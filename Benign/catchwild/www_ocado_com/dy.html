<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dy.html</title>
</head>
<body>

<script>
(function(document,Backbone,webshop){"use strict";webshop=webshop||{};webshop.dynamicYield=webshop.dynamicYield||{};webshop.dynamicYield.cookie={name:'_dyid',};webshop.dynamicYield.pageTypes={HOMEPAGE:'HOMEPAGE',CART:'CART',OTHER:'OTHER',};webshop.dynamicYield.eventTypes={addToCart:{name:'Add to Cart',type:'add-to-cart-v1',},removeFromCart:{name:'Remove from Cart',type:'remove-from-cart-v1',},syncCart:{name:'Sync Cart',type:'sync-cart-v1',},login:{name:'Login',type:'login-v1',},};webshop.dynamicYield.service={init(){if(this.isDYEnabled()){window.DY=window.DY||{};this.setActiveConsent(true);this.reportPageContext();this.reportLoginEvent();this.reportSyncCartEvent(this.cartMapper(_.get(webshop,'basketSummaryData.items',[])));this.initBasketChangeHandlers();}},initBasketChangeHandlers(){var rwdBasket=Backbone.Webshop.Basket;if(rwdBasket){rwdBasket.getInstance().on('change',this.onBasketChange,this);}else{document.observe('webshop:basket:update',this.onBasketUpdate.bind(this));}},isDYEnabled(){return(webshop.dynamicYield.siteId&&Backbone.Webshop.mixins.isBetaFeatureEnabled('DYNAMIC_YIELD'));},formatItemPrice(price,quantity){var parsePrice=Backbone.Webshop.mixins.parseFormattedPrice;var formattedPrice=typeof price==='string'?parsePrice({currentPrice:price}):price;if(!quantity){return formattedPrice;}
return Math.round((quantity*formattedPrice)*1000)/1000;},cartMapper(items){var formatPrice=this.formatItemPrice;return items.map(function(item){return{productId:item.sku,itemPrice:formatPrice(item.itemCataloguePrice),quantity:item.itemQuantity};});},onBasketUpdate(event){var jsonData=event.memo.data,eventData=jsonData&&jsonData.eventData,formatPrice=this.formatItemPrice;if(eventData&&eventData.quantity){var product=jsonData.lastItemUpdated;var items=JSON.parse(jsonData.items);var cart=items&&items.map(function(item){return{productId:item.sku,itemPrice:formatPrice(item.itemCataloguePrice),quantity:item.itemQuantity};});if(product){var quantity=Math.abs(eventData.quantity),productData={productId:product.sku,quantity:Math.abs(eventData.quantity),value:formatPrice(product.itemCataloguePrice,quantity),};this.reportCartEvent(productData,cart,eventData.quantity);this.reportSyncCartEvent(cart);}}},onBasketChange(model,response){if(response&&response.data){var sku=response.data.sku,items=model.get('items'),formatPrice=this.formatItemPrice;var cart=items&&items.map(function(item){var productId=item.get('sku'),itemPrice=formatPrice(item.get('itemPricePerUnit')),itemQuantity=item.get('itemQuantity');return{productId:productId,itemPrice:itemPrice,quantity:itemQuantity};});if(sku){var quantity=Math.abs(response.data.quantity),productData={productId:sku,quantity:quantity,value:formatPrice(response.data.price,quantity),};this.reportCartEvent(productData,cart,response.data.quantity);this.reportSyncCartEvent(cart);}}},setActiveConsent(initial){var cookiesList=webshop.cookies&&webshop.cookies.getCookieList()||[];var isDyCookieAllowed=cookiesList.includes(webshop.dynamicYield.cookie.name);window.DY.userActiveConsent={accepted:isDyCookieAllowed};if(typeof window.DYO!=='undefined'){window.DYO.ActiveConsent.updateConsentAcceptedStatus(isDyCookieAllowed);}
if(initial){webshop.cookies&&webshop.cookies.registerConsentChangedCallback(this.setActiveConsent.bind(this,false));}},reportPageContext(){var path=window.location.pathname;if(path==='/'||path==='/webshop/startWebshop.do'){window.DY.recommendationContext={type:webshop.dynamicYield.pageTypes.HOMEPAGE};return;}
if(path==='/webshop/displaySmartBasket.do'&&webshop.basketSummaryData&&webshop.basketSummaryData.items){var items=webshop.basketSummaryData.items.map(function(item){return item.sku;});window.DY.recommendationContext={type:webshop.dynamicYield.pageTypes.CART,data:items};return;}
window.DY.recommendationContext={type:webshop.dynamicYield.pageTypes.OTHER};},reportEvent(name,properties){if(window.DY.API&&typeof window.DY.API==='function'){window.DY.API('event',{name:name,properties:properties,});}},reportCartEvent(product,cart,quantityDelta){var eventTypes=webshop.dynamicYield.eventTypes,dyEvent=quantityDelta>0?eventTypes.addToCart:eventTypes.removeFromCart;this.reportEvent(dyEvent.name,{dyType:dyEvent.type,productId:product.productId,quantity:product.quantity,value:product.value,cart:cart,});},reportSyncCartEvent(cart){var dyEvent=webshop.dynamicYield.eventTypes.syncCart;this.reportEvent(dyEvent.name,{dyType:dyEvent.type,cart,});},reportLoginEvent(){if(webshop.justLoggedIn){var event=webshop.dynamicYield.eventTypes.login;var customerNum=webshop.info&&webshop.info.CI;if(customerNum){this.reportEvent(event.name,{properties:{dyType:event.type,cuid:customerNum,cuidType:'external',},});}}},};})(document,Backbone,webshop);
</script>

</body>
</html>
