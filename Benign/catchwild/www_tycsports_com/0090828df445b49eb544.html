<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0090828df445b49eb544.html</title>
</head>
<body>

<script>
/*! For license information please see 0090828df445b49eb544.js.LICENSE.txt */
(self.webpackChunk_marfeel_marfeel_sdk=self.webpackChunk_marfeel_marfeel_sdk||[]).push([[688],{688:(t,i,e)=>{e.r(i),e.d(i,{default:()=>Qt});let s={};function n(t,{cache:i=!0,readonly:e=!0}={}){try{if(!e)return new URL(t,document.baseURI);if(!s[t]){const{host:e,hostname:n,pathname:r,port:a,protocol:d,search:o,hash:l,href:u,origin:h}=new URL(t,document.baseURI),c={host:e,hostname:n,pathname:r,port:a,protocol:d,search:o,hash:l,href:u,origin:h};if(!i)return c;s[t]=c}return Object.assign({},s[t])}catch(t){return{}}}RegExp("^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])");const r=t=>n(t).href;var a=e(571);const d=()=>{try{return(0,a.Z)()}catch(t){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const i=16*Math.random()|0;return("x"===t?i:3&i|8).toString(16)}))}};var o=e(595);const l=(t,i=!1)=>"replicas"in t?t:{api:t,replicas:1,primary:i};class u{constructor(...t){this.apis=[],this.apis=t.map(((t,i)=>l(t,0===i)))}registerApi(t){this.apis.push(l(t))}post(...t){const[i,e,s]=t;this.apis.flatMap((t=>new Array(t.replicas).fill(t).map(((t,i)=>Object.assign(Object.assign({},t),{replicaId:`${i}`}))))).forEach((({api:t,replicaId:n,preprocess:r=(t=>t),primary:a})=>{try{const d=a?null==s?void 0:s.onSuccessCallback:void 0,o=a?null==s?void 0:s.onErrorCallback:void 0;t.post(i,r(e,null==s?void 0:s.contentType),Object.assign(Object.assign({},s),{onSuccessCallback:d,onErrorCallback:o,vars:Object.assign(Object.assign({},null==s?void 0:s.vars),{replicaId:n})}))}catch(t){}}))}}"function"==typeof SuppressedError&&SuppressedError;const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};var c,v,p,m,y=e(749);(m=c||(c={}))[m.XHR=0]="XHR",m[m.FETCH=1]="FETCH",m[m.BEACON=2]="BEACON",function(t){t[t.ABORT=0]="ABORT",t[t.NONE=1]="NONE",t[t.TIMER=2]="TIMER"}(v||(v={})),function(t){t[t.ORIGIN=0]="ORIGIN",t[t.FALLBACK=1]="FALLBACK"}(p||(p={}));const g=t=>null==t?void 0:t.replace(/\/$/,"");class f{constructor(t,{fallback:i,fallbackWindow:e=5e3,onModeChange:s=(()=>{}),timeout:n,timeoutStrategy:r}={}){this.mode=p.ORIGIN,this.pendingRequests={},this.endpoint=g(t),this.fallback=g(i),this.fallbackWindow=e,this.onModeChange=s,this.timeout=n,this.timeoutStrategy=r instanceof String?{strategy:r}:r}setRequestStatus(t,i=!0){this.pendingRequests[t]=i}isRequestPending(t){return!!this.pendingRequests[t]}switchMode(t,i){this.mode=t,window.setTimeout((()=>this.onModeChange(t,i)),0)}getUri(t,i={},e=this.mode){const s=t.startsWith("/")?t:`/${t}`;return function(t,i){const e=new RegExp(`:(${Object.keys(i).join("|")})`,"g");return t.replace(e,((t,e)=>i[e]||t))}(`${e===p.ORIGIN?this.endpoint:this.fallback}${s}`,i)}post(t,i,e={}){var s;const{onErrorCallback:n,onSuccessCallback:r,skipResponse:a=!1,vars:d,timeout:o,leaving:l}=e,u=function(t,i){var e={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(e[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)i.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(e[s[n]]=t[s[n]])}return e}(e,["onErrorCallback","onSuccessCallback","skipResponse","vars","timeout","leaving"]),m=this.mode,g=t=>{var i;return 408===t&&(null===(i=this.timeoutStrategy)||void 0===i?void 0:i.processor)||(t=>t)},f=!!l||a,M=f?void 0:this.fallback&&(s=>{if(this.fallback&&m===p.ORIGIN){const n=g(s);this.switchMode(p.FALLBACK,s),this.post(t,n(i,t),e),window.setTimeout((()=>this.switchMode(p.ORIGIN)),this.fallbackWindow)}else null==n||n(s)})||n,E=f?void 0:i=>{null==r||r(i),this.setRequestStatus(t,!1)},k=this.isRequestPending(t)&&(null===(s=this.timeoutStrategy)||void 0===s?void 0:s.forceOnExit)&&this.mode===p.ORIGIN&&l,b=(i,e=this.mode)=>{var s;!function(t,i,{contentType:e,sync:s=!1,onSuccessCallback:n,onErrorCallback:r,timeout:a,cancelOnTimeout:d}={}){const o=!!n||!!r,l=((t,i)=>y.TK||!y.hQ&&!y.jn||i?c.XHR:y.hQ&&(y.RX||t)?c.FETCH:y.jn&&!t?c.BEACON:c.XHR)(o,s),u=((t,i,e,s)=>i&&e&&t!==c.BEACON?s&&"AbortSignal"in window&&t===c.FETCH?v.ABORT:v.TIMER:v.NONE)(l,o,s?void 0:a,d),{onErrorCallback:p,onSuccessCallback:m}=((t,i,e,s)=>{if(t===v.TIMER){let t=!1;const n=window.setTimeout((()=>{t=!0,null==s||s(408)}),i),r=i=>e=>{t||(window.clearTimeout(n),null==i||i(e))};return{onSuccessCallback:r(e),onErrorCallback:r(s)}}return{onSuccessCallback:e,onErrorCallback:s}})(u,a,n,r),g=function(t,i){return"string"==typeof t?t:"application/x-www-form-urlencoded"===i?function(t){const i=[];return t.forEach(((t,e)=>{i.push(e+"="+encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,(function(t){return h[t]})))})),i.join("&")}(t):JSON.stringify(t)}(i,e);switch(l){case c.FETCH:return void((t,i,{contentType:e,keepalive:s=!1,timeout:n}={})=>{let r=i;const a=void 0!==n?{signal:window.AbortSignal.timeout(n)}:{};return e&&(r=new Blob([i],{type:e})),fetch(t,Object.assign({method:"POST",body:r,keepalive:s,credentials:"include"},a))})(t,g,{contentType:e,keepalive:!0,timeout:u===v.ABORT?a:void 0}).then((t=>(t.ok||null==p||p(t.status),t.text()))).then((t=>null==m?void 0:m(t))).catch((t=>{const i=(t=>t instanceof DOMException&&("TimeoutError"===t.name||t.code===DOMException.TIMEOUT_ERR))(t)?408:0;null==p||p(i)}));case c.BEACON:return void((t,i,{contentType:e}={})=>{let s=i;e&&(s=new Blob([i],{type:e})),window.navigator.sendBeacon(t,s)})(t,g,{contentType:e});default:!function(t,i,{onSuccessCallback:e,onErrorCallback:s,contentType:n,sync:r=!1}={}){const a=!r,d=new XMLHttpRequest;d.open("POST",t,a),n&&d.setRequestHeader("Content-Type",n),d.withCredentials=!0,r||(d.onreadystatechange=()=>{4===d.readyState&&(200===d.status?null==e||e(d.responseText):null==s||s(d.status))}),d.send(i),r&&d.responseText}(t,g,{onSuccessCallback:m,contentType:e,onErrorCallback:p,sync:s})}}(this.getUri(t,d,e),i,Object.assign(Object.assign({},u),{onSuccessCallback:E,onErrorCallback:M,timeout:null!=o?o:this.timeout,cancelOnTimeout:"abort"===(null===(s=this.timeoutStrategy)||void 0===s?void 0:s.strategy)}))};this.setRequestStatus(t,!f),b(i),k&&b(g(408)(i,t),p.FALLBACK)}}var M=e(539);function E(t=new Date){return Math.floor(t.getTime()/1e3)}function k(t,i,e,s){return new(e||(e=Promise))((function(n,r){function a(t){try{o(s.next(t))}catch(t){r(t)}}function d(t){try{o(s.throw(t))}catch(t){r(t)}}function o(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(a,d)}o((s=s.apply(t,i||[])).next())}))}const b=t=>t?1:0,I=t=>{const i={};return null===t||"object"!=typeof t?t:t instanceof Array?t.map(I):(Object.keys(t).forEach((e=>{void 0!==t[e]&&("[object Object]"===Object.prototype.toString.call(t[e])?i[e]=I(t[e]):i[e]=t[e])})),i)},T=t=>function(t,i,e,s){return new(e||(e=Promise))((function(t,i){function n(t){try{a(s.next(t))}catch(t){i(t)}}function r(t){try{a(s.throw(t))}catch(t){i(t)}}function a(i){var s;i.done?t(i.value):(s=i.value,s instanceof e?s:new e((function(t){t(s)}))).then(n,r)}a((s=s.apply(void 0,[])).next())}))}(0,0,void 0,(function*(){const i=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(t));return Array.from(new Uint8Array(i)).map((t=>("00"+t.toString(16)).slice(-2))).join("")})),w="undefined"!=typeof window&&window.location.hash.includes("mrfdebug"),S=function(){for(var t=arguments.length,i=new Array(t),e=0;e<t;e++)i[e]=arguments[e];w&&console.debug("%c[tracker-multimedia] %c","color:#ff9423","color: inherit",...i)};var P,L;(L=P||(P={})).PLAY="play",L.PAUSE="pause",L.END="end",L.UPDATE_CURRENT_TIME="updateCurrentTime",L.AD_PLAY="adPlay",L.MUTE="mute",L.UNMUTE="unmute",L.FULL_SCREEN="fullscreen",L.BACK_SCREEN="backscreen",L.ENTER_VIEWPORT="enterViewport",L.LEAVE_VIEWPORT="leaveViewport",L.MRF_MULTIMEDIA_ENGAGED="MRF_MULTIMEDIA_ENGAGED";const C=P.PLAY,A=P.PAUSE,x=P.END,O=P.UPDATE_CURRENT_TIME,_=P.AD_PLAY,R=P.MUTE,j=P.UNMUTE,N=P.FULL_SCREEN,F=P.BACK_SCREEN,W=P.ENTER_VIEWPORT,U=P.LEAVE_VIEWPORT,D=P.MRF_MULTIMEDIA_ENGAGED,B={[C]:"trackPlay",[A]:"trackPause",[x]:"trackEnd",[O]:"updateCurrentTime",[_]:"trackAdPlay",[R]:"trackMute",[j]:"trackUnmute",[N]:"trackFullScreen",[F]:"trackBackScreen",[W]:"trackEnterViewport",[U]:"trackLeaveViewport"};class q{constructor(){this.adsStarted=!1,this.started=!1,this.ended=!1,this.ads=[],this.maxPlayTime=0,this.play=[],this.pause=[],this.mute=[],this.unmute=[],this.backScreen=[],this.fullScreen=[],this.inViewport=!1}addEvent(t,i){const e=B[t],s=Math.round(i);e&&(this[e](s),this.updateCurrentTime(s))}trackPlay(t){this.play.push(t),this.started=!0}trackPause(t){this.pause.push(t)}trackEnd(t){this.ended=!0,this.pause.push(t)}updateCurrentTime(t){t>this.maxPlayTime&&(this.maxPlayTime=t)}trackAdPlay(t){this.ads.push(t),this.adsStarted=!0}trackMute(t){this.mute.push(t)}trackUnmute(t){this.unmute.push(t)}trackFullScreen(t){this.fullScreen.push(t)}trackBackScreen(t){this.backScreen.push(t)}trackEnterViewport(){this.inViewport=!0}trackLeaveViewport(){this.inViewport=!1}isSoundOn(){const t=this.mute.length?this.mute[this.mute.length-1]:-1,i=this.unmute.length?this.unmute[this.unmute.length-1]:-1;return-1===t||t<=i}isFullscreen(){const t=this.fullScreen.length?this.fullScreen[this.fullScreen.length-1]:-1,i=this.backScreen.length?this.backScreen[this.backScreen.length-1]:-1;return-1!==t&&i<t}isEngaged(){const t=this.isSoundOn(),i=this.isFullscreen();return t||i||this.inViewport}getSanitizedObject(){return{as:b(this.adsStarted),s:b(this.started),e:b(this.ended),ap:this.ads.length,mp:this.maxPlayTime,ads:this.ads,play:this.play,pause:this.pause,mute:this.mute,unmute:this.unmute,bscr:this.backScreen,fscr:this.fullScreen}}}class V{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isLive=t.isLive,this.title=t.title,this.description=t.description,this.url=t.url,this.thumbnail=t.thumbnail,this.authors=t.authors,this.publishTime=t.publishTime,this.duration=t.duration}getMediaLength(){const t=parseInt(this.duration,10);return isNaN(t)?this.isLive?-1:0:t}setMetadata(t){Object.assign(this,t)}getSanitizedObject(){return{m_il:this.isLive&&b(this.isLive),m_ti:this.title,m_d:this.description,m_u:this.url,m_th:this.thumbnail?r(this.thumbnail):void 0,m_a:this.authors,m_pt:this.publishTime,m_l:this.duration}}}const $=[W,U];class z{constructor(t,i,e){let{metadata:s,tick:n=0,uuid:r=d()}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.playbackInfo=new q,this.metadata=new V(s),this.editorialMetadata=null,this.provider=t,this.providerId=i,this.type=e,this.imp=r,this.tick=n,this.alreadySentProperties={},this.metadataUpdated=!0}addEvent(t,i){const e=this.metadata.getMediaLength()||0;return e===1/0||-1===e||i<=e+1||$.includes(t)?(this.playbackInfo.addEvent(t,i),S("addEvent: ".concat(t," added | eventTime: ").concat(i," | duration: ").concat(e)),!0):(S("addEvent: ".concat(t," rejected | eventTime: ").concat(i," | duration: ").concat(e)),!1)}incrementTick(t){void 0!==t?this.tick=t:this.tick++}setMetadata(t){this.metadata.setMetadata(t),this.metadataUpdated=!0}setEditorialMetadata(t){this.editorialMetadata=t}getItemAndPlaybackInfo(){return{a:this.tick,imp:this.imp,m_p:this.provider,m_pi:this.providerId,m_t:this.type,m:this.playbackInfo.getSanitizedObject()}}getMetadata(){return this.metadata.getSanitizedObject()}isMetadataUpdated(){return this.metadataUpdated}markMetadataUnupdated(){this.metadataUpdated=!1}isEngaged(){return this.playbackInfo.isEngaged()}}const G="iframe_api";class H{constructor(t,i,e,s,n,r,a){this.mediaId=i,this.id=`${t}${i}`,this.duration=e,this.title=s,this.url=n,this.thumbnail=r,this.authors=a,this.mediaStarted=!1,this.muted=!1}timeupdate(){this.mediaStarted=!0}getMetadata(){return{isLive:!1,title:this.title||this.url||"no title",url:this.url,duration:this.duration,thumbnail:this.thumbnail,authors:this.authors}}}const Y=t=>`yt-${t}`,K=/youtube\.com\/embed\/([a-zA-Z0-9_-]+)/;function X(t,i){const e=i.length?document.querySelectorAll(i.join(",")):[];return Array.from(e).some((i=>i.contains(t)))}function J(t){return"http://schema.org/VideoObject"===t.getAttribute("itemtype")?t:t.parentElement?J(t.parentElement):null}function Q(t,i){const e=t.querySelector(i);return"META"===(null==e?void 0:e.tagName)?e.content:e?e.textContent:null}const Z="enablejsapi=1";class tt{constructor(t,i){var e;this.players={},this.tracker=t,this.selectorBlacklist=null!==(e=null==i?void 0:i.selectorBlacklist)&&void 0!==e?e:[]}findPlayers(){console.warn("findPlayers not implemented")}startListening(){this.findPlayers(),(0,o.N)((()=>{this.findPlayers()}))}isBlacklisted(t){return X(t,this.selectorBlacklist)}listen(t){const i=t.getPlayerId();return!(!i||this.players[i]||(this.players[i]=t,t.listen(((t,i,e,s,n,r)=>this.tracker.initializeItem(t,i,e,s,n,r)),((t,i,e)=>this.tracker.registerEvent(t,i,e)),((t,i)=>this.tracker.setItemMetadata(t,i))),0))}}class it{constructor(){this.timers={},this.domainWhiteList=[]}getCurrentMediaId(){const t=this.getCurrentMedia();return null==t?void 0:t.id}isValidMedia(t){return!this.domainWhiteList.length||!t||this.domainWhiteList.some((i=>-1!==t.indexOf(i)))}listen(t,i,e){this.initMediaFunc=t,this.trackMediaEventFunc=i,this.setItemMetadataFunc=e}trackEvent(t){var i,e;return k(this,void 0,void 0,(function*(){null===(i=this.updateMetadata)||void 0===i||i.call(this);const s=yield this.getCurrentPlayerTime(),n=this.getCurrentMedia();if(n&&n.id){const i=t;n[i]&&"function"==typeof n[i]&&n[i](null!=s?s:0),this.trackMediaEventFunc&&(null===(e=this.trackMediaEventFunc)||void 0===e||e.call(this,n.id,t,null!=s?s:0))}}))}trackOnInterval(t){const i=this.getCurrentMediaId();i&&!this.timers[i]&&(this.timers[i]=setInterval((()=>{var i;null===(i=this.updateMetadata)||void 0===i||i.call(this),this.trackEvent(t)}),5e3))}stopTimer(){const t=this.getCurrentMediaId();t&&this.timers[t]&&(clearInterval(this.timers[t]),delete this.timers[t])}}class et{constructor(t,i,e){var s;this.videoId=(s=i).mediaid||s.idmedia||s.file.replace(/\//g,""),this.id="".concat(t).concat(this.videoId),this.video=i,this.duration=e,this.currentTime=0,this.playing=!1}play(){this.playing=!0}pause(){this.playing=!1}getMetadata(){const t=this.video.sources.length>0?this.video.sources[0]:null,i=t?t.file:this.video.file;return{isLive:!this.duration,title:this.video.title||i||"no title",url:i,thumbnail:t&&t.image?t.image:this.video.image,description:this.video.description,publishTime:this.video.pubdate,duration:this.duration}}}const st=["mp3"];class nt extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]};var e,s;if(super(),this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],t.getPlaylistItem()){const i=t.getPlaylistItem(),e=(null===(s=null==i?void 0:i.sources)||void 0===s?void 0:s.length)>0?i.sources[0]:null,n=e?null==e?void 0:e.file:null==i?void 0:i.file;this.isValidMedia(n)&&(this.player=t,this.setupMedia())}}setupMedia(){const t=this.player.getPlaylistItem();(t.mediaid||t.file)&&(this.currentMedia=new et(this.player.uniqueId,t,this.player.getDuration()))}getPlayerId(){var t;return null===(t=this.player)||void 0===t?void 0:t.uniqueId}listen(t,i,e){super.listen(t,i,e),this.initMedia(),this.listenToEvents()}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){return this.player.getCurrentTime?this.player.getCurrentTime():this.player.getPosition()}initMedia(){var t;if(this.currentMedia){const i=st.find((t=>{var i,e;return null===(e=null===(i=this.currentMedia)||void 0===i?void 0:i.getMetadata().url)||void 0===e?void 0:e.endsWith(t)}));this.initMediaFunc(this.currentMedia.id,"jwplayer",this.currentMedia.videoId,i?"audio":"video",this.currentMedia.getMetadata(),null===(t=this.player)||void 0===t?void 0:t.getContainer())}}reset(){this.setupMedia(),this.initMedia()}updateMetadata(){var t;if(0===(null===(t=this.currentMedia)||void 0===t?void 0:t.duration)){const t=this.player.getDuration();0!==t&&(this.currentMedia.duration=t,this.setItemMetadataFunc(this.getCurrentMediaId(),{duration:t,isLive:!1}))}}listenToEvents(){this.player.on("beforePlay",(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.on("pause",(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.on("beforeComplete",(()=>{this.stopTimer(),this.trackEvent(x)})),this.player.on("adPlay",(()=>{this.trackEvent(_)})),this.player.on("mute",(t=>{t.mute?this.trackEvent(R):this.trackEvent(j)})),this.player.on("fullscreen",(t=>{t.fullscreen?this.trackEvent(N):this.trackEvent(F)})),this.player.on("nextClick",(()=>{var t;(null===(t=this.currentMedia)||void 0===t?void 0:t.playing)&&this.trackEvent(A)})),this.player.on("playlistItem",(()=>{this.stopTimer(),this.reset()}))}}class rt{constructor(t,i,e,s,n){this.videoId=i,this.id="".concat(t).concat(i),this.duration=e,this.title=s,this.publishTime=n,this.videoStarted=!1}timeupdate(){this.videoStarted=!0}getMetadata(){return{isLive:!this.duration,title:this.title||"no title",url:"https://www.dailymotion.com/embed/video/".concat(this.videoId),thumbnail:"https://www.dailymotion.com/thumbnail/video/".concat(this.videoId),duration:this.duration,publishTime:this.publishTime}}}class at extends it{constructor(t){super(),this.player=t,this.ready=new Promise((t=>{this.setupMedia().then(t)}))}setupMedia(){return k(this,void 0,void 0,(function*(){const{videoTitle:t,videoId:i,videoDuration:e,playerPresentationMode:s,playerIsMuted:n,id:r,videoCreatedTime:a}=yield this.player.getState(),d=!!i;this.playerId=r,d&&(this.fullscreen="fullscreen"===s,this.muted=n,this.currentMedia=new rt(r,i,e,t,a))}))}listen(t,i){super.listen(t,i),this.initMedia(),this.listenToEvents()}getPlayerId(){return this.playerId}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){var t;return k(this,void 0,void 0,(function*(){let i=0;return(null===(t=this.currentMedia)||void 0===t?void 0:t.videoStarted)&&(i=(yield this.player.getState()).videoTime),i}))}trackEvent(t){return k(this,void 0,void 0,(function*(){const i=yield this.getCurrentPlayerTime();this.trackMediaEventFunc(this.getCurrentMediaId(),t,i)}))}initMedia(){var t;this.currentMedia&&(this.initMediaFunc(this.currentMedia.id,"dailymotion",this.currentMedia.videoId,"video",this.currentMedia.getMetadata(),null===(t=null==this?void 0:this.player)||void 0===t?void 0:t.getRootNode()),this.muted&&this.trackEvent(R))}reset(){return k(this,void 0,void 0,(function*(){yield this.setupMedia(),this.initMedia()}))}listenToEvents(){this.player.on("timeupdate",(()=>{var t;null===(t=this.currentMedia)||void 0===t||t.timeupdate()})),this.player.on(C,(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.on(A,(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.on("video_end",(()=>{this.stopTimer(),this.trackEvent(x)})),this.player.on("ad_play",(()=>{this.trackEvent(_)})),this.player.on("pes_presentationmodechange",(()=>k(this,void 0,void 0,(function*(){const t="fullscreen"===(yield this.player.getState()).playerPresentationMode;t!==this.fullscreen&&(this.fullscreen=t,t?this.trackEvent(N):this.trackEvent(F))})))),this.player.on("volumechange",(()=>k(this,void 0,void 0,(function*(){const t=(yield this.player.getState()).playerIsMuted;t!==this.muted&&(this.muted=t,t?this.trackEvent(R):this.trackEvent(j))})))),this.player.on("videochange",(()=>{this.stopTimer(),this.reset()}))}}const dt=window,ot="changeMedia";class lt{constructor(t){const i=t.id,e=t.evaluate("{mediaProxy.entry.id}");this.videoId=e,this.id="".concat(i).concat(e),this.player=t,this.videoStarted=!1}timeupdate(){this.videoStarted=!0}getMetadata(){const t=this.player.evaluate("{mediaProxy.entry.dataUrl}");return{isLive:b(this.player.evaluate("{mediaProxy.isLive}")),title:this.player.evaluate("{mediaProxy.entry.name}")||t||"no title",description:this.player.evaluate("{mediaProxy.entry.description}"),url:t,thumbnail:this.player.evaluate("{mediaProxy.entry.thumbnailUrl}"),duration:this.player.evaluate("{mediaProxy.entry.duration}"),publishTime:this.player.evaluate("{mediaProxy.entry.createdAt}"),authors:this.player.evaluate("{mediaProxy.entryMetadata.Author}")}}}class ut extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]};var e;super(),this.player=t,this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.ready=new Promise((t=>{this.player.kBind(ot,(()=>k(this,void 0,void 0,(function*(){this.player.kUnbind(ot),yield this.setupMedia(),t()}))))}))}setupMedia(){this.playerId=this.player.id;const t=this.player.evaluate("{mediaProxy.entry.dataUrl}");this.currentMedia=this.isValidMedia(t)?new lt(this.player):void 0}listen(t,i){super.listen(t,i),this.initMedia(),this.listenToEvents()}getPlayerId(){return this.playerId}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){return this.player?this.player.evaluate("{video.player.currentTime}"):0}trackEvent(t){if(this.currentMedia){const i=this.getCurrentPlayerTime();this.trackMediaEventFunc(this.getCurrentMediaId(),t,i)}}initMedia(){this.currentMedia&&(S("Initializing media tracking > ",this.player.id," - ",this.currentMedia.videoId),this.initMediaFunc(this.currentMedia.id,"kaltura",this.currentMedia.videoId,"video",this.currentMedia.getMetadata(),this.player))}reset(){return k(this,void 0,void 0,(function*(){yield this.setupMedia(),this.initMedia()}))}listenToEvents(){S("Attaching event listeners > ",this.player.id),this.player.kBind("playerUpdatePlayhead",(()=>{this.trackEvent(O)})),this.player.kBind("playerPlayed",(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.kBind("playerPaused",(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.kBind("playbackComplete",(()=>{this.stopTimer(),this.trackEvent(x)})),this.player.kBind("onAdPlay",(()=>{this.trackEvent(_)})),this.player.kBind("openFullScreen",(()=>{this.trackEvent(N)})),this.player.kBind("closeFullScreen",(()=>{this.trackEvent(F)})),this.player.kBind("mute",(()=>{this.trackEvent(R)})),this.player.kBind("unmute",(()=>{this.trackEvent(j)})),this.player.kBind(ot,(()=>{this.stopTimer(),this.reset()}))}}const ht=window;class ct{constructor(t,i,e,s,n,r,a,d,o,l){this.isLive=!1,this.mediaId=i,this.id=`${t}${i}`,this.duration=e,this.title=s,this.url=n,this.author=o,this.description=l,this.thumbnail=a,this.publishTime=d,this.mediaStarted=!1,this.isLive=null!=r&&r}timeupdate(){this.mediaStarted=!0}getMetadata(){var t;return{isLive:this.isLive,title:null!==(t=this.title)&&void 0!==t?t:null,url:this.url,duration:this.duration,thumbnail:this.thumbnail,publishTime:this.publishTime,authors:this.author,description:this.description}}}class vt extends it{constructor(t){super(),this.getPlayerId=()=>this.playerId,this.updateMetadata=()=>k(this,void 0,void 0,(function*(){var t,i,e,s;if(0===(null===(t=this.currentMedia)||void 0===t?void 0:t.duration)||isNaN(null!==(e=null===(i=this.currentMedia)||void 0===i?void 0:i.duration)&&void 0!==e?e:0)){const t=this.player.duration;0!==t&&this.currentMedia&&(this.currentMedia.duration=t,null===(s=this.setItemMetadataFunc)||void 0===s||s.call(this,this.getCurrentMediaId(),{duration:t}))}})),this.getCurrentMedia=()=>this.currentMedia,this.getCurrentPlayerTime=()=>k(this,void 0,void 0,(function*(){var t;let i=0;return(null===(t=this.currentMedia)||void 0===t?void 0:t.mediaStarted)&&(i=this.player.currentTime),i})),this.player=t,this.providerName="generic-audio",this.ready=new Promise((t=>{this.setupMedia().then(t)}))}setupMedia(){var t,i;return k(this,void 0,void 0,(function*(){const e=this.player.title||this.player.src,s=this.player.duration,n=this.player.src||(null!==(i=null===(t=this.player.querySelector("source"))||void 0===t?void 0:t.src)&&void 0!==i?i:""),r=yield T(n.startsWith("blob:")?e:n);this.playerId=r,this.currentMedia=new ct(r,r,s,e||n,n)}))}listen(t,i,e){var s;super.listen(t,i,e),this.currentMedia&&(null===(s=this.initMediaFunc)||void 0===s||s.call(this,this.currentMedia.id,this.providerName,this.currentMedia.mediaId,"audio",this.currentMedia.getMetadata(),this.player)),this.initializePlayer()}initializePlayer(){this.muted=0===this.player.volume,this.listenToEvents(),this.player.autoplay&&(this.trackOnInterval(O),this.trackEvent(C))}trackEvent(t){var i;return k(this,void 0,void 0,(function*(){const e=yield this.getCurrentPlayerTime();this.getCurrentMediaId()&&(null===(i=this.trackMediaEventFunc)||void 0===i||i.call(this,this.getCurrentMediaId(),t,e))}))}listenToEvents(){this.player.addEventListener("timeupdate",(()=>{var t;null===(t=this.currentMedia)||void 0===t||t.timeupdate()})),this.player.addEventListener(C,(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.addEventListener(A,(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.addEventListener("ended",(()=>{this.stopTimer(),this.trackEvent(x)})),this.player.addEventListener("volumechange",(()=>{const t=0===this.player.volume;t!==this.muted&&(this.muted=t,t?this.trackEvent(R):this.trackEvent(j))}))}}const pt="ended",mt="volumechange",yt="timeupdate",gt=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange"];class ft{constructor(t,i,e,s,n,r){this.mediaId=i,this.id="".concat(t).concat(i),this.duration=e,this.title=s,this.url=n,this.thumbnail=r,this.mediaStarted=!1}timeupdate(){this.mediaStarted=!0}getMetadata(){return{isLive:!1,title:this.title||this.url||"no title",url:this.url,duration:this.duration,thumbnail:this.thumbnail}}}const Mt=["taboola"];class Et extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"generic-video";var s;super(),this.player=t,this.domainWhiteList=null!==(s=null==i?void 0:i.domainWhiteList)&&void 0!==s?s:[],this.providerName=e,this.ready=new Promise((t=>{this.setupMedia().then(t)}))}retrieveMetadata(){return k(this,void 0,void 0,(function*(){return{}}))}setupMedia(){var t,i,e,s;return k(this,void 0,void 0,(function*(){const n=yield this.retrieveMetadata(),r=this.player.duration,a=this.player.src||(null!==(i=null===(t=this.player.querySelector("source"))||void 0===t?void 0:t.src)&&void 0!==i?i:""),d=null!==(e=n.url)&&void 0!==e?e:a,o=this.player.title||n.title||d,l=this.player.poster||n.thumbnail,u=null!==(s=n.id)&&void 0!==s?s:yield T(d.startsWith("blob:")?o:d);this.playerId=u,this.url=d,this.currentMedia=new ft(u,u,r,o,d,l)}))}isValidMedia(){var t,i;try{const i=new URL(this.url).origin;return(null===(t=this.domainWhiteList)||void 0===t?void 0:t.length)?this.domainWhiteList.some((t=>i.includes(t))):!Mt.some((t=>i.includes(t)))}catch(t){S("Couldn't validate media",t)}return!(null===(i=this.domainWhiteList)||void 0===i?void 0:i.length)}getPlayerId(){return this.playerId}shouldReset(){return!1}initMedia(){this.initMediaFunc(this.currentMedia.id,this.providerName,this.currentMedia.mediaId,"video",this.currentMedia.getMetadata(),this.player)}reset(){return k(this,void 0,void 0,(function*(){yield this.setupMedia(),this.initMedia()}))}listen(t,i,e){super.listen(t,i,e),this.initMedia(),this.initializePlayer()}initializePlayer(){this.muted=0===this.player.volume,this.listenToEvents(),this.player.autoplay&&(this.trackOnInterval(O),this.trackEvent(C))}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){var t;return k(this,void 0,void 0,(function*(){let i=0;return(null===(t=this.currentMedia)||void 0===t?void 0:t.mediaStarted)&&(i=this.player.currentTime),i}))}updateMetadata(){var t,i;if(0===(null===(t=this.currentMedia)||void 0===t?void 0:t.duration)||isNaN(null===(i=this.currentMedia)||void 0===i?void 0:i.duration)){const t=this.player.duration;0!==t&&(this.currentMedia.duration=t,this.setItemMetadataFunc(this.getCurrentMediaId(),{duration:t,isLive:!1}))}}trackEvent(t){return k(this,void 0,void 0,(function*(){const i=yield this.getCurrentPlayerTime();this.trackMediaEventFunc(this.getCurrentMediaId(),t,i)}))}listenToEvents(){this.player.addEventListener(yt,(()=>{var t;this.shouldReset()&&this.reset(),null===(t=this.currentMedia)||void 0===t||t.timeupdate()})),this.player.addEventListener(C,(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.addEventListener(A,(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.addEventListener(pt,(()=>{this.stopTimer(),this.trackEvent(x)}));for(const t of gt)this.player.addEventListener(t,(t=>{document.fullscreenElement===t.target?this.trackEvent(N):this.trackEvent(F)}));this.player.addEventListener(mt,(()=>k(this,void 0,void 0,(function*(){const t=0===this.player.volume;t!==this.muted&&(this.muted=t,t?this.trackEvent(R):this.trackEvent(j))}))))}}class kt{constructor(t,i,e,s,n,r,a,d){this.mediaId=i,this.id=`${t}${i}`,this.duration=e,this.title=s,this.url=n,this.thumbnail=r,this.isLive=a||0,this.mediaStarted=!1,this.initialTime=d||0}timeupdate(){this.mediaStarted=!0}getMetadata(){return{isLive:!!this.isLive,title:this.title||this.url||"no title",url:this.url,duration:this.duration,thumbnail:this.thumbnail}}}function bt(t,i){return i.split(".").reduce(((t,i)=>"function"==typeof t?t()[i]:"object"==typeof t&&null!==t&&i in t?t[i]:void 0),t)}function It(t,i){return i.duration?bt(t,i.duration):t.duration()}class Tt extends it{constructor(t,i){var e,s,n,r,a,d,o,l,u,h,c,v,p,m,y,g,f,M;super(),this.playerInitialized=!1,this.getPlayerId=()=>this.playerId,this.getCurrentMedia=()=>this.currentMedia,this.getCurrentPlayerTime=()=>k(this,void 0,void 0,(function*(){var t,i,e;let s=0;try{(null===(t=this.currentMedia)||void 0===t?void 0:t.mediaStarted)&&(s=(null===(i=this.player)||void 0===i?void 0:i.currentTime())-(null===(e=this.currentMedia)||void 0===e?void 0:e.initialTime))}catch(t){this.stopTimer()}return s})),this.updateMetadata=()=>{var t,i;const e=It(this.player,this.mappings);0!==e&&this.currentMedia&&(null===(t=this.currentMedia)||void 0===t?void 0:t.duration)!==e&&!this.videoEnded&&(this.currentMedia.duration=e,null===(i=this.setItemMetadataFunc)||void 0===i||i.call(this,this.getCurrentMediaId(),{duration:e,isLive:!1}))},this.player=t,this.playerId=`${Date.now()}`,this.config=i,this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.providerName=(null==i?void 0:i.providerName)||"videojs",this.videoEnded=!1,this.mappings={title:null!==(r=null===(n=null===(s=null==i?void 0:i.mappings)||void 0===s?void 0:s.videojs)||void 0===n?void 0:n.title)&&void 0!==r?r:"options_.title",thumbnail:null!==(o=null===(d=null===(a=null==i?void 0:i.mappings)||void 0===a?void 0:a.videojs)||void 0===d?void 0:d.thumbnail)&&void 0!==o?o:"options_.poster",url:null!==(h=null===(u=null===(l=null==i?void 0:i.mappings)||void 0===l?void 0:l.videojs)||void 0===u?void 0:u.url)&&void 0!==h?h:"options_.sources.0.src",isLive:null!==(p=null===(v=null===(c=null==i?void 0:i.mappings)||void 0===c?void 0:c.videojs)||void 0===v?void 0:v.isLive)&&void 0!==p?p:"",duration:null===(y=null===(m=null==i?void 0:i.mappings)||void 0===m?void 0:m.videojs)||void 0===y?void 0:y.duration,id:null!==(M=null===(f=null===(g=null==i?void 0:i.mappings)||void 0===g?void 0:g.videojs)||void 0===f?void 0:f.id)&&void 0!==M?M:""},this.ready=new Promise((t=>{this.setupMedia().then(t)}))}resetMedia(){return k(this,void 0,void 0,(function*(){this.stopTimer(),this.videoEnded=!1,yield this.setupMedia(),this.initMedia()}))}getTitle(){}getUrl(){}getThumbnail(){}getId(t){return k(this,void 0,void 0,(function*(){return yield T(t)}))}setupMedia(){var t,i,e,s,n,r,a;return k(this,void 0,void 0,(function*(){const d=this.player.options_,o=null!==(e=null===(i=null===(t=this.player)||void 0===t?void 0:t.currentSrc)||void 0===i?void 0:i.call(t))&&void 0!==e?e:"",l=null!==(s=this.getUrl())&&void 0!==s?s:null!==(n=bt(this.player,this.mappings.url))&&void 0!==n?n:o,u=this.getTitle()||bt(this.player,this.mappings.title)||bt(d,this.mappings.title)||l,h=It(this.player,this.mappings),c=this.mappings.id?bt(this.player,this.mappings.id):yield this.getId(l);this.url=l,l&&this.isValidMedia(l)&&(this.currentMedia=new kt(c,c,h,u,l,null!==(r=this.getThumbnail())&&void 0!==r?r:bt(this.player,this.mappings.thumbnail),(null!==(a=bt(this.player,this.mappings.isLive))&&void 0!==a?a:d.liveui||"true"===d.liveui)?1:0,this.player.currentTime()))}))}listen(t,i,e){super.listen(t,i,e),this.currentMedia&&this.initMedia(),this.listenToEvents()}initMedia(){var t,i,e,s,n,r;this.currentMedia&&!this.playerInitialized&&(null===(t=this.initMediaFunc)||void 0===t||t.call(this,this.currentMedia.id,this.providerName,this.currentMedia.mediaId,(null===(i=this.player)||void 0===i?void 0:i.isAudio_)||(null===(s=null===(e=this.player.options_)||void 0===e?void 0:e.model)||void 0===s?void 0:s.audioType)?"audio":"video",this.currentMedia.getMetadata(),null===(r=(n=this.player).el)||void 0===r?void 0:r.call(n)),this.playerInitialized=!0,this.initializePlayer())}initializePlayer(){var t,i,e,s,n,r,a,d;this.muted=0===this.player.volume(),this.fullscreen=this.player.isFullscreen(),(this.player.options_.autoplay||(null===(i=(t=this.player).hasStarted)||void 0===i?void 0:i.call(t)))&&(this.trackOnInterval(O),this.trackEvent(C)),((null===(n=null===(s=null===(e=this.player)||void 0===e?void 0:e.Ads)||void 0===s?void 0:s.call(e))||void 0===n?void 0:n.adPlaying)||(null===(d=null===(a=null===(r=this.player)||void 0===r?void 0:r.ads)||void 0===a?void 0:a.isAdPlaying)||void 0===d?void 0:d.call(a)))&&this.trackEvent(_)}trackEvent(t){var i,e;return k(this,void 0,void 0,(function*(){if(this.getCurrentMedia()){null===(i=this.updateMetadata)||void 0===i||i.call(this);const s=yield this.getCurrentPlayerTime();null===(e=this.trackMediaEventFunc)||void 0===e||e.call(this,this.getCurrentMediaId(),t,null!=s?s:0)}}))}listenToEvents(){var t,i;this.player.on("timeupdate",(()=>{var t;null===(t=this.currentMedia)||void 0===t||t.timeupdate()})),this.player.on("loadedmetadata",(()=>k(this,void 0,void 0,(function*(){this.url!==this.player.currentSrc()&&(yield this.resetMedia())})))),this.player.on("play",(()=>k(this,void 0,void 0,(function*(){this.url!==this.player.currentSrc()&&(yield this.resetMedia()),this.trackOnInterval(O),this.trackEvent(C)})))),this.player.on("pause",(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.on("ended",(()=>{this.stopTimer(),this.trackEvent(x),this.videoEnded=!0})),this.player.on("fullscreenchange",(()=>{this.fullscreen!==this.player.isFullscreen()&&(this.fullscreen=this.player.isFullscreen(),this.fullscreen?this.trackEvent(N):this.trackEvent(F))})),this.player.on(null!==(i=null===(t=null==this?void 0:this.config)||void 0===t?void 0:t.adsStartEvent)&&void 0!==i?i:"ads-ad-started",(()=>{this.trackEvent(_)}))}}const wt=t=>{var i,e;if(!t.parentElement)return null;const s=t.parentElement;return(null===(i=s.player)||void 0===i?void 0:i.player_)?s.player:(null===(e=s.player2)||void 0===e?void 0:e.player_)?s.player2:null},St=":not([data-compass-listening], [data-compass-skipped])",Pt=`${St} > video`,Lt=`${St} > audio`;class Ct extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=Array.from(document.querySelectorAll(`.video-js${Pt}, .video-js${Lt},.vjs-v7${Pt}, .vjs-v7${Lt}`)).filter((t=>!!wt(t)&&!this.isBlacklisted(t)));this.testing=Promise.all(Array.from(t).map((t=>k(this,void 0,void 0,(function*(){var i,e;const s=new Tt(wt(t),this.config);yield s.ready,this.listen(s)?null===(i=t.parentElement)||void 0===i||i.setAttribute("data-compass-listening","true"):(S("Generic video skipped: ",s.url),null===(e=t.parentElement)||void 0===e||e.setAttribute("data-compass-skipped","true"))}))))),yield this.testing}))}}class At{constructor(t,i,e){this.videoId=i.SM_ID,this.id="".concat(t).concat(this.videoId),this.video=i,this.started=e.started,this.fullscreen=e.fullscreen,this.muted=e.muted,this.paused=e.paused,this.adPlaying=e.adPlaying,this.currentTime=0;const s=function(t){const i=t.split(":").map((t=>parseInt(t,10)));return 3===i.length?3600*i[0]+60*i[1]+i[2]:2===i.length?60*i[0]+i[1]:i[0]}(e.duration);this.duration=s>0?s:-1}addTime(t){(this.currentTime<this.duration||-1===this.duration)&&(this.currentTime+=t)}isPlaying(){return this.started&&!this.paused}hasEnded(){return this.isPlaying()&&this.duration-this.currentTime<=5}updatePlaybackInfo(t){this.started=t.started,this.paused=t.paused,this.muted=t.muted,this.fullscreen=t.fullscreen,this.adPlaying=t.adPlaying}getMetadata(){return{title:this.video.title||this.video.content||"no title",url:this.video.content,thumbnail:this.video.poster,description:this.video.shortSummary,duration:this.duration}}}class xt extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]};var e;super(),this.player=t,this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.currentMedia=null}getPlayerId(){return this.player.parentElement.id}getCurrentPlayerTime(){return k(this,void 0,void 0,(function*(){return this.currentMedia.currentTime}))}getCurrentMedia(){return this.currentMedia}listen(t,i){super.listen(t,i),this.startListening()}startListening(){this.trackCurrentStatus(),setInterval((()=>{this.trackCurrentStatus()}),5e3)}trackCurrentStatus(){var t;const i=this.isValidMedia(function(t){var i,e,s,n;return null===(n=null===(s=null===(e=null===(i=null==t?void 0:t.playerStatus)||void 0===i?void 0:i.playerStatus)||void 0===e?void 0:e.playerModel)||void 0===s?void 0:s.currentItem)||void 0===n?void 0:n.content}(this.player))?function(t){try{const i=null==t?void 0:t.playerStatus,e=null==i?void 0:i.playerModel;if(e.currentItem){const t=e.currentItem,i=e.playlist.find((i=>i.S_ID===t.S_ID)),{paused:s,muted:n,isFullscreen:r,hasStarted:a,playerKey:d,adActive:o}=e;return new At(d,t,{paused:s,muted:n,fullscreen:r,started:a,duration:i?i.duration:null,adPlaying:!!o})}}catch(t){}return null}(this.player):void 0;i&&((null===(t=this.currentMedia)||void 0===t?void 0:t.id)!==(null==i?void 0:i.id)?this.trackChangeOfVideo(i):this.trackOngoingVideo(i))}trackChangeOfVideo(t){var i,e,s,n;(null===(i=this.currentMedia)||void 0===i?void 0:i.hasEnded())&&(this.currentMedia.currentTime=this.currentMedia.duration,this.trackEvent(x)),this.currentMedia=t,this.initMediaFunc(this.currentMedia.id,"stn",this.currentMedia.videoId,"video",this.currentMedia.getMetadata(),null===(n=null===(s=null===(e=this.player)||void 0===e?void 0:e.playerStatus)||void 0===s?void 0:s.playerModel)||void 0===n?void 0:n.divTag),this.currentMedia.isPlaying()&&this.trackEvent(C),this.currentMedia.muted&&this.trackEvent(R),this.currentMedia.fullscreen&&this.trackEvent(N),this.currentMedia.adPlaying&&this.trackEvent(_)}trackOngoingVideo(t){this.currentMedia.isPlaying()?(!t.adPlaying&&this.currentMedia.addTime(5),t.paused&&this.trackEvent(A),this.trackEvent(O)):t.paused||this.trackEvent(C),this.currentMedia.muted!==t.muted&&(t.muted?this.trackEvent(R):this.trackEvent(j)),this.currentMedia.fullscreen!==t.fullscreen&&(t.fullscreen?this.trackEvent(N):this.trackEvent(F)),this.currentMedia.adPlaying!==t.adPlaying&&t.adPlaying&&this.trackEvent(_),this.currentMedia.updatePlaybackInfo(t)}}class Ot{constructor(t,i,e,s,n,r,a,d){this.mediaId=i,this.id="".concat(t).concat(i),this.duration=e,this.title=s,this.url=n,this.thumbnail=a,this.description=d,this.publishTime=r,this.secondsPlayed=0}getMetadata(){return{isLive:!1,title:this.title||this.url,url:this.url,duration:this.duration,publishTime:this.publishTime,thumbnail:this.thumbnail,description:this.description}}}class _t extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]};var e;super(),this.player=t,this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.ready=Promise.resolve()}setupMedia(t){return k(this,void 0,void 0,(function*(){const i=t.title,e=Math.floor(t.duration/1e3),s=t.site_url,n=t.description,r=t.published_at,a=t.image_url;this.isValidMedia(s)&&(this.currentMedia=new Ot(this.getPlayerId(),t.episode_id,e,i,s,r,a,n),this.initMediaFunc(this.currentMedia.id,"spreaker",this.currentMedia.mediaId,"audio",this.currentMedia.getMetadata(),this.player.iframe))}))}getPlayerId(){return this.player.iframe.id}listen(t,i){super.listen(t,i),this.player.channel.port1.addEventListener("message",(t=>{const{data:i}=t;if((null==i?void 0:i.episode)&&!this.currentMedia&&this.setupMedia(i.episode),this.currentMedia){const{state:t,progress:e,duration:s}=i;if(t!==this.state)switch(t){case"paused":this.trackEvent(A),this.state=t;break;case"playing":this.trackEvent(C),this.state=t}e&&s&&this.trackProgress(e,s)}}))}trackProgress(t,i){const e=Math.floor(i*t/1e3);e>this.currentMedia.secondsPlayed+5&&(this.currentMedia.secondsPlayed=e,this.trackEvent(O),1===t&&this.trackEvent(x))}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){var t;return k(this,void 0,void 0,(function*(){return null===(t=this.currentMedia)||void 0===t?void 0:t.secondsPlayed}))}trackEvent(t){return k(this,void 0,void 0,(function*(){if(this.getCurrentMedia()){const i=yield this.getCurrentPlayerTime();this.trackMediaEventFunc(this.getCurrentMediaId(),t,i)}}))}}class Rt{constructor(t,i){var e;const s=t.videoData,n=t.id,r=(null===(e=null==s?void 0:s.additional_properties)||void 0===e?void 0:e.videoId)||n;this.videoId=r,this.url=i,this.id="".concat(n).concat(r),this.player=t,this.videoStarted=!1}timeupdate(){this.videoStarted=!0}getMetadata(){const t=this.player.videoData;return{isLive:!t,title:(null==t?void 0:t.headlines.basic)||this.url||"no title",description:null==t?void 0:t.description.basic,url:this.url,thumbnail:null==t?void 0:t.promo_image.url,duration:Math.floor((null==t?void 0:t.duration)/1e3),publishTime:null==t?void 0:t.publish_date}}}class jt extends it{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{domainWhiteList:[]};var e;super(),this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.player=t,this.setupMedia()}setupMedia(){this.playerId=this.player.id;const t=this.player.videoData,i=t?t.canonical_url:this.player.stream;this.currentMedia=this.isValidMedia(i)?new Rt(this.player,i):void 0}listen(t,i){super.listen(t,i),this.initMedia(),this.listenToEvents()}getPlayerId(){return this.playerId}getCurrentMedia(){return this.currentMedia}getCurrentPlayerTime(){return this.player?this.player.powa.getVideoElement().currentTime:0}trackEvent(t){if(this.getCurrentMedia()){const i=this.getCurrentPlayerTime();this.trackMediaEventFunc(this.getCurrentMediaId(),t,i)}}initMedia(){var t,i;this.getCurrentMedia()&&(S("Initializing media tracking > ",this.player.id," - ",this.currentMedia.videoId),this.initMediaFunc(this.currentMedia.id,"powa",this.currentMedia.videoId,"video",this.currentMedia.getMetadata(),null===(i=null===(t=this.player)||void 0===t?void 0:t.powa)||void 0===i?void 0:i.getRootElement()))}reset(){return k(this,void 0,void 0,(function*(){yield this.setupMedia(),this.initMedia()}))}listenToEvents(){S("Attaching event listeners > ",this.player.id),this.player.powa.on("play",(()=>{this.trackOnInterval(O),this.trackEvent(C)})),this.player.powa.on("pause",(()=>{this.stopTimer(),this.trackEvent(A)})),this.player.powa.on("end",(()=>{this.stopTimer(),this.trackEvent(x)})),this.player.powa.on("adImpression",(()=>{this.trackEvent(_)})),this.player.powa.on("fullscreen",(t=>{this.trackEvent(t.fullscreen?N:F)})),this.player.powa.on("muted",(t=>{this.trackEvent(t.muted?R:j)}))}}const Nt=window;class Ft{constructor(t){this.videoId=t.id,this.id=t.id,this.url=t.url,this.duration=t.duration,this.thumbnail=t.thumbnail,this.title=t.title,this.videoStarted=!1,this.currentTime=0}timeupdate(){this.videoStarted=!0}getMetadata(){return{isLive:!1,title:this.title,url:this.url,thumbnail:this.thumbnail,duration:this.duration}}}class Wt extends it{constructor(t,i,e){var s;super(),this.getPlayerId=()=>this.playerId,this.getCurrentMedia=()=>this.currentMedia,this.getCurrentPlayerTime=()=>k(this,void 0,void 0,(function*(){var t,i;return null!==(i=null===(t=this.currentMedia)||void 0===t?void 0:t.currentTime)&&void 0!==i?i:0})),this.updateMetadata=()=>{},this.playerId=t,this.element=i,this.domainWhiteList=null!==(s=null==e?void 0:e.domainWhiteList)&&void 0!==s?s:[],window.addEventListener("message",(t=>this.receiveMessage(t)))}receiveMessage(t){if("https://mdstrm.com"===t.origin&&this.element.contentWindow===t.source){const i=t.data;this.listenToEvent(i.eventName,i.eventData)}}setupMedia(t){this.currentMedia=this.isValidMedia(this.element.src)?new Ft(t):void 0}trackEvent(t){var i;return k(this,void 0,void 0,(function*(){if(this.getCurrentMedia()){const e=yield this.getCurrentPlayerTime();null===(i=this.trackMediaEventFunc)||void 0===i||i.call(this,this.getCurrentMediaId(),t,null!=e?e:0)}}))}initMedia(){var t,i;this.getCurrentMedia()&&this.currentMedia&&(S("Initializing media tracking > ",this.playerId," - ",null===(t=this.currentMedia)||void 0===t?void 0:t.videoId),null===(i=this.initMediaFunc)||void 0===i||i.call(this,this.currentMedia.id,"mediastream",this.currentMedia.videoId,"video",this.currentMedia.getMetadata()))}listenToEvent(t,i){switch(t){case"onMetadata":this.getCurrentMedia()||(this.setupMedia(i),this.initMedia());break;case"onPlay":this.trackOnInterval(O),this.trackEvent(C);break;case"onVideoStop":this.trackEvent(A),this.stopTimer();break;case"onTimeUpdate":this.currentMedia&&(this.currentMedia.currentTime=i);break;case"onAdsStarted":this.trackEvent(_);break;case"onFullscreenChange":this.trackEvent(i?N:F);break;case"onVolumeChange":this.trackEvent(i>0?j:R);break;case"onVideoEnd":this.trackEvent(x)}}}function Ut(){return(Ut=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t}).apply(this,arguments)}var Dt={ignoreId:!1};class Bt extends vt{constructor(t){super(t.querySelector("audio")),this.updateMetadata=()=>k(this,void 0,void 0,(function*(){var t;const i=this.player.parentElement,e=this.getTitle(i);this.currentMedia&&this.currentMedia.title!==e&&(this.currentMedia.title=e,null===(t=this.setItemMetadataFunc)||void 0===t||t.call(this,this.getCurrentMediaId(),{title:e}))}))}getTitle(t){const i=t.querySelectorAll(".np__info_principal, .np__program_name, .np__program_subtitle, .line__clamp_2"),e=[];return i.forEach((t=>{t.textContent&&""!==t.textContent.trim()&&e.push(t.textContent.trim())})),null==e?void 0:e[0]}setupMedia(){var t,i;return k(this,void 0,void 0,(function*(){const e=this.player.parentElement,s=this.getTitle(e),n=e.querySelector(".np__avatar_element_image").src,r=this.player.duration,a=this.player.src||(null!==(i=null===(t=this.player.querySelector("source"))||void 0===t?void 0:t.src)&&void 0!==i?i:""),d=yield T(a.startsWith("blob:")?`id-${s}`:`id-${null!=n?n:a}`);this.playerId=d,this.currentMedia=new ct(d,d,r,s,a,!0,n),this.providerName="mediastream"}))}}class qt{constructor(t,i,e,s,n,r){this.mediaId=i,this.id=`${t}${i}`,this.duration=e,this.title=s,this.url=n,this.thumbnail=r,this.mediaStarted=!1}timeupdate(){this.mediaStarted=!0}getMetadata(){return{isLive:!1,title:this.title||this.url||"no title",url:this.url,duration:this.duration,thumbnail:this.thumbnail}}}class Vt extends it{constructor(t,i){var e;super(),this.updateMetadata=()=>{},this.getPlayerId=()=>this.playerId,this.getCurrentMedia=()=>this.currentMedia,this.getCurrentPlayerTime=()=>k(this,void 0,void 0,(function*(){var t;let i=0;return(null===(t=this.currentMedia)||void 0===t?void 0:t.mediaStarted)&&this.videoElement&&(i=this.videoElement.currentTime),i})),this.domainWhiteList=null!==(e=null==i?void 0:i.domainWhiteList)&&void 0!==e?e:[],this.videoContainer=t,this.videoElement=t.querySelector("video"),this.videoElement&&(this.ready=new Promise((t=>{this.setupMedia().then(t)})))}setupMedia(){var t,i;return k(this,void 0,void 0,(function*(){if(!this.videoElement)return;const e=this.videoElement.duration,s=this.videoElement.src||(null!==(i=null===(t=this.videoElement.querySelector("source"))||void 0===t?void 0:t.src)&&void 0!==i?i:""),n=this.videoElement.poster,r=this.getTitle(),a=yield T(s.startsWith("blob:")?r:s);this.playerId=this.videoContainer.id,this.url=s,this.currentMedia=new qt(a,a,e,r,s,n)}))}getTitle(){var t,i,e,s,n,r,a,d,o,l;return null!==(l=(null===(a=null===(r=null===(n=null===(s=null===(e=null===(i=null===(t=this.videoContainer.querySelector("cnx-lit-ui-template"))||void 0===t?void 0:t.shadowRoot)||void 0===i?void 0:i.querySelector("cnx-ui-grid cnx-top-bar"))||void 0===e?void 0:e.shadowRoot)||void 0===s?void 0:s.querySelector("cnx-title"))||void 0===n?void 0:n.shadowRoot)||void 0===r?void 0:r.querySelector("span"))||void 0===a?void 0:a.textContent)||(null===(o=null===(d=this.videoContainer)||void 0===d?void 0:d.querySelector(".wps-title-overlay"))||void 0===o?void 0:o.textContent)||this.videoElement.title||this.videoElement.getAttribute("aria-label"))&&void 0!==l?l:"no title"}isValidMedia(){var t,i,e;try{const e=new URL(null!==(t=this.url)&&void 0!==t?t:"").origin;if(null===(i=this.domainWhiteList)||void 0===i?void 0:i.length)return this.domainWhiteList.some((t=>e.includes(t)))}catch(t){S("Couldn't validate media",t)}return!(null===(e=this.domainWhiteList)||void 0===e?void 0:e.length)}listen(t,i){super.listen(t,i),this.initMedia(),this.initializePlayer()}initMedia(){var t;this.currentMedia&&(null===(t=this.initMediaFunc)||void 0===t||t.call(this,this.currentMedia.id,"connatix",this.currentMedia.mediaId,"video",this.currentMedia.getMetadata(),this.videoElement))}initializePlayer(){this.videoElement&&(this.muted=0===this.videoElement.volume,this.listenToEvents())}trackEvent(t){var i;return k(this,void 0,void 0,(function*(){const e=yield this.getCurrentPlayerTime();this.getCurrentMediaId()&&(null===(i=this.trackMediaEventFunc)||void 0===i||i.call(this,this.getCurrentMediaId(),t,e))}))}resetMedia(){return k(this,void 0,void 0,(function*(){this.stopTimer(),yield this.setupMedia(),this.initMedia(),this.trackOnInterval(O),this.trackEvent(C)}))}listenToEvents(){this.videoElement.addEventListener(yt,(()=>{var t;null===(t=this.currentMedia)||void 0===t||t.timeupdate()})),this.videoElement.addEventListener(C,(()=>{var t;const i=this.getTitle();(null===(t=this.currentMedia)||void 0===t?void 0:t.title)!==i?this.resetMedia():(this.trackOnInterval(O),this.trackEvent(C))})),this.videoElement.addEventListener(A,(()=>{this.stopTimer(),this.trackEvent(A)})),this.videoElement.addEventListener(pt,(()=>{this.stopTimer(),this.trackEvent(x)})),this.videoElement.addEventListener(mt,(()=>{const t=0===this.videoElement.volume;t!==this.muted&&(this.muted=t,t?this.trackEvent(R):this.trackEvent(j))}))}}class $t extends Et{constructor(t,i={domainWhiteList:[]}){super(t,i,"clappr")}retrieveMetadata(){var t,i,e;return k(this,void 0,void 0,(function*(){const s=J(this.player);let n=null,r=null,a=null;s&&(n=Q(s,'[itemprop="name"]'),r=Q(s,'[itemprop="contentUrl"]'),a=Q(s,'[itemprop="thumbnailUrl"]'));const d=this.player.closest(".clappr-player"),o=null==d?void 0:d.querySelector(".video-info > .video-info__data > .video-info__data-title");if(o){const s=null!==(i=null===(t=o.querySelector(".visually-hidden"))||void 0===t?void 0:t.textContent)&&void 0!==i?i:"";n=null===(e=o.textContent)||void 0===e?void 0:e.replace(s,"").replace("\n","").trim()}return{title:n,url:r,thumbnail:a,id:n?yield T(n):void 0}}))}}function zt(t,i){return i.every((i=>{const e=i.key.split(".");let s=t;for(const t of e)if(s=s[t],void 0===s)return!1;return s===i.value}))}const Gt=(t,i,e)=>{let s=e,n=i;const r=t.split(".");for(const t of r)if(n=n[t],void 0===n){n="";break}return"string"==typeof s&&(s=s.replace(`{${t}}`,n.toString())),s};function Ht(t,i){var e;const s={id:"0"};for(const[n,r]of Object.entries(i)){const i=null===(e=r.match(/\{([^}]+)\}/g))||void 0===e?void 0:e.map((t=>t.slice(1,-1))),a=n;if(i){let e=r;for(const s of i)e=Gt(s,t,e);s[a]=e}else s[a]=r}return s}class Yt extends Tt{constructor(t,i){super(t,i)}getTitle(){return this.player.el_.parentElement.title}getUrl(){return this.player.el_.parentElement.getAttribute("video-url")}getThumbnail(){return this.player.el_.parentElement.getAttribute("data-poster-image")}getId(t){return k(this,void 0,void 0,(function*(){return yield T(`fue-${this.getUrl()}`)}))}}class Kt extends Et{constructor(t,i={domainWhiteList:[]}){super(t,i,"voltax"),this.currentSRC=this.player.src}shouldReset(){const t=this.currentSRC!==this.player.src;return t&&(this.currentSRC=this.player.src),t}retrieveMetadata(){var t,i,e;return k(this,void 0,void 0,(function*(){const s=null!==(e=null===(i=null===(t=this.player.closest(".voltax-mp-container-in-place"))||void 0===t?void 0:t.querySelector(".title"))||void 0===i?void 0:i.textContent)&&void 0!==e?e:"";return{title:s,id:yield T(s)}}))}}const Xt={youtube:class{constructor(t,i={enableSrcRewritting:!1,enableIframeScript:!0}){var e;this.players={},this.blacklistedIds=[],this.tracker=t,this.config=i,this.enableIframeScript=void 0===this.config.enableIframeScript||this.config.enableIframeScript,this.selectorBlacklist=null!==(e=null==i?void 0:i.selectorBlacklist)&&void 0!==e?e:[],this.startListening()}startListening(){const t=window.onYouTubeIframeAPIReady,i=this.onApiReady.bind(this,t);this.apiReady=!1,window.onYouTubeIframeAPIReady=i,this.enableIframeScript&&(()=>{if(!function(){const t=document.head.getElementsByTagName("script");return Array.from(t).map((t=>t.getAttribute("src"))).filter(Boolean).filter((t=>t.includes(G))).length>0}()){const t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","".concat("https://www.youtube.com","/").concat(G)),t.setAttribute("async","true"),document.head.appendChild(t)}})(),window.addEventListener("load",i)}onApiReady(t){this.apiReady||(null==t||t(),this.collectIframes(),(0,o.N)((()=>{this.collectIframes()})),window.addEventListener("message",(t=>this.processMessage(t)),!1),this.apiReady=!0)}collectIframes(){const t=document.querySelectorAll("iframe[src*=youtube]");window.YT&&window.YT.Player&&Array.from(t).forEach((t=>{var i;const e=t,s=function(t){const i=K.exec(t);return i?i[1]:null}(null!==(i=e.src)&&void 0!==i?i:"");e.id||(e.id=d()),X(e,this.selectorBlacklist)?s&&this.blacklistedIds.push(s):this.config.enableSrcRewritting&&-1===e.src.indexOf(Z)&&(e.src=-1===e.src.indexOf("?")?`${e.src}?${Z}`:`${e.src}&${Z}`)}))}processMessage(t){if(t.origin.indexOf("youtube")>0)try{const i=JSON.parse(t.data);if(-1===["infoDelivery","initialDelivery"].indexOf(i.event))return;const e=i.id;S("processMessage: ",e,i,this.players[e],this.players),this.players[e]?this.processNewEvent(e,i.info):this.initalizePlayer(e,i.info)}catch(i){S("Error while processing event: ",t.origin,t)}}processNewEvent(t,i){var e;const{PLAYING:s,PAUSED:n,ENDED:r}=window.YT.PlayerState,a=i.playerState,d=this.players[t].mediaId;switch(void 0!==i.muted&&this.players[t].muted!==i.muted&&(this.trackEvent(d,i.muted?R:j,null!==(e=this.players[t].currentTime)&&void 0!==e?e:0),this.players[t].muted=i.muted),this.players[t].currentTime=i.currentTime,a){case s:this.trackEvent(d,C,i.currentTime);break;case n:this.trackEvent(d,A,i.currentTime);break;case r:this.trackEvent(d,x,i.currentTime);break;default:this.trackEvent(d,O,i.currentTime)}}initalizePlayer(t,i){var e,s,n,r,a,d,o,l;const u=null!==(s=null===(e=i.videoData)||void 0===e?void 0:e.video_id)&&void 0!==s?s:"";-1===this.blacklistedIds.indexOf(u)&&(this.players[t]=new H(t,u,null!==(n=i.duration)&&void 0!==n?n:0,null!==(a=null===(r=i.videoData)||void 0===r?void 0:r.title)&&void 0!==a?a:"",null!==(d=i.videoUrl)&&void 0!==d?d:"",(t=>`https://i.ytimg.com/vi/${t}/maxresdefault.jpg`)(u),null!==(l=null===(o=i.videoData)||void 0===o?void 0:o.author)&&void 0!==l?l:""),this.tracker.initializeItem(Y(u),"youtube",u,"video",this.players[t].getMetadata()))}trackEvent(t,i,e){this.tracker.registerEvent(Y(t),i,Math.floor(e))}},jwplayer:class extends tt{constructor(t,i){super(t,i),this.config=i,"loading"===document.readyState?window.addEventListener("load",(()=>this.startListening())):this.startListening()}findPlayers(){const t=document.querySelectorAll("div.jwplayer:not([data-compass-listening])");Array.from(t).filter((t=>!this.isBlacklisted(t))).forEach((t=>{this.listen(new nt(window.jwplayer(t.id),this.config))&&t.setAttribute("data-compass-listening","true")}))}},dailymotion:class extends tt{constructor(t){super(t),"loading"===document.readyState?window.addEventListener("load",(()=>this.listenWhenScriptLoaded())):this.listenWhenScriptLoaded()}listenWhenScriptLoaded(){void 0===dt.dailymotion?dt.dailymotion={onScriptLoaded:()=>{this.onScriptLoaded()}}:this.onScriptLoaded()}findPlayers(){return k(this,void 0,void 0,(function*(){try{const t=yield Promise.all(dt.dailymotion.getAllPlayers());yield Promise.all(t.map((t=>k(this,void 0,void 0,(function*(){const i=new at(t);yield i.ready,this.listen(i)})))))}catch(t){}}))}onScriptLoaded(){this.startListening()}},kaltura:class extends tt{constructor(t,i){super(t,i),this.config=i,"loading"===document.readyState?window.addEventListener("load",(()=>this.startListening())):this.startListening()}startListening(){ht.kWidget?this.onScriptLoaded():(0,o.N)((()=>{!this.scriptLoaded&&ht.kWidget&&(this.scriptLoaded=!0,this.onScriptLoaded())}))}onScriptLoaded(){S("Kaltura provider hooked"),this.testLoadedPlayers={},ht.kWidget.addReadyCallback((t=>{const i=document.getElementById(t);this.isBlacklisted(i)||(this.testLoadedPlayers[t]=new Promise(((e,s)=>k(this,void 0,void 0,(function*(){S("Initializing Kaltura player > ",t);const s=new ut(i,this.config);yield s.ready,this.listen(s),e()})))))}))}},audio:class extends tt{constructor(t,i){super(t,i),this.startListening()}startListening(){window.setInterval((()=>{const t=document.querySelectorAll("audio:not([data-compass-listening])");Array.from(t).map((t=>k(this,void 0,void 0,(function*(){const i=new vt(t);yield i.ready,this.listen(i)&&t.setAttribute("data-compass-listening","true")}))))}),1e3)}},video:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll("video:not([data-compass-listening], [data-compass-skipped])");this.testing=Promise.all(Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){const i=new Et(t,this.config);yield i.ready,i.isValidMedia()&&this.listen(i)?t.setAttribute("data-compass-listening","true"):(S("Generic video skipped: ",i.url),t.setAttribute("data-compass-skipped","true"))}))))),yield this.testing}))}},videojs:Ct,stn:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){const t=document.querySelectorAll("stn-player:not([data-compass-listening], [data-compass-skipped])");Array.from(t).filter((t=>!this.isBlacklisted(t)&&!!t.playerStatus)).forEach((t=>{this.listen(new xt(t,this.config))&&t.setAttribute("data-compass-listening","true")}))}},spreaker:class extends tt{constructor(t,i){super(t,i),this.config=i,"loading"===document.readyState?window.addEventListener("load",(()=>this.startListening())):this.startListening()}findPlayers(){const t=document.querySelectorAll("iframe[src*=spreaker]");Array.from(t).filter((t=>!this.isBlacklisted(t))).forEach((t=>{const i=window.SP.widgets[t.id];i&&(t.setAttribute("data-compass-listening","true"),this.listen(new _t(i,this.config)))}))}},powa:class extends tt{constructor(t,i){super(t,i),this.config=i,"loading"===document.readyState?Nt.addEventListener("load",(()=>this.startListening())):this.startListening()}startListening(){var t;(null===(t=null==Nt?void 0:Nt.powas)||void 0===t?void 0:t._meta)&&Nt.powas._meta.powaTrack.forEach((t=>{"powaRender"===t.type&&this.onPowaRender(t.detail)})),window.addEventListener("powaRender",(t=>this.onPowaRender(t.detail)))}onPowaRender(t){return k(this,void 0,void 0,(function*(){S("Initializing Powa player > ",t.id);const i=new jt(t,this.config);this.listen(i)}))}},brightcove:class extends Ct{constructor(t,i){var e,s,n,r,a,d,o,l,u,h,c,v,p,m,y,g,f,M;super(t,Object.assign(Object.assign({},i),{providerName:"brightcove",mappings:{videojs:{title:null!==(n=null===(s=null===(e=null==i?void 0:i.mappings)||void 0===e?void 0:e.videojs)||void 0===s?void 0:s.title)&&void 0!==n?n:"mediainfo.name",thumbnail:null!==(d=null===(a=null===(r=null==i?void 0:i.mappings)||void 0===r?void 0:r.videojs)||void 0===a?void 0:a.thumbnail)&&void 0!==d?d:"mediainfo.poster",url:null!==(u=null===(l=null===(o=null==i?void 0:i.mappings)||void 0===o?void 0:o.videojs)||void 0===l?void 0:l.url)&&void 0!==u?u:"options_.sources.0.src",isLive:null!==(v=null===(c=null===(h=null==i?void 0:i.mappings)||void 0===h?void 0:h.videojs)||void 0===c?void 0:c.isLive)&&void 0!==v?v:"",duration:null!==(y=null===(m=null===(p=null==i?void 0:i.mappings)||void 0===p?void 0:p.videojs)||void 0===m?void 0:m.duration)&&void 0!==y?y:"mediainfo.duration",id:null!==(M=null===(f=null===(g=null==i?void 0:i.mappings)||void 0===g?void 0:g.videojs)||void 0===f?void 0:f.id)&&void 0!==M?M:"mediainfo.id"}}}))}},mediastream:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findIframePlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll("iframe[src*=mdstrm]:not([data-compass-listening], [data-compass-skipped])");return Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){const i=yield T(function(t,i){var e=Ut({},Dt,void 0),s=t;if(s&&s.id&&!e.ignoreId)return'//*[@id="'+s.id+'"]';for(var n=[];s&&Node.ELEMENT_NODE===s.nodeType;){for(var r=0,a=!1,d=s.previousSibling;d;)d.nodeType!==Node.DOCUMENT_TYPE_NODE&&d.nodeName===s.nodeName&&r++,d=d.previousSibling;for(d=s.nextSibling;d;){if(d.nodeName===s.nodeName){a=!0;break}d=d.nextSibling}n.push((s.prefix?s.prefix+":":"")+s.localName+(r||a?"["+(r+1)+"]":"")),s=s.parentNode}return n.length?"/"+n.reverse().join("/"):""}(t)),e=new Wt(i,t,this.config);this.listen(e)?t.setAttribute("data-compass-listening","true"):(S("Mediastream video skipped: ",t.src),t.setAttribute("data-compass-skipped","true"))}))))}))}findAudioPlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll("div:has(> .np__global_wrapper):not([data-compass-listening], [data-compass-skipped])");Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){const i=new Bt(t);yield i.ready,this.listen(i)?t.setAttribute("data-compass-listening","true"):(S("Mediastream video skipped: ",t.classList),t.setAttribute("data-compass-skipped","true"))}))))}))}findPlayers(){return k(this,void 0,void 0,(function*(){(yield this.findIframePlayers()).length||(yield this.findAudioPlayers())}))}},connatix:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll(".cnx-main-container:not([data-compass-listening], [data-compass-skipped])");yield Promise.all(Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){const i=new Vt(t,this.config);yield i.ready,i.isValidMedia()&&this.listen(i)?t.setAttribute("data-compass-listening","true"):(S("Generic video skipped: ",i.url),t.setAttribute("data-compass-skipped","true"))})))))}))}},clappr:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll(".clappr-player .container video:not([data-compass-listening], [data-compass-skipped])");yield Promise.all(Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){const i=new $t(t,this.config);yield i.ready,i.isValidMedia()&&this.listen(i)?t.setAttribute("data-compass-listening","true"):(S("Clappr video skipped: ",i.url),t.setAttribute("data-compass-skipped","true"))})))))}))}},iframe:class{constructor(t,i){var e,s;this.tracker=t,this.listening=!1,this.items={},this.pendingEvents=[];const{iframeSelector:n,type:r,providerName:a,eventsMapping:d,postMessageDomain:l}=null!==(s=null===(e=null==i?void 0:i.extraParams)||void 0===e?void 0:e.iframe)&&void 0!==s?s:{};this.iframeSelector=null!=n?n:"",this.type=null!=r?r:"audio",this.providerName=null!=a?a:"not defined",this.postMessageDomain=null!=l?l:"",this.eventsMapping=null!=d?d:[],function(){return k(this,void 0,void 0,(function*(){return{DOCUMENT_TITLE:document.title,ID_BY_URL:yield T(document.location.pathname)}}))}().then((t=>{this.substitutions=t})),this.startListening(),(0,o.N)((()=>{this.startListening()}))}startListening(){!this.listening&&document.querySelector(this.iframeSelector)&&(S("Iframe start listening to postMessages",this.iframeSelector,this.postMessageDomain),window.addEventListener("message",(t=>this.onMessageRecieved(t))),this.listening=!0)}onMessageRecieved(t){const i=t.data;if(t.origin.includes(this.postMessageDomain)){S("Iframe candidate message recieved",i);for(const t of this.eventsMapping)if(zt(i,t.filters)){const e=Ht(Object.assign(Object.assign({},i),this.substitutions),t.metadata||{});this.processEvent(t.event,e);break}}}processEvent(t,i){return k(this,void 0,void 0,(function*(){const e=i.id;"init"!==t||this.items[e]?"updateMetadata"!==t?this.items[e]?(t===C?this.items[e].timerId||(this.items[e].timerId=setInterval((()=>{this.items[e].currentTime+=5,this.tracker.registerEvent(i.id,O,this.items[e].currentTime)}),5e3)):t===A&&this.items[e].timerId&&(clearInterval(this.items[e].timerId),this.items[e].timerId=null),yield this.tracker.registerEvent(i.id,t,this.items[e].currentTime)):this.pendingEvents.push({eventId:t,metadata:i}):yield this.updateMetadata(e,i):yield this.initEvent(e,i)}))}initEvent(t,i){var e,s,n;return k(this,void 0,void 0,(function*(){this.items[t]={currentTime:0,title:null!==(e=i.title)&&void 0!==e?e:t,url:i.url,id:t,duration:parseInt(null!==(s=i.duration)&&void 0!==s?s:"-1",10),timerId:null},yield this.tracker.initializeItem(t,this.providerName,t,this.type,{title:null!==(n=i.title)&&void 0!==n?n:t,duration:this.items[t].duration}),this.processPendingEvents(t)}))}updateMetadata(t,i){var e,s,n;return k(this,void 0,void 0,(function*(){this.tracker.setItemMetadata(t,{duration:parseInt(null!==(e=i.duration)&&void 0!==e?e:"-1",10),url:null!==(s=i.url)&&void 0!==s?s:this.items[t].url,title:null!==(n=i.title)&&void 0!==n?n:this.items[t].title})}))}processPendingEvents(t){const i=this.pendingEvents.filter((i=>i.metadata.id===t));this.pendingEvents=this.pendingEvents.filter((i=>i.metadata.id!==t)),i.forEach((t=>{this.processEvent(t.eventId,t.metadata)}))}},fuel:class extends tt{constructor(t,i){var e,s,n,r,a,d,o,l,u,h,c,v,p,m,y,g,f,M;super(t,i),this.config=Object.assign(Object.assign({},i),{providerName:"fuel",mappings:{videojs:{title:null!==(n=null===(s=null===(e=null==i?void 0:i.mappings)||void 0===e?void 0:e.videojs)||void 0===s?void 0:s.title)&&void 0!==n?n:"options_.title",thumbnail:null!==(d=null===(a=null===(r=null==i?void 0:i.mappings)||void 0===r?void 0:r.videojs)||void 0===a?void 0:a.thumbnail)&&void 0!==d?d:"poster",url:null!==(u=null===(l=null===(o=null==i?void 0:i.mappings)||void 0===o?void 0:o.videojs)||void 0===l?void 0:l.url)&&void 0!==u?u:"options_.sources.0.src",isLive:null!==(v=null===(c=null===(h=null==i?void 0:i.mappings)||void 0===h?void 0:h.videojs)||void 0===c?void 0:c.isLive)&&void 0!==v?v:"",duration:null!==(y=null===(m=null===(p=null==i?void 0:i.mappings)||void 0===p?void 0:p.videojs)||void 0===m?void 0:m.duration)&&void 0!==y?y:"",id:null!==(M=null===(f=null===(g=null==i?void 0:i.mappings)||void 0===g?void 0:g.videojs)||void 0===f?void 0:f.id)&&void 0!==M?M:""}}}),this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=Array.from(document.querySelectorAll("fuel-video:not([data-compass-listening], [data-compass-skipped])"));this.testing=Promise.all(Array.from(t).map((t=>k(this,void 0,void 0,(function*(){const i=new Yt(t.firstChild.player,this.config);yield i.ready,this.listen(i)&&(null==t||t.setAttribute("data-compass-listening","true"))}))))),yield this.testing}))}},voltax:class extends tt{constructor(t,i){super(t,i),this.config=i,this.startListening()}findPlayers(){return k(this,void 0,void 0,(function*(){const t=document.querySelectorAll("stn-player  .shadow-root-voltax-mp");yield Promise.all(Array.from(t).filter((t=>!this.isBlacklisted(t))).map((t=>k(this,void 0,void 0,(function*(){if(!t.shadowRoot)return;const i=t.shadowRoot.querySelector("video");if(i){const e=new Kt(i,this.config);yield e.ready,e.isValidMedia()&&this.listen(e)?t.setAttribute("data-compass-listening","true"):(S("Generic video skipped: ",e.url),t.setAttribute("data-compass-skipped","true"))}})))))}))}}},Jt=["m_ti"];class Qt{constructor(t,i){var e,s,n;this.compass=i,this.items={},this.itemTimers={},this.accountId=t.accountId,this.api=((...t)=>new u(...t))(new f(this.compass.getEndpointDomain(),{fallback:this.compass.getFallbackEndpointDomain(),fallbackWindow:6e4})),t.stress&&this.api.registerApi(((t,i=1)=>({api:new f(t),replicas:i,preprocess:t=>t.replace(/}$/,',"fk":1}')}))(this.compass.getStagingEndpointDomain(),null!==(e=t.stressReplicas)&&void 0!==e?e:1)),void 0!==this.accountId?((null===(n=null===(s=t.multimedia)||void 0===s?void 0:s.providers)||void 0===n?void 0:n.length)&&function(t,i,e){const s={};t.forEach((t=>{if(Xt[t]&&!s[t]){const n=new Xt[t](i,e);s[t]=n}})),S("Providers initialized",s)}(t.multimedia.providers,this,t.multimedia.config),(0,M.C1)((()=>{Object.keys(this.itemTimers).forEach((t=>{this.track(t,!0)}))}))):console.warn("CompassTrackerMultimedia initialised without an account")}initializeItem(t,i,e,s,n,r){return k(this,void 0,void 0,(function*(){t&&i&&e&&s?(this.items[t]=new z(i,e,s,{metadata:n}),yield this.track(t),r&&function(t,i){try{const e=new IntersectionObserver((function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return function(t,i){t((null==i?void 0:i[0]).isIntersecting?W:U)}(i,...e)}));e.observe(t)}catch(t){S("failed on observing current media HTML",t)}}(r,(i=>{this.registerEvent(t,i,0)}))):console.warn("Multimedia item initialization failed:\nan ID, a provider, a providerId and a type are required")}))}getItem(t){const i=this.items[t];return i||console.warn(`Multimedia item with id ${t} has not been initialized`),i}setItemMetadata(t,i){t?(this.items[t].setMetadata(i),this.trackDeferred(t)):console.warn("Multimedia metadata setup must contain an ID")}getTrackingData(t){return k(this,void 0,void 0,(function*(){let i={};if(t.isMetadataUpdated()){const e=[];if(i=t.getMetadata(),Jt.forEach((t=>{!i[t]&&e.push(t)})),e.length)return console.warn(`Cannot track the Multimedia item, missing required properties: ${e.join(",")}`),Promise.resolve(null)}const e=yield function(t,i,e){return k(this,void 0,void 0,(function*(){if(e)return Object.assign(Object.assign({},e),{n:E()});const s=yield new Promise((t=>i.getRFV((i=>{if(i){const{rfv:e,r:s,f:n,v:r}=i;return t({rfv:e,rfv_f:n,rfv_r:s,rfv_v:r})}return t({})}))));return Object.assign(Object.assign({ac:t},yield i.getTrackingCommonData()),s)}))}(this.accountId,this.compass,t.editorialMetadata);t.editorialMetadata||t.setEditorialMetadata(e);const s=Object.assign({},e,t.getItemAndPlaybackInfo(),i);return t.markMetadataUnupdated(),I(s)}))}registerEvent(t,i,e,s=!1){return k(this,void 0,void 0,(function*(){const n=this.getItem(t);if(n){const r=n.addEvent(i,e);n.isEngaged()&&document.dispatchEvent(new Event(D)),r&&(s?yield this.track(t):yield this.trackDeferred(t))}}))}track(t,i=!1){return k(this,void 0,void 0,(function*(){const e=this.getItem(t);if(e){const t=yield this.getTrackingData(e);t&&(this.api.post("/multimedia.php",JSON.stringify(t),{skipResponse:i}),e.incrementTick())}}))}trackDeferred(t){return k(this,void 0,void 0,(function*(){return new Promise((i=>{this.itemTimers[t]||(this.itemTimers[t]=setTimeout((()=>{this.track(t).then((()=>{delete this.itemTimers[t],i()}))}),5e3))}))}))}}}}]);
</script>

</body>
</html>
