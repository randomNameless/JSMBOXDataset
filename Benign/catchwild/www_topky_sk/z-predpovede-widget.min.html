<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>z-predpovede-widget.min.html</title>
</head>
<body>

<script>
"use strict";(function(){window.zPredpovedeWidget=function(options){var $options=options||{};$options.name="["+($options.name||"z-predpovede-widget")+"]";$options.verbose=!!$options.verbose;$options.interval=($options.interval|0)||60;$options.cookie=$options.cookie||{};$options.cookie.name=$options.cookie.name||"widget:predpovede:city_name";$options.cookie.domain=$options.cookie.domain||("."+(location.hostname||document.domain).split(".").splice(-2).join("."))||".zoznam.sk";var $placeholders=["%WEATHER_LINK%","%WEATHER_TITLE%","%WEATHER_IMAGE%","%WEATHER_TEMPERATURE%","%WEATHER_CITY%","%WEATHER_CITY_SELECT%"];var $interval,$apiBaseUrl="https://cdn.predpovede.topky.sk";var $data={};var $array=[];var $counter=0;var $city="Bratislava";var _renderAll=function(){if($options.verbose){console.log($options.name,"_renderAll");}$array.forEach(function(item){_render(item.selector,item.template)});return this};var _render=function(selector,template){if($options.verbose){console.log($options.name,"_render");}if(!selector.toString()){throw new Error("Selector is not valid.")}var elements=Array.prototype.slice.call(document.querySelectorAll(selector));if(!elements.length){throw new Error("Selector is not valid.")}if(!template.toString()){throw new Error("Template is not valid.")}var html=template;var firstDate=Object.keys($data.weatherData).sort().shift();var cities = Object.keys($data.weatherData[firstDate]).sort((a, b) => a.localeCompare(b, 'sk'));var cookieValue=document.cookie.match(new RegExp($options.cookie.name+"=([^;]+)"));cookieValue=cookieValue&&cookieValue[1]&&cities.indexOf(cookieValue[1])!==-1?cookieValue[1]:$city;var currentHour=(new Date()).getHours();var isNight=currentHour<=5||currentHour>=18;var weather=$data.weatherData[firstDate][cookieValue];var selectId="predpovede-widget-select-"+$counter++;html=html.replace(new RegExp($placeholders[0],"g"),"https://predpovede.topky.sk/pocasie-"+weather.s);html=html.replace(new RegExp($placeholders[1],"g"),$data.weatherCodes[weather.o.cs].t);html=html.replace(new RegExp($placeholders[2],"g"),"https://cdn.predpovede.topky.sk/img/meteo/"+$data.weatherCodes[weather.o.cs][isNight?"n":"d"]+".svg");html=html.replace(new RegExp($placeholders[3],"g"),weather.o.t+"&nbsp;&deg;C");html=html.replace(new RegExp($placeholders[4],"g"),cookieValue);html=html.replace(new RegExp($placeholders[5],"g"),"<select id=\""+selectId+"\" title=\"Vyberte si mesto\">"+cities.map(function(city){return "<option value=\""+city+"\""+(city===cookieValue?" selected":"")+">"+city+"</option>"})+"</select>");elements.forEach(function(element){element.innerHTML=html});var select=document.querySelector("#"+selectId);if(!select){return this}select.addEventListener("change",function(event){$city=event.target.value;if(window.zCanUseCookies()){document.cookie=$options.cookie.name+"="+$city+";expires=Fri, 31 Dec 9999 23:59:59 GMT;domain="+$options.cookie.domain+";path=/;SameSite=None;Secure;"}_renderAll();});return this};var _fetch=function(callback){if($options.verbose){console.log($options.name,"_fetch");}_fetchJson($apiBaseUrl+"/feed/weather_map_short.json",function(weatherData){$data.weatherData=weatherData;if($data.weatherCodes){callback.call();return}_fetchJson($apiBaseUrl+"/feed/weather_code.json",function(weatherCodes){$data.weatherCodes=weatherCodes;callback.call()})});return this};var _fetchJson=function(url,callback){if($options.verbose){console.log($options.name,"_fetchJson");}var request=new XMLHttpRequest();request.open("GET",url,true);request.onload=function(){if(this.status<200||this.status>=400){throw new Error("Wrong response status: "+this.status)}if(callback){callback.call(null,JSON.parse(this.response))}};request.onerror=console.error;request.send();return this};return{PLACEHOLDERS:$placeholders,push:function(selector,template){if($options.verbose){console.log($options.name,"push");}$array.push({selector:selector,template:template});return this},run:function(){if($options.verbose){console.log($options.name,"run")}if($interval){console.error($options.name,"Already running!");return this}_fetch(_renderAll);$interval=setInterval(function(){_fetch(_renderAll)},$options.interval*1e3);return this}}}})();
</script>

</body>
</html>
