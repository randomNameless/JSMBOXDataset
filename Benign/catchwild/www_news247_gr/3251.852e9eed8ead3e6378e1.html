<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3251.852e9eed8ead3e6378e1.html</title>
</head>
<body>

<script>
(self.webpackChunk_cleverpush_cleverpush_js_sdk=self.webpackChunk_cleverpush_cleverpush_js_sdk||[]).push([[3251],{3251:function(e,n,t){"use strict";var r,o="handshake",a="handshake-reply",c="call",i="reply",d="fulfilled",l="rejected",u="message",s="ConnectionDestroyed",f="ConnectionTimeout",m="NotInIframe",v="IframeAlreadyAttachedToDom",p={"http:":"80","https:":"443"},h=/^(https?:|file:)?\/\/([^/:]+)?(:(\d+))?/,w={ERR_CONNECTION_DESTROYED:s,ERR_CONNECTION_TIMEOUT:f,ERR_NOT_IN_IFRAME:m,ERR_IFRAME_ALREADY_ATTACHED_TO_DOM:v,Promise:function(){try{return window?window.Promise:null}catch(e){return null}}(),debug:!1},E=(r=0,function(){return++r}),g=function(){if(w.debug){for(var e,n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];(e=console).log.apply(e,["[CleverPush][Penpal]"].concat(t))}},y=function(e){var n=[];return e((function(){n.forEach((function(e){e()}))})),{then:function(e){n.push(e)}}},C=function(e){return{name:e.name,message:e.message,stack:e.stack}},N=function(e){var n=new Error;return Object.keys(e).forEach((function(t){return n[t]=e[t]})),n},T=function(e,n,t,r,o){var a=n.localName,l=n.local,f=n.remote,m=n.remoteOrigin,v=!1;g("".concat(a,": Connecting call sender"));o.then((function(){v=!0})),t.reduce((function(e,n){return e[n]=function(e){return function(){for(var n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];if(g("".concat(a,": Sending ").concat(e,"() call")),f.closed&&r(),v){var p=new Error("Unable to send ".concat(e,"() call due ")+"to destroyed connection");throw p.code=s,p}return new w.Promise((function(n,r){var o=E();l.addEventListener(u,(function t(c){if(c.source===f&&c.origin===m&&c.data.penpal===i&&c.data.id===o){g("".concat(a,": Received ").concat(e,"() reply")),l.removeEventListener(u,t);var s=c.data.returnValue;c.data.returnValueIsError&&(s=N(s)),(c.data.resolution===d?n:r)(s)}})),f.postMessage({penpal:c,id:o,methodName:e,args:t},m)}))}}(n),e}),e)},_=function(e,n,t){var r=e.localName,o=e.local,a=e.remote,s=e.remoteOrigin,f=!1;g("".concat(r,": Connecting call receiver"));var m=function(e){if(e.source===a&&e.origin===s&&e.data.penpal===c){var t=e.data,o=t.methodName,u=t.args,m=t.id;if(g("".concat(r,": Received ").concat(o,"() call")),o in n){var v=function(e){return function(n){if(g("".concat(r,": Sending ").concat(o,"() reply")),f)g("".concat(r,": Unable to send ").concat(o,"() reply due to destroyed connection"));else{var t={penpal:i,id:m,resolution:e,returnValue:n};e===l&&n instanceof Error&&(t.returnValue=C(n),t.returnValueIsError=!0);try{a.postMessage(t,s)}catch(e){throw"DataCloneError"===e.name&&a.postMessage({penpal:i,id:m,resolution:l,returnValue:C(e),returnValueIsError:!0},s),e}}}};new w.Promise((function(e){return e(n[o].apply(n,u))})).then(v(d),v(l))}}};o.addEventListener(u,m),t.then((function(){f=!0,o.removeEventListener(u,m)}))};w.connectToChild=function(e){var n,t=e.url,r=e.appendTo,c=e.iframe,i=e.methods,d=void 0===i?{}:i,l=e.timeout,m=e.childWindow;if(c&&c.parentNode){var E=new Error("connectToChild() must not be called with an iframe already attached to DOM");throw E.code=v,E}var C=new y((function(e){n=e})),N=window;m||((c=c||document.createElement("iframe")).src=t);var O=function(e){var n,t,r,o=document.location,a=h.exec(e);if(a?(n=a[1]?a[1]:o.protocol,t=a[2],r=a[4]):(n=o.protocol,t=o.hostname,r=o.port),"file:"===n)return"null";var c=r&&r!==p[n]?":".concat(r):"";return"".concat(n,"//").concat(t).concat(c)}(t),k=new w.Promise((function(e,t){var i;void 0!==l&&(i=setTimeout((function(){var e=new Error("Connection to child timed out after ".concat(l,"ms"));e.code=f,t(e),n()}),l));var v,p,h={},w=function(t){var r=m||c.contentWindow;if(t.source===r&&t.origin===O&&t.data.penpal===o){g("Parent: Received handshake, sending reply");var l="null"===t.origin?"*":t.origin;t.source.postMessage({penpal:a,methodNames:Object.keys(d)},l);var u={localName:"Parent",local:N,remote:r,remoteOrigin:l};p&&p();var s=new y((function(e){C.then(e),p=e}));_(u,d,s),v&&v.forEach((function(e){delete h[e]})),v=t.data.methodNames,T(h,u,v,n,C),clearTimeout(i),e(h)}};if(N.addEventListener(u,w),!m){g("Parent: Loading iframe"),(r||document.body).appendChild(c);var E=setInterval((function(){document.body.contains(c)||(clearInterval(E),n())}),6e4);C.then((function(){c.parentNode&&c.parentNode.removeChild(c),N.removeEventListener(u,w),clearInterval(E);var e=new Error("Connection destroyed");e.code=s,t(e)}))}}));return{promise:k,iframe:c,destroy:n}},w.connectToParent=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.parentOrigin,r=void 0===t?"*":t,c=n.methods,i=void 0===c?{}:c,d=n.timeout,l=n.parentWindow;if(window===window.top&&!window.opener){var v=new Error("connectToParent() must be called within an iframe");throw v.code=m,v}var p=new y((function(n){e=n})),h=window,E=l||h.parent,C=new w.Promise((function(n,t){var c;void 0!==d&&(c=setTimeout((function(){var n=new Error("Connection to parent timed out after ".concat(d,"ms"));n.code=f,t(n),e()}),d));var l=function t(o){if(("*"===r||r===o.origin)&&o.source===E&&o.data.penpal===a){g("Child: Received handshake reply"),h.removeEventListener(u,t);var d={localName:"Child",local:h,remote:E,remoteOrigin:o.origin},l={};_(d,i,p),T(l,d,o.data.methodNames,e,p),clearTimeout(c),n(l)}};h.addEventListener(u,l),p.then((function(){h.removeEventListener(u,l);var e=new Error("Connection destroyed");e.code=s,t(e)})),g("Child: Sending handshake"),E.postMessage({penpal:o,methodNames:Object.keys(i)},r)}));return{promise:C,destroy:e}},n.ZP=w}}]);
//# sourceMappingURL=3251.852e9eed8ead3e6378e1.js.map
</script>

</body>
</html>
