<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>acc.fileupload.min.html</title>
</head>
<body>

<script>
ACC.fileupload={_autoload:[["bindProofOfPurchase",$(".js-pop-upload").length>0],["bindSerialNumberUpload",$(".js-reg-serialnumber-upload").length>0],["bindSerialNumberButton",$(".js-serialNumber-upload").length>0],["bindFileInputChange",$(".js-file-input").length>0]],pollWorkflow:function(a){ACC.fileupload.pollWorkflowCallback(a,null)},pollWorkflowCallback:function(b,d){const c=Date.now();const a=b+"?t="+c;console.log("Polling workflow status");$.ajax({url:a,type:"GET",success:function(i){if(i.status==="Finished"){if(typeof i.results[storeTaskName]!=="undefined"&&typeof i.results[storeTaskName].data!=="undefined"){const e=i.results[storeTaskName].data;const h=e.handle;console.log("Workflow Finished - file stored!");console.log("Upload container: "+e.container);console.log("Upload path: "+e.key);console.log("File handle: "+h);var f=cdnUrl+"/"+h+"?policy="+filestackPolicy+"&signature="+filestackSignature;if($(".js-pop-upload").length>0){f=cName+e.key}$("#fileStackCallBackFileUrl").val(f);if($("#fileStackCallBackFileName").length){$("#fileStackCallBackFileName").val(e.filename)}if(d===null){var g=$("#epsonFleetRegisterForm");$.ajax({url:g.attr("action"),type:g.attr("method"),data:g.serialize(),async:false,beforeSend:function(){$(".loader").show()},success:function(k){if(k.error){$("#serialNunberUploadFileErrors").empty();$("#serialNunberUploadFileErrors").html(k.error);parent.jQuery.fn.colorbox.close();$(".loader").hide();setTimeout(function(){$(".fleetRegister__serialNumber_error").slideDown();location.hash="#serialNunberUploadFileErrors";window.location.href=location.hash},500)}var j=k.success;ACC.fileupload.removeFile(client,h,options,j)},error:function(j){console.error("error: "+j);$(".loader").hide()}})}else{d()}}else{if(typeof i.results[storeTaskName]!=="undefined"&&typeof i.results[storeTaskName].error!=="undefined"){console.error("Workflow finished - file not stored: "+i.results[storeTaskName].error);$('<span style="color:red;">Error uploading file</span>').insertAfter($("#uploadSerialNumberSaveBtn"))}else{console.error("Workflow finished - file not stored!")}$(".loader").hide()}}else{if(i.status!=="Failed"&&i.status!=="Finished"){console.debug("Workflow still in process. Continuing polling...");setTimeout(function(){ACC.fileupload.pollWorkflowCallback(b,d)},1000)}else{$('<span style="color:red;">Error uploading file</span>').insertAfter($("#uploadSerialNumberSaveBtn"));if(typeof i.results[storeTaskName]!=="undefined"&&typeof i.results[storeTaskName].error!=="undefined"){console.log("Upload failed, "+i.results[storeTaskName].error)}else{console.log("Upload failed due to internal error")}$(".loader").hide()}}},error:function(e){console.log("Error encountered trying to poll workflow.");console.log(e)}})},removeFile:function(b,d,c,a){setTimeout(function(){b.remove(d,c).then(function(e){if(a){console.log("succesUrl:"+a);window.location.href=a}else{parent.jQuery.fn.colorbox.close();$(".loader").hide()}console.log("file deleted: "+e)})},500)},savePopCallback:function(){$("#save-pop-form").submit()},saveSerialFileCallback:function(){$("#save-serial-form").submit()},captchaCallback:function(){var c=$("#colorbox");var g=c.find("input[type=file]");var f=c.find("#uploadSerialNumberSaveBtn");if(g.val().length){if($("#colorbox input[type=file]")[0].files.length>0){const e=$("#colorbox input[type=file]")[0].files;const d=e[0];var a=d.size;var b=d.type;if(b!=""&&allowFileTypes.includes(b)&&a<=allowFileSizeMB*1000*1000){f.show()}else{f.hide()}}else{f.hide()}}else{f.hide()}},captchaExpiredCallback:function(){var a=$("#colorbox");var b=a.find("#uploadSerialNumberSaveBtn");b.hide()},bindProofOfPurchase:function(){var a=$(".js-pop-upload");a.on("click",function(d){d.preventDefault();$("#popReg").val($(this).data("registration"));var c=$(this).data("popup-label")||"";var b=$(this).data("registration");ACC.colorbox.open(c,{html:$(".serialNumber-modal__wrapper").html(),className:"fleet-colorbox-popup",maxWidth:"900px",width:"96%",onComplete:function(){var e=$("#colorbox");var i=e.find("input[type=file]");var h=e.find("#uploadSerialNumberSaveBtn");var g=e.find(".g-recaptcha-response");if(i.val().length&&g.val().length){h.show()}else{h.hide()}var f=e.find("#upload-serial-num-captcha-form .js-recaptcha-captchaaddon");if(f){ACC.captcha.bindWidgetCallback(f,"recaptchaFileupload")}$("#colorbox .serialnNum_choose_file__btn").click(function(){$("#colorbox .serialNumber-modal .js-file-input").trigger("click")});document.querySelector("#colorbox #uploadSerialNumberSaveBtn").addEventListener("click",function(m){$(".loader").show();if(!$("#colorbox #upload-serial-num-captcha-form").valid()){setTimeout(function(){$(".loader").hide();return false},500)}else{$("#colorbox #uploadSerialNumberSaveBtn").hide();$("#colorbox .upload-serial-num-captcha").hide();$("#colorbox #uploadSerialNumberMessage").html($("#colorbox #uploadSerialNumberMessage").data("loading"));const l=$("#colorbox .serialNumber-modal .js-file-input").prop("files");const k=l[0];const n={workflows:[workflowId]};const o={};var j=client.upload(k,o,n);j.then(function(r){const s=r.workflows[workflowId].jobid;var p="https://cdn.filestackcontent.com/"+fileStackApiKey+"/security=p:"+filestackPolicy+",s:"+filestackSignature+"/workflow_status=job_id:"+s;var q=p;$("#popReg").val(b);ACC.fileupload.pollWorkflowCallback(q,ACC.fileupload.savePopCallback)})}});$("#colorbox #upload-serial-num-captcha-form").validate({ignore:".ignore",rules:{hiddenRecaptcha:{required:function(){if(typeof grecaptcha!="undefined"){return(grecaptcha.getResponse(localStorage.getItem("#upload-serial-num-captcha-form_captchaId"))=="")}else{return $("#upload-serial-num-captcha-form #g-recaptcha_widget iframe").length>0}}}},messages:{hiddenRecaptcha:{required:function(){return $(".g-recaptcha_error").first().text()}}},errorPlacement:function(j,k){if(k.attr("name")=="recaptchaChallangeAnswered"){j.insertAfter("#g-recaptcha_widget")}else{j.insertAfter(k)}}})}})})},bindSerialNumberUpload:function(){var a=$(".js-reg-serialnumber-upload");if(a.length){a.on("click",function(c){c.preventDefault();var b=$(this).data("popup-label")||"";ACC.colorbox.open(b,{html:$(".serialNumber-modal__wrapper").html(),className:"fleet-colorbox-popup",maxWidth:"900px",width:"96%",onComplete:function(){var d=$("#colorbox");var h=d.find("input[type=file]");var g=d.find("#uploadSerialNumberSaveBtn");var f=d.find(".g-recaptcha-response");if(h.val().length&&f.val().length){g.show()}else{g.hide()}var e=d.find("#upload-serial-num-captcha-form .js-recaptcha-captchaaddon");if(e){ACC.captcha.bindWidgetCallback(e,"recaptchaFileupload")}$("#colorbox .serialnNum_choose_file__btn").click(function(){$("#colorbox .serialNumber-modal .js-file-input").trigger("click")});document.querySelector("#colorbox #uploadSerialNumberSaveBtn").addEventListener("click",function(l){$(".loader").show();if(!$("#colorbox #upload-serial-num-captcha-form").valid()){setTimeout(function(){$(".loader").hide();return false},500)}else{$("#colorbox #uploadSerialNumberSaveBtn").hide();$("#colorbox .upload-serial-num-captcha").hide();$("#colorbox #uploadSerialNumberMessage").html($("#colorbox #uploadSerialNumberMessage").data("loading"));const k=$("#colorbox .serialNumber-modal .js-file-input").prop("files");const j=k[0];const m={workflows:[workflowId]};const n={};var i=client.upload(j,n,m);i.then(function(q){const r=q.workflows[workflowId].jobid;var o="https://cdn.filestackcontent.com/"+fileStackApiKey+"/security=p:"+filestackPolicy+",s:"+filestackSignature+"/workflow_status=job_id:"+r;var p=o;ACC.fileupload.pollWorkflowCallback(p,ACC.fileupload.saveSerialFileCallback)})}});$("#colorbox #upload-serial-num-captcha-form").validate({ignore:".ignore",rules:{hiddenRecaptcha:{required:function(){if(typeof grecaptcha!="undefined"){return(grecaptcha.getResponse(localStorage.getItem("#upload-serial-num-captcha-form_captchaId"))=="")}else{return $("#upload-serial-num-captcha-form #g-recaptcha_widget iframe").length>0}}}},messages:{hiddenRecaptcha:{required:function(){return $(".g-recaptcha_error").first().text()}}},errorPlacement:function(i,j){if(j.attr("name")=="recaptchaChallangeAnswered"){i.insertAfter("#g-recaptcha_widget")}else{i.insertAfter(j)}}})}})})}},bindSerialNumberButton:function(){var a=$(".js-serialNumber-upload");a.on("click",function(c){c.preventDefault();var b=$(this).data("popup-label")||"";ACC.colorbox.open(b,{html:$(".serialNumber-modal__wrapper").html(),className:"fleet-colorbox-popup",maxWidth:"900px",width:"96%",onComplete:function(){var d=$("#colorbox");var h=d.find("input[type=file]");var g=d.find("#uploadSerialNumberSaveBtn");var f=d.find(".g-recaptcha-response");if(h.val().length&&f.val().length){g.show()}else{g.hide()}var e=d.find("#upload-serial-num-captcha-form .js-recaptcha-captchaaddon");if(e){ACC.captcha.bindWidgetCallback(e,"recaptchaFileupload")}$("#colorbox .serialnNum_choose_file__btn").click(function(){$("#colorbox .serialNumber-modal .js-file-input").trigger("click")});document.querySelector("#colorbox #uploadSerialNumberSaveBtn").addEventListener("click",function(l){$(".loader").show();if(!$("#colorbox #upload-serial-num-captcha-form").valid()){setTimeout(function(){$(".loader").hide();return false},500)}else{const k=$("#colorbox .serialNumber-modal .js-file-input").prop("files");const j=k[0];const m={workflows:[workflowId]};const n={};var i=client.upload(j,n,m);i.then(function(q){const r=q.workflows[workflowId].jobid;var o="https://cdn.filestackcontent.com/"+fileStackApiKey+"/security=p:"+filestackPolicy+",s:"+filestackSignature+"/workflow_status=job_id:"+r;var p=o;ACC.fileupload.pollWorkflow(p)})}});$("#colorbox #upload-serial-num-captcha-form").validate({ignore:".ignore",rules:{hiddenRecaptcha:{required:function(){if(typeof grecaptcha!="undefined"){return(grecaptcha.getResponse(localStorage.getItem("#upload-serial-num-captcha-form_captchaId"))=="")}else{return $("#upload-serial-num-captcha-form #g-recaptcha_widget iframe").length>0}}}},messages:{hiddenRecaptcha:{required:function(){return $(".g-recaptcha_error").first().text()}}},errorPlacement:function(i,j){if(j.attr("name")=="recaptchaChallangeAnswered"){i.insertAfter("#g-recaptcha_widget")}else{i.insertAfter(j)}}})}})})},bindFileInputChange:function(){$(document).on("change",".js-file-input",function(k){var g=$(this);var i=g.closest(".serialNumber-modal");var b=i.find(".file-upload__text");var c=i.find(".file-uploadsaved__submit");if(k.target.files.length>0){const a=k.target.files;const d=a[0];var h=d.name;b.val(h);var f=d.size;var l=d.type;$("#colorbox #invalidFileError").hide();if(l==""||!allowFileTypes.includes(l)){$("#colorbox #invalidFileError").empty();var j=$("#colorbox #invalidFileError").data("invalidmsg")||ACC.fleetRegSerialNumFileTypeError;$("#colorbox #invalidFileError").text(j);$("#colorbox #invalidFileError").show();c.hide();throw new Error(ACC.fleetRegSerialNumFileTypeError)}else{if(f>allowFileSizeMB*1000*1000){$("#colorbox #invalidFileError").empty();$("#colorbox #invalidFileError").text(ACC.fleetRegSerialNumFileSizeError+" "+allowFileSizeMB+"MB");$("#colorbox #invalidFileError").show();c.hide();throw new Error(ACC.fleetRegSerialNumFileSizeError+" "+allowFileSizeMB+"MB")}else{if($("#colorbox .g-recaptcha-response:last").val().length){c.show()}else{c.hide()}}}}else{b.val("");c.hide()}})}};
</script>

</body>
</html>
