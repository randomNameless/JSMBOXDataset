<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>persoGeo.html</title>
</head>
<body>

<script>
define(["jquery","entreprendre/persogeo/components/apiService","entreprendre/persogeo/components/searchComponent","entreprendre/persogeo/components/markup","entreprendre/persogeo/components/htmlGenerator","entreprendre/persogeo/components/serviceEnLigneButton","entreprendre/persogeo/components/resetSearch","entreprendre/persogeo/components/constants","entreprendre/persogeo/components/container","entreprendre/persogeo/components/serverErrors","entreprendre/persogeo/components/pivot"],function(e,n,a,t,r,i,o,s,d,c,l){"use strict";function p(e){return e.find('button[type="submit"]').removeAttr("disabled"),e.on("submit",function(e){e.preventDefault()}),a.initAutocomplete(e,function(n){m(e,n)}),{}}function v(e,n,t){404===e?a.displayNoResultMessage(n,t):c.displayMessage(t)}function u(e,n,a){null!==a[0].organismes&&L(a,e)}function m(t,r){var i=t.serialize(),s=t.attr("id");r&&(i+="&insee="+r),e("body").addClass("loading"),n.getGeoData(i,function(e){u(s,t,e)},function(e){v(e.status,s,t)},function(){var n=d.getByFormId(s);o.bind(t,n),e("body").removeClass("loading"),a.focusOnConfirmation(t)})}function f(e,n,a,t,r){var i=t.find("[data-pivot-local-service-en-ligne]");i.length>0&&(i.addClass("disabled"),h(t),C(n,t)),t.find("[data-attention-persogeo-id]").addClass("sp-vhidden"),t.find("[data-aNoter-raccordement-demarche]").removeClass("sp-vhidden"),t.find(".sp-geo-search-result").removeClass("sp-vhidden"),o.bind(e,r)}function h(e){var n=e.find('[data-aNoter-raccordement-demarche="depotDossierPACS"]');n.html(r.buildNoOnlineServiceMarkup("La commune que vous avez sélectionnée n’est pas reliée à notre service en ligne et ne pourra pas recevoir le dossier par voie dématérialisée. Vous pouvez cependant effectuer la démarche en ligne, télécharger les documents et les transmettre à la commune.")),n.attr({"aria-live":"polite","aria-atomic":"true"});var a=e.find('[data-aNoter-raccordement-demarche="ILE"]');a.html(r.buildNoOnlineServiceMarkup("La commune que vous avez sélectionnée n’est pas reliée à notre service en ligne. Nous vous invitons donc à contacter votre commune pour connaitre les modalités existantes d’inscription sur les listes électorales.")),a.attr({"aria-live":"polite","aria-atomic":"true"}),e.find("[data-pivot-local-service-en-ligne]").removeClass("disabled"),e.find("[data-pivot-local-service-en-ligne]").removeClass("sp-vhidden"),e.find("[data-aNoter-raccordement-demarche]").removeClass("fr-sr-only")}function g(n,a){var t=e(a.find("[data-pivot-local-service-en-ligne]"));0===n.urlDemarches.length?t.length>0&&!e(a.parent()).is("[data-ou-s-informer]")&&(h(a),a.find("[data-attention-persogeo-id]").addClass("sp-vhidden"),a.find("[data-aNoter-raccordement-demarche]").removeClass("sp-vhidden"),a.find("[data-pivot-local-service-en-ligne]").addClass("sp-vhidden"),a.find("[data-pivot-local-service-en-ligne]").attr("tabindex","-1"),C(n,a)):(a.find("[data-aNoter-persogeo-id]").html(""),a.find("[data-attention-persogeo-id]").addClass("sp-vhidden"),a.find("[data-pivot-local-service-en-ligne]").removeClass("disabled"),a.find("[data-pivot-local-service-en-ligne]").removeClass("sp-vhidden"),a.find("[data-aNoter-raccordement-demarche]").addClass("sp-vhidden"),i.enable(n)),document.querySelectorAll(".sp-panel-title button").forEach(function(e){e.addEventListener("click",function(){var e=this.closest(".sp-panel"),n=e.querySelector(".sp-panel-content"),a=n.classList.contains("show");n.setAttribute("aria-hidden",a?"true":"false")})})}function C(e,n){var a=n.find('[data-pivot-local-service-en-ligne="depotDossierPACS"]');if(a.length>0){a.removeClass("disabled"),a.removeClass("sp-vhidden"),a.removeAttr("tabindex"),a.addClass("enabled");var t=a.attr("href");if(t){if(-1!==t.indexOf("depotDossierPACS")){var r=t.indexOf("depotDossierPACS")+16;t=t.substr(0,r)+"/demarche?codeInseeCommune="+e.insee}a.attr("href",t)}}}function b(n,a,t,r){function i(n){e(n).attr("data-persogeo","pivot-hidden"),e(n).hide()}var o=n.find("[data-pivot][data-for="+a+"]");e.each(o,function(n,a){var o=e(a).is("[data-type-organisme='"+s.KEYWORD.LOCAL_PERSONNALISE_SUR_SP+"']"),d=-1===e.inArray(e(a).attr("data-pivot"),t),c=e(a).is("[data-pivot^='paris_']"),l=e(a).is("[data-type-organisme='"+s.KEYWORD.LOCAL_PERSONNALISABLE+"']");o&&d?(c&&r!==s.DISTRICT.PARIS&&i(a),c||r!==s.DISTRICT.PARIS||i(a)):l&&c&&r!==s.DISTRICT.PARIS&&i(a)})}function S(n,a,t){a.isUnique&&(n.find("div").is(".fr-tabs__panel")?n.find(".fr-tabs__panel").each(function(n,r){l.wrapAndDescribePivotsInContainer(e(r),a.name,t)}):l.wrapAndDescribePivotsInContainer(n,a.name,t))}function A(n,a,t,r,i,s){var d=[];r.find("[data-aNoter-persogeo-id]").html(""),r.find("[data-attention-persogeo-id]").removeClass("sp-vhidden"),r.find("a.sp-btn-demarche").removeClass("sp-vhidden"),o.bind(n,s),e.each(a.organismes,function(n,a){var t={name:a.pivotLocal,isUnique:-1===e.inArray(a.pivotLocal,d)};d.push(t.name);var o={};e.each(r.find("[data-pivot="+t.name+"]:not([data-persogeo=pivot-cloned])"),function(n,t){o=l.render(e(t),i,a)}),S(r,t,o)}),b(r,i,d,t),g(a,r),l.expandOrCollapseResults(r)}function I(n){e.each(n.urlDemarches,function(e,a){a.url=a.url+"?codeInseeCommune="+n.insee})}function L(n,a){var t=e("#"+a),r=n[0];I(r);var i;r.insee&&(i=r.insee.substring(0,2));var s=d.getByFormId(a);e.each(s,function(e,n){o.execute(n)});var c=r.organismes.length+r.urlDemarches.length;c>0?e.each(s,function(e,n){A(t,r,i,n,a,s,c)}):e.each(s,function(e,n){f(t,r,i,n,s)})}return{execute:p,renderNoPossiblePersonalization:f,renderServiceEnLigneUnavailable:h,renderServiceEnLigne:g,renderServiceEnLignePACS:C,renderPersonalizedInformations:A}});
</script>

</body>
</html>
