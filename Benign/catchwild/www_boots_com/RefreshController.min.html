<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RefreshController.min.html</title>
</head>
<body>

<script>
define("wc/render/RefreshController",["dijit","dojo","dojox","dojo/i18n!wc/nls/common","dojo/require!dojo/parser"],function(dijit,dojo,dojox){dojo.provide("wc.render.RefreshController"),dojo.requireLocalization("wc","common",null,"ROOT,en,en-us"),dojo.require("dojo.parser"),wc.render.refreshControllers={},wc.render.getRefreshControllerById=function(e){return wc.render.refreshControllers[e]},wc.render.declareRefreshController=function(e){var r=new wc.render.RefreshController(e);return this.refreshControllers[e.id]=r},dojo.declare("wc.render.RefreshController",null,{constructor:function(e){dojo.mixin(this,e),this.syncRCProperties(),dojo.isFunction(this.renderContextChangedHandler)&&(null==this.renderContext||null==this.renderContext?console.debug("WARNING from RefreshController - renderContextChangedHandler function cannot be defined when renderContext is null or undefined. Controller id: "+this.id):dojo.subscribe(this.renderContext.contextChangedEventName,this,"renderContextChanged")),dojo.isFunction(this.modelChangedHandler)&&dojo.subscribe("modelChanged",this,"modelChanged"),this.widgets={}},id:void 0,renderContext:void 0,url:void 0,mimetype:"text/html",renderContextChangedHandler:void 0,modelChangedHandler:void 0,postRefreshHandler:void 0,currentRCProperties:void 0,widgets:void 0,formId:void 0,addWidget:function(e){this.widgets[e.id]&&console.debug("RefreshController.addWidget: duplicate widget ID "+e.id),this.widgets[e.id]=e,console.debug("REFRESH CONTROLLER "+this.id+" ADDED THIS WIDGET..."+e+" with id = "+e.id)},removeWidget:function(e){void 0!==this.widgets?delete this.widgets[e.id]:console.debug("this.widgets in RefreshController#removeWidget(widget) is not defined yet. No deletion is needed")},syncRCProperties:function(){if(this.renderContext){var e,r={},o=this.renderContext.properties;for(e in o)r[e]=o[e];this.currentRCProperties=r}},renderContextChanged:function(e){for(var r in this.widgets)console.debug("Call renderContext changed handler for the widget..."+this.widgets[r]),this.renderContextChangedHandler(e,this.widgets[r]);this.syncRCProperties()},modelChanged:function(e){for(var r in this.widgets)this.modelChangedHandler(e,this.widgets[r])},refreshHandler:function(e,r){e.setInnerHTML(r)},refresh:function(widget,parameters){function isParameterExcluded(e,r){try{if("object"==typeof URLConfig)if("object"==typeof URLConfig.excludedURLPatterns)for(var o in URLConfig.excludedURLPatterns){var t,d=URLConfig.excludedURLPatterns[o],n=o;if("object"==typeof d)if(d.urlPattern&&(n=d.urlPattern),console.debug("URL pattern to match : "+n),n=new RegExp(n),e.match(n))for(t in d.excludedParameters)if(parametername==t)return 1}else console.debug("The parameter "+r+" is not excluded");else console.debug("No URLConfig defined.")}catch(e){console.debug("An error occured while trying to exclude "+e)}}var formNode=null;this.formId&&(formNode=document.getElementById(this.formId)),parameters?parameters.requesttype||(parameters.requesttype="ajax"):(parameters=[],parameters.requesttype="ajax"),this.url=this.url.replace(/amp;/g,"");var mergedParameters=parameters;if("object"==typeof wcCommonRequestParameters){for(var parameterName in console.debug("Common parameters = "+dojo.toJson(wcCommonRequestParameters)),mergedParameters={},dojo.mixin(mergedParameters,parameters),wcCommonRequestParameters)isParameterExcluded(this.url,parameterName)?console.debug("parameter "+parameterName+" is excluded"):mergedParameters[parameterName]=wcCommonRequestParameters[parameterName];console.debug("After merging = "+dojo.toJson(mergedParameters))}dojo.publish("ajaxRequestInitiated"),dojo.xhrPost({url:this.url,mimetype:this.mimetype,form:formNode,content:mergedParameters,load:function(data){function getIds(e,r){var o="";return""==(o=mergedParameters&&mergedParameters[e]?mergedParameters[e]:o)&&null!=formNode&&formNode[e]&&(o=formNode[e],null!=formNode[e].value&&(o=formNode[e].value)),""!=o||!r||-1!=(r=r).indexOf(e)&&(o=(r=r.substring(r.indexOf(e))).split("&")[0].split("=")[1]),o}function parseJsonCommentFiltered(str){str=str.replace("/*",""),str=str.replace("*/","");var json=eval("("+str+")");return json}var storeId=getIds("storeId",this.url),catalogId=getIds("catalogId",this.url),langId=getIds("langId",this.url),errorCodeBegin=data.indexOf("errorCode"),errorCodeEnd,errorCodeString,urlForMiniShopCart,serviceResponse,myURL,controller;-1!=errorCodeBegin?(errorCodeEnd=data.indexOf(",",errorCodeBegin),errorCodeString=data.substring(errorCodeBegin,errorCodeEnd),urlForMiniShopCart=this.url.indexOf("MiniShopCartDisplayView"),-1==urlForMiniShopCart&&cursor_clear(),console.debug("error condition encountered - error code: "+errorCodeString),-1!=errorCodeString.indexOf("2550")?(console.debug("error type: ERR_DIDNT_LOGON - the customer did not log on to the system."),console.debug("redirecting to URL: AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1"),document.location.href="AjaxLogonForm?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId+"&myAcctMain=1"):-1!=errorCodeString.indexOf("2510")?(console.debug("error type: ERR_SESSION_TIMEOUT - use session has timed out"),serviceResponse=parseJsonCommentFiltered(data),"true"==serviceResponse.exceptionData.rememberMe?(myURL="Logoff?rememberMe=true&storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId,console.debug("try to logoff, get URL="+myURL),dojo.xhrGet({url:myURL,handleAs:"text",content:mergedParameters,service:this,load:function(e,r){console.debug("User logged off. Reload current page to avoid data inconsistence..."),document.location.reload()},error:function(e,r){document.location.href="ReLogonFormView?rememberMe=true&storeId="+storeId}})):(console.debug("redirecting to URL: Logoff?URL=ReLogonFormView&storeId="+storeId),document.location.href="Logoff?URL=ReLogonFormView&storeId="+storeId)):-1!=errorCodeString.indexOf("2520")?(console.debug("error type: ERR_PROHIBITED_CHAR - detected prohibited characters in request"),console.debug("redirecting to URL: ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="ProhibitedCharacterErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):-1!=errorCodeString.indexOf("2540")?(console.debug("error type: ERR_CSRF - cross site request forgery attempt was detected"),console.debug("redirecting to URL: CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CrossSiteRequestForgeryErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId):-1!=errorCodeString.indexOf("CMN1039E")&&(console.debug("error type: _ERR_INVALID_COOKIE - cookie error was detected"),console.debug("redirecting to URL: CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId),document.location.href="CookieErrorView?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId)):(controller=widget.controller,console.debug("RefreshController.refresh - calling refreshHandler for "+widget),controller.refreshHandler(widget,data),null!=controller.postRefreshHandler&&(console.debug("RefreshController.refresh - calling postRefreshHandler for "+widget),controller.postRefreshHandler(widget))),dojo.publish("ajaxRequestCompleted"),widget.updateLiveRegion()},error:function(e){dojo.i18n.getLocalization("wc","common");console.debug("Warning: communication error while updating the refresh area"),dojo.publish("ajaxRequestCompleted")}})},testForChangedRC:function(e){for(var r=!1,o=0;o<e.length;o++){var t=e[o];if(this.currentRCProperties[t]!=this.renderContext.properties[t]){r=!0;break}}return r}})});
</script>

</body>
</html>
