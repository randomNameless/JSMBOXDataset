<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stationCongestion.html</title>
</head>
<body>

<script>
"use strict";var chartCompornent={"extends":VueChartJs.Bar,mixins:[VueChartJs.mixins.reactiveProp],props:["options"],mounted:function(){this.renderChart(this.chartData,this.options)},watch:{options:function(){this.renderChart(this.chartData,this.options)}}};new Vue({el:"#recommend-function",data:{imagePath:NAVITIME_WEB.IMAGE.STATIC_URL+"img/",loaded:!0,rateData:null,realRateData:null,messageData:null,levelData:null,barColorData:null,inputText:"",level:"",inputLinkId:"00006668",stationName:"東京",displayStationName:"",autoCompleteStyle:{vueSimpleSuggest:"",inputWrapper:"nt-input-text",defaultInput:"form-control",suggestions:"position-absolute list-group nt-suggest__group",suggestItem:"list-group-item nt-suggest__item"},controlEnter:{select:[],showList:[229]},chartData:{labels:[],datasets:[]},options:{responsive:!0,scales:{yAxes:[{scaleShowLabels:!1,display:!0,scaleLabel:{display:!1},ticks:{display:!1,min:0,max:1},gridLines:{drawBorder:!0}}]}},suggestStationList:[],isNoInputText:!1,isNoInputId:!1,isStationNameText:!0,isShortageData:!1,isMyCongestion:!0,isAlreadySet:!0},methods:{onBlur:function(){this.$refs.vss.listShown||(this.$refs.vss.isInFocus=!1),this.$refs.vss.hovered||(this.$refs.vss.hideList(),this.$refs.vss.isInFocus=!1)},getSuggestNodeList:function(){this.inputLinkId="";var a=this;return axios.get("/async/node/search?type=station.port&limit=10&keyword="+encodeURI(this.$refs.vss.text)).then(function(b){for(var c=[],d=b.data,e=0;e<d.length;e++)c.push(d[e]);return a.suggestStationList=c,a.suggestStationList})},getCongestion:function(){this.sendClick("","update");var a="";if(!document.search_station_form.keyword.value||!document.search_station_form.keyword.value.match(/\S/g))return void(this.isNoInputText=!0);if(!this.inputLinkId)return void(this.isNoInputId=!0);this.isNoInputText=!1,this.isNoInputId=!1,this.inputLinkId&&(a=this.inputLinkId);var b=dayjs(new Date).format("YYYY-MM-DDTHH:mm:ss");return axios.get("/async/congestion/node/prediction?node="+a+"&date="+b).then(function(a){var b=a.data,c=[],d=[],e=[],f=[],g=[];b.length?this.isShortageData=!1:this.isShortageData=!0;for(var h=0;h<b.length;h++)c.push(b[h].rate),d.push(b[h].realRate),e.push(b[h].message),f.push(b[h].level),g.push(b[h].barColor);this.rateData=c,this.realRateData=d,this.messageData=e,this.levelData=f,this.barColorData=g,this.createChartData(),this.createOptions(this.messageData,this.levelData),this.displayStationName=this.stationName,this.isStationNameText=!0;var i=this.getCookie("UserTop","congestion").split(".");this.isMyCongestion=i[1]!==this.displayStationName?!1:!0,this.isAlreadySet=i[1]!==this.displayStationName?!1:!0}.bind(this))},getCookie:function(a,b){var c=document.cookie,d=c.match(new RegExp(a+"=([^;]+)"));if(d){d[1]=decodeURIComponent(d[1]);var e=d[1].match(b+":([^;]+)");if(e)return e[1]}return""},inputKeyDown:function(a){return 13===a.keyCode?this.$refs.vss.listShown?void(this.$refs.vss.hovered&&(document.search_station_form.keyword.value=this.$refs.vss.hovered.name,this.inputLinkId=this.$refs.vss.hovered.id,this.stationName=this.$refs.vss.hovered.name,this.$refs.vss.hideList())):void this.getCongestion():void 0},onAutocompleteClick:function(a,b){this.inputLinkId=a,this.stationName=b},createChartData:function(){this.chartData={labels:[["3","時"],"","",["6","時"],"","",["9","時"],"","",["12","時"],"","",["15","時"],"","",["18","時"],"","",["21","時"],"","",["24","時"],"",["2","時"]],datasets:[{label:"本日の人混み",data:this.realRateData,backgroundColor:"#f0a500",type:"line",fill:!1,lineTension:.3,pointRadius:0},{label:"人混み予報",type:"bar",data:this.rateData,backgroundColor:this.barColorData,borderColor:"#026400",borderWidth:1,gridLines:{display:!1}}]}},setMyCongestion:function(){axios.get("/account/my/congestion?node="+this.inputLinkId+"&station="+encodeURI(this.displayStationName)).then(function(a){this.isMyCongestion=!0}.bind(this))["catch"](function(a){alert("表示中の駅の初期設定に失敗しました。\n"+a),console.log(a)})},createOptions:function(a,b){this.options={elements:{line:{borderColor:"#f0a500"}},legend:{display:!0,reverse:!0},responsive:!0,maintainAspectRatio:!1,scaleShowLabels:!1,scales:{xAxes:[{display:!0,stacked:!1,gridLines:{display:!1}}],yAxes:[{scaleShowLabels:!1,display:!0,ticks:{display:!1,min:0,suggestedMax:1.2},gridLines:{borderDash:[10,3]}}]},tooltips:{enabled:!1,xPadding:15,yPadding:10,custom:function(a){function b(a){return a.lines}var c=document.getElementById("chartjs-tooltip");if(c||(c=document.createElement("div"),c.id="chartjs-tooltip",c.innerHTML='<table style="width: 350px; text-align: center;"></table>',document.body.appendChild(c)),0===a.opacity)return void(c.style.opacity=0);if(c.classList.remove("above","below","no-transform"),a.yAlign?c.classList.add(a.yAlign):c.classList.add("no-transform"),a.body){var d=a.body.map(b),e="<thead>";e+="</thead><tbody>";var f=this.level;d.forEach(function(a,b){var c="background-color: #fff";c+="; border-style: solid",c+="; border-width: 2px",c+="; border-color: #67a266",c+="; border-radius: 4px;",c+="; padding: 10px",c+="; font-weight: bold",c+="; ";var d='<div class="balloon" style="'+c+'"><img class="stationCongestion__img" src= '+NAVITIME_WEB.IMAGE.STATIC_URL+"img/top/new/stationCongestion/ic-spot-congestion-lv-"+f+".svg />"+a+"</div>";e+="<tr><td>"+d+"</td></tr>"}),e+="</tbody>";var g=c.querySelector("table");g.innerHTML=e;var h=this._chart.canvas.getBoundingClientRect();c.style.opacity=1,c.style.position="absolute",c.style.left=h.left+window.pageXOffset+(a.caretX-190)+"px",c.style.top=h.top+window.pageYOffset+(a.caretY-80)+"px",c.style.fontFamily=a._bodyFontFamily,c.style.fontSize=a.bodyFontSize+"px",c.style.fontStyle=a._bodyFontStyle,c.style.padding=a.yPadding+"px "+a.xPadding+"px",c.style.pointerEvents="none",c.style.zIndex="100"}},callbacks:{title:function(){return""},label:function(c,d){this.level=b[c.index];var e=a[c.index];return e}}}}}},mounted:function(){var a=dayjs(new Date).format("YYYY-MM-DDTHH:mm:ss"),b="00006668",c=b;this.displayStationName="東京";var d=this.getCookie("UserTop","congestion");if(d){var e=d.split(".");c=e[0]?e[0]:b,this.displayStationName=e[1]?e[1]:"東京"}else this.isAlreadySet=!1,this.isMyCongestion=!1;axios.get("/async/congestion/node/prediction?node= "+c+"&date="+a).then(function(a){this.loaded=!1;var b=a.data,c=[],d=[],e=[],f=[],g=[];b.length||(this.isShortageData=!0);for(var h=0;h<b.length;h++)c.push(b[h].rate),d.push(b[h].realRate),e.push(b[h].message),f.push(b[h].level),g.push(b[h].barColor);this.rateData=c,this.realRateData=d,this.messageData=e,this.levelData=f,this.barColorData=g,this.createOptions(this.messageData,this.levelData),this.createChartData(),this.loaded=!0}.bind(this))},watch:{inputText:function(){this.inputText&&(this.isNoInputText=!1)}},mixins:[tdMixin],components:{chartCompornent:chartCompornent},template:'\n    <div class="section" v-inview:once.enter="sendImp">\n      <h2 class="section__title">おすすめ / 混雑情報</h2>\n      <div class="station-congestion content-float">\n        <div class="search-form__error-area">\n          <p v-if="isNoInputText" class="search-form__no-text">駅名を入力してください。</p>\n          <p v-if="!isNoInputText && isNoInputId" class="search-form__no-text">サジェストから駅を選択してください</p>\n        </div>\n\n        <form class="station_congestion_search_form" method="GET" name="search_station_form" onsubmit="return false;">\n          <vue-simple-suggest v-model="inputText"　display-attribute="name" :list ="getSuggestNodeList" :styles="autoCompleteStyle" ref="vss" :controls="controlEnter">\n            <label>\n              <span class="accessibility-hidden">駅検索</span>\n              <input class="search-form__text" name="keyword" placeholder="駅を入力"　type="text"\n                autocomplete="off" @keydown.enter="inputKeyDown" @blur="onBlur">\n            </label>\n            <div slot="suggestion-item" slot-scope="scopeSlot">\n              <div class="suggestion-select-item" @click="onAutocompleteClick(scopeSlot.suggestion.id, scopeSlot.suggestion.name)">{{ scopeSlot.suggestion.name }}</div>\n            </div>\n          </vue-simple-suggest>\n          <input type="hidden" name="from" value="navitime.pc.top">\n          <input type="button" v-on:click="getCongestion()" value="更新" class="search-form__btn">\n        </form>\n\n        <div class="explanation">駅を検索すると本日の混雑予報グラフが表示されます</div>\n        <div class="station-name">\n          <h3 class="station-congestion__title">{{displayStationName}}駅の人混み予報</h3>\n          <div v-if="!isAlreadySet" class="station-congestion__my-set-btn">\n            <a v-if="!isMyCongestion" class="station-congestion__my-set-a" v-on:click="setMyCongestion">表示中の駅を初期設定にする</a>\n            <span v-else class="station-congestion__my-set-complete">表示中の駅を初期設定にしました</span>\n          </div>\n        </div>\n        <div v-if="isShortageData" class="shortage-data">データが不十分のため表示できません</div>\n        <chart-compornent v-if="loaded" :chart-data="chartData" :options="options" id="congestion-chart"></chart-compornent>\n        <div class="annotation">NAVITIMEの検索経路状況に基づいて混雑を予報しています。</div>\n      </div>\n    </div>\n  '});
</script>

</body>
</html>
