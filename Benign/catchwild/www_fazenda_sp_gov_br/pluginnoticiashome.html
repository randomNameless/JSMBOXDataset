<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pluginnoticiashome.html</title>
</head>
<body>

<script>
var PST=PST||{},siteUrl="/Noticias";PST.NoticiasHome={ctx:void 0,collListItem:void 0,Buscar:function(){var e=PST.Avisos.formataData(new Date);PST.NoticiasHome.ctx=new SP.ClientContext(siteUrl);var t=(PST.NoticiasHome.ctx.get_web(),PST.NoticiasHome.ctx.get_web().get_lists().getByTitle("Páginas"));PST.NoticiasHome.ctx.load(t);var i=new SP.CamlQuery;i.set_viewXml("<View><Query><Where><And><Eq><FieldRef Name='DestaqueHomePortal' /><Value Type='Boolean'>1</Value></Eq><And><Or><Lt><FieldRef Name='PublishingStartDate' /><Value IncludeTimeValue='TRUE' Type='PublishingScheduleStartDateFieldType'>"+e+"</Value></Lt><IsNull><FieldRef Name='PublishingStartDate' /></IsNull></Or><Or><Geq><FieldRef Name='PublishingExpirationDate' /><Value IncludeTimeValue='TRUE' Type='PublishingScheduleEndDateFieldType'>"+e+"</Value></Geq><IsNull><FieldRef Name='PublishingExpirationDate' /></IsNull></Or></And></And></Where><OrderBy><FieldRef Name='DataPublicacao' Ascending='False' /></OrderBy></Query><RowLimit>3</RowLimit></View>"),PST.NoticiasHome.collListItem=t.getItems(i),PST.NoticiasHome.ctx.load(PST.NoticiasHome.collListItem),PST.NoticiasHome.ctx.executeQueryAsync(Function.createDelegate(this,PST.NoticiasHome.onQuerySucceeded),Function.createDelegate(this,PST.NoticiasHome.onQueryFailed))},addHoras:function(e,t){var i=new Date(e);e.getHours();return i.setDate(i.getDate()+1),i.setHours(0),i.setMinutes(0),i.setSeconds(0),i},formataData:function(e){console.log(e);var t=e.getMonth()+1,i=e.getFullYear(),o=e.getDate(),a=e.getHours(),l=e.getMinutes();return t<10&&(t="0"+t),o<10&&(o="0"+o),l<10&&(l="0"+l),i+"-"+t+"-"+o+"T"+a+":"+l+":00Z"},GetItems:function(){for(var e,t=[],i=[],o=PST.NoticiasHome.collListItem.getEnumerator();o.moveNext();){var a=(e=o.get_current()).get_item("UrlVideo"),l=null,s=null,n=null;if(null!=a)(n=(s=(l=$.parseHTML(a))[0].src.split("/")).pop()).indexOf("?")>=0&&(s=n.split("?"),n=s[0]);t={Titulo:e.get_item("Title"),ImagemNoticia:e.get_item("PublishingPageImage"),Link:e.get_item("FileRef"),DataPublicacao:e.get_item("DataPublicacao").format("dd/MM/yyyy"),ResumoNoticia:e.get_item("ResumoNoticia"),TipoDestaque:e.get_item("TipoDestaque"),ArquivoAudio:e.get_item("ArquivoAudioURL"),ArquivoVideo:e.get_item("UrlVideo"),ImagemVideo:'<img src="http://img.youtube.com/vi/'+n+'/mqdefault.jpg" style="position: relative; width: 280px; height: 170px;">',SrcVideo:null==l?null:l[0].src},i.push(t)}PST.NoticiasHome.MontarAviso(i)},ModalVideo:function(e){var t="<iframe  width='600' height='350' src='"+e+"?controls=0&autoplay=1'></iframe>";$("#modalContent").html(""),$("#modalContent").append(t)},MontarAviso:function(e){$.get("/BibliotecaDeScripts/TemplateHTML/TemplateNoticiasHome.html",function(t){var i=_.template(t)({Conteudo:e});$("#secaoNoticiasHome").append(i)})},onQuerySucceeded:function(e,t){PST.NoticiasHome.GetItems()},onQueryFailed:function(e,t){console.log("Não foi possível recuperar os dados de avisos")}},$(document).ready(function(){_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/\{%([\s\S]+?)%\}/g,escape:/\{%-([\s\S]+?)%\}/g},SP.SOD.loadMultiple(["SP.Runtime.js","SP.js"],function(){PST.NoticiasHome.Buscar()})});
</script>

</body>
</html>
