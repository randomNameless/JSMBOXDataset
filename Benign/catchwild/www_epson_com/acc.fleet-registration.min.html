<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>acc.fleet-registration.min.html</title>
</head>
<body>

<script>
ACC.fleetRegister={_autoload:["bindSelect2Dropdown","bindSerialNumber","bindFleetRegForm","bindFleetRegButton"],bindSelect2Dropdown:function(){$(".select-state-dropdown").select2().on("change",function(a){$(".loader").show();setTimeout(function(){if($("#city-section").css("display")=="none"){$("#city-section").show()}else{$("#city").val("")}$("#city").trigger("blur");$(".loader").hide()},500);$(this).valid()}).on("select2:open",function(){$(".select2-search__field")[0].focus()});$("#city").on("blur",function(){if($(this).val()!=""&&$(this).val()!=null){$(".loader").show();if(ACC.config.mdrEnabled=="true"){if($("#org-section").css("display")=="none"||$("#organizationSelect").val()==null){setTimeout(function(){$("#org-section").show();ACC.fleetRegister.bindCityOrgSection();$(".select-org-dropdown").select2("focus");$(".loader").hide()},500)}else{setTimeout(function(){$("#organizationSelect").val(null).trigger("change");resetStep1Values();$(".loader").hide()},200)}}else{setTimeout(function(){$(".newOrgNameInput #newOrgName").val("");$(".newOrgNameInput").show();$(".newOrgNameInput #newOrgName").focus();$("#form-address-section").show();ACC.fleetRegister.bindSelect2DropDownSection();validateContiueBtn();$(".loader").hide()},200)}}else{resetStep1Values()}})},bindCityOrgSection:function(){$(".select-org-dropdown").select2({ajax:{url:$("#orgNameUrl").val(),dataType:"json",delay:100,data:function(a){$(".select2-results__options").addClass("select2-org-loader");return{q:a.term,regionIso:$("#stateSelect").val(),city:$("#city").val()}},processResults:function(b,c){var a=$.map(b,function(d){d.id=d.id||d.uniqueID;d.text=d.text||d.formattedOrgName;return d});setTimeout(function(){$(".select2-results__options").removeClass("select2-org-loader")},100);return{results:a}},cache:true},minimumInputLength:3}).on("select2:open",function(a){$(".select2-search__field")[0].focus()}).on("select2:select",function(b){$(".loader").show();var a=$(this);setTimeout(function(){var c=b.params.data;$(".newOrgNameInput #newOrgName").val("");if(c.id=="NOT_LISTED"){$(".newOrgNameInput").show()}else{$(".newOrgNameInput").hide()}$(a).trigger("blur");$("#form-address-section").show();ACC.fleetRegister.bindSelect2DropDownSection();validateContiueBtn();$(".loader").hide()},500)})},bindSelect2DropDownSection:function(){$(".select-title-dropdown").select2({minimumResultsForSearch:Infinity}).on("change",function(a){$(this).valid();validateContiueBtn()});$(".select-purchaseAuthProd-dropdown").select2({minimumResultsForSearch:Infinity}).on("change",function(a){$(this).valid();validateContiueBtn()})},bindSerialNumber:function(){$("#addSerialNumber").on("click",function(){var c=$('.searial-number-section .form-group input[type="text"]').length;if(c<parseInt(ACC.config.serialNumMaxRows)){var b=$(".addMoreField").find('input[type="text"]');$(b).attr("id","serialNumber["+c+"]");$(b).attr("name","serialNumber["+c+"]");var a=$(".addMoreField").html();$(".searial-number-section").append(a);validateSubmitBtn()}if(c==(parseInt(ACC.config.serialNumMaxRows)-1)){$(this).addClass("disabled")}});$(document).on("click",".deleteBtn",function(){$(this).closest(".form-group").remove();var a=$('.searial-number-section .form-group input[type="text"]').length;if(a<parseInt(ACC.config.serialNumMaxRows)){$("#addSerialNumber").removeClass("disabled")}if(a==0){$(".fleetRegSaveBtn").attr("disabled",true)}else{validateSubmitBtn()}$('.searial-number-section .form-group input[type="text"]').each(function(c){var b="serialNumber["+(c)+"]";$(this).attr("id",b);$(this).attr("name",b)})})},bindFleetRegForm:function(){$("#epsonFleetRegisterForm").validate({rules:{state:"required",city:"required",orgName:"required",newOrgName:"required",firstname:"required",lastname:"required",telephone:{required:true,telephone:true},email:{customemail:true},title:"required",isPurchaseAuthorizeProduct:"required"},errorPlacement:function(a,b){var c=$(b);if($(c).attr("id")=="organizationSelect"||$(c).attr("id")=="stateSelect"||$(c).attr("id")=="selectTitle"||$(c).attr("id")=="selectPurchaseAuthorizeProduct"){a.insertAfter($(c).next())}else{if($(c).attr("id").includes("serialNumber")&&$(c).next().length>0){a.insertAfter($(c).next())}else{a.insertAfter(b)}}},highlight:function(c,a,b){var d=$(c);d.closest(".form-group").addClass(a)},unhighlight:function(c,a,b){var d=$(c);d.closest(".form-group").removeClass(a)}});$("#fleetRegisterCaptchaForm").validate({ignore:".ignore",rules:{hiddenRecaptcha:{required:function(){if(typeof grecaptcha!="undefined"){return(grecaptcha.getResponse(localStorage.getItem("#fleetRegisterCaptchaForm_captchaId"))=="")}else{return $("#fleetRegisterCaptchaForm #g-recaptcha_widget iframe").length>0}}}},messages:{hiddenRecaptcha:{required:function(){return $(".g-recaptcha_error").first().text()}}},errorPlacement:function(a,b){if(b.attr("name")=="recaptchaChallangeAnswered"){a.insertAfter("#g-recaptcha_widget")}else{a.insertAfter(b)}}});$(".fleetRegistration__step1 #editStep1").on("click",function(){$(".loader").show();setTimeout(function(){$(".fleetRegistration__step2 .fleetReg-step-head").removeClass("active");$(".fleetRegistration__step2 .fleetRegistration__steps-body").hide();$(".fleetRegistration__step1 .fleetReg-step-head").addClass("active");$(".fleetRegistration__step1 .fleetRegistration__steps-body").show();$(".fleetRegistration__step1 #editStep1").hide();location.hash="#step1";window.location.href=location.hash;$(".fleet-register-save-captcha").hide();$(".loader").hide()},1000)});$("#epsonFleetRegisterForm #email").on("blur change",function(){var a=$("#emailValidationRequired").is(":checked");var b=$("#showEmailValidationPopup").is(":checked");if(a&&b){$("#epsonFleetRegisterForm #alter-email").prop("checked",true)}});$(".fleetRegContBtn").on("click",function(c){if($(this).attr("disabled")!="disabled"){if($("#epsonFleetRegisterForm").valid()){var a=$("#epsonFleetRegisterForm #showEmailValidationPopup").is(":checked");var b=$("#epsonFleetRegisterForm #alter-email").is(":checked");if(a&&!b){$(".loader").show();setTimeout(function(){$(".fleetRegistration__step1 .fleetReg-step-head").removeClass("active");$(".fleetRegistration__step1 .fleetRegistration__steps-body").hide();$(".fleetRegistration__step1 #editStep1").show();$(".fleetRegistration__step2 .fleetReg-step-head").addClass("active");$(".fleetRegistration__step2 .fleetRegistration__steps-body").show();location.hash="#step2";window.location.href=location.hash;var d=$(".fleet-register-save-captcha .js-recaptcha-captchaaddon");if(d){ACC.captcha.bindWidget(d)}$(".fleet-register-save-captcha").show();$(".loader").hide()},1000)}else{$.ajax({url:ACC.config.encodedContextPath+"/mdr/fleet-register/emailValidation",type:"Post",data:$("#epsonFleetRegisterForm").serialize(),success:function(f){if(f=="success"){$(".loader").show();setTimeout(function(){$(".fleetRegistration__step1 .fleetReg-step-head").removeClass("active");$(".fleetRegistration__step1 .fleetRegistration__steps-body").hide();$(".fleetRegistration__step1 #editStep1").show();$(".fleetRegistration__step2 .fleetReg-step-head").addClass("active");$(".fleetRegistration__step2 .fleetRegistration__steps-body").show();location.hash="#step2";window.location.href=location.hash;var h=$(".fleet-register-save-captcha .js-recaptcha-captchaaddon");if(h){ACC.captcha.bindWidget(h)}$(".fleet-register-save-captcha").show();$(".loader").hide()},1000)}else{$("#epsonFleetRegisterForm #showEmailValidationPopup").prop("checked",true);$("#epsonFleetRegisterForm #alter-email").prop("checked",false);var g=$("#epsonFleetRegisterForm #emailValidationRequired").is(":checked");var e=$("#epsonFleetRegisterForm #showEmailValidationPopup").is(":checked");var d=$("#email-invalid").html();if(g&&e){$("#model-button").click();ACC.analytics.fireErrorEvent1("validity_email_validation_error","[serverside]","[Validity:double check your email]")}}}})}}else{$("#epsonFleetRegisterForm").find(".error label:visible:first").focus()}}});$(".fleetRegSaveBtn").on("click",function(){if($(this).attr("disabled")!="disabled"){$('.searial-number-section [name^="serialNumber"]').each(function(){$(this).rules("add",{required:true,maxlength:ACC.config.serialNumMaxLength,rejectCharacters:"^a-z0-9"})});var a=$("#epsonFleetRegisterForm").valid();a=$("#fleetRegisterCaptchaForm").valid()&&a;if(a){$("#fileStackCallBackFileUrl").val("");$(".loader").show();setTimeout(function(){$("#epsonFleetRegisterForm").submit();$(".loader").hide()},1000)}}});$("#epsonFleetRegisterForm").on("submit",function(a){a.preventDefault();$.ajax({url:$(this).attr("action"),type:$(this).attr("method"),data:$(this).serialize(),async:false,beforeSend:function(){$(".loader").show()},success:function(c){console.log("dd:"+c);if(c.error){$("#serialNunberUploadFileErrors").empty();$("#serialNunberUploadFileErrors").html(c.error);$(".fleetRegister__serialNumber_error").show()}else{var b=c.success;setTimeout(function(){window.location.href=b},500)}$(".loader").hide()},error:function(b){console.error("error: "+b);$(".loader").hide()}})});$(".serialNum-error-close").on("click",function(){$(".fleetRegister__serialNumber_error").hide()})},bindFleetRegButton:function(){$("#epsonFleetRegisterForm .fleetRegistration__step1").find("input[type=text]").on("keyup",function(){validateContiueBtn()});$(document).on("keyup","#epsonFleetRegisterForm .fleetRegistration__step2 input[type=text]",function(){validateSubmitBtn()})}};function validateContiueBtn(){var a=true;if($("#form-address-section").css("display")=="block"){$("#epsonFleetRegisterForm .fleetRegistration__step1").find("input[type=text], select").each(function(){if($(this).css("display")!="none"){if(this.id=="newOrgName"){if($(".newOrgNameInput").css("display")=="block"&&($(this).val()==null||$(this).val()=="")){a=false;return}}else{if($(this).val()==null||$(this).val()==""){a=false;return}}}})}if(a){$(".fleetRegContBtn").attr("disabled",false)}else{$(".fleetRegContBtn").attr("disabled",true)}}function validateSubmitBtn(){var a=true;$("#epsonFleetRegisterForm .fleetRegistration__step2").find("input[type=text], select").each(function(){if($(this).css("display")!="none"){if($(this).val()==null||$(this).val()==""){a=false;return}}});if(a){$(".fleetRegSaveBtn").attr("disabled",false)}else{$(".fleetRegSaveBtn").attr("disabled",true)}}function resetStep1Values(){$("#org-section").hide();$(".newOrgNameInput").hide();$("#form-address-section").hide();$("#epsonFleetRegisterForm").find("input[type=text]").val("");$("#organizationSelect").val(null).trigger("change");$("#selectTitle").val(null).trigger("change");$("#selectPurchaseAuthorizeProduct").val(null).trigger("change")};
</script>

</body>
</html>
