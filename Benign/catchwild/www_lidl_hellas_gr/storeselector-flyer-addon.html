<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>storeselector-flyer-addon.html</title>
</head>
<body>

<script>
import {Translations} from './storeselector-flyer-addonTranslations.js'

const template = document.createElement('template');
template.innerHTML = `
<style>
   .lirt-storeselector-flyer-addon {
        --background-brand: #F5F8FC;
        --background-white: #F5F5F5;
        --gray-darker: #353B42;
        --success: #348553;
        --danger: #E60A14;
        --primary: #0050AA;
    
        display: flex;
        height: 40px;
        padding: 0 8px;
        align-items: center;
        justify-content: center;
    }   
    
    .lirt-storeselector-flyer-addon__setStore,
    .lirt-storeselector-flyer-addon__storeInfo {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        width: calc(100vw - 16px);
        max-width: 344px;
        padding: 8px;
        gap: 4px;
        border-radius: 10px;
        background-color: unset;
        border: none;
        cursor: pointer;        
    }
    
    @media (min-width: 600px) {
        .lirt-storeselector-flyer-addon__setStore,
        .lirt-storeselector-flyer-addon__storeInfo {
            width: 384px;
            max-width: unset;
        }
    }
    @media (min-width: 960px) {
        .lirt-storeselector-flyer-addon__setStore,
        .lirt-storeselector-flyer-addon__storeInfo {
            width: 464px;
        }
    }
    
    @media (min-width: 1280px) {
        .lirt-storeselector-flyer-addon__setStore,
        .lirt-storeselector-flyer-addon__storeInfo {
            width: 626px;
        }
    }
    
    .lirt-storeselector-flyer-addon__storeInfo-text {
        display: flex;
        overflow: hidden;
        gap: 4px;
        align-items: center;
        
        @media (min-width: 1280px) {
            gap: 8px;
        }
    }
    
    .lirt-storeselector-flyer-addon__setStoreHeadline,
    .lirt-storeselector-flyer-addon__storeInfoHeadline {           
        font-family: 'LidlFontCondPro';
        font-style: normal;
        font-weight: 400;
        font-size: 12px;
        line-height: 16.8px;
        color: var(--primary);
        text-decoration: underline;
        
        @media (min-width: 1280px) {
            font-size: 14px;
            line-height: 19.6px;
        }
    }
    
    .lirt-storeselector-flyer-addon__storeInfoHeadline {
       
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex-shrink: 1;
    }   
            
    .lirt-storeselector-flyer-addon__storeInfoSubheadline {
        display: flex;
        flex-shrink: 0;
        gap: 4px;
    }
    
    .lirt-storeselector-flyer-addon__setStore-icons,
    .lirt-storeselector-flyer-addon__storeInfo-icons {
        height: 24px;
        flex-shrink: 0;
        fill: var(--primary);
    }
      
    .lirt-storeselector-flyer-addon__status,
    .lirt-storeselector-flyer-addon__separator,
    .lirt-storeselector-flyer-addon__addInfo {
        font-family: 'LidlFontCondPro';
        font-style: normal;
        font-size: 12px;
        line-height: 17px;
        
        @media (min-width: 1280px) {
            font-size: 14px;
            line-height: 19.6px;
        }
    }
    
    .lirt-storeselector-flyer-addon__status,
    .lirt-storeselector-flyer-addon__addInfo {
        white-space: nowrap;
    }
    
    .lirt-storeselector-flyer-addon__status {
        font-weight: 600;
    }
    
    .lirt-storeselector-flyer-addon__separator,
    .lirt-storeselector-flyer-addon__addInfo {
        font-weight: 400;
    
    }
    
    .lirt-storeselector-flyer-addon__status--open {
        color: var(--success);
    }
    
    .lirt-storeselector-flyer-addon__status--closed {
        color: var(--danger);
    }
    
    .hidden\\@all {
        display: none;
    }
</style>
<article class="lirt-storeselector-flyer-addon">
    <button class="lirt-storeselector-flyer-addon__setStore" part="set-store">
        <svg class="lirt-storeselector-flyer-addon__setStore-icons" part="icon" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 24 24">
            <path d="M12 2c3.584 0 6.5 2.916 6.5 6.5 0 3.685-4.07 9.51-6.5 12.792C9.57 18.01 5.5 12.185 5.5 8.5 5.5 4.916 8.416 2 12 2m0-1a7.5 7.5 0 0 0-7.5 7.5c0 4.142 4.286 10.179 7.5 14.464 3.214-4.286 7.5-10.322 7.5-14.464A7.5 7.5 0 0 0 12 1z"/>
            <path d="M12 12.5c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4zm0-7c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3z"/>
        </svg>
        <span class="lirt-storeselector-flyer-addon__setStore-text">
            <span class="lirt-storeselector-flyer-addon__setStoreHeadline" part="text"></span>
        </span>
    </button>

    <button class="lirt-storeselector-flyer-addon__storeInfo hidden@all">

        <span class="lirt-storeselector-flyer-addon__storeInfo-text">
            <svg class="lirt-storeselector-flyer-addon__storeInfo-icons" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <defs>
                    <path d="M18.5881634,55.3343014 L18.5881634,55.3343014 C19.2657532,56.2218995 20.643519,56.2218995 21.3211088,55.3343014 L21.3211088,55.3343014 C33.4273793,39.5090762 40,29.0635616 40,19.2133872 C40,8.63798019 31.0445219,0.032608061 20.0223951,6.73387979e-05 C7.14818954,-0.0323381438 -1.98797913,11.63633 0.372291886,23.7596215 C2.04367997,32.3649937 8.32267847,41.9120858 18.5881634,55.3343014 Z" id="path-1"></path>
                    <path d="M21.4105263,1.67480719 C19.92,0.372627585 18.0589474,-0.198132955 16.1726316,0.0682219635 L16.1263158,0.0766776752 C15.9789474,0.0978169544 15.8315789,0.127411945 15.6884211,0.157006936 C14.2736842,0.465640413 12.9642105,1.30698373 12,2.50346693 C11.0357895,1.30698373 9.72631579,0.461412557 8.31578947,0.15277908 C8.16842105,0.118956234 8.02526316,0.0935890986 7.87789474,0.0724498193 L7.82736842,0.0639941076 C5.94105263,-0.202360811 4.08,0.368399729 2.58947368,1.67057933 C0.943157895,3.11227818 0,5.25157324 0,7.54307111 L0,7.80519817 C0,10.0375061 0.808421053,12.1472061 2.26947368,13.7495635 L11.3768421,23.7273033 C11.7094737,24.0908989 12.2863158,24.0908989 12.6189474,23.7273033 L21.7263158,13.7495635 C23.1915789,12.1472061 24,10.0375061 24,7.80519817 L24,7.54307111 C24,5.25157324 23.0568421,3.11227818 21.4105263,1.67480719 Z" id="path-3"></path>
                    <path d="M32.24,0.46012468 C31.96,0.43012468 31.72,0.63012468 31.69,0.90012468 L31.67,1.11012468 C31.52,2.44012468 32.44,3.65012468 33.76,3.86012468 C39.08,4.68012468 41.51,5.89012468 42,6.50012468 C41.05,7.78012468 34.11,9.92012468 22.6,9.92012468 C11.09,9.92012468 4.15,7.79012468 3.2,6.50012468 C3.69,5.89012468 6.1,4.68012468 11.38,3.87012468 C12.7,3.67012468 13.62,2.45012468 13.47,1.12012468 L13.45,0.91012468 C13.42,0.63012468 13.17,0.43012468 12.9,0.47012468 C6.9,1.19012468 0,2.83012468 0,6.50012468 C0,13.0101247 21.69,13.0801247 22.61,13.0801247 C23.53,13.0801247 45.21,13.0101247 45.21,6.50012468 C45.21,2.81012468 38.28,1.18012468 32.24,0.46012468 Z" id="path-5"></path>
                </defs>
                <g id="map-/-locator-/-favorite" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="lidl_icon_pin_default" transform="translate(12.000000, 0.000000)">
                        <mask id="mask-2" fill="white">
                                <use xlink:href="#path-1"></use>
                        </mask>
                        <use id="Shape" fill="#353B42" fill-rule="nonzero" xlink:href="#path-1"></use>
                        <g id="Group" mask="url(#mask-2)">
                            <g transform="translate(-12.000000, 0.000000)" id="colors-/-01-brand-primary-/-10-base-#0050AA">
                                    <rect id="Rectangle" fill="#353B42" x="0" y="0" width="64" height="64"></rect>
                            </g>
                        </g>
                        <g id="Group" mask="url(#mask-2)">
                            <g transform="translate(8.000000, 8.000000)" id="logos-/-RGB">
                                <mask id="mask-4" fill="white">
                                        <use xlink:href="#path-3"></use>
                                </mask>
                                <g id="Shape" fill-rule="nonzero"></g>
                                <g id="Group" mask="url(#mask-4)" fill="#FFF">
                                        <g id="">
                                                <rect id="Rectangle" x="0" y="0" width="24" height="24"></rect>
                                        </g>
                                </g>
                            </g>
                        </g>
                    </g>
                </g>
            </svg>
            <span class="lirt-storeselector-flyer-addon__storeInfoHeadline"></span>
            <span class="lirt-storeselector-flyer-addon__storeInfoSubheadline">
                <span class="lirt-storeselector-flyer-addon__status"></span>
                <span class="lirt-storeselector-flyer-addon__separator hidden@all">&#9679</span>
                <span class="lirt-storeselector-flyer-addon__addInfo"></span>
            </span>
        </span>
    </button>
</article>
`

// web component
class StoreselectorFlyerAddon extends HTMLElement {

    constructor() {
        super();
        const shadowRoot = this.attachShadow({mode: 'closed'});
        // clone template content nodes to the shadow DOM
        shadowRoot.appendChild(template.content.cloneNode(true));

        this.setStore = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__setStore");
        this.storeInfo = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__storeInfo");
        this.setStoreHeadline = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__setStoreHeadline");
        this.setStoreSubheadline = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__setStoreSubheadline");
        this.storeInfoSubheadline = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__storeInfoSubheadline");
        this.fallback = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__fallback");
        this.storeName = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__storeInfoHeadline");
        this.storeStatus = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__status");
        this.storeAddInfo = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__addInfo");
        this.seperator = shadowRoot.querySelector(".lirt-storeselector-flyer-addon__separator");

        // TODO: remove fallback locale
        this.locale = (window.mindShiftNav && window.mindShiftNav.locale) || 'fr-FR';
        this.countryCode = this.locale.slice(3, 5);


        this.setStore.addEventListener('click', () => {
            this._pushClickEvent('openStoreSearchOffCanvas without favorite store', 'openStoreSearchOffCanvas');
            this._pushClickEventOld('open layer without favorite store');
        });

        this.storeInfo.addEventListener('click', () => {
            this._pushClickEvent('openStoreSearchOffCanvas with favorite store selected', 'openStoreSearchOffCanvas');
            this._pushClickEventOld('open layer with favorite store selected');
        });

        window.addEventListener("storesearch", async (e) => {
            if (e.detail.cookieSet === false) {
                this.storeInfo.classList.add("hidden@all");
                this.setStore.classList.remove("hidden@all");
            } else {
                let cookieValue = this._getCookie('ar');
                if (cookieValue !== undefined) {
                    await this._setValues(this._getDataFromCookie(cookieValue));
                    this.setStore.classList.add("hidden@all");
                    this.storeInfo.classList.remove("hidden@all");
                }
            }
        })

        // set text from translations
        this.setStoreHeadline.innerText = Translations[this.locale].textSetStoreHeadline;

        // get cookie if it is available
        let cookieValue = this._getCookie('ar');
        if (cookieValue !== undefined) {
            (async () => {
                await this._setValues(this._getDataFromCookie(cookieValue));
            })();
        }
    }

    /**
     * fetch data from timings:
     * @param countryCode {string}
     * @param entityID {string}
     * @returns {Promise<any>}
     */
    async _queryTimings(countryCode, entityID) {
        // entityID needs to be 4 digits with leading 0 if it is less
        let storeId = '0000' + entityID;
        storeId = storeId.slice(-4);

        let stage = "";
        if (window.location.href.indexOf("localhost") !== -1) {
            stage = "test";
        } else if (window.location.href.indexOf("https://dev.lidl") !== -1) {
            stage = "dev"
        } else if (window.location.href.indexOf("https://test.lidl") !== -1) {
            stage = "test"
        } else if (window.location.href.indexOf("https://qa.lidl") !== -1) {
            stage = "qas"
        } else {
            stage = "live"
        }
        const queryUrl ="https://" +  stage +  ".api.schwarz/odj/stores-api/v1/myapi/timings/" + countryCode + "/" + storeId;
        try {
            let response = await fetch(queryUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
            if (response.ok) {
                const responseData = await response.json();
                return responseData[0].currentOpeningInformation;
            } else {
                return null
            }
        } catch (error) {
            console.log("unable to fetch data");
            console.log(error);
            return null
        }
    }

    /**
     * returns a cookie
     * @param cookieName {string}
     * @returns {string|undefined}
     */
    _getCookie(cookieName) {
        let matches = document.cookie.match(new RegExp(
            "(?:^|; )" + cookieName.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
    }

    /**
     * returns the store data from the cookie
     * @param {string} cookieValue
     * @returns {Map<any, any>|null}
     * @private
     */
    _getDataFromCookie(cookieValue) {
        if (typeof cookieValue !== 'undefined') {
            this.setStore.classList.add("hidden@all")
            this.storeInfo.classList.remove("hidden@all");

            const cookieDataMap = new Map();
            const cookieData = cookieValue.split(';');
            for (const entry of cookieData) {
                cookieDataMap.set(entry.split('=')[0], entry.split('=')[1]);
            }
            return cookieDataMap
        } else {
            return null
        }
    }


    /**
     * display the store data from the cookie and the timings endpoint
     * @param storeDataFromCookie
     * @returns {Promise<void>}
     * @private
     */
    async _setValues(storeDataFromCookie) {

        if (storeDataFromCookie.size > 0) {
            this.storeName.innerText = storeDataFromCookie.get('street') + ', ' + storeDataFromCookie.get('zip') + ' ' + storeDataFromCookie.get('city');

            // timing logic
            let openingTimes = await this._queryTimings(this.countryCode, storeDataFromCookie.get('EntityID'));

            if (openingTimes !== null) {
                this.storeInfoSubheadline.classList.remove("hidden@all");
                // normal open date
                if (!openingTimes.currentDate.closed) {
                    const now = new Date();
                    const nextOpenTime = new Date(openingTimes.nextOpenDate.date + ' ' + openingTimes.nextOpenDate.openingHours[0].from);
                    const nextOpenTimeShownFormat = this._formatTime(nextOpenTime);

                    if (openingTimes.currentDate.openingHours.length === 1) {
                        const openingTime = new Date(openingTimes.currentDate.date + ' ' + openingTimes.currentDate.openingHours[0].from);
                        let openingHoursTo = openingTimes.currentDate.openingHours[0].to;
                        if (openingHoursTo === '00:00:00') {
                            openingHoursTo = '23:59:59'
                        }
                        const closingTime = new Date(openingTimes.currentDate.date + ' ' + openingHoursTo);

                        const openingTimeShownFormat = this._formatTime(openingTime);
                        const closingTimeShownFormat = this._formatTime(closingTime);

                        if ((openingTime <= now) && (now < closingTime)) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.innerText = Translations[this.locale].textStatusOpen + ' ' + closingTimeShownFormat;
                        }
                        if (now < openingTime) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.innerText = Translations[this.locale].textStatusClosed + ' ' + openingTimeShownFormat;
                        }
                        if (now > closingTime) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.innerText = Translations[this.locale].textStatusClosed + ' ' + nextOpenTimeShownFormat;
                        }
                    }
                    if (openingTimes.currentDate.openingHours.length === 2) {
                        const openingTime = new Date(openingTimes.currentDate.date + ' ' + openingTimes.currentDate.openingHours[0].from);
                        const breakStart = new Date(openingTimes.currentDate.date + ' ' + openingTimes.currentDate.openingHours[0].to);
                        const breakEnd = new Date(openingTimes.currentDate.date + ' ' + openingTimes.currentDate.openingHours[1].from);
                        let openingHoursTo = openingTimes.currentDate.openingHours[1].to;
                        if (openingHoursTo === '00:00:00') {
                            openingHoursTo = '23:59:59'
                        }
                        const closingTime = new Date(openingTimes.currentDate.date + ' ' + openingHoursTo);

                        const openingTimeShownFormat = this._formatTime(openingTime);
                        const breakStartShownFormat = this._formatTime(breakStart);
                        const breakEndShownFormat = this._formatTime(breakEnd);
                        const closingTimeShownFormat = this._formatTime(closingTime);

                        if ((openingTime <= now) && (now < breakStart)) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--closed")
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.innerText = Translations[this.locale].textStatusOpen + ' ' + breakStartShownFormat;
                        }
                        if ((breakEnd <= now) && (now < closingTime)) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--closed")
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.innerText = Translations[this.locale].textStatusOpen + ' ' + closingTimeShownFormat;
                        }
                        if (now < openingTime) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.innerText = Translations[this.locale].textStatusClosed + ' ' + openingTimeShownFormat;
                        }
                        if ((breakStart <= now) && (now < breakEnd)) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.innerText = Translations[this.locale].textStatusClosed + ' ' + breakEndShownFormat;
                        }
                        if (now > closingTime) {
                            this.storeStatus.classList.remove("lirt-storeselector-flyer-addon__status--open");
                            this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                            this.storeStatus.innerText = Translations[this.locale].textStatusClosed + ' ' + nextOpenTimeShownFormat;
                        }
                    }

                    // show next Close Date
                    if (openingTimes.nextCloseDate !== null) {
                        const nextCloseDate = new Date(openingTimes.nextCloseDate.date);
                        const options = {month: '2-digit', day: '2-digit'};
                        const nextCloseDateShownFormat = nextCloseDate.toLocaleDateString(this.locale, options);
                        this.seperator.classList.remove("hidden@all");
                        if (nextCloseDate.getDay() === 0) {
                            const options = {weekday: "long"};
                            let day = new Intl.DateTimeFormat(this.locale, options).format(nextCloseDate);
                            day = day.charAt(0).toUpperCase() + day.slice(1);
                            this.storeAddInfo.innerText = day + " " + Translations[this.locale].textClosed;
                        } else {
                            this.storeAddInfo.innerText = nextCloseDateShownFormat + " " + Translations[this.locale].textClosed;
                        }
                    } else {
                        this.storeAddInfo.innerText = "";
                        this.seperator.classList.add("hidden@all");
                    }
                }

                // holiday or sunday
                if (openingTimes.currentDate.closed && openingTimes.currentDate.reason === "holiday" || openingTimes.currentDate.closed && openingTimes.currentDate.reason === "sunday") {
                    this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                    let closeText = Translations[this.locale].textClosed;
                    closeText = closeText.charAt(0).toUpperCase() + closeText.slice(1);
                    this.storeStatus.innerText = closeText;

                    // show next open day
                    if (openingTimes.nextOpenDate !== null) {
                        const nextOpenDate = new Date(openingTimes.nextOpenDate.date);
                        const options = {month: '2-digit', day: '2-digit'};
                        const nextOpenDateShownFormat = nextOpenDate.toLocaleDateString(this.locale, options);
                        const openingTime = new Date(openingTimes.nextOpenDate.date + ' ' + openingTimes.nextOpenDate.openingHours[0].from);
                        const openingTimeShownFormat = this._formatTime(openingTime);
                        this.seperator.classList.remove("hidden@all");
                        this.storeAddInfo.innerText = Translations[this.locale].textWillOpen + ' ' + nextOpenDateShownFormat + ' ' + openingTimeShownFormat;
                    } else {
                        this.storeAddInfo.innerText = "";
                        this.seperator.classList.add("hidden@all");
                    }
                }

                // temporary closed
                if (openingTimes.currentDate.closed && openingTimes.currentDate.reason === "temp_closed") {
                    this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                    this.storeStatus.innerText = Translations[this.locale].textStatusTemporaryClosed;

                    // show next open day
                    if (openingTimes.nextOpenDate !== null) {
                        const nextOpenDate = new Date(openingTimes.nextOpenDate.date);
                        const options = {month: '2-digit', day: '2-digit'};
                        const nextOpenDateShownFormat = nextOpenDate.toLocaleDateString(this.locale, options);
                        this.seperator.classList.remove("hidden@all");
                        this.storeAddInfo.innerText = Translations[this.locale].textWillOpen + " " + nextOpenDateShownFormat;
                    } else if (openingTimes.currentDate.until !== null) {
                        let nextOpenDate = new Date(openingTimes.currentDate.until);
                        nextOpenDate.setDate(nextOpenDate.getDate()+1);
                        const options = {month: '2-digit', day: '2-digit'};
                        const nextOpenDateShownFormat = nextOpenDate.toLocaleDateString(this.locale, options);
                        this.seperator.classList.remove("hidden@all");
                        this.storeAddInfo.innerText = Translations[this.locale].textWillOpen + ' ' + nextOpenDateShownFormat;
                    } else {
                        this.storeAddInfo.innerText = "";
                        this.seperator.classList.add("hidden@all");
                    }
                }

                // permanently closed
                if (openingTimes.currentDate.closed && openingTimes.currentDate.reason === "closed") {
                    this.storeStatus.classList.add("lirt-storeselector-flyer-addon__status--closed");
                    this.storeStatus.innerText = Translations[this.locale].textStatusPermanentlyClosed;
                }
            } else {
                // Fallback Text
                this.storeInfoSubheadline.classList.add("hidden@all");
            }
        }
    }

    /**
     * format a date to a format to display: hh:mm
     * @param {Date} time
     * @returns {string}
     * @private
     */
    _formatTime(time) {
        return String(time.getHours()).padStart(2, '0') + ':' + String(time.getMinutes()).padStart(2, '0')
    }

    /**
     * pushes click events to GA4
     * @param {string} eventInteractionType
     * @param {string} linkName
     * @private
     */
    _pushClickEvent(eventInteractionType, linkName) {
        if (!window.dataLayerService) {
            console.warn("[retail] Tracking variable dataLayerService is not available.");
            window.dataLayerService = [];
        }

        window.dataLayerService.push({
            scenarioName: 'General_Link_Click',
            collections: {
                eventInfo: {
                    eventAction: 'General_Link_Click',
                    eventCategory: 'click',
                    eventInteractionType: eventInteractionType
                },
                click: {
                    linkName: linkName,
                    linkType: 'internal'
                }
            }
        });
    }

    /**
     * pushes click events to UA (universal analytics)
     * @param {string} eventAction
     * @private
     */
    _pushClickEventOld(eventAction) {
        if (!window.dataLayer) {
            console.warn("[retail] Tracking variable dataLayer is not available.");
            window.dataLayer = [];
        }

        window.dataLayer.push({
            'event': 'gaEvent',
            'eventCategory': 'Store Search',
            'eventAction': eventAction
        });
    }

}

// register component
customElements.define('store-selector-flyer-addon', StoreselectorFlyerAddon);

</script>

</body>
</html>
