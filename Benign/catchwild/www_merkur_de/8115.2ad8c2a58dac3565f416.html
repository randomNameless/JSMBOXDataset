<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>8115.2ad8c2a58dac3565f416.html</title>
</head>
<body>

<script>
(self.webpackChunk_cleverpush_cleverpush_js_sdk=self.webpackChunk_cleverpush_cleverpush_js_sdk||[]).push([[8115],{5533:function(e,n,r){"use strict";r.d(n,{Z:function(){return t}});var i=r(6875);function t(){return t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,r){var t=(0,i.Z)(e,n);if(t){var o=Object.getOwnPropertyDescriptor(t,n);return o.get?o.get.call(arguments.length<3?e:r):o.value}},t.apply(this,arguments)}},6875:function(e,n,r){"use strict";r.d(n,{Z:function(){return t}});var i=r(7608);function t(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=(0,i.Z)(e)););return e}},8606:function(e,n,r){"use strict";r.d(n,{Z:function(){return a}});var i=r(5991),t=r(6610),o=r(379),c=r(6070),s=r(7608);function u(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,s.Z)(e);if(n){var t=(0,s.Z)(this).constructor;r=Reflect.construct(i,arguments,t)}else r=i.apply(this,arguments);return(0,c.Z)(this,r)}}var a=function(e){(0,o.Z)(r,e);var n=u(r);function r(){return(0,t.Z)(this,r),n.apply(this,arguments)}return(0,i.Z)(r)}(r(4740).Z)},8115:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return M}});var i=r(6610),t=r(5991),o=r(5533),c=r(379),s=r(6070),u=r(7608),a=r(3251),f=r(4005),g=r(1078),d=r(8606),b=r(4740),l=r(2034),h=r(3114),p=r(7159),m=r(1720),v=r(155);function S(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=(0,u.Z)(e);if(n){var t=(0,u.Z)(this).constructor;r=Reflect.construct(i,arguments,t)}else r=i.apply(this,arguments);return(0,s.Z)(this,r)}}var M=function(e){(0,c.Z)(r,e);var n=S(r);function r(e,t,o){var c;if((0,i.Z)(this,r),(c=n.call(this,e,t,o)).addControllerChangeListener(),c.isSubscribed().then((function(e){e&&c.storageManager.initDb()})),c.isUnregisteringWorker=!1,e.loadIframe&&c.config.subdomain){var s="https://".concat(c.config.subdomain,".").concat(c.config.cleverpushDomain||"cleverpush.com"),u=document.createElement("div");u.style.display="none",document.body.appendChild(u),a.ZP.debug=g.cM.getLevel()<2;var f=a.ZP.connectToChild({url:"".concat(s,"/iframe?origin=").concat(encodeURIComponent(location.origin)),appendTo:u,timeout:2e4});f.iframe.style.display="none",f.promise.then((function(e){g.cM.debug("child ready",e),c.iframeMessenger=e,e.setConfig(c.config).then((function(){c.triggerEvent(l.Z.INITIALIZED)}))})).catch((function(e){g.cM.debug("iFrame connection error",e),c.triggerEvent(l.Z.INITIALIZED)}))}else c.triggerEvent(l.Z.INITIALIZED);return!navigator.permissions||"Firefox"===p.Xh.name&&p.x_<46||navigator.permissions.query({name:"notifications"}).then((function(e){e.onchange=function(){c.isSubscribing||("granted"===window.Notification.permission?"denied"===window.Notification.permission?c.unsubscribe():c.isSubscribed().then((function(e){e||c.triggerEvent(l.Z.PERMISSION_RE_GRANTED)})):c.unsubscribe(!0))}})),c}return(0,t.Z)(r,[{key:"unsubscribe",value:function(e){var n=this;return this.iframeMessenger?this.iframeMessenger.getSubscriptionId().then((function(i){return n.iframeMessenger.unsubscribe(!0).then((function(){return(0,o.Z)((0,u.Z)(r.prototype),"unsubscribe",n).call(n,e,i)}))})):(0,o.Z)((0,u.Z)(r.prototype),"unsubscribe",this).call(this,e)}},{key:"isSubscribedViaSubdomain",value:function(){return!0}},{key:"addControllerChangeListener",value:function(){var e=this;try{if(this.controllerChangeListenerAdded)return;this.controllerChangeListenerAdded=!0,"granted"===window.Notification.permission&&navigator.serviceWorker&&"/"===this.getWorkerScope()&&navigator.serviceWorker.addEventListener("controllerchange",(function(n){g.cM.debug("controllerchange",n),e.storageManager.unsetSynced(),e.isSubscribed()}))}catch(e){g.cM.error("addControllerChangeListener failed",e)}}},{key:"replaceRootWorker",value:function(){var e=this;return new Promise((function(n){var r;"granted"!==window.Notification.permission||!navigator.serviceWorker||"/"!==e.getWorkerScope()||!navigator.serviceWorker.controller||null!==(r=navigator.serviceWorker.controller.scriptURL)&&void 0!==r&&r.includes(e.getWorkerPath())?n():(g.cM.debug("replacing root service worker..."),navigator.serviceWorker.ready.then((function(r){if(e.isUnregisteringWorker)return g.cM.debug("already replacing root worker"),void n();e.isUnregisteringWorker=!0,setTimeout((function(){e.isUnregisteringWorker=!1}),6e4),r.unregister().then((function(e){g.cM.debug("replacing root worker result",e),n()})).catch(n)})).catch((function(e){g.cM.debug("replacing root service worker failed",e),n()})))}))}},{key:"isSubscribed",value:function(){var e=this;return new Promise((function(n){if("PREVIEW"===e.config.env)return n(!1);var r=function(){if(g.cM.debug("httpsManager syncAndResolve"),e.checkingIfShouldSync)return e.subscribed=!0,void n(!0);e.checkingIfShouldSync=!0,e.storageManager.checkIfShouldSync().then((function(r){e.checkingIfShouldSync=!1,r?e.sync().then((function(){g.cM.debug("httpsManager subscribed = true (1)"),e.subscribed=!0,n(!0)})).catch((function(r){g.cM.warn("error while syncing",r),g.cM.debug("httpsManager subscribed = true (2)"),e.subscribed=!0,n(!0)})):(g.cM.debug("httpsManager subscribed = true (3)"),e.subscribed=!0,n(!0))}))},i=function(){g.cM.debug("httpsManager resubscribe"),e.isSubscribing?(g.cM.debug("httpsManager subscribed = true (6)"),e.subscribed=!0,n(!0)):(e.isSubscribing=!0,e.isReSubscribe=!0,e.storageManager.canSubscribe().then((function(r){if(r){if(r===v.qq.WAS_DENIED)return e.config.showConfirmAlert=!0,n(!1),e.isSubscribing=!1,void(e.subscribed=!1);e.registerWorker().then((function(n){return e.pushManagerSubscribe(n)})).then((function(r){return e.sync(r).then((function(){e.isSubscribing=!1,e.triggerEvent(l.Z.SUBSCRIBED,e.storageManager.getSubscriptionId()),g.cM.debug("httpsManager subscribed = true (4)"),e.subscribed=!0,n(!0)}))})).catch((function(r){g.cM.error(r),e.isSubscribing=!1,g.cM.debug("httpsManager subscribed = false (5)"),e.subscribed=!1,n(!1)}))}else e.isSubscribing=!1,n(!1)})))},t=function(){if("granted"===window.Notification.permission&&navigator.serviceWorker)return e.getActiveWorkerRegistration().then((function(t){return t.pushManager.getSubscription().then((function(o){return e.tryWorkerUpdate(t),o?e.storageManager.isSubscribed().then((function(i){i?r():(g.cM.debug("httpsManager subscribed = false (7)"),e.subscribed=!1,n(!1))})):e.config.showConfirmAlertResubscribe?(e.config.showConfirmAlert=!0,void n(!1)):(g.cM.debug("isSubscribed: no subscription found -> resubscribe"),void i())}))})).catch((function(r){if(e.config.showConfirmAlertResubscribe)return e.config.showConfirmAlert=!0,void n(!1);g.cM.debug("isSubscribed: -> resubscribe ",r),i()}));g.cM.debug("isSubscribed: no perm or SW found"),g.cM.debug("httpsManager subscribed = false (8)"),e.subscribed=!1,n(!1)};e.replaceRootWorker().then((function(){if(!e.iframeMessenger)return t();e.iframeMessenger.isSubscribed().then((function(n){return g.cM.debug("isSubscribed",n),n?e.iframeMessenger.getSubscriptionId().then((function(n){return n!==e.storageManager.getSubscriptionId()||"granted"!==window.Notification.permission&&!e.config.autoRegister?r():t()})):t()})).catch((function(r){r&&(g.cM.debug("isSubscribed err",r),g.cM.error(r)),g.cM.debug("httpsManager subscribed = false (9)"),e.subscribed=!1,n(!1)}))}))}))}},{key:"pushManagerSubscribe",value:function(e,n){var r=this;return new Promise((function(i,t){e.pushManager.subscribe(r.getPushManagerSubscribeOptions()).then((function(n){i(n),r.unregisterOtherPushSubscriptions(e)})).catch((function(o){!n&&o&&o.message&&(o.message.indexOf("subscription with a different application server key")>-1||o.message.indexOf("subscription with a different applicationServerKey")>-1)?e.pushManager.getSubscription().then((function(n){n?(r.migratedSubscription=!0,n.unsubscribe().then((function(){r.pushManagerSubscribe(e,!0).then(i).catch(t)})).catch(t)):t(o)})).catch(t):t(o)}))}))}},{key:"canSubscribe",value:function(){var e=this;return new Promise((function(n,r){if("denied"===window.Notification.permission&&e.config.alertHoursDeny&&"was-denied"===localStorage.getItem("cleverpush-subscription-status")&&"denied"!==sessionStorage.getItem("cleverpush-subscription-status"))return e.config.showUnblockTutorial=!0,e.config.showConfirmAlert=!0,void n(!0);if("PREVIEW"===e.config.env)return n(!0);var i=function(){"denied"===window.Notification.permission?r(new b.Z("User has manually denied notifications","unsubscribed")):e.isSubscribing&&e.isReSubscribe?r(new b.Z("Currently automatically re-subscribing user in the background","isSubscribing")):e.storageManager.canSubscribe().then((function(i){g.cM.debug("storageStatus canSubscribe",i),i?e.isSubscribed().then((function(e){e?r(new b.Z("User is already subscribed","subscribed")):n(!0)})):r(new b.Z("User has manually unsubscribed or denied notifications: ".concat(i),"unsubscribed"))}))},t=function(){if("accengage"!==e.config.importedSubscriptionsProvider||!e.config.importedSubscriptionsSubdomain)return i();(0,m.N)(e.config).then((function(e){if(!e)return i();n(!1)}))};if(!e.iframeMessenger)return t();e.iframeMessenger.canSubscribe().then((function(e){var n=e.result,i=e.message,o=e.reason;if(g.cM.debug("canSubscribe from iframe",n),!0===n)return t();r(new b.Z(i,o))}),(function(e){e&&g.cM.debug("canSubscribe err iframe",e),r(e)}))}))}},{key:"getSubscriptionId",value:function(){var e=this;return new Promise((function(n){var r=e.storageManager.getSubscriptionId();r?n(r):e.iframeMessenger?e.iframeMessenger.getSubscriptionId().then((function(e){n(e)})):n(null)}))}},{key:"hasNotificationPermission",value:function(){var e=this;return new Promise((function(n){if("PREVIEW"===e.config.env)return n(!1);"granted"===window.Notification.permission?n(!0):n(!1)}))}},{key:"registerForPush",value:function(){var e=this;return new Promise((function(n,r){e.storageManager.setAllowed(),!(e.topics||[]).length&&e.config.confirmAlertNativeTheme&&"cleverpush-confirm-default"!==e.config.confirmAlertNativeTheme&&e.confirm&&e.confirm.hasTopicCheckboxes()&&e.setTopics(e.confirm.getSelectedTopics()),e.registerWorker().then((function(n){return e.pushManagerSubscribe(n)})).then((function(r){return g.cM.debug("push manager subscription",r),e.sync(r).then((function(){e.isSubscribing=!1,e.triggerEvent(l.Z.SUBSCRIBED,e.storageManager.getSubscriptionId()),n("granted")}))})).catch((function(n){g.cM.error(n),e.isSubscribing=!1,r(n)}))}))}},{key:"subscribeForce",value:function(e){var n=this;return new Promise((function(r,i){e?r():n.isSubscribing?i(new d.Z("A subscription process is already in progress.")):(n.isSubscribing=!0,"default"===Notification.permission?(Notification.requestPermission((function(e){"granted"===e?(n.registerForPushLater=!1,n.registerForPushLater?n.storageManager.setPending():n.registerForPush().then(r).catch(i),n.confirm&&(n.confirm.hideBackdrop(e),n.config.confirmAlertSelectTopicsLater&&(n.confirm.channelTopics||[]).length&&!n.config.confirmAlertHideChannelTopics&&(n.confirm.appendConfirmBox(n.config.confirmAlertSelectTopicsLaterTheme||"cleverpush-confirm-default",!0),n.config.confirmAlertSubscribeLater&&(n.registerForPushLater=!0)))):(n.isSubscribing=!1,"default"===e&&(n.storageManager.setClosed(),"Firefox"===p.Xh.name&&n.storageManager.setTempBlocked()),"denied"===e&&"PREVIEW"!==n.config.env&&(n.api.confirmAlertDenied(),n.storageManager.setDenied()),i(new b.Z((0,h.Iu)("popup.info").formatCleverPush("<strong>".concat((0,h.Iu)("confirm.allowBrowser")||(0,h.Iu)("confirm.allow"),"</strong>")),e))),g.cM.debug("HTTP Permission Request Result:",e)})),n.api.confirmAlertShown(!1,"native-confirm-alert")):"denied"===Notification.permission?(n.isSubscribing=!1,n.confirm.showBackdrop(void 0,"denied",(0,h.Iu)("popup.info").formatCleverPush("<strong>".concat((0,h.Iu)("confirm.allowBrowser")||(0,h.Iu)("confirm.allow"),"</strong>")))):(g.cM.debug("PermissionAlreadyGranted",n.config.confirmAlertSelectTopicsLater&&(n.confirm.channelTopics||[]).length&&!n.config.confirmAlertHideChannelTopics),n.registerForPush().then(r).catch(i),n.confirm&&(n.confirm.hideBackdrop("granted"),n.config.confirmAlertSelectTopicsLater&&(n.confirm.channelTopics||[]).length&&!n.config.confirmAlertHideChannelTopics&&n.getTopics().then((function(e){(e||[]).length||n.confirm.appendConfirmBox(n.config.confirmAlertSelectTopicsLaterTheme||"cleverpush-confirm-default",!0)})))))}))}},{key:"subscribe",value:function(){var e=this;return this.isSubscribed().then((function(n){return e.subscribeForce(n)}))}},{key:"setClickedNotification",value:function(e){this.storageManager.setClickedNotification(e),this.iframeMessenger&&this.iframeMessenger.setClickedNotification(e)}},{key:"getClickedNotification",value:function(e){var n=this;return new Promise((function(r){var i=n.storageManager.getClickedNotification(e);!i&&n.iframeMessenger?n.iframeMessenger.getClickedNotification().then((function(e){r(e)})):r(i)}))}}]),r}(f.default)},1720:function(e,n,r){"use strict";function i(e){return new Promise((function(n){window.addEventListener("message",(function e(r){if(console.log("acc message",r.data),r.data&&"mid:get:storage"===r.data.type)if(window.removeEventListener("message",e),r.data.body){var i=JSON.parse(r.data.body);n(!!i&&!0===i.isOptin)}else n(!1)}));var r=document.querySelector('iframe[name="acc_proxy"]');r?r.contentWindow.postMessage({topic:"mid:get:storage",type:"mid:get:storage",body:{}},"*"):((r=document.createElement("iframe")).src="https://"+e.importedSubscriptionsSubdomain+".accengage.net/pushweb/assets/m_main.html",r.style.display="none",r.style.border="none",r.name="acc_proxy",r.onload=function(){r.contentWindow.postMessage({topic:"mid:get:storage",type:"mid:get:storage",body:{}},"*")},r.onerror=function(){return n(!1)},document.body.appendChild(r))}))}r.d(n,{N:function(){return i}})}}]);
//# sourceMappingURL=8115.2ad8c2a58dac3565f416.js.map
</script>

</body>
</html>
