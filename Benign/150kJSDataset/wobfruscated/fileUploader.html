<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>fileUploader.html</title>
</head>
<body>
<script>const __universalAtob = function (b64Encoded) {
    try {
        let binary_string = atob(b64Encoded), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(b64Encoded, 'base64'));
    }
};
const __forWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAABfwKkgICAAAMDZW52BHRlc3QAAQNlbnYGdXBkYXRlAAADZW52BGJvZHkAAAOCgICAAAEABISAgIAAAXAAAAWDgICAAAEAAQeRgICAAAIGbWVtb3J5AgAEZGF0YQADCpmAgIAAAZOAgIAAAAJAA0AQAEUNARACEAEMAAsLCw==';
const __forWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__forWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__forWasmBuffer, 'base64'));
    }
})());
const __ifWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAF/AAKfgICAAAIDZW52CGltcEZ1bmMxAAADZW52CGltcEZ1bmMyAAADgoCAgAABAQSEgICAAAFwAAAFg4CAgAABAAEHkYCAgAACBm1lbW9yeQIABGRhdGEAAgqSgICAAAGMgICAAAAgAARAEAAFEAELCw==';
const __ifWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__ifWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__ifWasmBuffer, 'base64'));
    }
})());
const __callWasmBuffer = 'AGFzbQEAAAABhICAgAABYAAAAo+AgIAAAQNlbnYHaW1wRnVuYwAAA4KAgIAAAQAEhICAgAABcAAABYOAgIAAAQABB5GAgIAAAgZtZW1vcnkCAARkYXRhAAEKioCAgAABhICAgAAAEAAL';
const __callWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__callWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__callWasmBuffer, 'base64'));
    }
})());
const __wasmStringModules = ['AGFzbQEAAAAFg4CAgAABAAEGwYGAgAAhfwBBAQt/AEEOC38AQRALfwBBEgt/AEEUC38AQRoLfwBB5AALfwBB5gALfwBB+AALfwBB+gALfwBBlgELfwBBsAELfwBBuAELfwBBwAELfwBByAELfwBB0AELfwBB2gELfwBB4AELfwBB6AELfwBB8AELfwBB9gELfwBBgAILfwBBhAILfwBBiAILfwBBjAILfwBBkAILfwBBlgILfwBBnAILfwBBpAILfwBBqAILfwBBrAILfwBBsAILfwBBuAILB6mCgIAAIgZtZW1vcnkCAAVkYXRhMAMABWRhdGExAwEFZGF0YTIDAgVkYXRhMwMDBWRhdGE0AwQFZGF0YTUDBQVkYXRhNgMGBWRhdGE3AwcFZGF0YTgDCAVkYXRhOQMJBmRhdGExMAMKBmRhdGExMQMLBmRhdGExMgMMBmRhdGExMwMNBmRhdGExNAMOBmRhdGExNQMPBmRhdGExNgMQBmRhdGExNwMRBmRhdGExOAMSBmRhdGExOQMTBmRhdGEyMAMUBmRhdGEyMQMVBmRhdGEyMgMWBmRhdGEyMwMXBmRhdGEyNAMYBmRhdGEyNQMZBmRhdGEyNgMaBmRhdGEyNwMbBmRhdGEyOAMcBmRhdGEyOQMdBmRhdGEzMAMeBmRhdGEzMQMfBmRhdGEzMgMgC9CDgIAAIQBBAQsMZGVmYXVsdEZpbGUAAEEOCwEAAEEQCwEAAEESCwEAAEEUCwVmaWxlAABBGgtIcm91dGVyJTIwbWF0Y2hlcyUyMHR5cGUlMjBub3QlMjBmaWxlJTJDJTIwZmlsZXVwbG9hZGVyJTIwaW5pdCUyMGZhaWxlZCEAAEHkAAsBAABB5gALEXRvbyUyMGJpZyUyMGZpbGUAAEH4AAsBAABB+gALGmV4dGVudGlvbiUyMG5vdCUyMGFsbG93ZWQAAEGWAQsZaW5wdXQlNUJ0eXBlJTNEJ2ZpbGUnJTVEAABBsAELB2NoYW5nZQAAQbgBCwZCJTJGcwAAQcABCwdNQiUyRnMAAEHIAQsHS0IlMkZzAABB0AELCXByb2dyZXNzAABB2gELBWxvYWQAAEHgAQsGZXJyb3IAAEHoAQsGYWJvcnQAAEHwAQsFUE9TVAAAQfYBCwllcnJvciUyMAAAQYACCwIwAABBhAILAjAAAEGIAgsCMAAAQYwCCwMwMAAAQZACCwQlM0EAAEGWAgsEJTNBAABBnAILBkJ5dGVzAABBpAILA0tCAABBqAILA01CAABBrAILA0dCAABBsAILBm4lMkZhAABBuAILBCUyMAA='].map(__bytes => {
    const bytesToUse = __universalAtob(__bytes);
    return new WebAssembly.Instance(new WebAssembly.Module(bytesToUse));
});
const lS = (wI, pos, iWC) => {
    let __str = '';
    if (!Array.isArray(wI)) {
        let __targetModule = __wasmStringModules[wI];
        let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
        const __stringKey = `data${ pos }`;
        let __start = __targetModule.exports[__stringKey] - 1;
        let __str = '';
        let i = __start;
        let __c = __mem[i++];
        while (!(parseInt(__c) & 128) && __mem[i]) {
            __str += __c;
            __c = String.fromCharCode(__mem[i++]);
        }
        __str += __c;
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    } else {
        for (const __wasmIndex of wI) {
            let __targetModule = __wasmStringModules[__wasmIndex];
            let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
            const __stringKey = `data${ pos }`;
            let __start = __targetModule.exports[__stringKey] - 1;
            let i = __start;
            let __c = __mem[i++];
            while (!(parseInt(__c) & 128) && __mem[i]) {
                __str += __c;
                __c = String.fromCharCode(__mem[i++]);
            }
            __str += __c;
        }
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    }
};
Library.fileUploader = sumeru.Library.create(function (exports) {
    var fileUploader = function (properties) {
        this.fileName = lS(0, 0);
        this.extension = lS(0, 1);
        this.fileSize = 0;
        this.iPreviousBytesLoaded = 0;
        this.iPercentComplete = 0;
        this.routerPath = lS(0, 2);
        this.form = null;
        this.target = lS(0, 3);
        this.status = fileUploader.PENDING;
        var me = this;
        for (var key in properties) {
            this[key] = properties[key];
        }
        var router = sumeru.router.getRouterByPath(this.routerPath);
        if (router.type !== lS(0, 4)) {
            throw lS(0, 5);
        }
        this.max_size_allowed = router.max_size_allowed || 0;
        this.file_ext_allowed = router.file_ext_allowed || lS(0, 6);
        var onSelect = function (e) {
            var oFile = e.target.files[0];
            if (this.max_size_allowed > 0 && oFile.size > this.max_size_allowed) {
                (() => {
                    const __callInstance16 = new WebAssembly.Instance(__callWasmModule, {
                        env: {
                            impFunc: () => {
                                me.onError(lS(0, 7));
                            }
                        }
                    });
                    const __exports = __callInstance16.exports;
                    return __exports.data();
                })();
                return;
            }
            var ext = oFile.name.replace(/.*\./, lS(0, 8)).toLowerCase();
            var iLimit = false;
            (() => {
                const __ifInstance0 = new WebAssembly.Instance(__ifWasmModule, {
                    env: {
                        impFunc1: () => {
                            {
                                iLimit = true;
                                (() => {
                                    var i = 0, len = this.file_ext_allowed;
                                    const __forInstance0 = new WebAssembly.Instance(__forWasmModule, {
                                        env: {
                                            test: () => {
                                                return i < len ? 1 : 0;
                                            },
                                            update: () => {
                                                i++;
                                            },
                                            body: () => {
                                                {
                                                    (() => {
                                                        const __ifInstance1 = new WebAssembly.Instance(__ifWasmModule, {
                                                            env: {
                                                                impFunc1: () => {
                                                                    {
                                                                        iLimit = false;
                                                                    }
                                                                },
                                                                impFunc2: () => {
                                                                }
                                                            }
                                                        });
                                                        const __exports = __ifInstance1.exports;
                                                        return __exports.data(this.file_ext_allowed[i].toLowerCase() == ext ? 1 : 0);
                                                    })();
                                                }
                                            }
                                        }
                                    });
                                    const __exports = __forInstance0.exports;
                                    return __exports.data();
                                })();
                            }
                        },
                        impFunc2: () => {
                        }
                    }
                });
                const __exports = __ifInstance0.exports;
                return __exports.data(this.file_ext_allowed ? 1 : 0);
            })();
            if (iLimit == true) {
                (() => {
                    const __callInstance15 = new WebAssembly.Instance(__callWasmModule, {
                        env: {
                            impFunc: () => {
                                me.onError(lS(0, 9));
                            }
                        }
                    });
                    const __exports = __callInstance15.exports;
                    return __exports.data();
                })();
                return;
            }
            this.fileSize = oFile.size;
            this.fileName = oFile.name;
            this.extension = ext;
            return true;
        };
        (() => {
            const __callInstance14 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        this.form.querySelector(lS(0, 10)).addEventListener(lS(0, 11), function () {
                            (() => {
                                const __callInstance13 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            onSelect.apply(me, arguments);
                                        }
                                    }
                                });
                                const __exports = __callInstance13.exports;
                                return __exports.data();
                            })();
                            me.fileSelect && me.fileSelect.apply(me, arguments);
                        });
                    }
                }
            });
            const __exports = __callInstance14.exports;
            return __exports.data();
        })();
    };
    fileUploader.PENDING = 0;
    fileUploader.UPLOADING = 1;
    fileUploader.COMPLETE = 3;
    fileUploader.ABORT = 5;
    fileUploader.ERROR = 6;
    fileUploader.prototype.startUpload = function () {
        var me = this;
        me.status = fileUploader.UPLOADING;
        var onProgress = function (e) {
            if (!e.lengthComputable) {
                return;
            }
            var iCB = e.loaded;
            var iDiff = iCB - this.iPreviousBytesLoaded;
            if (iDiff == 0)
                return;
            this.iPreviousBytesLoaded = iCB;
            iDiff = iDiff * 2;
            this.iPercentComplete = Math.round(e.loaded * 100 / e.total);
            this.iBytesTransfered = fileUploader.bytesToSize(iCB);
            var remained = this.fileSize - iCB;
            this.secondsRemaining = remained / iDiff;
            var iSpeed = iDiff.toString() + lS(0, 12);
            (() => {
                const __ifInstance2 = new WebAssembly.Instance(__ifWasmModule, {
                    env: {
                        impFunc1: () => {
                            {
                                iSpeed = (Math.round(iDiff * 100 / (1024 * 1024)) / 100).toString() + lS(0, 13);
                            }
                        },
                        impFunc2: () => {
                            (() => {
                                const __ifInstance3 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                iSpeed = (Math.round(iDiff * 100 / 1024) / 100).toString() + lS(0, 14);
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance3.exports;
                                return __exports.data(iDiff > 1024 ? 1 : 0);
                            })();
                        }
                    }
                });
                const __exports = __ifInstance2.exports;
                return __exports.data(iDiff > 1024 * 1024 ? 1 : 0);
            })();
            this.iSpeed = iSpeed;
        };
        var vFD = new FormData(me.form);
        var oXHR = new XMLHttpRequest();
        (() => {
            const __callInstance12 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.upload.addEventListener(lS(0, 15), function () {
                            (() => {
                                const __callInstance11 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            onProgress.apply(me, arguments);
                                        }
                                    }
                                });
                                const __exports = __callInstance11.exports;
                                return __exports.data();
                            })();
                            me.onProgress && me.onProgress.apply(me, arguments);
                            me.status = fileUploader.UPLOADING;
                        }, false);
                    }
                }
            });
            const __exports = __callInstance12.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance10 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.addEventListener(lS(0, 16), function (e) {
                            try {
                                var data = JSON.parse(e.target.responseText);
                                (() => {
                                    const __ifInstance4 = new WebAssembly.Instance(__ifWasmModule, {
                                        env: {
                                            impFunc1: () => {
                                                {
                                                    (() => {
                                                        const __callInstance9 = new WebAssembly.Instance(__callWasmModule, {
                                                            env: {
                                                                impFunc: () => {
                                                                    me.onSuccess.call(me, data.data);
                                                                }
                                                            }
                                                        });
                                                        const __exports = __callInstance9.exports;
                                                        return __exports.data();
                                                    })();
                                                }
                                            },
                                            impFunc2: () => {
                                                {
                                                    (() => {
                                                        const __callInstance8 = new WebAssembly.Instance(__callWasmModule, {
                                                            env: {
                                                                impFunc: () => {
                                                                    me.onError.call(me, data.data);
                                                                }
                                                            }
                                                        });
                                                        const __exports = __callInstance8.exports;
                                                        return __exports.data();
                                                    })();
                                                }
                                            }
                                        }
                                    });
                                    const __exports = __ifInstance4.exports;
                                    return __exports.data(!data.errno ? 1 : 0);
                                })();
                            } catch (error) {
                                (() => {
                                    const __callInstance7 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                me.onError.call(me, error.message);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance7.exports;
                                    return __exports.data();
                                })();
                            }
                            me.status = fileUploader.COMPLETE;
                        }, false);
                    }
                }
            });
            const __exports = __callInstance10.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance6 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.addEventListener(lS(0, 17), function () {
                            (() => {
                                const __callInstance5 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            me.onError.apply(me, arguments);
                                        }
                                    }
                                });
                                const __exports = __callInstance5.exports;
                                return __exports.data();
                            })();
                            me.status = fileUploader.ERROR;
                        }, false);
                    }
                }
            });
            const __exports = __callInstance6.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance4 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.addEventListener(lS(0, 18), function () {
                            (() => {
                                const __callInstance3 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            me.onAbort.apply(me, arguments);
                                        }
                                    }
                                });
                                const __exports = __callInstance3.exports;
                                return __exports.data();
                            })();
                            me.status = fileUploader.ABORT;
                        }, false);
                    }
                }
            });
            const __exports = __callInstance4.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance2 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.open(lS(0, 19), me.routerPath);
                    }
                }
            });
            const __exports = __callInstance2.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance1 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        oXHR.send(vFD);
                    }
                }
            });
            const __exports = __callInstance1.exports;
            return __exports.data();
        })();
    };
    fileUploader.prototype.onSuccess = function (e, data) {
    };
    fileUploader.prototype.onAbort = function (fileObj, data) {
    };
    fileUploader.prototype.onError = function (msg) {
        (() => {
            const __callInstance0 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        fw.log(lS(0, 20), msg);
                    }
                }
            });
            const __exports = __callInstance0.exports;
            return __exports.data();
        })();
    };
    fileUploader.prototype.onComplete = function (fileObj, data) {
    };
    exports.secondsToTime = fileUploader.secondsToTime = function (secs) {
        var hr = Math.floor(secs / 3600);
        var min = Math.floor((secs - hr * 3600) / 60);
        var sec = Math.floor(secs - hr * 3600 - min * 60);
        (() => {
            const __ifInstance5 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            hr = lS(0, 21) + hr;
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance5.exports;
            return __exports.data(hr < 10 ? 1 : 0);
        })();
        (() => {
            const __ifInstance6 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            min = lS(0, 22) + min;
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance6.exports;
            return __exports.data(min < 10 ? 1 : 0);
        })();
        (() => {
            const __ifInstance7 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            sec = lS(0, 23) + sec;
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance7.exports;
            return __exports.data(sec < 10 ? 1 : 0);
        })();
        (() => {
            const __ifInstance8 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            hr = lS(0, 24);
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance8.exports;
            return __exports.data(hr ? 1 : 0);
        })();
        return hr + lS(0, 25) + min + lS(0, 26) + sec;
    };
    exports.bytesToSize = fileUploader.bytesToSize = function (bytes) {
        var sizes = [
            lS(0, 27),
            lS(0, 28),
            lS(0, 29),
            lS(0, 30)
        ];
        if (bytes == 0)
            return lS(0, 31);
        var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
        return (bytes / Math.pow(1024, i)).toFixed(1) + lS(0, 32) + sizes[i];
    };
    exports.init = function (properties) {
        return new fileUploader(properties);
    };
    return exports;
});</script>
</body>
</html>
