<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>event-bus.html</title>
</head>
<body>

<script>
!function(u,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var n=r();for(var e in n)("object"==typeof exports?exports:u)[e]=n[e]}}(this,function(){return function(u){var r={};function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return u[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=u,n.c=r,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},n.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,o){if(1&o&&(e=n(e)),8&o||4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var s in e)n.d(t,s,function(i){return e[i]}.bind(null,s));return t},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.p="",n(n.s=0)}([function(u,r,n){u.exports=n(1)},function(u,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const e=n(2);window.hasOwnProperty("gogEventBus")?console.warn("EventBus is duplicated!"):window.gogEventBus=e.EventBus.instance},function(u,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});class e{constructor(){this.registerWindow(window.parent),window.addEventListener("message",this.parsePostMessage.bind(this))}static get instance(){return e._instance||(e._instance=new this)}publish(t,s,i,a){this.executeSubscribers(t,s,i),"object"==typeof a&&a.hasOwnProperty("crossFrame")&&a.crossFrame&&this.sendPostMessage(t,s,i)}subscribe(t,s,i,a){if(!i)throw Error(`You're trying to subscribe to a channel without subscriber defined! channel: ${t} event: ${s}`);return e.SUBSCRIBERS.hasOwnProperty(t)||(e.SUBSCRIBERS[t]={}),e.SUBSCRIBERS[t].hasOwnProperty(s)||(e.SUBSCRIBERS[t][s]=[]),e.SUBSCRIBERS[t][s].push(i),()=>{const c=e.SUBSCRIBERS[t][s].indexOf(i);e.SUBSCRIBERS[t][s].splice(c,1),0===Object.keys(e.SUBSCRIBERS[t][s]).length&&delete e.SUBSCRIBERS[t][s],0===Object.keys(e.SUBSCRIBERS[t]).length&&delete e.SUBSCRIBERS[t]}}registerWindow(t){if(!(t===window||e.registeredWindows.indexOf(t)>-1))return e.registeredWindows.push(t),()=>{const s=e.registeredWindows.indexOf(t);e.registeredWindows.splice(s,1)}}sendPostMessage(t,s,i){for(const a of e.registeredWindows)"function"==typeof a.postMessage&&a.postMessage({action:"eventBus",data:{channelName:t,eventName:s,eventData:i}},"*")}parsePostMessage(t){"object"==typeof t.data&&null!==t.data&&t.data.hasOwnProperty("action")&&"eventBus"===t.data.action&&this.executeSubscribers(t.data.data.channelName,t.data.data.eventName,t.data.data.eventData)}executeSubscribers(t,s,i){if(e.SUBSCRIBERS.hasOwnProperty(t)&&e.SUBSCRIBERS[t].hasOwnProperty(s))for(const a of e.SUBSCRIBERS[t][s])a(i)}}e.SUBSCRIBERS={},e.registeredWindows=[],r.EventBus=e}])});
</script>

</body>
</html>
