<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>dependencies.min.2f8c381748ae60ad9d9c9227612d0739.html</title>
</head>
<body>
<script>// Get the current CSS Breakpoint: 'MOBILE', 'TABLET', 'DESKTOP'
function getCurrentBreakpoint() {
    var contentValue = window.getComputedStyle(
        document.querySelector('body'), '::before'
    ).getPropertyValue('content');

    return contentValue.replace(/\"/g, '');
}

function setQueryString(name, val) {
    var url = new URL(location.href);
    val && url.searchParams.set(name, val);
    !val && url.searchParams.delete(name);
    history.replaceState(null, null, url.toString());
}
// 判断以什么结尾的字符串
function wordEndWith(word, endStr){  
    var d=word.length-endStr.length;  
    return (d>=0&&word.lastIndexOf(endStr)==d)
}
/*
  *js debounce函数实现
  * @param fn {Function}   实际要执行的函数
  * @param delay {Number}  延迟时间，也就是阈值，单位是毫秒（ms）
  * @return {Function}     返回一个“去弹跳”了的函数
*/
function debounce(fn, delay = 500) {
    // timer 是在闭包中的
    var timer = null;
    
    return function() {
        if (timer) {
            clearTimeout(timer)
        }
        var _this = this
        var _arguments = arguments
        timer = setTimeout(function(){
            fn.apply(_this, _arguments)
            timer = null
        }, delay)
    }
}

  /***
  @handle 要执行的函数
  @time 延时的时间
  ***/
  function throttle(handle, wait) {
    if (typeof handle !== 'function') throw new Error('handle must be an function');
    if (typeof wait === 'undefined') wait = 400;
    var previous = 0; //定义变量记录上一次执行的时间
    var timer = null;
    return function proxy() {
      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
        args[_key2] = arguments[_key2];
      }
      var self = this;
      var now = new Date(); //定义变量记录当前次执行的时间点
      var interval = wait - (now - previous);
      if (interval <= 0) {
        clearTimeout(timer);
        timer = null;
        handle.call.apply(handle, [self].concat(args));
        previous = new Date();
      } else if (!timer) {
        //发现当前系统中有一次定时器，就意味着我们不需要开启定时器  
        //此次操作发生在我们此次定义的时间内，就不应该执行handle
        // 这个时候可以自己定义一个定时器，让handle在 interval之后执行
        timer = setTimeout(function () {
        //  _newArrowCheck(this, this);
          clearTimeout(timer);
          // 这个操作只是将系统中的定时器清除了，但是timer中的还在
          timer = null;
          handle.call.apply(handle, [self].concat(args));
          previous = new Date();
        }.bind(this), interval);
      }
    };
  }
  /***
  ** 全局toast
  @message 提示文案
  @time 显示时间
  @top显示的位置如果不传则显示在页面中间
  ***/
 function showToast(message, time, top){
  if(!$('.toast-wrapper').length){
    var htmlWapper = '<div class="toast-wrapper" style="top: ' + (top ? top + 'px' : '50%') + '"><img src="/etc/clientlibs/it/resources/icons/toast.png"/>'+
    '<span>'+message+'</span></div>'
    $("body").append(htmlWapper) 
    if(time){
     setTimeout(function(){
       $('.toast-wrapper').remove()
     }, time)
    }
  }
 }
(function () {
    var cnLanguages = ['zh-CN', 'zh'];
    var pageLang = $('html').attr('lang');
    var isCN = cnLanguages.indexOf(pageLang) >= 0
    window.isCN=isCN
    window.isCnAnalytics=typeof (ha) != "undefined"
})()
var banner = (function ($) {
  var banner = {};
  banner.init = function (bannerClass) {
    $(document).ready(function () {
      var $bannerCarousel = $(bannerClass + ".carousel");
      for (var i = 0; i < $bannerCarousel.length; i++) {
        var transitionTime = $($bannerCarousel[i]).attr('data-transition-interval');
        var isTransition = $($bannerCarousel[i]).attr('data-auto-transition');
        var $videoPlayBtn = $($bannerCarousel[i]).find(".video-play-btn");
        var $exploreVideoPlayBtn = $($bannerCarousel[i]).find(".explore-video-link");
        var videoplayBtnRight = $('.video-play-btn-right');
        var carouselItemsLength = $($bannerCarousel[i]).find(".carousel-item").length;

        if (carouselItemsLength == 1) {
          $($bannerCarousel[i]).find(".carousel-indicators").hide();
        } else {
          $($bannerCarousel[i]).find(".carousel-indicators").show();
        }

        $videoPlayBtn.click(function () {
          $bannerCarousel.carousel('pause');
        });

        videoplayBtnRight.click(function () {
          $bannerCarousel.carousel('pause');
        });

        $exploreVideoPlayBtn.click(function () {
          $bannerCarousel.carousel('pause');
        });
        if (isTransition == "true") {
          $($bannerCarousel[i]).carousel({
            interval: parseInt(transitionTime)
          });
        } else {
          //pause没有生效
         //  $bannerCarousel.carousel('pause');
          $($bannerCarousel[i]).carousel({
            interval: 0
          });
         // $bannerCarousel.carousel('pause');
        }
      }
      // 移动端滑动流畅度优化
      var isTouch=('ontouchstart' in window);
      if(isTouch){
        $.each($(".carousel-item"), function(){
          $(this).unbind().bind('touchstart', function(e){
            e.stopPropagation();
            var that=$(this);
            var touch = e.originalEvent.changedTouches[0];
            var startX = touch.pageX;
            var startY = touch.pageY;
            $(document).on('touchmove',function(e){
                touch = e.originalEvent.touches[0] ||e.originalEvent.changedTouches[0];
                var endX=touch.pageX - startX;
                var endY=touch.pageY - startY;
                if(Math.abs(endY)<Math.abs(endX)){
                    if(endX > 10){
                        $(this).off('touchmove');
                        that.parent().parent().carousel('prev');
                    }else if (endX < -10){
                        $(this).off('touchmove');
                        that.parent().parent().carousel('next');
                    }
                    return false;
                }
            });
        });
        })
        //定义起始为止的和结束位置变量
       $(document).on('touchend',function(){
           $(this).off('touchmove');
       });
     }
    });
  };

  return banner;
}($));

// banner class for hero-banner/thin-banner
var bannerArray = [".carousel-pc",".new-banner-full", ".hero-banner-full", ".small-banner-full-carousel", ".big-banner-full", ".split-banner-carousel"];
for (var i = 0; i < bannerArray.length; i++) {
  banner.init(bannerArray[i]);
}
// changed z-index for header when modal pops up
$(function () {
  $('.video-play-btn, .video-play-btn-right, .explore-video-link,.subscribe-btn').click(function () {
    $('.header-wrapper').css('z-index', '1');
  });
  $('.modal-header .close').click(function () {
    $('.header-wrapper').css('z-index', '10000');
    $('.carousel').carousel('cycle');
  });
});

// interactive banner组件公共代码
function toggeleVideo ($target) {
    $target.find('.vd-box').each(function () {
        var videoSrc;
        if (getCurrentBreakPoint() === 'MOBILE') {
            videoSrc = $(this).attr('data-mobile-vd');
        } else {
            videoSrc = $(this).attr('data-pc-vd');
        }
        var sourceDom = $("<source src=\"" + videoSrc + "\">");
        $(this).append(sourceDom);
    })
}

function initSwiper($that) {
    var self = $that
    var swiperContainer = $that.find('.swiper-container');
    var mySwiper = new Swiper(swiperContainer, {
        loop: false,
        autoplay: {
            delay: 6000,
            pauseOnMouseEnter: true,
            disableOnInteraction: false,
        },
        //   只有一个时swiper会失效
        watchOverflow: true,
        disableScroll: true,
        //   Swiper不会强制加载所有图片后才初始化
        preloadImages: false,
        noSwiping: getCurrentBreakPoint() !== 'MOBILE',//禁止左右滑动
        observer: true,  //开启动态检查器，监测swiper和slide
        observeParents: true,  //监测Swiper 的祖/父元素
        pagination: {
            clickable: true,
            el: $that.find('.swiper-pagination'),
            bulletElement: 'li',
            renderBullet: function (index, className) {
                return '<div class="' + className + '" data-index="' + index + '"><div class="swiper-carousel-div"><span class="swiper-carousel-span"></span></div></div>';
            },
        },
        on: {
            transitionStart: function () {
                if (isInViewPort($(self).get(0))) {
                    var _self = $(this.$el).find(".swiper-slide-active")
                    var imgSrc = $(_self).find("picture").attr("data-src");
                    var mobImgSrc = $(_self).find("picture").attr("data-mob-src");
                    var imageAltText = $(_self).find(".content-wrapper .text-title").find("pre").html() || 'Banner Image Text';
                    $.each(_self, function (i, e) {
                        $.each($(this).find("source"), function (index, ele) {
                            if (!$(this).attr("srcset")) {
                                $(this).attr("srcset", $(this).attr("data-srcset"))
                            }
                        })
                    })
                    if (!$(_self).find("picture").find("img").length) {
                        if (getCurrentBreakpoint() !== "MOBILE") {
                            if (imgSrc) {
                                $(_self).find("picture").append("<img decoding='async' src='" + imgSrc + "' alt='" + imageAltText + "' /> ")
                            }
                        } else {
                            if (mobImgSrc) {
                                $(_self).find("picture").append("<img decoding='async' src='" + mobImgSrc + "' alt='" + imageAltText + "' /> ")
                            }
                        }
                    }
                }
            },
            slideChangeTransitionStart: function () {
                var swiper = this;
                var activeSlide = swiper.slides[swiper.activeIndex];
                if(activeSlide){
                    var video = activeSlide.querySelector('video');
                    if (video) {
                        // 视频进度条时间设置为0
                        video.currentTime = 0;
                        video.play();
                    }
                }
            }
        },

    })
    //pc端hover暂停轮播
    if (getCurrentBreakPoint() !== 'MOBILE') {
        $that.hover(function () {
            mySwiper.autoplay.stop();
        }, function () {
            mySwiper.autoplay.start();
            $that.find(".swiper-pagination-bullet.swiper-pagination-bullet-active .swiper-carousel-div span").on("animationend", function () {
                mySwiper.slideNext();
            })
        });
    }


    //点击分页埋点
    $that.find('.swiper-pagination-bullet').on('click', function (e) {
        var pagIndex = $(this).attr('data-index');
        var currentSlide = $that.find(`.swiper-slide[data-swiper-slide-index=${pagIndex}]`)
        var atModule;
        if (currentSlide.length > 1) {
            atModule = `interactive_banner::banner_progress::` + $(currentSlide[0]).find('.text-title pre').text();
        } else {
            atModule = `interactive_banner::banner_progress::` + currentSlide.find('.text-title pre').text();
        }
        atModel.doAtEvent(atModule, 'action', e)
    })

}
// muiti-scenario switching组件公共代码
function initMultiScenario($element,clicked){
    var $multiScenarioSwitching = $element
    var isDesktop = getCurrentBreakPoint() == "DESKTOP"
    if($multiScenarioSwitching.length){
        $.each($multiScenarioSwitching, function(){
            var $comp = $(this)
            if(isDesktop && $comp.attr('data-editPage') != 'edit'){
                var $stickyContent = $comp.find('.sticky-content')
                $stickyContent.parent().css('height', $stickyContent.height() + $comp.find('.scenario-tab-item').length * 400 + 100 +"px") 
            }
            var $swiperWraper = $comp.find('.multi-scenario-switching-content')
            var $tabsWrapper = $comp.find('.scenario-tabs-section');
            var multiSwiper = new Swiper($swiperWraper, {
                slidesPerView: 1,
                allowTouchMove: false,
                normalizeSlideIndex: false,
                on: {
                    slideChangeTransitionEnd: function(){ 
                        $(this.$el).find('.plyr__control--overlaid.plyr__control--pressed').click();
                        $(this.$el).find('.swiper-slide').eq(this.activeIndex).find('.plyr__control.plyr__control--overlaid').click();
                    },
                }
            });

            if( $comp.find('.tabs-wapper').outerWidth() < $comp.find('.scenario-tabs-section').outerWidth() ){
              $comp.find('swiper-button-next').hide()
              $comp.find('swiper-button-prev').hide()
            }
            var tabSwiper = null
            tabSwiper = new Swiper($comp.find('.tabs-wapper'), {
                slidesPerView: 'auto',
                allowTouchMove: isDesktop ? false : true,
                navigation: {
                  nextEl: $comp.find('.swiper-button-next'),
                  prevEl: $comp.find('.swiper-button-prev')
                }
            });

            $tabsWrapper.find('.scenario-tab-item').on('click',function(e){
                var index = $(this).index()
                if (isDesktop) {
                    window.scrollTo(0, getPostion($comp.find('.sticky-content').parent(), 'top') +  window.pageYOffset + ((index+ 1) * 350) ) // 高度计算存在问题 这里400修改为320
                }
                tabSlideTo($tabsWrapper,index,multiSwiper)
                var title = $(this).attr('data-at-module');
                atModel.doAtEvent(title, 'action', e);
                // initPosition($(this), tabSwiper)
            })
            // sticky
            onScroll($comp.find('.sticky-content'),multiSwiper,tabSwiper);
            bindEvent($comp);
        })
    }
    // 点击半隐藏tab
    function initPosition(el,tabSwiper) {
      var $item = $(el)
      var itemWidth = $item.outerWidth()
      var $container = $item.parents('.tabs-wapper')
      var containerWidth = $container.outerWidth()
      var isRTL = $('body').hasClass('rtl')
      if($item.offset().left < $container.offset().left + 50 && $item.offset().left + itemWidth > $container.offset().left - 50){
        isRTL ? tabSwiper.slideNext() : tabSwiper.slidePrev()
      }
      if($item.offset().left - 50 < containerWidth + $container.offset().left && $item.offset().left + itemWidth + 50 > containerWidth + $container.offset().left ){
        isRTL ? tabSwiper.slidePrev() : tabSwiper.slideNext()
      }
    }

    function onScroll($comp,multiSwiper,tabSwiper){
        $(window).scroll(function(){
            checkIfSticky($comp.parent(),$comp,$comp.find('.scenario-tabs-section'),multiSwiper,tabSwiper)
        })
    }

    function bindEvent($comp){
        $comp.find('.tabs-content-video').on('click',function(e){
            e.stopPropagation()
        })
        $comp.find('.switching-video-button').find('span').on('click',function(e){
            e.stopPropagation()
            bindVideoClick($comp)
            $(this).parents(".tabs-content-container").find('.plyr__control.plyr__control--overlaid').click();
        })
        $comp.find('.tabs-content-container').on('click',function(e){
            var aHref =$(this).attr('data-href')
            if(aHref){
                var target = aHref.indexOf('http') === -1 ? '_self' : '_blank';
                var title = 'Multi_scenario_switching_components::'+ lastNode(aHref) + atModel.atSpliter + window.location.href; 
                atModel.doAtEvent(title, 'navigation', e);
                window.open(aHref, target)
            }
        })
    }

    function bindVideoClick($comp){
        var video = $comp.find('video')
        if(video.length){
            $.each(video,function(){
                $(this).on('play',function(){
                    $(this).parents('.tabs-content-container').addClass('play').removeClass('pause').removeClass('ended')
                })
                $(this).on('pause',function(){
                    $(this).parents('.tabs-content-container').addClass('pause').removeClass('play').removeClass('ended')
                })
                $(this).on('ended',function(){
                    $(this).parents('.tabs-content-container').addClass('ended').removeClass('play').removeClass('pause')
                })
            })
        }
    }
    var timer = setInterval(function () {
        if($multiScenarioSwitching.length){
            $.each($multiScenarioSwitching, function(){
                var $comp = $(this)
                if(document.readyState == 'complete'){
                    bindVideoClick($comp);
                    clearInterval(timer)
                } 
            })
        }
    }, 1000)

    function tabSlideTo($tab,index,multiSwiper){
        $tab.find('.scenario-tab-item').eq(index).addClass('active').siblings().removeClass('active')
        multiSwiper.slideTo(index,500)
    }

    function checkIfSticky($pageWapper,$compContent,$tabsWrapper,multiSwiper,tabSwiper){
        if (!$pageWapper.length) return;
        if (getCurrentBreakpoint() != 'DESKTOP') return
        
        if (getPostion($pageWapper, 'top') < 0) {
            var listBtmTop = getPostion($pageWapper, 'top') + getPostion($pageWapper, 'height');
            if (listBtmTop - $compContent.outerHeight() > 0) {
                $compContent.css('top', 0);
                var num = $tabsWrapper.find('.scenario-tab-item').length
                var scrollSlide = (getPostion($pageWapper, 'height') - getPostion($compContent, 'height')) / num
                var index = parseInt(($(window).scrollTop() - $pageWapper.offset().top ) / scrollSlide) 
                tabSlideTo($tabsWrapper,index,multiSwiper)
                initPosition($tabsWrapper.find('.scenario-tab-item').eq(index),tabSwiper)     
            } else {
                $compContent.css('top', listBtmTop - $compContent.outerHeight());
            }
            stickyFilterList(true,$pageWapper,$compContent)
        } else {
            stickyFilterList(false,$pageWapper,$compContent)
        }
    }

    function getPostion($ele, pos) {
        if (!$ele || $ele.length === 0)
            return;
        return $ele[0].getBoundingClientRect()[pos];
    }

    function stickyFilterList(isSticky,$pageWapper,$compContent) {
        if (isSticky) {
            $pageWapper.addClass('sticky');
        } else {
            $pageWapper.removeClass('sticky');
            $compContent.css('top', '');
        }
    }
    $(window).scroll()
}

// mobile端公共的点击滑动定位效果
// parentElemnt 需要滑动的元素
// element totalLisWidth滑动长度计算的元素
function initMobileSlidePosition(parentElemnt, element, index){
    if(getCurrentBreakPoint()!= 'DESKTOP'){
        if (index >= 3) {
            $(parentElemnt).animate({
                "scrollLeft": $("body").hasClass("rtl") ? -totalLisWidth($(this).parent().parent(),index) : totalLisWidth($(this).parent().parent(),index)
            }, 500)
        } else {
            $(this).parent().parent().parent().animate({
                "scrollLeft": 0
            }, 500)
        }
    }
}
//计算需要滚动的距离
function totalScrollGap(element, index) {
    var totals = 0
    $.each($(element).children(), function (i, ele) {
        if (i < index - 1) {
            totals += $(this).width() 
        }
    })
    return totals - $(window).width()/5.769230769230769
}
// 计算所有子元素的宽度合
function totalChildrenWidth(element){
    var totals = 0
    $.each($(element).children(), function (i, ele) {
        totals += $(this).width() 
    })
    return totals
}
//全局tab mobile端滑动处理
function initHandleMobileScroll(elem, parentNode){
    if(getCurrentBreakPoint()!= 'DESKTOP'){
        var rect = $(elem).get(0).getBoundingClientRect();
        // 计算元素中心点的x坐标
        var elementCenterX = rect.left + rect.width / 2;
        // 获取视口的宽度
         // 获取当前页面的水平滚动位置
        var currentScrollLeft = parentNode.get(0).pageXOffset || parentNode.get(0).scrollLeft;

        // 获取视口的宽度
        var viewportWidth = document.documentElement.clientWidth || window.innerWidth;

        // 计算滚动到元素中心所需的水平偏移量
        // 同时考虑当前页面的水平滚动位置
        var scrollLeft = elementCenterX - viewportWidth / 2 + currentScrollLeft;
        // 滚动到水平中间位置
        $(parentNode).get(0).scrollTo({
         left: scrollLeft,
          behavior: 'smooth' // 平滑滚动
        });
    }
}
//获取文件后缀名
function getFileExtension(filename) {
     // 检查是否存在文件名
    if (!filename) {
         return '';
     }
    // 查找最后一个点的位置
    var lastIndex = filename.lastIndexOf('.');
    // 如果找到了点，返回点之后的子字符串，否则返回空字符串
     return lastIndex < 0 ? '' : filename.substring(lastIndex + 1);
}
// 处理youtube视频
function convertToEmbedUrl(youtubeUrl) {
    // 正则表达式匹配YouTube视频页面URL（长链接）
    var regexLong = /^https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([^&]+)/;
    // 正则表达式匹配YouTube视频短链接（短链接）
    var regexShort = /^https?:\/\/youtu\.be\/([a-zA-Z0-9_-]+)/;

    var matchLong = youtubeUrl.match(regexLong);
    var matchShort = youtubeUrl.match(regexShort);

    var videoId;
    if (matchLong && matchLong[1]) {
        // 使用长链接中的视频ID
        videoId = matchLong[1];
    } else if (matchShort && matchShort[1]) {
        // 使用短链接中的视频ID
        videoId = matchShort[1];
    } else {
        return null; // 或者抛出错误，或者返回原始URL
    }

    // 构建嵌入URL
    var embedUrl = 'https://www.youtube-nocookie.com/embed/' + videoId;
    return embedUrl;
}
// 视频弹窗根据是本地视频还是youtube视频做判断使用iframe还是video
function initVideoModal(video, isYoutube) {
    var videoWarpper;
    var player;
    var placeholderSrc = '/etc/clientlibs/it/resources/images/video-bg.jpg'; // 占位图路径
    if (isYoutube) {
        videoWarpper = $('<div class="modal-stream-video"><div class="video-stream-container">><img src="' + placeholderSrc + '" class="video-placeholder"/><iframe id="videoPlayer" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>');
        $('body').append(videoWarpper);
        $(videoWarpper).find('.video-stream-container').append('<svg class="icon svg-icon close-video" aria-hidden="true"><use xlink:href="#icon-guanbi"></use> </svg>') 
       // 延迟加载YouTube视频，减少初始加载时间
        setTimeout(function() {
            player = $('#videoPlayer');
            player.attr('src', convertToEmbedUrl(video) + '?autoplay=1');
        }, 100); // 延迟时间可以根据实际情况调整
    } else {
        videoWarpper = $('<div class="modal-stream-video"><div class="video-stream-container"><video autoplay controls preload="auto"><source src="' + video + '" type="video/mp4"></source></video><svg class="icon svg-icon close-video" aria-hidden="true"><use xlink:href="#icon-guanbi"></use> </svg></div></div>');
        $('body').append(videoWarpper);
    }

    // 显示视频容器
    videoWarpper.fadeIn();

    $('.close-video').on('click', function() {
        $(this).parent().parent().remove();
        if (window.$checkedVideo) {
            window.$checkedVideo.trigger('click');
        }
        if($('html').hasClass('overflow-prevent')){
            $('html').removeClass('overflow-prevent')
        }
    });

    // 视频加载完成后移除占位图和加载遮罩
    if (player) {
        player.on('load', function() {
            $('.video-placeholder').remove();
        });
    }
}
//This is for Interactive Map

$(document).ready(function() {
    var intractiveMapText = document.querySelector('.pin-details .description');
    if(!intractiveMapText){
        return ;
    }
    $clamp(intractiveMapText, {
        clamp : 8
    });

    var intractiveMapTitleText = document.querySelector('.pin-title-cont .pin-title');
    $clamp(intractiveMapTitleText, {
        clamp : 2
    });

    //ellipses for Arabic(starts).stories-carousel-wrapper .stories__image-container-parent .stories__image-info--success-stories
		var classString = [".rtl .split-banner-content__header, .rtl .split-banner-content__subheader, .rtl .split-banner-content__item-detail",".rtl .newsroom__image-info--camera-type, .rtl .newsroom__image-info--availibility,.rtl .newsroom__image-info--camera-type, .rtl .newsroom-mobile-view__image-info--camara-type,.rtl .newsroom__image-info--availibility, .rtl .newsroom-mobile-view__image-info--availibility",".rtl .stories-carousel-wrapper .stories__image-container-parent .stories__image-info--heading ,.rtl .stories__image-info--success-stories"];
    	for(var i=0; i<classString.length; i++){
   			$(classString[i]).each(function(key , value){
                var storedHTMLvalue = value;
                var dot = new Dotdotdot( storedHTMLvalue, {watch:true});
                var api = dot.API;
                if(value.innerText=="... "){
                api.restore();
                dot ={};
                }
          })
        }
    //ellipses for Arabic(ends)
});

function isFunction(obj) {
    // Support: Chrome <=57, Firefox <=52
    // In some browsers, typeof returns "function" for HTML <object> elements
    // (i.e., `typeof document.createElement( "object" ) === "function"`).
    // We don't want to classify *any* DOM node as a function.
    return typeof obj === "function" && typeof obj.nodeType !== "number";
}
/***
 * 判断一段字符串中间是否有空格
*/
function hasSpaces(str) {
  return /\s+/g.test(str);
}
/**
 * for cn stlye improve
 */
var cnCssSettings = function () {
    var cnCss = '<link rel="stylesheet" type="text/css" href="/etc/clientlibs/it/resources/css/cn.css">';
    var cnLanguages = ['zh-CN', 'zh'];

    var pageLang = $('html').attr('lang');
    if (cnLanguages.indexOf(pageLang) >= 0) {
        $('head').append(cnCss);
    }
};
/**
 * page background
 */
var backgroundSttings = function () {
     var bgUrl = $('body').attr(window.innerWidth > 768 ? 'data-bg' : 'data-bg-mobile')
     bgUrl ? $('body').css('background','url('+bgUrl+') no-repeat center/cover') : false ;
};
/**
 * img标签做lazyload处理
 * **/
var imgTagLazyLoad = function () {
    var $imageTag = $('.lazy-image')
    $.each($imageTag, function (i, t) {
        var dataSrc = $(this).data('src')
        $(this).attr('src', dataSrc)
    })
}
/**
 * for image lazy load
 */
var imageLazyLoad = function () {

    var invokeLazyLoad = function (container) {
        var $container = $(container);
        if ($container.visible(true)) {
            // add proper delay to wait the dom loading
            setTimeout(function () {
                $container.find('.lazy').lazyload();
            }, 300);
        }
    };

    /**
     * replace css background image
     * @param imageElement
     * @param keepOriginal
     */
    var replaceOriginal = function (imageElement, keepOriginal) {
        var $item = $(imageElement);
        var originalImage;
        if (window.innerWidth > 768) {
            originalImage = $item.data('original');
        } else {
            originalImage = $item.data('original-mobile');
            if (!originalImage) {
                originalImage = $item.data('original');
            }
         }
        if ($item.is('div') || $item.is('article')) {
            if(!isNull(originalImage)) {
                $item.css('background-image', 'url("' + originalImage + '")');
            }
        } else if ($item.is('img')) {
            $item.attr('src', originalImage);
        }
        if (false) {
            $item.data('original', '');
            $item.removeAttr('data-original');
            $item.data('original-mobile', '');
            $item.removeAttr('data-original-mobile');
        }
    };
    /**
     * lazy load carousel background
     * @param carousel
     * @param item
     */
    var replaceCarouselImageSrc = function (carousel, item) {
        var $item = $(item);
        if($(item).hasClass("webp")){
            replaceWebpOriginal(item);
        } else {
            replaceOriginal(item);
        }
        var nestedElements = $item.find('[data-original]');
        $.each(nestedElements, function (index, element) {
            replaceCarouselImageSrc(carousel, element);
        });
    };

    /**
     * lazy load image by lazyload.js
     * @param container
     */
    var lazyloadBackground = function (container) {
        if (container) {
            $(container).find('.lazy[data-original]').lazyload();
        }
    };
    // 全局的modalUi样式
    var modalUi = function (isSure) {
        // + isSure ? '<div class="card-bottom card-x"><span class="card-bottom-btn">'+Granite.I18n.get('Sure')+'</span></div>' : null+
        if (!$('.form-popup').length) {
            var modalDiv = '<div class="form-popup"><div class="popup-wrap"><div class="popup-card"><div class="card-top">' +
                '<img src="/etc/clientlibs/it/resources/images/jingshi.png" alt=""> <span>' + Granite.I18n.get('Reminder') + ':</span></div>' +
                '<div class="card-middle"></div>' +
                '</div><span class="card-x card-close">x</span></div></div>'
            $("body").append(modalDiv)
        }
    }
    var hideModel = function () {
        var pupop = $('.form-popup')
        var btnClose = pupop.find('.card-x')
        btnClose.click(function () {
            pupop.hide()
        })
    }
    // 全局的loading样式
    var loadingUI = function () {
        if (!$('.loading-wrap').length) {
            var isHilookSite = $('body').hasClass('hilook-page')
            var loadingDiv = '<div class="loading-wrap"><div class="loading-box"><img src="/etc/clientlibs/it/resources/images/loading.gif"/></div></div>'
            var hilookLoadingDiv = '<div class="loading-wrap"><div class="loading-box"><img src="/etc/clientlibs/it/resources/icons/hilook-loading.gif"/></div></div>'
            $("body").append(isHilookSite ? hilookLoadingDiv : loadingDiv)
        }
    }
    // Only For Banner Carousels without class `lazy-carousel` .new-banner-full
    var $bannerCarousels = $('.banner-carousel,.thin-banner-carousel .carousel,.new-banner-full');
    var $lazyLoadContainer;
    $(document).ready(function () {
        $(window).on('scroll', function () {
           webpLazyload();
            scrollElementSetBackground();
        })
        var $banners = $('.new-split-banner-container').find('.lazy-banner')
        $.each($banners, function (index, item) {
            var $item = $(item);
            var originalImage;
            if (window.innerWidth > 768) {
                originalImage = $item.data('original');
            } else {
                originalImage = $item.data('original-mobile');
                if (!originalImage) {
                    originalImage = $item.data('original');
                }
            }
            $item.css("background-image", "url('" + originalImage + "')");
        })
        // static image lazy load
        // https://appelsiini.net/projects/lazyload/v1/
        $.each($('.rich-text p, .cmp-text p'), function (index, item) {
            if (($(item).text().trim() == '' || $(item).text().trim() == '&nbsp;') && !$(item).find('img').length) {
                $(item).css({
                    padding: '0px',
                    height: '16px',
                    marginBottom: '0px'
                })
            }
        })
        // 设置更小的图片
       $.each($(".lazy"), function(){
        if(!isCN){
            var thumbImage = $(this).data("original")
            if(thumbImage&&thumbImage.indexOf("thumb")> -1){
                if($(this).hasClass("number-image")){
                    $(this).attr("data-original", thumbImage.replace("thumb.1280.1280", "thumb.48.48"))
                } else {
                    if(getCurrentBreakPoint() != "MOBILE" ){
                        if($(this).hasClass("related-accessories-img") || $(this).hasClass("layout4__image")){
                            $(this).attr("data-original", thumbImage.replace("thumb.319.319", "thumb.140.100"))
                        } else {
                          //  $(this).attr("data-original", thumbImage.replace("thumb.1280.1280", "thumb.319.319"))
                        }
                       } else {
                        if($(this).hasClass("related-accessories-img") || $(this).hasClass("layout4__image")){
                            $(this).attr("data-original", thumbImage.replace("thumb.319.319", "thumb.48.48"))
                        } else if($(this).hasClass("img-fluid")){
                            $(this).attr("data-original", thumbImage.replace("thumb.319.319", "thumb.140.100"))
                        }else {
                            $(this).attr("data-original", thumbImage.replace("thumb.1280.1280", "thumb.319.319"))
                        }
                    }
                }
             }
        }
         $(this).lazyload({
            threshold: 300,
            vertical_only: true,
        });
       })

        // carousel image lazy load
        var $activeItems = $bannerCarousels.find('.carousel-item.active');
        $.each($activeItems, function (index, element) {
            if(!$(this).hasClass("webp-lazy")){
                replaceCarouselImageSrc($(element).parents('.carousel'), element);
            }
        });
        $bannerCarousels.on('slide.bs.carousel', function (e) {
            if(!$(e.relatedTarget).hasClass("webp-lazy")){
                replaceCarouselImageSrc(this, e.relatedTarget);
            }
        });

        // Bootstrap Carousel
        // https://getbootstrap.com/docs/4.4/components/carousel/#events
        var $lazyCarousels = $('.lazy-carousel');
        $lazyCarousels.on('slid.bs.carousel', function () {
            invokeLazyLoad(this);
        });

        // jQuery Cycle2
        // http://jquery.malsup.com/cycle2/api/
        var $lazyCycles = $('.lazy-cycle');
        $lazyCycles.on('cycle-after', function () {
            invokeLazyLoad(this);
        });

        // Slick
        // https://kenwheeler.github.io/slick/
        var $lazySlicks = $('.lazy-slick');
        $lazySlicks.on('afterChange', function () {
            invokeLazyLoad(this);
        });

        if ($lazyLoadContainer) {
            $.each($lazyLoadContainer, function (index, element) {
                lazyloadBackground(element);
            });
        }
        modalUi()
        // 全局的提示框关闭事件处理
        hideModel()
        // 全局的loading
        loadingUI()
        $.each($('.footer-body a, #header a, .quick-access-wrapper a, .cpp-data-wrapper a ,.document-download a'),function(){
            var link = $(this).attr('href') || $(this).attr('data-href')
            if(link && link.indexOf("http") > -1 && link.indexOf(window.location.host) < 0){
                $(this).attr('rel','noreferer,noopener,nofollow')
            }
        })
    });
};

var xssFilter = (function ($) {
    var filter = {};
    filter.flag = true;
    filter.doXssFilter = function (value) {
        // var reg = /[\@\_\!\|\~\`\%\+\=\/\$\%\^\&\*\{\}\:\;\"\<\>\?\\\(\)\uff1f\uff01\uff1a\uff08\uff09]/g;
        var regStr = "[@_!|~`%+=/$%^&*{}:;\"\\<>?()\uff1f\uff01\uff1a\uff08\uff09]";
        var $this = $(event.currentTarget);
        var exclude = $this.attr("data-exclude");
        if (!isNull(exclude)) {
            regStr = regStr.replace(exclude, "");
        }
        var reg = new RegExp(regStr);
        return value.replaceAll(reg, '');
    };
    filter.init = function () {
        $('.xss-value').on('compositionstart', function () {
            filter.flag = false;
        }).on('compositionend', function () {
            filter.flag = true;
        }).on('input', function () {
            if (filter.flag == true) {
                $(this).val(filter.doXssFilter($(this).val()));
            }
        });
        $('.xss-email').rules('add', {
            regex: /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/,
            messages: {
                regex: Granite.I18n.get("Please enter valid email address")
            }
        });
        $('.xss-phone').rules('add', {
            regex: /^1(3|4|5|6|7|8|9)\d{9}$/,
            messages: {
                regex: Granite.I18n.get("Please enter valid phone")
            }
        });
        $('.xss-number').attr("oninput", "value=value.replace(/[^\\d]/g,'')");

        // $('.xss-html').on('input', function () {
        //   $(this).html(filter.doXssFilter($(this).html()));
        // });
        // $('.xss-text').on('input', function () {
        //   $(this).text(filter.doXssFilter($(this).text()));
        // });
    };
    return filter;
}($));

var globalSettings = (function ($) {
    var settings = {};

    settings.init = function () {
        cnCssSettings();
        backgroundSttings();
        imageLazyLoad();
        webpLazyload();
        scrollElementSetBackground()
        $('span.ssolink,a.ssolink').click(function (e) {
            e.preventDefault()
            var selfHref = $(this).attr('href')
            var selfTarget = $(this).attr('target')
            setLoginCookie("redirectUrl", window.location.href);
            newWinOpen(selfHref + '&referrer=' + window.location.href, selfTarget)
            // window.open(selfHref + '&referrer='+window.location.href,selfTarget)
        })
        $('.banner-link').attr('href', 'www.hikivision.com')
        $.each($("a"), function(){
            var currentHref = $(this).attr("href") || $(this).attr("data-href") || $(this).attr("data-link") || $(this).attr("data-url")
            if($(this).hasClass("hik-video-trigger")){
                currentHref = $(this).attr("data-video-path")
            }
            if(currentHref && currentHref.indexOf("http") > -1 && currentHref.indexOf(window.location.host) < 0){
                $(this).attr("rel", "nofollow")
            }
       })
    };

    return settings;
})($);
// 使用a标签新窗口打开，避免chorme出现弹窗拦截
var newWinOpen = function (link, target) {
    var _target = target || '_self'
    var el = document.createElement("a");
    document.body.appendChild(el);
    el.href = link; //url 是你得到的连接
    el.target = _target; //指定在新窗口打开
    el.click();
    document.body.removeChild(el);
}
    /**
     * 背景图片替换成webp图片
     * @param imageElement
     * @param keepOriginal
     */
    var replaceWebpOriginal = function (imageElement, keepOriginal) {
        var $item = $(imageElement);
        var originalImage;
        if (window.innerWidth > 768) {
          originalImage = $item.data('original');
        } else {
           originalImage = $item.data('original-mobile');
            if (!originalImage) {
              originalImage = $item.data('original');
            }
         }
         if ($item.is('div') || $item.is('article')) {
            $item.css('background-image', 'url("' + originalImage +'?f=webp' + '")');
        } else if ($item.is('img')) {
            $item.attr('src', originalImage);
        }
        if (false) {
            $item.data('original', '');
            $item.removeAttr('data-original');
            $item.data('original-mobile', '');
            $item.removeAttr('data-original-mobile');
        }
    };   
// 处理到元素滚动到可是区域内在设置背景图
var scrollElementSetBackground = function () {
    var $lazyItem = $('.scroll-lazy-image')
    setTimeout(function(){
        $.each($lazyItem, function (i, t) {
            var thisBackgImage = $(this).data('original-mobile') ? $(this).data('original-mobile') : $(this).data('original')
            if (isInViewPort($(this).get(0))) {
                if($(this).hasClass("webp")){
                    replaceWebpOriginal(this);
                } else {
                   if (($(this).is('div') || $(this).is('a'))) {
                        if (window.innerWidth > 768) {
                            $(this).css('background-image', 'url("' + $(this).data('original') + '")');
                        } else {
                            $(this).css('background-image', 'url("' + thisBackgImage + '")');
                        }
                    } else if ($(this).is('img')) {
                        if(!$(this).attr('src')){
                            if (window.innerWidth > 768) {
                                $(this).attr('src', $(this).data('original'));
                            } else {
                                $(this).attr('src', thisBackgImage);
                            }
                        }
                    }
                }
            }
        })
    }, 200)
    var firmwareItem = $('.firmware, .firmware-series')
    $.each(firmwareItem, function (i, t) {
        if (isInViewPort($(this).get(0))) {
            $(this).addClass('scroll')
        }
    })
}
var accountLocation = (function ($) {
    var location = {};

    // 根据当前登录的ip给出对应的站点跳转提示
    location.init = function (data) {
        if (data) {
            var locationJson = data;
            var cookieName = 'ip_expired';
            if (locationJson.website) {
                setTimeout(function () {
                    var defaultDisplatName = Granite.I18n.get('Global');
                    location.ipUIDialog(locationJson.name, locationJson.website, locationJson.displayName ?? defaultDisplatName);
                    var config = {
                        name: cookieName,
                        value: locationJson.name,
                        expirationDays: 1,
                        path: '/'
                    };
                    storeManager.cookie.set(config, true, false);
                }, 6000)
            } else {
                var config = {
                    name: cookieName,
                    value: "",
                    expirationDays: 1,
                    path: '/'
                };
                storeManager.cookie.set(config, true, false);
            }
        }
    };
    // 处理a标签download的兼容性 需要给下载的a标签添加class名a-download-href
    // $('.a-download-href').on('click', function(e){
    //     e.preventDefault();
    //     e.stopPropagation();
    //     console.log('navigator.msSaveBlob', navigator.msSaveBlob)
    //     if(navigator.msSaveBlob) {
    //         download($(this).attr('href'))
    //     } else {
    //      $(this).attr('download')
    //      $(this).click()
    //     }
    // })
    location.ipUIDialog = function (locationSite, website, currentSite) {
        //You are visiting Hikvision Global English site.Recommand to visit our
        var currentSiteI18n = Granite.I18n.get('You are visiting the Hikvision');
        var site = Granite.I18n.get('site');
        var redirectI18n = Granite.I18n.get('Click here to visit the Hikvision');

        var currentSite = currentSiteI18n + " " + currentSite + " " + site + ". ";
        var siteUrlNodes = website.split('/')
        var lastNode = siteUrlNodes.pop()
        if (!lastNode) {
            lastNode = siteUrlNodes.pop()
        }
        var currentUrl = window.location.href
        var atModuleInfo = 'site_redirect::' + locationSite + '::' + lastNode + '::' + currentUrl;
        var html = "<div class='ip-wrap'>" +
            "<div class='ip-box'>" +
            "<p>" + currentSite + "</p>" +
            "<p>" + redirectI18n + " <a class='at-navigation' data-at-module='" + atModuleInfo + "' href='" + website + "' style='color:red;font-weight:bold'>" + locationSite + " <a style='position:relative;top:1px;left:5px;color:red'>></a></a></p>" +
            "<span class='cha at-action' data-at-module='" + website + "::close'></span></div>" +
            "</div>";
        $('body').append(html);
        $('.cha').on('click', function (e) {
            $('.ip-wrap').remove()
            atModel.doAtEvent('site_redirect::close::' + currentUrl, 'action', e);
        })
        var $link = $('.ip-wrap .ip-box a.at-navigation')
        setJumpEventForBuryPointNode($link, website, atModuleInfo)
    };
    // location.ipUIDialog('中文站', 'https://www.baidu.com', '中文站')
    return location;
}($));

// 判断是否在可视区域
function isInViewPort(element) {
    var viewWidth = window.innerWidth || document.documentElement.clientWidth;
    var viewHeight =
          window.innerHeight || document.documentElement.clientHeight;
    var top = element.getBoundingClientRect().top
    var right = element.getBoundingClientRect().right
    var bottom = element.getBoundingClientRect().bottom
    var left = element.getBoundingClientRect().left
    if(top>=viewHeight){ //判断元素是否在可视区域内,可视区域内则直接显示
        return top >= 0 && left >= 0 && right <= viewWidth && bottom <= viewHeight;
    } else {
      return true;  
    }
}
//判断网站语言类型
function JudgeWebLanguage(name) {
    var reg = eval("/" + name + "/g");
    var r = window.location.pathname.substr(1);
    var flag = reg.test(r);
    if (flag) {
        return true;
    } else {
        return false;
    }
}

// 当前页面做跳转时，需要加一个延时，否则埋点有概率埋不上
function setJumpEventForBuryPointNode($node, url, buryInfo) {
    var timeout = 1000
    $node.on('click', function (e) {
        e.preventDefault()
        if (buryInfo) {
            atModel.doAtEvent(buryInfo, 'navigation', e);
        }
        setTimeout(function () {
            location.href = url
            // var title = atModel.getTitle(event.currentTarget);
        }, timeout)
    })
}
// webp图片懒加载
function webpLazyload(click,parentElementElement){
    $.each($(".swiper-container,.lazy-carousel"), function(){
        var self = this
        setTimeout(function(){
                if (isInViewPort($(self).get(0))) {
                    $(self).find(".swiper-wrapper").find(".swiper-slide").find("picture").show()
                    $.each($(self).find(".swiper-wrapper").find(".swiper-slide").find("picture").find("source"), function(){
                        if(!$(self).attr("srcset")){
                            $(self).attr("srcset", $(self).attr("data-srcset"))
                        }
                    })
                    if($(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").length){
                        var imgSrc = $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture").attr("data-src")
                        var mobImgSrc =  $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture").attr("data-mob-src")
                        if(getCurrentBreakpoint()!== "MOBILE"){
                            // if(click&&!$(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture img").length && $(parentElementElement).html() === $(this).html()){
                            //     $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture").append("<img src="+imgSrc+"/>")
                            // }
                           if(hasSpaces(imgSrc)){
                            $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture img").attr("src", imgSrc)   
                           } 
                        } else {
                            // if(click&&!$(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture img").length&&$(parentElementElement).html() === $(this).html()){
                            //     $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture").append("<img src="+mobImgSrc+"/>")
                            // }
                          if(hasSpaces(mobImgSrc)){
                            $(self).find(".swiper-wrapper").find(".swiper-slide.first-slide").find("picture img").attr("src", mobImgSrc)
                           } 
                        }
                       // console.log('imgSrc', , hasSpaces(mobImgSrc))
                    }
                    if(!$(self).find(".swiper-wrapper").find(".swiper-slide").find("picture").find("img").length){
                        var imgSrc =  $(self).find(".swiper-wrapper").find(".swiper-slide.swiper-slide-active").find("picture").attr("data-src")
                        var mobImgSrc =  $(self).find(".swiper-wrapper").find(".swiper-slide.swiper-slide-active").find("picture").attr("data-mob-src")
                        var imageAltText = $(self).find(".swiper-wrapper").find(".swiper-slide").find("picture").attr("data-iamge-alt") || $(self).find(".banner-info-wrapper .title").find("pre").html() ||$(".prod_name-content").text() || 'Banner Image Text'
                        var srcset =  mobImgSrc + ' 991w,' + imgSrc + ' 1600w'
                        if(getCurrentBreakpoint()!== "MOBILE"){
                          $(self).find(".swiper-wrapper").find(".swiper-slide.swiper-slide-active").find("picture").append("<img decoding='async' src='"+imgSrc+"' alt='"+imageAltText+"' /> ")
                        }else{
                           $(self).find(".swiper-wrapper").find(".swiper-slide.swiper-slide-active").find("picture").append("<img decoding='async' src='"+mobImgSrc+"' alt='"+imageAltText+"' /> ")
                        }
                    }
                }
        }, 200)
         
    })
}
//修改指定模板 image video 组件默认宽度
(function getPageTemplate(){
        var pageTemplate =$('meta[name="template"]').attr('content')
        var templateArry=['success-story-page','news-page','event-page']
        if(templateArry.indexOf(pageTemplate) > -1 && window.innerWidth >= 992){
            $('.hiknow-video.aem-GridColumn:not(.aem-GridColumn--default--none)')
            .css("cssText","width:50% !important;margin:0 auto;padding:0 0px;box-sizing:border-box;float:none !important");
        }
        if(templateArry.indexOf(pageTemplate) > -1 && window.innerWidth < 992){
         $('.hiknow-video.aem-GridColumn:not(.aem-GridColumn--default--none)')
         .css("cssText","width:100% !important;padding:0 15px;")
        }
        if(templateArry.indexOf(pageTemplate) > -1){
            $('.rte').addClass('rte-width-80');
            $('.image').addClass('default-width-6C');
            $('.image.fixed-width-container').first().addClass('first-image')
        }
})()

function generateUUID() {
    var d = new Date().getTime();
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
}

function generateClientId() {
    var clientId = storeManager.cookie.get("clientId");
    if (!clientId) {
        clientId = generateUUID();
        storeManager.cookie.set({
            name: "clientId",
            value: clientId,
            path: '/',
            expirationDays: 0.5
        }, true);
    }
    return clientId;
}

/**
 * find by attribute
 * @param $parent parent
 * @param target target name
 * @param name attr name
 * @param value attr value
 * @returns {*}
 */
function findByAttr($parent, target, name, value) {
    var selector;
    if (!Array.isArray(value)) {
        selector = target + '[' + name + '="' + value + '"]';
        return $parent.find(selector)
    } else {
        selector = value.map(function (item) {
            return target + '[' + name + '="' + item + '"]';
        });
        return $parent.find(selector.join(','))
    }
}

if (JudgeWebLanguage('cn')) {
    $('.hiknow-rte a,.card-gallery a, .rte p a').addClass("ret-a-colorDown");
    $('.hiknow-rte a,.card-gallery a, .rte p a').hover(function () {
        $(this).addClass("ret-a-colorUp")
        // $(this).css({"color":"#D7150E","text-decoration": "underline"});
    }, function () {
        // $(this).css({"color":"#333333","text-decoration": "none"});
        $(this).addClass("ret-a-colorDown").removeClass("ret-a-colorUp");
    });
    $('.description-wrapper').find('h1').addClass('cn-h1')
    $('.description-wrapper').find('h2').addClass('cn-h2')
    $('.description-wrapper').find('h3').addClass('cn-h3')
    $('.description-wrapper').find('h4').addClass('cn-h4')
    $('.rte').find('h4').addClass('cn-h4')
}
globalSettings.init();

var getParameterArr = function (parameterStr) {
    var paramsTempArray = parameterStr.split('&');
    var params = {};

    for (var i = 0; i < paramsTempArray.length; i++) {
        var param = paramsTempArray[i].split('=');
        params[param[0]] = param[1];
    }
    return params;
}

function setLoginCookie(cname, cvalue) {
    //Session cookie
    var domain = storeManager.hikvision_domain;
    if (window.location.hostname.indexOf(storeManager.hikvision_domain) < 0) {
        domain =  window.location.hostname;
    }
    document.cookie = cname + "=" + cvalue + ";path=/;domain=" + domain;
}

function setSubmittedPageUrlCookie(cname) {
    var cvalue = window.location.href;
    setLoginCookie(cname, cvalue);
}

var getLoginCookie = function (name) {
    var reg = /\s/g;
    var result = document.cookie.replace(reg, "");
    var resultArr = result.split(";");
    for (var i = 0; i < resultArr.length; i++) {
        var nameArr = resultArr[i].split("=");
        if (nameArr[0] == name) {
            return nameArr[1];
        }
    }
}

var removeLoginCookie = function (name) {
    var oDate = new Date();
    oDate.setDate(new Date().getDate() - 1);
    var domain = storeManager.hikvision_domain;
    if (window.location.hostname.indexOf(storeManager.hikvision_domain) < 0) {
        domain =  window.location.hostname;
    }
    document.cookie = name + "=;expires=" + oDate + ";path=/;domain=" + domain;
}

var getServiceUrl = function () {
    var serviceUrl = "";
    var loginUtil;
    if ($(".login-btn.new-login").length > 0) {
        loginUtil = $(".login-btn.new-login").attr("data-login-url");
    } else if ($("a.login").length > 0) {
        loginUtil = $("a.login").attr("href");
    } else if ($("div.login").length > 0) {
        //handle showroom login.
        loginUtil = $("div.login").attr("data-login-url");
    } else {
        var needLoginTarget = $("meta[name=loginInfo]");
        loginUtil = needLoginTarget.attr("link");
    }
    if (loginUtil) {
        var parameterStr = loginUtil.substring(loginUtil.indexOf("?") + 1, loginUtil.length);
        var parameterArr = getParameterArr(parameterStr);
        if (parameterArr.hasOwnProperty("service")) {
            serviceUrl = parameterArr.service;
        }
    }
    return serviceUrl;
}

var loginUtil = (function ($) {
    var login = {};
    var currentUrl = window.location.href;

    login.init = function () {
        var isLoginPage = currentUrl.indexOf("/login") > -1;
        var site = parseSiteFromUrl();
        // cn站session认证
        if (site === "cn") {

        } else if (isLoginPage) {
            login.loginSuccess();
        } else if (getLoginCookie("ticket")) {
            //存在ticket，验证
            if (login.notEditorOrPreviewMode()) {
                login.checkLogin();
            }
            login.loginBtnHandler();
        } else {
            //未登录
            login.loginHandler();
        }
    };

    login.loginSuccess = function () {
        var parameterStr = currentUrl.substring(currentUrl.indexOf("?") + 1, currentUrl.length);
        var parameterArr = getParameterArr(parameterStr);
        if (parameterArr.hasOwnProperty("ticket")) {
            setLoginCookie("ticket", parameterArr.ticket);
            var redirectUrl = $.cookie("redirectUrl");
            if (!redirectUrl) {
                var index = currentUrl.indexOf("hikvision");
                if (index > 0) {
                    redirectUrl = currentUrl.substring(0, currentUrl.indexOf("sso"));
                } else {
                    redirectUrl = currentUrl.substring(0, currentUrl.indexOf("?"));
                }
            }
            login.checkLogin(redirectUrl);
        }
    };

    login.checkUserType = function (currentPagePath) {
        if (!currentPagePath) {
            currentPagePath = $(".needLogin").attr("data-page-path");
        }
        var hikId = $.cookie("HIKID");
        var hikEmail = $.cookie("HIKEMAIL");
        try {
            hikId = atob(hikId);
            hikEmail = atob(hikEmail);
        } catch (error) {
            console.log("Login Error:" + error);
        }
        var verifyUrl = "/content/hikvision/en/jcr:content/header";
        var checkUserTypeUrl = verifyUrl + ".usertype.json";
        if(currentPagePath){
            $.ajax({
                type: "GET",
                url: checkUserTypeUrl,
                data: {
                    currentPagePath: currentPagePath,
                    hikId: hikId,
                    hikEmail: hikEmail,
                    timestamp: new Date().getTime()
                },
                success: function (data) {
                    var jsonData = typeof data == "string" ? JSON.parse(data) : data;
                    if (jsonData.code == 403 && jsonData.redirectionUrl) {
                        window.location.href = jsonData.redirectionUrl + "?applyPath=" + currentPagePath;
                    } else {
                        if (currentUrl.indexOf("/login") > -1) {
                            window.location.href = currentPagePath;
                        } else {
                            $(".root.responsivegrid").parent().show();
                        }
                    }
                }
            });
        }
    }

    login.isShowroom = function () {
        var homePage = getLoginCookie("showroom-home-page");
        if (!homePage || homePage.length === 0) {
            var landingPage = getLoginCookie("showroom-landing-page");
            if (!landingPage || landingPage.length === 0) {
                return false;
            }
            return false;
        }
        return true;
    };

    login.checkLogin = function (redirectUrl) {
        var ticket = getLoginCookie("ticket");
        var serviceUrl = getServiceUrl();
        if (ticket && serviceUrl) {
            var verifyUrl = "/content/hikvision/en/jcr:content/header";
            var checkTicketUrl = verifyUrl + ".json";
            var userName = "";
            $.ajax({
                type: "GET",
                url: checkTicketUrl,
                data: {
                    service: serviceUrl,
                    ticket: ticket
                },
                success: function (data) {
                    var code = data.code;
                    if (code === 500) {
                        //未登录
                        login.loginHandler();
                        login.displayLogin(false, userName);
                    } else if (code === 200) {
                        userName = login.getEncryptCookie("HIKUSERNAME");
                        login.displayLogin(true, userName);
                        login.checkAccountType();

                        var needLoginTarget = $("meta[name=loginInfo]");
                        var userType = needLoginTarget.attr("content");
                        if (userType) {
                            login.checkUserType(redirectUrl);
                        } else {
                            // usercenter隐藏处理
                            $(".root.responsivegrid").parent().show();
                            // redirectUrl是函数则执行函数
                            if (redirectUrl) {
                                if (typeof redirectUrl === 'string') {
                                    window.location.href = redirectUrl;
                                } else {
                                    redirectUrl()
                                }
                            }
                        }
                    }
                },
                error: function (data) {
                    console.log("check sso ticket servlet has error, please get more message in the log");
                    login.loginHandler();
                    login.displayLogin(false, userName);
                }
            });
        }
    };

    /**
     * checkAccountType
     */
    login.checkAccountType = function () {
        var srcSystem = login.getEncryptCookie("SourceSystem");
        if ("Global" === srcSystem) {
            var hikId = login.getEncryptCookie("HIKID");
            $.ajax({
                url: "/bin/hikvision/login",
                type: "GET",
                data: {
                    businessType: "accountType",
                    hikId: hikId
                }
            }).done(function (data) {
                if (data) {
                    var expiresDate = new Date();
                    expiresDate.setTime(expiresDate.getTime() + (30 * 60 * 1000));
                    $.cookie("accountType", data, {
                        expires: expiresDate
                    });

                } else {
                    console.warn("AccountType is empty.");
                }
            }).fail(function (request, error) {
                console.log("Request Failed: " + error);
            });
        }
    };

    /**
     * getEncryptCookie
     * @param key
     * @returns {jQuery|*}
     */
    login.getEncryptCookie = function (key) {
        var value = getLoginCookie(key);
        try {
            value = decodeURIComponent(escape(window.atob(value)));
        } catch (error) {
            console.log("getEncryptCookie Error:" + key + error);
        }
        return value;
    };

    /**
     * displayLogin
     * @param isShow
     * @param userName
     */
    login.displayLogin = function (isShow, userName) {
        if (isShow) {
            // for pc
            $(".header-wrapper .login").hide();
            $(".header-wrapper .login-username").show();
            // for mobile
            $("#login-btn-wrap").hide();
            $("#user-name-wrap").show();
            initDropdownClick();
        } else {
            // for pc
            $(".header-wrapper .login").show();
            $(".header-wrapper .login-username").hide();
            // for mobile
            $("#login-btn-wrap").show();
            $("#user-name-wrap").hide();
        }
        // for pc
        $(".login-username").find(".link-username").text(userName);
        $(".login-username").find(".link-username").attr("title", userName);
        $(".login-username").find(".link-drp").attr("title", userName);
        // for mobile
        $("#user-name-wrap").find(".user-logo-name").text(userName);
        $("#user-name-wrap").find(".user-logo-name").attr("title", userName);
        // check login cookie disabled
        checkAndRemoveLoginCookie();
    };

    /**
     * 未登录
     */
    login.loginHandler = function () {
        var needLoginTarget = $("meta[name=loginInfo]");
        var userType = needLoginTarget.attr("content");
        var needLogin = needLoginTarget.attr("value");
        if (needLoginTarget.length == 0) {
            needLogin = $(".needLogin").length > 0;
        }
        var checkMode = login.notEditorOrPreviewMode();
        // ticket wrong
        // remove check && (!ticket || ticket === "123")
        if (needLogin && userType === undefined) {
            if (checkMode) {
                loginUtil.loginModalLoginBtnClick();
            }
        } else if (needLogin && userType !== undefined) {
            // pop login confirm
            if (checkMode) {
                loginUtil.popupLoginConfirmModal();
            }
        } else {
            //
            login.loginBtnHandler();
            removeAllLoginCookie();
        }
    };

    /**
     * login.isEditorOrPreviewMode
     */
    login.notEditorOrPreviewMode = function () {
        var runMode = login.getRunMode();
        return (runMode !== "edit" && runMode !== "preview");
    };

    /**
     * getRunMode
     */
    login.getRunMode = function () {
        return getLoginCookie("wcmmode");
    };

    /**
     * removeLoginCookie
     */
    function removeAllLoginCookie() {
        removeLoginCookie("ticket");
        removeLoginCookie("redirectUrl");
        removeLoginCookie("HIKID");
        removeLoginCookie("HIKUSERID");
        removeLoginCookie("HIKUSERNAME");
        removeLoginCookie("HIKEMAIL");
        removeLoginCookie("HIKROLE");
        removeLoginCookie("SourceSystem");
        removeLoginCookie("hik-login-user");
    }

    function checkAndRemoveLoginCookie() {
        // removeAllLoginCookie();
        storeManager.cookieDisclaimerUtil.cleanCategoryCookies()
    }

    /**
     * login user dropdown menu
     */
    var initDropdownClick = function () {
        $(".login-username .link-drp").unbind("click").click(function (e) {
            e.stopPropagation();
            $(this).siblings(".login-username-dropdown").toggle();
            $(this).siblings(".fa-caret-right").toggleClass("dropdown-open-caret");
            $(this).toggleClass("dropdown-open");

            $(".login-username").parent("login").addClass("hover");
        });
        $(document).click(function () {
            // $(".login-username-dropdown").hide();
            $(".login-username .link-drp").removeClass("dropdown-open");
            $(".login-username").parent("login").removeClass("hover");
        });
    };
    login.requestServerData = function (type, url, params, success, error) {
        $.ajax({
            type: type,
            url: url,
            data: params,
            dataType: "json",
            success: function (data) {
                success(data);
            },
            error: function () {
                error();
            }
        });
    }

    login.loginBtnHandler = function () {
        $(".link-logout, .logout").unbind("click").on("click", function () {
            removeAllLoginCookie();
        });
        $(".login-btn").unbind("click").on("click", function () {
            setLoginCookie("redirectUrl", currentUrl);
        });
        $(".new-login").unbind("click").on("click", function () {
            setLoginCookie("redirectUrl", currentUrl);
        });
        $(".login-btn-mobile").unbind("click").on("click", function () {
            setLoginCookie("redirectUrl", currentUrl);
        });
        //showroom welcome login
        $(".login-btn .link").unbind("click").on("click", function (e) {
            var homeLink = window.location.origin + $(this).attr("data-link");
            setLoginCookie("redirectUrl", homeLink);
            e.stopPropagation();
        });
    };

    login.loginModalLoginBtnClick = function () {
        setLoginCookie("redirectUrl", window.location.href);
        var link = '';
        if ($("a.login, span.login").length > 0) {
            // 老导航和新导航sso退出的a 标签的class类名不一样
            if ($('.new-login').length) {
                link = $(".login-btn.new-login ").attr("data-login-url") || $("span.new-login.link").attr("href");
            } else if ($("a.new-header-login").length > 0) {
                link = $("a.new-header-login").attr("data-href");
            } else {
                link = $("a.login").attr("href");
            }
        } else if ($("a.new-header-login").length > 0) {
            link = $("a.new-header-login").attr("data-href");
        } else if ($("div.login").length > 0) {
            //handle showroom login.
            link = $("div.login").attr("data-login-url");
        }else {
            link = $("meta[name=loginInfo]").attr("link");
        }
        link += ('&referrer=' + window.location.href);
        //中文站登录弹框跳转
        var cnLoginPath = $(".new-header-login").attr("data-path");
        if(cnLoginPath){
            link = cnLoginPath;
        }
        window.location.href = link
    }

    function getI18nString(msg) {
        return typeof Granite == "undefined" ? msg : Granite.I18n.get(msg);
    }

    login.popupLoginConfirmModal = function () {
        if ($('.login-required-comp').length < 1) {
            $(document).ready(function () {
                $('.login-required-comp').show();
                $('body').addClass('overflow-hidden');
            })
        } else {
            $('.login-required-comp').show();
            $('body').addClass('overflow-hidden');
        }
    }
    login.hideLoginConfirmModal = function () {
        var userType = $(".needLogin").attr("data-userType");
        if ($(".needLogin").length > 0 && userType != undefined) {
            var redirectionUrl = $(".needLogin").attr("data-redirectionUrl");
            window.location.href = redirectionUrl;
        } else {
            $('.login-required-comp').hide();
            $('.login-required-comp-cn').hide();
            $('body').removeClass('overflow-hidden');
        }
    }

    login.autoFillUserInfoInForm = function (success, $ele, cb) {
        //有效登录时，自动填充用户信息
        var hikId = getLoginCookie("HIKID");
        try {
            hikId = atob(hikId);
        } catch (error) {
            console.log("Login Error:" + error);
        }
        var data = $.extend({}, {hikId: hikId}, {
            "ticket": getLoginCookie("ticket"),
            "service": getServiceUrl()
        });
        var path = window.location.pathname.replace(".html", ".getUserInfo.json");
        if (path.indexOf("/content/hikvision") < 0) {
            path = "/content/hikvision" + path;
        }
        $.ajax({
            type: "GET",
            url: path,
            data: data,
            dataType: "json",
            success: function (resp) {
                if (resp.data.code == 0) {
                    success(resp.data.data, $ele, cb);
                }
            },
            error: function () {
                console.log('get user info by hikId failed')
                console.log("get user info by hikId failed");
            }
        });
    }
    return login;
})($);

loginUtil.init();

var hikPlayer = (function ($) {
    var player = {};
    /**
     * 1. open video modal trigger add css class [hik-video-trigger]
     * 2. trigger add property :
     *  1) data-internal-video: is internal video
     *  2) data-ezviz-video: is ezviz video
     *  3) data-video-path: video path
     *  4) data-check-login: video play check login
     *  5) data-resource: component resource path with property [videoPath]
     *  6) data-show-type: default, modal
     *  7) data-autoplay: "true", "false"
     *  8) data-poster: preview image
     *
     *  or  data-config = { checkLogin: false, videoPath: null, internalVideo: false, ezvizVideo: false, plyrProvider: null, videoType: null,
     *                      showType: null, autoplay: true, youtubeSdk: false, vimeoSdk: false, defaultVolume: 0.2, poster: null,}
     *
     **/
    player.Plyr = {
        plyrPlayer: null,
        plyrContainerId: null,
        plyrContainer: null,
        videoPath: null,
        config: {
            checkLogin: false,
            videoPath: null,
            internalVideo: false,
            ezvizVideo: false,
            plyrProvider: null,
            videoType: null,
            showType: null,
            autoplay: true,
            youtubeSdk: false,
            vimeoSdk: false,
            defaultVolume: 0.2,
            poster: null
        },
        initForNoModalType: function () {
            if (document.querySelector('.hik-video-wrapper')) {
                // 初始化不跳出弹窗的播放器
                var $videoWrapper = $('.hik-video-wrapper');
                $videoWrapper.each(function () {
                    var _this = $(this)
                    var videoPlayer = null
                    function initVideoPlayer () {
                        var config = player.Plyr.getTargetConfig(_this);
                        player.Plyr.config.autoplay = false
                        player.Plyr.config.loop = $(_this).attr("data-loop")
                        player.Plyr.config.fullscreen = $(_this).attr("data-fullscreen")
                        player.Plyr.config = $.extend(player.Plyr.config, config);
                        var finalConfig = $.extend(player.Plyr.config, player.Plyr.getPlyrConfig(player.Plyr.config))
                        var isYoutubeVideo = finalConfig.internalVideo !== "true"
                        var $videoPlayerContainer = $('<div id="video-player-container"></div>')
                        _this.append($videoPlayerContainer)
                        if (isYoutubeVideo) {
                            var videoPath = finalConfig.videoPath.indexOf('v=') !== -1 ? 
                                player.Plyr.getVideoId(finalConfig.videoPath, 'v') 
                                    : finalConfig.videoPath.slice(finalConfig.videoPath.lastIndexOf('/') + 1, finalConfig.videoPath.length + 1)
                            var realDiv = $("<div/>", {
                                class: "video-youtube-wrap",
                                'data-plyr-provider': 'youtube',
                                'data-plyr-embed-id': videoPath
                            })
                            $videoPlayerContainer.append(realDiv)
                            videoPlayer = new Plyr(realDiv, {
                                autoplay: !!finalConfig.autoplay,
                                youtube: {
                                    rel: 0,
                                    noCookie: true
                                }
                            })
                        } else {
                            player.Plyr.plyrContainer = player.Plyr.createPlyrContainer(
                                "video-player-container", 
                                finalConfig,
                                $videoPlayerContainer
                            );
                            videoPlayer = new Plyr(_this.find(isYoutubeVideo ? "#video-container-youtube" : "#video-container"), {
                                controls: ['play','play-large', 'progress', 'current-time', 'mute', 'captions', 'settings', 'volume', 'fullscreen']
                            });
                        }
                        // console.log('on each', _this.find("#video-container"), videoPlayer)
                        videoPlayer.muted = !!player.Plyr.config.autoplay
                        if (player.Plyr.config.autoplay) {
                            $(window).on('scroll', function () {
                                player.Plyr.visualVideo(videoPlayer)
                            })
                        }
                    }
                    initVideoPlayer()
                })
            }
        },
        init: function () {
            if (document.querySelector(".hik-video-trigger")) {
                $(".hik-video-trigger").on("click", function (e) {
                    e.preventDefault();
                    var _this = $(this);
                    var videoContainerId = _this.attr("id");
                    var config = player.Plyr.getTargetConfig(_this);
                    player.Plyr.config = $.extend(player.Plyr.config, config);
                    // check login
                    if (player.Plyr.config.checkLogin === "true") {
                        var ticket = getLoginCookie("ticket");
                        if (ticket && ticket !== "123") {
                            loginUtil.checkLogin(function () {
                                if (isNull(player.Plyr.config.videoPath)) {
                                    var resourcePath = _this.attr("data-resource");
                                    $.ajax({
                                        type: "GET",
                                        url: resourcePath + ".json",
                                        dataType: "json",
                                        success: function (data) {
                                            player.Plyr.config.videoPath = data.videoPath;
                                            if (player.Plyr.config.videoPath && !isNull(player.Plyr.config.videoPath.trim())) {
                                                setTimeout(function(){
                                                    player.Plyr.playModal(player.Plyr.config);
                                                }, 30)
                                            }
                                        },
                                        error: function () {
                                            console.log("Video info get failed");
                                        }
                                    });
                                } else {
                                    setTimeout(function(){
                                        player.Plyr.playModal(player.Plyr.config);
                                    }, 30)
                                }
                            });
                        } else {
                            loginUtil.popupLoginConfirmModal();
                        }
                    } else {
                        if (!isNull(player.Plyr.config.videoPath)) {
                            if (player.Plyr.config.showType === "modal") {
                                player.Plyr.playModal(player.Plyr.config);
                            } else if (player.Plyr.config.showType === "default") {
                                if (!videoContainerId) {
                                    videoContainerId = "hiknow-video-container"
                                }
                                player.Plyr.play(videoContainerId, player.Plyr.config);
                            } else {
                                player.Plyr.playModal(player.Plyr.config);
                            }
                        }
                    }
                    $(this).unbind()
                });
            }
        },
        // 当前视频只在可视区域播放
        visualVideo: function(player, container) {
            // console.log('visualVideo', player)
            if(player.elements){ // 本地视频
                var videoWrapper = player.elements.captions ? $(player.elements.captions).parent() : $(player.elements.wrapper) 
                if(!videoWrapper.length) return;
                var itemOffsetTop = videoWrapper.offset().top;
                var isVisible = videoWrapper.offset().left > -10 && ($(window).width() - videoWrapper.offset().left - videoWrapper.width()) > -10
                if (itemOffsetTop >= $(window).scrollTop() && itemOffsetTop < ($(window).scrollTop()+$(window).height()) && isVisible) {
                    player.play()
                } else {
                    player.pause()
                }
                window.myPlayer = player
            } 
        },
        getTargetConfig: function (target) {
            var config = {};
            if (target[0].hasAttribute("data-config")) {
                var jsonInfo = JSON.parse(target.attr("data-config"));
                config = jsonInfo;
            } else {
                config.checkLogin = target.attr("data-check-login");
                config.videoPath = target.attr("data-video-path");
                config.internalVideo = target.attr("data-internal-video");
                config.ezvizVideo = target.attr("data-ezviz-video");
                config.showType = target.attr("data-show-type");
                //$(this).attr("data-plyr-provider");
                config.plyrProvider = "youtube";
                //$(this).attr("data-video-type");
                config.videoType = "video/mp4";
                if (target[0].hasAttribute("data-autoplay")) {
                    config.autoplay = (target.attr("data-autoplay").toLowerCase() === "true");
                }
                config.poster = target.attr("data-poster");
            }
            return config;
        },
        initVideoModal: function () {
            var html = '<div class="modal fade video" id="hik-video" tabindex="-1" role="dialog" aria-hidden="true">'
                + ' <div class="modal-dialog modal-lg modal-dialog-centered">'
                + '   <div class="modal-content">'
                + '     <div class="modal-header"><button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><img src="/etc/clientlibs/it/resources/icons/icon-close-white.svg"/></span></button></div>'
                + '     <div class="modal-body">'
                + '       <div class="video-wrapper" id="modal-video-container" data-autoplay="true">'
                + '       </div>'
                + '     </div>'
                + '   </div>'
                + ' </div>'
                + '</div>';
            if($('#hik-video').length == 0){
                $('body').append(html);
            }
            $('#hik-video').find('.close').on('click',function (e) {
                player.Plyr.init();
                hikPlayer.Plyr.initForNoModalType();
               
                if($("body").hasClass("hideScroll")){
                  $("body").removeClass("hideScroll")
                }
                if($(".super-big-banner-full").length){
                    var ssVideoClass = sessionStorage.getItem("playVideoClass")
                    var video = $('.t_'+ssVideoClass)[0]
                    if(video.paused){
                       // $(video).attr("autoplay", true)
                        setTimeout(function(){
                            video.play()
                        }, 200)
                    } 
                }
            })
            $(".modal.fade.video").on("click", function(e){
                if($(this).hasClass("show")){
                    player.Plyr.init();
                    hikPlayer.Plyr.initForNoModalType();
                }
            })
        },
        createPlyrContainer: function (plyrContainerId, config, container) {
            var plyrContainer = container || $("#" + plyrContainerId);
            if (config.ezvizVideo === "true") {
                // ezviz video
                var iframeTag = $("<iframe/>", {
                    id: "video-container",
                    "width": "100%",
                    "height": "100%",
                    "src": config.videoPath,
                    "allowfullscreen": "true",
                    "webkitallowfullscreen": "true",
                    "mozallowfullscreen": "true",
                    class: "ezviz-video-container",
                    "autoplay": config.autoplay
                });

                plyrContainer.empty();
                plyrContainer.html(iframeTag);
            } else if (config.internalVideo === "true") {
                // internal video. video type = type
                // console.log('on play', config)
                var videoConfig =  {
                    id: "video-container",
                    playsinline: "",
                    class: "video-container video-player common-internal-video-container",
                    poster: config.poster,
                    autoplay: config.autoplay,
                    muted: !!config.autoplay
                }
                if(config.loop){
                    videoConfig.loop = {
                     active: true
                    }
                }
                if(config.fullscreen === "false"){
                    videoConfig.allowfullscreen  = "false"
                }
                var videoTag = $("<video/>", videoConfig);
                videoTag.append($('<source src="' + config.videoPath + '" type="' + config.videoType + '"/>'));
                videoTag.append($('<noscript className="loading-lazy"><img src="/etc/clientlibs/it/resources/images/video-bg.jpg" loading="lazy" className="static-device animated-videos" alt="Landing Animation Video"/></noscript>'));

                plyrContainer.empty();
                plyrContainer.html(videoTag);
            } else {
                // plyrProvider: youtube video
                var videoPath = config.videoPath.indexOf('v=') !== -1 ? player.Plyr.getVideoId(config.videoPath, 'v') : config.videoPath.slice(config.videoPath.lastIndexOf('/'), config.videoPath.length + 1)
                var iframeTag = $("<iframe/>", {
                    id: "video-container-youtube",
                    "width": "100%",
                    //使用youtube的nocokie模式，可以去除掉分享很查看更多等内容 https://www.youtube-nocookie.com
                    "src": 'https://www.youtube-nocookie.com/embed/' + videoPath + '?rel=0&autoplay=' + Number(config.autoplay) + '&controls=1',
                    "allowfullscreen": "true",
                    "allow":"autoplay",
                    "webkitallowfullscreen": "true",
                    "mozallowfullscreen": "true",
                    class: "video-container common-video-container",
                    "autoplay": config.autoplay,
                    "frameborder": 0
                });
                plyrContainer.empty();
                var realDiv = $("<div/>", {
                    class: "video-youtube-wrap"
                })
                realDiv.append(iframeTag)
                plyrContainer.html(realDiv);
            }

            player.Plyr.plyrContainerId = plyrContainerId;
            player.Plyr.plyrContainer = plyrContainer;
            player.Plyr.videoPath = config.videoPath;

            return plyrContainer;
        },
        getVideoId: function (url, name) {
            if (!url) return ""
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var urlIndex = url.indexOf('?')
            //https://www.youtube.com/embed/_7VsKIVLxXA
            var r = url.slice(urlIndex + 1, url.length).substr(0).match(reg);
            if (r != null) return unescape(r[2]);
            return "";
        },
        changePlyrVideoPath: function (config) {
            if (config.ezvizVideo === "true") {
                player.Plyr.plyrPlayer[0].source = config.videoPath;
            } else if (config.internalVideo === "true") {
                // internal video. video type = type
                player.Plyr.plyrPlayer[0].source = {
                    type: "video",
                    sources: [
                        {
                            src: config.videoPath,
                            type: config.videoType
                        }
                    ]
                }
            } else {
                player.Plyr.plyrPlayer[0].source = {
                    type: "video",
                    sources: [
                        {
                            src: config.videoPath,
                            provider: config.plyrProvider
                        }
                    ]
                }
            }
            player.Plyr.videoPath = config.videoPath;
        },
        play: function (plyrContainerId, config) {
            if (!player.Plyr.plyrContainerId) {
                player.Plyr.plyrContainer = player.Plyr.createPlyrContainer(plyrContainerId, config);
                // player.Plyr.createPlyr(plyrContainerId);
                player.Plyr.plyrPlayer = Plyr.setup("#video-container", player.Plyr.getPlyrConfig(config));
            } else if (player.Plyr.plyrContainerId !== plyrContainerId) {
                player.Plyr.plyrContainer = player.Plyr.createPlyrContainer(plyrContainerId, config);
                // player.Plyr.createPlyr(plyrContainerId);
                player.Plyr.plyrPlayer = Plyr.setup("#video-container", player.Plyr.getPlyrConfig(config));

            } else if (player.Plyr.videoPath !== config.videoPath) {
                player.Plyr.changePlyrVideoPath(config);
            }
            if($('.video-youtube-wrap').length){
               $('.video-youtube-wrap').addClass('plyr__video-wrapper plyr__video-embed')  
            }
            if (config.autoplay) {
                player.Plyr.plyrPlayer&&player.Plyr.plyrPlayer[0].play();
            }
        },
        playModal: function (config) {
            if (!player.Plyr.plyrContainerId) {
                player.Plyr.initVideoModal();
                player.Plyr.plyrContainer = player.Plyr.createPlyrContainer("modal-video-container", config);
                player.Plyr.plyrPlayer = Plyr.setup("#video-container", player.Plyr.getPlyrConfig(config));

                if (Plyr) {
                    // video stop
                    $("#hik-video").on("hidden.bs.modal", function (e) {
                        if (player.Plyr.plyrPlayer && player.Plyr.plyrPlayer.length > 0) {
                            player.Plyr.plyrPlayer[0].stop();
                        }
                    });
                }
            } else if (player.Plyr.videoPath !== config.videoPath && config.videoPath.indexOf('youtu') === -1) {
                player.Plyr.initVideoModal();
                player.Plyr.plyrContainer = player.Plyr.createPlyrContainer("modal-video-container", config);
                player.Plyr.plyrPlayer = Plyr.setup("#video-container", player.Plyr.getPlyrConfig(config));
                if (Plyr) {
                    // video stop
                    $("#hik-video").on("hidden.bs.modal", function (e) {
                        if (player.Plyr.plyrPlayer && player.Plyr.plyrPlayer.length > 0) {
                            player.Plyr.plyrPlayer[0].stop();
                        }
                    });
                }
                player.Plyr.changePlyrVideoPath(config);
            }
            if (config.videoPath.indexOf('youtu') !== -1) {
                player.Plyr.initVideoModal();
                player.Plyr.plyrContainer = player.Plyr.createPlyrContainer("modal-video-container", config);
                player.Plyr.plyrPlayer = Plyr.setup("#video-container-youtube", player.Plyr.getPlyrConfig(config));
                // 隐藏youtube分享 详情按钮
                setTimeout(function () {
                    $("#video-container-youtube").contents().find(".ytp-chrome-top-buttons").hide()
                }, 1000)
                if (Plyr) {
                    // video stop
                    $("#hik-video").on("hidden.bs.modal", function (e) {
                        $('#video-container-youtube').remove();
                    });
                }
            }
            $("#hik-video").modal("toggle");
            if (config.autoplay && config.videoPath.indexOf('youtu') === -1) {
                //config.internalVideo = 'true'
                if(player.Plyr.plyrPlayer){
                    player.Plyr.plyrPlayer[0].play();
                }
            }
        },
        playYoutube: function (videoPath, showModal) {
            var config = player.Plyr.getDefaultConfig();
            config.videoPath = videoPath;
            config.showModal = showModal;
            config.plyrProvider = "youtube";

            if (showModal) {
                player.Plyr.playModal(config);
            } else {
                if (!player.Plyr.plyrContainerId) {
                    player.Plyr.plyrContainerId = "hiknow-video-container"
                }
                player.Plyr.play(player.Plyr.plyrContainerId, config);
            }
        },
        playInternal: function (videoPath, type, showModal) {
            var config = player.Plyr.getDefaultConfig();
            config.internalVideo = true;
            config.videoPath = videoPath;
            config.showModal = showModal;
            config.videoType = type;

            if (showModal) {
                player.Plyr.playModal(config);
            } else {
                if (!player.Plyr.plyrContainerId) {
                    player.Plyr.plyrContainerId = "hiknow-video-container"
                }
                player.Plyr.play(player.Plyr.plyrContainerId, config);
            }
        },
        playEzviz: function (videoPath, showModal) {
            var config = player.Plyr.getDefaultConfig();
            config.ezvizVideo = true;
            config.videoPath = videoPath;
            config.showModal = showModal;

            if (showModal) {
                player.Plyr.playModal(config);
            } else {
                if (!player.Plyr.plyrContainerId) {
                    player.Plyr.plyrContainerId = "hiknow-video-container"
                }
                player.Plyr.play(player.Plyr.plyrContainerId, config);
            }
        },
        createPlyr: function (plyrContainerId, config) {
            if (Plyr) {
                if (config) {
                    player.Plyr.plyrPlayer = new Plyr(plyrContainerId, config);
                } else {
                    player.Plyr.plyrPlayer = new Plyr(plyrContainerId, player.Plyr.getPlyrConfig(config));
                }
                player.Plyr.plyrPlayer.on("ready", function () {
                    player.Plyr.plyrPlayer.autoplay = config.autoplay;
                    player.Plyr.plyrPlayer.poster = config.poster;
                    player.Plyr.plyrPlayer.volume = (config.autoplay ? 0 : config.defaultVolume);
                })
            }
        },
        getPlyrConfig: function (config) {
            return {
                "controls": ["play-large", "play", "volume", "mute", "current-time", "duration", "progress", "fullscreen"],
                "autoplay": config.autoplay,
                "poster": config.poster,
                "volume": (config.autoplay ? 0 : config.defaultVolume),
            };
        },
        getDefaultConfig: function () {
            return {
                checkLogin: false,
                videoPath: null,
                internalVideo: false,
                ezvizVideo: false,
                plyrProvider: null,
                videoType: null,
                showType: null,
                autoplay: true,
                youtubeSdk: false,
                vimeoSdk: false,
                defaultVolume: 0.2,
                poster: null,
            };
        }
    };
    return player;
})($);

(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD (Register as an anonymous module)
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// Node/CommonJS
		module.exports = factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (arguments.length > 1 && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setMilliseconds(t.getMilliseconds() + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {},
			// To prevent the for loop in the first place assign an empty array
			// in case there are no cookies at all. Also prevents odd result when
			// calling $.cookie().
			cookies = document.cookie ? document.cookie.split('; ') : [],
			i = 0,
			l = cookies.length;

		for (; i < l; i++) {
			var parts = cookies[i].split('='),
				name = decode(parts.shift()),
				cookie = parts.join('=');

			if (key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
var vendorLibs = (function ($) {
    var vendorLib = {};

    var htmlFunc = function (data) {
        if (data.vendorLibScript.toLowerCase().indexOf("<noscript>") >= 0) {
            var script = data.vendorLibScript.substring(data.vendorLibScript.indexOf('<noscript>'),
                data.vendorLibScript.indexOf('</noscript>'));

            var html = '<!-- ' + data.vendorLibName + ' -->'
                + $(script).html()
                + '<!-- end ' + data.vendorLibName + ' -->';
            var noscript = $("<noscript></noscript>").append(html);
            $('#vendor-lib-footer-content').append(noscript);
        } else {
            var html = '<!-- ' + data.vendorLibName + ' -->'
                + data.vendorLibScript
                + '<!-- end ' + data.vendorLibName + ' -->';
            $('#vendor-lib-footer-content').append(html);
        }
    };

    vendorLib.init = function () {
        $(document).ready(function () {
            var libListUrl = $(".gdpr-wrapper").attr("data-lib-list");
            if (libListUrl && 'undefined' !== libListUrl) {
                $.ajax({
                    type: "GET",
                    url: libListUrl + ".footer.json",
                    success: function (data) {
                        if(data && data.sign) {
                            initRuSign(data.sign);
                        }
                        if (data && data.vendorLibs) {
                            var gdprConsentCookie = storeManager.cookie.get(storeManager.STORE_NAMES.cookieDisclaimer);
                            if (window.location.href.indexOf('/cn') < 0 && (gdprConsentCookie === "0" || data.disableCookie !== 'true')) {
                                var cookieName = storeManager.cookie.get("ip_expired");
                                if (cookieName === null) {
                                    requestLocation(libListUrl, accountLocation);
                                }
                            }

                            $('#vendor-lib-footer-content').empty();
                            data.vendorLibs.forEach(function (value) {
                                if (storeManager.cookieDisclaimerUtil.checkCategory(value.vendorLibCategory, data.disableCookie)) {
                                    htmlFunc(JSON.parse(JSON.stringify(value)));
                                } else {
                                    storeManager.cookieDisclaimerUtil.cleanCookies(value.vendorLibCategory);
                                }
                            });
                        }
                    }
                });
            }
        });
    };

    function initRuSign(data) {
        var $signHidden = $("sign-hidden");
        if ($signHidden && $signHidden.length > 0) {
            if (data) {
                $signHidden.find("input[name='app-id']").val(data.appId);
                $signHidden.find("input[name='access-token']").val(data.accessToken);
                $signHidden.find("input[name='timestamp']").val(data.timestamp);
                $signHidden.find("input[name='Referer']").val(data.referer);
            }
        }
    }

    function requestLocation(libListUrl, accountLocation) {
        var currentPagePath = $('body').attr('data-page-path');
        $.ajax({
            type: "GET",
            url: libListUrl + ".location.json?q=" + generateClientId() + "&path=" + encodeURI(currentPagePath),
            success: function (data) {
                if (data && data.location) {
                    // account location
                    if (accountLocation) {
                        accountLocation.init(data.location);
                    }
                }
            }
        });
    }

    return vendorLib;
}($));
;
(function (document, $) {

    $(document).ready(function () {
            document.onreadystatechange = function () {
                if (document.readyState == "complete") {
                    // for dom xss
                    if (xssFilter) {
                        xssFilter.init();
                    }

                    // at event
                    if (atModel) {
                        atModel.initAtEvent();
                    }

                    // video controls.
                    if (hikPlayer && hikPlayer.Plyr) {
                        hikPlayer.Plyr.init();
                        hikPlayer.Plyr.initForNoModalType();
                    }

                    // vendor libs
                    if (vendorLibs) {
                        vendorLibs.init();
                    }
                    // $(document).ajaxComplete(function (event,xhr,options) {
                    // });
                    // $(document).ajaxError(function(event,xhr,options,exc){
                    // })
                    // $(document).ajaxStart(function () {
                    // });
                }
            };
        }
    );
})(document, $);
(function (factory) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], factory);
    } else if (typeof module === "object" && module.exports) {
        module.exports = factory(require("jquery"));
    } else {
        factory(jQuery);
    }
})(function ($) {
    if (!$.validator) {
        return $;
    }

    $.extend($.validator.messages, {
        required: Granite.I18n.get("This field is required."),
        remote: Granite.I18n.get("Please fix this field."),
        email: Granite.I18n.get("Please enter a valid email address."),
        url: Granite.I18n.get("Please enter a valid URL."),
        date: Granite.I18n.get("Please enter a valid date."),
        dateISO: Granite.I18n.get("Please enter a valid date (ISO)."),
        number: Granite.I18n.get("Please enter a valid number."),
        digits: Granite.I18n.get("Please enter only digits."),
        equalTo: Granite.I18n.get("Please enter the same value again."),
        maxlength: $.validator.format(
            Granite.I18n.get("Please enter no more than {0} characters.")
        ),
        minlength: $.validator.format(
            Granite.I18n.get("Please enter at least {0} characters.")
        ),
        rangelength: $.validator.format(
            Granite.I18n.get(
                "Please enter a value between {0} and {1} characters long."
            )
        ),
        range: $.validator.format(
            Granite.I18n.get("Please enter a value between {0} and {1}.")
        ),
        max: $.validator.format(
            Granite.I18n.get("Please enter a value less than or equal to {0}.")
        ),
        min: $.validator.format(
            Granite.I18n.get(
                "Please enter a value greater than or equal to {0}."
            )
        ),
        step: $.validator.format(
            Granite.I18n.get("Please enter a multiple of {0}.")
        ),
    });
    return $;
});

var hrefLang = (function ($) {
  var hrefLangModel = {};
  var head = document.head || document.getElementsByTagName('head')[0];
  var htmlFunc = function (data) {
    var arrayLibs = $(data);
    for (var i = 0; i < arrayLibs.length; i++) {
      $(arrayLibs[i]).appendTo(head);
    }
  };
  hrefLangModel.init = function () {
    $(document).ready(function () {
      setTimeout(function(){
        $.each($('script'), function(){
          if($(this).attr('src') === 'https://www.youtube.com/iframe_api'){
            $('.licdn-preload').after('<link href="https://www.youtube.com" rel="preconnect" />')
            $('.licdn-preload').after('<link href="https://www.youtube.com" rel="dns-prefetch" />')
            return false;
          }
        })
        // if(document.getElementById("youtube-iframe-api")){
        //   $('.licdn-preload').after('<link href="https://www.youtube.com" rel="preconnect" />')
        //   $('.licdn-preload').after('<link href="https://www.youtube.com" rel="dns-prefetch" />')
        // }
      } ,500)
       // 获取link canonical
       // $('.canonical_t').attr('href', window.location.origin + window.location.pathname)
    });
  };

  return hrefLangModel;
}($));
hrefLang.init();
/**
 * video视频方法写到全局
 */
/**
 * youtube event
 */
var videoArrays = [];
var youtubeEvent = (function () {
   var module = {};
   var players = new Array();

   module.init = function () {
       var iframeApi = document.getElementById("youtube-iframe-api");
       if (!iframeApi) {
           var tag = document.createElement('script');
           tag.src = "https://www.youtube.com/iframe_api";
           tag.id = "youtube-iframe-api";
           var firstScriptTag = document.getElementsByTagName('script')[0];
           firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
       }
   };
   module.initYTPlayer = function (iframe, videoId) {
       var player = new YT.Player(iframe, {
           events: {
               'onStateChange': onPlayerStateChange
           }
       });
       player.maxTime = 0;
       player.lastPosition = 0;
       player.lastPositionPaused = 0;
       player.lastTimeGap = undefined;
       player.seekTimeout = 0;
       players[videoId] = player;
       $(iframe).closest('.animated-videos').on('hikplyr:ytb-pause-player', function() {
           player.pauseVideo();
       });

       $(iframe).closest('.animated-videos').on('hikplyr:ytb-play-player', function() {
           player.playVideo();
       });
       videoArrays.push(player)
   };

   /**
    * playTracker
    * @param e
    * @returns {boolean}
    */
   function playTracker(event) {
       if (!event.target.clicknum) {
           event.target.clicknum = 0;
       }
       var clicknum = event.target.clicknum;
       ++event.target.clicknum;
       if (clicknum > 0) return false;
       //event.target.h改成evenet.target.g
       var item = $(event.target.g);
       var module = $(item).data('at-module');
       var videoId = $(item).data('video-id');

       var url = window.location.href;
       url = url.replaceAll("%20", "_");
       var title = module + atModel.atSpliter + videoId + atModel.atSpliter + url;
       atModel.doAtEvent(title, 'action', event);
   }

   /**
    * BUFFERING: 3, CUED: 5, ENDED: 0, PAUSED: 2, PLAYING: 1, UNSTARTED: -1
    *
    * @param event
    */
   function onPlayerStateChange(event) {
       try {
           switch (event.data) {
               case YT.PlayerState.PLAYING:
                   playTracker(event);
                   break;
               case YT.PlayerState.PAUSED:
                   break;
               case YT.PlayerState.BUFFERING:
                   break;
               case YT.PlayerState.CUED:
                   break;
               case YT.PlayerState.ENDED:
                   break;
           }
       } catch (ex) {
       }
   }

   return module;
})();
/**
* YouTube Iframe API Ready callback
*/
function onYouTubeIframeAPIReady() {
   var videoElements = document.querySelectorAll('.features-device-right')
   $.each(videoElements, function (index, item) {
       var videoItem = $(item);
       var autoplay = videoItem.attr('data-autoplay')
       var videoId = getVideoId(videoItem.attr('data-video'), 'v');
       if (localStorage.getItem('media_firstVideoPlayed')) {
           autoplay = 0
       }
       if (videoId) {
           if (autoplay == 1) {
               localStorage.setItem('media_firstVideoPlayed', '1')
           }
           var iframeItem = videoItem.addClass('youtubeVideo').find('iframe');
           var youtubeVideoUrl = 'https://www.youtube-nocookie.com/embed/' + videoId + '?rel=0&autoplay=' + autoplay + '&controls=1&mute=1&enablejsapi=1&origin=' + location.origin;
           iframeItem.attr('src', youtubeVideoUrl);
           iframeItem.attr('data-video-id', videoId);
           youtubeEvent.initYTPlayer(iframeItem[0], videoId);
       
       } else if (videoItem.attr('data-video').indexOf('youtu') !== -1) {
           if (autoplay == 1) {
               localStorage.setItem('media_firstVideoPlayed', '1')
           }
           var iframeItem = videoItem.addClass('youtubeVideo').find('iframe');
           var sSrc = videoItem.attr('data-video').slice(videoItem.attr('data-video').lastIndexOf('/') + 1, videoItem.attr('data-video').length)
           var youtubeVideoUrl1 = 'https://www.youtube-nocookie.com/embed/' + sSrc + '?rel=0&autoplay=' + autoplay + '&controls=1&mute=1&enablejsapi=1&origin=' + location.origin;
           iframeItem.attr('src', youtubeVideoUrl1);
           iframeItem.attr('data-video-id', sSrc);
           youtubeEvent.initYTPlayer(iframeItem[0], sSrc);
       } else {
           videoItem.removeClass('youtubeVideo')
       }
       setTimeout(function () {
           $(".features-device-right iframe").contents().find(".ytp-overflow-icon").hide()
       }, 1000)
   })
}

function getVideoId(url, name) {
   if(!url) return ""
   if(url.indexOf(name + '=')!==-1){
       var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
       var urlIndex = url ? url.indexOf('?') : -1
       var r = url.slice(urlIndex + 1, url.length).substr(0).match(reg);
       if (r != null) return unescape(r[2]);
       return "";
   } else { 
       // https://www.youtube.com/embed/_7VsKIVLxXA
       if(url.indexOf('youtu') !== -1) {
           var lastUrlId = url.lastIndexOf('/')
           return url.slice(lastUrlId+1, url.length+1)
       } else {
           return "";
       }
   }
}
// 当前视频只在可视区域播放
function visualVideo(videoArrays){
   $.each(videoArrays, function(index, item){
       if(item && item.videos){
           if(item.videos.elements){ // 本地视频
               var itemOffsetTop = $(item.videos.elements.captions).parent().offset().top;
               if (itemOffsetTop + $(item.videos.captions).parent().height() >= $(window).scrollTop() && itemOffsetTop < ($(window).scrollTop()+$(window).height()) && item.autoplay) {
                   item.videos.play()
               } else {
                   item.videos.pause()
               }
           } else { //youtube视频
               var itemOffsetTop1 = $(item.h).offset().top;
               if (itemOffsetTop1 + $(item.h).height() >= $(window).scrollTop() && itemOffsetTop1 < ($(window).scrollTop()+$(window).height()) && item.autoplay) {
                   item.videos.playVideo()
               } else {
                   item.videos.pauseVideo()
               }
           }
       }
   })
}
(function (document, $) {
    function getURLParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var value = window.location.search.substr(1).match(reg);
        if (value) {
            return decodeURI(value[2]);
        }
        return '';
    }
    $(document).ready(function() {
        var $header = $('#header');
        var $header2 = $('#cmp-subheader-selector');
        var offsetVal = 0;
        var comp = getURLParam('comp');
        var $targetComp = $('[data-website-link-anchor = "'+comp+'"]');
        if($targetComp.length) {
            setTimeout(function() {
                var scrollVal = $targetComp.offset().top;
                if ($header2.length) {
                    var header2offTop = $header2.offset().top;
                    scrollVal = header2offTop < scrollVal ? ( scrollVal - $header2.height() * 2) : (scrollVal - $header2.height());
                }

                if ($(window).width() < 992) {
                    scrollVal = scrollVal -  $header.height();
                }

                window.scrollTo(0, scrollVal);
            },100);
        }
    });
})(document, $);
;
(function (document, $) {
  function writeData() {
    var script = document.createElement('script');
    script.type = 'application/ld+json';
    var $breadcrumbElements = $('.header-2.aem-GridColumn .header-nav-ul').find('.header-nav-dw')
    var currentPageType = $('body').attr('data-page-path')
    var pagesArr = currentPageType.split('/')
    var navs = ['Products','products', 'Solutions','solutions', 'Support', 'support','Partners', 'partners']
    if(pagesArr.length>4){
      var itemListElements = [{
        "@type": "ListItem",
          "position": 1,
          "name":  pagesArr[4]&&pagesArr[4].indexOf('.html')!==-1 ? upperCaseWord(pagesArr[4].replace('.html', '')):upperCaseWord(pagesArr[4]),
          "item":  window.origin + '/' +pagesArr[3]+'/'+ (pagesArr[4]&&pagesArr[4].indexOf('.html')!==-1?pagesArr[4].replace('.html', ''):pagesArr[4])  +'/'
      }]
      $.each($breadcrumbElements, function(index, element){
        var subnavText = pagesArr[4]
        if(navs.indexOf(subnavText) !== -1){
          var href = $(element).find('a').attr('href')
            if(index>0 && $(element).find('a') && href){
              var replaceName = pagesArr[index+4]&&(pagesArr[index+4]).indexOf('.html')>-1?pagesArr[index+4].replace('.html', ''):pagesArr[index+4]
              itemListElements.push({
              "@type": "ListItem",
              "position": index + 1,
              "name":$($('.link-drp.at-navigation').get(index-1)).text(),
              "item": !href || href === 'javaScript:void(0);' ? window.origin + '/' + replaceName  +'/': window.origin + href
            })
          }
        } else {
          var href = $(element).find('a').attr('href')
          if(index>2 && $(element).find('a') && href && index<4 ){
            var replaceName = pagesArr[index+4]&&(pagesArr[index+4]).indexOf('.html')>-1?pagesArr[index+4].replace('.html', ''):pagesArr[index+4]
            itemListElements.push({
            "@type": "ListItem",
            "position": index,
            "name":$($('.link-drp.at-navigation').get(index-1)).text(),
            "item": !href || href === 'javaScript:void(0);' ? window.origin + '/' + replaceName  +'/': window.origin + href
          })
        }
        }
      })
      if($breadcrumbElements.length){
        var subnavText = pagesArr[4]
        if(navs.indexOf(subnavText) !== -1){
          itemListElements.push({
            "@type": "ListItem",
              "position": $breadcrumbElements.length,
              "name":  $('.logo-title-wrap .title').text(),
              "item": window.location.href,
          })
        } else {
          itemListElements.push({
            "@type": "ListItem",
              "position": $breadcrumbElements.length - 1,
              "name":  $('.logo-title-wrap .title').text(),
              "item": window.location.href,
          })
        }
      }
      script.text = JSON.stringify({
        "@context": "https://schema.org",
         "@type": "BreadcrumbList",
         "itemListElement":itemListElements
    });
    if ($breadcrumbElements.length || (_ && _.uniq(pagesArr).length === 5)) {
      document.querySelector('head').appendChild(script);
    }
  }
}
writeData()
function upperCaseWord(word){
  if(!word) return;
  return word[0].toUpperCase() + word.substr(1)
}
})(document, $);</script>
</body>
</html>
