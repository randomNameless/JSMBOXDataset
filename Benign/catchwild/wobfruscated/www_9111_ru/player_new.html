<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>player_new.html</title>
</head>
<body>
<script>let player_config={muted:!1,volume:1},playerFirstInit=!0,currentVideo=null;const videos=[],videos_src=[];class Player{video=null;video_id=0;muted_default=!0;autoplay=!1;event_name="click";constructor(e=0){this.video_id=e,!0===ru9111.mobile&&(this.event_name="touchend")}getTemplate(e=""){if(0!==this.getContainer().length)return;let t="";return!1===ru9111.mobile&&(t='\n\t\t\t\t<div class="player_controls__volume">\n\t\t\t\t\t<div class="player_controls__volume__progress"></div>\n\t\t\t\t</div>'),`\n\t\t\t<div class="player" id="player${this.video_id}" data-video-id="${this.video_id}" data-fullscreen="false">\n\t\t\t\t<div class="player_preloader player_preloader__hide">\n\t\t\t\t\t<div class="preloader__ring preloader__ring__green"><div></div><div></div><div></div><div></div></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="player__video__share__wrap player__video__share__hide">\n\t\t\t\t\t<div class="player__video__share">\n\t\t\t\t\t\t<div class="player__video__share__text">Поделиться видео</div>\n\t\t\t\t\t\t<div class="player__video__share__icon"><svg><use href="#share"></use></svg></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<video playsinline poster="${e}.jpg" preload="metadata" src="${e}.mp4" type="video/mp4;"></video>\n\t\t\t\t<div class="player_controls__wrapper">\n\t\t\t\t\t<div class="player_controls">\n\t\t\t\t\t\t<div class="player_controls__play"><svg><use href="#video2"></use></svg></div>\n\t\t\t\t\t\t<div class="player_controls__bar">\n\t\t\t\t\t\t\t<div class="player_controls__timeline"></div>\n\t\t\t\t\t\t\t<div class="player_controls__buffer"></div>\n\t\t\t\t\t\t\t<div class="player_controls__substrate"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="player_controls__timer">0:00</div>\n\t\t\t\t\t\t<div class="player_controls__sound">\n\t\t\t\t\t\t\t<div class="player_controls__muted">\n\t\t\t\t\t\t\t\t<svg><use href="#muted_on"></use></svg>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${t}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="player_controls__fullscreen">\n\t\t\t\t\t\t\t<svg><use href="#fullWindow"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`}getContainer(){return $("#player"+this.video_id)}initPlayer(){let e=this.getContainer();this.video=e.find("video")[0];let t=this.video;t.id=this.video_id,t.autoplay=site_vars.player_autoplay,t.showAds=!1,this.video.muted=player_config.muted,!0===this.video.muted?this.video.volume=0:this.video.volume=player_config.volume;let i=e.find(".player_controls__play"),a=e.find(".player_controls__wrapper");a.on(this.event_name,(e=>{e.stopPropagation()}));const r=(e="")=>{let t=a.hasClass("player_controls__wrapper__hidden");""===e?!0===t?a.removeClass("player_controls__wrapper__hidden"):a.addClass("player_controls__wrapper__hidden"):"show"===e&&!0===t?a.removeClass("player_controls__wrapper__hidden"):"hide"===e&&!1===t&&a.addClass("player_controls__wrapper__hidden")};let o=e.find(".player_controls__muted"),d=e.find(".player__video__share"),l=e.find(".player_preloader"),s=e.find(".player_controls__volume__progress"),n=e.find(".player_controls__volume"),_=e.find(".player_controls__timeline"),u=e.find(".player_controls__buffer"),v=e.find(".player_controls__timer"),p=e.find(".player_controls__bar"),c=e.find(".player_controls__fullscreen"),y=this.event_name,h=0;!0===ru9111.mobile&&(y="touchstart touchend touchmove"),e.on(y,(e=>{!0===ru9111.mobile?("touchstart"===e.originalEvent.type&&(h=0),"touchmove"===e.originalEvent.type&&h++,"touchend"===e.originalEvent.type&&0===h&&t.readyState>2&&(t.paused||t.ended?t.play():t.pause())):t.readyState>2&&(t.paused||t.ended?t.play():t.pause())})),l.on(this.event_name,(e=>{e.stopPropagation()})),d.on(this.event_name,(t=>{let i=0;e.closest("[data-title-id]").length>0?i=e.closest("[data-title-id]").data("titleId"):e.closest("[data-forum-id]").length>0&&(i=e.closest("[data-forum-id]").data("forumId")),i>0&&(!1===ru9111.mobile?(statClicks("video_share_desktop"),copy2Clip("https://www.9111.ru/questions/777777777"+i+"/","Готово")):(statClicks("video_share_mobile"),navigatorShare("https://www.9111.ru/questions/777777777"+i+"/")),playerVideoShare(d,"remove")),t.stopPropagation()})),i.on(this.event_name,(()=>{t.readyState>2?t.paused||t.ended?t.play():t.pause():t.ended&&t.readyState})),this.video.addEventListener("playing",(()=>{}),!1),this.video.addEventListener("play",(()=>{playerCurrentVideoStop(t),i.html('<svg><use href="#pause"></use></svg>'),videoViewingDuration("start"),playerVideoShare(d,"hide")}),!1),this.video.addEventListener("pause",(()=>{i.html('<svg><use href="#play"></use></svg>'),videoViewingDuration("send",t.id),playerPreloader(l,"hide")}),!1),this.video.addEventListener("ended",(()=>{t.currentTime=0,i.html('<svg><use href="#play"></use></svg>'),videoViewingDuration("send",t.id),r("show"),playerVideoShare(d,"show")})),e.on("mouseenter mouseover",(()=>{r("show")})),e.on("mouseleave",(()=>{t.currentTime>0&&!1===t.paused&&!1===t.ended&&t.readyState>2&&r("hide")})),s.width(100*t.volume+"%"),this.video.addEventListener("volumechange",(()=>{!0===t.muted?o.html('<svg><use href="#muted_off"></use></svg>'):o.html('<svg><use href="#muted_on"></use></svg>');let e=100*t.volume;e>90?e=100:e<=15&&(e=0),s.width(e+"%"),savePlayerConfig("volume",t.volume)}),!1),o.on(this.event_name,(()=>{!0===t.muted?(t.muted=!1,t.volume=1):(t.muted=!0,t.volume=0),savePlayerConfig("muted",t.muted),savePlayerConfig("volume",t.volume)})),n.on(this.event_name,(e=>{let i=e.offsetX;if(void 0===i){let t=e.target.getBoundingClientRect();i=e.changedTouches[0].pageX-t.left}if(i&&e.currentTarget.offsetWidth){let a=(i/e.currentTarget.offsetWidth).toFixed(1);a<.2?a=0:a>=.9&&(a=1),t.volume=a}})),p.on(this.event_name,(e=>{let i=e.offsetX;if(void 0===i){let t=e.target.getBoundingClientRect();i=e.changedTouches[0].pageX-t.left}i&&t.duration&&e.currentTarget.offsetWidth&&(t.currentTime=t.duration/100*(i/e.currentTarget.offsetWidth*100))})),e.on("webkitfullscreenchange fullscreenchange",(()=>{document.webkitFullscreenElement||document.fullscreenElement?(e.attr("data-fullscreen",!0),c.html('<svg><use href="#fullWindowExit"></use></svg>')):(e.attr("data-fullscreen",!1),c.html('<svg><use href="#fullWindow"></use></svg>'))})),c.on(this.event_name,(()=>{let i=document.getElementById(e[0].id);document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement?document.webkitExitFullscreen():document.webkitRequestFullscreen?document.webkitRequestFullscreen():i.webkitEnterFullScreen?i.webkitEnterFullScreen():i.requestFullscreen?i.requestFullscreen():t.webkitEnterFullScreen?t.webkitEnterFullScreen():i.requestFullscreen()})),this.video.addEventListener("timeupdate",(()=>{let e=Math.round(100/t.duration*t.currentTime);if(_.width(e+"%"),t.buffered&&t.buffered.length>0){let e=Math.round(t.buffered.end(0)/t.duration*100);u.width(e+"%")}let i=t.duration-t.currentTime;if(i){let e=Math.floor(i/60),t=Math.floor(i%60);v.html(e+":"+t.toString().padStart(2,"0"))}t.networkState===t.NETWORK_LOADING&&playerPreloader(l,"hide"),t.readyState<t.HAVE_FUTURE_DATA&&playerPreloader(l,"show")}),!1),this.video.addEventListener("stalled",(e=>{}),!1),this.video.addEventListener("suspend",(()=>{}),!1),this.video.addEventListener("seeking",(()=>{}),!1),this.video.addEventListener("seeked",(()=>{}),!1),this.video.addEventListener("waiting",(()=>{}),!1),this.video.addEventListener("loadstart",(()=>{playerPreloader(l,"show")}),!1),this.video.addEventListener("loadedmetadata",(()=>{}),!1),this.video.addEventListener("error",(e=>{}),!1),this.video.addEventListener("canplay",(()=>{playerPreloader(l,"hide")}),!1),this.video.addEventListener("canplaythrough",(()=>{playerPreloader(l,"hide")}),!1),this.video.addEventListener("loadeddata",(()=>{!0===t.autoplay&&t.readyState>2&&t.play()}),!1),this.video.addEventListener("durationchange",(e=>{}),!1),videos[t.id]=this.video,videos_src[this.video.id]=new VideoSrcModel(this.video.getAttribute("src"),0)}}function playerPreloader(e,t){"show"===t?(e.removeClass("player_preloader__hide"),e.addClass("player_preloader__show")):"hide"===t&&(e.removeClass("player_preloader__show"),e.addClass("player_preloader__hide"))}function playerCurrentVideoStop(e){null!==currentVideo&&currentVideo.id!==e.id&&!0!==currentVideo.paused&&currentVideo.pause(),currentVideo=e}function titleVideoHidden(e){let t=0;e.closest("[data-title-id]").length>0?t=e.closest("[data-title-id]").data("titleId"):e.closest("[data-forum-id]").length>0&&(t=e.closest("[data-forum-id]").data("forumId")),t>0&&saveHidden(Number.parseInt(t))}function savePlayerConfig(e,t){void 0!==e&&void 0!==t&&(player_config[e]=t,localStorage.setItem("player_config",JSON.stringify(player_config)))}function loadPlayerConfig(){try{let e=localStorage.getItem("player_config");e&&(player_config=JSON.parse(e))}catch(e){console.log("Error load config player")}}$(document).on("click",".block_item__video_poster",(function(){let e=$(this).closest(".block_item__video_wrapper"),t=e.data("videoUrl"),i=Number.parseInt(e.data("videoId")),a=e.data("videoType");if(""!==t&&i>0&&"video"===a){if(!0===playerFirstInit&&!1===site_vars.player_autoplay&&(site_vars.player_autoplay=!0,playerFirstInit=!1,statClicks("video_start"),playerAutoplay()),videoViewsAnalytics(e,i),0===e.find(".player").length){const a=new Player(i);a.autoplay=site_vars.player_autoplay,e.append(a.getTemplate(t)),a.initPlayer(),e.find(".block_item__video_poster").remove(),titleVideoHidden(a.getContainer()),delete a}}else if(""!==t&&("youtube"===a||"ok_video"===a||"rutube"===a)){let i="";"youtube"===a?i=`<iframe id="video_play_status" src="https://www.youtube.com/embed/${t}?wmode=opaque&autohide=1&autoplay=1&enablejsapi=1&origin=https://www.9111.ru" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`:"ok_video"===a?i=`<iframe id="video_play_status" src="https://ok.ru/videoembed/${t}" allow="autoplay" allowfullscreen></iframe>`:"rutube"===a&&(i=`<iframe id="video_play_status" src="https://rutube.ru/play/embed/${t}" allow="clipboard-write" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>`),""!==i&&(e.append(i),e.find(".block_item__video_poster").addClass("block_item__video_poster__hide"))}}));class VideoSrcModel{src;currentTime;constructor(e,t=0){this.src=e,this.currentTime=t}}let player_autoplay_timer=null,player_replay_timer=null;function playerAutoplayTimer(e=0){clearTimeout(player_autoplay_timer),player_autoplay_timer=setTimeout((e=>{let t=$('.block_item__video_wrapper[data-video-id="'+e+'"]');t&&t.find(".block_item__video_poster").click()}),500,e)}function playerReplayTimer(e=0){clearTimeout(player_replay_timer),player_replay_timer=setTimeout((e=>{let t=videos.at(e);if(void 0!==t&&!0===t.paused&&!1===t.ended)try{t.play(),videoViewingDuration("start")}catch(e){console.log("Err 1",e,t.id)}delete t}),500,e)}function playerStopVideo(e=0){if(e>0){let e=videos.at(lastVideoIdInView);void 0!==e&&!1===e.paused&&(e.pause(),videos_src[e.id]=new VideoSrcModel(e.src,e.currentTime),videoViewingDuration("send",e.id)),delete e}}let lastVideoIdInView=0,last_entry=null,threshold=.8;$(window).height()>$(window).width()/2&&!0===ru9111.mobile?threshold=.9:$(window).height()>$(window).width()&&!0===ru9111.mobile?threshold=.6:$(window).height()>600?threshold=.9:$(window).height()>=740&&(threshold=1);let playerAutoplay=()=>{const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{null!==last_entry&&!1===last_entry.isIntersecting&&lastVideoIdInView>0&&(playerStopVideo(lastVideoIdInView),lastVideoIdInView=0,last_entry=null),e.isIntersecting?(last_entry=e,lastVideoIdInView=Number.parseInt($(e.target).closest('.block_item__video_wrapper[data-video-type="video"]').data("videoId"))):(clearTimeout(player_autoplay_timer),clearTimeout(player_replay_timer),null!==currentVideo&&playerStopVideo(currentVideo.id))}))}),{threshold:threshold});document.querySelectorAll('.block_item__video_wrapper[data-video-type="video"]').forEach((t=>e.observe(t)))},playerAutostop=()=>{const e=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting?(last_entry=e,lastVideoIdInView=Number.parseInt($(e.target).closest('.block_item__video_wrapper[data-video-type="video"]').data("videoId"))):lastVideoIdInView>0&&(playerStopVideo(lastVideoIdInView),lastVideoIdInView=0)}))}),{threshold:threshold});document.querySelectorAll('.block_item__video_wrapper[data-video-type="video"]').forEach((t=>e.observe(t)))};const targetNode=document.querySelector("#main_page_content")||document.querySelector("#see_also_titles");if(targetNode){const e={childList:!0,subtree:!0,target:'.block_item__video_wrapper[data-video-type="video"]'};new(window.MutationObserver||window.WebKitMutationObserver)(((e,t)=>{e.forEach((e=>{e.target.classList.contains("ArticleContent")&&site_vars.player_autoplay}))})).observe(targetNode,e)}$(document).ready((function(){loadPlayerConfig(),!0===site_vars.player_autoplay?playerAutoplay():playerAutostop()}));let video_view_anal_insert_status=!1;function videoViewsAnalytics(e,t=0,i=0){if(e&&t>0&&!1===video_view_anal_insert_status){let a=0;$(e).closest("[data-title-id]").length>0?a=$(e).closest("[data-title-id]").data("titleId"):$(e).closest("[data-forum-id]").length>0&&(a=$(e).closest("[data-forum-id]").data("forumId")),t>0&&(video_view_anal_insert_status=!0,$.ajax({cache:!1,type:"POST",url:"/api/analytics/video_view_anal.php",dataType:"json",data:{video_id:t,title_id:a,referrer:document.referrer,shorts:i,url:window.location.href},success:function(e){video_view_anal_insert_status=!1}}))}}let video_viewing_duration=0,watch_video_timer=null;function videoViewingDuration(e="",t=0){let i=()=>{null!==watch_video_timer&&(clearTimeout(watch_video_timer),watch_video_timer=null,video_viewing_duration=0)};if("start"===e)i(),watch_video_timer=setInterval((()=>{video_viewing_duration++}),1e3);else if("stop"===e)i();else if("send"===e&&t>0&&video_viewing_duration>0){let e={query:"send",mode:"video_view_duration",video_id:Number.parseInt(t),duration:video_viewing_duration};ru9111.id>0&&(e.user_id=ru9111.id),wsSend(e),i()}}function playerVideoShare(e,t){let i=e.closest(".player__video__share__wrap");i&&("show"===t?(i.addClass("player__video__share__show"),i.removeClass("player__video__share__hide")):"hide"===t?(i.addClass("player__video__share__hide"),i.removeClass("player__video__share__show")):"remove"===t&&i.remove())}function videoAdInit(e){if("function"==typeof ya.videoAd.play){let t;if(void 0===t||t<getTimeStamp()){localStorage.setItem("show_video_advert",getTimeStamp()+3e3),$("#player"+e).after('<div id="player_adfox"><video id="video_adfox" poster="" src=""></video></div>'),$("#player_adfox").fadeIn(50);let t="player_adfox",i=document.getElementById(t),a=i.getElementsByTagName("video")[0],r=$("#player"+e).find("video")[0];if(i&&a){$("#player"+e).fadeOut(50,(function(){$("#player_adfox").fadeIn(50)}));let o={adFoxParameters:{ownerId:"282719",containerId:t,params:{pp:"g",ps:"ddlt",p2:"hnob"}}};null!==r&&!0!==r.paused&&r.pause(),ya.videoAd.play({videoSlot:a,slot:i,config:o}).then((t=>{$("#player_adfox").fadeOut(50,(function(){$("#player"+e).fadeIn(50),$("#player_adfox").remove()})),null!==r&&r.paused&&r.play()}),(t=>{$("#player_adfox").fadeOut(50,(function(){$("#player"+e).fadeIn(50),$("#player_adfox").remove()})),null!==r&&r.paused&&r.play()}))}}}}let scrollEventTimer=null,playerEventScroll=!1;window.addEventListener("scroll",(()=>{null!==scrollEventTimer&&(clearTimeout(scrollEventTimer),playerEventScroll=!0),scrollEventTimer=setTimeout((()=>{playerEventScroll=!1,null!==currentVideo&&currentVideo.id!==lastVideoIdInView&&(void 0===videos.at(lastVideoIdInView)?playerAutoplayTimer(lastVideoIdInView):playerReplayTimer(lastVideoIdInView))}),250)}),!1);</script>
</body>
</html>
