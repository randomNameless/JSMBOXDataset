<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.html</title>
</head>
<body>

<script>
"use strict";var d2c,__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),a=0;for(n=0;n<e;n++)for(var r=arguments[n],o=0,c=r.length;o<c;o++,a++)i[a]=r[o];return i},__extends=this&&this.__extends||function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){!function(t){var n=function(){function n(){this._scheme="https:",this._preRequestPath="/id/nidan/pre",this._receiveRequestPath="/id/nidan/receiver",this._storageKey="__nidan_id",this._paramKey="__did__",this._dadSyncUrl="https://nidan.addlv.smt.docomo.ne.jp/id/daisy/sync",this._nidanIDRequiredLength=80;var n=window;if(n._d2c_nidan_option&&"object"==typeof n._d2c_nidan_option){var e=n._d2c_nidan_option,i=e.scheme;i&&("https:"!==i&&"http:"!==i||(this._scheme=i));var a=e.preRequestPath;a&&(this._preRequestPath=a);var r=e.storageKey;r&&(this._storageKey=r);var o=e.dadSyncUrl;o&&(this._dadSyncUrl=o),t.util.log(this)}}return Object.defineProperty(n.prototype,"scheme",{get:function(){return this._scheme+"//"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"preRequestPath",{get:function(){return this._preRequestPath},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"receiveRequestPath",{get:function(){return this._receiveRequestPath},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"storageKey",{get:function(){return this._storageKey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"paramKey",{get:function(){return this._paramKey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"dadSyncURL",{get:function(){return this._dadSyncUrl},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nidanIDRequiredLength",{get:function(){return this._nidanIDRequiredLength},enumerable:!1,configurable:!0}),n}();t.Environment=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){!function(t){t.getRandomString=function(t){for(var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=n.length,i="",a=0;a<t;a++)i+=n[Math.floor(Math.random()*e)];return i},t.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n]}}(t.util||(t.util={}))}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var n=function(){function n(){this.nidanId="",this.daisyId="",this.completeDaisySync=!1,this.requestedDaisySync=!1,this.completeNidanSync=!1,this.environment=new t.Environment,this.nidanDomain="",this.notifyCallbacksForNidanID=[],this.notifyCallbacksForNidanAndDadUID=[],this.requestOrigin="",this.nidanDomain=t.domain.replace("/",""),this.requestOrigin=window.location.origin}return n.prototype.getPreURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.preRequestPath},n.prototype.getReceiverURL=function(){return this.environment.scheme+this.nidanDomain+this.environment.receiveRequestPath},n}();t.NidanContext=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var n=function(){function t(t){this._isComplete=!1,this._next=t}return t.prototype.setNext=function(t){this._next=t},t.prototype.isComplete=function(){return this._isComplete},t.prototype.complete=function(t){var n;this._isComplete=!0,null===(n=this._next)||void 0===n||n.start(t)},t}();t.Task=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var n=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.start=function(n){for(t.util.log("EventStart");n.notifyCallbacksForNidanAndDadUID.length>0;){n.notifyCallbacksForNidanAndDadUID.pop()(n.nidanId,n.daisyId)}t.util.log("EventStart"),this.complete(n)},e}(t.Task);t.DadUIDNotifyTask=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(n){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.start=function(t){n.util.log("request start DadUIDSync");var e=n.util.getRandomString(10);this.setReceiverFunc(t,e),this.addRequest(t,e),n.util.log("DadUIDSync append child"),n.util.log("request end DadUIDSync")},i.prototype.addRequest=function(t,n){var e=document.createElement("script"),i=new URL(t.environment.dadSyncURL);i.searchParams.append("callback",'d2c.nidan.receivers["'+n+'"]'),e.src=i.toString(),document.head.appendChild(e)},i.prototype.setReceiverFunc=function(e,i){var a=this;t.nidan.receivers[i]=function(t){n.util.log("response DadUIDSync start"),t&&(e.daisyId=t),e.completeDaisySync=!0,a.complete(e),n.util.log("response DadUIDSync end")}},i}(n.Task);n.DadUIDSyncTask=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(n){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.prototype.start=function(t){var e=this.getNidanId(t);if(""!==e)t.nidanId=e,t.completeNidanSync=!0,this.complete(t);else{n.util.log("NidanPre Append");var i=n.util.getRandomString(10);this.setReceiverFunc(t,i),this.addPreRequest(t,i)}},i.prototype.addPreRequest=function(t,n){this.addRequest(t.getPreURL(),t,n)},i.prototype.addReceiverRequest=function(t,n){this.addRequest(t.getReceiverURL(),t,n)},i.prototype.addRequest=function(t,n,e){var i=document.createElement("script"),a=new URL(t);a.searchParams.append("callback",'d2c.nidan.receivers["'+e+'"]'),a.searchParams.append("nocache",(new Date).getTime().toString()),a.searchParams.append("origin",n.requestOrigin),""!==n.nidanId&&a.searchParams.append("nidanid",n.nidanId),i.src=a.toString(),document.head.appendChild(i)},i.prototype.setReceiverFunc=function(e,i){var a=this;t.nidan.receivers[i]=function(t){for(n.util.log("Nidan Pre Receiver Start"),t&&""!==t&&(e.nidanId=t,localStorage.setItem(e.environment.storageKey,t)),e.completeNidanSync=!0;e.notifyCallbacksForNidanID.length>0;){e.notifyCallbacksForNidanID.pop()(e.nidanId,e.daisyId)}a.complete(e),a.publicationCookieDeleteRequest(e)}},i.prototype.publicationCookieDeleteRequest=function(e){var i=n.util.getRandomString(10);t.nidan.receivers[i]=function(){n.util.log("delete request receive")},this.addReceiverRequest(e,i)},i.prototype.getNidanId=function(t){var n="",e=localStorage.getItem(t.environment.storageKey);"string"==typeof e&&""!==e&&(n=e);var i=window.location.search;if(0===i.length)return n;var a=[];return i.slice(1).split("&").forEach(function(n){var e=n.split("=");2===e.length&&e[0]===t.environment.paramKey&&""!==e[1]&&a.push(e[1])}),1===a.length?(n!==a[0]&&localStorage.setItem(t.environment.storageKey,a[0]),a[0]):n},i}(n.Task);n.NidanSyncTask=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(t){var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.start=function(t){t.completeNidanSync&&t.completeDaisySync&&this.complete(t)},n}(t.Task);t.WaitTask=n}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(n){var e=function(){function e(){this.context=new n.NidanContext;var e=localStorage.getItem(this.context.environment.storageKey),i=new RegExp("^([a-z]|[A-Z]|[0-9]){80}$");if(e&&!i.test(e)&&(n.util.log("browser has invalid acid"),localStorage.removeItem(this.context.environment.storageKey)),t.nidan.receivers||(t.nidan.receivers={}),"string"!=typeof n.domain||""===n.domain)throw new Error("domain required");(new n.NidanSyncTask).start(this.context)}return e.getInstance=function(){return n.manager||(n.manager=new e)},e.prototype.getNidanID=function(t){if(n.util.log("Called:getNidanId"),"function"!=typeof t)throw new Error("callback func require");this.context.completeNidanSync?t(this.context.nidanId):(this.context.notifyCallbacksForNidanID.push(t),n.util.log("キュー数："+this.context.notifyCallbacksForNidanID.length))},e.prototype.getNidanAndDadUID=function(t){var e=this;if("function"!=typeof t)throw new Error("callback func require");if(this.context.completeNidanSync&&this.context.completeDaisySync)return n.util.log("Before Completed. notify callback."),void t(this.context.nidanId,this.context.daisyId);if(this.context.notifyCallbacksForNidanAndDadUID.push(t),n.util.log("Add Queue for NidanAndDadUID. length:"+this.context.notifyCallbacksForNidanAndDadUID.length),!this.context.requestedDaisySync){this.context.requestedDaisySync=!0,n.util.log("Daisy Sync Request Start");var i=new n.DadUIDSyncTask,a=new n.WaitTask;i.setNext(a);var r=new n.DadUIDNotifyTask;a.setNext(r),this.getNidanID(function(t){a.start(e.context)}),i.start(this.context)}},e}();n.NidanIdManager=e}(t.nidan||(t.nidan={}))}(d2c||(d2c={})),function(t){!function(n){n.getId=function(t){n.NidanIdManager.getInstance().getNidanID(t)},n.getIds=function(t){n.NidanIdManager.getInstance().getNidanAndDadUID(t)},setTimeout(function(){for(var e=n.NidanIdManager.getInstance(),i=t.nidan.tasks||Array;i.length>0;)e.getNidanID(i.shift())})}(t.nidan||(t.nidan={}))}(d2c||(d2c={}));
</script>

</body>
</html>
