<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>jquery.play.jw7-next.html</title>
</head>
<body>
<script>/** jquery_ddslick */
!function(e){e.fn.ddslick=function(t){return d[t]?d[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exists."):d.init.apply(this,arguments)};var d={},t={data:[],keepJSONItemsOnTop:!1,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:!0,imagePosition:"left",showSelectedHTML:!0,clickOffToClose:!0,embedCSS:!0,onSelected:function(){}};function i(e,d){var t=e.data("ddslick"),i=e.find(".dd-selected"),n=i.siblings(".dd-selected-value"),s=(e.find(".dd-options"),i.siblings(".dd-pointer"),e.find(".dd-option").eq(d)),l=s.closest("li"),a=t.settings,c=t.settings.data[d];e.find(".dd-option").removeClass("dd-option-selected"),s.addClass("dd-option-selected"),t.selectedIndex=d,t.selectedItem=l,t.selectedData=c,a.showSelectedHTML?i.html((c.imageSrc?'<img class="dd-selected-image'+("right"==a.imagePosition?" dd-image-right":"")+'" src="'+c.imageSrc+'" />':"")+(c.text?'<label class="dd-selected-text">'+c.text+"</label>":"")+(c.description?'<small class="dd-selected-description dd-desc'+(a.truncateDescription?" dd-selected-description-truncated":"")+'" >'+c.description+"</small>":"")):i.html(c.text),n.val(c.value),t.original.val(c.value),e.data("ddslick",t),o(e),function(e){var d=e.find(".dd-select").css("height"),t=e.find(".dd-selected-description"),i=e.find(".dd-selected-image");t.length<=0&&i.length>0&&e.find(".dd-selected-text").css("lineHeight",d)}(e),"function"==typeof a.onSelected&&a.onSelected.call(this,t)}function n(d){var t=d.find(".dd-select"),i=t.siblings(".dd-options"),n=t.find(".dd-pointer"),o=i.is(":visible");e(".dd-click-off-close").not(i).slideUp(50),e(".dd-pointer").removeClass("dd-pointer-up"),t.removeClass("dd-open"),o?(i.slideUp("fast"),n.removeClass("dd-pointer-up"),t.removeClass("dd-open")):(t.addClass("dd-open"),i.slideDown("fast"),n.addClass("dd-pointer-up")),function(d){d.find(".dd-option").each(function(){var t=e(this),i=t.css("height"),n=t.find(".dd-option-description"),o=d.find(".dd-option-image");n.length<=0&&o.length>0&&t.find(".dd-option-text").css("lineHeight",i)})}(d)}function o(e){e.find(".dd-select").removeClass("dd-open"),e.find(".dd-options").slideUp(50),e.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}d.init=function(d){var o=e.extend({},t,d);return e("#css-ddslick").length<=0&&o.embedCSS&&e('<style id="css-ddslick" type="text/css">.dd-select{ border-radius:2px; border:solid 1px #ccc; position:relative; cursor:pointer;}.dd-desc { color:#aaa; display:block; overflow: hidden; font-weight:normal; line-height: 1.4em; }.dd-selected{ overflow:hidden; display:block; padding:10px; font-weight:bold;}.dd-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}.dd-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }.dd-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}.dd-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #ddd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}.dd-option{ padding:10px; display:block; border-bottom:solid 1px #ddd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }.dd-options > li:last-child > .dd-option{ border-bottom:none;}.dd-option:hover{ background:#f3f3f3; color:#000;}.dd-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }.dd-option-selected { background:#f6f6f6; }.dd-option-image, .dd-selected-image { vertical-align:middle; float:left; margin-right:5px; max-width:64px;}.dd-image-right { float:right; margin-right:15px; margin-left:5px;}.dd-container{ position:relative;}​ .dd-selected-text { font-weight:bold}​</style>').appendTo("head"),this.each(function(){var o=e.extend({},t,d),s=e(this);if(!s.data("ddslick")){var l=[];o.data;s.find("option").each(function(){var d=e(this),t=d.data();l.push({text:e.trim(d.text()),value:d.val(),selected:d.is(":selected"),description:t.description,imageSrc:t.imagesrc})}),o.keepJSONItemsOnTop?e.merge(o.data,l):o.data=e.merge(l,o.data);var a=s,c=e("<div>").attr("id",s.attr("id")+"-dd-placeholder");s.replaceWith(c),(s=c).addClass("dd-container").append('<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>').append('<ul class="dd-options"></ul>'),s.find("input.dd-selected-value").attr("id",e(a).attr("id")).attr("name",e(a).attr("name"));l=s.find(".dd-select");var r=s.find(".dd-options");r.css({width:o.width}),l.css({width:o.width,background:o.background}),s.css({width:o.width}),null!=o.height&&r.css({height:o.height,overflow:"auto"}),e.each(o.data,function(e,d){d.selected&&(o.defaultSelectedIndex=e),r.append('<li><a class="dd-option">'+(d.value?' <input class="dd-option-value" type="hidden" value="'+d.value+'" />':"")+(d.imageSrc?' <img class="dd-option-image'+("right"==o.imagePosition?" dd-image-right":"")+'" src="'+d.imageSrc+'" />':"")+(d.text?' <label class="dd-option-text">'+d.text+"</label>":"")+(d.description?' <small class="dd-option-description dd-desc">'+d.description+"</small>":"")+"</a></li>")});var p={settings:o,original:a,selectedIndex:-1,selectedItem:null,selectedData:null};if(s.data("ddslick",p),o.selectText.length>0&&null==o.defaultSelectedIndex)s.find(".dd-selected").html(o.selectText);else{var f=null!=o.defaultSelectedIndex&&o.defaultSelectedIndex>=0&&o.defaultSelectedIndex<o.data.length?o.defaultSelectedIndex:0;i(s,f)}s.find(".dd-select").on("click.ddslick",function(){n(s)}),s.find(".dd-option").on("click.ddslick",function(){i(s,e(this).closest("li").index())}),o.clickOffToClose&&(r.addClass("dd-click-off-close"),s.on("click.ddslick",function(e){e.stopPropagation()}),e("body").on("click",function(){e(".dd-open").removeClass("dd-open"),e(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")}))}})},d.select=function(d){return this.each(function(){var t,n,o;void 0!==d.index&&i(e(this),d.index),d.id&&(t=e(this),n=d.id,o=t.find(".dd-option-value[value= '"+n+"']").parents("li").prevAll().length,i(t,o))})},d.open=function(){return this.each(function(){var d=e(this);d.data("ddslick")&&n(d)})},d.close=function(){return this.each(function(){var d=e(this);d.data("ddslick")&&o(d)})},d.destroy=function(){return this.each(function(){var d=e(this),t=d.data("ddslick");if(t){var i=t.original;d.removeData("ddslick").unbind(".ddslick").replaceWith(i)}})}}(jQuery);
/** Polyfill isArray */
if (!Array.isArray) {Array.isArray = function(arg) {return Object.prototype.toString.call(arg) === '[object Array]';};}
/** SANITIZE */
var HtmlSanitizer=new function(){var e={A:!0,ABBR:!0,B:!0,BLOCKQUOTE:!0,BODY:!0,BR:!0,CENTER:!0,CODE:!0,DIV:!0,EM:!0,FONT:!0,H1:!0,H2:!0,H3:!0,H4:!0,H5:!0,H6:!0,HR:!0,I:!0,IMG:!0,LABEL:!0,LI:!0,OL:!0,P:!0,PRE:!0,SMALL:!0,SOURCE:!0,SPAN:!0,STRONG:!0,TABLE:!0,TBODY:!0,TR:!0,TD:!0,TH:!0,THEAD:!0,UL:!0,U:!0,VIDEO:!0},t={FORM:!0},r={align:!0,color:!0,controls:!0,height:!0,href:!0,src:!0,style:!0,target:!0,title:!0,type:!0,width:!0},n={color:!0,"background-color":!0,"font-size":!0,"text-align":!0,"text-decoration":!0,"font-weight":!0},a=["http:","https:","data:","m-files:","file:","ftp:"],o={href:!0,action:!0};function i(e,t){for(var r=0;r<t.length;r++)if(0==e.indexOf(t[r]))return!0;return!1}this.SanitizeHtml=function(l){if(""==(l=l.trim()))return"";if("<br>"==l)return"";var d=document.createElement("iframe");if(void 0===d.sandbox)return alert("Your browser does not support sandboxed iframes. Please upgrade to a modern browser."),"";d.sandbox="allow-same-origin",d.style.display="none",document.body.appendChild(d);var m=d.contentDocument||d.contentWindow.document;null==m.body&&m.write("<body></body>"),m.body.innerHTML=l;var c=function l(d){if(d.nodeType==Node.TEXT_NODE)var c=d.cloneNode(!0);else if(d.nodeType==Node.ELEMENT_NODE&&(e[d.tagName]||t[d.tagName])){if(("SPAN"==d.tagName||"B"==d.tagName||"I"==d.tagName||"U"==d.tagName)&&""==d.innerHTML.trim())return document.createDocumentFragment();c=t[d.tagName]?m.createElement("DIV"):m.createElement(d.tagName);for(var u=0;u<d.attributes.length;u++){var f=d.attributes[u];if(r[f.name])if("style"==f.name)for(s=0;s<d.style.length;s++){var g=d.style[s];n[g]&&c.style.setProperty(g,d.style.getPropertyValue(g))}else{if(o[f.name]&&f.value.indexOf(":")>-1&&!i(f.value,a))continue;c.setAttribute(f.name,f.value)}}for(u=0;u<d.childNodes.length;u++){var h=l(d.childNodes[u]);c.appendChild(h,!1)}}else c=document.createDocumentFragment();return c}(m.body);return document.body.removeChild(d),c.innerHTML.replace(/<br[^>]*>(\S)/g,"<br>\n$1").replace(/div><div/g,"div>\n<div")},this.AllowedTags=e,this.AllowedAttributes=r,this.AllowedCssStyles=n,this.AllowedSchemas=a};

// String format helper
if (!String.format) {
    String.format = function(format) {
        var args = Array.prototype.slice.call(arguments, 1);
        return format.replace(/{(\d+)}/g, function(match, number) {
            return typeof args[number] != 'undefined'
            ? args[number]
            : match
            ;
        });
    };
}

let continuumVOD = (function(){
    if(!window.localStorage){
        return;
    }
    let KEY = 'resume_play_mmc_';

    function _get(rec_id){
        return localStorage.getItem(KEY + rec_id);
    }

    function _save(rec_id, info){
        localStorage.setItem(KEY + rec_id, info);
    }

    return {
        get: _get,
        save: _save
    }
})();

var DEBUG_ENABLE = false;
var NG_ENABLE = false;
var DEBUG_ON_SERVER = false;
var FORCE_API_PRODUKCIJA = false;
var MMC_PLAYER_ASSETS_V = '20241118' || window.PLAYER_ASSETS_VERSION_NUMBER;

try{
    var bodyClassList = document.body.classList;
    if(bodyClassList.contains('ng-enable')){
        NG_ENABLE = true;
        console.log("🚀NG_ENABLE", NG_ENABLE)
    }
    if(bodyClassList.contains('debug-mode')){
        DEBUG_ENABLE = true;
        console.log("🚀DEBUG_ENABLE", DEBUG_ENABLE)
    }
    if(bodyClassList.contains('sever-debug-mode')){
        DEBUG_ON_SERVER = true;
        console.log("🚀DEBUG_ON_SERVER", DEBUG_ON_SERVER)
    }
}catch(e){/** Legacy browser sanity check */}


function loadFile(path, type, checkId, async) {

    if (document.getElementById(checkId)) return;
    var fileref = null;
    if (type == "js") {
        fileref = document.createElement('script');
        fileref.setAttribute("type", "text/javascript");
        fileref.setAttribute("src", path);
        fileref.setAttribute("id", checkId);
        if(async === true) {
            fileref.setAttribute("async", true);
        }
    } else if (type == "css") {
        fileref = document.createElement("link");
        fileref.setAttribute("rel", "stylesheet");
        fileref.setAttribute("type", "text/css");
        fileref.setAttribute("href", path);
        fileref.setAttribute("id", checkId);
    }
    document.getElementsByTagName("head")[0].appendChild(fileref);
}

function escapeHtml(unsafe)
{
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
}

function is_development() {
    const hostname = window.location.hostname;
    if (hostname.toLowerCase().includes('dev.')) {
        return true;
    }
    return false;
};

function initMux(playerInstance, data) {
    if(typeof data !== 'undefined' && typeof data.response !== 'undefined' && typeof data.response.id !== 'undefined' && data.response.id != 'ra.val202') {
        return;
    }
    
    let video_id = '';
    let video_title = '';
    let video_stream_type = 'live';
    if(typeof data !== 'undefined' && typeof data.response !== 'undefined' && typeof data.response.category !== 'undefined' &&  data.response.category == 'live') {
        if(data.response.category != 'live') {
            video_stream_type = 'on-demand';
        }
        if(data.response.id !== 'undefined') {
            video_id = data.response.id; 
        }
        if(data.response.mediaType !== 'undefined' && data.response.source !== 'undefined') {
            video_title = data.response.source + ' - ' + data.response.mediaType;
        }
    }
    else if(typeof data !== 'undefined' && typeof data.response !== 'undefined' && typeof data.response.id !== 'undefined') {
        video_id = data.response.id;
        if(data.response.title !== 'undefined' && data.response.showName !== 'undefined') {
            video_title = data.response.title + ' - ' + data.response.showName;
        }
    }

    if(video_stream_type === 'live') {
        if(typeof initJWPlayerMux !== 'undefined') {
            const playerInitTime = Date.now();
            console.log('Mux init success.', playerInitTime);   
            initJWPlayerMux(playerInstance, {
                debug: false,
                automaticErrorTracking: false,
                data: {
                    env_key: 'qgceprj8mgous92q2h3tsul15', // production         
                    // Metadata
                    player_name: 'MMCplayer', // ex: 'My Main Player'
                    player_init_time: playerInitTime, // ex: 1451606400000
                    video_id: video_id,
                    video_title: video_title,
                    video_stream_type: video_stream_type
    
                }
            });
        }
    }
}


loadFile('https://img.rtvslo.si/_static/r' + MMC_PLAYER_ASSETS_V +'/rtv4d/jw7/assets/css/4d-next.css', 'css', 'rtv4dplayercss');
if(window.location.href.indexOf('zkp.rtvslo.si') > -1)  {
    loadFile('https://img.rtvslo.si/_static/r' + MMC_PLAYER_ASSETS_V +'/rtv4d/jw7/assets/css/zkp.css', 'css', 'zkpcss');
}


if(typeof window._paq === 'undefined') {
    var _paq = window._paq = window._paq || [];
    (function() {
        var u="//matomo.rtvslo.si/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '15']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
    //loadFile('https://matomo.rtvslo.si/matomo.js', 'js', 'matomojs',true);
}


if (typeof $4D !== 'undefined') {
    //console.log('4d');
    jQuery = $4D;
}
(function($, matchRecordingId) {

    let userInteractionValue = false;//This prevent autostart of video on page load
    function handleSingleUserInteraction() {
        document.cookie = "userInteraction=true; path=/";
        // Remove the event listener
        document.removeEventListener('click', handleSingleUserInteraction);
        //read cookie
        let userInteraction = document.cookie.replace(/(?:(?:^|.*;\s*)userInteraction\s*\=\s*([^;]*).*$)|^.*$/, "$1");
        //console.log('userInteraction', userInteraction);
        // Set the userInteractionValue
        userInteractionValue = (userInteraction === 'true');
    }
  
      // Add the event listener
    document.addEventListener('click', handleSingleUserInteraction);
    //delete cookie if direct page load with now history
    if(window.performance && window.performance.navigation.type == 1) {
        document.cookie = "userInteraction=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }
      
      Object.defineProperty(window, 'getUserInteraction', {
        get: function() {
            //check if cookie is set
            if(userInteractionValue === false) {
                let userInteraction = document.cookie.replace(/(?:(?:^|.*;\s*)userInteraction\s*\=\s*([^;]*).*$)|^.*$/, "$1");
                if(userInteraction === 'true') {
                    userInteractionValue = true;
                }
            }
          return userInteractionValue;
        }
      });
  
      // Setter
      Object.defineProperty(window, 'setUserInteraction', {
        set: function(value) {
          userInteractionValue = value;
          document.cookie = `userInteraction=${value}; path=/`;
        }
      });

    const API_CLIENT_ID = "82013fb3a531d5414f478747c1aca622";
    const cookieSIGN_LANG = 'rtv.SIGN_LANG';
    const cookieSOUND_DESCR = 'rtv.SOUND_DESCRIPTION';
    const ITALIAN = window.CAPODISTRIA_APP_MOBILE_IS_SET || false;
    const HUN = window.HUN_LANG_ENABLE || false;
    const abouttext = 'Deyk. - 20240508';

    const SORODNO_ITEMS_PER_PAGE = 30;
    const SORODNO_CLIPS_ITEMS_PER_PAGE = 30;

    const INTERVAL_IN_S = 60;
    const TRANSLATE_LIVE_CHANNELS = { //for video stats
        'ra.a1': 'ra.a1.video',
        'ra.val202': 'ra.val202.video',
        'ra.ars': 'ra.ars.video',
        'ra.mb1': 'ra.mb1.video',
        'ra.kp': 'ra.kp.video',
    }
    //DONT CHANGE THIS ORDER OR HELL WILL RAPTURE
    const LIVE_CHANNELS = [
                            'tv.slo1', // Stats index 1
                            'tv.slo2', 
                            'tv.slo3', 
                            'tv.kp1', 
                            'tv.mb1', 
                            'tv.mmctv',
                            'ra.a1',
                            'ra.val202',
                            'ra.ars',
                            'ra.mb1',
                            'ra.rsi',
                            'ra.kp',
                            'ra.capo',
                            'ra.mmr',
                            'tv.slo1a', 
                            'rez.1',
                            'rez.2',
                            'tv.mmctv2',
                            'ra.raz',
                            'ra.202sport',
                            'ra.a1.video',
                            'ra.val202.video',
                            'ra.ars.video', 
                            'ra.mb1.video',
                            'ra.kp.video', //Stats index 25
                        ];
    var LANGUAGE = "SLO";
    var lang = {
        recommend : "Všeč mi je",
        recommended: "Priporočeno!",
        removed: "Odstranjeno…",
        save: "Shrani",
        add_to_my_list:"Dodano med moje.",
        removed_from_my_list:"Odstranjeno iz seznama.",
        not_logged_in:"Niste prijavljeni!",
        logged_successfully:"Prijavljen",
        link:"Deli",
        copy_link:"Kopiraj povezavo ob časovni kodi",
        link_saved:"Povezava uspešno shranjena v odložišče!",
        epizodes:"Prispevki ",
        views:"ogledov",
        other_epizodes:"Drugi prispevki",
        my_shows_and_epizodes:"Moje oddaje in prispevki",
        close:"Zapri",
        search:"Išči",
        search_resultes:"Rezultati iskanja",
        automatic:"Samodejno",
        audio_translation:"Avdio prevod",
        copied:"Kopirano",
        more:"Več",
        podcast_subscribe: "Naroči se na podkast"
    };
  
    if(ITALIAN){
        LANGUAGE = "ITA";
        lang = {
            recommend : "Suggerisci",
            recommended: "Suggerito!",
            removed: "Rimosso…",
            save: "Salva",
            add_to_my_list:"Aggiunto tra le mie.",
            removed_from_my_list:"Rimosso dall'elenco.",
            not_logged_in:"Non sei iscritto!",
            logged_successfully:"Iscritto",
            link:"Condividi",
            copy_link:"Copia il link accanto al codice temporale",
            link_saved:"Link salvato con successo negli appunti!",
            epizodes:"Servizi ",
            views:"Visualizzazioni",
            other_epizodes:"Altri servizi",
            my_shows_and_epizodes:"Le mie trasmissioni e i miei servizi",
            close:"Chiudi",
            search:"Cerca",
            search_resultes:"Risultati della ricerca",
            automatic:"Automaticamente",
            audio_translation:"Traduzione audio",
            copied:"Copiato",
            more:"Di più",
            podcast_subscribe: "Iscriviti al podcast"
        };
    }
    if(HUN){
        LANGUAGE = "HUN";
        lang = {
            recommend : "Megoszotom",
            recommended: "Megosztva",
            removed: "Eltávolítva…",
            save: "Mentés",
            add_to_my_list:"Hozzáadás a kedvenceimhez",
            removed_from_my_list:"Eltávolítva a listából.",
            not_logged_in:"Nincs bejelentkezve!",
            logged_successfully:"Bejelentkezve",
            link:"Link",
            copy_link:"Link másolása az időkódhoz",
            link_saved:"A linket sikeresen mentette a vágólapra!",
            epizodes:"Összeállítások ",
            views:"megtekintés",
            other_epizodes:"Egyéb összeállítások",
            my_shows_and_epizodes:"Adásaim és összeállításaim",
            close:"Bezárás",
            search:"Keresés",
            search_resultes:"Találatok",
            automatic:"Autómatikusan",
            audio_translation:"Audió fordítás",
            copied:"Másolva",
            more:"További tartalmak",
            podcast_subscribe: "Feliratkozás a podcastra"
        };
    }
    
   

    let isMobile = 0; //initiate as false
    // device detection
    if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) ||
        /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) {
        isMobile = 1;
    }

    var HTTP = 'http://';
    var HTTPS = 'https://';
    var PROTOCOL = 'https:' == document.location.protocol ? HTTPS : HTTP;
    var IOS_RTVSLO_SI_SERVER = PROTOCOL + '5862e89255007.streamlock.net';
    var STREAM_RTVSLO_SI_SERVER = PROTOCOL + '585ddcf1f3493.streamlock.net';
    const VIEWPORT_WIDTH = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)
    //console.log('VIEWPORT_WIDTH', VIEWPORT_WIDTH);


    //Ob prehoodu na ssl se uporabi drugi endpoint dokler se ne proklopimo na nov property
    function replaceEndpointHLS(original) {

        if (typeof original !== 'string' || PROTOCOL === HTTP) {
            return original;
        }

        var hls = original.replace('http://', '').replace('https://', ''); //remove protocol;
        var needle = hls.split('/');
        if (needle.length > 0) {
            hls = hls.replace(needle[0], '');
            return STREAM_RTVSLO_SI_SERVER + hls;
        } else {
            return original;
        }

    }

    function forceSLL(original) {
        var HTTP_CONST = 'http://';
        var HTTPS_CONST = 'https://';
        var PROTOCOL_CONST = 'https:' == document.location.protocol ? HTTPS_CONST : HTTP_CONST;
        if (typeof original !== 'string' || PROTOCOL_CONST === HTTP_CONST) {
            return original;
        }
        return original.replace('http://', 'https://');
    }

    const EVENT_TYPE_REC_DATA = 'REC_DATA';
    const EVENT_TYPE_LAST_SHOWS = 'LAST_SHOWS';
    const EVENT_PLAYLIST_NEXT = 'EVENT_PLAYLIST_NEXT';
    const EVENT_TYPE_SHOW_CHILDREN = 'SHOW_CHILDREN';
    /**
     * 
     * @param {dom instance string} id 
     * @param {type : string} type 
     * @param {data : object} data 
     */
    function _dispatchCustomEvent(type, data) 
    {
              
        const DOM_HANDLE = '#messaging-broker-rtv4d';
        const HANDLE = 'EVENT_HANDLE_JWPLAYER_CUSTOM_EVENTS';
        try {          
            let myEvent = new CustomEvent(HANDLE, {
                detail: {
                    type: type,
                    data: data
                },
                bubbles: true,
                cancelable: true,
                composed: false,
            });  
            var el = document.querySelector(DOM_HANDLE)
            if(el) {
                el.dispatchEvent(myEvent);
            }
            
        }
        catch(e) {
            console.log('unable to dispatch evenet', e);
        }     
    }

    function fetchLinearAdd(player, type, source) 
    {
        var timestamp = Math.floor(Date.now() / 1000);
        let url = "https://core.iprom.net/vast?sitePath=[%22rtvslo%22,%22stirid_arhiv%22]&zones=[90]&time=["+timestamp+"]";   

        if(type === 'live') {
            url = rtvdef.get_live_linear(source);
        }
        else if(type === 'archive') {
            url = rtvdef.get_arhiv_linear(source);
        }
        console.log('fetchLinearAdd', url);
        
        let player_parent = '#' + player; 
        if(!document.querySelector(player_parent)) {
            console.log('Player parent not found');
            return;
        }

        // Remove any existing VAST div if it exists
        let existingVastDiv = document.querySelector(player + '_vast');
        if (existingVastDiv) {
            existingVastDiv.remove();
        }

        //add placeholder div for vast before player_parent
        let vastDiv = document.createElement('div');
        vastDiv.id = player + '_vast';
        //add to DOM before player_parent if not exists
        if(!document.querySelector(player_parent + '_vast')) {
            document.querySelector(player_parent).insertAfter(vastDiv, document.querySelector(player_parent).firstChild);
        }   
        let player_parent_vast = '#' + vastDiv.id;    //use fetch to get the VAST response
        fetch(url, {
            credentials: 'include',
        }).then(function(response) {  
                // The API call was successful!
                return response.text();
            }).then(function(xml) {

                    let parser = new DOMParser();
                    let xmlDoc = parser.parseFromString(xml, "text/xml");

                    let Ad = xmlDoc.getElementsByTagName('Ad');
                    if(!Ad) {
                        console.log('NO_VAST');
                        return;
                    }
                                           
                    let adservers = [];
                    
                    let externalAdServer = xmlDoc.getElementById('externalAdServer');
                    if(externalAdServer) {
                        externalAdServer = externalAdServer.innerHTML;
                        adservers.push(externalAdServer);
                    }

                    let internalAddServer = xmlDoc.getElementById('iPROM Core9');
                    if(internalAddServer) {
                        internalAddServer = internalAddServer.innerHTML;
                        //how to remoce CDATA from string
                        internalAddServer = internalAddServer.replace('<![CDATA[', '').replace(']]>', '');
                        adservers.push(internalAddServer);
                    }

                    let clickThrough = xmlDoc.getElementsByTagName('NonLinearClickThrough')
                    if(clickThrough && clickThrough[0]) {
                        clickThrough = clickThrough[0].innerHTML;
                        clickThrough = clickThrough.replace('<![CDATA[', '').replace(']]>', '');       
                    }
                    
                    // Regular expression to match <![CDATA[ ... ]]> and extract the content
                    const cdataRegex = /<!\[CDATA\[(.*?)\]\]>/g;
                    // Function to extract links
                    function extractLinks(xmlString) {
                        const matches = xmlString.matchAll(cdataRegex);
                        const links = [];
                        for (const match of matches) {
                            // match[1] contains the content inside CDATA
                            if (match[1].startsWith("http")) {
                                links.push(match[1]);
                            }
                        }
                        return links;
                    }                
                    function extractStaticResourceLinks(xmlString) {
                        const regex = /<StaticResource creativeType="image">(.*?)<\/StaticResource>/g;
                        const links = [];
                        let match;        
                        while ((match = regex.exec(xmlString)) !== null) {
                            links.push(match[1].trim());
                        }
                        return links;
                    }

                    const links = extractLinks(xml);

                    if(!clickThrough) {
                        let link = links.filter(function(itm){
                            if (itm.indexOf('https://core.iprom.net/Click') > -1){
                                return itm;
                            }
                        });
                        if(link.length > 0) {
                            clickThrough = link[0];
                        }
                    }

                    if(!clickThrough) {
                        console.log('link not found');
                        return;
                    }

                    if(adservers.length === 0) {
                        console.log('adservers not found');
                        return;
                    }
                   

                    //console.log('adservers', adservers);
                    //console.log('clickThrough', clickThrough);
                    
                    const creatives = extractStaticResourceLinks(xml);
                    //check if array is not empty
                    if (creatives.length === 0)return;
            
                    //find #player_01_vast object and attach creatives[0] as image to center 
                    let vastImage = document.createElement('img');
                    //ckeck if vast img is image url
                    if (creatives[0].indexOf('https') === -1){
                        return
                    }
                
                    vastImage.src = creatives[0];
                    //show full screen as cover
                    vastImage.style.width = '100%';
                
                    vastImage.style.position = 'absolute';
                    vastImage.style.top = '0';
                    vastImage.style.left = '0';
                    // add pointer
                    vastImage.style.cursor = 'pointer';                
                    //image can be clicked add link
                    vastImage.addEventListener('click', function(){
                        window.open(clickThrough, '_blank');
                    });               
                    document.querySelector(player_parent_vast).appendChild(vastImage);
                    let closeBtn = '10px';
                    let fontSize =  '1rem';
                    let fontWeight = '400';
                    let closeBtnTXT = 'Zapri oglas';
                    if (isMobile) {
                        closeBtn = '-55px';
                        fontSize =  '0.75rem';
                        closeBtnTXT = '<span class="icon icon-play mr-2"></span> Zapri oglas';
                        document.querySelector(player_parent_vast).style['z-index'] = 1;
                    }                
                    //add close button
                    const closeButton = document.createElement('div');
                    closeButton.style.width = '100px';
                    closeButton.style.height = '30px';
                    closeButton.style.position = 'absolute';
                    closeButton.style.bottom = closeBtn;
                    closeButton.style.right = '15px';
                    closeButton.style.backgroundColor = 'rgb(255, 255, 255)';
                
                    closeButton.style.cursor = 'pointer';
                    //font weight light
                    closeButton.style.fontWeight = fontWeight;
                    closeButton.style.display = 'flex';
                    closeButton.style.justifyContent = 'center';
                    closeButton.style.alignItems = 'center';
                    closeButton.style.color = '#000';
                    closeButton.style.fontSize = fontSize;
                    //font-family: Roboto,-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;
                    closeButton.style.fontFamily = 'Roboto,-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif';      
                    closeButton.innerHTML = closeBtnTXT;
                    
                    document.querySelector(player_parent_vast).appendChild(closeButton);   

                    adservers.forEach(function(itm){
                        fetch(itm,
                            {
                                credentials: 'include',
                                mode: 'no-cors'
                            })
                            .then(function(response) {
                                // The API call was successful!
                        }).catch(function(err) {});
                    });

                    closeButton.addEventListener('click', function(){
                        document.querySelector(player_parent_vast).innerHTML = '';
                        if(jwplayer) {
                            jwplayer(player).setControls(true);
                            if(isMobile)jwplayer(player).play();
                        }           
                    });
            
            }).catch(function(err) {
                // There was an error
                //console.warn('Something went wrong.', err);
            });
    }



    $.fn.playVod = function(id, options, isShowItem, isPopup) {

        //console.log(id, options, isShowItem, isPopup);

        var info = {};
        info.horizontalVolumeSlider = true;

        if(options && options.render && options.render === 'inline-audio-podcast' || options.render === 'inline-audio'){
            options['client'] = API_CLIENT_ID;
            var wi = $(this).parent().width();
            options["width"] =  wi;
            options["height"] = 30;///MUST BE 30px - jw makes it work
            options["stretching"] = 'fill';
            options["image"] = '';
            options["toolbar"] = false; 
            options["noads"] = 1; 
            document.body.classList.add('jw-podcast-inline-audio');               
        }

        if(options && options.render && options.render === 'inline-audio-podcast-mobile'){
            options['client'] = API_CLIENT_ID;
            //get screen width
            var wi = document.documentElement.clientWidth - 48;
            options["width"] =  wi;
            options["height"] = 30;///MUST BE 30px - jw makes it work
            options["stretching"] = 'fill';
            options["image"] = '';
            options["toolbar"] = false;  
            options["noads"] = 1; 
        }
        
        if(options && options.render && options.render === 'square-audio'){
            options["aspectratio"] = "1:1",
            options["toolbar"] = false;  
            info.horizontalVolumeSlider = false;   
            options["noads"] = 1; 
        }

        var isPopup = isPopup || false;
        document.body.classList.remove("live4d-playing-now");

        if($("#rtv4d_popup").length && NG_ENABLE){
            $("#rtv4d_popup").removeClass('show-list');
        }

        if (isShowItem && options) {
            var promoOptions = {
                'promo': 1,
                'mute': 1,
                'noads': 1,
                'autostart': 'true',
                'width': '100%',
                'height': '',
            };
            options = $.extend({}, options, promoOptions);
        }
        
        if(isPopup && options) {
            var exstra =  {
                'popup': true,
            };
            options = $.extend({}, options, exstra);
        }

        var video = $.extend({}, defaults, options, rtvdef);

        

        var container = $(this);

        if (typeof video.promo === 'undefined') {
            video.promo = 0;
        }
        
        if (typeof video.autostart !== 'string') {
            video.autostart = video.autostart.toString();
        }

        let disableAds = false;

        if (typeof video.disableAds !== 'undefined' && video.disableAds == "true") {
            disableAds = true;
        }
        else if (typeof video.disableAds !== 'undefined' && video.disableAds == 1) {
            disableAds = true;
        }
        else if (typeof video.noads !== 'undefined' && video.noads == 1) {
            disableAds = true;
        }

        if(window.location.href.indexOf("dostopno") > -1) {
            disableAds = true;
        } 
        
        info.recordingId = id;
        info.width = video.width;
        info.height = video.height;
        info.mute = (typeof video.mute !== 'undefined' && video.mute == 1) ? "true" : "false";
        info.controls = (typeof video.hidecontrols !== 'undefined' && video.hidecontrols == 1) ? "false" : "true";
        info.showsubtitles = (typeof video.showsubtitles !== 'undefined' && video.showsubtitles == 0) ? 'false' : 'true';


        let autostart = false;
        //console.log('getUserInteraction', getUserInteraction);
        //console.log('video.autostart', video.autostart);
        if(video.autostart == 'true' && getUserInteraction){  
            autostart = true;
        }

        info.primary = "html5";
        info.hlshtml = "true";
        info.autostart = autostart;
        info.stretching = video.stretching;
        info.disableAds = disableAds;
        //info.visualplaylist = false;
        info.nextupoffset = 0;
        info.abouttext = abouttext;
        //info.aboutlink = '/?t=20';
        info.videoInfo = lang.copy_link;

        info.aspectratio = (typeof video.aspectratio !== 'undefined') ? video.aspectratio: "16:9";

        info.playbackRateControls = [0.5, 0.75, 1, 1.25, 1.5];

        info.hlsjsConfig = {
            debug: false
        }

        if(typeof video !== 'undefined' && typeof video.image !== 'undefined'){
            if(typeof video.image === 'string' && video.image.indexOf('https://') > -1) {
                info.image = video.image;
            }
        }

        info.cast = {
            customAppId: "9BCE1FE3"
        }

        info.timeSlider = {
            "legacy": true,
            "preferChapterImages": false,
            "showKnob": true,
            "showAdMarkers": false
        }
        

        //Force audio player to 40px height. Used in embed
        /* show only 40px controls*/
        if (typeof video.smallVod !== 'undefined' && video.smallVod == 'true') {
            info.width = $(this).width();
            info.height = '40';
        }

        var logo = getLogo(video, "");
        if (logo !== false) {
            info.logo = logo;
        }

        info.sharing = {
            link: ''
        }    

        info.advertising = {
            client: 'vast',
            skipoffset: 7,
            vpaidcontrols: true
        }

       
        if(ITALIAN){
             
        }
        else if(HUN){
            info.advertising = {
                skipmessage: 'Hirdetés átugrása XXs múlva',
                admessage: 'A hirdetés végéig: XXs.',
                skiptext: 'Hirdetés átugrása',
                cuetext: 'Hirdetés'
            }
            
            info.localization = {
                nextUp: 'Következő felvétel',
                playlist: 'Lejátszási listák',
                related: 'Lejátszási lista',
                playback: 'Lejátszás',
                play: 'Lejátszás',
                pause: 'Szünet',
                volume: 'Hangerő',
                prev: 'Vissza',
                next: 'Előre',
                cast: 'Chromecast',
                fullscreen: 'Teljes képernyő',
                hd: 'Felbontás',
                cc: 'Feliratok',
                audioTracks: 'Hangsáv',
                replay: 'Újrajátszás',
                buffer: 'Betöltés',
                more: 'Több',
                liveBroadcast: 'Élő',
                notLive: 'Késleltetés',
                loadingAd: 'Hirdetés betöltése',
                rewind: 'Vissza 10s',
                nextUpClose: 'Bezárás',
                videoInfo: 'Info',
                shortcuts: {
                    keyboardShortcuts: 'Billentyűparancsok'
                },
                sharing: {
                    link: lang.link,
                    facebook: 'Facebook',
                    twitter: 'Twitter',
                    heading: 'Megosztás'
                } 
            }
        }
        else{
            info.localization = {      
                notLive: 'Zamik', 
                liveBroadcast: 'Živo'        
            }
        }


        try {
            if (typeof video.playfile === "object" && video.playfile !== null) {
                return playFiles(container, info, video);
            }

            if (typeof video.playlistXML === "string" && video.playlistXML !== null) {
                info.playlist = video.playlistXML;
                data = {};
                data.response = {};
                data.response.mediaType = "video";
                return showPlayer(container, data, info, video);
            }
        } catch (e) {
            return console.log(e);
        };
       

        var endpoint = "/ava/getRecordingDrm/";
        if (isShowItem) {
            endpoint = "/ava/getLastRecordingByShowId/";
        }
        var url = getApiEndPoint(DEBUG_ENABLE) + endpoint + id + "?client_id=" + API_CLIENT_ID;

        
        $.ajaxSetup({xhrFields: { withCredentials: true } });

        let subtitles = (function get_subtitles() {
            if (is_development()) {
                var url = getApiEndPoint(DEBUG_ENABLE) + '/ava/subtitles/' + id + "?client_id=" + API_CLIENT_ID;    
                var data = null;
                $.ajax({
                    url: url,
                    async: false, 
                    dataType: 'json',
                    success: function (json) {
                        data = json;
                    },
                    error: function (request, status, error) {
                        console.log(error);
                    }
                });
                
                if (data.hasOwnProperty('response')) {
                    //console.log(data.response); // debug printout
                    return data.response;
                }
                return null; // default

            } else { // PROD
                return null;
            }
        })();
      

        return $.ajax({
            url: url,
            data: {
                "client_id": video.client
            },
            dataType: 'jsonp',
            cache: 'false',
            jsonpCallback: function() {
                var random = Math.floor(Math.random() * 1000);
                return 'ava_' + random;
            },
            success: function(data) {

                if (data.response && !data.response.subtitles) {
                    if (subtitles && subtitles.length > 0) {
                        data.response.subtitles = subtitles;
                    }
                }
                
                if(data && data.response && data.response.jwt) {
                    getMedia(data,video, data.response.jwt, begin);
                }
                else {
                    begin(data);
                }
                
                function getMedia(data, video, jwt, clb){

                    //console.log("data ", data);
                    var url = getApiEndPoint(DEBUG_ENABLE);
                    $.ajaxSetup({xhrFields: { withCredentials: true } });
                    $.ajax({
                        url: url + "/ava/getMedia/" + data.response.id,
                        data: {
                            "client_id": API_CLIENT_ID,
                            "jwt": jwt
                        },
                        dataType: 'jsonp',
                        cache: 'false',
                        jsonpCallback: function() {
                            var random = Math.floor(Math.random() * 1000);
                            return 'ava_' + random;
                        },
                        success: function(streams) {

                            if(!streams.error){

                                if(streams.response && streams.response.addaptiveMedia){
                                    data.response.addaptiveMedia = streams.response.addaptiveMedia;
                                }
                                if(streams.response && streams.response.addaptiveMedia_sl){
                                    data.response.addaptiveMedia_sl = streams.response.addaptiveMedia_sl;
                                }
                                if(streams.response && streams.response.mediaFiles){
                                    if(clb){
                                      
                                        data.response.mediaFiles = [];
    
                                        streams.response.mediaFiles.map(function(item){
                                            data.response.mediaFiles.push(item);
                                        });
                                        
                                       
                                        clb(data);
                                    }
                                }
                            }
                            else{
                                begin(streams);
                            }             
                        }
                    });
                }

                function begin(data) {
                    //PUSH TO IOS
                    if(data && data.response ) {
                       try
                       {
                            var mediaType = "archiveTV";
                            var url = "";
                            if(data.response.addaptiveMedia && data.response.addaptiveMedia.hls_sec) {
                                url =  data.response.addaptiveMedia.hls_sec;
                            } 
                            else { 
                                mediaType = "archiveRA";
                                url = data.response.mediaFiles[0].streams.https;
                            }
                            var title = data.response.title;
                            var subtitle = data.response.showName;
                            var poster = data.response.thumbnail_sec;
                           
                            var packet = [mediaType, url, poster, title, subtitle];
                            packet = packet.join('|');
                            //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 576 ~ getMedia ~ packet", packet);         
                            if (parent && document.cookie && document.cookie.indexOf("showIosNative=true") != -1) {                      
                                parent.postMessage("rtv4d::" + packet,"*");
                            }
                        }
                        catch(e) {
                            //console.log('packet ios e:', e);
                        }

                        if(_dispatchCustomEvent) {
                            _dispatchCustomEvent(EVENT_TYPE_REC_DATA, data.response);
                        }            
                    }

                    if (typeof data.error !== 'undefined' || data.response == false) {
                        if (typeof jwplayer === "function") {
                            try {
                          
                                video.playfile = {
                                    //"rtmp": (video.streamer["rtmp"] + "/mp4:" + video.preroll["dummy"]["rtmp"]),
                                    "html5": (video.streamer["html5"] + video.preroll["dummy"]["html5"])
                                };
                              
                                return playFiles(container, info, video);
                            } catch (e) {
                                console.log(e);
                            }
                        }
                        if (video.callback) {
                            if (typeof video.callback === 'string') {
                                var fn = window[video.callback];
                                if (typeof fn === 'function') {
                                    return fn(data);
                                }
                            } else {
                                var callbacks = $.Callbacks();
                                callbacks.add(video.callback);
                                return callbacks.fire(data);
                            }
                        }
                        //console.log(data.error);
                        return false;
                    }

                    var logo = getLogo(video, data);
                    if (logo !== false) {
                        info.logo = logo;
                    }

                    
                   

                    if (data.response.showTypeId == 70 || data.response.showTypeId == 71) {
                        info.advertising.skipoffset = 7;
                        info.advertising.skipmessage = 'Še xxs';
                        info.advertising.skiptext = 'Preskoči';
                    }

                   

                    if (data && data.response && data.response.noAds && data.response.noAds == 1) {
                        info.disableAds = true;
                    }

                    //23.3 - neprijavljeni ki se jim posnetek ne zrola ne prikažemo reklam
                    if (typeof data.response.showLoginPopup !== 'undefined' && data.response.showLoginPopup == "1") {
                        info.disableAds = true;
                        info.showLoginPopup = data.response.showLoginPopup;
                    }

                    //25.2.20 - neprijavljeni ki se jim posnetek ne zrola ne prikažemo reklam
                    if (typeof data.response.publicExpirationDatePopup !== 'undefined' && data.response.publicExpirationDatePopup == "1") {
                        info.disableAds = true;
                        info.publicExpirationDatePopup = data.response.publicExpirationDatePopup;
                    }

                   
                    if(typeof window._paq !== 'undefined') {          
                        _paq.push(['setSiteId', 15]);//SET TO MMC JWPLAYER  
                        if(typeof Matomo !== 'undefined' && typeof Matomo.MediaAnalytics !== 'undefined') {
                            try {
                                let isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();
                                //console.log('isMediaAnalyticsEnabled',isMediaAnalyticsEnabled);
                                if(isMediaAnalyticsEnabled === false) {
                                    Matomo.MediaAnalytics.enableMediaAnalytics();
                                    isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();
                                    console.log('VOD isMediaAnalyticsEnabled', isMediaAnalyticsEnabled);
                                }
                            }
                            catch(e){
                                console.log('e',e)
                            }
                        }
                       
                        /*
                        if(typeof Matomo !== 'undefined' && typeof Matomo.MediaAnalytics !== 'undefined') {
                            let isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();   
                            console.log('VOD isMediaAnalyticsEnabled', isMediaAnalyticsEnabled); 
                            if(isMediaAnalyticsEnabled === false) {      
                                Matomo.MediaAnalytics.enableMediaAnalytics();     
                                isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();
                                console.log('VOD isMediaAnalyticsEnabled', isMediaAnalyticsEnabled);
                                if(document.getElementById('rtv4d_player')) {
                                    Matomo.MediaAnalytics.scanForMedia(document.getElementById('rtv4d_player'));//Na strani live so spodaj oddaje ki se odprejo v poup
                                }
                                else {
                                    Matomo.MediaAnalytics.scanForMedia();
                                }      
                            }*/
                       /* }
                        
                        
                        let rec_id = id + '';
                        if(data.response.mediaType == 'audio') {
                            _paq.push(['trackEvent', 'MediaAudio', 'start', rec_id]);
                        }
                        else {
                            _paq.push(['trackEvent', 'MediaVideo', 'start', rec_id]);
                        }*/
                    }


                    //midroll 28.11.2017
                    /*
                    if (info.disableAds === false && data.response.showTypeId != 31 && //SKIP MIDROLE NA OTROŠKIH     
                        data.response.mediaType === 'video' &&
                        typeof data.response.duration !== 'undefined') {



                        var duration = Math.floor(parseInt(data.response.duration, 10) / 60) || 0;

                        if (!info.advertising.schedule) {
                            info.advertising.schedule = {};
                        }


                        if (duration > 90) {

                            var adsLink = video.get_arhiv_midroll(data.response.showTypeId, data.response.showId);
                            var adsLink2 = video.get_arhiv_midroll(data.response.showTypeId, data.response.showId);


                            var offset = Math.floor(duration / 3 * 60);
                            info.advertising.schedule.adbreak1 = {
                                offset: offset,
                                tag: adsLink
                            };
                            info.advertising.schedule.adbreak2 = {
                                offset: offset * 2,
                                tag: adsLink2
                            };


                        } else if (duration >= 35 && duration <= 90) {

                            var adsLink = video.get_arhiv_midroll(data.response.showTypeId, data.response.showId);

                            var offset = Math.floor(duration / 2 * 60);
                            info.advertising.schedule.adbreak1 = {
                                offset: offset,
                                tag: adsLink
                            };
                        }
                    }
                    */


                    if (typeof data.response.subtitles !== 'undefined' && data.response.subtitles) {
                        var subcookie = $.cookieApi("read", null, "jwplayer.captionLabel");
                        if (subcookie === false) {
                            $.cookieApi("set", "Off", "jwplayer.captionLabel", 0);
                        }
                    }

                    info.playlist = (function() {
                                         
                        var i = {};
                        i.image = null;

                        if (typeof video.image === 'string' && video.image.indexOf(".jpg") > -1) {
                            i.image = video.image;
                        }

                        if(i.image === null) {
                            try{
                                let image = data.response.images.orig;
                                if(typeof image === 'string') {
                                    image =  image.replace('rtvslo.si', 'rtvcdn.si', image);
                                   i.image = image;
                                }        
                            }catch(e){}
                        }

                      
                        
                        //MATOMO
                        if (typeof data.response.title === 'string') {
                            let tmp = [];
                            tmp.push(data.response.title);
                            tmp.push(data.response.mediaType);
                            tmp.push(data.response.source);          
                            tmp.push(data.response.id);
                            i.title = tmp.join(' ');
                        }


                        i.sources = [];

                        if (data.response.mediaFiles !== undefined) {
                            data.response.mediaFiles.sort(function(a, b) {
                                return (b.bitrate + b.width) - (a.bitrate + a.width);
                            });
                        }

                        try {
                            if (data.response.addaptiveMedia && data.response.addaptiveMedia.hls) {
                                data.response.addaptiveMedia.hls = replaceEndpointHLS(data.response.addaptiveMedia.hls);
                            }
                        } catch (e) {
                            console.log("convert error", e);
                            //do nothing
                        }


                        
                        var mc = 0;        
                        //ADAPTIVE VIDEO
                        if (data && data.response && data.response.addaptiveMedia && typeof data.response.addaptiveMedia !== 'undefined') {        

                            var file = data.response.addaptiveMedia.hls_sec;
                                
                            if(data && data.response && data.response.addaptiveMedia_sl && data.response.addaptiveMedia_sl.hls_sec){
                                var on = $.cookieApi("read", null, cookieSIGN_LANG, 365) ? $.cookieApi("read", null, cookieSIGN_LANG, 365) : false;
                                if(on == '1'){
                                    console.log('Now playing sign lang video....')
                                    file = data.response.addaptiveMedia_sl.hls_sec;
                                }
                            }
    
                           
                            
                            
                            i.sources[mc] = {
                                file: file,
                                type: "hls",
                            };
                            mc += 1;  
                                
                                
                                
                        } else {
                           
                            if (typeof data.response.mediaFiles !== 'undefined') {
                               
                                $.each(data.response.mediaFiles, function(t) {
                                    //NON-ADAPTIVE VIDEO
                                    switch (data.response.mediaFiles[t].mediaType) {
                                        case "MP4":
                                            i.sources[mc] = { 
                                                file: (data.response.mediaFiles[t].streams.hls_sec),
                                                type: "hls"
                                            };
                                            mc += 1;
                                           
                                            break;
                                        case "MP3":
                                            i.sources[mc] = {
                                                file: (data.response.mediaFiles[t].streams.https),
                                                type: "mp3"
                                            };

                                            /*
                                            i.sources[mc + 1] = {
                                                file: (data.response.mediaFiles[t].streamers.http + "/" + data.response.mediaFiles[t].filename),
                                                type: "mp3"
                                            };
                                            mc += 2;*/
                                            /*
                                            i.sources[mc] = {
                                                file: (data.response.mediaFiles[t].streamers.http + "/" + data.response.mediaFiles[t].filename),
                                                type: "mp3"
                                            };
                                            */

                                            mc += 1;
                                            //mc += 2;
                                            break;
                                    }
                                });
                                
                            }
                        }

                        if (mc === 0) {
              
                            i.sources[mc] = {
                                file: (video.streamer["html5"] + video.preroll["dummy"]["html5"]),
                                type: "mp4"
                            };
                            data.response.mediaType = "video";
                        }

                      

                        if (data && data.response && data.response.subtitles && Array.isArray(data.response.subtitles)) {

                            var addStyleString = function(str) {
                                var node = document.createElement('style');
                                node.innerHTML = str;
                                document.head.appendChild(node);
                            }

                            addStyleString('video::cue(.yellow) {color: #FFFF00}');
                            addStyleString('video::cue(.blue) {color: #00FFFF}');
                            addStyleString('video::cue(.green) {color: #00FF00}');
                            addStyleString('video::cue(.pink) {color: #FF00FF}');
                            addStyleString('.jwplayer .yellow {color: #FFFF00}');
                            addStyleString('.jwplayer .blue {color: #00FFFF}');
                            addStyleString('.jwplayer .green {color: #00FF00}');
                            addStyleString('.jwplayer .pink {color: #FF00FF}');

                            //inject css

                            i.tracks = [];
                          
                            if(info && info.showsubtitles && info.showsubtitles === 'false'){     
                               return getPreroll(i, data, video);
                            }

                            $.each(data.response.subtitles, function(t) {
                                let is_default = false;
                                if (data.response.subtitles[t].language === "Slovenian") {
                                    data.response.subtitles[t].language = "Slovenski";
                                }
                                else if (data.response.subtitles[t].language === "SL") {
                                    data.response.subtitles[t].language = "Slovenski";
                                }
                                else if (data.response.subtitles[t].language === "EN") {
                                    data.response.subtitles[t].language = "Angleški";
                                }
                                else if (data.response.subtitles[t].language === "CZ") {
                                    data.response.subtitles[t].language = "Češki";
                                }

                                if(data.response.subtitles[t].language === "Slovenski") {
                                    is_default = true;
                                }

                                // @DEBUG
                                //inject fix string "strojni prepis"
                                if (data.response.subtitles[t].hasOwnProperty('autogenerated') && data.response.subtitles[t].autogenerated == true) {
                                    data.response.subtitles[t].language += " (strojni prepis)"; // maybe should be done on API side?
                                }
                                // end @DEBUG

                                try 
                                {
                                    let file = forceSLL(data.response.subtitles[t].file);
                                    i.tracks[t] = {
                                        file: file,
                                        kind: "captions",
                                        label: data.response.subtitles[t].language,
                                        "default": is_default
                                    };
                                }
                                catch(e){
                                    console.log('E_SUBS', e);
                                }  
                                /*i.tracks[t] = { file: data.response.subtitles[t].file, kind: "captions", label: data.response.subtitles[t].language, "default": true };*/
                            });
                            //console.log('i.tracks', i.tracks);
                        }
                        return getPreroll(i, data, video);
                    })();

                    if (data && data.response && data.response.link && info && info.sharing) {                     
                        info.sharing.link = getShareUrlCtx(null, data)                  
                    }

                    if (info && video && video.captions && typeof video.captions === 'object') {
                        info.captions = video.captions;
                    }

                    if (typeof jwplayer === "function") {
                        showPlayer(container, data, info, video);
                    }
                  
                    if (video.callback) {
                        try {
                            info.response = data.response;
                            info.player = jwplayer(container.id);
                            if (typeof video.callback === 'string') {
                                var fn = window[video.callback];
                                if (typeof fn === 'function') {
                                    return fn(info);
                                }
                            } 
                            else {
                                var callbacks = $.Callbacks();
                                callbacks.add(video.callback);
                                return callbacks.fire(info);
                            }
                        } catch (e) {
                            console.log(e);
                        }
                    }
                    return false;
                }
            }
        });
    }

    $.fn.playLive = function(id, options) {

        var container = $(this);
        var that = this;

        var isRadio = ($(that).data("channel") || "").indexOf('ra.') !== -1 ? true : false;
        var disableAds = false;

        if(options && options.render && options.render === 'inline-audio'){
            options['client'] = API_CLIENT_ID;
            var wi = $(this).parent().width();
            options["width"] =  wi;
            options["height"] = 30;///MUST BE 30px - jw makes it work
            options["stretching"] = 'fill';
            options["image"] = '';
            options["toolbar"] = false;   
            document.body.classList.add('jw-live-inline-audio');         
        }

        if(isRadio){
            disableAds = true;
            if(options && options.render && options.render === 'square-audio'){
                options["aspectratio"] = "1:1";
            }
        }
        var video = $.extend({}, defaults, options, rtvdef);
    
        //TODO - add to input paramerers  - options
        var showAdvancedLive = false;

        if (typeof video.autostart !== 'string') {
            video.autostart = video.autostart.toString();
        }

        if (typeof video.disableAds !== 'undefined' && video.disableAds == "true") {
            disableAds = true;
        }
        else if (typeof video.disableAds !== 'undefined' && video.disableAds == 1) {
            disableAds = true;
        }
        
        var info = {};
     
        info.horizontalVolumeSlider = true;
        info.width = video.width;
        info.height = video.height;
        info.mute = (typeof video.mute !== 'undefined' && video.mute == 1) ? "true" : "false";
        info.controls = (typeof video.hidecontrols !== 'undefined' && video.hidecontrols == 1) ? "false" : "true";
        info.primary = "html5"; 
        info.autostart = video.autostart;
        info.stretching = video.stretching;
      
        info.disableAds = disableAds;
        info.showLoginPopup = false;
        //info.visualplaylist = true;
        info.abouttext = abouttext;
        //info.nextupoffset = -1;
        info.showAdvancedLive = showAdvancedLive;
      

        info.aspectratio = (typeof video.aspectratio !== 'undefined') ? video.aspectratio: "16:9";

        info.playbackRateControls = [0.5, 0.75, 1, 1.25, 1.5];

        info.hlsjsConfig = {
            liveSyncDuration: 30,
            debug: false
        }
        info.advertising = {
            client: 'vast',
            skipoffset: 7,
            vpaidcontrols: true
        }

        info.cast = {
            customAppId: "9BCE1FE3"
        }

        if(typeof video !== 'undefined' && typeof video.image !== 'undefined'){
            if(typeof video.image === 'string' && video.image.indexOf('https://') > -1) {
                info.image = video.image;
            }
        }
        
       
        if(ITALIAN){
             
        }
        else if(HUN){
            info.advertising = {
                skipmessage: 'Hirdetés átugrása XXs múlva',
                admessage: 'A hirdetés végéig: XXs.',
                skiptext: 'Hirdetés átugrása',
                cuetext: 'Hirdetés'
            }
            
            info.localization = {
                nextUp: 'Következő felvétel',
                playlist: 'Lejátszási listák',
                related: 'Lejátszási lista',
                playback: 'Lejátszás',
                play: 'Lejátszás',
                pause: 'Szünet',
                volume: 'Hangerő',
                prev: 'Vissza',
                next: 'Előre',
                cast: 'Chromecast',
                fullscreen: 'Teljes képernyő',
                hd: 'Felbontás',
                cc: 'Feliratok',
                audioTracks: 'Hangsáv',
                replay: 'Újrajátszás',
                buffer: 'Betöltés',
                more: 'Több',
                liveBroadcast: 'Élő',
                notLive: 'Késleltetés',
                loadingAd: 'Hirdetés betöltése',
                rewind: 'Vissza 10s',
                nextUpClose: 'Bezárás',
                videoInfo: 'Info',
                shortcuts: {
                    keyboardShortcuts: 'Billentyűparancsok'
                },
                sharing: {
                    link: lang.link,
                    facebook: 'Facebook',
                    twitter: 'Twitter',
                    heading: 'Megosztás'
                } 
            }
        }
        else{
            info.localization = {      
                notLive: 'Zamik', 
                liveBroadcast: 'Živo'        
            }
        }


        var logo = getLogo(video, "");
        if (logo !== false) {
            info.logo = logo;
        }

        try {
            if (typeof video.playfile === "object" && video.playfile !== null) {
                return playFiles(container, info, video);
            }
        } catch (e) {
            return console.log(e);
        };

        


        var url = getApiEndPoint(DEBUG_ENABLE);
       
        $.ajaxSetup({xhrFields: { withCredentials: true } });
        return $.ajax({
            url: url + "/ava/getLiveStream/" + id,
            data: {
                "client_id": video.client
            },
            dataType: 'jsonp',
            cache: 'false',
            jsonpCallback: function() {
                var random = Math.floor(Math.random() * 1000);
                return 'ava_' + random;
            },
            success: function(data) {

                //PUSH TO IOS
                if(data && data.response ) {         
                    try {
                        var mediaType = "liveTV";
                        var url = data.response.mediaFiles[0].streamer + "/playlist.m3u8";
                        if(data.response.mediaType === 'audio'){
                            mediaType = "liveRA";
                          
                            var radio_stations = [];
                            radio_stations["ra.a1"] = "https://mp3.rtvslo.si/ra1";
                            radio_stations["ra.val202"] = "https://mp3.rtvslo.si/val202";
                            radio_stations["ra.ars"] = "https://mp3.rtvslo.si/ars";
                            radio_stations["ra.mb1"] = "https://mp3.rtvslo.si/rmb";
                            radio_stations["ra.rsi"] = "https://mp3.rtvslo.si/rsi";
                            radio_stations["ra.kp"] = "https://mp3.rtvslo.si/rakp";
                            radio_stations["ra.capo"] = "https://mp3.rtvslo.si/capo";
                            radio_stations["ra.mmr"] = "https://mp3.rtvslo.si/mmr";
                            //radio_stations["ra.mmr"] = "https://mp3.rtvslo.si/202sport";
                            //radio_stations["ra.raz"] = "https://mp3.rtvslo.si/raz";
                            
                            url = radio_stations[data.response.id];
                            //url = data.response.addaptiveMedia.http.replace('http://', 'https://');
                        }
                        var title = data.response.title;
                        var subtitle = "V živo";
                        var poster = data.response.images.orig;
                       
                        var packet = [mediaType, url, poster, title, subtitle];
                        packet = packet.join('|');
                        //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 576 ~ getMedia ~ packet", packet);         
                        if (parent && document.cookie && document.cookie.indexOf("showIosNative=true") != -1) {                      
                            parent.postMessage("rtv4d::" + packet,"*");
                        }
                    } 
                    catch(e){}              
                }

                
                if(typeof Matomo !== 'undefined' && typeof Matomo.MediaAnalytics !== 'undefined') {

                    let isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();
                    //console.log('isMediaAnalyticsEnabled',isMediaAnalyticsEnabled);
                    if(isMediaAnalyticsEnabled === true) {
                        Matomo.MediaAnalytics.disableMediaAnalytics();
                        isMediaAnalyticsEnabled = Matomo.MediaAnalytics.isMediaAnalyticsEnabled();
                        //console.log('LIVE isMediaAnalyticsEnabled', isMediaAnalyticsEnabled);
                    }
                }
                
                

                //ERROR Handling
                if (typeof data.error !== 'undefined' || data.response == null) {
                    if (typeof jwplayer === "function") {
                        try {
                            video.playfile = {
                               // "rtmp": (video.streamer["rtmp"] + "/mp4:" + video.preroll["dummy"]["rtmp"]),
                                "html5": (video.streamer["html5"] + video.preroll["dummy"]["html5"])
                            };

                            playFiles(container, info, video);
                        } catch (e) {
                            console.log(e);
                        }
                    }
                    if (video.callback) {
                        if (typeof video.callback === 'string') {
                            var fn = window[video.callback];
                            if (typeof fn === 'function') {
                                return fn(data);
                            }
                        } else {
                            var callbacks = $.Callbacks();
                            callbacks.add(video.callback);
                            return callbacks.fire(data);
                        }
                    }
                    //console.log(data.error);
                    return false;
                }


                var logo = getLogo(video, data);

                if (logo !== false) {
                    info.logo = logo;
                }

                if (data.response.mediaFiles) {
                    info.playlist = buildPlaylist(data, video);
                }

                if (typeof jwplayer === "function") {

                    showPlayer(container, data, info, video);
                }

                if (video.callback) {
                    try {
                        info.response = data.response;
                        info.player = jwplayer(container.id);



                        if (typeof video.callback === 'string') {
                            var fn = window[video.callback];
                            if (typeof fn === 'function') {
                                return fn(info);
                            }
                        } else {
                            var callbacks = $.Callbacks();
                            callbacks.add(video.callback);
                            return callbacks.fire(info);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                }
                return false;
            }
        });
    }

    function showAds(data, video, info) {

         //PRE
        if(info.disableAds == true) {
            return
        }
        
        if(data && data.response && data.response.id && typeof data.response.id === 'string' && data.response.id.indexOf('ra.') > -1) {
            //NO ADS ON RADIO
            return
        }
  
        //SKIP PROMO
        if (data && data.response && data.response.promo && data.response.promo == 1) {
            return;
        }

        //SKIP FORCED
        if (data && data.response && data.response.noAds && data.response.noAds == 1) {
            return;
        }

        //SKIP OTROSKI//SKIP OTROSKI
        if (data && data.response && data.response.showTypeId && data.response.showTypeId == 31) {
            return;
        }

        //Skip ios native app 
        var showIosNative = $.cookieApi("read", null, "showIosNative", 365) ? $.cookieApi("read", null, "showIosNative", 365) : false;
        if(showIosNative === true){
            return;
        }

        if(data && data.response && data.response.mediaType && typeof data.response.mediaType === 'string' && data.response.mediaType === 'audio') {
            //ADS ON AUDIO
            let ssid = 'AVDIOarhiv';
            info.advertising = {   
                skipoffset: 7,
                skipmessage: 'Oglas lahko preskočite čez XXs',
                admessage: 'Do konca oglasa: XXs.',
                skiptext: 'Preskoči oglas',
                client: "vast",
                tag: "https://core.iprom.net/vast?sitePath=[%22rtvslo%22,%22" + ssid + "%22,%22%22]&zones=[34]" // Your VAST ad URL
            }
        }

        let vast0 = "";       
        if (typeof data.response.category !== 'undefined' && data.response.category === 'live' && typeof data.response.id !== 'undefined') {
            vast0 = video.get_live_preroll(data.response.id);
        } 
        else {
            vast0 = video.get_arhiv_preroll(data.response.showTypeId, data.response.showId);
        }
        
        if (!info.advertising.schedule) {
            info.advertising.schedule = {};
        }
       
        if(vast0 !== '') {
            info.advertising.schedule.preroll = {
                offset: 'pre',
                tag: vast0
            };
        }

        //POST
        if (typeof data.response.showTypeId !== 'undefined') {

            var post = video.get_arhiv_postroll(data.response.showTypeId, data.response.showId);

            info.advertising.schedule.postroll = {
                offset: 'post',
                tag: post
            }
        }
        
        //console.log('info.advertising', info.advertising);
    }

    function getRandomInt() {
        var min = 1000000000;
        var max = 9999999999;
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive
    }

    function showPlayer(container, data, info, video) {

        jwplayer.key = video.jwkey;
        rtvdef.playerStatus = true;
        rtvdef.media = info.response;

        /* send request to API #2 */
        function sendRequestPlayLive(id, type) { 
                
            var uhash = $.cookieApi("read", null, "rtv.liveplay.stats", 0);
            if (typeof uhash === 'undefined' || uhash === false || uhash.length < 1) {   
                var newcookie = [];
                newcookie[0] = getRandomInt();
                uhash = newcookie[0];
                var MAX_AGE = 365 * 10; // 10yrs
                $.cookieApi("set", uhash, "rtv.liveplay.stats", MAX_AGE);     
            }

            var app_id = getAppId();

            var link = getApiEndPoint() + "/stats/logstream/liveplay/" + id + "/" + uhash + "/" + app_id  +"/?t=" + Math.floor(Math.random() * 1000);
            if(type === 'interval'){
                link = getApiEndPoint(DEBUG_ENABLE) + "/stats/logstream/live/" + id + "/" + uhash + "/" + app_id + "/?t=" + Math.floor(Math.random() * 1000);
                return getAjaxStats(link, function(data){
                    //console.log('data', data)
                    var element = document.getElementById("live_top_right_link");
                    var cnt = 0;
                    if(data && data.response && data.response.concurrent  && data.response.concurrent.cnt){
                        cnt = data.response.concurrent.cnt;
                    }
                    else if(data && data.response && data.response.concurrent){ 
                        cnt = data.response.concurrent;             
                    }

                    if(element){
                        element.style.display = 'block';
                        element.innerHTML = '<span class="icon-user"></span>&nbsp;&nbsp;' + cnt;   
                    }

                    if(data && data.response && data.response.status && data.response.status === 'on') { 

                        var status = $.cookieApi("read", null, "jwplayer.liveRadioStream" + id, 365);
                        //console.log('status', status);
                        if(status === 'on') {
                            return;//predvaja se video kar je ok
                        }
                        //Predvaja se audio - omogoči preklop
                        var element = document.getElementById("live_radio_video_top_right_link");
                        if(element){
                            element.style.display = 'block';
                            element.innerHTML = '<span class="icon-audio"></span>&nbsp;&nbsp; Preklopi vir';
                            element.onclick = function() { 
                                $.cookieApi("set", "on", "jwplayer.liveRadioStream" + id, 1);
                                setTimeout(function() {
                                    location.reload(); 
                                }, 200)       
                            };
                        }
                        
                    }else { 
                        var status = $.cookieApi("read", null, "jwplayer.liveRadioStream" + id, 365);
                        //console.log('status', status);
                        var element = document.getElementById("live_radio_video_top_right_link");
                        if(status === 'on') {
                             //Video se je predvajal ampak je končano. Prikaži gumb za preklop nazaj na audio vir in izbriši piškot              
                            if(element){
                                element.style.display = 'block';
                                element.innerHTML = '<span class="icon-video"></span>&nbsp;&nbsp; Preklopi vir';
                                element.onclick = function() { 
                                    $.cookieApi("set", null, "jwplayer.liveRadioStream" + id, 0);
                                    setTimeout(function() {
                                        location.reload(); 
                                    }, 200)       
                                };
                            }
                        }else{
                            if(element){
                                element.style.display = 'hide';
                                $.cookieApi("set", null, "jwplayer.liveRadioStream" + id, 0);
                            }
                           
                        }
                    }
                        
                });
            }
           
            getAjaxStats(link);  
        };

        container.each(function(p) {
            
            showAds(data, video, info);

            
                   
            //INIT AUDIO
            if (video.height > 40 && data.response.mediaType === "audio" && (video.image || typeof data.response.images.orig !== "undefined")) {
          
                return (function() {

                    $radioImage = $("<div>", {
                        id: (container[p].id + '_top'),
                    });

                    $("#" + container[p].id).append($radioImage);
                    $radioPlayer = $("<div>", {
                        id: (container[p].id + '_bottom')
                    });

                    $("#" + container[p].id).append($radioPlayer);

                    if (video.image) {             
                        if (typeof data.response.images.orig === 'undefined') {
                            data.response.images = {};
                        }
                        data.response.images.orig = video.image;
                    }
                    else {
                        try 
                        {
                            if (data && data.response && data.response.onair && 
                                    data.response.onair.current && data.response.onair.current.show &&
                                         data.response.onair.current.show.images && data.response.onair.current.show.images.orig && typeof data.response.onair.current.show.images.orig === 'string') {        
                                data.response.images.orig = data.response.onair.current.show.images.orig;
                            }
                        } 
                        catch (e) {}
                    }
                       
                    $image = $("#" + container[p].id + "_top");
                    
                    $image.css({
                            "z-index": "1",
                            "position": "relative" // this is a must
                    });

                    $image.addClass("custom_top_message");

                    var padding = [44, 73];
                    if (video.onair === "true" && typeof data.response.category !== 'undefined' && data.response.category === 'live') {        
                        onair(data.response.id, padding, video, $image, info, data);
                    }             
                  
                    //LIVE AUDIO
                    var playerInstance = jwplayer(container[p].id + "_bottom");        
                    playerInstance.setup(info);
                    initMux(playerInstance, data);      
                    playerInstance.on('ready', function(a) {
   
                        //Prevent contetnt jumping on portal;https://www.rtvslo.si/znanost-in-tehnologija/clovek-prihodnosti-med-fikcijo-in-realnostjo/487924
                        var player_instance_contaniner = $('#'+ container[p].id)
                        if(player_instance_contaniner && player_instance_contaniner.length){
                            player_instance_contaniner.removeClass('embed-responsive');
                            player_instance_contaniner.removeClass('container-16-9');
                        }
                        let live = false;
                        if (data.response.category === 'live') {
                            live = true;
                        } 
                        else {
                            if((video && video.target && video.target === 'popup') || (video && video.toolbar) ){
                               addBottomToolbar(container[p].id, data, playerInstance);
                            }   
                        }

                        if(info && info.recordingId){

                            if(video && video.skip2s && video.skip2s > 0){
                                playerInstance.seek(video.skip2s);
                            }
                            else {
                                var cookieData = $.cookieApi("read",null , "resume_radio_data_" + info.recordingId,  2);
                                if(cookieData) {
                                    var resumeAt = cookieData.split(':')[0],
                                        videoDur = cookieData.split(':')[1];
                                    if(parseInt(resumeAt, 10) < parseInt(videoDur, 10)) {
                                        playerInstance.seek(parseInt(resumeAt, 10));
                                        //console.log('Resuming at ' + resumeAt); //for demo purposes
                                    }
                                    else if(cookieData && !(parseInt(resumeAt, 10) < parseInt(videoDur, 10))) {
                                        //console.log('Video ended last time! Will skip resume behavior'); //for demo purposes
                                    }
                                }
                            }                       
                        }  

                        //30.11.2015 ready ne vrne več ID kot v JW6
                        a.id = container[p].id;
                        
                        renderBackFFButn(a.id, live);

                        renderLiveBtn(a.id, 'radio');//Live radio

                        renderRadioVideoBtn(a.id);
                       
                        renderBackPodcastBtn(a.id, data);

                        renderButtonsEmbed(a.id, data);

                    
                        if (data && data.response && data.response.subtitles && Array.isArray(data.response.subtitles)) {     
                             if (data.response.subtitles.length >= 0) {                
                                odprtikopInit($("#" + container[p].id), data.response.subtitles[0].file);
                            }
                        }

                        if (typeof video.clip === 'object' && video.clip !== null) {
                            clipRecording(container[p].id + "_bottom", video);
                        }
                        if (typeof data.response.id !== 'undefined' && (typeof data.response.category === 'undefined' || data.response.category !== 'live')) {
                            $.stats(container[p].id + "_bottom", data.response.id, data.response);
                        }
                    }).on('error', function(err) {
                        let that = this;
                        errorHandler(err, data, that);
                    }).on('play', function(e) {
                        
                        let $image = $("#" + container[0].id + "_bottom" + " .jw-overlays");
                        //check if image exists
                        if($image && $image.length){
                            $image.css({"z-index": "0"});
                        }

                        if(data && 
                            data.response && 
                                data.response.id && 
                                    data.response.category && 
                                        data.response.category === 'live'){
                            
                            let channelId = data.response.id;                
                            //AUDIO
                            let index = LIVE_CHANNELS.indexOf(channelId);
                               if(index !== -1){
                                    mutateLiveTimeScroll(data.response);
                                    mutateLiveTimebarUpdate(data.response);
                                    sendRequestPlayLive(index + 1);
                                }
                        }    


                    }).on('stop', function(e) {
                        mutateLiveTimeScrollStop()
                    }).on('time', function(e){
                        if(info && info.recordingId && e && e.position){
                            $.cookieApi("set", Math.floor(e.position) + ':' + playerInstance.getDuration(), "resume_radio_data_" + info.recordingId,  2);
                        }
                    }).on('visualQuality', function(e) {

                    
                    }).on('all', function(e) { //LIVE AUDIO

                    
                        let volume = this.getVolume();
                        if (e === 'adPlay') {
                            if (volume > 80) {
                                this.setVolume(80);
                            }
                        }
                        if (e === 'adComplete' || e === 'adSkipped') {                  
                            if (volume >= 80) {
                                volume = 100;
                            }
                            this.setVolume(volume);
                        }
                        if(e === 'time'){
                            
                            //Send live stats beacon every 60 seciong of playtime
                            var unix =  Math.floor(Date.now() / 1000);
                            var last = $.cookieApi("read", null, "jwplayer.live.time", 1);
                            if(last == false){
                                $.cookieApi("set", unix, "jwplayer.live.time", 1);
                            }
                            else {
                                last = parseInt(last, 10);
                                if(unix - last >= INTERVAL_IN_S){
                                    $.cookieApi("set", unix, "jwplayer.live.time", 1);
                                    var channels = LIVE_CHANNELS;
                                    var index = channels.indexOf(data.response.id);
                                    if(index !== -1){
                                        sendRequestPlayLive(index + 1, 'interval');
                                    }
                                }
                            }                
                        }
                    });

                    return playerInstance;
                })();
            }

            info.sources = info.playlist[0].sources;


        playerInstance = jwplayer(container[p].id);

        try{
            //if info height is not set, set it to 40px
            if(!info.height){
                info.height = 30;
            }
            playerInstance.setup(info);
        }
        catch(e){
            console.log('JW7 SETUP ERROR', e, info);
        }
      

        /** RADIO LIVE PLAYER BOOSTRAP MODULE */
        if(typeof window._globaLiveRadioPlayerCommands !== 'undefined' && typeof window._globaLiveRadioPlayerCommands.bootstrap !== 'undefined') {
            window._globaLiveRadioPlayerCommands.bootstrap(playerInstance);
        }
                
        initMux(playerInstance, data);
                        
        playerInstance.on('ready', function(a) {

                if(window._globalAmbientModeF) {
                    window._globalAmbientModeF();
                }
                
                if(!$("#snackbar4dplayer").length) {
                    let $snackbar = $("<div id='snackbar4dplayer'></div>");
                    $('body').append($snackbar);
                }
                          
                //INIT AKAMAI STATS
                let live = false;
                if (data && data.response && data.response.category === 'live') {
                    live = true;
                }
                else {          
                    if(info && info.recordingId) {

                        if(video && video.skip2s && video.skip2s > 0){
                            playerInstance.seek(video.skip2s);
                        }
                        else 
                        {
                            (function(rec_id, player_inst, info_inst) {
                                let continuum = continuumVOD.get(rec_id);
                                if(typeof continuum !== 'string') {
                                    continuum = $.cookieApi("read",null , "resume_video_data_" + rec_id,  2);//falback
                                    if(typeof continuum !== 'string') {
                                       return;     
                                    }
                                }  

                                let info = continuum.split(':');
                                if(info.length !== 2) {
                                    return
                                }

                                let resumeAt = parseInt(info[0], 10);
                                let videoDur = parseInt(info[1], 10);
                                if(resumeAt >= videoDur) {
                                    return;
                                }

                                player_inst.seek(resumeAt);

                                if(info_inst.autostart ===  false || info_inst.autostart ===  'false') {
                                    player_inst.stop();
                                    //console.log('Autostart off ...');
                                }

                            })(info.recordingId, playerInstance, info);

                        }                      
                    }  
                }

                a.id = container[p].id;
                
                renderBackFFButn(a.id, live);

                renderButtonsEmbed(a.id, data, live);

             
                //TV MMC ONLY  
                if(data && data.response && data.response.id && data.response.id && data.response.id === 'tv.mmctv'){
                    renderLiveBtn(a.id);//live video
                }else if(data && data.response && data.response.id && typeof data.response.id === 'string' && data.response.id.indexOf('ra.') > -1){//VIDEO ON RADIO
                    renderLiveBtn(a.id, 'radio');
                    renderRadioVideoBtn(a.id);
                }

                renderBackPodcastBtn(a.id, data);
                if(document.body.classList.contains('rtv4d-ng')) {
                    $("#" + container[p].id).setButtonsYtExt();
                }

                if (data && data.response && data.response.subtitles && Array.isArray(data.response.subtitles)) {     
                    if (data.response.subtitles.length >= 0) {                
                       odprtikopInit($("#" + container[p].id), data.response.subtitles[0].file);
                   }
               }
                
                $showLoginPopup = $("<div>", {
                    style: "line-height:20px;text-align:center;opacity:0.9;position:absolute;left:0;top:0;background:none rgb(51, 51, 51);z-index:99999;color:white;width:100%;padding:10px;",
                    id: (container[p].id + '_top_login'),
                });

                if (info.showLoginPopup === '1') {
          
                    var loc = window.location.href;
                    // console.log('data.response',data.response );
                    if (loc.indexOf('.rtvslo.si') !== 1) {
                        
                        var location = loc.indexOf('dev.rtvslo.si') > -1 ? 'https://monocms.dev.rtvslo.si/' : 'https://www.rtvslo.si/';
                        //var location = 'https://www.rtvslo.si/';
                        var neprijavljen = 'Spoštovani. Oddaja je na voljo samo prijavljenim uporabnikom. <br>Prijavite se na tej <a style="color:white;font-weight:bold;text-decoration:underline;" href="' + location + 'prijava">POVEZAVI</a>. <a target="_blank" style="color:white;" href="https://www.rtvslo.si/uporaba/uporabniski-racun-rtvslo-si/455921"> Več informacij</a>.';
                        
                        if(typeof info.publicExpirationDatePopup !== 'undefined' && info.publicExpirationDatePopup === '1'){
                            neprijavljen = 'Spoštovani. Vsebina je na voljo le registriranim zavezancem za plačilo RTV-prispevka.<br>Postopek aktivacije zavezanca opravite na spletni strani <a style="color:white;font-weight:bold;text-decoration:underline;" href="' + location + 'mojrtv">RTVSLO.SI/MOJRTV</a> v sklopu nastavitev uporabniškega računa.';
                        }
     
                        $showLoginPopup.html(neprijavljen);

                    } else {
                        $showLoginPopup.html('Spoštovani. Ogled vsebine je možen samo na <a target="_blank" style="color:white;font-weight:bold;" href="' + data.response.showLink + '"> RTV4D</a>');
                    }

                    $("#" + container[p].id).prepend($showLoginPopup);
                }

                if (typeof video.clip === 'object' && video.clip !== null) {
                    clipRecording(container[p], video);
                }

                if (typeof data.response.id !== 'undefined' && (typeof data.response.category === 'undefined' || data.response.category !== 'live')) {
                    $.stats(a.id, data.response.id, data.response);
                }

               
              
                //Ne prikaži pod inline videji in na live
                if((video && video.target && video.target === 'popup') || (video && video.toolbar) ){              
                    addBottomToolbar(container[p].id, data, playerInstance);
                                 
                }

                //Inject inline live functionalitiy:
                if(info.showAdvancedLive === true){
                    window.module__globalLiveInlinePlayer.init(container[p].id, getAjax)                 
                }

                //END VOD READY EVENT  
            }).on('error', function(err) {
                let playerInstance = this;
                errorHandler(err, data, playerInstance);
            }).on('time', function(e) {
                if(info && info.recordingId){
                    let timeinfo = Math.floor(e.position) + ':' + Math.floor(playerInstance.getDuration());
                    let rec_id =  info.recordingId;
                   if(continuumVOD && continuumVOD.save) {
                        continuumVOD.save(rec_id, timeinfo);
                   }
                }                  
            }).on('all', function(e, info) { //LIVE VIDEO AND VOD
                let playerInstance = this;
                if(e === 'warning' && info.code === 339000) {
                    const currentQuality = playerInstance.getCurrentQuality();
                    if (currentQuality > 0) {
                        console.log('Switching to lower quality.');
                        playerInstance.setCurrentQuality(currentQuality - 1);
                    } 
                }
                if(e === 'time') {
                    
                    //Send live stats beacon every 30 seciong of playtime
                    var unix =  Math.floor(Date.now() / 1000);
                    var last = $.cookieApi("read", null, "jwplayer.live.time", 1);
                    if(last === false) {
                        $.cookieApi("set", unix, "jwplayer.live.time", 1);
                    }
                    else {
                        if(unix - last >= INTERVAL_IN_S) {
                            $.cookieApi("set", unix, "jwplayer.live.time", 1);
                            let channelId = data.response.id;    
                            //If radio is playing video is started than send different stats
                            if(TRANSLATE_LIVE_CHANNELS[channelId] && info.height > 30) {
                                channelId = TRANSLATE_LIVE_CHANNELS[channelId];
                            }
                            let index = LIVE_CHANNELS.indexOf(channelId);
                            if(index !== -1) {
                                sendRequestPlayLive(index + 1, 'interval');
                            }
                        }
                    }                
                }

                if (e === 'userActive' && video.promo === 1) {
                    var mute = this.getMute();
                    if (mute == true) {
                        this.setVolume(25);
                        this.setMute(!mute)
                    }
                }

                if (e === 'adPlay') {
                    var volume = this.getVolume();
                    if (volume >= 90) {
                        this.setVolume(70);
                    }
                }
                if (e === 'adComplete' || e === 'adSkipped') {
                    var volume = this.getVolume();
                    if (volume == 70) {
                        volume = 100;
                    }
                    this.setVolume(volume);
                }
                return playerInstance;

            }).on('play', function(e) { //LIVE VIDEO

                //HIDE VAST ADD IF SHOWN
                let vastAdd = '#' + container[0].id + '_vast';
                if(document.querySelector(vastAdd))document.querySelector(vastAdd).innerHTML = '';

                //console.log('PLAY VOD!', leavingPageModalListener). /radio/vzivo/val202
                if(typeof leavingPageModalListener !== 'undefined') {
                    let confirm = document.getElementById('confirm-live-player-leave');
                    if(confirm) {
                        leavingPageModalListener(confirm);
                    }       
                }

                let tracks = this.getAudioTracks();   
                //console.log('tracks', tracks)
                //create mock track for unit test    
                //let tracks = [{name1: 'Avdio opis - nekaj ', language: 'sl', id: 1}, {name1: 'Avdio prevod -nekaj', language: 'sl', id: 2}];     
                if(tracks && tracks.length > 1) {    
                    let track_name = tracks[1].name ? tracks[1].name : '';
                    //console.log('track_name', track_name)   
                    let whitelist = ['opis', 'prevod', 'podnapisi', 'zvocni'];       
                    //use whitelist intems as needle
                    let filter = whitelist.filter(function(item) {
                        return track_name.indexOf(item) > -1;
                    });
   
                    if(filter.length > 0) {           
                        let on = $.cookieApi("read", null, cookieSOUND_DESCR, 365) ? $.cookieApi("read", null, cookieSOUND_DESCR, 365) : false;
                        if(on == '1') {
                            this.setCurrentAudioTrack(1);
                        }
                    }
                }              
   
                if(data && data.response && 
                            data.response.id && 
                                data.response.category && 
                                    data.response.category === 'live') {  

                    let channelId = data.response.id;    
                    //If radio is playing video is started than send different stats
                    if(TRANSLATE_LIVE_CHANNELS[channelId] && info.height > 30) {
                        channelId = TRANSLATE_LIVE_CHANNELS[channelId];
                    }
                    let index = LIVE_CHANNELS.indexOf(channelId);
                    
                    if(index !== -1) {
                        mutateLiveTimeScroll(data.response);
                        mutateLiveTimebarUpdate(data.response);
                        sendRequestPlayLive(index + 1);
                    }
                }       
            }).on('stop', function(e) {              
                mutateLiveTimeScrollStop()
            }).on('pause', function(e) {//Warning this event is triget for live and vod!
                if(data && data.response && data.response.category && data.response.category === 'live') {  
                    if(info && info.disableAds && info.disableAds === true) {
                        return;
                    }
                    if(info && info.height && info.height > 30) {
                        fetchLinearAdd(container[p].id, 'live', data.response.id);  
                    }
                }
               
            });
        });
        return;
    }

    function renderButtonsEmbed(id, data, live) {
        //console.log('renderButtonsEmbed', id, data, live);
        $("#" + id).setButtonsEmbed(data, live);
    }
    
  
    
    function renderBackPodcastBtn(id, data) {
        let element = document.getElementById("podcast_top_right_link_" + id);
        if(element){
            return;
        }

        if(data && data.response && data.response.podcast && data.response.podcast == 1) {

            let html = [];
            if(data.response.applePodcast) {
                html.push('<li><a target="blank" href="' + data.response.applePodcast + '"><img style="width:32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAHQElEQVRoge2Ze4xUZxnGf985c9vr7M5eBrbLLrsslxUNl8UK1hqKxiwtaIiENNGqJViaVOu1CbFRjo1otfXaphojNpagCU2NTTAtRiHVkJRAl1IXFqGw070R9jLM3mbncs68/jHcdu5nd/pXef6bed73/Z7nO998837fgTu4gw82VLEKydNPrUTJ/ShZBbQBrYDjBg30AmcR1Y0mR9QTxjvFGHdeBuQZox74JsKDQIuN1AjiOkrkrn/jKH9JPfn5K3PVMCcD8qxRi8X3UewCSgGo9sHiJXBXE9TUQqUXXO5kQiyaYDo8w/jkNJfHLHqGawlOO6+XiwK/BzGUsSP4vhuQnxmdwH6gAU2DFSthzd3Q0GivUP8YnLwE3f0gAjCKUo+qvdtfsVOmYANy6JBO4NyvgccAaGmDT3VCdY2d8dIxNgmvvQ2Xrt745gWo/YYy7jMLSS/IgBiGixIOoNRmnCW9dG6rZ0XbgrlqzoiuXlNe7zlnxr3BaW1ZYLSq7tGlj6tovrS8BsQ45kAb2I9on6S0YjFfuBcWVhVHdArMIWH8YIJEGIDDdejblKFyPglHLjKJ0V+R8HyJMjc8vBFqKuYsUCJmPHHVCkf7dE98UHObQ4JWpqjerSXFNCiqduqE/miRCLNlBOsXwOO5auZ8AvLDQ9sQ9VecOjx8n72Zj1lmYjgyFR3UiPW5vNYgyhrPHFq3V5/12RwSQi8mEBNQ7Kjf63jZtgH5ycFqoq7/AXV8tgPW5N/mzUBsMnJad8UGcFs2NsRUAwCRt4TJwwmAUTf6cq+hMlbUslaNuvcCdbQtKEg8QOgvesXMO/bEZ4OnQ+FqVQC1M5g/yBaX0YDs+7Mf5BFR+jBb10UKHVRi9oXmQulWLXzRrZ0+5XF8+dV94s8Uk9HANbNzZ5DN01Mf+Vw9lR5PcWXNhsBkNs5ZRannQ2qNQJWm89VMMWkGxBDNksrdFp5az0eL1usBoNyYzuXagLtTC1gbtUvdbu3dkx69LFfO4rU3hLErE5+2jY4SXy1ozboPnI3zMKBA9xPUW7UJbREel195XVWUKEUjQIXAqTfzl/E1QqkXwuM0H94nH97ypOrOaSCBvkkhuJbYFx9HnZnWJOTdoi2rWakW6C58gC+jPxvl61ogcJqpqIuNQG4DCukAcDbZN9Dl0VYBPLDansB8KF/O+IUhKlCsB56/ncvwT6yWgaDXzn3AYooHKK3AC4DQlsql/4iRGgvVo1WreHFlpGO0jBMBH3354irLbmijNZVLewInS3SvCM33F9AlzRdjZXyskDjX9aOPAlcql/4EZF7HzLgoeuaRbxuZ5jkGYMbAVWKv2IV6EGgvJPbqWOF1o3FAcd7SCaRymQz0AXUzE/YNCDhz8cFxuNwPl/phaLjwuhNREmEfK0Qxkcqlb6OKCyJ0hEOEvf7rB/Z5IhqDv78BvQMZ6Th5jI9MJpe6JlxM5dIM9FVxPKKztSRI+UIbIi/1Z+eOnbglXqBPdPotJ1bCRa3ysDRf7b7gzdyuVC7NwLTOG0qjPDCYu6gIBAaTS+LyAExMZY999wrH4+VopoulomgCmm5w/pydUBKXry+3hPB6XgNP7FLdz74ovaFJWoaGoaE+veBUGF75B4xeSzEFA6LTD2y4/ftIJffEs7Taa5pzi+8PQmiGEeXgjPGAOpfKZz7QCAcA3s6yIR49AaMhxkTnhOnmWLScN2dquDZTQ2PMN1s8wOqmTFVgxUJYtzi3ga5priaWUZdoTZ99yHKoj+n8xmXxnfO9lK1fDT7vbP7iFL1hH4sh/Y/Il2FJbGoHpw7/7YfpGNSUJWd+bXPutmMkBmfC+IFJt4s/ZIrJmv7Mn8QwHWxsa6Fp+4bZ957P/RNC4cx5m9rhnrw/y8LwUj/0Jsf5qbFC7ckUk/VMbJXwy3g5bT0jtHS9N5vbsCRzziIfrM/C2cWp0E3xASx+lC0uq4E9O9S40vgawJFuuBK6xa1rgS2roa4CdA2qS2FjOzMPfZyEnv2aoGAMRuBIcucRleARY6XKusfl7Xue+ps8g+K7pS74yiegpnz+AnMhGCf+8wFOnxYioxqvnWxRT+eKz2vAMETT13JAHCyprMZ6cBVr/CXYbDIKQ1cMszOIYyQBwEEaeAilJFdOQZ2ncVZc6OwHvuhQ0FkPHUW+Hv3tNHx7AiJJua/SwHZU7ntRsPN+QEQZ5/kxij0AraWw2Q+1aR26PZwz4evjcPTWPfRzNPAtlLIKybfd+xvnpRP4HdCsgJWVcHcV0lhS+ElSgOMxeH4aXp6B5IphDMVuGtT784Ljdhhnpdx08L1uB+vOOvEHNJY2Oij5jBvudUO7A5p1qLhefULgPQvOm/CfKByJQuDW/CZfMSUwWJT5/rPoBm6iV6pwshN4DJV+Xs2DPhQHMHmBJjU0VwnFuT8QUVxhLcKnUXSQoB2FH6gluWJGEYbR6EF4C8W/WEgXSiWKMv4d3MEHGP8HtSFnf3Lv+IYAAAAASUVORK5CYII="></a></li>');
            } 

            if(data.response.podcastLink) {
                html.push('<li><a target="blank" href="' + data.response.podcastLink + '"><img style="width:32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QA/wD/AP+gvaeTAAAEx0lEQVR4nO2aTYgcRRiG369rzAajkhVNNDlJNBEjZvEQEDUJCkogB5eIHhQvEoSYRAVvIZDrXvzBPUgOQXSNejBBL4KukKxrjOiSRfFnl/iDIghRN7q7bnanvno9TMfNz3RV9Uz3jGA/MDB01/dWfW91f11dM0BFRUVFRUVFRcX/E4ltSNV5ALMApgDMgpyGyASASZCTMOYbAJMioiWNtRTyGMCIZjMQOQFyGEkyDOCkiLjWh1c+RRtwMT8DOIQkOSgiky3El07ZBpwnwOMAXoYxb4iIbUurQDpnwCI/AngBSXJAROYK0myZbhhwjl9A7oUxr4pI0drRdNOAVJijMGaniHxZin6ApBudXoDIXXBujKoDJJd0vPvYhunglgHoBbAMqmsgshbAOgAbAPQBMG2NhvwMxjwsIj+0pZODaANCkFwO1c0QuRfAdgCrWpQ6A/JxqdUOFzW2jkPSsF6/n6pDVJ2jKlv47Ot2HoVAcgVV91P1TAsmDJLsfp0qApLXUPV5qtZzmvBWN4pjaZC8jdaO5jLBuSMk2yuwGbT2Nkiehsi3ACbg3BhqtY9FZDZaixQ49xSAAQCxszsoxuyO7aNwArM0T2tHqPo0yZXRmuRGqn6f42rYW2aO/sHGD7JO594luSlKl+yltUcjtR2tfaDsXJsPtJVHmbUjrNe3BLXJpXTucKTuFMkbOpHzhYNs7VnemDXVIZLXe/VJQ9WDkcZ+2vEnQxsGLM6ctQ96+yANnXs7Um+gU7k3Bte+Aec+gyR7Mvshl0bWhAWSt7abV3deh0U+hEi/iEw37YvshXNjAPz3OjkCY7a0s5+Q523wMgBXAFgJ1Zsgsh4im0DenR7PyxiSZKuInM7obyOc+wihdQL5mNRqr7XQfzGkl+xDdO69tODluR0+J3llprbqMxEaP/1nlsokN+QoYo2Pc8NZCZAUWns84qmwo9O5emG9fh9VT+Uw4qVMLbKPqjYQf4pkrZM5BiF5FVXfjDbB2u2ZWqovRsQ/2sn8oqHqvkgTpkhe11SDvJaqMwEDRjudWzRUfTLShCGPxnOBWEdyTSfzykXkleBIbm4aT66i6tlA/P5O55WLqJpg7TFP/KGIYljYRm/hpIXxu6AJjcXVpfHWbo2IXZ9nTLk3HEn2UHUPrT2RFqaZ9Ptu3xofAETkLzi3M6KTZ5seN+YDAL96Y527J6jfKiRXU3XcMwMnSa4O6jh3JDCTCyRXNI1VHfTGOlfO7wnpzPuSP98E75WQLm5Cy+Y9TWOt7Q/E/Z5nKz3+FnDuCTR+AgvRB+e8S1MRGYfI+14Vsr/pcWOOAfD96+RqAGsDY/yXeAPIRwpt69wr3vMid5C8/NLD8geAcW+s6rpg/ynxBojckqNtuBIb8w6Avz0temDtnRnnvgj0X4IB+QhuUIjIHET8y9ckuT3jzERAvgQDyK8Lb0seDbS4OSPObwB5Y1T/yHcLZK7Tm7R9Paod+VXgfPNiZoz//wMiy6P6Rx4DkuQAQsWnwXjaNowx/r/OiWRtpf8ZUM7cZbqYaANEZB5Jsg1+E8aRJNtEZCFS9rfA+axEmm6mRsS1D8klVN1Faz+h6jRVp9Ntq1159+bSxZVvUXO2yLiKioqKioqKioqKRf4BQHTuuWVIXFUAAAAASUVORK5CYII="></a></li>');
            } 

            if(data.response.googlePodcast) {
                html.push('<li><a target="blank" href="' + data.response.googlePodcast + '"><img style="width:32px;" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAACkUlEQVRoge2ZP24TQRTGf293iBT5BJjCSsEBKJBsBELCFgUHgAKJxssNKDgEJyBxicQJKGxDESG7QIgDICUCiaSkiYQwOx6K2Ca7C/tnPGNHYr9uCs+8N/O+931vDTVq/N8QXxv/eLXXCkM1MNAWmOpA93cfHn11fU7gesMlFsF3gYaBXmjCAx/neEvAwJ3E2nDXxzneEgB2CtZO4DOBjcBnArPU+qePQ7wlIHCYWEty7QrK5kcnt260jFEDoA1MJZz3m+8/Jlqk1nEUKrVvDB1gokU/dRBvBlY68K1zc8x5i1zuMro2+XC/6j73Dh60UHogy4sIdH/8ZFxJK2xLKNEisW2R58F3gQbQM/PqWmGbgJMWKemLoPpFWHGgDEpaibUvorYS/0JJK7G2VmzbSqS1obJWbNVKmDiMgBFwJshQAh1V3SND4qv9t61fogYipm1gqkX1v7+87dzHA7yL3nwBcvVj78VJS8dmJZoK6R89b67iybzAIvgu0BDoKRN7IV9ZLIJfaUWMScSTSSAQkyCf/L03b8SoLZCrFZkSMimypdcLHAK91crSqJW0ErnNwIrEInGEMAI5AzOUYF6ZfIATK5F5AYFZ6tYz5dGcfCokXxmUtBIzcuLJvMDcQW+ugLW1IpPAlble9WZgGIuyKw9HCJUk4lFIIp5MCZ0OuoXlUWagcYXjZ83ceKxIvAj+AvmCrWmFz4HmUg/1heTb1FDvzcxpHUcif8inpbpRKwPbiSy3NwPsPj52ohVFsH2BZDnYl8d2BhpnVsKBaFqVUBkrUWaoN3EYidL7QEeQCUFc+eOXtz84Zq+vj82Fj18ijHYefXbOiW0P9Wtj20P92qj/H8jBpbYShaitRI0aNUrhN1DSAf3/BgazAAAAAElFTkSuQmCC"></a></li>');
            } 
        }    
    }

    function renderLiveBtn(id, type) {
        //var player = document.getElementById(id).clientWidth;
        //if(player < 350)return;
        //console.log('renderLiveBtn', id);
        let element = document.getElementById("live_top_right_link");
        if(element){ 
            return;
        }
         
        let myFFButton = document.createElement("span");         
        myFFButton.setAttribute('class','live_info');
        myFFButton.setAttribute('id','live_top_right_link');
        myFFButton.setAttribute('title','Število gledalcev');
        if(type === 'radio') {
            myFFButton.setAttribute('title','Število poslušalcev');
        }
        
        myFFButton.setAttribute('style','font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;font-size: 0.75rem;text-transform: uppercase;color: #fff; border-radius: 5px;position: absolute;background-color: #333;opacity:0.85;padding: 3px 8px;right: 10px;z-index: 9999999;top: 10px;');          
        myFFButton.style.display = 'none';
        let leftGroup = document.getElementById(id).getElementsByClassName('jw-aspect')[0];
        if(leftGroup) {
            leftGroup.insertBefore(myFFButton, leftGroup.childNodes[2]);  
        }    
    }

    function renderRadioVideoBtn(id) {
        let element = document.getElementById("live_radio_video_top_right_link");
        if(element){ 
            return;
        }
         
        let myButton = document.createElement("span");         
        myButton.setAttribute('class','live_info radio_video');
        myButton.setAttribute('id','live_radio_video_top_right_link');
        myButton.setAttribute('title','Preklopi vir');     
        myButton.setAttribute('style','cursor:pointer;font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;font-size: 0.75rem;text-transform: uppercase;color: #fff; border-radius: 5px;position: absolute;background-color: #b61702;opacity:0.85;padding: 3px 8px;right: 10px;z-index: 9999999;top: 40px;');          
        myButton.style.display = 'none';
        let leftGroup = document.getElementById(id).getElementsByClassName('jw-aspect')[0];
        if(leftGroup){
            leftGroup.insertBefore(myButton, leftGroup.childNodes[2]);  
        }       
    }

    function renderBackFFButn(id, live){
        if(jwplayer(id + '_bottom').id === id + '_bottom') {
            id = id + '_bottom';//properly attach to audio players. 
        }
        //console.log('renderBackFFButn',id, live);
        //let position = jwplayer(id).getPosition();

        window._globalFunctionsJW = {
            'forward': function(id){
                //console.log('forward id', id);
                let duration = Math.floor(jwplayer(id).getDuration());
                let position = jwplayer(id).getPosition();
                if(position + 10 > duration){
                    return;
                }
                jwplayer(id).seek(position + 10);
            },
            'back': function(id){
                //console.log('back id', id);
                let position = jwplayer(id).getPosition();
                //console.log('position', position);
                if(position <= 10){
                    jwplayer(id).seek(0);
                }
                else {
                    jwplayer(id).seek(position - 10)
                }
            },
            'backLive': function(id){
                //console.log('backLive id', id);
                let duration = Math.floor(jwplayer(id).getDuration());
                let position =  Math.floor(jwplayer(id).getPosition()); 
                let offseet = 20;//added 10 s becaouse off the buffer
                //let buffer = jwplayer().getBuffer();  
                //console.log('duration', duration); 
                //console.log('position', position); 
                //console.log('buffer', buffer);   
                if(position - offseet < duration) {
                    return;
                } 
                let seek = position - offseet;
                //console.log('seek', seek); 
                jwplayer(id).seek(seek);
                
            },
            'ffLive': function(id){
                //console.log('ffLive id', id);
                let position =  Math.floor(jwplayer(id).getPosition());
                //console.log('ffLive', id, position);  
                if(position + 20 > 0) {
                    return;  
                }     
                jwplayer(id).seek(position + 10);                        
            }
        };

        

        if(VIEWPORT_WIDTH >= 768) {//only show on bigger screens.
            
            //Fast Fowward
            var myFFButton = document.createElement("div");         
            myFFButton.setAttribute('class','jw-icon jw-icon-inline jw-button-color  jw-icon-tooltip jw-reset jw-button-custom-ff');
            if(live) {
                myFFButton.setAttribute('onclick','window._globalFunctionsJW.ffLive("'+id+'");');
            }
            else {
                myFFButton.setAttribute('onclick','window._globalFunctionsJW.forward("'+id+'");');
            }
        
            var leftGroup = document.getElementById(id).getElementsByClassName('jw-button-container')[0];
            if(leftGroup){
                leftGroup.insertBefore(myFFButton, leftGroup.childNodes[2]);
            }

            //Rewind
            var myRButton = document.createElement("div");
            myRButton.setAttribute('class','jw-icon jw-icon-inline jw-button-color  jw-icon-tooltip jw-reset jw-button-custom-bb');
            if(live) {
                myRButton.setAttribute('onclick','window._globalFunctionsJW.backLive("'+id+'");');
            }
            else {
                myRButton.setAttribute('onclick','window._globalFunctionsJW.back("'+id+'");');
            }
            
            var leftGroup = document.getElementById(id).getElementsByClassName('jw-button-container')[0];
            if(leftGroup){
                leftGroup.insertBefore(myRButton, leftGroup.childNodes[2]);
            }
        }
        else { //ONLY ON MOBILE 
           
            let elem = document.getElementsByClassName('jw-display-icon-next');
            try {
                if(typeof elem[0] == 'object') {
                    if(live) {       
                       elem[0].outerHTML = "<div onclick=\"window._globalFunctionsJW.ffLive('" + id + "');\" class='jw-display-icon-container jw-display-icon-forward' ><div class='jw-icon jw-icon-forward' aria-label='Naprej'></div></div>";
                    }
                    else {
                        elem[0].outerHTML = "<div onclick=\"window._globalFunctionsJW.forward('" + id + "');\" class='jw-display-icon-container jw-display-icon-forward' ><div class='jw-icon jw-icon-forward' aria-label='Naprej'></div></div>";           
                    }                   
                }
            }
            catch(e){};          
        }    
    }

    function mutateLiveTimeScrollStop() {
        document.body.classList.remove("live4d-playing-now");

        if(window.__global_mutationObserver_Live){          
            window.__global_mutationObserver_Live.disconnect();
            window.__global_mutationObserver_Live = null;
        }

        if(window.__global_mutationObserver_LiveLock){
            window.__global_mutationObserver_LiveLock = false;
        }

        if(window.__global_mutationObserver_Live2){          
            window.__global_mutationObserver_Live2.disconnect();
            window.__global_mutationObserver_Live2 = null;
        }

        if(window.__global_mutationObserver_LiveLock2){
            window.__global_mutationObserver_LiveLock2 = false;
        }
    }

    function mutateLiveTimeScroll(data){

        var liveOffset = 72000;
        
        try {
            liveOffset = data.mediaFiles[0].dvr;
        }
        catch(e){}


                       
        document.body.classList.add("live4d-playing-now");    
        /**
         * Overide default player behavior - absolute time
         * Carfull using system time and fixed offeset 2h!
         */
        if ("MutationObserver" in window) {
               
            window.__global_mutationObserver_LiveLock = false;
            window.__global_mutationObserver_Live = new MutationObserver(function(mutations) {      
                 

                if(window.__global_mutationObserver_LiveLock === true){
                    //console.log("window.__global_mutationObserver_LiveLock ", window.__global_mutationObserver_LiveLock);
                    window.__global_mutationObserver_LiveLock = false;
                    return;
                }
                mutations.forEach(function(mutation) {

                   // console.log("mutation ", mutation);

                    var cssText = mutation.target.style.left;
                    if(cssText && cssText.indexOf('%') > -1){

                        var el = document.getElementsByClassName("jw-time-tip");
                        
                        if(el && el.length) {
                            
                            var procent = parseFloat(cssText.replace('%',''));
                            cssText = liveOffset * 10 * (100 - procent);
                            var d = new Date(Date.now() - cssText);

                            function addZero(i) {
                                if (i < 10) {
                                i = "0" + i;
                                }
                                return i;
                            }

                            var h = d.getHours(); // => 9
                            var m = d.getMinutes(); // =>  30
                            var s = d.getSeconds(); // => 51

                            window.__global_mutationObserver_LiveLock = true;
                            //el[0].innerHTML = addZero(h) + ':' + addZero(m) + ':' + addZero(s);

                            var el = document.getElementsByClassName("jw-icon jw-icon-inline jw-text jw-reset jw-text-elapsed");      
                            if(el && el.length) {
                                var time = addZero(h) + ':' + addZero(m) + ':' + addZero(s);
                                //console.log('time',time);
                                el[0].innerHTML = time;
                            }
                        }
                    }                 
                });
            });
            
            var target_ = document.getElementsByClassName("jw-icon jw-icon-tooltip jw-tooltip-time jw-button-color");

            if(target_ && target_.length > 0){
                target_ = target_[0]; 
                if(window.__global_mutationObserver_Live){
                    window.__global_mutationObserver_Live.observe(target_, {
                        attributes: true,
                        characterData: false,
                        childList: true,
                        subtree: false,
                        attributeOldValue: true,
                        characterDataOldValue: false
                    });
                }                      
            }
        }
    }

    window.__global_mutationObserver_LiveLock2 = false;
    window.__global_mutationObserver_Live2 = null;
    function mutateLiveTimebarUpdate(data) {

        var liveOffset = 72000;
        
        try {
            liveOffset = data.mediaFiles[0].dvr;
        }catch(e){}


        /**
         * Overide default player behavior - absolute time
         * Carfull using system time and fixed offeset 2h!
         */
        if ("MutationObserver" in window) {
                
            window.__global_mutationObserver_LiveLock2 = false;
            window.__global_mutationObserver_Live2 = new MutationObserver(function(mutations) {  
                /*console.log("mutations[0].oldValue", mutations[0].oldValue);
                if(typeof mutations[0].oldValue === 'string' &&  mutations[0].oldValue.indexOf('99.999') > -1){
                    return;
                }*/

                if(window.__global_mutationObserver_LiveLock2 === true){
                    //console.log("window.__global_mutationObserver_LiveLock ", window.__global_mutationObserver_LiveLock);
                    window.__global_mutationObserver_LiveLock2 = false;
                    return;
                }
                mutations.forEach(function(mutation) {

                    //console.log('mutation',mutation);
        
                    var cssText = mutation.target.style.width;
                    if(cssText && cssText.indexOf('%') > -1){

                        var el = document.getElementsByClassName("jw-icon jw-icon-inline jw-text jw-reset jw-text-elapsed");
                        
                        if(el && el.length) {
                            
                            var procent = parseFloat(cssText.replace('%',''));
                            cssText = liveOffset * 10 * (100 - procent);
                            var d = new Date(Date.now() - cssText);

                            function addZero(i) {
                                if (i < 10) {
                                i = "0" + i;
                                }
                                return i;
                            }

                            var h = d.getHours(); // => 9
                            var m = d.getMinutes(); // =>  30
                            var s = d.getSeconds(); // => 51

                            window.__global_mutationObserver_LiveLock2 = true;
                            var time = addZero(h) + ':' + addZero(m) + ':' + addZero(s);
                            //console.log('time1',time);
                            el[0].innerHTML = time;
                            //el[0].innerHTML = addZero(h) + ':' + addZero(m) + ':' + addZero(s);
                        }
                    }
                                   
                });
            });
            
            var target_ = document.getElementsByClassName("jw-progress jw-reset");

            if(target_ && target_.length > 0){
                target_ = target_[0]; 
                if(window.__global_mutationObserver_Live2){
                    window.__global_mutationObserver_Live2.observe(target_, {
                        attributes: true,
                        characterData: false,
                        childList: true,
                        subtree: false,
                        attributeOldValue: true,
                        characterDataOldValue: false
                    });
                }                      
            }
        }
    }

    function onair(id, padding, video, container, info, stuff) {
      
        var $space = $("<div>");
        $space.css({
            "padding": "10px",
            "top" : "0",
            "width": (video.width - (padding[1] * 2)),
            "overflow": "hidden",
            "position": "absolute",
            "z-index": 99999,
            "max-width": "100%"  
        });

        $(container).append($space);


        var $onair = $("<div>");
        $onair.css({
            "float": "left",
            "background-image": "url('" + video.url["static"] + "img/onair_bg.png')",
            "background-position": "center center",
            "background-repeat": "repeat",
            "position": "relative",
            "display": "none",
            "height": "45",
            "cursor": "pointer",
            "width": "100%",
            "border-radius": "5px"
          
        });
        $space.append($onair);


        if (id == "ra.val202") {
            $onair.attr('title', 'Glasbeni S.O.S.')
            $onair.click(function(a) {
                window.open( "https://val202.rtvslo.si/sos/", '_blank');
               
            });
        }
        if (id == "ra.a1") {
            $onair.attr('title', 'Glasbeni S.O.S.')
            $onair.click(function(a) {
                window.open( "https://prvi.rtvslo.si/sos/", '_blank');
               
            });
        }
        if (id == "ra.ars") {
            $onair.attr('title', 'Glasbeni S.O.S.');
            $onair.click(function(a) {
                window.open( "https://ars.rtvslo.si/sos/", '_blank');
               
            });
        }

        var $logo = $("<div>");
        $logo.css({
            /*"background-image": "url('" + video.url["static"] + "img/onair_left.png')",*/
            "background-position": "top left",
            "background-repeat": "no-repeat",
            "position": "relative",
            "padding": "0px 0px 0px 10px"
        });

        $onair.append($logo);

        var refresh = (function() {
               
            var radio_stations = [];
            radio_stations["ra.a1"] = "ra1";
            radio_stations["ra.val202"] = "val202";
            radio_stations["ra.ars"] = "ars";
            radio_stations["ra.mb1"] = "ramb";
            radio_stations["ra.rsi"] = "rsi";
            radio_stations["ra.kp"] = "rakp";
            radio_stations["ra.capo"] = "racap";
            radio_stations["ra.mmr"] = "mmr";
            radio_stations["ra.raz"] = "raz";

            if(typeof radio_stations[id] === 'undefined'){
                console.log('undefined radio_station')
                return;
            }
            
   
            $.ajax({
                url: "https://api.rtvslo.si/onair/" + radio_stations[id],
                dataType: 'jsonp',
                cache: 'false',
                jsonpCallback: function() {
                    var random = Math.floor(Math.random() * 1000);
                    return 'ava_onair_' + random;
                },
                success: function(data) {
                                   
                    var isData = 0;
                  
                    if (data && data.response) {

                        var $content = $("<div>");
                        $content.css({
                                "background-image": "url('" + video.url["static"] + "img/onair_mic.png')",
                                "background-position": "0 center",
                                "background-repeat": "no-repeat",
                                "position": "relative",
                                "padding": "8px 15px 0px 29px",
                                "height": "45",
                                "color": "white",
                                "font-family": "Helvetica, sans-serif",
                                "font-size": "12px",
                                "line-height": "16px"
                        }); 

                        if(data.response && data.response.status && data.response.status === 'on'){
                            if(info.playlist && info.playlist.length  && info.playlist.length > 0 && info.playlist[0].format == 'audio'){
                                current = '<strong style="padding-top:8px;white-space:nowrap;text-overflow:ellipsis;width:100%;display:inline-block;overflow:hidden;">Na voljo je video signal.</strong>';
                                $content.append(current);
                                $logo.empty();
                                $onair.css({
                                    "display": "block"
                                });
                                $onair.attr('title', 'Preklopite na video signal.')
                                $logo.append($content);

                                $logo.on('click', function(){
                                    window.location.reload();
                                });
                            }
                            return;
                        }



                        if (typeof data.response.BroadcastMonitor.Current !== 'undefined' && (data.response.BroadcastMonitor.Current.Interface === 'MUSIC' || (typeof data.response.BroadcastMonitor.Current.CategoryFullName !== 'undefined' && data.response.BroadcastMonitor.Current.CategoryFullName.indexOf('GLASBA') >= 0))) {
                            if (typeof data.response.BroadcastMonitor.stationName !== 'undefined' && data.response.BroadcastMonitor.stationName === 'MMR') {
                                current = "Most szól:<br />";
                            } else if (typeof data.response.BroadcastMonitor.stationName !== 'undefined' && data.response.BroadcastMonitor.stationName === 'STATIONITA') {
                                current = "Ora in onda:<br />";
                            } else if (typeof data.response.BroadcastMonitor.stationName !== 'undefined' && data.response.BroadcastMonitor.stationName === 'RSI') {
                                current = "Currently on air:<br />";
                            } else {
                                current = "Predvaja se:<br />";
                            }
                            c = data.response.BroadcastMonitor.Current;
                            if (c.artistName.length === 0) {
                                current += '<strong style="white-space:nowrap;text-overflow:ellipsis;width:100%;display:inline-block;overflow:hidden;">' + c.titleName + ' - ' + c.Comment1 + '</strong>';
                            } else {
                                current += '<strong style="white-space:nowrap;text-overflow:ellipsis;width:100%;display:inline-block;overflow:hidden;">' + c.artistName + ' - ' + c.titleName + '</strong>';
                            }

                            

                            $content.append(current);
                            $logo.empty();
                            $onair.css({
                                "display": "block"
                            });
                            $logo.append($content);
                            isData += 1;
                        }
                    }
                    if (isData < 1) {
                     
                        $onair.css({
                            "display": "none"
                        });
                    }

                  

                   
                },
                error: function(e){
                    console.log('e',e);
                }
            });
        });

        setInterval(function() {
            refresh();
        }, 30 * 1000);

        refresh();
    }
    /*
        Live player 
    */
    function buildPlaylist(data, video) {
        //console.log(data.response);
        //Overide API with user selection.
        var id = '0';
        if (data && typeof data.response !== 'undefined' && data.response.id !== 'undefined') {
            id = data.response.id;
        }

        //var selected = $.cookieApi("read", null, "jwplayer.liveRadioStream" + id, 365);
        //if (selected === 'audio' && data.response.id.indexOf('tv') === -1) {
        //    data.response.mediaType = 'audio';
        //}
        var radio_stations = ["ra.a1", "ra.val202", "ra.ars", "ra.mb1", "ra.rsi", "ra.kp", "ra.capo", "ra.mmr", "ra.sport202", "ra.raz", "ra.ukr"];
        var channel_type = 'tv';

        var isRadio = radio_stations.filter(function(item) {
            return item == data.response.id;
        })
        if (isRadio.length > 0) {
            channel_type = 'ra';
        }


        var i = [];
        switch (channel_type) {
         
            case "tv":

                var myvideo = null;
                $.each(data.response.mediaFiles, function(s) {
                    if (data.response.mediaFiles[s].mediaType === 'video') {
                        myvideo = data.response.mediaFiles[s];
                    }
                });

                if (myvideo === null) {
                    console.log('missing stream files')
                    return false;
                }

                var playlist = {};
                playlist.format = data.response.mediaType;
                //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 2408 ~ buildPlaylist ~ data.response", data.response)
                playlist.sources = [];
                if (typeof data.response.title === 'string') {
                    playlist.title = data.response.title + ' ' + data.response.id;//DC they dont want this
                }

                try {
                    if (typeof data.response.images.orig !== 'undefined') {
                        playlist.image = forceSLL(data.response.images.orig);
                    }
                } catch (e) {}


                try {
                    if (typeof data.response.onair.current.thumbnail === 'string') {
                        var tmp = data.response.onair.current.thumbnail;
                       
                        if(tmp.indexOf("174734331") === -1){
                            playlist.image = forceSLL(data.response.onair.current.thumbnail);
                        }
                        
                    }
                } catch (e) {}


                if (myvideo.type === "hls") {
                    playlist.sources[0] = {
                        'default': true,
                        file: (myvideo.streamer + myvideo.file),
                        type: "hls",
                        'default': 'true',
                    };
                }

                return getPreroll(playlist, data, video);
                //break;
            case "ra":

                var myvideo = null;
                var myaudio = null;
                var channels = LIVE_CHANNELS;
                var index = channels.indexOf(data.response.id);
                $.each(data.response.mediaFiles, function(s) {
                    if (data.response.mediaFiles[s].mediaType === data.response.mediaType) { // Ta pogoj odloči ali se bo zaplayal video ali audio
                        if(data.response.mediaType === 'video'){
                            //SET PIŠKOT DA IGRA VIDEO          
                            if(index !== -1){
                                var id = index + 1;
                                $.cookieApi("set", "on", "jwplayer.liveRadioStream" + id, 1);
                            }
                        }
                        myvideo = data.response.mediaFiles[s];
                    } else {
                        myaudio = data.response.mediaFiles[s];
                        if(index !== -1){
                            var id = index + 1;
                            $.cookieApi("set", null, "jwplayer.liveRadioStream" + id, 0);
                        }
                    }
                });


                if (myvideo === null) {
                    console.log('missing stream files')
                    return false;
                }
                
                function createPlaylist(myvideo, data, title, format, playlist_image) {
                    var i = [];
                    i[0] = {};
                    i[0].sources = [];
                    var playlist = i[0];

                    playlist.title = title;
                    playlist.format = format;
                    playlist.image = playlist_image;

                    if (myvideo.type === "hls") {
                        playlist.sources[0] = {
                            'default': true,
                            file: (myvideo.streamer + myvideo.file),
                            type: "hls",
                        };
                    }
                    return playlist;
                }

                let playlist_image = null
                try {
                    if (typeof data.response.images.orig !== 'undefined') {         
                        playlist_image = data.response.images.orig;
                    }
                } catch (e) {}

                try {
                    if (typeof video.image === 'string' && video.image.indexOf('https://') > -1) {         
                        playlist_image = video.image;
                    }
                } catch (e) {}
             

                var playlists = [];
                playlists.push(createPlaylist(myvideo, data,'', data.response.mediaType, playlist_image));

                //FALBACK AFTER VIDEO ENDED
                if (myaudio && myaudio.mediaType === 'audio') {
                    playlists.push(createPlaylist(myaudio, data, 'Predvajanje vsebine brez video signala, samo zvok.', data.response.mediaType, playlist_image));
                }

                //console.log('playlists', playlists);
                return playlists;

        }
        return null;
    }

    function getPreroll(i, data, video) {

        var playlist = [];
        
        //PG12/15/With parents preroll
        /*
        var pgItem = {};
        pgItem.sources = [];
        pgItem.title = 'Opozorilo za starše - PG'
        try{
            if(data.response.broadcast.parentalGuidance){
                var parentalGuidance = data.response.broadcast.parentalGuidance;
                if(parentalGuidance == 5) {               
                    pgItem.sources[0] = {
                        file: "https://videoweb.rtvslo.si/ava_archive02/preroll/nst_720p.mp4",
                        type: "mp4"
                    };
                    playlist.push(pgItem);
                }
                else if(parentalGuidance == 3) {               
                    pgItem.sources[0] = {
                        file: "https://videoweb.rtvslo.si/ava_archive02/preroll/pg12_720p.mp4",
                        type: "mp4"
                    };
                    playlist.push(pgItem);
                }
                else if(parentalGuidance == 4) {               
                    pgItem.sources[0] = {
                        file: "http://videoweb.rtvslo.si/ava_archive02/preroll/pg15_720p.mp4",
                        type: "mp4"
                    };
                    playlist.push(pgItem);
                }
                
            }
        }catch(e){}
        
        */                
        playlist.push(i);

        var modified = playListToSSL(playlist);
        
        return modified;
        


        //if(typeof data.response.clip !== 'undefined') return [];
        var min = 0;
        var max = 5;
        // and the formula is:
        var random = Math.floor(Math.random() * (max - min + 1)) + min;
        var showPreroll = false;
        if (random === 3) {
            showPreroll = false; //11.1.2017 dost je bilo nepotrebnega obremenjevnja userjev
        }


        
        var t = null;
        if (typeof data.response.showTypeId !== 'undefined' && typeof video.preroll[data.response.showTypeId] !== 'undefined') {
            t = video.preroll[data.response.showTypeId];
        }
        if (typeof data.response.category !== 'undefined' && typeof video.preroll[data.response.category] !== 'undefined') {
            t = video.preroll[data.response.category];
        }

        
        //UEFA
        var UEFA = 'xxx';
        if (data.response.showId === UEFA /* || data.response.id === 'tv.slo2' || data.response.id === 'tv.mmctv'*/ ) {


            showPreroll = true;
            t = {
                rtmp: '/2016/06/07/RKL-REKLAME-20160607-000-UEFAEURO2016DigitalMediaBumper_0.mp4',
                html5: '/2016/06/07/RKL-REKLAME-20160607-000-UEFAEURO2016DigitalMediaBumper_0.mp4'
            }
            var duration = parseInt(data.response.duration, 10);
            if (duration > 600) {
                t = {
                    rtmp: '/2016/06/10/RKL-REKLAME-20160610-000-UEFAEURO2016uvodnaspica_19201223.mp4',
                    html5: '/2016/06/10/RKL-REKLAME-20160610-000-UEFAEURO2016uvodnaspica_19201223.mp4'
                }
            }
        }




        if (showPreroll === true && t !== null && data.response.mediaType === "video" && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) === false /* && typeof data.response.clip == 'undefined'*/ ) {
            var preroll = {};
            preroll.sources = [];
        
            var streamer = IOS_RTVSLO_SI_SERVER + "/simplevideostreaming42";
            if (data.response.mediaFiles.length > 0) {
                if (typeof data.response.mediaFiles[0].streamers !== 'undefined') {
                    streamer = data.response.mediaFiles[0].streamers.hls;
                }

            }
            

            var RAND = Math.floor(Math.random() * 10011111);
            var hls_stream_server = streamer + "/_definst_/" + t["rtmp"] + "/playlist.m3u8?RAND=" + RAND;
            hls_stream_server = replaceEndpointHLS(hls_stream_server);
            preroll.sources.push({
                file: hls_stream_server,
                type: "hls"
            });

            preroll.sources.push({
                file: (video.streamer["rtmp"] + "/mp4:" + t["rtmp"]),
                type: "rtmp"
            });

            preroll.sources.push({
                file: (video.streamer["html5"] + t["html5"]),
                type: "mp4"
            });

            if (typeof i.image !== 'undefined') {
                preroll.image = i.image;
            }

            //console.log('preroll ' , preroll);
            playlist[0] = preroll;
            playlist[1] = i;

            //console.log("playlist ", playlist);

            //UEFA POST ROLL
            /*if (data.response.showId === UEFA) {

                var duration = parseInt(data.response.duration, 10);
                if (duration > 600) {
                    var clone = JSON.parse(JSON.stringify(preroll));
                    c = {
                        rtmp: '/2016/06/10/RKL-REKLAME-20160610-000-UEFAEURO2016ClosingSequence_0.mp4',
                        html5: '/2016/06/10/RKL-REKLAME-20160610-000-UEFAEURO2016ClosingSequence_0.mp4'
                    }

                    clone.sources[0] = {
                        file: (streamer + "/_definst_/" + c["rtmp"] + "/playlist.m3u8?RAND=" + RAND),
                        type: "hls"
                    }
                    clone.sources[1] = {
                        file: (video.streamer["rtmp"] + "/mp4:" + c["rtmp"]),
                        type: "rtmp"
                    }
                    clone.sources[2] = {
                        file: (video.streamer["html5"] + c["html5"]),
                        type: "mp4"
                    }
                    playlist[2] = clone;

                } else {
                    playlist[2] = preroll;
                }
            }*/
        } else {
            playlist[0] = i;
        }
        if (typeof data.response.clip !== 'undefined') {
            //console.log(playlist);
        }

       
        var modified = playListToSSL(playlist);

        return modified;
    }

    function playListToSSL(playlist) {
        var list = playlist || [];
        list.map(function(itm) {
            if (typeof itm.image === 'string' && itm.image.indexOf(PROTOCOL) === -1) {
                itm.image = itm.image.replace('http://', PROTOCOL);
            }
            if (typeof itm.sources !== 'undefined' && typeof itm.sources.length !== 'undefined') {
                itm.sources.map(function(source) {
                    if (source && source.file && typeof source.file === 'string' && source.file.indexOf(PROTOCOL) === -1) {
                        source.file = source.file.replace('http://', PROTOCOL);
                    }
                })
            }
        })
        return list;
    }

    function getLogo(video, data) {
        var logo = {};
        logo.file = video.url["static"] + ((video.height > 200) ? video.logo["big"] : video.logo["small"]);
        logo.link = forceSLL("http://4d.rtvslo.si/");
        try {
            if (data.response.link) {
                logo.link = data.response.link;
            }
        } catch (e) {};

        logo.position = "bottom-right";
        logo.hide = true;

        var isLogo = true;
        $.each(video.domains, function(t) {
            if (location.host.toLowerCase().indexOf(video.domains[t]) >= 0) {
                isLogo = false;
                return false;
            }
        });

        if (isLogo) {
            return logo;
        }
        return false;
    }

    function clipRecording(container, video) {

        var startSeconds = 0;
        if (typeof video.clip.start !== 'undefined') {
            if (typeof video.clip.start === 'string') {
                var start = video.clip.start.split(":");
                if (start.length === 3) {
                    var startSeconds = 0;
                    startSeconds += Math.floor(start[0]) * 60 * 60;
                    startSeconds += Math.floor(start[1]) * 60;
                    startSeconds += Math.floor(start[2]);
                    if (startSeconds > 0) {
                        video.clip.offset = startSeconds;
                    }
                }
            }
        } else {
            video.clip.start = -1;
        }

        var endSeconds = 0;

        //console.log("video.clip.end ", video.clip.end = null);

        if (typeof video.clip.end !== 'undefined') {

            if (typeof video.clip.end === 'string') {
                var end = video.clip.end.split(":");
                if (end.length === 3) {
                    var endSeconds = 0;
                    endSeconds += Math.floor(end[0]) * 60 * 60;
                    endSeconds += Math.floor(end[1]) * 60;
                    endSeconds += Math.floor(end[2]);
                    if (endSeconds > 0 && endSeconds > startSeconds) {
                        video.clip.duration = endSeconds - startSeconds;
                    }
                }
            }
        }


        if (typeof video.clip.offset === 'undefined' && typeof video.clip.duration === 'undefined') {
            return;
        }

        if (typeof video.clip.offset === 'string') {
            video.clip.offset = parseInt(video.clip.offset, 10) || -1;
        }

        if (typeof video.clip.duration === 'string') {
            video.clip.duration = parseInt(video.clip.duration, 10) || -1;
        }

        rtvdef.offset = video.clip.offset;

        var state = 0;

        function clipPlay(player) {

            if (video.clip.offset !== -1) {
                var offset = parseInt(video.clip.offset, 10) || 0;
                if (offset > 0) {
                    player.seek(video.clip.offset);
                }
            } else {
                video.clip.offset = 0;
            }

            if (video.clip.duration !== -1) {
                player.on("time", function(c) {
                    if (c.position >= (video.clip.offset + video.clip.duration)) {
                        player.stop();
                        state = 1;
                    }
                });
            }
        };


        if (jwplayer(container.id) && jwplayer(container.id).getPlaylist() && jwplayer(container.id).getPlaylist().length > 1) {

            jwplayer(container.id).onPlaylistItem(function(a) {

                if (jwplayer(container.id).getPlaylist().length - 1 === jwplayer(container.id).getPlaylistIndex()) {
                    //jwplayer(container.id)
                    jwplayer(container.id).on("play", function(a) {
                        clipPlay(jwplayer(container.id));
                        if (state > 0) {
                            jwplayer(container.id).playlistItem(0);
                            state = 0;
                        }
                    });
                }
            });
        } else {
            state = 1;
            jwplayer(container.id).on("play", function(a) {
                if (state > 0) {
                    clipPlay(jwplayer(container.id));
                    state = 0;
                }
            });
        }
    }

    function playFiles(container, info, video) {

        //console.log("container ", container);
        //console.log("info 1", info);
        //console.log("video ", video);

        info.playlist = [];
        info.playlist[0] = {};
        if (typeof video.image !== "undefined") {
            info.playlist[0].image = video.image;
        }

        info.playlist[0].sources = [];
        var t = 0;
        data = {};
        data.response = {};
        data.response.mediaType = "video";
        if (typeof video.playfile["rtmp"] !== "undefined") {
            info.playlist[0].sources[t] = {
                file: video.playfile["rtmp"],
                type: "rtmp"
            };
            if (video.playfile["rtmp"].indexOf(".mp3") > 0 || video.playfile["rtmp"].indexOf(".wav") > 0) {
                data.response.mediaType = "audio";
            }
            t += 1;
        }

        if (typeof video.playfile["html5"] !== "undefined") {
            if (video.playfile["html5"].indexOf(".mp3") > 0 || video.playfile["html5"].indexOf(".wav") > 0) {
                info.playlist[0].sources[t] = {
                    file: video.playfile["html5"],
                    type: "mp3"
                };
                data.response.mediaType = "audio";
            } else {
                info.playlist[0].sources[t] = {
                    file: video.playfile["html5"],
                    type: "mp4"
                };
            }
            t += 1;
        }

        try {
            if (typeof video.ads["common"]["pre"] !== "undefined") {
                data.response.zone_id = video.ads["common"]["pre"];
            }
            if (typeof video.ads["common"]["post"] !== "undefined") {
                data.response.zone_id = video.ads["common"]["post"];
            }
        } catch (e) {};

        return showPlayer(container, data, info, video);
    }


    function odprtikopInit($container, vtt_file) {

        var template = '<div id="transcripts_odprti_kop" class="transcripts" style="display:none;">' +
            '<div id="header-search-input" class="searchbox">' +
            '<span id="match_vtt" class="match"></span>' +
            '<input id="search_vtt" type="search" class="search" placeholder="Iskalnik"  />' +
            //'<span class="input_search_bar_icon"><img src="https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico%20search.png"/></span>' + 
            '<span id="search_vtt_close" class="search_button" onclick="window._globalTtoogleInteractiveFunc();">' + lang.close + '</span>' +
            '</div>' +
            '<div id="transcript_vtt" class="transcript"></div>' +
            '</div>';

        
        if(document.body.classList.contains('rtv4d-ng')) {

            template = `<div class="d-flex justify-content-between">
            <div class="d-flex align-items-center">
              <div class="input-group mr-2" style="width: 200px;" id="header-search-input">
                <input id="search_vtt"  type="text" class="form-control form-control-sm" placeholder="Iskalnik" aria-label="Iskanje po podnapisih" aria-describedby="subtitle-search-btn">
                <div class="input-group-append">
                  <button class="btn btn-secondary btn-sm" type="button" aria-label="Začni iskanje" id="subtitle-search-btn"><span class="icon-search"></span></button>
                </div>
              </div>
              <small class="text-muted">
                Rezultat: <span id="match_vtt" class="match"></span>
              </small>
            </div>
            <div class="ml-lg-auto h6 font-weight-light rtv4d-options-buttons flex-lg-column flex-xl-row d-flex d-xl-block">
              <a href="javascript:transcript.close();" class="mt-2 text-uppercase"><span class="option-text">Zapri</span><span class="icon-cross ml-2 muted small"></span></a>
            </div>
          </div>
          <p id="transcript_vtt" class="transcript mt-2"></p>`;      
        }
        
        var inject = $.parseHTML(template);
        if(document.body.classList.contains('rtv4d-ng')) {
            $("#rtv4d-main-player-transcript").append(inject);
        }else {      
            $container.parent().append(inject);
        }
         
       

       
       
        var chapters = [];
        var captions = [];
        var caption = -1;
        var matches = [];
        var query = "";
        var cycle = -1;

        var transcript = document.getElementById('transcript_vtt');
        var search = document.getElementById('search_vtt');
        var match = document.getElementById('match_vtt');

        if(transcript && search && match) {
            loadCaptions(vtt_file);
        }else {
            console.error('E_DOM_EL_MISSING')
        }
        

        //https://img.rtvslo.si/_up/ava/ava_misc/subs/2019/06/05/Kultura040619.vtt

        function loadCaptions(vtt_file) {
            
            //console.log('vtt_file',vtt_file );
            if(typeof vtt_file !== 'string')return;
            vtt_file = vtt_file.replace('http://','https://').replace('//api.rtvslo.si/ava/subtitles','//img.rtvslo.si/_up/ava');
            
            //console.log('vtt_filevtt_file', vtt_file);
            var r = new XMLHttpRequest();
            r.onreadystatechange = function() {


                if (r.readyState == 4 && r.status == 200) {

                    //console.log('r.responseText', r.responseText);
                    var t = r.responseText
                        .replace(/font color=/g, '')
                        .replace(/font/g, '').replace(/&lt;/g, '').replace(/&gt;/g, '')
                        .replace(/<\/>/g, '').replace(/<\\b>/g, '').replace(/<\/b>/g, '')
                        .replace(/<br>/g, '').replace(/<b>/g, '').replace(/<br\/>/g, '')
                        .replace(/<\"#FFFF00\">/g, '').replace(/<\"#00FF00\">/g, '')
                        .replace(/<\"#0000FF\">/g, '').replace(/<br \/>/g, '')
                        //.replace(/.c/g, 'span')
                        .replace(/\r/g, '')
                        .split("\n\n");
                    
                    
                   
                    t.shift();
                    var h = "<p>";
                    var s = 0;
                 
                    for (var i = 0; i < t.length; i++) {
                                          
                        var c = parse(t[i]);
                        if (c === null) continue;

                       // console.log('c ', c )
                        if (s < chapters.length && c.begin > chapters[s].begin) {
                            h += "</p><h4>" + chapters[s].text + "</h4><p>";
                            s++;
                        }

                        if(c && c.text && typeof c.text === 'string'){

                          
                            c.text = c.text.replaceAll('&lt;c.yellow&gt;','<span style="color:#ffff66;display:inline;">');// <c.yellow></c.yellow>
                           
                            c.text = c.text.replaceAll('&lt;c.green&gt;','<span style="color:#00ff99;display:inline;">');// <c.yellow></c.yellow>
                        
                            c.text = c.text.replaceAll('&lt;c.blue&gt;','<span style="color:#0099ff;display:inline;">');// <c.yellow></c.yellow>
                           
                            c.text = c.text.replaceAll('&lt;c.pink&gt;','<span style="color:#ff33cc;display:inline;">');// <c.yellow></c.yellow>

                            c.text = c.text.replaceAll('&lt;c.white&gt;','<span style="color:#ffffff;display:inline;">');// <c.yellow></c.yellow>

                            c.text = c.text.replaceAll('&lt;/c.&gt;','</span>');// 

                            c.text = c.text.replaceAll('&lt;/c&gt;','</span>');// <c.yellow></c.yellow>
                    
                        }
                       

                        //console.log('c', c);
                        var line_content = c.btext + ' - ' + c.text; //.replace(/font color=/g, 'span id="caption' + i+ '" style=').replace(/font/g, 'span').replace(/&lt;/g, '<').replace(/&gt;/g, '>'); 

                        //console.log('line_content',line_content );

                        h += "<span id=caption" + i + ">" + line_content + "</span>";
                        captions.push(c);
                    }

                    //console.log(h);

                    transcript.innerHTML = h + "</p>";
                }
            };
            r.open('GET', vtt_file, true);
            r.send();
        };

        function parse(d) {
            var a = d.split("\n");

            //console.log('a', a)
            //if (a.length < 3) return null;
            var i = a[0].indexOf(' --> ');
            var t = a[1];
            if (a[2]) {
                t += " " + a[2];
            }
            if (a[3]) {
                t += " " + a[3];
            }
            if (typeof t === 'string') {
                t = t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            } else {
                t = '';
            }

            return {
                begin: seconds(a[0].substr(0, i)),
                btext: a[0].substr(3, i - 7),
                end: seconds(a[0].substr(i + 5)),
                text: t
            }
        };

        function seconds(s) {

            //console.log('s', s);
            var a = s.split(':');
            var r = Number(a[a.length - 1]) + Number(a[a.length - 2]) * 60;
            if (a.length > 2) {
                r += Number(a[a.length - 3]) * 3600;
            }
            return r;
        };



        // Highlight current caption and chapter
        jwplayer().on('time', function(e) { 
            var p = e.position;
            for (var j = 0; j < captions.length; j++) {
                if (captions[j].begin < p && captions[j].end > p) {
                    if (j != caption) {
                        var c = document.getElementById('caption' + j);
                        if (caption > -1) {
                            document.getElementById('caption' + caption).className = "";
                        }
                        c.className = "current";
                        if (query == "") {
                            transcript.scrollTop = c.offsetTop - transcript.offsetTop - 40;
                        }
                        caption = j;
                    }
                    break;
                }
            }
        });



        // Hook up interactivity
        transcript.addEventListener("click", function(e) {
            //  console.log('transcript e', e.target);
            if (e.target.id.indexOf("caption") == 0) {
                var i = Number(e.target.id.replace("caption", ""));

                //console.log('i',i );
                jwplayer().seek(captions[i].begin);
            }
        });
        search.addEventListener('focus', function(e) {
            setTimeout(function() {
                search.select();
            }, 100);
        });
        search.addEventListener('keydown', function(e) {    
                if(e.code === 'Escape') {
                    this.value = '';
                }    
                //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 3188 ~ search.addEventListener ~ e", e)  
                var q = this.value.toLowerCase();    
                if(q.length < 3) return;        
                if (q.length > 0) {
                    if (q == query) {
                        if (cycle >= matches.length - 1) {
                            cycleSearch(0);
                        } else {
                            cycleSearch(cycle + 1);
                        }
                    } else {
                        resetSearch();
                        searchTranscript(q);
                    }
                } else {
                    resetSearch();
                }
            
        });



        // Execute search
        function searchTranscript(q) {
            matches = [];
            query = q;
            for (var i = 0; i < captions.length; i++) {
                var m = captions[i].text.toLowerCase().indexOf(q);
                if (m > -1) {
                    document.getElementById('caption' + i).innerHTML =
                        captions[i].text.substr(0, m) + "<em>" +
                        captions[i].text.substr(m, q.length) + "</em>" +
                        captions[i].text.substr(m + q.length);
                    matches.push(i);
                }
            }
            if (matches.length) {
                cycleSearch(0);
            } else {
                resetSearch();
            }
        };

        function cycleSearch(i) {
            if (cycle > -1) {
                var o = document.getElementById('caption' + matches[cycle]);
                o.getElementsByTagName("em")[0].className = "";
            }
            var c = document.getElementById('caption' + matches[i]);
            c.getElementsByTagName("em")[0].className = "current";
            match.innerHTML = (i + 1) + " / " + matches.length;
            transcript.scrollTop = c.offsetTop - transcript.offsetTop - 40;
            cycle = i;
        };

        function resetSearch() {
            if (matches.length) {
                for (var i = 0; i < captions.length; i++) {
                    document.getElementById('caption' + i).innerHTML = captions[i].btext + " - " + captions[i].text;
                }
            }
            query = "";
            matches = [];
            match.innerHTML = "0 / 0";
            cycle = -1;
            transcript.scrollTop = 0;
        };

    }

    function errorHandler(err, data, context) {
        
        // Base URL for error reporting
        const urlBase = 'https://www.rtvslo.si/predvajalnik-rtv-slo/prijava-napake';
        const errorCode = err.code || '';
        const errorMsg = err.message || '';
        
        // Determine URL parameters based on the data response
        const response = (data && data.response) || null;
        //return if no response
        if(response === null) return;

        const id = response.id || '';
        const type = response.jwt ? 'VOD' : 'LIVE';
        const urlError = `${urlBase}?jw_error=${errorCode}&type=${type}&id=${id}`;
      
        // Construct error HTML
        const errorHtml = `
          <div class="custom-error-msg-jw" style="text-align:center;font-size:0.875rem;color:#ccc;line-height:1.2rem;">
            <div class="c-error-text">${errorMsg}</div>
            <div class="c-error-text">
              Prosimo, <a style="color:#2780e3;font-weight:bold;" href="javascript:void(0);" onclick="window.location.reload();">ponovno naložite</a> stran ali 
              <a style="color:#2780e3;font-weight:bold;" target="_blank" href="${urlError}">IZPOLNITE OBRAZEC O NAPAKI.</a>
            </div>
          </div>
        `;
      
        // Update the DOM with the error message
        const errorElement = document.querySelector('.jw-error-msg.jw-info-overlay');
        if (errorElement) {
          errorElement.innerHTML = errorHtml;
        }
      }
      

    $.fn.setButtons = function(video, data, info) {
        var container = $(this);
        //console.log("video", video);
        $.each(container, function(t) {


            if (video.buttons["quality"]) {
                jwplayer(container[t].id).addButton((video.url["static"] + video.buttons["qualityButton"]), "Kvaliteta video prenosa", function() {

                    var player = $("#" + container[t].id);
                    var playlist = data.response.mediaFiles;

                    var $wrapper = $("<div>", {
                        id: (container[t].id + '_qualitypick'),
                        align: "center"
                    });
                    $wrapper.css({
                        "width": player.width(),
                        "height": player.height(),
                        "background-color": "black"
                    });
                    player.before($wrapper);

                    var $wrapper2 = $("<div>");
                    $wrapper2.css({
                        "width": "300",
                        "padding-top": (Math.floor((player.height()) * 0.2))
                    });
                    $wrapper.append($wrapper2);

                    $content = $("<div>");
                    $content.css({
                        "color": "white",
                        "font": "22px Helvetica, sans-serif",
                        "padding": "5px 5px 20px 5px"
                    });
                    $content.html("Izberite kvaliteto videa");
                    $wrapper2.append($content);

                    player.hide();

                    $.each(data.response.mediaFiles, function(x) {
                        if (data.response.mediaFiles[x].mediaType === "octoshape") {
                            $content = $("<a/>", {
                                href: "javascript:void(0);"
                            });
                            $content.html(video.quality[data.response.mediaFiles[x].bitrate]);
                            $content.css({
                                "height": "32",
                                "width": "192",
                                "display": "block",
                                "background-image": "url(" + video.url["static"] + "img/quality.png)",
                                "background-position": "top left",
                                "background-repeat": "no-repeat",
                                "color": "white",
                                "font": "14px Helvetica, sans-serif",
                                "line-height": "30px",
                                "text-decoration": "none",
                                "margin-bottom": "10px"
                            });
                            if (data.response.mediaFiles[x].bitrate === video.bitrateRel) {
                                $content.css({
                                    "background-image": "url(" + video.url["static"] + "img/quality_active.png)"
                                });
                            }

                            $content.click(function(event) {
                                event.preventDefault();
                                $.cookieApi("set", data.response.mediaFiles[x].bitrate, "jwplayer.quality", 365);
                                $wrapper.remove();
                                player.show();
                                info.playlist = buildPlaylist(data, video);
                                info.autostart = true;
                                info.disableAds = true;
                                window.location.reload();
                                //showPlayer(container, data, info, video);
                            });
                            $wrapper2.append($content);
                        }
                    });

                }, "jwplayer.quality");
            }
        });
        return;
    }

    $.fn.setButtonsOpen365 = function(data, live, container) {
            
        if(live === true) {
            return;
        }
        
        if(document.body.classList.contains('rtv4d-ng')){
            return;
        }
  
        let id = null
        let category = null;
        let duration = null;
        try {
            id = data.response.id;
            category = data.response.category;
            duration = data.response.duration;
        }
        catch(e) {
            console.log('e',e);
        }

          
        $.each(container, function(t) {
            
            let element = container[t].id;
            if(document.getElementById(container[t].id + '_bottom')) {
                element = container[t].id + '_bottom'
            }
           
            const icon = "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyNi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM6c2tldGNoPSJodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2gvbnMiDQoJIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgODggNzIiDQoJIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDg4IDcyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPg0KCS5zdDB7ZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7ZmlsbDojRkZGRkZGO30NCgkuc3Qxe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPGc+DQoJPHBhdGggY2xhc3M9InN0MCIgZD0iTTgwLDBIMzZIOEMzLjYsMCwwLDMuNiwwLDh2MTJ2NDRjMCw0LjQsMy42LDgsOCw4aDQ0aDI4YzQuNCwwLDgtMy42LDgtOFY1MlY4Qzg4LDMuNiw4NC40LDAsODAsMHogTTgwLDY0SDUyDQoJCUg4VjIwVjhoMjhoNDR2NDRWNjR6Ii8+DQoJPGc+DQoJCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yMCwzMy42aDIuOGMxLjIsMCwyLjQtMC40LDIuOC0wLjhjMC40LTAuNCwwLjgtMS42LDAuOC0yLjRjMC0xLjItMC40LTItMC44LTIuNGMtMC44LTAuOC0xLjYtMS4yLTIuNC0xLjINCgkJCXMtMS42LDAuNC0yLjQsMC44Yy0wLjgsMC44LTEuMiwxLjItMS4yLDJoLTUuMmMwLTEuMiwwLjQtMi40LDEuMi0zLjZjMC44LTEuMiwxLjYtMiwzLjItMi40YzEuMi0wLjQsMi40LTAuOCw0LTAuOA0KCQkJYzIuOCwwLDQuOCwwLjgsNi40LDJzMi40LDMuMiwyLjQsNS4yYzAsMS4yLTAuNCwyLjQtMS4yLDMuMmMtMC44LDAuOC0xLjYsMi0yLjgsMi40YzEuNiwwLjQsMi44LDEuMiwzLjIsMi40DQoJCQljMC40LDEuMiwxLjIsMi40LDEuMiwzLjZjMCwyLjQtMC44LDQtMi40LDUuNmMtMS42LDEuMi00LDItNi44LDJjLTIuNCwwLTQuOC0wLjgtNi40LTJTMTQsNDMuOSwxNCw0MS45aDUuMg0KCQkJYzAsMC44LDAuNCwxLjYsMS4yLDIuNGMwLjgsMC44LDEuNiwwLjgsMi44LDAuOGMxLjIsMCwyLTAuNCwyLjgtMC44YzAuOC0wLjgsMS4yLTEuNiwxLjItMi40YzAtMi40LTEuNi00LTQuNC00SDIwVjMzLjZMMjAsMzMuNnoNCgkJCSIvPg0KCQk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNNDkuNiwyMi44djQuNGgtMC40Yy0yLjQsMC00LDAuOC01LjYsMlM0MS4yLDMyLDQxLjIsMzRjMS4yLTEuMiwzLjItMiw1LjItMmMyLjQsMCw0LDAuOCw1LjIsMi40DQoJCQlzMiwzLjYsMiw2LjRjMCwxLjYtMC40LDMuMi0xLjIsNC40cy0xLjYsMi40LTMuMiwzLjJjLTEuMiwwLjgtMi44LDEuMi00LjQsMS4yYy0yLjgsMC00LjgtMC44LTYuNC0yLjhjLTEuNi0yLTIuNC00LjQtMi40LTcuNnYtMg0KCQkJYzAtMi44LDAuNC01LjIsMS42LTcuNmMxLjItMiwyLjQtMy42LDQuNC00LjhzNC40LTEuNiw2LjgtMS42aDAuOEw0OS42LDIyLjhDNDkuNiwyMi44LDQ5LjYsMjIuOCw0OS42LDIyLjh6IE00NC40LDM1LjYNCgkJCWMtMC44LDAtMS42LDAuNC0yLjQsMC44Yy0wLjgsMC40LTEuMiwwLjgtMS42LDEuNnYxLjZjMCwxLjYsMC40LDMuMiwxLjIsNHMxLjYsMS42LDIuOCwxLjZzMi0wLjQsMi44LTEuMnMxLjItMiwxLjItMy4yDQoJCQljMC0xLjYtMC40LTIuNC0xLjItMy4yQzQ2LjQsMzYsNDUuNiwzNS42LDQ0LjQsMzUuNnoiLz4NCgkJPHBhdGggY2xhc3M9InN0MSIgZD0iTTU3LjIsMzYuNGwxLjYtMTMuMmgxNC40djQuNEg2Mi44TDYyLDMzLjJjMS4yLTAuOCwyLjQtMC44LDQtMC44YzIuNCwwLDQuNCwwLjgsNS42LDIuNGMxLjIsMS42LDIsMy42LDIsNi40DQoJCQljMCwxLjYtMC40LDMuMi0xLjIsNC40cy0xLjYsMi40LTMuMiwzLjJDNjgsNDkuNiw2Ni40LDUwLDY0LjQsNTBjLTEuNiwwLTMuMi0wLjQtNC40LTAuOGMtMS4yLTAuOC0yLjQtMS42LTMuMi0yLjgNCgkJCXMtMS4yLTIuNC0xLjItNGg1LjJjMCwxLjIsMC40LDIsMS4yLDIuNHMxLjYsMC44LDIuNCwwLjhjMS4yLDAsMi0wLjQsMi44LTEuMnMwLjgtMiwwLjgtMy42cy0wLjQtMi40LTEuMi0zLjINCgkJCUM2NiwzNi44LDY2LDM2LDY0LjgsMzZjLTEuMiwwLTIsMC40LTIuOCwwLjhsLTAuNCwwLjRMNTcuMiwzNi40eiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K";
            jwplayer(element).addButton(icon, "Odpri na RTV 365", function() {
                let url = 'https://365.rtvslo.si/arhiv/n/' + id;
                window.open(url, '_blank');  
                jwplayer(element).pause();
            }, element + ".open365Btn", "icon open365Btn");


            const icon2 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABmJLR0QA/wD/AP+gvaeTAAACnklEQVRYhc3Zz28MYRzH8c9TsW2itDYh2j25qaKuEqEuToILf4IexN2vEjcitPUfaFSq4iASJ9zUfeuEpCVpuw52N22JFbwdZtdONrMzs8/O7NPP+flmXvvszPN8nxlpEwQ4ATwCPgMV4CvwGhgDMq59/wNsB54Rnk/AYddWAT3AuwhsLevO0cBETGwtH4HMFkfYQUkzklq5flbSclc6pMickWTzMJ1zBT5kWXfQFXibZV2fK3DRsm41UUVUgGFgGvjd4gpRy8NOQQ8AT4E/ltBajncCOpcAFGA2Tegw8CQE+g24BlwB/sbAvgV604DuB2YjoNeBHb6a03hNT1B+AneB7tp40+TCuyUNSeqXtCIpb4yphEEljUs6Lylo5SlKmpQ0ZYxZC6jfKumkpGOScpJKkt5Lem6MKYTN0FHgTcAMlYAHQLZh/BDwOGRGi8C4f0YTC949FXU/rQIjwD5gJgRaAm4AfYlDq9hLEVB/Nmi+jpaAm6lBq9gc8KMFcFDWgNvAztSgPvCdNqBl4BbQnzrUB85bYl90ZEYb0iVpr2VtwRhTShITJ+10aySmaCFdkhYtawdc3RIvLWtPSVp08dDlgO9trBTQyWWtir7YAs7txuFDXya6b11hM2zNPvQR4FXADBaBKRr+chw0P83ay12qt5fLkhaMMb9Cfmi77WVG9fZyUFJZ9fYyvYMndg38WeBLk/EV4B7Qkxq6ioh7RLpKvCPSPGkckQLgSR5C51IHN8CTOOaPdgxdhbf7ImW6o2AffNISvOTq3Vo2ekhg9rgCb1jWlV2B85Z1C4E7XdoBBuT14d1RYxsylgInXoD7LT5wH3D5zQ7vs9d8TOw6MOIM60P34u2EUTPrHusPMIq3oSzhNTwFvDb3QuNt8A/2QNeR5qlVBAAAAABJRU5ErkJggg==";
            
            if(typeof options !== 'undefined' && options && options.render && options.render === 'square-audio') {
                return;//NO REAL STATE
            }
            
            jwplayer(element).addButton(icon2, "Deli", function() {
              
                let sharingPlugin = jwplayer(element).getPlugin('sharing');
                setTimeout(function() {
                    sharingPlugin.open();
                }, 100)          
                
            }, element + ".openShare", "icon open365Btn");
          
        });
              
    
    }

    $.fn.setButtonsEmbed = function(data, live) {

            var container = $(this);

            $(this).setButtonsOpen365(data, live, container);

            
            
            if(VIEWPORT_WIDTH < 992) {//only show on bigger screens.
                return
            }
            
            if(!document.body.classList.contains('rtv4d-ng')){
                return;
            }

        
            let id = null
            let category = null;
            let duration = null;
            let stub = null;
            try {
                id = data.response.id;
                category = data.response.category;
                duration = data.response.duration;
                stub = data.response.stub;
            }
            catch(e){
                return console.log('e', e);
            }
            
            //player_01_

        
            

            $.each(container, function(t) {

                let element = container[t].id;
                if(document.getElementById(container[t].id + '_bottom')) {
                    element = container[t].id + '_bottom'
                }
              
                let icon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAADAklEQVRoge2Xy0tUcRTHz09dlGaRLQLBjHYatnAW2YtWgbQtykSSQIr+gFq4kgo02gSu2yhEtZAe1KqFtQkiMbTaBUXRA1eJogbOp8XcoeuZ33397h0n6H5X/mbO+ZxznN/jHJFcuXLlyvU/CGgARoCuWueSSkAvfzUHXM6CW5cFJKH6fX93iUhHDXJIJ6ARWGSjDtU6r8QC+lQRnwCTBXuzt1a/Wk8aY9i06EAB6E7JaAHW1C/SGeHTDRTSxPXDWoEvwAqg/6NJOJdUEbMR9qeAJeAb0OYatwxrAmZ8wYvAsCNrWhVyJcR22ItV1hugMYwfeEa8Q3hHRPxbyojINoci2kTkmP8jEXkQ4tLsxSqrICKTQPIzDYxSqSkXGHBVcaYj7A1w3xL/WtLA5y2QWaApaREe761iXYzhsxV4rfyKwEDcoEeAVQX4juOBAzoU6zewK6ZvK/BV+a8Q9YgCe4GfFscelyI85g3Fe5TQvwAsK8YPYE+QQzOlJk7/lGmuXAN8VMyzDpzTbLzFAN4B27VhPfCESo24FuFxDyveEu7nbMSS31Og3m9022J0j5R9EDCumBMpWMbLSWusbHDB8uUMEQ9QjMANlPayX70pmVuAV5Z8h6rZNJ4Qkd2+9YKIPK9ivOpsLWBC8cZT5hi0tW76jTI97FRhgMJ+2J/hP+yeYTMwrwydrl8yHqCwX7/vgR1BDpk8iMBjxbieogjbg7gA7ItyPEqKFgXYSeUAtd+xCFuLsgYcjwsYpFKzQGQLT8IBKoRjaxoBhpKCblkgG19Su98L5RM4QIUwgtr40aQsAeqAh0lgQBuw7rMtAu0OsW2zUOUN5VPgg2iMKYrIgIjM6a9CcuhTzJfGmM9xkldaFJGibz0nImeMMesOrJKAdkqtxiowGGGbeIAKYZ0EfhHnhkoA7SHiCgY6VRFrQEvKuAeAg2kYLkFTDVD/hMhogKq5yHCAclVWbfw5tZ4yxixnxI6lrAr5ICLzvvXdjLi1EdBFqd1uqHUuuXLlypVrU/QHAGciZ6uM4WQAAAAASUVORK5CYII=";
                jwplayer(element).addButton(icon, 'Vdelaj', function() {
                  
                   

                    var player = $("#" + element);
                    var playlist = [
                        {
                            label: 'Zapri',
                            size: 22,
                        }
                    ];

                    let $wrapper = $("<div>", {
                        id: (element + '_closecaptions_pick'),
                        align: "center"
                    });
                    $wrapper.css({
                        "width": player.width(),
                        "height": player.height(),
                        "background-color": "black"
                    });
                    player.before($wrapper);

                    let  $wrapper2 = $("<div>");
                    $wrapper2.css({
                        "width": "95%",
                        "padding-top": "0px" //(Math.floor((player.height()) * 0.2))
                    });
                    $wrapper.append($wrapper2);

                    $content = $("<div>");
                    $content.css({
                        "font-family": "Roboto",
                        "color": "white",
                        "font-weight": "300",
                        "font-size": "18px",
                        "padding": "10px 5px 10px 5px"
                    });
                    $content.html("Vdelava posnetka");


                    $content_povezava = $("<div>");
                    $content_povezava.css({
                        "font-family": "Roboto",
                        "color": "white",
                        "font-weight": "300",
                        "font-size": "18px",
                        "padding": "10px 5px 10px 5px"
                    });
                    $content_povezava.html("Povezava");

                 

                    player.hide();

                    let $textArea = $("<textarea>", {
                        id:"embedCodePlaceholder"
                    });

                    $textArea.css({
                        "font-family": "Roboto",
                        width: "500px",
                        height: "120px",
                        "margin-bottom": "5px",
                        "background-color": "#333",
                        border: "none",
                        "border-radius":"5px",
                        color: "white",
                        "font-size": "16px",
                        color: "#eee",
                        "font-weight": 100,
                        padding: "10px",
                        resize: "none",
                        display: "block",
                        "margin-bottom": "10px"
                    });

                    let template = '<iframe src="https://365.rtvslo.si/embed/{recording_id}?a={autostart}&t={begining}&l={duration}{adds}" width="100%" height="354" frameborder="0" allowfullscreen="true"></iframe>';
                    let template_ink = 'https://365.rtvslo.si/arhiv/{stub}/{recording_id}?t={begining}&a={autostart}&l={duration}';
                    let iframe = '';
                    let input_value = '';
                    let autostart = 1;
                    let adds = '';
                    let begining = parseInt(jwplayer(element).getPosition(), 10);

                    if(live !== true) {
                        iframe = template.replace('{recording_id}', id).replace('{duration}', duration).replace('{autostart}', autostart).replace('{begining}', begining).replace('{adds}', adds);
                        input_value = template_ink.replace('{recording_id}', id).replace('{begining}', begining).replace('{autostart}', autostart).replace('{stub}', stub).replace('{duration}', duration);;
                    } 
                    else {
                        template = '<iframe src="https://365.rtvslo.si/embed/{channel}?a={autostart}" width="100%" height="354" frameborder="0" allowfullscreen="true"></iframe>';
                        iframe = template.replace('{channel}', id).replace('{autostart}', autostart).replace('{begining}', begining).replace('{adds}', adds);
                    }


                    let $input_value = $("<input>", {
                        id:"linkPlaceholder"
                    });

                    $input_value.css({
                        "font-family": "Roboto",
                        width: "500px",
                        height: "25px",
                        "margin-bottom": "5px",
                        "background-color": "#333",
                        border: "none",
                        "border-radius":"5px",
                        color: "white",
                        "font-size": "14px",
                        color: "#eee",
                        "font-weight": 100,
                        padding: "10px",
                        resize: "none"
                    });

                    
                    $wrapper2.append($content_povezava);

                    $input_value.val(input_value);
                    $wrapper2.append($input_value);
                    

                    $wrapper2.append($content);
                    $textArea.val(iframe);
                    $wrapper2.append($textArea);

                

                   

                   

                    $autostart = $("<div>", {
                        id:"autostartCodePlaceholder"
                    });
                    $input = $("<input>", {
                        type:"checkbox",
                        id:"autostartCheckbox",
                        name:"autostartCheckbox",
                        checked:"checked"
                    }).on('click', function(){
                        if($(this).is(':checked')) {
                            autostart = 1;
                        }
                        else {
                            autostart = 0;
                        }

                        iframe = template.replace('{channel}', id).replace('{recording_id}', id).replace('{duration}', duration).replace('{autostart}', autostart).replace('{begining}', begining).replace('{adds}', adds);
                        input_value = template_ink.replace('{recording_id}', id).replace('{begining}', begining).replace('{autostart}', autostart).replace('{stub}', stub).replace('{duration}', duration);
                        $textArea.val(iframe);
                        $input_value.val(input_value);
                    });




                    $label = $("<label style='padding-left:20px'>", {        
                        for:"autostartCheckbox"                  
                    }).css({
                        "font-family": "Roboto",
                    }).html('Samodejno predvajanje')

                    $autostart.append($input);
                    $autostart.append($label);

                    $wrapper2.append($autostart);


                    if(live !== true) {

                        $startTime = $("<div>", {
                            id:"startTimePlaceholder"
                        });
                        $input = $("<input>", {
                            type:"checkbox",
                            id:"startTimeCheckbox",
                            name:"startTimeCheckbox",
                            checked:"checked"
                        }).on('click', function(){ 
                        
                            if($(this).is(':checked')) {
                                $("#startTimeInput").removeAttr('disabled')
                            }
                            else {
                                $("#startTimeInput").prop("disabled", true);
                            }
                        });

                        $label = $("<label style='padding-left:20px'>", {        
                            for:"startTimeCheckbox"                  
                        }).css({
                            "font-family": "Roboto",
                        }
                        ).html('Začetek ob: ');

                    // $startTime.append($input);
                        $startTime.append($label);

                        let currentMin = parseInt(parseInt(jwplayer(element).getPosition(), 10) / 60, 10);
                        let currentSec = parseInt(jwplayer(element).getPosition(), 10) % 60;
                        if(currentSec < 10) {
                            currentSec = '0' + currentSec;
                        }
                        //console.log('currentMin', currentMin);
                        //console.log('currentSec', currentSec);

                        $input = $("<input>", {
                            type:"text",
                            id:"startTimeInput",
                            name:"startTimeInput",
                            placeholder: "00:00",
                        
                            //disabled:"disabled",
                        }).css({
                            background:'none',
                            width: '50px',    
                            'margin-left': '12px',
                            color:'white',
                            'font-size': '14px',
                            "font-family": "Roboto",
                            "font-weight": '100'
                        }).val(currentMin + ':' + currentSec).on('keyup', function(){
                            let time_input = $(this).val().split(':');
                            let sek = 0;
                            let min = 0;
                            if(time_input.length === 2) {
                                sek = parseInt(time_input[1], 10);
                                min = parseInt(time_input[0], 10);
                            }
                            else if(time_input.length === 1) {
                                sek = parseInt(time_input[0], 10);
                            }else{

                            }
                            if(isNaN(min)) {
                                min = 0;
                            }
                            if(isNaN(sek)) {
                                sek = 0;
                            }
                            if(sek >= 60) {
                                sek = 59;
                            }

                            let begining = sek  + min * 60;
                            if(begining > duration ) {
                                begining = duration;
                            }

                            if(sek < 10) {
                                sek = '0' + sek;
                            }
                            
                            let score = min + ':' + sek;
                            $(this).val(score)
                        
                            iframe = template.replace('{recording_id}', id).replace('{duration}', duration).replace('{autostart}', autostart).replace('{begining}', begining).replace('{adds}', adds);
                            $textArea.val(iframe);
                            input_value = template_ink.replace('{recording_id}', id).replace('{begining}', begining).replace('{autostart}', autostart).replace('{duration}', duration).replace('{stub}', stub);;
                            $input_value.val(input_value);
                        });

                    
                        $startTime.append($input);

                        $wrapper2.append($startTime);
                    
                    }

                    //GUMB ZAPRI
                    $.each(playlist, function(index) {

                        $content = $("<a/>", {
                            href: "javascript:void(0);",
                            class: "btn btn-sm btn-primary-dark btn-pill "
                        });
                        $content.html(playlist[index].label);
                        $content.css({
                          
                            "width": "80px",
                        
                            "background-position": "top left",
                            "background-repeat": "no-repeat",
                            "color": "white",
                            "font": "16px",
                            "font-family": "Roboto",
                            "color": "white",
                            "font-weight": "300",
                            "line-height": "30px",
                            "text-decoration": "none",
                            "margin-bottom": "10px",
                            "margin-top": "10px",
                        });


                        $content.click(function(event) {
                            event.preventDefault();           
                            $wrapper.remove();
                            player.show();     

                        });
                        $wrapper2.append($content);

                    });

                }, "jwplayer.embedBtn", "icon embedBtn");

            

            });
            return;
        
        
    }
  
    $.fn.setButtonsYtExt = function() {
        //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 3525 ~ rtv4DTheatreMode", rtv4DTheatreMode)
        //jw-icon-fullscreen
        if(VIEWPORT_WIDTH < 768) {//only show on bigger screens.
            return
        }
        
        var container = $(this);

        $.each(container, function(t) {
            
            let player = jwplayer(container[t].id);
            player.addButton('<svg width="44" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><text x="0" y="16" font-family="Arial" font-size="14" fill="white" id="playout-speed-svg-element" >1x</text></svg>', 'Nastavi hitrost', function() {
                
                var rates = [0.5, 0.75, 1, 1.25, 1.5];
                var currentRate = player.getPlaybackRate();
                var currentIndex = rates.indexOf(currentRate);
                var nextIndex = (currentIndex + 1) % rates.length;
                var nextRate = rates[nextIndex];
                
                player.setPlaybackRate(nextRate);
                if(document.getElementById('playout-speed-svg-element')) {
                    document.getElementById('playout-speed-svg-element').textContent = nextRate + 'x';
                }
                
                
            }, "jwplayer.setplaybackspeed", "icon setplaybackspeed");

        });


        if(!rtv4DFullscreenPlayer) return;

        $.each(container, function(t) {
            //console.log('jwplayer(container[t].id).addButton', jwplayer(container[t].id).addButton);
            jwplayer(container[t].id).addButton('<svg xmlns="http://www.w3.org/2000/svg" class="jw-svg-icon jw-svg-icon-fullscreen-on" viewBox="0 0 240 240" focusable="false"><path d="M96.3,186.1c1.9,1.9,1.3,4-1.4,4.4l-50.6,8.4c-1.8,0.5-3.7-0.6-4.2-2.4c-0.2-0.6-0.2-1.2,0-1.7l8.4-50.6c0.4-2.7,2.4-3.4,4.4-1.4l14.5,14.5l28.2-28.2l14.3,14.3l-28.2,28.2L96.3,186.1z M195.8,39.1l-50.6,8.4c-2.7,0.4-3.4,2.4-1.4,4.4l14.5,14.5l-28.2,28.2l14.3,14.3l28.2-28.2l14.5,14.5c1.9,1.9,4,1.3,4.4-1.4l8.4-50.6c0.5-1.8-0.6-3.6-2.4-4.2C197,39,196.4,39,195.8,39.1L195.8,39.1z"></path></svg>', 'Celoten zaslon', function() {
                
                //jwplayer().setFloating(false)
                rtv4DFullscreenPlayer.toggle();   
                
            }, "jwplayer.fullscreen", "icon theatre");

        });

        if(!rtv4DTheatreMode) return;

        $.each(container, function(t) {
     
            jwplayer(container[t].id).addButton('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 13"><path fill="#FFF" d="M22 13H0V0h22v13zM2 11h18V2H2v9z"/></svg>', 'Način kina', function() {


                if(rtv4DTheatreMode.isInTheatreMode) {
                    rtv4DTheatreMode.close();       
                }
                else 
                {
                    rtv4DTheatreMode.open();  
                }
                
            }, "jwplayer.theatre", "icon theatre");

        });

        return;
    }

    window._globalTtoogleInteractiveFunc = function() {
        
        if ($('#transcripts_odprti_kop').is(":visible")) {
            $('#transcripts_odprti_kop').hide();
            $('#rtv4d_player_toolbar').show();
            $('#content_popup').show();

        } else {
            $('#transcripts_odprti_kop').show();
            $('#rtv4d_player_toolbar').hide();
            $('#content_popup').hide();
        }
    }

    $.fn.setButtonInteractive = function(video, data, info) {


        var container = $(this);

        $.each(container, function(t) {

            jwplayer(container[t].id).addButton("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABGCAYAAABxLuKEAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAATpSURBVHhe7ZtLiBRXFIZnNCYaJgaMuhLNGAhCRvG5EKKLQBYhZHaCYkwUkSQkWcxCdy4MohsFHwERUZNFhJi4SEBXIqJuzEYZUOIzLwkoLiLGqKgz+Y73b507VX27x+66XePcD35u97mn7n/qTHdXdVVPWyKRSCSeM/r7+9v7+vpeY5zO+AaagsZpeuRAAzrQEnZ+FzqD7vA8A/E/0BG0DnVp8+cPdm4W2o9ua9+HBNudRZ+il7Tk8IYdmYYOoT7tY0OwzN8MK1G7LIYf7MTnKPet0iise4JhqqyGBxT8MoX/+HgPCgSPm+hd2ZYb6n2VYk+60mtD7i10Hh1DP6HT6Bp6oJQg5N1HS2VfTqjTXimnXMnVIedXtBHN52nuZwVzE9AK9AO677bMh/mHqFublg+KC759mLdD8Mc8HKVN6oJ8O8c5gKp+gDN1B83RJuWBor5Qjbkwvxc1dOLG9ovQdS2ZgblL6BWltx6KsUNytRM1e5n3KLVh5NWr5TMwt12prYdiDqmuDM1sSgXWnISuysKDuP0hZiq1dVCEndHmvvcJ71Va07GdR7ln0cS/V1rroIj9qseD+O8MY5VWCHh86dx8iD9CnUqLDzV0UMC/rpwMK5VWGHiMwf+ys/Mhvl5p8cF/iSvDh6IuMAzpkPys4LXCufoQ71VKfDDfpTo8iH+llMLBzl6195zzU4gZk5UWF4zPqA4P4vOVEgX8Dsvag/gHSokHvnblLe/c5R8U9ZIAdfQ4ax/ia5USD0wnyd+D+HmlRAPP92TvQXynUuKBaaf8PYgfVUo08Fwgew/i3yolHvjOcPY+FPOzUqKB50zZexD/TinxwHSK/D2I/6KUaOC5WPYexPcoJR6YjkOZrwKE/lJKNPBcLnsP4puUEheM/1QNTyD2AE1QShTw2yZ7D+KrlRIXjI+oBg/iHyolCvhdkbUH8blKiQvG61TDYA4qpXCoYZY8PYjfYhittLhg3uXK8CFu12inK61Q8NrnXH2IH1BKa6CAal8LCj9U4tGFHsrSg3j8rwMDoYBPVIsHcWOx0poOFqNZ/6hz8yF+iSHKt/uqUMBYCrHbphmI30DTlNpUWHerbDIwt0ZprYVCVqmmDMzZheuJSm0KrPmZWz0Lc+cYXlBqa6GQdnTcCsuDYq+ihi9Qs5S9fba4VbMwZxfCFyq9HFDXVIq66UrMwtxtZPeeXtQmQ4Jt30LH3Gr5ML9B6eWCwt5BtW6n2k2xj3jYoc2CkGt3A+xm3SO3Qj62LkNrzlvqgQKXodxD6EDIuYsOox70PqF50ts8X462odwz2mqQv4Ohss48nr+pssoBBXWj/6zYogk1jzn7zFmmssoBdc2mqIuuxObD2nbvaAMPRzHmfok0mCtfcyhoPNqO6vqtS72w3jn05OjD49wLVRWYL19zDBV+kDH4AVoLtr+C1vDQO0/R+kHIKWdzDArrROtRL6rrx4qk2S+u7Lcx3TzNPc1nrmZjDPLK25wKFDjZdhatRV9T9zfIXlW70Wa0Gs0lVvMQTJ41vOaR0LA8VO7mNBPb2dScKqTmBEjNCZCaEyA1J0BqToDUnACpOQFScwKk5gRIzQkwxObYz2Wf6Tr1sKSe5jD/G8Pr2mTkEGrOiG1KhbzmjPimVBjYnNSUQag59kGbmjIYmlLof8skEolEomHa2v4HFsBwt9KSwswAAAAASUVORK5CYII=", "Iskalnik", function() {

                var player = $("#" + container[t].id);
                //alert(container[t].id);

                window._globalTtoogleInteractiveFunc();



            }, "jwplayer.interactiove", "icon interactive");

        });
        return;
    }

    function copyTextToClipboard(text) {
        var textArea = document.createElement("textarea");

        textArea.style.position = 'fixed';
        textArea.style.top = 0;
        textArea.style.left = 0;
        // Ensure it has a small width and height. Setting to 1px / 1em
        // doesn't work as this gives a negative w/h on some browsers.
        textArea.style.width = '2em';
        textArea.style.height = '2em';
        // We don't need padding, reducing the size if it does flash render.
        textArea.style.padding = 0;
        // Clean up any borders.
        textArea.style.border = 'none';
        textArea.style.outline = 'none';
        textArea.style.boxShadow = 'none';
        // Avoid flash of white box if rendered for any reason.
        textArea.style.background = 'transparent';
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            var successful = document.execCommand('copy');
            var msg = successful ? 'successful' : 'unsuccessful';
            //console.log('Copying text command was ' + msg);
            showToastMsg(lang.link_saved)
        } catch (err) {
            console.log('Oops, unable to copy');
        }
        document.body.removeChild(textArea);
    }
   

    $.cookieApi = function(action, value, name, days) {
        switch (action) {
            case "set":
                var date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                var expires = (days > 0) ? "; expires=" + date.toUTCString() : "";
                var cooks = name + "=" + encodeURIComponent(value) + expires + ";domain=." + document.domain + "; path=/;secure;";
                document.cookie = cooks;
                break;
            case "read":
                var nameEQ = name + "=",
                    ca = document.cookie.split(';'),
                    value = '',
                    firstChar = '',
                    parsed = {};
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) {
                        value = c.substring(nameEQ.length, c.length);
                        firstChar = value.substring(0, 1);
                        if (firstChar === "{") {
                            parsed = JSON.parse(value);
                            if ("v" in parsed) return parsed.v;
                        }
                        if (value === "undefined") return false;
                        return decodeURIComponent(value);
                    }
                }
                break;
        }
        return false;
    }

    function getShareUrlCtx(player, data){

        if(player === null && data && data.response && data.response.link){
            return data.response.link;
        }

        var retLink = '';
        var player_position = Math.floor(player.getPosition());

        //console.log('player_position', player_position);

        var date = new Date(null);
        date.setSeconds(player_position); // specify value for SECONDS here
        var result = date.toISOString().substr(11, 8);

        var link = window.location.href;
        //console.log(href);

        if(link.indexOf('4d.rtvslo.si') > -1){
            if (data && data.response && data.response.link) {
                retLink = data.response.link + '/' + result;
            }
        } 
        else {
         
            if(link.indexOf('?') > -1){
                link = link + '&t=' + player_position
            } else {
                link = link + '?t=' + player_position
            }
            
            retLink = link;

        }

        return retLink;

    }

    function getApiEndPoint($debug) {

        if(FORCE_API_PRODUKCIJA){
            return 'https://api.rtvslo.si'
        }
      
        if ($debug) {
            return 'https://api.dev.rtvslo.si'
        }

        if (window.location.href.indexOf('dev.rtvslo.si') > -1 || window.location.href.indexOf('jwplayer.rtvslo.si') > -1) {
            return 'https://api.dev.rtvslo.si'
        }

        return 'https://api.rtvslo.si'
    }

    function showToastMsg(msg, show_error_msg) {
        if (show_error_msg === false) return;

        $('#snackbar4dplayer').html(msg);
        $('#snackbar4dplayer').addClass('show');
        // After 3 seconds, remove the show class from DIV
        setTimeout(function() {
            $('#snackbar4dplayer').removeClass('show');
            $('#snackbar4dplayer').html('');
        }, 1000);
    }

    function getMyPlaylists(rec_id, marked, clb) {

        var getUserLists = getApiEndPoint(DEBUG_ENABLE) + '/ava/getUserLists?client_id=' + API_CLIENT_ID + '&pageSize=50&pageNumber=0';

        getAjax(getUserLists, function(data) {
            if (data.error) {
                return showToastMsg(lang.not_logged_in);
            }
            if (data.response && data.response.items) {


                //console.log('data.response.items',data.response.items )

                var checked_default = '';
                if (marked === true) {
                    checked_default = 'checked';
                }

                var items = '<div class="md-checkbox">' +
                    '<input data-rec_id={rec_id} id="playlistid___{id}" type="checkbox" {checked}>' +
                    '<label for="playlistid___{id}">{name}</label>' +
                    '</div>'.replace('{rec_id}', rec_id);

                var default_item = items.replace('{checked}', checked_default);

                var html = default_item.replace('{name}', 'Poznejše gledanje').replace('{id}', 'default').replace('{id}', 'default');

                data.response.items.map(function(itm) {
                    var item_checked = '';
                    if (typeof itm.recording_ids == 'string') {
                        if (itm.recording_ids.indexOf(rec_id) > -1) {
                            item_checked = 'checked';
                        }
                    }

                    html = html + items.replace('{name}', itm.title).replace('{id}', itm.id).replace('{id}', itm.id).replace('{checked}', item_checked);
                });

                $('#user-playlist-items').html(html);

                $('form#form-create-item').off();
                $('form#form-create-item').on('submit', function(e) {

                    e.preventDefault();
                    $input_create_name = $('#input-create-name').val();

                    createNewPlaylist($input_create_name, function(new_playlist) {
                        getMyPlaylists();

                    });
                })

                if (clb) {
                    clb();
                }


                //console.log('data.response', html)
            }
        })
    };

    function createNewPlaylist(name, clb) {
        var userList = getApiEndPoint(DEBUG_ENABLE) + '/ava/userList?client_id=' + API_CLIENT_ID;

        postAjax(userList, { 'title': name, 'public': '1', 'active': '1' }, function(data) {
            if (data.error) {
                return showToastMsg(lang.not_logged_in);
            }
            if (data.response) {

                if (clb) {
                    clb(data.response); //
                }
            }
        });
    }

    function addToList(id) {


        var markRecording = getApiEndPoint(DEBUG_ENABLE) + '/ava/markRecording/' + id + '?client_id=' + API_CLIENT_ID ;

        getAjax(markRecording, function(data) {
            if (data.error) {
                return showToastMsg(lang.not_logged_in);
            }
            if (data && data.response == true) {
                var st1 = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-shrani-2.png";
                showToastMsg(lang.add_to_my_list);
                $('#my_button_stuff').css('background-image', "url('" + st1 + "')");
                $('#my_button_stuff .mobile_icon').html('Moje');
                $('#id___default').attr("checked", "checked")
                    // $('#recommend_button').html('Priporočeno');
            }


            if (data && data.response == false) {
                showToastMsg(lang.removed_from_my_list);
                var st2 = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-shrani-1.png"; //"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABhSURBVDhPY6A5OHv2rMrp06dngmioEOngzJkzNkD8H0RDhUgHI9kQoCI5YAwYo2NgzCSDDAHR2ORB+qBGMDAAFU2D2kgSBumDGkEll+ACQEWj6QQNUMUQYAxQnouJAwwMAJrK6FqaaVq+AAAAAElFTkSuQmCC";;
                $('#my_button_stuff').css('background-image', "url('" + st2 + "')");
                $('#my_button_stuff .mobile_icon').html(lang.save);
            }
        });
    }

    function removeFromList(id) {
        var markRecording = getApiEndPoint(DEBUG_ENABLE) + '/ava/markRecording/' + id + '?client_id=' + API_CLIENT_ID;

        getAjax(markRecording, function(data) {
            if (data.error) {
                return showToastMsg(lang.not_logged_in);
            }

            var st2 = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-shrani-2.png"; 
            showToastMsg('Odstranjeno.');
            $('#my_button_stuff').css('background-image', "url('" + st2 + "')");
            //$('#recommend_button').html('Priporoči');

        });
    }

    function addToCustomList(list_id, rec_id) {

        var markRecording = getApiEndPoint(DEBUG_ENABLE) + '/ava/itemToUserList?client_id=' + API_CLIENT_ID;

        postAjax(markRecording, { 'recId': rec_id, 'listId': list_id }, function(data) {
            if (data.error) {
                return showToastMsg(lang.not_logged_in);
            }
            if (data.response && data.response == true) {
                showToastMsg('Uspeh :)');
            }
        });
    }



    function getAjax(url, clb, show_error_msg) {
        
        //console.log('url', url)
        var url = url;
        if (url.indexOf('?') == -1) {
            url = url + '?_=' + Math.floor((Math.random() * 100000) + 1);
        } else {
            url = url + '&_=' + Math.floor((Math.random() * 100000) + 1);
        }
        $.ajaxSetup({xhrFields: { withCredentials: true } });
        $.ajax({
            type: 'GET',
            url: url,
            success: function(data) {
                if (data.error) {
                    if (data.error.message && typeof data.error.message === 'string') {
                        if (data.error.message.indexOf('E_SESSION_NONE') > -1) {
                            return showToastMsg(lang.not_logged_in, show_error_msg);
                        }
                        if (data.error.message.indexOf('session_id') > -1) {
                            return showToastMsg(lang.not_logged_in, show_error_msg);
                        }
                    }
                    ///console.log(JSON.stringify(data));
                }

                if (clb) {
                    clb(data);
                }

            },
            error: function(e) {
                //showToastMsg(lang.not_logged_in);
                console.log(JSON.stringify(e));
            }
        });
    }

    function detectCordovaAndroid() 
    {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        // Detecting Android device
        if (/android/i.test(userAgent)) {
            // Optionally, detect a specific Cordova app (if you have a custom part of the User Agent string)
            // Example: if (/MyCordovaApp/i.test(userAgent)) { ... }  
            return true; // Android device in a Cordova app
        }
        return false; // Not an Android device in a Cordova app
    }

    function detectCordovaIOS() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
        // Detecting iOS device
        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            // This will only detect iOS devices, not whether it's specifically a Cordova app.
            // If you have a unique identifier for your Cordova app in the User Agent, check for that here.
    
            return true; // iOS device detected
        }
    
        return false; // Not an iOS device
    }

    function isMobileBrowser() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
        // Patterns to detect mobile devices
        return /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());
    }

    function getAppId() 
    {  
        if(detectCordovaAndroid() || detectCordovaIOS() || isMobileBrowser()) return 1;//MOBILE PLATFORM
        
        return 0;
    }

    function getAjaxStats(url, clb) {
        
        //console.log('url', url)
        var url = url;
        if (url.indexOf('?') == -1) {
            url = url + '?_=' + Math.floor((Math.random() * 100000) + 1);
        } else {
            url = url + '&_=' + Math.floor((Math.random() * 100000) + 1);
        }
        $.ajaxSetup({xhrFields: { withCredentials: true } });
        $.ajax({
            type: 'GET',
            url: url,
            success: function(data) {
                if (data.error) {           
                    console.log(JSON.stringify(data));
                }

                if (clb) {
                    clb(data);
                }
            },
            error: function(e) {
                console.log(JSON.stringify(e));
            }
        });
    }

    function postAjax(url, data, clb) {
        $.ajaxSetup({xhrFields: { withCredentials: true } });
        $.ajax({
            type: 'POST',
            url: url,
            data: data,
            success: function(data) {
                if (data.error) {
                    console.log(JSON.stringify(data.error));
                }

                if (clb) {
                    clb(data);
                }

            },
            error: function(e) {
                console.log(JSON.stringify(e));
            }
        });
    }

    function getApiSession() {
       
        return null;
    }



    function recommendItem(a) {

      

        var star = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-priporoci-1.png"; 
        var star_full = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-priporoci-2.png"; 
        var current_star = star;
        var count = 0
        if (a && a.response && a.response.recommended_count) {
            count = a.response.recommended_count;
        }

        //var recommended_txt = "<span class='mobile_icon_recommned'>Priporoči</span> <span>(<span id='recommended_count_indikator'>" + count + "</span>)</span>";
        var recommended_txt = "<span class='mobile_icon_recommned'>" + lang.recommend+ "</span>";
        if (typeof a.response.recommended !== 'undefined') {
            //reommended_txt = 'Priporočeno';
            current_star = star_full;
        }

        if (typeof a.response.recommended_count !== 'undefined') {
            //recommended_txt = "<span class='mobile_icon_recommned'>Priporoči</span> <span>(<span id='recommended_count_indikator'>" + count + "</span>)</span>";
            recommended_txt = "<span class='mobile_icon_recommned'>" + lang.recommend + "</span>";

        }

        
        var $moje = $("<div id='recommend_button' class='button-group'></div>");
        $moje.css({
            "cursor": "pointer",
            "background-image": "url('" + current_star + "')",
            "padding-left": "25px",
            "background-size": "15px"

        }).html(recommended_txt);
        
        $moje.on('click', function() {
            var recomment_url = getApiEndPoint(DEBUG_ENABLE) + '/ava/recomendRecording/' + a.response.id + '?client_id=' + API_CLIENT_ID;

            getAjax(recomment_url, function(data) {
                if (data.error) {
                    return showToastMsg(lang.not_logged_in);
                }


                //console.log('data.response', data);
                if (data.response && data.response == true) {

                    $('#recommend_button').css('background-image', "url('" + star_full + "')");
                    var current = $('#recommended_count_indikator').html();

                    //console.log('current', current);

                    var num = 0;
                    if (typeof current === 'string' && current.length > 0) {
                        num = parseInt(current, 10);
                        num = num + 1;
                    } else {
                        num = 1;
                    }

                    $('#recommended_count_indikator').html(num);

                    showToastMsg(lang.recommend);

                } else {

                    var current = $('#recommended_count_indikator').html();


                    var num = 0;
                    if (typeof current === 'string' && current.length > 0) {
                        num = parseInt(current, 10);
                        num = num - 1;
                    } else {
                        num = 1;
                    }
                    if(num < 0) num = 0;
                    $('#recommended_count_indikator').html(num);

                    $('#recommend_button').css('background-image', "url('" + star + "')");

                    showToastMsg('Odstranjeno...');
                    //$('#recommend_button').html('Priporoči');
                }
            });

        });
        
        return $moje;
    }

    function initMyListItems() {
        $('.mmc-player-modal #user-playlist-items input').off();
        $('.mmc-player-modal #user-playlist-items input').on('change', function(e) {
            var elem = e.currentTarget.id;
            if (typeof e.currentTarget.id === 'string') {
                var curr_id = e.currentTarget.id.split('___');
                if (curr_id.length > 1) {
                    var list_id = curr_id[1];
                    console.log('list_id', list_id);
                    var rec_id = $('#playlistid___' + list_id).data('rec_id');
                    console.log('rec_id', rec_id);

                    if ($('#playlistid___' + list_id).is(':checked')) {

                        if (list_id === 'default') {
                            addToList(rec_id);
                            //console.log('addToList')
                        } else {
                            addToCustomList(list_id, rec_id);
                        }

                    } 
                    else {

                        if (list_id === 'default') {
                            removeFromList(rec_id);
                        } 
                        else {
                            addToCustomList(list_id, rec_id);
                        }

                    }


                }
            }
        });
    }

    function myListIntemsInit(a) {

        if (!a && !a.response && !a.response.id) {
            return
        };
        
        var moje_dodano = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADdSURBVDhP1ZC9DgFBFEZXBPEUKpVoNeIddHqtSlQKQqul8AxbU+hEscnsXyFb7SsoJX4Sdp2R20gEo+IkJ5n7zb13M2v9N2maZuI4Lkj5Hb7vT3EtpTkMNzzPS1zXbUtkhuM4RRbEuNJPktgMhie4D4KgJJEZDNd4ygU7EpkRRVGeJVvcvHwGX1hiU8oHGB5xdwjDsCzRc2ia03zFrkR3qKt4xp5Er2FRn+YEZ7ZtZ7WcPXKlz9L2Hv58i6Ejswsc40kpVZHrz2GwjjuWpTiU2Bz9E1k0YElOop/Hsm7XtZl8ckT65QAAAABJRU5ErkJggg==";
        var moje_dodaj = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABhSURBVDhPY6A5OHv2rMrp06dngmioEOngzJkzNkD8H0RDhUgHI9kQoCI5YAwYo2NgzCSDDAHR2ORB+qBGMDAAFU2D2kgSBumDGkEll+ACQEWj6QQNUMUQYAxQnouJAwwMAJrK6FqaaVq+AAAAAElFTkSuQmCC";
        var marked = false;
        if (typeof a.response.marked !== 'undefined') {
            moje_dodaj = moje_dodano;
            marked = true;
        }

        // instanciate new modal
        var modal = new tingle.modal({
            footer: true,
            stickyFooter: true,
            closeMethods: ['overlay', 'button', 'escape'],
            closeLabel: "",
            cssClass: ['mmc-player-modal'],
            onOpen: function() {
                //console.log('modal open');
                getMyPlaylists(a.response.id, marked, function() {
                    initMyListItems();
                })
            },
            onClose: function() {
                console.log('modal closed');
                $('form#form-create-item').hide();
            },
            beforeClose: function() {
                // here's goes some logic
                // e.g. save content before closing the modal
                return true; // close the modal
                return false; // nothing happens
            }
        });



        // set content
        modal.setContent('<div id="user-playlist-items">');

        var input_form = '<form class="form-create-item" id="form-create-item" style="display:none;">' +
            '<input  autocomplete="off" placeholder="Vnesite ime za seznam ..." id="input-create-name" class="input-create" type="text" name="fname">' +
            '<input class="submit pure-material-button-contained" type="submit" value="Ustvari">' +
            '</form>';

        modal.setFooterContent(input_form);


        // add another button
        modal.addFooterBtn('+ Ustvari nov seznam predvajanja', 'tingle-btn', function() {
            // here goes some logic
            $('form#form-create-item').toggle();
            //modal.close();
        });



        var $moje2 = $("<div id='my_button_stuff' class='moje button-group'>");
        $moje2.css({
            "cursor": "pointer",
            "background-image": "url('" + moje_dodaj + "')",

        }).html('<span class="mobile_icon">' + lang.save +'</span>');
        
        $moje2.on('click', function() {

            addToList(a.response.id);
            //modal.open();
        });

        return $moje2;

    }

    function myListIntemsInitMoje(a) {

        if (!a && !a.response && !a.response.id) {
            return
        };
       
        var moje_dodano = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-shrani-2.png"; //"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADdSURBVDhP1ZC9DgFBFEZXBPEUKpVoNeIddHqtSlQKQqul8AxbU+hEscnsXyFb7SsoJX4Sdp2R20gEo+IkJ5n7zb13M2v9N2maZuI4Lkj5Hb7vT3EtpTkMNzzPS1zXbUtkhuM4RRbEuNJPktgMhie4D4KgJJEZDNd4ygU7EpkRRVGeJVvcvHwGX1hiU8oHGB5xdwjDsCzRc2ia03zFrkR3qKt4xp5Er2FRn+YEZ7ZtZ7WcPXKlz9L2Hv58i6Ejswsc40kpVZHrz2GwjjuWpTiU2Bz9E1k0YElOop/Hsm7XtZl8ckT65QAAAABJRU5ErkJggg==";
        var moje_dodaj = "https://img.rtvslo.si/_static/r1/novi/img/mmc_player_icons/ico-shrani-1.png"; //"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABhSURBVDhPY6A5OHv2rMrp06dngmioEOngzJkzNkD8H0RDhUgHI9kQoCI5YAwYo2NgzCSDDAHR2ORB+qBGMDAAFU2D2kgSBumDGkEll+ACQEWj6QQNUMUQYAxQnouJAwwMAJrK6FqaaVq+AAAAAElFTkSuQmCC";
        var marked = false;
        var text = '<span class="mobile_icon">' + lang.save+ '</span>';
        if (typeof a.response.marked !== 'undefined') {
            moje_dodaj = moje_dodano;
            marked = true;
            text = '<span class="mobile_icon">Moje</span>'
        }

        var $moje2 = $("<div id='my_button_stuff' class='moje button-group'>");
        $moje2.css({
            "cursor": "pointer",
            "background-image": "url('" + moje_dodaj + "')",

        }).html(text)
        
        $moje2.on('click', function() {

            //console.log('click');

            addToList(a.response.id);

        });

        return $moje2;

    }

    function removeLeadingZerosFromDate(date_format){

        if(date_format[3] === '0'){
            date_format = date_format.substr(0,3) + date_format.substr(4,date_format.length);
        }
        if(date_format[0] === '0'){
            date_format = date_format.substr(1,date_format.length);  
        }

        return date_format;
    }

    window.__global4DPopupOpened = false;
    
    window.__globalPlayerCTX = null;
    window.__globalBeforeShowPopupState = null;
    $.showPopup = function(action, id, options, pushState) {

        
        if(window.__globalBeforeShowPopupState === null){
            var beforeState = window.location.href;
            if(beforeState.indexOf('?4d=') > -1){//Prevent loops
                beforeState = beforeState.split('?4d=')[0];
            }
            if(beforeState.indexOf('?rtv365=') > -1){//Prevent loops
                beforeState = beforeState.split('?rtv365=')[0];
            }
            window.__globalBeforeShowPopupState = beforeState;
        }
        
        var is_dev = false;

        if (window.location.href.indexOf('dev.rtvslo.si') > -1 || window.location.href.indexOf('jwplayer.rtvslo.si') > -1) {
            is_dev = true;
        }

        /** Context is king */
        //window.__globalPlayerCTX = window.__globalPlayerCTX  || 'rtv';

        if(window.__globalPlayerCTX === null){
            if (window.location.href.indexOf('rtvslo.si/tv-capodistria') > -1) {
                window.__globalPlayerCTX = 'tv_ita';
            }else if (window.location.href.indexOf('rtvslo.si/tv') > -1 ) {
                window.__globalPlayerCTX = 'tv';
            }else if (window.location.href.indexOf('rtvslo.si/radio-capodistria') > -1 ) {
                window.__globalPlayerCTX = 'radio_ita';
            }else if (window.location.href.indexOf('rtvslo.si/radio') > -1 ) {
                window.__globalPlayerCTX = 'radio';
            }else if (window.location.href.indexOf('rtvslo.si/dostopno') > -1 ) {
                window.__globalPlayerCTX = 'dostopno';
            }else {
                window.__globalPlayerCTX = 'rtv';    
            }    
        }   

        //console.log("window.__globalPlayerCTX", window.__globalPlayerCTX);
        window.__global4DPopupOpened = true;  

        if (window.dm) {
            dm.AjaxEvent('pageview');
        }

        window.onpopstate = function(event) {
           

            //console.log('event',event);
            if(document.location && document.location.href && (document.location.href.indexOf('/4d/arhiv/') === -1 || document.location.href.indexOf('/rtv365/arhiv/') === -1)){
              
                closePlayerModal(false);//Back dont modify history!
                return;
            }
            if(document.location && document.location.href && document.location.href.indexOf('/4d/arhiv/') > -1){
                var loc = document.location.href;
                var segments = loc.split('/4d/arhiv/');
                if(segments.length > 1) {
                    var rec_url = segments[1];

                    var recording_id = matchRecordingId(rec_url);
                    if(recording_id !== false){
                        $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true' }, false);//Dont push state1
                        return;
                    }
                }             
            }
            if(document.location && document.location.href && document.location.href.indexOf('/rtv365/arhiv/') > -1){
                var loc = document.location.href;
                var segments = loc.split('/rtv365/arhiv/');
                if(segments.length > 1) {
                    var rec_url = segments[1];

                    var recording_id = matchRecordingId(rec_url);
                    if(recording_id !== false){
                        $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true' }, false);//Dont push state1
                        return;
                    }
                }             
            }
        }

        function closePlayerModal(replaceState){
            
            if(NG_ENABLE === true){
                return;
            }
            
            $("#rtv4d_popup").remove();
            rtvdef.playerStatus = false;
            //window.location.hash = '';
            $("object, embed").css({
                "visibility": "visible"
            });                   
           
            if(typeof replaceState === 'undefined' ){
                window.history.pushState(null, null, window.__globalBeforeShowPopupState); 
            }

            window.__global4DPopupOpened = false;  
            window.__globalBeforeShowPopupState = null;

            if (document.cookie && document.cookie.indexOf("showIosNative=true") != -1) {
                if(parent) {
                  parent.postMessage("closePlayerModal","*");
                }
            }
        }
        /*
        if(typeof pushState === 'undefined'){
            history.pushState(null, null, "?4d=" + id + '#modal')
        }*/

        
        if(typeof pushState === 'undefined' || pushState === true){
            //history.pushState(null, null, "?4d=" + id + '#modal')
            let source = window.__globalPlayerCTX;
            if(source === 'rtv'){
                source = 'mmc';
            }
            let state = "/rtv365/arhiv/" + id;
            if(source !== ''){
                state = "/rtv365/arhiv/" + id + "?s=" + source;
            }
            history.pushState(null, null, state);               
        }
        
    
        var wH = ($(document).height() > $(window).height()) ? $(document).height() : $(window).height();
        var wW = $(window).width();

        var close_btn = '40';
        var close_btn_margin = "-30px -30px 0 0";

        if (typeof wW !== 'undefined' && wW > 0) {
            //options.width = Math.round(wW / 2);
            //options.height = Math.round((options.width * 9) / 16);
            if (wW > 1024) {
                options.width = '100%';
                options.height = 540;
            } else {
                options.width = '100%';
                options.height = 540;
                close_btn = '60';
                close_btn_margin = "-40px -20px 0 0";
            }

        }


        var $popup;
        var video = $.extend({}, defaults, options, rtvdef);
       
        if (!$("#rtv4d_popup").length) {
            $popup = $("<div>", {
                id: "rtv4d_popup",
                align: "center"
            });
            var pos = NG_ENABLE ? "initial" : "fixed"; 
            $popup.css({
                "width": '100%',
                "height": '100%',
                "position": pos,
                "top": "0",
                "left": "0",
                "background-image": "url(" + video.url["static"] + "img/popup_bg.png)",
                "background-position": "top left",
                "background-repeat": "repeat",
                "z-index": "99999"
            });
            if($("#popup-inject").length){
                $("#popup-inject").append($popup)
            }else {
                $("body").prepend($popup);
            }
         
            $("object, embed").css({
                "visibility": "hidden"
            });
        }else{
            $popup = $("#rtv4d_popup");
            $popup.empty();
        } 

        window.onclick = function(event) {

            var modal = document.getElementById('rtv4d_popup');
            if (event.target == modal) {
                //console.log('event', event.target);
                event.stopImmediatePropagation();
                event.stopPropagation()
                event.preventDefault();
                //console.log('modal', modal);
                closePlayerModal();
              
                //modal.style.display = "none";
            }
        }

        var $container = $("<div>");
        $container.css({
            //"width": video.width,
            "background-color": "#1E1E1E",
            "margin": !NG_ENABLE ? "20px 0 0 0" : "0",
            "position": !NG_ENABLE ? "relative" : "absolute",
            "box-sizing": "border-box",
            "width": "100%",
            "id": "player-main-content"
        }).addClass('player-main-content');
        $popup.append($container);


        

        var $header = $("<div id='mmc-player-header' class='mmc-player-header row'><div class='inner-wrapper'>");

        var $right_menu = null;
        var $lists = null;
        if(NG_ENABLE){
            $right_menu = $("<div class='mmc-player-right-menu'>");
            $lists = $("<div class='mmc-lists-content'><div id='mmc-lists-content' class='mycontent'>");
        }
      

        var $content = $("<div class='mmc-player-content'>");
        var $content_second_row = $("<div class='mmc-player-sidebar'>");
        var $clear = $("<div class='clear'>");
        var $footer = $("<div class='mmc-player-footer row'>");

        $container.append($header);

        $header = $("#mmc-player-header > div");
        
        if($right_menu){
            $container.append($right_menu);
        }

        if($lists){
            $container.append($lists);
        }
       
       
        $container.append($content);
        if(action === 'vod') {
            $container.append($content_second_row);
        }
       
        $container.append($clear);
        $container.append($footer);

        


        var $content_first_row = $('<div class="mycontent dark-mode">'); 
        
        var $player_wrapper = $('<div class="embed-responsive container-16-9" style="height:auto;">'); 

        if(NG_ENABLE) {
            $player_wrapper = $('<div class="" style="height:auto;">'); 
        }
      

        $content_first_row.append($player_wrapper);
        //var $content_second_row = $("<div class='sidebar'>");

        $content.append($content_first_row);
        //$content.append($content_second_row).css({'color':'#bbb','text-align': 'left' });

        var $right_column_moje = $("<div class='right_column_list_moje'><div class='right-column'>" + lang.my_shows_and_epizodes + "</div><div style='list-style: none;' class='list-contents'></div><div class='more-content-button-moje'>" + lang.more + " <span class='icon-arrow_down'></span></div>")

        var $right_column = $("<div class='right_column_list'>")

        var $content_second_video_list_prispevki_iz_oddaj = $("<ul class='video-list-4d iz-oddaj clip-slider'>");

        var $content_second_video_list_prispevki_iz_oddaj_more = $("<span class='content_second_video_list_btn more-content-button-prispevki-more'>");

        $content_second_video_list_prispevki_iz_oddaj_more.html('Vsi prispevki <span class="icon-arrow_down"></span>');

        var $content_second_video_list_drugi_iz_oddaj = $("<ul class='video-list-4d drugi'>");

        var $content_second_video_list = $("<ul class='video-list-4d'>");//ZAdnje oddaje pri oddajah in Sorodni prispevki pri prispevkih - več funcionalnost

        var $content_second_video_list_more = $("<div class='content_second_video_list_btn more-content-button'>");

        $content_second_video_list_more.html(lang.more + ' <span class="icon-arrow_down"></span>');

        $right_column.append($content_second_video_list_prispevki_iz_oddaj);

        $right_column.append($content_second_video_list_prispevki_iz_oddaj_more);

        $right_column.append($content_second_video_list_drugi_iz_oddaj);

        $right_column.append($content_second_video_list);

        $right_column.append($content_second_video_list_more);

       
       
        var $logo = $("<a>", {
            "href": "javascript:void(0);", 
            "id": "4d_popup_link"
        }).addClass('logo');

        if(NG_ENABLE) {
            $logo.on('click', function() {
                window.module__globalDrawerLists.showList();
            })
        }

        var $search = $("<input>", {
            "id": "input_search_bar",
            "autocomplete": "off",
            "placeholder": ""
        }).addClass('input_search_bar');

        var $search_result = $("<div>", {
            "id": "filter-records",

        }).addClass('filter-records');

        var $close = $("<a>", {
            "href": "javascript:void(0);",
            "id": "close_popup_btn",
            "title": lang.close
        }).addClass('close');

        $close.css({
            "position": "absolute",
        });

        var $my_list_toogle = $("<a>", {
            "href": "javascript:void(0);",
            "id": "my_list_toogle",
            "title": "Moje A/V  vsebine",
            "class": "my_list_toogle"
        });

        var $toggler = '<div class="onoffswitch"><input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch"><label class="onoffswitch-label" for="myonoffswitch"><span class="onoffswitch-inner"></span><span class="onoffswitch-switch icon-bookmark"></span></label></div>';
       
        var login_ink = 'https://www.rtvslo.si/prijava';
        if (is_dev) {
            login_ink = 'https://monocms.dev.rtvslo.si/prijava';
        }

        var $login = $("<a>", {
            "href": login_ink,
            "id": "login_btn_link",
            "title": lang.not_logged_in,
            "class": "login_btn_link",
        });

        var $span = $("<div>", {
            "id": "login_subtitle_text",

        }).html('Prijava');

        $span.css({
            "position": "absolute",
            "top": "-10px",
            "right": "0px",
            "color": "#eee",
            "width": "140px",
            "text-align": "center",
            "font-size": "10px"
        });

        $header.append($logo);

        if(!NG_ENABLE) {
            //console.log("🚀 ~ file: jquery.play.jw7-next.js ~ line 4548 ~ action", action)
            if(action === 'vod') {
                
                var $demoBasic = $("<div>").attr('id', 'player_contextSelector');
                $header.append($demoBasic); 


                var width =  100;
                var ddData = [{
                        text: "RTV",
                        value: 'rtv',
                        selected: window.__globalPlayerCTX  === 'rtv',
                    },
                    {
                        text: "TV",
                        value: 'tv',
                        selected: window.__globalPlayerCTX  === 'tv',
                    },
                    {
                        text: "RADIO",
                        value: 'radio',
                        selected: window.__globalPlayerCTX  === 'radio',
                    },
                    {
                        text: "MMC",
                        value: 'mmc',
                        selected:  window.__globalPlayerCTX  === 'mmc',
                    }
                ];

                if( window.__globalPlayerCTX === 'tv_ita' || window.__globalPlayerCTX === 'radio_ita'){
                    ddData = [{
                        text: "TV Capodistria",
                        value: 'tv_ita',
                        selected: window.__globalPlayerCTX  === 'tv_ita',
                    },
                    {
                        text: "Radio Capodistria",
                        value: 'radio_ita',
                        selected: window.__globalPlayerCTX  === 'radio_ita',
                    }
                    
                    ];
                
                }

                if( window.__globalPlayerCTX === 'dostopno'){
                    ddData = [{
                        text: "Dostopno",
                        value: 'dostopno',
                        selected: true,
                    }]
                }

                if( window.__globalPlayerCTX === 'tv_ita'){
                    width =  150;
                }

                if(window.__globalPlayerCTX === 'radio_ita'){
                    width =  150;
                }



                var ddWidth = {
                    'rtv':'55px',
                    'tv':'45px',
                    'radio':'75px',
                    'mmc':'64px'
                }
                $('#player_contextSelector').ddslick({
                    data: ddData,
                    width: width,   
                    imagePosition: "left",
                    selectText: "Izberite",
                    onSelected: function(data) {
                        //console.log('selected', data.selectedData.value);
                        window.__globalPlayerCTX  = data.selectedData.value;

                        placeholderSearch(data.selectedData.value);
                        
                        var width = ddWidth[data.selectedData.value];
                        //console.log('width', width);
                        try {
                            $("#player_contextSelector-dd-placeholder .dd-select").css("width", width);
                            
                        } catch(e) {}               
                    }
                });
            }
          
            



            function placeholderSearch(CTX){

                if(typeof CTX === 'undefined'){
                    return;
                }
                
                //console.log('CTX',CTX);
                if(CTX  === 'tv'){
                    $("#input_search_bar").attr('placeholder', 'Išči po TV-vsebinah');
                }else if(CTX  === 'radio'){
                    $("#input_search_bar").attr('placeholder', 'Išči po radijskih vsebinah');
                }else if(CTX === 'mmc'){
                    $("#input_search_bar").attr('placeholder', 'Išči po vsebinah MMC-ja');
                }else if(CTX  === 'rtv'){
                    $("#input_search_bar").attr('placeholder', 'Išči po vseh RTV-vsebinah');
                }else if(CTX  === 'tv_ita'){
                    $("#input_search_bar").attr('placeholder', 'Cerca ...');
                }else if(CTX  === 'radio_ita'){
                    $("#input_search_bar").attr('placeholder', 'Cerca ...');
                }
            }

            if(action === 'vod') {
                $header.append($toggler);
            }
           
        }
                
       if(action === 'vod') {
            $header.append($login); 
       }
        

        var loggedIn = $.cookieApi("read", null, "APISESSION_USER_ID", 365) ? $.cookieApi("read", null, "APISESSION_USER_ID", 365) : "";
        var show_error_msg = false;
        if (loggedIn) {
            getAjax(getApiEndPoint(DEBUG_ENABLE) + '/users/getCurrent?client_id=' + API_CLIENT_ID, function(data) {
                if (data.response) {
                    $('#login_btn_link').css("background-image", "url(//img.rtvslo.si/_up/avatars/" + data.response.id + ".png)");
                    $('#login_btn_link').css("opacity", "1");
                    $('#login_btn_link').css("background-size", "100%");
                    $('#login_btn_link').attr('title', lang.logged_successfully + ': ' + data.response.uname);
                    $('#rtv4d_popup .mobile_inline .login_name').css("background-image", "url(//img.rtvslo.si/_up/avatars/" + data.response.id + ".png)");
                }
            }, show_error_msg);
        }


        if(NG_ENABLE === false){
            $header.append($close);

            $close.on('click', function(e) {
                e.stopImmediatePropagation();
                e.stopPropagation()
                e.preventDefault();
                //jwplayer("rtv4d_player").remove();
                closePlayerModal();
            
            });
        }

        

        var $videoplayer = $("<div>", {
            id: "rtv4d_player"
        });


        $player_wrapper.append($videoplayer);

        $(window).resize(function() {
            var wH = ($(document).height() > $(window).height()) ? $(document).height() : $(window).height();
            var wW = $(window).width();
            $popup.css({
                "width": wW,
                "height": wH
            });
        });

        window.__mmc_rtv4d_popup_navigation = function(hash) {

            $('#navbar_mobile_rtv4d a').removeClass('active');
            $('#' + hash).addClass('active');
            if (hash == 'info_rtv4d') {
                $('#rtv4d_popup .mmc-player-sidebar').hide()
                $('#content_popup').show();
            } else if (hash == 'sorodno_rtv4d') {
                $('#content_popup').hide();
                $('#rtv4d_popup .mmc-player-sidebar').show();
                $('button#sorodno_desktop_rtv4d').click();

            } else if (hash == 'moje_rtv4d') {
                $('#content_popup').hide();
                $('#rtv4d_popup .mmc-player-sidebar').show();
                $('button#moje_desktop_rtv4d').click();
            }
        };



        if (action == 'vod') {
            options.callback = function(a) {
                if (typeof a.error === 'undefined') {

                    if (a && a.response && a.response.title) {

                        $header.append($search);
                        $search.wrap("<div id='input_search_bar_container' class='input_search_bar_container'></div>");
                        $search.after("<div id='input_search_bar_icon' class='input_search_bar_icon' onclick='document.getElementById(\"input_search_bar\").focus();'></div>");
                        $header.append($search_result);

                        

                        if (typeof window.module__globalSearcBoxPopUpBarVarBuuFoo !== 'undefined') {
                            window.module__globalSearcBoxPopUpBarVarBuuFoo.init();
                        } 
                        else {

                            if (DEBUG_ENABLE === true) {
                                loadFile('./assets/js/searchbox-next.js', 'js', 'searchbox');
                            } 
                            else {
                                loadFile('https://img.rtvslo.si/_static/r' + MMC_PLAYER_ASSETS_V + '/rtv4d/jw7/assets/js/searchbox-next.js', 'js', 'searchbox');;
                            }
                        }



                        var $title = $("<div>", {
                            id: 'content_popup'
                        });
                        $title.addClass('content');
                        $content_first_row.append($title);

                        var $sub_content = $("<div>", {
                            id: 'sub_content'
                        });
                        $sub_content.addClass('sub_content');

                        $title.append($sub_content);


                        var showTypes = [{ "portalId": "9", "title": "Priporočamo", "id": "28" }, 
                        { "portalId": "8", "title": "-", "id": "29" }, 
                        { "portalId": "7", "title": "Kulturno-umetniški program", "id": "30" }, 
                        { "portalId": "6", "title": "Otroški program", "id": "31" }, 
                        { "portalId": "5", "title": "Verski program", "id": "32" }, 
                        { "portalId": "4", "title": "Izobraževalni program", "id": "33" }, 
                        { "portalId": "3", "title": "Informativni program", "id": "34" }, 
                        { "portalId": "2", "title": "Športni program", "id": "35" }, 
                        { "portalId": "1", "title": "Razvedrilni program", "id": "36" }, 
                        { "portalId": "40", "title": "Iz TV arhiva", "id": "6781958" }, 
                        { "portalId": "0", "title": "Reklame", "id": "15890837" }, 
                        { "portalId": "0", "title": "Mladinski program", "id": "15890838" }, 
                        { "portalId": "0", "title": "Parlamentartni program", "id": "15890839" }, 
                        { "portalId": "0", "title": "Dokumentarni program", "id": "15890840" }, 
                        { "portalId": "0", "title": "Filmski program", "id": "15890841" }];

                        if(window.__globalPlayerCTX === 'tv_ita' || window.__globalPlayerCTX === 'radio_ita'){

                            showTypes = [
                                        { "portalId": "9", "title": "Consigliamo", "id": "28" },
                                        { "portalId": "8", "title": "", "id": "29" },
                                        { "portalId": "7", "title": "Programma artistico-culturale", "id": "30" },
                                        { "portalId": "6", "title": "Programma per i bambini", "id": "31" },
                                        { "portalId": "5", "title": "Programma religioso", "id": "32" },
                                        { "portalId": "4", "title": "Programma educativo", "id": "33" },
                                        { "portalId": "3", "title": "Programma informativo", "id": "34" },
                                        { "portalId": "2", "title": "Programma sportivo", "id": "35" },
                                        { "portalId": "1", "title": "Programma intrattenimento", "id": "36" },
                                        { "portalId": "40", "title": "Dalle teche TV", "id": "6781958" },
                                        { "portalId": "0", "title": "Pubblicità", "id": "15890837" },
                                        { "portalId": "0", "title": "Programma per i giovani", "id": "15890838" },
                                        { "portalId": "0", "title": "Programma parlamentare", "id": "15890839" },
                                        { "portalId": "0", "title": "Programma documentari", "id": "15890840" },
                                        { "portalId": "0", "title": "Programma film", "id": "15890841" }
                                ];
                        }

                        


                        var showTypesBarbs = [];
                        showTypesBarbs["28"] = "Priporočamo";
                        showTypesBarbs["29"] = "NedefiniranO";
                        showTypesBarbs["30"] = "Kultura";
                        showTypesBarbs["31"] = "Otroci";

                        showTypesBarbs["32"] = "Duhovno";
                        showTypesBarbs["33"] = "Znanje";
                        showTypesBarbs["34"] = "Info";

                        showTypesBarbs["34"] = "Info";
                        showTypesBarbs["35"] = "Šport";
                        showTypesBarbs["36"] = "Razvedrilo";

                        showTypesBarbs["6781958"] = "Iz TV arhiva";
                        showTypesBarbs["15890837"] = "Reklame";
                        showTypesBarbs["15890838"] = "Mladi";

                        showTypesBarbs["15890839"] = "Parlamentartni";
                        showTypesBarbs["15890840"] = "Dokumentarni";
                        showTypesBarbs["15890841"] = "Film/serije";


                        
                        $title.prepend('<div class="titleLink">' + a.response.title + '</span></div>');
                                               

                        var $sub_content = $("<div>", {
                            class: 'showMoreBtn'
                        }).on('click', function(){
                            $('#show_description_txt').toggle();
                            
                        })


                        var $moje4 = $("<div class='d4-button-group moje4'>");

                        $title.append($sub_content);

                        var date_format =  removeLeadingZerosFromDate(a.response.date);

                        var star = '';
                        if(a && a.response && a.response.broadcastDates && Array.isArray(a.response.broadcastDates) && a.response.broadcastDates.length > 1){
                            star = ' * ';
                        }
                            
                        var objavljeno =  date_format;   
                        var st_ogledov = (a.response.views || 0) + ' ' + lang.views + star + '<span class="dot"> • </span> ';


                        let show_stats = false;
                        try{
                            if(a.response.show_stats == 1){
                                show_stats = true;                       
                            }
                        }catch(e){}
                        
                        

                        var sanityNumber = parseInt(a.response.views || 0, 10);

                        let subTitle = '';
                        let parentalGuidance = '';

                        if(a.response.broadcast.parentalGuidance && a.response.broadcast.parentalGuidance > 0) {
                            let pg = a.response.broadcast.parentalGuidance;
                            let pg_text = '';
                            let pg_class = 'icon-pg';
                            if(pg == 1) {
                                pg_text = 'Za odrasle';
                                pg_class = 'icon-pg-18';
                            }
                            else if(pg == 2) {
                                pg_text = 'Za otroke od 15 let';
                                pg_class = 'icon-pg-15';
                            }
                            else if(pg == 3) {
                                pg_text = 'Za otroke od 12 let';
                                pg_class = 'icon-pg-12';
                            }
                            parentalGuidance = `<span class="dot"> • </span><span title="${pg_text}" class="${pg_class} mr-1"></span>`;
                        }

                        if(a.response.subTitle && a.response.subTitle !== '') {
                            subTitle = a.response.subTitle + ' <span class="dot">•</span> ';
                            //capitalize first letter
                            subTitle = subTitle.charAt(0).toUpperCase() + subTitle.slice(1);
                        }
                        subtitles_icon = '';
                        if(a.response.subtitles && Array.isArray(a.response.subtitles)){
                            subtitles_icon = '<span class="dot"> • </span><span title="Podnapisi" class="icon-podnapisi"></span>'
                        }
                        
                        var metadata = subTitle + '<span id="show_stats_number" style="display:none;">' + st_ogledov + '</span>' + objavljeno  + ' <span  class="dot">•</span> ' +  a.response.length_min + ' min';

                        if(show_stats && sanityNumber > 0 && sanityNumber < 500000){ //this filters fuck ups 
                            metadata = '<span id="show_stats_number">' + st_ogledov + '</span>' + objavljeno + ' <span class="dot">•</span> ' +  a.response.length_min + ' min';
                        }

                        if(a && a.response && a.response.geoblocked && a.response.geoblocked === 1) {
                            var slo = '<span class="dot"> • </span><i title="Vsebina je geoblokirana" class="icon-slovenia"></i>';
                            metadata = metadata + slo;
                        }
                        //console.log("a.response.expirationDate", a.response.expirationDate)
                        if(a && a.response && a.response.expirationDate && a.response.expirationDate.indexOf('3000-') === -1 && a.response.expirationDate.indexOf('3001-') === -1) {
                            if(a.response.promo && a.response.promo === 1) {
                                //Skip from promo
                            }
                            else {
                                var span = '<span  class="dot"> • </span><i>' + time_expire_on(a.response.expirationDate) + '</i></span>'
                                metadata = metadata + span;    
                            }            
                        }
                        metadata = metadata + subtitles_icon + parentalGuidance;


                        $moje4.html(metadata);
                        var showTypeName = showTypes.filter(function(itm) {
                            return itm.id == a.response.showTypeId;
                        });


                        if (a &&  a.response && a.response.showName) {
                            let text = ''
                            if (a && a.response && a.response.clip && a.response.clip == 1) {
                                text = 'Prispevek iz oddaje ' + '<span class="dot">•</span> ';
                            }
                            let link = 'https://365.rtvslo.si/oddaja/' + a.response.showName.replace(/ /g, '-').replace(/[^a-zA-Z0-9-]/g, '').toLowerCase() + '/' + a.response.showId;
                            $sub_content.append('<div class="subtitle">' + text + '<a target="_blank" style="color:#2793E6;" href="' +link + '"> ' + a.response.showName + '</a></div>');
                        }

                        var $buttons = $("<div>").css({});
                        $sub_content.append($buttons);
                        var $buttons_wrap = $("<div>");
                        $buttons.append($buttons_wrap);
                        $buttons_wrap.append($moje4);

    

                        if (a.response.showName) {
                            $('#4d_show_name_tile').attr('title', a.response.showName);
                            $('#4d_show_name_tile').html('Več o oddaji');
                            $('#4d_show_name_tile').attr('href', a.response.showLink);

                            var $about = '';
                            var $desc = '';
                            var $rich_desc = '';
                            if (a && a.response && a.response.description && typeof a.response.description === 'string') {
                                $about = a.response.description.replace(/(?:\r\n|\r|\n)/g, '<br>')
                                $desc = a.response.description;
                              
                            } 
                            else if(a && a.response && a.response.showDescription && typeof a.response.showDescription === 'string') {
                                $about = a.response.showDescription.replace(/(?:\r\n|\r|\n)/g, '<br>');
                                $desc = a.response.showDescription;
                            }

                            if (a && a.response && a.response.rich_description && typeof a.response.rich_description === 'string') {
                                $rich_desc = HtmlSanitizer.SanitizeHtml(a.response.rich_description.replace(/(?:\r\n|\r|\n)/g, '<br>'));     
                            }
                            //alert(a.response.rich_description);
                            //console.log('$about',$about);
                            try {
                                $about = $about.replace(/"/g, '\'');
                                $desc = escapeHtml($desc);
                                $about = $about + $rich_desc;
                            }
                            catch(e){}
                           


                            if(a && a.response && a.response.broadcastDates && Array.isArray(a.response.broadcastDates) && a.response.broadcastDates.length > 1){
                                                    
                                if(show_stats === true){
                                    $about = $about + '<span id="show_stats_disclaimer" style="display:none;"><br><br><i>* Število ogledov oz. poslušanj se nanaša na daljše obdobje, saj je bila oddaja že večkrat predvajana in na spletu na voljo že pred tem datumom.</i></span>';
                                }                 
                            }

                            $title.append('<div title="'+ $desc+'" id="show_description_txt" class="show_description_txt">' + $about + '</div>');

                            
                            
                            if(a && a.response && a.response.broadcast && a.response.broadcast.author){
                                let author = a.response.broadcast.author;
                                $title.append('<div style="font-size:0.875rem" title="' + author +'" class="author_txt">Avtor: ' + author + '</div>');          
                            }

                           

                            if($(window).width() <= 900){
                                $('#rtv4d_popup #show_description_txt').hide();
                            }

                           

                        }
                       

                        $title.append('<div id="parent_show_recording"></div>')

                    
                        var video_news = '';
                        var active_oddaje = 'active';
                        var sorodni_prispevki = '';
                        var videonews = false;
                        //console.log('options', options);
                        if (options && options.videonews) {
                            video_news = '<button class="btn btn-sm active" id="video_novice_desktop_rtv4d">Video novice</button>';
                            active_oddaje = '';
                            videonews = true;
                        } 
               
                          
                        //console.log('(a', a);
                        if (a && a.response && a.response.children) {         
                            sorodni_prispevki = '<button class="btn btn-sm" id="sorodni_prispevki_rtv4d">' + lang.epizodes + '</button>';
                        }

                        if (a && a.response && a.response.clip && a.response.clip == 1) {         
                            sorodni_prispevki = '<button class="btn btn-sm" id="sorodni_prispevki_rtv4d">' + lang.epizodes + '</button>';
                            active_oddaje = '';
                        }

                        var $side_menu_buttons_sub_sorodno = '<div><div id="navbar_desktop_rtv4d_sorodno" class="navbar_desktop_rtv4d_sorodno navbar_desktop">' +
                            '{video_news}' +
                            '<button class="btn btn-sm {active_oddaje}" id="zadnje_oddaje_desktop_rtv4d">Oddaje</button>' +
                            '{sorodni_prispevki}' +
                            '</div></div>';

                        $side_menu_buttons_sub_sorodno = $side_menu_buttons_sub_sorodno.replace('{video_news}', video_news).replace('{active_oddaje}', active_oddaje).replace('{sorodni_prispevki}', sorodni_prispevki);

                        $side_menu_buttons_sub_sorodno = $($side_menu_buttons_sub_sorodno);

                       
                      
                      
                        
                       $content_second_row.append($right_column_moje);
                       $content_second_row.append($right_column);     

                       $('#myonoffswitch').on('click', function(itm) {

                            return window.location.href = 'https://365.rtvslo.si/seznam/moje';
                           
                       });                   
                       
                    function secondsToHH_MM_SS_sec(d) {
                        var result = "00:00:00";
                        var d = Number(d);
                        var h = Math.floor(d / 3600);
                        var m = Math.floor(d % 3600 / 60);
                        var s = Math.floor(d % 3600 % 60);
                        var timecode = ((h > 0 ? h + ":" : "") + (m > 0 ? (h > 0 && m < 10 ? "0" : "") + m + ":" : "0:") + (s < 10 ? "0" : "") + s);
                        /*var i = timecode.length;
                        i = 8 - i;
                        result = result.substr(0, i) + timecode;*/

                        return timecode;

                    };

                    function time_expire_on(time) {

                        var timeRelative = {

                            time_formats: [
                              //[2, 'sekundo', 1], // 60
                              //[3, 'sekundi', 1], // 2 sekundi
                              //[5, 'sekunde', 1], // 3 in 4 sekunde
                              [10, 'ravnokar', 'ravnokar'], // Ravnokar je <10sek
                              [60, 'sekund', 1], // N sekund
                          
                              [120, 'minuto', 60],  // [60*2, 'minuto', 60], // 1 minuta
                              [180, 'minuti', 60],  // [60*3, 'minuti', 60], // 2 minuti
                              [300, 'minute', 60],  // [60*5, 'minute', 60], // 3 in 4 minute
                              [3600, 'minut', 60],  // [60*60, 'minut', 60], // N minut
                          
                              [7200, 'uro', 3600],  // [60*60*2, 'uro', 60*60], // 1 uro
                              [10800, 'uri', 3600],  // [60*60*3, 'uri', 60*60], // 2 uri
                              [18000, 'ure', 3600],  // [60*60*5, 'ure', 60*60], // 3 in 4 ure
                              [86400, 'ur', 3600],  // [60*60*24, 'ur', 3600], // N ur
                          
                              [172800, 'dan', 86400],  // [60*60*24*2, 'dan', 60*60*24], // 1 dan
                              // [604800, 'dni', 86400],  // [60*60*24*7, 'dni', 60*60*24], // N dni
                          
                              [2903040000, 'dni', 86400],  // [60*60*24*7*4*12*10, 'dni', 60*60*24], // N dni 
                          /*
                              [1209600, 'teden', 604800],  // [60*60*24*7*2, 'teden', 60*60*24*7], // 1 teden
                              [1814400, 'tedna', 604800],  // [60*60*24*7*3, 'tedna', 60*60*24*7], // 2 tedna
                              [2419200, 'tedne', 604800],  // [60*60*24*7*4, 'tedne', 60*60*24*7], // 3 tedne
                          
                              [4838400, 'mesec', 2419200],  // [60*60*24*7*4*2, 'mesec', 60*60*24*7*4], // 1 mesec
                              [7257600, 'meseca', 2419200],  // [60*60*24*7*4*3, 'meseca', 60*60*24*7*4], // 2 meseca
                              [12096000, 'mesece', 2419200],  // [60*60*24*7*4*5, 'mesece', 60*60*24*7*4], // 3 in 4 mesece
                              [29030400, 'mesecev', 2419200],  // [60*60*24*7*4*12, 'mesecev', 60*60*24*7*4], // N mesecev
                          
                              [58060800, 'leto', 29030400],  // [60*60*24*7*4*12*2, 'leto', 60*60*24*7*4*12], // 1 leto
                              [87091200, 'leti', 29030400],  // [60*60*24*7*4*12*3, 'leti', 60*60*24*7*4*12], // 2 leti
                              [145152000, 'leta', 29030400],  // [60*60*24*7*4*12*5, 'leta', 60*60*24*7*4*12], // 3 in 4 leta
                              [2903040000, 'let', 29030400],  // [60*60*24*7*4*12*100, 'let', 60*60*24*7*4*12], // N let
                          */
                            ],
                            word_ago_format: '{0} nazaj',
                            word_from_now_format: 'še {0}',
                          
                            calc: function(time, disable_future) {
                              disable_future = disable_future || true;
                              // String format helper
                              if (!String.format) {
                                String.format = function(format) {
                                  var args = Array.prototype.slice.call(arguments, 1);
                                  return format.replace(/{(\d+)}/g, function(match, number) {
                                    return typeof args[number] != 'undefined'
                                    ? args[number]
                                    : match
                                    ;
                                  });
                                };
                              }
                          
                              switch (typeof time) {
                                case 'number':
                                  break;
                                case 'string':
                                  time = +new Date(time.replace(" ", "T"));
                                  break;
                                case 'object':
                                  if (time.constructor === Date) time = time.getTime();
                                  break;
                                default:
                                  time = +new Date();
                              }
                          
                              var seconds = (+new Date() - time) / 1000,
                                word_format = this.word_ago_format,
                                list_choice = 1;
                          
                              /*if (seconds == 0) {
                                return 'sedaj'
                              }*/
                              if (seconds < 0) {
                                seconds = Math.abs(seconds);
                                word_format = this.word_from_now_format;
                                list_choice = 2;
                              }
                              else if ((seconds > 0) && disable_future) {
                                return false;
                              }

                              // If more than a 30 days throw custom text
                            if (seconds > 2678400) { // 60*60*24*31
                                return String.format(word_format, 'več kot 30 dni');
                            }


                              var i = 0,
                                format;
                              while (format = this.time_formats[i++])
                                if (seconds < format[0]) {
                                  if (typeof format[2] == 'string')
                                    return format[list_choice];
                                  else
                                    return String.format(word_format, Math.floor(seconds / format[2]) + ' ' + format[1]);
                                }
                              return time;
                              }
                          }

                          return timeRelative.calc(time);
                    }

                    function createListItem(itm, params){

                        var column1 = '6';
                        var column2 = '6';
                        var show_more_prispevki = false;

                        if(params && params['cols']){
                            if(params['cols']['col1']){
                                column1 = params['cols']['col1'] ? params['cols']['col1'] : column1;
                            }
                            if(params['cols']['col2']){
                                column2 = params['cols']['col2'] ? params['cols']['col2'] : column2;
                            }           
                        }
                       

                        var $template = "<li class=\"{class}\" onclick=\"$.showPopup('vod', {recording}, {target: 'popup', client: '" +API_CLIENT_ID+ "', autostart: 'true', {videonews} }, true);\">" +
                        //let $template = "<li class=\"{class}\">" +
                                    '<div class="md-news">' +
                                        '<div class="row">' +
                                            '<div class="col-sm-4 col-6 col-md-6 image">' +
                                                '<span class="image-link image-container container-16-9 has-media-meta player" style="display: flex; position: relative;">' +        
                                                        '<div class="media-meta-time"><span class="{icon}"></span>{length}</div>' +
                                                        '<div class="media-meta-icon">' +
                                                            '{sign_desc}' +
                                                            '{sign_lang}' +
                                                            '{deaf}' +
                                                            '{geo}' +
                                                           
                                                        '</div>' +   
                                                        '<img style="max-width:100%;" src="{img}"/>' +                                                        
                                                '</span>' +
                                            '</div>' +
                                            '<div class="col-sm-8 col-6 col-md-6 title" style="padding:0;">' +   
                                                    '<h3 class="title-cut-4-rows">' + 
                                                        '<p class="media-meta">{title}</p>' + 
                                                        '<p class="media-meta date">{date}</p>' +
                                                    '</h3>' +      
                                            '</div>' +
                                        '</div>' +
                                '</div>' +
                        '</li>';

                        var tmp = '';
                        if (itm && itm.images && itm.images.wide1) {
                            tmp = $template.replace('{date}', removeLeadingZerosFromDate(itm.date)).replace('{title}', itm.title).replace('{img}', itm.images.wide1).replace('{recording}', itm.id).replace('{videonews}', 'videonews: ' + options.videonews);
                            
                            var duration = secondsToHH_MM_SS_sec(itm.duration);
                            tmp = tmp.replace('{length}', duration);
                        } 

                        
                        
                        if(itm && itm.id && itm.showlength && itm.images && itm.images[0] && itm.images[0]['image'] && itm.images[0]['image']['thumb']) {
                            var img = itm.images[0]['image']['thumb'].replace('_thumb.jpg','_wide2.jpg')
                            tmp = $template.replace('{date}', itm.date).replace('{title}', itm.title).replace('{img}',img ).replace('{recording}', itm.id).replace('{length}', itm.showlength).replace('{videonews}', 'videonews: ' + options.videonews);
                        }
                        tmp = tmp.replace('http://', 'https://');
                        if (itm && itm.geoblocked && itm.geoblocked == '1') {
                            tmp = tmp.replace('{geo}', '<i class="icon-slovenia"></i>');
                        } else {
                            tmp = tmp.replace('{geo}', '');
                        }
                        if(itm && itm.subtitled && itm.subtitled == '1'){
                            tmp = tmp.replace('{deaf}','<i class="icon-podnapisi" title="podnapisi"></i>');
                        }else{
                            tmp = tmp.replace('{deaf}','');
                        }
                        
                        if(itm && itm.audioTranslation && itm.audioTranslation == '1'){           
                            tmp = tmp.replace('{sign_lang}','<i class="icon-zvocni-podnapisi" title="Zvočni podnapisi"></i>');
                        }else{
                            tmp = tmp.replace('{sign_lang}','');
                        }

                        if(itm && itm.audioDescription && itm.audioDescription == '1'){           
                            tmp = tmp.replace('{sign_desc}','<i class="icon-zvocni-opis" title="Zvočni opis"></i>');
                        }else{
                            tmp = tmp.replace('{sign_desc}','');
                        }                      
                        
                        if(itm && itm.clip && itm.clip == '1') {    
                            tmp = tmp.replace('{icon}','icon-video-clip');
                        }
                        else {
                            if(itm.mediaType === 'audio'){
                                if(itm.podcast == '1'){
                                    tmp = tmp.replace('{icon}','icon-podcast');
                                }
                                else {
                                    tmp = tmp.replace('{icon}','icon-audio');
                                }
                            }
                            else {
                                tmp = tmp.replace('{icon}','icon-video');
                            }          
                        }

                        if(itm && itm.hide && itm.hide == '1'){
                            show_more_prispevki = true;
                                                        
                            tmp = tmp.replace('{class}','hide');
                        }else{
                            tmp = tmp.replace('{class}','');
                        }
                        //console.log("createListItem -> itm", itm.expirationDate)
                        if(itm && itm.expirationDate && itm.expirationDate.indexOf('3000-') === -1 && itm.expirationDate.indexOf('3001-') === -1){
                        
                            if(itm.promo && itm.promo === 1){
                              //Skip from promo
                            }
                            else {
                                var span = '<span style="float:right;"><i>' + time_expire_on(itm.expirationDate) + '</i></span>'
                                tmp = tmp.replace('{expirationDate}',span);
                            }                       
                        }
                        else {
                            tmp = tmp.replace('{expirationDate}','');
                        }

                        return {
                            'show_more_prispevki': show_more_prispevki,
                            'element': tmp,
                        };

                    }

                    

                    function createList(items, dest, type, hits, pageSize, pageNumber, callback) {
                            
                            var list = [];      
                            var show_more_prispevki = false;
                            items.map(function(itm) {            
                                var list_element = createListItem(itm);
                                show_more_prispevki = list_element['show_more_prispevki'];
                                var element = list_element['element'];
                                list.push(element)
                            });

                            if(show_more_prispevki === true){
                                $(".more-content-button-prispevki-more").show();    
                                $(".more-content-button-prispevki-more").on('click', function(){
                                    $(".video-list-4d.iz-oddaj").find('li').removeClass('hide');
                                    $(".more-content-button-prispevki-more").hide();
                                });
                            }

                            if(!dest.append){

                                console.log('load more error type', type);
                                return;
                            }
                            

                            dest.append(list.join(''));

                            if (pageSize * (pageNumber + 1) < hits) {
                                //var moreContentButton = $('<li data-type="' + type + '" class="more-content-button" style="color: #fff; text-align: center; border: 1px solid #656565; padding: 5px; width: 100%;">Več</li>');
                                //dest.append(moreContentButton);
                                $(".more-content-button").show();
                            }

                            if ($(".more-content-button").length) {
                                handleMoreContentButton(type, pageNumber);
                            }

                            if (callback && typeof(callback) === "function") {
                                callback(items);
                            }
                        }

                        

                        function handleMoreContentButton(type, pageNumber) {
                           
                            $(".more-content-button").on("click", function() {
                                $(".more-content-button").off();
                                                        
                                switch (type) {
                                    case "sorodno-zadnje-oddaje":
                                        getLastShows(a.response.showId, a.response.id, SORODNO_ITEMS_PER_PAGE, pageNumber+1, $content_second_video_list, window.__globalPlayerCTX );
                                        break;
                                    case "sorodno-prispevki":
                                        //getChildren(a.response.id, a.response.id, SORODNO_ITEMS_NUMBER, pageNumber+1);
                                        if (a && a.response && a.response.clip == '1'  && a.response.parents && a.response.parents[0]) {                
                                            getChildren(a.response.parents[0], a.response.id, SORODNO_ITEMS_PER_PAGE, pageNumber+1, $content_second_video_list_prispevki_iz_oddaj, window.__globalPlayerCTX );
                                        }else{
                                            getChildren(a.response.id, a.response.id, SORODNO_ITEMS_PER_PAGE, pageNumber+1, $content_second_video_list_prispevki_iz_oddaj, window.__globalPlayerCTX );
                                        } 
                                        break;
                                    case "get-related-clips":
                                        getRelatedClips(a.response.showTypeId, a.response.id, SORODNO_CLIPS_ITEMS_PER_PAGE,  pageNumber+1,  $content_second_video_list, window.__globalPlayerCTX );
                                        break;                         
                                    default:
                                        break;
                                }
                            });
                            
                        }

                        function getRecommended(interval, clip) {
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getRecommendRecordings?client_id=8c5205a95060a482f0fc96b9162d9e3f&interval=week&clip=" + clip;
                            
                            getAjax(url, function(data) {
                                if (data && data.response && data.response.recordings) {
                                    createList(data.response.recordings, $content_second_video_list, "priporocene");
                                }
                            });
                        }
                        /**
                         * 
                         * @param {*} clip 
                         * @param {*} showTypeId 
                         * Priročene  uredništva
                         */
                        function getCarouselByWPid(clip, showTypeId) {
                            
                            var WPID = 71;
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getSearch?client_id=8c5205a95060a482f0fc96b9162d9e3f&showTypeId="+showTypeId+"&WPId="+WPID+"&sort=date&order=desc&pageSize=20&pageNumber=0&promo=0&clip=" + clip;
                            //https://api.dev.rtvslo.si/ava/getSearch?client_id=8c5205a95060a482f0fc96b9162d9e3f&showTypeId=30&WPId=71&sort=date&order=desc&language=SLO&pageSize=10&pageNumber=0&subtitled=0&recommended=0&signLanguage=0&audioDescription=0&hearingAid=0&mediafiles=0&carousel=0&podcast=0&clip=show&lat=46.0417455&long=14.50974789999998&promo=0&unpublished=0&payTv=0&children=0&_=1579864166638
                            getAjax(url, function(data) {

                                if (data && data.response && data.response.recordings) {

                                    createList(data.response.recordings, $content_second_video_list, "priporocene");
                                }
                            });
                        }

                        function getChildren(id, current_id, pageSize, pageNumber, $dom_list, ctx, callback) {
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getChildren/" + id + "?&client_id=" + API_CLIENT_ID + "&sort=date&order=desc&pageSize=" + pageSize + "&pageNumber=" + pageNumber + "&language=" + LANGUAGE;
                            
                            if(ctx === 'radio'){
                                url = url + '&source=ra1%2Cval202%2Cars%2Cramb%2Crakp%2Crsi'
                            }
                            if(ctx === 'tv'){
                                url = url + '&source=slo1%2Cslo2%2Cslo3%2Ctvkp%2Ctvmb%2Cmmctv'
                            }
                            if(ctx === 'mmc'){
                                url = url + '&source=mmctv'
                            }
                            if(ctx === 'tv_ita'){
                                url = url + '&source=tvkp'
                            }
                            if(ctx === 'radio_ita'){
                                url = url + '&source=capo'
                            }
                            
                            getAjax(url, function(data) {
                                //console.log('data.response.recordings',data.response.recordings );
                                if (data && data.response && data.response.recordings) {
                                    var $filter = data.response.recordings.filter(function(itm) {
                                        return itm.id != current_id;
                                    })
                                    //console.log('$(window).width()',$(window).width());
                                    if($(window).width() > 900){
                                        $filter.map(function(recording, i){
                                            if(i > 2){
                                                $filter[i]['hide'] = '1';
                                            }
                                            //console.log("i ", i);
                                        }) 
                                    }else{
                                        $content_second_video_list_prispevki_iz_oddaj_more.hide();
                                    }
                                                      
                                    createList($filter, $dom_list, "sorodno-prispevki", data.response.meta.hits, pageSize, pageNumber, callback);
                                }
                            });
                        }

                        function getRelatedClips(showTypeId, current_id, pageSize, pageNumber, $dom_list, filter_items, ctx, callback) {
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getSearch2?&client_id=" + API_CLIENT_ID + "&showTypeId=" + showTypeId + "&promo=0&sort=date&order=desc&pageSize=" + pageSize + "&pageNumber=" + pageNumber + "&clip=clip&from=2007-01-01&language=" + LANGUAGE;
                            if(ctx === 'radio'){
                                url = url + '&source=ra1%2Cval202%2Cars%2Cramb%2Crakp%2Crsi'
                            }
                            if(ctx === 'tv'){
                                url = url + '&source=slo1%2Cslo2%2Cslo3%2Ctvkp%2Ctvmb%2Cmmctv'
                            }
                            if(ctx === 'mmc'){
                                url = url + '&source=mmctv'
                            }
                            if(ctx === 'tv_ita'){
                                url = url + '&source=tvkp'
                            }
                            if(ctx === 'radio_ita'){
                                url = url + '&source=capo'
                            }

                            getAjax(url, function(data) {
                                // console.log('data.response.recordings',data);

                                if (data && data.response && data.response.recordings) {

                                    var $filter = data.response.recordings.filter(function(itm) {
                                        return itm.id != current_id;
                                    })
                                    
                                    if(Array.isArray(filter_items)) 
                                    {
                                        $filter = data.response.recordings.filter(function(itm) {
                                            return filter_items.indexOf(itm.id) === -1;
                                        })
                                    }
                                    createList($filter, $dom_list, "get-related-clips", data.response.meta.hits, pageSize, pageNumber, callback);
                                }
                            });
                        }

                        function getLastShows(showId, current_id, pageSize, pageNumber, $dom_list, ctx, callback) {  
                            //console.log('getLastShows', showId);                
                            var promo = 0;
                            if(showId == 173250644){
                                promo = 1;
                            }
                            
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getSearch2?&client_id=" + API_CLIENT_ID + "&showId=" + showId + "&promo=" + promo + "&sort=date&order=desc&pageSize=" + pageSize + "&pageNumber=" + pageNumber + "&clip=show&from=2007-01-01&language=" + LANGUAGE;                  
                            
                            
                            if(ctx === 'radio'){
                                url = url + '&source=ra1%2Cval202%2Cars%2Cramb%2Crakp%2Crsi'
                            }
                            if(ctx === 'tv'){
                                url = url + '&source=slo1%2Cslo2%2Cslo3%2Ctvkp%2Ctvmb%2Cmmctv'
                            }
                            
                            getAjax(url, function(data) {

                                if (data && data.response && data.response.recordings) {

                                    var $filter = data.response.recordings.filter(function(itm) {
                                        return itm.id != current_id;
                                    })

                                    if(_dispatchCustomEvent) {
                                        _dispatchCustomEvent(EVENT_TYPE_LAST_SHOWS, $filter);
                                    }

                                    createList($filter, $dom_list, "sorodno-zadnje-oddaje", data.response.meta.hits, pageSize, pageNumber, callback);
                                }
                            });
                        }

                        function getParentRecording(recordingId, callback) {
                                             
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getRecordingDrm/" + recordingId + "?&client_id=" + API_CLIENT_ID;    
                            getAjax(url, function(data) {
                                if (data && data.response) {
                                    if(callback){
                                        callback(data.response);
                                    }                                
                                }
                            });
                        }

                        function getMyList(pageSize, pageNumber, clb) {
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getMarkedRecordings?client_id=" + API_CLIENT_ID + "&pageSize=" + pageSize + "&pageNumber=" + pageNumber;
                            getAjax(url, function(data) {
                               
                                if (data && data.response && data.response && clb) {
                                    clb(data.response)
                                }
                            });
                        }

                        function getVideoNews(id, current_id) {
                            var url = getApiEndPoint(DEBUG_ENABLE) + "/ava/getVideoNews/" + id + "?&client_id=" + API_CLIENT_ID + "&sort=date&order=desc&pageSize=20";
                            getAjax(url, function(data) {
                                //console.log('data.response',data.response );

                                if (data && data.response) {
                                    var $filter = data.response.filter(function(itm) {
                                        return itm.id != current_id;
                                    })

                                    $filter.map(function(itm) {
                                        itm.id = itm.url;
                                    })

                                    //console.log('$filter', $filter)
                                    createList($filter, $content_second_video_list, "video-novice");
                                }
                            });
                        }

                        /**
                         * Load right column
                         */

                         
                         
                         //PRISPEVEK       
                         if(a && a.response && a.response.clip == '1' && a.response.parents && a.response.parents[0]){
                   
                            getChildren(a.response.parents[0], a.response.id, SORODNO_ITEMS_PER_PAGE, 0, $content_second_video_list_prispevki_iz_oddaj, window.__globalPlayerCTX,  function(data) {
                                //$("#navbar_desktop_rtv4d_sorodno button").first().trigger("click");
                                $title = $('<div class="right-column">');

                                var $template = "<span class=\"subtitle-link\" onclick=\"$.showPopup('vod', " + a.response.parents[0] + ", {target: 'popup', client: '" + API_CLIENT_ID + "', autostart: 'true' });\">" + a.response.showName + "</span>";
                                text =  lang.epizodes + ' <span class="dot">•</span> '  + $template;
                                $title.append(text);

                                //$title = $title.html('Iz oddaje <span class="dot">•</span> ' + a.response.showName) ;
                                //$content_second_video_list_prispevki_iz_oddaj.prepend($title);
                                $title.insertBefore($content_second_video_list_prispevki_iz_oddaj)

                                
                                var filter = [];
                                data.map(function(itm){
                                    filter.push(itm.id);
                                })
                                
                                
                            
                                getRelatedClips(a.response.showTypeId, a.response.id, SORODNO_CLIPS_ITEMS_PER_PAGE, 0, $content_second_video_list, filter, window.__globalPlayerCTX , function(){
                                
                                    $title = $('<div class="right-column zadnje-oddaje">');
                                    $title = $title.html(lang.other_epizodes + ' <span class="dot">•</span> ' + showTypesBarbs[a.response.showTypeId]);
                                    //$content_second_video_list.prepend($title);
                                    $title.insertBefore($content_second_video_list)
                                
                                });
                            
                            
                            });

                            

    

                         }
                         else {//ODDAJA
                           
                            getChildren(a.response.id, a.response.id, SORODNO_ITEMS_PER_PAGE, 0, $content_second_video_list_prispevki_iz_oddaj, window.__globalPlayerCTX , function(data) {
                                //$("#navbar_desktop_rtv4d_sorodno button").first().trigger("click");

                                
                                if(data.length === 0){
                                    $(".video-list-4d.iz-oddaj").hide();
                                    return;
                                }else{
                                    $(".video-list-4d.iz-oddaj").show();
                                }

                                $title = $('<div class="right-column">');
                                $title = $title.html(lang.epizodes + ' <span class="dot">•</span> ' + a.response.showName) ;
                                //$content_second_video_list_prispevki_iz_oddaj.prepend($title);
                                $title.insertBefore($content_second_video_list_prispevki_iz_oddaj)
                            });

                            getLastShows(a.response.showId, a.response.id, SORODNO_ITEMS_PER_PAGE, 0, $content_second_video_list, window.__globalPlayerCTX, function(data){

                                $title = $('<div class="right-column zadnje-oddaje">');
                                $title = $title.html(a.response.showName)
                                //$content_second_video_list.prepend($title);
                                $title.insertBefore($content_second_video_list)
                            });
                         }
                        
                    

                        if (typeof a.response.news !== 'undefined') {

                            var wW = $(window).width();

                            $related = $("<div id='related-news-popup'>");

                            if (wW > 768) {
                                $related.css({
                                    "width": "100%",
                                    "max-width": "320px",
                                    "position": "absolute",
                                    "top": "5px",
                                    "left": "5px",
                                    "text-align": "left",
                                    "padding": "0 10px",
                                    "background-color": "#171B1A",      
                                    "font-size": "0.875rem",
                                    "font-weight": "100"

                                });
                            } else {
                                $related.css({
                                    "width": "100%",
                                    "max-width": "100%",
                                    "text-align": "left",
                                    "padding": "0 10px",
                                    "background-color": "#171B1A",
                                    "font-size": "0.875rem",
                                    "position": "relative",
                                    "font-weight": "100"
                                });
                            }

                            $content_first_row.append($related);

                            var news = a.response.news.join();
                            var urlgetItems = "https://api.rtvslo.si/news/getItems?client_id=" + API_CLIENT_ID + "&id=" + news + "&prepare=medium";

                            function succeseCallBack(data) {
                                if (typeof data.response === 'undefined') return null;
                                var dataArray = [];
                                if (typeof options.showrelatednews !== 'undefined') {
                                    if (options.showrelatednews === false) {
                                        return
                                    }
                                }


                                //var template = '<div style="height:60px;"><a onclick="window.open(\'{link}\',\'_blank\');" style="color:white;position:relative;float:left;" target="_blank" href="{link}"><img style="width:65px;position:absolute;top:0px;" src="{img_src}" /><span style="padding:0px 5px 0 75px;display:inline-block;font-weight:600;font-size:0.85rem;line-height:1.1rem;">{title}</span></div>';
                                var template = '<div style="height:60px;"><a style="color:white;position:relative;float:left;" target="_blank" href="{link}"><img style="width:90px;position:absolute;top:0px;" src="{img_src}" /><span style="padding:0px 0px 0 100px;display:inline-block;font-weight:400;font-size:0.875rem;line-height:1.1rem;">{title}</span></div>';

                                var index = 0;
                                $.each(data.response, function(key, value) {
                                    index++;
                                });

                                dataArray.push('<div style="padding:5px 0 10px 0px;color:white;">Preberite na portalu rtvslo.si</div><a href="javascript:void(0);" onclick="this_is_very_long_global_function243534()" style="position: absolute;right: -8px;padding: 20px 20px 20px 40px;color: #eee;top: -21px;font-size: 1.3rem;cursor: pointer;">x</a>');

                                $.each(data.response, function(key, value) {
                                    //console.log(value);
                                    var divWidth = Math.floor(100 / index);

                                    var location = window.location.href.indexOf('beta.rtvslo.si') > -1 ? 'https://beta.rtvslo.si' : 'https://www.rtvslo.si';

                                    var link = location + value.link;
                                    var tmp1 = template.replace('{link}', link).replace('{link}', link).replace('{title}', value.title).replace('{img_src}', value.lead_image.image.fp1.replace('_fp1.jpg', '_fp-md.jpg')).replace('http://', 'https://').replace('{wproc}', divWidth);
                                    dataArray.push(tmp1);

                                });
                                template = dataArray.join('');
                                $related.append(template);
                                $('#related-news-popup').animate({
                                    width: '100%'
                                }, 500);
                                setTimeout(function() {
                                    $('#related-news-popup').hide();
                                }, 8000);

                                window.this_is_very_long_global_function243534 = function(e) {
                                    if (e) {
                                        e.stopImmediatePropagation();
                                        e.stopPropagation()
                                        e.preventDefault();
                                    }
                                    $('#related-news-popup').hide();
                                }

                            }
                            $.ajaxSetup({xhrFields: { withCredentials: true } });
                            $.ajax({
                                type: 'GET',
                                url: urlgetItems,
                                contentType: "application/json",
                                dataType: 'jsonp',
                                success: function(json) {
                                    succeseCallBack(json);
                                },
                                error: function(e) {
                                    console.log(JSON.stringify(e));
                                }
                            });
                        }


                    }


                    $(document).keyup(function(e) {
                        if (e.keyCode === 27) {
                            //jwplayer("rtv4d_player").remove();
                            $('#rtv4d_popup').remove();
                            rtvdef.playerStatus = false;
                            $("object, embed").css({
                                "visibility": "visible"
                            });
                        }
                    });

                    if(NG_ENABLE && window.module__globalDrawerLists){
                        window.module__globalDrawerLists.init($right_menu, getAjax, '');
                    }
                    if(typeof placeholderSearch !== 'undefined') {
                        placeholderSearch(window.__globalPlayerCTX); 
                    }
                   

                } else {
                    //console.log(a.error);
                    closePlayerModal();
                }
            }
        } else {
            options.callback = function(a) {
                if (typeof a.error === 'undefined') {
                    if (a.response && a.response.title) {

                        $container.addClass('live');
                        //$content_second_row.addClass('live');

                        var $title = $("<div>", {
                            id: 'content_popup'
                        });
                        $title.css({

                        }).addClass('content');
                        $content_first_row.append($title);
                        $content_second_video_list.addClass('live');

                        //console.log('a.response.onair', a.response.onair)

                        if (a.response.onair) {
                            if (a.response.onair.current && a.response.onair.current.broadcast) {
                                var current = "Ni podatka";
                                if (a.response.onair.current.broadcast.title && typeof a.response.onair.current.broadcast.title === 'string' && a.response.onair.current.broadcast.title.length > 0) {
                                    current = a.response.onair.current.broadcast.title;
                                }else if(a.response.onair.current.broadcast.eptitle && typeof a.response.onair.current.broadcast.eptitle === 'string' && a.response.onair.current.broadcast.eptitle.length > 0) {
                                    current = a.response.onair.current.broadcast.eptitle;
                                }else if(a.response.onair.current.vsebina) {
                                    current = a.response.onair.current.vsebina;
                                }
                                
                                
                                $title.append('<div class="titleLink">' + current + '</div>');
                                if(action === 'vod') {
                                    $title.append('<div><a class="external_link" href="' + a.response.link + '" target="_blank">' + a.response.title + '</a></div>');
                                }
                                
                            }
                            if (a.response.onair.next) {

                                var title = a.response.onair.next.broadcast.title != '' ? a.response.onair.next.broadcast.title : a.response.onair.next.broadcast.eptitle;
                                $('#4d_show_name_tile').html('Sledi, ' + title + '.');
                                $('#4d_show_date').html('Začetek: ' + a.response.onair.next.ura);
                            }

                            if (a.response.onair.current && a.response.onair.current.broadcast && a.response.onair.current.broadcast.prog_synopsis) {
                                $title.append('<div id="show_description_txt">' + a.response.onair.current.broadcast.prog_synopsis + '</div>');
                            }

                        }

                       

                        $content_second_row.append($content_second_video_list);

                        var channelsNames = { 'tv.slo1': 'tvs1', 'tv.slo2': 'tvs3', 'tv.slo3': 'tvs3', 'tv.kp1': 'tvs1', 'tv.mb1': 'tvs1', 'tv.mmctv': 'tvs1' };

                        function getToday(offset) {

                            var currentDate = new Date();

                            if (offset != 0) {
                                currentDate.setDate(currentDate.getDate() + offset);
                            }
                            var day = currentDate.getDate()
                            var month = currentDate.getMonth() + 1
                            var year = currentDate.getFullYear()
                            return year + "-" + month + "-" + day;
                        }

                        function getStored(id, date) {
                            var url = 'https://api.rtvslo.si/spored/list/' + channelsNames[id] + '/' + date;

                            //console.log('url', url);
                            getAjax(url, function(data) {

                                if (data.response) {

                               

                                    var template = '<li style="padding-left:20px;">' +
                                        '<strong>{ura}</strong>' +
                                        '<a rel="nofollow" target="_blank" title="Ogled podrobnosti." href="https://4d.rtvslo.si/spored-4d/{channel}/{date}/{id}"><span> {vsebina}</span></a>' +
                                        '</li>';

                                    var template_block = '<li >' +
                                        '<strong>{ura}</strong>' +
                                        '<span> {vsebina}</span>' +
                                        '</li>';

                                    var list = [];
                                    data.response.map(function(itm) {
                                        var tmp = ''; 
                                            if (!itm.id) {
                                                tmpl = template_block;
                                                tmp = tmpl.replace('{ura}', itm.ura).replace('{vsebina}', itm.vsebina);
                                            } else {
                                                tmpl = template;
                                                tmp = tmpl.replace('{ura}', itm.ura).replace('{vsebina}', itm.vsebina).replace('{channel}', channelsNames[id]).replace('{date}', date).replace('{id}', itm.id);                     
                                                //console.log('tmp', tmp)
                                            }
                                            
                                            list.push(tmp);
                                        })
                                        //console.log('data.response',$content_second_video_list)
                                    $content_second_video_list.append(list.join(''));
                                }
                            });

                        }

                        getStored(a.response.id, getToday(0));




                    }
                } else {
                    //console.log(a.error);
                    closePlayerModal();
                }
            }
        }

        if (typeof options.autostart === 'undefined') {
            options.autostart = "true";
        }

        switch (action) {
            case "live":
                $("#rtv4d_player").playLive(id, options);
                break;
            case "vod":
                var isPopup = true;
                $("#rtv4d_player").playVod(id, options, false, isPopup);
                break;
        }
        return;
    }


    $.isPlayerOpen = function() {
        return rtvdef.playerStatus;
    }

    $.stats = function(c, id, data) {

        //console.log(c);
        //console.log(id);
        var current = 0;
        var sum = 0;
        var item = 0;
        var playlist = jwplayer(c).getPlaylist();

        /* calculate and store new sum */
        var cal = (function(old, n) {
            if (playlist.length === 1 || (jwplayer(c).getPlaylistIndex() === playlist.length - 1)) {
                if (old > n) {
                    sum += old - n;
                }
                if (n > old) {
                    sum += n - old;
                }
                if (sum >= 4) {
                    var s = Math.round(sum);
                    sum = 0;
                    cookie(id, s);
                }
            }
        });

        /* set cookie */
        var cookie = (function(id, s) {
            if (typeof id === 'undefined' || typeof s === 'undefined') {
                return false;
            }

            // hash$avaid-duration+avaid-duration+avaid-duration
            var isEnd = (id === false && s === false) ? true : false;
            if (isEnd === false) {
                id = parseInt(id);
                s = parseInt(s);
                if (isNaN(id) === true || isNaN(s) === true || id < 11 || s > 10) {
                    return false;
                }
            }
            var value = $.cookieApi("read", null, "rtv.statistic", 0);
            var hash = random();

            if (typeof value === 'undefined' || value === false || value.length < 1) {
                if (isEnd === true) {
                    return false;
                }
                var newline = [];
                newline[0] = id;
                newline[1] = s;
                var newcookie = [];
                newcookie[0] = random();
                newcookie[1] = newline.join("-");
                if (isEnd === false) {
                    $.cookieApi("set", (newcookie.join("$")), "rtv.statistic", 30);
                }
                return false;
            }

            var listOne = value.split("$");
            if (listOne.length > 0 && listOne[0].length == hash.length) {
                var newcookie = [];
                newcookie[0] = listOne[0];
                var newline = [];
                var inside = 0;
                if (typeof listOne[1] !== 'undefined') {
                    var listTwo = listOne[1].split("+");
                    if (listTwo.length > 0) {
                        for (i = 0; i < listTwo.length; i++) {
                            if (listTwo[i].length > 0) {
                                var listThree = listTwo[i].split("-");
                                if (listThree.length == 2) {
                                    listThree[0] = parseInt(listThree[0]);
                                    listThree[1] = parseInt(listThree[1]);
                                    if (isNaN(listThree[0]) === false && isNaN(listThree[1]) === false) {
                                        if (isEnd === true) {
                                            try {
                                                sendRequest(listOne[0], listThree[0], listThree[1]);
                                            } catch (e) {}
                                        } else {
                                            if (listThree[0] >= 10 && listThree[1] >= 60) {
                                                try {
                                                    sendRequest(listOne[0], listThree[0], listThree[1]);
                                                } catch (e) {}
                                            } else {
                                                if (listThree[0] == id) {
                                                    var current = (newline.length < 1) ? 0 : newline.length + 1;
                                                    newline[current] = [];
                                                    newline[current][0] = id;
                                                    newline[current][1] = listThree[1] + s;
                                                    inside += 1;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }

                if (inside === 0 && isEnd === false) {
                    var current = (newline.length < 1) ? 0 : newline.length + 1;
                    newline[current] = [];
                    newline[current][0] = id;
                    newline[current][1] = s;
                }

                if (newline.length > 0) {
                    var newitem = [];
                    for (i = 0; i < newline.length; i++) {
                        newitem[i] = newline[i].join("-");
                    }
                    newcookie[1] = newitem.join("+");
                }
                $.cookieApi("set", (newcookie.join("$")), "rtv.statistic", 30);
                return false;
            }

            $.cookieApi("set", "", "rtv.statistic", 30);
            return false;
        });

        /* send request to API */
        var sendRequest = (function(hash, id, duration) {
            var id = id + '';
            //console.log('sendRequest stats 1')
            if (typeof hash !== 'undefined' && id !== 'undefined' && id >= 10 && typeof duration !== 'undefined' && duration > 0) {
                var link = rtvdef.get_api_endpoint() + "stats/log/vod/" + id + "/" + hash + "/" + duration + "/?t=" + Math.floor(Math.random() * 1000);
                //console.log("link ", link);
                getAjaxStats(link);
            }
        });

        /* send request to API #2 */
        var sendRequestPlay = (function(id, hash) {
            //console.log('sendRequestPlay stats 2');
            var id = id + '';
            var app_id = getAppId();    
            if (id !== 'undefined' && id.length > 1) {
                var link = rtvdef.get_api_endpoint() + "stats/log/vodplay/" + id + "/" + hash + "/" + app_id + "/?t=" + Math.floor(Math.random() * 1000);
                getAjaxStats(link);
            }
        });

        

        /* send request to API #3 */
        var sendRequestCaptions = (function(id) {
            var id = id + '';
            //console.log('sendRequestCaptions stats');
            if (id !== 'undefined' && id.length > 1) {
                var link = rtvdef.get_api_endpoint() + "stats/log/vodcaptions/" + id + "/?t=" + Math.floor(Math.random() * 1000);
                getAjaxStats(link);
            }
        });

        /* get random string */
        var random = (function() {
            return (new Date()).getTime().toString() + (10000 + Math.floor(Math.random() * 89999)).toString();
        });

        /* event handlers */
        jwplayer(c).on('seek', function(i) {
            cal(current, i.position);
            current = i.offset;
        });

        jwplayer(c).on('all', function(i) {

            //Dont't remove this.
            if(i == 'play'){
                document.body.classList.add("mmcplayer-state-play");
            }
            if(i == 'stop'){
                document.body.classList.remove("mmcplayer-state-play");
            }
            if(i == 'pause'){
                document.body.classList.remove("mmcplayer-state-play");
            }
        });
        
        jwplayer(c).on('time', function(i) {
            //console.log('time',i);
            function isInt(n) {
                return n % 1 === 0;
            }
            if (isInt(i.position) === true) {
                //console.log(i.position);
                if (i.duration - i.position < 15 && i.duration > 10) {
                    if ($('#related-news-popup').length) {
                        $('#related-news-popup').show();
                    }
                }
                if (i.position % 60 === 0) {
                    //console.log('miniute timer...');
                }
            }

            if (rtvdef.offset > 0 && i.position === 0) {
                current = rtvdef.offset;
            } else {
                cal(current, i.position);
                current = i.position;
            }
        });

        var isPlayed = false;
        var isCaptions = false;

        /*
        jwplayer(c).on('error', function(err) {
            let that = this;
            errorHandler(err, null, that)

        });
        */

      
        jwplayer(c).on('pause', function(e) {// VOD ONLY!

            if (typeof data === 'undefined' || data === null) return;
            try {
                if (data.noAds === 1) return;
                if (data.showTypeId === 31) return;
                if (data.mediaType === 'audio') return;
                fetchLinearAdd(c, 'archive', data.showTypeId);
            } catch (e) {
                console.error('error', e);
            }              
        });

        

        jwplayer(c).on('play', function(i) {
            //HIDE VAST ADD IF SHOWN
            let vastAdd = '#' + c + '_vast';
            if(document.querySelector(vastAdd))document.querySelector(vastAdd).innerHTML = '';
               
            if (isPlayed === false) {
                try {
                    //$.cookieApi("set", "", "rtv.statistic", 30);
                    var rtv_statistic_vod = $.cookieApi("read", null, "rtv.statistic.vod_");
                    if(rtv_statistic_vod == false) {
                        rtv_statistic_vod =  Math.floor(Math.random() * 1000000);
                        $.cookieApi("set", rtv_statistic_vod, "rtv.statistic.vod_", 365);
                    }

                    
                    sendRequestPlay(id, rtv_statistic_vod);
                } catch (e) {}
                isPlayed = true;
            }
            if (item !== jwplayer(c).getPlaylistIndex()) {
                current = 0;
                if (rtvdef.offset > 0) {
                    current = rtvdef.offset;
                }
            }
            item = jwplayer(c).getPlaylistIndex();

            var captionsIndex = jwplayer(c).getCurrentCaptions();
            if (typeof captionsIndex !== 'undefined' && captionsIndex > 0 && isCaptions === false) {
                sendRequestCaptions(id);
                isCaptions = true;
            }
        });

        jwplayer(c).on('captionsChanged', function(track) {
            //console.log('captionsChanged');
            if (isCaptions === false && track && typeof track.track !== 'undefined' && track.track > 0) {
                sendRequestCaptions(id);
                isCaptions = true;
            }
        });

        jwplayer(c).on('complete', function(i) {

            //console.log("i ", i);
            if (playlist.length === 1 || (jwplayer(c).getPlaylistIndex() === playlist.length - 1)) {
                cal(current, jwplayer(c).getPosition());
                cookie(false, false);
            }
            if ($('#related-news-popup').length) {
                $('#related-news-popup').hide();
            }

            if(typeof _dispatchCustomEvent !== 'undefined') {
                _dispatchCustomEvent('EVENT_PLAYLIST_NEXT',1);
            }
        });



        $(window).on('adPlay', function() {
            /* send cookie data to API */
            cookie(false, false);
            return;
        });
    }

    var defaults = {
        width: '100%',
        //height: 560,
        autostart: "false",
        jwkey: "wMrsgIDs46HWntucdKHhTdb/wr/Yd1TQ0d7iig==",
        captions: null,
        controls: true,
        bitrate: null,
        image: null,
        playfile: null,
        playlistXML: null,
        clip: null,
        onair: "true",
        callback: null
    }

    var rtvdef = {
        url: {
            "api": 'https://api.rtvslo.si/',
            "static": 'https://img.rtvslo.si/_static/r666/rtv4d/',
            "api_dev": 'https://api.dev.rtvslo.si/',
        },
        get_api_endpoint: function($debug) {
            if ($debug) {
                return rtvdef.url.api_dev;
            }
            if (window.location.href.indexOf('dev.') > -1) {
                return rtvdef.url.api_dev;
            }
            return rtvdef.url.api;
        },
        ads: {
            "xml": PROTOCOL + "ads.rtvslo.si/delivery/fc.php?script=bannerTypeHtml:vastInlineBannerTypeHtml:vastInlineHtml&zones=pre-roll:0.0-0%3D[OPENXID]&nz=1&source=&r=[RANDOM]&block=1&format=vast&charset=UTF-8",
            "common": {
                "pre": "173",
                "post": "174"
            }
        },
        iprom: {
            'vast': 'https://core.iprom.net/vast?sitePath=["rtvslo","[SID]","[SSID]"]&zones=[[ZONE]]',
            'vast_safe': 'https://core.iprom.net/vast?sitePath=["rtvslo","[SID]"]&zones=[[ZONE]]',
        },
        get_arhiv_preroll: function(source, showID) {
            return rtvdef.get_iprom('arhiv', 'preroll', source, showID);
        },
        get_live_preroll: function(kanal) {
            return rtvdef.get_iprom('live', 'preroll', kanal);
        },
        get_arhiv_midroll: function(source, showID) {
            return rtvdef.get_iprom('arhiv', 'midroll', source, showID);
        },
        get_live_midroll: function(kanal) {
            return rtvdef.get_iprom('live', 'midroll', kanal);
        },
        get_arhiv_postroll: function(source, showID) {
            return rtvdef.get_iprom('arhiv', 'postroll', source, showID);
        },
        get_live_postroll: function(kanal) {
            return rtvdef.get_iprom('live', 'postroll', kanal);
        },
        get_live_linear: function(kanal) {
            return rtvdef.get_iprom('live', 'linear', kanal);
        },
        get_arhiv_linear: function(source) {
            return rtvdef.get_iprom('arhiv', 'linear', source);
        },
        get_iprom: function(type, zone_name, source, showID) {
            var random = Math.floor(Math.random() * 1000);
            var sid = 'safe';
            var zone = '34';
            if (zone_name === 'preroll') {
                zone = '34';
            } 
            else if (zone_name === 'midroll') {
                zone = '35';
            } 
            else if (zone_name === 'postroll') {
                zone = '36';
            }
            else if (zone_name === 'linear') {
                zone = '90';
            }

            //OVERIDE CC
            var value = $.cookieApi("read", null, "cc_advertising", 0);
            if (typeof value === 'undefined' || value !== 'yes') {
                //console.log('vast-safe', retVal);
                return rtvdef.iprom.vast_safe.replace('[SID]', sid).replace('[ZONE]', zone).replace('[RANDOM]', random);       
            }

            switch (type) {
                case 'live':
                    var sid = 'stirid_live';
                    var ssid = 'tv_slo_ena';
                    if (source === 'tv.slo1') {
                        ssid = 'tv_slo_ena';
                    } else if (source === 'tv.slo2') {
                        ssid = 'tv_slo_dve';
                    } else if (source === 'tv.slo3') {
                        ssid = 'tv_slo_tri';
                    } else if (source === 'tv.mb1') {
                        ssid = 'tv_maribor';
                    } else if (source === 'tv.kp1') {
                        ssid = 'tv_koper';
                    } else if (source === 'tv.mmctv' || source === 'tvmmc') {
                        ssid = 'mmc_tv';
                    } else if (source === 'tv.mmctv2' || source === 'tvmmc2') {
                        ssid = 'MMCTV2';
                    }
                    return rtvdef.iprom.vast.replace('[SID]', sid).replace('[SSID]', ssid).replace('[ZONE]', zone).replace('[RANDOM]', random);
                case 'arhiv':
                    var sid = 'stirid_arhiv';
                    var ssid = 'priporocamo';
            
                    if (source == 28) {
                        ssid = 'priporocamo';
                    } else if (source == 29) {
                        ssid = 'nedefiniran';
                    } else if (source == 30) {
                        ssid = 'kult_umetniski';
                    } else if (source == 32) {
                        ssid = 'verski';
                    } else if (source == 33) {
                        ssid = 'izobrazevalni';
                    } else if (source == 34) {
                        ssid = 'informativni';
                    } else if (source == 35) {
                        ssid = 'sportni';
                    } else if (source == 36) {
                        ssid = 'razvedrilni';
                    } else if (source == 6781958) {
                        ssid = 'iz_tv_arhiva';
                    } else if (source == 15890838) {
                        ssid = 'mladinski';
                    } else if (source == 15890839) {
                        ssid = 'parlamentarni';
                    } else if (source == 15890843) {
                        ssid = 'filmi';
                    }else if (source == 15890841) {
                        ssid = 'serije';
                    }else if (source == 15890840) {
                        ssid = 'dokumentarci';
                    }
                          
                    return rtvdef.iprom.vast.replace('[SID]', sid).replace('[SSID]', ssid).replace('[ZONE]', zone).replace('[RANDOM]', random);
            }
        },
        streamer: {
            "html5": PROTOCOL + "videoweb.rtvslo.si/ava_archive02/",
            "rtmp": "rtmp://stream.rtvslo.si/ava_archive02",
            "hls": STREAM_RTVSLO_SI_SERVER + "/ava_archive02/_definst_/",
            "fallback": "2013/08/23/mobilni-rtvslo.mp4",
            "octoshape": "swf/octoshape3.swf",
            "error": PROTOCOL + "videoweb.rtvslo.si/dummy_720p.mp4"
        },
        domains: [
            "rtvslo.si",
            "tvslo.si",
            "val202.si",
            "otroski.si"
        ],
        quality: {
            "auto": "Avtomati&#269;no",
            "2200000": "720p HD",
            "1200000": "480p",
            "800000": "360p",
            "350000": "216p",
            "192000": "192kbps"
        },
        preroll: {
            /*"live" : { "rtmp" : "preroll/open-info.mp4", "html5" : "preroll/info.m4v" },*/
            "31": {
                "rtmp": "preroll/otroci.mp4",
                "html5": "preroll/otroci.m4v"
            },
            "30": {
                "rtmp": "preroll/kultura.mp4",
                "html5": "preroll/kultura.m4v"
            },
            "32": {
                "rtmp": "preroll/religija.mp4",
                "html5": "preroll/religija.m4v"
            },
            "33": {
                "rtmp": "preroll/izobrazevanje.mp4",
                "html5": "preroll/izobrazevanje.m4v"
            },
            "34": {
                "rtmp": "preroll/info.mp4",
                "html5": "preroll/info.m4v"
            },
            "35": {
                "rtmp": "preroll/sport.mp4",
                "html5": "preroll/sport.m4v"
            },
            "36": {
                "rtmp": "preroll/zabava.mp4",
                "html5": "preroll/zabava.m4v"
            },
            "dummy": {
                "html5": "preroll/dummy_720p.mp4",
            }
        },
        logo: {
            "small": "img/rtv4dwatermark.png",
            "big": "img/rtv4dwatermark.png"
        },
        buttons: {
            "quality": true,
            "qualityButton": "img/settingsButton.png",
            "4d": "app/img/ico_rtv4d.ico"
        },
        stretching: "uniform",
        playerStatus: false,
        offset: 0
    }


    function addBottomToolbar(id, data, playerInstance) {

        if($("#" + playerInstance.id + '_toolbar').length){
            $("#" + playerInstance.id + '_toolbar').remove()
        }

        if(data && data.response && data.response.category && data.response.category === 'live'){
            return;
        }

        var $bootomToolbar = $("<div>", {
                id: (playerInstance.id + '_toolbar'),
                class: 'advanced_toolbar_actions'
        });

        
 

        var $bootomToolbarBtn1 = null;

        if (data && data.response && data.response.subtitles && Array.isArray(data.response.subtitles)) {

            $bootomToolbarBtn1 = $("<div>", {
                id: (id + '_toogleInteractive'),
                class: 'odprti_kop button-group',
                title: 'Prepis',
            }).html('<span class="mobile_icon">Prepis</span>')
            
            $bootomToolbarBtn1.on('click', function() {
                window._globalTtoogleInteractiveFunc();
            });

       }

        var $bootomToolbarBtn2 = $("<div>", {
            id: (id + '_copy'),
            class: 'copy button-group',
            title: lang.copy_link
        }).html('<span class="mobile_icon">' + lang.link+ '</span>').on('click', function() {
           

            var link = getShareUrlCtx(playerInstance, data);


            var title = '';
            var text = '';
            if(data && data.response && data.response.title && data.response.description){
                title = data.response.title;
                text = data.response.description;
            }

            if (navigator.share) {
                navigator.share({
                  title: title,
                  text: text,
                  url: link,
                }).then(function(){console.log('Successful share')}).catch(function(error){console.log('Error sharing', error)});
            }else{
                copyTextToClipboard(link);
            }
            
            //copyTextToClipboard(link);
            
        });

        //Priporoči
        $recommend = recommendItem(data);

        //$moje = myListIntemsInit(data);

        $moje = myListIntemsInitMoje(data);

        $bootomToolbar.append($recommend);

        $bootomToolbar.append($moje);

        $bootomToolbar.append($bootomToolbarBtn2);

        var title = 'Naroči se na podkast';
        if(lang && lang.podcast_subscribe){
            title = lang.podcast_subscribe;
        }


        if (data.response.podcast == 1) {
            var $bottomToolbarPodcastButton = $("<a>", {
                id: 'rss-button',
                class: 'button-group',
                title: title,
                target: '_blank',
                href: 'https://www.rtvslo.si/radio/podkast/' + data.response.stub + '/' + data.response.showId
            }).html('<span class="rss-icon">Podkast</span>');

           
            $bootomToolbar.append($bottomToolbarPodcastButton);

        }


        if ($bootomToolbarBtn1 !== null) {
            $bootomToolbar.append($bootomToolbarBtn1);
        }

        
        var $bootomToolbarBtn4 = null;
       

        if (data && data.response && data.response.signLanguage && data.response.signLanguage == '1') {

            var on = $.cookieApi("read", null, cookieSIGN_LANG, 365) ? $.cookieApi("read", null, cookieSIGN_LANG, 365) : false;

            var class_ = on == '1' ? 'sign-on' : 'sign-off';
            var text = 'Vklopi znakovni jezik';
            if(on == '1' ){
                text = 'Izklopi znakovni jezik';
            }

            $bootomToolbarBtn4 = $("<div>", {
                id: (id + '_toogleSignLang'),
                class: 'sign_lang button-group ' + class_,
                title: text,
            }).html('<span class="mobile_icon">Znakovni jezik</span>')
            
            $bootomToolbarBtn4.on('click', function() {

                toogleSingLanguage(data.response.id, function(id){
                       
                    var $player_container = "#" + playerInstance.id;

                    if(!$($player_container).length){
                        showToastMsg('Napaka pri preklopu na drugi vir.');
                        return;
                    }

                    playerInstance.stop();
                    playerInstance.remove();
                     
                    if($("#" + playerInstance.id + '_toolbar').length){
                        $("#" + playerInstance.id + '_toolbar').remove()
                    }

                    $($player_container).empty();                               
                  
                    $($player_container).playVod(id, {toolbar: true,client: API_CLIENT_ID, autostart: 'true', width:'100%', scale:'true', height: 540} , false, true);
                  
                   
                });
                
            });
        }
        if ($bootomToolbarBtn4 !== null) {
            $bootomToolbar.append($bootomToolbarBtn4);
        }
        
        function toogleSingLanguage(id, clb){
            var on = $.cookieApi("read", null, cookieSIGN_LANG, 365) ? $.cookieApi("read", null, cookieSIGN_LANG, 365) : false;

            if(on == '1'){
                $.cookieApi("set", "0", cookieSIGN_LANG, 365);
            }else{
                $.cookieApi("set", "1", cookieSIGN_LANG, 365);    
            }
            if(clb){
                clb(id);
            }
        }

        if ($("#content_popup").length) {
            $bootomToolbar.insertBefore($("#content_popup"));
        } 
        else {
            $bootomToolbar.insertAfter($("#" + id));
        }
    }

    //22.2.23 - portal dostopno
    //console.log('window.location.href', window.location.href);
    if(window.location.href.indexOf("dostopno") > -1) {
        //$.cookieApi("set", "1", cookieSIGN_LANG, 365);
        $.cookieApi("set", "1", cookieSOUND_DESCR, 365);
    }

}(jQuery, matchRecordingId));

function matchRecordingId(rec_url){
    if(typeof rec_url === 'string'){
        var regex = /^\d{9}/;      
        var id = rec_url.match(regex);
       
        if (id && id[0]) {
            return id[0];        
        } else {
            regex = /^\d{8}/;      
            id = rec_url.match(regex);
            if(id && id[0]){
                return id[0];    
            }
        } 
    }
    return false;
}

jQuery(document).ready(function($) {

    

    var API_CLIENT_ID = '82013fb3a531d5414f478747c1aca622';
    var link = window.location.href;
    link = link.replace('#modal','');
    var offset = null;
    if(link.indexOf('&t=') > -1) {
        var segments = link.split('&t=');
        link = segments[0];
        offset = parseInt(segments[1],10);   
    }

    if (link.indexOf('?4d=') > -1) {     
        var segments = link.split('?4d=');
        if (segments.length > 1) {
            var rec_url = segments[1];                   
            var recording_id = matchRecordingId(rec_url);
                
            if (recording_id !== false){
                if (offset === null) {
                    $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true' });//Dont push state1
                } else {
                    $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true', skip2s: offset});
                }
            }                               
        }
    } 

    if (link.indexOf('?rtv365=') > -1) {     
        var segments = link.split('?rtv365=');
        if (segments.length > 1) {
            var rec_url = segments[1];                   
            var recording_id = matchRecordingId(rec_url);
                
            if (recording_id !== false){
                if (offset === null) {
                    $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true' });//Dont push state1
                } else {
                    $.showPopup("vod", recording_id, {target: 'popup', client: API_CLIENT_ID, autostart: 'true', skip2s: offset});
                }
            }                               
        }
    } 



    $(".player").each(function(s) {
        
        var recordingData = $(this).data();

        if (typeof recordingData.options === 'undefined') {
            recordingData.options = {};
        }
        if (!recordingData.options['client']) {
            recordingData.options['client'] = API_CLIENT_ID;
        }
        if (recordingData.options["scale"] === "true") {
            recordingData.options["width"] = $(this).width();
            recordingData.options["height"] = Math.round((recordingData.options["width"] * 9) / 16);
        }

        if (typeof recordingData.clip !== 'undefined') {
            recordingData.options.clip = recordingData.clip;
        }
        if (typeof recordingData.options['image'] !== 'undefined' && recordingData.options['image'].length > 4) {
            var imglen = recordingData.options['image'].length;
            if (recordingData.options['image'].substring(imglen - 3) !== 'jpg' && recordingData.options['image'].substring(imglen - 4) !== 'jpeg' && recordingData.options['image'].substring(imglen - 3) !== 'gif' && recordingData.options['image'].substring(imglen - 3) !== 'png') {
                delete recordingData.options['image'];
            }
        }
        if (typeof recordingData.showrelatednews !== 'undefined') {
            recordingData.options['showrelatednews'] = recordingData.showrelatednews;
        }

        if (typeof recordingData.videonews !== 'undefined') {
            recordingData.options['videonews'] = recordingData.videonews;
        }

        if (typeof recordingData.target !== 'undefined') {
            recordingData.options['target'] = recordingData.target;
        }

        try {
            if (recordingData.target) {
                if (recordingData.target === "popup") {

                    //TODO _ REMOVE
                    /*
                    if (DEBUG_ENABLE) {
                        recordingData.options.autostart = "false";
                        $.showPopup("vod", recordingData.recording, recordingData.options);
                    }
                    */
                   
                     //TODO _ REMOVE
                     if (NG_ENABLE) {
                        recordingData.options.autostart = "false";
                        $.showPopup("vod", recordingData.recording, recordingData.options);
                    }

                    //$.showPopup('live', recordingData.channel, recordingData.options);
                    $(this).click(function(event) {
                        event.preventDefault();
                        event.stopImmediatePropagation();
                        recordingData.options.autostart = "true";
                        if (recordingData.channel) {
                            $.showPopup("live", recordingData.channel, recordingData.options);
                        }

                        if (recordingData.recording) {
                            $.showPopup("vod", recordingData.recording, recordingData.options);
                        }
                        return false;
                    });
                }

                if (recordingData.target.substring(0, 1) === "#") {
                    $(this).click(function(event) {
                        event.preventDefault();
                        event.stopImmediatePropagation();
                        recordingData.options.autostart = "true";
                        $(recordingData.target).empty();
                        if (recordingData.channel) {
                            $(recordingData.target).playLive(recordingData.channel, recordingData.options);
                        }

                        if (recordingData.recording) {
                            $(recordingData.target).playVod(recordingData.recording, recordingData.options);
                        }
                        return false;
                    });
                }
            } else {
                
                if (recordingData.channel) {
                    $(this).attr('id', "rtv4dplayer_live_" + s);
                    $(this).playLive(recordingData.channel, recordingData.options);
                }
                if (recordingData.recording) {
                    $(this).attr('id', "rtv4dplayer_vod_" + s);
                    $(this).playVod(recordingData.recording, recordingData.options);
                    if(recordingData.options && recordingData.options.render && recordingData.options.render === 'inline-audio-podcast-mobile'){
                        window._globalPodcastMobilePlayerID = "rtv4dplayer_vod_" + s
                    }
                }
                if (recordingData.showid) {
                    $(this).attr('id', "rtv4dplayer_vod_" + s);
                    $(this).playVod(recordingData.showid, recordingData.options, true);
                }
            }
        } catch (e) {
            console.log(e);
        }
    });
});</script>
</body>
</html>
