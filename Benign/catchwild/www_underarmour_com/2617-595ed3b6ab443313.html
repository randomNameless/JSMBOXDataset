<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2617-595ed3b6ab443313.html</title>
</head>
<body>

<script>
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2617],{15413:function(e,r,o){o.d(r,{d:function(){return t}});var a=o(2265);let l=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];function t(){let[e,r]=(0,a.useState)("other"),[o,t]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(void 0!==window.navigator){let{userAgent:e,maxTouchPoints:o}=navigator,a=!1;if("maxTouchPoints"in navigator)a=o>0;else{let r="undefined"!=typeof matchMedia&&matchMedia("(pointer:coarse)");a=r&&"(pointer:coarse)"===r.media?!!r.matches:"orientation"in window||/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(e)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(e)}t(a?"mobile":"desktop"),l.includes(e)||e.includes("Mac")&&"ontouchend"in document?r("ios"):e.match(/Android/)?r("android"):r("other")}},[]),{currentDevice:e,deviceType:o}}},2617:function(e,r,o){o.d(r,{mw:function(){return f}});var a=o(57437),l=o(12471),t=o(97545),i=o(75694),n=o(49899),s=o(2265),u=o(27509),d=o(15413),c=o(76548),y=o(42995),v=o(77504),p=o(8995),m=o(2240),w=o(51331),P=o(61909),g=o(37440);let b=(0,m.YR)("LoyaltyProvider"),h=(0,s.createContext)({loyaltyOperationLoading:!1,unenrolled:!1,createWalletPass:async()=>{throw Error("createWalletPass() not implemented. Please include LoyaltyProvider in your app.")},enroll:async()=>{throw Error("enroll() not implemented. Please include LoyaltyProvider in your app.")},getAvailableRewards:async()=>{throw Error("getAvailableRewards() not implemented. Please include LoyaltyProvider in your app.")},getRewardAssets:async()=>{throw Error("getRewardAssets() not implemented. Please include LoyaltyProvider in your app.")},getRewardProduct:async()=>{throw Error("getRewardProduct() not implemented. Please include LoyaltyProvider in your app.")},getRewardUrl:async()=>{throw Error("getRewardUrl() not implemented. Please include LoyaltyProvider in your app.")},getRewardsHistory:async()=>{throw Error("getRewardsHistory() not implemented. Please include LoyaltyProvider in your app.")},isEligible:async()=>{throw Error("isEligible() not implemented. Please include LoyaltyProvider in your app.")},joinWaitlist:async()=>{throw Error("joinWaitlist() not implemented. Please include LoyaltyProvider in your app.")},redeemCoupon:async()=>{throw Error("redeemCoupon() not implemented. Please include LoyaltyProvider in your app.")},redeemReward:async()=>{throw Error("redeemReward() not implemented. Please include LoyaltyProvider in your app.")},refresh:async()=>{throw Error("refresh() not implemented. Please include LoyaltyProvider in your app.")},unenroll:async()=>{throw Error("unenroll() not implemented. Please include LoyaltyProvider in your app.")}});function f(){return(0,s.useContext)(h)}r.ZP=function(e){let{children:r}=e,{analyticsManager:o}=(0,u.z)(),m=(0,l.x)(),{cart:f,redeemReward:E}=(0,c.jD)(),{deviceType:L}=(0,d.d)(),{user:C,refresh:R}=(0,y.k)(),[k,D]=(0,s.useState)(),[S,M]=(0,s.useState)(!1),[I,A]=(0,s.useState)(!1),[N,W]=(0,s.useState)(),[T,{loading:U,error:x}]=(0,t.t)(v.z2b,{fetchPolicy:"no-cache",onError(e){b.error({error:e},"getAvailableRewardsQuery")}}),[Q,{loading:O,error:j}]=(0,t.t)(v.FQb,{onError(e){b.error({error:e},"getCategoryPageQuery")}}),[B,{loading:z,error:G}]=(0,t.t)(v.JdM,{onError(e){b.error({error:e},"getAvailableRewardsQuery")}}),[_,{loading:F,error:H}]=(0,t.t)(v.CWV,{fetchPolicy:"no-cache",onError(e){b.error({error:e},"getLoyaltyPointsQuery")}}),[Y,{loading:Z,error:$}]=(0,t.t)(v.mLl,{fetchPolicy:"no-cache",onError(e){b.error({error:e},"isEligibleQuery")}}),[K,{loading:q,error:J}]=(0,t.t)(v.tvP,{fetchPolicy:"no-cache",onError(e){b.error({error:e},"getLoyaltyCartDataQuery")}}),[V,{loading:X,error:ee}]=(0,t.t)(v.Qtt,{fetchPolicy:"no-cache",onError(e){b.error({error:e},"rewardsHistoryQuery")}}),[er,{loading:eo,error:ea}]=(0,i.D)(v.r03,{errorPolicy:"none",onError(e){b.error({error:e},"enrollMutation")}}),[el,{loading:et,error:ei}]=(0,i.D)(v.qTv,{errorPolicy:"none",onError(e){b.error({error:e},"generateWalletPassMutation")}}),[en,{loading:es,error:eu}]=(0,i.D)(v.Ady,{errorPolicy:"none",onError(e){b.error({error:e},"joinWaitlistMutation")}}),[ed,{loading:ec,error:ey}]=(0,i.D)(v.HC,{errorPolicy:"none",onError(e){b.error({error:e},"redeemCouponMutation")}}),[ev,{loading:ep,error:em}]=(0,i.D)(v.$oX,{errorPolicy:"none",onError(e){b.error({error:e},"unenrollMutation")}}),ew=(0,s.useCallback)(async()=>{if(null==C?void 0:C.isLoyalty){let{data:e}=await _();void 0!==(null==e?void 0:e.getLoyaltyPointsData.loyaltyPointsBalance)&&W(r=>{var o;return{claimedRewards:null==r?void 0:r.claimedRewards,customerPoints:e.getLoyaltyPointsData.loyaltyPointsBalance,rewardGroups:null!==(o=null==r?void 0:r.rewardGroups)&&void 0!==o?o:[]}})}},[C,_]),eP=(0,s.useCallback)(async e=>{let{platform:r}=e,{data:o}=await el({variables:{platform:r}});return null==o?void 0:o.generateUacfIdWalletPass},[el]),eg=(0,s.useCallback)(async e=>{var r,a,l,t,i,s;let{readonlySearchParams:u,session:d,source:c}=e,{channel:y,subChannel:m,subChannelDetail:w}=n.parse(u.toString()),P=await er({variables:{input:{channel:v.vzK[(0,g.YZ)(y)]||v.vzK.WEB,subChannel:(0,g.YZ)(m)||L,subChannelDetail:(0,g.YZ)(w)||o.getExternalCampaignData().external_campaign_id||(0,p.uF)(c)}},...d&&{context:{headers:{authorization:"Bearer ".concat(null==d?void 0:null===(r=d.uacapi)||void 0===r?void 0:r.accessToken)}}}}),h=null!==(s=null===(l=P.data)||void 0===l?void 0:null===(a=l.enrollCustomerIntoLoyalty.loyalty)||void 0===a?void 0:a.status)&&void 0!==s?s:v.wcI.UNENROLLED;if(null===(t=P.data)||void 0===t?void 0:t.enrollCustomerIntoLoyalty.success){if(h===v.wcI.ENROLLED){o.fireLoyaltyAction({loyalty:{loyalty:!0,action:"subscribe",source:c}});let e=null!=d?d:null==C?void 0:C.session;(null==e?void 0:e.accountType)===v.$x3.REGISTERED&&await R(e)}return{status:h,success:!0}}return b.error(null===(i=P.data)||void 0===i?void 0:i.enrollCustomerIntoLoyalty.messages[0].message,"enroll() error"),{status:h,success:!1}},[o,L,C,er,R]),eb=(0,s.useCallback)(async e=>{var r;let{display:o,flows:a}=e,{data:l}=await T({variables:{customerNo:"",displayOnPages:o,rewardFlowTypes:a}});return null!==(r=null==l?void 0:l.availableRewardsToClaim.rewardGroups.filter(e=>!!e))&&void 0!==r?r:[]},[T]),eh=(0,s.useCallback)(async e=>{var r;let{reward:o,mapper:a}=e;if(!(null==o?void 0:o.ctaURL))return;let{data:l}=await B({variables:{ids:o.ctaURL}});return null==l?void 0:null===(r=l.contentAssets)||void 0===r?void 0:r.map(e=>{var r;return{...e,body:null!==(r=null==e?void 0:e.body)&&void 0!==r?r:void 0}}).map(a).filter(e=>!!e)},[B]),ef=(0,s.useCallback)(async e=>{let{reward:r}=e;if(null==r?void 0:r.productID)try{return await (0,w.jn)(m,r.productID)}catch(e){b.error({error:e},"getRewardProduct");return}},[m]),eE=(0,s.useCallback)(async e=>{var r,o;let{reward:a}=e;if(!(null==a?void 0:a.ctaURL))return;let{data:l}=await Q({variables:{id:a.ctaURL}});return null!==(o=null==l?void 0:null===(r=l.category)||void 0===r?void 0:r.url)&&void 0!==o?o:void 0},[Q]),eL=(0,s.useCallback)(async function(){var e;let{count:r,page:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{count:100,page:1},{data:a}=await V({variables:{customerNo:"",pageNumber:o,pageSize:r}});return null!==(e=null==a?void 0:a.getLoyaltyPointsData.loyaltyEvents)&&void 0!==e?e:[]},[V]),eC=(0,s.useCallback)(async e=>{var r;let{postal:o,region:a}=e,{data:l}=await Y({variables:{input:{postalCode:o,region:a}}});return null!==(r=null==l?void 0:l.checkEligibilityForLoyalty.eligible)&&void 0!==r&&r},[Y]),eR=(0,s.useCallback)(async e=>{let{email:r,postal:o}=e,{data:a}=await en({variables:{input:{email:r,postalCode:o}}});return(null==a?void 0:a.joinLoyaltyWaitList.status)===v.m5h.SUCCESS},[en]),ek=(0,s.useCallback)(async e=>{let{id:r}=e;if(null==C?void 0:C.isLoyalty){var o;if(null===(o=(await ed({variables:{LoyaltyClaimDiscountCouponInput:{rewardId:r}}})).data)||void 0===o?void 0:o.claimDiscountCouponWithRewardPoints.success)return await ew(),!0}return!1},[C,ed,ew]),eD=(0,s.useCallback)(async e=>{if(null==C?void 0:C.isLoyalty){D(void 0),M(!0);let o=await E(e);if(o.success)await ew();else{var r;D(null===(r=o.errors.find(e=>e.error))||void 0===r?void 0:r.error)}return M(!1),o.success}return!1},[C,E,ew]),eS=(0,s.useCallback)(async e=>{let r,{claimed:{filter:o,status:a},display:l,flow:t}=e,{data:i}=await K({variables:{customerNo:"",displayOnPages:l,loyaltyClaimedRewardsInput:{customerNo:"",filterParam:a,filterType:o},rewardFlowTypes:t}});if(i){var n,s;let e=null!==(s=null==f?void 0:null===(n=f.couponItems)||void 0===n?void 0:n.map(e=>e.code))&&void 0!==s?s:[];W(r={claimedRewards:i.claimedRewards.coupon.filter(e=>!!e).filter(r=>e.includes(r.code)),customerPoints:i.getLoyaltyPointsData.loyaltyPointsBalance,rewardGroups:i.availableRewardsToClaim.rewardGroups.filter(e=>!!e)})}return r},[f,K]),eM=(0,s.useCallback)(async()=>{if((null==C?void 0:C.isLoyalty)&&(await ev({variables:{input:{customerNo:""}}})).data){o.fireLoyaltyAction({loyalty:{loyalty:!0,action:"unsubscribe",source:P.$.ECOMMUNENROLLREWARDS}});let e=null==C?void 0:C.session;return e&&await R(e),A(!0),!0}return!1},[o,C,ev,R]);(0,s.useEffect)(()=>{ew()},[C,ew]);let eI=(0,s.useMemo)(()=>ea||ei||x||j||G||J||H||$||eu||ey||k||ee||em,[ea,ei,x,j,G,J,H,$,eu,ey,k,ee,em]),eA=(0,s.useMemo)(()=>eo||et||U||O||z||q||F||Z||es||ec||S||X||ep,[eo,et,U,z,O,q,F,Z,es,ec,S,X,ep]),eN=(0,s.useMemo)(()=>({loyalty:N,loyaltyOperationError:eI,loyaltyOperationLoading:eA,createWalletPass:eP,enroll:eg,getAvailableRewards:eb,getRewardAssets:eh,getRewardProduct:ef,getRewardUrl:eE,getRewardsHistory:eL,isEligible:eC,joinWaitlist:eR,redeemCoupon:ek,redeemReward:eD,refresh:eS,unenroll:eM,unenrolled:I}),[N,eI,eA,eP,eg,eb,eh,ef,eE,eL,eC,eR,ek,eD,eS,eM,I]);return(0,a.jsx)(h.Provider,{value:eN,children:r})}}}]);
</script>

</body>
</html>
