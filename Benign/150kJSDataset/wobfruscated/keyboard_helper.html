<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>keyboard_helper.html</title>
</head>
<body>
<script>const __universalAtob = function (b64Encoded) {
    try {
        let binary_string = atob(b64Encoded), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(b64Encoded, 'base64'));
    }
};
const __forWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAABfwKkgICAAAMDZW52BHRlc3QAAQNlbnYGdXBkYXRlAAADZW52BGJvZHkAAAOCgICAAAEABISAgIAAAXAAAAWDgICAAAEAAQeRgICAAAIGbWVtb3J5AgAEZGF0YQADCpmAgIAAAZOAgIAAAAJAA0AQAEUNARACEAEMAAsLCw==';
const __forWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__forWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__forWasmBuffer, 'base64'));
    }
})());
const __ifWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAF/AAKfgICAAAIDZW52CGltcEZ1bmMxAAADZW52CGltcEZ1bmMyAAADgoCAgAABAQSEgICAAAFwAAAFg4CAgAABAAEHkYCAgAACBm1lbW9yeQIABGRhdGEAAgqSgICAAAGMgICAAAAgAARAEAAFEAELCw==';
const __ifWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__ifWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__ifWasmBuffer, 'base64'));
    }
})());
const __callWasmBuffer = 'AGFzbQEAAAABhICAgAABYAAAAo+AgIAAAQNlbnYHaW1wRnVuYwAAA4KAgIAAAQAEhICAgAABcAAABYOAgIAAAQABB5GAgIAAAgZtZW1vcnkCAARkYXRhAAEKioCAgAABhICAgAAAEAAL';
const __callWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__callWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__callWasmBuffer, 'base64'));
    }
})());
const __wasmStringModules = ['AGFzbQEAAAAFg4CAgAABAAEG0YGAgAAkfwBBAQt/AEEQC38AQRYLfwBBHAt/AEEkC38AQS4LfwBBNgt/AEE+C38AQcgAC38AQdIAC38AQYoBC38AQZIBC38AQaYBC38AQaoBC38AQa4BC38AQdABC38AQdYBC38AQdwBC38AQYoCC38AQagCC38AQcgCC38AQc4CC38AQeoCC38AQYYDC38AQYwDC38AQagDC38AQa4DC38AQbQDC38AQbwDC38AQcQDC38AQc4DC38AQewDC38AQfYDC38AQYAEC38AQYoEC38AQZQECwfEgoCAACUGbWVtb3J5AgAFZGF0YTADAAVkYXRhMQMBBWRhdGEyAwIFZGF0YTMDAwVkYXRhNAMEBWRhdGE1AwUFZGF0YTYDBgVkYXRhNwMHBWRhdGE4AwgFZGF0YTkDCQZkYXRhMTADCgZkYXRhMTEDCwZkYXRhMTIDDAZkYXRhMTMDDQZkYXRhMTQDDgZkYXRhMTUDDwZkYXRhMTYDEAZkYXRhMTcDEQZkYXRhMTgDEgZkYXRhMTkDEwZkYXRhMjADFAZkYXRhMjEDFQZkYXRhMjIDFgZkYXRhMjMDFwZkYXRhMjQDGAZkYXRhMjUDGQZkYXRhMjYDGgZkYXRhMjcDGwZkYXRhMjgDHAZkYXRhMjkDHQZkYXRhMzADHgZkYXRhMzEDHwZkYXRhMzIDIAZkYXRhMzMDIQZkYXRhMzQDIgZkYXRhMzUDIwvehYCAACQAQQELDXVzZSUyMHN0cmljdAAAQRALBXRleHQAAEEWCwR1cmwAAEEcCwZlbWFpbAAAQSQLCXBhc3N3b3JkAABBLgsHbnVtYmVyAABBNgsHb3B0aW9uAABBPgsIc3ItQ3lybAAAQcgACwhzci1MYXRuAABB0gALNmFwcCUzQSUyRiUyRmtleWJvYXJkLmdhaWFtb2JpbGUub3JnJTJGbWFuaWZlc3Qud2ViYXBwAABBigELB3N0cmluZwAAQZIBCxMlMkZtYW5pZmVzdC53ZWJhcHAAAEGmAQsDZW4AAEGqAQsDZW4AAEGuAQshRmFpbGVkJTIwdG8lMjBmZXRjaCUyMGZpbGUlM0ElMjAAAEHQAQsER0VUAABB1gELBWpzb24AAEHcAQstRXhjZXB0aW9uJTIwaW4lMjBtb3pTZXR0aW5ncy5jcmVhdGVMb2NrKCklM0EAAEGKAgscJTBBVXNpbmclMjBkZWZhdWx0JTIwdmFsdWVzAABBqAILH0V4Y2VwdGlvbiUyMHF1ZXJ5aW5nJTIwc2V0dGluZwAAQcgCCwQlM0EAAEHOAgsbJTBBVXNpbmclMjBkZWZhdWx0JTIwdmFsdWUAAEHqAgsbRXJyb3IlMjBxdWVyeWluZyUyMHNldHRpbmcAAEGGAwsEJTNBAABBjAMLGmFwcGxpY2F0aW9uaW5zdGFsbHN1Y2Nlc3MAAEGoAwsFdGV4dAAAQa4DCwR1cmwAAEG0AwsHbnVtYmVyAABBvAMLBmNhdGNoAABBxAMLCWZ1bmN0aW9uAABBzgMLHGRpZCUyMG5vdCUyMGRlY2xhcmUlMjB0eXBlLgAAQewDCwhkZWZhdWx0AABB9gMLCGRlZmF1bHQAAEGABAsIZGVmYXVsdAAAQYoECwlmdW5jdGlvbgAAQZQECy4lMkZzaGFyZWQlMkZyZXNvdXJjZXMlMkZrZXlib2FyZF9sYXlvdXRzLmpzb24A'].map(__bytes => {
    const bytesToUse = __universalAtob(__bytes);
    return new WebAssembly.Instance(new WebAssembly.Module(bytesToUse));
});
const lS = (wI, pos, iWC) => {
    let __str = '';
    if (!Array.isArray(wI)) {
        let __targetModule = __wasmStringModules[wI];
        let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
        const __stringKey = `data${ pos }`;
        let __start = __targetModule.exports[__stringKey] - 1;
        let __str = '';
        let i = __start;
        let __c = __mem[i++];
        while (!(parseInt(__c) & 128) && __mem[i]) {
            __str += __c;
            __c = String.fromCharCode(__mem[i++]);
        }
        __str += __c;
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    } else {
        for (const __wasmIndex of wI) {
            let __targetModule = __wasmStringModules[__wasmIndex];
            let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
            const __stringKey = `data${ pos }`;
            let __start = __targetModule.exports[__stringKey] - 1;
            let i = __start;
            let __c = __mem[i++];
            while (!(parseInt(__c) & 128) && __mem[i]) {
                __str += __c;
                __c = String.fromCharCode(__mem[i++]);
            }
            __str += __c;
        }
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    }
};
lS(0, 0);
(() => {
    const __callInstance77 = new WebAssembly.Instance(__callWasmModule, {
        env: {
            impFunc: () => {
                (function (exports) {
                    var BASE_TYPES = new Set([
                        lS(0, 1),
                        lS(0, 2),
                        lS(0, 3),
                        lS(0, 4),
                        lS(0, 5),
                        lS(0, 6)
                    ]);
                    var SETTINGS_KEYS = {
                        ENABLED: 'keyboard.enabled-layouts',
                        DEFAULT: 'keyboard.default-layouts'
                    };
                    var DEPRECATE_KEYBOARD_SETTINGS = {
                        en: 'keyboard.layouts.english',
                        'en-Dvorak': 'keyboard.layouts.dvorak',
                        cs: 'keyboard.layouts.czech',
                        fr: 'keyboard.layouts.french',
                        de: 'keyboard.layouts.german',
                        hu: 'keyboard.layouts.hungarian',
                        nb: 'keyboard.layouts.norwegian',
                        my: 'keyboard.layouts.myanmar',
                        sl: 'keyboard.layouts.slovak',
                        tr: 'keyboard.layouts.turkish',
                        ro: 'keyboard.layouts.romanian',
                        ru: 'keyboard.layouts.russian',
                        ar: 'keyboard.layouts.arabic',
                        he: 'keyboard.layouts.hebrew',
                        'zh-Hant-Zhuyin': 'keyboard.layouts.zhuyin',
                        'zh-Hans-Pinyin': 'keyboard.layouts.pinyin',
                        el: 'keyboard.layouts.greek',
                        'jp-kanji': 'keyboard.layouts.japanese',
                        pl: 'keyboard.layouts.polish',
                        'pt-BR': 'keyboard.layouts.portuguese',
                        sr: 'keyboard.layouts.serbian',
                        es: 'keyboard.layouts.spanish',
                        ca: 'keyboard.layouts.catalan'
                    };
                    var MULTI_LAYOUT_MAP = {
                        sr: [
                            lS(0, 7),
                            lS(0, 8)
                        ]
                    };
                    var defaultKeyboardManifestURL = lS(0, 9);
                    var currentSettings = { defaultLayouts: {} };
                    currentSettings.defaultLayouts[defaultKeyboardManifestURL] = {
                        en: true,
                        number: true
                    };
                    currentSettings.enabledLayouts = map2dClone(currentSettings.defaultLayouts);
                    function map2dIs(manifestURL, layoutId) {
                        return !!(this[manifestURL] && this[manifestURL][layoutId]);
                    }
                    function map2dSet(manifestURL, layoutId) {
                        (() => {
                            const __ifInstance0 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            this[manifestURL] = {};
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance0.exports;
                            return __exports.data(!this[manifestURL] ? 1 : 0);
                        })();
                        this[manifestURL][layoutId] = true;
                    }
                    function map2dUnset(manifestURL, layoutId) {
                        if (!this[manifestURL]) {
                            return;
                        }
                        delete this[manifestURL][layoutId];
                        (() => {
                            const __ifInstance1 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            delete this[manifestURL];
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance1.exports;
                            return __exports.data(!Object.keys(this[manifestURL]).length ? 1 : 0);
                        })();
                    }
                    function map2dClone(obj) {
                        var result = {};
                        for (var key1 in obj) {
                            result[key1] = {};
                            for (var key2 in obj[key1]) {
                                result[key1][key2] = obj[key1][key2];
                            }
                        }
                        return result;
                    }
                    var watchQueries = [];
                    var defaultLayoutConfig;
                    function kh_updateWatchers(reason) {
                        (() => {
                            const __ifInstance2 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            (() => {
                                                const __callInstance76 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            KeyboardHelper.getApps(function withApps() {
                                                                (() => {
                                                                    const __callInstance75 = new WebAssembly.Instance(__callWasmModule, {
                                                                        env: {
                                                                            impFunc: () => {
                                                                                watchQueries.forEach(function eachWatchQuery(watch) {
                                                                                    (() => {
                                                                                        const __callInstance74 = new WebAssembly.Instance(__callWasmModule, {
                                                                                            env: {
                                                                                                impFunc: () => {
                                                                                                    KeyboardHelper.getLayouts(watch.query, function withLayouts(layouts) {
                                                                                                        (() => {
                                                                                                            const __callInstance73 = new WebAssembly.Instance(__callWasmModule, {
                                                                                                                env: {
                                                                                                                    impFunc: () => {
                                                                                                                        watch.callback(layouts, reason);
                                                                                                                    }
                                                                                                                }
                                                                                                            });
                                                                                                            const __exports = __callInstance73.exports;
                                                                                                            return __exports.data();
                                                                                                        })();
                                                                                                    });
                                                                                                }
                                                                                            }
                                                                                        });
                                                                                        const __exports = __callInstance74.exports;
                                                                                        return __exports.data();
                                                                                    })();
                                                                                });
                                                                            }
                                                                        }
                                                                    });
                                                                    const __exports = __callInstance75.exports;
                                                                    return __exports.data();
                                                                })();
                                                            });
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance76.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance2.exports;
                            return __exports.data(watchQueries.length ? 1 : 0);
                        })();
                    }
                    var waitingForSettings = [];
                    var loadedSettings = new Set();
                    function kh_loadedSetting(setting) {
                        (() => {
                            const __callInstance72 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        loadedSettings.add(setting);
                                    }
                                }
                            });
                            const __exports = __callInstance72.exports;
                            return __exports.data();
                        })();
                        (() => {
                            const __ifInstance3 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            (() => {
                                                const __callInstance71 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            waitingForSettings.forEach(function (callback) {
                                                                (() => {
                                                                    const __callInstance70 = new WebAssembly.Instance(__callWasmModule, {
                                                                        env: {
                                                                            impFunc: () => {
                                                                                callback();
                                                                            }
                                                                        }
                                                                    });
                                                                    const __exports = __callInstance70.exports;
                                                                    return __exports.data();
                                                                })();
                                                            });
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance71.exports;
                                                return __exports.data();
                                            })();
                                            waitingForSettings = [];
                                            (() => {
                                                const __callInstance69 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            kh_updateWatchers({ settings: true });
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance69.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance3.exports;
                            return __exports.data(loadedSettings.size >= Object.keys(SETTINGS_KEYS).length ? 1 : 0);
                        })();
                    }
                    function kh_withSettings(callback) {
                        (() => {
                            const __ifInstance4 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            (() => {
                                                const __callInstance68 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            callback();
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance68.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    },
                                    impFunc2: () => {
                                        {
                                            (() => {
                                                const __callInstance67 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            waitingForSettings.push(callback);
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance67.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    }
                                }
                            });
                            const __exports = __ifInstance4.exports;
                            return __exports.data(loadedSettings.size >= Object.keys(SETTINGS_KEYS).length ? 1 : 0);
                        })();
                    }
                    function kh_getSettings() {
                        loadedSettings = new Set();
                        var lock = window.navigator.mozSettings.createLock();
                        lock.get(SETTINGS_KEYS.DEFAULT).onsuccess = kh_parseDefault;
                        lock.get(SETTINGS_KEYS.ENABLED).onsuccess = kh_parseEnabled;
                    }
                    function kh_parseDefault() {
                        var value = this.result[SETTINGS_KEYS.DEFAULT];
                        (() => {
                            const __ifInstance5 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            currentSettings.defaultLayouts = value;
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance5.exports;
                            return __exports.data(value ? 1 : 0);
                        })();
                        (() => {
                            const __callInstance66 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        kh_loadedSetting(SETTINGS_KEYS.DEFAULT);
                                    }
                                }
                            });
                            const __exports = __callInstance66.exports;
                            return __exports.data();
                        })();
                    }
                    function kh_parseEnabled() {
                        var value = this.result[SETTINGS_KEYS.ENABLED];
                        var needsSave = false;
                        (() => {
                            const __ifInstance6 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            currentSettings.enabledLayouts = map2dClone(currentSettings.defaultLayouts);
                                            needsSave = true;
                                        }
                                    },
                                    impFunc2: () => {
                                        {
                                            var type = typeof value;
                                            (() => {
                                                const __ifInstance7 = new WebAssembly.Instance(__ifWasmModule, {
                                                    env: {
                                                        impFunc1: () => {
                                                            {
                                                                try {
                                                                    currentSettings.enabledLayouts = {};
                                                                    var oldSettings = JSON.parse(value);
                                                                    (() => {
                                                                        const __callInstance65 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    oldSettings.forEach(function (layout) {
                                                                                        (() => {
                                                                                            const __ifInstance8 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                env: {
                                                                                                    impFunc1: () => {
                                                                                                        {
                                                                                                            var manifestURL = layout.manifestURL;
                                                                                                            (() => {
                                                                                                                const __ifInstance9 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                                    env: {
                                                                                                                        impFunc1: () => {
                                                                                                                            manifestURL = layout.appOrigin + lS(0, 11);
                                                                                                                        },
                                                                                                                        impFunc2: () => {
                                                                                                                        }
                                                                                                                    }
                                                                                                                });
                                                                                                                const __exports = __ifInstance9.exports;
                                                                                                                return __exports.data(!manifestURL ? 1 : 0);
                                                                                                            })();
                                                                                                            (() => {
                                                                                                                const __callInstance64 = new WebAssembly.Instance(__callWasmModule, {
                                                                                                                    env: {
                                                                                                                        impFunc: () => {
                                                                                                                            map2dSet.call(currentSettings.enabledLayouts, manifestURL, layout.layoutId);
                                                                                                                        }
                                                                                                                    }
                                                                                                                });
                                                                                                                const __exports = __callInstance64.exports;
                                                                                                                return __exports.data();
                                                                                                            })();
                                                                                                        }
                                                                                                    },
                                                                                                    impFunc2: () => {
                                                                                                    }
                                                                                                }
                                                                                            });
                                                                                            const __exports = __ifInstance8.exports;
                                                                                            return __exports.data(layout.enabled ? 1 : 0);
                                                                                        })();
                                                                                    });
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance65.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                } catch (e) {
                                                                    currentSettings.enabledLayouts = map2dClone(currentSettings.defaultLayouts);
                                                                    needsSave = true;
                                                                }
                                                            }
                                                        },
                                                        impFunc2: () => {
                                                            {
                                                                currentSettings.enabledLayouts = value;
                                                            }
                                                        }
                                                    }
                                                });
                                                const __exports = __ifInstance7.exports;
                                                return __exports.data(type === lS(0, 10) ? 1 : 0);
                                            })();
                                        }
                                    }
                                }
                            });
                            const __exports = __ifInstance6.exports;
                            return __exports.data(!value ? 1 : 0);
                        })();
                        (() => {
                            const __callInstance63 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        kh_loadedSetting(SETTINGS_KEYS.ENABLED);
                                    }
                                }
                            });
                            const __exports = __callInstance63.exports;
                            return __exports.data();
                        })();
                        (() => {
                            const __ifInstance10 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            (() => {
                                                const __callInstance62 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            KeyboardHelper.saveToSettings();
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance62.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance10.exports;
                            return __exports.data(needsSave ? 1 : 0);
                        })();
                    }
                    function kh_migrateDeprecatedSettings(deprecatedSettings) {
                        var settingEntry = DEPRECATE_KEYBOARD_SETTINGS[lS(0, 12)];
                        if (deprecatedSettings[settingEntry] == undefined) {
                            return;
                        }
                        currentSettings.enabledLayouts[defaultKeyboardManifestURL] = { number: true };
                        var hasEnabledLayout = false;
                        for (var key in DEPRECATE_KEYBOARD_SETTINGS) {
                            settingEntry = DEPRECATE_KEYBOARD_SETTINGS[key];
                            (() => {
                                const __ifInstance11 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                hasEnabledLayout = true;
                                                (() => {
                                                    const __ifInstance12 = new WebAssembly.Instance(__ifWasmModule, {
                                                        env: {
                                                            impFunc1: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance61 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    MULTI_LAYOUT_MAP[key].forEach(function enableLayout(layoutId) {
                                                                                        (() => {
                                                                                            const __callInstance60 = new WebAssembly.Instance(__callWasmModule, {
                                                                                                env: {
                                                                                                    impFunc: () => {
                                                                                                        map2dSet.call(currentSettings.enabledLayouts, defaultKeyboardManifestURL, layoutId);
                                                                                                    }
                                                                                                }
                                                                                            });
                                                                                            const __exports = __callInstance60.exports;
                                                                                            return __exports.data();
                                                                                        })();
                                                                                    });
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance61.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            },
                                                            impFunc2: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance59 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    map2dSet.call(currentSettings.enabledLayouts, defaultKeyboardManifestURL, key);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance59.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    });
                                                    const __exports = __ifInstance12.exports;
                                                    return __exports.data(key in MULTI_LAYOUT_MAP ? 1 : 0);
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance11.exports;
                                return __exports.data(deprecatedSettings[settingEntry] ? 1 : 0);
                            })();
                        }
                        (() => {
                            const __ifInstance13 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            (() => {
                                                const __callInstance58 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            map2dSet.call(currentSettings.enabledLayouts, defaultKeyboardManifestURL, lS(0, 13));
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance58.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    },
                                    impFunc2: () => {
                                    }
                                }
                            });
                            const __exports = __ifInstance13.exports;
                            return __exports.data(!hasEnabledLayout ? 1 : 0);
                        })();
                        var deprecatedSettingsQuery = {};
                        for (var key in DEPRECATE_KEYBOARD_SETTINGS) {
                            settingEntry = DEPRECATE_KEYBOARD_SETTINGS[key];
                            deprecatedSettingsQuery[settingEntry] = null;
                        }
                        (() => {
                            const __callInstance57 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        window.navigator.mozSettings.createLock().set(deprecatedSettingsQuery);
                                    }
                                }
                            });
                            const __exports = __callInstance57.exports;
                            return __exports.data();
                        })();
                        (() => {
                            const __callInstance56 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        KeyboardHelper.saveToSettings();
                                    }
                                }
                            });
                            const __exports = __callInstance56.exports;
                            return __exports.data();
                        })();
                    }
                    function kh_loadJSON(href, callback) {
                        if (!callback)
                            return;
                        var xhr = new XMLHttpRequest();
                        xhr.onerror = function () {
                            (() => {
                                const __callInstance55 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            console.error(lS(0, 14) + href, xhr.statusText);
                                        }
                                    }
                                });
                                const __exports = __callInstance55.exports;
                                return __exports.data();
                            })();
                        };
                        xhr.onload = function () {
                            (() => {
                                const __callInstance54 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            callback(xhr.response);
                                        }
                                    }
                                });
                                const __exports = __callInstance54.exports;
                                return __exports.data();
                            })();
                        };
                        (() => {
                            const __callInstance53 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        xhr.open(lS(0, 15), href, true);
                                    }
                                }
                            });
                            const __exports = __callInstance53.exports;
                            return __exports.data();
                        })();
                        xhr.responseType = lS(0, 16);
                        (() => {
                            const __callInstance52 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        xhr.send();
                                    }
                                }
                            });
                            const __exports = __callInstance52.exports;
                            return __exports.data();
                        })();
                    }
                    function kh_getMultiSettings(settings, callback) {
                        var results = {};
                        try {
                            var lock = navigator.mozSettings.createLock();
                        } catch (e) {
                            (() => {
                                const __callInstance51 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            console.warn(lS(0, 17), e, lS(0, 18));
                                        }
                                    }
                                });
                                const __exports = __callInstance51.exports;
                                return __exports.data();
                            })();
                            for (var p in settings)
                                results[p] = settings[p];
                            (() => {
                                const __callInstance50 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            callback(results);
                                        }
                                    }
                                });
                                const __exports = __callInstance50.exports;
                                return __exports.data();
                            })();
                        }
                        var settingNames = Object.keys(settings);
                        var numSettings = settingNames.length;
                        var numResults = 0;
                        (() => {
                            var i = 0;
                            const __forInstance0 = new WebAssembly.Instance(__forWasmModule, {
                                env: {
                                    test: () => {
                                        return i < numSettings ? 1 : 0;
                                    },
                                    update: () => {
                                        i++;
                                    },
                                    body: () => {
                                        {
                                            (() => {
                                                const __callInstance49 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            requestSetting(settingNames[i]);
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance49.exports;
                                                return __exports.data();
                                            })();
                                        }
                                    }
                                }
                            });
                            const __exports = __forInstance0.exports;
                            return __exports.data();
                        })();
                        function requestSetting(name) {
                            try {
                                var request = lock.get(name);
                            } catch (e) {
                                (() => {
                                    const __callInstance48 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                console.warn(lS(0, 19), name, lS(0, 20), e, lS(0, 21));
                                            }
                                        }
                                    });
                                    const __exports = __callInstance48.exports;
                                    return __exports.data();
                                })();
                                (() => {
                                    const __callInstance47 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                recordResult(name, settings[name]);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance47.exports;
                                    return __exports.data();
                                })();
                                return;
                            }
                            request.onsuccess = function () {
                                var value = request.result[name];
                                (() => {
                                    const __ifInstance14 = new WebAssembly.Instance(__ifWasmModule, {
                                        env: {
                                            impFunc1: () => {
                                                {
                                                    value = settings[name];
                                                }
                                            },
                                            impFunc2: () => {
                                            }
                                        }
                                    });
                                    const __exports = __ifInstance14.exports;
                                    return __exports.data(value === undefined ? 1 : 0);
                                })();
                                (() => {
                                    const __callInstance46 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                recordResult(name, value);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance46.exports;
                                    return __exports.data();
                                })();
                            };
                            request.onerror = function (evt) {
                                (() => {
                                    const __callInstance45 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                console.warn(lS(0, 22), name, lS(0, 23), evt.error);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance45.exports;
                                    return __exports.data();
                                })();
                                (() => {
                                    const __callInstance44 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                recordResult(name, settings[name]);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance44.exports;
                                    return __exports.data();
                                })();
                            };
                        }
                        function recordResult(name, value) {
                            results[name] = value;
                            numResults++;
                            (() => {
                                const __ifInstance15 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                (() => {
                                                    const __callInstance43 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                callback(results);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance43.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance15.exports;
                                return __exports.data(numResults === numSettings ? 1 : 0);
                            })();
                        }
                    }
                    function KeyboardLayout(options) {
                        for (var key in options) {
                            this[key] = options[key];
                        }
                    }
                    (() => {
                        const __callInstance42 = new WebAssembly.Instance(__callWasmModule, {
                            env: {
                                impFunc: () => {
                                    Object.defineProperties(KeyboardLayout.prototype, {
                                        'default': {
                                            get: function kh_getLayoutIsDefault() {
                                                return map2dIs.call(currentSettings.defaultLayouts, this.app.manifestURL, this.layoutId);
                                            }
                                        },
                                        enabled: {
                                            get: function kh_getLayoutIsEnabled() {
                                                return map2dIs.call(currentSettings.enabledLayouts, this.app.manifestURL, this.layoutId);
                                            },
                                            set: function kh_setLayoutIsDefault(value) {
                                                var method = value ? map2dSet : map2dUnset;
                                                (() => {
                                                    const __callInstance41 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                method.call(currentSettings.enabledLayouts, this.app.manifestURL, this.layoutId);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance41.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        }
                                    });
                                }
                            }
                        });
                        const __exports = __callInstance42.exports;
                        return __exports.data();
                    })();
                    var kh_SettingsHelper = {};
                    (() => {
                        const __callInstance40 = new WebAssembly.Instance(__callWasmModule, {
                            env: {
                                impFunc: () => {
                                    Object.defineProperties(kh_SettingsHelper, {
                                        'default': {
                                            get: function () {
                                                return map2dClone(currentSettings.defaultLayouts);
                                            },
                                            set: function (value) {
                                                currentSettings.defaultLayouts = map2dClone(value);
                                            },
                                            enumerable: true
                                        },
                                        'enabled': {
                                            get: function () {
                                                return map2dClone(currentSettings.enabledLayouts);
                                            },
                                            set: function (value) {
                                                currentSettings.enabledLayouts = map2dClone(value);
                                            },
                                            enumerable: true
                                        }
                                    });
                                }
                            }
                        });
                        const __exports = __callInstance40.exports;
                        return __exports.data();
                    })();
                    var KeyboardHelper = exports.KeyboardHelper = {
                        settings: kh_SettingsHelper,
                        fallbackLayoutNames: { password: 'en' },
                        fallbackLayouts: {},
                        inputAppList: null,
                        init: function kh_init() {
                            watchQueries = [];
                            this.inputAppList = new InputAppList();
                            this.inputAppList.onupdate = kh_updateWatchers.bind(undefined, { apps: true });
                            (() => {
                                const __callInstance39 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.inputAppList.start();
                                        }
                                    }
                                });
                                const __exports = __callInstance39.exports;
                                return __exports.data();
                            })();
                            var settings = window.navigator.mozSettings;
                            (() => {
                                const __ifInstance16 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                (() => {
                                                    const __callInstance38 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                kh_getSettings();
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance38.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __callInstance37 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                settings.addObserver(SETTINGS_KEYS.ENABLED, kh_getSettings);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance37.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __callInstance36 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                settings.addObserver(SETTINGS_KEYS.DEFAULT, kh_getSettings);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance36.exports;
                                                    return __exports.data();
                                                })();
                                                var deprecatedSettingsQuery = {};
                                                for (var key in DEPRECATE_KEYBOARD_SETTINGS) {
                                                    var settingEntry = DEPRECATE_KEYBOARD_SETTINGS[key];
                                                    deprecatedSettingsQuery[settingEntry] = undefined;
                                                }
                                                (() => {
                                                    const __callInstance35 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                kh_getMultiSettings(deprecatedSettingsQuery, kh_migrateDeprecatedSettings);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance35.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance16.exports;
                                return __exports.data(settings ? 1 : 0);
                            })();
                            (() => {
                                const __callInstance34 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            window.addEventListener(lS(0, 24), this);
                                        }
                                    }
                                });
                                const __exports = __callInstance34.exports;
                                return __exports.data();
                            })();
                        },
                        handleEvent: function (event) {
                            (() => {
                                const __callInstance33 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            kh_updateWatchers({ apps: true });
                                        }
                                    }
                                });
                                const __exports = __callInstance33.exports;
                                return __exports.data();
                            })();
                        },
                        isKeyboardType: function kh_isKeyboardType(type) {
                            return BASE_TYPES.has(type);
                        },
                        setLayoutEnabled: function kh_setLayoutEnabled(manifestURL, layoutId, enabled) {
                            var method = enabled ? map2dSet : map2dUnset;
                            (() => {
                                const __callInstance32 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            method.call(currentSettings.enabledLayouts, manifestURL, layoutId);
                                        }
                                    }
                                });
                                const __exports = __callInstance32.exports;
                                return __exports.data();
                            })();
                        },
                        getLayoutEnabled: function kh_getLayoutEnabled(manifestURL, layoutId) {
                            return map2dIs.call(currentSettings.enabledLayouts, manifestURL, layoutId);
                        },
                        setLayoutIsDefault: function kh_setLayoutIsDefault(manifestURL, layoutId, enabled) {
                            var method = enabled ? map2dSet : map2dUnset;
                            (() => {
                                const __callInstance31 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            method.call(currentSettings.defaultLayouts, manifestURL, layoutId);
                                        }
                                    }
                                });
                                const __exports = __callInstance31.exports;
                                return __exports.data();
                            })();
                        },
                        getLayoutIsDefault: function kh_getLayoutIsDefault(manifestURL, layoutId) {
                            return map2dIs.call(currentSettings.defaultLayouts, manifestURL, layoutId);
                        },
                        checkDefaults: function kh_checkDefaults(callback) {
                            var layoutsEnabled = [];
                            var missingTypes = [];
                            (() => {
                                const __callInstance30 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            [
                                                lS(0, 25),
                                                lS(0, 26),
                                                lS(0, 27)
                                            ].forEach(function eachType(type) {
                                                var enabled;
                                                (() => {
                                                    const __callInstance29 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                this.getLayouts({
                                                                    type: type,
                                                                    enabled: true
                                                                }, function (layouts) {
                                                                    enabled = layouts.length;
                                                                });
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance29.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __ifInstance17 = new WebAssembly.Instance(__ifWasmModule, {
                                                        env: {
                                                            impFunc1: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance28 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    missingTypes.push(type);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance28.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                    (() => {
                                                                        const __callInstance27 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    this.getLayouts({
                                                                                        type: type,
                                                                                        'default': true
                                                                                    }, function (layouts) {
                                                                                        (() => {
                                                                                            const __ifInstance18 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                env: {
                                                                                                    impFunc1: () => {
                                                                                                        {
                                                                                                            layouts[0].enabled = true;
                                                                                                            (() => {
                                                                                                                const __callInstance26 = new WebAssembly.Instance(__callWasmModule, {
                                                                                                                    env: {
                                                                                                                        impFunc: () => {
                                                                                                                            layoutsEnabled.push(layouts[0]);
                                                                                                                        }
                                                                                                                    }
                                                                                                                });
                                                                                                                const __exports = __callInstance26.exports;
                                                                                                                return __exports.data();
                                                                                                            })();
                                                                                                        }
                                                                                                    },
                                                                                                    impFunc2: () => {
                                                                                                    }
                                                                                                }
                                                                                            });
                                                                                            const __exports = __ifInstance18.exports;
                                                                                            return __exports.data(layouts[0] ? 1 : 0);
                                                                                        })();
                                                                                    });
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance27.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            },
                                                            impFunc2: () => {
                                                            }
                                                        }
                                                    });
                                                    const __exports = __ifInstance17.exports;
                                                    return __exports.data(!enabled ? 1 : 0);
                                                })();
                                            }, this);
                                        }
                                    }
                                });
                                const __exports = __callInstance30.exports;
                                return __exports.data();
                            })();
                            (() => {
                                const __ifInstance19 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                (() => {
                                                    const __ifInstance20 = new WebAssembly.Instance(__ifWasmModule, {
                                                        env: {
                                                            impFunc1: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance25 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    callback(layoutsEnabled, missingTypes);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance25.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            },
                                                            impFunc2: () => {
                                                            }
                                                        }
                                                    });
                                                    const __exports = __ifInstance20.exports;
                                                    return __exports.data(callback ? 1 : 0);
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance19.exports;
                                return __exports.data(layoutsEnabled.length ? 1 : 0);
                            })();
                        },
                        saveToSettings: function ke_saveToSettings() {
                            var toSet = {};
                            toSet[SETTINGS_KEYS.ENABLED] = currentSettings.enabledLayouts;
                            toSet[SETTINGS_KEYS.DEFAULT] = currentSettings.defaultLayouts;
                            (() => {
                                const __callInstance24 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            window.navigator.mozSettings.createLock().set(toSet);
                                        }
                                    }
                                });
                                const __exports = __callInstance24.exports;
                                return __exports.data();
                            })();
                        },
                        getApps: function kh_getApps(callback) {
                            var cleanupSettings = function (inputApps) {
                                (() => {
                                    const __callInstance23 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                Object.keys(currentSettings.enabledLayouts).concat(Object.keys(currentSettings.defaultLayouts)).forEach(function (manifestURL) {
                                                    if (!inputApps.some(function (app) {
                                                            return app.manifestURL === manifestURL;
                                                        })) {
                                                        delete currentSettings.enabledLayouts[manifestURL];
                                                        delete currentSettings.defaultLayouts[manifestURL];
                                                    }
                                                });
                                            }
                                        }
                                    });
                                    const __exports = __callInstance23.exports;
                                    return __exports.data();
                                })();
                            };
                            if (this.inputAppList.ready) {
                                var inputApps = this.inputAppList.getListSync();
                                (() => {
                                    const __callInstance22 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                cleanupSettings(inputApps);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance22.exports;
                                    return __exports.data();
                                })();
                                (() => {
                                    const __callInstance21 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                callback(inputApps);
                                            }
                                        }
                                    });
                                    const __exports = __callInstance21.exports;
                                    return __exports.data();
                                })();
                                return;
                            }
                            (() => {
                                const __callInstance20 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.inputAppList.getList().then(function (inputApps) {
                                                (() => {
                                                    const __callInstance19 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                cleanupSettings(inputApps);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance19.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __callInstance18 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                callback(inputApps);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance18.exports;
                                                    return __exports.data();
                                                })();
                                            })[lS(0, 28)](function (e) {
                                                (() => {
                                                    const __callInstance17 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                console.error(e);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance17.exports;
                                                    return __exports.data();
                                                })();
                                            });
                                        }
                                    }
                                });
                                const __exports = __callInstance20.exports;
                                return __exports.data();
                            })();
                        },
                        getLayouts: function kh_getLayouts(options, callback) {
                            (() => {
                                const __ifInstance21 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                callback = options;
                                                options = {};
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance21.exports;
                                return __exports.data(typeof options === lS(0, 29) ? 1 : 0);
                            })();
                            function withApps(apps) {
                                var fallbackLayoutNames = {};
                                for (var group in this.fallbackLayoutNames) {
                                    fallbackLayoutNames[group] = this.fallbackLayoutNames[group];
                                }
                                this.fallbackLayouts = {};
                                var layouts = apps.reduce(function eachApp(result, app) {
                                    var manifest = new ManifestHelper(app.manifest);
                                    for (var layoutId in manifest.inputs) {
                                        var inputManifest = manifest.inputs[layoutId];
                                        if (!inputManifest.types) {
                                            (() => {
                                                const __callInstance16 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            console.warn(app.manifestURL, layoutId, lS(0, 30));
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance16.exports;
                                                return __exports.data();
                                            })();
                                            continue;
                                        }
                                        var layout = new KeyboardLayout({
                                            app: app,
                                            manifest: manifest,
                                            inputManifest: inputManifest,
                                            layoutId: layoutId
                                        });
                                        (() => {
                                            const __ifInstance22 = new WebAssembly.Instance(__ifWasmModule, {
                                                env: {
                                                    impFunc1: () => {
                                                        {
                                                            for (var group in fallbackLayoutNames) {
                                                                (() => {
                                                                    const __ifInstance23 = new WebAssembly.Instance(__ifWasmModule, {
                                                                        env: {
                                                                            impFunc1: () => {
                                                                                {
                                                                                    this.fallbackLayouts[group] = layout;
                                                                                    delete fallbackLayoutNames[group];
                                                                                }
                                                                            },
                                                                            impFunc2: () => {
                                                                            }
                                                                        }
                                                                    });
                                                                    const __exports = __ifInstance23.exports;
                                                                    return __exports.data(layoutId === fallbackLayoutNames[group] ? 1 : 0);
                                                                })();
                                                            }
                                                        }
                                                    },
                                                    impFunc2: () => {
                                                    }
                                                }
                                            });
                                            const __exports = __ifInstance22.exports;
                                            return __exports.data(app.manifestURL === defaultKeyboardManifestURL ? 1 : 0);
                                        })();
                                        if (options[lS(0, 31)] && !layout[lS(0, 32)]) {
                                            continue;
                                        }
                                        if (options.enabled && !layout.enabled) {
                                            continue;
                                        }
                                        if (options.type) {
                                            options.type = [].concat(options.type);
                                            if (!options.type.some(function (type) {
                                                    return inputManifest.types.indexOf(type) !== -1;
                                                })) {
                                                continue;
                                            }
                                        }
                                        (() => {
                                            const __callInstance15 = new WebAssembly.Instance(__callWasmModule, {
                                                env: {
                                                    impFunc: () => {
                                                        result.push(layout);
                                                    }
                                                }
                                            });
                                            const __exports = __callInstance15.exports;
                                            return __exports.data();
                                        })();
                                    }
                                    if (options[lS(0, 33)]) {
                                        (() => {
                                            const __callInstance14 = new WebAssembly.Instance(__callWasmModule, {
                                                env: {
                                                    impFunc: () => {
                                                        result.sort(function (a, b) {
                                                            return a.inputManifest.types.length - b.inputManifest.types.length;
                                                        });
                                                    }
                                                }
                                            });
                                            const __exports = __callInstance14.exports;
                                            return __exports.data();
                                        })();
                                    }
                                    return result;
                                }.bind(this), []);
                                (() => {
                                    const __callInstance13 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                kh_withSettings(callback.bind(null, layouts));
                                            }
                                        }
                                    });
                                    const __exports = __callInstance13.exports;
                                    return __exports.data();
                                })();
                            }
                            (() => {
                                const __callInstance12 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.getApps(withApps.bind(this));
                                        }
                                    }
                                });
                                const __exports = __callInstance12.exports;
                                return __exports.data();
                            })();
                        },
                        stopWatching: function () {
                            watchQueries = [];
                        },
                        watchLayouts: function (query, callback) {
                            (() => {
                                const __ifInstance24 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                callback = query;
                                                query = {};
                                            }
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance24.exports;
                                return __exports.data(typeof query === lS(0, 34) ? 1 : 0);
                            })();
                            var watch = {
                                query: query,
                                callback: callback
                            };
                            (() => {
                                const __callInstance11 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            watchQueries.push(watch);
                                        }
                                    }
                                });
                                const __exports = __callInstance11.exports;
                                return __exports.data();
                            })();
                            (() => {
                                const __callInstance10 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.getLayouts(query, function initialCall(layouts) {
                                                watch.layouts = layouts;
                                                (() => {
                                                    const __callInstance9 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                callback(layouts, {
                                                                    apps: true,
                                                                    settings: true
                                                                });
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance9.exports;
                                                    return __exports.data();
                                                })();
                                            });
                                        }
                                    }
                                });
                                const __exports = __callInstance10.exports;
                                return __exports.data();
                            })();
                        },
                        getDefaultLayoutConfig: function kh_getDefaultLayoutConfig(callback) {
                            if (!callback) {
                                return;
                            }
                            (() => {
                                const __ifInstance25 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            {
                                                (() => {
                                                    const __callInstance8 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                callback(defaultLayoutConfig);
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance8.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        },
                                        impFunc2: () => {
                                            {
                                                var KEYBOARDS = lS(0, 35);
                                                (() => {
                                                    const __callInstance7 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                kh_loadJSON(KEYBOARDS, function loadKeyboardLayouts(data) {
                                                                    (() => {
                                                                        const __ifInstance26 = new WebAssembly.Instance(__ifWasmModule, {
                                                                            env: {
                                                                                impFunc1: () => {
                                                                                    {
                                                                                        defaultLayoutConfig = data;
                                                                                        (() => {
                                                                                            const __callInstance6 = new WebAssembly.Instance(__callWasmModule, {
                                                                                                env: {
                                                                                                    impFunc: () => {
                                                                                                        callback(defaultLayoutConfig);
                                                                                                    }
                                                                                                }
                                                                                            });
                                                                                            const __exports = __callInstance6.exports;
                                                                                            return __exports.data();
                                                                                        })();
                                                                                    }
                                                                                },
                                                                                impFunc2: () => {
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __ifInstance26.exports;
                                                                        return __exports.data(data ? 1 : 0);
                                                                    })();
                                                                });
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance7.exports;
                                                    return __exports.data();
                                                })();
                                            }
                                        }
                                    }
                                });
                                const __exports = __ifInstance25.exports;
                                return __exports.data(defaultLayoutConfig ? 1 : 0);
                            })();
                        },
                        changeDefaultLayouts: function kh_changeDefaultLayouts(language, reset) {
                            (() => {
                                const __callInstance5 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.getDefaultLayoutConfig(function gotDefaultLayouts(keyboards) {
                                                var newKbLayouts = keyboards.layout[language];
                                                var kbManifestURL = defaultKeyboardManifestURL;
                                                currentSettings.defaultLayouts = {};
                                                var langIndependentLayouts = keyboards.langIndependentLayouts;
                                                (() => {
                                                    var i = langIndependentLayouts.length - 1;
                                                    const __forInstance1 = new WebAssembly.Instance(__forWasmModule, {
                                                        env: {
                                                            test: () => {
                                                                return i >= 0 ? 1 : 0;
                                                            },
                                                            update: () => {
                                                                i--;
                                                            },
                                                            body: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance4 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    this.setLayoutIsDefault(kbManifestURL, langIndependentLayouts[i].layoutId, true);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance4.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    });
                                                    const __exports = __forInstance1.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __ifInstance27 = new WebAssembly.Instance(__ifWasmModule, {
                                                        env: {
                                                            impFunc1: () => {
                                                                {
                                                                    currentSettings.enabledLayouts = map2dClone(currentSettings.defaultLayouts);
                                                                }
                                                            },
                                                            impFunc2: () => {
                                                            }
                                                        }
                                                    });
                                                    const __exports = __ifInstance27.exports;
                                                    return __exports.data(reset ? 1 : 0);
                                                })();
                                                (() => {
                                                    i = newKbLayouts.length - 1;
                                                    const __forInstance2 = new WebAssembly.Instance(__forWasmModule, {
                                                        env: {
                                                            test: () => {
                                                                return i >= 0 ? 1 : 0;
                                                            },
                                                            update: () => {
                                                                i--;
                                                            },
                                                            body: () => {
                                                                {
                                                                    (() => {
                                                                        const __callInstance3 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    this.setLayoutIsDefault(kbManifestURL, newKbLayouts[i].layoutId, true);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance3.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                    (() => {
                                                                        const __callInstance2 = new WebAssembly.Instance(__callWasmModule, {
                                                                            env: {
                                                                                impFunc: () => {
                                                                                    this.setLayoutEnabled(kbManifestURL, newKbLayouts[i].layoutId, true);
                                                                                }
                                                                            }
                                                                        });
                                                                        const __exports = __callInstance2.exports;
                                                                        return __exports.data();
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    });
                                                    const __exports = __forInstance2.exports;
                                                    return __exports.data();
                                                })();
                                                (() => {
                                                    const __callInstance1 = new WebAssembly.Instance(__callWasmModule, {
                                                        env: {
                                                            impFunc: () => {
                                                                this.saveToSettings();
                                                            }
                                                        }
                                                    });
                                                    const __exports = __callInstance1.exports;
                                                    return __exports.data();
                                                })();
                                            }.bind(this));
                                        }
                                    }
                                });
                                const __exports = __callInstance5.exports;
                                return __exports.data();
                            })();
                        }
                    };
                    (() => {
                        const __callInstance0 = new WebAssembly.Instance(__callWasmModule, {
                            env: {
                                impFunc: () => {
                                    KeyboardHelper.init();
                                }
                            }
                        });
                        const __exports = __callInstance0.exports;
                        return __exports.data();
                    })();
                }(window));
            }
        }
    });
    const __exports = __callInstance77.exports;
    return __exports.data();
})();</script>
</body>
</html>
