<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>middy-5.35.257.html</title>
</head>
<body>

<script>
(()=>{var t={9486:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Engagement=void 0;var s=e(7569);i.Engagement=s.default},7569:function(t,i,e){"use strict";var s=this&&this.__spreadArrays||function(){for(var t=0,i=0,e=arguments.length;i<e;i++)t+=arguments[i].length;var s=Array(t),n=0;for(i=0;i<e;i++)for(var r=arguments[i],o=0,h=r.length;o<h;o++,n++)s[n]=r[o];return s};Object.defineProperty(i,"__esModule",{value:!0});var n=e(3502),r=function(){function t(t){this._velocities=[],this._listeners=[],this._isSubscribed=!1,this._timeoffset=t||Date.now(),this._outOfFocusTime=0,this._hiddenTime=0,this._pageHeight=this.getPageHeight(),this._windowHeight=this.getWindowHeight(),this._lastScrollingDistance=this.getScrollingDistance(),this._maxScrollDepthPercentage=this.getMaxScrollDepth(),this._lastVelocityReportTime=Date.now()}return t.prototype.subscribe=function(){this._isSubscribed||(this._isSubscribed=!0,this.initScrollListener(),this.initVisibilityChangeListener(),this.initVelocityListener(),this.initResizeListener())},t.prototype.unsubscribe=function(){this._isSubscribed&&(this._listeners.forEach((function(t){window.removeEventListener(t.eventName,t.eventHandler)})),clearInterval(this._velocityInterval),this._listeners=[],this._isSubscribed=!1)},t.get=function(i){return t._instance||(t._instance=new t(i)),t._instance},t.prototype.getData=function(){return{max_depth_percentage:this._maxScrollDepthPercentage,screen_length:this.getScreenLength(),time_on_page:this.getTimeOnPage(),velocity_excluding_static_time:this.getAverageVelocity(n.VelocityType.EXCLUDE_STATIC_USER),velocity_including_static_time:this.getAverageVelocity(n.VelocityType.INCLUDE_STATIC_USER),page_load_time:this.getPageLoadTime()}},t.prototype.getPageLoadTime=function(){try{var t=window.performance.getEntriesByType("navigation")[0];if("complete"===document.readyState&&t&&t.loadEventEnd>0&&t.domContentLoadedEventStart>0)return Math.floor(Math.abs(t.loadEventEnd-t.domContentLoadedEventStart))}catch(t){}return-1},t.prototype.getScreenLength=function(){return window.screen.availHeight||window.screen.height},t.prototype.initResizeListener=function(){var t=this,i=function(){t._pageHeight=t.getPageHeight(),t._windowHeight=t.getWindowHeight()};this._listeners.push({eventName:"resize",eventHandler:i}),window.addEventListener("resize",i)},t.prototype.initScrollListener=function(){var t=this,i=this.throttle((function(){t._maxScrollDepthPercentage=t.getMaxScrollDepth()}),1e3);this._listeners.push({eventName:"scroll",eventHandler:i}),window.addEventListener("scroll",i)},t.prototype.initVisibilityChangeListener=function(){var t=this,i=function(){"hidden"===window.document.visibilityState?t._hiddenTime=Date.now():t._hiddenTime>0&&(t._outOfFocusTime=t._outOfFocusTime+(Date.now()-t._hiddenTime))};this._listeners.push({eventName:"visibilitychange",eventHandler:i}),window.addEventListener("visibilitychange",i)},t.prototype.initVelocityListener=function(){var t=this;this._velocityInterval||(this._velocityInterval=setInterval((function(){t._velocities.push(t.getMomentVelocity())}),1e3))},t.prototype.getMaxScrollDepth=function(){this._pageHeight=this.getPageHeight(),this._windowHeight=this.getWindowHeight();var t=this.getScrollDepthPercentages(),i=this._maxScrollDepthPercentage||0;return Math.max(i,t)},t.prototype.getScrollDepthPercentages=function(){var t=this.getScrollingDistance(),i=this._pageHeight;return Math.round(t/i*100)},t.prototype.getScrollingDistance=function(){return this.getPageYOffset()+this._windowHeight},t.prototype.getPageYOffset=function(){return window.pageYOffset||window.scrollY},t.prototype.getWindowHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},t.prototype.getPageHeight=function(){var t,i;return Math.floor(Math.max(null===(t=window.document.body)||void 0===t?void 0:t.scrollHeight,null===(i=window.document.body)||void 0===i?void 0:i.offsetHeight,window.document.documentElement.clientHeight,window.document.documentElement.scrollHeight,window.document.documentElement.offsetHeight))},t.prototype.getTimeOnPage=function(){var t=(Date.now()-this._timeoffset)/1e3,i=this._outOfFocusTime/1e3;return Number((t-i).toFixed(2))},t.prototype.getAverageVelocity=function(t){var i=s(this._velocities);t===n.VelocityType.EXCLUDE_STATIC_USER&&(i=i.filter(Number));var e=i.reduce((function(t,i){return t+i}),0);return i.length>0?e/i.length:-1},t.prototype.getMomentVelocity=function(){var t=Date.now(),i=this.getScrollingDistance()-this._lastScrollingDistance,e=(t-this._lastVelocityReportTime)/1e3;return this._lastVelocityReportTime=t,this._lastScrollingDistance=this.getScrollingDistance(),!i?0:Math.round(Math.abs(i/e))},t.prototype.getTitlesText=function(){var t=[];return document.querySelectorAll("h1").forEach((function(i){t.push(i.innerText.trim().replace(/_/g,"-"))})),t.length?t.join("_"):void 0},t.prototype.getDescriptionText=function(){var t=[];return document.querySelectorAll("meta[name='description'],meta[property='og:description']").forEach((function(i){t.push(i.content.trim().replace(/_/g,"-"))})),t.length?t.join("_"):void 0},t.prototype.throttle=function(t,i){var e=Date.now();return function(){e+i-Date.now()<0&&(t(),e=Date.now())}},t}();i.default=r},3502:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VelocityType=void 0,function(t){t.EXCLUDE_STATIC_USER="exclude_static_user",t.INCLUDE_STATIC_USER="include_static_user"}(i.VelocityType||(i.VelocityType={}))},3301:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebVitals=void 0;var s=e(6340);Object.defineProperty(i,"WebVitals",{enumerable:!0,get:function(){return s.WebVitals}})},6340:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.WebVitals=void 0;var e=function(){function t(t,i){this.webVitalsData={pv:t,url:i}}return t.prototype.getData=function(){return this.webVitalsData},t.prototype.measure=function(){var t=this;this.getInstance().then((function(i){i.onLCP(t.collectWebVitals.bind(t)),i.onCLS(t.collectWebVitals.bind(t)),i.onINP(t.collectWebVitals.bind(t))}))},t.prototype.collectWebVitals=function(t){var i=this.prepareDataFields(t),e=i.name.toLowerCase();this.webVitalsData[e]=i.value},t.prototype.getInstance=function(){return new Promise((function(t){if(window.brw_webVitals)t(window.brw_webVitals);else{var i=document.createElement("script");i.src="//cdn.browsiprod.com/web-vitals/web-vitals-4.2.3.js",i.onload=function(){t(window.brw_webVitals)},document.head.appendChild(i)}}))},t.prototype.prepareDataFields=function(t){var i=t.name,e=t.value;return{name:i,value:e="number"==typeof e?+e.toFixed(3):e}},t}();i.WebVitals=e},3761:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(394);class n{static getNow(){return Date.now()}static isCacheTimeValid(t,i){return Date.now()-i<t}static isGlobalCacheActive(){return s.Profiler.get().cacheUtilsFunctions}static getCachedResult(t,i,e){if(!this.isGlobalCacheActive())return{valid:!1,result:null,reason:"cache is not active for this site"};const s=t,n=e?Object.assign(this.defConfigs,e):this.defConfigs;if(!n.active)return{valid:!1,result:null,reason:"function not active"};const r=s.browsiCache&&s.browsiCache[i];return r&&this.isCacheTimeValid(n.time,r.cacheTime)?{valid:!0,result:r.result}:{valid:!1,result:null,reason:"cache not found"}}static storeCache(t,i,e,s){const n=s?Object.assign(this.defConfigs,s):this.defConfigs;if(!this.isGlobalCacheActive()||!n.active)return;const r=t,o=r.browsiCache&&r.browsiCache[i];o&&o.result&&this.isCacheTimeValid(n.time,o.cacheTime)||(r.browsiCache=r.browsiCache||{},r.browsiCache[i]={result:e,cacheTime:this.getNow()})}}i.default=n,n.defConfigs={active:!0,time:100}},3610:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=class{constructor(t,i){this.child=t,this.parent=i||void 0}}},1250:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4730);i.default=class{constructor(t){if(this.loggerFallback=!1,this.name=t,this.active=window._middyo&&window._middyo.debug,this.logsToHide=window._middyo&&window._middyo.hideLogs||[],this.logsWhiteList=window._middyo&&window._middyo.logsWhiteList||[],this.active){let t=window.console;if(!t.hasOwnProperty("debug")||!t.hasOwnProperty("info")||!t.hasOwnProperty("log")){let t=document.createElement("iframe");t.width="0",t.height="0",t.frameBorder="0",document.body.appendChild(t);let i=t.contentWindow;["debug","info","log"].forEach((t=>window.console[t]=i&&i.console[t]))}}}hideLog(){return(this.logsToHide.indexOf(this.name)>-1||this.logsToHide.indexOf("*")>-1)&&-1==this.logsWhiteList.indexOf(this.name)}print(t,i){if(!this.active)return;if(this.hideLog())return;const e=window.console,s=[],n=t=>{let n=s.concat(i);if(this.loggerFallback)return this.loggerWithArguments(t,n);try{e[t].apply(e,n)}catch(i){return this.loggerFallback=!0,this.loggerWithArguments(t,n)}};switch(t){case 0:s.push(`%c[${this.name}]`,"color: gray;"),n("debug");break;case 1:s.push(`%c[${this.name}]`,"color: gray;"),n("info");break;case 2:s.push(`%c[!] [${this.name}]`,"color: red;"),n("error");break;case 3:n("table");break;case 4:n("log")}}loggerWithArguments(t,i){let e=`console.${t}(args)`,s=i.map(((t,i)=>`args[${i}]`));new Function("args",e.replace(/args/,s.join(",")))(i)}verbose(...t){this.print(0,Array.prototype.slice.call(arguments))}v(...t){this.verbose.apply(this,arguments)}info(...t){this.print(1,Array.prototype.slice.call(arguments))}error(...t){this.print(2,Array.prototype.slice.call(arguments))}i(...t){this.info.apply(this,arguments)}table(...t){this.print(3,Array.prototype.slice.call(arguments))}style(...t){this.print(4,Array.prototype.slice.call(arguments))}logWaterfallDetails(t,i,e){t.waterfall=t.waterfall||[],t.waterfall.push({provider:t.genericParams.displayName||t.providerName||s.ProviderType.HEADER_BIDDING,adIndex:t.spotIndex,adUnit:i.c.au||"-",size:JSON.stringify(t.implementedSize),position:t.positionType,isLazy:t.isLazyLoading,status:e}),this.info("Waterfall Table:"),this.table(t.waterfall)}hbLog(t,i,e,s){if(this.active){console.group(`auction result ${i}, winner: %c[${s&&s.bidder||"None"}]`,"color:#42919D;font-size:20px");const n=t.map((t=>({bidder:t.bidder,cpm:t.cpm,size:`${t.width}x${t.height}`,currency:t.currency}))),r=e.map((t=>({bidder:t.bidder,cpm:-1,size:"NA",currency:"NA"})));this.table(n.concat(r)),console.groupEnd()}}apsLog(t){this.active&&t&&(console.group(`${t.slotID} result %c[aps]`,"color:#42919D;font-size:20px"),this.table([t]),console.groupEnd())}}},8807:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Output=void 0;const s=e(7111),n=e(9714),r=e(1332),o=e(8406),h=e(9840),a=e(4987),c=e(3813),l=e(394),d=e(584);i.Output={setBrowsiOutput:function(t){function i(){return o.default.getSpots().slice()}const e=i(),u={getFiredEvents:s.default.getFiredEvents,spots:e,getSpots:i,serializedSpots:e.map((t=>o.default.serialize(t))),publisherAds:n.default.get().foundAds,browsiEmbeddedPlacementsIds:a.default._(),mainContent:{start:r.default.instance.start,end:r.default.instance.end,startBorder:r.default.instance.startingBorder,endBorder:r.default.instance.endingBorder},getEmbeddedSpots:o.default.getEmbeddedSerializedSpots,getStayAwayElements:h.default.get().getStayAwayElements.bind(h.default.get()),f:a.default,skippedElements:d.default.getSkippedElementsContainers(),invalidInspectives:c.default.get().getInvalidInspectives()},v=l.Profiler.get().pageViewID;window.browsiOutput=window.browsiOutput?window.browsiOutput:{},window.browsiOutput[v]=window.browsiOutput[v]?Object.assign(window.browsiOutput[v],u):u,window.browsiOutput.state=t},getBrowsiOutput:t=>t?window.browsiOutput[t]:window.browsiOutput[l.Profiler.get().pageViewID]}},4752:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(394),n=e(4987),r=e(8406),o=e(3434),h=e(7111),a=e(9310),c=e(1250),l=e(3105),d=e(492);class u{static get profile(){return this._profile||(this._profile=s.Profiler.get()),this._profile}static isEmbeddedByBrowsi(t,i){let e=this.profile.externalFlowHandler&&this.profile.externalFlowHandler.currentAds?this.profile.externalFlowHandler.currentAds:[];if(n.default.S(e,t))return!0;if(!i&&r.default.getSpots().length>0){let i=r.default.getSpots().filter((t=>t.browsiAd&&n.default.O(t.browsiAd))).map((t=>t.browsiAd));const e=t.id,s=t.id&&-1!==n.default._().indexOf(e)||n.default.S(i,t);if(s)return s}return!1}static isLazySpotsEnabled(){return!!this.profile.spotsSupplyParams.lazySpots}static getLazySpotsInstance(){var t;return!!(null===(t=this.profile.spotsSupplyParams.lazySpots)||void 0===t?void 0:t.bucketsConfigured)?l.default.get():d.default.get()}static getTimeOffset(){return Date.now()-this.profile.timeOffset}static isCustomRefreshConfigured(){return!!this.profile.customRefresh}static getExternalFlowHandler(t){var i;if(this.profile.externalFlowHandler&&(null===(i=this.profile)||void 0===i?void 0:i.externalFlowHandler[t])){return(...i)=>{try{return this.logger.verbose(`Invoking ${t}`),this.profile.externalFlowHandler[t](...i)}catch(i){h.default.get().sendErrorEvent(a.EventType.CRASH,"ExternalFlowHandler: "+t,i.message)}}}}static getDcsType(){return this.profile.dcsState?"script":this.profile.dcs.type}static getUserID(){return o.default.hasUserConsent?this.profile.userID:"anonymous"}}i.default=u,u.logger=new c.default("Profile Utils")},4987:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(3610),n=e(1150),r=e(8431),o=e(4752),h=e(394),a=e(9839),c=e(6761),l=e(2593),d=e(7579),u=e(4730),v=e(3761);class f{static A(){return this.viewport||(this.viewport=f.P()),this.viewport}static T(t){return null==t}static I(){const t={};return t.width=window.screen.availWidth||window.screen.width,t.height=window.screen.availHeight||window.screen.height,t}static M(t=!0){const i=o.default.getExternalFlowHandler("getPageHeight");let e;return e=i?i():this.D(),t&&a.default.hasDcsMc()?e-f.R(a.default.getCurrentDcsElement(),!0).y:e}static C(){const t=o.default.getExternalFlowHandler("getPageWidth");if(t)return t();const i=window.document.documentElement;return Math.floor(Math.max(i.clientWidth,i.scrollWidth,i.offsetWidth))}static $(t){let i=t.offsetTop,e=t.offsetLeft,s=t.offsetParent;const n=t.offsetWidth,r=t.offsetHeight;for(;s;)i+=s.offsetTop,e+=s.offsetLeft,s=s.offsetParent;const o=window.document.body,h=o.offsetTop,a=o.offsetLeft,c=o.offsetWidth;return i>=h&&e>=a&&n<=c&&r>0}static F(){return Math.floor(Math.abs(window.performance.timing.loadEventEnd-window.performance.timing.domContentLoadedEventStart))}static B(t,i){var e;let s={y:-1,x:-1};if(!t||!this.O(t))return s;s=this.R(t);const n=null===(e=h.Profiler.get().dcsState)||void 0===e?void 0:e.mainContentElement;if(a.default.isEndless()){const t=a.default.getEndlessElementByPvId(i||h.Profiler.get().pageViewID);s.y-=this.R(t).y}else n&&(s.y-=this.R(n).y);return s}static N(t){let i=this.R(t.element).y;return t.referer instanceof HTMLIFrameElement&&(i+=this.R(t.referer).y),a.default.hasDcsMc()&&(i-=this.R(a.default.getCurrentDcsElement()).y),i}static L(t){return this.A().height*t}static U(t){return f.H()+f.W()-f.B(t).y}static q(t){const i=f.B(t).y,e=i+f.G(t).h,s=f.W(),n=s+f.H();return e<s||i>n?0:e<=n&&i>=s?e-i:e>n?n-i:e-s}static J(t,i){return this.U(t)>=this.L(i)}static X(t,i){return this.q(t)>=this.L(i)}static R(t,i=!1){let e=t.getBoundingClientRect(),s=this.K(),n=document.documentElement,r=i?window.pageYOffset||n.scrollTop||s.scrollTop:this.W(),o=window.pageXOffset||n.scrollLeft||s.scrollLeft,h=n.clientTop||s.clientTop||0,a=n.clientLeft||s.clientLeft||0,c=e.top+r-h,l=e.left+o-a;return{y:Math.round(c),x:Math.round(l)}}static getSAPositionFromTop(t){return f.B(t).y}static Y(t){if(!t)return 0;const i=f.B(t).y;if("none"!==t.style.display&&i>0)return i;let e,s,n=t.previousElementSibling;for(;n;){if(e=f.B(n).y,"none"!==n.style.display&&e>0)return s=n.getBoundingClientRect().height,s+e;n=n.previousElementSibling}return this.Y(t.parentElement)}static Z(t){return Math.floor(this.B(t).y/this.A().height)+1}static tt(t){return Math.floor(this.it(t))+1}static it(t){return t.adDistanceFromTop/this.A().height}static getFoldNumberByDistance(t){return Math.floor(t/this.A().height)+1}static nt(t){const i=a.default.isEndless()?h.Profiler.get().pageViewID:void 0;return Math.floor(f.B(t,i).y/this.A().height)+1}static ht(){const t=a.default.hasDcsMc()?this.W()-f.R(a.default.getCurrentDcsElement()).y:this.W();return{top:t,bottom:t+Number(this.A().height),left:window.pageXOffset}}static calculateDistanceBetweenTwoElements(t,i){let e=0,s=this.B(t),n=this.B(i);return s&&n&&(s.y>n.y?e=s.y-n.y-this.G(i).h:s.y<n.y&&(e=n.y-s.y-this.G(t).h)),e}static ct(){let t={width:0,height:0},i=window.screen;return t.width=i.availWidth,t.height=i.availHeight,t}static ut(){return Math.max(Math.floor(this.gt()),1)}static wt(t){return Number(f.gt().toFixed(t))}static gt(){let t=this.ct();return this.ht().top/t.height+1}static O(t){return t instanceof Element}static G(t){let i=t.getBoundingClientRect();return{w:i.width,h:i.height}}static _t(t){let i=t.getElementsByTagName("iframe")[0];if(i)try{return{size:{w:+i.width,h:+i.height},element:i}}catch(t){}return{size:this.G(t),element:t}}static yt(t){return t.dataset._getElementSize=t.dataset._getElementSize||JSON.stringify(this.G(t)),JSON.parse(t.dataset._getElementSize)}static St(t){let i=t.getBoundingClientRect();return{w:i.width,h:i.height}}static Ot(t){if(t&&"function"==typeof t.getAttribute&&t.getAttribute("id"))return"//*[@id='"+t.getAttribute("id")+"']";if(t===document.body)return"/";if(t){let i=0,e=t.parentNode?t.parentNode.childNodes:[];for(let s=0;s<e.length;s++){let n=e[s];if(n===t)return this.Ot(t.parentNode)+"/"+t.tagName.toLowerCase()+"["+(i+1)+"]";1===n.nodeType&&n.tagName===t.tagName&&i++}}return""}static At(t){return t.size?{w:t.size[0],h:t.size[1]}:{w:-1,h:-1}}static getDfpRequestEventSize(t){var i,e;const s=null===(e=null===(i=t.slot)||void 0===i?void 0:i.getSizes)||void 0===e?void 0:e.call(i);return s.length?this.getDfpSizesList(s):[{w:-1,h:-1}]}static getDfpSizesList(t){return null==t?void 0:t.map((t=>{if("string"==typeof t)return t;const i=Object.values(t);return{w:i[0],h:i[1]}}))}static jt(t,i){let e=window.getComputedStyle(t),s=!i||this.Et(t);return!!e&&(s&&"visible"===e.getPropertyValue("visibility")&&"none"!==e.getPropertyValue("display")&&"0"!==e.getPropertyValue("opacity"))}static Et(t){let i=t.getBoundingClientRect();return i.top>=0&&i.right<=window.innerWidth&&i.bottom<=this.M()&&i.left>=0&&i.height>0||this.$(t)}static Pt(t,i){let e=Array();return("IFRAME"===t.nodeName?this.Tt(t):Array.from(t.querySelectorAll("*"))).forEach((n=>{if("IFRAME"===n.nodeName)try{const t=this.It(n);if(t){let s=t.document;if(s){let t=this.Pt(s.body,i||n);e=e.concat(t)}}}catch(n){}else e.push(new s.default(n,i||t))})),e}static It(t){let i;try{i=t.contentWindow&&t.contentWindow.document?t.contentWindow:void 0}catch(t){}return i}static Tt(t){if("IFRAME"===t.nodeName){let i=this.It(t);if(i)return Array.from(i.document.querySelectorAll("*"))}return[]}static Mt(t){if(!t)return"";let i="";switch(t.nodeName.toLowerCase()){case"embed":case"iframe":case"source":case"track":case"video":i=t.getAttribute("src")||"";break;case"a":case"area":case"link":i=t.getAttribute("href")||"";break;case"object":i=t.getAttribute("data")||""}if(!i){let e=Array.from(t.attributes).filter((t=>!(!t.name||-1===t.name.indexOf("url"))));i=e[0]&&e[0].value||""}return i.replace(/\/?$/,"")}static S(t,i){for(let e of t)if(e.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)return!0;return!1}static kt(t,i){let e=t.parentNode;for(;null!==e;){if(e===i)return!0;e=e.parentNode}return!1}static Dt(t,i,e){return new Promise(((s,n)=>{const o=document.createElement("script");if(o.async=!0,o.setAttribute("src",t),o.addEventListener("load",(()=>{s(r.Status.SUCCESS)})),o.addEventListener("error",(()=>{n(r.Status.ERROR)})),e){const t=this.It(i);t?t.document.body.appendChild(o):n(r.Status.ERROR)}else i.appendChild(o)}))}static Rt(t){const i=document.querySelector("#browsi-tag"),e=document.createElement("script");return i?(Array.from(i.attributes).forEach((t=>{t.nodeName&&t.nodeValue&&e.setAttribute(t.nodeName,t.nodeValue)})),e.setAttribute("async",""),t&&(e.setAttribute("sitekey",t),e.dataset.sitekey=t),document.head.appendChild(e),i):null}static xt(t,i){return i<=0?0:Number((t/i).toFixed(2))}static Ct(t,i){t=t.replace(/\/?$/,"");for(let e of Array.from(i.querySelectorAll("a")))if(-1!==this.Mt(e).indexOf(t))return!0;return!1}static $t(t){return!!t.textContent&&t.textContent.length>0}static isFixed(t){const i={active:!0,time:1500};if(t){const e=v.default.getCachedResult(t,"isFixed",i);if(e.valid)return e.result}let e=o.default.getExternalFlowHandler("isFixed");if(e)return e.call(this,t);if(t&&t!==document.body){if("fixed"===window.getComputedStyle(t).position)return v.default.storeCache(t,"isFixed",{status:!0,element:t},i),{status:!0,element:t};{const e=t.parentElement?this.isFixed(t.parentElement):{status:!1};return v.default.storeCache(t,"isFixed",e,i),e}}return{status:!1}}static Ft(t){const i={active:!0,time:1500};if(t&&t!==document.body){const e=v.default.getCachedResult(t,"isStickyElement",i);if(e.valid)return e.result;if("sticky"===window.getComputedStyle(t).position)return v.default.storeCache(t,"isStickyElement",!0,i),!0;{const e=!!t.parentElement&&this.Ft(t.parentElement);return v.default.storeCache(t,"isStickyElement",e,i),e}}return!1}static Bt(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_DISCONNECTED)}static isPositionedBefore(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING)}static isPositionedAfter(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING)}static isPositionContained(t,i){return!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)}static Nt(t,i,e){return Math.abs(t-i)<=(e||0)}static zt(t){return t==n.AdPositionType.STICKY_BOTTOM||t==n.AdPositionType.STICKY_TOP}static Vt(t){let i=encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&"),e=new RegExp("(?:(?:^|.*;)\\s*"+i+"\\s*\\=\\s*([^;]*).*$)|^.*$"),s=document.cookie.replace(e,"$1");return decodeURIComponent(s)||""}static H(){const t=o.default.getExternalFlowHandler("getWindowHeight");return t?t():window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}static W(){const t=o.default.getExternalFlowHandler("getPageYOffset");let i=t?t():window.pageYOffset||("CSS1Compat"===document.compatMode?document.documentElement.scrollTop:document.body.scrollTop);return a.default.hasDcsMc()&&(i-=this.R(a.default.getCurrentDcsElement(),!0).y),i}static Lt(){return this.W()+this.H()}static Ut(t){const i=this.M()||1;return t=t||0,Math.round(t/i*100)}static Ht(t){return!this.Wt(t)||this.W()>0||this.userEngaged}static Wt(t){var i;return!!(null===(i=l.SpotsUtils.getConf(t.tags))||void 0===i?void 0:i.engagedUsers)&&t.optimizeViewability}static qt(t){return Object.keys(t).map((i=>i+"="+("object"==typeof t[i]?encodeURIComponent(JSON.stringify(t[i])):encodeURIComponent(t[i])))).join("&")}static Gt(t,i){let e=document.createElement("style");e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),(e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+i+"}",0):(e.styleSheet||e.sheet).addRule(t,i)}static Jt(t){return!(!t||!t.parentElement)&&(t.parentElement.removeChild(t),!0)}static Xt(t){this.browsiEmbeddedPlacementsIds.push(t)}static _(){return this.browsiEmbeddedPlacementsIds}static Kt(){return Math.floor(Date.now()/1e3)}static Yt(){return Math.floor(Date.now())}static Qt(t){return Array.from(t.querySelectorAll("SCRIPT"))}static Zt(t){return 0===t.w&&0===t.h}static ti(t){return-1===t.w&&-1===t.h}static ii(t){return`${t[0]}x${t[1]}`}static ei(t=""){const i=/^(\d+)x(\d+)$/.exec(t);return i&&3===i.length?{w:Number(i[1]),h:Number(i[2])}:{w:-1,h:-1}}static ni(t){const i=t.getBoundingClientRect(),e=i.width*i.height,s=f.hi(i);return e>0&&s/e>=.15}static hi(t){const i=this.ci(),e=this.D(),s=t.left+window.scrollX,n=t.right+window.scrollX,r=t.bottom+window.scrollY,o=t.top+window.scrollY;if(s>window.innerWidth||n<0||r<0||o>e)return 0;let h=t.width;s<0&&(h-=Math.abs(s)),n>i&&(h-=n-i);let a=t.height;return o<0&&(a-=Math.abs(o)),r>e&&(a-=r),h*a}static ci(){return Math.max(window.document.body.scrollWidth,window.document.body.offsetWidth,window.document.documentElement.scrollWidth,window.document.documentElement.offsetWidth,window.document.documentElement.clientWidth)}static D(){var t,i;let e=o.default.getExternalFlowHandler("getPageHeight");return e?e():Math.floor(Math.max(null===(t=window.document.body)||void 0===t?void 0:t.scrollHeight,null===(i=window.document.body)||void 0===i?void 0:i.offsetHeight,window.document.documentElement.clientHeight,window.document.documentElement.scrollHeight,window.document.documentElement.offsetHeight))}static ui(t){let i=window.getComputedStyle(t);return!!i&&("visible"===i.getPropertyValue("visibility")&&"none"!==i.getPropertyValue("display")&&"0"!==i.getPropertyValue("opacity"))}static gi(t){return this.ui(t)&&this.ni(t)}static wi(t){return t.head||t.getElementsByTagName("head")[0]}static _i(){return`${window.document.location.protocol}//${window.document.location.host}${window.document.location.pathname}`}static yi(){let t=window.document.location.search.substring(1).split("&");return 0===t.length?"":(t.length>10&&(t.length=10),t.join("&"))}static Si(t=document){const i=t.createElement("script");return i.async=!0,i.setAttribute("crossorigin","anonymous"),i}static Oi(t,i){try{localStorage.setItem(t,i)}catch(t){}}static Ai(t){try{localStorage.removeItem(t)}catch(t){}}static ji(t){try{return localStorage.getItem(t)||""}catch(t){}return""}static Ei(){let t=o.default.getExternalFlowHandler("getScrollListenElement");return t?t():window}static K(){let t=o.default.getExternalFlowHandler("getBodyElementForScroll");return t?t():document.body}static Pi(t){return t>=.85*this.A().height}static P(){let t=o.default.getExternalFlowHandler("viewportDetection");if(t){const i=t();if(i&&i.width&&i.height)return i}let i={width:0,height:0};return void 0!==window.innerWidth?(i.width=window.innerWidth,i.height=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth&&(i.width=document.documentElement.clientWidth,i.height=document.documentElement.clientHeight),i.area=i.height&&i.width?i.height*i.width:0,i}static Ti(){let t=this.M(),i=this.A().height;return{docHeight:t,viewPortHeight:i,numberOfFolds:t/i}}static Ii(t,i){const e=i&&i!=document.body?i:document;return document.evaluate(t,e,null,0,null)}static Mi(t,i,e){let s=[];if(t)for(let n=0;n<t.length;n++){let r=null;try{r=this.Ii(e?this.ki(t[n]):t[n],i)}catch(t){return[]}if(r){let t=r.iterateNext();for(;t;)s.push(t),t=r.iterateNext()}}return s}static ki(t){return this.startsWith("(.",t)?t:this.startsWith("(",t)?t.replace("(","(."):"."+t}static Di(t){let i=+new Date+""+Math.random();try{let e=t.contentWindow;return!!e&&(e[i]="asd","asd"===e[i])}catch(t){return!1}}static Ri(t,i){for(let e=0;e<t.length;e++)if(t[e].indexOf(i)>-1)return!0;return!1}static xi(t){return t.filter((t=>t&&!t.isLazyLoading&&t.type!==c.SpotType.STICKY&&t.type!==c.SpotType.API))}static Ci(t,i,e=!0){let s=!1;return n=>{s||(e&&t(n),s=!0,setTimeout((()=>{s=!1,t(n)}),i))}}static xhrPromise(t,i,e){return new Promise(((s,n)=>{const r=new XMLHttpRequest;r.open(i||"GET",t,!0),r.onreadystatechange=function(){r.readyState==(r.DONE||4)&&(r.status>=200&&r.status<300?s(r):n(null))},"POST"===i&&e?r.send(e):r.send()}))}static clone(t){return JSON.parse(JSON.stringify(t))}static querySelectorOnDocument(t,i){let e=null;if(t instanceof HTMLIFrameElement){const i=this.It(t);i&&(e=i.document)}else t instanceof HTMLElement&&t.shadowRoot?e=t.shadowRoot:(t instanceof Document||t instanceof HTMLElement)&&(e=t);return e?Array.prototype.slice.call(e.querySelectorAll(i)).map((i=>({element:i,referer:t}))):[]}static avg(t,i){return i<=0?0:t/i}static getWeightedAvg(t,i,e,s){const n=i+s;return n>0?parseFloat(((t*i+e*s)/n).toFixed(2)):0}static getChildrenMaxHeight(t){let i=0;return Array.from(t.querySelectorAll(":scope > *")).forEach((t=>{i=Math.max(i,t.getBoundingClientRect().height)})),i}static getGAMResponseInfo(t,i){if(!t)return null==i?void 0:i.genericParams.gamInfo;{const i=t.getResponseInformation();if(i)return{oid:i.campaignId,lid:i.lineItemId||i.sourceAgnosticLineItemId}}}static getBrowsiTag(){return window.browsitag||null}static isValidStickyHeight(t){return t<=.3*this.A().height}static isValidStickySize(t){return this.isValidStickyHeight(t.h)&&t.w<=this.A().width}static dispatchDOMEvent(t,i,e){const s=new CustomEvent(t,{detail:i});return e.dispatchEvent(s),!0}static isBrowsiLoggerActive(){return!!h.Profiler.get().loaderParams.lp}static getPredictionToSend(t){var i;const e=null===(i=null==t?void 0:t.od)||void 0===i?void 0:i[50];return(null==e?void 0:e.sp)?e:void 0}static getDemandConfig(t){var i;return t.rt===u.ProviderType.HEADER_BIDDING?null===(i=t.c)||void 0===i?void 0:i.d:t.c}static isSraResponse(t){return t.rt===d.DemandRequestType.SRA}static splitAdUnit(t){const i=t.split("/");return{pubID:i[1],au:i.slice(2).join("/")}}static convertToOldStyleAdUnit(t){const i=this.getDemandConfig(t);if(!i)return t;const e=this.splitAdUnit(i.aup);return i.a.pubID=e.pubID,i.au=e.au,t}static convertToNewStyleAdUnit(t,i){const e=this.getDemandConfig(t);return e?(e.aup===i&&e.p!==u.ProviderType.GENERIC_JS&&(e.aup=`/${e.a.pubID}/${e.au}`),t):t}static startsWith(t,i){return 0===i.indexOf(t)}static getElementPercentageInViewport(t){const i=f.B(t).y,e=f.G(t).h,s=i+e,n=f.ht();let r;return s<n.top||i>n.bottom?0:s<=n.bottom&&i>=n.top?100:(r=s>n.bottom?n.bottom-i:s-n.top,100*Math.min(Number(r/e),1))}static getShadowRoot(t){let i=t;for(;11!=i.nodeType&&i.parentNode;)i=i.parentNode;return 11===i.nodeType?i:void 0}static generateUuid(t=""){return t?((Number(t)^16*Math.random())>>Number(t)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,f.generateUuid)}static flattenArray(t){return t.reduce(((t,i)=>t.concat(i)),[])}static isChangingViewport(t){return f.B(t).y<f.ht().bottom}static getArticleAge(){const t=h.Profiler.get().articlePublishDate;if(t){const i=Date.now()-t;return Math.floor(i/6e4)}return-1}}i.default=f,f.userEngaged=!1,f.browsiEmbeddedPlacementsIds=[]},3640:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AdType=void 0,function(t){t.PUBLISHER_AD="publisher_ad",t.BROWSI_AD="browsi_ad",t.SA_TO_DENSTIY="sa_to_density"}(i.AdType||(i.AdType={}))},4492:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CustomTagType=void 0,function(t){t.BROWSI_SPOT="browsispot",t.BROWSI_SPOT_FIXED_BELOW="brwfb"}(i.CustomTagType||(i.CustomTagType={}))},4351:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MiddyState=void 0,function(t){t.LOADED="loaded",t.STARTED="started"}(i.MiddyState||(i.MiddyState={}))},1807:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.RunMode=void 0,function(t){t.BLOCKLIST="bl"}(i.RunMode||(i.RunMode={}))},9207:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SpotEngineType=void 0,function(t){t.STANDARD="standard",t.SLIDES_ALL="slides_all",t.BROWSI_SPOTS="browsi_spots"}(i.SpotEngineType||(i.SpotEngineType={}))},8431:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Status=void 0,function(t){t.SUCCESS="success",t.FAILURE="failure",t.ERROR="error",t.NO_URL="No hb url was found",t.TIMEOUT="timeout",t.GENERIC_SNIPPET_ERROR="generic_snippet_error",t.NOT_SUPPORTED="not_supported"}(i.Status||(i.Status={}))},8540:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CustomRefreshRate=void 0;const s=e(1250),n=e(4987),r=e(7111),o=e(7579),h=e(394),a=e(9310),c=e(9497),l=e(4752);class d{constructor(){this.logger=new s.default("RefreshRate"),this.profile=h.Profiler.get()}static get(){return d.instance||(d.instance=new d),d.instance}runCustomRefreshHook(t){const i=l.default.getExternalFlowHandler("preCustomRefresh");if(i){const e=i(t);return e&&Array.isArray(e)&&e.length>0?e:(this.logger.verbose("disabling refresh for this slots",t),[])}return t}sendCustomRefreshRate(t,i){const e=this.runCustomRefreshHook(i);if(e.length>0){let i="";if(t===o.DemandRequestType.SINGLE)if(e&&1===e.length){const t=e[0];i=this.buildRefreshRateSingleUrl(t)}else this.logger.error(`invalid slots params ${e}`);else e&&t===o.DemandRequestType.SRA&&(i=this.buildRefreshRateSRAUrl(e));i?this.refreshRateXhrRequest(i):this.logger.error("error building get custom refresh rate url")}}refreshRateXhrRequest(t){n.default.xhrPromise(t,"GET").then((i=>{if(200===i.status){const t=JSON.parse(i.responseText);Array.isArray(t)?t.map((t=>c.ViewabilityService.instance.handleCustomRefreshResponse(t))):c.ViewabilityService.instance.handleCustomRefreshResponse(t)}else r.default.get().sendErrorEvent(a.EventType.XHR_ERROR,t,"get refresh rate failed"),this.logger.error(`Error on get refresh rate. url: ${t}`)})).catch((i=>{r.default.get().sendErrorEvent(a.EventType.XHR_ERROR,t,(null==i?void 0:i.message)||"get refresh rate failed"),this.logger.error("error on xhr promise",i)}))}buildRefreshRateSingleUrl(t){let i=Object.assign(Object.assign(Object.assign(Object.assign({pk:this.profile.publisherKey,sk:this.profile.siteKey,t:n.default.Yt()},t.au?{au:t.au}:{}),t.id?{id:t.id}:{}),t.lid?{lid:t.lid}:{}),t.oid?{oid:t.oid}:{});return`//${this.profile.demandHost}/refreshrate/single/mobile?${n.default.qt(i)}`}buildRefreshRateSRAUrl(t){let i=Object.assign({pk:this.profile.publisherKey,sk:this.profile.siteKey,t:n.default.Yt()},this.buildRefreshRateSRAParams(t));return`//${this.profile.demandHost}/refreshrate/sra/mobile?${n.default.qt(i)}`}buildRefreshRateSRAParams(t){let i={};return t.map(((e,s)=>{const n=this.buildRefreshRateSRASpotParams(e);for(let e in n)i[e]=i[e]||[],i[e].push(n[e]),s+1===t.length&&(i[e]=i[e].join("||"))})),i}buildRefreshRateSRASpotParams(t){return Object.assign(Object.assign(Object.assign(Object.assign({},t.au?{au:t.au}:{}),t.id?{id:t.id}:{}),t.lid?{lid:t.lid}:{}),t.oid?{oid:t.oid}:{})}}i.CustomRefreshRate=d},4490:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DemandManager=void 0;const s=e(4987),n=e(4059),r=e(1250),o=e(3673),h=e(7709),a=e(96),c=e(9840),l=e(7004),d=e(6761),u=e(394),v=e(4752),f=e(7328),p=e(8431),m=e(4730),g=e(7250),b=e(1332),w=e(9497),_=e(8234),y=e(3802),S=e(3813),O=e(2593),A=e(238),j=e(8406),E=e(584),P=e(6457),T=e(4560),I=e(9714),M=e(2133),k=e(1159),D=e(7499),R=e(626),x=e(3810);i.DemandManager=class{constructor(){this.demandIndexLimit=99,this.profile=u.Profiler.get(),this.logger=new r.default("Demand"),this.SRAState={[d.SpotType.API]:{nextDemandConfig:0,smallestAllowedAdIndex:0}},this.demandCounter=-1}updateSRAState(t){t.forEach((t=>{let i=t.tags;const e=t.type;if(E.default.isFixedSpot(i)){const i=t.selector;this.SRAState[e]=this.SRAState[e]||{},this.SRAState[e][i]||(this.SRAState[e][i]={nextDemandConfig:0,smallestAllowedAdIndex:0})}else this.SRAState[e]||(this.SRAState[e]={nextDemandConfig:0,smallestAllowedAdIndex:0})}))}getSpotSRAState(t){return this.shouldRelocateAPI(t)||2===t.relocationStatus?this.SRAState[d.SpotType.API]:t instanceof P.FixedSpot?this.SRAState[t.type][t.selector]:this.SRAState[t.type]}waitForFetching(t,i){return new Promise(((e,s)=>{if(t.isLazyLoading&&!t.isRefreshing()&&v.default.isLazySpotsEnabled()){v.default.getLazySpotsInstance().subscribe(t,(()=>this.$i(t,i,e,s)),(()=>this.Fi(t,i)))}else this.$i(t,i,e,s)}))}getSpotAdUnit(t,i){var e;const n=s.default.getDemandConfig(i);return(null===(e=t.options)||void 0===e?void 0:e.adUnit)||(null==n?void 0:n.aup)||"NA"}$i(t,i,e,r){var h;if(t.disableDemand)return void this.logger.info(`spot ${t.spotIndex} is disabled. blocked`);let c=this.getCandidateResponseForSpot(i,t);if(c){c.is&&(t.isShadowDemand=!0);const l=this.getViolations(t,c);if(l.length)t.Bi(l),1===l.length&&"out_of_focus"===l[0].reason&&n.default.instance.waitForUserFocus().then((()=>this.$i(t,i,e,r)));else{const n=c;s.default.isSraResponse(i)&&(this.shouldRelocateAPI(t)&&t.Ni(A.DemandTool.get().relocateSpots.shift()),this.confirmResponseForSpot(t));const l=T.InframeManager.get(),d=l.shouldFetchDynamicVideo(t.isRefreshing(),t.type)&&l.hasVideoDemand(t),u=o.ProviderFactory.generateProvider(d?{rt:"inframe",plk:n.plk}:n,t),v=a.EmbeddingFactory.getEmbedder(n,t);u&&v?(this.logger.info(`spot ${t.spotIndex} matched to demand ${d?"video":t.demandIndex}`,n),t.zi(n),t.selectedSizes=(null===(h=t.options)||void 0===h?void 0:h.sizes)||n.szs,e({provider:u,embedder:v,matchedResponse:n})):(this.logger.error("unknown provider/embedder"),r("unknown provider/embedder"))}}else this.logger.info(`no demand for spot ${t.spotIndex}`)}confirmResponseForSpot(t){const i=this.getSpotSRAState(t);t.demandIndex=i.nextDemandConfig,i.nextDemandConfig<this.demandIndexLimit&&i.nextDemandConfig++,i.smallestAllowedAdIndex=t.typeIndex}getCandidateResponseForSpot(t,i){let e=null;return s.default.isSraResponse(t)?i.typeIndex>=this.getSpotSRAState(i).smallestAllowedAdIndex&&this.hasUnusedDemandResponses(t,i)&&(e=this.getNextDemandResponses(t,i)):e=t,e}hasUnusedDemandResponses(t,i){return!!this.nextDemandResponses(t,i)}getNextDemandResponses(t,i){return s.default.clone(this.nextDemandResponses(t,i))}nextDemandResponses(t,i){const e=e=>{if(e)return e.od=t.ods[i.spotIndex],e},s=this.getSpotSRAState(i);return O.FIXED_TYPES.includes(i.type)?e(t.fc[i.selector]&&t.fc[i.selector][s.nextDemandConfig]):this.shouldRelocateAPI(i)?e(t.ac[s.nextDemandConfig]):e(t.c[s.nextDemandConfig])}shouldRelocateAPI(t){return t.type===d.SpotType.DYNAMIC&&!!A.DemandTool.get().relocateSpots.length}Vi(t,i){if(t=this.fillAPIResponse(t,i)){const e=[];i.forEach((i=>{i.Li>=2&&o.ProviderFactory.setSpotProviderName(t,i),e.push(this.waitForUserEngagement(i).then((()=>{this.waitForFetching(i,t).then((t=>{const e=t.embedder instanceof M.default;this.demandCounter--,0===this.demandCounter&&S.default.get().onStopEngine();const s=this.getSRADelayConfig(e);Promise.race([this.delayTogglePromise(s.shouldDelay),this.delayTimeoutPromise(s.delayTime),this.waitForPubAdRequestPromise()]).then((()=>{this.Ui(t.provider,t.embedder,t.matchedResponse,i)}))})).catch((t=>{y.YieldClient.get().handleWaterfallFailed(t,i,null)}))})))}))}else this.logger.info(`Waterfall ended for spot ${i.map((t=>t.spotIndex)).join(", ")}`),i.forEach((t=>{t.Hi()}))}delayTimeoutPromise(t){return new Promise((i=>{setTimeout((()=>{i()}),t)}))}delayTogglePromise(t){return new Promise((i=>{t||i()}))}waitForPubAdRequestPromise(){return new Promise((t=>{I.default.get().waitForFirstAdRequest().then((()=>{t()}))}))}getSRADelayConfig(t){var i,e;const s=this.profile.waitForAdRequest,n=(null===(e=null===(i=null===googletag||void 0===googletag?void 0:googletag.pubads)||void 0===i?void 0:i.call(googletag).getSlots())||void 0===e?void 0:e.length)||0;return{shouldDelay:!(!s||t||!n),delayTime:s||0}}fillAPIResponse(t,i){if(t){if(s.default.isSraResponse(t)){const i=Object.keys(t.ac);for(let e=0;e<i.length;e++)if("empty"===t.ac[i[e]].rt){const s=A.DemandTool.get().relocateSpots[e];if(!s||!this.canFakeResponse(s))return null;t.ac[i[e]]=this.getFakeApiResponse(s.options,s.sizes)}return t}return t}return this.canFakeResponse(i[0])?this.getFakeApiResponse(i[0].options,i[0].sizes):null}canFakeResponse(t){return!!(1==t.Li&&t.options&&t.options.adUnit&&t.options.sizes)}getFakeApiResponse(t,i){return{rt:"empty_api",c:{a:{autoSize:!0,inIframe:!1},aup:t.adUnit,p:""},plk:"",szs:i,is:!1}}waitForUserEngagement(t){return new Promise((i=>{if(s.default.Ht(t)||t.isEagerFirstFold())return i();{const t=()=>{this.logger.info("detected scroll, fetching"),f.default.get().removeListener("scroll",s.default.Ei(),t),s.default.userEngaged=!0,i()};f.default.get().listen("scroll",s.default.Ei(),t)}}))}Ui(t,i,e,s){s.setPlaceholderSize(e.szs),e=s.Wi(e),t.Ui(e,i).then((n=>{var r,o;t.applyLoggerData(s,n,e);let h=!1;switch((n.refresh||s.refresh)&&(n.status!==p.Status.SUCCESS&&s.qi(),h=!0),this.logger.logWaterfallDetails(s,e,n.status?n.status.toString():n.toString()),n.status){case p.Status.TIMEOUT:case p.Status.FAILURE:case p.Status.NOT_SUPPORTED:case p.Status.NO_URL:s.destoryDFPSlot(),(null===(r=s.refresh)||void 0===r?void 0:r.noDemandRefresh)?this.handlSpotWithoutDemand(s,t,n,e):null===(o=s.refresh)||void 0===o||o.stopRefreshing(),h||n.refresh||y.YieldClient.get().getNextDemandFromYield(s);break;case p.Status.SUCCESS:this.Gi(s,t,i,n,e)}})).catch((t=>{y.YieldClient.get().handleWaterfallFailed(t,s,e)}))}handlSpotWithoutDemand(t,i,e,s){const n=this.getAdditionalFields(e,s);this.runPostFetch(t,s),this.subscribeToViewabilityService(t,i,s,n)}Gi(t,i,e,s,n){var r,o,a;const c=this.getAdditionalFields(s,n);if(null===(r=t.placeholder)||void 0===r||r.removePlaceholderStyle(t.newBrowsiAd),t.providerName!=m.ProviderType.DFP){new g.default(t,c.adUnit,n.plk).waitForSpotMeasurable()}"s"!==t.tags.positionTag?t.positionType=b.default.instance.getAdPositionType(t.newBrowsiAd?t.newBrowsiAd.adWrapper:void 0):e.Ji(t,null===(o=t.newBrowsiAd)||void 0===o?void 0:o.adWrapper),t.Xi(),h.Embedder.Ki(t),(null===(a=this.profile.uxFixes)||void 0===a?void 0:a.fixWiderAds)&&this.fixWiderAds(t),this.runPostFetch(t,n),i.Yi(c.adUnit,n.plk),t.providerName!==m.ProviderType.GENERIC_JS&&t.providerName!==m.ProviderType.INFRAME&&i.Qi(t),this.subscribeToViewabilityService(t,i,n,c),this.collectSpotData(t),this.logger.info(`added ${t.providerName}: `,t.newBrowsiAd?t.newBrowsiAd.adWrapper:void 0)}collectSpotData(t){try{this.profile.adsDistanceViolations&&R.AdsDistanceViolationsService.get().addBrowsiAd(t),this.profile.collectUserTouch&&x.TouchEventsService.get().addBrowsiAd(t)}catch(i){this.logger.info("Faild to collect user touch data / ads distance violations for spot index:",t.spotIndex,i)}}subscribeToViewabilityService(t,i,e,s){if(i.Zi()){const i=t.type===d.SpotType.STICKY||"s"===t.tags.positionTag;v.default.isCustomRefreshConfigured()&&t.initCustomRefreshRate(),w.ViewabilityService.instance.subscribe(t.ie(s),_.ViewabilityConfigurations.vConfig(i),e)}}runPostFetch(t,i){var e;const n=v.default.getExternalFlowHandler("postFetch");if(n){const r=null===(e=s.default.getDemandConfig(i))||void 0===e?void 0:e.aup;n(t,i=s.default.convertToOldStyleAdUnit(i)),i=r?s.default.convertToNewStyleAdUnit(i,r):i}}ee(t){return t.args||{}}getAdditionalFields(t,i){var e;const n=this.ee(t),r=(null===(e=s.default.getDemandConfig(i))||void 0===e?void 0:e.aup)||"",o=n.adUnit?n.adUnit:r;return n.adUnit=o,n}se(t){if("fi"===t.tags.typeTag&&this.profile.fixedSpotsFirst)return null;const i=c.default.get().isStayAwayViolated(t);return i?{reason:"stay_away",message:i.distance.toString()}:null}ne(t){var i;if(t.type!=d.SpotType.DYNAMIC||!A.DemandTool.get().relocationActive)return null;const e=j.default.getSpots().filter((t=>t.type===d.SpotType.API&&1!==t.relocationStatus&&!s.default.isFixed(t.ref).status)),n=null===(i=this.profile.spotsSupplyParams.dynamic)||void 0===i?void 0:i.distance;if(!n)return null;return e.some((i=>{const e={element:i.ref,height:s.default.G(i.ref).h},{distance:r}=c.default.get().getSaDistance(t.ref,e);return r<n}))?{reason:"api_sa",message:""}:null}checkCLSViolation(t){let i=!1;const e=O.SpotsUtils.getConf(t.tags);return e&&"avoidCLS"in e&&e.avoidCLS&&(i=s.default.isChangingViewport(t.ref)),i?{reason:"CLS",message:""}:null}re(t,i){return l.default.instance.canEmbedAd(t,i)?null:{reason:"density",message:`${l.default.instance.getTotalAdDensity()}/${l.default.instance.densityCap}`}}oe(t,i){var e,s;if(t.optimizeViewability){const n=O.SpotsUtils.getViewabilityThreshold(t.tags);if(n){const t=(null===(s=null===(e=null==i?void 0:i.od)||void 0===e?void 0:e[50])||void 0===s?void 0:s.p)&&Number(i.od[50].p);if(t&&t>0&&t<n)return{reason:"prediction_threshold",message:""}}}return null}checkProfitabilityThreshold(t){if(t.optimizeViewability){const i=k.ProfitabilityPredictorService.get().getProfitabilityThreshold(t.tags);if(i){const t=k.ProfitabilityPredictorService.get().getPrediction();if(t&&t>=0&&t<i)return{reason:"profit",message:""}}}return null}checkPredicitonsViolations(t,i,e){switch(k.ProfitabilityPredictorService.get().getThresholdOperator(t.tags)){case D.ThresholdOperator.AND:if(i||e){const t=[];return i&&t.push(i),e&&t.push(e),t}break;case D.ThresholdOperator.OR:if(i&&e)return[i,e]}return null}Fi(t,i){if(!t.disableDemand&&(!s.default.isSraResponse(i)||this.hasUnusedDemandResponses(i,t))){const e=this.getCandidateResponseForSpot(i,t);if(e){const i=this.getViolations(t,e),n=[{reason:"lazy_ad_missed",message:`${s.default.wt(2)}`}].concat(i);t.Bi(n)}}}getViolations(t,i){const e=[];if(this.isSpotNotExist(t)&&e.push({reason:"spot_not_exists",message:""}),t.type===d.SpotType.STICKY)return t.sizes.length||e.push({reason:"no_compatible_sizes",message:""}),e;const s=this.oe(t,i),r=this.checkProfitabilityThreshold(t),o=this.checkPredicitonsViolations(t,r,s);o&&o.forEach((t=>{e.push(t)}));const h=t.isRefreshing()?null:this.checkCLSViolation(t);if(h&&e.push(h),t.type===d.SpotType.API)return e;const a=t.isRefreshing()?null:this.se(t),c=t.isRefreshing()?null:this.re(t,i.szs),l=t.isRefreshing()?null:this.ne(t);return n.default.instance.isHidden&&this.profile.blockAdRequestOnOOF&&e.push({reason:"out_of_focus",message:""}),a&&e.push(a),c&&e.push(c),l&&e.push(l),e}isSpotNotExist(t){var i;if(null===(i=t.options)||void 0===i?void 0:i.shadowElement){const i=t.options.shadowElement,e=s.default.getShadowRoot(i);return!!e&&s.default.Bt(i,e)}return s.default.Bt(t.ref,document.body)}fixWiderAds(t){var i,e,s,n;const r=(null===(i=t.newBrowsiAd)||void 0===i?void 0:i.iframe)||(null===(e=t.newBrowsiAd)||void 0===e?void 0:e.adContainer),o=null==r?void 0:r.getBoundingClientRect();if(o&&r){const i=o.width-((null===(s=t.implementedSize)||void 0===s?void 0:s.w)||0),e=((null===(n=t.implementedSize)||void 0===n?void 0:n.w)||0)+o.x;if(i<0){const t=i/2;r.style.marginLeft=t+"px",r.style.marginRight=t+"px"}else if(0===i&&o.x>0&&window.screen.availWidth<e){const t=-o.x;r.style.marginLeft=t+"px"}}else;}isSaas(t){const i=s.default.getDemandConfig(t);if(!i)return!1;const e=s.default.splitAdUnit(i.aup);return"57778053"!==(null==e?void 0:e.pubID)}}},1159:function(t,i,e){"use strict";var s=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,h)}a((s=s.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0}),i.ProfitabilityPredictorService=void 0;const n=e(1250),r=e(4987),o=e(1332),h=e(8406),a=e(8473),c=e(394),l=e(6761),d=e(2593),u=e(4752);class v{constructor(){this.prediction=-9,this.predictionBucket="",this.logger=new n.default("ProfitabilityPredictorService")}static get(){return v.instance||(v.instance=new v),v.instance}getPrediction(){return this.prediction}getProfitabilityThreshold(t){var i;return null===(i=d.SpotsUtils.getConf(t))||void 0===i?void 0:i.profitabilityThreshold}getThresholdOperator(t){var i;return null===(i=d.SpotsUtils.getConf(t))||void 0===i?void 0:i.operator}sendProfitabilityPrediction(){if(!c.Profiler.get().predictorsVersions.profit)return this.logger.info("profitability predictor version is missing"),void(this.prediction=-1);let t=this.buildProfitabilityPredictionUrl();t?this.profitabilityPredictionXhrRequest(t):this.logger.error("error building get profitability prediction url")}buildProfitabilityPredictionUrl(){var t,i,e;const s=c.Profiler.get(),n=(new Date).toLocaleString("en-US",{timeZone:"America/New_York"}),h=new Date(n).getHours(),l=this.getMinSpots(),d=a.default.get().getMostSampledAvgHighestBid(),u=Object.assign(Object.assign({mc:o.default.instance.calculateMCSize(!0),pl:r.default.M(),pk:s.publisherKey,sk:s.siteKey,os:(null===(t=s.deviceType)||void 0===t?void 0:t.os)||"",d:(null===(i=s.deviceType)||void 0===i?void 0:i.device)||"",dt:(null===(e=s.deviceType)||void 0===e?void 0:e.devicePlatform)||"",aa:r.default.getArticleAge(),gl:s.countryCode,ts:s.trafficSource,iru:s.isReturningUser,h,iamin:l.in||0,tamin:l.t||0,samin:l.s||0,ramin:0,aid:s.articleId,v:s.predictorsVersions.profit},(null==d?void 0:d.avg)?{ahb:d.avg}:{}),(null==d?void 0:d.curr)?{cur:d.curr}:{});return`//ai.browsiprod.com/profit?${r.default.qt(u)}`}profitabilityPredictionXhrRequest(t){r.default.xhrPromise(t,"GET").then((t=>s(this,void 0,void 0,(function*(){let i;200!==t.status&&(i=-2,this.logger.info("failed to get profitability prediction")),i=yield this.predictionHook(i||JSON.parse(t.responseText).prediction),this.prediction=i,this.predictionBucket=this.getBucketByPrediction(i)})))).catch((t=>{this.prediction=-8,this.logger.error("error on xhr promise",t)}))}predictionHook(t){return new Promise(((i,e)=>{const s=u.default.getExternalFlowHandler("postProfitPrediction");if(!s)return i(t);s(t,i,e)}))}getMinSpots(){const t=this.getMaxSpots(),i=this.getFoundSpots();return{in:Math.min(t.in,i.in),t:Math.min(t.t,i.t),s:Math.min(t.s,i.s)}}getMaxSpots(){var t;return{in:(null===(t=d.SpotsUtils.getConf({typeTag:"dy",positionTag:"in"}))||void 0===t?void 0:t.maxItems)||0,t:!!d.SpotsUtils.getConf({typeTag:"fi",positionTag:"t"})?1:0,s:!!d.SpotsUtils.getConf({typeTag:"st",positionTag:"s"})?1:0}}getFoundSpots(){return{in:h.default.getSpotsByType([l.SpotType.DYNAMIC]).length,t:h.default.getSpotsByType([l.SpotType.FIXED_TOP]).length,s:h.default.getSpotsByType([l.SpotType.STICKY]).length}}getBucketByPrediction(t){return!t||"number"!=typeof t||t<0?"":t<=.3?"low":t<=.6?"medium":"high"}getPredictionBucket(){return this.predictionBucket}}i.ProfitabilityPredictorService=v},143:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Provider=void 0;const s=e(1159),n=e(4987),r=e(7111),o=e(7709),h=e(8473),a=e(9310),c=e(1607),l=e(394),d=e(6761),u=e(8406),v=e(8803),f=e(9839),p=e(4752),m=e(2593),g=e(3434),b=e(5023),w=e(8431),_=e(4730),y=e(9497),S=e(8234);class O{constructor(t){this.spot=t,this.he=window;const i=f.default.getDcsActionCounter();this.ae=`${t.spotIndex}_ai_${t.Li?t.Li:1}_rc_${t.refreshCount}${i&&i>0?`_dcs_${i}`:""}`;const e=l.Profiler.get().predictorsKeyValueNames;this.de=e.viewability50}ue(){const t=this.spot.getQueryBaseElement(),i=f.default.getDcsActionCounter(),e=`browsi_wrapper_${`${this.spot.spotIndex}_ai_${this.spot.Li?this.spot.Li:1}_rc_${this.spot.refresh?this.spot.refresh.lastSuccessfulRefresh:0}${i&&i>0?`_dcs_${i}`:""}`}`;return t.querySelector(`#${e}`)||void 0}ve(t,i,e,s,n){(1===this.spot.Li||this.spot.isRefreshing())&&(this.spot.fetchStartTime=Date.now()),this.fe(t,i,e,s,n),1==this.spot.Li&&h.default.get().increment(a.EventType.AD_REQUEST)}fe(t,i,e,s,n){r.default.get().ve(this.spot,t,i,this.getSizesByOrder(e),s,n)}pe(t,i,e,s,n){e&&e.includes(w.Status.GENERIC_SNIPPET_ERROR)&&r.default.get().sendErrorEvent(a.EventType.GENERIC_ERROR,"",n||"",e),this.me(i,t.c.aup,t.plk,e,s,n)}me(t,i,e,s,n,o){r.default.get().ge(this.spot,t,i,e,s,n,o)}Yi(t,i,e){this.we(t,i,e)}we(t,i,e){var s,r;const o=n.default.getGAMResponseInfo(this.spot.slot,this.spot);let a=!1;l.Profiler.get().sendBrowsiImpressionDOMEvent&&(a=this._e(t)),this.ye(t,i,a,o,e),null===(s=this.spot.refresh)||void 0===s||s.handleSuccess(),this.spot.fetchStartTime&&(this.spot.fetchLatency=Math.min(Date.now()-this.spot.fetchStartTime,5e3));const c=(null===(r=this.spot.refresh)||void 0===r?void 0:r.count)||0;h.default.get().browsiImpression(this.spot.fetchLatency||-1,c)}ye(t,i,e,s,n){r.default.get().Yi(this.spot,t,i,e,s,n)}_e(t){var i,e;const s={element:this.spot.newBrowsiAd.adContainer,adUnit:(null===(i=this.spot.slot)||void 0===i?void 0:i.getAdUnitPath())||t,refreshCount:(null===(e=this.spot.refresh)||void 0===e?void 0:e.count)||0};return n.default.dispatchDOMEvent(b.BROWSI_IMPRESSION_DOM_EVENT_NAME,s,window)}useOriginalSizes(t){if(this.spot.type===d.SpotType.STICKY)return m.SpotsUtils.getConf(this.spot.tags).useOriginalSizes;const i=p.default.getExternalFlowHandler("useOriginalSizes");return!!i&&i(Object.assign({},t))}Se(t){if(this.spot.isRefreshing()){return this.useOriginalSizes(this.spot)?this.spot.selectedSizes.map((i=>this.Oe(t,i))):this.Oe(t,this.spot.implementedSize)}return this.spot.selectedSizes.filter((i=>t||!n.default.Zt(i))).map((i=>this.Oe(t,i)))}Oe(t,i){const e=n.default.Zt(i);return t?e?["fluid"]:[i.w,i.h]:e?[]:[i.w,i.h]}Ae(t,i,e){const s=p.default.getExternalFlowHandler("preAuction");s&&s(t,i,e)}je(t){var i;const e=p.default.getExternalFlowHandler("preFetchAsync"),s=p.default.getExternalFlowHandler("preFetch");if(s||e){const r=null===(i=n.default.getDemandConfig(t))||void 0===i?void 0:i.aup;return new Promise(((i,r)=>(t=n.default.convertToOldStyleAdUnit(t),e?void e(this.spot,t,i,r,this):(s&&s(this.spot,t,this),i())))).then((()=>{t=r?n.default.convertToNewStyleAdUnit(t,r):t}))}return Promise.resolve()}runPreGoogletagDisplay(t){const i=p.default.getExternalFlowHandler("preGoogletagDisplay");i&&i(t)}Ee(t,i){if(!i)return Promise.reject("No Config");i=this.updateAmazonBidderConfig(i);const e=t.win;if(t.iframe)return this.Pe(e,i,t);if(O.isApstagInitCalled)return Promise.resolve(t);if(e.apstag&&"function"==typeof e.apstag.fetchBids){try{const t=this.getApsInitConfig(i);e.apstag.init(t),O.isApstagInitCalled=!0}catch(t){this.Te.error("could not init publisher apstag",t)}return Promise.resolve(t)}return O.Ie||(O.Ie=this.Pe(e,i,t)),O.Ie.then((()=>(this.Te.info("Using browsi injected apstag"),t)))}updateAmazonBidderConfig(t){const i=p.default.getExternalFlowHandler("preApsInit");return i?i(t):t}getApsInitConfig(t){return{adServer:t.adServer,pubID:t.pubID,simplerGPT:t.simplerGPT}}Pe(t,i,e){return this.Te.info("Injecting apstag"),new Promise(((s,n)=>{const o=t.document.createElement("script");o.async=!0;const h="//c.amazon-adsystem.com/aax2/apstag.js";o.setAttribute("src",h),o.addEventListener("load",(()=>{if("function"==typeof t.apstag.init){const e=this.getApsInitConfig(i);t.apstag.init(e)}s(e)})),o.addEventListener("error",(()=>{r.default.get().sendErrorEvent(a.EventType.SCRIPT_LOAD_ERROR,h,"apstag"),n(e)})),t.document.head.appendChild(o)}))}Me(t){var i;return(null===(i=t.win.googletag)||void 0===i?void 0:i.apiReady)?Promise.resolve(t):new Promise(((i,e)=>{const s=document.createElement("script");s.async=!0,s.setAttribute("src","https://securepubads.g.doubleclick.net/tag/js/gpt.js"),s.addEventListener("load",(()=>{i(t)})),s.addEventListener("error",(()=>{e(t)})),n.default.wi(t.win.document).appendChild(s)}))}ke(){const t=this.useOriginalSizes(this.spot);return this.spot.isRefreshing()&&this.spot.implementedSize&&!t?this.spot.isFluid?["fluid"]:[this.spot.implementedSize.w,this.spot.implementedSize.h]:this.Se(!0)}De(t,i){return t.slot&&t.slot.getSlotElementId()===i}Qi(t){if(l.Profiler.get().adInViewport&&!(t.refreshCount>0)&&t.newBrowsiAd){const i=50+(t.newBrowsiAd.adMarking?n.default.G(t.newBrowsiAd.adMarking).h:0),e=t.newBrowsiAd.adWrapper;if(n.default.G(e).h>i)this.Re(e,t);else{const s=new c.default(e);s.addResizeListener((()=>{n.default.G(e).h>i&&(s.removeResizeListener(),this.Re(e,t))}))}}}Re(t,i){const e=n.default.getElementPercentageInViewport(t);e&&r.default.get().sendAdInViewport(i,e)}xe(t){return n.default.T(t.p)?"NA":t.p>=0?(Math.floor(10*t.p)/10).toFixed(2):"NA"}Ce(t,i){i.forEach((i=>{t.setTargeting(i.key,i.value)}))}$e(t,i){if(!t.v)return[];const e=this.spot.newBrowsiAd.win.googletag;if(e&&e.pubads&&-1!=e.pubads().getTargetingKeys().indexOf(i))return[];if(!t.j)return t.v;try{return this.he.eval(t.v&&t.v[0])||[]}catch(t){return[]}}Fe(){const t=this.Be||this.spot.refresh&&this.spot.refresh.stickyRefresh&&this.spot.refresh.oldBrowsiAd&&this.spot.refresh.oldBrowsiAd.adWrapper;t&&(o.Embedder.Ne(t),n.default.Jt(t))}ze(){return!1}Ve(){return this.spot.spotRequested>this.spot.Li&&!this.spot.isRefreshing()}Le(t){return t&&"true"===t.autoSize}Ue(t){const i=Array.isArray(t.setTargeting)?t.setTargeting:[],e=n.default.getPredictionToSend(t);if(e&&i.push({key:this.de,value:this.xe(e)}),l.Profiler.get().sendRevenueKeyValue){const t=s.ProfitabilityPredictorService.get().getPredictionBucket();t&&i.push({key:"brp",value:t})}if(this.spot.refresh&&this.spot.refresh.isRefreshing&&!this.spot.refresh.stickyRefresh){this.spot.refresh.keyValues&&i.push({key:"browsiRefresh",value:"True"})}const r=t.c.pgkv||t.c&&t.c.d&&t.c.d.pgkv||{},o=Object.assign(n.default.clone(l.Profiler.get().pageKeyValues||{}),n.default.clone(r||{}));for(let t in o){const e=this.$e(o[t],t);e.length&&i.push({key:t,value:e})}return i}Zi(){var t;if(this.spot.type!==d.SpotType.STICKY)return!0;const i=n.default.G(this.spot.browsiAd);return n.default.isValidStickyHeight(i.h)?((null===(t=m.SpotsUtils.getConf(this.spot.tags))||void 0===t?void 0:t.location)===v.Location.TOP?window.document.body.style.paddingTop=i.h+"px":window.document.body.style.paddingBottom=i.h+"px",!0):(u.default.removeStickyAd(this.spot),this.Te.info("sticky ad removed,",i.h," is over 30%"),!1)}setGoogleTagPrivacy(t){if(!g.default.hasUserConsent){const i=g.default.getCurrentConsentType();"ccpa"===i?t.pubads().setPrivacySettings({restrictDataProcessing:!0}):"gdpr"===i&&t.pubads().setRequestNonPersonalizedAds(1)}}getSizesByOrder(t){return Array.isArray(t[0])?t.sort(((t,i)=>{if("fluid"===t[0])return-1;if("fluid"===i[0])return 1;try{const e=t[0],s=i[0];return e===s?t[1]-i[1]:e-s}catch(t){return-1}})).map((t=>"fluid"===t[0]?"fluid":t[0]+"x"+t[1])).join("|"):t.join("x")}applyLoggerData(t,i,e){if(n.default.isBrowsiLoggerActive()){const s=this.buildLoggerData(t,i,e);window.dispatchEvent(new CustomEvent("fetch_end",{detail:s}))}}buildLoggerData(t,i,e){var s,r,o,h,a,c,l;const d=n.default.getGAMResponseInfo(t.slot,t);let u=(null===(s=t.slot)||void 0===s?void 0:s.getSizes())||[];const v=null==u?void 0:u.map((t=>{if("string"==typeof t)return t;const i=Object.values(t);return{w:i[0],h:i[1]}})),f=t.providerName===_.ProviderType.GENERIC_JS?(()=>{var t,i,s;const n=null===(t=e.c.a)||void 0===t?void 0:t.template,r=(null==n?void 0:n.n)?`V(${null===(s=null===(i=n.n.match(/\d+\_\d+/))||void 0===i?void 0:i[0])||void 0===s?void 0:s.replace("_",".")})`:"";return`${null==n?void 0:n.p} ${r}`})():void 0,p=null===(r=e.c.b)||void 0===r?void 0:r.map((t=>t.bc.bidder));return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({demandType:t.providerName,placement:null===(o=t.newBrowsiAd)||void 0===o?void 0:o.adContainer,adUnit:(null===(h=t.slot)||void 0===h?void 0:h.getAdUnitPath())||(null===(a=t.genericParams)||void 0===a?void 0:a.adUnit),requestedSizes:v,targeting:null===(c=t.slot)||void 0===c?void 0:c.getTargetingMap(),responseSize:t.implementedSize||null,refreshCount:t.refreshCount||0,orderId:(null==d?void 0:d.oid)||null,lineItemId:(null==d?void 0:d.lid)||null},t.providerName===_.ProviderType.DFP||t.providerName===_.ProviderType.GENERIC_JS?{}:{winner:i.status===w.Status.SUCCESS?"GAM":"NONE"}),i.status!==w.Status.SUCCESS?{noFill:!0}:{}),p?{biddersList:p}:{}),f?{templateName:f}:{}),(null===(l=t.genericParams)||void 0===l?void 0:l.loggerData)?{genericData:t.genericParams.loggerData}:{})}handleForcedRefreshNonEmptyEvent(t,i,e,s){y.ViewabilityService.instance.unsubscribe(this.spot),this.Yi(t,i,"forced_refresh");const n=this.spot.type===d.SpotType.STICKY||"s"===this.spot.tags.positionTag;y.ViewabilityService.instance.subscribe(this.spot.ie(e),S.ViewabilityConfigurations.vConfig(n),s),this.applyLoggerData(this.spot,{status:w.Status.SUCCESS,args:{provider:this.spot.providerName||""}},s)}}i.Provider=O,O.isApstagInitCalled=!1},3673:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProviderFactory=void 0;const s=e(1865),n=e(4730),r=e(9605),o=e(8228),h=e(3259);i.ProviderFactory=class{static generateProvider(t,i){switch(this.setSpotProviderName(t,i)){case n.ProviderType.INFRAME:return new h.Inframe(i,t.plk);case n.ProviderType.HEADER_BIDDING:return new o.HeaderBidding(i);case n.ProviderType.DFP:return i.providerName=n.ProviderType.DFP,new s.DFP(i);case n.ProviderType.GENERIC_JS:const e=t;return new r.GenericJs(i,e)}return null}static setSpotProviderName(t,i){var e;switch(i.genericParams.displayName=void 0,null==t?void 0:t.rt){case n.ProviderType.INFRAME:i.providerName=n.ProviderType.INFRAME;break;case n.ProviderType.HEADER_BIDDING:i.providerName=n.ProviderType.HEADER_BIDDING;break;case"empty_api":i.providerName=n.ProviderType.DFP;break;case"provider":const s=t;switch((null===(e=s.c.a)||void 0===e?void 0:e.template)&&(i.providerName=n.ProviderType.GENERIC_JS,i.genericParams.displayName=s.c.a.template.p),s.c.p){case n.ProviderType.DFP:i.providerName=n.ProviderType.DFP;break;case n.ProviderType.GENERIC_JS:i.providerName=n.ProviderType.GENERIC_JS}}return i.providerName||null}}},3802:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.YieldClient=void 0;const s=e(1250),n=e(4987),r=e(7579),o=e(4490),h=e(8431),a=e(394),c=e(6761),l=e(4752),d=e(7111),u=e(9839),v=e(8473),f=e(2593),p=e(3434),m=e(238),g=e(9310),b=e(4560),w=e(4730);class _{constructor(){this.logger=new s.default("YieldClient"),this.profile=a.Profiler.get(),this.demandManager=new o.DemandManager,this.isHidden="hidden"===document.visibilityState}static get(){return _.instance||(_.instance=new _),_.instance}He(t){const i=b.InframeManager.get();t.some((t=>t.type===c.SpotType.DYNAMIC))&&i.isInframeConfigured()&&(i.addPotentialSpots(t),i.sendPotentialSpots()),this.demandManager.updateSRAState(t),this.runPreDemand(t),this.prepareSpotsForAPIRelocation(t).then((t=>{this.demandManager.demandCounter=t.filter((t=>!t.isLazyLoading)).length,t.length&&this.We(t,r.DemandRequestType.SRA)}))}prepareSpotsForAPIRelocation(t){return new Promise((i=>{const e=m.DemandTool.get().relocateSpots;if(!m.DemandTool.get().relocationActive||!e.length)return i(t);const s=t.filter((t=>t.type===c.SpotType.DYNAMIC));if(!(s.length<e.length))return i(t);e.forEach((t=>{t.relocationStatus=-1})),m.DemandTool.get().proceedRelocation(!1).then((()=>{var e;return s.length&&!(null===(e=f.SpotsUtils.getConf(s[0].tags))||void 0===e?void 0:e.maxItems)?(s.forEach((t=>{d.default.get().sendAdRequestBlockedEvent(t,"relocation_fail","")})),i(t.filter((t=>t.type!==c.SpotType.DYNAMIC)))):i(t)})).catch((e=>(this.logger.error("error while resolving relocation",e),i(t))))}))}We(t,i){if(this.profile.analysisMode)return;let e="";if(t[0].isRefreshing()&&!!this.profile.blockLineItemIds||i===r.DemandRequestType.SINGLE)if(1===t.length){const i=t[0];e=this.buildGetDemandUrl(i)}else this.logger.error("invalid spots list",t);else i===r.DemandRequestType.SRA&&(e=this.buildGetSRADemandUrl(t));e?this.qe(e,t):this.logger.error("error building demand url",t)}qe(t,i){if(this.profile.analysisMode)return;const e=[...i];n.default.xhrPromise(t,"GET").then((s=>{var n,r,o;if(204===s.status)this.demandManager.Vi(null,e);else if(202===s.status)this.handleRefreshBlocked(e);else if(200===s.status){const t=JSON.parse(s.responseText),i=this.convertDemand(t);1===e.length&&(null===(n=e[0].refresh)||void 0===n?void 0:n.isGenericRefresh(e[0]))?null===(o=(r=e[0].genericParams).refresh)||void 0===o||o.call(r,i):(b.InframeManager.get().isInframeConfigured()&&"SRA"===t.rt&&b.InframeManager.get().setTotalVideosToEmbedCount(i),this.runPostDemand(i,e),this.demandManager.Vi(i,e))}else d.default.get().sendErrorEvent(g.EventType.XHR_ERROR,t,"get demand failed"),this.logger.error(`Error on get demand. url:${t},spots ${i}`)})).catch((i=>{d.default.get().sendErrorEvent(g.EventType.XHR_ERROR,t,(null==i?void 0:i.message)||"get demand failed"),this.logger.error("error on xhr promise",i)}))}convertDemand(t){return function(t){return"SRA"===t.rt}(t)?this.convertSRADemand(t):this.convertSingleDemand(t)}convertSRADemand(t){const i=t=>{const i={};for(let e in t)i[e]=this.convertSingleDemand(t[e]);return i};return{rt:"SRA",ods:(t=>{const i={};for(let e in t)i[e]={50:t[e]};return i})(t.ps),c:t.c.c?i(t.c.c):{},fc:(t=>{const i={};for(let e in t){i[e]={};for(let s in t[e])i[e][s]=this.convertSingleDemand(t[e][s])}return i})(Object.assign({},t.c.fc||{},t.c.fb||{},t.c.ft||{})),ac:t.c.ac?i(t.c.ac):{}}}convertSingleDemand(t){var i;let e=Object.assign(Object.assign({rt:"header_bidding"===t.rt?"header_bidding":"provider",setTargeting:t.setTargeting,plk:t.plk,szs:t.c.szs},t.p?{od:{50:t.p}}:{}),{is:t.is});return"header_bidding"===t.rt?(e.c=Object.assign({if:t.c.if,t:t.c.hb?t.c.hb.t:(null===(i=t.c.tam)||void 0===i?void 0:i.t)||0,ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr}},t.c.hb?{b:t.c.hb.b.map((t=>Object.assign(Object.assign({},t.a?{a:t.a}:{}),{bc:{bidder:t.c,params:t.p}})))}:{}),t.c.gam&&(e.c.d=s())):e.c=s(),e;function s(){const i=t.rt===w.ProviderType.GENERIC_JS;return Object.assign(Object.assign({a:Object.assign(Object.assign({upc:"true",autoSize:"true"},i?{url:t.c.u,withCallback:t.c.c?"true":"false",isJS:t.c.js?"true":"false",template:t.c.tm}:{}),{inIFrame:t.c.if?"true":"false"})},t.c.tam?{tam:{adServer:t.c.tam.a,pubID:t.c.tam.p,slotName:t.c.tam.s||t.c.gam.au,timeout:t.c.tam.t,simplerGPT:!!t.c.tam.sgpt}}:{}),i?{p:w.ProviderType.GENERIC_JS,aup:t.c.au||"",ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr},t:t.c.t,pgkv:t.c.slt?n(t.c.slt):{}}:{aup:t.c.gam.au,ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr},p:"dfp",pgkv:t.c.gam?n(t.c.gam.t):{}})}function n(t){const i={};return t.forEach((t=>{i[t.k]={v:t.v,j:t.j}})),i}}buildGetSRADemandUrl(t){let i=Object.assign(Object.assign(Object.assign({},this.Ge(t[0].isDcs)),{ac:u.default.getDcsActionCounter()}),this.buildPotentialSpotsParams(t));if(m.DemandTool.get().relocateSpots.length){const t=[],e=[];m.DemandTool.get().relocateSpots.forEach((i=>{var s;t.push(i.ref.id),e.push((null===(s=i.options)||void 0===s?void 0:s.adUnit)||"")})),i.div=t.join("||"),i.au=e.join("||")}return p.default.hasUserConsent&&Object.assign(i,this.getUserStatistics()),`//${this.profile.demandHost}/sra/mobile?${n.default.qt(i)}`}buildGetDemandUrl(t){let i=Object.assign(Object.assign(Object.assign({},this.Ge(t.isDcs)),{ac:u.default.getDcsActionCounter()}),this.buildAdData(t));return p.default.hasUserConsent&&Object.assign(i,this.getUserStatistics()),`//${this.profile.demandHost}/single/mobile?${n.default.qt(i)}`}buildAdData(t){var i;const e={if:t.Li>1,ai:t.spotIndex,st:t.type,al:n.default.B(t.ref).y,f:n.default.tt(t),ll:t.isLazyLoading,pt:t.positionType,rc:t.refreshCount,di:n.default.T(t.demandIndex)?t.spotIndex:t.demandIndex},s=n.default.getGAMResponseInfo(t.slot,t);return(null==s?void 0:s.lid)&&(e.li=null==s?void 0:s.lid),(null==s?void 0:s.oid)&&(e.oi=null==s?void 0:s.oid),(t.type===c.SpotType.API||t.relocationPlid)&&(e.div=t.relocationPlid||t.ref.id,e.au=null===(i=t.options)||void 0===i?void 0:i.adUnit),t.selector&&(e.s=t.selector),e}buildPotentialSpotsParams(t){let i={};return t.map(((e,s)=>{const n=this.buildSRAUrlParamPotentialSpot(e);for(let e in n)i[e]=i[e]||[],i[e].push(n[e]),s+1===t.length&&(i[e]=i[e].join("||"))})),i}buildSRAUrlParamPotentialSpot(t){return{ais:t.spotIndex,als:n.default.B(t.ref).y,fs:n.default.tt(t),lls:t.isLazyLoading,sts:t.type,pts:t.positionType,ss:t.selector?t.selector:"",dis:n.default.T(t.demandIndex)?t.spotIndex:t.demandIndex}}getUserStatistics(){const t=v.default.get().analytics;return{bi:t.bi,bv:t.bv,sp:t.uv.t_sp,tiv:t.tiv.b_ativ,pv:t.pv,pi:t.pi,av:t.uv.t_a,oof:t.aof.t_a}}handleRefreshBlocked(t){t[0].refresh&&(t[0].refresh.active=!1),d.default.get().sendAdRequestBlockedEvent(t[0],"liIdBl","")}Ge(t){var i,e,s,r,o,h;const a=Object.assign(Object.assign({sk:this.profile.siteKey,pk:this.profile.publisherKey,pvid:this.profile.pageViewID,aid:this.profile.articleId,sid:this.profile.sessionID,uid:l.default.getUserID(),pu:n.default._i(),pl:n.default.M(),d:t,sh:n.default.H(),lid:this.profile.supplyConfigId,ts:this.profile.trafficSource,cc:this.profile.countryCode,ir:this.profile.isReturningUser,ul:n.default.W(),do:null===(i=this.profile.deviceType)||void 0===i?void 0:i.os,dd:null===(e=this.profile.deviceType)||void 0===e?void 0:e.device,dp:null===(s=this.profile.deviceType)||void 0===s?void 0:s.devicePlatform,db:null===(r=this.profile.deviceType)||void 0===r?void 0:r.browser,vpv:this.profile.predictorsVersions.viewability},"number"==typeof(null===(o=this.profile.spotsSupplyParams.lazySpots)||void 0===o?void 0:o.threshold)?{lt:null===(h=this.profile.spotsSupplyParams.lazySpots)||void 0===h?void 0:h.threshold}:{}),this.profile.shadowPublisher?{spk:this.profile.shadowPublisher.pk,ssk:this.profile.shadowPublisher.sk,sli:this.profile.shadowPublisher.scid}:{}),c=n.default.yi();return c.length>0&&(a.qp=c),a}handleWaterfallFailed(t,i,e){this.logger.error("waterfall failed",t),e&&this.logger.logWaterfallDetails(i,e,h.Status.FAILURE),i.isRefreshing()||this.getNextDemandFromYield(i)}getNextDemandFromYield(t){if(t.Li++,t.Li>2)return this.demandManager.Vi(null,[t]);this.We([t],r.DemandRequestType.SINGLE)}runPreDemand(t){const i=l.default.getExternalFlowHandler("onPreDemand");i&&i(t)}runPostDemand(t,i){const e=l.default.getExternalFlowHandler("onPostDemand");e&&e(t,i)}}i.YieldClient=_},7527:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CUSTOM_REFRESH_RESPONSES_MAP=void 0,i.CUSTOM_REFRESH_RESPONSES_MAP={[-1]:"found rule with no refresh",[-2]:"not found rule",[-3]:"refresh blocked by black/white list",[-4]:"not found line item type in cache",[-5]:"missing publisher refresh rates rules",[-6]:"server error"}},1865:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DFP=i.MIN_AD_SIZE=void 0;const s=e(143),n=e(1250),r=e(4987),o=e(4730),h=e(7709),a=e(7646),c=e(7250),l=e(8431),d=e(4752),u=e(8406);i.MIN_AD_SIZE=5;class v extends s.Provider{constructor(t,i){super(t),this.Te=new n.default("DFP"),this.isPubHeaderBidding=i||!1,this.Be=this.ue()}static isValidSize(t,e=!1){return e&&r.default.Zt(t)||t.w>i.MIN_AD_SIZE&&t.h>i.MIN_AD_SIZE}Ui(t,i){return new Promise(((e,s)=>{i.Je(this.spot,this.ze()).then((t=>this.Me(t))).then((i=>{this.pushGoogleTagCommands(i,t,e)})).catch((t=>{s({status:l.Status.ERROR})}))}))}pushGoogleTagCommands(t,i,e){let s=t.win.googletag||{};s.cmd=s.cmd||[],(s||this.spot.Li>1)&&(this.runProcessBeforeCallingDFP(i),this.je(i).then((()=>{s.cmd.push((()=>{this.pushGptCommands(t,i,e)}))})).catch((t=>{this.spot.handlePreFetchAsyncReject(t)})))}runProcessBeforeCallingDFP(t){var i;const e=d.default.getExternalFlowHandler("processBeforeCallingDFP");if(e){this.Te.info("processBeforeCallingDFP hook has been invoked"),t.setTargeting=t.setTargeting||[];const s=null===(i=r.default.getDemandConfig(t))||void 0===i?void 0:i.aup;t=r.default.convertToOldStyleAdUnit(t),e(u.default.getSpots(),this.spot.spotIndex,t),t=s?r.default.convertToNewStyleAdUnit(t,s):t}}pushGptCommands(t,i,e){const s=t.win.googletag,n=(s.pubads().getSlots().length,this.Se(!0));this.spot.Xe(s.defineSlot(i.c.aup,n,t.adContainer.id)),this.Te.info(`spot ${this.spot.spotIndex}, definedSlot: ${this.spot.slot.getAdUnitPath()} ${JSON.stringify(n)}`);const r="false"===i.c.a.upc||!i.c.a.upc;this.Ce(this.spot.slot,this.Ue(i)),this.spot.slot.addService(s.pubads()),this.setGoogleTagPrivacy(s),s.enableServices(),this.runPreGoogletagDisplay(this.spot),t.isIframe?s.display(t.adContainer):s.pubads().isInitialLoadDisabled()?(s.display(t.adContainer),s.pubads().refresh([this.spot.slot],{changeCorrelator:r})):(r&&googletag.pubads().updateCorrelator(),s.display(t.adContainer)),s.pubads().addEventListener("slotRequested",(e=>{if(this.De(e,t.adContainer.id)){this.Te.verbose(`dfp(da) slotRequestedEvent ${t.adContainer.id}`),this.spot.spotRequested++;const e=this.Ve()?"forced_refresh":void 0;this.ve(i.c.aup,i.plk,this.Se(!0),void 0,e)}})),s.pubads().addEventListener("slotRenderEnded",(s=>{this.De(s,t.adContainer.id)&&(this.Ve()?this.handleForcedRefreshSlotRenderEnded(i,s):(this.handleSlotRenderEnded(t,i,t.adContainer.id,s,e),this.spot.Ke()))})),s.pubads().addEventListener("slotOnload",(t=>{if(this.spot.slot!=t.slot)return;this.Te.info("send measurable event after slotOnload listener for spot ",this.spot.spotIndex);new c.default(this.spot,i.c.aup,i.plk).sendEvent("DFP slot loaded")}))}handleForcedRefreshSlotRenderEnded(t,i){this.spot.isMeasurable=!1,this.pe(t,!i.isEmpty,"forced_refresh",r.default.getGAMResponseInfo(i.slot)),i.isEmpty||this.handleForcedRefreshNonEmptyEvent(t.c.aup,t.plk,{forcedRefresh:!0,adUnit:t.c.aup},t)}handleSlotRenderEnded(t,i,e,s,n){var c,d;let u=r.default.At(s);s.size&&this.spot.Ye(u),this.Te.info(`dfp returned ${s.isEmpty?"empty":JSON.stringify(u)} for ${e}`),this.pe(i,!s.isEmpty,void 0,r.default.getGAMResponseInfo(s.slot)),s.isEmpty?(h.Embedder.Ne(t.adWrapper),n({status:l.Status.FAILURE,refresh:null===(c=this.spot.refresh)||void 0===c?void 0:c.isRefreshing})):(this.spot.isRefreshing()&&(t.win.googletag.destroySlots([null===(d=this.spot.refresh)||void 0===d?void 0:d.oldSlot]),this.Fe()),t.display(this.Le(i.c.a)),r.default.Xt(e),n({status:l.Status.SUCCESS,args:{provider:o.ProviderType.DFP,adUnit:i.c.aup}})),a.default.get().waitForBrowsiAV(s.slot,t,i,this.spot)}}i.DFP=v},7579:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DemandRequestType=void 0,function(t){t.SRA="SRA",t.SINGLE="SINGLE"}(i.DemandRequestType||(i.DemandRequestType={}))},9605:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.GenericJs=void 0;const s=e(143),n=e(1250),r=e(4987),o=e(4730),h=e(8431),a=e(8406),c=e(394),l=e(7111),d=e(1865),u=e(4752),v=e(4560),f=e(8234),p=e(9497),m=e(9166);class g extends s.Provider{constructor(t,i){super(t),this.dfpRequested=0,this.Te=new n.default("GenericJS"),this.isJs="true"===i.c.a.isJS,this.snippetUrl=i.c.a.url,this.isCallback="true"===i.c.a.withCallback,this.template=i.c.a.template,this.callbackInvoked=!1,this.manualFailureReported=!1,this.adUnit=i.c&&i.c.aup||"NA",this.placementKey=i.plk,this.demandResponse=i}Ui(t,i){return new Promise(((e,s)=>i.Je(this.spot,this.ze()).then((i=>{this.je(t).then((()=>(this.ve(this.adUnit,this.placementKey,[]),r.default.xhrPromise(this.snippetUrl).then((t=>t.status&&200===t.status?t.responseText:Promise.reject({status:h.Status.GENERIC_SNIPPET_ERROR,msg:"no response. status - "+t.status}))).then((s=>this.runSnippet(i,s,t,e))).then((s=>this.handleResult(s,i,t,e))).catch((i=>{this.Te.error(i),this.pe(t,!1,h.Status.GENERIC_SNIPPET_ERROR,void 0,(null==i?void 0:i.msg)||""),s({status:h.Status.GENERIC_SNIPPET_ERROR,args:{provider:o.ProviderType.GENERIC_JS,adUnit:"NA"}})}))))).catch((t=>{this.spot.handlePreFetchAsyncReject(t)}))})).catch((i=>{this.pe(t,!1,h.Status.GENERIC_SNIPPET_ERROR),s({status:h.Status.GENERIC_SNIPPET_ERROR,args:{provider:o.ProviderType.GENERIC_JS,adUnit:"NA"}})}))))}handleResult(t,i,e,s){if(t.status===h.Status.SUCCESS){if(this.Qi(this.spot),!this.isCallback){let t=!1;i.adContainer.style.display="block",this.Te.verbose("starting valid size interval");const n=setInterval((()=>{this.manualFailureReported&&clearInterval(n),this.isValidAdSize(i)&&(clearInterval(n),t=!0,this.validAdSizeCallback(i,e,s))}),200);setTimeout((()=>{t||this.manualFailureReported||(clearInterval(n),this.spot.browsiAd=i.adContainer,this.pe(e,!1),s({status:h.Status.FAILURE}))}),e.c.t)}}else s(t)}getAdSize(t){var i;if(!(null===(i=this.spot.placeholder)||void 0===i?void 0:i.active))return r.default.G(t.adContainer);let e={w:0,h:0};return t.adContainer.childNodes.forEach((t=>{if(r.default.O(t)){const i=r.default.G(t);e.w=Math.max(e.w,i.w),e.h+=i.h}})),e}isValidAdSize(t){const i=u.default.getExternalFlowHandler("isValidGenericSize");if(i)return i(t,this.spot);{const i=this.getAdSize(t);return i.w>d.MIN_AD_SIZE&&i.h>d.MIN_AD_SIZE}}validAdSizeCallback(t,i,e){var s;if(!this.callbackInvoked){this.Te.info("callback triggered",this.spot.demandIndex,i),this.spot.browsiAd=t.adContainer,(null===(s=this.spot.newBrowsiAd)||void 0===s?void 0:s.adMarking)&&(this.spot.newBrowsiAd.adMarking.style.display="block");const n=r.default.G(this.spot.browsiAd);if(this.isCallback&&!this.isValidAdSize(t))return this.handleFailure(i,e);this.spot.Ye(n),this.pe(i,!0),e({status:h.Status.SUCCESS,args:{provider:o.ProviderType.GENERIC_JS}})}}handleFailure(t,i){this.Te.info(`ad height < ${d.MIN_AD_SIZE} for spot`,this.spot.demandIndex),this.pe(t,!1),this.spot.Hi(),a.default.removeStickyAd(this.spot),i({status:h.Status.FAILURE})}runSnippet(t,i,e,s){return this.isJSONPTemplate()?(this.spot.spotRequested++,m.default.registerToGoogleTagEvent("slotRenderEnded",{spot:this.spot,callback:this.googleTagEventCallback.bind(this)}),m.default.registerToGoogleTagEvent("slotRequested",{spot:this.spot,callback:this.googleTagEventCallback.bind(this)}),this.prepareTemplateFunction(t,e,s)):new Promise(((n,o)=>{this.isCallback&&this.assignBrowsiCallbackToWindow(t,e,s),t.adContainer.className=t.adContainer.id;let a=i.replace(/<DIV_ID>/g,`${t.adContainer.id}`).replace(/<SPOT_INDEX>/g,this.spot.spotIndex.toString()).replace(/<DEMAND_INDEX>/g,this.spot.demandIndex.toString()).replace(/<BROWSI_VIEWABILITY_PREDICTION>/g,this.getPredictionReplaceValue(e)).replace(/<PAGEVIEW_ID>/g,c.Profiler.get().pageViewID).replace(/<LAYOUT_ID>/g,c.Profiler.get().supplyConfigId).replace(/"<SPOT_SIZES>"/g,JSON.stringify(this.Se(!0))).replace(/"<TARGETING>"/g,JSON.stringify(this.Ue(e))).replace(/<VIDEO_IDX>/g,JSON.stringify(v.InframeManager.get().getVideoIndex(this.spot.spotIndex)));if(this.template)for(let t in this.template.pr){const i=new RegExp(t,"g");a=a.replace(i,this.template.pr[t])}if(this.assignFunctionsToBrowsiTag(e,s),this.Te.verbose("running snippet",a),a)if(this.isJs)try{t.win.eval(a),n({status:h.Status.SUCCESS})}catch(t){this.Te.error(t),o({status:h.Status.GENERIC_SNIPPET_ERROR,msg:t.message})}else{t.adContainer.innerHTML=a;const i=r.default.Qt(t.adContainer);this.copyAndAppendScriptTag(t.adContainer,i,n)}}))}isJSONPTemplate(){var t;return!!(null===(t=this.template)||void 0===t?void 0:t.n)}prepareTemplateFunction(t,i,e){return new Promise(((s,n)=>{var o;const h=null===(o=this.template)||void 0===o?void 0:o.n,a=this.buildTemplateArguments(t,i,e);"function"==typeof t.win[h]?this.runTemplateFunction(h,t.win,a,s,n):r.default.Dt(this.snippetUrl,t.win.document.body,t.isIframe).then((()=>{this.runTemplateFunction(h,t.win,a,s,n)}))}))}runTemplateFunction(t,i,e,s,n){try{const n=i[t](e);"function"==typeof(null==n?void 0:n.refresh)&&(this.spot.genericParams.refresh=this.invokeRefreshCallback.bind(this,n.refresh)),s({status:h.Status.SUCCESS})}catch(t){this.Te.error("Error while running template function",t),n({status:h.Status.GENERIC_SNIPPET_ERROR,msg:t.message})}}buildTemplateArguments(t,i,e){var s,n,r;const o=this.isCallback?(s,n,r)=>this.browsiCallback(t,i,e,s,n,r):void 0;return Object.assign(Object.assign({divId:t.adContainer.id,spotIndex:this.spot.spotIndex,demandIndex:this.spot.demandIndex,viewabilityPrediction:this.getPredictionReplaceValue(i),pageviewID:c.Profiler.get().pageViewID,layoutID:c.Profiler.get().supplyConfigId,spotsSizes:this.Se(!0),targeting:this.Ue(i),adUnit:i.c.aup,refreshRate:(null===(s=i.c.ri)||void 0===s?void 0:s.r)||-1,templateParams:null===(n=this.template)||void 0===n?void 0:n.pr},i.c.tam?{amznBidConf:{pubID:i.c.tam.pubID,adServer:i.c.tam.adServer,slotName:i.c.tam.slotName,timeout:i.c.tam.timeout,simplerGPT:i.c.tam.simplerGPT}}:{}),{sendActiveViewEvent:()=>{this.sendActiveViewEvent(i)},sendGeneralDataEvent:this.sendGeneralDataEvent,reportManualFailureEvent:t=>{this.reportManualFailureEvent(i,e,t)},mapAdUnitToSpot:t=>{this.setAdUnitMap(t)},callback:o,inframeVideoIdx:v.InframeManager.get().getVideoIndex(this.spot.spotIndex),prebidGlobalInstanceName:(null===(r=c.Profiler.get().prebidData)||void 0===r?void 0:r.globalInstanceName)||"pbjs"})}setAdUnitMap(t){this.spot.genericParams.adUnitMap=t}assignFunctionsToBrowsiTag(t,i){const e=window.browsitag;e.__gs=e.__gs||{},e.__gs[this.spot.spotIndex]={av:()=>{this.sendActiveViewEvent(t)},gd:this.sendGeneralDataEvent,rmf:e=>{this.reportManualFailureEvent(t,i,e)}}}sendActiveViewEvent(t){l.default.get().sendViewedImpressionAV(this.spot,t)}sendGeneralDataEvent(t,i){l.default.get().sendGeneralDataEvent(t,i)}reportManualFailureEvent(t,i,e){this.manualFailureReported||this.callbackInvoked||(this.manualFailureReported=!0,this.pe(t,!1,e)),i({status:h.Status.FAILURE})}getPredictionReplaceValue(t){const i=r.default.getPredictionToSend(t);return i?this.xe(i):""}copyAndAppendScriptTag(t,i,e){Array.from(i).forEach((i=>{let e=document.createElement("script");Array.from(i.attributes).forEach((t=>{e.setAttribute(t.name,t.value)})),i.parentElement&&i.parentElement.removeChild(i),e.text=i.text,t.appendChild(e)})),e({status:h.Status.SUCCESS})}assignBrowsiCallbackToWindow(t,i,e){window[`browsiCallback_${this.spot.spotIndex}`]=(s,n)=>this.browsiCallback(t,i,e,s,n)}browsiCallback(t,i,e,s,n,r){var a,c,l;this.callbackInvoked=!0;const d=v.InframeManager.get().isProviderInframe(this.spot);if(this.Te.info("spot: ",this.spot),this.spot.genericParams.gamInfo=(null==r?void 0:r.gamInfo)==={}||null==r?void 0:r.gamInfo,this.spot.genericParams.adUnit=null==r?void 0:r.adUnit,this.spot.genericParams.loggerData=null==r?void 0:r.loggerData,!this.manualFailureReported)if(s){this.spot.browsiAd=t.adContainer,this.pe(i,!1,n,this.spot.genericParams.gamInfo),d&&v.InframeManager.get().handleVideoWithoutDemand();const s={status:h.Status.FAILURE};(null===(a=this.spot.refresh)||void 0===a?void 0:a.isRefreshing)&&this.applyLoggerData(this.spot,s,i),e(s)}else{this.spot.browsiAd=t.adContainer,this.pe(i,!0,void 0,this.spot.genericParams.gamInfo),null===(c=this.spot.newBrowsiAd)||void 0===c||c.display(!1);const s={status:h.Status.SUCCESS,args:{provider:o.ProviderType.GENERIC_JS}};(null===(l=this.spot.refresh)||void 0===l?void 0:l.isRefreshing)&&(this.Yi(this.adUnit,this.placementKey),u.default.isCustomRefreshConfigured()&&this.spot.initCustomRefreshRate(),p.ViewabilityService.instance.subscribe(this.spot.ie({adUnit:this.adUnit}),f.ViewabilityConfigurations.vConfig(),i),this.spot.refresh.handleSuccess(),this.applyLoggerData(this.spot,s,i)),d&&v.InframeManager.get().handleVideoWithDemand(this.spot.spotIndex),e(s)}}ze(){return!0}getRefreshTemplateValues(t){return{targeting:this.Ue(t)}}invokeRefreshCallback(t,i){t&&(p.ViewabilityService.instance.unsubscribe(this.spot),this.spot.spotRequested++,this.ve(this.adUnit,this.placementKey,[]),t(this.getRefreshTemplateValues(i)))}isForcedRefresh(){return this.dfpRequested>this.spot.spotRequested&&!this.spot.isRefreshing()}googleTagEventCallback(t,i){switch(t){case"slotRenderEnded":this.onSlotRenderEnded(i);break;case"slotRequested":this.onSlotRequested(i)}}onSlotRenderEnded(t){this.isForcedRefresh()&&(this.spot.isMeasurable=!1,this.pe(this.demandResponse,!t.isEmpty,"forced_refresh"),t.isEmpty||this.handleForcedRefreshNonEmptyEvent(this.adUnit,this.placementKey,{adUnit:this.adUnit,forcedRefresh:!0},this.demandResponse)),this.dfpRequested=0,this.spot.spotRequested=0}onSlotRequested(t){this.dfpRequested++,this.isForcedRefresh()&&this.ve(this.adUnit,this.placementKey,[],void 0,"forced_refresh")}}i.GenericJs=g},3259:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Inframe=void 0;const s=e(143),n=e(1250),r=e(8431),o=e(4730),h=e(7111),a=e(4560);class c extends s.Provider{constructor(t,i){super(t),this.Te=new n.default("Inframe");const e=a.InframeManager.get();this.adImpressionListener=t=>{t.detail.inframeId===e.inframeId&&(this.Qe("",i),window.removeEventListener("video_ad_impression",this.adImpressionListener))},e.shouldFetchDynamicVideo(!1,t.type)&&window.addEventListener("video_ad_impression",this.adImpressionListener)}Ui(t,i){return this.je(t).then((()=>new Promise(((e,s)=>{this.ve("",t.plk,this.Se(!1));let n=!1;try{a.InframeManager.get().activateVideo(this.spot.spotIndex),n=!0}catch(t){this.Te.error("video activation failed",t)}const h=n?void 0:"video activation failed";this.pe(t,n,h),n?i.Je(this.spot,this.ze()).then((t=>{e({status:r.Status.SUCCESS,args:{provider:o.ProviderType.INFRAME}})})).catch((t=>{s({status:r.Status.ERROR})})):s({status:r.Status.ERROR})}))))}ze(){return!0}Yi(t,i){}Qe(t,i){this.we(t,i)}ye(t,i,e){h.default.get().Ze(this.spot,i,e)}fe(t,i,e,s){h.default.get().ns(this.spot,i)}me(t,i,e,s,n,r){h.default.get().hs(this.spot,t,e,s)}}i.Inframe=c},4560:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.InframeManager=i.INFRAME_DISPLAY_NAME=void 0;const s=e(394),n=e(7111),r=e(4730),o=e(1250),h=e(6761);i.INFRAME_DISPLAY_NAME="video";class a{constructor(){var t,i;this.potentialSpots={},this.totalVideosToEmbedCount=0,this.videosHandledCount=0,this.spotToVideoIdxMap={},this.spotsWithDemand={},this.logger=new o.default("Inframe"),this.inframeConf=Object.assign({},null===(t=s.Profiler.get().loaderParams)||void 0===t?void 0:t.ly.inf),this.inframeId=this.inframeConf.id,this.isDynamicVideoConfigured=!!(null===(i=this.inframeConf)||void 0===i?void 0:i.dv)}static get(){return a.instance||(this.instance=new a),a.instance}addPotentialSpots(t){t.forEach((t=>{const i=document.createElement("div"),e=document.createElement("div");i.setAttribute("style","display:none"),e.setAttribute("style","display:none"),i.setAttribute("pp",t.spotIndex.toString()),e.setAttribute("pp",t.spotIndex.toString()),e.appendChild(i),t.ref.insertAdjacentElement("beforebegin",e),this.potentialSpots[t.spotIndex]={adContainer:i,adWrapper:e}}))}sendPotentialSpots(t){const i=window;i.avnts=i.avnts||{hasDemand:t=>!1,placements:[],activation:[]};const e=[];for(let t in this.potentialSpots)e.push({element:this.potentialSpots[t].adContainer,adIndex:t});const s={placements:e};t?(t.slice(1).forEach(((t,e)=>{i.avnts.placements.push({index:e+1,data:s}),this.addVideoIndex(e+1,t)})),n.default.get().sendInframePlacementEvent(e.length)):(i.avnts.placements.push({index:0,data:s}),this.addVideoIndex(0),n.default.get().sendInframePlacementEvent(e.length))}handleVideoWithDemand(t){this.moveSpotToDemandList(t),this.increaseVideosHandledCount()}moveSpotToDemandList(t){this.spotsWithDemand[t]=this.potentialSpots[t],delete this.potentialSpots[t]}handleVideoWithoutDemand(){this.increaseVideosHandledCount()}getSpotContainers(t){return this.potentialSpots[t]||this.spotsWithDemand[t]}setTotalVideosToEmbedCount(t){if(this.isDynamicVideoConfigured)return void(this.totalVideosToEmbedCount=1);const e=t.c,s=Object.keys(e).filter((t=>{var s,n;return(null===(n=null===(s=e[t].c.a)||void 0===s?void 0:s.template)||void 0===n?void 0:n.p)===i.INFRAME_DISPLAY_NAME}));this.totalVideosToEmbedCount=s.length,s.length>1&&this.sendPotentialSpots(s)}increaseVideosHandledCount(){this.videosHandledCount++,this.isHandledAllVideos()&&this.removeAllPotentialSpotsContainers()}isHandledAllVideos(){return this.totalVideosToEmbedCount===this.videosHandledCount}removeAllPotentialSpotsContainers(){Object.keys(this.potentialSpots).forEach((t=>{var i;const e=this.potentialSpots[t];null===(i=e.adWrapper.parentElement)||void 0===i||i.removeChild(e.adWrapper)}))}getVideoIndex(t){const i=this.spotToVideoIdxMap[t];return void 0===i?0:i}addVideoIndex(t,i){void 0!==i&&(this.spotToVideoIdxMap[i]=t)}isProviderInframe(t){return t.genericParams.displayName===i.INFRAME_DISPLAY_NAME||t.providerName===r.ProviderType.INFRAME}isInframeConfigured(){return!!this.inframeId&&this.isDynamicVideoConfigured}shouldFetchDynamicVideo(t,i){return i===h.SpotType.DYNAMIC&&this.isInframeConfigured()&&!this.isHandledAllVideos()&&!t}hasVideoDemand(t){var i;this.logger.verbose(`Requesting inframe has demand for adix:${t.spotIndex}`,t.ref);const e=window.avnts,s=(null==e?void 0:e.ready)&&"function"==typeof(null==e?void 0:e.hasDemand);let r=!1;const o=null===(i=this.potentialSpots[t.spotIndex])||void 0===i?void 0:i.adContainer;s&&o&&(r=null==e?void 0:e.hasDemand({index:this.videosHandledCount,element:o,adIndex:t.spotIndex}));const h=s?r?"":"no demand":"api not ready";return this.logger.verbose(`Response for inframe has demand, adix:${t.spotIndex}: isMatched:${!(!s||!r)}, reason: ${h||"none"} `,t.ref),n.default.get().ls(t,!(!s||!r),h),s&&r}activateVideo(t){const i=window.avnts,{adContainer:e}=this.getSpotContainers(t);this.handleVideoWithDemand(t),null==i||i.activation.push({index:this.videosHandledCount-1,data:{element:e,spotIndex:t}})}}i.InframeManager=a},4730:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ProviderType=void 0,function(t){t.DFP="dfp",t.GENERIC_JS="generic_js",t.ILX="ilx",t.HEADER_BIDDING="header_bidding",t.UNRULY="unruly",t.TEADS="teads",t.MANUAL_AD="manual_ad",t.MANUAL_IFRAME_AD="manual_iframe_ad",t.INFRAME="inframe",t.BROWSI_VIDEO="browsi_video"}(i.ProviderType||(i.ProviderType={}))},8126:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AuctionDataCollector=void 0;const s=e(1250),n=e(8406),r=e(7111),o=e(394);class h{constructor(){this.logger=new s.default("AuctionDataCollector"),this.matches={},this.profile=o.Profiler.get()}static get(){return h.instance||(this.instance=new h),h.instance}collectBidRequest(t,i,e){if(this.profile.collectHbEvents){const t=this.getSpotFromAdUnitCode(i);t?this.sendBidRequestEvent(t,e):this.logger.info("could not find spot for",i,"not sending bid request")}}collectBidMatch(t,i,e,s){this.profile.collectHbEvents&&(this.matches[t]=this.matches[t]||{},this.matches[t][i]=this.matches[t][i]||[],this.matches[t][i][+e.im]=this.matches[t][i][+e.im]||[],this.matches[t][i][+e.im].push(e),s&&this.sendBidMatches(t))}sendBidMatches(t){const i=this.getSpotFromAdUnitCode(t);if(!i)return void this.logger.info("could not find spot for",t,"not sending bid match");const e=this.bidMatchedParamsToEvent(this.matches[t]);e&&e.length&&r.default.get().sendBidMatch(i,e),this.matches[t]={}}bidMatchedParamsToEvent(t){let i=[];for(let e in t)t.hasOwnProperty(e)&&t[e].forEach((t=>{let s={n:e,im:t[0].im,s:[]};t[0].reqt&&t[0].rest&&(s.reqt=t[0].reqt,s.rest=t[0].rest),t[0].brc&&(s.brc=t[0].brc),t[0].au&&(s.au=t[0].au),t.forEach((t=>{t.s.forEach((i=>{s.s.push(Object.assign(Object.assign(Object.assign({},i),t.rsn?{rsn:t.rsn}:{}),t.br?{br:t.br}:{}))}))})),i.push(s)}));return i}getSpotFromAdUnitCode(t){let i;const e=n.default.getSpots();if(t.startsWith("browsi")){const s=t.split("_")[2];i=e.find((t=>t.spotIndex===+s))}else i=e.find((i=>{var e,s,n,r;return i.genericParams.adUnitMap===t||(null===(s=null===(e=i.newBrowsiAd)||void 0===e?void 0:e.adContainer)||void 0===s?void 0:s.id)===t||(null===(r=null===(n=i.newBrowsiAd)||void 0===n?void 0:n.adWrapper)||void 0===r?void 0:r.id)===t}));return i}collectDFPBidRequest(t,i){this.profile.collectHbEvents&&this.sendBidRequestEvent(t,i)}sendBidRequestEvent(t,i){const e=this.buildRequestParamsToEvent(i);e&&e.length&&r.default.get().sendBidRequests(t,e)}buildRequestParamsToEvent(t){let i=[];return t.forEach((t=>{for(let e in t)t.hasOwnProperty(e)&&i.push({n:e,s:t[e]})})),i}buildSizesFromArray(t){return t.map((t=>({w:t[0],h:t[1]})))}}i.AuctionDataCollector=h},4545:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HbProvider=void 0;const s=e(143),n=e(8126),r=e(4752),o=e(4987),h=e(7250),a=e(8406),c=e(3434);class l extends s.Provider{constructor(t){super(t)}isRefreshingDfpOnly(){var t,i;return this.spot.isRefreshing()&&!(!(null===(t=this.spot.refresh)||void 0===t?void 0:t.stickyRefresh)&&!(null===(i=this.spot.refresh)||void 0===i?void 0:i.dfpOnly))}requestDfpBid(t,i,e,s){this.Me(t).then((()=>{const n=this.Se(!0);this.pushGptCommands(n,t,s,i),this.subscribeToGptEvents(t,i,e)}))}subscribeToGptEvents(t,i,e){t.win.googletag.cmd.push((()=>{t.win.googletag.pubads().addEventListener("slotRequested",(e=>{this.Te.verbose(`dfp(da) slotRequestedEvent ${t.adContainer.id}`),this.slotAdRequestHandler(e,t,i)})),t.win.googletag.pubads().addEventListener("slotResponseReceived",(i=>{this.Te.verbose(`dfp(da) slotResponseReceived ${t.adContainer.id}`)})),t.win.googletag.pubads().addEventListener("slotRenderEnded",(s=>this.slotRenderEndedHandler(s,t,i,e))),t.win.googletag.pubads().addEventListener("slotOnload",(t=>this.slotOnloadHandler(t,i)))}))}runProcessBeforeCallingDFP(t){var i;const e=r.default.getExternalFlowHandler("processBeforeCallingDFP");if(e){this.Te.info("processBeforeCallingDFP hook has been invoked"),t.setTargeting=t.setTargeting||[];const s=null===(i=o.default.getDemandConfig(t))||void 0===i?void 0:i.aup;t=o.default.convertToOldStyleAdUnit(t),e(a.default.getSpots(),this.spot.spotIndex,t),t=s?o.default.convertToNewStyleAdUnit(t,s):t}}runPreDfpHB(t,i){var e;const s=r.default.getExternalFlowHandler("preDfpHB");if(s){const n=null===(e=o.default.getDemandConfig(t))||void 0===e?void 0:e.aup;t=o.default.convertToOldStyleAdUnit(t),s(this.spot,t,i),t=n?o.default.convertToNewStyleAdUnit(t,n):t}}hasAmazonBidder(t){return!(!t.c.d||!t.c.d.tam)}slotOnloadHandler(t,i){if(!this.spot.slot||this.spot.slot!=t.slot)return;new h.default(this.spot,i.c.d.aup,i.plk).sendEvent("DFP DA slot loaded")}buildAmazonPromise(t,i,e){return this.hasAmazonBidder(t)&&c.default.hasUserConsent?new Promise(((s,h)=>{const a=t.c.d.tam;this.Ee(e,a).then((t=>{const e=t.win.apstag,h=this.Se(!1),c=(null==a?void 0:a.slotName)||"",l=Object.assign({slots:[{slotID:i,slotName:c,sizes:h}]},a.timeout?{timeout:a.timeout}:{}),d=r.default.getExternalFlowHandler("preApsFetchBids");d&&d(l),e.fetchBids(l,(t=>{const e=t.find((t=>t.slotID===i));this.Te.info("amazon bid: ",e),this.Te.apsLog(e);const r=e&&e.size?o.default.ei(e.size):{w:-1,h:-1},h={im:!!e&&!!e.amzniid,s:[r],br:-1,au:c};return n.AuctionDataCollector.get().collectBidMatch(i,"aps",h,!0),s()}));const u=n.AuctionDataCollector.get();u.collectBidRequest("aps",i,[{aps:u.buildSizesFromArray(h)}])}))})):Promise.resolve()}getSizeForBidders(){return this.spot.isRefreshing()?this.spot.implementedSize||{w:1,h:1}:{w:-1,h:-1}}}i.HbProvider=l},8228:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.HeaderBidding=void 0;const s=e(4621),n=e(7111),r=e(4987),o=e(4730),h=e(7646),a=e(8431),c=e(394),l=e(1865),d=e(8126),u=e(9310),v=e(9166);class f extends s.PrebidJs{constructor(t){super(t),this.Be=this.ue(),this.adUnit=null}us(t,i,e,s){const r=this.usingBrowsiPbjs?0:1;if(this.hasDfpBidder(t)||this.ve(this.vs(t),t.plk,this.Se(!0),r),this.isRefreshingDfpOnly())this.requestDfpBid(i,t,e,!1);else{const r=i.adContainer.id;this.adUnit=this.hasBidders(t)?this.buildAdUnit(t.c.b,t.c.d,r,this.getSizeForBidders()):null,this.Ae(this.spot,this.adUnit,t);const o=this.buildHBPromise(t,this.adUnit,i,e),h=this.buildAmazonPromise(t,r,i);Promise.all([o,h]).then((()=>{const s=this.hasBidders(t)?this.getPrebidWinner(r):null,o=!!s;if(this.hasDfpBidder(t))this.requestDfpBid(i,t,e,o);else{if(s)return this.handleBidSuccess(s,i,t,e);n.default.get().ge(this.spot,!1,this.vs(t),t.plk,null,null),e({status:a.Status.FAILURE})}})).catch((t=>{this.Te.error(t),s({status:a.Status.FAILURE})}))}}vs(t){var i;return(null===(i=t.c.d)||void 0===i?void 0:i.aup)||"NA"}buildHBPromise(t,i,e,s){return i&&this.hasBidders(t)?new Promise((n=>{this.pbjsInstance&&(this.pbjsInstance.que=this.pbjsInstance.que||[],this.pbjsInstance.que.push((()=>{if(this.pbjsInstance){this.pbjsInstance.addAdUnits(i),this.pbjsInstance.setConfig(this.getConfig(t.c.t)),this.addConfigByProvider(t.c.b||[]),this.pbjsInstance.onEvent("bidWon",(i=>this.winnerHandler(i,this.spot,e,t,s)));if(this.spot.newBrowsiAd&&this.spot.newBrowsiAd.iframe){const t=this.spot.newBrowsiAd;new v.default(this.getInstanceName(t),t.win).initListeners()}this.pbjsInstance.requestBids(Object.assign({adUnitCodes:[i.code],auctionId:`${i.code}_${r.default.generateUuid()}`,bidsBackHandler:t=>{n()}},t.c.t?{timeout:t.c.t}:{}))}})))})):Promise.resolve()}winnerHandler(t,i,e,s,n){t&&t.adUnitCode===this.adUnit.code&&this.hasDfpBidder(s)&&this.handleBidSuccess(t,e,s,n)}slotAdRequestHandler(t,i,e){if(this.De(t,i.adContainer.id)){const t=this.usingBrowsiPbjs?0:1;this.Te.verbose(`dfp(da) slotRequestedEvent ${i.adContainer.id}`),this.spot.spotRequested++;const s=this.Ve()?"forced_refresh":void 0;this.ve(this.vs(e),e.plk,this.Se(!0),t,s)}}slotRenderEndedHandler(t,i,e,s){var c;if(this.De(t,i.adContainer.id)){if(this.Ve())return this.handleForcedRefreshSlotRenderEnded(e,t,s);const l=r.default.At(t);e.c.b||this.sendDfpBidMatched(null===(c=e.c.d)||void 0===c?void 0:c.aup,!t.isEmpty,l,t.slot.getSlotElementId()),this.Te.info(`dfp(da) slotRenderEnded ${t.isEmpty?"empty":JSON.stringify(l)} for ${i.adContainer.id}`),t.isEmpty?(n.default.get().ge(this.spot,!1,t.slot.getAdUnitPath(),e.plk,null,r.default.getGAMResponseInfo(t.slot)),s({status:a.Status.FAILURE})):(this.handleAdMatched(i,e,t,l),s({status:a.Status.SUCCESS,args:{adUnit:t.slot.getAdUnitPath(),provider:o.ProviderType.HEADER_BIDDING}})),h.default.get().waitForBrowsiAV(t.slot,i,e,this.spot)}}sendDfpBidMatched(t,i,e,s){const n={im:i,s:[e],br:-1,au:t};d.AuctionDataCollector.get().collectBidMatch(s,o.ProviderType.DFP,n,!0)}handleAdMatched(t,i,e,s){var o;this.spot.isRefreshing()&&(t.win.googletag.destroySlots([null===(o=this.spot.refresh)||void 0===o?void 0:o.oldSlot]),this.Fe()),this.spot.Ke(),n.default.get().ge(this.spot,!0,e.slot.getAdUnitPath(),i.plk,null,r.default.getGAMResponseInfo(e.slot)),this.spot.Ye(s),l.DFP.isValidSize(s,!0)&&t.display(this.Le(i.c.d.a));try{const t=e.slot.getHtml();if(t.includes("apstag.renderImp")||t.includes("amzn_win")){if(r.default.isBrowsiLoggerActive()){const t={winner:"aps",size:s,adUnit:e.slot.getSlotElementId()};window.dispatchEvent(new CustomEvent(u.EventType.AMAZON_WINNER,{detail:t}))}c.Profiler.get().collectHbEvents&&n.default.get().sendAPSWinner(this.spot)}}catch(t){}}pushGptCommands(t,i,e,s){const n=s.c.d,r="false"===n.a.upc||!n.a.upc;let o=i.win.googletag||{};o.cmd=o.cmd||[],this.runProcessBeforeCallingDFP(s),this.runPreDfpHB(s,this.adUnit),o.cmd.push((()=>{if(this.spot.Xe(o.defineSlot(n.aup,t,i.adContainer.id)),this.spot.slot.addService(o.pubads()),this.setGoogleTagPrivacy(o),o.pubads().enableSingleRequest(),o.enableServices(),this.hasBidders(s)&&this.pbjsInstance.que.push((()=>{e&&this.pbjsInstance.setTargetingForGPTAsync([i.adContainer.id])})),this.Ce(this.spot.slot,this.Ue(s)),this.hasAmazonBidder(s)&&i.win.apstag&&i.win.apstag.setDisplayBids(),this.runPreGoogletagDisplay(this.spot),i.iframe?o.display(i.adContainer):(o.enableServices(),o.display(i.adContainer),o.pubads().isInitialLoadDisabled()&&o.pubads().refresh([this.spot.slot],{changeCorrelator:r})),!s.c.b){const t=this.spot.implementedSize||{w:-1,h:-1};d.AuctionDataCollector.get().collectDFPBidRequest(this.spot,[{dfp:[t]}])}}))}handleForcedRefreshSlotRenderEnded(t,i,e){this.spot.isMeasurable=!1;const s={im:!i.isEmpty,s:[r.default.At(i)],br:-1,rsn:"forced_refresh",au:t.c.d.aup};if(d.AuctionDataCollector.get().collectBidMatch(this.spot.newBrowsiAd.adContainer.id,o.ProviderType.DFP,s,!0),n.default.get().ge(this.spot,!i.isEmpty,i.slot.getAdUnitPath(),t.plk,"forced_refresh",r.default.getGAMResponseInfo(i.slot)),!i.isEmpty){const i=this.vs(t);this.handleForcedRefreshNonEmptyEvent(i,t.plk,{forcedRefresh:!0,adUnit:i},t)}e({status:a.Status.SUCCESS,args:{adUnit:"NA",provider:o.ProviderType.HEADER_BIDDING}})}}i.HeaderBidding=f,f.isBidTimeoutListenerActive=!1},4621:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PrebidJs=void 0;const s=e(1250),n=e(4987),r=e(4730),o=e(7111),h=e(8431),a=e(394),c=e(4545),l=e(3434),d=e(9310),u=e(4752);class v extends c.HbProvider{constructor(t){super(t),this.usingBrowsiPbjs=!1,this.Te=new s.default("PrebidJs"),this.profile=a.Profiler.get()}hasBidders(t){return!(!t.c.b||!t.c.b.length)}Ui(t,i){return new Promise(((e,s)=>{i.Je(this.spot,this.ze()).then((i=>{this.hasBidders(t)&&this.appendPrebidJsToHead(i).catch((t=>{t===h.Status.NOT_SUPPORTED&&(o.default.get().sendAdRequestBlockedEvent(this.spot,"prebid_version_unsupported",`Prebid version ${this.pbjsInstance?this.pbjsInstance.version:""}`),this.Te.error(`fetching failed: Prebid version ${this.pbjsInstance?this.pbjsInstance.version:""} is not supported`,this.pbjsInstance)),e({status:t})})),this.je(t).then((()=>{this.us(t,i,e,s)})).catch((t=>{this.spot.handlePreFetchAsyncReject(t)}))}))}))}getBidResponses(t,i){return i&&i[t]?i[t].bids:[]}buildIframe(t,i){const e=t.win.document.createElement("iframe");return e.id=t.adContainer.id,e.width=`${i.width}`,e.height=`${i.height}`,e.scrolling="no",e.frameBorder="0",e}getHighestBidById(t,i){const e=t[i]&&t[i].bids;return e?e.reduce(((t,i)=>t.cpm>i.cpm?t:i)):null}handleBidSuccess(t,i,e,s){var n;this.spot.Ye({w:t.width,h:t.height}),i.display(this.Le(null===(n=e.c.d)||void 0===n?void 0:n.a)),this.spot.isRefreshing()&&this.Fe(),this.hasDfpBidder(e)||(this.renderAd(i,t),s({status:h.Status.SUCCESS,winnerName:t.bidder,args:{adUnit:"NA",adHeight:this.spot.implementedSize.h,provider:r.ProviderType.HEADER_BIDDING}}))}renderAd(t,i){if(t.isIframe)n.default.Jt(t.adContainer),this.pbjsInstance.renderAd(t.win.document,i.adId);else{n.default.Jt(t.adContainer);const e=this.buildIframe(t,i);t.adContainer=e,t.adWrapper.appendChild(e),e.setAttribute("style",`text-align:center;display: block;margin: auto;auto;width:100% !important; height:${this.spot.implementedSize.h}px !important; width: ${this.spot.implementedSize.w}px !important;`),this.pbjsInstance.renderAd(e.contentWindow.document,i.adId)}}appendPrebidJsToHead(t){if(!this.profile.prebidData||!this.profile.prebidData.prebidPath)return Promise.reject(h.Status.NO_URL);if(t.isIframe)return this.injectPbjsAndResolve(t,!1);const i=this.getInstanceName(t);return this.pbjsInstance=t.win[i],this.Te.verbose(`checking ${i}`,this.pbjsInstance),this.pbjsInstance?v.isBrowsiPbjsExists?(this.Te.verbose(`Using browsi ${i}`),this.usingBrowsiPbjs=!0,Promise.resolve(h.Status.SUCCESS)):this.pbjsInstance.version?0===this.pbjsInstance.version.indexOf("v0")?Promise.reject(h.Status.NOT_SUPPORTED):(this.Te.verbose("Using publisher pbjs"),Promise.resolve(h.Status.SUCCESS)):this.injectPbjsAndResolve(t,!0):this.injectPbjsAndResolve(t,!0)}getInstanceName(t){var i;const e="pbjs";return t.iframe?e:(null===(i=this.profile.prebidData)||void 0===i?void 0:i.globalInstanceName)||e}injectPbjsAndResolve(t,i){return this.injectBrowsiPbjs(t),this.usingBrowsiPbjs=!0,i&&(v.isBrowsiPbjsExists=!0),Promise.resolve(h.Status.SUCCESS)}injectBrowsiPbjs(t){this.Te.verbose("Injecting Browsi Pbjs"),t.win.pbjs=t.win.pbjs||{},this.pbjsInstance=t.win.pbjs,this.pbjsInstance.que=this.pbjsInstance.que||[];const i=n.default.Si(t.win.document),e=this.profile.prebidData.prebidPath;i.setAttribute("src",e),i.addEventListener("error",(()=>{o.default.get().sendErrorEvent(d.EventType.SCRIPT_LOAD_ERROR,e,"prebid")})),n.default.wi(t.win.document).appendChild(i)}isValidBid(t){return t&&t.adUnitCode&&Array.isArray(window.browsiAdUnitCodes)&&-1!==window.browsiAdUnitCodes.indexOf(t.adUnitCode)||!1}getWinnerName(t,i){if(t.isEmpty)return"NA";{const e=n.default.At(t);return 1===e.w&&1===e.h?i?i.bidder:"NA":r.ProviderType.DFP}}getConfig(t){let i=Object.assign({enableSendAllBids:!0,debug:!!a.Profiler.get().debug},t?{bidderTimeout:t}:{});this.usingBrowsiPbjs&&(i=Object.assign(i,Object.assign(Object.assign({},l.default.prebidConf),this.profile.prebidConfig||{})));let e=u.default.getExternalFlowHandler("setPrebidConfig");return e&&e(i),this.Te.info("Using Prebid configuration:",i),i}buildAdUnit(t,i,e,s){let n={};const r=t.reduce(((t,e)=>{switch(e.a&&this.handleBidAlias(e.a,e.bc.bidder),this.getBidName(e)){case"pulsepoint":return t.concat(this.buildPulsepointBids(e,s));case"ix":return t.concat(this.buildIXBids(e,s));case"ias":return t.concat(this.buildIASBids(e,i));case"unruly":return n=this.buildVideoMediaType(e),t.concat([e.bc]);default:return t.concat([e.bc])}}),[]);r.forEach((t=>{t.browsiSpot=this.spot.spotIndex}));const o=this.getGPID(e,i);return{code:e,mediaTypes:Object.assign({banner:{sizes:this.getPrebidSizes()}},n),ortb2Imp:{ext:{gpid:o,data:{pbadslot:o,adserver:{adslot:o}}}},bids:r||[]}}getGPID(t,i){return`${i?i.aup+"#":""}${t}`}handleBidAlias(t,i){const e=this.spot.newBrowsiAd&&this.spot.newBrowsiAd.isIframe,s=v.activeBidAlias[t]&&v.activeBidAlias[t]===i,n=e||!s;this.pbjsInstance&&n&&(e||(v.activeBidAlias[t]=i),this.pbjsInstance.que.push((()=>{this.pbjsInstance.aliasBidder(t,i)})))}buildPulsepointBids(t,i){return(n.default.ti(i)?this.Se(!1):[[i.w,i.h]]).map((i=>({bidder:t.bc.bidder,params:Object.assign(Object.assign({},t.bc.params),{cf:n.default.ii(i)})})))}buildIXBids(t,i){return(n.default.ti(i)?this.Se(!1):[[i.w,i.h]]).map((i=>({bidder:t.bc.bidder,params:Object.assign(Object.assign({},t.bc.params),{size:i})})))}buildIASBids(t,i){return[{bidder:t.bc.bidder,params:{pubId:t.bc.params.pubId,adUnitPath:(null==i?void 0:i.aup)||""}}]}buildVideoMediaType(t){const i=t.bc.params["video-context"],e=t.bc.params["video-width"],s=t.bc.params["video-height"];return i&&e&&s?{video:{context:i,playerSize:[[e,s]]}}:{}}getPrebidSizes(){return this.Se(!1)}getBidName(t){return t.a?t.a:t.bc.bidder}addConfigByProvider(t){t.forEach((t=>{switch(this.getBidName(t)){case"pubmatic":case"aardvark":this.pbjsInstance.setConfig({userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}}}})}}))}hasDfpBidder(t){return!!t.c.d}getPrebidWinner(t){return this.pbjsInstance.getHighestCpmBids().find((i=>i.adUnitCode===t))}}i.PrebidJs=v,v.isBrowsiPbjsExists=!1,v.activeBidAlias={}},8221:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987);class r{constructor(){this.vendors=[],this.foundCRs=[],this.logger=new s.default("CR"),this.vendors=this.buildVendors()}static get(){return r.instance||(r.instance=new r),r.instance}getVendorsElements(){const t=this.findCR();return t.length?t.map((t=>t.element)):[]}isVendorNode(t){return this.vendors.some((i=>i.checkNode(t)))}isFound(t){return this.foundCRs.some((i=>i.element.isEqualNode(t)||n.default.kt(t,i.element)))}findCR(){const t=document.getElementsByTagName("iframe"),i=[];return this.vendors.forEach((e=>{i.push(...this.getVendorData(e,document));for(let s=0;s<t.length;s++){if(!t[s])continue;let n;try{n=t[s].contentWindow.document}catch(t){}if(n)try{i.push(...this.getVendorData(e,n))}catch(t){}}})),this.foundCRs=i,i}getVendorData(t,i){let e=[];if(!t.selectors.length)return[];return Array.from(i.querySelectorAll(t.selectors.join(", "))).forEach((i=>{if(t.validateId&&!t.validateId(i.id))return;t.parent&&(i=i.parentNode);const s=this.createVendorData(t,i);s.is_visible&&e.push(s)})),e}createVendorData(t,i){return{type:t.key,width:this.getVendorSize(i).w,height:this.getVendorSize(i).h,offset_top:n.default.B(i).y,fold:n.default.Z(i),is_visible:this.isVendorVisible(i),element:i}}getVendorSize(t){const i=t.getBoundingClientRect();return{w:i.width,h:i.height}}isVendorVisible(t){const i=t.getBoundingClientRect();return!(i.width<2||i.height<2)}buildVendors(){return[this.buildVendor("taboola","Taboola",[".trc_rbox_container"],["taboola_view_id","_taboola"],(t=>"DIV"===t.tagName&&t.classList.contains("trc_rbox_container"))),this.buildVendor("outbrain","Outbrain",["[id^='outbrain_widget_']"],["outbrain","outbrain_rater"],(t=>"DIV"===t.tagName&&t.id.startsWith("outbrain_widget_"))),this.buildVendor("revcontent","Revcontent",["[id^='rcjsload_']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("rcjsload_"))),this.buildVendor("google","Google Matched Content",["ins.adsbygoogle[data-ad-format='autorelaxed']"],["adsbygoogle"],(t=>!("INS"!==t.tagName||!t.classList.contains("adsbygoogle")||!t.dataset)&&"autorelaxed"===t.dataset.adFormat)),this.buildVendor("gravity","Gravity",["[id^='grv-personalization-']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("grv-personalization-"))),this.buildVendor("contentAd","ContentAd",["[id^='contentad']"],[],(t=>!("DIV"!==t.tagName||!/^contentad\d+$/.test(t.id)||!t.parentElement||"DIV"!==t.parentElement.tagName)),!0,(t=>/^contentad\d+$/.test(t))),this.buildVendor("adblade","AdBlade",["ins.adbladeads + div.adblade-dyna"],[],(t=>!!("DIV"===t.tagName&&t.classList.contains("adblade-dyna")&&t.previousElementSibling&&"INS"===t.previousElementSibling.tagName&&t.previousElementSibling.classList.contains("adbladeads")))),this.buildVendor("zergnet","ZergNet",["[id^='zergnet-widget']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("zergnet-widget"))),this.buildVendor("viafoura","Viafoura",["[id^='gmg-vf-articles']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("gmg-vf-articles")))]}buildVendor(t,i,e,s,n,r,o){return{key:t,name:i,selectors:e,variables:s,checkNode:n,parent:r,validateId:o}}}i.default=r},5966:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),e(4987);const s=e(4987),n=e(1250),r=e(394),o=e(4752);class h{constructor(){this.disqusSrc=new RegExp(/^.*disqus.com\/embed\/comments*/),this.spotimSrc=new RegExp(/^.*.spot.im*/),this.facebookCommentsRegex=new RegExp(/.*www.facebook.com.*plugins.*comments.php/),this.logger=new n.default("CommentSectionDetector"),this.profile=r.Profiler.get(),this.commentSections=[]}static get(){return h.instance||(this.instance=new h),h.instance}addIfComments(t){if(s.default.jt(t,!0)){let i;switch(t.nodeName){case"IFRAME":let e=s.default.Mt(t);this.disqusSrc.test(e)?i=this.resolveCommentSection(t,"disqus"):this.spotimSrc.test(e)?i=this.resolveCommentSection(t,"spot.im"):this.facebookCommentsRegex.test(e)&&(i=this.resolveCommentSection(t,"facebook"));break;case"DIV":case"SECTION":i=this.ResolveCommentsClass(t)}i&&this.commentSections.push(i)}}reportCommentSection(){return this.commentSections.filter((t=>s.default.G(t.element).h>0&&(t.element.childNodes.length>0||"IFRAME"==t.element.tagName))).map((t=>(this.logger.info("comment section to report ",t.element),{type:t.type,height:s.default.G(t.element).h,offset_top:s.default.B(t.element).y})))}getAllCommentSections(){return this.commentSections.filter((t=>s.default.G(t.element).h>0&&(t.element.childNodes.length>0||"IFRAME"==t.element.tagName))).map((t=>t.element))}alreadyDetected(t){for(let i of this.commentSections){let e=i.element;if(t===e||s.default.isPositionContained(e,t)||s.default.isPositionContained(t,e))return!0;let n=Array.prototype.slice.call(e.childNodes);if(this.alreadyFound(t,n))return!0}return!1}alreadyFound(t,i){for(let e of i){if(t===e)return!0;let i=Array.prototype.slice.call(e.childNodes);if(this.alreadyFound(t,i))return!0}return!1}resolveCommentSection(t,i){if(this.alreadyDetected(t))return;let e=this.getSectionContainer(t);"boolean"!=typeof e&&(t=e);let n=window.getComputedStyle(t),r=n.height?parseInt(n.height):void 0,o=n.width?parseInt(n.width):void 0;if(r||(r=s.default.G(t).h),o||(o=s.default.G(t).w),Number.isInteger(r)&&r>0&&Number.isInteger(o)&&o>0){if(r<=50||o<=50){if(!this.hasLinkToComments(t))return;i="button"}return{element:t,type:i}}}ResolveCommentsClass(t){if(this.alreadyDetected(t))return;let i,e,n,r=t.classList;if(!s.default.Ri(r,"icon")&&this.hasCommentLikeClasses(r,t)){if(this.isFacebookCommentSection(r,t))i="facebook";else if(this.isGigyaCommentSection(r))i="gigya";else if(this.isTalkbacksSection(r))i="talkbacks";else{let h=t.querySelectorAll("iFRAME");if(h.length>0){for(let a=0;a<h.length;a++)if(h[a].parentElement&&!o.default.isEmbeddedByBrowsi(h[a].parentElement,!1))this.addIfComments(h[a]);else if(i="native",e=this.hasForm(t),n=this.hasList(t)||s.default.Ri(r,"comment")&&(s.default.Ri(r,"list")||s.default.Ri(r,"stream")||s.default.Ri(r,"view")||s.default.Ri(r,"all")),e||n)return{element:t,type:i};return}if(i="native",e=this.hasForm(t),n=this.hasList(t)||s.default.Ri(r,"comment")&&(s.default.Ri(r,"list")||s.default.Ri(r,"stream")||s.default.Ri(r,"view")||s.default.Ri(r,"all")),!e&&!n)return}return{element:t,type:i}}}isTalkbacksSection(t){return s.default.Ri(t,"talkback")}isGigyaCommentSection(t){return s.default.Ri(t,"gig-comments")}isFacebookCommentSection(t,i){return i.id.indexOf("fb-comment")>-1||s.default.Ri(t,"fb-comment")}hasCommentLikeClasses(t,i){return s.default.Ri(t,"comment")||s.default.Ri(t,"talkback")||i.id.indexOf("talkback")>-1||i.id.indexOf("comment")>-1||i.id.indexOf("respond")>-1}hasLinkToComments(t){let i=t.getAttribute("src");if(i&&i.indexOf("comment")>-1)return!0;let e=t.getAttribute("href");if(e&&e.indexOf("comment")>-1)return!0;if(t.hasChildNodes()){let i=t.children;for(let t=0;t<i.length;t++)if(this.hasLinkToComments(i[t]))return!0}return!1}getSectionContainer(t){let i=[],e=t.attributes;for(let t=0;t<e.length;t++)i.push(e.item(t).value);if(t&&("UL"===t.nodeName||"OL"===t.nodeName||s.default.Ri(i,"comment")||s.default.Ri(i,"talkback")||s.default.Ri(i,"respond"))){let i=!!t.parentElement&&this.getSectionContainer(t.parentElement);return!1===i?t:i}return!1}hasForm(t){let i=t.querySelectorAll("FORM"),e=t.querySelectorAll("TEXTAREA");if(i.length>0||e.length>0){for(let t=0;t<i.length;t++)if(i[t].getBoundingClientRect().height>0)return!0;for(let t=0;t<e.length;t++)if(e[t].getBoundingClientRect().height>0)return!0}return!1}hasList(t){let i=t.querySelectorAll("UL,OL");if(i.length>0)for(let t=0;t<i.length;t++)if(i[t].getBoundingClientRect().height>0)return!0;let e=s.default.Ot(t),n=s.default.Mi([e+'//*[contains(@class,"comment") and (contains(@class,"list") or contains(@class,"content") or contains(@class,"stream") or contains(@class,"view") or contains(@class,"all") or contains(@class,"talkback") ) ]']);return n.length>0&&n[0].hasChildNodes()}resetCommentSections(){this.commentSections=[]}}i.default=h},2562:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(9714),o=e(4730),h=e(394),a=e(1865),c=e(2786),l=e(9839),d=e(4752);var u;!function(t){t[t.VALID=0]="VALID",t[t.LAZY=1]="LAZY",t[t.INVALID=2]="INVALID"}(u||(u={}));class v{constructor(){var t,i;this.manualAdsSlots=[],this.logger=new s.default("Dfp Detector"),this.googletag=window.googletag||{},this.googletag.cmd=this.googletag.cmd||[],this.betweenAdsDistance=(null===(i=null===(t=h.Profiler.get().spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.distance)||0,this.isActive=!1,this.profile=h.Profiler.get();const e=h.Profiler.get().predictorsKeyValueNames;this.predictionKey=e.papaas||"browsiViewability",this.profile.manualDfpIframeAds&&(this.addManualAds(this.profile.manualDfpIframeAds.selectors),this.initRecheckManualAdsHook()),this.profile.waitForAdRequest&&this.listenToSlotRequested()}static start(){this.instance?this.instance.logger.info("already started"):(this.instance=new v,this.instance.logger.info("starting"),this.instance.run())}static restart(){this.instance?this.instance.checkFetchedSlots():this.start()}static setInactive(){this.instance&&(this.instance.isActive=!1)}initRecheckManualAdsHook(){const t=t=>{this.profile.manualDfpIframeAds&&this.addManualAds(this.profile.manualDfpIframeAds.selectors,t)},i=d.default.getExternalFlowHandler("recheckManualAds");i&&i(t)}run(){this.isActive=!0,this.listenToLazyAds(),this.checkFetchedSlots()}checkFetchedSlots(t){this.checkCurrentSlots(t),setTimeout((()=>this.checkCurrentSlots(t)),1e3)}getManualAdsSlots(){return this.manualAdsSlots}addManualAds(t,i=document){t.forEach((t=>{i.querySelectorAll(t).forEach((t=>{const i=t.querySelector("iframe");if(i&&n.default.Di(i)){const e=i.contentWindow;if(e){const i=e.googletag=e.googletag||{};i.cmd=i.cmd||[];const s={element:t,window:e,provider:o.ProviderType.MANUAL_IFRAME_AD};this.checkFetchedSlots(s),this.listenToLazyAds(s)}}}))}))}getGoogleTag(t){return t?t.googletag:this.googletag}checkCurrentSlots(t){this.logger.verbose("checking current slots");const i=this.getGoogleTag(null==t?void 0:t.window);i.cmd.push((()=>{i.pubads().getSlots().forEach((i=>{let e=i.getSlotElementId();const s=((null==t?void 0:t.window)||window).document.getElementById(e);if(s&&i.getResponseInformation()){const e=this.validateSlot(s,i,t),n=(null==t?void 0:t.element)||s;if(e.status===u.VALID)return void r.default.get().addFoundProvider(n,this.getProviderType(i,t),this.betweenAdsDistance,!0,n.id,i.getAdUnitPath(),!1,i,e.size);if(e.status===u.LAZY)return void this.handleThirdPartySlowAdRendering(s,i,!0,t)}}))}))}validateSlot(t,i,e){const s=this.resolveInnerMostSingleChild(t),r=n.default.St(s);return this.validationPassed((null==e?void 0:e.element)||t,i,!!e)?this.isRendered(s,r)?{status:u.VALID,size:r}:{status:u.LAZY}:{status:u.INVALID}}isRendered(t,i){return n.default.gi(t)&&a.DFP.isValidSize(i)}listenToSlotRequested(){googletag.pubads().addEventListener("slotRequested",(()=>{r.default.get().onDfpSlotReady()}))}listenToLazyAds(t){const i=this.getGoogleTag(null==t?void 0:t.window);i.cmd.push((()=>{const e=c.default.get();i.pubads().addEventListener("slotRenderEnded",(i=>{const s=e&&e.handleRenderEnded(i);if(this.isActive&&!i.isEmpty){const e=i.slot,n=e.getSlotElementId(),o=((null==t?void 0:t.window)||window).document.getElementById(n);if(o){const i=this.validateSlot(o,e,t),n=(null==t?void 0:t.element)||o;if(i.status===u.VALID)return void r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size);if(i.status===u.LAZY)return void this.handleThirdPartySlowAdRendering(n,e,!0,t);i.status===u.INVALID&&(s?r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size,"browsi"):this.isForcedRefreshed(n,e)&&r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size,"forced"))}}}))}))}handleThirdPartySlowAdRendering(t,i,e,s){this.waitForDeflating(t).then((n=>{this.logger.verbose("deflated to ",n);const o=(null==s?void 0:s.element)||t;r.default.get().addFoundProvider(o,this.getProviderType(i,s),this.betweenAdsDistance,!1,o.id,i.getAdUnitPath(),e,i,n)})).catch((i=>this.logger.verbose("did not deflate",i,t)))}validationPassed(t,i,e=!1){return!this.isBrowsiAd(i)&&!r.default.get().isDetectedAlready(t,e)&&(l.default.isInCurrentArticle(t)||l.default.isBetweenArticles(t,this.profile.dcs)||n.default.isFixed(t).status)}isForcedRefreshed(t,i){return!this.isBrowsiAd(i)&&r.default.get().isDetectedAlready(t)&&(l.default.isInCurrentArticle(t)||l.default.isBetweenArticles(t,this.profile.dcs)||n.default.isFixed(t).status)}isBrowsiAd(t){const i=t.getSlotElementId();return/^browsi_(ad.*)_ai_-?(\d+).*$/.test(i)}resolveAdSize(t){let i,e=t;for(;1===(i=this.getNonScriptChildren(e)).length;)e=i[0];return n.default.St(e)}resolveInnerMostSingleChild(t){let i,e=t;for(;1===(i=this.getNonScriptChildren(e)).length;)e=i[0];return e}getNonScriptChildren(t){return Array.from(t.children).filter((t=>"SCRIPT"!==t.tagName))}waitForDeflating(t){return new Promise(((i,e)=>{let s=10;this.logger.verbose("waiting for deflation",t);const n=setInterval((()=>{const r=this.resolveAdSize(t);a.DFP.isValidSize(r)&&(clearInterval(n),i(r)),s--||(clearInterval(n),e(r))}),500)}))}getProviderType(t,i){if(i)return i.provider;const e=t.getTargetingKeys();return-1!=e.indexOf("hb_pb")&&-1!=e.indexOf("hb_size")?o.ProviderType.HEADER_BIDDING:o.ProviderType.DFP}}i.default=v},9714:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1250),r=e(7111),o=e(2562),h=e(9310),a=e(4730),c=e(9840),l=e(1332),d=e(8406),u=e(8473),v=e(7646),f=e(9497),p=e(1150),m=e(8234),g=e(394),b=e(9839),w=e(4752),_=e(5023),y=e(7579),S=e(8540),O=e(626),A=e(7797);class j{constructor(){var t,i;this._foundAds=[],this.scanningTagNames="div,iframe,ins,header,class,section",this.adRequested=!1,this.profile=g.Profiler.get(),this.betweenAdDistance=(null===(i=null===(t=g.Profiler.get().spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.distance)||0,this.teadsSelector="teads-inread",this.unrulySelector="unruly_in_article_placement",this.logger=new n.default("ProvidersDetector"),this._foundAds=[],this.waitForAdRequest=new Promise((t=>this.adRequestedPromise=t)),this.usingCustomRefresh=w.default.isCustomRefreshConfigured(),this.customRefreshBatch=[],this.waitingForCustomRefreshBatch=!0,this.usingCustomRefresh&&this.sendCustomRefreshBatch()}static get(){return this.instance||(this.instance=new j),this.instance}get foundAds(){return this._foundAds}onDfpSlotReady(){this.adRequested=!0,this.adRequestedPromise()}waitForFirstAdRequest(){return new Promise((t=>{if(this.adRequested)return t();this.waitForAdRequest.then(t)}))}addIfNew(t,i,e,n,o,c,d,p,g=!1,b){if(this.adRequested||i!==a.ProviderType.DFP||this.onDfpSlotReady(),!b&&this.isDetectedAlready(t))return;if(this.isBrowsiGeneric(t))return;const w=this.getManualIframeWindow(i,t);let _=this.buildPublisherAd(t,i,e,n,o,c,d,p,b,g,w);this.usingCustomRefresh&&d&&this.initRefreshRateRequest(_),this.updateFoundAds(_),l.default.instance.calculateMCSize(!0);let y=!1;if("browsi"===_.refreshType&&this.profile.sendBrowsiImpressionDOMEvent&&(y=this.sendBrowsiImpressionDOMEvent(_)),i!==a.ProviderType.DFP||s.default.zt(_.positionType)||u.default.get().increment(h.EventType.FOUND_PUBLISHER_AD),this.profile.reportPublisherAds){r.default.get().sendFoundPublisherAd(_,y);const t=this.buildViewabilityDetails(_);f.ViewabilityService.instance.subscribe(t,m.ViewabilityConfigurations.pubAdConfig(_.positionType),void 0,d,b),i===a.ProviderType.DFP&&d&&v.default.get().waitForPublisherAV(d,_)}return _.positionType}getManualIframeWindow(t,i){var e;if(t===a.ProviderType.MANUAL_IFRAME_AD)return(null===(e=i.querySelector("iframe"))||void 0===e?void 0:e.contentWindow)||void 0}initRefreshRateRequest(t){if(this.waitingForCustomRefreshBatch)this.customRefreshBatch.push(t);else{const i=this.getPublisherAdCustomRefreshRateParams(t);S.CustomRefreshRate.get().sendCustomRefreshRate(y.DemandRequestType.SINGLE,[i])}}sendCustomRefreshBatch(){setTimeout((()=>{if(this.waitingForCustomRefreshBatch=!1,this.customRefreshBatch.length){let t=this.customRefreshBatch.map((t=>this.getPublisherAdCustomRefreshRateParams(t)));S.CustomRefreshRate.get().sendCustomRefreshRate(y.DemandRequestType.SRA,t),this.customRefreshBatch=[]}}),1500)}getPublisherAdCustomRefreshRateParams(t){var i,e,s,n;return Object.assign(Object.assign(Object.assign(Object.assign({},t.adUnit?{au:t.adUnit}:{}),t.placementId?{id:t.placementId}:{}),(null===(i=t.gamResponseInfo)||void 0===i?void 0:i.lid)?{lid:null===(e=t.gamResponseInfo)||void 0===e?void 0:e.lid}:{}),(null===(s=t.gamResponseInfo)||void 0===s?void 0:s.oid)?{oid:null===(n=t.gamResponseInfo)||void 0===n?void 0:n.oid}:{})}sendBrowsiImpressionDOMEvent(t){const i={element:t.element,adUnit:t.adUnit,refreshCount:t.refreshCount};return s.default.dispatchDOMEvent(_.BROWSI_IMPRESSION_DOM_EVENT_NAME,i,window)}updateFoundAds(t){t.refreshCount>0?this.foundAds.splice(this.foundAds.findIndex((i=>i.placementId===t.placementId)),1,t):this.foundAds.push(t),this.collectFoundAdData(t)}collectFoundAdData(t){try{this.profile.adsDistanceViolations&&O.AdsDistanceViolationsService.get().addPublisherAd(t)}catch(i){this.logger.info("Faild to collect ads distance violations for publisher ad id:",t.placementId,i)}}isBrowsiGeneric(t){const i=d.default.getSpots().find((i=>!(!i.browsiAd||!s.default.isPositionContained(i.browsiAd,t))));return!i&&b.default.isSlides()?this.isBrowsiGenericFromPreviousSlide(t):!!i}isBrowsiGenericFromPreviousSlide(t){const i=b.default.getWindowObject();if(i){const e=b.default.getCurrentDcsElement(),n=Object.keys(i).map((t=>Number(t))).filter((t=>!isNaN(t))).sort(((t,i)=>t-i));for(let r in n){const n=i[r];if(n.element===e||s.default.isPositionContained(n.element,e)){const e=i[r].pvId;if(window.browsiOutput[e].getSpots().find((i=>i.browsiAd&&s.default.isPositionContained(i.browsiAd,t))))return!0}}}return!1}buildViewabilityDetails(t){return{element:t.element,adIndex:t.adIndex,byBrowsi:!1,gs:!0,positionType:t.positionType,placementId:t.placementId,adUnit:t.adUnit,provider:t.providerName,isLazyLoaded:t.isLazyLoaded,refreshCount:t.refreshCount,manualIframeWindow:t.manualIframeWindow}}buildPublisherAd(t,i,e,n,r,o,h,a,c,l=!1,d){let v=0,f=-1;if(c){const i=this._foundAds.find((i=>i.element===t));i&&(v=++i.refreshCount,f=i.adIndex)}let p=s.default.B(t).y;const m=this.resolveElementSize(t,a);let g=this.getAdPositionType(t,m,p),b=s.default.zt(g)?-1:Math.floor(p/s.default.A().height)+1;f=f>-1?f:this.foundAds.length,l&&(n=r=t.id||n+"_"+f);const w=u.default.get().getHighestBidDataByCode(n,r),_=Object.assign({providerName:i,positionType:g,element:t,topPos:p,foldNum:b,adIndex:f,width:m.w,height:m.h,stayAwayDistance:e,placementId:n,adUnit:r,isLazyLoaded:o,forcedRefresh:!(!c||"forced"!==c),refreshCount:v,isRefreshing:!1,refreshType:c,gamResponseInfo:s.default.getGAMResponseInfo(h),manualIframeWindow:d},w?{highestBid:w}:{});return _.positionType=this.getAdPositionType(t,m,p,_),this.logger.style("%cFound provider ("+_.positionType+") on page: "+i+"("+_.width+"x"+_.height+")","color: white; background-color: #42919D; border-radius: 4px; font-size:16px; font-weight:bold; padding:2px;",t),_}getAdPositionType(t,i,e,s){let n=l.default.instance.getAdPositionType(t,i.h,e,!0);return s&&n==p.AdPositionType.ABOVE_MC?l.default.instance.getAdPositionType(t,i.h,e):l.default.instance.getAdPositionType(t,i.h,e,!0)}scan(t,i=this.scanningTagNames){if(this.profile.scanThirdPartyProviders){const e=b.default.getCurrentDcsElement(),n=e instanceof Element?e:document;let r=Array.from(n.querySelectorAll(i));for(let i of r)switch(i.nodeName){case"P":default:this.handleThirdPartyProviders([i],t);break;case"IMG":s.default.jt(i,!0)&&this.handleThirdPartyProviders([i],t)}}return t&&(o.default.start(),this.logger.info("stayAwayElements after first scan,:",c.default.get().getStayAwayElements())),this.foundAds}handleThirdPartyProviders(t,i){if(0!==this.betweenAdDistance)for(let e of t){let t=!1;if(w.default.isEmbeddedByBrowsi(e,i)||(this.isUnruly(e)?t=this.addFoundProvider(e,a.ProviderType.UNRULY,this.betweenAdDistance,i,"NA","NA",!1):this.isTeads(e)?t=this.addFoundProvider(e,a.ProviderType.TEADS,this.betweenAdDistance,i,"NA","NA",!1):this.isILX(e)&&(t=this.addFoundProvider(e,a.ProviderType.ILX,this.betweenAdDistance,i,"NA","NA",!1))),!t&&"iframe"===e.tagName.toLowerCase()&&s.default.Di(e)&&!w.default.isEmbeddedByBrowsi(e,i)&&!s.default.S(this.foundAds.map((t=>t.element)),e)){const t=e;let s=Array.prototype.slice.call(t.contentWindow.document.querySelectorAll(this.scanningTagNames));this.handleThirdPartyProviders(s,i)}}}addFoundProvider(t,i,e,n,r,o,h,a,l,d){const u=this.addIfNew(t,i,e,r,o,h,a,l,!1,d);return u&&!s.default.zt(u)&&u!==p.AdPositionType.INTERSTITIAL&&c.default.get().upsertStayAwayElement(t,{distance:e,toDensity:!0,type:A.StayAwayType.BOTH},h,"provider"),!!u}isDetectedAlready(t,i=!1){return!(i||!s.default.Bt(window.document.body,t))||(!!this.foundAds.some((i=>i.element===t))||(!!s.default.S(this.foundAds.map((t=>t.element)),t)||this.foundAds.some((i=>s.default.S([t],i.element)))))}isVisibleAndMatchingSelector(t,i){const e=t;if(!s.default.O(e))return!1;if(s.default.jt(e,!0)&&"0px"!==window.getComputedStyle(e).height&&s.default.G(e).h>50){if(e.classList.contains(i))return!0;{const t=Array.from(document.querySelectorAll(`.${i}`));if(t&&t.length>0&&s.default.S(t,e))return!0}}return!1}isTeads(t){return this.isVisibleAndMatchingSelector(t,this.teadsSelector)}isUnruly(t){return this.isVisibleAndMatchingSelector(t,this.unrulySelector)}isILX(t){return this.isVisibleAndMatchingSelector(t,"FIOnDemandWrapper")}isValid(t){if(!s.default.O(t))return!1;const i=s.default.G(t),e=s.default.It(t);return i.w>50&&(!(i.h<60&&e&&e.document.body&&e.document.body.children&&0===Array.from(e.document.body.children).filter((t=>"SCRIPT"!==t.nodeName)).length)&&!(i.h<30))}getScanningTagNames(){return this.scanningTagNames}resolveElementSize(t,i){if(i)return i;{const i=t.getBoundingClientRect();return{w:i.width,h:i.height}}}}i.default=j},6981:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(394);class o{constructor(){this.logger=new s.default("socialWidgetDetector"),this.profile=r.Profiler.get(),this.allSocialElements=[]}static get(){return o.instance||(this.instance=new o),o.instance}reportSocialElements(){return this.logger.info("social widgets to report ",this.allSocialElements.map((t=>t.element))),this.allSocialElements.filter((t=>{let i=n.default.G(t.element);return i.h>5&&i.w>5})).map((t=>({type:t.type,height:n.default.G(t.element).h,offset_top:n.default.B(t.element).y})))}getAllSocialElements(){return this.logger.info("social widgets to report ",this.allSocialElements.map((t=>t.element))),this.allSocialElements.filter((t=>{let i=n.default.G(t.element);return i.h>5&&i.w>5})).map((t=>t.element))}scanSocialElementsByType(t){let i="";switch(t){case"facebook":i='.fb-post, .fb-comment-embed, .fb-comments, .fb-quote, .fb-video, .fb-page,iframe[src*="www.facebook.com/plugins/comment_embed.php"],iframe[src*="www.facebook.com/plugins/post.php"],iframe[src*="www.facebook.com/plugins/video.php"],iframe[src*="www.facebook.com/plugins/page.php"]';break;case"twitter":i=".twitter-moment, .twitter-timeline, .twitter-grid, .twitter-tweet, twitter-widget";break;case"pintrest":i="span[class*=_embed_grid][class*=PIN],span[class*=_embed_pin][class*=PIN]";break;case"instagram":i="iframe.instagram-media"}n.default.querySelectorOnDocument(document,i).map((i=>{this.allSocialElements.push({element:i.element,type:t})}))}scanAllSocialWidgets(){this.allSocialElements=[],this.scanSocialElementsByType("facebook"),this.scanSocialElementsByType("pintrest"),this.scanSocialElementsByType("instagram"),this.scanSocialElementsByType("twitter")}isSocialWidgetOrInSocialWidget(t){for(let i=0;i<this.allSocialElements.length;i++)if(this.allSocialElements[i].element==t||n.default.isPositionContained(this.allSocialElements[i].element,t))return!0;return!1}}i.default=o},7646:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(7111),r=e(394);class o{constructor(){this.logger=new s.default("activeViewViewability"),this.isActive=!!r.Profiler.get().activeView}static get(){return o.instance||(this.instance=new o),o.instance}waitForPublisherAV(t,i){if(!this.isActive)return;const e=i.refreshCount;window.googletag.pubads().addEventListener("impressionViewable",(s=>{s.slot==t&&e===i.refreshCount&&n.default.get().sendViewedPublisherAdAV(i)}))}waitForBrowsiAV(t,i,e,s){if(!this.isActive)return;i.win.googletag.pubads().addEventListener("impressionViewable",(i=>{i.slot==t&&n.default.get().sendViewedImpressionAV(s,e)}))}}i.default=o},7004:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1250),r=e(9714),o=e(8406),h=e(1332),a=e(9840),c=e(1150),l=e(3640),d=e(394),u=e(6761);class v{constructor(){this.positionsToDensity=[c.AdPositionType.WITHIN_MC,c.AdPositionType.STICKY_TOP,c.AdPositionType.STICKY_BOTTOM],this.fluidDensitySize={w:300,h:250}}get densityCap(){return this._densityCap}static get instance(){return this._instance||(this._instance=new v),this._instance}init(t,i,e){this.logger=new n.default("AdDensity"),this._densityCap=e?Number((e/100).toFixed(2)):0,this.debugMode=t||!1,this.manualSA=a.default.get().getStayAwayElements();const s=d.Profiler.get().admarking;this.adMarkingSize=s&&s.active?32:0,this.densityRequests=0}getPublisherAdDensity(){return this.calculateAdsDensity(this.getMainContentPublisherAds(),"publisher")}getTotalAdDensity(){return this.densityRequests++,this.densityRequests%5==0&&(h.default.instance.calculateMCSize(!0),this.recalculateAdsPositionType(),this.densityRequests=0),this.calculateAdsDensity(this.getMainContentAds(),"total")}calculateAdsDensity(t,i){let e=h.default.instance.calculateMCSize()||0,n=this.getAccumulatedHeight(t),r=s.default.xt(n,e);return this.debugMode&&this.logger.verbose(`(${i}) density: ${n} / ${e} = ${r}. `,t.map((t=>[t.type,t.element]))),r}canEmbedAd(t,i){if(t.isRefreshing())return!0;let e=this.getPotentialAdSize(i);if(!e)return!0;if(!this._densityCap)return!0;if(!h.default.instance.withinMainContent(t.ref))return!0;const n=this.getAccumulatedHeight(this.getMainContentAds())+e.h,r=h.default.instance.calculateMCSize()+e.h+this.adMarkingSize,o=s.default.xt(n,r);return this.logger.verbose(`spot ${t.spotIndex}, expected density: ${n}/${r}=${o}`),o<=this._densityCap}getManualSAElements(){return this.manualSA.filter((t=>t.toDensity&&this.isPositionToDenity(t.positionType))).map((t=>({type:l.AdType.SA_TO_DENSTIY,positionType:t.positionType,element:t.element})))}isPositionToDenity(t){return!!this.positionsToDensity.find((i=>i===t))}recalculateAdsPositionType(){this.logger.verbose("recalculating position_type"),this.manualSA.forEach((t=>{t.positionType=h.default.instance.getAdPositionType(t.element,t.element.getBoundingClientRect().height,s.default.B(t.element).y)})),r.default.get().foundAds.forEach((t=>{t.positionType=h.default.instance.getAdPositionType(t.element,t.element.getBoundingClientRect().height,s.default.B(t.element).y,!0)})),o.default.getEmbeddedSpots().forEach((t=>{t.browsiAd&&t.type!==u.SpotType.STICKY&&(t.positionType=h.default.instance.getAdPositionType(t.browsiAd,t.browsiAd.getBoundingClientRect().height,s.default.B(t.browsiAd).y))}))}getMainContentPublisherAds(){let t=r.default.get().foundAds.filter((t=>t.positionType!=c.AdPositionType.INTERSTITIAL&&(t.positionType==c.AdPositionType.STICKY_TOP||t.positionType==c.AdPositionType.STICKY_BOTTOM||h.default.instance.withinMainContent(t.element)))).map((t=>({type:l.AdType.PUBLISHER_AD,positionType:t.positionType,element:t.element}))),i=this.getManualSAElements();if(i.length){const e=t.map((t=>t.element));i=i.filter((t=>-1===e.indexOf(t.element)&&!s.default.S(e,t.element)&&!e.some((i=>s.default.kt(i,t.element)))))}return[...t,...i]}getMainContentBrowsiAds(){return o.default.getEmbeddedSpots().filter((t=>{let i=t.browsiAd;return i&&h.default.instance.withinMainContent(i)})).map((t=>{var i;return{type:l.AdType.BROWSI_AD,positionType:c.AdPositionType.WITHIN_MC,element:t.isRefreshing()&&(null===(i=t.refresh)||void 0===i?void 0:i.oldBrowsiAd)?t.refresh.oldBrowsiAd.adContainer:t.newBrowsiAd.adContainer}}))}getMainContentAds(){return this.getMainContentBrowsiAds().concat(this.getMainContentPublisherAds())}getAccumulatedHeight(t){return t.reduce(((t,i)=>t+i.element.getBoundingClientRect().height),0)}getPotentialAdSize(t){const i=t.map((t=>s.default.Zt(t)?this.fluidDensitySize:t));return i.length?i.reduce(((t,i)=>t.h>i.h?t:i)):null}}i.default=v},626:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AdsDistanceViolationsService=i.AdType=void 0;const s=e(1250),n=e(4987),r=e(4752),o=e(5068),h=e(1150);var a;!function(t){t.PUBLISHER="pu",t.BROWSI="b"}(a=i.AdType||(i.AdType={}));class c{constructor(){this.observedAds=[],this.adsInView=[],this.violations=new Set,this.logger=new s.default("AdsDistanceViolationsService")}static get(){return c.instance||(c.instance=new c),c.instance}getAdsDistanceViolation(){const t={bb:0,bpu:0,pupu:0};return[...this.violations].forEach((i=>{const e=i.replace(/\d/g,"");t[e]=(t[e]||0)+1})),t}addPublisherAd(t){const i=this.getAdHeight(t.element,t.height);if(!i)return void this.logger.verbose("The height is lower than the min height required to collect ad distance violations for publisher ad id:",t.placementId);if(n.default.zt(t.positionType))this.setSticky(this.getStickyElement(t.element),t.positionType,i);else{if(t.refreshCount>0){const e=this.observedAds.findIndex((i=>i.type===a.PUBLISHER&&i.index===t.adIndex));if(-1!==e){if(!(this.observedAds[e].height!==i||this.observedAds[e].element!==t.element))return;this.removeObservedAd(a.PUBLISHER,t.adIndex)}}const e=this.initObserver(a.PUBLISHER,t.adIndex,t.element,i);this.observedAds.push(e)}}addBrowsiAd(t){var i,e;const s=null===(i=t.newBrowsiAd)||void 0===i?void 0:i.adContainer;if(s){const i=this.getAdHeight(s,null===(e=t.implementedSize)||void 0===e?void 0:e.h);if(!i)return void this.logger.verbose("The height is lower than the min height required to collect ad distance violations for spot index:",t.spotIndex);if("s"===t.tags.positionTag)this.setSticky(this.getStickyElement(s),t.positionType,i);else{t.refreshCount>0&&this.removeObservedAd(a.BROWSI,t.spotIndex);const e=this.initObserver(a.BROWSI,t.spotIndex,s,i);this.observedAds.push(e)}}}getAdHeight(t,i){if(i&&i>=10)return i;const e=t.getBoundingClientRect().height;return e>=10?e:void 0}removeObservedAd(t,i){const e=this.observedAds.findIndex((e=>e.type===t&&e.index===i));-1!==e&&(this.observedAds[e].observer.clearObserver(),this.observedAds.splice(e,1));const s=this.adsInView.findIndex((e=>e.type===t&&e.index===i));-1!==s&&this.adsInView.splice(s,1)}initObserver(t,i,e,s){const n=10/s,r=new o.default(e,n,[0],(()=>{this.adsInView.push(h),this.checkViolation(h)}),this.getRootMargin(),(()=>{const e=this.adsInView.findIndex((e=>e.type===t&&e.index===i));-1!==e&&this.adsInView.splice(e,1)}),!0,!1);r.observe(),this.logger.verbose("Observer initialized for element:",e);const h={type:t,index:i,element:e,height:s,observer:r};return h}getRootMargin(){var t;if(null===(t=this.sticky)||void 0===t?void 0:t.isVisible){if(this.sticky.positionType===h.AdPositionType.STICKY_BOTTOM)return`0px 0px -${this.sticky.height}px 0px`;if(this.sticky.positionType===h.AdPositionType.STICKY_TOP)return`-${this.sticky.height}px 0px 0px 0px`}}setSticky(t,i,e){var s;null===(s=this.sticky)||void 0===s||s.observer.disconnect();const r=new MutationObserver(((t,i)=>{setTimeout((()=>{if(this.sticky)for(const i of t)if("attributes"===i.type){const t=n.default.jt(this.sticky.element,!1);this.sticky.isVisible!==t&&(this.sticky.isVisible=t,this.reobserveAds())}}),500)}));r.observe(t,{attributes:!0}),this.sticky={element:t,height:e,positionType:i,observer:r,isVisible:n.default.jt(t,!1)},this.reobserveAds()}getStickyElement(t){const i=r.default.getExternalFlowHandler("changeStickyElementADV");if(i){const e=i(t);if(e&&n.default.O(e))return e}return t}reobserveAds(){this.adsInView=[],this.observedAds=this.observedAds.map((t=>(t.observer.clearObserver(),this.initObserver(t.type,t.index,t.element,t.height))))}checkViolation(t){this.adsInView.length<2||this.adsInView.forEach((i=>{if(!(i.type===t.type&&i.index===t.index)){const e=[i,t].sort(((t,i)=>t.type.localeCompare(i.type)||t.index-i.index)).map((t=>t.type+t.index)).join("");this.violations.add(e),this.logger.verbose("Ads distance violation detected:",e)}}))}}i.AdsDistanceViolationsService=c},8473:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(9310),r=e(4987),o=e(4059),h=e(7111),a=e(394),c=e(7607),l=e(3434);class d{constructor(){this.storageKey="__bus",this.prebidStorageKey="__brtd",this.maxTimeInView=7,this.maxFetchLatency=5e3,this.maxVelocity=5e3,this.newDataToFlush=!1,this._visitBrowsiImpressions=0,this.highestBidsData=[],this.isLatestAvgHighestBidByCurrencyReset=!1,this.latestAvgHighestBidByCurrency=[],this.highestBidsCollector={};const t=new Date;t.setHours(0,0,0,0),this.currentTime=t.getTime(),this.logger=new s.default("BrowsiAnalytics"),this.browsiTimeInView={},this.publisherTimeInView={},this.pvUv=this.getEmptyPvUv(),this._analytics=this.buildMergedAnalytics(),this.measurement={previousYOffset:0,previousTime:0,timeLeft:3e5,startTime:0,started:!1,interval:null,timeout:null},this.sessionId=a.Profiler.get().sessionID,this.userId=r.default.ji("__browsiUID"),l.default.hasUserConsent?(this.flushRequest(),this.flush(),this.startFlushInterval()):(r.default.Ai(this.storageKey),r.default.Ai(this.prebidStorageKey))}get analytics(){return this._analytics}get currentVisitImpressions(){return this._visitBrowsiImpressions}startFlushInterval(){this.flushInterval||(this.flushInterval=setInterval((()=>{this.newDataToFlush&&this.flush()}),5e3),this.logger.info("started flushInterval"))}static get(){return d.instance||(d.instance=new d),d.instance}sendAnalyticsEvent(){l.default.hasUserConsent&&this._analytics.c>1?h.default.get().sendAnalyticsEvent(this._analytics):this.logger.info("first time user, no event")}startMeasurements(){l.default.hasUserConsent&&!this.measurement.started&&(this.startInterval(),this.startFlushInterval(),this.measurement.started=!0,o.default.instance.subscribe((t=>this.handleOOF(t))))}increment(t,i){switch(t){case n.EventType.FOUND_PUBLISHER_AD:this._analytics.pi++;break;case n.EventType.VIEWED_PUBLISHER_AD:this._analytics.pv++;break;case n.EventType.AD_IMPRESSION:this._analytics.bi++,0==i&&this._visitBrowsiImpressions++;break;case n.EventType.VIEWED_IMPRESSION:this._analytics.bv++;break;case n.EventType.AD_REQUEST_BLOCKED:this._analytics.aof.l_oof++;break;case n.EventType.AD_REQUEST:this._analytics.aof.l_ar++;break;default:return}this.flushRequest()}browsiImpression(t,i){this.increment(n.EventType.AD_IMPRESSION,i),t=Math.min(t,this.maxFetchLatency),this.logger.verbose(`adding ${t}ms to aul`),this._analytics.aul={a:r.default.getWeightedAvg(this._analytics.aul.a,this._analytics.aul.i,t,1),i:this._analytics.aul.i+1},this.flushRequest()}updateAvgWiningBid(t){t=t&&t>-1?t:0;let i=this._analytics.ahb||0,e=this._analytics.nam||0;i=(i*e+t)/(e+1),e++,this._analytics.ahb=i,this._analytics.nam=e,this.flushRequest()}handleOOF(t){if(this.measurement.timeLeft>0)if(t){clearInterval(this.measurement.interval),this.measurement.interval=null,clearInterval(this.flushInterval),this.flushInterval=null,clearTimeout(this.measurement.timeout),this.measurement.timeout=null,this.logger.info("user is out, intervals and timeout cleared");const t=Date.now();this.measurement.timeLeft-=t-this.measurement.startTime}else l.default.hasUserConsent&&(this.logger.info("user is back"),this.startInterval(),this.startFlushInterval(),this.startFlushInterval())}startInterval(){this.measurement.timeLeft>0?(this.logger.verbose(`initiating interval for ${this.measurement.timeLeft/1e3} s`),this.measurement.previousYOffset=r.default.W(),this.measurement.previousTime=r.default.Kt(),this.measurement.startTime=Date.now(),this.measurement.interval||(this.measurement.interval=setInterval((()=>{const t=r.default.Kt(),i=r.default.W();this.pvUv=this.getNewAuv(i,t),this._analytics.uv=Object.assign(this._analytics.uv,this.pvUv),this.logger.verbose("auv: ",JSON.parse(JSON.stringify(this._analytics.uv))),this.measurement.previousYOffset=i,this.measurement.previousTime=t,this.flushRequest()}),1e3)),this.measurement.timeout||(this.measurement.timeout=setTimeout((()=>{clearInterval(this.measurement.interval),this.measurement.interval=null,this.measurement.timeLeft=0,this.logger.verbose("stopping interval")}),this.measurement.timeLeft))):this.logger.verbose(`measurementTimeLeft: ${Math.max(0,this.measurement.timeLeft/1e3)} s, not initiating interval`)}getNewAuv(t,i){const e=this.getVelocity(t,i,this.measurement.previousYOffset,this.measurement.previousTime),s=r.default.clone(this.pvUv);return e>0?(s.pv_a=r.default.getWeightedAvg(s.pv_a,s.pv_i,e,1),s.pv_i++):(s.pv_sp=Math.min(parseFloat(r.default.avg(s.pv_si,s.pv_si+s.pv_i).toFixed(2)),1),s.pv_si++),s}getVelocity(t,i,e,s){const n=Math.abs(t-e),r=Math.max(i-s,1),o=r>0?parseFloat(Math.min(n/r,this.maxVelocity).toFixed(2)):0;return this.logger.verbose(`velocity: ${o} = (timeDelta:${r})/(pixelDelta:${n})`),o}flush(){r.default.Oi(this.storageKey,JSON.stringify(this._analytics)),this.newDataToFlush=!1,this.logger.verbose("flushed:",JSON.parse(JSON.stringify(this._analytics))),this.prebidFlush()}prebidFlush(){const t={bi:this._analytics.bi,bv:this._analytics.bv,pi:this._analytics.pi,pv:this._analytics.pv,bativ:this._analytics.tiv.b_ativ,uva:this._analytics.uv.t_a,uvs:this._analytics.uv.t_sp,oof:this._analytics.aof.t_a,sid:this.sessionId,uid:this.userId};r.default.Oi(this.prebidStorageKey,JSON.stringify(t)),this.logger.verbose("set Prebid storage:",JSON.stringify(t))}buildMergedAnalytics(){let t=this.getEmptyAnalytics();if(l.default.hasUserConsent)try{t=Object.assign(t,JSON.parse(r.default.ji(this.storageKey))),t.tiv=this.mergePreviousAvgTimeInView(t.tiv),t.uv=this.mergePreviousUv(t.uv),t.aof=this.mergePreviousAvgOof(t.aof),t.rahbc=this.updateRecentAvgHighestBidByCurrency(t.rahbc,this.currentTime),this.latestAvgHighestBidByCurrency=this.getLatestAvgHighestBidByCurrency(t.lahbc)}catch(t){this.logger.error(`failed to parse storage with key ${this.storageKey}, ${r.default.ji(this.storageKey)}`)}return t.c++,t}updateRecentAvgHighestBidByCurrency(t,i){const e=i-6048e5;return Object.keys(t).forEach((i=>{parseInt(i)<e&&delete t[i]})),t}getLatestAvgHighestBidByCurrency(t){return t.map((t=>({curr:t.curr,avg:t.avg,smp:t.smp,age:this.getDaysDifference((new Date).getTime(),t.time)})))}getDaysDifference(t,i){return Math.abs(t-i)/864e5}mergePreviousAvgTimeInView(t){let i=this.getEmptyTimeInViewStructure();return t&&(i.b_ativ=r.default.getWeightedAvg(t.b_ativ||0,t.b_ai||0,t.b_pv_ativ||0,t.b_pv_ai||0),i.b_ai=t.b_ai+(t.b_pv_ai||0),i.p_ativ=r.default.getWeightedAvg(t.p_ativ||0,t.p_ai||0,t.p_pv_ativ||0,t.p_pv_ai||0),i.p_ai=t.p_ai+(t.p_pv_ai||0),i.b_pv_ativ=0,i.b_pv_ai=0),i}mergePreviousUv(t){let i=this.getEmptyUv();return t&&(i.t_a=r.default.getWeightedAvg(t.t_a||0,t.t_i||0,t.pv_a||0,t.pv_i||0),i.t_i=(t.t_i||0)+(t.pv_i||0),i.pv_a=0,i.pv_i=0,i.t_si=(t.t_si||0)+(t.pv_si||0),i.t_sp=r.default.getWeightedAvg(t.t_sp||0,t.t_si||0,t.pv_sp||0,t.pv_si||0)),i}mergePreviousAvgOof(t){let i=this.getEmptyAvgOofStructure();if(t){if(0===t.l_oof&&0===t.l_ar)return t;let e=0;0===t.l_ar?e=1:0!=t.l_oof&&(e=t.l_oof/(t.l_oof+t.l_ar)),i.t_a=r.default.getWeightedAvg(t.t_a||0,t.t_i||0,e||0,1),i.l_ar=0,i.l_oof=0,i.t_i=t.t_i+1}return i}getEmptyAnalytics(){return{c:0,bi:0,bv:0,pi:0,pv:0,tiv:this.getEmptyTimeInViewStructure(),aul:{a:0,i:0},uv:this.getEmptyUv(),aof:this.getEmptyAvgOofStructure(),ahbc:[],lahbc:[],rahbc:{}}}getEmptyUv(){return Object.assign({t_a:0,t_i:0,t_sp:0,t_si:0},this.getEmptyPvUv())}getEmptyPvUv(){return{pv_a:0,pv_i:0,pv_sp:0,pv_si:0}}getEmptyTimeInViewStructure(){return{b_pv_ativ:0,b_pv_ai:0,b_ativ:0,b_ai:0,p_pv_ativ:0,p_pv_ai:0,p_ativ:0,p_ai:0}}getEmptyAvgOofStructure(){return{l_ar:0,l_oof:0,t_a:0,t_i:0}}updateTimeInView(t,i,e,s,n){var o;const h=t==c.TimeInViewType.BROWSI,a=h?i.spotIndex:i,l=h?(null===(o=i.refresh)||void 0===o?void 0:o.lastSuccessfulRefresh)||0:e,d=h?this.browsiTimeInView:this.publisherTimeInView;if(this.shouldUpdateTimeInView(d,a,l)){r.default.T(d[a])&&(d[a]={});const t=d[a][l]||0;d[a][l]=Math.min(Math.floor(Math.max(t,n)),this.maxTimeInView);const{sum:i,items:e}=this.getCurrentTimeInView(d);h?(this._analytics.tiv.b_pv_ai=e,this._analytics.tiv.b_pv_ativ=r.default.avg(i,e)):(this._analytics.tiv.p_pv_ai=e,this._analytics.tiv.p_pv_ativ=r.default.avg(i,e)),this.flushRequest()}}shouldUpdateTimeInView(t,i,e){return r.default.T(t[i])||!e||r.default.T(t[i][e])||t[i][e]<this.maxTimeInView}getCurrentTimeInView(t){let i=0,e=0;for(let s of Object.keys(t))for(let n of Object.keys(t[s]))i+=t[s][n],e+=1;return{sum:i,items:e}}flushRequest(){this.newDataToFlush=!0}updateRecentAvgWiningBidByCurrency(t,i){this._analytics.rahbc[this.currentTime]=this._analytics.rahbc[this.currentTime]||[];const e=this._analytics.rahbc[this.currentTime].find((t=>t.curr===i));e?(e.sum+=t,e.smp++):this._analytics.rahbc[this.currentTime].push({curr:i,sum:t,smp:1}),this.flushRequest()}updateLatestAvgWiningBidByCurrency(t,i){this.isLatestAvgHighestBidByCurrencyReset||(this._analytics.lahbc=[],this.isLatestAvgHighestBidByCurrencyReset=!0);const e=(new Date).getTime(),s=this._analytics.lahbc.find((t=>t.curr===i));s?(s.avg=(s.avg*s.smp+t)/(s.smp+1),s.smp++,s.time=e):this._analytics.lahbc.push({curr:i,avg:t,smp:1,time:e}),this.flushRequest()}updateAvgWiningBidByCurrency(t,i){const e=this._analytics.ahbc.find((t=>t.curr===i));e?(e.avg=(e.avg*e.smp+t)/(e.smp+1),e.smp++):this._analytics.ahbc.push({curr:i,avg:t,smp:1}),this.flushRequest()}addHighestBidData(t,i){const e=this.highestBidsData.find((t=>t.crn===i));t=+t,e?e.sum_br=e.sum_br+t:this.highestBidsData.push({crn:i,sum_br:t})}processBidData(t,i,e,s){!t||t<0||!i||(this.addHighestBidData(t,i),this.updateAvgWiningBidByCurrency(t,i),this.updateLatestAvgWiningBidByCurrency(t,i),this.updateRecentAvgWiningBidByCurrency(t,i),this.updateAvgWiningBid(t),this.updateHighestBidByAdUnitCode(e,t,i))}updateHighestBidByAdUnitCode(t,i,e){this.highestBidsCollector[t]={cpm:i,currency:e}}getHighestBidData(){return this.highestBidsData}getRecentAvgHighestBidByCurrency(t){if(!Object.keys(t).length)return;const i=[];Object.keys(t).forEach((e=>{t[e].forEach((t=>{const e=i.find((i=>i.curr===t.curr));e?(e.sum+=t.sum,e.smp+=t.smp):i.push({curr:t.curr,sum:t.sum,smp:t.smp})}))}));const e=this.getMostSempledHighestBidByCurrency(i);return{curr:e.curr,avg:e.sum/e.smp,smp:e.smp}}getMostSempledHighestBidByCurrency(t){return t.reduce(((t,i)=>i.smp>t.smp?i:t),t[0])}getAverageHighestBidByCurrencyMetrics(){return{uahbc:this.getMostSempledHighestBidByCurrency(this._analytics.ahbc),rahbc:this.getRecentAvgHighestBidByCurrency(this._analytics.rahbc),lahbc:this.getMostSempledHighestBidByCurrency(this.latestAvgHighestBidByCurrency)}}getHighestBidDataByCode(t,i){return this.highestBidsCollector[t]||this.highestBidsCollector[i]||null}getAverageHighestBid(){return this._analytics.ahb}getMostSampledAvgHighestBid(){return this._analytics.ahbc.length?this._analytics.ahbc.reduce(((t,i)=>t.smp>i.smp?t:i)):null}getHighestBidsCollector(){return this.highestBidsCollector}}i.default=d},3434:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(394),n=e(4987);i.default=class{static get hasUserConsent(){return this.updateConsentStatus(),this.hasConsent}static get location(){return"string"!=typeof this._location&&null!==this._location&&(this._location=s.Profiler.get().userAnonymousContinent||null),this._location}static get prebidConf(){let t=null;return"eu"===this.location?t={gdpr:{cmpApi:"iab",allowAuctionWithoutConsent:!0,timeout:1e3}}:"us"===this.location&&(t={usp:{cmpApi:"iab",timeout:1e3}}),t?{consentManagement:t}:null}static updateConsentStatus(){const t=this.getCurrentConsentType();this.hasConsent=!t||this.getConsentStatus(t)}static getConsentStatus(t){const i=n.default.getBrowsiTag();return i&&i.__cs&&"function"==typeof i.__cs[t]?i.__cs[t]():this.hasConsent}static getCurrentConsentType(){if(this.location){if("eu"===this.location)return"gdpr";if("us"===this.location)return"ccpa"}return null}}},9268:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(8542),r=e(9714),o=e(4987),h=e(7111),a=e(3802),c=e(4059),l=e(2562),d=e(1332),u=e(3813),v=e(9497),f=e(7328),p=e(394),m=e(7709),g=e(8406),b=e(8803),w=e(9839),_=e(584),y=e(6761),S=e(6981),O=e(5966),A=e(8221),j=e(2593),E=e(238),P=e(9486),T=e(3810);class I{constructor(t,i,e,n){if(this.dcsType=t,this.mutationConfig=e,this.mutationElement=i,this.profile=p.Profiler.get(),this.actionCounter=w.default.getDcsActionCounter(),this.windowObject=window[w.default.windowVarName],w.default.setCurrentEndlessPvid(this.profile.pageViewID),this.logger=new s.default(`DCS ${t}`),n){if("slides"!==t){let i;w.default.isDcsPageview()&&(i=w.default.getCurrentDcsElement()),this.spotEngine=u.default.get(),this.spotEngine.setTargetElements(i instanceof Element?[i]:[]),"readMore"===t?this.runPageStructureReport():this.runSpotEngine(!0,!0)}}else this.runPageStructureReport()}createObserver(){"readMore"!==this.dcsType&&(this.observer=new MutationObserver((t=>this.mutationsHandler(t))),this.observer.observe(this.listenElement||document.body,this.mutationConfig))}removeObserver(){this.observer&&this.observer.disconnect()}sendDcsEvent(t,i,e,s){const n=I.getSpotsResults(t,i);h.default.get().sendDcs(t,n.dynamicResults.spotsFound,null!=e?e:n.dynamicResults.maxItems,n.fixedResults.spotsFound,null!=s?s:n.fixedResults.maxItems)}incrementActionCounter(){this.actionCounter++,this.windowObject.count=this.actionCounter}runPageStructureReport(){d.default.instance.findMainContent(r.default.get().foundAds,A.default.get().findCR(),O.default.get().getAllCommentSections(),S.default.get().getAllSocialElements()),l.default.start(),r.default.get().scan(!1)}removeSpotsFromDOM(){g.default.getNonStickySpots().forEach((t=>{m.Embedder.bs(t)}))}runNewMiddy(t){h.default.get().flushEventsQue(),this.clearExternalServices(),this.keepStickyReference(),this.stopObservers(),I.resetWindowObjects(),this.injectBootstrap(t)}injectBootstrap(t){this.logger.info("injecting bootstrap "+(t?"with siteKey: "+t:""));const i=o.default.Rt(t);i&&i.parentElement&&(this.logger.info("removing old bootstrap tag",i),i.parentElement.removeChild(i))}static resetWindowObjects(){window.browsi_bootstrap_loaded=!1,window._middyo=null;const t=window.browsitag;t&&"function"==typeof t.__ori&&t.__ori()}stopObservers(){var t;l.default.setInactive(),(null===(t=this.spotEngine)||void 0===t?void 0:t.lazyDetector)&&this.spotEngine.lazyDetector.removeObserver(),c.default.instance.unsubscribe()}runSpotEngine(t,i,e){return new Promise(((s,r)=>{E.DemandTool.get().holdEngineForRelocation().then((()=>{this.logger.info("Running SpotEngine");const r=w.default.getDcsActionCounter(),o={isDcs:r&&r>0||this.actionCounter>0,type:this.dcsType,actionCounter:this.actionCounter,slides:e};return n.default.run(this.spotEngine,this.profile,t,i,o),i||this.profile.analysisMode||a.YieldClient.get().He(g.default.getNonStickySpots().filter((t=>!t.browsiAd))),s()}))}))}getDcsType(){return this.dcsType}getActionCounter(){return this.actionCounter}clearExternalServices(){f.default.get().removeAll(),v.ViewabilityService.instance.clearBeforeDcs(),P.Engagement.get().unsubscribe(),T.TouchEventsService.get().disconnectResizeObserver()}keepStickyReference(){const t=g.default.getStickySerializedSpots();t&&(this.windowObject[b.StickyConstants.dcsVar]=t)}static getSpotsResults(t,i){i=i||g.default.getSpots();return{fixedResults:{maxItems:_.default.getFixedTotalMaxItems(),spotsFound:i.filter((t=>"fi"===t.tags.typeTag)).length},dynamicResults:{maxItems:j.SpotsUtils.getDynamicMaxItems(),spotsFound:i.filter((t=>t.type==y.SpotType.DYNAMIC)).length}}}}i.default=I},1580:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6688),n=e(2610),r=e(1712),o=e(9517),h=e(9363),a=e(7815);i.default=class{static createDCS(t,i){switch(t){case"gallery":return new s.default("gallery",i,!0);case"readMore":return new n.default("readMore",i,!0);case"spa":return new o.default("spa",i,!0);case"endlessScroll":return new r.default("endlessScroll",i,!0);case"slides":return new h.default("slides",i,!0);case"manual":return new a.default("manual",!0);default:return null}}}},1078:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DcsApi=void 0;const s=e(394),n=e(1250),r=e(9497),o=e(7709),h=e(7328),a=e(2562),c=e(2786),l=e(7111),d=e(9310),u=e(4987),v=e(8406),f=e(4059),p=e(3813),m=e(9268),g=e(9839),b=e(4752),w=e(3810),_="browsiDcs";i.DcsApi=class{constructor(t,i){this.logger=new n.default("dcsAPI"),this.logger.info("started"),this.ws(i,t)}ws(t,i){window[g.default.windowVarName]=window[g.default.windowVarName]||{dcsType:"script"},this.injectDcsScript(t,(()=>{this.logger.info("DCS script loaded, firing dcsAPI event"),window.dispatchEvent(new CustomEvent("dcsAPI",{detail:this.api(i)}))}))}api(t){return{getSpotsMap:()=>{const t=this.getMappedSpots();return this.logger.info("getSpotsMap "+this.getPv(),t),t},removeSpots:t=>{const i=t.map(this.removeSpot.bind(this)),e=i.filter(Boolean);return this.logger.info(`removed ${i.length}/${e.length} spots`,this.getPv()),e.length===i.length},refreshSpots:t=>{const i=this.refreshSpots(t);return this.logger.info("refreshedSpots "+this.getPv(),i),i},getSaObjects:t=>g.default.getSaObjects(t),injectEngine:()=>(this.logger.info("InjectEngine "+this.getPv()),this.runNewPv()),rebuildProfile:i=>{this.logger.info("rebuildProfile","changes:",i,"original",t,this.getPv()),s.Profiler.mergeDeep(t,i);return s.Profiler.rebuild(t)},clearListeners:()=>this.clearListeners(),reportError:t=>{l.default.get().sendErrorEvent(d.EventType.CRASH,t.filename,t.message)},getPossibleSpots:t=>p.default.get().collect(!1,t,void 0,!0),pageViewId:s.Profiler.get().pageViewID}}injectDcsScript(t,i){if(!window.document.getElementById(_)){this.logger.info("Injecting Browsi Dcs Script");const e=u.default.Si(window.document);return e.setAttribute("src",t),e.id=_,e.onload=i,e.addEventListener("error",(()=>{l.default.get().sendErrorEvent(d.EventType.SCRIPT_LOAD_ERROR,t,"DcsScript")})),window.document.head.appendChild(e),e}i()}getPv(){return s.Profiler.get().pageViewID}getSpots(){return v.default.getSpots()}getMappedSpots(){const t=this.getSpots(),i={};return t.forEach((t=>{var e;const s=v.default.serialize(t);i[t.tags.positionTag]=i[t.tags.positionTag]||[],null===(e=i[t.tags.positionTag])||void 0===e||e.push(s)})),i}removeSpot(t){const i=this.getSpots().find((i=>i.spotIndex===t.spotIndex));let e=!1;return i&&(i.destoryDFPSlot(),r.ViewabilityService.instance.unsubscribe(i),e=o.Embedder.bs(i)),this.logger.info(`Spot ${e?"":"not"} removed from DOM`,t),e}refreshSpots(t){const i=t.map(this.createSpotFromSerialized);return i.forEach((t=>t._s())),i}clearListeners(){h.default.get().removeAll(),a.default.setInactive(),f.default.instance.unsubscribe(),w.TouchEventsService.get().disconnectResizeObserver();try{b.default.getLazySpotsInstance().stopService()}catch(t){this.logger.error(t)}const t=c.default.get();t&&(t.config.active=!1),r.ViewabilityService.instance.clearBeforeDcs()}runNewPv(){this.logger.info("runNewPv"),m.default.resetWindowObjects(),this.logger.info("injecting bootstrap");const t=u.default.Rt();t&&t.parentElement&&t.parentElement.removeChild(t),this.sendDcsEvent()}sendDcsEvent(){const t=m.default.getSpotsResults(d.EventType.DCS_SCRIPT);l.default.get().sendDcs(d.EventType.DCS_SCRIPT,t.dynamicResults.spotsFound,t.dynamicResults.maxItems,t.fixedResults.spotsFound,t.fixedResults.maxItems)}createSpotFromSerialized(t){return p.default.get().createSpot(t,t.selector)}}},1712:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9268),n=e(4987),r=e(9310),o=e(7815),h=e(9839);class a extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.articles=[],this.logger.info(`Endless Initialized for pv ${this.profile.pageViewID}`),this.listenElement=i instanceof HTMLElement?i:document.body,this.contentConfiguration=this.profile.dcs?this.profile.dcs:null,this.triggerMinimalPercentage=this.profile.dcs.viewportPercentage/100,this.checkUrlChanges=this.profile.dcs.checkUrlChanges,this.currentURL=window.location&&window.location.href,this.newContentFound=!1,this.contentConfiguration&&this.contentConfiguration.articlesSelector?this.articles=Array.from(document.querySelectorAll(this.contentConfiguration.articlesSelector)):this.articles=[]}mutationsHandler(t){setTimeout((()=>{const i=window.location&&window.location.href;this.profile.dcs.reInjectOnUrl&&i!==this.currentURL?this.reInject():t.forEach((t=>{this.handleIfEndless(t)}))}),1e3)}reInject(){if(this.observer){this.removeObserver(),delete this.observer;new o.default("endlessScroll",!1).trigger()}}handleIfEndless(t){if(t.addedNodes.length>0){const i=Array.from(t.addedNodes).filter((t=>t instanceof HTMLElement&&n.default.jt(t,!0)&&null!==t.offsetParent)),e=this.getNewArticleIfTriggerd(i);e.length&&e.forEach((t=>{this.logger.info("watching article's distance",t),this.watch(t)}))}}watch(t){setTimeout((()=>{this.observer&&this.isWindowCloseToArticle(t)&&this.hasUrlChanged()?(this.incrementActionCounter(),this.windowObject[this.actionCounter]={element:t,pvId:null,saE:h.default.getSaObjects(t)},this.windowObject.dcsType=this.getDcsType(),this.sendDcsEvent(r.EventType.DCS_ENDLESS),this.profile.debug&&(this.windowObject._endlessEvent={event_type:"dcs_endlessScroll"},this.logger.info(`dcs new content at position ${n.default.B(t).y}`,t)),this.newContentFound=!0,this.removeObserver(),this.runNewMiddy()):this.newContentFound||this.watch(t)}),300)}isWindowCloseToArticle(t){return n.default.J(t,this.triggerMinimalPercentage)}hasUrlChanged(){const t=window.location&&window.location.href;return!this.checkUrlChanges||!t||this.currentURL!==t}getNewArticleIfTriggerd(t){let i=[];const e=this.contentConfiguration.newContent&&this.contentConfiguration.newContent.className.split(" ");return this.contentConfiguration.articlesSelector?(i=Array.from(document.querySelectorAll(this.contentConfiguration.articlesSelector)),i=i.filter((t=>-1===this.articles.indexOf(t))),i.length&&(this.articles=this.articles.concat(i))):e&&t.some((t=>{const s=Array.from(t.classList).filter((t=>e.some((i=>t.includes(i)))));return(s.length===e.length||t.id.length>0&&t.id===this.contentConfiguration.newContent.id)&&(i.push(t),this.articles.push(t),!0)})),i}}i.default=a},7815:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9268),n=e(4987),r=e(9310);class o extends s.default{constructor(t,i){super(t,null,{},i),this.logger.info("Manual DCS Initalized"),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.lastArticle||(this.windowObject._lastArticle=document.location.href.slice());const e=n.default.getBrowsiTag();if(e){const t=this.profile.dcs.delay;e.triggerNewArticle=t?i=>{setTimeout(this.trigger.bind(this,i),t)}:this.trigger.bind(this)}}mutationsHandler(t){}trigger(t){this.removeSpotsFromDOM(),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.incrementActionCounter(),this.sendDcsEvent(r.EventType.DCS_MANUAL);const i=n.default.getBrowsiTag();i&&delete i.triggerNewArticle,this.runNewMiddy(t)}}i.default=o},2610:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9268),n=e(8542),r=e(4987),o=e(9310),h=e(2562),a=e(3813),c=e(584),l=e(2593);class d extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Read More Initialized"),!this.profile.analysisMode&&l.SpotsUtils.getConf({typeTag:"st",positionTag:"s"})&&a.default.get().buildStickySpot(),this.clickDetector()}mutationsHandler(t){}clickDetector(){if(this.mutationElement){const t=this.mutationElement.children?[this.mutationElement,...Array.from(this.mutationElement.children)]:[this.mutationElement];let i=!1;r.default.jt(this.mutationElement,!0)?t.length&&(this.shouldScanAbove()?this.handleSpotEngineRun(!0,!0,!0):n.default.sendPageViewReport([],this.profile,!0,!0),t.forEach((t=>{t.addEventListener("click",(e=>{if(!i){const s=this.getReadMoreButtonLocation(t),n=e.screenY||s,o=r.default.Lt(),h=Math.max(n,o);setTimeout((t=>this.clickHandler(h)),1e3,n),i=!0}})),this.logger.info("waiting for click on ",t)}))):(this.logger.info("invisible button",this.mutationElement),this.handleSpotEngineRun(!1,!0,!0))}}handleSpotEngineRun(t,i,e,s,n){return new Promise(((r,o)=>{t&&(this.spotEngine.setExternalScanConfig(this.getExternalScanConfig(this.shouldScanAbove(),n)),this.incrementActionCounter()),this.runSpotEngine(i,e,s).then((()=>(h.default.restart(),r())))}))}clickHandler(t){if(this.shouldScanAbove()){this.spotEngine.setExternalScanConfig(this.getExternalScanConfig(!1,t));const i=this.spotEngine.runSecondTimeForBelowReadMore(),e=this.getMaxItemsForDcsEvent(i.firstRunSpots,{typeTag:"dy",positionTag:"in"}),s=l.FIXED_TAGS.map((t=>this.getMaxItemsForDcsEvent(i.firstRunSpots,t))).reduce(((t,i)=>t+i));this.sendDcsEvent(o.EventType.DCS_READMORE,i.secRunSpots,e,s)}else this.handleSpotEngineRun(!0,!1,!0,void 0,t).then((()=>{this.sendDcsEvent(o.EventType.DCS_READMORE)}))}getMaxItemsForDcsEvent(t,i){const e=c.default.getMaxItems(i),s=t.filter((t=>t.tags.typeTag===i.typeTag&&t.tags.positionTag===i.positionTag));return Math.max(e-s.length,0)}shouldScanAbove(){return this.profile.dcs.scanAboveReadMore}getExternalScanConfig(t,i){const e=i||this.getReadMoreButtonLocation();return{forceStartPosition:t?void 0:e,forceEndPosition:t?e:void 0}}getReadMoreButtonLocation(t){return r.default.B(t||this.mutationElement).y}}i.default=d},9363:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9268),n=e(4987),r=e(9310),o=e(7328),h=e(2562),a=e(4059),c=e(9840),l=e(3060),d=e(3813),u=e(4492),v=e(9207),f=e(9839);class p extends s.default{constructor(t,i,e){if(super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info(`Slides Initialized for pv ${this.profile.pageViewID}`),this.mutationElement=i,this.slides=[],n.default.Mi(this.profile.dcs.mutationXpaths).forEach((t=>{this.slides.push({element:t,spots:[]})})),this.triggerMinimalPercentage=this.profile.dcs.viewportPercentage/100,this.slideEliminationPercentage=this.triggerMinimalPercentage+.1,this.checkUrlChanges=this.profile.dcs.checkUrlChanges,this.currentURL=window.location&&window.location.href,this.scrollDirection=l.ScrollDirection.DOWN,this.lastPosition=n.default.Lt(),o.default.get().listen("scroll",n.default.Ei(),(()=>{let t=n.default.Lt();this.scrollDirection=this.lastPosition<=t?l.ScrollDirection.DOWN:l.ScrollDirection.UP,this.lastPosition=t})),this.assignScrollListeners(),f.default.isSlidesTriggered()){const t=this.getCurrentSlide(),i=this.getPreviousSlides().includes(t)?[]:Array.from(t.querySelectorAll(u.CustomTagType.BROWSI_SPOT));this.spotEngine=d.default.get(v.SpotEngineType.BROWSI_SPOTS),this.spotEngine.setTargetElements(i),this.runSpotEngine(!0,!0)}else this.spotEngine=d.default.get(v.SpotEngineType.SLIDES_ALL),this.spotEngine.setTargetElements([]),this.runSpotEngine(!0,!0,this.slides)}mutationsHandler(t){}assignScrollListeners(){this.slides&&this.slides.length>0&&this.getAllSlidesElements().forEach((t=>{o.default.get().listen("scroll",n.default.Ei(),this.generateScrollListener(t))}))}isWindowCloseToSlide(t){return n.default.X(t,this.triggerMinimalPercentage)}isInDirectionOfSlide(t){return this.scrollDirection===l.ScrollDirection.UP&&n.default.isPositionedBefore(t,this.getCurrentSlide())||this.scrollDirection===l.ScrollDirection.DOWN&&n.default.isPositionedBefore(this.getCurrentSlide(),t)}generateScrollListener(t){return n.default.Ci((()=>{this.isInDirectionOfSlide(t)&&this.getCurrentSlide()!==t&&this.isWindowCloseToSlide(t)&&this.hasUrlChanged()&&(this.incrementActionCounter(),this.windowObject[this.actionCounter]={element:t,pvId:null,saE:c.default.get().getStayAwayElements().filter((i=>n.default.isPositionedBefore(t,i.element)))},this.windowObject.dcsType=this.getDcsType(),this.sendDcsEvent(r.EventType.DCS_SLIDES),this.profile.debug&&this.logger.info("dcs entering slide ",t),this.keepStickyReference(),this.runNewMiddy())}),100)}runNewMiddy(){h.default.setInactive(),this.spotEngine.lazyDetector&&this.spotEngine.lazyDetector.removeObserver(),this.clearExternalServices(),a.default.instance.unsubscribe(),s.default.resetWindowObjects(),this.logger.info("injecting bootstrap");const t=n.default.Rt();t&&t.parentElement&&t.parentElement.removeChild(t)}getAllSlidesElements(){return this.slides.map((t=>t.element))}hasUrlChanged(){const t=window.location&&window.location.href;return!this.checkUrlChanges||!t||this.currentURL!==t}getCurrentSlide(){return f.default.isSlides()?this.windowObject[this.getActionCounter()].element:this.slides[0].element}getPreviousSlides(){let t=new Set;for(let i=0;i<this.getActionCounter();i++)t.add(this.windowObject[i].element);return Array.from(t)}}i.default=p},9517:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9268),n=e(9310);class r extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Spa Initalized"),this.listenElement=i instanceof HTMLElement?i:document.body,this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.lastArticle||(this.windowObject._lastArticle=document.location.href.slice())}mutationsHandler(t){t.forEach((t=>{this.handleIfSpa(t)}))}handleIfSpa(t){t.addedNodes.length>0&&t.target instanceof Element&&this.lastArticle!==document.location.href&&(this.removeSpotsFromDOM(),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.incrementActionCounter(),this.sendDcsEvent(n.EventType.DCS_SPA),this.removeObserver(),this.runNewMiddy())}}i.default=r},9839:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(394),r=e(8803),o=e(9840);class h{static get windowObj(){return this.initiated||(this._windowObj=window[h.windowVarName]?Object.assign({},window.__dcs):null,this.initiated=!0),this._windowObj}static getWindowObject(){return this._windowObj}static isEndless(){return this.checkType(["endlessScroll"])}static isSlides(){return this.checkType(["slides"])}static isSpa(){return!!this.getSpaLastArticle()}static isManualDcs(){const t=n.Profiler.get();return t.dcs&&t.dcs.enable&&"manual"==t.dcs.type}static checkType(t){var i;const e=this.getDcsActionCounter();return!(!t.includes("script")||!n.Profiler.get().dcsState)||!!(null===(i=this.windowObj)||void 0===i?void 0:i[e])&&this.windowObj[e].element instanceof Element&&t.includes(this.windowObj.dcsType)}static getCurrentDcsElement(){var t;const i=null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.mainContentElement;if(i)return i;{const t=this.getDcsActionCounter();return this.windowObj&&this.windowObj[t]?this.windowObj[t].element:null}}static setCurrentEndlessPvid(t){const i=this.getDcsActionCounter();window[this.windowVarName][i]?Object.assign(window[this.windowVarName][i],{pvId:t}):window[this.windowVarName][i]={element:document.body,pvId:t}}static getEndlessElementByPvId(t){if(this.windowObj&&this.getDcsActionCounter())for(let i=0;i<=this.windowObj.count;i++)if(this.windowObj[i].pvId===t)return this.windowObj[i].element;return document.body}static getArticlesList(t){var i;const e=this.isEndless()&&t.articlesSelector?[t.articlesSelector]:[],r=(null===(i=n.Profiler.get().dcsState)||void 0===i?void 0:i.articleSelectors)||[],o=e||r;return o.length?Array.from(document.querySelectorAll(o.join(","))):this.isSlides()?s.default.Mi(t.mutationXpaths):[]}static isBetweenArticles(t,i){const e=this.getArticlesList(i);if(!e.length)return!1;const n=this.getCurrentDcsElement();if(n instanceof Element&&e){const i=e.indexOf(n),r=e[i+1];if(r instanceof HTMLElement){const i=s.default.B(t).y,e=s.default.B(n).y,o=s.default.B(r).y;return e<i&&i<o}}return!1}static getSpaLastArticle(){var t;return null===(t=this.windowObj)||void 0===t?void 0:t._lastArticle}static isDcsPageview(){return!!n.Profiler.get().dcsState||!!(this.windowObj&&this.windowObj.count>0)}static getDcsActionCounter(){var t;const i=(null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.count)||(this.windowObj?this.windowObj.count:null);return i&&i>0?i:0}static getDcsParentPageViewID(){var t,i,e;return(null===(i=null===(t=this.windowObj)||void 0===t?void 0:t[0])||void 0===i?void 0:i.pvId)||(null===(e=n.Profiler.get().dcsState)||void 0===e?void 0:e.parentPageView)||n.Profiler.get().pageViewID}static getLatestDcsStayObjects(){var t;const i=null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.stayAwayObjects;if(null==i?void 0:i.length)return i;{const t=this.getDcsActionCounter();return this.windowObj&&this.windowObj[t]&&this.windowObj[t].saE}}static isInCurrentArticle(t){const i=this.getCurrentDcsElement();return!(i&&i instanceof Element)||s.default.isPositionContained(i,t)}static isSlidesTriggered(){return!!(this.windowObj&&"slides"===this.windowObj.dcsType&&this.windowObj.count>0)}static shouldRetrieveDcs(){const t=n.Profiler.get();return!!(t.dcs&&t.dcs.enable&&t.dcs.mutationXpaths)}static getFirstElementFromArray(t){return t.find((t=>s.default.O(t)))||null}static retrieveMutationElementIfExists(t,i){return new Promise((function(e,r){let o=null;const a=n.Profiler.get();if(a.dcs.delay&&a.dcs.delay>0){i.info(`waiting ${a.dcs.delay} ms for dcs element`);let n=setInterval((function(){o=h.getFirstElementFromArray(s.default.Mi(t)),o&&(clearInterval(n),i.info("found dcs element"),e(o))}),100);setTimeout((function(){o||(i.info("no dcs element found"),r(new Error(h.dcsFailureMessage)))}),a.dcs.delay||0)}else o=h.getFirstElementFromArray(s.default.Mi(t)),o?e(o):r(new Error(h.dcsFailureMessage))}))}static removeStickyVar(t){try{this.windowVarName[r.StickyConstants.dcsVar]&&(this.windowVarName[r.StickyConstants.dcsVar]=null)}catch(i){t.info("failed to remove sticky ad")}}static hasDcsMc(){var t;return!(!h.isEndless()&&!(null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.mainContentElement))}static getSaObjects(t){return o.default.get().getStayAwayElements().filter((i=>s.default.isPositionedBefore(t,i.element)))}}i.default=h,h.initiated=!1,h.dcsFailureMessage="DCSError",h.windowVarName="__dcs"},6688:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(9268),r=e(9310),o=e(7328),h=e(3810);class a extends n.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Galleries Initalized"),this.mutationElement=i,this.logger.info(this.profile),this.listenElements=s.default.Mi(this.profile.dcs.mutationXpaths),this.assignClickListeners()}mutationsHandler(t){}assignClickListeners(){this.listenElements&&this.listenElements.length>0&&this.listenElements.forEach((t=>{this.assignClickListenersForElement(t)}))}assignClickListenersForElement(t){const i=t.children?[t,...Array.from(t.children)]:[t];let e=!1;s.default.jt(t,!0)?i.length&&i.forEach((t=>{o.default.get().listen("click",t,(()=>{e||(this.logger.info("clicked"),this.sendDcsEvent(r.EventType.DCS_GALLERY),o.default.get().removeAll(),h.TouchEventsService.get().disconnectResizeObserver(),setTimeout((()=>this.clickHandler()),1e3),e=!0)})),this.logger.info("waiting for click on ",t)})):this.logger.info("button not found",t)}clickHandler(){this.incrementActionCounter(),this.removeSpotsFromDOM(),this.runNewMiddy()}}i.default=a},238:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DemandTool=void 0;const s=e(4987),n=e(1250),r=e(3802),o=e(7579),h=e(2593),a=e(4107),c=e(8406),l=e(394),d=e(7111),u=e(4752),v=e(9840),f=e(7797),p={"in-content":"in",top:"t",bottom:"b",adhesive:"s"};class m{constructor(){this.relocationDelayReached=!1,this.spots=[],this.logger=new n.default("BrowsiDemandTool"),this.waitForRelocationDecision=new Promise((t=>this.relocatePromise=t)),this.relocateSpots=[],this.relocationSelectors=(l.Profiler.get().apiRelocationSelectors||[]).join(","),this.relocationActive=!!this.relocationSelectors;const t=s.default.getBrowsiTag();if(t){if(t.display=this.display.bind(this),t.cmd)for(;t.cmd.length;){const i=t.cmd.shift();"function"==typeof i&&this.execute(i)}else t.cmd=[];t.cmd.push=t=>this.execute(t)}}proceedRelocation(t){return new Promise((i=>{this.relocatePromise(t),i()}))}static get(){return m.instance||(this.instance=new m),m.instance}execute(t){try{t()}catch(t){this.reportFailure(t,"")}}display(t,i){this.runApiDisplayHook(t,i),this.logger.info(`display('${t})'`,i),this.buildSpot(t,i).then((t=>this.waitForRelocation(t))).then((t=>{t.shouldProceed&&(this.addPlacementToSA(t.spot),r.YieldClient.get().We([t.spot],o.DemandRequestType.SINGLE))})).catch((i=>this.reportFailure(i,t)))}buildSpot(t,i){return t&&"string"==typeof t||(null==i?void 0:i.shadowElement)&&s.default.O(i.shadowElement)?this.buildOptionsPromise(t,i).then((i=>this.validateElement(t,i.shadowElement).then((t=>this.validateSpot(t,i))))):Promise.reject(`container ID is null or not a string - ${t}`)}buildOptionsPromise(t,i){return i?Promise.all([this.validateSizeArray(i.sizes),this.validateRefresh(i.refresh),this.validateKeyValuesArray(i.keyValues),this.validateAdUnit(i.adUnit),this.validateViewability(i.disableViewabilityOptimization),this.validatePosition(t,i.positionTag)]).then((t=>{const e={sizes:t[0],refresh:t[1],keyValues:t[2],adUnit:t[3],disableViewabilityOptimization:t[4],positionTag:t[5],shadowElement:null==i?void 0:i.shadowElement};return Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),e})):Promise.resolve({})}validateSpot(t,i){return new Promise(((e,s)=>{if(this.noSizesDefinedForSpot(i))return s(`No sizes defined for this spot - ${t.id}`);this.logger.info("Processed element and options:",t,i);const n=this.spots.length,r=new a.ApiSpot(t,n,i);this.spots.push(r),r.relocationStatus=this.getRelocationStatus(r),c.default.reportSpot(r),this.attachParamsToRef(t,i),e(r)}))}noSizesDefinedForSpot(t){return(!t.sizes||0===t.sizes.length)&&0===h.SpotsUtils.getSizes({typeTag:"api",positionTag:t.positionTag||"in"}).length}validateElement(t,i){return new Promise(((e,n)=>{if(i&&s.default.O(i))return e(i);const r=document.getElementById(t);return r?e(r):n(`no element with such id exists - ${t}`)}))}validateSizeArray(t){return new Promise(((i,e)=>{t||i(),Array.isArray(t)||e("sizes is not a valid sizes array. Please supply an array of objects: {w: adWidth, h: adHeight}"),(t=this.validateSizes(t)).length||i(),i(t)}))}validateRefresh(t){return new Promise(((i,e)=>{void 0===t&&i(),"boolean"==typeof t?i({active:!!t}):"object"==typeof t&&"boolean"==typeof t.active?(void 0!==t.refreshSecond&&("number"!=typeof t.refreshSecond||t.refreshSecond<=0)&&e("refresh.refresh.refreshSecond should be positive number"),i(Object.assign({active:!!t.active},t.refreshSecond?{refreshSecond:t.refreshSecond}:{}))):e("refresh is not a valid object. Please supply an object: {active: true/false}")}))}validateKeyValuesArray(t){return new Promise(((i,e)=>{t||i(),t&&this.isInvalidKeyValuesArray(t)&&e("keyValues is not a valid key-value array. Please supply an array of objects: {key: key, value: value}"),t=this.removeUnsupportedKeyValues(t),this.processKeyValuesArray(t),i(t)}))}processKeyValuesArray(t){const i=t=>"string"!=typeof t?t.toString():t;t.forEach((t=>{Array.isArray(t.value)?t.value.forEach(((e,s)=>{t.value[s]=i(e)})):t.value=i(t.value)}))}validateAdUnit(t){return new Promise(((i,e)=>{t||i(),t&&this.isInvalidAdUnit(t)&&e('adUnit is not in the valid format. Please make sure to send a string in the format: "/pubId/adUnit"'),s.default.startsWith("/",t)||(t="/"+t),i(t)}))}validateViewability(t){return new Promise(((i,e)=>{if(t&&"boolean"!=typeof t)return e("optimizeViewability is not in the valid format. Please make sure to send a boolean value (true/false)");i(!!t)}))}validatePosition(t,i){return new Promise(((e,s)=>{if(!i){const i=l.Profiler.get().spotsSupplyParams.api||{};return Object.keys(i).forEach((s=>{var n;const r=null===(n=i[s])||void 0===n?void 0:n.positionIds;if(this.matchRegexOrString(t,r))return e(s)})),e("in")}return e(p[i])}))}matchRegexOrString(t,i){return!!(null==i?void 0:i.some((i=>new RegExp("^/.*/$").test(i)?(i=i.substring(1,i.length-1),new RegExp(i).test(t)):t===i)))}isInvalidSizeArray(t){return!Array.isArray(t)||0===t.length||t.some((t=>isNaN(t.w)||isNaN(t.h)))}validateSizes(t){t=t.map((t=>"string"==typeof t&&"fluid"===t.toLowerCase()?{h:0,w:0}:{h:Number(t.h),w:Number(t.w)}));return t.filter((t=>!(t=>(isNaN(t.w)||isNaN(t.h))&&!("string"==typeof t&&"fluid"!==t.toLowerCase()))(t)))}isInvalidKeyValuesArray(t){return!Array.isArray(t)||0===t.length}removeUnsupportedKeyValues(t){const i=t=>"string"!=typeof t.key||!this.isSupportedKeyValType(t.value)&&(!Array.isArray(t.value)||t.value.some((t=>!this.isSupportedKeyValType(t))));return t.filter((t=>!i(t)))}isSupportedKeyValType(t){return["string","number","boolean"].includes(typeof t)}isInvalidAdUnit(t){return"string"!=typeof t||1===t.split("/").length}reportFailure(t,i){this.logger.error("browsitag execution failed:",t),i="string"==typeof i?i:"",d.default.get().sendApiRequestBlockedEvent("api_failed",t,i)}attachParamsToRef(t,i){s.default.isBrowsiLoggerActive()&&(t.spotOptions=i)}runApiDisplayHook(t,i){const e=u.default.getExternalFlowHandler("apiDisplay");e&&e(t,i)}holdEngineForRelocation(){return new Promise(((t,i)=>{if(!this.relocationActive)return t();const e=u.default.getExternalFlowHandler("apiRelocationDelay");e?e(t,i):setTimeout((()=>t()),300)})).then((()=>{this.relocationDelayReached=!0,this.relocateSpots=this.relocateSpots.sort((function(t,i){return 2&t.ref.compareDocumentPosition(i.ref)?1:-1}))}))}addPlacementToSA(t){var i,e,s;if("s"===(null===(i=t.options)||void 0===i?void 0:i.positionTag))return;const n=null===(e=l.Profiler.get().spotsSupplyParams.dynamic)||void 0===e?void 0:e.distance;if(!n)return void(((null===(s=l.Profiler.get().spotsSupplyParams.dynamic)||void 0===s?void 0:s.maxItems)||this.relocationActive)&&this.logger.error("no SA distance configured for inline spots, cant add API spot to SA"));const r={distance:n,toDensity:!1,type:f.StayAwayType.BOTH};v.default.get().upsertStayAwayElement(t.ref,r,!1,"API")}waitForRelocation(t){return new Promise((i=>{this.shouldRelocate(t)?(this.relocateSpots.push(t),this.waitForRelocationDecision.then((e=>{if(!e){const i=this.relocateSpots.findIndex((i=>i.spotIndex===t.spotIndex));i>-1&&this.relocateSpots.splice(i,1)}i({shouldProceed:!e,spot:t})}))):i({shouldProceed:!0,spot:t})}))}shouldRelocate(t){return 1===t.relocationStatus}getRelocationStatus(t){if(this.relocationActive)return t.ref.matches(this.relocationSelectors)?this.relocationDelayReached?-2:1:0}}i.DemandTool=m},7111:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4075),n=e(1250),r=e(9310),o=e(4987),h=e(1332),a=e(9714),c=e(6761),l=e(9839),d=e(4752),u=e(9486),v=e(8473),f=e(4059),p=e(7004),m=e(394),g=e(8910),b=e(1159),w=e(7093),_=e(626),y=e(3810),S=e(9497);class O{constructor(t){this.eventsQue={},this.profile=t,this.staticFields=this.buildStaticFields(),this.supplyStaticFields=this.buildSupplyStaticFields(),this.demandStaticFields=this.buildDemandStaticFields(),this.inframeStaticFields=this.buildInframeStaticFields(),this.eventServerUrl=t.esReportDomain,this.logger=new n.default("Events"),this.dcsCounter=0,this.sendEventsThrottle=o.default.Ci(this.flushEventsQue.bind(this),this.profile.bulkEventsThrottle||0,!1),this.isValidEventServerUrl=this.isValidURL(this.eventServerUrl),this.isValidEventServerUrl||this.logger.error("Invalid event server URL")}static get(){return O._instance||(this._instance=new O(window._middyo)),O._instance}static getFiredEvents(){return O.firedEvents}static addToFiredEvents(t,i){this.firedEvents[t]&&Array.isArray(this.firedEvents[t])||(this.firedEvents[t]=[]),this.firedEvents[t].push(...i)}sendEngineLoadedEvent(){const t=this.getEngineLoadedEvent();this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.ENGINE_LOADED,[t]),this.initBeaconFlushQue()}sendPageviewEvent(t,i,e,n){this.profile.analysisMode||"pageview"===m.Profiler.get().billableEvents&&o.default.dispatchDOMEvent("browsi_pageview",{},window);const h=this.getPageViewEvent(t,i,e);n&&(h.ppvid=this.staticFields.pvid,h.pvid=n),this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.PAGE_VIEW,[h])}sendSpotFoundEvent(t){let i=this.getSpotFoundEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.SPOT_FOUND,[i])}sendBidRequests(t,i){let e=this.getBidRequestEvent(t,i);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.BID_REQUEST,[e])}sendBidMatch(t,i){let e=this.getBidMatchedEvent(t,i);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.BID_MATCHED,[e])}ve(t,i,e,n,o,h){const a=this.getAdRequest(t,i,e,n,o,h);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST,[a])}ns(t,i){const e=this.getInframeAdRequest(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST,[e])}ge(t,i,e,n,o,h,a){const c=this.getAdMatchedEvent(t,e,i,n,o,h,a);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_MATCHED,[c])}ls(t,i,e){const n=this.ys(i,t,e);this.addToEventsQue(s.EventTopic.INFRAME,r.EventType.INFRAME_HAS_DEMAND,[n])}hs(t,i,e,n){const o=this.getInframeAdMatchedEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_MATCHED,[o])}Yi(t,i,e,n,o,h){const a=this.getAdImpressionEvent(t,i,e,n,o,h);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IMPRESSION,[a])}Ze(t,i,e){const n=this.Ss(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IMPRESSION,[n])}sendAdMeasurableEvent(t,i,e,n){const o=this.getAdMeasurableEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.MEASURABLE_IMPRESSION,[o])}Os(t,i,e,n){const o=this.getViewedImpressionEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION,[o])}As(t,i,e){const n=this.Es(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION,[n])}sendViewedImpressionAV(t,i){const e=this.getViewedImpressionEventAV(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION_AV,[e])}sendFoundPublisherAd(t,i){const e=this.getFoundPublisherAd(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.FOUND_PUBLISHER_AD,[e])}sendDcs(t,i,e,n,r){const o=this.getDcsEvent(t,i,e,n,r);this.addToEventsQue(s.EventTopic.SUPPLY,t,[o])}Ps(t,i,e){const n=this.Ts(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_PUBLISHER_AD,[n])}sendViewedPublisherAdAV(t){const i=this.getViewedPublisherAdAv(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_PUBLISHER_AD_AV,[i])}sendPubAdRefreshRequest(t,i,e,n){const o=this.getPubAdRefreshEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PUB_AD_REFRESH_REQUEST,[o])}sendAdInViewport(t,i){const e=this.getAdInViewportEvent(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IN_VIEWPORT,[e])}sendStayAway(t){if(0===t.length)return;const i=this.getStayAwayEvent(t);this.addToEventsQue(s.EventTopic.UX_RULES,r.EventType.STAY_AWAY,[i])}sendSkipped(t){if(0===t.length)return;const i=this.getSkippedEvent(t);this.addToEventsQue(s.EventTopic.UX_RULES,r.EventType.SKIPPED,[i])}sendAnalyticsEvent(t){const i=v.default.get().getMostSampledAvgHighestBid(),{uahbc:e,rahbc:n,lahbc:o}=v.default.get().getAverageHighestBidByCurrencyMetrics();let h=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.USER_STATS,to:d.default.getTimeOffset(),c:t.c,bi:t.bi,bv:t.bv,pi:t.pi,pv:t.pv,b_ativ:t.tiv.b_ativ,aul:t.aul.a,uva:t.uv.t_a,uvsp:t.uv.t_sp,oofu:t.aof.t_a,uid:d.default.getUserID(),sid:this.profile.sessionID,ahbc:t.ahbc},t.nam?{nam:t.nam}:{}),t.ahb?{ahb:t.ahb}:{}),(null==i?void 0:i.avg)?{mahb:i.avg}:{}),(null==i?void 0:i.curr)?{cur:i.curr}:{}),e?{uahbc:e}:{}),n?{rahbc:n}:{}),o?{lahbc:o}:{});this.addToEventsQue(s.EventTopic.ANALYTIC,r.EventType.USER_STATS,[h])}sendWebVitalsEvent(t){const{sk:i,pk:e,dp:n}=this.staticFields,{pv:o,lcp:h,cls:a,inp:c}=t;let l=Object.assign(Object.assign(Object.assign(Object.assign({},h?{lcp:h}:{}),a?{cls:a}:{}),c?{inp:c}:{}),{to:d.default.getTimeOffset()}),u={sk:i,pk:e,dp:n,pvid:o};const v=Object.assign({events:[l]},u);this.sendBeacon(s.EventTopic.WEB_VITALS,[v],!1,r.EventType.WEB_VITALS)||this.addToEventsQue(s.EventTopic.WEB_VITALS,r.EventType.WEB_VITALS,[v])}sendGeneralDataEvent(t,i){let e=Object.assign(Object.assign(Object.assign({},this.staticFields),this.supplyStaticFields),{events:[{et:r.EventType.GENERAL_DATA,to:d.default.getTimeOffset(),gd:t}]});i&&i.forEach((t=>{delete e[t]}));this.sendBeacon(s.EventTopic.ANALYTIC,[e],!1,r.EventType.GENERAL_DATA)||this.addToEventsQue(s.EventTopic.ANALYTIC,r.EventType.GENERAL_DATA,[e])}sendSummaryEvent(){const t=u.Engagement.get().getData(),i=(new g.default).getData(),e=v.default.get().getHighestBidData().map((t=>(t.sum_br=+t.sum_br.toFixed(2),t))),n=b.ProfitabilityPredictorService.get().getPrediction(),h=w.default.prediction,c=this.getAdsDistanceViolation();let l=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.SUMMARY,to:d.default.getTimeOffset(),ads:v.default.get().currentVisitImpressions,dep:t.max_depth_percentage,sl:t.screen_length,plt:t.page_load_time,top:t.time_on_page,v:t.velocity_including_static_time,vest:t.velocity_excluding_static_time,pl:o.default.M(),dt:p.default.instance.getTotalAdDensity(),denp:p.default.instance.getPublisherAdDensity(),paf:a.default.get().foundAds.length,p_w:e,ps:Object.assign({},i)},"number"==typeof n?{pp:n}:{}),"number"==typeof h?{sp:h}:{}),c?{adv:c}:{}),this.profile.predictorsVersions.profit?{ppv:this.profile.predictorsVersions.profit}:{}),this.profile.predictorsVersions.scroll?{spv:this.profile.predictorsVersions.scroll}:{}),{uid:d.default.getUserID(),sid:this.profile.sessionID}),f={scid:this.profile.supplyConfigId,sk:this.staticFields.sk,pk:this.staticFields.pk,pvid:this.staticFields.pvid,dp:this.staticFields.dp,geo:this.staticFields.geo,ts:this.staticFields.ts,db:this.staticFields.db,dos:this.staticFields.dos,d:this.staticFields.d,mv:this.staticFields.mv,bpvid:this.staticFields.bpvid,url:this.staticFields.url};const m=Object.assign({events:[l]},f);this.sendBeacon(s.EventTopic.ENGAGEMENT,[m],!1,r.EventType.SUMMARY)||this.addToEventsQue(s.EventTopic.ENGAGEMENT,r.EventType.SUMMARY,[m])}sendDemandSummaryEvent(){const{adsTouchesMap:t}=y.TouchEventsService.get().getTouchMaps(),i=0!==Object.keys(t).length,e=S.ViewabilityService.instance.getTimeInViewSummaryMap();if(!(0!==Object.keys(e).length)&&!i)return;const n={et:r.EventType.DEMAND_SUMMARY,to:d.default.getTimeOffset(),plc:this.getDemandSummaryPlacementData(e,t)},o={scid:this.profile.supplyConfigId,sk:this.staticFields.sk,pk:this.staticFields.pk,pvid:this.staticFields.pvid,dp:this.staticFields.dp,mv:this.staticFields.mv,aid:this.staticFields.aid},h=Object.assign({events:[n]},o);this.sendBeacon(s.EventTopic.DEMAND_ENGAGEMENT,[h],!1,r.EventType.DEMAND_SUMMARY)||this.addToEventsQue(s.EventTopic.DEMAND_ENGAGEMENT,r.EventType.DEMAND_SUMMARY,[h])}sendPubDemandSummaryEvent(t){const i=t.filter((t=>t.highestBid));if(!i.length)return;const e=function(t){const i=t.reduce(((t,i)=>{let e=i.highestBid;return t[e.currency]=(t[e.currency]||0)+1,t}),{});return Object.keys(i).reduce(((t,e)=>i[t]>i[e]?t:e))}(i),n=i.map((t=>{const i=t.highestBid;return{au:t.adUnit,size:`${t.width}x${t.height}`,rc:t.refreshCount,bid:i.currency===e?+i.cpm.toFixed(3):-1,ot:t.topPos,plid:t.placementId,pos:t.positionType}})),o={et:r.EventType.PUB_DEMAND_SUMMARY,to:d.default.getTimeOffset(),cur:e,pa:n},h={scid:this.profile.supplyConfigId,sk:this.staticFields.sk,pk:this.staticFields.pk,pvid:this.staticFields.pvid,dp:this.staticFields.dp,mv:this.staticFields.mv,aid:this.staticFields.aid},a=Object.assign({events:[o]},h);this.sendBeacon(s.EventTopic.DEMAND_ENGAGEMENT,[a],!1,r.EventType.PUB_DEMAND_SUMMARY)||this.addToEventsQue(s.EventTopic.DEMAND_ENGAGEMENT,r.EventType.PUB_DEMAND_SUMMARY,[a])}getDemandSummaryPlacementData(t,i){const e=m.Profiler.mergeDeep(t,i);return Object.keys(e).flatMap((t=>Object.keys(e[t]).map((i=>{const{mtiv:s,apiv:n,mind:r}=e[t][i];return Object.assign(Object.assign(Object.assign({adix:Number(t),rc:Number(i)},s?{mtiv:s}:{}),n?{apiv:n}:{}),"number"==typeof r?{mind:r}:{})}))))}getAdsDistanceViolation(){if(this.profile.adsDistanceViolations){const t=_.AdsDistanceViolationsService.get().getAdsDistanceViolation();if(Object.values(t).some((t=>0!==t)))return t}}sendFoldSummaryEvent(){const{foldsTouchesMap:t}=y.TouchEventsService.get().getTouchMaps();if(!(0!==Object.keys(t).length))return;const i={et:r.EventType.FOLD_SUMMARY,to:d.default.getTimeOffset(),fd:this.getFoldsTouchesData(t)},e={scid:this.profile.supplyConfigId,sk:this.staticFields.sk,pk:this.staticFields.pk,pvid:this.staticFields.pvid,dp:this.staticFields.dp,ts:this.staticFields.ts,mv:this.staticFields.mv,aid:this.staticFields.aid},n=Object.assign({events:[i]},e);this.sendBeacon(s.EventTopic.FOLDS,[n],!1,r.EventType.FOLD_SUMMARY)||this.addToEventsQue(s.EventTopic.FOLDS,r.EventType.FOLD_SUMMARY,[n])}getFoldsTouchesData(t){return Object.keys(t).map((i=>({f:Number(i),t:t[i]})))}sendFocusChangedEvent(t,i){const e=this.getFocusChangeEvent(t,i);this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.FOCUS_CHANGED,[e])}sendAdRequestBlockedEvent(t,i,e){const n=this.getAdBlockEvent(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST_BLOCKED,[n])}sendApiRequestBlockedEvent(t,i,e){const n=this.getApiBlockEvent(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST_BLOCKED,[n])}sendPubAdRefreshBlockedEvent(t,i){const e=this.getRefreshBlockEvent(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PUB_AD_REFRESH_BLOCK,[e])}sendStickyClosedEvent(t){const i=this.getStickClosedEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.STICKY_CLOSED,[i])}sendHBWinner(t,i){const e=this.getHBWinnerEvent(t,i.bidder,i.cpm,i.height,i.width);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.HBWinner,[e])}sendAPSWinner(t){const i=this.getHBWinnerEvent(t,"aps",-1);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.HBWinner,[i])}sendErrorEvent(t,i,e,s){const n=this.getErrorEvent(t,e,i,s);this.sendError(t,n)}sendPlaceholderViewed(t){const i=this.getPlaceholderEvent(t,r.EventType.PLACEHOLDER_VIEWED);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PLACEHOLDER_VIEWED,[i])}sendPlaceholderClosed(t,i){const e=this.getPlaceholderEvent(t,r.EventType.PLACEHOLDER_CLOSED,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PLACEHOLDER_CLOSED,[e])}sendBillableEvent(t){const i=this.getBillableEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.BILLABLE_EVENT,[i])}sendError(t,i){this.profile.debug?this.logger.error(i):this.addToEventsQue(s.EventTopic.ERROR,t,[i])}addToEventsQue(t,i,e,s){this.isValidEventServerUrl&&(this.shouldThrottleEvent(t)?(this.eventsQue[t]=this.eventsQue[t]||[],this.eventsQue[t].push(...e),this.sendEventsThrottle()):this.sendEventsByShadowLead(t,e),O.addToFiredEvents(t,e),this.logger.style(`%c[${this.logger.name}] ${t}/${i} ${s?`[${s}]`:""}`,"color: white; background-color: #42919D; border-radius: 4px; font-size:16px; font-weight:bold; padding:2px;",1===e.length?e[0]:e))}shouldThrottleEvent(t){return!!this.profile.bulkEventsThrottle&&![s.EventTopic.ERROR,s.EventTopic.SUPPLY].includes(t)}flushEventsQue(t=!1){for(let i in this.eventsQue)if(this.eventsQue.hasOwnProperty(i)&&this.eventsQue[i].length){this.sendEventsByShadowLead(i,this.eventsQue[i],t)&&(this.eventsQue[i]=[])}}sendEventsByShadowLead(t,i,e=!1){if(this.profile.shadowPublisher&&[s.EventTopic.DEMAND,s.EventTopic.HEADER_BIDDING].includes(t)){const s=i.filter((t=>t.hasOwnProperty("sd"))),n=i.filter((t=>!t.hasOwnProperty("sd"))),r=this.sendByType(e,!0,t,n,!1),o=this.sendByType(e,!0,t,s,!0);return r||o}return this.sendByType(e,!0,t,i)}sendByType(t,i,e,s,n=!1){return!s.length||(t?this.sendBeacon(e,this.getBulkEventByTopic(e,s,n),i):(this.send(e,this.getBulkEventByTopic(e,s,n)),!0))}getBulkEventByTopic(t,i,e=!1){const n={events:i};if(t===s.EventTopic.ENGAGEMENT||t===s.EventTopic.DEMAND_ENGAGEMENT||t===s.EventTopic.FOLDS)return Object.assign({},i);if(t===s.EventTopic.HEADER_BIDDING)return i.map((t=>Object.assign(Object.assign(Object.assign(Object.assign({},t),this.staticFields),this.demandStaticFields),e?Object.assign(Object.assign({},this.profile.shadowPublisher),{lsk:this.staticFields.sk,lpk:this.staticFields.pk,lscid:this.demandStaticFields.scid}):{})));if(t===s.EventTopic.INFRAME)return[Object.assign(Object.assign({},n),this.inframeStaticFields)];if(t===s.EventTopic.DEMAND)return[Object.assign(Object.assign(Object.assign(Object.assign({},n),this.staticFields),this.demandStaticFields),e?Object.assign(Object.assign({},this.profile.shadowPublisher),{lsk:this.staticFields.sk,lpk:this.staticFields.pk,lscid:this.demandStaticFields.scid}):{})];if(t===s.EventTopic.SUPPLY||t===s.EventTopic.ANALYTIC){const e=Object.assign(Object.assign(Object.assign({},n),this.staticFields),this.supplyStaticFields);return t===s.EventTopic.SUPPLY&&i[0].pvid&&(e.pvid=i[0].pvid,delete i[0].pvid),[e]}return t===s.EventTopic.REFRESH?[Object.assign(n,{pk:this.staticFields.pk})]:(t===s.EventTopic.UX_RULES&&Object.assign(n,{pk:this.staticFields.pk,sk:this.staticFields.sk,pvid:this.staticFields.pvid,aid:this.staticFields.aid,mv:this.staticFields.mv,dp:this.staticFields.dp,scid:this.profile.supplyConfigId}),[n])}send(t,i){const e=new XMLHttpRequest;e.open("POST",`${this.eventServerUrl}v2/${t}?p=${this.staticFields.pvid}`,!0),e.send(JSON.stringify(i)),this.testEvents(i)}testEvents(t){if(this.profile.test){const i=o.default.getBrowsiTag();i&&(i.tee=i.tee||[],i.tee.push(...t))}}sendBeacon(t,i,e=!1,s,n){try{this.testEvents(i);if(navigator.sendBeacon(`${this.eventServerUrl}v2/${t}?p=${this.staticFields.pvid}`,JSON.stringify(i)))return e?this.logger.verbose("flush events beacon",i):(O.addToFiredEvents(t,i),this.logger.style(`%c[${this.logger.name}] ${t}/${s} ${n?`[${n}]`:""}`,"color: white; background-color: #42919D; border-radius: 4px; font-size:16px; font-weight:bold; padding:2px;",1===i.length?i[0]:i)),!0}catch(t){return this.logger.verbose("failed sending events on beacon",i),!1}return!1}initBeaconFlushQue(){f.default.instance.subscribe((t=>{t&&this.flushEventsQue(!0)}))}sendUserEngagedEvent(){const t=this.getUserEngagementEvent();this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.USER_ENGAGED,[t])}sendCustomRefreshRateEvent(t,i){let e=this.getCustomRefreshRateEvent(t,i);this.addToEventsQue(s.EventTopic.REFRESH,r.EventType.CUSTOM_REFRESH_RATE_RULE,[e])}buildStaticFields(){return{bpvid:this.profile.bootstrapPageViewId,sk:this.profile.siteKey,pk:this.profile.publisherKey,pvid:this.profile.pageViewID,geo:this.profile.countryCode,url:encodeURIComponent(o.default._i()),ts:this.profile.trafficSource,db:this.profile.deviceType&&this.profile.deviceType.browser||"",dbt:this.profile.deviceType&&this.profile.deviceType.browserType||"",d:this.profile.deviceType&&this.profile.deviceType.device?this.profile.deviceType.device:"",dp:this.profile.deviceType&&this.profile.deviceType.devicePlatform||"",dos:this.profile.deviceType&&this.profile.deviceType.os||"",dosv:this.profile.deviceType&&this.profile.deviceType.osVersion||"",mv:this.profile.version,aid:this.profile.articleId}}buildSupplyStaticFields(){return{iru:this.profile.isReturningUser,scid:this.profile.supplyConfigId,res:`${screen.width}x${screen.height}`}}buildDemandStaticFields(){return{mv:this.profile.version,scid:this.profile.supplyConfigId}}buildInframeStaticFields(){var t,i;return{geo:this.profile.countryCode,db:(null===(t=this.profile.deviceType)||void 0===t?void 0:t.browser)||"",dos:(null===(i=this.profile.deviceType)||void 0===i?void 0:i.os)||"",scid:this.profile.supplyConfigId,pk:this.staticFields.pk,pvid:this.staticFields.pvid,mv:this.staticFields.mv,sk:this.staticFields.sk,dp:this.staticFields.dp,d:this.staticFields.d}}getEngineLoadedEvent(){return Object.assign({et:r.EventType.ENGINE_LOADED,to:d.default.getTimeOffset(),ul:o.default.W()})}getPageViewEvent(t,i,e){const s=o.default.getArticleAge();return Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.PAGE_VIEW,uid:d.default.getUserID(),sid:this.profile.sessionID,mi:t,fmi:i,pl:o.default.M(),sl:o.default.H(),to:d.default.getTimeOffset(),mcs:h.default.instance.calculateMCSize(!0),mcst:h.default.instance.getMCStart(),mcc:h.default.instance.getScanStatus(),ul:o.default.W(),ppv:this.profile.predictorsVersions.profit,spv:this.profile.predictorsVersions.scroll},this.profile.runMode?{mod:this.profile.runMode}:{}),e&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()?{ac:l.default.getDcsActionCounter()}:{}),this.shouldSendParentPageViewId(e)?{ppvid:l.default.getDcsParentPageViewID()}:{}),s>-1?{aa:s}:{})}getSpotFoundEvent(t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.SPOT_FOUND,adix:t.spotIndex,pt:t.positionType,to:d.default.getTimeOffset(),dcs:t.isDcs,f:o.default.tt(t),ot:o.default.B(t.ref).y,ill:t.isLazyLoading,ul:o.default.W(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getBidRequestEvent(t,i){return Object.assign(Object.assign({et:r.EventType.BID_REQUEST,adix:t.spotIndex,di:t.demandIndex,atix:t.Li,ot:o.default.B(t.ref).y,rc:t.refreshCount,to:d.default.getTimeOffset(),st:t.type,b:i},this.getSpotTypeAndTags(t)),t.isShadowDemand?{sd:!0}:{})}getBidMatchedEvent(t,i){return Object.assign(Object.assign({et:r.EventType.BID_MATCHED,adix:t.spotIndex,di:t.demandIndex,atix:t.Li,ot:o.default.B(t.ref).y,rc:t.refreshCount,to:d.default.getTimeOffset(),st:t.type,b:i},this.getSpotTypeAndTags(t)),t.isShadowDemand?{sd:!0}:{})}getHBWinnerEvent(t,i,e,s,n){const o={n:i,s:[{br:e}]};return Object.assign(Object.assign(Object.assign({et:r.EventType.HBWinner,di:t.demandIndex,to:d.default.getTimeOffset(),adix:t.spotIndex,atix:t.Li,rc:t.refreshCount,b:[o]},this.getSpotTypeAndTags(t)),s?{h:s}:{}),n?{w:n}:{})}getAdRequest(t,i,e,s,n,h){var a;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_REQUEST,adix:t.spotIndex,di:t.demandIndex,au:i,atix:t.Li,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.tt(t),ot:o.default.B(t.ref).y,ill:t.isLazyLoading,rc:t.refreshCount,to:d.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default.W(),st:t.type,s},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),t.type===c.SpotType.API&&(null===(a=t.options)||void 0===a?void 0:a.disableViewabilityOptimization)?{vod:!0}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),"number"==typeof n?{pi:n}:{}),h?{rsn:h}:{}),t.convertedToEager?{ce:!0}:{}),t.isShadowDemand?{sd:!0}:{})}getDcsEvent(t,i,e,s,n){return Object.assign({to:d.default.getTimeOffset(),et:t,pl:o.default.M(),mi:e,fmi:n,ul:o.default.W()})}getAdMatchedEvent(t,i,e,s,n,a,u){const f=v.default.get().getHighestBidDataByCode(t.newBrowsiAd.adContainer.id,i);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_MATCHED,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Li,pr:t.genericParams.displayName||t.providerName||"NA",im:e,w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.ref).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.ref),ill:t.isLazyLoading,rc:t.refreshCount,to:d.default.getTimeOffset(),plk:s,dcs:t.isDcs,ul:o.default.W(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),n?{rsn:n}:{}),f?{hb:+f.cpm.toFixed(3),cur:f.currency}:{}),t.generalData?{gd:t.generalData}:{}),a),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),u?{msg:u}:{}),t.convertedToEager?{ce:!0}:{}),t.isShadowDemand?{sd:!0}:{})}getInframeAdMatchedEvent(t,i,e,s){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_MATCHED,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",im:i,w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.ref).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.ref),ill:t.isLazyLoading,to:d.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default.W(),st:t.type,sid:this.profile.sessionID},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),s?{rsn:s}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getAdImpressionEvent(t,i,e,s,n,a){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_IMPRESSION,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Li,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.browsiAd).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:t.refreshCount,to:d.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default.W(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),n),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),t.convertedToEager?{ce:!0}:{}),a?{rsn:a}:{}),t.isShadowDemand?{sd:!0}:{})}Ss(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_IMPRESSION,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.browsiAd).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,to:d.default.getTimeOffset(),plk:i,dcs:t.isDcs,ul:o.default.W(),st:t.type,sid:this.profile.sessionID},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),e?{ded:!0}:{})}getAdMeasurableEvent(t,i,e,s){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.MEASURABLE_IMPRESSION,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Li,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.browsiAd).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:t.refreshCount,to:d.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default.W(),st:t.type},this.getSpotTypeAndTags(t)),s?{rsn:s}:{}),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.convertedToEager?{ce:!0}:{})}getViewedImpressionEvent(t,i,e,s){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.VIEWED_IMPRESSION,adix:t.spot.spotIndex,di:t.spot.demandIndex,au:t.adUnit||(t.demandResponse.c.d?t.demandResponse.c.d.au:t.demandResponse.c.au)||"NA",atix:t.spot.Li,pr:t.spot.genericParams.displayName||t.spot.providerName||"",w:t.spot.implementedSize?t.spot.implementedSize.w:-1,h:t.spot.implementedSize?t.spot.implementedSize.h:-1,f:o.default.tt(t.spot),ot:o.default.B(t.spot.browsiAd).y,pt:t.spot.type===c.SpotType.STICKY?t.spot.positionType:h.default.instance.getAdPositionType(t.spot.browsiAd),ill:t.spot.isLazyLoading,rc:t.refreshCount,to:d.default.getTimeOffset(),tiv:i,piv:e,plk:t.demandResponse.plk,dcs:t.spot.isDcs,ul:o.default.W(),st:t.spot.type},this.getSpotTypeAndTags(t.spot)),this.getDcsCountAndType(t.spot.isDcs)),t.spot.type===c.SpotType.API||this.shouldSendParentPageViewId(t.spot.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.spot.generalData?{gd:t.spot.generalData}:{}),t.gamResponseInfo),t.spot.relocationPlid?{plid:t.spot.relocationPlid}:{}),t.spot.type===c.SpotType.API?{plid:t.spot.ref.id}:{}),"number"==typeof t.spot.relocationStatus?{rs:t.spot.relocationStatus}:{}),t.spot.convertedToEager?{ce:!0}:{}),t.spot.isShadowDemand?{sd:!0}:{}),s?{rsn:s}:{})}Es(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.VIEWED_IMPRESSION,adix:t.spot.spotIndex,pr:t.spot.genericParams.displayName||t.spot.providerName||"",w:t.spot.implementedSize?t.spot.implementedSize.w:-1,h:t.spot.implementedSize?t.spot.implementedSize.h:-1,f:o.default.tt(t.spot),ot:o.default.B(t.spot.browsiAd).y,pt:t.spot.type===c.SpotType.STICKY?t.spot.positionType:h.default.instance.getAdPositionType(t.spot.browsiAd),ill:t.spot.isLazyLoading,to:d.default.getTimeOffset(),tiv:i,piv:e,plk:t.demandResponse.plk,dcs:t.spot.isDcs,ims:t.spot.isMeasurable,ul:o.default.W(),st:t.spot.type,sid:this.profile.sessionID},this.getSpotTypeAndTags(t.spot)),this.getDcsCountAndType(t.spot.isDcs)),t.spot.type===c.SpotType.API||this.shouldSendParentPageViewId(t.spot.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.spot.generalData?{gd:t.spot.generalData}:{}),t.spot.relocationPlid?{plid:t.spot.relocationPlid}:{}),t.spot.type===c.SpotType.API?{plid:t.spot.ref.id}:{}),"number"==typeof t.spot.relocationStatus?{rs:t.spot.relocationStatus}:{})}getViewedImpressionEventAV(t,i){var e;return Object.assign(Object.assign(Object.assign({et:r.EventType.VIEWED_IMPRESSION_AV,adix:t.spotIndex,di:t.demandIndex,au:o.default.getDemandConfig(i).aup||"NA",atix:t.Li,pr:t.genericParams.displayName||t.providerName||"",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.tt(t),ot:o.default.B(t.browsiAd).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:(null===(e=t.refresh)||void 0===e?void 0:e.lastSuccessfulRefresh)||0,to:d.default.getTimeOffset(),ul:o.default.W(),st:t.type},this.getSpotTypeAndTags(t)),t.convertedToEager?{ce:!0}:{}),t.isShadowDemand?{sd:!0}:{})}getFoundPublisherAd(t,i){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.FOUND_PUBLISHER_AD,adix:t.adIndex,h:t.height,f:o.default.nt(t.element),ot:o.default.B(t.element).y,to:d.default.getTimeOffset(),pt:t.positionType,pr:t.providerName,plid:t.placementId,au:t.adUnit,dcs:l.default.isDcsPageview(),ul:o.default.W(),rc:t.refreshCount},this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.refreshType?{rt:t.refreshType}:{}),t.gamResponseInfo),i?{ded:!0}:{})}Ts(t,i,e){const s=t.ref;let n=o.default.B(s).y,a=t.ref.getBoundingClientRect(),c=h.default.instance.getAdPositionType(s,a.height,n,!0);return Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.VIEWED_PUBLISHER_AD,adix:t.adIndex,h:a.height,f:o.default.nt(s),ot:n,rc:t.refreshCount,to:d.default.getTimeOffset(),pt:c,tiv:i,piv:e,pr:t.provider,plid:t.placementId,au:t.adUnit,c:t.viewedImpressions,ill:t.isLazyLoaded,dcs:l.default.isDcsPageview(),ul:o.default.W()},this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.refreshType?{rt:t.refreshType}:{}),t.gamResponseInfo)}getViewedPublisherAdAv(t){let i=o.default.B(t.element).y,e=t.element.getBoundingClientRect(),s=h.default.instance.getAdPositionType(t.element,e.height,i,!0);return Object.assign({et:r.EventType.VIEWED_PUBLISHER_AD_AV,rc:t.refreshCount,h:t.height,f:o.default.nt(t.element),ot:o.default.B(t.element).y,to:d.default.getTimeOffset(),pt:s,pr:t.providerName,plid:t.placementId,au:t.adUnit,ill:t.isLazyLoaded,ul:o.default.W()})}getPubAdRefreshEvent(t,i,e,s){const n=t.ref;let a=o.default.B(n).y,c=n.getBoundingClientRect(),u=h.default.instance.getAdPositionType(n,c.height,a,!0);return Object.assign({et:r.EventType.PUB_AD_REFRESH_REQUEST,adix:t.adIndex,rc:i,f:o.default.nt(n),ot:o.default.B(n).y,to:d.default.getTimeOffset(),pt:u,pr:s,plid:t.placementId,au:t.adUnit,dcs:l.default.isDcsPageview(),ul:o.default.W(),rt:e})}getFocusChangeEvent(t,i){return Object.assign({et:r.EventType.FOCUS_CHANGED,if:t,to:d.default.getTimeOffset(),ul:o.default.W(),pl:o.default.M()},i&&{opl:!0})}getAdBlockEvent(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_REQUEST_BLOCKED,adix:t.spotIndex,atix:t.Li,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.tt(t),ot:o.default.B(t.ref).y,ill:t.isLazyLoading,rc:t.refreshCount,rsn:i,msg:e,to:d.default.getTimeOffset(),dcs:t.isDcs,st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.generalData?{gd:t.generalData}:{}),t.isShadowDemand?{sd:!0}:{})}getApiBlockEvent(t,i,e){return Object.assign({et:r.EventType.API_REQUEST_BLOCKED,rsn:t,msg:i,to:d.default.getTimeOffset(),plid:e})}getRefreshBlockEvent(t,i){return Object.assign(Object.assign({et:r.EventType.PUB_AD_REFRESH_BLOCK,ot:o.default.B(t).y,rsn:i,to:d.default.getTimeOffset(),dcs:l.default.isDcsPageview()},this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{})}getUserEngagementEvent(){return Object.assign({et:r.EventType.USER_ENGAGED,pl:o.default.M(),to:d.default.getTimeOffset(),ul:o.default.W()})}getAdInViewportEvent(t,i){return Object.assign({to:d.default.getTimeOffset(),et:r.EventType.AD_IN_VIEWPORT,rc:t.refreshCount,atix:t.Li,adix:t.spotIndex,ivp:i.toFixed(2)},t.convertedToEager?{ce:!0}:{})}getStickClosedEvent(t){return{et:r.EventType.STICKY_CLOSED,adix:t.spotIndex,di:t.demandIndex,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,ot:o.default.B(t.browsiAd).y,pt:t.type===c.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),rc:t.refreshCount,to:d.default.getTimeOffset(),ul:o.default.W()}}getErrorEvent(t,i,e,s){var n,r,o,h,a,c;return Object.assign({et:t,msg:i,file:e,now:Math.floor(Date.now()/1e3),to:+new Date-this.profile.timeOffset,lineNo:-1,columnNo:-1,url:this.staticFields.url,d:this.staticFields.d,res:this.supplyStaticFields.res,bpvid:this.profile.bootstrapPageViewId,sk:this.profile.siteKey,pk:this.profile.publisherKey,uid:d.default.getUserID(),sid:this.profile.sessionID,pvid:this.profile.pageViewID,geo:this.profile.countryCode,ts:this.profile.trafficSource,mv:this.profile.version,iru:this.profile.isReturningUser,scid:this.profile.supplyConfigId,db:(null===(n=this.profile.deviceType)||void 0===n?void 0:n.browser)||"",dbt:(null===(r=this.profile.deviceType)||void 0===r?void 0:r.browserType)||"",dp:(null===(o=this.profile.deviceType)||void 0===o?void 0:o.devicePlatform)||"",dv:(null===(h=this.profile.deviceType)||void 0===h?void 0:h.vendor)||"",dos:(null===(a=this.profile.deviceType)||void 0===a?void 0:a.os)||"",dosv:(null===(c=this.profile.deviceType)||void 0===c?void 0:c.osVersion)||""},s?{error:s}:{})}getPlaceholderEvent(t,i,e){return Object.assign(Object.assign({et:i,di:t.demandIndex,to:d.default.getTimeOffset(),adix:t.spotIndex,atix:t.Li,ul:o.default.W()},this.getSpotTypeAndTags(t)),e?{rsn:e}:{})}getInframePlacementEvent(t){return{pc:t,to:d.default.getTimeOffset(),et:r.EventType.PLACEMENTS_SENT}}ys(t,i,e){return{to:d.default.getTimeOffset(),et:r.EventType.INFRAME_HAS_DEMAND,ill:i.isLazyLoading,im:t,st:i.type,rsn:e,adix:i.spotIndex,sid:this.profile.sessionID}}getInframeAdRequest(t,i){var e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({et:r.EventType.AD_REQUEST,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.tt(t),ot:o.default.B(t.ref).y,ill:t.isLazyLoading,to:d.default.getTimeOffset(),plk:i,dcs:t.isDcs,ul:o.default.W(),st:t.type,sid:this.profile.sessionID},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===c.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.type===c.SpotType.API?{plid:t.ref.id}:{}),t.type===c.SpotType.API&&(null===(e=t.options)||void 0===e?void 0:e.disableViewabilityOptimization)?{vod:!0}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getCustomRefreshRateEvent(t,i){return{et:r.EventType.CUSTOM_REFRESH_RATE_RULE,at:t,rr:i}}getBillableEvent(t){return{et:r.EventType.BILLABLE_EVENT,to:d.default.getTimeOffset(),pr:t.type}}getSpotTypeAndTags(t){return{ptg:t.tags.positionTag,st:t.type}}getStayAwayEvent(t){return{et:r.EventType.STAY_AWAY,to:d.default.getTimeOffset(),uxi:t}}getSkippedEvent(t){return{et:r.EventType.SKIPPED,to:d.default.getTimeOffset(),uxi:t}}shouldSendParentPageViewId(t){return t&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()&&l.default.checkType(["slides","script"])}sendInframePlacementEvent(t){const i=this.getInframePlacementEvent(t);this.addToEventsQue(s.EventTopic.INFRAME,r.EventType.PLACEMENTS_SENT,[i])}getDcsCountAndType(t){return t&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()?{ac:l.default.getDcsActionCounter()}:{}}isValidURL(t){if(!t)return!1;try{return new URL("https://"+t),!0}catch(t){return!1}}}i.default=O,O.firedEvents={spotEngineStatus:"in_progress"}},4059:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(7111),n=e(1250),r=e(7328),o=e(394);class h{constructor(){this.logger=new n.default("FocusService"),this.isHidden="hidden"===document.visibilityState,this.unloading=!1,this.logger.info(`focus on start. in focus: ${!this.isHidden}`),this.isSubscribed=!0,this.isHidden&&!this.unloading&&s.default.get().sendFocusChangedEvent(!1,!0),this.subscribe((t=>{this.isHidden=t,this.logger.info(`focus changed. in focus: ${!this.isHidden}`),this.unloading||s.default.get().sendFocusChangedEvent(!t)}))}static get instance(){return this._instance||(this._instance=new h),this._instance}subscribe(t){o.Profiler.get().debug&&this.listenToDemoVisibilityChange(t);const i=r.default.get();i.listen("visibilitychange",document,(()=>{if(this.isSubscribed)switch(document.visibilityState){case"hidden":h.instance.isHidden=!0,t(!0);break;case"visible":h.instance.isHidden=!1,this.unloading=!1,t(!1)}})),i.listen("beforeunload",window,(()=>{this.unloading=!0}))}unsubscribe(){return this.isSubscribed=!1,!0}waitForUserFocus(){return this.isHidden?(this.logger.info("oof focus, waiting"),new Promise((t=>{this.subscribe((i=>{i||t()}))}))):Promise.resolve()}listenToDemoVisibilityChange(t){r.default.get().listen("demoVisibilityChange",document,(()=>{window._isHidden?(h.instance.isHidden=!0,t(!0)):(h.instance.isHidden=!1,t(!1))}))}}i.default=h},5068:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4059),r=e(1865),o=e(394);i.default=class{constructor(t,i,e=[1e3],n,r,o,h,a=!0){this.timeouts=[],this.isInView=!1,this.logger=new s.default("IntersectionHandler"),this.element=t,this.threshold=i,this.rootMargin=r,e=Array.from(new Set(e)),this.breakpoints=e.sort(((t,i)=>t-i)),this.observer=this.initObserver(),this.callback=n,this.outOfThresholdCallback=o||(()=>{}),this.isContinuousObserver=!!h,this.shouldCheckMinSize=a}initObserver(){let t={threshold:[this.threshold,Math.max(0,this.threshold-.01)],rootMargin:this.rootMargin};return n.default.instance.subscribe((t=>{t?this.clearAllTimeouts():this.isInView&&this.setBreakpointsTimeouts()})),new IntersectionObserver(this.observationCallback.bind(this),t)}observe(){return this.logger.verbose("observe ",this.element,` for threshold of ${this.threshold} with breakpoint of ${this.breakpoints} and ${this.rootMargin||"no"} rootMargin`),this.observer.observe(this.element),new Promise((t=>{this.resolver=t}))}observationCallback(t){const i=t[0];i.intersectionRatio>=this.threshold&&this.isAboveMinimumSize(i.boundingClientRect.height)?(this.isInView=!0,this.setBreakpointsTimeouts()):(this.isInView=!1,this.clearAllTimeouts(),this.outOfThresholdCallback())}isAboveMinimumSize(t){return o.Profiler.get().measureViewabilityForAllSizes||!this.shouldCheckMinSize||t>=r.MIN_AD_SIZE}setBreakpointsTimeouts(){const t=this.isContinuousObserver?[...this.breakpoints]:this.breakpoints;t.forEach((i=>{this.timeouts.push(setTimeout((()=>{const i=t.shift();this.callback(i),this.breakpoints.length||this.observationDone()}),i))}))}clearAllTimeouts(){this.timeouts.forEach((t=>{clearTimeout(t)}))}observationDone(){this.logger.info("All break points reached for element:",this.element),this.resolver(),this.clearObserver()}clearObserver(){this.logger.info("Stop observing",this.element),this.clearAllTimeouts(),this.observer.unobserve(this.element),this.observer.disconnect()}}},492:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1250),r=e(3060),o=e(7328),h=e(394),a=e(4752),c=e(2593),l=e(6761);class d{constructor(){var t,i;if(this.logger=new n.default("LazySpots"),this.userPositionInterval=-1,this.postMovementTimeoutActive=!1,this.serviceActive=!1,this.lazySpots=[],!a.default.isLazySpotsEnabled())throw new Error("no config found");this.generalLazyConfig=c.SpotsUtils.getGeneralLazyConfig(),this.lazyStatus=this.getLazyStatus(!0),this.lazySpotsListener=s.default.Ci((()=>this.checkLocationAndFetch()),100),this.approvalsCountTarget=(null===(t=this.generalLazyConfig)||void 0===t?void 0:t.approvalCount)||-1,this.profile=h.Profiler.get(),this.autoFirstFold=(null===(i=this.generalLazyConfig)||void 0===i?void 0:i.autoThreshold)?this.calculateFirstFoldByThreshold(this.generalLazyConfig.autoThreshold):0,this.fetchTime=this.buildFetchTime()}buildFetchTime(){return this.generalLazyConfig?this.generalLazyConfig.avgFetchTime:-1}checkLocationAndFetch(){this.lazyStatus.positionListenerActive||this.startUserPositionInterval(),this.fetchChecking()}fetchChecking(t=!1){if(this.lazyStatus.scrollDirection===r.ScrollDirection.DOWN)for(const i of this.lazySpots)if(this.isSpotMissed(i.spot))this.logger.verbose(`spot ${i.spot.spotIndex} at position ${s.default.B(i.spot.ref).y} missed, current position: ${s.default.Lt()}`),i.missedCallback(),this.zeroApprovalsCount(i);else if(this.isUserInThreshold(i)){if(this.logger.verbose(`user in threshold of spot ${i.spot.spotIndex}`),this.isExpectedNextPositionOk(i)){i.approvalsCount++,this.logger.verbose(`spot ${i.spot.spotIndex} approvalsCount ${i.approvalsCount}/${this.approvalsCountTarget}`),(this.approvalsTargetReached(i)||t)&&(this.logger.info(`spot ${i.spot.spotIndex} is good for fetching, userStatic=${t}`),i.fetchCallback(),this.lazySpots.splice(this.lazySpots.indexOf(i),1),this.lazySpots.length||this.stopService());break}this.zeroApprovalsCount(i)}else this.zeroApprovalsCount(i);else this.lazySpots.forEach((t=>this.zeroApprovalsCount(t)))}approvalsTargetReached(t){return t.approvalsCount>=this.approvalsCountTarget}zeroApprovalsCount(t){t.approvalsCount>0&&this.logger.verbose(`reset spot ${t.spot.spotIndex} approvalsCount 0/${this.approvalsCountTarget}`),t.approvalsCount=0}isExpectedNextPositionOk(t){return this.lazyStatus.expectedNextPosition<s.default.B(t.spot.ref).y}getLazyStatus(t){const i=s.default.Lt(),e=Date.now(),n=t?0:i-this.lazyStatus.lastPosition,o=t?0:e-this.lazyStatus.previousTime,h=t||this.lazyStatus.lastPosition<i?r.ScrollDirection.DOWN:i==this.lazyStatus.lastPosition?this.lazyStatus.scrollDirection:r.ScrollDirection.UP,a=this.fetchTime/o;return{scrollDirection:h,expectedNextPosition:0===o?i:i+n*a,previousTime:e,lastPosition:i,positionListenerActive:!t&&this.lazyStatus.positionListenerActive}}static get(){return d._instance||(this._instance=new d),d._instance}calculateFirstFoldByThreshold(t){const i=s.default.M(),e=s.default.A().height,n=(e+(t-1)*((i-e)/9))/e+1,r=Math.round(100*n)/100;return Math.max(r,1)}isLazy(t){if(t.isEagerFirstFold())return!1;const i=c.SpotsUtils.getLazyConf(t.tags);if(!this.shouldCheckLazyLoad(t)||!i)return!1;if(this.isIllegalConfig(i))return this.logger.error(`${t.type} spot ${t.spotIndex} has an illegal configuration`,i),!1;t.adDistanceFromTop=s.default.B(t.ref).y;const e=s.default.it(t)+1;return this.autoFirstFold?e>=this.autoFirstFold:e>=i.firstFold&&t.typeIndex>=i.firstAdIndex}shouldCheckLazyLoad(t){return t.type!==l.SpotType.STICKY&&this.fetchTime>-1}isIllegalConfig(t){return!this.autoFirstFold&&(void 0===t.firstFold||void 0===t.firstAdIndex)}subscribe(t,i,e){var n;this.serviceActive||this.startService(),this.isSpotMissed(t)&&e();const r=s.default.B(t.ref).y,o=d.getThresholdLocation(r,null===(n=this.generalLazyConfig)||void 0===n?void 0:n.threshold);this.logger.info(`spot ${t.spotIndex} at ${r} will start at ${o.toFixed(2)}`),this.lazySpots.push({spot:t,approvalsCount:0,thresholdLocation:o,fetchCallback:i,missedCallback:e}),this.fetchChecking()}static getThresholdLocation(t,i=0){return t-s.default.ct().height*i}isSpotMissed(t){return s.default.B(t.ref).y<=this.lazyStatus.lastPosition}stopService(){var t;this.logger.info("stopping service"),o.default.get().removeListener("scroll",s.default.Ei(),this.lazySpotsListener),clearInterval(this.userPositionInterval),this.lazyStatus.positionListenerActive=!1,this.serviceActive=!1,this.lazyStatus=this.getLazyStatus(),null===(t=this.thresholdMonitor)||void 0===t||t.stopMonitoring(),this.fetchChecking()}startService(){var t;this.logger.info("starting service"),o.default.get().listen("scroll",s.default.Ei(),this.lazySpotsListener),this.startUserPositionInterval(),(null===(t=this.profile.spotsSupplyParams.lazySpots)||void 0===t?void 0:t.recalculateThreshold)&&(this.thresholdMonitor=this.ThresholdMonitor(),this.thresholdMonitor.startMonitoring()),this.serviceActive=!0}startUserPositionInterval(){this.lazyStatus=this.getLazyStatus(),this.lazyStatus.positionListenerActive||(this.userPositionInterval=window.setInterval((()=>{if(this.lazyStatus=this.getLazyStatus(),this.logger.verbose(`direction: ${this.lazyStatus.scrollDirection.toString()}, at ${s.default.Lt().toFixed(2)}, next location: ${this.lazyStatus.expectedNextPosition.toFixed(2)}`),this.noMovement()&&!this.postMovementTimeoutActive){const t=this.lazyStatus.lastPosition;setTimeout((()=>{var i;this.postMovementTimeoutActive=!1,t===this.lazyStatus.lastPosition&&(clearInterval(this.userPositionInterval),(null===(i=this.generalLazyConfig)||void 0===i?void 0:i.staticUser)&&this.fetchChecking(!0),this.lazyStatus.positionListenerActive=!1,this.logger.verbose("positionInterval stopped, static user"))}),500),this.postMovementTimeoutActive=!0}}),100)),this.lazyStatus.positionListenerActive=!0,this.logger.verbose("positionInterval started")}isUserInThreshold(t){const i=s.default.B(t.spot.ref).y;return this.lazyStatus.lastPosition<i&&this.lazyStatus.lastPosition>t.thresholdLocation}noMovement(){return this.lazyStatus.lastPosition===this.lazyStatus.expectedNextPosition}ThresholdMonitor(){let t,i,e=s.default.M();return{startMonitoring:()=>{window.ResizeObserver?(i=new ResizeObserver((()=>{e=this.recalculateLazySpots(e)})),i.observe(s.default.K())):t=window.setInterval((()=>{e=this.recalculateLazySpots(e)}),800)},stopMonitoring:()=>{i?i.disconnect():clearInterval(t)}}}recalculateLazySpots(t){const i=s.default.M();return i>t&&(t=i,this.lazySpots.forEach((t=>{this.reCalculateSpotThreshold(t)}))),t}reCalculateSpotThreshold(t){var i;const e=s.default.B(t.spot.ref).y,n=d.getThresholdLocation(e,null===(i=this.generalLazyConfig)||void 0===i?void 0:i.threshold);n-t.thresholdLocation>50&&(this.logger.info(`spot ${t.spot.spotIndex} moved to ${e}px and will start at ${n}`),t.thresholdLocation=n)}manualFetchSpot(t){const i=this.lazySpots.find((i=>i.spot.spotIndex===t.spotIndex));i&&(i.fetchCallback(),this.lazySpots.splice(this.lazySpots.indexOf(i),1),this.lazySpots.length||this.stopService())}}i.default=d},7328:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250);class n{constructor(){this.callbackMap={},this.logger=new s.default("ListenerService"),this.externalListenersRemovers=[]}static get(){return this.instance||(this.instance=new n),this.instance}addExternalListenerRemoveFunction(t){this.externalListenersRemovers.push(t)}listen(t,i,e){i&&"function"==typeof i.addEventListener?(this.insert(t,e,i),i.addEventListener(t,e),this.logger.verbose(`Listening to ${t} on `,i)):this.logger.error("Failed listening to: ",i)}removeListener(t,i,e){if(i&&"function"==typeof i.removeEventListener){const s=this.findListener(t,e);e=s?s.callback:e,this.remove(t,e,i),i.removeEventListener(t,e),this.logger.verbose(`Stopped listening to ${t} on `,i)}else this.logger.error("Failed listening to: ",i)}removeAll(){var t;for(let t in this.callbackMap)this.callbackMap.hasOwnProperty(t)&&(this.callbackMap[t].forEach((i=>{try{i.listenObject.removeEventListener(t,i.callback),this.logger.verbose(`Stopped listening to ${t} on `,i.listenObject)}catch(e){this.logger.info(`failed to remove ${t} listener from`,i.listenObject,e.message)}})),this.callbackMap[t]=[]);null===(t=this.externalListenersRemovers)||void 0===t||t.forEach((t=>t()))}findListener(t,i){return this.callbackMap[t]&&this.callbackMap[t].find((t=>t.callback.name===i.name))}insert(t,i,e){this.callbackMap.hasOwnProperty(t)||(this.callbackMap[t]=[]),this.callbackMap[t].push({listenObject:e,callback:i})}remove(t,i,e){if(this.callbackMap.hasOwnProperty(t)){let s=this.callbackMap[t].find((t=>t.callback.toString()===i.toString()&&t.listenObject===e));if(null!=s){let i=this.callbackMap[t].indexOf(s);i>-1&&this.callbackMap[t].splice(i,1)}}}}i.default=n},8910:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1332);i.default=class{constructor(){}getData(){const t=this.getSocialWidgetsData(),i=this.getVideosData(),e=this.getCommentSectionsData(),s=this.getContentRecommendationData(),n=this.getAllImgData(),r=this.getAllParagraphsData();return{img:n.length,img_s:n.size,p:r.length,p_s:r.size,cr:s.length,cr_s:s.size,cs:e.length,cs_s:e.size,sw:t.length,sw_s:t.size,vid:i.length,vid_s:i.size}}getAllParagraphsData(){return this.getLengthAndSizeBySelector("p:not(:empty)")}getAllImgData(){return this.getLengthAndSizeBySelector("img")}getLengthAndSizeBySelector(t,i=!0,e=!0,n=!1){const r=Array.from(document.querySelectorAll(t));let o=0;return{length:r.filter((t=>{if(i&&!this.isInMainContent(t))return!1;if(n&&!s.default.jt(t,!0))return!1;const{w:r,h}=s.default.G(t);return(!e||!(r<=15||h<=15))&&(o+=h,!0)})).length,size:o}}getCommentSectionsData(){return this.getLengthAndSizeBySelector(['iframe[src*="spot.im"]','iframe[src*="disqus.com"]',".gig-comments","talkback",'div[data-spotim-module="conversation"]'].join(","))}getContentRecommendationData(){return this.getLengthAndSizeBySelector([".trc_rbox_container",'[id^="outbrain_widget_"]','[id^="rcjsload_"]','[id^="grv-personalization-"]','[id^="contentad"]',"ins.adbladeads + div.adblade-dyna"].join(","))}getVideosData(){return this.getLengthAndSizeBySelector("video",!0,!0,!0)}isInMainContent(t){return n.default.instance.withinMainContent(t)}getSocialWidgetsData(){const t=[".fb-post",".fb-comment-embed",".fb-comments",".fb-quote",".fb-video",".fb-page","iframe[src*='facebook.com']"].concat([".twitter-moment",".twitter-timeline",".twitter-grid",".twitter-tweet","twitter-widget"],["span[class*=_embed_grid][class*=PIN]","span[class*=_embed_pin][class*=PIN]"],["iframe.instagram-media"]);return this.getLengthAndSizeBySelector(t.join(","))}}},7250:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1250),r=e(7111);i.default=class{constructor(t,i,e){this.logger=new n.default("MeasurableImpressions"),this.spot=t,this.nonFriendlyFound=0,this.rootFrames=[],this.secLevelFrames=[],this.mutationConfig={childList:!0,subtree:!0},this.adUnit=i,this.plk=e}waitForSpotMeasurable(){if(this.spot.newBrowsiAd){if(this.rootFrames=this.scanAllFrames(this.spot.newBrowsiAd.adWrapper),this.rootFrames.forEach((t=>{this.secLevelFrames=this.secLevelFrames.concat(this.scanAllFrames(t))})),0==this.nonFriendlyFound&&!this.adFramesFound())return void this.waitForIframe();if(this.nonFriendlyFound>0&&!this.adFramesFound())return void this.sendEvent("non-friendly iframes");this.promiseAll(this.rootFrames.concat(this.secLevelFrames))}}sendEvent(t){this.spot.isMeasurable||(this.spot.isMeasurable=!0,r.default.get().sendAdMeasurableEvent(this.spot,this.adUnit,this.plk,t))}adFramesFound(){return this.secLevelFrames.length>0||(!this.spot.newBrowsiAd||!this.spot.newBrowsiAd.isIframe)&&this.rootFrames.length>0}promiseAll(t){let i=t.map((t=>this.waitForIframeLoad(t)));Promise.all(i).then((t=>{t.filter((t=>!t.status||"complete"!=t.status)).length||(this.logger.info("send measurable event after frames scan for spot ",this.spot.spotIndex," iframes scaned ",t," nonFriendly found ",this.nonFriendlyFound),this.sendEvent("all frames loaded"))})).catch((t=>this.logger.error("measurable no iframe loaded found ",t)))}waitForIframeLoad(t){return new Promise(((i,e)=>{const s=t.contentDocument||t.contentWindow.document;this.isIframeLoaded(s)?i({status:"complete",frame:t}):t.onload=e=>{i({status:"complete",frame:t})}}))}isIframeLoaded(t){return"complete"==t.readyState&&null!=t.querySelector("head")&&t.querySelector("head").childNodes.length>0&&null!=t.querySelector("body")&&t.querySelector("body").childNodes.length>0}scanAllFrames(t){const i=s.default.querySelectorOnDocument(t,"iframe"),e=i.filter((t=>s.default.Di(t.element)));return this.nonFriendlyFound+=i.length-e.length,e.map((t=>t.element))}waitForIframe(){this.observer=new MutationObserver((t=>this.handleMutationFound(t))),this.rootFrames.length?this.rootFrames.forEach((t=>{this.observer.observe(t.contentDocument||t.contentWindow.document,this.mutationConfig)})):this.spot.newBrowsiAd&&this.observer.observe(this.spot.newBrowsiAd.adWrapper,this.mutationConfig)}handleMutationFound(t){if(t.forEach((t=>{Array.from(t.addedNodes).forEach((t=>{"IFRAME"==t.nodeName&&this.secLevelFrames.push(t)}))})),this.secLevelFrames.length){this.logger.info("Observer destroyed");const t=this.secLevelFrames.filter((t=>s.default.Di(t)));t.length?this.promiseAll(t):this.sendEvent("non-friendly iframes")}}}},3105:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(1250),r=e(3060),o=e(394),h=e(4752),a=e(2593),c=e(6761),l=e(5068);class d{constructor(){if(this.logger=new n.default("NativeLazySpots"),this.lazySpots=[],this.lazySpotsQue=[],!h.default.isLazySpotsEnabled())throw new Error("no config found");this.bucketsMap={},this.profile=o.Profiler.get()}Is(t){const{scrollDirection:i}=t.scrollStatus;if(i===r.ScrollDirection.UP)return{shouldFetch:!1};if(this.isUserInThreshold(t)){if(this.logger.verbose(`user in threshold of spot ${t.spot.spotIndex}`),this.Ms(t))return{shouldFetch:!0};t.retestTimeoutId||this.retestExpectedNextPosition(t)}else this.isSpotMissed(t.spot)&&this.ks(t);return{shouldFetch:!1}}ks(t){clearTimeout(t.retestTimeoutId),t.isMissed||(t.isMissed=!0,this.logger.verbose(`spot ${t.spot.spotIndex} at position ${s.default.B(t.spot.ref).y} missed, current position: ${s.default.Lt()}`),t.missedCallback())}Ds(t){var i;clearTimeout(this.fetchTimeoutId),null===(i=t.observer)||void 0===i||i.clearObserver();const e=this.lazySpots.indexOf(t),s={spotIndex:t.spot.spotIndex,fetchCallback:this.Rs.bind(this,t)};this.lazySpotsQue.push(s);const n=!this.lazySpots[e-1]||this.lazySpots[e-1].isMissed;this.setFetchTimeout(n)}setFetchTimeout(t){t?this.fetchQue():this.fetchTimeoutId=setTimeout((()=>{this.fetchQue()}),50)}fetchQue(){this.lazySpotsQue.sort(((t,i)=>t.spotIndex-i.spotIndex)),this.lazySpotsQue.forEach((t=>{t.fetchCallback()})),this.lazySpotsQue.splice(0,this.lazySpotsQue.length)}Rs(t,i=!1){var e;this.logger.info(`spot ${t.spot.spotIndex} is good for fetching ${i?"(scroll predictor)":""}`),t.fetchCallback(),null===(e=t.observer)||void 0===e||e.clearObserver(),this.xs(t),this.lazySpots.length||this.stopService()}xs(t){this.lazySpots.splice(this.lazySpots.indexOf(t),1)}Ms(t){return t.scrollStatus.expectedNextPosition<s.default.B(t.spot.ref).y}Cs(t,i){const{userLastPosition:e,previousTime:n,scrollDirection:o}=t.scrollStatus,h=s.default.Lt(),a=Date.now(),c=i?0:h-e,l=i?0:a-n,d=e<h?r.ScrollDirection.DOWN:h==e?o:r.ScrollDirection.UP,u=this.bucketsMap[t.spot.spotIndex].avgFetchTime/l;return{scrollDirection:d,expectedNextPosition:0===l?h:h+c*u,previousTime:a,userLastPosition:h,isIntersecting:!0}}static get(){return d._instance||(this._instance=new d),d._instance}getBucketsMap(t){let i={};return t.forEach((t=>{i[t.firstAdIndex]=t})),i}getSpotLazyConfig(t){const i=a.SpotsUtils.getLazyBucketsConf(t.tags),e=t.positionTagIndex?t.positionTagIndex:t.typeIndex;if(i&&"number"==typeof e){const s=this.getBucketsMap(i),n=Object.keys(s).map((t=>Number(t))),r=Math.max(...n.filter((t=>t<=e)));if(r>=0){const i=s[r];return this.logger.verbose(`${t.type} spot ${t.spotIndex} lazy bucket config`,i),this.bucketsMap[t.spotIndex]=i,i}}this.logger.verbose(`no lazy bucket config found for ${t.type} spot ${t.spotIndex}`)}isLazy(t){if(t.isEagerFirstFold())return!1;const i=this.getSpotLazyConfig(t);if(!this.shouldCheckLazyLoad(t)||!i)return!1;if(this.isIllegalConfig(i))return this.logger.error(`${t.type} spot ${t.spotIndex} has an illegal configuration`,i),!1;t.adDistanceFromTop=this.$s(t);const e=s.default.it(t)+1,n=t.positionTagIndex?t.positionTagIndex:t.typeIndex;return e>=i.firstFold&&n>=i.firstAdIndex}shouldCheckLazyLoad(t){var i;return t.type!==c.SpotType.STICKY&&(null===(i=this.bucketsMap[t.spotIndex])||void 0===i?void 0:i.avgFetchTime)>-1}isIllegalConfig(t){return void 0===t.firstFold||void 0===t.firstAdIndex}Fs(t){var i;const e=(null===(i=this.bucketsMap[t.spot.spotIndex])||void 0===i?void 0:i.threshold)||0;this.logger.info(`spot ${t.spot.spotIndex}, will start ${Math.trunc(e*s.default.H())}px before spot.ref: `,t.spot.ref);const n=d.Bs(e),r=this.Ns.bind(this,t),o=this.zs(t.spot),h=new l.default(t.spot.ref,.01,o,(i=>{this.observerCallback.apply(this,[t,i])}),n,r,!0,!1);return h.observe().then(),h}observerCallback(t,i){if(t.scrollStatus=this.Cs(t,!i),i){const{shouldFetch:i}=this.Is(t);i&&this.Ds(t)}}retestExpectedNextPosition(t){this.observerCallback(t,0);const i=this.zs(t.spot)[1];t.retestTimeoutId=setTimeout((()=>{this.observerCallback(t,i)}),i)}subscribe(t,i,e){const n={spot:t,fetchCallback:i,missedCallback:e,scrollStatus:{scrollDirection:r.ScrollDirection.DOWN,userLastPosition:s.default.Lt()},isMissed:!1},o=this.Fs(n);n.observer=o,this.isSpotMissed(t)&&this.ks(n),this.lazySpots.push(n)}static Bs(t){return`0% 0% ${Math.trunc(100*t)}% 0%`}isSpotMissed(t){return this.$s(t)<=s.default.Lt()}Ns(t){t.scrollStatus.isIntersecting=!1,this.isSpotMissed(t.spot)&&this.ks(t)}stopService(){this.logger.info("stopping service"),this.lazySpots.forEach((t=>{this.xs(t)}))}isUserInThreshold(t){if(!t.scrollStatus.isIntersecting)return!1;const i=this.$s(t.spot);return s.default.Lt()<i}$s(t){return s.default.B(t.ref).y}zs(t){return[0,100*(this.bucketsMap[t.spotIndex].approvalCount||-1)]}manualFetchSpot(t){const i=this.lazySpots.find((i=>i.spot.spotIndex===t.spotIndex));i&&this.Rs(i,!0)}}i.default=d},9698:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(394);class o{constructor(){this.titleSelectors=["h1","h2","h3","h4","h5","h6","header"],this.minDistance=60,this.oneLineSelectors=["span","div","p"],this.logger=new s.default("ContentTitle"),this.excludeElements=this.getExcludeElements(r.Profiler.get().pageLayoutSA.ex),this.titlesOnPage=this.collectTitles(),this.logger.verbose("titles",this.titlesOnPage),this.titlesLocations=this.getLocations(this.titlesOnPage),this.oneLinersOnPage=this.collectOneLiners(),this.logger.verbose("one liners",this.oneLinersOnPage),this.oneLinersLocations=this.getLocations(this.oneLinersOnPage)}static get(){return o.instance||(this.instance=new o),o.instance}collectTitles(t){return Array.from((t||document).querySelectorAll(this.titleSelectors.join(","))).filter((t=>n.default.jt(t,!1)&&!this.isExcluded(t)))}collectOneLiners(){const t=.3*n.default.C();return Array.from(document.querySelectorAll(this.oneLineSelectors.join(","))).filter((i=>this.isOneLine(i,t)))}isOneLine(t,i){return n.default.jt(t,!1)&&t.offsetHeight<30&&t.offsetWidth>i&&t.innerText.trim().length>0&&!this.isExcluded(t)}getLocations(t){return t.map((t=>this.getBottomOffset(t))).filter((t=>t>0)).sort(((t,i)=>t-i))}isTitle(t){return-1!=this.titlesOnPage.indexOf(t)}isCollectedOneLine(t){return-1!=this.oneLinersOnPage.indexOf(t)}isAfterOneLiner(t){const i=n.default.B(t).y;if(i<1)return!1;if(this.isCollectedOneLine(t)){const e=this.getBottomOffset(t),s=this.oneLinersLocations.indexOf(e);if(s&&this.oneLinersLocations[s-1])return i-this.oneLinersLocations[s-1]<this.minDistance}for(let t=this.oneLinersLocations.length;t>=0;t--)if(i>=this.oneLinersLocations[t])return i-this.oneLinersLocations[t]<this.minDistance;return!1}isBetweenTitleAndContent(t){const i=t.previousElementSibling;if(i&&n.default.O(i)&&this.isTitle(i))return!0;const e=n.default.B(t).y;if(e<1)return!1;if(this.isTitle(t)){const i=this.getBottomOffset(t),s=this.titlesLocations.indexOf(i);if(s&&this.titlesLocations[s-1])return e-this.titlesLocations[s-1]<this.minDistance}for(let t=this.titlesLocations.length;t>=0;t--)if(e>=this.titlesLocations[t])return e-this.titlesLocations[t]<this.minDistance;return!1}getBottomOffset(t){return n.default.B(t).y+n.default.G(t).h}getExcludeElements(t){return t&&t.length?Array.from(document.querySelectorAll(t.join(","))):[]}isExcluded(t){const i=-1!=this.excludeElements.indexOf(t);return i&&this.logger.verbose("element is excluded from page auto layout stay away by config",t),i}}i.default=o},2951:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(5068),r=e(7111),o=e(4987),h=e(7709),a=e(6761);i.default=class{constructor(){this.logger=new s.default("PlaceholderService"),this.isOpen=!1,this.active=!0}openPlaceholder(t){t.newBrowsiAd&&(this.applyPlaceholderStyle(t),this.isOpen=!0,this.observer=new n.default(t.newBrowsiAd.adContainer,.25,[1e3],(()=>{r.default.get().sendPlaceholderViewed(t)})),this.observer.observe())}getPlaceholderStyle(){return this.size?`display:block; width:${this.size.w}px; max-width:100%; min-height:${this.size.h}px; background-color:transparent;`:""}applyPlaceholderStyle(t){var i,e;const s=(null===(i=t.newBrowsiAd)||void 0===i?void 0:i.adContainer.style.cssText)||"";null===(e=t.newBrowsiAd)||void 0===e||e.adContainer.setAttribute("style",`${s} ${this.getPlaceholderStyle()}`)}stopObserving(){var t;this.active&&(null===(t=this.observer)||void 0===t||t.clearObserver(),this.observer=void 0)}closePlaceholder(t){if(this.active){if(!t.newBrowsiAd||!this.isOpen)return;const i="none"===t.newBrowsiAd.adContainer.style.display;if(!i&&t.type!==a.SpotType.STICKY&&o.default.isChangingViewport(t.newBrowsiAd.adWrapper))return void this.logger.verbose("placeholder changes viewport, keep open",t.newBrowsiAd);this.deactivatePlaceholder(),r.default.get().sendPlaceholderClosed(t,i?"other":"browsi"),h.Embedder.bs(t)}}removePlaceholderStyle(t){if(this.active){if(!t)return;t.adContainer.style.removeProperty("width"),t.adContainer.style.removeProperty("max-width"),t.adContainer.style.removeProperty("background-color"),this.deactivatePlaceholder()}}setSize(t){this.size=t}deactivatePlaceholder(){this.isOpen=!1,this.stopObserving(),this.active=!1}}},9166:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(8126),n=e(7111),r=e(394),o=e(4730),h=e(4987),a=e(1250),c=e(9310),l=e(9839),d=e(8473);class u{constructor(t,i){this.involvedSlotsIds=[],this.window=i,this.pbjsInstance=this.getPbjsInstance(t),this.googleTag=this.getGoogleTag(),this.logger=new a.default("PrebidListeners"),this.dcsWindowObject=i[l.default.windowVarName],this.functionBridge={init:t=>{this.onAuctionInit(t)},end:t=>{this.onAuctionEnd(t)},timeout:t=>{this.onBidTimeout(t)},won:t=>{this.onBidWon(t)},billable:t=>{this.onBillableEvent(t)}},this.profile=r.Profiler.get()}static registerToGoogleTagEvent(t,i){this.registerGoogleTagListeners[t]=this.registerGoogleTagListeners[t]||[],this.registerGoogleTagListeners[t].push(i)}removeListeners(){this.pbjsInstance.que.push((()=>{this.pbjsInstance.offEvent("bidWon",this.functionBridge.won),this.pbjsInstance.offEvent("auctionEnd",this.functionBridge.end),this.profile.collectHbEvents&&(this.pbjsInstance.offEvent("auctionInit",this.functionBridge.init),this.pbjsInstance.offEvent("bidTimeout",this.functionBridge.timeout)),r.Profiler.get().sendPrebidBillableEvents&&this.pbjsInstance.offEvent("billableEvent",this.functionBridge.billable),this.dcsWindowObject&&(this.dcsWindowObject._prebidEventsCount=this.pbjsInstance.getEvents().length)}))}getPbjsInstance(t){return this.window[t]=this.window[t]||{},this.window[t].que=this.window[t].que||[],this.window[t]}getGoogleTag(){let t=this.window.googletag||{};return t.cmd=t.cmd||[],this.window.googletag=t,t}initListeners(){this.initSlotRenderEndedListener(),this.initSlotRequestListener(),this.pbjsInstance.que.push((()=>{this.collectPreInitBids(),this.pbjsInstance.onEvent("bidWon",this.functionBridge.won),this.pbjsInstance.onEvent("auctionEnd",this.functionBridge.end),this.profile.collectHbEvents&&(this.pbjsInstance.onEvent("auctionInit",this.functionBridge.init),this.pbjsInstance.onEvent("bidTimeout",this.functionBridge.timeout)),this.profile.sendPrebidBillableEvents&&this.initBillableEventsListener()}))}initSlotRenderEndedListener(){this.googleTag.cmd.push((()=>{this.googleTag.pubads().addEventListener("slotRenderEnded",(t=>{const i=t.slot.getSlotElementId();if(this.checkRegisteredListeners(i,t,"slotRenderEnded",u.registerGoogleTagListeners.slotRenderEnded),!this.profile.collectHbEvents||!this.involvedSlotsIds.includes(i))return;const e=h.default.At(t);this.sendDfpBidMatched(t.slot.getAdUnitPath(),!t.isEmpty,e,i)}))}))}checkRegisteredListeners(t,i,e,s=[]){var n,r,o,h;for(let a=0;a<s.length;a++){let c=s[a].spot;if(c.genericParams.adUnitMap===t||(null===(r=null===(n=c.newBrowsiAd)||void 0===n?void 0:n.adContainer)||void 0===r?void 0:r.id)===t||(null===(h=null===(o=c.newBrowsiAd)||void 0===o?void 0:o.adWrapper)||void 0===h?void 0:h.id)===t){s[a].callback(e,i);break}}}initSlotRequestListener(){this.googleTag.cmd.push((()=>{this.googleTag.pubads().addEventListener("slotRequested",(t=>{const i=t.slot.getSlotElementId();if(this.checkRegisteredListeners(i,t,"slotRequested",u.registerGoogleTagListeners.slotRequested),!this.profile.collectHbEvents||!this.involvedSlotsIds.includes(i))return;const e=h.default.getDfpRequestEventSize(t),n=s.AuctionDataCollector.get().getSpotFromAdUnitCode(i);n&&s.AuctionDataCollector.get().collectDFPBidRequest(n,[{dfp:e}])}))}))}onBidTimeout(t){if(t){t=Array.isArray(t)?t:[t];const i={im:!1,rsn:"timeout",s:[{w:-1,h:-1}]};t.forEach((t=>{this.isBrowsiAuction(t.auctionId,[t.adUnitCode])&&s.AuctionDataCollector.get().collectBidMatch(t.adUnitCode,t.bidder,i)}))}}onBidWon(t){const i=s.AuctionDataCollector.get().getSpotFromAdUnitCode(t.adUnitCode);if(i&&(this.profile.collectHbEvents&&n.default.get().sendHBWinner(i,t),h.default.isBrowsiLoggerActive())){const i={adUnit:t.adUnitCode,winner:t.bidder,cpm:t.cpm,currency:t.currency,size:{w:t.width,h:t.height}};window.dispatchEvent(new CustomEvent(c.EventType.HBWinner,{detail:i}))}}onAuctionEnd(t){const i=t.adUnitCodes,e=t.bidsReceived,s=this.isBrowsiAuction(t.auctionId,i);if(e.length&&this.collectHighestBids(e,i,s),!s||!this.profile.collectHbEvents)return;const n=i[0];this.collectBidMatched(n,e),this.logger.hbLog(e,n,this.getNoBids(n),this.getPrebidWinner(n))}collectHighestBids(t,i,e){(i=e?i:i.filter((t=>this.isForRevenuePrediction(t)))).forEach((i=>{const s=t.filter((t=>t.adUnitCode===i));if(!s.length)return;const n=s.reduce(((t,i)=>t.cpm>i.cpm?t:i));d.default.get().processBidData(n.cpm,n.currency,i,e)}))}collectPreInitBids(){if(this.dcsWindowObject)return;[...this.pbjsInstance.getAllPrebidWinningBids(),...this.pbjsInstance.getAllWinningBids()].forEach((t=>{this.collectHighestBids([t],[t.adUnitCode],!1)}))}isForRevenuePrediction(t){var i;return!!(null===(i=this.profile.predictorsVersions.publisherAdUnits)||void 0===i?void 0:i.some((i=>t.includes(i))))}isBrowsiAuction(t,i){return i.length&&t.includes(i[0])&&t.includes("browsi")||i.some((t=>!!s.AuctionDataCollector.get().getSpotFromAdUnitCode(t)))}initBillableEventsListener(){var t;let i=this.pbjsInstance.getEvents();const e=null===(t=this.dcsWindowObject)||void 0===t?void 0:t._prebidEventsCount;e&&(i=i.slice(e));i.filter((t=>"billableEvent"===t.eventType)).forEach((t=>{n.default.get().sendBillableEvent(t.args)})),this.pbjsInstance.onEvent("billableEvent",this.functionBridge.billable)}onBillableEvent(t){n.default.get().sendBillableEvent(t)}onAuctionInit(t){let i=[];const e=t.adUnitCodes;if(!e[0]||!this.isBrowsiAuction(t.auctionId,e))return;const n={};t.bidderRequests.forEach((t=>{const i=t.bidderCode;t.bids.forEach((t=>{const e=Array.isArray(t.sizes[0])?t.sizes:[t.sizes],s=t.adUnitCode;n[s]=n[s]||{},n[s][i]=n[s][i]||{},n[s][i].sizes=n[s][i].sizes||[],n[s][i].sizes.push(e)}))})),Object.keys(n).forEach((t=>{this.involvedSlotsIds.push(t),Object.keys(n[t]).forEach((e=>{const r=[...new Set(h.default.flattenArray(n[t][e].sizes))];i.push({[e]:s.AuctionDataCollector.get().buildSizesFromArray(r)})})),s.AuctionDataCollector.get().collectBidRequest("prebid",t,i),i=[]}))}collectBidMatched(t,i){const e={};i.forEach((i=>{const n={im:Number(i.cpm)>0,s:[{w:i.width,h:i.height}],br:Number(i.cpm)};i.currency&&(n.brc=i.currency),i.requestTimestamp&&i.responseTimestamp&&(n.reqt=i.requestTimestamp,n.rest=i.responseTimestamp),e[i.bidder]=e[i.bidder]||[],e[i.bidder]=e[i.bidder].concat(n.s),s.AuctionDataCollector.get().collectBidMatch(t,i.bidder,n)}));let n=[];this.getNoBids(t).forEach((i=>{if(i.bidderRequestId&&n.includes(i.bidderRequestId))return;const r=e[i.bidder]||[];i.bidderRequestId&&n.push(i.bidderRequestId);const o={im:!1,rsn:"no_bid",s:s.AuctionDataCollector.get().buildSizesFromArray(i.sizes).filter((t=>!r.some((i=>i.w===t.w&&i.h===t.h))))};0!==o.s.length&&s.AuctionDataCollector.get().collectBidMatch(t,i.bidder,o)})),s.AuctionDataCollector.get().sendBidMatches(t)}getNoBids(t){if(this.pbjsInstance&&this.pbjsInstance.getNoBids&&"function"==typeof this.pbjsInstance.getNoBids){const i=this.pbjsInstance.getNoBids()[t];return i?i.bids:[]}return[]}sendDfpBidMatched(t,i,e,n){const r={im:i,s:[e],br:-1,au:t};s.AuctionDataCollector.get().collectBidMatch(n,o.ProviderType.DFP,r,!0)}getPrebidWinner(t){return this.pbjsInstance.getHighestCpmBids().find((i=>i.adUnitCode===t))}}i.default=u,u.registerGoogleTagListeners={}},394:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Profiler=void 0;const s=e(7797),n=e(1250),r=e(7111),o=e(9310),h=e(4987),a=e(4730);class c{constructor(t){this.logger=new n.default("Profile"),this.profile=this.buildProfile(t)}static get(){return this._instance||(this._instance=new c(window._middyo),this.updateExternalFlowHandler()),this._instance.profile}static rebuild(t){return this._instance=new c(t),this.updateExternalFlowHandler(),this._instance.profile}static setLoadTime(){this.get().loadTime=Date.now()-this.get().timeOffset}buildProfile(t){const i=c.evaluateLoaderParams(t);return c.mergeDeep(i,c.getDebugConfig()),window._middyo=i,i}static updateExternalFlowHandler(){const t=c._instance.profile;if(t.externalFlowHandler&&t.externalFlowHandler.preEngine)try{t.externalFlowHandler.preEngine(t)}catch(t){r.default.get().sendErrorEvent(o.EventType.CRASH,"preEngine",t.message)}this.updatePostHooks(t)}static updatePostHooks(t){var i;const e=t.spotsSupplyParams.dynamic;e&&(null===(i=t.loaderParams.ly.in)||void 0===i?void 0:i.di)&&(e.distance=this.getDistanceInPixelsByType(t.loaderParams.ly.in.di))}static evaluateLoaderParams(t){var i,e,s,n;return Object.assign({loaderParams:t,admarking:c.convertAdMarking(t.sec.adm),analysisMode:t.ly.am,bootstrapPageViewId:t.bpvi,contentRecommendationStayAwayDistance:t.sec.crd,countryCode:t.r.cc,deviceType:c.convertDeviceType(t.dt),esReportDomain:t.r.es,h:t.si.h,demandHost:t.si.dh,runMode:t.m,isReturningUser:t.r.ru,pageViewID:t.i.pv,prebidData:c.convertPrebidData(t.si.pd),prebidConfig:c.convertPrebidConfig(t.pc),prebidPath:t.si.pd.p,publisherKey:t.i.pk,sessionID:t.i.s,siteKey:t.i.sk,supplyConfigId:t.i.sc,targetElements:t.sec.te||[],timeOffset:t.to||0,trafficSource:t.r.ts,userID:t.i.u,version:t.ses.v,externalFlowHandler:t.externalFlowHandler,maxAdDensity:t.ly.mad,mainContentConfig:c.convertMC(t.sec.mc),debug:!!t.debug,test:!!t.test,draw:!!t.draw,yieldHostname:t.yhn,dcs:c.convertDCS(t.sec.dcs),lazyStayAway:t.sec.lsa,articleId:t.i.aid,articlePublishDate:t.i.apd,scanningTags:t.sec.st||[],activeView:t.si.av,pageLayoutSA:t.sec.plsa,predictorsKeyValueNames:c.convertPredictorKeyValueNames(t.si.v50,null===(i=t.pub)||void 0===i?void 0:i.p),adInViewport:t.si.aiv,logEngagement:t.ses.le,pageKeyValues:t.ly.pgkv||{},pubAdsRefresh:c.getPubAdsRefreshConfig(null===(e=t.pub)||void 0===e?void 0:e.r,null===(s=t.si.pd)||void 0===s?void 0:s.g),sampleViewed:t.si.sve,userAnonymousContinent:t.r.cl,blockLineItemIds:t.si.bli,reportResponseTime:{active:t.si.rrt,timers:t.td},spotsSupplyParams:this.getLayoutConfig(t.ly,!!t.ly.ars,t.od),uxRules:this.convertUxRules(t.sec.ux||[]),uxFixes:this.getUxFixes(t),placeholder:t.ly.ph,eagerFirstFold:t.ly.eff,fixedSpotsFirst:t.ly.fsf,useWebVitals:t.ly.wv,apiRelocationSelectors:t.ly.ars,dcsState:t.dcss&&this.getDcsState(t.dcss),billableEvents:t.si.be,bulkEventsThrottle:t.si.bet,sendBrowsiImpressionDOMEvent:t.si.bi,scanThirdPartyProviders:!!t.ly.stp,cacheUtilsFunctions:!!t.ly.cuf,sendViewabilityCheckpoints:!!t.ly.vc,sendPrebidBillableEvents:!!t.ly.spbe,usingMagnite:!1,measureViewabilityForAllSizes:!!t.ly.mvas,customRefresh:!!(null===(n=t.pi)||void 0===n?void 0:n.crr),manualDfpIframeAds:void 0,waitForAdRequest:t.si.wfar,collectHbEvents:!!t.si.chbe,reportPublisherAds:!!t.si.cpae,reportUxRulesInvalidations:!!t.si.ruxi,predictorsVersions:this.getPredictorsVersions(t.pv),adsDistanceViolations:!!t.si.adv,collectUserTouch:!!t.si.cut,blockAdRequestOnOOF:!0,sendRevenueKeyValue:!!t.ly.spp},t.spub?{shadowPublisher:t.spub}:{})}static getPredictorsVersions(t){return{scroll:(null==t?void 0:t.s)||"",profit:(null==t?void 0:t.p)||"",viewability:(null==t?void 0:t.mv)||"-1",publisherAdUnits:null==t?void 0:t.pau}}static getUxFixes(t){var i,e;return{dynamicIframeSize:null===(i=t.ly.uxfx)||void 0===i?void 0:i.dis,fixWiderAds:!!(null===(e=t.ly.uxfx)||void 0===e?void 0:e.fwa)}}static convertUxRules(t){return t.sa=t.sa||[],t.sk=t.sk||{},{stayAway:t.sa.map((t=>({selectorType:t.st,toDensity:t.td,values:t.v,adProviderName:t.iae?a.ProviderType.MANUAL_AD:void 0,distance:t.d,useDistanceFromLayout:!!t.dfl,type:t.ty||s.StayAwayType.BOTH}))),skipped:{css:t.sk.c||[],xpath:t.sk.x||[]}}}static convertMC(t){return t?{enabled:!0,start:t.s||[],end:t.e||[]}:null}static convertDCS(t){return t&&"script"!==t.ty?{enable:!0,checkUrlChanges:t.cuc,newContent:t.acc?{className:t.acc.cn,id:t.acc.id,nodeName:t.acc.nn}:null,type:t.ty,articlesSelector:t.as,viewportPercentage:t.vp||0,mutationXpaths:t.xp||[],delay:t.d,scanAboveReadMore:t.sbrm,reInjectOnUrl:t.rij}:{enable:!1,checkUrlChanges:!1,newContent:{className:"",id:"",nodeName:""},type:"none",articlesSelector:"",viewportPercentage:0,mutationXpaths:[],scanAboveReadMore:!1}}static convertPredictorKeyValueNames(t,i){return{viewability50:t||"browsiViewability",papaas:i}}static convertPrebidData(t){return t?{prebidPath:t.p,globalInstanceName:t.g}:null}static convertPrebidConfig(t){return t?JSON.parse(t.pcm):null}static convertAdMarking(t){return t?{active:!0,color:t.c,text:t.t,customStyle:t.s}:{active:!1,color:null,text:null,customStyle:null}}static convertDeviceType(t){return{browser:t.b,os:t.os,browserType:t.bt,osVersion:t.osv,vendor:t.v,devicePlatform:t.p,device:t.d}}static getPubAdsRefreshConfig(t,i){return t&&t.c&&t.r&&t.l&&t.t?{active:!0,adIdType:t.t,adIds:t.l,refreshCount:t.c,refreshRate:t.r,dfpOnly:t.d,sendRefreshKV:t.kv,customPbjsName:i}:null}static getLayoutConfig(t,i,e){return{dynamic:this.convertLayoutDynamicConfig(i,t.in),fixed:this.convertLayoutFixedConfig(t.in),fixedTop:this.convertLayoutFixedConfig(t.t),fixedBottom:this.convertLayoutFixedConfig(t.b),sticky:this.convertLayoutStickyConfig(t),api:this.convertLayoutApiConfig(t),lazySpots:this.convertLayoutLazyConfig(t,e)}}static convertLayoutDynamicConfig(t,i){var e,s,n;if(i&&(i.dy||t))return Object.assign(Object.assign({},this.convertScannedSpot(i)),{distance:400,mainContentOnly:(null===(e=i.dy)||void 0===e?void 0:e.ico)||!1,maxItems:(null===(s=i.dy)||void 0===s?void 0:s.dmi)||0,startInFoldSelectors:i.sfs,potentialSpots:i.ps,avoidCLS:null===(n=i.acls)||void 0===n?void 0:n.dy,scrollDepthPredictor:i.spr})}static getDistanceInPixelsByType(t){if("PIXEL"===t.dt)return t.d;const i=h.default.A().height;return t.d*i}static convertLayoutFixedConfig(t){var i,e;if(null===(i=null==t?void 0:t.fi)||void 0===i?void 0:i.ds)return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},this.convertScannedSpot(t)),{maxItems:-1,targetElements:t.fi.ds||t.fi.pids,targetElementPosition:t.fi.tep}),t.sfs?{startElementSelector:t.sfs}:{}),t.acls?{avoidCLS:null===(e=t.acls)||void 0===e?void 0:e.fi}:{}),t.spr?{scrollDepthPredictor:t.spr}:{}),{enforceUxRules:t.fi.eur})}static convertScannedSpot(t){var i,e,s,n,r,o,h,a,c,l,d,u,v;return Object.assign(Object.assign(Object.assign(Object.assign({allowedCreativeSizes:t.ds||[],engagedUsers:null===(i=t.ov)||void 0===i?void 0:i.eu,lazyLoading:(null===(e=t.ov)||void 0===e?void 0:e.ll)?{firstAdIndex:null===(n=null===(s=t.ov)||void 0===s?void 0:s.ll)||void 0===n?void 0:n.fai,firstFold:null===(o=null===(r=t.ov)||void 0===r?void 0:r.ll)||void 0===o?void 0:o.ff}:void 0,lazyLoadingBuckets:(null===(h=t.ov)||void 0===h?void 0:h.ll)?this.converLazyLoadingBucketsConfig(t):void 0,viewabilityThreshold:null===(a=t.ov)||void 0===a?void 0:a.vt,profitabilityThreshold:null===(c=t.ov)||void 0===c?void 0:c.pt,operator:null===(l=t.ov)||void 0===l?void 0:l.o},t.start?{startInFold:t.start}:{}),t.stop?{stopInFold:t.stop}:{}),(null===(d=t.acls)||void 0===d?void 0:d.api)?{avoidCLS:null===(u=t.acls)||void 0===u?void 0:u.api}:{}),{style:null===(v=t.st)||void 0===v?void 0:v.b})}static converLazyLoadingBucketsConfig(t){var i;if(!(null===(i=t.ov)||void 0===i?void 0:i.llb))return;const e=[];return t.ov.llb.map((t=>{e.push({firstAdIndex:t.fai,firstFold:t.ff,threshold:t.t,approvalCount:t.ac,avgFetchTime:t.aft})})),e}static convertLayoutStickyConfig(t){var i;if(t.s)return{location:t.s.l,allowedCreativeSizes:t.s.ds||[],closeButton:!!t.s.cb,useOriginalSizes:!!t.s.uos,style:null===(i=t.s.st)||void 0===i?void 0:i.b}}static convertLayoutApiConfig(t){if(!t)return;const i={};return["in","t","b","s"].forEach((e=>{var s,n,r;const o=t[e];i[e]=o?Object.assign(Object.assign({},"s"===e?this.convertLayoutStickyConfig(t):this.convertScannedSpot(o)),{viewabilityOptimizationBlocklist:(null===(s=o.api)||void 0===s?void 0:s.vob)||[],positionIds:null===(n=o.api)||void 0===n?void 0:n.ids,targetElementPosition:t.atep||"INSIDE",style:null===(r=o.st)||void 0===r?void 0:r.b}):{targetElementPosition:"INSIDE"}})),i}static convertLayoutLazyConfig(t,i){if(!t.ll)return;const e={avgFetchTime:t.ll.aft,approvalCount:t.ll.ac,staticUser:t.ll.su,threshold:t.ll.t,recalculateThreshold:t.ll.rct,bucketsConfigured:t.ll.llb};return t.ll.m||(e.autoThreshold=t.ll.d),e}static isObject(t){return t&&"object"==typeof t&&!Array.isArray(t)}static mergeDeep(t,i){if(this.isObject(t)&&this.isObject(i))for(const e in i)!i.hasOwnProperty(e)||!this.isObject(i[e])||i[e]instanceof Node?Object.assign(t,{[e]:i[e]}):(t[e]||Object.assign(t,{[e]:{}}),this.mergeDeep(t[e],i[e]));return t}static getDebugConfig(){const t=sessionStorage.getItem("__brwsidbg");let i={};return t&&(i=JSON.parse(t)),i}static getDcsState(t){return{count:t.c,mainContentElement:t.mc,stayAwayObjects:t.sao,articleSelectors:t.as,prevPvSpots:t.pps,parentPageView:t.ppv}}}i.Profiler=c},2786:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(7111),r=e(4987),o=e(394),h=e(4752);class a{constructor(t){this.googletag=this.initGoogletag(),this.apstag=window.apstag,this.pubAdsData=[],this.logger=new s.default("PubadsRefresh"),this.config=t,this.pbjsInstanceName=this.config.customPbjsName||"pbjs",this.pbjsInstance=a.getPbjs(this.pbjsInstanceName),this.vendor=o.Profiler.get().usingMagnite?"magnite":"prebid"}static get(){if(a.instance)return a.instance;const t=this.getPubAdsRefreshConfig();return t&&(a.instance=new a(t))}static getPubAdsRefreshConfig(){let t;return t=o.Profiler.get().customRefresh?this.getCustomRefreshConfig():o.Profiler.get().usingMagnite?this.getMagniteConfig():o.Profiler.get().pubAdsRefresh,t}static getCustomRefreshConfig(){var t;return{active:!0,adIdType:"AD_UNIT",adIds:[],refreshCount:100,refreshRate:3e4,dfpOnly:!1,sendRefreshKV:!0,customPbjsName:(null===(t=o.Profiler.get().prebidData)||void 0===t?void 0:t.globalInstanceName)||"pbjs"}}static getMagniteConfig(){var t,i,e,s,n,r,h,c;const l=(null===(t=o.Profiler.get().prebidData)||void 0===t?void 0:t.globalInstanceName)||"pbjs",d=null===(i=a.getPbjs(l))||void 0===i?void 0:i.getConfig(),u=null===(s=null===(e=null==d?void 0:d.realTimeData)||void 0===e?void 0:e.dataProviders)||void 0===s?void 0:s.find((t=>"browsi"===t.name)),v=null===(r=null===(n=null==u?void 0:u.params)||void 0===n?void 0:n.rp)||void 0===r?void 0:r.nonBrowsiAds,f=this.getMagniteAdIds(v).concat((null===(h=o.Profiler.get().manualDfpIframeAds)||void 0===h?void 0:h.adUnits)||[]),{refreshRate:p}=v||{};if(f.length>0&&p){return{active:!0,adIdType:"AD_UNIT",adIds:f,refreshCount:(null===(c=o.Profiler.get().pubAdsRefresh)||void 0===c?void 0:c.refreshCount)||100,refreshRate:p,dfpOnly:!1,sendRefreshKV:!0,customPbjsName:l}}return null}static getMagniteAdIds(t){var i;let e=new Set;return null===(i=null==t?void 0:t.placements)||void 0===i||i.forEach((t=>{this.findMatchedSlots(t).forEach((t=>{e.add(t)}))})),Array.from(e)}static findMatchedSlots(t){var i,e;let s=[];const n=null===(e=null===(i=window.googletag)||void 0===i?void 0:i.pubads)||void 0===e?void 0:e.call(i).getSlots();return null==n||n.forEach((i=>{const e=i.getSlotElementId(),n=i.getAdUnitPath();this.isMatchAdUnitPattern(t,e,n)&&s.push(n)})),s}findMatchAd(t,i,e){if("magnite"===this.vendor){if(this.pbjsInstance&&this.pbjsInstance.rp){this.pbjsInstance.rp.adUnitPatterns.find((e=>a.isMatchAdUnitPattern(e,i,t)))?e.isValidMagnite=!0:this.logger.info("Couldn't find valid magnite match")}}else this.pbjsInstance&&this.pbjsInstance.adUnits&&(e.adUnit=this.pbjsInstance.adUnits.find((e=>[t,i].includes(e.code))))}static isMatchAdUnitPattern(t,i,e){return!(t.divPattern&&!i.match(t.divPattern)||t.slotPattern&&!e.match(t.slotPattern))}preparePubadsRefresh(t,i,e){e&&!e.refreshInfo.requested&&this.isAllowedLineItemId(t).then((()=>{this.runPreRefresh(t,e).then((()=>{if(e.refreshInfo.requested=!0,this.logger.info("preparing refresh for adData",e),!e.manualIframeWindow&&(this.pbjsInstance=a.getPbjs(this.pbjsInstanceName),!this.config.dfpOnly&&this.pbjsInstance)){const i=t.getAdUnitPath(),s=t.getSlotElementId();this.findMatchAd(i,s,e)}this.refreshBid(e,i)}))})).catch((t=>{this.logger.error("pubadsRefresh rejected slot refresh:",t),"liIdBl"===t&&(e.refreshInfo.active=!1,n.default.get().sendPubAdRefreshBlockedEvent(e.element,t))}))}runPreRefresh(t,i){return new Promise(((e,s)=>{const n=h.default.getExternalFlowHandler("prePubadsRefresh");if(n){t.getSlotElementId(),i.refreshInfo.count;n(t,i,e,s)}else e()}))}refreshBid(t,i){if(!t.slot||!t.element)return!1;const e=this.getAdSize(t.element);this.attachSizeMapping(e,t.slot),this.handleKVs(t),t.refreshInfo.count++,this.sendRefreshRequestEvent(t,i),t.refreshInfo.viewedTime=Date.now();const s=this.getGoogleTag(t.manualIframeWindow);return s.cmd=this.googletag.cmd||[],s.cmd.push((()=>{const i=this.createHbPromise(t,e),n=this.createAmazonPromise(t.slot,e,t.manualIframeWindow);Promise.all([i,n]).then((i=>{this.logger.info(`refreshing dfp ${i}`),t.slot.setCollapseEmptyDiv(!1),s.pubads().refresh([t.slot])}))})),!0}handleKVs(t){const i=this.getTargeting(t.slot);t.slot.clearTargeting(),Object.keys(i).forEach((e=>{e.indexOf("hb_")+e.indexOf("amzn")===-2&&t.slot&&t.slot.setTargeting(e,i[e])})),this.config.sendRefreshKV&&t.slot.setTargeting("browsiRefresh","pubtrue");const e=o.Profiler.get().supplyConfigId;t.slot.setTargeting("browsiLayout",e)}createHbPromise(t,i){const e=i=>!(!i||!t.adUnit&&!t.isValidMagnite||this.config.dfpOnly);return new Promise((s=>{const n=a.getPbjs(this.pbjsInstanceName,t.manualIframeWindow);e(n)?(n.que=n.que||[],n.que.push((()=>{"magnite"==this.vendor?n.rp?n.rp.requestBids({callback:()=>{s("magnite")},gptSlotObjects:[t.slot]}):s():(this.setAdUnitSizes(t.adUnit,i),n.requestBids({adUnitCodes:[t.adUnit.code],bidsBackHandler:()=>{t.slot&&(n.setTargetingForGPTAsync([t.adUnit.code]),s("pbjs"))}}))}))):s()}))}createAmazonPromise(t,i,e){return new Promise((s=>{const n=this.getApsTag(e);if(!n||"function"!=typeof n.fetchBids||this.config.dfpOnly)return s();{const e=t.getSlotElementId(),r={slotID:e,slotName:t.getAdUnitPath(),sizes:[[i.w,i.h]]};n.fetchBids({slots:[r]},(t=>{const i=t.find((t=>t.slotID===e));return this.logger.info("amazon bid: ",i),this.logger.apsLog(i),this.apstag.setDisplayBids(),s("amazon")}))}}))}handleRenderEnded(t){const i=this.findExistingAdData(t.slot);if(i)if(t.isEmpty)this.logger.info("refresh for adData:",i,"returned empty. disabling refresh for this slot."),i.refreshInfo.active=!1;else{if(i.refreshInfo.requested)return this.logger.info("refresh for adData:",i,"ended successfully"),i.refreshInfo.requested=!1,!0;this.logger.info("adData:",i,"was forced refresh. disabling refresh for this slot."),i.refreshInfo.active=!1}return!1}sendRefreshRequestEvent(t,i){const e=this.getSlotWinner(t.slot);n.default.get().sendPubAdRefreshRequest(i,t.refreshInfo.count,"browsi",e)}findExistingAdData(t){return this.pubAdsData.find((i=>i.slot===t))}createAdData(t,i,e){const s={slot:t,element:i,refreshInfo:{active:!0,requested:!1,count:0,viewedTime:Date.now()},manualIframeWindow:e};return this.pubAdsData.push(s),s}getAdData(t,i,e){if(!i)return null;let s=this.findExistingAdData(i);return this.checkConditions(i,s)?(s||(s=this.createAdData(i,t,e)),s):null}checkConditions(t,i){if(i&&!i.refreshInfo.active)return!1;const e=[];h.default.isCustomRefreshConfigured()||!this.isWhitelisted(t)&&e.push("not in whitelist");const s=this.checkRefreshCount(i);s&&e.push(s),i&&i.refreshInfo.count===this.config.refreshCount&&e.push(`refresh count ${i.refreshInfo.count} passed limit ${this.config.refreshCount}`);const n=!e.length;return this.logger.info("checkConditions for",t.getSlotElementId(),"result ? ",n||e),n}checkRefreshCount(t){if(t&&t.refreshInfo.count===this.config.refreshCount)return`refresh count ${t.refreshInfo.count} passed limit ${this.config.refreshCount}`}isWhitelisted(t){if(this.config.adIds.includes("*"))return!0;switch(this.config.adIdType){case"AD_UNIT":const i=t.getAdUnitPath();return this.config.adIds.includes(i);case"PLACEMENT":const e=t.getSlotElementId();return this.config.adIds.includes(e)}return!1}getAdSize(t){let i=r.default._t(t);return i||(i={size:r.default.G(t),element:t}),i.size}setAdUnitSizes(t,i){t.mediaTypes.banner.sizes=[[i.w,i.h]],t.sizes&&(t.sizes=[i.w,i.h])}attachSizeMapping(t,i){const e=googletag.sizeMapping().addSize([0,0],r.default.Zt(t)?["fluid"]:[t.w,t.h]).build();i.defineSizeMapping(e),this.logger.info("attachedSizeMapping",e)}initGoogletag(){const t=window.googletag||(window.googletag={});return t.cmd=t.cmd||[],t}getTargeting(t){return t.getTargetingMap?t.getTargetingMap():t.getTargeting()}static getPbjs(t,i=window){return i[t]}getGoogleTag(t){return t?t.googletag:this.googletag}getApsTag(t){return t?t.apstag:this.apstag}getSlotWinner(t){const i=t.getHtml();return i.indexOf("renderAd")>-1?"prebid":i.indexOf("renderImp")>-1?"amazon":"dfp"}isAllowedLineItemId(t){const i=o.Profiler.get();if(i.blockLineItemIds){const e=r.default.getGAMResponseInfo(t);if(!e)return Promise.resolve();const s={sk:i.siteKey,dt:"mobile"};(null==e?void 0:e.lid)&&(s.li=null==e?void 0:e.lid),(null==e?void 0:e.oid)&&(s.oi=null==e?void 0:e.oid);const n=`//${i.yieldHostname}/bli?${r.default.qt(s)}`;return r.default.xhrPromise(n,"GET").then((t=>202===t.status?Promise.reject("liIdBl"):Promise.resolve()))}return Promise.resolve()}}i.default=a},1607:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250);i.default=class{constructor(t){this.resizeRAF=null,this.resizeListeners=[],this.resizeElement=t,this.obj=document.createElement("object"),this.logger=new s.default("ResizeListener"),this.logger.verbose("set resize listener for",t)}resizeListener(){this.resizeRAF&&window.cancelAnimationFrame(this.resizeRAF),this.resizeRAF=window.requestAnimationFrame((()=>{this.resizeListeners.forEach((t=>{t.call(this.obj)}))}))}objectLoad(){this.obj.contentDocument.defaultView.addEventListener("resize",this.resizeListener.bind(this)),this.resizeListener.bind(this)()}addResizeListener(t){this.resizeListeners.length||("static"==getComputedStyle(this.resizeElement).position&&(this.resizeElement.style.position="relative"),this.obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -999;"),this.obj.onload=this.objectLoad.bind(this),this.obj.type="text/html",this.obj.data="about:blank",this.resizeElement.appendChild(this.obj)),this.resizeListeners.push(t)}removeResizeListener(t){var i,e;t?this.resizeListeners.splice(this.resizeListeners.indexOf(t),1):this.resizeListeners=[];const s=null===(e=null===(i=this.obj)||void 0===i?void 0:i.contentDocument)||void 0===e?void 0:e.defaultView;!this.resizeListeners.length&&s&&(s.removeEventListener("resize",this.resizeListener),this.resizeElement.removeChild(this.obj))}}},9840:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(1332),o=e(9714),h=e(8221),a=e(394),c=e(9839),l=e(7797),d=e(1865),u=e(2375),v=e(4730);class f{constructor(){this.stayAwayElements=[],this.stayAwayInvalidations=[],this.profile=a.Profiler.get(),this.logger=new s.default("SAService"),this.domScanned=!1,this.stayAwayConfig=this.getSAconfig();const t=u.TAGS_TO_SCAN.map((t=>t.toLowerCase())),i=this.profile.scanningTags.map((t=>t.toLowerCase()))||[];this.typesToSaFrom=Array.from(new Set(["iframe","ins","center","footer","class","h2","aside","img","id","twitterwidget","video",...t,...i])),this.reportInvalidations=this.profile.reportUxRulesInvalidations,this.updateSaConfigsDistance()}static get(){return f.instance||(this.instance=new f),f.instance}getSAconfig(){const t=this.profile.uxRules.stayAway;return t.push({selectorType:"CSS",toDensity:!1,values:["div[id*='vid-container']"],distance:100,useDistanceFromLayout:!0,adProviderName:v.ProviderType.BROWSI_VIDEO,type:l.StayAwayType.BOTH}),t}updateSaConfigsDistance(){var t;const i=this.stayAwayConfig,e=null===(t=this.profile.spotsSupplyParams.dynamic)||void 0===t?void 0:t.distance;e&&i.filter((t=>t.useDistanceFromLayout)).forEach((t=>{t.distance=e,this.logger.verbose("Selectors group:",t.values,"using layout inline distance:",t.distance)}))}isInStayAwayElements(t,i){if(this.stayAwayElements)for(let e=0;e<this.stayAwayElements.length;e++){const s=this.stayAwayElements[e];if(t===s.element)return this.updateStayAwayInvalidations(this.reportInvalidations,s,{distance:0,isSaPositionedBefore:!1},i),!0}return!1}isToStayAway(t,i){return t={ref:t},this.stayAwayElements.some((e=>{const s=this.hasViolatedStayAway(t,e);return this.updateStayAwayInvalidations(this.reportInvalidations,e,s,i),null!==s}))}getStayAwayElements(){return this.stayAwayElements}handleStayAwayConfig(t,i,e,s,n,r){if(!this.isValidHeightForSkipSa(t))return;const o=this.upsertStayAwayElement(t,e,s,n,r,i);null!=e.adProviderName&&o&&this.reportPublisherAd(o,e)}upsertStayAwayElement(t,i,e,s,r,o){if(!i.distance)return this.logger.verbose("Received distance is 0, not adding element: ",t," to Stay Aways"),null;let h=this.stayAwayElements.find((i=>i.element===t));if(h)this.updateSAElement(h,t,s,i,e,r);else{if(!(i.adProviderName&&n.default.G(t).h<=25)){const n=this.insertSaElement(t,i,e,s,r,o);return this.logSaAdded(i,e,n),n}this.logger.verbose("ignoring sa ad element, height <= 25",t)}return null}insertSaElement(t,i,e,s,o,h){const a=t.getBoundingClientRect();o||(o=r.default.instance.getAdPositionType(t,a.height,a.top));const c={element:t,top:n.default.getSAPositionFromTop(t),height:a.height,stayAwayDistance:i.distance,toDensity:i.toDensity,positionType:o,isLazy:e,subType:s,isValid:f.isSaValid(t),selector:h,type:i.type};return this.stayAwayElements.push(c),c}updateSAElement(t,i,e,s,r,o){const h=Object.assign({},t);t.top=n.default.getSAPositionFromTop(i),t.height=i.getBoundingClientRect().height,t.isValid=f.isSaValid(i),h.top===t.top&&h.height===t.height&&i.style.display===t.element.style.display||this.logger.verbose("Updated: ",h," TO: ",t)}logSaAdded(t,i,e){const s=[i?"Lazy ":"","Added",e];void 0!==t.values&&s.push("By Config: ",Object.assign(Object.assign({},t),e.selector?{values:[e.selector]}:{})),this.logger.verbose(...s)}isAdType(t){return"provider"===t||"content_recommendation"===t}resetStayAwayElements(){this.stayAwayElements=this.stayAwayElements.filter((t=>{if(!document.body.contains(t.element))return!t.element}))}scanDomForSA(t=!1){const i=f.getElementToScanFrom();if(t)this.domScanned=!0,this.logger.verbose("Re-scanning dom for SA");else if(this.logger.verbose("Start scanning dom for SA"),(c.default.hasDcsMc()||c.default.isSlides())&&c.default.getDcsActionCounter()>0){(c.default.getLatestDcsStayObjects()||[]).forEach((t=>{this.upsertStayAwayElement(t.element,{toDensity:t.toDensity,distance:t.stayAwayDistance,type:t.type},!1,t.subType,t.positionType)}))}const e=this.typesToSaFrom?this.typesToSaFrom.join(","):o.default.get().getScanningTagNames();this.logger.info("Staying away from these types: ",e);for(let s of this.stayAwayConfig)try{if(s.values.length)if("XPATH"===s.selectorType)for(let e of s.values){const r=n.default.Mi([e],i,!0);for(let i of r)this.handleStayAwayConfig(i,e,s,t,"configuration")}else if("CSS"===s.selectorType)for(let n of s.values){const r=Array.from(i.querySelectorAll(n)).filter((t=>!(!e.includes(t.tagName.toLowerCase())&&!e.includes(t.tagName))||(this.logger.verbose("Not sa - element is not in types to sa from",t),!1)));for(let i of r)this.handleStayAwayConfig(i,n,s,t,"configuration")}}catch(t){this.logger.error("Problem while adding SaConfig to SaElements",s,t)}}isStayAwayViolated(t){if(!this.profile.lazyStayAway)return null;this.scanForCR(t.ref),!t.isLazyLoading&&this.domScanned||this.scanDomForSA(!0);let i=null;return this.stayAwayElements.some((e=>{let s=this.hasViolatedStayAway(t,e);return null!=s&&(-1===s.distance?this.logger.verbose("Spot: ",t.ref," has violated StayAway from: ",e.element,", because it's contained in the SA element"):this.logger.verbose("Spot: ",t.ref," has violated StayAway from: ",e.element,", Distance between objects is: ",s.distance),i={distance:s.distance,spot:t,saObject:e},!0)})),i}getStayAwayInvalidations(){return this.stayAwayInvalidations}updateStayAwayInvalidations(t,i,e,s){if(!t||s||!e||!i.selector)return;const n=e.distance<0?0:Math.floor(e.distance),r=e.isSaPositionedBefore?-1*n:n,o=this.stayAwayInvalidations.find((t=>t.s===i.selector&&t.d===r));o?o.c++:this.stayAwayInvalidations.push({s:i.selector,t:i.type,d:r,c:1})}scanForCR(t){const i=this.profile.contentRecommendationStayAwayDistance;if(!i)return;const e={distance:i,toDensity:!1,type:l.StayAwayType.BOTH},s=f.getElementToScanFrom(),r=Array.from(s.querySelectorAll("div,ins")).concat(t).sort(((t,i)=>2&t.compareDocumentPosition(i)?1:-1)),o=r.indexOf(t),a=n.default.B(t).y;for(let t=o+1;t<r.length&&!this.isTooFar(r[t],a,i);t++)h.default.get().isVendorNode(r[t])&&f.get().upsertStayAwayElement(r[t],e,!0,"content_recommendation");for(let t=o-1;t>=0&&!this.isTooFar(r[t],a,i);t--)h.default.get().isVendorNode(r[t])&&f.get().upsertStayAwayElement(r[t],e,!0,"content_recommendation")}isTooFar(t,i,e){return!n.default.isFixed(t)&&n.default.gi(t)&&Math.abs(n.default.Y(t)-i)>e}hasViolatedStayAway(t,i){if(null==t.ref||n.default.isFixed(i.element).status||!window.document.body.contains(i.element))return null;if(!this.isValidStayAwayType(t.ref,i))return null;let e=this.getSaDistance(t.ref,i);return e.distance<i.stayAwayDistance?e:null}isValidStayAwayType(t,i){switch(i.type){case l.StayAwayType.BOTH:return!0;case l.StayAwayType.BELOW:return n.default.isPositionedAfter(t,i.element);case l.StayAwayType.ABOVE:return n.default.isPositionedBefore(t,i.element);default:return!0}}static isSaValid(t){return n.default.jt(t,!0)&&!n.default.isFixed(t).status}reportPublisherAd(t,i){this.logger.verbose("Found manual ad: ",t.element);const e=t.element.id||t.selector||"";o.default.get().addIfNew(t.element,i.adProviderName,i.distance,e,e,t.isLazy,void 0,{w:t.element.offsetWidth,h:t.height},!0)}static getElementToScanFrom(){return c.default.hasDcsMc()||c.default.isSlides()?c.default.getCurrentDcsElement():document.body}getSaDistance(t,i){let e=Math.abs(n.default.getSAPositionFromTop(t)-n.default.getSAPositionFromTop(i.element));const s=n.default.isPositionedBefore(i.element,t);if(s){e-=i.height>=d.MIN_AD_SIZE?i.height:n.default.G(i.element).h}return{distance:e,isSaPositionedBefore:s}}isValidHeightForSkipSa(t){const i=n.default.M();return n.default.G(t).h<.8*i}}i.default=f},7093:function(t,i,e){"use strict";var s=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,h)}a((s=s.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0});const n=e(8406),r=e(4987),o=e(4752),h=e(394),a=e(1332),c=e(8910),l=e(6761),d=e(1250),u=e(2593),v=e(584),f=e(8473);class p{constructor(){this.isInvalidVersion=!1,this.logger=new d.default("ScrollDepthPredictorsService");if(!h.Profiler.get().predictorsVersions.scroll)return this.logger.info("scroll depth predictor version is missing"),this.isInvalidVersion=!0,void(p.prediction=-1);const t=u.SpotsUtils.getConf(u.SPOT_TAGS_MAP[l.SpotType.DYNAMIC]),i=u.SpotsUtils.getConf(u.SPOT_TAGS_MAP[l.SpotType.FIXED_IN_CONTENT]);this.predictorConfig=(null==t?void 0:t.scrollDepthPredictor)||(null==i?void 0:i.scrollDepthPredictor),this.setData()}setData(){var t,i,e,s;const c=h.Profiler.get(),d=n.default.getSpots().filter((t=>t.isLazyLoading)).length;let p=(new Date).toLocaleString("en-US",{timeZone:"America/New_York"}),m=new Date(p).getHours();const g=u.SpotsUtils.getConf(u.SPOT_TAGS_MAP[l.SpotType.FIXED_BOTTOM]),b=Math.max((null==g?void 0:g.maxItems)||0,0),w=v.default.getMaxItems(u.SPOT_TAGS_MAP.dy);this.staticData={pk:c.publisherKey,sk:c.siteKey,h:m,gl:c.countryCode,os:(null===(t=c.deviceType)||void 0===t?void 0:t.os)||"",d:(null===(i=c.deviceType)||void 0===i?void 0:i.device)||"",dt:(null===(e=c.deviceType)||void 0===e?void 0:e.devicePlatform)||"",ts:c.trafficSource,b:(null===(s=c.deviceType)||void 0===s?void 0:s.browser)||"",pl:r.default.M(),mc:a.default.instance.calculateMCSize(!0),sl:r.default.H(),ul:r.default.W(),to:o.default.getTimeOffset(),almi:Math.min(w+b,d),v:c.predictorsVersions.scroll,sf:d,iru:c.isReturningUser,uva:f.default.get().analytics.uv.t_a,uvs:f.default.get().analytics.uv.t_sp}}getPrediction(){return s(this,void 0,void 0,(function*(){if(this.isInvalidVersion)return-1;const t=yield this.fetchPrediction();let i;if(200!==t.status&&(this.logger.info("failed to get scroll prediction"),i=-2),i=yield this.predictionHook(i||JSON.parse(t.responseText).prediction),i<0)return i;if(p.prediction=i,!this.predictorConfig)return this.logger.info("no scroll prediction configuration, data collecting only"),-3;const e=this.predictorConfig.f,s=i*e;return this.logger.info("got prediction",i,"with factor of",e,"final prediction is",s),s}))}predictionHook(t){return new Promise(((i,e)=>{const s=o.default.getExternalFlowHandler("postScrollPrediction");if(!s)return i(t);s(t,i,e)}))}modifySpotsAccordingToPrediction(t){var i;if(!(null===(i=this.predictorConfig)||void 0===i?void 0:i.e))return void this.logger.info("scroll predictor is disabled");const e=this.filterLazySpotsAboveThreshold(t);this.moveLazySpotsToEager(e)}fetchPrediction(){return s(this,void 0,void 0,(function*(){const t=(new c.default).getData(),i=Object.assign(Object.assign({},this.staticData),{vp:t.vid,p:t.p,i:t.img,cs:t.cs,cr:t.cr});return r.default.xhrPromise(`//ai.browsiprod.com/scroll/v2?${r.default.qt(i)}`,"GET")}))}filterLazySpotsAboveThreshold(t){const i=r.default.M(!1)*t,e=n.default.getSpots().filter((t=>{if("in"!==t.tags.positionTag||!t.isLazyLoading||t.newBrowsiAd)return!1;return r.default.B(t.ref).y<i}));return this.logger.info(`spots before position ${i} will convert to eager`,e),e}moveLazySpotsToEager(t){const i=o.default.getLazySpotsInstance();t.forEach((t=>{t.isLazyLoading=!1,t.convertedToEager=!0,i.manualFetchSpot(t)}))}}i.default=p},8542:function(t,i,e){"use strict";var s=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))((function(n,r){function o(t){try{a(s.next(t))}catch(t){r(t)}}function h(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,h)}a((s=s.apply(t,i||[])).next())}))};Object.defineProperty(i,"__esModule",{value:!0});const n=e(1250),r=e(3802),o=e(7111),h=e(4059),a=e(4987),c=e(8807),l=e(584),d=e(6761),u=e(8406),v=e(1159),f=e(7093),p=e(2593);class m{static get logger(){return this._logger||(this._logger=new n.default("SpotEngine Flow Service")),this._logger}static run(t,i,e,s,n){const o=!!(null==n?void 0:n.isDcs)||!!i.dcsState;let h=[];try{t.startSpotEngine(n),h=u.default.getSpots()}catch(t){i.debug&&m.logger.error(t)}e&&m.sendPageViewReport(h,i,!1,o);const c=i.fixedSpotsFirst?h.filter((t=>!l.default.isFixedSpot(t.tags))):h,v=a.default.xi(c);c.length&&s&&!i.analysisMode&&r.YieldClient.get().He(c.filter((t=>t.type!==d.SpotType.STICKY&&t.type!==d.SpotType.API))),this.shouldStopSpotEngine(v,i)&&t.onStopEngine()}static shouldStopSpotEngine(t,i){return!t.length||i.analysisMode||h.default.instance.isHidden||t.length&&this.eagerSpotsShouldWaitForEngaged(t)&&!a.default.userEngaged}static eagerSpotsShouldWaitForEngaged(t){return t.some(a.default.Wt)}static sendPageViewReport(t,i,e,s){i.debug&&c.Output.setBrowsiOutput("page_view");const n=l.default.getFixedTotalMaxItems(),r=l.default.getMaxItems(p.SPOT_TAGS_MAP[d.SpotType.DYNAMIC]);o.default.get().sendPageviewEvent(r,n,s),this.initScrollDepthPredictor(),this.sendProfitabilityPrediction()}static initScrollDepthPredictor(){return s(this,void 0,void 0,(function*(){const t=new f.default,i=yield t.getPrediction();i>-1&&t.modifySpotsAccordingToPrediction(i)}))}static sendProfitabilityPrediction(){v.ProfitabilityPredictorService.get().sendProfitabilityPrediction()}}i.default=m},2593:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SpotsUtils=i.SPOT_TAGS_MAP=i.FIXED_TAGS=i.FIXED_TYPES=void 0;const s=e(6761),n=e(394),r=e(4987),o=e(4752);i.FIXED_TYPES=[s.SpotType.FIXED_IN_CONTENT,s.SpotType.FIXED_TOP,s.SpotType.FIXED_BOTTOM],i.FIXED_TAGS=[{typeTag:"fi",positionTag:"in"},{typeTag:"fi",positionTag:"t"},{typeTag:"fi",positionTag:"b"}],i.SPOT_TAGS_MAP={[s.SpotType.FIXED_IN_CONTENT]:{oldType:s.SpotType.FIXED_IN_CONTENT,typeTag:"fi",positionTag:"in"},[s.SpotType.FIXED_TOP]:{oldType:s.SpotType.FIXED_TOP,typeTag:"fi",positionTag:"t"},[s.SpotType.FIXED_BOTTOM]:{oldType:s.SpotType.FIXED_BOTTOM,typeTag:"fi",positionTag:"b"},[s.SpotType.DYNAMIC]:{oldType:s.SpotType.DYNAMIC,typeTag:"dy",positionTag:"in"},[s.SpotType.STICKY]:{oldType:s.SpotType.STICKY,typeTag:"st",positionTag:"s"}};class h{static getGeneralLazyConfig(){return n.Profiler.get().spotsSupplyParams.lazySpots}static getSizes(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.allowedCreativeSizes)||[]}static validateStickySizes(t){return t.filter((t=>r.default.isValidStickySize(t)))}static getDynamicMaxItems(){var t;return(null===(t=n.Profiler.get().spotsSupplyParams.dynamic)||void 0===t?void 0:t.maxItems)||0}static getFixedMaxItems(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.maxItems)||-1}static getConf(t){switch(t.typeTag){case"fi":switch(t.positionTag){case"in":return n.Profiler.get().spotsSupplyParams.fixed;case"t":return n.Profiler.get().spotsSupplyParams.fixedTop;case"b":return n.Profiler.get().spotsSupplyParams.fixedBottom;default:return}case"dy":return n.Profiler.get().spotsSupplyParams.dynamic;case"api":const i=n.Profiler.get().spotsSupplyParams.api;return i&&i[t.positionTag];case"st":return n.Profiler.get().spotsSupplyParams.sticky}}static getLazyConf(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.lazyLoading}static getLazyBucketsConf(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.lazyLoadingBuckets}static getViewabilityThreshold(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.viewabilityThreshold}static shouldLazyLoad(t){return t.optimizeViewability&&o.default.getLazySpotsInstance().isLazy(t)}static getTargetElementPosition(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.targetElementPosition)||"ABOVE"}static convertTagsToType(t){switch(t.typeTag){case"dy":return s.SpotType.DYNAMIC;case"api":return s.SpotType.API;case"st":return s.SpotType.STICKY;case"fi":switch(t.positionTag){case"in":return s.SpotType.FIXED_IN_CONTENT;case"t":return s.SpotType.FIXED_TOP;case"b":return s.SpotType.FIXED_BOTTOM}default:return s.SpotType.DYNAMIC}}static sortBySpotIndex(t){return t.sort(((t,i)=>t.spotIndex-i.spotIndex))}}i.SpotsUtils=h},3810:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TouchEventsService=void 0;const s=e(4987),n=e(1250),r=e(6761),o=e(7328);class h{constructor(){this.ads=[],this.adsTouchesMap={},this.foldsTouchesMap={},this.isResizeObserverExist=!!window.ResizeObserver,this.pageHeight=s.default.M(),this.viewPortHeight=s.default.Ti().viewPortHeight,this.logger=new n.default("TouchEventsService")}static get(){return h.instance||(h.instance=new h),h.instance}getTouchMaps(){return{foldsTouchesMap:this.foldsTouchesMap,adsTouchesMap:this.adsTouchesMap}}initListeners(){if(this.isResizeObserverExist){const t=s.default.Ci(this.recalculateAdsDistance.bind(this),250);this.resizeObserver=new ResizeObserver(t),this.resizeObserver.observe(s.default.K()),o.default.get().listen("touchstart",window,this.touchCallback.bind(this)),this.logger.info("touchstart listener and ResizeObserver are added")}else this.logger.info("ResizeObserver is not supported, touch service will not collect data")}disconnectResizeObserver(){var t;null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.logger.info("ResizeObserver is disconnected")}getAdDistanceFromPageTop(t){const i=s.default.B(t).y;return{distanceTop:i,distanceBottom:i+s.default.G(t).h}}recalculateAdsDistance(){const t=s.default.M();t!=this.pageHeight&&(this.pageHeight=t,this.ads.filter((t=>t.active)).forEach((t=>{const{distanceTop:i,distanceBottom:e}=this.getAdDistanceFromPageTop(t.element);t.distanceTop=i,t.distanceBottom=e})))}addBrowsiAd(t){var i;if(!this.isResizeObserverExist||t.type===r.SpotType.STICKY||!t.newBrowsiAd)return;t.refreshCount>0&&this.ads.filter((i=>i.active&&i.index===t.spotIndex)).forEach((t=>t.active=!1));const e=null===(i=t.newBrowsiAd)||void 0===i?void 0:i.adContainer,{distanceTop:s,distanceBottom:n}=this.getAdDistanceFromPageTop(e);this.ads.push({active:!0,index:t.spotIndex,refreshCount:t.refreshCount,element:e,distanceTop:s,distanceBottom:n})}touchCallback(t){this.handleFoldTouches(t),this.handleAdsTouches(t)}handleFoldTouches(t){Array.from(t.changedTouches).forEach((t=>{const i=s.default.getFoldNumberByDistance(t.pageY);i<11&&(this.foldsTouchesMap[i]=this.foldsTouchesMap[i]||0,this.foldsTouchesMap[i]++)}))}handleAdsTouches(t){Array.from(t.changedTouches).forEach((t=>{this.ads.filter((t=>t.active)).forEach((i=>{this.processAdTouch(i,t.pageY,t.clientY)}))}))}processAdTouch(t,i,e){this.isTouchingAd(t.distanceTop,t.distanceBottom,i)?this.updateAdsTouchesMap(t.index,t.refreshCount,0):this.processAdTouchOutside(t,i,e)}isTouchingAd(t,i,e){return t<=e&&e<=i}processAdTouchOutside(t,i,e){const{index:s,refreshCount:n,distanceTop:r,distanceBottom:o}=t;let h,a;const c=i>o;if(c)h=i-o,a=h<e;else{h=r-i,a=h<this.viewPortHeight-e}if(a){const t=c?-h:h;this.updateAdsTouchesMap(s,n,t)}}updateAdsTouchesMap(t,i,e){this.adsTouchesMap[t]=this.adsTouchesMap[t]||{},this.adsTouchesMap[t][i]=this.adsTouchesMap[t][i]||{};const s=this.adsTouchesMap[t][i].mind,n="number"==typeof s?this.getClosestDistanceToAd(s,e):e;this.adsTouchesMap[t][i].mind=n}getClosestDistanceToAd(t,i){return Math.abs(t)<=Math.abs(i)?t:i}}i.TouchEventsService=h},2002:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(7709),n=e(4987),r=e(4560),o=e(4730);class h extends s.Embedder{constructor(t){super(t)}Je(t,i){return new Promise(((e,s)=>{if(t.ref&&t.ref.parentNode){let s;r.InframeManager.get().isProviderInframe(t)&&(s=r.InframeManager.get().getSpotContainers(t.spotIndex));const n=this.runChangeEmbedderContainersHook(t)||s,o=this.Vs((null==n?void 0:n.adWrapper)||document.createElement("div"),t.type,t.typeIndex),h=this.Ls((null==n?void 0:n.adContainer)||document.createElement("div")),a=this.Us(t,i,o),c=i?"block":"none";(null==n?void 0:n.adContainer)||o.appendChild(h),o.setAttribute("style","text-align: center;"),this.runProcessSpotHook(t,o),h.setAttribute("style",this.Hs(t,c));const l=this.Ws(t,window,o,a,h,null);this.runOnBuildBrowsiAdHook(l),this.qs(t,o,!!n),o.setAttribute("style",this.Gs(t,c)),t.Js(l),e(l)}else s()}))}Xs(t,i=!1){var e;if(t.placeholder){const i=this.getMinHeight(t);t.placeholder.removePlaceholderStyle(t.newBrowsiAd),(null===(e=t.newBrowsiAd)||void 0===e?void 0:e.adContainer)&&(t.newBrowsiAd.adContainer.style.minHeight=i,t.placeholder.size&&t.implementedSize&&t.placeholder.size.h>t.implementedSize.h&&(t.newBrowsiAd.adContainer.style.display="flex",t.newBrowsiAd.adContainer.style.justifyContent="center",t.newBrowsiAd.adContainer.style.alignItems="center"))}if(t.providerName===o.ProviderType.GENERIC_JS)return;const{width:s,height:r}=this.Ks(t,i);if(i||n.default.Gt(`#${t.newBrowsiAd&&t.newBrowsiAd.adContainer.id} iframe`,`height:${r} !important;width: ${s} !important;`),n.default.Gt(`#${t.newBrowsiAd&&t.newBrowsiAd.adContainer.id} *`,"text-align:center !important;"),t.isFluid&&t.browsiAd){const i=t.browsiAd.getBoundingClientRect();t.Ye({w:i.width,h:i.height})}}}i.default=h},7709:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Embedder=void 0;const s=e(4987),n=e(394),r=e(1250),o=e(6761),h=e(8803),a=e(9839),c=e(4752),l=e(8406),d=e(2593),u=e(7111),v=e(4730);class f{constructor(t){this.profile=n.Profiler.get();const i=a.default.getDcsActionCounter();this.spotIdentifier=`${t.spotIndex}_ai_${t.Li?t.Li:1}_rc_${t.refresh?t.refresh.count:0}${i&&i>0?`_dcs_${i}`:""}`,this.logger=new r.default("Embedder")}static bs(t){var i;return!!t.newBrowsiAd&&(s.default.Jt(t.newBrowsiAd.adWrapper),f.Ne(t.newBrowsiAd.adWrapper),null===(i=t.placeholder)||void 0===i||i.stopObserving(),!0)}runProcessSpotHook(t,i){const e=c.default.getExternalFlowHandler("processSpotBeforeAddingToDOM");e&&(t.containerElement={children:[i]},e(t,t.spotIndex))}qs(t,i,e){var s;if(t.isRefreshing()||f.bs(t),!e)if(t.type===o.SpotType.STICKY){const e=window.document.body;(null===(s=d.SpotsUtils.getConf(t.tags))||void 0===s?void 0:s.location)===h.Location.TOP?e.prepend(i):e.appendChild(i)}else switch(t.targetElementPosition){case"BELOW":case"ABOVE":t.ref.insertAdjacentElement("beforebegin",i);break;case"INSIDE":t.ref.insertAdjacentElement("afterbegin",i)}t.relocationPlid&&i.setAttribute("relocatedId",t.relocationPlid)}Vs(t,i,e){return t.id=`browsi_wrapper_${this.spotIdentifier}`,t.setAttribute("spotType",i),t.setAttribute("typeIndex",""+e),t}Ls(t){return t.id=`browsi_ad_${this.spotIdentifier}`,t}Ys(){const t=document.createElement("iframe");return t.id=`browsi_ad_${this.spotIdentifier}`,t.scrolling="no",t.frameBorder="0",t.marginHeight="0",t.marginWidth="0",t.height="0",t.width="0",t.style.display="none",t}Ws(t,i,e,s,n,r){return{win:i,adWrapper:e,adMarking:s,adContainer:n,iframe:r,isIframe:null!==r,display:i=>this.Xs(t,!!i)}}Us(t,i,e){try{if(!this.profile.admarking||!this.profile.admarking.active)return null;this.setGeneralMarkingStyle();const s=document.createElement("div");s.innerText=this.profile.admarking.text?this.profile.admarking.text:"ADVERTISEMENT",s.id=`browsi_admarking_${t.spotIndex}`,s.setAttribute("class","browsi_admarking");const n=t.providerName===v.ProviderType.GENERIC_JS||!i;s.setAttribute("style","display:"+(n?"none":"block"));const r=c.default.getExternalFlowHandler("adMarkingHandler"),h=(t,i)=>{i.prepend(t)};return r?r(s,e,h,t):t.type!==o.SpotType.STICKY?(h(s,e),s):null}catch(i){return this.logger.error(`Failed to generate ad marking for spot index ${t.spotIndex}`),null}}setGeneralMarkingStyle(){if(l.default.getSpots().filter((t=>t.browsiAd)).length<=1){const t=this.Qs();s.default.Gt(".browsi_admarking",t)}}Qs(){const t=`height: 32px !important;\nwidth: 100% !important;\npadding: 0 !important;\nfont-family: Arial, sans-serif !important;\nmargin: auto !important;\ntext-align: center !important;\nline-height: 32px !important;\nfont-weight: normal !important;\ncolor: ${this.profile.admarking.color?this.profile.admarking.color:"#9f9f9f"} !important;\nfont-size: 11px !important;`;return this.profile.admarking.customStyle?this.profile.admarking.customStyle:t}static Ki(t){const i=t.newBrowsiAd;i&&i.adWrapper&&-1==this.browsiAdsOnPage.indexOf(i.adWrapper)&&this.browsiAdsOnPage.push(i.adWrapper)}static Ne(t){const i=this.browsiAdsOnPage.indexOf(t);i>-1&&this.browsiAdsOnPage.splice(i,1)}static Zs(){return this.browsiAdsOnPage}Ks(t,i){const e=t.implementedSize,s=t.isFluid||i?"auto":`${e&&e.h}px`;return{width:t.isFluid||i?"auto":`${e&&e.w}px`,height:s}}Gs(t,i){var e,s,n;const r=d.SpotsUtils.getConf(t.tags);let h="margin: 0 auto;text-align: center;margin-top:16px;margin-bottom: 16px;clear: both !important;";if(i&&!(null===(e=t.placeholder)||void 0===e?void 0:e.active)&&(h+=`display:${i};`),t.type===o.SpotType.STICKY){h+=`position:fixed!important;${(null===(s=r)||void 0===s?void 0:s.location.toLowerCase())||"bottom"}: 0 !important; left: 50%; transform: translateX(-50%); margin:0 auto !important; z-index:9999;`}return(null===(n=null==r?void 0:r.style)||void 0===n?void 0:n.w)&&(h+=r.style.w),h}Hs(t,i){var e;let s="margin: 0 auto;text-align: center;margin-top:16px;margin-bottom: 16px;clear: both !important;";i&&(s+=`display:${i};`),t.type===o.SpotType.STICKY&&(s+="margin:0 !important;");const n=d.SpotsUtils.getConf(t.tags);return(null===(e=null==n?void 0:n.style)||void 0===e?void 0:e.c)&&(s+=n.style.c),s}Ji(t,i){var e;const n=d.SpotsUtils.getConf(t.tags);if(i&&(null==n?void 0:n.closeButton)){const r=document.createElement("c-button");r.id=`close-sticky-${this.spotIdentifier}`,r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 30 30"><defs><style>.a{fill:#fff;stroke:#707070;}.b{stroke:none;}.c{fill:none;}</style></defs><g transform="translate(-1429 -929)"><g class="a" transform="translate(1429 929)"><circle class="b" cx="15" cy="15" r="15"/><circle class="c" cx="15" cy="15" r="14.5"/></g><path d="M20.518,6.563,18.955,5l-6.2,6.2L6.563,5,5,6.563l6.2,6.2L5,18.955l1.563,1.563,6.2-6.2,6.2,6.2,1.563-1.563-6.2-6.2Z" transform="translate(1430.975 930.975)"/></g></svg>',r.setAttribute("style","position: absolute;width: 24px;height: 24px;border:none; background:none;padding:0;cursor:pointer");const o=n.location,a=(null===(e=t.implementedSize)||void 0===e?void 0:e.w)||s.default.C();r.style.right=s.default.C()<=a?"0px":"-12px",r.style[o===h.Location.BOTTOM?"top":"bottom"]="-12px",r.onclick=()=>{t.isRefreshing()||(l.default.removeStickyAd(t),u.default.get().sendStickyClosedEvent(t))},i.appendChild(r)}}runChangeEmbedderContainersHook(t){const i=c.default.getExternalFlowHandler("changeEmbedderContainers");return i?i(t):null}runOnBuildBrowsiAdHook(t){const i=c.default.getExternalFlowHandler("onBuildBrowsiAd");return i?i(t):t}getMinHeight(t){var i,e,n,r,h;let a="";if(t.type!==o.SpotType.STICKY&&t.newBrowsiAd&&t.placeholder&&s.default.isChangingViewport(t.newBrowsiAd.adWrapper))if(t.placeholder.active)a=t.placeholder.size.h?t.placeholder.size.h+"px":"";else{const s=(null===(n=null===(e=null===(i=t.refresh)||void 0===i?void 0:i.oldBrowsiAd)||void 0===e?void 0:e.iframe)||void 0===n?void 0:n.style.minHeight)||(null===(h=null===(r=t.refresh)||void 0===r?void 0:r.oldBrowsiAd)||void 0===h?void 0:h.adContainer.style.minHeight);a=s||""}return a}}i.Embedder=f,f.browsiAdsOnPage=[]},96:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EmbeddingFactory=void 0;const s=e(2133),n=e(2002),r=e(4730);i.EmbeddingFactory=class{static getEmbedder(t,i){var e;switch(t.rt){case r.ProviderType.HEADER_BIDDING:return t.c.if?new s.default(i):new n.default(i);case"empty_api":return new n.default(i);case"provider":const o=t;if(null===(e=o.c.a)||void 0===e?void 0:e.template)return this.inIframe(o)?new s.default(i):new n.default(i);switch(o.c.p){case r.ProviderType.DFP:case r.ProviderType.GENERIC_JS:return this.inIframe(o)?new s.default(i):new n.default(i);default:return null}default:return null}}static inIframe(t){return"true"===t.c.a.inIFrame}}},2133:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(7709),n=e(4987),r=e(1607);class o extends s.Embedder{constructor(t){super(t)}Je(t,i){return new Promise(((e,s)=>{var n,r;if(t.ref&&t.ref.parentNode){const s=this.Vs(document.createElement("div"),t.type,t.typeIndex),o=this.Ys(),h=this.Ls(document.createElement("div")),a=this.Us(t,i,s),c=i?"block":"none";this.setIframePlaceholderStyle(o,t);const l=null===(r=null===(n=t.refresh)||void 0===n?void 0:n.oldBrowsiAd)||void 0===r?void 0:r.adContainer.style.minHeight;l&&(o.style.minHeight=l),s.appendChild(o),this.runProcessSpotHook(t,s),o.onload=()=>{o.contentDocument.open(),o.contentDocument.close(),o.contentDocument.body.appendChild(h),o.contentWindow.__cmp=window.__cmp,o.contentWindow.__tcfapi=window.__tcfapi;const i=this.Ws(t,o.contentWindow,s,a,h,o);h.setAttribute("style","text-align: center;"),t.Js(i),i.adWrapper.setAttribute("style",this.Gs(t,c)),e(i)},this.qs(t,s,!1)}}))}Xs(t,i=!1){var e,s,r;null===(e=t.placeholder)||void 0===e||e.removePlaceholderStyle(t.newBrowsiAd);const{width:o,height:h}=this.Ks(t,!1);if(t.newBrowsiAd){if(t.newBrowsiAd.iframe){if(t.newBrowsiAd.iframe.style.display="block",t.isFluid||(null===(s=this.profile.uxFixes)||void 0===s?void 0:s.dynamicIframeSize))return this.setImplementedIframeSize(t.newBrowsiAd.iframe,t.implementedSize),void this.watchDynamicIframeSize(t.newBrowsiAd.iframe,t);let i=`text-align:center;display: block;margin: auto;width:${o} !important; height:${h} !important;`;const e=this.getMinHeight(t);t.newBrowsiAd.adContainer.style.minHeight=e,i+=e?`min-height:${e};`:"",(null===(r=t.placeholder)||void 0===r?void 0:r.size)&&t.implementedSize&&t.placeholder.size.h>t.implementedSize.h&&(t.newBrowsiAd.adContainer.style.display="flex",t.newBrowsiAd.adContainer.style.justifyContent="center",t.newBrowsiAd.adContainer.style.alignItems="center"),t.newBrowsiAd.iframe.setAttribute("style",i)}n.default.Gt(`#${t.newBrowsiAd.adContainer.id} iframe`,`height:${h};width: ${o} !important;`)}}setImplementedIframeSize(t,i){i&&t&&(t.width=i.w.toString(),t.height=i.h.toString())}watchDynamicIframeSize(t,i){var e;const s=null===(e=t.contentWindow)||void 0===e?void 0:e.document.body;if(s){t.style.setProperty("width","100%","important");const i=new r.default(s);i.addResizeListener((()=>{const e=n.default.G(s).h;t.setAttribute("style",`text-align:center;display: block;margin: auto; height:${e}px !important; width:100% !important`),setTimeout((()=>{i.removeResizeListener()}),2e3)}))}}setIframePlaceholderStyle(t,i){var e;if(!(null===(e=i.placeholder)||void 0===e?void 0:e.active))return;const s=i.tn(i.sizes);t.width=""+s.w,t.height=""+s.h,t.style.display="block"}}i.default=o},5023:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BROWSI_IMPRESSION_DOM_EVENT_NAME=void 0,i.BROWSI_IMPRESSION_DOM_EVENT_NAME="browsiImpression"},4075:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventTopic=void 0,function(t){t.DEMAND="demand",t.SUPPLY="supply",t.ENGAGEMENT="engagement",t.ANALYTIC="analytic",t.PREBID="prebid",t.HEADER_BIDDING="hb",t.ERROR="engineError",t.WEB_VITALS="web_vitals",t.INFRAME="inframe",t.REFRESH="refresh",t.FOLDS="folds",t.DEMAND_ENGAGEMENT="demand_engagement",t.UX_RULES="ux_rules"}(i.EventTopic||(i.EventTopic={}))},9310:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.EventType=void 0,function(t){t.SPOT_FOUND="spot_found",t.AD_REQUEST="ad_request",t.AD_MATCHED="ad_matched",t.AD_IMPRESSION="ad_impression",t.MEASURABLE_IMPRESSION="measurable_impression",t.VIEWED_IMPRESSION="viewed_impression",t.VIEWED_IMPRESSION_AV="viewed_impression_av",t.VIEWED_IMPRESSION_100="v_100",t.FOUND_PUBLISHER_AD="found_publisher_ad",t.VIEWED_PUBLISHER_AD="viewed_publisher_ad",t.VIEWED_PUBLISHER_AD_AV="viewed_publisher_ad_av",t.PUB_AD_REFRESH_REQUEST="pub_ad_refresh_request",t.BID_REQUEST="bid_request",t.BID_MATCHED="bid_matched",t.BID_MATCHED_TIMEOUT="bid_matched_timeout",t.API_REQUEST_BLOCKED="api_request_blocked",t.AD_REQUEST_BLOCKED="ad_request_blocked",t.AD_IN_VIEWPORT="ad_in_viewport",t.PUB_AD_REFRESH_BLOCK="parb",t.STICKY_CLOSED="sticky_closed",t.PLACEHOLDER_VIEWED="placeholder_viewed",t.PLACEHOLDER_CLOSED="placeholder_closed",t.BILLABLE_EVENT="billable_event",t.ENGINE_LOADED="engine_loaded",t.PAGE_VIEW="page_view",t.DCS_GALLERY="dcs_gallery",t.DCS_ENDLESS="dcs_endlessScroll",t.DCS_ACCORDION="dcs_accordion",t.DCS_READMORE="dcs_readMore",t.DCS_SPA="dcs_spa",t.DCS_SLIDES="dcs_slides",t.DCS_MANUAL="dcs_manual",t.DCS_SCRIPT="dcs_script",t.FOCUS_CHANGED="focus_changed",t.USER_ENGAGED="user_engaged",t.NETWORK_INFO_FOUND="network_info_found",t.FOLD_SUMMARY="fold_summary",t.CRASH="crash",t.PREBID_ERROR="prebid_error",t.SCRIPT_LOAD_ERROR="script_load_error",t.CONFIGURATION_ERROR="configuration_error",t.XHR_ERROR="xhr_promise_error",t.GENERIC_ERROR="generic_error",t.GENERAL_ENGAGEMENT="general_engagement",t.SUMMARY="summary",t.DEMAND_SUMMARY="demand_summary",t.PUB_DEMAND_SUMMARY="pub_demand_summary",t.USER_STATS="user_stats",t.GENERAL_DATA="general_data",t.FOUND_PUBLISHER_AD_BIDS="fpab",t.HBWinner="hbw",t.AMAZON_WINNER="amw",t.RESPONSE_TIMES="rt",t.WEB_VITALS="web_vitals",t.PLACEMENTS_SENT="placements",t.INFRAME_HAS_DEMAND="has_demand",t.CUSTOM_REFRESH_RATE_RULE="rule",t.STAY_AWAY="stay_away",t.SKIPPED="skipped"}(i.EventType||(i.EventType={}))},1332:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(1150),o=e(394),h=e(9839),a=e(2593);class c{constructor(){this.logger=new s.default("MainContent"),this.commonStartTagNames="main,p,nav,img,h1,h2,header",this.commonEndTagNames="p,img,h2,h1,svg",this.excludeElements="footer, form",this.maxMCSize=1e5,this.scanStatus=4;const t=o.Profiler.get();this.debugMode=!!t.debug&&t.debug,this.draw=!!t.draw&&t.draw,this.mainContentConfig=t.mainContentConfig,this.mainContentOnly=!1,this.isAutoDetected=!1,this.commentSections=[],this.socialWidgets=[],this.mainContentConfig&&this.mainContentConfig.enabled&&(this.mainContentConfig.start||this.mainContentConfig.end)?this.logger.info("mainContent is using configuration data - start: ",this.mainContentConfig.start," end ",this.mainContentConfig.end):this.logger.info("no configuration found, mainContent will be detected automatically")}static get instance(){return this._instance||(this._instance=new c),this._instance}findMainContent(t,i,e,s){this.scanStatus=0,this.CR=i,this.commentSections=e,this.socialWidgets=s,this.start=this.calculateStartingElement(),this.startPosition=n.default.B(this.start).y,this.end=this.calculateEndElement(),this.endPosition=n.default.B(this.end).y,this.totalMCSize=this.calculateMCSize(!0),this.logMainContent();const r=a.SpotsUtils.getConf({typeTag:"dy",positionTag:"in"});this.mainContentOnly=(null==r?void 0:r.mainContentOnly)&&!this.isAutoDetected&&this.isMCAtLeastOneFold()}logMainContent(){this.logger.verbose(`Start Element at offsetTop ${this.startPosition}`,this.start),this.logger.verbose(`End Element at offsetTop ${this.endPosition}`,this.end),this.logger.verbose(`mc size: ${this.totalMCSize}`),this.drawMainContentBorder(this.start,this.end)}isMCAtLeastOneFold(){return this.calculateMCSize(!0)>=window.screen.height}calculateStartingElement(){const t=this.getDcsMcElement();return this.mainContentConfig&&this.mainContentConfig.enabled?(this.configStart=t,this.mainContentConfig.start.length>0&&(this.configStart=this.findConfigStartElement(this.mainContentConfig.start))):this.configStart=t,this.configStart?this.configStart:this.findStartingPoint()}calculateEndElement(){return this.mainContentConfig&&this.mainContentConfig.enabled?this.mainContentConfig.end.length>0&&(this.configEnd=this.findConfigEndElement(this.mainContentConfig.end)):this.configEnd=this.getDcsMcElement(),this.configEnd||this.findEndingPoint()}findConfigStartElement(t){let i=n.default.Mi(t);if(h.default.hasDcsMc()){const t=h.default.getCurrentDcsElement();i=i.filter((i=>i===t||n.default.isPositionContained(t,i)||n.default.isPositionedAfter(i,t)))}return 0===i.length&&(this.isAutoDetected=!0),this.upperMostElementOf(i)}findConfigEndElement(t){let i=n.default.Mi(t);return 0===i.length&&(this.isAutoDetected=!0),this.lowerMostElementOf(i)}findStartingPoint(){this.scanStatus=1;let t=this.getAllValidCandidates(this.commonStartTagNames),i=this.upperMostElementOf(t);return i||document.body}findEndingPoint(){this.scanStatus=1===this.scanStatus?3:2;let t=this.lowerMostElementOf(this.CR.filter((t=>t.data&&t.data.is_visible)).map((t=>t.node))),i=this.lowerMostElementOf(this.commentSections);this.logger.verbose("lowestCS: "+i+"; lowestCR: "+t);let e=this.upperMostElementOf([i,t].filter((t=>!!t))),s=this.getAllValidCandidates(this.commonEndTagNames);s=s.concat(this.socialWidgets),s=this.sortByDomLocation(s),s=this.removeAllElementsAfter(e,s);let n=this.getExcludedElements();return s=this.excludeElementsAndTheirChildren(s,n),s&&s.length?s[s.length-1]:this.start}getExcludedElements(){return Array.from(document.body.querySelectorAll(this.excludeElements)).filter((t=>{if("FORM"===t.nodeName){return t.getBoundingClientRect().height<=.8*document.body.getBoundingClientRect().height}return!0}))}getAllValidCandidates(t){let i=.8*n.default.A().width,e=[];return Array.from(document.body.querySelectorAll(t)).filter((t=>{if(n.default.S(e,t))return!1;let s=t.getBoundingClientRect();switch(t.nodeName){case"NAV":return!(n.default.isFixed(t).status||!t.hasChildNodes())&&(!n.default.Ct(location.origin,t)||(e.push(t),!1));case"H1":case"H2":case"HEADER":return!(!n.default.$t(t)||!s.height)&&(!(n.default.isFixed(t).status||!n.default.isFixed(t).status&&n.default.Ct(location.origin,t))||(e.push(t),!1));case"MAIN":case"SVG":case"svg":return!n.default.isFixed(t).status&&s.height>i;case"P":return!n.default.isFixed(t).status&&n.default.$t(t)&&s.height;case"IMG":return s.height&&s.width>i;default:return!1}}))}excludeElementsAndTheirChildren(t,i){return t.filter((t=>t&&!n.default.S(i,t)))}sortByDomLocation(t){return t.sort((function(t,i){return t===i?0:t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING?1:-1}))}calculateMCSize(t){if(!this.totalMCSize||t)if(this.start&&this.end)if(n.default.Bt(window.document.body,this.start)||n.default.Bt(window.document.body,this.end))this.logger.error("could not update mc_size, start/end elements removed from DOM",this.start,this.end);else{this.logger.verbose("calculating start/end elements"),this.startPosition=n.default.B(this.start).y,this.endPosition=n.default.B(this.end).y;let t=Math.min(this.endPosition+this.end.offsetHeight-this.startPosition,this.maxMCSize);this.totalMCSize=t>-1?t:-1,this.logger.info(`MC Size: ${this.totalMCSize}, startPosition: ${this.startPosition}, endPosition: ${this.endPosition}, endElementsSize: ${this.end.offsetHeight}`)}else this.totalMCSize=-1;return this.totalMCSize}withinMainContent(t){return!(!this.start||!this.end)&&(n.default.isPositionContained(this.start,t)&&n.default.isPositionedBefore(t,this.end)||n.default.isPositionContained(this.end,t)||n.default.isPositionedAfter(t,this.start)&&n.default.isPositionedBefore(t,this.end)||t===this.start||t===this.end)}shouldLookInMCOnly(){return this.mainContentOnly}isBelowMC(t){return this.elementAfterEnd?n.default.isPositionedAfter(t,this.elementAfterEnd):n.default.isPositionedAfter(t,this.end)}getMCStart(){return this.start?this.start.offsetTop:-1}isNextVisibleElement(t){return this.elementAfterEnd||this.findNextVisibleElement(),t===this.elementAfterEnd}findNextVisibleElement(){let t=Array.from(document.querySelectorAll("*")).filter((t=>n.default.isPositionedAfter(t,this.end)&&!n.default.isPositionContained(this.end,t)&&n.default.gi(t)));t.length>0&&(this.elementAfterEnd=t[0])}getBorderElement(t){let i=document.createElement("div");i.id="browsi_"+t.toLowerCase().replace(/\s*/g,""),i.style.width="100%",i.style.height="0px",i.style["border-bottom"]="2px solid #00ff00",i.style["text-align"]="center",i.style.zIndex="9999999",i.style.position="absolute",i.style.color="white";let e=document.createElement("span");return e.style["font-size"]="20px",e.style["background-color"]="#00ff00",e.innerText=t,i.appendChild(e),i}drawMainContentBorder(t,i){this.debugMode&&this.draw&&(t.parentNode&&(this.startingBorder=this.startingBorder||this.getBorderElement("Main Content Start"),this.logger.verbose("starting border",this.startingBorder),t.parentNode.insertBefore(this.startingBorder,t)),i&&i.parentNode&&(this.endingBorder=this.endingBorder||this.getBorderElement("Main Content Ends"),this.logger.verbose("ending border",this.endingBorder),i.nextSibling?i.parentNode.insertBefore(this.endingBorder,i.nextSibling):i.parentNode.appendChild(this.endingBorder)))}upperMostElementOf(t){return t?this.sortByDomLocation(t)[0]:void 0}lowerMostElementOf(t){return t?this.sortByDomLocation(t)[t.length-1]:void 0}removeAllElementsAfter(t,i){if(!t)return i;let e=new Array;for(let s of i)s&&s.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING&&e.push(s);return e}getAdPositionType(t,i,e,s){if(!t||!this.start||!this.end)return r.AdPositionType.NA;if(n.default.isFixed(t).status||n.default.Ft(t)){if(void 0!==i&&void 0!==e){if(s&&n.default.Pi(i))return r.AdPositionType.INTERSTITIAL;const t=e+i-n.default.ht().top;return n.default.Nt(n.default.A().height,t,.25*n.default.A().height)?r.AdPositionType.STICKY_BOTTOM:r.AdPositionType.STICKY_TOP}return r.AdPositionType.NA}return this.withinMainContent(t)?r.AdPositionType.WITHIN_MC:n.default.isPositionedBefore(this.start,t)?r.AdPositionType.BELOW_MC:r.AdPositionType.ABOVE_MC}getDcsMcElement(){return h.default.hasDcsMc()?h.default.getCurrentDcsElement():void 0}getScanStatus(){return this.scanStatus}}i.default=c},7499:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ThresholdOperator=void 0,function(t){t.OR="or",t.AND="and"}(i.ThresholdOperator||(i.ThresholdOperator={}))},6050:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(4730);i.default=class{constructor(t,i){this.active=!0,this.rate=t.r,this.dfpOnly=t.do,this.keyValues=t.kv,this.limit=t.l,this.noDemandRefresh=t.nd,this.count=0,this.lastSuccessfulRefresh=0,this.isRefreshing=!1,this.stickyRefresh=!1,this.failCallback=i}canRefresh(t){return t>=this.rate&&!this.isRefreshing}start(t,i){this.oldBrowsiAd=Object.assign({},t.newBrowsiAd),this.isRefreshing=!0,this.stickyRefresh=i,this.updateCount(),t.sizes=[t.implementedSize]}isGenericRefresh(t){return!(!t.genericParams.refresh||t.providerName!==n.ProviderType.GENERIC_JS||!this.isRefreshing)}updateCount(){this.count++}handleFailed(t){t.newBrowsiAd&&(s.default.Jt(t.newBrowsiAd.adWrapper),t.newBrowsiAd=Object.assign({},this.oldBrowsiAd),t.browsiAd=t.newBrowsiAd.adWrapper),this.isRefreshing=!1,"function"==typeof this.failCallback&&this.failCallback()}handleSuccess(){this.lastSuccessfulRefresh=this.count,this.isRefreshing=!1}isAllowedProviderForRefresh(t,i){return(t.providerName!==n.ProviderType.HEADER_BIDDING||!!i.c.d)&&t.providerName!==n.ProviderType.INFRAME}stopRefreshing(){this.active=!1}}},3060:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ScrollDirection=void 0,function(t){t.UP="up",t.DOWN="down"}(i.ScrollDirection||(i.ScrollDirection={}))},6761:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SpotType=void 0,function(t){t.FIXED_IN_CONTENT="fixed_mc",t.FIXED_TOP="fixed_top",t.FIXED_BOTTOM="fixed_bottom",t.DYNAMIC="dynamic_mc",t.STICKY="sticky",t.API="api"}(i.SpotType||(i.SpotType={}))},8803:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Location=i.StickyConstants=void 0,function(t){t.dcsVar="sticky"}(i.StickyConstants||(i.StickyConstants={})),function(t){t.TOP="TOP",t.BOTTOM="BOTTOM"}(i.Location||(i.Location={}))},7607:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TimeInViewType=void 0,function(t){t.BROWSI="browsi",t.PUBLISHER="publisher"}(i.TimeInViewType||(i.TimeInViewType={}))},1150:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AdPositionType=void 0,function(t){t.WITHIN_MC="within_mc",t.BELOW_MC="below_mc",t.ABOVE_MC="above_mc",t.STICKY_TOP="sticky_top",t.STICKY_BOTTOM="sticky_bottom",t.NA="NA",t.INTERSTITIAL="interstitial"}(i.AdPositionType||(i.AdPositionType={}))},3627:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.PublisherAdViewabilityObject=void 0;const s=e(2786),n=e(8473),r=e(9310),o=e(7607),h=e(4730),a=e(4987),c=e(4151),l=e(7111),d=e(4752);class u extends c.ViewabilityAdObject{constructor(t,i,e,s,n){super(t,i,e,a.default.getGAMResponseInfo(s)),this.placementId=t.placementId,this.isLazyLoaded=t.isLazyLoaded,this.positionType=t.positionType,this.provider=t.provider,this.refreshType=n,this.refreshCount=t.refreshCount,this.slot=s,this.isCustomRefreshConfigured=d.default.isCustomRefreshConfigured(),this.manualIframeWindow=t.manualIframeWindow,this.isCustomRefreshConfigured||this.setPubAdsRefresh(t,s),this.inViewActionsMap=this.generateInViewActionsMap(this.inViewActionsMap)}setPubAdsRefresh(t,i){var e;const n=s.default.get();if(n&&i){const r=n.getAdData(t.element,i,t.manualIframeWindow);r&&(this.pubRefreshRate=null===(e=s.default.get())||void 0===e?void 0:e.config.refreshRate,this.pubAdsData=r,this.refreshCallback=()=>{n.preparePubadsRefresh(i,this,r)})}}setCustomRefresh(t){const i=s.default.get(),e=this.slot;if(i&&e){const s=i.getAdData(this.ref,e);s&&(this.pubRefreshRate=t,this.pubAdsData=s,this.refreshCallback=()=>{i.preparePubadsRefresh(e,this,s)})}}onCustomRefreshRateReceived(t){t>0&&this.setCustomRefresh(t)}updateAnalytics(t){1===this.viewedImpressions&&this.isDfpAdNonSticky()&&n.default.get().increment(r.EventType.VIEWED_PUBLISHER_AD),n.default.get().updateTimeInView(o.TimeInViewType.PUBLISHER,this.placementId,this.refreshCount,this.viewedImpressions,t)}sendViewedEvent(t,i){l.default.get().Ps(this,t,i)}isDfpAdNonSticky(){return!(this.provider!==h.ProviderType.DFP||this.positionType&&a.default.zt(this.positionType))}isRefreshable(){return!(!this.refreshCallback||!this.pubAdsData)}canRefreshAd(t){return!!(!this.isRefreshing&&this.pubRefreshRate&&t>=this.pubRefreshRate&&this.refreshCallback)}_s(){this.refreshCallback&&this.refreshCallback()}isSticky(){return a.default.zt(this.positionType)}getRefreshRate(){return this.pubRefreshRate||-1}generateInViewActionsMap(t){return Object.assign(t,this.addActionToMap(["analytics"],[1e3,2e3,3e3,4e3,5e3,6e3,7e3],t)),Object.assign(t,this.addActionToMap(["event"],[this.conf.duration],t)),this.isRefreshable()&&this.getRefreshRate()>0&&Object.assign(t,this.addActionToMap(["refresh"],[this.getRefreshRate()],t)),t}}i.PublisherAdViewabilityObject=u},9746:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.SpotViewabilityObject=void 0;const s=e(8234),n=e(8473),r=e(9310),o=e(7607),h=e(4151),a=e(7111),c=e(6050),l=e(4987),d=e(394),u=e(4560),v=e(4752);class f extends h.ViewabilityAdObject{constructor(t,i,e,n){super(t,i,e,l.default.getGAMResponseInfo(t.spot.slot,t.spot)),this.isForcedRefresh=!1,this.spot=t.spot,this.expectedViewability=t.en,this.demandResponse=n,this.isCustomRefreshConfigured=v.default.isCustomRefreshConfigured(),this.isForcedRefresh=t.forcedRefresh,i.type===s.ViewabilityAdType.V&&(this.isRefreshConfigured(n)&&!this.isCustomRefreshConfigured&&(this.refreshManager=this.initializeRefresh(n.c.ri)),this.inViewActionsMap=this.generateInViewActionsMap(this.inViewActionsMap))}isRefreshConfigured(t){var i;return!!(null===(i=t.c)||void 0===i?void 0:i.ri)&&t.c.ri.r>0}initializeRefresh(t){return this.spot.refresh||(this.spot.refresh=new c.default(t)),this.spot.refresh}updateCustomRefresh(t){return this.spot.refresh?this.spot.refresh.rate=t.r:this.spot.refresh=new c.default(t),this.spot.refresh}getCustomRefreshInfo(t){if(this.demandResponse.c.ri)return{kv:this.demandResponse.c.ri.kv,do:this.demandResponse.c.ri.do,r:t,l:0,nd:!1}}setCustomRefresh(t){this.refreshManager=this.updateCustomRefresh(this.getCustomRefreshInfo(t))}onCustomRefreshRateReceived(t){var i;t>0?this.setCustomRefresh(t):null===(i=this.refreshManager)||void 0===i||i.stopRefreshing()}updateAnalytics(t){1===this.viewedImpressions&&n.default.get().increment(r.EventType.VIEWED_IMPRESSION),n.default.get().updateTimeInView(o.TimeInViewType.BROWSI,this.spot,this.refreshCount,this.viewedImpressions,t)}sendViewedEvent(t,i){u.InframeManager.get().isProviderInframe(this.spot)?a.default.get().As(this,t,i):a.default.get().Os(this,t,i,this.isForcedRefresh?"forced_refresh":void 0)}isRefreshable(t){return!!(null==t?void 0:t.active)&&t.isAllowedProviderForRefresh(this.spot,this.demandResponse)&&(!t.limit||t.count<=t.limit)}stopAdTracking(){this.isViewed=!1}canRefreshAd(t){return!!this.refreshManager&&this.refreshManager.canRefresh(t)}getRefreshRate(){var t;return(null===(t=this.refreshManager)||void 0===t?void 0:t.rate)||-1}_s(){this.stopAdTracking(),this.viewedImpressions=1,this.spot._s()}get refreshCount(){var t;return(null===(t=this.refreshManager)||void 0===t?void 0:t.lastSuccessfulRefresh)||0}generateInViewActionsMap(t){var i,e;const s=(null===(i=this.spot.refresh)||void 0===i?void 0:i.count)===(null===(e=this.spot.refresh)||void 0===e?void 0:e.lastSuccessfulRefresh);return this.spot.refresh&&!s||(Object.assign(t,this.addActionToMap(["analytics"],[1e3,2e3,3e3,4e3,5e3,6e3,7e3],t)),Object.assign(t,this.addActionToMap(["event"],[this.conf.duration],t)),d.Profiler.get().sendViewabilityCheckpoints&&!this.conf.shouldReportOneTime&&Object.assign(t,this.addActionToMap(["timeInView"],[2e3,5e3,1e4,15e3,2e4,25e3,3e4],t))),this.isRefreshable(this.refreshManager)&&this.getRefreshRate()>0&&!this.isCustomRefreshConfigured&&Object.assign(t,this.addActionToMap(["refresh"],[this.getRefreshRate()],t)),t}}i.SpotViewabilityObject=f},4151:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ViewabilityAdObject=void 0;const s=e(394);i.ViewabilityAdObject=class{constructor(t,i,e,n){this.inViewActionsMap={},this.ref=t.element,this.adIndex=t.adIndex,this.isViewed=!1,this.viewedImpressions=0,this.adUnit=t.adUnit||"NA",this.pageViewId=s.Profiler.get().pageViewID,this.isRefreshing=!1,this.logger=e,this.isByBrowsi=t.byBrowsi,this.conf=i,this.viewabilityInterval=null,this.metrics={startTime:null,viewed:!1,hiddenTime:0,outOfFocusTime:0},this.gamResponseInfo=n}getRefreshRate(){return-1}sendViewabilityReport(t,i,e,s){t/=1e3,this.viewedImpressions++,e&&this.sendViewedEvent(t,i),s&&this.updateAnalytics(t)}updateHiddenTime(t){t?this.metrics.hiddenTime=Date.now():this.isViewed&&(this.metrics.outOfFocusTime+=Date.now()-this.metrics.hiddenTime)}stopAdTracking(){this.isViewed=!1}isSticky(){return!1}addActionToMap(t,i,e){return i.forEach((i=>{e[i]=e[i]||[],e[i].push(...t)})),e}}},8234:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ViewabilityConfigurations=i.ViewabilityAdType=void 0;const s=e(4987);var n;!function(t){t[t.PUB_AD=0]="PUB_AD",t[t.V=1]="V"}(n=i.ViewabilityAdType||(i.ViewabilityAdType={}));i.ViewabilityConfigurations=class{static vConfig(t){return{minViewInitiator:50,duration:1e3,shouldReportOneTime:!!t,type:n.V}}static pubAdConfig(t){return{minViewInitiator:50,duration:1e3,shouldReportOneTime:s.default.zt(t),type:n.PUB_AD}}}},9497:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ViewabilityService=void 0;const s=e(1250),n=e(4059),r=e(9746),o=e(3627),h=e(8234),a=e(394),c=e(5068),l=e(4987),d=e(7527),u=e(7111);class v{constructor(){this.timeInViewMap={},this.logger=new s.default("Viewability"),this.profile=a.Profiler.get(),this.isHidden=!1,this.ads=[],n.default.instance.subscribe((t=>{this.isHidden=t,this.ads.forEach((i=>{i.updateHiddenTime(t)}))})),this.logger.info("Using the NEW intersection observer Viewability service")}static get instance(){return v._instance||(this._instance=new v),v._instance}getTimeInViewSummaryMap(){return this.retrieveTimeInViewSummaryMap(this.timeInViewMap)}retrieveTimeInViewSummaryMap(t){const i={};return Object.keys(t).forEach((e=>{i[e]={},Object.keys(t[e]).forEach((s=>{const n=t[e][s],r=n.reduce(((t,i)=>i.t>t?i.t:t),0),o=n.reduce(((t,i)=>t+i.p),0)/n.length;i[e][s]={mtiv:r,apiv:o}}))})),i}subscribe(t,i,e,s,n){const r=this.generateAdObject(t,i,e,s,n);let o;t.byBrowsi||(o=this.ads.findIndex((i=>i.placementId===t.placementId)),t.gs&&-1!=o&&this.ads.splice(o,1)),this.insert(r)}handleCustomRefreshResponse(t){const i=this.getViewabilityAdObject(t.id),e=t.rr,s=(null==i?void 0:i.conf.type)===h.ViewabilityAdType.PUB_AD?"publisher":"browsi";u.default.get().sendCustomRefreshRateEvent(s,e),i?(this.logger.verbose("get refresh rate returned",t,"matched to ad",i),i.onCustomRefreshRateReceived(e),e>0?this.observeCustomRefresh(i,e):this.logger.info("get refresh rate returned",t,"disabling refresh for this ad:",d.CUSTOM_REFRESH_RESPONSES_MAP[t.rr])):this.logger.info("get refresh rate returned",t,"didnt matched to exist ad")}getViewabilityAdObject(t){return this.ads.find((i=>i.ref.id===t))}initViewabilityCheck(t){const i=Object.keys(t.inViewActionsMap).map(Number);t.observer=new c.default(t.ref,t.conf.minViewInitiator/100,i,(i=>{const e=l.default.getElementPercentageInViewport(t.ref);this.onAdIsInView(t,i,e)})),t.observer.observe().then((()=>{t.refreshObserver||this.removeFromAdsArray(t)}))}observeCustomRefresh(t,i){t.refreshObserver=new c.default(t.ref,t.conf.minViewInitiator/100,[i],(i=>{this.handleRefresh(t,i)})),t.refreshObserver.observe().then((()=>{this.removeFromAdsArray(t)}))}onAdIsInView(t,i,e){const s=t.inViewActionsMap[i];this.logger.info(t.ref,` is in view for ${i} perform actions ${s}`),s.includes("refresh")&&this.handleRefresh(t,i);const n=s.includes("event"),r=s.includes("analytics");t.sendViewabilityReport(i,e,n,r),s.includes("timeInView")&&this.upadteTimeInViewMap(t,i,e)}upadteTimeInViewMap(t,i,e){const s={t:i/1e3,p:e},n=t.refreshCount||0,{adIndex:r}=t;this.timeInViewMap[r]=this.timeInViewMap[r]||{},this.timeInViewMap[r][n]=this.timeInViewMap[r][n]||[],this.timeInViewMap[r][n].push(s)}removeFromAdsArray(t){const i=this.ads.indexOf(t);i>-1&&this.ads.splice(i,1)}insert(t){this.ads.push(t),this.initViewabilityCheck(t)}handleRefresh(t,i){t.isByBrowsi&&(t.spot.waterfall=[]),t.canRefreshAd(i)&&(this.logger.info(`${t.isByBrowsi?"Spot":"Publisher ad"} #${t.adIndex} has been in view for ${i} ms. Starting to refresh`),t._s())}clearBeforeDcs(){this.clear()}clear(){this.ads.forEach((t=>{this.unObserveAd(t)})),this.ads=[]}generateAdObject(t,i,e,s,n){switch(i.type){case h.ViewabilityAdType.PUB_AD:return new o.PublisherAdViewabilityObject(t,i,this.logger,s,n);case h.ViewabilityAdType.V:return new r.SpotViewabilityObject(t,i,this.logger,e)}}unsubscribe(t){const i=this.ads.find((i=>{var e;return i.ref===t.ref||i.ref===t.browsiAd||i.ref===(null===(e=t.newBrowsiAd)||void 0===e?void 0:e.adContainer)}));i&&(this.unObserveAd(i),this.removeFromAdsArray(i))}unObserveAd(t){var i,e;null===(i=t.observer)||void 0===i||i.clearObserver(),null===(e=t.refreshObserver)||void 0===e||e.clearObserver()}}i.ViewabilityService=v},4107:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ApiSpot=void 0;const s=e(2094),n=e(6761),r=e(2593);class o extends s.DirectSpot{constructor(t,i,e){const s={positionTag:e.positionTag||"in",typeTag:"api",oldType:n.SpotType.API};super(t,500,s,i);const o=r.SpotsUtils.getConf(s);this.options=e,this.sizes=e.sizes||o&&o.allowedCreativeSizes||[],this.options.sizes=this.sizes,this.optimizeViewability=this.sn(o),this.isLazyLoading=r.SpotsUtils.shouldLazyLoad(this)}sn(t){var i,e,s;if(t){const n=t.viewabilityOptimizationBlocklist,r=n&&(!!(null===(i=this.options)||void 0===i?void 0:i.adUnit)&&n.includes(null===(e=this.options)||void 0===e?void 0:e.adUnit)||n.includes(this.ref.id));return!(null===(s=this.options)||void 0===s?void 0:s.disableViewabilityOptimization)&&!r}return!0}Wi(t){return this.rn(t)}hn(){"INSIDE"===this.targetElementPosition&&"none"===this.ref.style.display&&this.ref.style.removeProperty("display")}getQueryBaseElement(){var t;return(null===(t=this.options)||void 0===t?void 0:t.shadowElement)||document}}i.ApiSpot=o},2094:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DirectSpot=void 0;const s=e(5567);class n extends s.default{constructor(t,i,e,s,n){super(t,i,e,s,n)}}i.DirectSpot=n},7874:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DynamicSpot=void 0;const s=e(79),n=e(6761);class r extends s.ScannedSpot{constructor(t,i,e,s){super(t,{positionTag:"in",typeTag:"dy",oldType:n.SpotType.DYNAMIC},i,0,e,s)}Ni(t){var i;this.relocationPlid=t.ref.id,this.options=t.options,(null===(i=t.options)||void 0===i?void 0:i.sizes)&&(this.sizes=t.options.sizes),this.relocationStatus=2}}i.DynamicSpot=r},6457:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FixedSpot=void 0;const s=e(79),n=e(6761);class r extends s.ScannedSpot{constructor(t,i,e,s){const o={[n.SpotType.FIXED_IN_CONTENT]:{index:600,positionTag:"in"},[n.SpotType.FIXED_TOP]:{index:100,positionTag:"t"},[n.SpotType.FIXED_BOTTOM]:{index:200,positionTag:"b"}},h={positionTag:o[t.type].positionTag,typeTag:"fi",oldType:t.type};r.typeIndexSelectorMap[i]=r.typeIndexSelectorMap[i]||0,super(t.ref,h,t.typeIndex,o[t.type].index,e,s),this.demandIndex=r.typeIndexSelectorMap[i],r.typeIndexSelectorMap[i]++,this.selector=i}}i.FixedSpot=r,r.typeIndexSelectorMap={}},79:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ScannedSpot=void 0;const s=e(5567),n=e(4752);class r extends s.default{constructor(t,i,e,s,r,o){super(t,s,i,e,r,o),n.default.isLazySpotsEnabled()&&(this.isLazyLoading=n.default.getLazySpotsInstance().isLazy(this))}}i.ScannedSpot=r},5567:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AD_INDEX_LIMIT=void 0;const s=e(1332),n=e(7579),r=e(3802),o=e(1250),h=e(7111),a=e(9310),c=e(8473),l=e(1150),d=e(4987),u=e(394),v=e(2593),f=e(2951),p=e(4730),m=e(7709),g=e(4752),b=e(8540);i.AD_INDEX_LIMIT=99;i.default=class{constructor(t,e,n,r,h,a){this.convertedToEager=!1,this.isShadowDemand=!1,this.profile=u.Profiler.get(),this.logger=new o.default("Spot"),this.spotIndex=e+Math.min(i.AD_INDEX_LIMIT,r),this.demandIndex=Math.min(i.AD_INDEX_LIMIT,r),this.ref=t,this.pos="before",this.isDcs=!!(null==h?void 0:h.isDcs),this.Li=1,this.maxWidth=d.default.A().width,this.isLazyLoading=!1,this.isPopulatedWithAd=!1,this.positionType=l.AdPositionType.NA,"s"!==n.positionTag&&(this.positionType=s.default.instance.getAdPositionType(t)),this.adDistanceFromTop=d.default.B(t).y,this.adRequestBlockedSent=!1,this.spotRequested=0,this.isMeasurable=!1,this.disableDemand=!1,this.expectedViewabilityMapping={50:-99},this.isFluid=!1,this.type=v.SpotsUtils.convertTagsToType(n),this.typeIndex=r,this.optimizeViewability=!0,this.targetElementPosition=v.SpotsUtils.getTargetElementPosition(n),this.refresh=null,this.tags=n,this.sizes=this.an(),this.ln()&&(this.placeholder=new f.default),this.genericParams={},this.positionTagIndex=a}Xe(t){this.slot&&this.refresh&&(this.refresh.oldSlot=this.slot),this.slot=t}Ye(t){this.implementedSize=t,this.isFluid=this.dn(t)}dn(t){return 0===t.h&&0===t.w}an(){return v.SpotsUtils.getSizes(this.tags).filter((t=>!d.default.ti(t)))}Js(t){var i;this.browsiAd=t.adWrapper,this.isPopulatedWithAd=!0,this.newBrowsiAd=t,(null===(i=this.placeholder)||void 0===i?void 0:i.active)&&this.placeholder.openPlaceholder(this)}Xi(){this.newBrowsiAd&&(this.newBrowsiAd.adMarking&&(this.newBrowsiAd.adMarking.style.display="block"),this.newBrowsiAd.adWrapper&&(this.newBrowsiAd.adWrapper.style.display="block",s.default.instance.calculateMCSize(!0))),this.hn()}hn(){}_s(){var t,i,e;null===(t=this.placeholder)||void 0===t||t.deactivatePlaceholder(),this.providerName!==p.ProviderType.GENERIC_JS||(null===(i=this.genericParams)||void 0===i?void 0:i.refresh)?(null===(e=this.refresh)||void 0===e||e.start(this,!1),r.YieldClient.get().We([this],n.DemandRequestType.SINGLE)):this.logger.verbose("Custom in view refresh failed. no refresh function supplied by template")}Ke(){this.refresh&&(this.refresh.isRefreshing=!1),this.isMeasurable=!1}qi(){var t;null===(t=this.refresh)||void 0===t||t.handleFailed(this)}isRefreshing(){var t;return!!(null===(t=this.refresh)||void 0===t?void 0:t.isRefreshing)}get refreshCount(){var t;return(null===(t=this.refresh)||void 0===t?void 0:t.count)||0}zi(t){if(t.od&&t.od[50]&&t.od[50].p){const i=Number(t.od[50].p);this.expectedViewabilityMapping[50]=Number(i<0?i:i.toFixed(3))}}handlePreFetchAsyncReject(t){const i=[{reason:"pre_fetch_async",message:t}];this.Bi(i)}Bi(t){var i;if(!this.adRequestBlockedSent){const e=t.map((t=>t.reason.toString())).join(","),s=t.map((t=>t.message)).join(",");this.logger.info(`blocking spot ${this.spotIndex}`),this.logger.table(t),h.default.get().sendAdRequestBlockedEvent(this,e,s),e.includes("out_of_focus")&&(c.default.get().increment(a.EventType.AD_REQUEST_BLOCKED),this.logger.info("collect oof")),this.adRequestBlockedSent=!0,this.disableDemand=this.un(t),this.disableDemand&&(null===(i=this.placeholder)||void 0===i||i.closePlaceholder(this))}}un(t){return!!t.find((t=>!["lazy_ad_missed","out_of_focus","spot_not_exists","CLS"].includes(t.reason)))}ie(t){return{element:this.newBrowsiAd.isIframe?this.newBrowsiAd.iframe:this.newBrowsiAd.adContainer,spot:this,byBrowsi:!0,adIndex:this.spotIndex,adUnit:t.adUnit,gs:!1,en:this.expectedViewabilityMapping[50],forcedRefresh:t.forcedRefresh}}Wi(t){return this.options?this.rn(t):t}rn(t){const i=this.options,e=t.c.d||t.c,s=t.c,n=this.Li>1;return void 0!==i.refresh&&s.ri&&(i.refresh.active?i.refresh.refreshSecond&&(s.ri.r=1e3*i.refresh.refreshSecond):s.ri.r=-1),n?this.sizes=this.an():(i.adUnit&&"demo-placement"!==t.plk&&(e.aup=i.adUnit),i.keyValues&&(t.setTargeting=t.setTargeting?t.setTargeting.concat(i.keyValues):i.keyValues)),t}ln(){var t;return this.profile.placeholder&&!!this.sizes.length&&(this.sizes.length>1||!this.vn(this.sizes[0]))&&!(null===(t=this.refresh)||void 0===t?void 0:t.isRefreshing)}setPlaceholderSize(t){var i;if(null===(i=this.placeholder)||void 0===i?void 0:i.active){let i;const e=this.tn(t),s=g.default.getExternalFlowHandler("changePlaceholderSize");if(s){i=s(Object.assign({},this),Object.assign({},e));!!i.w&&!!i.h||this.placeholder.deactivatePlaceholder()}this.placeholder.setSize(i||e)}}fn(t){let i=0,e=0;return t.forEach((t=>{t.w>i&&(i=t.w),t.h>e&&(e=t.h)})),{w:i,h:e}}tn(t){const i=this.fn(t);return d.default.Zt(i)||this.vn(i)?{w:d.default.A().width,h:250}:{w:i.w,h:Math.min(i.h,250)}}vn(t){return 1===t.w&&1===t.h}isEagerFirstFold(){return this.profile.eagerFirstFold&&d.default.tt(this)<=1}destoryDFPSlot(t){var i,e;const s=t||this.newBrowsiAd;this.slot&&s&&(null===(e=null===(i=s.win)||void 0===i?void 0:i.googletag)||void 0===e||e.destroySlots([this.slot]),delete this.slot)}Hi(){var t;(null===(t=this.placeholder)||void 0===t?void 0:t.active)?this.placeholder.closePlaceholder(this):m.Embedder.bs(this)}getQueryBaseElement(){return document}initCustomRefreshRate(){var t,i,e,s;let r=Object.assign({},(null===(t=this.newBrowsiAd)||void 0===t?void 0:t.adContainer.id)?{id:this.newBrowsiAd.adContainer.id}:{});if(this.providerName===p.ProviderType.GENERIC_JS)Object.assign(r,Object.assign(Object.assign(Object.assign({},this.genericParams.adUnit?{au:this.genericParams.adUnit}:{}),(null===(i=this.genericParams.gamInfo)||void 0===i?void 0:i.lid)?{lid:this.genericParams.gamInfo.lid}:{}),(null===(e=this.genericParams.gamInfo)||void 0===e?void 0:e.oid)?{oid:this.genericParams.gamInfo.oid}:{}));else{const t=d.default.getGAMResponseInfo(this.slot);Object.assign(r,Object.assign(Object.assign(Object.assign({},(null===(s=this.slot)||void 0===s?void 0:s.getAdUnitPath())?{au:this.slot.getAdUnitPath()}:{}),(null==t?void 0:t.lid)?{lid:t.lid}:{}),(null==t?void 0:t.oid)?{oid:t.oid}:{}))}b.CustomRefreshRate.get().sendCustomRefreshRate(n.DemandRequestType.SINGLE,[r])}}},3813:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(4987),r=e(7111),o=e(1332),h=e(9714),a=e(8221),c=e(5966),l=e(6981),d=e(7004),u=e(8807),v=e(6761),f=e(9207),p=e(4492),m=e(584),g=e(9698),b=e(394),w=e(8406),_=e(8803),y=e(3802),S=e(9839),O=e(2593),A=e(6457),j=e(7874),E=e(132),P=e(9840),T=e(9310),I=e(2375);class M{constructor(t){this.fixedFirstSpots=[],this.logger=new s.default("SpotEngine"),this.invalidInspectives=[],this.profile=b.Profiler.get();const i=(this.profile.scanningTags||[]).map((t=>t.toUpperCase())),e=I.TAGS_TO_SCAN.map((t=>t.toUpperCase()));this.tagsToScan=Array.from(new Set([...e,...i])),this.tagsToAvoid=["NAV","A","LI","HEADER","TABLE","P"].filter((t=>this.profile.scanningTags&&!this.profile.scanningTags.includes(t)&&!this.profile.scanningTags.includes(t.toLowerCase()))),this.type=t||f.SpotEngineType.STANDARD,this.isSpotEngineDone=!1,this.externalTargetElements=null,this.isDcs=!1,this.spotsFound=[],this.currentSpotTags={typeTag:"dy",positionTag:"in"},this.externalScanConfig={}}static get(t){return M.instance||(this.instance=new M(t)),t&&(this.instance.type=t),M.instance}setTargetElements(t){this.externalTargetElements=t}setExternalScanConfig(t){this.externalScanConfig=Object.assign(this.externalScanConfig,t)}runSecondTimeForBelowReadMore(){this.invalidInspectives=[];const t=w.default.getSpots().slice();this.spotsFound.length||(this.spotsFound=t.slice()),this.collectDynamicAndFixed();const i=this.spotsFound.slice(t.length);this.handleSpotsFound(i);const e=w.default.getSpots().slice(t.length);return this.profile.analysisMode||y.YieldClient.get().He(e),{firstRunSpots:t,secRunSpots:e}}startSpotEngine(t){const i=this.getTargetElements();this.resetDefaultValues(),this.isDcs=!!(null==t?void 0:t.isDcs)||!!this.profile.dcsState,this.runExternalProcesses(),this.run(i,t)}getTargetElements(){return this.externalTargetElements&&this.externalTargetElements.length?this.externalTargetElements:this.type===f.SpotEngineType.BROWSI_SPOTS?[]:this.profile.targetElements&&this.profile.targetElements.length>0?n.default.Mi(this.profile.targetElements):[document.body]}runExternalProcesses(){m.default.initializeSkippedElements(),o.default.instance.findMainContent(h.default.get().foundAds,a.default.get().findCR(),c.default.get().getAllCommentSections(),l.default.get().getAllSocialElements()),P.default.get().scanDomForSA(),h.default.get().scan(!0)}resetDefaultValues(){this.externalTargetElements=null,this.isSpotEngineDone=!1,this.invalidInspectives=[],this.isDcs=!1,this.spotsFound=[]}run(t,i){if(this.logger.info(`Running on mode: ${this.type}`),this.buildStickySpot(),this.type===f.SpotEngineType.BROWSI_SPOTS)this.runForBrowsiSpots(t);else if(this.type===f.SpotEngineType.SLIDES_ALL){const e=i&&i.slides;this.collectDynamicAndFixed(t,e);const s=e||[];for(let t=1;t<s.length;t++)this.logger.info("found",s[t].spots.length,"spots on slide number ",t+1,":",s[t]);this.handleSpotsFound(this.spotsFound)}else this.collectDynamicAndFixed(t),this.handleSpotsFound(this.spotsFound)}collectDynamicAndFixed(t,i){this.profile.fixedSpotsFirst||this.collectFixedSpots(t,i),this.currentSpotTags={typeTag:"dy",positionTag:"in"},this.collect(!1,t,i),this.reportUxRulesInvalidations()}collectFixedSpots(t,i){O.FIXED_TAGS.forEach((e=>{O.SpotsUtils.getConf(e)&&(this.currentSpotTags=e,this.collect(!0,t,i))}))}scanFixedSpotsFirst(){this.logger.info("scan fixed spots first"),this.collectFixedSpots(),this.handleSpotsFound(this.spotsFound),this.fixedFirstSpots=this.spotsFound,this.reportInvalidInspectives(),this.profile.analysisMode||y.YieldClient.get().He(w.default.getSpots())}BuildSelectorXpath(){let t="(";if("dy"===this.currentSpotTags.typeTag)this.tagsToScan.forEach((i=>{t+=".//"+i+"|"}));else if("fi"===this.currentSpotTags.typeTag){const i=O.SpotsUtils.getConf(this.currentSpotTags);i&&(this.updateFixedElementsBySelector(i.targetElements||[],i),(i.targetElements||[]).forEach((i=>{t+=n.default.ki(i)+"|"})))}return t=t.substring(0,t.length-1),t+=")[not(",this.tagsToAvoid.forEach((i=>{t+="ancestor::"+i+"|"})),t=t.substring(0,t.length-1),t+=")]",t}collect(t,i,e,s){function h(i){return t}s&&P.default.get().scanDomForSA(!0);let a=this.getSpotFoundByTags(this.currentSpotTags).length;this.logger.verbose("scanning tags: ",this.tagsToScan);let c,l=!1;i=i||[document.body];const d=this.getAllPossibleElements(i,t),u=O.SpotsUtils.getConf(s?{typeTag:"api",positionTag:"in"}:this.currentSpotTags);if(!u)return;t&&(u.maxItems=d.length),s&&(this.logger.info("scanning DCS API spots"),this.currentSpotTags={typeTag:"dy",positionTag:"in"});const f=m.default.getStartPosition();this.logger.verbose("all possible elements:",d);let p=[];const b=s||this.enforceValidations();for(let i=0;i<d.length;i++){const w=d[i];if(e&&(c=e.find((t=>n.default.isPositionContained(t.element,w))),!c))continue;l=!(c&&e&&e.length)||c.element===e[0].element;const _=c&&!l;if(!s&&m.default.isMaxSpotsReached(_,c,t)){if(e)continue;break}if(h()&&m.default.isPositionInsideAndNotEmpty(u,w))this.reportInvalidInspective(w,"position inside & not empty"),r.default.get().sendErrorEvent(T.EventType.CONFIGURATION_ERROR,"","fixed spot rejected - positioned inside of non empty element");else{if(b){const i=this.getDistanceFromTop(w);if(i<f){this.reportInvalidInspective(w,"before starting fold");continue}if(this.externalScanConfig.forceStartPosition&&i<this.externalScanConfig.forceStartPosition){this.reportInvalidInspective(w,"before read more");continue}if(this.externalScanConfig.forceEndPosition&&i>this.externalScanConfig.forceEndPosition){this.reportInvalidInspective(w,"after read more");break}const e=m.default.getStopPosition();if(e&&i>e){this.reportInvalidInspective(w,"after stopping fold");break}if(!t&&o.default.instance.shouldLookInMCOnly()&&!o.default.instance.withinMainContent(w)&&!o.default.instance.isNextVisibleElement(w)){if(this.reportInvalidInspective(w,"out of main content"),o.default.instance.isBelowMC(w))break;continue}if(m.default.isOutOfViewport(w)){this.reportInvalidInspective(w,"out of viewport");continue}if(!t&&!n.default.Et(w)){this.reportInvalidInspective(w,"not visible");continue}if(!t&&n.default.isFixed(w).status){this.reportInvalidInspective(w,"fixed");continue}if(!t&&this.profile.pageLayoutSA){if(g.default.get().isBetweenTitleAndContent(w)){this.reportInvalidInspective(w,"between title and content");continue}if(g.default.get().isAfterOneLiner(w)){this.reportInvalidInspective(w,"after one line");continue}}if(!t&&!m.default.hasValidWidth(w)){this.reportInvalidInspective(w,"too narrow");continue}if(t&&"INSIDE"===O.SpotsUtils.getTargetElementPosition(this.currentSpotTags)){const t=m.default.getSkippedElementsContainers();if(t&&t.includes(w)){this.reportInvalidInspective(w,"skipped");continue}}if(m.default.isCloseToSpot(w,_,t)){this.reportInvalidInspective(w,"too close to spot");continue}}if(s||!h()||u.enforceUxRules){if(m.default.isInSkippedElements(w)){this.reportInvalidInspective(w,"skipped");continue}if(m.default.shouldSA(w,t)){this.reportInvalidInspective(w,"stay away");continue}}s?p.push({ref:w,typeIndex:0,type:v.SpotType.DYNAMIC}):_?this.saveBrowsiSpot(w,c):(this.saveSpot(w,a),a++)}}if(s)return this.reportInvalidInspectives("DCS API -"),p.map((t=>t.ref));const w=O.SpotsUtils.convertTagsToType(this.currentSpotTags);this.logger.style("%cTotal "+w+" Spots: "+this.getSpotFoundByTags(this.currentSpotTags).length+" / "+m.default.getMaxSpots(t),"font-size:18px; font-weight:bold;"),this.logger.style("%cMax "+w+" Items: "+m.default.getMaxItems(),"font-size:14px; font-weight:bold;"),"dy"===this.currentSpotTags.typeTag&&(this.reportInvalidInspectives(),this.invalidInspectives=[])}reportUxRulesInvalidations(){if(this.profile.reportUxRulesInvalidations){const t=P.default.get().getStayAwayInvalidations(),i=m.default.getSkippedInvalidations(),e=r.default.get();e.sendStayAway(t),e.sendSkipped(i)}}reportInvalidInspectives(t){this.logger.info(`${t||""} invalid  inspectives before start in fold: `,this.invalidInspectives.filter((t=>"before starting fold"==t.reason))),this.logger.info(`${t||""} invalid  inspectives: `,this.invalidInspectives.filter((t=>"before starting fold"!=t.reason)))}enforceValidations(){return!m.default.isFixedSpot(this.currentSpotTags)||!this.profile.fixedSpotsFirst}getAllPossibleElements(t,i){let e=[];return t.forEach((t=>{const s=m.default.getRootElement(t,i),r=n.default.Mi([this.BuildSelectorXpath()],t);e=e.concat(s,r)})),e}reportInvalidInspective(t,i){this.invalidInspectives.push({inspective:t,reason:i,type:O.SpotsUtils.convertTagsToType(this.currentSpotTags)})}saveSpot(t,i){this.spotsFound.push({ref:t,type:O.SpotsUtils.convertTagsToType(this.currentSpotTags),typeIndex:i})}handleSpotsFound(t){t.sort((function(t,i){return 2&t.ref.compareDocumentPosition(i.ref)?1:-1}));let i=0,e=0;t.forEach((t=>{t.positionTag=O.SPOT_TAGS_MAP[t.type].positionTag,"in"===t.positionTag?(t.positionTagIndex=i,i++):"b"===t.positionTag&&(t.positionTagIndex=e,e++),this.createSpot(t)})),w.default.getSpots().forEach((t=>this.logger.verbose("spot found ",t.ref,t)))}saveBrowsiSpot(t,i){const e=document.createElement(p.CustomTagType.BROWSI_SPOT);e.setAttribute("browsiType",O.SpotsUtils.convertTagsToType(this.currentSpotTags)),"fi"===this.currentSpotTags.typeTag&&e.setAttribute("browsiSelector",this.getSelectorByElement(t)),t.parentElement.insertBefore(e,t),i.spots.push(e)}onStopEngine(){this.isSpotEngineDone||(this.logger.info("onStopEngine"),this.isSpotEngineDone=!0,d.default.instance.recalculateAdsPositionType(),this.profile.debug&&u.Output.setBrowsiOutput("spot_engine_done"))}getDistanceFromTop(t){return n.default.B(t).y}runForBrowsiSpots(t){const i=w.default.getSpots();t.forEach((t=>{let e=t.getAttribute("browsiType"),s={ref:t,type:e,typeIndex:i.filter((t=>t.type==e)).length};this.createSpot(s,t.getAttribute("browsiSelector")||void 0),this.logger.info("Found browsi spot: ",t)})),this.logger.style("%cTotal fixed Spots: "+i.filter((t=>"fi"===t.tags.typeTag)).length,"font-size:18px; font-weight:bold;"),this.logger.style("%cTotal dynamic Spots: "+i.filter((t=>t.type==v.SpotType.DYNAMIC)).length,"font-size:18px; font-weight:bold;"),this.logger.style("%cMax dynamic Items: "+m.default.getMaxItems({typeTag:"dy",positionTag:"in"}),"font-size:14px; font-weight:bold;")}getInvalidInspectives(){return this.invalidInspectives}buildStickySpot(){var t,i,e;const s=O.SpotsUtils.getConf({typeTag:"st",positionTag:"s"});if(!s)return;const n=S.default.getWindowObject(),r=null===(e=null===(i=null===(t=this.profile.dcsState)||void 0===t?void 0:t.prevPvSpots)||void 0===i?void 0:i.s)||void 0===e?void 0:e[0],o=this.isDcs&&((null==n?void 0:n[_.StickyConstants.dcsVar])||r);if(this.isDcs&&!o)return;if(!o&&this.isStickyApiIdsConfigured())return void this.logger.info("Sticky spot in invalid because Sticky Api spot is already defined ");if(!o&&m.default.isPubStickyOnPage())return void this.logger.info("Sticky spot in invalid because of publisher sticky ad");const h=new E.StickySpot(s.location,o);return w.default.reportSpot(h),h}createSpot(t,i){const e={isDcs:this.isDcs};let s;switch(t.type){case v.SpotType.FIXED_IN_CONTENT:case v.SpotType.FIXED_TOP:case v.SpotType.FIXED_BOTTOM:s=new A.FixedSpot(t,i||this.getSelectorByElement(t.ref),e,t.positionTagIndex);break;default:s=new j.DynamicSpot(t.ref,t.typeIndex,e,t.positionTagIndex)}return w.default.reportSpot(s),s}getSpotFoundByTags(t){return this.spotsFound.filter((i=>i.type==O.SpotsUtils.convertTagsToType(t)))}isStickyApiIdsConfigured(){const t=O.SpotsUtils.getConf({typeTag:"api",positionTag:"s"});return!(!t||!t.positionIds)}modifyTargetElementsForBelowPosition(t,i){const e=(t.targetElements||[]).indexOf(i),s=`//${p.CustomTagType.BROWSI_SPOT_FIXED_BELOW}[@class='${this.currentSpotTags.typeTag}${this.currentSpotTags.positionTag}']`;(t.targetElements||[])[e]=s}createReferenceElementsForBelowPosition(t){return t.map((t=>{const i=document.createElement(p.CustomTagType.BROWSI_SPOT_FIXED_BELOW);return i.classList.add(this.currentSpotTags.typeTag+this.currentSpotTags.positionTag),i.style.width=(t.getBoundingClientRect().width||0)+"px",i.style.display="block",t.insertAdjacentElement("afterend",i),i}))}modifyFixedElementsBelowPosition(t,i,e){return"BELOW"!==t.targetElementPosition?e:(this.modifyTargetElementsForBelowPosition(t,i),this.createReferenceElementsForBelowPosition(e))}updateFixedElementsBySelector(t,i){this.fixedSelectorsToElementsMap=this.fixedSelectorsToElementsMap||{},t.forEach((t=>{this.fixedSelectorsToElementsMap[t]=this.modifyFixedElementsBelowPosition(i,t,n.default.Mi([t]))}))}getSelectorByElement(t){for(let i in this.fixedSelectorsToElementsMap){if(this.fixedSelectorsToElementsMap[i].some((i=>i===t)))return i}return""}}i.default=M},584:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4987),n=e(3813),r=e(4492),o=e(9840),h=e(394),a=e(9714),c=e(1150),l=e(2593),d=e(238);class u{static get browsiAdsMinDistance(){var t;return this._browsiAdsMinDistance||(this._browsiAdsMinDistance=(null===(t=l.SpotsUtils.getConf({typeTag:"dy",positionTag:"in"}))||void 0===t?void 0:t.distance)||400),this._browsiAdsMinDistance}static get profile(){return this._profile||(this._profile=h.Profiler.get()),this._profile}static isMaxSpotsReached(t,i,e){const s=u.getMaxSpots(e);return t?i.spots.filter((t=>t.getAttribute("browsiType")==l.SpotsUtils.convertTagsToType(n.default.get().currentSpotTags))).length>=s:u.getCurrentTypeSpots().length>=s}static getMaxSpots(t){return t?l.SpotsUtils.getFixedMaxItems(n.default.get().currentSpotTags):this.getDynamicMaxSpots()}static getDynamicMaxSpots(){var t,i;let e=this.getMaxItems({typeTag:"dy",positionTag:"in"})+d.DemandTool.get().relocateSpots.length;const s=null===(i=null===(t=this.profile.spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.potentialSpots;return s?Math.max(s,e):e}static getMaxItems(t){const i=t||n.default.get().currentSpotTags;return"fi"===i.typeTag?l.SpotsUtils.getFixedMaxItems(i):l.SpotsUtils.getDynamicMaxItems()}static getFixedTotalMaxItems(){return l.FIXED_TAGS.map((t=>{const i=l.SpotsUtils.getConf(t);return i?i.maxItems:0})).reduce(((t,i)=>-1===t||-1===i?-1:t+i),0)}static getCurrentTypeSpots(){return n.default.get().spotsFound.filter((t=>t.type==l.SpotsUtils.convertTagsToType(n.default.get().currentSpotTags)))}static getSpotsByType(t){return[...n.default.get().spotsFound,...n.default.get().fixedFirstSpots].filter((i=>i.type==t))}static isFixedSpot(t){return"fi"===t.typeTag}static isCloseToSpot(t,i,e,r){if(e)return!1;if(i)return u.isCloseToPreviousBrowsiSpot(t);let o=[...n.default.get().spotsFound,...n.default.get().fixedFirstSpots,...r||[]];o.sort(((t,i)=>2&t.ref.compareDocumentPosition(i.ref)?1:-1));for(let i=0;i<o.length;i++){const e=o[i].ref;if(!s.default.isFixed(e).status&&Math.abs(this.getDistanceBetweenElementAndSpot(t,o[i]))<this.browsiAdsMinDistance)return!0}return!1}static getDistanceBetweenElementAndFixedSpot(t,i){const e=l.SpotsUtils.getConf(l.SPOT_TAGS_MAP[i.type]);let n=Math.abs(this.getDistanceFromTop(t)-this.getDistanceFromTop(i.ref));return"INSIDE"===e.targetElementPosition&&s.default.isPositionedBefore(i.ref,t)&&(n-=s.default.G(i.ref).h),n}static getDistanceBetweenElementAndSpot(t,i){return this.isFixedSpot(l.SPOT_TAGS_MAP[i.type])?this.getDistanceBetweenElementAndFixedSpot(t,i):this.getDistanceFromTop(t)-this.getDistanceFromTop(i.ref)}static isCloseToPreviousBrowsiSpot(t){const i=document.getElementsByTagName(r.CustomTagType.BROWSI_SPOT),e=i[i.length-1];return!!e&&this.getDistanceFromTop(t)-this.getDistanceFromTop(e)<this.browsiAdsMinDistance}static getDistanceFromTop(t){return s.default.B(t).y}static getStartPosition(){const t=l.SpotsUtils.getConf(n.default.get().currentSpotTags);if(!t)return 0;if(t.startInFoldSelectors){let i=s.default.Mi(t.startInFoldSelectors)[0];if(i)return s.default.B(i).y+20}if(t.startInFold){return s.default.Ti().viewPortHeight*(t.startInFold-1)}return 0}static getStopPosition(){const t=l.SpotsUtils.getConf(n.default.get().currentSpotTags);if(!t||"number"!=typeof t.stopInFold||"number"!=typeof t.startInFold)return!1;const i=s.default.Ti();if(t.stopInFold>=0)return i.viewPortHeight*t.stopInFold;{const e=t.startInFold-t.stopInFold;return i.numberOfFolds>e+1&&i.docHeight+i.viewPortHeight*t.stopInFold}}static initializeSkippedElements(){const t=this.profile.uxRules.skipped.xpath.flatMap((t=>s.default.Mi([t]).map((i=>({selector:t,element:i}))))),i=this.profile.uxRules.skipped.css.flatMap((t=>Array.from(document.querySelectorAll(t)).map((i=>({selector:t,element:i}))))),e=o.default.get();this.skippedObjs=t.concat(i).filter((t=>e.isValidHeightForSkipSa(t.element)))}static getSkippedElementsContainers(){return this.skippedObjs.map((t=>t.element))}static isOutOfViewport(t){const i=s.default.B(t);return i.x>=s.default.A().width||i.y+t.clientHeight<0||i.x+t.clientWidth<0}static shouldSA(t,i){const e=o.default.get();return e.isInStayAwayElements(t,i)||e.isToStayAway(t,i)}static isInSkippedElements(t){if(this.skippedObjs.length)for(let i=0;i<this.skippedObjs.length;i++)if(s.default.isPositionContained(this.skippedObjs[i].element,t))return this.updateSkippedInvalidations(this.profile.reportUxRulesInvalidations,this.skippedObjs[i]),!0;return!1}static updateSkippedInvalidations(t,i){if(!t)return;const e=this.skippedInvalidations.find((t=>t.s===i.selector));e?e.c++:this.skippedInvalidations.push({s:i.selector,c:1})}static getSkippedInvalidations(){return this.skippedInvalidations}static hasValidWidth(t){const i=this.minContainerWidth,e=s.default.yt(t).w;if(e&&e>=i)return!0;const n=t.parentNode;if(n&&s.default.O(t.parentNode)){const t=s.default.yt(n).w;return!!(t&&t>=i)}return!1}static getRootElement(t,i){return i||"BODY"==t.nodeName?[]:[t]}static isPubStickyOnPage(){return a.default.get().foundAds.some((t=>t.positionType===c.AdPositionType.STICKY_TOP||t.positionType===c.AdPositionType.STICKY_BOTTOM))}static isPositionInsideAndNotEmpty(t,i){if("INSIDE"===t.targetElementPosition){return Array.from(i.childNodes).filter((t=>this.isExpandableElement(t))).length>0}return!1}static isExpandableElement(t){return s.default.O(t)&&!(t instanceof HTMLScriptElement)}}i.default=u,u.skippedObjs=[],u.minContainerWidth=250,u.skippedInvalidations=[]},8406:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1250),n=e(6761),r=e(8803),o=e(7709),h=e(2593),a=e(9839),c=e(7111);class l{static get logger(){return this._logger||(this._logger=new s.default("Spots")),this._logger}static getSpots(){return this.spots}static addSpot(t){return this.spots.push(t),this.spots}static reportSpot(t){l.addSpot(t),c.default.get().sendSpotFoundEvent(t),l.logger.info("spot found",t.ref)}static getNonStickySpots(){return this.spots.filter((t=>t.type!==n.SpotType.STICKY&&"s"!==t.tags.positionTag))}static getNonStickyOrApiSpots(){return this.spots.filter((t=>t.type!==n.SpotType.STICKY&&t.type!==n.SpotType.API))}static getSpotsByType(t){return this.spots.filter((i=>t.includes(i.type)))}static getStickySpot(){return this.spots.find(this.isSticky)||null}static isSticky(t){return t.type===n.SpotType.STICKY}static getEmbeddedSpots(){return l.getSpots().filter((t=>t.isPopulatedWithAd))}static getEmbeddedSerializedSpots(){return l.getEmbeddedSpots().map((t=>l.serialize(t)))}static getStickySerializedSpots(){const t=l.getStickySpot();return t?l.stickySerialize(t):null}static getLazyLoadSpots(){return this.getSpots().filter((t=>t.isLazyLoading))}static serialize(t){return{spotIndex:t.spotIndex,maxWidth:t.maxWidth,adDistanceFromTop:t.adDistanceFromTop,pos:t.pos,isLazyLoading:t.isLazyLoading,newBrowsiAd:t.newBrowsiAd,browsiAd:t.browsiAd,type:t.type,typeIndex:t.typeIndex,ref:t.ref,selector:t.selector}}static stickySerialize(t){return{maxWidth:t.maxWidth,newBrowsiAd:t.newBrowsiAd,browsiAd:t.browsiAd,implementedSize:t.implementedSize,slot:t.slot,attemptIndex:t.Li,refresh:t.refresh}}static removeStickyAd(t){var i,e;if("s"!==t.tags.positionTag)return;o.Embedder.bs(t),t.newBrowsiAd&&t.slot&&(null===(e=null===(i=t.newBrowsiAd.win)||void 0===i?void 0:i.googletag)||void 0===e||e.destroySlots([t.slot])),a.default.removeStickyVar(this.logger);const s=window.document.body.style,n=h.SpotsUtils.getConf(t.tags);(null==n?void 0:n.location)===r.Location.TOP?s.paddingTop="":s.paddingBottom=""}}i.default=l,l.spots=[]},132:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.StickySpot=void 0;const s=e(2094),n=e(6761),r=e(8803),o=e(1150),h=e(3802),a=e(4987),c=e(7579),l=e(4730);class d extends s.DirectSpot{constructor(t,i){const e=i?{isDcs:!0}:void 0,s={positionTag:"s",typeTag:"st",oldType:n.SpotType.STICKY};super(window.document.body,0,s,-1,e),this.positionType=t==r.Location.BOTTOM?o.AdPositionType.STICKY_BOTTOM:o.AdPositionType.STICKY_TOP,i?this.handleSpotFromPreviousPageView(this,i):h.YieldClient.get().We([this],c.DemandRequestType.SINGLE)}handleSpotFromPreviousPageView(t,i){Object.assign(t,i),this.refreshStickySpotOnNewPv()}refreshStickySpotOnNewPv(){var t;this.providerName!==l.ProviderType.GENERIC_JS&&(null===(t=this.refresh)||void 0===t||t.start(this,!0),h.YieldClient.get().We([this],c.DemandRequestType.SINGLE))}tn(){const t=this.fn(this.sizes);return a.default.Zt(t)||this.vn(t)?{w:a.default.A().width,h:250}:t}}i.StickySpot=d},2375:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TAGS_TO_SCAN=void 0,i.TAGS_TO_SCAN=["BR","DIV","TABLE","TBODY","FORM","SECTION","ARTICLE","SPAN","HEADER","P","MAIN","UL","OL","LI","FIGURE"]},7797:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.StayAwayType=void 0,function(t){t.BOTH="both",t.ABOVE="above",t.BELOW="below"}(i.StayAwayType||(i.StayAwayType={}))},844:()=>{var t,i,e,s;String.prototype.endsWith||(String.prototype.endsWith=function(t,i){var e=this.toString();("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>e.length)&&(i=e.length),i-=t.length;var s=e.lastIndexOf(t,i);return-1!==s&&s===i}),String.prototype.startsWith||(String.prototype.startsWith=function(t,i){return this.substr(i||0,t.length)===t}),Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(null==this)throw new TypeError;var i=Object(this),e=i.length>>>0;if("function"!=typeof t)throw new TypeError;for(var s=[],n=arguments.length>=2?arguments[1]:void 0,r=0;r<e;r++)if(r in i){var o=i[r];t.call(n,o,r,i)&&s.push(o)}return s}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),e=i.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var s=arguments[1],n=0;n<e;){var r=i[n];if(t.call(s,r,n,i))return r;n++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},writable:!0,configurable:!0}),Array.from||(Array.from=(t=Object.prototype.toString,i=function(i){return"function"==typeof i||"[object Function]"===t.call(i)},e=Math.pow(2,53)-1,s=function(t){var i=function(t){var i=Number(t);return isNaN(i)?0:0!==i&&isFinite(i)?(i>0?1:-1)*Math.floor(Math.abs(i)):i}(t);return Math.min(Math.max(i,0),e)},function(t){var e=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,r=arguments.length>1?arguments[1]:void 0;if(void 0!==r){if(!i(r))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(n=arguments[2])}for(var o,h=s(e.length),a=i(this)?Object(new this(h)):new Array(h),c=0;c<h;)o=e[c],a[c]=r?void 0===n?r(o,c):r.call(n,o,c):o,c+=1;return a.length=h,a})),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(t){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var i,e=Object(this),s=e.length>>>0,n=0;if(arguments.length>=2)i=arguments[1];else{for(;n<s&&!(n in e);)n++;if(n>=s)throw new TypeError("Reduce of empty array with no initial value");i=e[n++]}for(;n<s;)n in e&&(i=t(i,e[n],n,e)),n++;return i}}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;for(var i=Object(this),e=i.length>>>0,s=arguments.length>=2?arguments[1]:void 0,n=0;n<e;n++)if(n in i&&t.call(s,i[n],n,i))return!0;return!1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,i){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),s=e.length>>>0;if(0===s)return!1;var n,r,o=0|i,h=Math.max(o>=0?o:s-Math.abs(o),0);for(;h<s;){if((n=e[h])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;h++}return!1}})}},i={};function e(s){var n=i[s];if(void 0!==n)return n.exports;var r=i[s]={exports:{}};return t[s].call(r.exports,r,r.exports,e),r.exports}(()=>{"use strict";const t=e(7004),i=e(1580),s=e(8542),n=e(7111),r=e(4987),o=e(7328),h=e(8807),a=e(1250),c=e(8473),l=e(3813);e(844);const d=e(4351),u=e(394),v=e(7815),f=e(238),p=e(4752),m=e(9839),g=e(1807),b=e(3301),w=e(1078),_=e(9486),y=e(4059),S=e(9166),O=e(3810),A=e(9714);class j{constructor(){this.profile=u.Profiler.get(),this.logger=new a.default("App.ts")}pn(){if(r.default.W()>0||m.default.isSlidesTriggered())n.default.get().sendUserEngagedEvent(),c.default.get().startMeasurements();else{const t=()=>{this.logger.info("detected engagementScroll, send event"),r.default.Ei().removeEventListener("scroll",t),n.default.get().sendUserEngagedEvent(),c.default.get().startMeasurements()};o.default.get().listen("scroll",r.default.Ei(),t)}}mn(){window._middyo.state===d.MiddyState.LOADED&&(window._middyo.state=d.MiddyState.STARTED,this.profile.runMode===g.RunMode.BLOCKLIST?this.gn():this.bn())}gn(){this.logger.style("%cBlocklisted mode","font-size:48px; color:red; background:black;"),this.pn(),s.default.sendPageViewReport([],this.profile,!1,!1)}bn(){var i;this.wn();const e=new S.default((null===(i=this.profile.prebidData)||void 0===i?void 0:i.globalInstanceName)||"pbjs",window);if(o.default.get().addExternalListenerRemoveFunction(e.removeListeners.bind(e)),e.initListeners(),t.default.instance.init(this.profile.debug,this.profile.draw,this.profile.maxAdDensity||0),this.profile.collectUserTouch&&O.TouchEventsService.get().initListeners(),this.logger.info("%Profile: ","font-size:18px; font-weight:bold;",this.profile),this.profile.analysisMode||(f.DemandTool.get(),this.profile.fixedSpotsFirst&&l.default.get().scanFixedSpotsFirst()),this.pn(),c.default.get().sendAnalyticsEvent(),this.profile.useWebVitals){const t=new b.WebVitals(u.Profiler.get().pageViewID,encodeURIComponent(r.default._i()));t.measure(),y.default.instance.subscribe((i=>{i&&setTimeout((()=>{const i=t.getData();this.logger.verbose("Sending web vital data ",i),n.default.get().sendWebVitalsEvent(i)}),0)}))}this.profile.analysisMode&&this.logger.style("%cAnalysis mode","font-size:48px; color:white; background:red;"),this._n()}wn(){_.Engagement.get(this.profile.timeOffset).subscribe(),y.default.instance.subscribe((t=>{var i;if(t){const t=n.default.get();t.sendSummaryEvent(),t.sendDemandSummaryEvent(),t.sendFoldSummaryEvent(),(null===(i=this.profile.predictorsVersions.publisherAdUnits)||void 0===i?void 0:i.length)&&t.sendPubDemandSummaryEvent(A.default.get().foundAds)}}))}yn(){this.runTriggersHook(),this.Sn()}On(){return new Promise((t=>{const i=p.default.getExternalFlowHandler("middyInitialator");i?i(this.profile,t):t()}))}_n(){this.On().then((()=>this.yn()))}runTriggersHook(){const t=p.default.getExternalFlowHandler("triggers");t&&t({pv:t=>{n.default.get().sendPageviewEvent(0,0,!0,t)},gd:(t,i)=>{n.default.get().sendGeneralDataEvent(t,i)}})}Sn(){m.default.isManualDcs()?(window[m.default.windowVarName]=window[m.default.windowVarName]||{},new v.default("manual",!0)):m.default.shouldRetrieveDcs()?(window[m.default.windowVarName]=window[m.default.windowVarName]||{},m.default.retrieveMutationElementIfExists(this.profile.dcs.mutationXpaths,this.logger).then(this.An.bind(this)).catch((t=>{this.dcsFailedCallback(t)}))):this.runSpotEngine()}An(t){const e=i.default.createDCS(this.profile.dcs.type,t);null!==e&&e.createObserver()}dcsFailedCallback(t){t.message===m.default.dcsFailureMessage?(this.logger.style("%cCould not find mutationElement on the page, not running DCS","font-size:16px;"),this.runSpotEngine()):setTimeout((()=>{throw t}))}runSpotEngine(){f.DemandTool.get().holdEngineForRelocation().then((()=>{let t,i=l.default.get();this.profile.dcsState&&(t={isDcs:!0}),s.default.run(i,this.profile,!0,!0,t)}))}}function E(){if(("interactive"===document.readyState||"complete"===document.readyState)&&!window._middyo.state){window._middyo.state=d.MiddyState.LOADED;(new j).mn()}}!function(){!function(){var t,i;const e=window._middyo,s=null===(i=null===(t=null==e?void 0:e.sec)||void 0===t?void 0:t.dcs)||void 0===i?void 0:i.su;s&&new w.DcsApi(e,s)}();const t=u.Profiler.get();n.default.get().sendEngineLoadedEvent(),u.Profiler.setLoadTime(),t.debug&&h.Output.setBrowsiOutput("engine_loaded"),window.document.addEventListener("readystatechange",(()=>E())),E()}()})()})();
</script>

</body>
</html>
