<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BundleInjectedWidgets.vue_vue_type_script_setup_true_lang.html</title>
</head>
<body>

<script>
import{g as I,R as J,b as f,C as Q}from"./commonAppInit.js";import{a as X}from"./realms.js";import{g as G,h as Z,i as q,j as ee,k as te,l as ne,m as ae,n as oe,o as se,p as re}from"./api.js";import{r as l,o as M,w as U,b as g,a as S,E as ie,d as W,f as b,g as ue,k as le,F as de,m as H,p as ce,N as me,D as Ee}from"./_plugin-vue_export-helper.js";import{r as A}from"./request.js";import{d as T,c as _e}from"./initCSRF.js";import{u as fe}from"./auth.store.js";import{c as O}from"./createAjaxHeaders.js";import{u as ve}from"./useEventListener.js";import{u as pe}from"./useOnUser.js";import{u as Ce}from"./vue-router.js";import{g as Se}from"./getRandomHash.js";import{c as Ie}from"./common.js";function $e(e,t){let n=I("CURRENT_REQUEST_LANGUAGE");return I("REALM")===J.US&&n==="en"?n="en-US":n==="en"&&(n="en-GB"),new Date(e).toLocaleString(n,t)}const Re=""+new URL("default-news-image.jpg",import.meta.url).href,he=""+new URL("default-news-image-cn360.jpg",import.meta.url).href;function Ye(){return X()?he:Re}function Le(){var t;const e=Ce();try{return(t=e==null?void 0:e.query)!=null&&t.preview_id?e.query.preview_id:new URL(window.location.href).searchParams.get("preview_id")||""}catch(n){return f("Failed to use previewId: ",n),""}}var C={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function ze({slug:e,onError:t}){const n=Le(),s=fe(),a=I("CONSUMER"),o=a===Q.PCBrowser,i=!!n,u={slug:e},d={consumer:a,lang:I("CURRENT_REQUEST_LANGUAGE")};n&&(d.preview_id=n);const _=i?te(u):ne(u),v=i?ae(u):oe(u),p=i?se(u):re(u),m=l(),h=l(),L=l(),w=l(),c=l();async function E(r){var B,P;const{deserializer:z,path:K,store:F}=r;try{const R=await A(r);if(!R.ok){(B=r.onError)==null||B.call(r,R);return}const D=await z(R);return F.value=D,D}catch(R){f(`Failed to make papi news request: ${K}`,R),(P=r.onError)==null||P.call(r)}}M(async()=>{const r=await E({path:_,method:"GET",deserializer:T,store:m,query:d,baseUrl:C.VITE_LEGACY_API_URL,onError:t});r!=null&&r.isCustom||(E({path:p,method:"GET",deserializer:_e,store:h,query:d,baseUrl:C.VITE_LEGACY_API_URL,onError:t}),o&&E({path:v,method:"GET",deserializer:T,store:L,query:d,baseUrl:C.VITE_LEGACY_API_URL}),o&&!i&&E({path:Z(u),method:"GET",deserializer:T,store:w,query:d,baseUrl:C.VITE_LEGACY_API_URL}))}),pe(()=>{o&&!i&&E({path:q,method:"GET",deserializer:T,store:c,baseUrl:C.VITE_LEGACY_API_URL})});const N=l(!1);return U(()=>{var r;(r=m.value)!=null&&r.id&&s.user&&!N.value&&(A({path:ee({id:m.value.id}),method:"POST",baseUrl:C.VITE_LEGACY_API_URL,headers:O({useCsrf:!0}),query:{consumer:a}}),N.value=!0)}),g(()=>{var r;N.value&&((r=m.value)!=null&&r.id)&&A({path:G({id:m.value.id}),method:"POST",baseUrl:C.VITE_LEGACY_API_URL,headers:O({useCsrf:!0})})}),ve(window,o?"beforeunload":"visibilitychange",()=>{var r;(r=m.value)!=null&&r.id&&navigator.sendBeacon(G({id:m.value.id}))}),{details:m,content:h,recommended:L,prevNext:w,hits:c}}const V="HMR_ENABLED",j="HMR_VITE_CLIENT_URL",x="HMR_VITE_BUNDLE_URL";function Y(){return{isEnabled:localStorage.getItem(V)==="true",viteClientURL:localStorage.getItem(j)||"",viteBundleURL:localStorage.getItem(x)||"",save(e,t,n){localStorage.setItem(V,e.toString()),localStorage.setItem(j,t),localStorage.setItem(x,n)}}}function y(e,t){return new Promise((n,s)=>{if(e){f("Importing external script: ",e.src);const a=document.createElement("script");Object.entries(e).filter(([o])=>o!=="src").map(([o,i])=>a.setAttribute(o,i)),a.onload=()=>{f("Successfully imported external script: ",e.src),n(a)},a.onerror=o=>{f("Failed to import external script",o),s(o)},a.setAttribute("src",e.src),((t==null?void 0:t.target)||document.head).appendChild(a)}})}function we(){const e=Y(),t=l(!1);return async function(){try{if(!e.isEnabled||t.value)return;if(e.isEnabled&&(!e.viteBundleURL||!e.viteClientURL))throw new Error("Required HMR params are missing");await y({type:"module",src:e.viteClientURL},{target:document.body}),await y({type:"module",src:e.viteBundleURL},{target:document.body}),t.value=!0}catch(n){f("Failed to init HMR: ",n)}}}function Te(e){return new Promise((t,n)=>{const s=document.createElement("link");s.setAttribute("href",e.href),s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),document.head.appendChild(s),s.onload=()=>t(s),s.onerror=n})}const Ue=e=>`${I("CMS_BUNDLES_ROOT")}${e}/index.css`,ge=e=>`${I("CMS_BUNDLES_ROOT")}${e}/index.js`;function Ne(e){const t=Se(),n=Y(),s=we(),a=l(!1),o=l(!1),i=l(),u=l();return U(async()=>{var d,_;try{if(a.value)return;if(n.isEnabled)await s(),a.value=!0;else if((d=e==null?void 0:e.value)!=null&&d.bundleKey){const v=(_=e==null?void 0:e.value)==null?void 0:_.bundleKey,[p,m]=await Promise.allSettled([y({type:"module",src:`${ge(v)}?h=${t}`},{target:document.body}),Te({href:`${Ue(v)}?h=${t}`})]);if(m.status==="fulfilled"&&(i.value=m.value),p.status==="fulfilled")u.value=p.value;else throw new Error("Failed to load js bundle");a.value=!0}}catch(v){f("Failed to load CMS bundle: ",v),a.value=!0,o.value=!0}}),g(()=>{setTimeout(()=>{var d,_;(d=i.value)==null||d.remove(),(_=u.value)==null||_.remove()},500)}),{isLoaded:a,isError:o}}const k="wowsp:cms-bundle:init",be=e=>`wowsp:cms-bundle:content-loaded:${e}`,$="wowsp:cms-bundle:cms-inject-widgets",Ae=3e3;function Ke(e){const{details:t,content:n,onCustomPageError:s}=e,a=l(!1),o=l(!1),i=l(),{isLoaded:u,isError:d}=Ne(t),_=S(()=>{var c,E;return t.value&&((c=t.value)!=null&&c.isCustom?u.value:n.value&&(!((E=t.value)!=null&&E.bundleKey)||u.value))}),v=S(()=>{var c,E;return(c=t.value)!=null&&c.isCustom?a.value:!((E=t.value)!=null&&E.bundleKey)||a.value||o.value||d.value});function p(){f("Got cms bundle init"),a.value=!0,i.value&&clearTimeout(i.value)}U(()=>{var c;d.value&&((c=t.value)!=null&&c.isCustom)&&(s==null||s())}),U(()=>{!a.value&&_.value&&(f("Should send bundle content loaded"),ie(()=>{var c;if((c=t.value)!=null&&c.bundleKey){f("Sending bundle content loaded");const E=new CustomEvent(be(t.value.bundleKey),{detail:{typographyClass:Ie.content}});document.body.dispatchEvent(E),t.value.isCustom||(i.value=window.setTimeout(()=>{f("Bundle load timeout"),o.value=!0},Ae))}}))}),M(()=>{document.body.addEventListener(k,p)}),g(()=>{document.body.removeEventListener(k,p)});const m=S(()=>_.value&&t.value.isCustom),h=S(()=>_.value&&!t.value.isCustom),L=S(()=>!_.value||!v.value),w=S(()=>v.value);return{shouldRenderCustomContent:m,shouldRenderDefaultContent:h,shouldRenderSpinner:L,shouldShowContent:w}}const Fe=W({__name:"BundleInjectedWidgets",setup(e){const t=l([]);function n(s){if(s.detail){let a=function({template:i,id:u}){return{component:Ee(W({template:i})),id:`#${u}`}};const o=s.detail;if(Array.isArray(o)){const i=o.map(u=>a(u));t.value=[...t.value,...i]}else{const i=a(o);t.value=[...t.value,i]}}}return M(()=>{document.body.addEventListener($,n)}),g(()=>{document.body.removeEventListener($,n)}),(s,a)=>(b(!0),ue(de,null,le(t.value,o=>(b(),H(me,{to:o.id,key:"widget.id"},[(b(),H(ce(o.component)))],8,["to"]))),128))}});export{Fe as _,Ke as a,Y as b,$e as f,Ye as g,y as i,ze as u};

</script>

</body>
</html>
