<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clientlib-base.min.cd34741fc31242ccbbac28dcbd4c625c.html</title>
</head>
<body>

<script>
/* ========================================================================
 * Bootstrap: affix.js v3.3.5
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // AFFIX CLASS DEFINITION
  // ======================

  var Affix = function (element, options) {
    this.options = $.extend({}, Affix.DEFAULTS, options)

    this.$target = $(this.options.target)
      .on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this))
      .on('click.bs.affix.data-api',  $.proxy(this.checkPositionWithEventLoop, this))

    this.$element     = $(element)
    this.affixed      = null
    this.unpin        = null
    this.pinnedOffset = null

    this.checkPosition()
  }

  Affix.VERSION  = '3.3.5'

  Affix.RESET    = 'affix affix-top affix-bottom'

  Affix.DEFAULTS = {
    offset: 0,
    target: window
  }

  Affix.prototype.getState = function (scrollHeight, height, offsetTop, offsetBottom) {
    var scrollTop    = this.$target.scrollTop()
    var position     = this.$element.offset()
    var targetHeight = this.$target.height()

    if (offsetTop != null && this.affixed == 'top') return scrollTop < offsetTop ? 'top' : false

    if (this.affixed == 'bottom') {
      if (offsetTop != null) return (scrollTop + this.unpin <= position.top) ? false : 'bottom'
      return (scrollTop + targetHeight <= scrollHeight - offsetBottom) ? false : 'bottom'
    }

    var initializing   = this.affixed == null
    var colliderTop    = initializing ? scrollTop : position.top
    var colliderHeight = initializing ? targetHeight : height

    if (offsetTop != null && scrollTop <= offsetTop) return 'top'
    if (offsetBottom != null && (colliderTop + colliderHeight >= scrollHeight - offsetBottom)) return 'bottom'

    return false
  }

  Affix.prototype.getPinnedOffset = function () {
    if (this.pinnedOffset) return this.pinnedOffset
    this.$element.removeClass(Affix.RESET).addClass('affix')
    var scrollTop = this.$target.scrollTop()
    var position  = this.$element.offset()
    return (this.pinnedOffset = position.top - scrollTop)
  }

  Affix.prototype.checkPositionWithEventLoop = function () {
    setTimeout($.proxy(this.checkPosition, this), 1)
  }

  Affix.prototype.checkPosition = function () {
    if (!this.$element.is(':visible')) return

    var height       = this.$element.height()
    var offset       = this.options.offset
    var offsetTop    = offset.top
    var offsetBottom = offset.bottom
    var scrollHeight = Math.max($(document).height(), $(document.body).height())

    if (typeof offset != 'object')         offsetBottom = offsetTop = offset
    if (typeof offsetTop == 'function')    offsetTop    = offset.top(this.$element)
    if (typeof offsetBottom == 'function') offsetBottom = offset.bottom(this.$element)

    var affix = this.getState(scrollHeight, height, offsetTop, offsetBottom)

    if (this.affixed != affix) {
      if (this.unpin != null) this.$element.css('top', '')

      var affixType = 'affix' + (affix ? '-' + affix : '')
      var e         = $.Event(affixType + '.bs.affix')

      this.$element.trigger(e)

      if (e.isDefaultPrevented()) return

      this.affixed = affix
      this.unpin = affix == 'bottom' ? this.getPinnedOffset() : null

      this.$element
        .removeClass(Affix.RESET)
        .addClass(affixType)
        .trigger(affixType.replace('affix', 'affixed') + '.bs.affix')
    }

    if (affix == 'bottom') {
      this.$element.offset({
        top: scrollHeight - height - offsetBottom
      })
    }
  }


  // AFFIX PLUGIN DEFINITION
  // =======================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.affix')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.affix', (data = new Affix(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.affix

  $.fn.affix             = Plugin
  $.fn.affix.Constructor = Affix


  // AFFIX NO CONFLICT
  // =================

  $.fn.affix.noConflict = function () {
    $.fn.affix = old
    return this
  }


  // AFFIX DATA-API
  // ==============

  $(window).on('load', function () {
    $('[data-spy="affix"]').each(function () {
      var $spy = $(this)
      var data = $spy.data()

      data.offset = data.offset || {}

      if (data.offsetBottom != null) data.offset.bottom = data.offsetBottom
      if (data.offsetTop    != null) data.offset.top    = data.offsetTop

      Plugin.call($spy, data)
    })
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: alert.js v3.3.5
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // ALERT CLASS DEFINITION
  // ======================

  var dismiss = '[data-dismiss="alert"]'
  var Alert   = function (el) {
    $(el).on('click', dismiss, this.close)
  }

  Alert.VERSION = '3.3.5'

  Alert.TRANSITION_DURATION = 150

  Alert.prototype.close = function (e) {
    var $this    = $(this)
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = $(selector)

    if (e) e.preventDefault()

    if (!$parent.length) {
      $parent = $this.closest('.alert')
    }

    $parent.trigger(e = $.Event('close.bs.alert'))

    if (e.isDefaultPrevented()) return

    $parent.removeClass('in')

    function removeElement() {
      // detach from parent, fire event then clean up data
      $parent.detach().trigger('closed.bs.alert').remove()
    }

    $.support.transition && $parent.hasClass('fade') ?
      $parent
        .one('bsTransitionEnd', removeElement)
        .emulateTransitionEnd(Alert.TRANSITION_DURATION) :
      removeElement()
  }


  // ALERT PLUGIN DEFINITION
  // =======================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.alert')

      if (!data) $this.data('bs.alert', (data = new Alert(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.alert

  $.fn.alert             = Plugin
  $.fn.alert.Constructor = Alert


  // ALERT NO CONFLICT
  // =================

  $.fn.alert.noConflict = function () {
    $.fn.alert = old
    return this
  }


  // ALERT DATA-API
  // ==============

  $(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close)

}(jQuery);

/* ========================================================================
 * Bootstrap: dropdown.js v3.3.5
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.5'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger('hidden.bs.dropdown', relatedTarget)
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger('shown.bs.dropdown', relatedTarget)
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);

/* ========================================================================
 * Bootstrap: tooltip.js v3.3.5
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // TOOLTIP PUBLIC CLASS DEFINITION
  // ===============================

  var Tooltip = function (element, options) {
    this.type       = null
    this.options    = null
    this.enabled    = null
    this.timeout    = null
    this.hoverState = null
    this.$element   = null
    this.inState    = null

    this.init('tooltip', element, options)
  }

  Tooltip.VERSION  = '3.3.5'

  Tooltip.TRANSITION_DURATION = 150

  Tooltip.DEFAULTS = {
    animation: true,
    placement: 'top',
    selector: false,
    template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
    trigger: 'hover focus',
    title: '',
    delay: 0,
    html: false,
    container: false,
    viewport: {
      selector: 'body',
      padding: 0
    }
  }

  Tooltip.prototype.init = function (type, element, options) {
    this.enabled   = true
    this.type      = type
    this.$element  = $(element)
    this.options   = this.getOptions(options)
    this.$viewport = this.options.viewport && $($.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : (this.options.viewport.selector || this.options.viewport))
    this.inState   = { click: false, hover: false, focus: false }

    if (this.$element[0] instanceof document.constructor && !this.options.selector) {
      throw new Error('`selector` option must be specified when initializing ' + this.type + ' on the window.document object!')
    }

    var triggers = this.options.trigger.split(' ')

    for (var i = triggers.length; i--;) {
      var trigger = triggers[i]

      if (trigger == 'click') {
        this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
      } else if (trigger != 'manual') {
        var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focusin'
        var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

        this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
        this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
      }
    }

    this.options.selector ?
      (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :
      this.fixTitle()
  }

  Tooltip.prototype.getDefaults = function () {
    return Tooltip.DEFAULTS
  }

  Tooltip.prototype.getOptions = function (options) {
    options = $.extend({}, this.getDefaults(), this.$element.data(), options)

    if (options.delay && typeof options.delay == 'number') {
      options.delay = {
        show: options.delay,
        hide: options.delay
      }
    }

    return options
  }

  Tooltip.prototype.getDelegateOptions = function () {
    var options  = {}
    var defaults = this.getDefaults()

    this._options && $.each(this._options, function (key, value) {
      if (defaults[key] != value) options[key] = value
    })

    return options
  }

  Tooltip.prototype.enter = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    if (obj instanceof $.Event) {
      self.inState[obj.type == 'focusin' ? 'focus' : 'hover'] = true
    }

    if (self.tip().hasClass('in') || self.hoverState == 'in') {
      self.hoverState = 'in'
      return
    }

    clearTimeout(self.timeout)

    self.hoverState = 'in'

    if (!self.options.delay || !self.options.delay.show) return self.show()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'in') self.show()
    }, self.options.delay.show)
  }

  Tooltip.prototype.isInStateTrue = function () {
    for (var key in this.inState) {
      if (this.inState[key]) return true
    }

    return false
  }

  Tooltip.prototype.leave = function (obj) {
    var self = obj instanceof this.constructor ?
      obj : $(obj.currentTarget).data('bs.' + this.type)

    if (!self) {
      self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
      $(obj.currentTarget).data('bs.' + this.type, self)
    }

    if (obj instanceof $.Event) {
      self.inState[obj.type == 'focusout' ? 'focus' : 'hover'] = false
    }

    if (self.isInStateTrue()) return

    clearTimeout(self.timeout)

    self.hoverState = 'out'

    if (!self.options.delay || !self.options.delay.hide) return self.hide()

    self.timeout = setTimeout(function () {
      if (self.hoverState == 'out') self.hide()
    }, self.options.delay.hide)
  }

  Tooltip.prototype.show = function () {
    var e = $.Event('show.bs.' + this.type)

    if (this.hasContent() && this.enabled) {
      this.$element.trigger(e)

      var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0])
      if (e.isDefaultPrevented() || !inDom) return
      var that = this

      var $tip = this.tip()

      var tipId = this.getUID(this.type)

      this.setContent()
      $tip.attr('id', tipId)
      this.$element.attr('aria-describedby', tipId)

      if (this.options.animation) $tip.addClass('fade')

      var placement = typeof this.options.placement == 'function' ?
        this.options.placement.call(this, $tip[0], this.$element[0]) :
        this.options.placement

      var autoToken = /\s?auto?\s?/i
      var autoPlace = autoToken.test(placement)
      if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

      $tip
        .detach()
        .css({ top: 0, left: 0, display: 'block' })
        .addClass(placement)
        .data('bs.' + this.type, this)

      this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)
      this.$element.trigger('inserted.bs.' + this.type)

      var pos          = this.getPosition()
      var actualWidth  = $tip[0].offsetWidth
      var actualHeight = $tip[0].offsetHeight

      if (autoPlace) {
        var orgPlacement = placement
        var viewportDim = this.getPosition(this.$viewport)

        placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top'    :
                    placement == 'top'    && pos.top    - actualHeight < viewportDim.top    ? 'bottom' :
                    placement == 'right'  && pos.right  + actualWidth  > viewportDim.width  ? 'left'   :
                    placement == 'left'   && pos.left   - actualWidth  < viewportDim.left   ? 'right'  :
                    placement

        $tip
          .removeClass(orgPlacement)
          .addClass(placement)
      }

      var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

      this.applyPlacement(calculatedOffset, placement)

      var complete = function () {
        var prevHoverState = that.hoverState
        that.$element.trigger('shown.bs.' + that.type)
        that.hoverState = null

        if (prevHoverState == 'out') that.leave(that)
      }

      $.support.transition && this.$tip.hasClass('fade') ?
        $tip
          .one('bsTransitionEnd', complete)
          .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :
        complete()
    }
  }

  Tooltip.prototype.applyPlacement = function (offset, placement) {
    var $tip   = this.tip()
    var width  = $tip[0].offsetWidth
    var height = $tip[0].offsetHeight

    // manually read margins because getBoundingClientRect includes difference
    var marginTop = parseInt($tip.css('margin-top'), 10)
    var marginLeft = parseInt($tip.css('margin-left'), 10)

    // we must check for NaN for ie 8/9
    if (isNaN(marginTop))  marginTop  = 0
    if (isNaN(marginLeft)) marginLeft = 0

    offset.top  += marginTop
    offset.left += marginLeft

    // $.fn.offset doesn't round pixel values
    // so we use setOffset directly with our own function B-0
    $.offset.setOffset($tip[0], $.extend({
      using: function (props) {
        $tip.css({
          top: Math.round(props.top),
          left: Math.round(props.left)
        })
      }
    }, offset), 0)

    $tip.addClass('in')

    // check to see if placing tip in new offset caused the tip to resize itself
    var actualWidth  = $tip[0].offsetWidth
    var actualHeight = $tip[0].offsetHeight

    if (placement == 'top' && actualHeight != height) {
      offset.top = offset.top + height - actualHeight
    }

    var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

    if (delta.left) offset.left += delta.left
    else offset.top += delta.top

    var isVertical          = /top|bottom/.test(placement)
    var arrowDelta          = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
    var arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight'

    $tip.offset(offset)
    this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], isVertical)
  }

  Tooltip.prototype.replaceArrow = function (delta, dimension, isVertical) {
    this.arrow()
      .css(isVertical ? 'left' : 'top', 50 * (1 - delta / dimension) + '%')
      .css(isVertical ? 'top' : 'left', '')
  }

  Tooltip.prototype.setContent = function () {
    var $tip  = this.tip()
    var title = this.getTitle()

    $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
    $tip.removeClass('fade in top bottom left right')
  }

  Tooltip.prototype.hide = function (callback) {
    var that = this
    var $tip = $(this.$tip)
    var e    = $.Event('hide.bs.' + this.type)

    function complete() {
      if (that.hoverState != 'in') $tip.detach()
      that.$element
        .removeAttr('aria-describedby')
        .trigger('hidden.bs.' + that.type)
      callback && callback()
    }

    this.$element.trigger(e)

    if (e.isDefaultPrevented()) return

    $tip.removeClass('in')

    $.support.transition && $tip.hasClass('fade') ?
      $tip
        .one('bsTransitionEnd', complete)
        .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :
      complete()

    this.hoverState = null

    return this
  }

  Tooltip.prototype.fixTitle = function () {
    var $e = this.$element
    if ($e.attr('title') || typeof $e.attr('data-original-title') != 'string') {
      $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
    }
  }

  Tooltip.prototype.hasContent = function () {
    return this.getTitle()
  }

  Tooltip.prototype.getPosition = function ($element) {
    $element   = $element || this.$element

    var el     = $element[0]
    var isBody = el.tagName == 'BODY'

    var elRect    = el.getBoundingClientRect()
    if (elRect.width == null) {
      // width and height are missing in IE8, so compute them manually; see https://github.com/twbs/bootstrap/issues/14093
      elRect = $.extend({}, elRect, { width: elRect.right - elRect.left, height: elRect.bottom - elRect.top })
    }
    var elOffset  = isBody ? { top: 0, left: 0 } : $element.offset()
    var scroll    = { scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop() }
    var outerDims = isBody ? { width: $(window).width(), height: $(window).height() } : null

    return $.extend({}, elRect, scroll, outerDims, elOffset)
  }

  Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {
    return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2 } :
           placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2 } :
           placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :
        /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width }

  }

  Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {
    var delta = { top: 0, left: 0 }
    if (!this.$viewport) return delta

    var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
    var viewportDimensions = this.getPosition(this.$viewport)

    if (/right|left/.test(placement)) {
      var topEdgeOffset    = pos.top - viewportPadding - viewportDimensions.scroll
      var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
      if (topEdgeOffset < viewportDimensions.top) { // top overflow
        delta.top = viewportDimensions.top - topEdgeOffset
      } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
        delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
      }
    } else {
      var leftEdgeOffset  = pos.left - viewportPadding
      var rightEdgeOffset = pos.left + viewportPadding + actualWidth
      if (leftEdgeOffset < viewportDimensions.left) { // left overflow
        delta.left = viewportDimensions.left - leftEdgeOffset
      } else if (rightEdgeOffset > viewportDimensions.right) { // right overflow
        delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
      }
    }

    return delta
  }

  Tooltip.prototype.getTitle = function () {
    var title
    var $e = this.$element
    var o  = this.options

    title = $e.attr('data-original-title')
      || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)

    return title
  }

  Tooltip.prototype.getUID = function (prefix) {
    do prefix += ~~(Math.random() * 1000000)
    while (document.getElementById(prefix))
    return prefix
  }

  Tooltip.prototype.tip = function () {
    if (!this.$tip) {
      this.$tip = $(this.options.template)
      if (this.$tip.length != 1) {
        throw new Error(this.type + ' `template` option must consist of exactly 1 top-level element!')
      }
    }
    return this.$tip
  }

  Tooltip.prototype.arrow = function () {
    return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
  }

  Tooltip.prototype.enable = function () {
    this.enabled = true
  }

  Tooltip.prototype.disable = function () {
    this.enabled = false
  }

  Tooltip.prototype.toggleEnabled = function () {
    this.enabled = !this.enabled
  }

  Tooltip.prototype.toggle = function (e) {
    var self = this
    if (e) {
      self = $(e.currentTarget).data('bs.' + this.type)
      if (!self) {
        self = new this.constructor(e.currentTarget, this.getDelegateOptions())
        $(e.currentTarget).data('bs.' + this.type, self)
      }
    }

    if (e) {
      self.inState.click = !self.inState.click
      if (self.isInStateTrue()) self.enter(self)
      else self.leave(self)
    } else {
      self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
    }
  }

  Tooltip.prototype.destroy = function () {
    var that = this
    clearTimeout(this.timeout)
    this.hide(function () {
      that.$element.off('.' + that.type).removeData('bs.' + that.type)
      if (that.$tip) {
        that.$tip.detach()
      }
      that.$tip = null
      that.$arrow = null
      that.$viewport = null
    })
  }


  // TOOLTIP PLUGIN DEFINITION
  // =========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.tooltip')
      var options = typeof option == 'object' && option

      if (!data && /destroy|hide/.test(option)) return
      if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.tooltip

  $.fn.tooltip             = Plugin
  $.fn.tooltip.Constructor = Tooltip


  // TOOLTIP NO CONFLICT
  // ===================

  $.fn.tooltip.noConflict = function () {
    $.fn.tooltip = old
    return this
  }

}(jQuery);

/* ========================================================================
 * Bootstrap: modal.js v3.3.5
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // MODAL CLASS DEFINITION
  // ======================

  var Modal = function (element, options) {
    this.options             = options
    this.$body               = $(document.body)
    this.$element            = $(element)
    this.$dialog             = this.$element.find('.modal-dialog')
    this.$backdrop           = null
    this.isShown             = null
    this.originalBodyPad     = null
    this.scrollbarWidth      = 0
    this.ignoreBackdropClick = false

    if (this.options.remote) {
      this.$element
        .find('.modal-content')
        .load(this.options.remote, $.proxy(function () {
          this.$element.trigger('loaded.bs.modal')
        }, this))
    }
  }

  Modal.VERSION  = '3.3.5'

  Modal.TRANSITION_DURATION = 300
  Modal.BACKDROP_TRANSITION_DURATION = 150

  Modal.DEFAULTS = {
    backdrop: true,
    keyboard: true,
    show: true
  }

  Modal.prototype.toggle = function (_relatedTarget) {
    return this.isShown ? this.hide() : this.show(_relatedTarget)
  }

  Modal.prototype.show = function (_relatedTarget) {
    var that = this
    var e    = $.Event('show.bs.modal', { relatedTarget: _relatedTarget })

    this.$element.trigger(e)

    if (this.isShown || e.isDefaultPrevented()) return

    this.isShown = true

    this.checkScrollbar()
    this.setScrollbar()
    this.$body.addClass('modal-open')

    this.escape()
    this.resize()

    this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this))

    this.$dialog.on('mousedown.dismiss.bs.modal', function () {
      that.$element.one('mouseup.dismiss.bs.modal', function (e) {
        if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true
      })
    })

    this.backdrop(function () {
      var transition = $.support.transition && that.$element.hasClass('fade')

      if (!that.$element.parent().length) {
        that.$element.appendTo(that.$body) // don't move modals dom position
      }

      that.$element
        .show()
        .scrollTop(0)

      that.adjustDialog()

      if (transition) {
        that.$element[0].offsetWidth // force reflow
      }

      that.$element.addClass('in')

      that.enforceFocus()

      var e = $.Event('shown.bs.modal', { relatedTarget: _relatedTarget })

      transition ?
        that.$dialog // wait for modal to slide in
          .one('bsTransitionEnd', function () {
            that.$element.trigger('focus').trigger(e)
          })
          .emulateTransitionEnd(Modal.TRANSITION_DURATION) :
        that.$element.trigger('focus').trigger(e)
    })
  }

  Modal.prototype.hide = function (e) {
    if (e) e.preventDefault()

    e = $.Event('hide.bs.modal')

    this.$element.trigger(e)

    if (!this.isShown || e.isDefaultPrevented()) return

    this.isShown = false

    this.escape()
    this.resize()

    $(document).off('focusin.bs.modal')

    this.$element
      .removeClass('in')
      .off('click.dismiss.bs.modal')
      .off('mouseup.dismiss.bs.modal')

    this.$dialog.off('mousedown.dismiss.bs.modal')

    $.support.transition && this.$element.hasClass('fade') ?
      this.$element
        .one('bsTransitionEnd', $.proxy(this.hideModal, this))
        .emulateTransitionEnd(Modal.TRANSITION_DURATION) :
      this.hideModal()
  }

  Modal.prototype.enforceFocus = function () {
    $(document)
      .off('focusin.bs.modal') // guard against infinite focus loop
      .on('focusin.bs.modal', $.proxy(function (e) {
        if (this.$element[0] !== e.target && !this.$element.has(e.target).length) {
          this.$element.trigger('focus')
        }
      }, this))
  }

  Modal.prototype.escape = function () {
    if (this.isShown && this.options.keyboard) {
      this.$element.on('keydown.dismiss.bs.modal', $.proxy(function (e) {
        e.which == 27 && this.hide()
      }, this))
    } else if (!this.isShown) {
      this.$element.off('keydown.dismiss.bs.modal')
    }
  }

  Modal.prototype.resize = function () {
    if (this.isShown) {
      $(window).on('resize.bs.modal', $.proxy(this.handleUpdate, this))
    } else {
      $(window).off('resize.bs.modal')
    }
  }

  Modal.prototype.hideModal = function () {
    var that = this
    this.$element.hide()
    this.backdrop(function () {
      that.$body.removeClass('modal-open')
      that.resetAdjustments()
      that.resetScrollbar()
      that.$element.trigger('hidden.bs.modal')
    })
  }

  Modal.prototype.removeBackdrop = function () {
    this.$backdrop && this.$backdrop.remove()
    this.$backdrop = null
  }

  Modal.prototype.backdrop = function (callback) {
    var that = this
    var animate = this.$element.hasClass('fade') ? 'fade' : ''

    if (this.isShown && this.options.backdrop) {
      var doAnimate = $.support.transition && animate

      this.$backdrop = $(document.createElement('div'))
        .addClass('modal-backdrop ' + animate)
        .appendTo(this.$body)

      this.$element.on('click.dismiss.bs.modal', $.proxy(function (e) {
        if (this.ignoreBackdropClick) {
          this.ignoreBackdropClick = false
          return
        }
        if (e.target !== e.currentTarget) return
        this.options.backdrop == 'static'
          ? this.$element[0].focus()
          : this.hide()
      }, this))

      if (doAnimate) this.$backdrop[0].offsetWidth // force reflow

      this.$backdrop.addClass('in')

      if (!callback) return

      doAnimate ?
        this.$backdrop
          .one('bsTransitionEnd', callback)
          .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :
        callback()

    } else if (!this.isShown && this.$backdrop) {
      this.$backdrop.removeClass('in')

      var callbackRemove = function () {
        that.removeBackdrop()
        callback && callback()
      }
      $.support.transition && this.$element.hasClass('fade') ?
        this.$backdrop
          .one('bsTransitionEnd', callbackRemove)
          .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :
        callbackRemove()

    } else if (callback) {
      callback()
    }
  }

  // these following methods are used to handle overflowing modals

  Modal.prototype.handleUpdate = function () {
    this.adjustDialog()
  }

  Modal.prototype.adjustDialog = function () {
    var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight

    this.$element.css({
      paddingLeft:  !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',
      paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''
    })
  }

  Modal.prototype.resetAdjustments = function () {
    this.$element.css({
      paddingLeft: '',
      paddingRight: ''
    })
  }

  Modal.prototype.checkScrollbar = function () {
    var fullWindowWidth = window.innerWidth
    if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8
      var documentElementRect = document.documentElement.getBoundingClientRect()
      fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)
    }
    this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth
    this.scrollbarWidth = this.measureScrollbar()
  }

  Modal.prototype.setScrollbar = function () {
    var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
    this.originalBodyPad = document.body.style.paddingRight || ''
    if (this.bodyIsOverflowing) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
  }

  Modal.prototype.resetScrollbar = function () {
    this.$body.css('padding-right', this.originalBodyPad)
  }

  Modal.prototype.measureScrollbar = function () { // thx walsh
    var scrollDiv = document.createElement('div')
    scrollDiv.className = 'modal-scrollbar-measure'
    this.$body.append(scrollDiv)
    var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
    this.$body[0].removeChild(scrollDiv)
    return scrollbarWidth
  }


  // MODAL PLUGIN DEFINITION
  // =======================

  function Plugin(option, _relatedTarget) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.modal')
      var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data) $this.data('bs.modal', (data = new Modal(this, options)))
      if (typeof option == 'string') data[option](_relatedTarget)
      else if (options.show) data.show(_relatedTarget)
    })
  }

  var old = $.fn.modal

  $.fn.modal             = Plugin
  $.fn.modal.Constructor = Modal


  // MODAL NO CONFLICT
  // =================

  $.fn.modal.noConflict = function () {
    $.fn.modal = old
    return this
  }


  // MODAL DATA-API
  // ==============

  $(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function (e) {
    var $this   = $(this)
    var href    = $this.attr('href')
    var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\s]+$)/, ''))) // strip for ie7
    var option  = $target.data('bs.modal') ? 'toggle' : $.extend({ remote: !/#/.test(href) && href }, $target.data(), $this.data())

    if ($this.is('a')) e.preventDefault()

    $target.one('show.bs.modal', function (showEvent) {
      if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown
      $target.one('hidden.bs.modal', function () {
        $this.is(':visible') && $this.trigger('focus')
      })
    })
    Plugin.call($target, option, this)
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: transition.js v3.3.5
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: button.js v3.3.5
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // BUTTON PUBLIC CLASS DEFINITION
  // ==============================

  var Button = function (element, options) {
    this.$element  = $(element)
    this.options   = $.extend({}, Button.DEFAULTS, options)
    this.isLoading = false
  }

  Button.VERSION  = '3.3.5'

  Button.DEFAULTS = {
    loadingText: 'loading...'
  }

  Button.prototype.setState = function (state) {
    var d    = 'disabled'
    var $el  = this.$element
    var val  = $el.is('input') ? 'val' : 'html'
    var data = $el.data()

    state += 'Text'

    if (data.resetText == null) $el.data('resetText', $el[val]())

    // push to event loop to allow forms to submit
    setTimeout($.proxy(function () {
      $el[val](data[state] == null ? this.options[state] : data[state])

      if (state == 'loadingText') {
        this.isLoading = true
        $el.addClass(d).attr(d, d)
      } else if (this.isLoading) {
        this.isLoading = false
        $el.removeClass(d).removeAttr(d)
      }
    }, this), 0)
  }

  Button.prototype.toggle = function () {
    var changed = true
    var $parent = this.$element.closest('[data-toggle="buttons"]')

    if ($parent.length) {
      var $input = this.$element.find('input')
      if ($input.prop('type') == 'radio') {
        if ($input.prop('checked')) changed = false
        $parent.find('.active').removeClass('active')
        this.$element.addClass('active')
      } else if ($input.prop('type') == 'checkbox') {
        if (($input.prop('checked')) !== this.$element.hasClass('active')) changed = false
        this.$element.toggleClass('active')
      }
      $input.prop('checked', this.$element.hasClass('active'))
      if (changed) $input.trigger('change')
    } else {
      this.$element.attr('aria-pressed', !this.$element.hasClass('active'))
      this.$element.toggleClass('active')
    }
  }


  // BUTTON PLUGIN DEFINITION
  // ========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.button')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.button', (data = new Button(this, options)))

      if (option == 'toggle') data.toggle()
      else if (option) data.setState(option)
    })
  }

  var old = $.fn.button

  $.fn.button             = Plugin
  $.fn.button.Constructor = Button


  // BUTTON NO CONFLICT
  // ==================

  $.fn.button.noConflict = function () {
    $.fn.button = old
    return this
  }


  // BUTTON DATA-API
  // ===============

  $(document)
    .on('click.bs.button.data-api', '[data-toggle^="button"]', function (e) {
      var $btn = $(e.target)
      if (!$btn.hasClass('btn')) $btn = $btn.closest('.btn')
      Plugin.call($btn, 'toggle')
      if (!($(e.target).is('input[type="radio"]') || $(e.target).is('input[type="checkbox"]'))) e.preventDefault()
    })
    .on('focus.bs.button.data-api blur.bs.button.data-api', '[data-toggle^="button"]', function (e) {
      $(e.target).closest('.btn').toggleClass('focus', /^focus(in)?$/.test(e.type))
    })

}(jQuery);

/* ========================================================================
 * Bootstrap: popover.js v3.3.5
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // POPOVER PUBLIC CLASS DEFINITION
  // ===============================

  var Popover = function (element, options) {
    this.init('popover', element, options)
  }

  if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')

  Popover.VERSION  = '3.3.5'

  Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {
    placement: 'right',
    trigger: 'click',
    content: '',
    template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
  })


  // NOTE: POPOVER EXTENDS tooltip.js
  // ================================

  Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)

  Popover.prototype.constructor = Popover

  Popover.prototype.getDefaults = function () {
    return Popover.DEFAULTS
  }

  Popover.prototype.setContent = function () {
    var $tip    = this.tip()
    var title   = this.getTitle()
    var content = this.getContent()

    $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)
    $tip.find('.popover-content').children().detach().end()[ // we use append for html objects to maintain js events
      this.options.html ? (typeof content == 'string' ? 'html' : 'append') : 'text'
    ](content)

    $tip.removeClass('fade top bottom left right in')

    // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
    // this manually by checking the contents.
    if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()
  }

  Popover.prototype.hasContent = function () {
    return this.getTitle() || this.getContent()
  }

  Popover.prototype.getContent = function () {
    var $e = this.$element
    var o  = this.options

    return $e.attr('data-content')
      || (typeof o.content == 'function' ?
            o.content.call($e[0]) :
            o.content)
  }

  Popover.prototype.arrow = function () {
    return (this.$arrow = this.$arrow || this.tip().find('.arrow'))
  }


  // POPOVER PLUGIN DEFINITION
  // =========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.popover')
      var options = typeof option == 'object' && option

      if (!data && /destroy|hide/.test(option)) return
      if (!data) $this.data('bs.popover', (data = new Popover(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.popover

  $.fn.popover             = Plugin
  $.fn.popover.Constructor = Popover


  // POPOVER NO CONFLICT
  // ===================

  $.fn.popover.noConflict = function () {
    $.fn.popover = old
    return this
  }

}(jQuery);

/* ========================================================================
 * Bootstrap: carousel.js v3.3.5
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CAROUSEL CLASS DEFINITION
  // =========================

  var Carousel = function (element, options) {
    this.$element    = $(element)
    this.$indicators = this.$element.find('.carousel-indicators')
    this.options     = options
    this.paused      = null
    this.sliding     = null
    this.interval    = null
    this.$active     = null
    this.$items      = null

    this.options.keyboard && this.$element.on('keydown.bs.carousel', $.proxy(this.keydown, this))

    this.options.pause == 'hover' && !('ontouchstart' in document.documentElement) && this.$element
      .on('mouseenter.bs.carousel', $.proxy(this.pause, this))
      .on('mouseleave.bs.carousel', $.proxy(this.cycle, this))
  }

  Carousel.VERSION  = '3.3.5'

  Carousel.TRANSITION_DURATION = 600

  Carousel.DEFAULTS = {
    interval: 5000,
    pause: 'hover',
    wrap: true,
    keyboard: true
  }

  Carousel.prototype.keydown = function (e) {
    if (/input|textarea/i.test(e.target.tagName)) return
    switch (e.which) {
      case 37: this.prev(); break
      case 39: this.next(); break
      default: return
    }

    e.preventDefault()
  }

  Carousel.prototype.cycle = function (e) {
    e || (this.paused = false)

    this.interval && clearInterval(this.interval)

    this.options.interval
      && !this.paused
      && (this.interval = setInterval($.proxy(this.next, this), this.options.interval))

    return this
  }

  Carousel.prototype.getItemIndex = function (item) {
    this.$items = item.parent().children('.item')
    return this.$items.index(item || this.$active)
  }

  Carousel.prototype.getItemForDirection = function (direction, active) {
    var activeIndex = this.getItemIndex(active)
    var willWrap = (direction == 'prev' && activeIndex === 0)
                || (direction == 'next' && activeIndex == (this.$items.length - 1))
    if (willWrap && !this.options.wrap) return active
    var delta = direction == 'prev' ? -1 : 1
    var itemIndex = (activeIndex + delta) % this.$items.length
    return this.$items.eq(itemIndex)
  }

  Carousel.prototype.to = function (pos) {
    var that        = this
    var activeIndex = this.getItemIndex(this.$active = this.$element.find('.item.active'))

    if (pos > (this.$items.length - 1) || pos < 0) return

    if (this.sliding)       return this.$element.one('slid.bs.carousel', function () { that.to(pos) }) // yes, "slid"
    if (activeIndex == pos) return this.pause().cycle()

    return this.slide(pos > activeIndex ? 'next' : 'prev', this.$items.eq(pos))
  }

  Carousel.prototype.pause = function (e) {
    e || (this.paused = true)

    if (this.$element.find('.next, .prev').length && $.support.transition) {
      this.$element.trigger($.support.transition.end)
      this.cycle(true)
    }

    this.interval = clearInterval(this.interval)

    return this
  }

  Carousel.prototype.next = function () {
    if (this.sliding) return
    return this.slide('next')
  }

  Carousel.prototype.prev = function () {
    if (this.sliding) return
    return this.slide('prev')
  }

  Carousel.prototype.slide = function (type, next) {
    var $active   = this.$element.find('.item.active')
    var $next     = next || this.getItemForDirection(type, $active)
    var isCycling = this.interval
    var direction = type == 'next' ? 'left' : 'right'
    var that      = this

    if ($next.hasClass('active')) return (this.sliding = false)

    var relatedTarget = $next[0]
    var slideEvent = $.Event('slide.bs.carousel', {
      relatedTarget: relatedTarget,
      direction: direction
    })
    this.$element.trigger(slideEvent)
    if (slideEvent.isDefaultPrevented()) return

    this.sliding = true

    isCycling && this.pause()

    if (this.$indicators.length) {
      this.$indicators.find('.active').removeClass('active')
      var $nextIndicator = $(this.$indicators.children()[this.getItemIndex($next)])
      $nextIndicator && $nextIndicator.addClass('active')
    }

    var slidEvent = $.Event('slid.bs.carousel', { relatedTarget: relatedTarget, direction: direction }) // yes, "slid"
    if ($.support.transition && this.$element.hasClass('slide')) {
      $next.addClass(type)
      $next[0].offsetWidth // force reflow
      $active.addClass(direction)
      $next.addClass(direction)
      $active
        .one('bsTransitionEnd', function () {
          $next.removeClass([type, direction].join(' ')).addClass('active')
          $active.removeClass(['active', direction].join(' '))
          that.sliding = false
          setTimeout(function () {
            that.$element.trigger(slidEvent)
          }, 0)
        })
        .emulateTransitionEnd(Carousel.TRANSITION_DURATION)
    } else {
      $active.removeClass('active')
      $next.addClass('active')
      this.sliding = false
      this.$element.trigger(slidEvent)
    }

    isCycling && this.cycle()

    return this
  }


  // CAROUSEL PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.carousel')
      var options = $.extend({}, Carousel.DEFAULTS, $this.data(), typeof option == 'object' && option)
      var action  = typeof option == 'string' ? option : options.slide

      if (!data) $this.data('bs.carousel', (data = new Carousel(this, options)))
      if (typeof option == 'number') data.to(option)
      else if (action) data[action]()
      else if (options.interval) data.pause().cycle()
    })
  }

  var old = $.fn.carousel

  $.fn.carousel             = Plugin
  $.fn.carousel.Constructor = Carousel


  // CAROUSEL NO CONFLICT
  // ====================

  $.fn.carousel.noConflict = function () {
    $.fn.carousel = old
    return this
  }


  // CAROUSEL DATA-API
  // =================

  var clickHandler = function (e) {
    var href
    var $this   = $(this)
    var $target = $($this.attr('data-target') || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '')) // strip for ie7
    if (!$target.hasClass('carousel')) return
    var options = $.extend({}, $target.data(), $this.data())
    var slideIndex = $this.attr('data-slide-to')
    if (slideIndex) options.interval = false

    Plugin.call($target, options)

    if (slideIndex) {
      $target.data('bs.carousel').to(slideIndex)
    }

    e.preventDefault()
  }

  $(document)
    .on('click.bs.carousel.data-api', '[data-slide]', clickHandler)
    .on('click.bs.carousel.data-api', '[data-slide-to]', clickHandler)

  $(window).on('load', function () {
    $('[data-ride="carousel"]').each(function () {
      var $carousel = $(this)
      Plugin.call($carousel, $carousel.data())
    })
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: scrollspy.js v3.3.5
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // SCROLLSPY CLASS DEFINITION
  // ==========================

  function ScrollSpy(element, options) {
    this.$body          = $(document.body)
    this.$scrollElement = $(element).is(document.body) ? $(window) : $(element)
    this.options        = $.extend({}, ScrollSpy.DEFAULTS, options)
    this.selector       = (this.options.target || '') + ' .nav li > a'
    this.offsets        = []
    this.targets        = []
    this.activeTarget   = null
    this.scrollHeight   = 0

    this.$scrollElement.on('scroll.bs.scrollspy', $.proxy(this.process, this))
    this.refresh()
    this.process()
  }

  ScrollSpy.VERSION  = '3.3.5'

  ScrollSpy.DEFAULTS = {
    offset: 10
  }

  ScrollSpy.prototype.getScrollHeight = function () {
    return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
  }

  ScrollSpy.prototype.refresh = function () {
    var that          = this
    var offsetMethod  = 'offset'
    var offsetBase    = 0

    this.offsets      = []
    this.targets      = []
    this.scrollHeight = this.getScrollHeight()

    if (!$.isWindow(this.$scrollElement[0])) {
      offsetMethod = 'position'
      offsetBase   = this.$scrollElement.scrollTop()
    }

    this.$body
      .find(this.selector)
      .map(function () {
        var $el   = $(this)
        var href  = $el.data('target') || $el.attr('href')
        var $href = /^#./.test(href) && $(href)

        return ($href
          && $href.length
          && $href.is(':visible')
          && [[$href[offsetMethod]().top + offsetBase, href]]) || null
      })
      .sort(function (a, b) { return a[0] - b[0] })
      .each(function () {
        that.offsets.push(this[0])
        that.targets.push(this[1])
      })
  }

  ScrollSpy.prototype.process = function () {
    var scrollTop    = this.$scrollElement.scrollTop() + this.options.offset
    var scrollHeight = this.getScrollHeight()
    var maxScroll    = this.options.offset + scrollHeight - this.$scrollElement.height()
    var offsets      = this.offsets
    var targets      = this.targets
    var activeTarget = this.activeTarget
    var i

    if (this.scrollHeight != scrollHeight) {
      this.refresh()
    }

    if (scrollTop >= maxScroll) {
      return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
    }

    if (activeTarget && scrollTop < offsets[0]) {
      this.activeTarget = null
      return this.clear()
    }

    for (i = offsets.length; i--;) {
      activeTarget != targets[i]
        && scrollTop >= offsets[i]
        && (offsets[i + 1] === undefined || scrollTop < offsets[i + 1])
        && this.activate(targets[i])
    }
  }

  ScrollSpy.prototype.activate = function (target) {
    this.activeTarget = target

    this.clear()

    var selector = this.selector +
      '[data-target="' + target + '"],' +
      this.selector + '[href="' + target + '"]'

    var active = $(selector)
      .parents('li')
      .addClass('active')

    if (active.parent('.dropdown-menu').length) {
      active = active
        .closest('li.dropdown')
        .addClass('active')
    }

    active.trigger('activate.bs.scrollspy')
  }

  ScrollSpy.prototype.clear = function () {
    $(this.selector)
      .parentsUntil(this.options.target, '.active')
      .removeClass('active')
  }


  // SCROLLSPY PLUGIN DEFINITION
  // ===========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.scrollspy')
      var options = typeof option == 'object' && option

      if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.scrollspy

  $.fn.scrollspy             = Plugin
  $.fn.scrollspy.Constructor = ScrollSpy


  // SCROLLSPY NO CONFLICT
  // =====================

  $.fn.scrollspy.noConflict = function () {
    $.fn.scrollspy = old
    return this
  }


  // SCROLLSPY DATA-API
  // ==================

  $(window).on('load.bs.scrollspy.data-api', function () {
    $('[data-spy="scroll"]').each(function () {
      var $spy = $(this)
      Plugin.call($spy, $spy.data())
    })
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: collapse.js v3.3.5
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.5'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);

/* ========================================================================
 * Bootstrap: tab.js v3.3.5
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // TAB CLASS DEFINITION
  // ====================

  var Tab = function (element) {
    // jscs:disable requireDollarBeforejQueryAssignment
    this.element = $(element)
    // jscs:enable requireDollarBeforejQueryAssignment
  }

  Tab.VERSION = '3.3.5'

  Tab.TRANSITION_DURATION = 150

  Tab.prototype.show = function () {
    var $this    = this.element
    var $ul      = $this.closest('ul:not(.dropdown-menu)')
    var selector = $this.data('target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    if ($this.parent('li').hasClass('active')) return

    var $previous = $ul.find('.active:last a')
    var hideEvent = $.Event('hide.bs.tab', {
      relatedTarget: $this[0]
    })
    var showEvent = $.Event('show.bs.tab', {
      relatedTarget: $previous[0]
    })

    $previous.trigger(hideEvent)
    $this.trigger(showEvent)

    if (showEvent.isDefaultPrevented() || hideEvent.isDefaultPrevented()) return

    var $target = $(selector)

    this.activate($this.closest('li'), $ul)
    this.activate($target, $target.parent(), function () {
      $previous.trigger({
        type: 'hidden.bs.tab',
        relatedTarget: $this[0]
      })
      $this.trigger({
        type: 'shown.bs.tab',
        relatedTarget: $previous[0]
      })
    })
  }

  Tab.prototype.activate = function (element, container, callback) {
    var $active    = container.find('> .active')
    var transition = callback
      && $.support.transition
      && ($active.length && $active.hasClass('fade') || !!container.find('> .fade').length)

    function next() {
      $active
        .removeClass('active')
        .find('> .dropdown-menu > .active')
          .removeClass('active')
        .end()
        .find('[data-toggle="tab"]')
          .attr('aria-expanded', false)

      element
        .addClass('active')
        .find('[data-toggle="tab"]')
          .attr('aria-expanded', true)

      if (transition) {
        element[0].offsetWidth // reflow for transition
        element.addClass('in')
      } else {
        element.removeClass('fade')
      }

      if (element.parent('.dropdown-menu').length) {
        element
          .closest('li.dropdown')
            .addClass('active')
          .end()
          .find('[data-toggle="tab"]')
            .attr('aria-expanded', true)
      }

      callback && callback()
    }

    $active.length && transition ?
      $active
        .one('bsTransitionEnd', next)
        .emulateTransitionEnd(Tab.TRANSITION_DURATION) :
      next()

    $active.removeClass('in')
  }


  // TAB PLUGIN DEFINITION
  // =====================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.tab')

      if (!data) $this.data('bs.tab', (data = new Tab(this)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.tab

  $.fn.tab             = Plugin
  $.fn.tab.Constructor = Tab


  // TAB NO CONFLICT
  // ===============

  $.fn.tab.noConflict = function () {
    $.fn.tab = old
    return this
  }


  // TAB DATA-API
  // ============

  var clickHandler = function (e) {
    e.preventDefault()
    Plugin.call($(this), 'show')
  }

  $(document)
    .on('click.bs.tab.data-api', '[data-toggle="tab"]', clickHandler)
    .on('click.bs.tab.data-api', '[data-toggle="pill"]', clickHandler)

}(jQuery);

/*!
 * Flickity PACKAGED v2.2.2
 * Touch, responsive, flickable carousels
 *
 * Licensed GPLv3 for open source use
 * or Flickity Commercial License for commercial use
 *
 * https://flickity.metafizzy.co
 * Copyright 2015-2021 Metafizzy
 */
(function(e,i){if(typeof define=="function"&&define.amd){define("jquery-bridget/jquery-bridget",["jquery"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("jquery"))}else{e.jQueryBridget=i(e,e.jQuery)}})(window,function t(e,r){"use strict";var o=Array.prototype.slice;var i=e.console;var u=typeof i=="undefined"?function(){}:function(t){i.error(t)};function n(h,s,c){c=c||r||e.jQuery;if(!c){return}if(!s.prototype.option){s.prototype.option=function(t){if(!c.isPlainObject(t)){return}this.options=c.extend(true,this.options,t)}}c.fn[h]=function(t){if(typeof t=="string"){var e=o.call(arguments,1);return i(this,t,e)}n(this,t);return this};function i(t,r,o){var a;var l="$()."+h+'("'+r+'")';t.each(function(t,e){var i=c.data(e,h);if(!i){u(h+" not initialized. Cannot call methods, i.e. "+l);return}var n=i[r];if(!n||r.charAt(0)=="_"){u(l+" is not a valid method");return}var s=n.apply(i,o);a=a===undefined?s:a});return a!==undefined?a:t}function n(t,n){t.each(function(t,e){var i=c.data(e,h);if(i){i.option(n);i._init()}else{i=new s(e,n);c.data(e,h,i)}})}a(c)}function a(t){if(!t||t&&t.bridget){return}t.bridget=n}a(r||e.jQuery);return n});(function(t,e){if(typeof define=="function"&&define.amd){define("ev-emitter/ev-emitter",e)}else if(typeof module=="object"&&module.exports){module.exports=e()}else{t.EvEmitter=e()}})(typeof window!="undefined"?window:this,function(){function t(){}var e=t.prototype;e.on=function(t,e){if(!t||!e){return}var i=this._events=this._events||{};var n=i[t]=i[t]||[];if(n.indexOf(e)==-1){n.push(e)}return this};e.once=function(t,e){if(!t||!e){return}this.on(t,e);var i=this._onceEvents=this._onceEvents||{};var n=i[t]=i[t]||{};n[e]=true;return this};e.off=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length){return}var n=i.indexOf(e);if(n!=-1){i.splice(n,1)}return this};e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length){return}i=i.slice(0);e=e||[];var n=this._onceEvents&&this._onceEvents[t];for(var s=0;s<i.length;s++){var r=i[s];var o=n&&n[r];if(o){this.off(t,r);delete n[r]}r.apply(this,e)}return this};e.allOff=function(){delete this._events;delete this._onceEvents};return t});
/*!
 * getSize v2.0.3
 * measure size of elements
 * MIT license
 */
(function(t,e){if(typeof define=="function"&&define.amd){define("get-size/get-size",e)}else if(typeof module=="object"&&module.exports){module.exports=e()}else{t.getSize=e()}})(window,function t(){"use strict";function m(t){var e=parseFloat(t);var i=t.indexOf("%")==-1&&!isNaN(e);return i&&e}function e(){}var i=typeof console=="undefined"?e:function(t){console.error(t)};var y=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];var b=y.length;function E(){var t={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0};for(var e=0;e<b;e++){var i=y[e];t[i]=0}return t}function S(t){var e=getComputedStyle(t);if(!e){i("Style returned "+e+". Are you running this code in a hidden iframe on Firefox? "+"See https://bit.ly/getsizebug1")}return e}var n=false;var C;function x(){if(n){return}n=true;var t=document.createElement("div");t.style.width="200px";t.style.padding="1px 2px 3px 4px";t.style.borderStyle="solid";t.style.borderWidth="1px 2px 3px 4px";t.style.boxSizing="border-box";var e=document.body||document.documentElement;e.appendChild(t);var i=S(t);C=Math.round(m(i.width))==200;s.isBoxSizeOuter=C;e.removeChild(t)}function s(t){x();if(typeof t=="string"){t=document.querySelector(t)}if(!t||typeof t!="object"||!t.nodeType){return}var e=S(t);if(e.display=="none"){return E()}var i={};i.width=t.offsetWidth;i.height=t.offsetHeight;var n=i.isBorderBox=e.boxSizing=="border-box";for(var s=0;s<b;s++){var r=y[s];var o=e[r];var a=parseFloat(o);i[r]=!isNaN(a)?a:0}var l=i.paddingLeft+i.paddingRight;var h=i.paddingTop+i.paddingBottom;var c=i.marginLeft+i.marginRight;var u=i.marginTop+i.marginBottom;var d=i.borderLeftWidth+i.borderRightWidth;var f=i.borderTopWidth+i.borderBottomWidth;var p=n&&C;var v=m(e.width);if(v!==false){i.width=v+(p?0:l+d)}var g=m(e.height);if(g!==false){i.height=g+(p?0:h+f)}i.innerWidth=i.width-(l+d);i.innerHeight=i.height-(h+f);i.outerWidth=i.width+c;i.outerHeight=i.height+u;return i}return s});(function(t,e){"use strict";if(typeof define=="function"&&define.amd){define("desandro-matches-selector/matches-selector",e)}else if(typeof module=="object"&&module.exports){module.exports=e()}else{t.matchesSelector=e()}})(window,function t(){"use strict";var n=function(){var t=window.Element.prototype;if(t.matches){return"matches"}if(t.matchesSelector){return"matchesSelector"}var e=["webkit","moz","ms","o"];for(var i=0;i<e.length;i++){var n=e[i];var s=n+"MatchesSelector";if(t[s]){return s}}}();return function t(e,i){return e[n](i)}});(function(e,i){if(typeof define=="function"&&define.amd){define("fizzy-ui-utils/utils",["desandro-matches-selector/matches-selector"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("desandro-matches-selector"))}else{e.fizzyUIUtils=i(e,e.matchesSelector)}})(window,function t(h,r){var c={};c.extend=function(t,e){for(var i in e){t[i]=e[i]}return t};c.modulo=function(t,e){return(t%e+e)%e};var i=Array.prototype.slice;c.makeArray=function(t){if(Array.isArray(t)){return t}if(t===null||t===undefined){return[]}var e=typeof t=="object"&&typeof t.length=="number";if(e){return i.call(t)}return[t]};c.removeFrom=function(t,e){var i=t.indexOf(e);if(i!=-1){t.splice(i,1)}};c.getParent=function(t,e){while(t.parentNode&&t!=document.body){t=t.parentNode;if(r(t,e)){return t}}};c.getQueryElement=function(t){if(typeof t=="string"){return document.querySelector(t)}return t};c.handleEvent=function(t){var e="on"+t.type;if(this[e]){this[e](t)}};c.filterFindElements=function(t,n){t=c.makeArray(t);var s=[];t.forEach(function(t){if(!(t instanceof HTMLElement)){return}if(!n){s.push(t);return}if(r(t,n)){s.push(t)}var e=t.querySelectorAll(n);for(var i=0;i<e.length;i++){s.push(e[i])}});return s};c.debounceMethod=function(t,e,n){n=n||100;var s=t.prototype[e];var r=e+"Timeout";t.prototype[e]=function(){var t=this[r];clearTimeout(t);var e=arguments;var i=this;this[r]=setTimeout(function(){s.apply(i,e);delete i[r]},n)}};c.docReady=function(t){var e=document.readyState;if(e=="complete"||e=="interactive"){setTimeout(t)}else{document.addEventListener("DOMContentLoaded",t)}};c.toDashed=function(t){return t.replace(/(.)([A-Z])/g,function(t,e,i){return e+"-"+i}).toLowerCase()};var u=h.console;c.htmlInit=function(a,l){c.docReady(function(){var t=c.toDashed(l);var s="data-"+t;var e=document.querySelectorAll("["+s+"]");var i=document.querySelectorAll(".js-"+t);var n=c.makeArray(e).concat(c.makeArray(i));var r=s+"-options";var o=h.jQuery;n.forEach(function(e){var t=e.getAttribute(s)||e.getAttribute(r);var i;try{i=t&&JSON.parse(t)}catch(t){if(u){u.error("Error parsing "+s+" on "+e.className+": "+t)}return}var n=new a(e,i);if(o){o.data(e,l,n)}})})};return c});(function(e,i){if(typeof define=="function"&&define.amd){define("flickity/js/cell",["get-size/get-size"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("get-size"))}else{e.Flickity=e.Flickity||{};e.Flickity.Cell=i(e,e.getSize)}})(window,function t(e,i){function n(t,e){this.element=t;this.parent=e;this.create()}var s=n.prototype;s.create=function(){this.element.style.position="absolute";this.element.setAttribute("aria-hidden","true");this.x=0;this.shift=0};s.destroy=function(){this.unselect();this.element.style.position="";var t=this.parent.originSide;this.element.style[t]="";this.element.removeAttribute("aria-hidden")};s.getSize=function(){this.size=i(this.element)};s.setPosition=function(t){this.x=t;this.updateTarget();this.renderPosition(t)};s.updateTarget=s.setDefaultTarget=function(){var t=this.parent.originSide=="left"?"marginLeft":"marginRight";this.target=this.x+this.size[t]+this.size.width*this.parent.cellAlign};s.renderPosition=function(t){var e=this.parent.originSide;this.element.style[e]=this.parent.getPositionValue(t)};s.select=function(){this.element.classList.add("is-selected");this.element.removeAttribute("aria-hidden")};s.unselect=function(){this.element.classList.remove("is-selected");this.element.setAttribute("aria-hidden","true")};s.wrapShift=function(t){this.shift=t;this.renderPosition(this.x+this.parent.slideableWidth*t)};s.remove=function(){this.element.parentNode.removeChild(this.element)};return n});(function(t,e){if(typeof define=="function"&&define.amd){define("flickity/js/slide",e)}else if(typeof module=="object"&&module.exports){module.exports=e()}else{t.Flickity=t.Flickity||{};t.Flickity.Slide=e()}})(window,function t(){"use strict";function e(t){this.parent=t;this.isOriginLeft=t.originSide=="left";this.cells=[];this.outerWidth=0;this.height=0}var i=e.prototype;i.addCell=function(t){this.cells.push(t);this.outerWidth+=t.size.outerWidth;this.height=Math.max(t.size.outerHeight,this.height);if(this.cells.length==1){this.x=t.x;var e=this.isOriginLeft?"marginLeft":"marginRight";this.firstMargin=t.size[e]}};i.updateTarget=function(){var t=this.isOriginLeft?"marginRight":"marginLeft";var e=this.getLastCell();var i=e?e.size[t]:0;var n=this.outerWidth-(this.firstMargin+i);this.target=this.x+this.firstMargin+n*this.parent.cellAlign};i.getLastCell=function(){return this.cells[this.cells.length-1]};i.select=function(){this.cells.forEach(function(t){t.select()})};i.unselect=function(){this.cells.forEach(function(t){t.unselect()})};i.getCellElements=function(){return this.cells.map(function(t){return t.element})};return e});(function(e,i){if(typeof define=="function"&&define.amd){define("flickity/js/animate",["fizzy-ui-utils/utils"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("fizzy-ui-utils"))}else{e.Flickity=e.Flickity||{};e.Flickity.animatePrototype=i(e,e.fizzyUIUtils)}})(window,function t(e,i){var n={};n.startAnimation=function(){if(this.isAnimating){return}this.isAnimating=true;this.restingFrames=0;this.animate()};n.animate=function(){this.applyDragForce();this.applySelectedAttraction();var t=this.x;this.integratePhysics();this.positionSlider();this.settle(t);if(this.isAnimating){var e=this;requestAnimationFrame(function t(){e.animate()})}};n.positionSlider=function(){var t=this.x;if(this.options.wrapAround&&this.cells.length>1){t=i.modulo(t,this.slideableWidth);t-=this.slideableWidth;this.shiftWrapCells(t)}this.setTranslateX(t,this.isAnimating);this.dispatchScrollEvent()};n.setTranslateX=function(t,e){t+=this.cursorPosition;t=this.options.rightToLeft?-t:t;var i=this.getPositionValue(t);this.slider.style.transform=e?"translate3d("+i+",0,0)":"translateX("+i+")"};n.dispatchScrollEvent=function(){var t=this.slides[0];if(!t){return}var e=-this.x-t.target;var i=e/this.slidesWidth;this.dispatchEvent("scroll",null,[i,e])};n.positionSliderAtSelected=function(){if(!this.cells.length){return}this.x=-this.selectedSlide.target;this.velocity=0;this.positionSlider()};n.getPositionValue=function(t){if(this.options.percentPosition){return Math.round(t/this.size.innerWidth*1e4)*.01+"%"}else{return Math.round(t)+"px"}};n.settle=function(t){var e=!this.isPointerDown&&Math.round(this.x*100)==Math.round(t*100);if(e){this.restingFrames++}if(this.restingFrames>2){this.isAnimating=false;delete this.isFreeScrolling;this.positionSlider();this.dispatchEvent("settle",null,[this.selectedIndex])}};n.shiftWrapCells=function(t){var e=this.cursorPosition+t;this._shiftCells(this.beforeShiftCells,e,-1);var i=this.size.innerWidth-(t+this.slideableWidth+this.cursorPosition);this._shiftCells(this.afterShiftCells,i,1)};n._shiftCells=function(t,e,i){for(var n=0;n<t.length;n++){var s=t[n];var r=e>0?i:0;s.wrapShift(r);e-=s.size.outerWidth}};n._unshiftCells=function(t){if(!t||!t.length){return}for(var e=0;e<t.length;e++){t[e].wrapShift(0)}};n.integratePhysics=function(){this.x+=this.velocity;this.velocity*=this.getFrictionFactor()};n.applyForce=function(t){this.velocity+=t};n.getFrictionFactor=function(){return 1-this.options[this.isFreeScrolling?"freeScrollFriction":"friction"]};n.getRestingPosition=function(){return this.x+this.velocity/(1-this.getFrictionFactor())};n.applyDragForce=function(){if(!this.isDraggable||!this.isPointerDown){return}var t=this.dragX-this.x;var e=t-this.velocity;this.applyForce(e)};n.applySelectedAttraction=function(){var t=this.isDraggable&&this.isPointerDown;if(t||this.isFreeScrolling||!this.slides.length){return}var e=this.selectedSlide.target*-1-this.x;var i=e*this.options.selectedAttraction;this.applyForce(i)};return n});(function(o,a){if(typeof define=="function"&&define.amd){define("flickity/js/flickity",["ev-emitter/ev-emitter","get-size/get-size","fizzy-ui-utils/utils","./cell","./slide","./animate"],function(t,e,i,n,s,r){return a(o,t,e,i,n,s,r)})}else if(typeof module=="object"&&module.exports){module.exports=a(o,require("ev-emitter"),require("get-size"),require("fizzy-ui-utils"),require("./cell"),require("./slide"),require("./animate"))}else{var t=o.Flickity;o.Flickity=a(o,o.EvEmitter,o.getSize,o.fizzyUIUtils,t.Cell,t.Slide,t.animatePrototype)}})(window,function t(n,e,i,a,s,o,r){var l=n.jQuery;var h=n.getComputedStyle;var c=n.console;function u(t,e){t=a.makeArray(t);while(t.length){e.appendChild(t.shift())}}var d=0;var f={};function p(t,e){var i=a.getQueryElement(t);if(!i){if(c){c.error("Bad element for Flickity: "+(i||t))}return}this.element=i;if(this.element.flickityGUID){var n=f[this.element.flickityGUID];if(n)n.option(e);return n}if(l){this.$element=l(this.element)}this.options=a.extend({},this.constructor.defaults);this.option(e);this._create()}p.defaults={accessibility:true,cellAlign:"center",freeScrollFriction:.075,friction:.28,namespaceJQueryEvents:true,percentPosition:true,resize:true,selectedAttraction:.025,setGallerySize:true};p.createMethods=[];var v=p.prototype;a.extend(v,e.prototype);v._create=function(){var t=this.guid=++d;this.element.flickityGUID=t;f[t]=this;this.selectedIndex=0;this.restingFrames=0;this.x=0;this.velocity=0;this.originSide=this.options.rightToLeft?"right":"left";this.viewport=document.createElement("div");this.viewport.className="flickity-viewport";this._createSlider();if(this.options.resize||this.options.watchCSS){n.addEventListener("resize",this)}for(var e in this.options.on){var i=this.options.on[e];this.on(e,i)}p.createMethods.forEach(function(t){this[t]()},this);if(this.options.watchCSS){this.watchCSS()}else{this.activate()}};v.option=function(t){a.extend(this.options,t)};v.activate=function(){if(this.isActive){return}this.isActive=true;this.element.classList.add("flickity-enabled");if(this.options.rightToLeft){this.element.classList.add("flickity-rtl")}this.getSize();var t=this._filterFindCellElements(this.element.children);u(t,this.slider);this.viewport.appendChild(this.slider);this.element.appendChild(this.viewport);this.reloadCells();if(this.options.accessibility){this.element.tabIndex=0;this.element.addEventListener("keydown",this)}this.emitEvent("activate");this.selectInitialIndex();this.isInitActivated=true;this.dispatchEvent("ready")};v._createSlider=function(){var t=document.createElement("div");t.className="flickity-slider";t.style[this.originSide]=0;this.slider=t};v._filterFindCellElements=function(t){return a.filterFindElements(t,this.options.cellSelector)};v.reloadCells=function(){this.cells=this._makeCells(this.slider.children);this.positionCells();this._getWrapShiftCells();this.setGallerySize()};v._makeCells=function(t){var e=this._filterFindCellElements(t);var i=e.map(function(t){return new s(t,this)},this);return i};v.getLastCell=function(){return this.cells[this.cells.length-1]};v.getLastSlide=function(){return this.slides[this.slides.length-1]};v.positionCells=function(){this._sizeCells(this.cells);this._positionCells(0)};v._positionCells=function(t){t=t||0;this.maxCellHeight=t?this.maxCellHeight||0:0;var e=0;if(t>0){var i=this.cells[t-1];e=i.x+i.size.outerWidth}var n=this.cells.length;for(var s=t;s<n;s++){var r=this.cells[s];r.setPosition(e);e+=r.size.outerWidth;this.maxCellHeight=Math.max(r.size.outerHeight,this.maxCellHeight)}this.slideableWidth=e;this.updateSlides();this._containSlides();this.slidesWidth=n?this.getLastSlide().target-this.slides[0].target:0};v._sizeCells=function(t){t.forEach(function(t){t.getSize()})};v.updateSlides=function(){this.slides=[];if(!this.cells.length){return}var n=new o(this);this.slides.push(n);var t=this.originSide=="left";var s=t?"marginRight":"marginLeft";var r=this._getCanCellFit();this.cells.forEach(function(t,e){if(!n.cells.length){n.addCell(t);return}var i=n.outerWidth-n.firstMargin+(t.size.outerWidth-t.size[s]);if(r.call(this,e,i)){n.addCell(t)}else{n.updateTarget();n=new o(this);this.slides.push(n);n.addCell(t)}},this);n.updateTarget();this.updateSelectedSlide()};v._getCanCellFit=function(){var t=this.options.groupCells;if(!t){return function(){return false}}else if(typeof t=="number"){var e=parseInt(t,10);return function(t){return t%e!==0}}var i=typeof t=="string"&&t.match(/^(\d+)%$/);var n=i?parseInt(i[1],10)/100:1;return function(t,e){return e<=(this.size.innerWidth+1)*n}};v._init=v.reposition=function(){this.positionCells();this.positionSliderAtSelected()};v.getSize=function(){this.size=i(this.element);this.setCellAlign();this.cursorPosition=this.size.innerWidth*this.cellAlign};var g={center:{left:.5,right:.5},left:{left:0,right:1},right:{right:0,left:1}};v.setCellAlign=function(){var t=g[this.options.cellAlign];this.cellAlign=t?t[this.originSide]:this.options.cellAlign};v.setGallerySize=function(){if(this.options.setGallerySize){var t=this.options.adaptiveHeight&&this.selectedSlide?this.selectedSlide.height:this.maxCellHeight;this.viewport.style.height=t+"px"}};v._getWrapShiftCells=function(){if(!this.options.wrapAround){return}this._unshiftCells(this.beforeShiftCells);this._unshiftCells(this.afterShiftCells);var t=this.cursorPosition;var e=this.cells.length-1;this.beforeShiftCells=this._getGapCells(t,e,-1);t=this.size.innerWidth-this.cursorPosition;this.afterShiftCells=this._getGapCells(t,0,1)};v._getGapCells=function(t,e,i){var n=[];while(t>0){var s=this.cells[e];if(!s){break}n.push(s);e+=i;t-=s.size.outerWidth}return n};v._containSlides=function(){if(!this.options.contain||this.options.wrapAround||!this.cells.length){return}var t=this.options.rightToLeft;var e=t?"marginRight":"marginLeft";var i=t?"marginLeft":"marginRight";var n=this.slideableWidth-this.getLastCell().size[i];var s=n<this.size.innerWidth;var r=this.cursorPosition+this.cells[0].size[e];var o=n-this.size.innerWidth*(1-this.cellAlign);this.slides.forEach(function(t){if(s){t.target=n*this.cellAlign}else{t.target=Math.max(t.target,r);t.target=Math.min(t.target,o)}},this)};v.dispatchEvent=function(t,e,i){var n=e?[e].concat(i):i;this.emitEvent(t,n);if(l&&this.$element){t+=this.options.namespaceJQueryEvents?".flickity":"";var s=t;if(e){var r=new l.Event(e);r.type=t;s=r}this.$element.trigger(s,i)}};v.select=function(t,e,i){if(!this.isActive){return}t=parseInt(t,10);this._wrapSelect(t);if(this.options.wrapAround||e){t=a.modulo(t,this.slides.length)}if(!this.slides[t]){return}var n=this.selectedIndex;this.selectedIndex=t;this.updateSelectedSlide();if(i){this.positionSliderAtSelected()}else{this.startAnimation()}if(this.options.adaptiveHeight){this.setGallerySize()}this.dispatchEvent("select",null,[t]);if(t!=n){this.dispatchEvent("change",null,[t])}this.dispatchEvent("cellSelect")};v._wrapSelect=function(t){var e=this.slides.length;var i=this.options.wrapAround&&e>1;if(!i){return t}var n=a.modulo(t,e);var s=Math.abs(n-this.selectedIndex);var r=Math.abs(n+e-this.selectedIndex);var o=Math.abs(n-e-this.selectedIndex);if(!this.isDragSelect&&r<s){t+=e}else if(!this.isDragSelect&&o<s){t-=e}if(t<0){this.x-=this.slideableWidth}else if(t>=e){this.x+=this.slideableWidth}};v.previous=function(t,e){this.select(this.selectedIndex-1,t,e)};v.next=function(t,e){this.select(this.selectedIndex+1,t,e)};v.updateSelectedSlide=function(){var t=this.slides[this.selectedIndex];if(!t){return}this.unselectSelectedSlide();this.selectedSlide=t;t.select();this.selectedCells=t.cells;this.selectedElements=t.getCellElements();this.selectedCell=t.cells[0];this.selectedElement=this.selectedElements[0]};v.unselectSelectedSlide=function(){if(this.selectedSlide){this.selectedSlide.unselect()}};v.selectInitialIndex=function(){var t=this.options.initialIndex;if(this.isInitActivated){this.select(this.selectedIndex,false,true);return}if(t&&typeof t=="string"){var e=this.queryCell(t);if(e){this.selectCell(t,false,true);return}}var i=0;if(t&&this.slides[t]){i=t}this.select(i,false,true)};v.selectCell=function(t,e,i){var n=this.queryCell(t);if(!n){return}var s=this.getCellSlideIndex(n);this.select(s,e,i)};v.getCellSlideIndex=function(t){for(var e=0;e<this.slides.length;e++){var i=this.slides[e];var n=i.cells.indexOf(t);if(n!=-1){return e}}};v.getCell=function(t){for(var e=0;e<this.cells.length;e++){var i=this.cells[e];if(i.element==t){return i}}};v.getCells=function(t){t=a.makeArray(t);var i=[];t.forEach(function(t){var e=this.getCell(t);if(e){i.push(e)}},this);return i};v.getCellElements=function(){return this.cells.map(function(t){return t.element})};v.getParentCell=function(t){var e=this.getCell(t);if(e){return e}t=a.getParent(t,".flickity-slider > *");return this.getCell(t)};v.getAdjacentCellElements=function(t,e){if(!t){return this.selectedSlide.getCellElements()}e=e===undefined?this.selectedIndex:e;var i=this.slides.length;if(1+t*2>=i){return this.getCellElements()}var n=[];for(var s=e-t;s<=e+t;s++){var r=this.options.wrapAround?a.modulo(s,i):s;var o=this.slides[r];if(o){n=n.concat(o.getCellElements())}}return n};v.queryCell=function(t){if(typeof t=="number"){return this.cells[t]}if(typeof t=="string"){if(t.match(/^[#.]?[\d/]/)){return}t=this.element.querySelector(t)}return this.getCell(t)};v.uiChange=function(){this.emitEvent("uiChange")};v.childUIPointerDown=function(t){if(t.type!="touchstart"){t.preventDefault()}this.focus()};v.onresize=function(){this.watchCSS();this.resize()};a.debounceMethod(p,"onresize",150);v.resize=function(){if(!this.isActive){return}this.getSize();if(this.options.wrapAround){this.x=a.modulo(this.x,this.slideableWidth)}this.positionCells();this._getWrapShiftCells();this.setGallerySize();this.emitEvent("resize");var t=this.selectedElements&&this.selectedElements[0];this.selectCell(t,false,true)};v.watchCSS=function(){var t=this.options.watchCSS;if(!t){return}var e=h(this.element,":after").content;if(e.indexOf("flickity")!=-1){this.activate()}else{this.deactivate()}};v.onkeydown=function(t){var e=document.activeElement&&document.activeElement!=this.element;if(!this.options.accessibility||e){return}var i=p.keyboardHandlers[t.keyCode];if(i){i.call(this)}};p.keyboardHandlers={37:function(){var t=this.options.rightToLeft?"next":"previous";this.uiChange();this[t]()},39:function(){var t=this.options.rightToLeft?"previous":"next";this.uiChange();this[t]()}};v.focus=function(){var t=n.pageYOffset;this.element.focus({preventScroll:true});if(n.pageYOffset!=t){n.scrollTo(n.pageXOffset,t)}};v.deactivate=function(){if(!this.isActive){return}this.element.classList.remove("flickity-enabled");this.element.classList.remove("flickity-rtl");this.unselectSelectedSlide();this.cells.forEach(function(t){t.destroy()});this.element.removeChild(this.viewport);u(this.slider.children,this.element);if(this.options.accessibility){this.element.removeAttribute("tabIndex");this.element.removeEventListener("keydown",this)}this.isActive=false;this.emitEvent("deactivate")};v.destroy=function(){this.deactivate();n.removeEventListener("resize",this);this.allOff();this.emitEvent("destroy");if(l&&this.$element){l.removeData(this.element,"flickity")}delete this.element.flickityGUID;delete f[this.guid]};a.extend(v,r);p.data=function(t){t=a.getQueryElement(t);var e=t&&t.flickityGUID;return e&&f[e]};a.htmlInit(p,"flickity");if(l&&l.bridget){l.bridget("flickity",p)}p.setJQuery=function(t){l=t};p.Cell=s;p.Slide=o;return p});
/*!
 * Unipointer v2.3.0
 * base class for doing one thing with pointer event
 * MIT license
 */
(function(e,i){if(typeof define=="function"&&define.amd){define("unipointer/unipointer",["ev-emitter/ev-emitter"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("ev-emitter"))}else{e.Unipointer=i(e,e.EvEmitter)}})(window,function t(s,e){function i(){}function n(){}var r=n.prototype=Object.create(e.prototype);r.bindStartEvent=function(t){this._bindStartEvent(t,true)};r.unbindStartEvent=function(t){this._bindStartEvent(t,false)};r._bindStartEvent=function(t,e){e=e===undefined?true:e;var i=e?"addEventListener":"removeEventListener";var n="mousedown";if(s.PointerEvent){n="pointerdown"}else if("ontouchstart"in s){n="touchstart"}t[i](n,this)};r.handleEvent=function(t){var e="on"+t.type;if(this[e]){this[e](t)}};r.getTouch=function(t){for(var e=0;e<t.length;e++){var i=t[e];if(i.identifier==this.pointerIdentifier){return i}}};r.onmousedown=function(t){var e=t.button;if(e&&(e!==0&&e!==1)){return}this._pointerDown(t,t)};r.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])};r.onpointerdown=function(t){this._pointerDown(t,t)};r._pointerDown=function(t,e){if(t.button||this.isPointerDown){return}this.isPointerDown=true;this.pointerIdentifier=e.pointerId!==undefined?e.pointerId:e.identifier;this.pointerDown(t,e)};r.pointerDown=function(t,e){this._bindPostStartEvents(t);this.emitEvent("pointerDown",[t,e])};var o={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]};r._bindPostStartEvents=function(t){if(!t){return}var e=o[t.type];e.forEach(function(t){s.addEventListener(t,this)},this);this._boundPointerEvents=e};r._unbindPostStartEvents=function(){if(!this._boundPointerEvents){return}this._boundPointerEvents.forEach(function(t){s.removeEventListener(t,this)},this);delete this._boundPointerEvents};r.onmousemove=function(t){this._pointerMove(t,t)};r.onpointermove=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerMove(t,t)}};r.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerMove(t,e)}};r._pointerMove=function(t,e){this.pointerMove(t,e)};r.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])};r.onmouseup=function(t){this._pointerUp(t,t)};r.onpointerup=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerUp(t,t)}};r.ontouchend=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerUp(t,e)}};r._pointerUp=function(t,e){this._pointerDone();this.pointerUp(t,e)};r.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])};r._pointerDone=function(){this._pointerReset();this._unbindPostStartEvents();this.pointerDone()};r._pointerReset=function(){this.isPointerDown=false;delete this.pointerIdentifier};r.pointerDone=i;r.onpointercancel=function(t){if(t.pointerId==this.pointerIdentifier){this._pointerCancel(t,t)}};r.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);if(e){this._pointerCancel(t,e)}};r._pointerCancel=function(t,e){this._pointerDone();this.pointerCancel(t,e)};r.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])};n.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}};return n});
/*!
 * Unidragger v2.3.1
 * Draggable base class
 * MIT license
 */
(function(e,i){if(typeof define=="function"&&define.amd){define("unidragger/unidragger",["unipointer/unipointer"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("unipointer"))}else{e.Unidragger=i(e,e.Unipointer)}})(window,function t(r,e){function i(){}var n=i.prototype=Object.create(e.prototype);n.bindHandles=function(){this._bindHandles(true)};n.unbindHandles=function(){this._bindHandles(false)};n._bindHandles=function(t){t=t===undefined?true:t;var e=t?"addEventListener":"removeEventListener";var i=t?this._touchActionValue:"";for(var n=0;n<this.handles.length;n++){var s=this.handles[n];this._bindStartEvent(s,t);s[e]("click",this);if(r.PointerEvent){s.style.touchAction=i}}};n._touchActionValue="none";n.pointerDown=function(t,e){var i=this.okayPointerDown(t);if(!i){return}this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY};t.preventDefault();this.pointerDownBlur();this._bindPostStartEvents(t);this.emitEvent("pointerDown",[t,e])};var s={TEXTAREA:true,INPUT:true,SELECT:true,OPTION:true};var o={radio:true,checkbox:true,button:true,submit:true,image:true,file:true};n.okayPointerDown=function(t){var e=s[t.target.nodeName];var i=o[t.target.type];var n=!e||i;if(!n){this._pointerReset()}return n};n.pointerDownBlur=function(){var t=document.activeElement;var e=t&&t.blur&&t!=document.body;if(e){t.blur()}};n.pointerMove=function(t,e){var i=this._dragPointerMove(t,e);this.emitEvent("pointerMove",[t,e,i]);this._dragMove(t,e,i)};n._dragPointerMove=function(t,e){var i={x:e.pageX-this.pointerDownPointer.pageX,y:e.pageY-this.pointerDownPointer.pageY};if(!this.isDragging&&this.hasDragStarted(i)){this._dragStart(t,e)}return i};n.hasDragStarted=function(t){return Math.abs(t.x)>3||Math.abs(t.y)>3};n.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e]);this._dragPointerUp(t,e)};n._dragPointerUp=function(t,e){if(this.isDragging){this._dragEnd(t,e)}else{this._staticClick(t,e)}};n._dragStart=function(t,e){this.isDragging=true;this.isPreventingClicks=true;this.dragStart(t,e)};n.dragStart=function(t,e){this.emitEvent("dragStart",[t,e])};n._dragMove=function(t,e,i){if(!this.isDragging){return}this.dragMove(t,e,i)};n.dragMove=function(t,e,i){t.preventDefault();this.emitEvent("dragMove",[t,e,i])};n._dragEnd=function(t,e){this.isDragging=false;setTimeout(function(){delete this.isPreventingClicks}.bind(this));this.dragEnd(t,e)};n.dragEnd=function(t,e){this.emitEvent("dragEnd",[t,e])};n.onclick=function(t){if(this.isPreventingClicks){t.preventDefault()}};n._staticClick=function(t,e){if(this.isIgnoringMouseUp&&t.type=="mouseup"){return}this.staticClick(t,e);if(t.type!="mouseup"){this.isIgnoringMouseUp=true;setTimeout(function(){delete this.isIgnoringMouseUp}.bind(this),400)}};n.staticClick=function(t,e){this.emitEvent("staticClick",[t,e])};i.getPointerPoint=e.getPointerPoint;return i});(function(n,s){if(typeof define=="function"&&define.amd){define("flickity/js/drag",["./flickity","unidragger/unidragger","fizzy-ui-utils/utils"],function(t,e,i){return s(n,t,e,i)})}else if(typeof module=="object"&&module.exports){module.exports=s(n,require("./flickity"),require("unidragger"),require("fizzy-ui-utils"))}else{n.Flickity=s(n,n.Flickity,n.Unidragger,n.fizzyUIUtils)}})(window,function t(n,e,i,a){a.extend(e.defaults,{draggable:">1",dragThreshold:3});e.createMethods.push("_createDrag");var s=e.prototype;a.extend(s,i.prototype);s._touchActionValue="pan-y";var r="createTouch"in document;var o=false;s._createDrag=function(){this.on("activate",this.onActivateDrag);this.on("uiChange",this._uiChangeDrag);this.on("deactivate",this.onDeactivateDrag);this.on("cellChange",this.updateDraggable);if(r&&!o){n.addEventListener("touchmove",function(){});o=true}};s.onActivateDrag=function(){this.handles=[this.viewport];this.bindHandles();this.updateDraggable()};s.onDeactivateDrag=function(){this.unbindHandles();this.element.classList.remove("is-draggable")};s.updateDraggable=function(){if(this.options.draggable==">1"){this.isDraggable=this.slides.length>1}else{this.isDraggable=this.options.draggable}if(this.isDraggable){this.element.classList.add("is-draggable")}else{this.element.classList.remove("is-draggable")}};s.bindDrag=function(){this.options.draggable=true;this.updateDraggable()};s.unbindDrag=function(){this.options.draggable=false;this.updateDraggable()};s._uiChangeDrag=function(){delete this.isFreeScrolling};s.pointerDown=function(t,e){if(!this.isDraggable){this._pointerDownDefault(t,e);return}var i=this.okayPointerDown(t);if(!i){return}this._pointerDownPreventDefault(t);this.pointerDownFocus(t);if(document.activeElement!=this.element){this.pointerDownBlur()}this.dragX=this.x;this.viewport.classList.add("is-pointer-down");this.pointerDownScroll=h();n.addEventListener("scroll",this);this._pointerDownDefault(t,e)};s._pointerDownDefault=function(t,e){this.pointerDownPointer={pageX:e.pageX,pageY:e.pageY};this._bindPostStartEvents(t);this.dispatchEvent("pointerDown",t,[e])};var l={INPUT:true,TEXTAREA:true,SELECT:true};s.pointerDownFocus=function(t){var e=l[t.target.nodeName];if(!e){this.focus()}};s._pointerDownPreventDefault=function(t){var e=t.type=="touchstart";var i=t.pointerType=="touch";var n=l[t.target.nodeName];if(!e&&!i&&!n){t.preventDefault()}};s.hasDragStarted=function(t){return Math.abs(t.x)>this.options.dragThreshold};s.pointerUp=function(t,e){delete this.isTouchScrolling;this.viewport.classList.remove("is-pointer-down");this.dispatchEvent("pointerUp",t,[e]);this._dragPointerUp(t,e)};s.pointerDone=function(){n.removeEventListener("scroll",this);delete this.pointerDownScroll};s.dragStart=function(t,e){if(!this.isDraggable){return}this.dragStartPosition=this.x;this.startAnimation();n.removeEventListener("scroll",this);this.dispatchEvent("dragStart",t,[e])};s.pointerMove=function(t,e){var i=this._dragPointerMove(t,e);this.dispatchEvent("pointerMove",t,[e,i]);this._dragMove(t,e,i)};s.dragMove=function(t,e,i){if(!this.isDraggable){return}t.preventDefault();this.previousDragX=this.dragX;var n=this.options.rightToLeft?-1:1;if(this.options.wrapAround){i.x%=this.slideableWidth}var s=this.dragStartPosition+i.x*n;if(!this.options.wrapAround&&this.slides.length){var r=Math.max(-this.slides[0].target,this.dragStartPosition);s=s>r?(s+r)*.5:s;var o=Math.min(-this.getLastSlide().target,this.dragStartPosition);s=s<o?(s+o)*.5:s}this.dragX=s;this.dragMoveTime=new Date;this.dispatchEvent("dragMove",t,[e,i])};s.dragEnd=function(t,e){if(!this.isDraggable){return}if(this.options.freeScroll){this.isFreeScrolling=true}var i=this.dragEndRestingSelect();if(this.options.freeScroll&&!this.options.wrapAround){var n=this.getRestingPosition();this.isFreeScrolling=-n>this.slides[0].target&&-n<this.getLastSlide().target}else if(!this.options.freeScroll&&i==this.selectedIndex){i+=this.dragEndBoostSelect()}delete this.previousDragX;this.isDragSelect=this.options.wrapAround;this.select(i);delete this.isDragSelect;this.dispatchEvent("dragEnd",t,[e])};s.dragEndRestingSelect=function(){var t=this.getRestingPosition();var e=Math.abs(this.getSlideDistance(-t,this.selectedIndex));var i=this._getClosestResting(t,e,1);var n=this._getClosestResting(t,e,-1);var s=i.distance<n.distance?i.index:n.index;return s};s._getClosestResting=function(t,e,i){var n=this.selectedIndex;var s=Infinity;var r=this.options.contain&&!this.options.wrapAround?function(t,e){return t<=e}:function(t,e){return t<e};while(r(e,s)){n+=i;s=e;e=this.getSlideDistance(-t,n);if(e===null){break}e=Math.abs(e)}return{distance:s,index:n-i}};s.getSlideDistance=function(t,e){var i=this.slides.length;var n=this.options.wrapAround&&i>1;var s=n?a.modulo(e,i):e;var r=this.slides[s];if(!r){return null}var o=n?this.slideableWidth*Math.floor(e/i):0;return t-(r.target+o)};s.dragEndBoostSelect=function(){if(this.previousDragX===undefined||!this.dragMoveTime||new Date-this.dragMoveTime>100){return 0}var t=this.getSlideDistance(-this.dragX,this.selectedIndex);var e=this.previousDragX-this.dragX;if(t>0&&e>0){return 1}else if(t<0&&e<0){return-1}return 0};s.staticClick=function(t,e){var i=this.getParentCell(t.target);var n=i&&i.element;var s=i&&this.cells.indexOf(i);this.dispatchEvent("staticClick",t,[e,n,s])};s.onscroll=function(){var t=h();var e=this.pointerDownScroll.x-t.x;var i=this.pointerDownScroll.y-t.y;if(Math.abs(e)>3||Math.abs(i)>3){this._pointerDone()}};function h(){return{x:n.pageXOffset,y:n.pageYOffset}}return e});(function(n,s){if(typeof define=="function"&&define.amd){define("flickity/js/prev-next-button",["./flickity","unipointer/unipointer","fizzy-ui-utils/utils"],function(t,e,i){return s(n,t,e,i)})}else if(typeof module=="object"&&module.exports){module.exports=s(n,require("./flickity"),require("unipointer"),require("fizzy-ui-utils"))}else{s(n,n.Flickity,n.Unipointer,n.fizzyUIUtils)}})(window,function t(e,i,n,s){"use strict";var r="http://www.w3.org/2000/svg";function o(t,e){this.direction=t;this.parent=e;this._create()}o.prototype=Object.create(n.prototype);o.prototype._create=function(){this.isEnabled=true;this.isPrevious=this.direction==-1;var t=this.parent.options.rightToLeft?1:-1;this.isLeft=this.direction==t;var e=this.element=document.createElement("button");e.className="flickity-button flickity-prev-next-button";e.className+=this.isPrevious?" previous":" next";e.setAttribute("type","button");this.disable();e.setAttribute("aria-label",this.isPrevious?"Previous":"Next");var i=this.createSVG();e.appendChild(i);this.parent.on("select",this.update.bind(this));this.on("pointerDown",this.parent.childUIPointerDown.bind(this.parent))};o.prototype.activate=function(){this.bindStartEvent(this.element);this.element.addEventListener("click",this);this.parent.element.appendChild(this.element)};o.prototype.deactivate=function(){this.parent.element.removeChild(this.element);this.unbindStartEvent(this.element);this.element.removeEventListener("click",this)};o.prototype.createSVG=function(){var t=document.createElementNS(r,"svg");t.setAttribute("class","flickity-button-icon");t.setAttribute("viewBox","0 0 100 100");var e=document.createElementNS(r,"path");var i=a(this.parent.options.arrowShape);e.setAttribute("d",i);e.setAttribute("class","arrow");if(!this.isLeft){e.setAttribute("transform","translate(100, 100) rotate(180) ")}t.appendChild(e);return t};function a(t){if(typeof t=="string"){return t}return"M "+t.x0+",50"+" L "+t.x1+","+(t.y1+50)+" L "+t.x2+","+(t.y2+50)+" L "+t.x3+",50 "+" L "+t.x2+","+(50-t.y2)+" L "+t.x1+","+(50-t.y1)+" Z"}o.prototype.handleEvent=s.handleEvent;o.prototype.onclick=function(){if(!this.isEnabled){return}this.parent.uiChange();var t=this.isPrevious?"previous":"next";this.parent[t]()};o.prototype.enable=function(){if(this.isEnabled){return}this.element.disabled=false;this.isEnabled=true};o.prototype.disable=function(){if(!this.isEnabled){return}this.element.disabled=true;this.isEnabled=false};o.prototype.update=function(){var t=this.parent.slides;if(this.parent.options.wrapAround&&t.length>1){this.enable();return}var e=t.length?t.length-1:0;var i=this.isPrevious?0:e;var n=this.parent.selectedIndex==i?"disable":"enable";this[n]()};o.prototype.destroy=function(){this.deactivate();this.allOff()};s.extend(i.defaults,{prevNextButtons:true,arrowShape:{x0:10,x1:60,y1:50,x2:70,y2:40,x3:30}});i.createMethods.push("_createPrevNextButtons");var l=i.prototype;l._createPrevNextButtons=function(){if(!this.options.prevNextButtons){return}this.prevButton=new o(-1,this);this.nextButton=new o(1,this);this.on("activate",this.activatePrevNextButtons)};l.activatePrevNextButtons=function(){this.prevButton.activate();this.nextButton.activate();this.on("deactivate",this.deactivatePrevNextButtons)};l.deactivatePrevNextButtons=function(){this.prevButton.deactivate();this.nextButton.deactivate();this.off("deactivate",this.deactivatePrevNextButtons)};i.PrevNextButton=o;return i});(function(n,s){if(typeof define=="function"&&define.amd){define("flickity/js/page-dots",["./flickity","unipointer/unipointer","fizzy-ui-utils/utils"],function(t,e,i){return s(n,t,e,i)})}else if(typeof module=="object"&&module.exports){module.exports=s(n,require("./flickity"),require("unipointer"),require("fizzy-ui-utils"))}else{s(n,n.Flickity,n.Unipointer,n.fizzyUIUtils)}})(window,function t(e,i,n,s){function r(t){this.parent=t;this._create()}r.prototype=Object.create(n.prototype);r.prototype._create=function(){this.holder=document.createElement("ol");this.holder.className="flickity-page-dots";this.dots=[];this.handleClick=this.onClick.bind(this);this.on("pointerDown",this.parent.childUIPointerDown.bind(this.parent))};r.prototype.activate=function(){this.setDots();this.holder.addEventListener("click",this.handleClick);this.bindStartEvent(this.holder);this.parent.element.appendChild(this.holder)};r.prototype.deactivate=function(){this.holder.removeEventListener("click",this.handleClick);this.unbindStartEvent(this.holder);this.parent.element.removeChild(this.holder)};r.prototype.setDots=function(){var t=this.parent.slides.length-this.dots.length;if(t>0){this.addDots(t)}else if(t<0){this.removeDots(-t)}};r.prototype.addDots=function(t){var e=document.createDocumentFragment();var i=[];var n=this.dots.length;var s=n+t;for(var r=n;r<s;r++){var o=document.createElement("li");o.className="dot";o.setAttribute("aria-label","Page dot "+(r+1));e.appendChild(o);i.push(o)}this.holder.appendChild(e);this.dots=this.dots.concat(i)};r.prototype.removeDots=function(t){var e=this.dots.splice(this.dots.length-t,t);e.forEach(function(t){this.holder.removeChild(t)},this)};r.prototype.updateSelected=function(){if(this.selectedDot){this.selectedDot.className="dot";this.selectedDot.removeAttribute("aria-current")}if(!this.dots.length){return}this.selectedDot=this.dots[this.parent.selectedIndex];this.selectedDot.className="dot is-selected";this.selectedDot.setAttribute("aria-current","step")};r.prototype.onTap=r.prototype.onClick=function(t){var e=t.target;if(e.nodeName!="LI"){return}this.parent.uiChange();var i=this.dots.indexOf(e);this.parent.select(i)};r.prototype.destroy=function(){this.deactivate();this.allOff()};i.PageDots=r;s.extend(i.defaults,{pageDots:true});i.createMethods.push("_createPageDots");var o=i.prototype;o._createPageDots=function(){if(!this.options.pageDots){return}this.pageDots=new r(this);this.on("activate",this.activatePageDots);this.on("select",this.updateSelectedPageDots);this.on("cellChange",this.updatePageDots);this.on("resize",this.updatePageDots);this.on("deactivate",this.deactivatePageDots)};o.activatePageDots=function(){this.pageDots.activate()};o.updateSelectedPageDots=function(){this.pageDots.updateSelected()};o.updatePageDots=function(){this.pageDots.setDots()};o.deactivatePageDots=function(){this.pageDots.deactivate()};i.PageDots=r;return i});(function(t,n){if(typeof define=="function"&&define.amd){define("flickity/js/player",["ev-emitter/ev-emitter","fizzy-ui-utils/utils","./flickity"],function(t,e,i){return n(t,e,i)})}else if(typeof module=="object"&&module.exports){module.exports=n(require("ev-emitter"),require("fizzy-ui-utils"),require("./flickity"))}else{n(t.EvEmitter,t.fizzyUIUtils,t.Flickity)}})(window,function t(e,i,n){function s(t){this.parent=t;this.state="stopped";this.onVisibilityChange=this.visibilityChange.bind(this);this.onVisibilityPlay=this.visibilityPlay.bind(this)}s.prototype=Object.create(e.prototype);s.prototype.play=function(){if(this.state=="playing"){return}var t=document.hidden;if(t){document.addEventListener("visibilitychange",this.onVisibilityPlay);return}this.state="playing";document.addEventListener("visibilitychange",this.onVisibilityChange);this.tick()};s.prototype.tick=function(){if(this.state!="playing"){return}var t=this.parent.options.autoPlay;t=typeof t=="number"?t:3e3;var e=this;this.clear();this.timeout=setTimeout(function(){e.parent.next(true);e.tick()},t)};s.prototype.stop=function(){this.state="stopped";this.clear();document.removeEventListener("visibilitychange",this.onVisibilityChange)};s.prototype.clear=function(){clearTimeout(this.timeout)};s.prototype.pause=function(){if(this.state=="playing"){this.state="paused";this.clear()}};s.prototype.unpause=function(){if(this.state=="paused"){this.play()}};s.prototype.visibilityChange=function(){var t=document.hidden;this[t?"pause":"unpause"]()};s.prototype.visibilityPlay=function(){this.play();document.removeEventListener("visibilitychange",this.onVisibilityPlay)};i.extend(n.defaults,{pauseAutoPlayOnHover:true});n.createMethods.push("_createPlayer");var r=n.prototype;r._createPlayer=function(){this.player=new s(this);this.on("activate",this.activatePlayer);this.on("uiChange",this.stopPlayer);this.on("pointerDown",this.stopPlayer);this.on("deactivate",this.deactivatePlayer)};r.activatePlayer=function(){if(!this.options.autoPlay){return}this.player.play();this.element.addEventListener("mouseenter",this)};r.playPlayer=function(){this.player.play()};r.stopPlayer=function(){this.player.stop()};r.pausePlayer=function(){this.player.pause()};r.unpausePlayer=function(){this.player.unpause()};r.deactivatePlayer=function(){this.player.stop();this.element.removeEventListener("mouseenter",this)};r.onmouseenter=function(){if(!this.options.pauseAutoPlayOnHover){return}this.player.pause();this.element.addEventListener("mouseleave",this)};r.onmouseleave=function(){this.player.unpause();this.element.removeEventListener("mouseleave",this)};n.Player=s;return n});(function(i,n){if(typeof define=="function"&&define.amd){define("flickity/js/add-remove-cell",["./flickity","fizzy-ui-utils/utils"],function(t,e){return n(i,t,e)})}else if(typeof module=="object"&&module.exports){module.exports=n(i,require("./flickity"),require("fizzy-ui-utils"))}else{n(i,i.Flickity,i.fizzyUIUtils)}})(window,function t(e,i,n){function l(t){var e=document.createDocumentFragment();t.forEach(function(t){e.appendChild(t.element)});return e}var s=i.prototype;s.insert=function(t,e){var i=this._makeCells(t);if(!i||!i.length){return}var n=this.cells.length;e=e===undefined?n:e;var s=l(i);var r=e==n;if(r){this.slider.appendChild(s)}else{var o=this.cells[e].element;this.slider.insertBefore(s,o)}if(e===0){this.cells=i.concat(this.cells)}else if(r){this.cells=this.cells.concat(i)}else{var a=this.cells.splice(e,n-e);this.cells=this.cells.concat(i).concat(a)}this._sizeCells(i);this.cellChange(e,true)};s.append=function(t){this.insert(t,this.cells.length)};s.prepend=function(t){this.insert(t,0)};s.remove=function(t){var e=this.getCells(t);if(!e||!e.length){return}var i=this.cells.length-1;e.forEach(function(t){t.remove();var e=this.cells.indexOf(t);i=Math.min(e,i);n.removeFrom(this.cells,t)},this);this.cellChange(i,true)};s.cellSizeChange=function(t){var e=this.getCell(t);if(!e){return}e.getSize();var i=this.cells.indexOf(e);this.cellChange(i)};s.cellChange=function(t,e){var i=this.selectedElement;this._positionCells(t);this._getWrapShiftCells();this.setGallerySize();var n=this.getCell(i);if(n){this.selectedIndex=this.getCellSlideIndex(n)}this.selectedIndex=Math.min(this.slides.length-1,this.selectedIndex);this.emitEvent("cellChange",[t]);this.select(this.selectedIndex);if(e){this.positionSliderAtSelected()}};return i});(function(i,n){if(typeof define=="function"&&define.amd){define("flickity/js/lazyload",["./flickity","fizzy-ui-utils/utils"],function(t,e){return n(i,t,e)})}else if(typeof module=="object"&&module.exports){module.exports=n(i,require("./flickity"),require("fizzy-ui-utils"))}else{n(i,i.Flickity,i.fizzyUIUtils)}})(window,function t(e,i,o){"use strict";i.createMethods.push("_createLazyload");var n=i.prototype;n._createLazyload=function(){this.on("select",this.lazyLoad)};n.lazyLoad=function(){var t=this.options.lazyLoad;if(!t){return}var e=typeof t=="number"?t:0;var i=this.getAdjacentCellElements(e);var n=[];i.forEach(function(t){var e=s(t);n=n.concat(e)});n.forEach(function(t){new r(t,this)},this)};function s(t){if(t.nodeName=="IMG"){var e=t.getAttribute("data-flickity-lazyload");var i=t.getAttribute("data-flickity-lazyload-src");var n=t.getAttribute("data-flickity-lazyload-srcset");if(e||i||n){return[t]}}var s="img[data-flickity-lazyload], "+"img[data-flickity-lazyload-src], img[data-flickity-lazyload-srcset]";var r=t.querySelectorAll(s);return o.makeArray(r)}function r(t,e){this.img=t;this.flickity=e;this.load()}r.prototype.handleEvent=o.handleEvent;r.prototype.load=function(){this.img.addEventListener("load",this);this.img.addEventListener("error",this);var t=this.img.getAttribute("data-flickity-lazyload")||this.img.getAttribute("data-flickity-lazyload-src");var e=this.img.getAttribute("data-flickity-lazyload-srcset");this.img.src=t;if(e){this.img.setAttribute("srcset",e)}this.img.removeAttribute("data-flickity-lazyload");this.img.removeAttribute("data-flickity-lazyload-src");this.img.removeAttribute("data-flickity-lazyload-srcset")};r.prototype.onload=function(t){this.complete(t,"flickity-lazyloaded")};r.prototype.onerror=function(t){this.complete(t,"flickity-lazyerror")};r.prototype.complete=function(t,e){this.img.removeEventListener("load",this);this.img.removeEventListener("error",this);var i=this.flickity.getParentCell(this.img);var n=i&&i.element;this.flickity.cellSizeChange(n);this.img.classList.add(e);this.flickity.dispatchEvent("lazyLoad",t,n)};i.LazyLoader=r;return i});
/*!
 * Flickity v2.2.2
 * Touch, responsive, flickable carousels
 *
 * Licensed GPLv3 for open source use
 * or Flickity Commercial License for commercial use
 *
 * https://flickity.metafizzy.co
 * Copyright 2015-2021 Metafizzy
 */
(function(t,e){if(typeof define=="function"&&define.amd){define("flickity/js/index",["./flickity","./drag","./prev-next-button","./page-dots","./player","./add-remove-cell","./lazyload"],e)}else if(typeof module=="object"&&module.exports){module.exports=e(require("./flickity"),require("./drag"),require("./prev-next-button"),require("./page-dots"),require("./player"),require("./add-remove-cell"),require("./lazyload"))}})(window,function t(e){return e});
/*!
 * Flickity asNavFor v2.0.2
 * enable asNavFor for Flickity
 */
(function(t,e){if(typeof define=="function"&&define.amd){define("flickity-as-nav-for/as-nav-for",["flickity/js/index","fizzy-ui-utils/utils"],e)}else if(typeof module=="object"&&module.exports){module.exports=e(require("flickity"),require("fizzy-ui-utils"))}else{t.Flickity=e(t.Flickity,t.fizzyUIUtils)}})(window,function t(n,s){n.createMethods.push("_createAsNavFor");var e=n.prototype;e._createAsNavFor=function(){this.on("activate",this.activateAsNavFor);this.on("deactivate",this.deactivateAsNavFor);this.on("destroy",this.destroyAsNavFor);var e=this.options.asNavFor;if(!e){return}var i=this;setTimeout(function t(){i.setNavCompanion(e)})};e.setNavCompanion=function(t){t=s.getQueryElement(t);var e=n.data(t);if(!e||e==this){return}this.navCompanion=e;var i=this;this.onNavCompanionSelect=function(){i.navCompanionSelect()};e.on("select",this.onNavCompanionSelect);this.on("staticClick",this.onNavStaticClick);this.navCompanionSelect(true)};e.navCompanionSelect=function(t){var e=this.navCompanion&&this.navCompanion.selectedCells;if(!e){return}var i=e[0];var n=this.navCompanion.cells.indexOf(i);var s=n+e.length-1;var r=Math.floor(a(n,s,this.navCompanion.cellAlign));this.selectCell(r,false,t);this.removeNavSelectedElements();if(r>=this.cells.length){return}var o=this.cells.slice(n,s+1);this.navSelectedElements=o.map(function(t){return t.element});this.changeNavSelectedClass("add")};function a(t,e,i){return(e-t)*i+t}e.changeNavSelectedClass=function(e){this.navSelectedElements.forEach(function(t){t.classList[e]("is-nav-selected")})};e.activateAsNavFor=function(){this.navCompanionSelect(true)};e.removeNavSelectedElements=function(){if(!this.navSelectedElements){return}this.changeNavSelectedClass("remove");delete this.navSelectedElements};e.onNavStaticClick=function(t,e,i,n){if(typeof n=="number"){this.navCompanion.selectCell(n)}};e.deactivateAsNavFor=function(){this.removeNavSelectedElements()};e.destroyAsNavFor=function(){if(!this.navCompanion){return}this.navCompanion.off("select",this.onNavCompanionSelect);this.off("staticClick",this.onNavStaticClick);delete this.navCompanion};return n});
/*!
 * imagesLoaded v4.1.4
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
(function(e,i){"use strict";if(typeof define=="function"&&define.amd){define("imagesloaded/imagesloaded",["ev-emitter/ev-emitter"],function(t){return i(e,t)})}else if(typeof module=="object"&&module.exports){module.exports=i(e,require("ev-emitter"))}else{e.imagesLoaded=i(e,e.EvEmitter)}})(typeof window!=="undefined"?window:this,function t(e,i){var s=e.jQuery;var r=e.console;function o(t,e){for(var i in e){t[i]=e[i]}return t}var n=Array.prototype.slice;function a(t){if(Array.isArray(t)){return t}var e=typeof t=="object"&&typeof t.length=="number";if(e){return n.call(t)}return[t]}function l(t,e,i){if(!(this instanceof l)){return new l(t,e,i)}var n=t;if(typeof t=="string"){n=document.querySelectorAll(t)}if(!n){r.error("Bad element for imagesLoaded "+(n||t));return}this.elements=a(n);this.options=o({},this.options);if(typeof e=="function"){i=e}else{o(this.options,e)}if(i){this.on("always",i)}this.getImages();if(s){this.jqDeferred=new s.Deferred}setTimeout(this.check.bind(this))}l.prototype=Object.create(i.prototype);l.prototype.options={};l.prototype.getImages=function(){this.images=[];this.elements.forEach(this.addElementImages,this)};l.prototype.addElementImages=function(t){if(t.nodeName=="IMG"){this.addImage(t)}if(this.options.background===true){this.addElementBackgroundImages(t)}var e=t.nodeType;if(!e||!h[e]){return}var i=t.querySelectorAll("img");for(var n=0;n<i.length;n++){var s=i[n];this.addImage(s)}if(typeof this.options.background=="string"){var r=t.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var o=r[n];this.addElementBackgroundImages(o)}}};var h={1:true,9:true,11:true};l.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(!e){return}var i=/url\((['"])?(.*?)\1\)/gi;var n=i.exec(e.backgroundImage);while(n!==null){var s=n&&n[2];if(s){this.addBackground(s,t)}n=i.exec(e.backgroundImage)}};l.prototype.addImage=function(t){var e=new c(t);this.images.push(e)};l.prototype.addBackground=function(t,e){var i=new u(t,e);this.images.push(i)};l.prototype.check=function(){var n=this;this.progressedCount=0;this.hasAnyBroken=false;if(!this.images.length){this.complete();return}function e(t,e,i){setTimeout(function(){n.progress(t,e,i)})}this.images.forEach(function(t){t.once("progress",e);t.check()})};l.prototype.progress=function(t,e,i){this.progressedCount++;this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded;this.emitEvent("progress",[this,t,e]);if(this.jqDeferred&&this.jqDeferred.notify){this.jqDeferred.notify(this,t)}if(this.progressedCount==this.images.length){this.complete()}if(this.options.debug&&r){r.log("progress: "+i,t,e)}};l.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";this.isComplete=true;this.emitEvent(t,[this]);this.emitEvent("always",[this]);if(this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}};function c(t){this.img=t}c.prototype=Object.create(i.prototype);c.prototype.check=function(){var t=this.getIsImageComplete();if(t){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image;this.proxyImage.addEventListener("load",this);this.proxyImage.addEventListener("error",this);this.img.addEventListener("load",this);this.img.addEventListener("error",this);this.proxyImage.src=this.img.src};c.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth};c.prototype.confirm=function(t,e){this.isLoaded=t;this.emitEvent("progress",[this,this.img,e])};c.prototype.handleEvent=function(t){var e="on"+t.type;if(this[e]){this[e](t)}};c.prototype.onload=function(){this.confirm(true,"onload");this.unbindEvents()};c.prototype.onerror=function(){this.confirm(false,"onerror");this.unbindEvents()};c.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this);this.proxyImage.removeEventListener("error",this);this.img.removeEventListener("load",this);this.img.removeEventListener("error",this)};function u(t,e){this.url=t;this.element=e;this.img=new Image}u.prototype=Object.create(c.prototype);u.prototype.check=function(){this.img.addEventListener("load",this);this.img.addEventListener("error",this);this.img.src=this.url;var t=this.getIsImageComplete();if(t){this.confirm(this.img.naturalWidth!==0,"naturalWidth");this.unbindEvents()}};u.prototype.unbindEvents=function(){this.img.removeEventListener("load",this);this.img.removeEventListener("error",this)};u.prototype.confirm=function(t,e){this.isLoaded=t;this.emitEvent("progress",[this,this.element,e])};l.makeJQueryPlugin=function(t){t=t||e.jQuery;if(!t){return}s=t;s.fn.imagesLoaded=function(t,e){var i=new l(this,t,e);return i.jqDeferred.promise(s(this))}};l.makeJQueryPlugin();return l});
/*!
 * Flickity imagesLoaded v2.0.0
 * enables imagesLoaded option for Flickity
 */
(function(i,n){if(typeof define=="function"&&define.amd){define(["flickity/js/index","imagesloaded/imagesloaded"],function(t,e){return n(i,t,e)})}else if(typeof module=="object"&&module.exports){module.exports=n(i,require("flickity"),require("imagesloaded"))}else{i.Flickity=n(i,i.Flickity,i.imagesLoaded)}})(window,function t(e,i,s){"use strict";i.createMethods.push("_createImagesLoaded");var n=i.prototype;n._createImagesLoaded=function(){this.on("activate",this.imagesLoaded)};n.imagesLoaded=function(){if(!this.options.imagesLoaded){return}var n=this;function t(t,e){var i=n.getParentCell(e.img);n.cellSizeChange(i&&i.element);if(!n.options.freeScroll){n.positionSliderAtSelected()}}s(this.slider).on("progress",t)};return i});
SYNCSEARCH_SITE="2KZ9WLFD";
SYNCSEARCH_GROUP=33; //全体
SYNCSEARCH_GROUP1=34; //support配下
SYNCSEARCH_GROUP2=35; //service配下
SYNCSEARCH_GROUP3=36; //action配下
SYNCSEARCH_GROUP4=37; //support/servrice/mobile/配下
SYNCSEARCH_GROUP5=38; //support/servrice/internet/配下
SYNCSEARCH_GROUP6=33; //全体 SP用追記
SYNCSEARCH_GROUP7=42; //ショップ検索配下
SYNCSEARCH_GROUP8=44; //FAQ配下
SYNCSEARCH_GROUP9=44; //FAQ配下
/**
 * sync_suggest.js
 * Created with IntelliJ IDEA.
 * Author: Miyabi Ogino
 * Author: Shuji Umino
 * Date: 2016/03/01
 * Time: 10:44
 * To change this template use File | Settings | File Templates.
 */

/**
 * Active suggest object.
 */
var ss_suggest;

/**
 * Browser type.
 * @type {{IE: boolean, Opera: boolean, WebKit: boolean, Chrome: boolean, Gecko: boolean}}
 */
var SyncSearchBrowser = {
    IE: !!(window.attachEvent && !window.opera),
    Edge: navigator.userAgent.indexOf('Edge') >= -1,
    Opera: !!window.opera,
    WebKit: navigator.userAgent.indexOf('AppleWebKit/') > -1 && navigator.userAgent.indexOf('Chrome') == -1 && navigator.userAgent.indexOf('Edge') == -1,
    Chrome: navigator.userAgent.indexOf('Chrome') > -1,
    Gecko: navigator.userAgent.indexOf('Gecko') > -1 && navigator.userAgent.indexOf('KHTML') == -1
};

/**
 * Utility object.
 * @type {{createRoot: createRoot, initSyncVariable: initSyncVariable, MAX_SUGGEST: number, initSyncSuggest: initSyncSuggest, initSyncForm: initSyncForm, initSyncQuery: initSyncQuery, createSuggestFrame: createSuggestFrame, createFrame: createFrame, createSuggestArea: createSuggestArea, createCss: createCss, createSuggest: createSuggest, createSuggestElements: createSuggestElements, assign: assign, valueOf: valueOf, decodeInnerHTML: decodeInnerHTML, isAscii: isAscii, isEmptyText: isEmptyText, assert: assert, createAdjustParam: createAdjustParam, containsBrower: containsBrower, equalToBrower: equalToBrower, startsWith: startsWith, size: size, coordinate: coordinate, createOffset: createOffset, fix: fix, showSuggest: showSuggest, position: position, queue: null, resetPosition: resetPosition, isValidForm: isValidForm, isInitialized: isInitialized, isArray: isArray, doneWmode: boolean, appendWMode: appendWMode, replace: replace, contains: contains, createNode: createNode}}
 */
var SyncSearchUtils = {

    /**
     * Create URL root.
     * @returns {string}
     */
    createRoot: function () {
      
      if (location.hostname == 'demo.syncsearch.jp') {
        return 'http://demo.syncsearch.jp';
      } else {
        if (location.protocol == 'https:') {
          return 'https://ssl.syncsearch.jp';
        } else {
          return 'http://pro.syncsearch.jp';
        }
      }
    },

    /**
     * Initialize variable.
     */
    initSyncVariable: function () {
        if (typeof SYNCSEARCH_SITE === 'undefined') {
            SYNCSEARCH_SITE = 'undefined';
            throw '\"SYNCSEARCH_SITE\" is ' + SYNCSEARCH_SITE + '!';
        }
        if (typeof SYNCSEARCH_FORM === 'undefined') {
            SYNCSEARCH_FORM = 'SS_searchForm';
        }
        if (typeof SYNCSEARCH_QUERY === 'undefined') {
            SYNCSEARCH_QUERY = 'SS_searchQuery';
        }
        if (typeof SYNCSEARCH_SUGGEST_DEPTH === 'undefined' && typeof SYNCSEARCH_USER_RESULT !== 'undefined') {
            SYNCSEARCH_SUGGEST_DEPTH = 3;
        }
        if (typeof SYNCSEARCH_SUGGEST_DEPTH === 'undefined') {
            SYNCSEARCH_SUGGEST_DEPTH = 1;
        }
        if (typeof SYNCSEARCH_SUGGEST_OFF === 'undefined') {
            SYNCSEARCH_SUGGEST_OFF = [];
        }
        if (typeof SYNCSEARCH_SUGGEST_ON === 'undefined') {
            SYNCSEARCH_SUGGEST_ON = [];
        }
        if (typeof SYNCSEARCH_SUGGEST_HEIGHT === 'undefined') {
            SYNCSEARCH_SUGGEST_HEIGHT = [];
        }
        if (typeof SYNCSEARCH_SUGGEST_FONT === 'undefined') {
            SYNCSEARCH_SUGGEST_FONT = [];
        }
        if (typeof SYNCSEARCH_WMODE_EXCLUDES === 'undefined') {
            SYNCSEARCH_WMODE_EXCLUDES = [];
        }
        if (typeof SYNCSEARCH_ADJUST === 'undefined') {
            SYNCSEARCH_ADJUST = [];
        }
    },

    /**
     * Number of maximum suggest objects.
     */
    MAX_SUGGEST: 10,

    /**
     * Initialize suggest.
     */
    initSyncSuggest: function () {
        SyncSearchUtils.initSyncVariable();
        var form = document.getElementById(SYNCSEARCH_FORM);
        if (SyncSearchUtils.assert(form) && form.id == SYNCSEARCH_FORM) {
            SyncSearchUtils.initSyncForm('');
        }
        for (var i = 1; i <= SyncSearchUtils.MAX_SUGGEST; ++i) {
            SyncSearchUtils.initSyncForm(i);
        }
        window.setInterval(SyncSearchUtils.resetPosition, 1000);
    },

    /**
     * Initialize input form.
     * @param num
     */
    initSyncForm: function (num) {
        if (!SyncSearchUtils.isValidForm(num) || SyncSearchUtils.isInitialized(num)) {
            return;
        }
        var form = document.getElementById(SYNCSEARCH_FORM + num);
        var suggest = new SyncSearchSuggest(num);
        window.setInterval(suggest.watchQuery.bind(suggest), 300);

        SyncSearchEvent.observe(suggest.query, 'focus', suggest.enable.bind(suggest));
        SyncSearchEvent.observe(suggest.query, 'blur', suggest.disable.bind(suggest));
        SyncSearchEvent.observe(suggest.query, 'keydown', suggest.keyDown.bind(suggest));
        SyncSearchEvent.observe(suggest.query, 'keyup', suggest.keyUp.bind(suggest));
        SyncSearchEvent.observe(form, 'submit', suggest.checkSubmit.bind(suggest));

        ss_suggest = suggest;
    },

    /**
     * Initialize query.
     * @param num
     * @returns {HTMLElement}
     */
    initSyncQuery: function (num) {
        var query = document.getElementById(SYNCSEARCH_QUERY + num);
        query.setAttribute('autocomplete', 'off');
        return query;
    },

    /**
     * Create suggest iframe.
     * @param num
     * @returns {HTMLElement}
     */
    createSuggestFrame: function (num) {
        var frame = SyncSearchUtils.createFrame(num);
        if (SyncSearchUtils.equalToBrower('ie6')) {
            var div = document.createElement('div'); // For jQuery CarouFredSel at IE6.
            div.style.position = 'absolute';
            div.style.top = '0px';
            div.style.left = '0px';
            div.style.zIndex = '999999';
            div.appendChild(frame);
            document.body.appendChild(div);
        } else {
            document.body.appendChild(frame);
        }
        return frame;
    },

    /**
     * Create iframe node.
     * @param num
     * @returns {HTMLElement}
     */
    createFrame: function (num) {
        var frame = document.createElement('iframe');

        frame.scrolling = 'no';
        frame.allowTransparency = 'true'; // for IE
        frame.id = 'SS_Frame' + num;
        frame.frameBorder = '0'; // for IE
        frame.src = 'javascript:"";';
        frame.sandbox = 'allow-same-origin allow-scripts';
        frame.style.zIndex = '1000000';
        frame.style.display = 'block';
        frame.style.position = 'absolute';
        frame.style.border = '0 none';
        frame.style.visibility = 'visible';
        frame.style.top = '0px';
        frame.style.left = '0px';
        frame.style.height = '0px';
        frame.style.width = '0px';
        
        if (document.all) { // IE
            frame.onreadystatechange = function () {
                if (this.readyState == 'complete') {
                    var doc = this.contentDocument || this.contentWindow.document;
                    var i = this.id.replace('SS_Frame', '');
                    SyncSearchUtils.createSuggestArea(doc, i);
                    this.onreadystatechange = null;
                }
            };
        } else {
            frame.onload = function () {
                var doc = this.contentDocument || this.contentWindow.document;
                var i = this.id.replace('SS_Frame', '');
                SyncSearchUtils.createSuggestArea(doc, i);
            };
        }
        return frame;
    },

    /**
     * Create suggest area.
     * @param doc
     * @param num
     */
    createSuggestArea: function (doc, num) {
        var css = SyncSearchUtils.createCss(doc, num);
        if (document.all) {
            doc.getElementsByTagName('head')[0].appendChild(css);
        } else {
            doc.head.appendChild(css);
        }
        var suggest = SyncSearchUtils.createSuggest(doc, num);
        doc.body.appendChild(suggest);
    },

    /**
     * Create CSS node.
     * @param doc
     * @param num
     * @returns {HTMLElement}
     */
    createCss: function (doc, num) {
        var css = doc.createElement('style');
        css.type = 'text/css';
        
        var parentDoc = window.parent.document;
        var fontFamily = (parentDoc.body.currentStyle || getComputedStyle(parentDoc.body, '')).fontFamily;
        if (fontFamily == undefined || fontFamily == '') {
            fontFamily = 'Arial,sans-serif';
        }
        
        var font = SyncSearchUtils.assign(SYNCSEARCH_SUGGEST_FONT, num, {
            color: '#333',
            size: '0.85em',
            family: fontFamily,
            direction: 'ltr',
            textAlign: 'left'
        });
        var offColor = SyncSearchUtils.assign(SYNCSEARCH_SUGGEST_OFF, num, '#FFF');
        var onColor = SyncSearchUtils.assign(SYNCSEARCH_SUGGEST_ON, num, '#ECF5FA');
        var heightParam = SyncSearchUtils.assign(SYNCSEARCH_SUGGEST_HEIGHT, num, '');
        var height = (SyncSearchUtils.isEmptyText(heightParam)) ? '' : 'height:' + heightParam + ';';
        var width = (SyncSearchUtils.equalToBrower('ie6')) ? 'width:100%;' : ''; // Resolution for IE6. see http://www.velocityreviews.com/forums/t880756-onmouseover-and-ie6.html
        var color = SyncSearchUtils.valueOf(font.color, '#333');
        var size = SyncSearchUtils.valueOf(font.size, '0.85em');
        var family = SyncSearchUtils.valueOf(font.family, 'Arial,sans-serif');
        var direction = SyncSearchUtils.valueOf(font.direction, 'ltr');
        var textAlign = SyncSearchUtils.valueOf(font.textAlign, 'left');
        
        var styles = 'body{' + 
                              'background-color:transparent;' + 
                              'color:' + color + ';' + 
                              'font-family:' + family + ';' + 
                              'font-size:' + size + ';' + 
                              'direction:' + direction + ';' + 
                              'text-align:' + textAlign + ';' +  
                              'margin:0;' + 
                              'padding:0px' + 
                         '}';
        styles += 'div.SS_suggest{' + 
                              'background-color:transparent;' + 
                              'border-bottom:1px solid #CCC;' + 
                              'border-left:1px solid #CCC;' + 
                              'border-right:1px solid #CCC;' + 
                              'font-weight:normal;' + 
                              'padding:0;' + 
                              'visibility:hidden;' + 
                         '}';
        styles += 'div.SS_suggest div.SS_suggestItem{' +
                           'border-top:1px solid #CCC;' + 
                               height +
                               'line-height:115%;' + 
                               'padding:3px 2px 2px 4px;' + 
                               width + 
                         '}';
        styles += 'div.SS_suggest div.SS_suggestItemOff{' + 
                               'background-color:' + offColor + ';' + 
                         '}';
        styles += 'div.SS_suggest div.SS_suggestItemOn{' + 
                              'background-color:' + onColor + ';' +
                         '}';
        
        if (SyncSearchUtils.equalToBrower('ie8') || SyncSearchUtils.equalToBrower('ie7') || SyncSearchUtils.equalToBrower('ie6')) {
            styles += 'div.SS_suggest span.SS_suggestKey{' + 
                              'font-size:100%;' + 
                         '}';
        } else {
            styles += 'div.SS_suggest span.SS_suggestKey{' + 
                              height + 
                              'vertical-align:bottom;' + 
                              'display:table-cell;' +
                              'font-size:100%;' + 
                         '}';
        }
        
        
        if (typeof SYNCSEARCH_SUGGEST_STYLE !== 'undefined') {
            styles += " " + SYNCSEARCH_SUGGEST_STYLE;
        }
        
        if (css.styleSheet) { // IE
            css.styleSheet.cssText = styles;
        } else {
            css.appendChild(doc.createTextNode(styles));
        }
        return css;
    },

    /**
     * Create suggest node.
     * @param doc
     * @param num
     * @returns {HTMLElement}
     */
    createSuggest: function (doc, num) {
        var suggestNode = doc.createElement('div');
        suggestNode.id = 'SS_suggest' + num;
        suggestNode.className = 'SS_suggest';
        suggestNode.oncontextmenu = 'return false;';
        return suggestNode;
    },

    /**
     * Create suggest elements.
     * @param items
     * @param limit
     * @param num
     * @param rate
     * @returns {string}
     */
    createSuggestElements: function (items, limit, num, rate) {
        var html = '';
        for (var i = 0; i < limit; ++i) {
            var item = items[i];
            if (!SyncSearchUtils.assert(item) || !SyncSearchUtils.assert(item.key)) {
                continue;
            }
            html += '\n<div class=\"SS_suggestItem SS_suggestItemOff\" id=\"SS_suggestItem' + num + '_' + (i + 1) + '\" onMouseOver=\"parent.ss_suggest.mouseOver(this)\" onmousedown=\"parent.ss_suggest.mouseDown()\" onmouseup=\"parent.ss_suggest.mouseUp(this)\">';
            html += '<span class=\"SS_suggestKey\">' + item.key + '</span>';
            if (rate) {
                html += '<span class=\"SS_suggestRate\"></span>';
            }
            html += '</div>';
        }
        return html;
    },

    /**
     * Assign from the definitions, suggest-number.
     * @param array
     * @param num
     * @param defaultValue
     * @returns {*}
     */
    assign: function (array, num, defaultValue) {
        if (!SyncSearchUtils.assert(array) || !SyncSearchUtils.isArray(array) || array.length === 0) {
            return defaultValue;
        }
        for (var i = 0; i < array.length; ++i) {
            var item = array[i];
            if (!SyncSearchUtils.assert(item) || !SyncSearchUtils.assert(item.num) || num != item.num) {
                continue;
            }
            return item.value;
        }
        return defaultValue;
    },

    /**
     * Get a valid value.
     * @param value
     * @param defaultValue
     */
    valueOf: function (value, defaultValue) {
        return (SyncSearchUtils.assert(value)) ? value : defaultValue;
    },

    /**
     * Decode escaped characters.
     * @param html
     * @returns {XML}
     */
    decodeInnerHTML: function (html) {
        return html.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&nbsp;/g, ' ');
    },

    /**
     * Check ASCII character.
     * @param ch
     * @returns {boolean}
     */
    isAscii: function (ch) {
        var chc = ch.charCodeAt(ch.length - 1);
        return chc >= 0x0021 && chc <= 0x007e;
    },

    /**
     * Check empty-text.
     * @param text
     * @returns {boolean}
     */
    isEmptyText: function (text) {
        return (!SyncSearchUtils.assert(text) || text === '');
    },

    /**
     * Assertion.
     * @param obj
     * @returns {boolean}
     */
    assert: function (obj) {
        return (typeof obj !== 'undefined' && obj != null);
    },

    /**
     * Create adjust parameter.
     * @param id
     * @param param
     * @returns {number}
     */
    createAdjustParam: function (id, param) {
        if (!SyncSearchUtils.assert(SYNCSEARCH_ADJUST) || !SyncSearchUtils.isArray(SYNCSEARCH_ADJUST) || SYNCSEARCH_ADJUST.length === 0) {
            return 0;
        }
        for (var i = 0; i < SYNCSEARCH_ADJUST.length; ++i) {
            var tgtId = SYNCSEARCH_ADJUST[i].id;
            var browsers = SYNCSEARCH_ADJUST[i].browser;
            if (!SyncSearchUtils.assert(tgtId) || id !== tgtId || !SyncSearchUtils.assert(browsers) || !SyncSearchUtils.containsBrower(browsers)) {
                continue;
            }
            var tgtParam = SYNCSEARCH_ADJUST[i].param;
            if (SyncSearchUtils.assert(tgtParam) && param === tgtParam) {
                return SYNCSEARCH_ADJUST[i].value;
            }
        }
        return 0;
    },

    /**
     * Find my browser.
     * @param browsers
     */
    containsBrower: function (browsers) {
        if (!SyncSearchUtils.assert(browsers) || !SyncSearchUtils.isArray(browsers)) {
            return false;
        }
        for (var i = 0; i < browsers.length; ++i) {
            var browser = browsers[i];
            if (SyncSearchUtils.equalToBrower(browser)) {
                return true;
            }
        }
        return false;
    },

    /**
     * Check my browser.
     * @param browser
     * @returns {*}
     */
    equalToBrower: function (browser) {
        if (!SyncSearchUtils.assert(browser)) {
            return false;
        }
        if (browser === 'all') {
            return true;
        }
        if (browser === 'firefox') {
            return SyncSearchBrowser.Gecko;
        }
        if (browser === 'safari') {
            return SyncSearchBrowser.WebKit;
        }
        if (browser === 'chrome') {
            return SyncSearchBrowser.Chrome;
        }
        if (browser === 'opera') {
            return SyncSearchBrowser.Opera;
        }
        if (SyncSearchUtils.startsWith(browser, 'ie')) {
            if (SyncSearchUtils.startsWith(browser, 'ie11')) {
                var userAgent = window.navigator.userAgent;
                return (SyncSearchBrowser.IE && (userAgent.indexOf('Trident/7') != -1));
            } else {
                var appVersion = window.navigator.appVersion.toLowerCase();
                var version = 'msie ' + browser.replace(/ie/g, '') + '.';
                return (SyncSearchBrowser.IE && (appVersion.indexOf(version) != -1));
            }
        }
    },

    /**
     * Check starting with prefix.
     * @param text
     * @param prefix
     */
    startsWith: function (text, prefix) {
        return text.lastIndexOf(prefix, 0) == 0;
    },

    /**
     * Calculate element size.
     * @param elm
     * @returns {{height: number, width: number}}
     */
    size: function (elm) {
        return {height: elm.offsetHeight, width: elm.offsetWidth};
    },

    /**
     * Calculate element coordination.
     * @param elm
     * @returns {{top: number, left: number}}
     */
    coordinate: function (elm) {
        var pos = elm.getBoundingClientRect();
        var scrollTop = (document.body.scrollTop || document.documentElement.scrollTop); // Fix for page scroll. see http://terurou.hateblo.jp/entry/20080223/1203705170
        var scrollLeft = (document.body.scrollLeft || document.documentElement.scrollLeft);  // Fix for page scroll. see http://terurou.hateblo.jp/entry/20080223/1203705170
        var topBorderWidth = document.documentElement.clientTop || 0; // Fix for IEs page border. see https://github.com/zeroclipboard/ZeroClipboard/pull/114
        var leftBorderWidth = document.documentElement.clientLeft || 0; // Fix for IEs page border. see https://github.com/zeroclipboard/ZeroClipboard/pull/114
        var offset = SyncSearchUtils.createOffset();
        return {
            top: pos.top + scrollTop - topBorderWidth - offset.top,
            left: pos.left + scrollLeft - leftBorderWidth - offset.left
        };
    },

    /**
     * Create offset value.
     * @returns {{top: number, left: number}}
     * @note IEs "Quirks mode"(document.documentMode === 5) is needed to set -2px to top and left.
     *       IE 6-8 is topBorderWidth = 2, leftBorderWidth = 2, but "Quirks mode" is topBorderWidth = 0, leftBorderWidth = 0.
     *
     *       Note.
     *       topBorderWidth = document.documentElement.clientTop || 0; // Fix for IEs page border. see https://github.com/zeroclipboard/ZeroClipboard/pull/114
     *       leftBorderWidth = document.documentElement.clientLeft || 0; // Fix for IEs page border. see https://github.com/zeroclipboard/ZeroClipboard/pull/114
     */
    createOffset: function () {
        var offsetTop = 0;
        var offsetLeft = 0;
        if ((SyncSearchBrowser.IE && document.documentMode === 5) ||
            ((SyncSearchUtils.equalToBrower('ie6') || SyncSearchUtils.equalToBrower('ie7')) && document.compatMode === 'BackCompat')) {
            // IEs "Quirks mode"(document.documentMode === 5(over IE8) document.compatMode === 'BackCompat'(IE5-7)) is needed to set -2px to top and left.
            offsetTop += 2;
            offsetLeft += 2;
        }
        if ((SyncSearchBrowser.IE && (SyncSearchUtils.equalToBrower('ie9') || SyncSearchUtils.equalToBrower('ie10') || SyncSearchUtils.equalToBrower('ie11'))) ||
               (SyncSearchBrowser.Edge)) {
            offsetTop += 1;
        } 
        return {top: offsetTop, left: offsetLeft};
    },

    /**
     * Fix suggest frame, area.
     * @param frame
     * @param area
     * @param target
     */
    fix: function (frame, area, target) {
        var widthAdjust = -2;
        if (SyncSearchUtils.equalToBrower('ie8') || SyncSearchUtils.equalToBrower('ie7') || SyncSearchUtils.equalToBrower('ie6')) {
            widthAdjust = 0;
        }
        
        var querySize = SyncSearchUtils.size(target);
        area.style.width = (querySize.width + widthAdjust) + SyncSearchUtils.createAdjustParam(target.id, 'width') + 'px';
        var areaSize = SyncSearchUtils.size(area);
        //adjust 1px height by affected body font-size
        frame.style.height = (areaSize.height + 1) + 'px';
        frame.style.width = areaSize.width + 'px';
    },

    /**
     * Show suggest-frame.
     * @param frame
     * @param area
     * @param target
     */
    showSuggest: function (frame, area, target) {
        area.style.display = 'block';
        area.style.visibility = 'visible';
        SyncSearchUtils.fix(frame, area, target);
    },

    /**
     * Position object under target.
     * @param obj
     * @param target
     */
    position: function (obj, target) {
        var tgtCoord = SyncSearchUtils.coordinate(target);
        var bodyCoord = {top: 0, left: 0};
        var body = document.body;
        if (body.style.position === 'absolute' || body.style.position === 'fixed' || body.style.position === 'relative') {
            bodyCoord = SyncSearchUtils.coordinate(body);
        }
        var tgtSize = SyncSearchUtils.size(target);
        var topPos = tgtCoord.top + tgtSize.height - bodyCoord.top;
        var leftPos = tgtCoord.left - bodyCoord.left;
        obj.style.top = topPos + SyncSearchUtils.createAdjustParam(target.id, 'top') + 'px';
        obj.style.left = leftPos + SyncSearchUtils.createAdjustParam(target.id, 'left') + 'px';
    },

    /**
     * Timer queue(for setTimeout and clearTimeout).
     */
    queue: null,

    /**
     * Reset suggest-position.
     */
    resetPosition: function () {
        if (SyncSearchUtils.assert(SyncSearchUtils.queue)) {
            window.clearTimeout(SyncSearchUtils.queue);
        }
        SyncSearchUtils.queue = window.setTimeout(function () {
            for (var i = 0; i <= SyncSearchUtils.MAX_SUGGEST; ++i) {
                if (!SyncSearchUtils.isValidForm(i) || !SyncSearchUtils.isInitialized(i)) {
                    continue;
                }
                var frameId = (i < 1) ? 'SS_Frame' : 'SS_Frame' + i;
                var frame = document.getElementById(frameId);
                if (!SyncSearchUtils.assert(frame)) {
                    continue;
                }
                var frameSize = SyncSearchUtils.size(frame);
                if (frameSize.height === 0 || frameSize.width === 0) {
                    continue;
                }
                var queryId = (i < 1) ? SYNCSEARCH_QUERY : SYNCSEARCH_QUERY + i;
                var query = document.getElementById(queryId);
                var frameDoc = document.getElementById(frameId).contentDocument || document.getElementById(frameId).contentWindow.document;
                var areaId = (i < 1) ? 'SS_suggest' : 'SS_suggest' + i;
                var area = frameDoc.getElementById(areaId);
                if (!SyncSearchUtils.assert(area) || area.style.visibility !== 'visible') {
                    frame.height = '0px';
                    frame.width = '0px';
                    continue;
                }
                if (query == document.activeElement && !SyncSearchUtils.isVisible(query)) {
                  query.blur();
                  continue;
                }
                
                SyncSearchUtils.fix(frame, area, query);
                SyncSearchUtils.position(frame, query);
            }
        }, 0);
    },
    
    
    /**
      https://github.com/jquery/jquery/blob/master/src/css/hiddenVisibleSelectors.js
    */
    isVisible: function(elem) {
      return !!( elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length );
    },

    /**
     * Check valid search-form.
     * @param i
     * @returns {boolean}
     */
    isValidForm: function (i) {
        var num = (!isFinite(i) || i < 1) ? '' : i;
        var form = document.getElementById(SYNCSEARCH_FORM + num);
        return (SyncSearchUtils.assert(form) && form.id === SYNCSEARCH_FORM + num);
    },

    /**
     * Check initialized iframe.
     * @param i
     */
    isInitialized: function (i) {
        var frameId = (!isFinite(i) || i < 1) ? 'SS_Frame' : 'SS_Frame' + i;
        var frame = document.getElementById(frameId);
        return SyncSearchUtils.assert(frame);
    },

    /**
     * Check array instance.
     * @param obj
     */
    isArray: function (obj) {
        return Object.prototype.toString.call(obj) == '[object Array]' || (typeof obj === 'object' && 'length' in obj && 'item' in obj);
    },

    /**
     * Check SyncSearchUtils#appendWMode() terminated.
     */
    doneWmode: false,

    /**
     * Append 'wmode: transparent' to flash objects.
     * @note Reference http://www.onlineaspect.com/2009/08/13/javascript_to_fix_wmode_parameters/
     */
    appendWMode: function () {
        if (SyncSearchUtils.doneWmode) {
            return;
        }
        var embds = document.getElementsByTagName('embed');
        if (SyncSearchUtils.isArray(embds)) {
            for (var i = 0; i < embds.length; ++i) {
                var embd = embds[i];
                if (SyncSearchUtils.contains(SYNCSEARCH_WMODE_EXCLUDES, embd.id)) {
                    continue;
                }
                var transed = embd.cloneNode(true); // Need to replace node.
                var wmode = transed.getAttribute('wmode');
                if (!SyncSearchUtils.assert(wmode) || wmode !== 'transparent') {
                    transed.setAttribute('wmode', 'transparent');
                    embd.parentNode.replaceChild(transed, embd); // Need to replace node.
                }
            }
        }
        var objs = document.getElementsByTagName('object');
        if (SyncSearchUtils.isArray(objs)) {
            for (var i = 0; i < objs.length; ++i) {
                var obj = objs[i];
                if (SyncSearchUtils.contains(SYNCSEARCH_WMODE_EXCLUDES, obj.id)) {
                    continue;
                }
                var transed = obj.cloneNode(true); // Need to replace node.
                var param = SyncSearchUtils.replace(transed.childNodes, 'param', 'wmode', 'transparent');
                if (!SyncSearchUtils.assert(param)) {
                    transed.appendChild(SyncSearchUtils.createNode('param', 'wmode', 'transparent'));
                    obj.parentNode.replaceChild(transed, obj); // Need to replace node.
                }
            }
        }
        SyncSearchUtils.doneWmode = true;
    },

    /**
     * Replace element's attribute from node.
     * @param nodes
     * @param elmName
     * @param attrName
     * @param attrValue
     */
    replace: function (nodes, elmName, attrName, attrValue) {
        for (var i = 0; i < nodes.length; ++i) {
            var node = nodes[i];
            if (!SyncSearchUtils.assert(node) || !SyncSearchUtils.assert(node.nodeType) ||
                node.nodeType !== 1) {
                continue;
            }
            var name = node.getAttribute('name');
            if (SyncSearchUtils.assert(name) && name.toLowerCase() === attrName.toLowerCase()) {
                var value = node.getAttribute('value');
                if (SyncSearchUtils.assert(value) && value === attrValue) {
                    return node;
                }
                node.parentNode.removeChild(node);
            }
        }
        return null;
    },

    /**
     * Array contains value.
     * @param array
     * @param value
     * @returns {boolean}
     */
    contains: function (array, value) {
        if (typeof array === 'undefined' || !SyncSearchUtils.isArray(array) || typeof value === 'undefined') {
            return false;
        }
        for (var i = 0; i < array.length; ++i) {
            if (array[i] === value) {
                return true;
            }
        }
        return false;
    },

    /**
     * Create a node.
     * @param nodeName
     * @param attrName
     * @param attrValue
     * @returns {HTMLElement}
     */
    createNode: function (nodeName, attrName, attrValue) {
        var node = document.createElement(nodeName);
        node.setAttribute('name', attrName);
        node.setAttribute('value', attrValue);
        return node;
    }

};

/**
 * Suggest object constructor.
 * @param num
 * @constructor
 */
var SyncSearchSuggest = function (num) {
    this.num = num;
    this.query = SyncSearchUtils.initSyncQuery(num);
    this.max = 0; // Count of suggest items.
    this.lastChar = ''; // The last character of the inputted query.
    this.lastQuery = this.createQuery(); // The last inputted query.
    this.index = 0; // The index of the chosen suggest.
    this.rate = false;
    this.active = true; // The flag of active.
    this.queryIndex = this.query.value.length; // The index of the fixed query.
    this.depth = SYNCSEARCH_SUGGEST_DEPTH;
    this.clickLock = false;
    this.imeActive = false;
    this.frame = SyncSearchUtils.createSuggestFrame(num);
};

/**
 * SyncSearchSuggest.prototype definition.
 * @type {{createArea: Function, createRequestURL: Function, request: Function, RESPONSE_COMPLETE: number, RESPONSE_STATUS_OK: number, response: Function, createQuery: Function, watchQuery: Function, toggle: Function, hide: Function, checkSubmit: Function, checkIme: Function, enable: Function, disable: Function, fixQuery: Function, search: Function, mouseDown: Function, mouseUp: Function, mouseOver: Function, keyDown: Function, keyUp: Function, doUp: Function, doDown: Function, doBack: Function, doEnter: Function, doRight: Function, doSpace: Function}}
 */
SyncSearchSuggest.prototype = {

    /**
     * Create suggest-area node.
     * @returns {HTMLElement}
     */
    createArea: function () {
        var frameDoc = this.frame.contentDocument || this.frame.contentWindow.document;
        return frameDoc.getElementById('SS_suggest' + this.num);
    },

    /**
     * Create suggest-request URL.
     * @param type
     * @param text
     * @returns {string}
     */
    createRequestURL: function (type, text) {
        var url = SyncSearchUtils.createRoot();
        var group;
        url += '/suggest?site=' + SYNCSEARCH_SITE + '&type=' + type + '&query=' + encodeURI(text) + '&suffix=' + this.queryIndex + '&format=json&charset=utf-8';
        try {
            group = window['SYNCSEARCH_GROUP' + this.num];
        } catch (e) {
            // Nothing to do.
        }
        if (!SyncSearchUtils.isEmptyText(group)) {
            url += '&group=' + group;
        }
        return url;
    },

    /**
     * Request suggests.
     * @param text
     * @param type
     */
    request: function (text, type) {
        var url = this.createRequestURL(type, text);
        if (SyncSearchUtils.isEmptyText(url)) {
            return;
        }
        this.jsonReq = new JSONscriptRequest(url);
        this.jsonReq.buildScriptTag();
        this.jsonReq.addScriptTag();
    },

    RESPONSE_COMPLETE: 4,
    RESPONSE_STATUS_OK: 200,

    /**
     * Response suggests.
     */
    response: function () {
        if (!SyncSearchUtils.assert(this.suggestList)) {
            this.hide();
            this.jsonReq.removeScriptTag();
            return;
        }
        this.max = this.suggestList.length;
        var html = SyncSearchUtils.createSuggestElements(this.suggestList, this.max, this.num, this.rate);
        if (html === '') {
            return;
        }
        var area = this.createArea();
        area.innerHTML = html;
        SyncSearchUtils.showSuggest(this.frame, area, this.query);
        SyncSearchUtils.position(this.frame, this.query);
        if (this.max === 0) {
            this.hide();
        }
    },

    /**
     * Create query.
     * @returns {string}
     */
    createQuery: function () {
        if (SyncSearchUtils.isEmptyText(this.query)) {
            return '';
        }
        return this.query.value.split(String.fromCharCode(12288)).join(' '); // From 2byte space character to 1Byte space character.
    },

    /**
     * Watch query.
     */
    watchQuery: function () {
        SyncSearchUtils.appendWMode();
        if (!SyncSearchUtils.assert(ss_suggest) || ss_suggest != this || !SyncSearchUtils.assert(ss_suggest.num) || ss_suggest.num != this.num) {
            return;
        }

        var query = this.createQuery(); // From 1byte-character to 2Byte-character.
        if (this.lastQuery != query && this.active &&
            query.length > 0 && this.index === 0 &&
            query.split(' ').length <= this.depth) {
            var lastChar = query.substring(query.length - 1, query.length);
            this.request(query, lastChar == ' ' ? 2 : 1);
        }
        // Watch the event by timer, "selected delete" which cannot detect by key-events.
        if (this.queryIndex > this.query.value.length) {
            this.queryIndex = this.query.value.length;
        }
        this.lastQuery = query;
    },

    /**
     * Switch suggest item.
     * @param idx
     * @param state
     * @param replace
     */
    toggle: function (idx, state, replace) {
        var doc = this.frame.contentDocument || this.frame.contentWindow.document;
        var item = doc.getElementById('SS_suggestItem' + this.num + '_' + idx);
        if (SyncSearchUtils.assert(item)) {
            item.className = 'SS_suggestItem SS_suggestItem' + state;
            if (replace) {
                var html = item.childNodes[0].innerHTML;
                this.query.value = SyncSearchUtils.decodeInnerHTML(html);
            }
        }
    },

    /**
     * Hide suggests.
     */
    hide: function () {
        this.index = 0;
        var area = this.createArea();
        area.innerHTML = '';
        area.style.display = 'none';
        area.style.visibility = 'hidden';
        this.frame.style.height = '0px';
        this.frame.style.width = '0px';
    },

    /**
     * Check action at submit.
     * @param e
     */
    checkSubmit: function (e) {
        var idx = this.index;
        if (document.all) { //IE
            event.returnValue = (idx == 0); //IE
        } else if (idx != 0) {
            e.preventDefault(); //FF
        }
    },

    /**
     * Check IME status.
     * @param keyCode
     */
    checkIme: function (keyCode) {
        this.imeActive = typeof keyCode === 'undefined' || keyCode === 229;
    },

    /**
     * Enable suggest.
     * @note at OnFocus
     */
    enable: function () {
        ss_suggest = this;
        this.active = true;
        this.fixQuery();
    },

    /**
     * Disable suggest.
     * @note at OnBlur, MouseUp
     */
    disable: function () {
        if (this.clickLock === false) {
            this.active = false;
            this.fixQuery();
            this.hide();
        }
    },

    /**
     * Hidden suggest.
     */
    hidden: function () {
        this.active = false;
        this.fixQuery();
        this.hide();
    },

    /**
     * Fix suggest query.
     */
    fixQuery: function () {
        this.toggle(this.index, 'Off', false);
        this.index = 0;
        this.queryIndex = this.query.value.length;
    },

    /**
     * Do searching.
     */
    search: function () {
        document.getElementById(SYNCSEARCH_FORM + this.num).submit();
    },

    /**
     * Action for "mouse down".
     */
    mouseDown: function () {
        this.clickLock = true;
    },

    /**
     * Action for "mouse up".
     * @param elm
     */
    mouseUp: function (elm) {
        this.query.value = '';
        this.frame.focus();
        var html = elm.childNodes[0].innerHTML;
        this.query.value = SyncSearchUtils.decodeInnerHTML(html);
        this.clickLock = false;
        this.disable();
    },

    /**
     * Action for "mouse over".
     * @param elm
     */
    mouseOver: function (elm) {
        for (var i = 0; i < this.max; i++) {
            var doc = this.frame.contentDocument || this.frame.contentWindow.document;
            var itemElm = doc.getElementById('SS_suggestItem' + this.num + '_' + (i + 1));
            if (itemElm.id == elm.id) {
                itemElm.className = 'SS_suggestItem SS_suggestItemOn';
                this.index = i;
            } else {
                itemElm.className = 'SS_suggestItem SS_suggestItemOff';
            }
        }
    },

    /**
     * Action for "key down".
     * @param e
     */
    keyDown: function (e) {
        if (!SyncSearchUtils.assert(ss_suggest)) {
            return;
        }
        var keyCode = '';
        if (SyncSearchBrowser.IE) {
            keyCode = event.keyCode;
        } else {
            keyCode = e.which;
        }
        this.checkIme(keyCode); //If IME is active, disable do "Pressing Up Key" and "Pressing Down Key".
    },

    /**
     * Action for "key up".
     * @param e
     */
    keyUp: function (e) {
        if (!SyncSearchUtils.assert(ss_suggest)) {
            return;
        }
        var query = this.createQuery();
        query = query.replace('　', ' '); // From 1byte-character to 2Byte-character.
        if (SyncSearchUtils.isEmptyText(query)) {
            this.hide();
        } else {
            var keyCode = 0;
            if (SyncSearchBrowser.IE) { // IE
                keyCode = event.keyCode;
                event.returnValue = true; // Prevent the upper level from propagating events.
                event.cancelBubble = true; // Prevent the upper level from propagating events.
            } else { // exclude IE.
                keyCode = e.which;
                e.stopPropagation(); // Prevent the upper level from propagating events.
            }

            // Get inputted key-code.
            if (!this.imeActive && keyCode === 38) { // Pressing UP-Key.
                this.doUp();
            } else if (!this.imeActive && keyCode === 40) { // Pressing Down-Key.
                this.doDown();
            } else if (keyCode === 27) { // Pressing Esc-Key.
                this.hide();
            } else if (keyCode === 8 || keyCode === 46) { // Pressing Back-key or Del-key.
                this.doBack();
            } else if (keyCode === 39) { // Pressing Right-key.
                this.doRight();
            } else if (keyCode === 32) { // Pressing Space-key.
                this.doSpace();
            } else if (keyCode === 13) { // Pressing Enter-key.
                this.doEnter(query);
            }
        }
        this.lastChar = query.substring(query.length - 1, query.length);
    },

    /**
     * Action for pressing Up-Key.
     */
    doUp: function () {
        this.toggle(this.index, 'Off', true);
        if (this.index > 0) {
            --this.index;
        }
        this.toggle(this.index, 'On', true);
    },

    /**
     * Action for pressing Down-Key.
     */
    doDown: function () {
        if (this.index < this.max) {
            this.toggle(this.index, 'Off', true);
            ++this.index;
            this.toggle(this.index, 'On', true);
        }
    },

    /**
     * Action for pressing Back-Key or Del-Key.
     */
    doBack: function () {
        this.fixQuery();
    },

    /**
     * Action for pressing Enter-Key.
     * @param query
     */
    doEnter: function (query) {
        if (!this.active) {
            if (SyncSearchUtils.isAscii(query) || SyncSearchUtils.isAscii(this.lastChar)) {
                this.search();
            }
        }
        if (this.index > 0) {
            this.hidden();
        }
        this.fixQuery();
    },

    /**
     * Action for pressing Right-Key.
     */
    doRight: function () {
        var query = this.createQuery(); // From 1Byte-character to 2Byte-character.
        if (query.split(' ').length < this.depth) {
            this.index = 0;
            this.request(query, 2);
        }
    },

    /**
     * Action for pressing Space-Key.
     */
    doSpace: function () {
        this.queryIndex = this.query.value.length;
        var query = this.createQuery(); // From 1Byte-character to 2Byte-character.
        if (query.split(' ').length <= this.depth) {
            this.index = 0;
            this.request(query, 2);
        }
    }

};

/**
 * Suggest event.
 * @type {{observe: Function, bindReady: Function}}
 */
var SyncSearchEvent = {

    /**
     * Observe function
     * @param element
     * @param name
     * @param func
     */
    observe: function (element, name, func) {
        if (element.addEventListener) {
            element.addEventListener(name, func, false);
        } else if (element.attachEvent) {
            element.attachEvent('on' + name, func);
        }
    },

    /**
     * Binding 'onReady' state.
     * @param handler
     * @note This is the cross-browser 'DOMContentLoaded' handling code
     *       see http://javascript.info/tutorial/onload-ondomcontentloaded
     */
    bindReady: function (handler) {

        /**
         * Ready state.
         * @type {boolean}
         */
        var called = false;

        /**
         * Ready function.
         */
        var ready = function () {
            if (called) { // If handler called, nothing to do.
                return;
            }
            called = true;
            handler();
        };

        /**
         * Wait for ready state is 'complete'.
         */
        var wait = function () {
            if (document.readyState === 'complete') {
                ready();
            }
        };

        /**
         * Check state for under IE8.
         */
        var tryScroll = function () {
            if (called) {
                return;
            }
            try {
                document.documentElement.doScroll('left');
                ready();
            } catch (e) {
                setTimeout(tryScroll, 10); // Retry after 10 milli-sec.
            }
        };

        if (document.addEventListener) { // native event
            document.addEventListener('DOMContentLoaded', ready, false);
        } else if (document.attachEvent) { // IE
            try {
                var isFrame = window.frameElement != null;
            } catch (e) {
                // Nothing to do.
            }

            // IE, the document is not inside a frame
            if (document.documentElement.doScroll && !isFrame) {
                tryScroll();
            }

            // IE, the document is inside a frame
            document.attachEvent('onreadystatechange', wait);
        }

        // Old browsers
        if (window.addEventListener) {
            window.addEventListener('load', ready, false);
        } else if (window.attachEvent) {
            window.attachEvent('onload', ready);
        } else {
            var fn = window.onload; // very old browser, copy old onload
            window.onload = function () { // replace by new onload and call the old one
                fn && fn();
                ready();
            };
        }
    }

};

SyncSearchEvent.bindReady(SyncSearchUtils.initSyncSuggest);

/**
 * Prototype Function
 * @param obj
 * @returns {Function}
 */
if (!Function.prototype.bind) {
    Function.prototype.bind = function(object) {
        var __method = this;
        
        return function() {
            return __method.apply(object, arguments);
        }
    };
}

// jsr_class.js
//
// JSONscriptRequest -- a simple class for making HTTP requests
// using dynamically generated script tags and JSON
//
// Author: Jason Levitt
// Date: December 7th, 2005
//
// A SECURITY WARNING FROM DOUGLAS CROCKFORD:
// "The dynamic <script> tag hack suffers from a problem. It allows a page
// to access data from any server in the web, which is really useful.
// Unfortunately, the data is returned in the form of a script. That script
// can deliver the data, but it runs with the same authority as scripts on
// the base page, so it is able to steal cookies or misuse the authorization
// of the user with the server. A rogue script can do destructive things to
// the relationship between the user and the base server."
//
// So, be extremely cautious in your use of this script.
//
//
// Sample Usage:
//
// <script type="text/javascript" src="jsr_class.js"></script>
//
// function callbackfunc(jsonData) {
//      alert('Latitude = ' + jsonData.ResultSet.Result[0].Latitude +
//            '  Longitude = ' + jsonData.ResultSet.Result[0].Longitude);
//      aObj.removeScriptTag();
// }
//
// request = 'http://api.local.yahoo.com/MapsService/V1/geocode?appid=YahooDemo&
//            output=json&callback=callbackfunc&location=78704';
// aObj = new JSONscriptRequest(request);
// aObj.buildScriptTag();
// aObj.addScriptTag();
//
//

// Constructor -- pass a REST request URL to the constructor
//
var JSONscriptRequest = function (fullUrl) {
    // REST request path
    this.fullUrl = fullUrl;
    // Keep IE from caching requests
    this.noCacheIE = '&noCacheIE=' + (new Date()).getTime();
    // Get the DOM location to put the script tag
    this.headLoc = document.getElementsByTagName('head').item(0);
    // Generate a unique script tag id
    this.scriptId = 'JscriptId' + JSONscriptRequest.scriptCounter++;
};

// Static script ID counter
JSONscriptRequest.scriptCounter = 1;

// buildScriptTag method
//
JSONscriptRequest.prototype.buildScriptTag = function () {

    // Create the script tag
    this.scriptObj = document.createElement('script');

    // Add script object attributes
    this.scriptObj.setAttribute('type', 'text/javascript');
    this.scriptObj.setAttribute('charset', 'utf-8');
    this.scriptObj.setAttribute('src', this.fullUrl + this.noCacheIE);
    this.scriptObj.setAttribute('id', this.scriptId);
};

// removeScriptTag method
//
JSONscriptRequest.prototype.removeScriptTag = function () {
    // Destroy the script tag
    this.headLoc.removeChild(this.scriptObj);
};

// addScriptTag method
//
JSONscriptRequest.prototype.addScriptTag = function () {
    // Create the script tag
    this.headLoc.appendChild(this.scriptObj);
};
var AU_COMMON = AU_COMMON || {};

(function($) {

    AU_COMMON = {
        ANIMATION: {
            DURATION: 400,
            EASING: 'easeOutQuad',
        },
    };
    AU_COMMON.getCookie = function(c_name) {
        var st="";
        var ed="";
        if(document.cookie.length>0){
            st=document.cookie.indexOf(c_name + "=");
            if(st!=-1){
                st=st+c_name.length+1;
                ed=document.cookie.indexOf(";",st);
                if(ed==-1) ed=document.cookie.length;
                return decodeURIComponent(document.cookie.substring(st,ed));
            }
        }
        return "";
    };

    AU_COMMON.setCookie = function(name, value, path, days, domain, secure) {
        if (typeof(days) != "number") days = 7;
        var date;
        if (days > 0) {
            date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        } else {
            date = new Date(0);
        }
        document.cookie = encodeURIComponent(name) + "=" +
                encodeURIComponent(value) + "; " +
                (days != 0 ? "expires=" + date.toGMTString() + "; " : "") +
                (domain ? "domain=" + domain + "; " : "") +
                (path ? "path=" + path : "") +
                (secure ? "; secure" : "");
        return value;
    };

    AU_COMMON.getParameters = function(url, name) {
        var values = [];
        if (!name) {
            return null;
        }
        name = encodeURIComponent(name);
        if (url.indexOf("?") == -1) {
            return null;
        }
        if (url.indexOf("#") != -1) {
            url = url.substring(0, url.indexOf("#"));
        }
        var query = url.substring(url.indexOf("?") + 1);
        if (query.indexOf(name) == -1) {
            return null;
        }
        var queryPts = query.split("&");
        for (var i = 0; i < queryPts.length; i++) {
            var paramPts = queryPts[i].split("=");
            if (paramPts[0] == name) {
                values.push(paramPts.length > 1 ? decodeURIComponent(paramPts[1]) : "");
            }
        }
        return values.length > 0 ? values : null;
    };

    AU_COMMON.getParameter = function(url, name) {
        var params = AU_COMMON.getParameters(url, name);
        return params != null ? params[0] : null;
    };

    AU_COMMON.DrawerMenu = function($base, $openBtn, $container,$inner) {
        var self = this;

        self.$container = $container;
        self.$base = $base;
        self.$openBtn = $openBtn;
        self.$inner = $inner;

        self.init();
    };
    AU_COMMON.DrawerMenu.prototype = {
        STATE: {
            OPEN: 'is-drawer-open',
            CLOSE: 'is-drawer-close',
            LAYER_OPEN: 'is-layer-open',
            SLIDER_SLIDED: 'is-slider-slided',
            SLIDER_ACTIVE: 'is-slider-active',
            SLIDER_CLOSE: 'is-slider-close',
            ACCORDION_OPEN: 'accordion-opened',
            TAB_SELECTED: 'tab-selected',
        },

        init: function() {
            var self = this;

            self.setParamters();
            self.bindEvents();
            self.$openBtn.attr('aria-expanded', false);
            self.$base.addClass(self.STATE.CLOSE);
        },
        setParamters: function() {
            var self = this;

            self.$window = $(window);
            self.$html = $('html');
            self.$body = $('body');
            self.$closeBtn = self.$base.find('.jsc-drawer-close-btn');
            self.$overlay = $('<div>').addClass('backgroundSheet');
            self.$scrollLayer = $('<div>').addClass('megaMenuSmp-layer');
            self.$wrapper = $("#contentsWrapper");
            self.$wrap = $('#jsi-drawer-navigation');
            self.$sliderTrigger = $('.jsc-menu-list-slider-trigger');
            self.$sliderSubMenu = $('.jsc-sub-menu-list-slider');
            self.sliderTargetName = self.$sliderTrigger.data('menu-list-target');
            self.$sliderTarget = $('#jsi-menu-list-slider-target-' + self.sliderTargetName);
            self.$myAuSliderTrigger = $('.jsc-menu-list-slider-trigger-myau');
            self.$myAuSliderSubMenu = $('.jsc-sub-menu-list-slider-myau');
            self.myAuSliderTargetName = self.$myAuSliderTrigger.data('menu-list-target');
            self.$myAuSliderTarget = $('#jsi-menu-list-slider-target-' + self.myAuSliderTargetName);

            self.$accordion = $('.jsc-accordion');

            self.$localNavTrigger = $('.jsc-local-nav-trigger');
            self.$localNavTarget = $('.jsc-local-nav-target');

            self.$megaMenuTarget = $('.jsc-megaMenu-target');
            self.$myAuMenuTarget = $('.jsc-myAuMenu-target');
            self.$drawerNav = $('#jsi-drawer-navigation');
            self.classLocalNavOpend = 'accordion-opened';

            self.$header = $('#jsi-header');

            self.$container = $('#jsi-drawer-navigation-inner');

            self.fixedPosition = 0;

            self.isShow = false;

        },
        bindEvents: function() {
            var self = this;

            self.$container.trigger('scroll');
            self.$container.on('touchstart', function(event){
                isMoveTop = false;
            });

            self.$openBtn.on('click', function(event) {
                self.isShow = true;
                self.$header.trigger('isLayerOpen');

                event.preventDefault();
                $('.drawer-layer').removeClass(self.STATE.LAYER_OPEN);
                self.$base.closest('.drawer-layer').addClass(self.STATE.LAYER_OPEN);
                self.generateOverlay();
                self.openDrawer();

                $('#jsi-disable-scrolling').addClass('is-scrolling-disable');

                document.ontouchmove = function ( event ) {
                    var isTouchMoveAllowed = true;
                    var target = event.target;

                    while (target !== null) {
                        if (target.classList && target.classList.contains('is-scrolling-disable')) {
                            isTouchMoveAllowed = false;
                            break;
                        }
                        target = target.parentNode;
                    }

                    if ( !isTouchMoveAllowed ) {
                        event.preventDefault();
                    }
                };

                $('.megaMenuSmp-inner').off('scroll.burgerMenuScroll');
                $('.megaMenuSmp-inner').on('scroll.burgerMenuScroll', function(event){
                    var $this = $(this);
                    if ($this.scrollTop() == 0) {
                        $this.scrollTop(1);
                    }
                    if($this.get(0).scrollHeight - $this.height() == $this.scrollTop()) {
                        $this.scrollTop($this.scrollTop() - 1)
                    }
                });
                self.inhibitTabindexFocus();
            });

            self.$overlay.on('click', function(event) {
                event.preventDefault();
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$body.scrollTop(self.scrollTop);
                self.$header.trigger('isLayerClose');
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
            });

            self.$window.on('updateParameters', function(event, ua){
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$header.trigger('isLayerClose');
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
                self.$html.removeClass('is-drawer-open');
            });

            self.$closeBtn.on('click', function(event) {
                event.preventDefault();
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$body.scrollTop(self.scrollTop);
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
                self.$header.trigger('isLayerClose');
                self.$inner.trigger('closeSlider');
                self.$openBtn.focus();
            });

            self.$window.on('orientationchange', function(){
                event.preventDefault();
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$html.removeClass('is-drawer-open')
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
                self.$inner.trigger('closeSlider');
            });
            self.$base.on('touchmove scroll', function(event) {
                event.stopPropagation();
            });

            self.$sliderTarget.on('animationend',function(){
                if ($(this).hasClass(self.STATE.SLIDER_SLIDED)) {
                    $(this).find('a:first').focus();
                } else {
                    $(this).addClass(self.STATE.SLIDER_CLOSE);
                }
            });

            self.$myAuSliderTarget.on('animationend',function(){
                if ($(this).hasClass(self.STATE.SLIDER_SLIDED)) {
                    $(this).find('a:first').focus();
                } else {
                    $(this).addClass(self.STATE.SLIDER_CLOSE);
                }
            });

            self.$base.on('animationend',function(){
                // 各アニメーション終了時に必ず呼ばれる処理

                if ($(this).hasClass(self.STATE.OPEN)) {
                    // サイドメニューを開いている場合
                    if (self.$base.get(0).id === 'jsi-drawer-navigation') {
                        self.$body.append(self.$scrollLayer);
                    }
                    self.$window.scrollTop(0);
                    self.$openBtn.attr('aria-expanded', true);
                    if(self.$openBtn.is(':focus')){
                        self.$sliderTrigger.find('a:first').focus();
                    }
                } else {
                    // サイドメニューを閉じた場合
                    self.$html.removeClass(self.STATE.OPEN);
                    $('.drawer-layer').removeClass(self.STATE.LAYER_OPEN);
                    self.$base.addClass(self.STATE.CLOSE);
                    self.$openBtn.attr('aria-expanded', false);
                    self.$base.find('[aria-expanded=true]').attr('aria-expanded', false);
                }
            });

            self.$container.on('touchend',function(e){
                if ( $(e.target).hasClass('jsc-megaMenu-target') && self.isShow ) {
                    self.closeDrawer();
                    self.removeOverlay();
                    self.bindAllResetStateFunc();
                    $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
                    self.$html.removeClass('is-drawer-open');

                }
            });

            // 領域外タップ
            self.$megaMenuTarget.on('click touchend', function(event) {
                if ($.contains($('#jsi-drawer-navigation')[0], event.target)) {
                    return;
                }
                if(self.isShow === false) {
                    return;
                }
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$inner.trigger('closeSlider');
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
            });
            self.$myAuMenuTarget.on('click touchend', function(event) {
                if ($.contains($('#jsi-drawer-navigation')[0], event.target)) {
                    return;
                }
                if(self.isShow === false) {
                    return;
                }
                self.closeDrawer();
                self.removeOverlay();
                self.bindAllResetStateFunc();
                self.$inner.trigger('closeSlider');
                $('#jsi-disable-scrolling').removeClass('is-scrolling-disable');
            });
        },
        generateOverlay: function() {
            var self = this;
            self.$body.append(self.$overlay);

        },
        openDrawer: function() {
            var self = this;
            if(self.$localNavTarget.hasClass(self.classLocalNavOpend)) {
                self.$localNavTrigger.trigger('click');
            }
            self.$overlay.on('touchmove.noScroll', function(e) {
                e.preventDefault();
            });
            self.fixedPosition = self.$window.scrollTop();
            self.$wrapper.css({top: -1 * self.fixedPosition});

            self.$base.removeClass(self.STATE.CLOSE);
            self.$html.addClass(self.STATE.OPEN);
            self.$base.addClass(self.STATE.OPEN);
        },
        closeDrawer: function() {
            var self = this;
            self.isShow = false;

            if(self.fixedPosition > 0) {
                setTimeout(function(){
                    self.$wrapper.css('top', '');
                    self.$window.scrollTop(self.fixedPosition);
               }, 500);
            }

            if (self.$base.length) {
                self.$html.removeClass(self.STATE.OPEN);
                self.$base.removeClass(self.STATE.OPEN);
                if (self.$base.get(0).id === 'jsi-drawer-navigation') {
                    self.$scrollLayer.remove();
                }
            }
            self.allowTabindexFocus();

            setTimeout(function(){
                self.$base.trigger('animationend');
            }, 500);

        },
        removeOverlay: function() {
            var self = this;

            self.$overlay.detach();
        },
        bindAllResetStateFunc: function() {
            var self = this;

            self.resetSliderState();
            self.resetAccordionState();
        },
        resetSliderState: function() {
            var self = this;
            var isSlided = self.$sliderTrigger.hasClass(self.STATE.SLIDER_ACTIVE) || self.$myAuSliderTrigger.hasClass(self.STATE.SLIDER_ACTIVE);

            if(isSlided) {
                self.$sliderTrigger.removeClass(self.STATE.SLIDER_ACTIVE);
                self.$sliderTarget.removeClass(self.STATE.SLIDER_SLIDED);
                self.$sliderSubMenu.removeClass(self.STATE.SLIDER_SLIDED);
                self.$myAuSliderTrigger.removeClass(self.STATE.SLIDER_ACTIVE);
                self.$myAuSliderTarget.removeClass(self.STATE.SLIDER_SLIDED);
                self.$myAuSliderSubMenu.removeClass(self.STATE.SLIDER_SLIDED);
            }
        },
        resetAccordionState: function() {
            var self = this;

            self.$accordion.each(function() {
                var $accordion = $(this);
                var $accordionTarget = $accordion.find('.jsc-accordion-target');
                var isOpen = $accordion.hasClass(self.STATE.ACCORDION_OPEN);

                if(isOpen) {
                    $accordion.removeClass(self.STATE.ACCORDION_OPEN);
                    $accordionTarget.slideUp(0);
                }
            });
        },
        // for key operation with galaho
        inhibitTabindexFocus: function() {
            var self = this;
            self.$localNavTrigger.attr('tabindex','-1');
        },
        // for key operation with galaho
        allowTabindexFocus: function() {
            var self = this;
            self.$localNavTrigger.removeAttr('tabindex');
        },
    };
    $(function() {
        new AU_COMMON.DrawerMenu($('#jsi-drawer-navigation'), $('#jsi-drawer-navigation-open-btn'),$('#jsi-drawer-navigation-wrap'),$('#jsi-drawer-navigation-inner'));
    });

    /**
    *  商品・サービス メニュー（SP）.
    *
    * @param $base
    *
    */
    AU_COMMON.MenuListSlider = function($base) {
        var self = this;

        self.$base = $base;
        self.init();
    };
    AU_COMMON.MenuListSlider.prototype = {
        STATE: {
            SLIDED: 'is-slider-slided',
            ACTIVE: 'is-slider-active',
            CLOSE: 'is-slider-close'
        },
        CSS_LEFT: {
            HIDDEN: 0,
            VISIBLE: '100%',
        },

        init: function() {
            var self = this;

            self.setParamters();
            self.bindEvents();
            self.$triggerLink.attr('aria-expanded', false);
            self.$target.addClass(self.STATE.CLOSE);
        },
        setParamters: function() {
            var self = this;

            self.$slider = self.$base.find('#jsi-menu-list-slider');
            self.$trigger = self.$base.find('.jsc-menu-list-slider-trigger');
            self.$triggerLink = self.$trigger.find('a');
            self.$subMenu = self.$base.find('.jsc-sub-menu-list-slider');
            self.$scrollContent = self.$base.find('.jsc-scrollable');
            self.$productTarget = self.$base.find('.megaMenuSmp-select');

            self.targetName = self.$trigger.data('menu-list-target');
            self.$target = self.$base.find('#jsi-menu-list-slider-target-' + self.targetName);

            // My au メニュー（SP）のエレメントを取得
            self.$myAuTrigger = self.$base.find('.jsc-menu-list-slider-trigger-myau');
            self.$myAuTriggerLink = self.$myAuTrigger.find('a:first');
            self.$myAuSliderSubMenu = self.$base.find('.jsc-sub-menu-list-slider-myau');
            self.myAuTargetName = self.$myAuTrigger.data('menu-list-target');
            self.$myAuTarget = self.$base.find('#jsi-menu-list-slider-target-' + self.myAuTargetName);
        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function() {
                self.toggleSlider();
            });
            self.$scrollContent.on('touchstart', function() {


            })
        },
        toggleSlider: function() {
            var self = this;
            var isTargetSlided = self.$target.hasClass(self.STATE.SLIDED);
            var isMyAuMenuSlided = self.$myAuTarget.hasClass(self.STATE.SLIDED);

            // My au メニュー（SP）が開いている場合は閉じる
            if (isMyAuMenuSlided){
                self.$myAuTrigger.removeClass(self.STATE.ACTIVE);
                self.$myAuSliderSubMenu.removeClass(self.STATE.SLIDED);
                self.$myAuTarget.removeClass(self.STATE.SLIDED);
                self.$myAuTriggerLink.attr('aria-expanded', false);
            }

            if (isTargetSlided) {
                self.$scrollContent.trigger('closeSlider');
                self.$triggerLink.attr('aria-expanded', false);
            } else {
                self.$scrollContent.on('closeSlider', function(){
                    self.$scrollContent.off('closeSlider');
                });
                self.$triggerLink.attr('aria-expanded', true);
            }

            self.$trigger.toggleClass(self.STATE.ACTIVE);
            self.$subMenu.toggleClass(self.STATE.SLIDED);
            self.$target.removeClass(self.STATE.CLOSE);
            self.$target.toggleClass(self.STATE.SLIDED);

        },
    };
    $(function() {
        new AU_COMMON.MenuListSlider($('#jsi-drawer-navigation'));
    });

    /**
    * My au メニュー（SP）.
    *
    * @param $base
    *
    */
    AU_COMMON.MyAuMenuListSlider = function($base) {
        var self = this;

        self.$base = $base;
        self.init();
    };
    AU_COMMON.MyAuMenuListSlider.prototype = {
        STATE: {
            SLIDED: 'is-slider-slided',
            ACTIVE: 'is-slider-active',
            CLOSE: 'is-slider-close'
        },
        CSS_LEFT: {
            HIDDEN: 0,
            VISIBLE: '100%',
        },

        // 初期処理
        init: function() {
            var self = this;

            self.setParamters();
            self.bindEvents();
            self.$target.addClass(self.STATE.CLOSE);
            window.auDataLayer.addEventListener(window.auDataLayer.userInfo.ready, function(){
                // userInfoAPIの準備ができたら処理を行う.
                // au ユーザーにログインしている場合
                if (window.auDataLayer.userInfo.isAuUser()){
                    // My au メニュー（SP）に必要なクラスを追加
                    self.addMyAuMenuClass();
                }
            });

        },

        // パラメータ設定
        setParamters: function() {
            var self = this;

            // My au メニュー（SP）のエレメントを取得
            self.$slider = self.$base.find('#jsi-menu-list-slider');
            self.$trigger = self.$base.find('.jsc-menu-list-slider-trigger-myau');
            self.$triggerLink = self.$trigger.find('a');
            self.$subMenu = self.$base.find('.jsc-sub-menu-list-slider-myau');
            self.$scrollContent = self.$base.find('.jsc-scrollable');

            self.targetName = self.$trigger.data('menu-list-target');
            self.$target = self.$base.find('#jsi-menu-list-slider-target-' + self.targetName);

            // 商品・サービス メニュー（SP）のエレメントを取得
            self.$productTrigger = self.$base.find('.jsc-menu-list-slider-trigger');
            self.$productSliderSubMenu = self.$base.find('.jsc-sub-menu-list-slider');
            self.productTargetName = self.$productTrigger.data('menu-list-target');
            self.$productTarget = self.$base.find('#jsi-menu-list-slider-target-' + self.productTargetName);
        },

        // My au メニュー用のクラス追加
        addMyAuMenuClass: function() {
            var self = this;
            // My au メニュー用（SP）のクラスに変更（「＞」アイコンが付いているクラスに変更）
            self.$trigger.removeClass('myAuMenuSmp-mainNav-ttl-not-children');
            self.$trigger.addClass('myAuMenuSmp-mainNav-ttl-has-children');
            self.$triggerLink.attr('aria-expanded', false);
        },

        // イベント定義
        bindEvents: function() {
            var self = this;

            // My au メニュー（SP）のクリックイベント
            self.$trigger.on('click', function() {
                // au ユーザーにログインしている場合
                if (window.auDataLayer.userInfo.isAuUser()){
                    // My au メニュー（SP）のスライド処理を呼び出し
                    self.toggleSlider();
                }else{
                    // My au ページに遷移
                    self.toMyAuPage();
                }
            });
            self.$scrollContent.on('touchstart', function() {


            })
        },

        // My au メニュー（SP）のスライド処理
        toggleSlider: function() {
            var self = this;
            var isTargetSlided = self.$target.hasClass(self.STATE.SLIDED);
            var isProductMenuSlided = self.$productTarget.hasClass(self.STATE.SLIDED);

            // 商品・サービス メニュー（SP）が開いている場合は閉じる
            if (isProductMenuSlided){
                self.$productTrigger.removeClass(self.STATE.ACTIVE);
                self.$productSliderSubMenu.removeClass(self.STATE.SLIDED);
                self.$productTarget.removeClass(self.STATE.SLIDED);
            }

            // My au メニュー（SP）が開いている場合
            if (isTargetSlided) {
                // My au メニュー（SP）を閉じる
                self.$scrollContent.trigger('closeSlider');
                self.$triggerLink.attr('aria-expanded', false);
            } else {
                // My au メニュー（SP）の閉じるイベントを定義
                self.$scrollContent.on('closeSlider', function(){
                    self.$scrollContent.off('closeSlider');
                });
                self.$triggerLink.attr('aria-expanded', true);
            }

            // My au メニュー（SP）のクラスを切り替え（開 ⇔ 閉）
            self.$trigger.toggleClass(self.STATE.ACTIVE);
            self.$subMenu.toggleClass(self.STATE.SLIDED);
            self.$target.removeClass(self.STATE.CLOSE);
            self.$target.toggleClass(self.STATE.SLIDED);
        },
        // My au ページに遷移する処理
        toMyAuPage: function() {
            var self = this;
            var myAuUrl = self.$trigger.attr("data-myauurl");
            location.href = myAuUrl;
        }
    };

    // 起動時処理
    $(function() {
        if ($('.myAuMenuSmp-mainNav-contents').length) {
            new AU_COMMON.MyAuMenuListSlider($('#jsi-drawer-navigation'));
        }
    });

    AU_COMMON.Accordion = function($base) {
        var self = this;

        self.$base = $base;

        self.init();
    };
    AU_COMMON.Accordion.prototype = {
        STATE: {
            OPEN: 'accordion-opened',
        },
        init: function() {
            var self = this;

            self.setParamters();
            self.bindEvents();
            self.$triggerLink.attr('aria-expanded', false);
        },
        setParamters: function() {
            var self = this;

            self.$window = $(window);
            self.$scrollableArea = $('#jsi-drawer-navigation-inner');
            self.$trigger = self.$base.find('.jsc-accordion-trigger');
            self.$triggerLink = self.$trigger.find('a');
            self.$target = self.$base.find('.jsc-accordion-target');
            self.$targetLink = self.$target.find('a');

            self.scrollableAreaHeight = self.$scrollableArea.get(0).scrollHeight;
        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function(event) {
                event.stopPropagation();
                self.toggleAccordion();
            });
                    self.$target.on('scroll', function(event) {
                event.stopPropagation();
            });
        },
        toggleAccordion: function() {
            var self = this;

            self.$target.stop().slideToggle({
                duration: AU_COMMON.ANIMATION.DURATION / 2,
                easing: AU_COMMON.ANIMATION.EASING,
                complete: function() {
                    if(self.$targetLink.length > 0){
                        self.$targetLink[0].focus();
                    }
                }
            });

            self.$base.toggleClass(self.STATE.OPEN);
            var isAccordionOpen = self.$base.hasClass(self.STATE.OPEN);

            if(isAccordionOpen) {
                self.stackAccordionAtTop();
                self.$triggerLink.attr('aria-expanded', true);
            } else {
                self.stackAccordionAtBottom();
                self.$triggerLink.attr('aria-expanded', false);
            }

        },
        disable_scroll: function () {
            var self = this;

            self.$scrollableArea.get(0).ontouchmove = self.preventDefault;
            window.ontouchmove  = self.preventDefault; // mobile
        },
        enable_scroll: function () {
            var self = this;

            self.$scrollableArea.get(0).ontouchmove = null;
            window.ontouchmove = null;
        },
        preventDefault: function(e) {
            e = e || window.event;
            if (e.preventDefault)
                e.preventDefault();
            e.returnValue = false;
        },
        preventDefaultForScrollKeys: function(e) {
            if (keys[e.keyCode]) {
                preventDefault(e);
                return false;
            }
        },
        stackAccordionAtBottom: function() {
            var self = this;
            self.$scrollableArea.stop().animate({
                scrollTop: self.scrollableAreaHeight,
            });
        },
        stackAccordionAtTop: function($target) {
            var self = this;

            let targetTopOffset = self.$trigger.length ? self.$trigger.offset().top : 0;

            self.$scrollableArea.stop().animate({
                scrollTop: targetTopOffset + self.$scrollableArea.scrollTop(),
            }, function(){
                $('.megaMenuSmp-inner').trigger('scroll');
            });

        }
    };
    $(function() {
        $('.jsc-accordion').each(function() {
            new AU_COMMON.Accordion($(this));
        });
    });

    AU_COMMON.Tab = function($base) {
        var self = this;

        self.$base = $base;

        self.init();
    };

    AU_COMMON.LocalNav = function($base) {
        var self = this;

        self.$base = $base;

        self.init();
    };
    AU_COMMON.LocalNav.prototype = {
        STATE: {
            OPEN: 'accordion-opened',
        },
        init: function() {
            var self = this;

            self.setParameters();
            self.bindEvents();
        },
        setParameters: function() {
            var self = this;
            self.$window = $(window);
            self.$html = $('html');
            self.$body = $('body');
            self.$trigger = $('.jsc-local-nav-trigger');
            self.$target = $('.jsc-local-nav-target');
            self.$overlay = $('<div>').addClass('backgroundSheet');
            self.$localNav = $('#jsi-local-nav');
            self.$header = $('#jsi-header');
            self.$mainContent = $('#maincontArea');
            self.$accordionElem = $('.megaMenuSmp-accordion');

            self.$wrapper = $("#contentsWrapper");
            self.fixedPosition = 0;

        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function() {
                if(self.$target.is(':animated')) {
                    return;
                }
                self.toggleNav();
            });

            self.$overlay.on('click', function() {
                self.toggleNav();
            });

            self.$target.on('scroll touchmove', function(event) {
                event.stopPropagation();
            });

            self.$window.on('updateParameters', function() {
                self.closeNav();
                self.$mainContent.css({'overflow': '', 'position': ''})
                self.$target.removeClass(self.STATE.OPEN);
                self.$target.hide();
            });
        },
        generateOverlay: function() {
            var self = this;

            self.$html.addClass(self.STATE.OPEN);
            self.$base.addClass(self.STATE.OPEN);

            $('#jsi-disable-scrolling').append(self.$overlay);
            self.$overlay.css('display', 'block');
        },
        toggleNav: function() {
            var self = this;
            var isAccordionOpen = self.$target.hasClass(self.STATE.OPEN);

            self.$target.stop().slideToggle({
                duration: AU_COMMON.ANIMATION.DURATION / 2,
                easing: AU_COMMON.ANIMATION.EASING,
            });

            if(isAccordionOpen === false) {
                self.fixedPosition = self.$window.scrollTop();
                    self.generateOverlay();

                self.$localNav.css('z-index', 9999);
                self.$header.css('z-index', 9999);
                self.$overlay.on('touchmove.noScroll', function(event) {
                    event.preventDefault();
                });
                self.$mainContent.on('touchmove.noScroll', function(event) {
                    event.preventDefault();
                });
                self.$mainContent.css({'overflow': 'hidden', 'position': 'fixed'})
                self.$accordionElem.addClass('accordion-opened');

                self.$header.trigger('disableDisplay');
                setTimeout(function() {
                    self.$wrapper.css({'margin-top': -1 * self.fixedPosition});
                }, 0)


            }else{
                self.closeNav();
                self.$mainContent.css({'overflow': '', 'position': ''})
                self.$accordionElem.removeClass('accordion-opened');
                self.$wrapper.css('margin-top', '');
                self.$window.scrollTop(self.fixedPosition);
                self.$header.trigger('enableDisplay');
            }

            self.$target.toggleClass(self.STATE.OPEN);
        },
        removeOverlay: function() {
            var self = this;

            self.$overlay.detach();
        },
        closeNav: function() {
            var self = this;

            self.removeOverlay();
            self.$localNav.css('z-index', '');
            self.$header.css('z-index', '');
            self.$overlay.off('.noScroll');
            self.$mainContent.off('.noScroll');
            self.$html.removeClass(self.STATE.OPEN);
        }
    };
    $(function() {
        new AU_COMMON.LocalNav($('.jsc-tab'));
    });

    AU_COMMON.HeaderManager = {
        init: function() {

        },
        setParamters: function() {

        },
        bindEvents: function() {

        }
    };
    $(function() {
        AU_COMMON.HeaderManager.init();
    });

    AU_COMMON.PageTopScroller = {
        STATE: {
            SPEED: 500,
        },
        init: function() {
            var self = this;

            AU_COMMON.PageDivision.init();
            self.pageDivision = AU_COMMON.PageDivision.getPageDivision();

            self.setParamters();
            self.bindEvents();
            if(self.$trigger.hasClass('is-fadeIn')) {
                self.toggleTrigger();
            }
        },
        setParamters: function() {
            var self = this;

            self.$window = $(window);
            self.$trigger = $('.btn-pageTop');
            self.$header = $('#jsi-header');
            self.$localNav = $('#jsi-local-nav');
            self.headerHeight = self.$header.length ? self.$header.height() : 0;
            self.isGoToPageTop = false;
        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function(event) {
                event.preventDefault();
                self.goToTop();
            });

            if(self.$trigger.hasClass('is-fadeIn')) {
                self.$window.on('scroll', function() {
                    self.toggleTrigger();
                });
            }

        },
        toggleTrigger: function() {
            var self = this;
            if(self.isGoToPageTop) {
                return;
            }
            if(self.$window.scrollTop() > 100 && ! self.$trigger.hasClass('fadeIn')) {
                self.$trigger.addClass('fadeIn');
            }else if(self.$window.scrollTop() <= 100 && self.$trigger.hasClass('fadeIn')) {
                self.$trigger.removeClass('fadeIn');
            }
        },
        goToTop: function() {
            var self = this;
            if(self.$window.scrollTop() === 0) {
                return;
            }
            self.$window.on('touchmove.noScroll', function(e) {
                e.preventDefault();
            });
            self.$window.trigger('goToPageTop', [true]);

            $('body,html').animate({
                scrollTop: 0
            }, self.STATE.SPEED, function() {
                self.$window.off('.noScroll');
                self.$window.trigger('goToPageTop', [false]);
                self.$trigger.removeClass('fadeIn');

            });
        },
    };
    $(function() {
        AU_COMMON.PageTopScroller.init();
    });

    /**
    * メガ メニュー（PC）.
    *
    */
    AU_COMMON.MegaMenu = {
        init: function() {
            var self = this;

            self.setParamters();
            self.setSideContentPosition();
            self.bindEvents();
            self.$container.css({'display': 'none'});
            self.$trigger.attr('aria-expanded', false);
        },
        setParamters: function() {
            var self = this;

            self.$window = $(window);
            self.$trigger = $('.jsc-megaMenu-trigger');
            self.$target = $('.jsc-megaMenu-target');
            self.$bullet = $('.jsc-megaMenu-bullet');
            self.$content = $('.jsc-megaMenu-content');
            self.$container = $('.jsc-megaMenu-container');
            self.$sideContent = $('.jsc-megaMenu-sideContent');
            self.$close = $('.jsc-megaMenu-close');

            self.$phoneInfoTriggr = $('.jsc-phone-info-trigger');
            self.$myAuMenuTriggr = $('.jsc-myAuMenu-trigger');

            if (self.$target.length) {
                self.triggerTop = self.$target.offset().top;
            }

            if (self.$content.length) {
                self.contentHeight = self.$content.height();
                self.contentWidth = self.$content.width();
            }

            if (self.$sideContent.length) {
                self.sideContentWidth = self.$sideContent.width();
                self.sideContentHeight = self.$sideContent.height();
                self.sideContentTop = self.$sideContent.position().top;
            }

            AU_COMMON.PageDivision.init();
            this.pageDivision = AU_COMMON.PageDivision.getPageDivision();
        },
        setSideContentPosition: function() {
            var self = this;
            if (self.$sideContent.length) {
                self.sideContentWidth = self.$sideContent.width();
                self.sideContentBottom = self.$sideContent.height() + self.$sideContent.offset().top;
            }
        },
        bindEvents: function() {
            var self = this;
            var windowWidth = $(window).width();


            self.$trigger.on('click', function() {
                self.toggleMegaMenu();
            });
            self.$close.on('click', function() {
                self.toggleMegaMenu();
            });

            self.$window.on('orientationchange', function(){
                self.setParamters();
                self.setSideContentPosition();
            });

            var timer = false;
            self.$window.on('resize', function() {
                if(Math.abs(self.$window - windowWidth) > 200) {
                    return
                }
                self.$bullet.hide();
                self.$content.css('opacity','0');
                if (timer !== false) {
                    clearTimeout(timer);
                }
                timer = setTimeout(function() {
                    self.setParamters();
                    self.setSideContentPosition();
                    self.$content.css({'top':'', 'left': ''})
                    if(! self.$target.hasClass('is-open')){
                    return;
                }
                if(self.pageDivision == 'pc') {
                    if(! self.$target.hasClass('is-open')){
                        self.showMegaMenuPc();
                    }else{
                        self.hideMegaMenuPc();
                    }
                }else{
                    if(! self.$target.hasClass('is-open')){
                        self.showMegaMenuMiniPc();
                    }else{
                        self.hideMegaMenuMiniPc();
                    }
                }
                }, 200);
            });

            var scrollTimer = false;
            self.$window.on('scroll', function() {
                if(! self.$target.hasClass('is-open')){
                    return;
                }
                if(self.pageDivision == 'pc') {
                    if(! self.$target.hasClass('is-open')){
                        self.showMegaMenuPc();
                    }else{
                        self.hideMegaMenuPc();
                    }
                }else{
                    if(! self.$target.hasClass('is-open')){
                        self.showMegaMenuMiniPc();
                    }else{
                        self.hideMegaMenuMiniPc();
                    }
                }
            });
            self.$trigger.on('closeMegaMenu', function() {
                if(self.pageDivision == 'pc') {
                    self.hideMegaMenuPc();
                }else{
                    self.hideMegaMenuMiniPc();
                }
            });
            self.$trigger.on('quickHideMegaMenu', function() {
                if(self.pageDivision == 'pc') {
                    self.quickHideMegaMenuPc();
                }else{
                    self.quickHideMegaMenuMiniPc();
                }
            });
        },
        toggleMegaMenu: function() {
            var self = this;
            if(self.$content.is(':animated')){
                return;
            }
            if(self.pageDivision == 'pc') {
                if(! self.$target.hasClass('is-open')){
                    self.showMegaMenuPc();
                }else{
                    self.hideMegaMenuPc();
                }
            }else{
                if(! self.$target.hasClass('is-open')){
                    self.showMegaMenuMiniPc();
                }else{
                    self.hideMegaMenuMiniPc();
                }
            }
        },
        showMegaMenuPc: function() {
            var self = this;
            self.$phoneInfoTriggr.trigger('closeContent');
            self.$myAuMenuTriggr.trigger('quickHideMyAuMenu');

            self.$content.animate({
                'left': 180,
                'opacity': 1,
                'z-index':999
            }, 300, 'easeOutExpo', 
            function(){
                self.$container.find('a:first').focus();
            });
            self.$container.css({'opacity': 1});
            self.$container.css({'display': 'inline-block'});
            self.$trigger.attr('aria-expanded', true);
            self.$close.css({'display': 'inline-block'});
            self.$bullet.show();
            self.$target.addClass('is-open');
        },
        showMegaMenuMiniPc: function() {
            const self = this,
                  showPosition = 49;
            self.$phoneInfoTriggr.trigger('closeContent');
            self.$myAuMenuTriggr.trigger('quickHideMyAuMenu');
            self.$content.css('top', showPosition + 1);
            self.$content.animate({
                'top': showPosition,
                'opacity': 1,
                'z-index':999
            }, 300, 'easeOutExpo', 
            function(){
                self.$container.find('a:first').focus();
            });
            self.$container.css({'opacity': 1});
            self.$close.css({'display': 'inline-block'});
            self.$container.css({'display': 'inline-block'});
            self.$trigger.attr('aria-expanded', true);
            self.$bullet.css({'top':30}).show();
            self.$target.addClass('is-open');
        },
        hideMegaMenuPc: function() {
            var self = this;

            self.$content.css('z-index', '');
            self.$content.animate({
                'left': - (self.contentWidth - self.sideContentWidth),
            },300, 'easeOutExpo', function(){
                self.$content.css('opacity','0');
                self.$container.css({'display': 'none'});
            });
            self.$container.css({'opacity': 0});
            self.$close.css({'display': 'none'});
            self.$trigger.attr('aria-expanded', false);
            self.$bullet.hide();
            self.$target.removeClass('is-open');
            self.$trigger.focus();
        },
        hideMegaMenuMiniPc: function() {
            var self = this;
            self.$content.css('z-index', '');
            self.$content.animate({
                top: self.sideContentHeight,
                'height': 0,
            }, 250, 'easeOutExpo', function(){
                self.$content.css({'opacity':'0', 'height': ''});
                self.$container.css({'display': 'none'});
            });

            self.$container.css({'opacity': 0});
            self.$close.css({'display': 'none'});
            self.$trigger.attr('aria-expanded', false);
            self.$bullet.css({'top':''}).hide();
            self.$target.removeClass('is-open');
            self.$trigger.focus();
        },
        quickHideMegaMenuPc: function() {
            var self = this;

            self.$content.css('z-index', '');
            self.$content.css({'left': - (self.contentWidth - self.sideContentWidth)});
            self.$content.css({'opacity': 0});
            self.$container.css({'opacity': 0});
            self.$close.css({'display': 'none'});
            self.$bullet.hide();
            self.$target.removeClass('is-open');
        },
        quickHideMegaMenuMiniPc: function() {
            var self = this;
            self.$content.css('z-index', '');
            self.$content.css({top: self.sideContentHeight});
            self.$content.css({'opacity':'0', 'height': ''});
            self.$container.css({'opacity': 0});
            self.$close.css({'display': 'none'});
            self.$bullet.css({'top':''}).hide();
            self.$target.removeClass('is-open');
        }
    };
    $(function() {
        AU_COMMON.MegaMenu.init();
    });

    /**
    * My au メニュー（PC）.
    *
    */
    AU_COMMON.MyAuMenu = {
            // 初期処理
            init: function() {
                var self = this;

                self.setParamters();
                self.setSideContentPosition();
                self.bindEvents();

            },

            // パラメータ設定
            setParamters: function() {
                var self = this;

                self.$window = $(window);
                self.$trigger = $('.jsc-myAuMenu-trigger');
                self.$target = $('.jsc-myAuMenu-target');
                self.$bullet = $('.jsc-myAuMenu-bullet');
                self.$content = $('.jsc-myAuMenu-content');
                self.$container = $('.jsc-myAuMenu-container');
                self.$sideContent = $('.jsc-megaMenu-sideContent');
                self.$close = $('.jsc-myAuMenu-close');

                self.$phoneInfoTriggr = $('.jsc-phone-info-trigger');
                self.$megaMenuTriggr = $('.jsc-megaMenu-trigger');

                // ターゲットの縦位置取得
                if (self.$target.length) {
                    self.triggerTop = self.$target.offset().top;
                }

                // コンテンツの高さ・幅取得
                if (self.$content.length) {
                    self.contentHeight = self.$content.height();
                    self.contentWidth = self.$content.width();
                }

                // サイドメニューの幅・高さ・縦位置取得
                if (self.$sideContent.length) {
                    self.sideContentWidth = self.$sideContent.width();
                    self.sideContentHeight = self.$sideContent.height();
                    self.sideContentTop = self.$sideContent.position().top;
                }

                AU_COMMON.PageDivision.init();
                this.pageDivision = AU_COMMON.PageDivision.getPageDivision();
            },

            // サイドメニューの表示位置を取得
            setSideContentPosition: function() {
                var self = this;
                if (self.$sideContent.length) {
                    self.sideContentWidth = self.$sideContent.width();
                    self.sideContentBottom = self.$sideContent.height() + self.$sideContent.offset().top;
                }
            },
            // イベント定義
            bindEvents: function() {
                var self = this;
                var windowWidth = $(window).width();


                // My au メニュー（PC）クリックイベント
                self.$trigger.on('click', function() {

                    // au ユーザーにログインしている、かつ My au メニューコンテンツが存在する場合
                    if (window.auDataLayer.userInfo.isAuUser() && self.$content.length){
                        // My au メニューの表示切り替え
                        self.toggleMyAuMenu();
                    }else{
                        // My au ページに遷移
                        self.toMyAuPage();
                    }

                });

                // My au メニュー（PC）の × ボタンクリックイベント
                self.$close.on('click', function() {
                    self.toggleMyAuMenu();
                });

                // My au メニュー（PC）の 縦横比変更イベント
                self.$window.on('orientationchange', function(){
                    self.setParamters();
                    self.setSideContentPosition();
                });

                // My au メニュー（PC）の 画面サイズ変更イベント
                var timer = false;
                self.$window.on('resize', function() {
                    if(Math.abs(self.$window - windowWidth) > 200) {
                        return
                    }
                    self.$bullet.hide();
                    self.$content.css('opacity','0');
                    if (timer !== false) {
                        clearTimeout(timer);
                    }
                    timer = setTimeout(function() {
                        self.setParamters();
                        self.setSideContentPosition();
                        self.$content.css({'top':'', 'left': ''})
                        if(! self.$target.hasClass('is-open')){
                        return;
                    }
                    if(self.pageDivision == 'pc') {
                        if(! self.$target.hasClass('is-open')){
                            self.showMyAuMenuPc();
                        }else{
                            self.hideMyAuMenuPc();
                        }
                    }else{
                        if(! self.$target.hasClass('is-open')){
                            self.showMyAuMenuMiniPc();
                        }else{
                            self.hideMyAuMenuMiniPc();
                        }
                    }
                    }, 200);
                });

                // My au メニュー（PC）の スクロールイベント
                var scrollTimer = false;
                self.$window.on('scroll', function() {
                    if(! self.$target.hasClass('is-open')){
                        return;
                    }
                    if(self.pageDivision == 'pc') {
                        if(! self.$target.hasClass('is-open')){
                            self.showMyAuMenuPc();
                        }else{
                            self.hideMyAuMenuPc();
                        }
                    }else{
                        if(! self.$target.hasClass('is-open')){
                            self.showMyAuMenuMiniPc();
                        }else{
                            self.hideMyAuMenuMiniPc();
                        }
                    }
                });

                // My au メニュー（PC）の 閉じるイベント（アニメーションあり）
                self.$trigger.on('closeMyAuMenu', function() {
                    if(self.pageDivision == 'pc') {
                        self.hideMyAuMenuPc();
                    }else{
                        self.hideMyAuMenuMiniPc();
                    }
                });

                // My au メニュー（PC）の 閉じるイベント（アニメーションなし）
                self.$trigger.on('quickHideMyAuMenu', function() {
                    if(self.pageDivision == 'pc') {
                        self.quickHideMyAuMenuPc();
                    }else{
                        self.quickHideMyAuMenuMiniPc();
                    }
                });
            },

            // My au メニュー（PC）の 表示切り替え
            toggleMyAuMenu: function() {
                var self = this;
                if(self.$content.is(':animated')){
                    return;
                }
                if(self.pageDivision == 'pc') {
                    if(! self.$target.hasClass('is-open')){
                        self.showMyAuMenuPc();
                    }else{
                        self.hideMyAuMenuPc();
                    }
                }else{
                    if(! self.$target.hasClass('is-open')){
                        self.showMyAuMenuMiniPc();
                    }else{
                        self.hideMyAuMenuMiniPc();
                    }
                }
            },

            // My au メニュー（PC）の 表示
            showMyAuMenuPc: function() {
                var self = this;
                self.$phoneInfoTriggr.trigger('closeContent');
                self.$megaMenuTriggr.trigger('quickHideMegaMenu');

                self.$content.animate({
                    'left': 180,
                    'opacity': 1,
                    'z-index':999
                }, 300, 'easeOutExpo');
                self.$container.css({'opacity': 1});
                self.$close.css({'display': 'inline-block'});
                self.$bullet.show();
                self.$target.addClass('is-open');
            },

            // My au メニュー（PC）の 表示（ミニPC用）
            showMyAuMenuMiniPc: function() {
                const self = this,
                      showPosition = 49;
                self.$phoneInfoTriggr.trigger('closeContent');
                self.$megaMenuTriggr.trigger('quickHideMegaMenu');
                self.$content.css('top', showPosition + 1);
                self.$content.animate({
                    'top': showPosition,
                    'opacity': 1,
                    'z-index':999
                }, 300, 'easeOutExpo');
                self.$container.css({'opacity': 1});
                self.$close.css({'display': 'inline-block'});
                self.$bullet.css({'top':30}).show();
                self.$target.addClass('is-open');
            },

            // My au メニュー（PC）の 非表示（アニメーションあり）
            hideMyAuMenuPc: function() {
                var self = this;

                self.$content.css('z-index', '');
                self.$content.animate({
                    'left': - (self.contentWidth - self.sideContentWidth),
                },300, 'easeOutExpo', function(){
                    self.$content.css('opacity','0');
                });
                self.$container.css({'opacity': 0});
                self.$close.css({'display': 'none'});
                self.$bullet.css({'top':''}).hide();
                self.$target.removeClass('is-open');
            },
            // My au メニュー（PC）の 非表示（アニメーションあり）（ミニPC用）
            hideMyAuMenuMiniPc: function() {
                var self = this;
                self.$content.css('z-index', '');
                self.$content.animate({
                    top: self.sideContentHeight,
                    'height': 0,
                }, 250, 'easeOutExpo', function(){
                    self.$content.css({'opacity':'0', 'height': ''});
                });

                self.$container.css({'opacity': 0});
                self.$close.css({'display': 'none'});
                self.$bullet.css({'top':''}).hide();
                self.$target.removeClass('is-open');
            },

            // My au メニュー（PC）の 非表示（アニメーションなし）
            quickHideMyAuMenuPc: function() {
                var self = this;

                self.$content.css('z-index', '');
                self.$content.css({'left': - (self.contentWidth - self.sideContentWidth)});
                self.$content.css({'opacity': 0});
                self.$container.css({'opacity': 0});
                self.$close.css({'display': 'none'});
                self.$bullet.hide();
                self.$target.removeClass('is-open');
            },

            // My au メニュー（PC）の 非表示（アニメーションなし）（ミニPC用）
            quickHideMyAuMenuMiniPc: function() {
                var self = this;
                self.$content.css('z-index', '');
                self.$content.css({top: self.sideContentHeight});
                self.$content.css({'opacity':'0', 'height': ''});
                self.$container.css({'opacity': 0});
                self.$close.css({'display': 'none'});
                self.$bullet.hide()
                self.$target.removeClass('is-open');
            },

            // My au ページに遷移
            toMyAuPage: function() {
                var self = this;
                var myAuUrl = self.$trigger.attr("data-myauurl");
                location.href = myAuUrl;
            }
    };
    // 起動時処理
    $(function() {
        AU_COMMON.MyAuMenu.init();
    });


    AU_COMMON.PhoneInfo = {
        init: function() {
            var self = this;

            self.setParamters();
            self.bindEvents();
            self.toggleContent();
        },
        setParamters: function() {
            var self = this;

            self.PageDivisionObj = AU_COMMON.PageDivision;
            self.PageDivisionObj.init();
            this.pageDivision = self.PageDivisionObj.getPageDivision();

            self.$window = $(window);
            self.$wrapper = $('.jsc-phone-info');
            self.$trigger = $('.jsc-phone-info-trigger');
            self.$target = $('.jsc-phone-info-target');
            self.$close = $('.jsc-phone-info-close');
            self.$megaMenuTrigger = $('.jsc-megaMenu-trigger');
            self.$myAuMenuTrigger = $('.jsc-myAuMenu-trigger');
            self.setWidthHeight();
            self.isShow = false;
        },
        setWidthHeight: function() {
            var self = this;

            if (self.$target.length) {
                self.targetWidth = self.$target.outerWidth();
                self.targetHeight = self.$target.outerHeight();
            }
            if (self.$trigger.length) {
                self.triggerWidth = self.$trigger.outerWidth();
                self.triggerHeight = self.$trigger.outerHeight();
            }
        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function(event) {
                event.preventDefault();
                self.showContent();
                self.$megaMenuTrigger.trigger('closeMegaMenu');
                self.$myAuMenuTrigger.trigger('closeMyAuMenu');
            });

            self.$close.on('click', function(event) {
                event.preventDefault();
                self.closeContent();
            });

            self.$trigger.on('closeContent', function() {
                self.closeContent();
            });

            var timer = false;
            self.$window.on('resize', function() {

                if (timer !== false) {
                    clearTimeout(timer);
                }
                timer = setTimeout(function() {
                    if (self.$window.innerHeight() < self.targetHeight && self.isShow == true) {
                        self.$wrapper.css('top', 0);
                        self.$wrapper.css('bottom', 'auto');
                    }else{
                        self.$wrapper.css('top', 'auto');
                        self.$wrapper.css('bottom', '20px');
                    }
                    self.toggleContent();
                }, 200);
            });
        },
        showContent: function() {
            var self = this;

            self.$trigger.hide();
            self.$wrapper.animate({
                width: self.targetWidth,
                height: self.targetHeight
            }, 300, 'easeOutExpo', function(){
                if (self.$window.innerHeight() < self.targetHeight) {
                    self.$wrapper.css('top', 0);
                    self.$wrapper.css('bottom', 'auto');
                }
                self.$target.fadeIn('fast');
            });
            self.isShow = true;
        },
        closeContent: function() {
            var self = this;

            self.$target.fadeOut('fast');
            self.$wrapper.css('top', '');
            self.$wrapper.css('bottom', '20px');
            self.$wrapper.not(':animated').animate({
                width: self.triggerWidth,
                height: self.triggerHeight
            }, 300, 'easeOutExpo', function(){
                self.$wrapper.css({'width': '', 'height': ''});
                self.$trigger.show();
            });
            self.isShow = false;
        },
        toggleContent: function() {
            var self = this;

            self.pageDivision = self.PageDivisionObj.getPageDivision();

            if(self.pageDivision == 'sp' || self.pageDivision == 'tb') {
                self.$wrapper.hide();
            }else{
                self.$wrapper.show();
            }
        }

    };
    $(function() {
        AU_COMMON.PhoneInfo.init();
    });

    AU_COMMON.MENU_SLIDER = {
        SLIDE_TIME : 400,
        init : function(){
            var self = this;

            self.setParameters();
            self.bindEvents();
            if($(window).width() < 980) {
                return;
            }
            setTimeout( function() {
                self.slide();
            }, 1000);
        },
        setParameters : function(){

            if($(window).width() < 980) {
                return;
            }
            this.$window = $(window);
            this.windowWidth = $(window).innerWidth();
            this.$html = $('html');
            this.$wrapper = $('#contentsWrapper');
            this.$navigator = $('#jsi-local-nav');
            this.navigatorHeight = this.$navigator.length ? this.$navigator.innerHeight() : 0;
            this.$megamenuSideContent = $('.jsc-megaMenu-sideContent');
            this.$navigator.addClass('isDonMove');

            if(window.innerWidth >= 980 && window.innerWidth < 1200) {
                let megamenuSideContentHeight = this.$megamenuSideContent.length ? this.$megamenuSideContent.height() : 0;
                this.targetTop = megamenuSideContentHeight;
            }
        },
        bindEvents: function() {
            var self = this;

            $(window).on("orientationchange",function(){
                if(Math.abs(window.orientation) === 90){
                    self.setParameters();
                    setTimeout( function() {
                        self.slide();
                    }, 1000);
                }
            });
            var timer = false;
        },
        slide : function(){
            var self = this;

            this.$wrapper.animate({'margin-top' : 0}, this.SLIDE_TIME);
            this.$navigator.animate({top : self.targetTop}, this.SLIDE_TIME, function(){
                self.$navigator.css('position', '');
                self.$navigator.css('top', '');
                self.$navigator.removeClass('isDonMove');
                self.$navigator.removeClass('init');
                self.$window.trigger('isSuccessDropMenu');
                self.$window.trigger('isSuccessDropMenu');
            });
        }
    };

    AU_COMMON.ShowSearch = {
        init: function() {
            var self = this;

            self.setParameters();
            self.bindEvents();
        },
        setParameters: function() {
            var self = this;

            self.$wrapper = $('.jsc-show-search-wrapper');
            self.$trigger = $('.jsc-show-search-trigger');
            self.$target = $('.jsc-show-search-target');
            self.targetWidth = self.$target.length ? self.$target.width() : 0;
            self.$contentsWrapper = $("#contentsWrapper");
        },
        bindEvents: function() {
            var self = this;

            self.$trigger.on('click', function(event) {
                event.preventDefault();

                self.showContent();
            });

            self.$contentsWrapper.on('click', function (event) {
                if(self.$target.hasClass('isOpen') && ! $.contains(self.$wrapper[0], event.target)){
                    self.hideSearchBtn();
                };
            });
        },
        showContent: function() {
            var self = this;

            self.$trigger.css('visibility', 'hidden');
            self.$target.css('opacity', 1).animate({'width': 120}).addClass('isOpen');
            self.$wrapper.css('background-image','none');
        },
        hideSearchBtn: function() {
            var self = this;

            if(! self.$target.hasClass('isOpen')){
                return;
            }
            self.$target
                .removeClass('isOpen')
                .animate({'width': 48}, function(){
                    self.$trigger.css('visibility', '')
                    $(this).css('opacity', '')
                    self.$wrapper.css('background-image', '');
                });
        }
    }
    $(function() {
        AU_COMMON.ShowSearch.init();
    });

    AU_COMMON.FixedHeaderPC = {
        init: function() {
            this.setParameters();
            this.bindEvents();
        },
        setParameters: function() {
            AU_COMMON.PageDivision.init();
            this.pageDivision = AU_COMMON.PageDivision.getPageDivision();
            this.$window = $(window);
            this.$html = $('html');
            this.$targets = {};

            this.$header = $('#jsi-header');
            this.$localNav = $('#jsi-local-nav');
            this.localNavHeight = this.$localNav.length ? this.$localNav.outerHeight() : 0;
            this.$sideContent = $('.sidecontArea');
            this.stopPoint = '';
            this.windowWidth = this.$window.width;
            this.$target = $('.jsc-fixedHeader-target');
            this.updateParameters();

            this.isRequiredAnimate = false;
            this.isShowHeader = true;
        },
        updateParameters: function(isPageChange) {
            this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
            if(this.pageDivision == 'pc') {
                this.$sideContent = $('.sidecontArea');
                this.stopPoint = '';
                this.$targets = [];
                this.$targets = this.$localNav;
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
                this.$header = $('#jsi-header');
            }else if(this.pageDivision == 'minipc') {
                this.$sideContent = $('.sidecontArea');
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.outerHeight() : 0;
                this.stopPoint = '';
                this.$targets = [];
                this.stopPoint = parseInt(this.localNavHeight);
                this.$targets = this.$localNav;
                this.$header = this.$sideContent;
                this.$header.removeClass('is-hide');
                this.$header.removeClass('is-fixed');
                this.$targets.removeClass('is-fixed');
                this.$header.removeClass('stored-header-ismove');
                this.$targets.removeClass('is-absolute');
                this.$header.removeClass('is-absolute');
                this.$header.removeClass('stored-header-hoge');

            }else if(this.pageDivision == 'tb' || this.pageDivision == 'sp') {
                this.stopPoint = '';
                this.$targets = [];
                this.$targets = this.$localNav;
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
                this.$header = $('#jsi-header');
                this.stopPoint = this.$header.length ? this.$header.height() : 0;
            }
            if(this.$targets.hasClass('is-fixed') && (this.pageDivision == 'minipc' || this.pageDivision == 'pc') && isPageChange) {
                this.$targets.css('top', 0);
                this.isRequiredAnimate = true;
                this.isShowHeader = false;
                this.$sideContent.addClass('is-fixed');
            }else{
                this.$targets.css('top', '');
                this.isRequiredAnimate = false;
                this.isShowHeader = true;
                this.$sideContent.removeClass('is-fixed');
                this.$targets.removeClass('is-fixed');
            }
            this.$targets.removeClass('stored-header-ismove');
            this.$header.removeClass('stored-header-isshow');
            this.$header.removeClass('stored-header-ishide');

        },
        bindEvents: function() {
            var self = this;
            var timer  = false;
            var start_pos = 0;
            var upDown = '';

            this.$window.on('scroll', function(e) {
                var $this = $(this);

                if(self.isGoToPageTop) {
                    return;
                }

                if (timer !== false) {
                    clearTimeout(timer);
                }

                var current_pos = $this.scrollTop();
                if (current_pos > start_pos) {
                    upDown = 'down'
                }else if (current_pos < start_pos) {
                    upDown = 'up'
                }

                // ヘッダ出納処理
                if (upDown != '') {
                    if(self.pageDivision == 'pc') {
                        self.toggleContent();
                    }else if(self.pageDivision == 'minipc') {
                        self.toggleContentMiniPc(upDown);
                    }else if(self.pageDivision != 'minipc') {
                        self.toggleContentSP(upDown);
                    }
                }
                start_pos = current_pos;
                if(self.pageDivision == 'minipc' && current_pos < self.stopPoint) {
                    if(! self.$header.hasClass('is-absolute')) {
                        self.$header.addClass('is-absolute')
                    }
                    if(! self.$targets.hasClass('is-absolute')) {
                        self.$targets.addClass('is-absolute')
                    }
                }

                timer = setTimeout(function() {
                    if(current_pos == 0 && self.pageDivision == 'minipc') {
                        self.resetHeader(current_pos);
                    }
                }, 200);
            });
            this.$window.on('updateParameters', function(event, ua) {
                self.pageDivision = ua;
                self.updateParameters(true);
            });

            // ページトップ押下時は処理を止める。ページトップ完了時はパラメータ更新
            this.$window.on('goToPageTop', function(event, isGoToPageTop) {
                self.isGoToPageTop = isGoToPageTop;
                if(self.isGoToPageTop === false) {
                    self.updateParameters();
                }
            });
            this.$header.on('disableDisplay', function(){
                self.$targets.removeClass('stored-header-ismove');
                self.$header.removeClass('stored-header-ishide');
                self.disabledDisplay = true;
            });
            this.$header.on('enableDisplay', function(){
                self.disabledDisplay = false;
            });
        },
        toggleContent: function() {
            var self = this;
            if (self.disabledDisplay) return;
            var scrollTop = this.$window.scrollTop();
            if(scrollTop > this.stopPoint) {
                this.$targets.css('top','');
                this.$targets.addClass('is-fixed');
            }else if(scrollTop <= this.stopPoint) {
                this.$targets.removeClass('is-fixed');
            }
        },
        toggleContentMiniPc: function(upDown) {
            var self = this;
            if(this.$sideContent.is(':animated') || self.disabledDisplay) {
                return;
            }
            var self = this;
            var scrollTop = this.$window.scrollTop();

            self.$targets.removeClass('stored-header-hoge');
            self.$header.removeClass('stored-header-hoge');

            if(upDown == 'down') {
                this.hideHeader(scrollTop);
                return;
            }
            if(upDown == 'up') {
                this.showHeader(scrollTop);
                return;
            }
        },
        toggleContentSP: function(upDown) {
            var self = this;
            if(this.$sideContent.is(':animated') || self.disabledDisplay) {
                return;
            }
            var scrollTop = this.$window.scrollTop();

            // ヘッダ格納
            if(scrollTop > this.stopPoint && upDown == 'down' && ! this.$targets.hasClass('stored-header-ismove')) {
                this.$targets.addClass('stored-header-ismove');
                this.$targets.addClass('is-fixed');
                this.$header.addClass('stored-header-ishide');
            // ヘッダ表示
            }else if(upDown == 'up' && this.$header.hasClass('stored-header-ishide')) {
                this.$targets.removeClass('stored-header-ismove');
                this.$header.removeClass('stored-header-ishide');

            }
        },
        hideHeader: function(scrollTop) {
            if(scrollTop < this.stopPoint) {
                return;
            }
            var self = this;
            // 一度目のスクロール時はアニメーションせずにグレー帯が固定される
            if(this.isRequiredAnimate === false) {
                self.$targets.removeClass('is-absolute');
                this.$header.removeClass('is-absolute');

                self.$header.addClass('is-hide');
                self.$targets.addClass('is-fixed');
                this.isRequiredAnimate = true;
            }
            // 一度ヘッダが格納されれば次回よりヘッダはアニメーションで表示する
            else if(this.isRequiredAnimate === true && this.isShowHeader) {
                this.$header.removeClass('stored-header-ismove');
                this.$targets.removeClass('stored-header-ismove');

                this.isRequiredAnimate = true;
            }
            this.isShowHeader = false;

        },
        showHeader: function(scrollTop) {
            if(scrollTop < this.stopPoint) {
                this.resetHeader(scrollTop);
                return;
            }
            if(this.isShowHeader) {
                return;
            }
            this.isShowHeader = true;
            this.isRequiredAnimate = true;

            this.$header.addClass('stored-header-ismove');
            this.$targets.addClass('stored-header-ismove');

            return;
        },
        resetHeader:function(scrollTop){
            if(scrollTop > this.stopPoint) {
                return;
            }

            this.$targets.addClass('stored-header-hoge');
            this.$header.addClass('stored-header-hoge');
            this.isRequiredAnimate = false;
            this.$sideContent.removeClass('is-fixed');
            this.$targets.removeClass('is-fixed');
            this.$header.removeClass('is-hide');
            this.$header.removeClass('stored-header-ismove');
            this.$targets.removeClass('stored-header-ismove');
        }
    }

    AU_COMMON.FixedHeaderSP = {
        init: function() {
            this.setParameters();
            this.bindEvents();
        },
        setParameters: function() {
            AU_COMMON.PageDivision.init();
            this.pageDivision = AU_COMMON.PageDivision.getPageDivision();

            this.$window = $(window);
            this.$html = $('html');
            this.$targets = {};

            this.$header = $('#jsi-header');
            this.headerHeight = this.$header.length ? this.$header.height() : 0;
            this.$localNav = $('#jsi-local-nav');
            this.$sideContent = $('.sidecontArea');
            this.stopPoint = '';
            this.windowWidth = this.$window.width;
            this.$target = $('.jsc-fixedHeader-target');
            this.updateParameters();
            this.disabledDisplay;


            this.isRequiredAnimate = false;
            this.isShowHeader = true;

            this.windowH = window.innerHeight;
            this.positionGap = 0;
        },
        updateParameters: function() {

            this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;

            if(this.pageDivision == 'pc') {
                this.stopPoint = '';
                this.$targets = [];
                this.$targets = this.$localNav;
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
                this.$header = $('#jsi-header');
            }else if(this.pageDivision == 'minipc') {
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
                this.stopPoint = '';
                this.$targets = [];
                this.stopPoint = parseInt(this.sideContentHeight);
                this.$targets = this.$localNav;
                this.$header = this.$sideContent;
                this.$header.removeClass('is-hide');
                this.$header.removeClass('is-fixed');
                this.$targets.removeClass('is-fixed');
                this.$header.removeClass('stored-header-ismove');
                this.$targets.removeClass('is-absolute');
                this.$header.removeClass('is-absolute');
                this.$header.removeClass('stored-header-hoge');
            }else if(this.pageDivision == 'tb' || this.pageDivision == 'sp') {
                this.stopPoint = '';
                this.$targets = [];
                this.$targets = this.$localNav;
                this.sideContentHeight = this.$sideContent.length ? this.$sideContent.height() : 0;
                this.$header = $('#jsi-header');
                this.stopPoint = this.$header.length ? this.$header.height() : 0;
            }
            if(this.$targets.hasClass('is-fixed') && (this.pageDivision == 'minipc' || this.pageDivision == 'pc') && isPageChange) {
                this.$targets.css('top', 0);
                this.isRequiredAnimate = true;
                this.isShowHeader = false;
                this.$sideContent.addClass('is-fixed');
            }else{
                this.$targets.css('top', '');
                this.isRequiredAnimate = false;
                this.isShowHeader = true;
                this.$sideContent.removeClass('is-fixed');
                this.$targets.removeClass('is-fixed');
            }
            this.$targets.removeClass('stored-header-ismove');
            this.$header.removeClass('stored-header-isshow');
            this.$header.removeClass('stored-header-ishide');

        },
        bindEvents: function() {
            var self = this;
            var timer  = false;
            var start_pos = 0;
            var upDown = '';
            var startscrollTop = null;
            var documentHeight = $(document).height();


            this.$window.on('touchstart', function(e) {
                startscrollTop = self.$window.scrollTop();
            });

            this.$window.on('scroll', function(e) {

                if (timer !== false) {
                    clearTimeout(timer);
                }

                //do not execute match height when scrolling is not end(heropanel.js, carousel.js)
                $.each(carouselTimer, function() {
                    if (this !== false) {
                        clearTimeout(this);
                    }
                });

                timer = setTimeout(function() {

                    var dh = $(document).height();
                    var wh = window.innerHeight;
                    var wy = window.pageYOffset;

                    if(startscrollTop === null) {
                        return;
                    }
                    if(self.$html.hasClass('is-drawer-open')) {
                        return;
                    }
                    if(self.isGoToPageTop) {
                        return;
                    }

                    if(wy+wh > dh) return;

                    var $this = $(this);
                    var current_pos = $this.scrollTop();
                    if(current_pos < 0) {
                        return;
                    }

                    if(self.pageDivision == 'minipc' && current_pos < this.stopPoint) {
                        if(! self.$header.hasClass('is-absolute')) {
                            self.$header.addClass('is-absolute')
                        }
                        if(! self.$targets.hasClass('is-absolute')) {
                            self.$targets.addClass('is-absolute')
                        }
                    }


                    self.positionGap += current_pos - startscrollTop;


                    if(self.windowH == wh){

                        if (self.positionGap > 1) {
                            upDown = 'down';
                            self.positionGap = 0;
                        }
                        else if (self.positionGap < -1) {
                            upDown = 'up';
                            self.positionGap = 0;
                        }else{
                            upDown = 'nan';
                        }
                        // ヘッダ出納処理
                        if(self.pageDivision == 'pc') {
                            self.toggleContentPc();
                        }
                        if(self.pageDivision == 'minipc') {
                            self.toggleContentMiniPc(upDown);
                        }
                        if(self.pageDivision != 'minipc') {
                            self.toggleContentSP(upDown);
                        }
                    }
                    if(self.pageDivision == 'minipc' && current_pos < self.stopPoint && upDown == "down") {
                        if(! self.$header.hasClass('is-absolute')) {
                            self.$header.addClass('is-absolute')
                        }
                        if(! self.$targets.hasClass('is-absolute')) {
                            self.$targets.addClass('is-absolute')
                        }
                    }
                    self.windowH = wh;

                        // ヘッダ出納処理
                        if(self.pageDivision == 'pc') {
                            self.toggleContentPc();
                        }
                        if(self.pageDivision == 'minipc') {
                            self.toggleContentMiniPc(upDown);
                        }
                        if(self.pageDivision != 'minipc') {
                            self.toggleContentSP(upDown);
                        }

                        var scrollHeight = $(document).height();
                        var scrollPosition = $(window).height() + $(window).scrollTop();
                        if ((scrollHeight - scrollPosition) / scrollHeight === 0 &&
                            (self.pageDivision != 'tb' || self.pageDivision != 'sp')) {
                            self.$targets.removeClass('stored-header-ismove');
                            self.$header.removeClass('stored-header-ishide');
                        }
                        startscrollTop = current_pos;
                }, 100);

            });
            this.$window.on('updateParameters', function(event, ua) {
                self.pageDivision = ua;
                self.updateParameters();
            });

            // ページトップ押下時は処理を止める。ページトップ完了時はパラメータ更新
            this.$window.on('goToPageTop', function(event, isGoToPageTop) {
                self.isGoToPageTop = isGoToPageTop;
                if(self.isGoToPageTop === false) {
                    self.updateParameters();
                }
            });
            self.$header.on('disableDisplay', function(){
                if (self.$targets.hasClass('stored-header-ismove')) {
                    self.toggleContentSP('up');
                }
                self.disabledDisplay = true;
            });
            self.$header.on('enableDisplay', function(){
                self.disabledDisplay = false;
            })

        },
        toggleContentPc: function() {
            var scrollTop = this.$window.scrollTop();
            if(scrollTop > this.stopPoint) {
                this.$targets.css('top','');
                this.$targets.addClass('is-fixed');
            }else if(scrollTop <= this.stopPoint) {
                this.$targets.removeClass('is-fixed');
            }
        },
        toggleContentSP: function(upDown) {
            var self = this;
            if(this.$sideContent.is(':animated') || self.disabledDisplay) {
                return;
            }

            var scrollTop = this.$window.scrollTop();

            // ヘッダ格納
            if(scrollTop > this.stopPoint && upDown == 'down' && ! this.$targets.hasClass('stored-header-ismove')) {
                this.$targets.addClass('stored-header-ismove');
                this.$targets.addClass('is-fixed');
                this.$header.addClass('stored-header-ishide');
            // ヘッダ表示
            }else if(upDown == 'up' && this.$header.hasClass('stored-header-ishide')) {
                this.$targets.removeClass('stored-header-ismove');
                this.$header.removeClass('stored-header-ishide');
            }
        },
        toggleContentMiniPc: function(upDown) {
            var self = this;
            var scrollTop = this.$window.scrollTop();

            self.$targets.removeClass('stored-header-hoge');
            self.$header.removeClass('stored-header-hoge');

            if(upDown == 'down' && this.isShowHeader) {
                this.hideHeader(scrollTop);
                return;
            }
            if(upDown == 'up') {
                this.showHeader(scrollTop);
                return;
            }
        },
        hideHeader: function(scrollTop) {
            if(scrollTop < this.stopPoint) {
                return;
            }
            var self = this;
            // 一度目のスクロール時はアニメーションせずにグレー帯が固定される
            if(this.isRequiredAnimate === false) {
                self.$targets.removeClass('is-absolute');
                this.$header.removeClass('is-absolute');

                self.$header.addClass('is-hide');
                self.$targets.addClass('is-fixed');
                this.isRequiredAnimate = true;
            }
            // 一度ヘッダが格納されれば次回よりヘッダはアニメーションで表示する
            else if(this.isRequiredAnimate === true && this.isShowHeader) {
                this.$header.removeClass('stored-header-ismove');
                this.$targets.removeClass('stored-header-ismove');

                this.isRequiredAnimate = true;
            }
            this.isShowHeader = false;

        },
        showHeader: function(scrollTop) {
            if(scrollTop < this.stopPoint) {
                this.resetHeader(scrollTop);
                return;
            }
            if(this.isShowHeader) {
                return;
            }

            this.isShowHeader = true;
            this.isRequiredAnimate = true;

            this.$header.addClass('stored-header-ismove');
            this.$targets.addClass('stored-header-ismove');

            return;
        },
        resetHeader:function(scrollTop){
            if(scrollTop > this.stopPoint) {
                return;
            }

            this.$targets.addClass('stored-header-hoge');
            this.$header.addClass('stored-header-hoge');
            this.isRequiredAnimate = false;
            this.$sideContent.removeClass('is-fixed');
            this.$targets.removeClass('is-fixed');
            this.$header.removeClass('is-hide');
            this.$header.removeClass('stored-header-ismove');
            this.$targets.removeClass('stored-header-ismove');
        }
    }

    $(function() {
        var ua = AU_COMMON.Get_UA.init();
        if(ua == 'isPc') {
            AU_COMMON.FixedHeaderPC.init();
        }else{
            AU_COMMON.FixedHeaderSP.init();
        }

        // zoom設定 取得できない場合は1を設定
        var zoom = $("#jsi-local-nav, .cmp-au-com-localnav").css("zoom");
        if (isNaN(zoom)) {
            zoom = '1';
        }

        // URLのアンカー値を変更を検知
        $(window).on('hashchange', function(){
            if (window.location.hash) {
                // スクロール処理
                var hashTop = $(window.location.hash).offset().top;
                let $navi = $("#jsi-local-nav, .cmp-au-com-localnav");
                let naviHeight = $navi.length ? $navi.height() * zoom : 0;
                let $head = $("#jsi-header");
                let headHeight = $head.length ? $head.height()  * zoom : 0;
                var scrollPosition = hashTop - naviHeight - headHeight;
                $('html, body').animate({
                    scrollTop: scrollPosition
                }, 500);
            }
        });
        $(window).on('load', function(e) {
            if (window.location.hash) {
                // スクロール処理 (ローカルナビの表示がスマホ表示の場合)
                if($(window).width() < 980) {
                    var hashTop = $(window.location.hash).offset().top;
                    let $navi = $("#jsi-local-nav, .cmp-au-com-localnav");
                    let naviHeight = $navi.length ? $navi.height() * zoom : 0;
                    let $head = $("#jsi-header");
                    let headHeight = $head.length ? $head.height() * zoom : 0;
                    var scrollPosition = hashTop - naviHeight - headHeight;
                    $('html, body').animate({
                        scrollTop: scrollPosition
                    }, 500);
                }
            }
        });
    });

    AU_COMMON.Get_UA = {
        init: function() {
            var ua = navigator.userAgent.toLowerCase();
            var isWindows = /windows/.test(ua);
            var isMac = /mac/.test(ua);
            var isIPhone = /i(phone|pod)/.test(ua);
            var isIPad = /ipad/.test(ua);
            var isIOS = isIPhone || isIPad;
            var isAndroid = /android/.test(ua);
            var isAndroidMobile = /android(.+)?mobile/.test(ua);
            var isIE = /msie|trident/.test(ua);
            var isFirefox = /firefox/.test(ua);
            var isChrome = /chrome/.test(ua);
            var isCrios = /crios/.test(ua);
            var isSafari = /safari/.test(ua);
            var isOpera = /opera/.test(ua);
            var isOperaMobile = /opera mobi/.test(ua);
            var isOperaMini = /opera mini/.test(ua);
            var isTablet = isIPad || (isAndroid && !isAndroidMobile && !isOperaMobile);
            var isSmartphone = isIPhone || isAndroidMobile;
            var isPC = !isIOS && !isAndroid;

            if(isPC){
                return 'isPc';
            }else if(isTablet){
                return "isTablet";
            }else if(isSmartphone){
                return "isPhone";
            }
        }
    }

    AU_COMMON.PageDivision = {
        init: function() {
            this.setParameters();
            this.bindEvents();
        },
        setParameters: function() {
            this.$window = $(window);
            this.pageDivision = this.judgePageDivision();
        },
        bindEvents: function() {
            var self = this;
            var timer = false;
            var thisPagedivision = '';

            this.$window.on('resize', function() {

                thisPagedivision = self.judgePageDivision();

                if(self.pageDivision != thisPagedivision) {
                    self.pageDivision = thisPagedivision
                    self.$window.trigger('updateParameters', [thisPagedivision]);
                }
            });
        },
        getPageDivision: function() {
            return this.pageDivision;
        },
        judgePageDivision: function() {
            if(this.$window.width()　>= 1200) {
                thisPageDivision = 'pc';
            }
            if(this.$window.width()　< 1200 && this.$window.width()　>= 980) {
                thisPageDivision = 'minipc';
            }
            if(this.$window.width()　< 980 && this.$window.width()　>= 768) {
                thisPageDivision = 'tb';
            }
            if(this.$window.width()　< 768) {
                thisPageDivision = 'sp';
            }
            return thisPageDivision;
        }
    }
    $(function() {
        AU_COMMON.PageDivision.init();
    });

    AU_COMMON.WindowNoResize = {
        init: function() {
            this.setParameters();
            this.bindEvents();
        },
        setParameters: function() {
            this.$window = $(window);
        },
        bindEvents: function() {
            this.$window.on('resize', function(e) {
                e.preventDefault();
                return;
            });
        }
    }

    $(function() {
        AU_COMMON.WindowNoResize.init();
    });

})(jQuery);

(function($) {
    // for local nav of product pages
    var timer = false,
        $productLocalNav = $('#jsi-local-nav.productElem'),
        $categoryLocalNav = $('#jsi-local-nav.mainHeadLocalNav-category'),
        setProductLocalNavLaidOut = function(){
            var numWindowWidth = window.innerWidth ? window.innerWidth : $(window).width();
            if ($productLocalNav.length) {
                var $navList = $('.mainHeadLocalNav-list', $productLocalNav),
                    $navListContents = $('> *', $navList),
                    $productName = $('.mainHeadLocalNav-toCategoryTop', $productLocalNav),
                    $navBtn = $('.btn-section', $productLocalNav),
                    $featuredCont = $('.featuredCont', $navList),
                    numFeaturedContents = $featuredCont.length,
                    numListContents = $navListContents.length,
                    numFeaturedContentsWidth = (function(){
                        var numSumWidth = 0,
                            i
                        ;
                        for (i = 0; i < numListContents; i++) {
                            numSumWidth += $navListContents.eq(i).outerWidth();
                        }
                        return numSumWidth;
                    })(),
                    _setNavMarginLeft = function() {
                    let numPosList = $productName.length ? $productName.position().left + $productName.outerWidth() : 0,
                            numMarginLeft = numPosList + numFeaturedContentsWidth,
                            numIndex = numListContents - numFeaturedContents,
                            $target = $navListContents.eq(numIndex)
                        ;
                        if ($navBtn.length) {
                            var numPosBtn = $navBtn.position().left;
                            numMarginLeft = numPosBtn - numMarginLeft - 20; //ボタン有
                        } else {
                            let numNavWidth = $productLocalNav.length ? $productLocalNav.width() : 0;
                            // マージン調整幅：ローカルナビの全体幅 - プロダクト名幅 - ローカルナビリストコンテンツ幅 - マージン調整幅(20)
                            numMarginLeft = numNavWidth - ($productName.length ? $productName.outerWidth() : 0) - numFeaturedContentsWidth - 20; //ボタン無
                        }
                        if (numMarginLeft > 0) {
                            $target.css({'margin-left': numMarginLeft});
                        }
                    },
                    _setProductNameMaxWidth = function() {
                        var numProductNameOuterSpace = numFeaturedContentsWidth + 60,
                            numMaxWidth = numWindowWidth - numProductNameOuterSpace,
                            _setMaxWidth = function() {
                                $productName.css({'max-width': numMaxWidth});
                            }
                        ;
                        if ($navBtn.length) {
                            numMaxWidth -= $navBtn.outerWidth();
                        }
                        $productName.removeAttr('style');
                        if (($productName.length ? $productName.outerWidth() : 0) < numMaxWidth) {
                            _setNavMarginLeft();
                        } else {
                            _setMaxWidth();
                            _setNavMarginLeft();
                        }
                    }
                ;
                if (numWindowWidth >= 1200) {
                    numWindowWidth -= 200;
                }
                if (numWindowWidth >= 980) {
                    _setProductNameMaxWidth();
                } else {
                    $navListContents.removeAttr('style');
                }
            } else if ($categoryLocalNav.length) {
                var $navList = $('.megaMenuSmp-accordion', $categoryLocalNav),
                    $productName = $('.mainHeadLocalNav-toCategoryTop', $categoryLocalNav)
                ;
                if (numWindowWidth >= 980) {
                    let navListWidth = $categoryLocalNav.width() - ($productName.length ? $productName.outerWidth() : 0);
                    $navList.css('width',navListWidth);
                }
            }
        }
    ;
    $(window)
        .on('load', setProductLocalNavLaidOut)
        .on('resize', function(){
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(setProductLocalNavLaidOut, 100);
        })
    ;

    $.fn.isVisible = function() {
        return $.expr.pseudos.visible(this[0]);
    }
    ;

})(jQuery);
/* agreementsAPI.js */
(function ($) {
    window.agreementsAPI = {};
    window.agreementsAPI.SESSION_AGREEDTERMS_KEY = 'agreedTerms';
    window.agreementsAPI.SESSION_STORAGE_TERMLIST_KEY = 'individualTermsList';
    window.agreementsAPI.AGREESTATUS = '1';
    window.agreementsAPI.DISAGREESTATUS = '0';
    window.agreementsAPI.POST_SUCCESS_EVENT_NAME = 'ppmpostmodagreements:success';
    window.agreementsAPI.POST_ERROR_EVENT_NAME = 'ppmpostmodagreements:error';
    window.agreementsAPI.POST_ALL_EVENT_NAME = window.agreementsAPI.POST_SUCCESS_EVENT_NAME + " " + window.agreementsAPI.POST_ERROR_EVENT_NAME;

    const validate = function (individualTermsList) {
        var json = JSON.stringify(individualTermsList);
        window.sessionStorage.setItem(window.agreementsAPI.SESSION_STORAGE_TERMLIST_KEY, json);
    }

    const invalidate = function () {
        window.sessionStorage.removeItem(window.agreementsAPI.SESSION_STORAGE_TERMLIST_KEY);
    }

    /*
     *  同意状態変更要求サーブレットを呼び出し
     *  @param agreeAtLoginList 強制同意規約情報リスト
     */
    function ppmPostModAgreements(agreeAtLoginList){
        $.ajax({
            url: '/bin/wcm/au-com/ppmpostmodagreements.json',
            type: 'POST',
            dataType: "application/json; charset=utf-8",
            cache : false,
            data : { kiyakuInfoArray:JSON.stringify(agreeAtLoginList) },
        }).done(function(data, status, xhr){
            $(document).trigger(window.agreementsAPI.POST_SUCCESS_EVENT_NAME );
        }).fail(function(data, status, xhr){
            $(document).trigger(window.agreementsAPI.POST_ERROR_EVENT_NAME);
        });
    }
    window.agreementsAPI.ppmPostModAgreements = ppmPostModAgreements;
    /*
     *  規約情報設定取得サーブレットを呼び出し
     *  @param agreement 同意情報
     */
    function ppmGetTermsInfo(agreement){
        $.ajax({
            url: '/bin/wcm/au-com/termsInfoConfig.json',
            type: 'GET',
            cache : false
        }).done(function(data, status, xhr){
            if (data) {
                var termsInfoMap = {};
                for (var i in data) {
                    var termData = data[i].data;
                    if (termData && termData.master && termData.master.termsCode) {
                        var master = termData.master;
                        var termsCode = master.termsCode;
                        termsInfoMap[termsCode] = {termsPage: master.individualTermsPage, agreeAtLogin: master.agreeAtLogin};
                    }
                }
                if(Object.keys(termsInfoMap).length){
                    var agreeAtLoginList = [];
                    var individualTermsList = [];
                    for (var key in agreement) {
                        if (isDisagree(agreement[key])) {
                            var termsInfo = termsInfoMap[agreement[key].kiyakuCode];
                            if (termsInfo) {
                                var agreeAtLogin = termsInfo.agreeAtLogin;
                                var url = location.href;
                                if (agreeAtLogin == true){
                                    agreeAtLoginList.push({kiyakuCode: agreement[key].kiyakuCode,kiyakuNumCode: agreement[key].kiyakuLatestNumCode,agreementStatus: "1"});
                                } else {
                                    if (termsInfo.termsPage) {
                                        var pagePath = termsInfo.termsPage.replace('/content/au-com', '');
                                        var termsNumCode = agreement[key].kiyakuLatestNumCode;
                                        if (pagePath && termsNumCode) {
                                            var redirectPath = pagePath + ".ver-" + termsNumCode + "/";
                                            individualTermsList.push({termsCode: agreement[key].kiyakuCode,pagePath:redirectPath,returnUrl: url});
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (agreeAtLoginList.length > 0) {
                        $(document).on(window.agreementsAPI.POST_ALL_EVENT_NAME, function () {
                            if (individualTermsList.length > 0){
                                validate(individualTermsList);
                                location.href = individualTermsList[0].pagePath;
                            }
                        });
                        ppmPostModAgreements(agreeAtLoginList);
                    } else if (individualTermsList.length > 0) {
                        validate(individualTermsList);
                        location.href = individualTermsList[0].pagePath;
                    }
                }
            }
        });
    }

    function isDisagree(agreementInfo){
        if(agreementInfo && agreementInfo.kiyakuCode && agreementInfo.kiyakuLatestNumCode && agreementInfo.validAgreementFlag === "") {
            return true;
        }
        return false;
    }

    function existDisagree(agreement){
        if (agreement.length > 0){
            for (var key in agreement) {
                if (isDisagree(agreement[key])) {
                    return true;
                }
            }
        }
        return false
    }

    /*
     *  セッションストレージにindividualTermsListを更新
     */
    function updateIndividualTermsList(kiyakuCode){
        var individualTerms = null;
        var individualTermsList = JSON.parse(window.sessionStorage.getItem(window.agreementsAPI.SESSION_STORAGE_TERMLIST_KEY));
        if(individualTermsList && kiyakuCode) {
            if(individualTermsList.length && individualTermsList.length > 0 ) {
                for(var index in individualTermsList ) {
                    if(individualTermsList[index].termsCode == kiyakuCode) {
                        individualTerms = JSON.parse(JSON.stringify(individualTermsList[index]));
                        individualTermsList.splice(index,1);
                    }
                }
            }
            if (individualTerms) {
                if (individualTermsList.length == 0) {
                    invalidate();
                    window.location.href = individualTerms.returnUrl;
                } else {
                    window.sessionStorage.setItem(window.agreementsAPI.SESSION_STORAGE_TERMLIST_KEY,JSON.stringify(individualTermsList));
                    window.location.href = individualTermsList[0].pagePath;
                }
            }
        }
    }
    window.agreementsAPI.updateIndividualTermsList = updateIndividualTermsList;

    /*
     *  同意状態参照サーブレットを呼び出し
     */
    function ppmGetAgreements(){
        $.ajax({
            url: '/bin/wcm/au-com/ppmgetagreements.json',
            type: 'GET',
            cache : false
        }).done(function(data, status, xhr){
            if (data) {
                const agreement = data.agreement;
                if (existDisagree(agreement)){
                    ppmGetTermsInfo(agreement);
                }
            }
        })
    }

    if (CommonUtil.isPublish()) {
        if (window.sessionStorage.getItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY)){
            window.sessionStorage.removeItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY);
            var execFlg = false;
            window.auDataLayer.addEventListener(window.auDataLayer.userInfo.ready, function(){
                if (!execFlg && window.auDataLayer.userInfo.isLive()) {
                    execFlg = true;
                    ppmGetAgreements();
                }
            });
        }
    }

})(jQuery);
/* cartAPI.js */
(function ($) {
    "use strict";

    if (window.cartAPI) {
        return; // 2重初期化防止
    }

    /**
     * APIの箱.
     *
     *
     */
    window.cartAPI = {};

    const LOCAL_STORAGE_KEY = 'cart';
    const CURRENT_CART_OBJ_VERSION = '1.0';

    /**
     * 初期化処理.
     */
    function init() {
        if (!isLive()) {
            var cart = {};
            cart.ver = CURRENT_CART_OBJ_VERSION;
            cart.data = {};
            cart.cnt = 0;
            var json = JSON.stringify(cart);
            window.localStorage.setItem(LOCAL_STORAGE_KEY, json);
        }
    };

    /**
     * カートへアイテムを追加.
     *
     * @param productCode
     * @param contractType
     * @param qty
     *
     */
    var add = function (productCode, contractType, qty) {

        if (isLive()) {
            var item = {};
            item.productCode = productCode;
            if (contractType === '1'
                    || contractType === '2'
                    || contractType === '3'
                    || contractType === '4'
                    || contractType === '5') {
                item.contractType = contractType;
            }
            item.qty = qty;

            var data = getCartObj();

            if (!data[productCode]) {
                incrementCnt();
            }
            data[productCode] = item;

            setCartObj(data);
        }
    };
    window.cartAPI.add = add;

    /**
     * カートからアイテムを削除.
     *
     * @param productCode
     */
    var remove = function (productCode) {

        if (isLive()) {
            var data = getCartObj();

            if (data[productCode]) {
                delete data[productCode];
                decrementCnt();
            }

            setCartObj(data);
        }
    };
    window.cartAPI.remove = remove;

    /**
     * カートの内容を取得.
     *
     * @return JavaScript オブジェクト
     */
    var getCartObj = function () {
        if (isLive()) {
            var json = window.localStorage.getItem(LOCAL_STORAGE_KEY);
            var cart = JSON.parse(json);
            var data = cart.data;

            return data;
        }
    }
    window.cartAPI.getCartObj = getCartObj;

    /**
     * カートオブジェクトをセットする.
     *
     * @param data
     */
    var setCartObj = function (data) {
        if (isLive()) {
            var json = window.localStorage.getItem(LOCAL_STORAGE_KEY);
            var cart = JSON.parse(json);

            cart.data = data;

            json = JSON.stringify(cart);
            window.localStorage.setItem(LOCAL_STORAGE_KEY, json);
        }
    }

    /**
     * LocalStorage が生きているかチェック.
     */
    var isLive = function () {
        if (window.localStorage.getItem(LOCAL_STORAGE_KEY)) {
            return true;
        }
        return false;
    };

    /**
     * カート内件数を取得.
     *
     * @return カート内件数
     */
    function getCartNum() {
        var json = window.localStorage.getItem(LOCAL_STORAGE_KEY);
        var cart = JSON.parse(json);

        return cart.cnt;
    }
    window.cartAPI.getCartNum = getCartNum;

    /**
     * カート内件数を加算.
     */
    function incrementCnt() {
        addCnt(1);
    }
    /**
     * カート内件数を減算.
     */
    function decrementCnt() {
        addCnt(-1);
    }

    /**
     * カート内件数を変更.
     *
     * @param 加算数
     */
    function addCnt(num) {
        var json = window.localStorage.getItem(LOCAL_STORAGE_KEY);
        var cart = JSON.parse(json);

        cart.cnt += num;

        json = JSON.stringify(cart);
        window.localStorage.setItem(LOCAL_STORAGE_KEY, json);
    }

    /**
     * 初期化処理.
     */
    $(function () {
        init();
    });

})(jQuery);

/**
 * flashmodal.js
 */
(function ($) {

    'use strict';

    // 2重初期化防止
    if (window.flashmodal) {
        return;
    }

    /**
     * flashmodal
     */
    window.flashmodal = (function () {

        /** target id. */
        var ID_TARGET = 'body > #flashModal';
        var CLASS_INNER = 'flashmodal-inner';
        var CLASS_ACTIVE = 'is-active';
        var CLASS_OUT = 'is-out';

        /**
         * コンストラクタ。
         */
        var flashmodal = function () {
            if (!(this instanceof flashmodal)) {
                return new flashmodal();
            }
        };

        /**
         * メッセージ表示。
         * @param {string} message 表示するメッセージ
         */
        flashmodal.dispMessage = function (message) {
            return dispMessageInternal(message, null);
        }

        /**
         * Notice メッセージ表示。
         * @param {string} message 表示するメッセージ
         */
        flashmodal.dispNoticeMessage = function (message) {
            return dispMessageInternal(message, 'is-notice');
        }

        /**
         * Success メッセージ表示。
         * @param {string} message 表示するメッセージ
         */
        flashmodal.dispSuccessMessage = function (message) {
            return dispMessageInternal(message, 'is-success');
        }

        /**
         * Alert メッセージ表示。
         * @param {string} message 表示するメッセージ
         */
        flashmodal.dispAlertMessage = function (message) {
            return dispMessageInternal(message, 'is-alert');
        }

        /**
         * Error メッセージ表示。
         * @param {string} message 表示するメッセージ
         */
        flashmodal.dispAlertMessage = function (message) {
            return dispMessageInternal(message, 'is-error');
        }

        /**
         * メッセージ表示。
         * @param {string} message 表示するメッセージ
         * @param {string} clazz CSSクラス
         */
        var dispMessageInternal = function (message, clazz) {

            var $ID_TARGET = $(ID_TARGET);
            if ($ID_TARGET.length == 0) {
                $ID_TARGET = $('<div>');
                $ID_TARGET.attr('id', 'flashModal');
                $('body').append($ID_TARGET);
            }

            var $inner = $('<div>');
            $inner.addClass(CLASS_INNER);
            $inner.addClass(clazz);
            $inner.html(message);
            $(ID_TARGET).append($inner);

            var d = new $.Deferred();
            d.promise()
            .then(function() {
                setTimeout(function() {
                    $inner.show();
                }, 10);
            })
            .then(function() {
                setTimeout(function() {
                    $inner.addClass(CLASS_ACTIVE);
                }, 210);
            })
            .then(function() {
                setTimeout(function() {
                    $inner.addClass(CLASS_OUT);
                }, 2210);
            })
            .then(function() {
                setTimeout(function() {
                    $inner.removeClass(CLASS_OUT);
                    $inner.removeClass(CLASS_ACTIVE);
                }, 2710);
            })
            .then(function() {
                setTimeout(function() {
                    $inner.remove();
                }, 2720);
            });
            d.resolve();
        };

        return flashmodal;
    })();
})(jQuery);

/* ppcIssueAPI.js */
(function($) {
    'use strict';

    if (window.ppcIssueAPI) {
        return;
    }

    window.ppcIssueAPI = {};

    const COOKIE_KEY_VTKT = 'CCAAUTKT';
    const SESSION_STORAGE_KEY = 'ppcIssue';
    const COOKIE_KEY = 'ppcIssue';
    const COOKIE_VALUE = 'true';
    const COOKIE_EXPIRE_MINUTES = 5;
    const COOKIE_SECURE = ($(location).attr('protocol') == 'https:');
    const PPC_KBN = [2, 3, 4];

    const setCookie = function(date) {
        document.cookie = encodeURIComponent(COOKIE_KEY) + '=' + encodeURIComponent(COOKIE_VALUE) + '; '
        + 'expires=' + date.toGMTString() + '; path=/' + (COOKIE_SECURE ? '; secure' : '');
    }

    const validateCookie = function() {
        const date = new Date();
        date.setMinutes(date.getMinutes() + COOKIE_EXPIRE_MINUTES);
        setCookie(date);
    }

    const validate = function(json, ppcKbn) {
        const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  ppcKbn;
        window.sessionStorage.setItem(SESSION_STORAGE_KEY_KBN, json);
        validateCookie();
    }

    const invalidateCookie = function() {
        const date = new Date(0);
        setCookie(date);
    }

    const invalidate = function(ppcKbn) {
        invalidateCookie();
        const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  ppcKbn;
        window.sessionStorage.removeItem(SESSION_STORAGE_KEY_KBN);
    }

    const isLive = function(ppcKbn) {
        const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  ppcKbn;
        return CommonUtil.getCookie(COOKIE_KEY_VTKT)
            && CommonUtil.getCookie(COOKIE_KEY)
            && window.sessionStorage.getItem(SESSION_STORAGE_KEY_KBN);
    }

    if (CommonUtil.getCookie(COOKIE_KEY_VTKT) == '' || CommonUtil.getCookie(COOKIE_KEY) == '') {
        for (var j in PPC_KBN) {
            const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  PPC_KBN[j];
            if (window.sessionStorage.getItem(SESSION_STORAGE_KEY_KBN)) {
                invalidateCookie();
                window.sessionStorage.removeItem(SESSION_STORAGE_KEY_KBN);
            }
        }
    }

    const getPromise = function(ppcKbn) {
        var defer = $.Deferred();
        const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  ppcKbn;
        setTimeout(function() {
            if (isLive(ppcKbn)) {
                const json = window.sessionStorage.getItem(SESSION_STORAGE_KEY_KBN);
                const data = JSON.parse(json);
                defer.resolve(data);
            } else {
                invalidate(ppcKbn);
                if (CommonUtil.getCookie(COOKIE_KEY_VTKT)) {
                    $.ajax({
                        url: '/bin/wcm/au-com/juice/ppcissue.json',
                        type: 'GET',
                        cache : false,
                        data : {ppcKbn: ppcKbn}
                    }).done(function(data, status, xhr) {
                        if (data) {
                            const json = JSON.stringify(data);
                            validate(json, ppcKbn);
                            defer.resolve(data);
                        } else {
                            defer.reject(true);
                        }
                    }).fail(function(xhr, status, thrown) {
                        defer.reject(false);
                    }).always(function() {
                    });
                } else {
                    defer.reject(false);
                }
            }
        }, 0);
        return defer.promise();
    }

    /**
     * 指定したパスで値を取得する.
     * cf: window.ppcIssueAPI.get("/getPPCIssueRes/resultCd", "");
     * @param path 取得したい値までのJSONオブジェクト名
     * @param defaultVal 取得できなかった場合のデフォルト値
     */
    var get = function (path, ppcKbn, defaultVal) {
        const SESSION_STORAGE_KEY_KBN = SESSION_STORAGE_KEY + '_' +  ppcKbn;
        if (!path || !ppcKbn) {
            return defaultVal;
        }
        var value = defaultVal;
        try {
            var json = window.sessionStorage.getItem(SESSION_STORAGE_KEY_KBN);
            if (json) {
                var dtoObj = JSON.parse(json);
                if (path == '/') {
                    return dtoObj;
                }
                var paths = path.split('/');
                for (var i = 1 ; i < paths.length ; i++) {
                    var key = paths[i];
                    dtoObj = dtoObj[key];
                    if (dtoObj == undefined) {
                        break;
                    }
                }
                if (dtoObj != undefined) {
                    value = dtoObj;
                }
            }
        } catch (e) {
            console.error(e);
            value = defaultVal;
        }
        return value;
    };

    window.ppcIssueAPI = {
                    getPromise: getPromise,
                    get: get
    }
})(jQuery);

/* ppcInfoAPIv2.js */
(function($) {
    'use strict';

    if (window.ppcInfoAPIv2) {
        return;
    }

    window.ppcInfoAPIv2 = {};

    const COOKIE_KEY_VTKT = 'CCAAUTKT';
    const SESSION_STORAGE_KEY = 'ppcInfov2';
    const COOKIE_KEY = 'ppcInfov2';
    const COOKIE_VALUE = 'true';
    const COOKIE_EXPIRE_MINUTES = 5;
    const COOKIE_SECURE = ($(location).attr('protocol') == 'https:');

    const setCookie = function(date) {
        document.cookie = encodeURIComponent(COOKIE_KEY) + '=' + encodeURIComponent(COOKIE_VALUE) + '; '
        + 'expires=' + date.toGMTString() + '; path=/' + (COOKIE_SECURE ? '; secure' : '');
    }

    const validateCookie = function() {
        const date = new Date();
        date.setMinutes(date.getMinutes() + COOKIE_EXPIRE_MINUTES);
        setCookie(date);
    }

    const validate = function(json) {
        window.sessionStorage.setItem(SESSION_STORAGE_KEY, json);
        validateCookie();
    }

    const invalidateCookie = function() {
        const date = new Date(0);
        setCookie(date);
    }

    const invalidate = function() {
        invalidateCookie();
        window.sessionStorage.removeItem(SESSION_STORAGE_KEY);
    }

    const isLive = function() {
        return CommonUtil.getCookie(COOKIE_KEY_VTKT)
            && CommonUtil.getCookie(COOKIE_KEY)
            && window.sessionStorage.getItem(SESSION_STORAGE_KEY);
    }

    const getPromise = function() {
        var defer = $.Deferred();
        setTimeout(function() {
            if (isLive()) {
                const json = window.sessionStorage.getItem(SESSION_STORAGE_KEY);
                const data = JSON.parse(json);
                defer.resolve(data);
            } else {
                invalidate();
                if (CommonUtil.getCookie(COOKIE_KEY_VTKT)) {
                    $.ajax({
                        url: '/bin/wcm/au-com/juice/ppcinfo.json',
                        type: 'GET',
                        cache : false
                    }).done(function(data, status, xhr) {
                        if (data) {
                            const json = JSON.stringify(data);
                            validate(json);
                            defer.resolve(data);
                        } else {
                            defer.reject(true);
                        }
                    }).fail(function(xhr, status, thrown) {
                        defer.reject(false);
                    }).always(function() {
                    });
                } else {
                    defer.reject(false);
                }
            }
        }, 0);
        return defer.promise();
    }

    if (!isLive()) {
        invalidate();
    }

    /**
     * 指定したパスで値を取得する.
     * cf: window.ppcInfoAPIv2.get("/getPpcInfoRes/reqParameter/sid", "");
     *     window.ppcInfoAPIv2.get("/getPpcInfoRes/ppcInfos/0/ppcRedirectUrl", "");
     * @param path 取得したい値までのJSONオブジェクト名
     * @param defaultVal 取得できなかった場合のデフォルト値
     */
    var get = function (path, defaultVal) {
        if (!path) {
            return defaultVal;
        }
        var value = defaultVal;
        try {
            var json = window.sessionStorage.getItem(SESSION_STORAGE_KEY);
            if (json) {
                var dtoObj = JSON.parse(json);
                if (path == '/') {
                    return dtoObj;
                }
                var paths = path.split('/');
                for (var i = 1 ; i < paths.length ; i++) {
                    var key = paths[i];
                    dtoObj = dtoObj[key];
                    if (dtoObj == undefined) {
                        break;
                    }
                }
                if (dtoObj != undefined) {
                    value = dtoObj;
                }
            }
        } catch (e) {
            console.error(e);
            value = defaultVal;
        }
        return value;
    };

    window.ppcInfoAPIv2 = {
                    getPromise: getPromise,
                    get: get
    }
})(jQuery);

/* biscuitDbInfoAPI.js */
(function($) {
    'use strict';

    if (window.biscuitDbInfoAPI) {
        return;
    }

    window.biscuitDbInfoAPI = {};

    const COOKIE_KEY_VTKT = 'CCAAUTKT';
    const SESSION_STORAGE_KEY = 'biscuitDbInfo';
    const COOKIE_KEY = 'biscuitDbInfo';
    const COOKIE_VALUE = 'true';
    const COOKIE_EXPIRE_MINUTES = 5;
    const COOKIE_SECURE = ($(location).attr('protocol') == 'https:');

    const setCookie = function(date) {
        document.cookie = encodeURIComponent(COOKIE_KEY) + '=' + encodeURIComponent(COOKIE_VALUE) + '; '
        + 'expires=' + date.toGMTString() + '; path=/' + (COOKIE_SECURE ? '; secure' : '');
    }

    const validateCookie = function() {
        const date = new Date();
        date.setMinutes(date.getMinutes() + COOKIE_EXPIRE_MINUTES);
        setCookie(date);
    }

    const validate = function(json) {
        window.sessionStorage.setItem(SESSION_STORAGE_KEY, json);
        validateCookie();
    }

    const invalidateCookie = function() {
        const date = new Date(0);
        setCookie(date);
    }

    const invalidate = function() {
        invalidateCookie();
        window.sessionStorage.removeItem(SESSION_STORAGE_KEY);
    }

    const isLive = function() {
        return CommonUtil.getCookie(COOKIE_KEY_VTKT)
            && CommonUtil.getCookie(COOKIE_KEY)
            && window.sessionStorage.getItem(SESSION_STORAGE_KEY);
    }

    const getPromise = function() {
        var defer = $.Deferred();
        setTimeout(function() {
            if (isLive()) {
                const json = window.sessionStorage.getItem(SESSION_STORAGE_KEY);
                const data = JSON.parse(json);
                defer.resolve(data);
            } else {
                invalidate();
                if (CommonUtil.getCookie(COOKIE_KEY_VTKT)) {
                    $.ajax({
                        url: '/bin/wcm/au-com/biscuitDbInfo.json',
                        type: 'GET',
                        contentType: 'application/json',
                        cache : false
                    }).done(function(data, status, xhr) {
                        if (data) {
                            const json = JSON.stringify(data);
                            validate(json);
                            defer.resolve(data);
                        } else {
                            defer.reject(true);
                        }
                    }).fail(function(xhr, status, thrown) {
                        defer.reject(false);
                    }).always(function() {
                    });
                } else {
                    defer.reject(false);
                }
            }
        }, 0);
        return defer.promise();
    }

    if (!isLive()) {
        invalidate();
    }

    /**
     * 指定したパスで値を取得する.
     * cf: window.biscuitDbInfoAPI.get("/ppcInfGetResEntity/ppcInfLst", false);
     *     window.biscuitDbInfoAPI.get("/ppcInfGetResEntity/ppcInfLst/0/ppc", "");
     * @param path 取得したい値までのJSONオブジェクト名
     * @param defaultVal 取得できなかった場合のデフォルト値
     */
    var get = function (path, defaultVal) {
        if (!path) {
            return defaultVal;
        }
        var value = defaultVal;
        try {
            var json = window.sessionStorage.getItem(SESSION_STORAGE_KEY);
            if (json) {
                var dtoObj = JSON.parse(json);
                if (path == '/') {
                    return dtoObj;
                }
                var paths = path.split('/');
                for (var i = 1 ; i < paths.length ; i++) {
                    var key = paths[i];
                    dtoObj = dtoObj[key];
                    if (dtoObj == undefined) {
                        break;
                    }
                }
                if (dtoObj != undefined) {
                    value = dtoObj;
                }
            }
        } catch (e) {
            console.error(e);
            value = defaultVal;
        }
        return value;
    };

    window.biscuitDbInfoAPI = {
                    getPromise: getPromise,
                    get: get
    }
})(jQuery);

/* productDataLayerAPI.js */
(function($) {
    'use strict';

    const DATA_LAYER_KEY = 'product';
    const READY_EVENT_NAME = 'productDataLayerAPI:ready';
    const SELECT_EVENT_NAME = 'productDataLayerAPI:select';

    // 二重初期化防止フラグ
    var execFlg = false;

    window.productDataLayerAPI = window.productDataLayerAPI || {};

    /**
     * 初期化処理
     *
     */
    function init() {
        if (isLive()) {
            $(document).trigger(READY_EVENT_NAME);
        }

        // 二重実行防止
        if (execFlg) {
            return;
        }

        execFlg = true;

        // adobeDataLayerを初期化
        window.adobeDataLayer = window.adobeDataLayer || [];

        // adobeDataLayer の ready イベント
        window.adobeDataLayer.push('cmp:loaded', function () {
            initProduct();
            // 製品データレイヤーの ready イベント発火
            $(document).trigger(window.productDataLayerAPI.READY_EVENT_NAME);
        });

    }

    /**
     * 製品データレイヤーの生存判定を行う
     *
     * @private
     */
    function isLive() {
        return window.adobeDataLayer &&
        window.adobeDataLayer.getState &&
        window.adobeDataLayer.getState()[window.productDataLayerAPI.DATA_LAYER_KEY];
    }

    /**
     * 指定された製品を製品データレイヤーから削除する
     *
     * @private
     * @param {String} 製品コード（未指定の場合は、全て削除する）
     */
    function remove(productCode) {
        var productObj = {};
        if (productCode) {
            productObj[window.productDataLayerAPI.DATA_LAYER_KEY] = {};
            productObj[window.productDataLayerAPI.DATA_LAYER_KEY][productCode] = null;
        } else {
            productObj[window.productDataLayerAPI.DATA_LAYER_KEY] = null;
        }
        window.adobeDataLayer.push(productObj);
    }

    /**
     * 製品を製品データレイヤーに初期設定する
     *
     * @private
     */
    function initProduct() {
        var $elements = $('[data-cmp-ols-product-codes-json]');
        $elements.each(function() {
            var $element = $(this);
            var productCodes = $element.data('cmpOlsProductCodesJson');
            if (!productCodes) {
                return;
            }
            var productPath = '/' + window.productDataLayerAPI.DATA_LAYER_KEY;
            window.productDataLayerAPI.set(productPath, productCodes);
        });
    }

    /**
     * adobeDataLayerにイベントを登録する
     *
     * @param eventName イベント名
     * @param eventInfo イベント情報
     */
    function addEventTrigger(eventName, eventInfo) {
        window.auDataLayer.addEventTrigger(eventName, eventInfo);
    }

    /**
     * adobeDataLayerにイベントリスナーを登録する
     *
     * @param event 対象のイベント
     * @param func イベントキャッチ後に実行する関数
     */
    function addEventListener(event, func) {
        window.auDataLayer.addEventListener(event, func);
    }

    /**
     * 指定されたパスに指定された値を設定する
     * （値の指定がない場合は、対象のオブジェクトを削除する）
     *
     * @param {String} パス（スラッシュ区切り）
     * @param {String} 値
     */
    function set(path, value) {
        var keys = path.split('/');

        var jsonValue = value ? value : null;
        for(var i = keys.length - 1; i >= 0; i--){
            var key = keys[i];
            var jsonObj = {};
            if (key) {
                jsonObj[key] = jsonValue;
                jsonValue = jsonObj;
            }
        }

        window.adobeDataLayer.push(jsonValue);
    }

    /**
     * 指定されたパスの値を取得する
     *
     * @param {String} パス（スラッシュ区切り）
     * @return 値（指定されたパスが存在しない場合は undefined を返却）
     */
    function get(path) {
        return window.auDataLayer.get(path);
    }

    /**
     * 製品データレイヤーの情報を全てクリアする
     *
     */
    function clear() {
        remove()
    }

    /**
     * 公開する関数を定義
     */
    window.productDataLayerAPI = {
                    DATA_LAYER_KEY: DATA_LAYER_KEY,
                    READY_EVENT_NAME: READY_EVENT_NAME,
                    SELECT_EVENT_NAME: SELECT_EVENT_NAME,
                    init: init,
                    addEventTrigger: addEventTrigger,
                    addEventListener: addEventListener,
                    set: set,
                    get: get,
                    clear: clear
    }

    $(function() {
        window.productDataLayerAPI.init();
    });
})(jQuery);

/* formDataLayerAPI.js */
(function($) {
    'use strict';

    const SESSION_STORAGE_KEY = 'auDataLayer.form';
    const DATA_LAYER_KEY = 'form';
    const READY_EVENT_NAME = 'formDataLayerAPI:ready';
    const CHANGE_EVENT_NAME = 'formDataLayerAPI:change';
    const SUBMIT_KEY = '__submit__';
    const SUBMIT_ACTION_TYPE_KEY = 'actionType';
    const SUBMIT_RESOURCE_PATH = 'resourcePath';
    const SUBMIT_CSRF_TOKEN = 'csrfToken';
    const SUBMIT_PARAMETER = 'parameter';
    const FORM_CONTAINER_INFO_KEY = '__info__';
    const FORM_CONTAINER_SELECTER = '.cmp-au-com-form';
    const FORM_CONTAINER_READY_EVENT = 'auForm:ready';
    const FORM_SHOW_HIDE_EVENT = 'auForm:showHide';
    const FORM_PARTS_SELECTER = '.cmp-au-com-form__formparts';


    // 二重初期化防止フラグ
    let execFlg = false;

    if (window.formDataLayerAPI) {
        return;
    }

    window.formDataLayerAPI = {};

    /**
     * 初期化処理
     *
     */
    function init() {

        if (isLive()) {
            $(document).trigger(READY_EVENT_NAME);
        }

        // 二重実行防止
        if (execFlg) {
            return;
        }

        execFlg = true;

        // adobeDataLayerを初期化
        window.adobeDataLayer = window.adobeDataLayer || [];

        // adobeDataLayer の ready イベント
        window.adobeDataLayer.push('cmp:loaded', function () {

            // セッションストレージの値をデータレイヤーに設定
            setSessionStorageToDataLayer();

            // フォームデータレイヤーの値を各入力部品に反映
            setDataLayerToInputValues();

            // フォームデータレイヤーの ready イベント発火
            $(document).trigger(window.formDataLayerAPI.READY_EVENT_NAME);
        });

    }

    /**
     * フォームデータレイヤーの生存判定を行う
     *
     * @private
     */
    function isLive() {
        return window.adobeDataLayer &&
        window.adobeDataLayer.getState &&
        window.adobeDataLayer.getState()[window.formDataLayerAPI.DATA_LAYER_KEY];
    }

    /**
     * 指定されたフォームデータをフォームデータレイヤーから削除する
     *
     * @private
     * @param {String} フォーム名（未指定の場合は、全て削除する）
     */
    function remove(formName) {
        let formObj = {};
        if (formName) {
            formObj[window.formDataLayerAPI.DATA_LAYER_KEY] = {};
            formObj[window.formDataLayerAPI.DATA_LAYER_KEY][formName] = null;
        } else {
            formObj[window.formDataLayerAPI.DATA_LAYER_KEY] = null;
        }
        window.adobeDataLayer.push(formObj);
    }

    /**
     * フォームデータレイヤーのサブミット処理を行う
     *
     * @param {jQueryElement} サブミットボタン
     */
    function submit($submitButton, csrfToken) {

        let formName = window.auForm.getFormName($submitButton);
        var $formContainer = $(FORM_CONTAINER_SELECTER + '[data-form-name=' + formName + ']');

        if($formContainer.length > 0){
            var $formParts = $(FORM_PARTS_SELECTER, $formContainer);
            $formParts.each(function() {
                var $inputParts = window.auForm.getInputParts($(this));
                if ($inputParts.length > 0) {
                    let name = $inputParts.closest('[name]').attr('name');
                    if (name) {
                        let inputInfo = getInputInfo($inputParts, name);
                        let isSubmited = get('/' + DATA_LAYER_KEY + '/' + formName + '/' + name + '/submited');
                        if (!isSubmited) {
                            if (inputInfo && window.auForm.isEnableElement($inputParts)) {
                                set('/' + DATA_LAYER_KEY + '/' + formName + '/' + name, inputInfo, false);
                                set('/' + DATA_LAYER_KEY + '/' + formName + '/' + name + '/submited', true, false);
                            } else {
                                set('/' + DATA_LAYER_KEY + '/' + formName + '/' + name, undefined, false);
                            }
                        }
                    }
                }
            });
        }

        updateSubmitStatus($submitButton, csrfToken);
        updateFormContainerInfo($formContainer);
        removeNotSubmitData();

    }

    /**
     * フォームデータレイヤーにサブミットステータスを設定する
     *
     * @private
     * @param {jQueryElement} サブミットボタン
     */
    function updateSubmitStatus($submitButton, csrfToken) {
        let formName = window.auForm.getFormName($submitButton);
        let actionType = $submitButton.data('action-type');
        let resourcePath = $submitButton.data('cmp-resource-path');
        let parameter = $submitButton.data('submit-parameter');
        set('/' + DATA_LAYER_KEY + '/' + formName + '/' + SUBMIT_KEY + '/' + SUBMIT_ACTION_TYPE_KEY, actionType, false);
        set('/' + DATA_LAYER_KEY + '/' + formName + '/' + SUBMIT_KEY + '/' + SUBMIT_RESOURCE_PATH, resourcePath, false);
        set('/' + DATA_LAYER_KEY + '/' + formName + '/' + SUBMIT_KEY + '/' + SUBMIT_CSRF_TOKEN, csrfToken, false);
        if (parameter) {
            set('/' + DATA_LAYER_KEY + '/' + formName + '/' + SUBMIT_KEY + '/' + SUBMIT_PARAMETER, JSON.stringify(parameter), false);
        }
    }
    
     /**
     * フォームデータレイヤーにformContainer情報を設定する
     *
     * @private
     * @param {jQueryElement} フォームコンテナ
     */
     function updateFormContainerInfo($formContainer) {
        const formName = window.auForm.getFormName($formContainer);
        const resourcePath  = $('input[name=":formstart"]', $formContainer).val();
        set('/' + DATA_LAYER_KEY + '/' + formName + '/' + FORM_CONTAINER_INFO_KEY + '/' + SUBMIT_RESOURCE_PATH, resourcePath, false);
    }

    /**
     * 非表示項目などの必要のないオブジェクトを削除する
     *
     * @private
     */
    function removeNotSubmitData() {

        let formObj = get(DATA_LAYER_KEY);
        let keys = Object.keys(formObj);
        keys.forEach(function(formName) {
            let actionType = get('/' + DATA_LAYER_KEY + '/' + formName + '/' + SUBMIT_KEY + '/' + SUBMIT_ACTION_TYPE_KEY);
            if (!actionType) {
                remove(formName);
            }
        });

    }

    /**
     * 指定されたパスに指定された値を設定する
     * （値の指定がない場合は、対象のオブジェクトを削除する）
     *
     * @param {String} パス（スラッシュ区切り）
     * @param {String} 値
     */
    function set(path, value, isTriggerEvent) {
        let keys = path.split('/');

        let jsonValue = value ? value : null;
        if (jsonValue != null && jsonValue.relatedInfo != null) {
            set(path + '/relatedInfo', null, false);
        }

        for(let i = keys.length - 1; i >= 0; i--){
            let key = keys[i];
            let jsonObj = {};
            if (key) {
                jsonObj[key] = jsonValue;
                jsonValue = jsonObj;
            }
        }

        window.adobeDataLayer.push(jsonValue);

        if (isTriggerEvent !== false) {
            $(document).trigger(CHANGE_EVENT_NAME);
        }

    }

    /**
     * 指定されたパスの値を取得する
     *
     * @param {String} パス（スラッシュ区切り）
     * @return 値（指定されたパスが存在しない場合は undefined を返却）
     */
    function get(path) {
        return window.auDataLayer.get(path);
    }

    /**
     * フォームデータレイヤーの情報を全てクリアする
     *
     */
    function clear() {
        remove()
        window.sessionStorage.removeItem(window.formDataLayerAPI.SESSION_STORAGE_KEY);
    }

    /**
     * セッションストレージの値をデータレイヤーに設定する
     *
     */
    function setSessionStorageToDataLayer() {

        let formJson = window.sessionStorage.getItem(window.formDataLayerAPI.SESSION_STORAGE_KEY);
        let formObj = JSON.parse(formJson) || {};
        window.adobeDataLayer.push({form: formObj});

    }

    /**
     * フォームデータレイヤーの値を各入力部品に反映する
     *
     */
    function setDataLayerToInputValues($input) {

        if ($input) {

            let formName = window.auForm.getFormName($input)
            let name = $input.attr('name');
            let inputInfo = get('/' + DATA_LAYER_KEY + '/' + formName + '/' + name);
            if (inputInfo) {
                if ($input.length > 0) {
                    setInputValues($input, inputInfo);
                }
                set('/' + DATA_LAYER_KEY + '/' + formName + '/' +  name + '/submited', undefined, false);
            }

        } else {

            let formObj = get(DATA_LAYER_KEY) || {};
            let keys = Object.keys(formObj);
            keys.forEach(function(key) {
                var $formContainer = $('[data-form-name=' + key + ']');
                if ($formContainer.length > 0) {
                    let items = formObj[key];
                    let names = Object.keys(items);
                    names.forEach(function (name) {
                        let inputInfo = get('/' + DATA_LAYER_KEY + '/' + key + '/' +  name);
                        if (inputInfo) {
                            var $input = $('[name=' + name + ']', $formContainer);
                            if ($input.length > 0) {
                                setInputValues($input, inputInfo);
                            }
                            set('/' + DATA_LAYER_KEY + '/' + key + '/' +  name + '/submited', undefined, false);
                        }
                    });
                }
            });

        }

    }

    /**
     * 引数で指定された値を各入力部品に設定する
     *
     * @private
     * @param {jQueryElement} 入力部品
     * @param {Object} 入力情報
     */
    function setInputValues($input, inputInfo) {
        $input.each(function(){
            var $this = $(this);
            let tagName = this.tagName;
            let type = $this.attr('type');
            if (type != 'hidden') {
                if (tagName == 'SELECT') {
                    $this.val(inputInfo.value);
                }else if (type == 'checkbox' || type == 'radio') {
                    setCheckedValues($this, inputInfo.value);
                } else if (inputInfo.text && inputInfo.text !== inputInfo.value) {
                    $this.val(inputInfo.text);
                } else {
                    $this.val(inputInfo.value);
                }
            }
        });
    }

    /**
     * フォームデータレイヤーの情報をセッションストレージに保存する
     *
     */
    function save() {

        let formObj = get(DATA_LAYER_KEY);
        let formJson = JSON.stringify(formObj);
        window.sessionStorage.setItem(window.formDataLayerAPI.SESSION_STORAGE_KEY, formJson);

    }

    /**
     * 引数で指定された値を文字列に変換して返却する。
     *
     * @param {Object} 値
     * @return {String} 文字列
     */
    function getStringOrNull(value) {
        return value != null ? String(value) : null;
    }

    /**
     * 指定されたフォーム入力部品の値を規定のオブジェクトにして返却する
     *
     * @param {jQueryElement} フォーム入力部品
     * @return {Object} 入力情報
     */
    function getInputInfo($input) {

        let info = {};
        let name = $input.closest('[name]').attr('name');
        if (name) {

            let tagName = $input[0].tagName;
            let type = $input.attr('type');

            // value
            // text
            let value = undefined;
            let text = undefined;
            if (tagName == 'SELECT') {
                value = getStringOrNull($('option:selected', $input).data('value'));
                text = getStringOrNull($('option:selected', $input).data('text'));
            } else if (type == 'checkbox' || type == 'radio') {
                let values = getCheckedValues($input);
                value = getStringOrNull(values.value);
                text = getStringOrNull(values.text);
            } else if (type == 'hidden') {
                value = $input.parent().data('cmp-value-data-type') == 'json' && $input.val() ? JSON.parse($input.val()) : $input.val();
            } else if ($input.data('value') && $input.data('value') != $input.val()) {
                value = $input.data('value');
                text = $input.val();
            } else {
                value = $input.val();
                text = $input.data('text');
            }

            if (value != null && value !== "") {
                info.value = value;
                info.text = text;
            } else {
                info.value = null;
                info.text = null;
            }

            // label
            let label = $('[data-partsname=' + name + ']').data('labelvalue');
            if (label) {
                info.label = label;
            }

            // resourcePath
            var $formParts = $input.closest(FORM_PARTS_SELECTER);
            let resourcePath = $formParts.data('cmp-resource-path');
            if (resourcePath) {
                info.resourcePath = resourcePath;
            }

            // relatedInfo
            if (tagName == 'SELECT' || type == 'checkbox' || type == 'radio') {
                let relatedInfoItems = $formParts.data('cmpRelatedInfoItemsJson');
                info.relatedInfo = getRelatedInfo(relatedInfoItems, value);
            }

        }

        if (!Object.keys(info).length) {
            info = undefined;
        }

        return info;

    }

    /**
     * 複数選択が可能な入力部品の入力値を取得する
     *
     * @param {jQueryElement} フォーム入力部品（複数）
     * @return {String} 入力値
     */
    function getCheckedValues($elems) {
        let separator = $elems.data('cmp-separator') || '';
        let result = {};
        let text=[];
        let value = [];
        $elems.each(function () {
            var $elem = $(this);
            if ($elem.prop('checked')) {
                value.push($elem.val());
                text.push($elem.data('text'));
            }
        });
        result.value = value.join(separator);
        result.text = text.join(separator);
        return result;
    }

    /**
     * 複数選択が可能な入力部品の入力値を設定する
     *
     * @param {jQueryElement} フォーム入力部品（複数）
     * @param {String} 入力値
     */
    function setCheckedValues($elems, values) {
        let separator = $elems.data('cmp-separator') || '';
        if (values || values === '') {
            let valuesArray = values.split(separator);
            $elems.each(function () {
                var $elem = $(this);
                let value = $elem.val();
                if (valuesArray.indexOf(value) >= 0) {
                    $elem.parent().addClass('checked');
                    $elem.prop('checked', true);
                } else {
                    $elem.parent().removeClass('checked');
                    $elem.prop('checked', false);
                }
            });
        }
    }

    /**
     * 関連情報を取得する
     *
     * @param {Object} 関連情報項目
     * @return {Object} 関連情報
     */
    function getRelatedInfo(relatedInfoItems, value) {
        if (relatedInfoItems == null || !relatedInfoItems.length || value == null) {
            return null;
        }

        let result = {};
        $.each(relatedInfoItems, function() {
            let relatedInfoItem = this;

            let relatedInfoListPath = relatedInfoItem.relatedInfoListPath;
            let keyItem = relatedInfoItem.keyItem;
            if (relatedInfoListPath == null || relatedInfoListPath == '' || keyItem == null || keyItem == '') {
                return true;
            }

            let relatedInfoList = get(relatedInfoListPath);
            if (!relatedInfoList || !Array.isArray(relatedInfoList) || !relatedInfoList.length) {
                return true;
            }

            $.each(relatedInfoList, function() {
                let relatedInfo = this;
                let keyItemValue = relatedInfo[keyItem];
                if (keyItemValue == null || keyItemValue != value) {
                    return true;
                }

                $.each(Object.keys(relatedInfo), function() {
                    let key = this;
                    result[key] = relatedInfo[key];
                });
            });
        });

        if (!Object.keys(result).length) {
            result = null;
        }

        return result;
    }

    /**
     * 公開する関数を定義
     */
    window.formDataLayerAPI = {
                    SESSION_STORAGE_KEY: SESSION_STORAGE_KEY,
                    DATA_LAYER_KEY: DATA_LAYER_KEY,
                    READY_EVENT_NAME: READY_EVENT_NAME,
                    CHANGE_EVENT_NAME: CHANGE_EVENT_NAME,
                    FORM_CONTAINER_READY_EVENT: FORM_CONTAINER_READY_EVENT,
                    FORM_SHOW_HIDE_EVENT: FORM_SHOW_HIDE_EVENT,
                    init: init,
                    submit: submit,
                    set: set,
                    get: get,
                    save: save,
                    clear: clear,
                    getInputInfo: getInputInfo,
                    setDataLayerToInputValues: setDataLayerToInputValues,
                    setCheckedValues: setCheckedValues
    }
})(jQuery);

(function($) {
    $(function(){

        $(document)
            .on('click', '.popupCloser', function(){
                window.close();
            })
        ;

        // end of jquery
    });
})(jQuery);
(function($) {
    $(function(){

        $(document)
            .on('click', '.popupCloser', function(){
                window.close();
            })
        ;

        // end of jquery
    });
})(jQuery);
(function ($) {
    "use strict";

    var windw;
    var windh;
    $(function() {
        $(window).on('resize', function() {
            windw = window.innerWidth ? window.innerWidth : $(window).width();
            windh = window.innerHeight ? window.innerHeight : $(window).height();
        }).trigger('resize');

        $('.mainHeadLocalNavDrop-label').on('click', function(){

            if (windw >= 980 || $(this).closest('.mainHeadLocalNav-enableSpDrawer').length > 0) {

                // クリックしたもの以外を閉じる。
                var self = $(this);
                $('.mainHeadLocalNavDrop-label').not(self).closest('.mainHeadLocalNavDrop').removeClass('open');
                $('.mainHeadLocalNavDrop-label').not(self).closest('.mainHeadLocalNavDrop').find('.mainHeadLocalNavDrop-accordion').slideUp(0);

                // クリックしたものを開く。
                $(this).closest('.mainHeadLocalNavDrop').toggleClass('open');
                $(this).closest('.mainHeadLocalNavDrop').find('.mainHeadLocalNavDrop-accordion').slideToggle(200);

                return false;
            }
        });
        $('.mainHeadLocalNavDrop-close').on('click', function(){
            if (windw >= 980  || $(this).closest('mainHeadLocalNav-enableSpDrawer').length > 0) {
                $(this).closest('.mainHeadLocalNavDrop').removeClass('open');
                $(this).closest('.mainHeadLocalNavDrop').find('.mainHeadLocalNavDrop-accordion').slideUp(200);

                return false;
            }
        });

        var timer = false;
        $(window).on('resize',function() {
            var $spDrawerLocalnav = $('.mainHeadLocalNav.mainHeadLocalNav-enableSpDrawer');
            if (windw <= 979 && $spDrawerLocalnav.length > 0) {
                if (timer !== false) {
                    clearTimeout(timer);
                }
                timer = setTimeout(function() {
                    $('.mainHeadLocalNav-list', $spDrawerLocalnav).css('max-height', windh - 88 + 'px');
                }, 200);
            }
        }).trigger('resize');

        // カートの件数をセット
        var cartNum = window.cartAPI.getCartNum();
        $('.mainHeadLocalNav .btn-section.cart-section .cart_num').text(cartNum);
    });
})(jQuery);
/* localnav.js */

(function($) {

    var tmpScrollTop = 0;
    var isExistHeaderSmp = false;
    $(function () {
        tmpScrollTop = window.scrollY || document.documentElement.scrollTop;

        if ($('.headerSmp').length > 0) {
            isExistHeaderSmp = true;
        }
        if (!isExistHeaderSmp) {
            $('.cmp-au-com-localnav').addClass('cmp-au-com-localnav_contentsOnly');
        }
        adjustOnScroll();
    });

    $(window).on('scroll', function () {
        if ($('.cmp-au-com-localnav_2ndicon_open').length == 0) {
            adjustOnScroll();
        }
    });

    var windw;
    var windh;
    var timer = false;
    $(window).on('resize', function () {
        adjustOnScroll();
        if (window.CommonUtil.isPc()) {
            $('.cmp-au-com-localnav_3rd').css('display', '');
        } else {
            closeDrawerMenu();
        }

        windw = window.innerWidth ? window.innerWidth : $(window).width();
        windh = window.innerHeight ? window.innerHeight : $(window).height();

        var $spDrawerLocalnav = $('.cmp-au-com-localnav.cmp-au-com-localnav_enable_sp_drawer');
        if (windw <= 979 && $spDrawerLocalnav.length > 0) {
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(function() {
                $('.cmp-au-com-localnav_3rd', $spDrawerLocalnav).css('max-height', windh - 88 + 'px');
            }, 200);
        }

    });

    function adjustOnScroll () {

        var $localnav = $('.cmp-au-com-localnav');
        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        if (scrollTop !== 0) {
            $localnav.addClass('cmp-au-com-localnav_fixed');
        } else {
            $localnav.removeClass('cmp-au-com-localnav_fixed');
        }
        var margintop = '';
        var duration = 0;
        if (scrollTop >= tmpScrollTop && scrollTop !== 0) {
            margintop = '0px';
            duration = 200;
        } else {
            if (window.CommonUtil.isMiniPc()) {
                margintop = '50px';
            } else if (window.CommonUtil.isMobile()) {
                margintop = '44px';
            }
            if (!isExistHeaderSmp && !window.CommonUtil.isMiniPc()) {
                margintop = '0px';
            }
            duration = 300;
        }
        if (tmpScrollTop !== scrollTop) {
            $localnav.animate({
                marginTop: margintop
            }, {
                duration: duration,
                queue: false,
                easing: 'easeOutQuad'
            });
        }

        tmpScrollTop = scrollTop;
    }

    function toggleHeaderStyle() {

        var $target = $('.headerSmp');
        if ($target.css('z-index') !== '9999') {
            $target.css('z-index', '9999');
        } else {
            $target.css('z-index', '');
        }
    }

    function toggleBodyStyle() {
        var $body = $('body');
        if ($body.css('position') !== 'fixed') {
            $body.css('position', 'fixed');
            $body.css('overflow-y', 'hidden');
        } else {
            $body.css('position', '');
            $body.css('overflow-y', '');
        }
    }

    /**
     * SP、タブレット表示時のアコーディオンメニュー開閉処理
     */
    $('.cmp-au-com-localnav_left').on('click', function () {
        if (window.CommonUtil.isMobile()) {
            toggleHeaderStyle();
            toggleBodyStyle();

            var $this = $(this);
            $this.find('.cmp-au-com-localnav_2ndicon').toggleClass('cmp-au-com-localnav_2ndicon_open');
            $this.find('.cmp-au-com-localnav_3rdlayer').toggleClass('cmp-au-com-localnav_3rdlayer_display');
            $this.find('.cmp-au-com-localnav_3rd').slideToggle(200);
            let $secondLabel = $this.find('.cmp-au-com-localnav_2ndlabel');
            let $isOpen = $this.find('.cmp-au-com-localnav_2ndicon_open');
            if ($isOpen.length > 0) {
                $secondLabel.attr('aria-expanded', true);
                let $thirdLink = $this.find('.cmp-au-com-localnav_3rdlink');
                if ($thirdLink.length > 0) {
                    $thirdLink[0].focus();
                }
            } else {
                $secondLabel.attr('aria-expanded', false);
            }
            setTimeout(toggleHeaderStyle, 500);
        }
    });

    /**
     * ドロワーメニューの開閉処理.
     */
    function toggleDrawerMenu ($trigger) {

        // 一旦開いているものを閉じる
        closeDrawerMenu($trigger);

        var $parent = $trigger.closest('.cmp-au-com-localnav_3rdelem');
        $parent.find('.cmp-au-com-localnav_3rddrawer').slideToggle(200);

        $parent.find('.cmp-au-com-localnav_3rdlink_drawer').toggleClass('cmp-au-com-localnav_3rdlink_draweropen');

        let $thirdDrawer = $parent.find('.cmp-au-com-localnav_3rdlink_drawer');
        if ($thirdDrawer.hasClass('cmp-au-com-localnav_3rdlink_draweropen')) {
            $thirdDrawer.attr('aria-expanded', true);
            let $drawerLink = $parent.find('.cmp-au-com-localnav_3rddrawer a');
            if ($drawerLink.length > 0) {
                $drawerLink[0].focus();
            }
        } else {
            $thirdDrawer.attr('aria-expanded', false);
        }
    }

    /**
     * ドロワーメニューを閉じる
     */
    function closeDrawerMenu ($trigger) {
        var $root = $('.cmp-au-com-localnav_3rd');
        var $opened = $root.find('.cmp-au-com-localnav_3rdlink_draweropen').not($trigger);
        var $openedParent = $opened.parent();
        $openedParent.find('.cmp-au-com-localnav_3rddrawer').slideUp(0);
        $openedParent.find('.cmp-au-com-localnav_3rdlink_drawer').removeClass('cmp-au-com-localnav_3rdlink_draweropen');
        $openedParent.find('.cmp-au-com-localnav_3rdlink_drawer').attr('aria-expanded', false);
    }

    /**
     * ドロワーメニューのリンククリック処理
     */
    $('.cmp-au-com-localnav_3rdlink_drawer').on('click', function () {

        if (window.CommonUtil.isPc() || $(this).closest('.cmp-au-com-localnav_enable_sp_drawer').length > 0) {
            toggleDrawerMenu($(this));
            return false;
        }
        return true;
    });

    /**
     * ×ボタンのクリック処理
     */
    $('.cmp-au-com-localnav_drawercloser').on('click', function () {
        closeDrawerMenu($(this));
    });

    $(function () {
        // カートの件数をセット
        var cartNum = window.cartAPI.getCartNum();
        $('.cmp-au-com-localnav_cart .cmp-au-com-localnav_cartlink .cmp-au-com-localnav_cartlinknum').text(cartNum);
    });

})(jQuery);
/* section-container.js */
(function($) {
    $(function() {

        $('section.lazyload').on('img:load', function() {
            var $self = $(this);
            if ($self.css('background-image') != 'none') {
                adjustBgImage($self);
            }
        }).each(function() {
            responsiveImage.lazyload($(this), false);
        });

        var delay = null;
        $(window).on('resize', function () {

            clearTimeout(delay);
            delay = setTimeout(function () {
                $('section.lazyload').each(function() {
                    adjustBgImage($(this));
                });
            }, 500);
        });
    });

    function adjustBgImage ($obj) {
        var bgSize = $obj.width();
        var orgWidth = $obj.data('orgWidth');
        var orgHeight = $obj.data('orgHeight');
        var height = orgHeight;

        if (bgSize < orgWidth) {
            $obj.css('background-size', bgSize);
            height = (bgSize / orgWidth) * orgHeight;
        }
        $obj.css('min-height', height);
    }

})(jQuery);

(function($) {
    $(function(){
        $('.card-display').filter(function() {
            return !$(this).closest('.product-list').length && !$(this).closest('.secondary-banner').length;
        }).each(function(){
            var $cardBox = $('.cardBox', this),
                $cardInner = $('.cardBox-ctr', $cardBox),
                $imgs = $('img.lazyload', $cardInner),
                readyAllImg = false,
                loadAllImg = false,
                matchedHeight = false,
                matchHeightCard = function() {
                    $cardInner.matchHeight({
                        byRow: true // 行ごとに高さを揃えるなら：true
                    });
                    return true;
                },
                initialyzeCard = function() {
                    if (!readyAllImg) {
                        readyAllImg = responsiveImage.prepareLoadAll($imgs, false);
                    }
                    if (readyAllImg && !loadAllImg) {
                        loadAllImg = responsiveImage.confirmLoadAll($imgs);
                    }
                    if (loadAllImg && !matchedHeight) {
                        matchedHeight = matchHeightCard();
                    }
                }
            ;

            //not to run on Author Edit Mode
            if (!(AU_COMMON.getCookie("wcmmode") == "edit"
                    && AU_COMMON.getParameter(document.location.href, 'wcmmode') != 'disabled')) {
                $imgs.on('img:load', function() {
                    initialyzeCard();
                });
                initialyzeCard();
            }
        });
    });
})(jQuery);

(function($) {
    "use strict";

    $(function(){
        $('.generalLoginButton').on('click', function() {
            var bid = $(this).data('bid');
            var param = '';
            if (bid) {
                param = '?bid=' + bid;
            }

            var form = $('<form></form>', {
                method: 'post',
                action: '/bin/wcm/au-com/login.do' + param
            });
            $('body').append(form);
            form.trigger('submit');
        });
    });

})(jQuery);

(function ($) {

    $(function () {
        $imgs = $('img.lazyload');
        $imgs.on('img:load', function() {
            if (window.responsiveImage.confirmLoadAll($imgs)) {
                adjustFooter();
            }
        });
    });

    var timer = false;
    $(window).on('resize', function () {

        if (timer !== false) {
            clearTimeout(timer);
        }
        timer = setTimeout(adjustFooter, 500);
    });

    const resizeObserver = new ResizeObserver(() => {
        adjustFooter();
    });

    const targetNode = $('body > div.root.responsivegrid > div.aem-Grid > .au-layoutcontainer:not(.cmp-au-com-au-layoutcontainer__footer)')[0];
    if (targetNode) {
        resizeObserver.observe(targetNode);
    }

    /**
     * フッター位置の調整
     */
    function adjustFooter () {
        var $footerArea = $('.cmp-au-com-au-layoutcontainer__footer');
        if ($footerArea.length == 1) {
            const rootHeight = $('body > div.root.responsivegrid').height();
            const contentsAndFooterHeight = $footerArea.css('position') == 'absolute' ? rootHeight + $footerArea.height() : rootHeight;
            if (window.innerHeight > contentsAndFooterHeight) {
                $footerArea.css('position', 'absolute');
                $footerArea.css('bottom', '0');
            } else {
                $footerArea.css('position', '');
                $footerArea.css('bottom', '');
            }
        }
    }

})(jQuery);

(function($) {
    "use strict";

    function isEnglish() {
        var lang  = $('html').attr('lang');
        if (lang && lang == 'en') {
            return true;
        } else {
            return false;
        }
    }

    $('#login-btn').on('click', function() {
      if ($(this).hasClass('agreedTerms')) {
            sessionStorage.setItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY, true);
        }
        var form = $('<form></form>', {
            method: 'post',
            action: '/bin/wcm/au-com/login.do?bid=we-we-hd-0001'
        });
        $('body').append(form);
        form.trigger('submit');
    });

    $('#logout-btn').on('click', function() {
        var url = '/bin/wcm/au-com/logout.do';
        if (isEnglish()) {
            url += '?lang=en&bid=we-we-hd-0002';
        } else {
            url += '?bid=we-we-hd-0002';
        }
        var form = $('<form></form>', {
            method: 'post',
            action: url
        });
        $('body').append(form);
        form.trigger('submit');
    });
})(jQuery);
(function($) {
"use strict";

    const SERVLET_URL = '/bin/wcm/au-com/login.do';
 
    $('.au-login-btn.current').on('click', function() {
        sessionStorage.setItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY, true);
        var form = $('<form></form>', {
            method: 'post',
            action: SERVLET_URL
        });
        $('body').append(form);
        form.trigger('submit');
    });

    $('.au-login-btn.path').on('click', function() {
        sessionStorage.setItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY, true);
        var form = $('<form></form>', {
            method: 'post',
            action: SERVLET_URL
        });
        form.append($('#targetUrlId'));
        $('body').append(form);
        form.trigger('submit');
    });

    $('.au-login-btn.query').on('click', function() {
        sessionStorage.setItem(window.agreementsAPI.SESSION_AGREEDTERMS_KEY, true);
        var url = SERVLET_URL;
        var queryTargetUrl = AU_COMMON.getParameter(document.location.href, 'targeturl');
        var targetUrl = '';
        if (queryTargetUrl) {
            targetUrl = queryTargetUrl;
        } else {
            targetUrl = document.referrer;
        }
        if (targetUrl) {
            url = url + '?targetUrl=' + encodeURIComponent(targetUrl);
        }
        var form = $('<form></form>', {
            method: 'post',
            action: url
        });
        $('body').append(form);
        form.trigger('submit');
    });

})(jQuery);
(function ($) {
    $(function(){
        "use strict";
        var $page = $('body.qaViewPage-v2');
        if ($page.length != 0) {
            // pv数カウントアップ
            var questionIdList = document.getElementsByName('question_id');
            if (questionIdList.length != 0) {
                var questionId = questionIdList[0].content;
                if (questionId) {
                    $.ajax({
                        url: '/bin/wcm/au-com/incr_pv.do',
                        type: 'GET',
                        data: {
                            'questionId' : questionId ,
                            'isIntra' : "false"
                        },
                        cache : false,
                    }).done(function(data) {
                    }).fail(function(data) {
                    });
                }
            }
            // au.com検索対象外か判定
            var noSearch = document.getElementsByName('noSearch');
            if (noSearch.length != 0) {
                // au.com検索対象外の場合、SyncSearchの対象外にするためクラスを削除する。
                $('div').removeClass('qaSrch-question-txt qaSrch-answer-bdy');
            }
        }
    });

})(jQuery);
(function ($) {

    var timer = false;
    $(window).on('scroll', function () {

        var $pageV2 = $('.page-v2');
        if ($pageV2.length != 0) {
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(adjustOnScroll, 100);
        }
    });

    function adjustOnScroll () {

        var scrollTop = window.scrollY || document.documentElement.scrollTop;
        if (scrollTop !== 0) {
            $('.headerSmp').addClass('onScroll');
        } else {
            $('.headerSmp').removeClass('onScroll');
            $('.mainHeadLocalNav').removeClass('is-fixed');
        }
    }

})(jQuery);
(function() {
    document.querySelectorAll('.cmp-au-com-faq-search-box').forEach(el => {
        const inputelem = el.querySelector('.cmp-au-com-faq-search-box__input-text');
        const crossbuttonelem = el.querySelector('.cmp-au-com-faq-search-box__input-text-cross');
        crossbuttonelem.addEventListener("click", () => {
            removeText(inputelem);
        });
    })
    function removeText(inputelem) {
        inputelem.value='';
    }
})();
(function($) {

    let timer = false;
    const setRowHeight = function(arrRow){
        var arrHeight = [],
            numMaxHeight = 0
        ;
        arrRow.forEach(function($row){
            var numHeight = $row.height();
            arrHeight.push(numHeight);
        });
        numMaxHeight = Math.max.apply(null, arrHeight);
        arrRow.forEach(function($row){
            $row.height(numMaxHeight);
        });
    },
    setTale = function(){
        $('.table-section').each(function(){
            var $section = $(this),
                numSectionWidth = $section.width()
            ;
            $('.table-fixedHoriz', this).each(function(){
                var $horizontal = $(this),
                    $fixedTable = $('.tableElem', $horizontal),
                    $fixedTableRow = $('.table-row', $fixedTable),
                    $dataContainer = $horizontal.next('.table-dataCtr'),
                    $dataTable = $('.tableElem', $dataContainer),
                    $dataTableRow = $('.table-row', $dataTable),
                    numRow = $fixedTableRow.length,
                    numnumFixedTableWidthRatio = parseInt($horizontal.attr('data-width-ratio'), 10),
                    numFixedAreaWidth = Math.floor(numSectionWidth * numnumFixedTableWidthRatio / 100),
                    numRealFixedAreaWidth,
                    numTargetAreaWidth,
                    numMarginLeft,
                    i
                ;
                $horizontal.width(numFixedAreaWidth);
                numRealFixedAreaWidth = $('.tableElem', $horizontal).width();
                $horizontal.width(numRealFixedAreaWidth);
                numTargetAreaWidth = numSectionWidth - numRealFixedAreaWidth;
                $dataContainer.width(numTargetAreaWidth);
                if (numRow) {
                    for (i = 0; i < numRow; i++) {
                        var $basedRow = $fixedTableRow.eq(i),
                            $targetRow = $dataTableRow.eq(i)
                        ;
                        setRowHeight([$basedRow, $targetRow]);
                    }
                }
            });
        });
    }

    $(function(){
        const $img = $('.table-section img.lazyload');
        $img.on('img:load', setTale);
    });

    $(window)
        .on('load', setTale)
        .on('resize', function(){
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(setTale, 200);
        })
    ;

// end of jquery
})(jQuery);
(function($) {
    "use strict";

    var NS = "cmp";
    var IS = "tabs";

    var keyCodes = {
        END: 35,
        HOME: 36,
        ARROW_LEFT: 37,
        ARROW_UP: 38,
        ARROW_RIGHT: 39,
        ARROW_DOWN: 40
    };

    var selectors = {
        self: "[data-" +  NS + '-is="' + IS + '"]',
        active: {
            tab: "cmp-tabs__tab--active",
            tabpanel: "cmp-tabs__tabpanel--active"
        }
    };

    /**
     * Tabs Configuration
     *
     * @typedef {Object} TabsConfig Represents a Tabs configuration
     * @property {HTMLElement} element The HTMLElement representing the Tabs
     * @property {Object} options The Tabs options
     */

    /**
     * Tabs
     *
     * @class Tabs
     * @classdesc An interactive Tabs component for navigating a list of tabs
     * @param {TabsConfig} config The Tabs configuration
     */
    function Tabs(config) {
        var that = this;

        if (config && config.element) {
            init(config);
        }

        /**
         * Initializes the Tabs
         *
         * @private
         * @param {TabsConfig} config The Tabs configuration
         */
        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            cacheElements(config.element);
            that._active = getActiveIndex(that._elements["tab"]);

            if (that._elements.tabpanel) {
                refreshActive();
                bindEvents();
            }

            if (window.Granite && window.Granite.author && window.Granite.author.MessageChannel) {
                /*
                 * Editor message handling:
                 * - subscribe to "cmp.panelcontainer" message requests sent by the editor frame
                 * - check that the message data panel container type is correct and that the id (path) matches this specific Tabs component
                 * - if so, route the "navigate" operation to enact a navigation of the Tabs based on index data
                 */
                new window.Granite.author.MessageChannel("cqauthor", window).subscribeRequestMessage("cmp.panelcontainer", function(message) {
                    if (message.data && message.data.type === "cmp-tabs" && message.data.id === that._elements.self.dataset["cmpPanelcontainerId"]) {
                        if (message.data.operation === "navigate") {
                            navigate(message.data.index);
                        }
                    }
                });
            }
        }

        /**
         * Returns the index of the active tab, if no tab is active returns 0
         *
         * @param {Array} tabs Tab elements
         * @returns {Number} Index of the active tab, 0 if none is active
         */
        function getActiveIndex(tabs) {
            if (tabs) {
                for (var i = 0; i < tabs.length; i++) {
                    if (tabs[i].classList.contains(selectors.active.tab)) {
                        return i;
                    }
                }
            }
            return 0;
        }

        /**
         * Caches the Tabs elements as defined via the {@code data-tabs-hook="ELEMENT_NAME"} markup API
         *
         * @private
         * @param {HTMLElement} wrapper The Tabs wrapper element
         */
        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                if (hook.closest("." + NS + "-" + IS) === that._elements.self) { // only process own tab elements
                    var capitalized = IS;
                    capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                    var key = hook.dataset[NS + "Hook" + capitalized];
                    if (that._elements[key]) {
                        if (!Array.isArray(that._elements[key])) {
                            var tmp = that._elements[key];
                            that._elements[key] = [tmp];
                        }
                        that._elements[key].push(hook);
                    } else {
                        that._elements[key] = hook;
                    }
                }
            }
        }

        /**
         * Binds Tabs event handling
         *
         * @private
         */
        function bindEvents() {
            var tabs = that._elements["tab"];
            if (tabs) {
                for (var i = 0; i < tabs.length; i++) {
                    (function(index) {
                        tabs[i].addEventListener("click", function(event) {
                            var $tabLink = $(this).children(".cmp-au-com-tab-link");
                            if($tabLink.length == 0) {
                                navigateAndFocusTab(index);
                            } else {
                                $tabLink[0].click();
                            }
                        });
                        tabs[i].addEventListener("keydown", function(event) {
                            onKeyDown(event);
                        });
                    })(i);
                }
            }
        }

        /**
         *
         * Handles tab keydown events
         *
         * @private
         * @param {Object} event The keydown event
         */
        function onKeyDown(event) {
            var index = that._active;
            var lastIndex = that._elements["tab"].length - 1;

            switch (event.keyCode) {
                case keyCodes.ARROW_LEFT:
                case keyCodes.ARROW_UP:
                    event.preventDefault();
                    if (index > 0) {
                        navigateAndFocusTab(index - 1);
                    }
                    break;
                case keyCodes.ARROW_RIGHT:
                case keyCodes.ARROW_DOWN:
                    event.preventDefault();
                    if (index < lastIndex) {
                        navigateAndFocusTab(index + 1);
                    }
                    break;
                case keyCodes.HOME:
                    event.preventDefault();
                    navigateAndFocusTab(0);
                    break;
                case keyCodes.END:
                    event.preventDefault();
                    navigateAndFocusTab(lastIndex);
                    break;
                default:
                    return;
            }
        }

        /**
         * Refreshes the tab markup based on the current {@code Tabs#_active} index
         *
         * @private
         */
        function refreshActive() {
            var tabpanels = that._elements["tabpanel"];
            var tabs = that._elements["tab"];

            if (tabpanels) {
                if (Array.isArray(tabpanels)) {
                    for (var i = 0; i < tabpanels.length; i++) {
                        if (i === parseInt(that._active)) {
                            tabpanels[i].classList.add(selectors.active.tabpanel);
                            tabpanels[i].removeAttribute("aria-hidden");
                            tabs[i].classList.add(selectors.active.tab);
                            tabs[i].setAttribute("aria-selected", true);
                            tabs[i].setAttribute("tabindex", "0");
                        } else {
                            tabpanels[i].classList.remove(selectors.active.tabpanel);
                            tabpanels[i].setAttribute("aria-hidden", true);
                            tabs[i].classList.remove(selectors.active.tab);
                            tabs[i].setAttribute("aria-selected", false);
                            tabs[i].setAttribute("tabindex", "-1");
                        }
                    }
                } else {
                    // only one tab
                    tabpanels.classList.add(selectors.active.tabpanel);
                    tabs.classList.add(selectors.active.tab);
                }
            }
        }

        /**
         * Focuses the element and prevents scrolling the element into view
         *
         * @param {HTMLElement} element Element to focus
         */
        function focusWithoutScroll(element) {
            var x = window.scrollX || window.pageXOffset;
            var y = window.scrollY || window.pageYOffset;
            element.focus();
            window.scrollTo(x, y);
        }

        /**
         * Navigates to the tab at the provided index
         *
         * @private
         * @param {Number} index The index of the tab to navigate to
         */
        function navigate(index) {
            that._active = index;
            refreshActive();
        }

        /**
         * Navigates to the item at the provided index and ensures the active tab gains focus
         *
         * @private
         * @param {Number} index The index of the item to navigate to
         */
        function navigateAndFocusTab(index) {
            navigate(index);
            focusWithoutScroll(that._elements["tab"][index]);
        }
    }

    /**
     * Reads options data from the Tabs wrapper element, defined via {@code data-cmp-*} data attributes
     *
     * @private
     * @param {HTMLElement} element The Tabs element to read options data from
     * @returns {Object} The options read from the component data attributes
     */
    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    /**
     * Document ready handler and DOM mutation observers. Initializes Tabs components as necessary.
     *
     * @private
     */
    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Tabs({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Tabs({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });


    }

    /**
     * スイッチアイコンの高さ設定.
     */
    function setTabSwitcherHeight ($tabSection) {
        const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr');
        const $tabDisplay = $tabCtr.children('.cmp-au-com-tab-display');
        const $tabSwitcher = $tabCtr.children('.tab-switcher');
        const tabHeight = $tabDisplay.height();
        $tabSwitcher.children('a').css('height', tabHeight);
    }

    /**
     * タブラベルテキストの調整.
     */
    function adjustTabLabelTxt($tabSection) {
        const $cmpTabs = $tabSection.parent();
        const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr');
        $('.cmp-au-com-tab-label', $tabCtr).each(function () {
            var $tabLabel = $(this),
            numLabelHeight = $tabLabel.outerHeight(),
            numLineHeight = parseInt($tabLabel.css('line-height'), 10),
            numMaxLabelLine = 2,
            numMaxLabelHeight = numLineHeight * numMaxLabelLine;
            if (numLabelHeight > numMaxLabelHeight && !$tabLabel.hasClass('text-over')) {
                if (!$cmpTabs.parent().hasClass('cmp-au-com-tabs__display__nolimit')) {
                    var strThisText = $tabLabel.text(),
                    strThisHtml = $tabLabel.html(),
                    numLabelWidth = $tabLabel.width(),
                    numLabelFontSize = parseInt($tabLabel.css('font-size'), 10),
                    numThisLine = numLabelHeight / numLineHeight,
                    numTextLength = strThisText.length,
                    numTextLengthPerLineByWidth = Math.floor(numLabelWidth / numLabelFontSize),
                    numTextLengthPerLineByLine = Math.ceil(numTextLength / numThisLine),
                    numMaxLengthPerLine = Math.max(numTextLengthPerLineByWidth, numTextLengthPerLineByLine) - 1,
                    strBeforeText = strThisText.slice(0, numMaxLengthPerLine) // 改行を入れる位置までの文言
                    ;
                    var idx = 0;
                    var strReplaceHTML = '';
                    for (var i = 0; i < strThisHtml.length; i++) {
                        // 変換元のHtmlを1文字ずつ取り出す。
                        var ch = strThisHtml[i];
                        // 改行を入れる位置までの文言が見つかるごとにカウントアップ
                        if (ch == strBeforeText[idx]) {
                            idx++;
                        }
                        // 変換後のHtmlへ1文字ずつ詰める。
                        strReplaceHTML += ch;
                        // 改行を入れる位置までの文言が全て見つかったら改行を入れる。
                        if (idx == strBeforeText.length) {
                            strReplaceHTML += '<br class="tabJsCtr">';
                            idx++;
                        }
                    }
                    $tabLabel.html(strReplaceHTML).addClass('text-over');
                }
            }
            $tabLabel.css('visibility','visible');
        });
    }

    /**
     * スイッチアイコンの表示／非表示切り替え.
     */
    function toggleTabSwitcher ($tabSection) {
        const CSS_CLS_HAS_CTR = 'hasCtr';
        const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr'),
              $tabSwitcher = $('.tab-switcher', $tabCtr),
              $tabPrev = $('.tab-prev', $tabSwitcher),
              $tabNext = $('.tab-next', $tabSwitcher),
              $tabDisplay = $('.cmp-au-com-tab-display', $tabCtr),
              $tabList = $('.cmp-au-com-tabs__tablist', $tabDisplay),
              numTabDisplayWidth = $tabDisplay.outerWidth(),
              numTabListWidth = $tabList.outerWidth(),
              numTabListLeftDistance = $tabList.position().left;
        if (numTabListLeftDistance < 0) {
            $tabPrev.show();
        } else {
            $tabPrev.hide();
        }
        if (numTabListWidth > numTabDisplayWidth) {
            $tabCtr.addClass(CSS_CLS_HAS_CTR);
            if ((numTabListWidth - numTabDisplayWidth) <= Math.ceil(Math.abs(numTabListLeftDistance))) {
                $tabNext.hide();
            } else {
                $tabNext.show();
            }
        } else {
            $tabNext.hide();
            $tabCtr.removeClass(CSS_CLS_HAS_CTR);
        }
    }

    /**
     * 初期表示タブのラベルを表示.
     */
    function displayActiveTabLabel($tabSection) {

        const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr');
        const $tabDisplay = $('.cmp-au-com-tab-display', $tabCtr);
        const $tabList = $('.cmp-au-com-tabs__tablist', $tabDisplay);
        const $tabSelected = $('.cmp-tabs__tab.cmp-tabs__tab--active', $tabDisplay);

        var numSetLeft = 0;
        // タブ表示幅＜タブ全体の幅の場合
        var numTabDisplayWidth = $tabDisplay.outerWidth(),
        numTabListWidth = $tabList.outerWidth();
        // 初期表示位置を算出（+5は既存処理から）
        var numTabSelectedLeftDistance = $tabSelected.position().left + 5;
        if (numTabDisplayWidth < numTabSelectedLeftDistance) {
            // タブ表示幅＜初期選択タブの位置の場合（１ページ目で初期選択タブが表示されていない場合）
            // タブのページ数算出
            var numDividerLength = Math.ceil(numTabListWidth / numTabDisplayWidth),
            arrDividePosition = [];
            // 各タブページの位置を計算
            for (var i = 1; i <= numDividerLength; i++) {
                arrDividePosition.push(numTabDisplayWidth * i);
            }
            // 各タブページ位置と初期表示位置を比較して、スクロール位置を算出する
            $.each(arrDividePosition, function (numIndex, numVal) {
                if (numTabSelectedLeftDistance < numVal) {
                    // 初期表示位置＜各タブページ位置（タブページの表示範囲内に収まった）場合、終了
                    return false;
                }
                // スクロール位置算出(-100%で左に１スクロール移動する)
                numSetLeft = -(numIndex + 1) * 100;
            });
        }
        // タブのスクロール実行
        $tabList.css({
            left: numSetLeft + '%'
        });
    }

    /**
     * タブラベルの幅設定.
     */
    function setTabLabelWidth($tabSection) {
        const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr');
        const $tabList = $('.cmp-au-com-tabs__tablist', $tabCtr);
        var itemsSize = $tabList.data('items-size');
        var displayNum = 1;

        if (CommonUtil.isPc()) {
            displayNum = $tabList.data('display-num-pc');
        } else if (CommonUtil.isTablet()) {
            displayNum = $tabList.data('display-num-tab');
        } else {
            displayNum = $tabList.data('display-num-sp');
        }

        if ( itemsSize < displayNum ) {
            displayNum = itemsSize;
        }

        var width = 'calc( 100% / '+ displayNum + ' * ' + itemsSize +')'
        $tabList.css('width', width);
        $tabList.css('table-layout', 'fixed');

    }

    /**
     * タブ設定処理.
     */
    function resetTabProps (tabOpenParams) {
        $('.cmp-au-com-tab').each(function () {
            const $tab = $(this);
            const $tabSection = $tab.children('.cmp-au-com-tab-section');
            const $tabCtr = $tabSection.children('.cmp-au-com-tab-ctr');
            const $tabLabel = $('.cmp-au-com-tab-label', $tabCtr);

            if (tabOpenParams) {
                for (var i = 0; tabOpenParams[i]; i++) {
                    $('[data-id= '+ tabOpenParams[i] +']', $tabSection).trigger('click');
                }
            }
            $tabLabel.removeClass('text-over');
            $('br.tabJsCtr', $tabLabel).remove();

            var $tabSelected = $('.cmp-tabs__tab.cmp-tabs__tab--active', $tabSection);

            // タブラベルの幅を設定
            setTabLabelWidth($tabSection);

            if ($tabSelected.length) {

                // 初期表示タブのラベルを表示
                displayActiveTabLabel($tabSection);
                // スイッチアイコンの表示切替
                toggleTabSwitcher($tabSection);
                // タブラベルテキストの調整
                adjustTabLabelTxt($tabSection);
                // スイッチアイコンの高さ調整
                setTabSwitcherHeight($tabSection);

            }

        });

    }

    /**
     * ready処理.
     */
    $(function () {
        var timer = false;
        var isExec = false;
        // event
        $(document).on('click', '.cmp-au-com-tab-section > .cmp-au-com-tab-ctr > .tab-switcher > *', function () {
            if (isExec) {
                return;
            }
            isExec = true;
            var $tabSwitcher = $(this),
                $tabCtr = $tabSwitcher.parent().parent(),
                $tabSection = $tabCtr.parent(),
                $tabDisplay = $('.cmp-au-com-tab-display', $tabCtr),
                $tabList = $('.cmp-au-com-tabs__tablist', $tabDisplay),
                numTabDisplayWidth = $tabDisplay.outerWidth(),
                numTabListLeftDistance = $tabList.position().left,
                numLeftDistance = Math.round(numTabListLeftDistance / numTabDisplayWidth * 100),
                numSetLeft = 0;
            if ($tabSwitcher.is('.tab-prev')) {
                numSetLeft = numLeftDistance + 100;
                if (numSetLeft > 0) {
                    numSetLeft = 0;
                }
            } else {
                numSetLeft = numLeftDistance - 100;
            }
            $tabList.animate({left: numSetLeft + '%'}, 200, 'swing',
                function() {
                    toggleTabSwitcher($tabSection);
                    isExec = false;
                }
            );
        });

        const $tabSelected = $('.cmp-au-com-tab-section > .cmp-au-com-tab-ctr .cmp-tabs__tab.cmp-tabs__tab--active', this);
        if ($tabSelected.length) {
            $tabSelected.each(function() {
                $tabSelected.trigger('click');
            });
        }

        // save window width
        var currentWidth = window.innerWidth;
        $(window).on('resize', function (e) {
            // Mobile Safari scrolling support
            if (currentWidth == window.innerWidth) {
                // resize event and window of the same width , event canceled
                return;
            }
            // window width updated
            currentWidth = window.innerWidth;
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(resetTabProps, 200);
        });

        var tabOpenParam = AU_COMMON.getParameter(document.location.href, "tabopen");
        var tabOpenParams = tabOpenParam ? tabOpenParam.split(',') : undefined;
        onDocumentReady();
        resetTabProps(tabOpenParams);

        // タブが非表示の場合、ラベルの調整が正しく出来ないため、表示されたタイミングでラベルを再調整
        $('.cmp-au-com-tab > .cmp-au-com-tab-section').on('inview', function () {
            const $tabSection = $(this);
            // 初期表示タブのラベルを表示
            displayActiveTabLabel($tabSection);
            // スイッチアイコンの表示切替
            toggleTabSwitcher($tabSection);
            // タブラベルテキストの調整
            adjustTabLabelTxt($tabSection);
            // スイッチアイコンの高さ調整
            setTabSwitcherHeight($tabSection);
        });

        // end of jquery
    });

}(jQuery));

/**
 * Element.matches()
 * https://developer.mozilla.org/enUS/docs/Web/API/Element/matches#Polyfill
 */
if (!Element.prototype.matches) {
    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
}

// eslint-disable-next-line valid-jsdoc
/**
 * Element.closest()
 * https://developer.mozilla.org/enUS/docs/Web/API/Element/closest#Polyfill
 */
if (!Element.prototype.closest) {
    Element.prototype.closest = function(s) {
        "use strict";
        var el = this;
        if (!document.documentElement.contains(el)) {
            return null;
        }
        do {
            if (el.matches(s)) {
                return el;
            }
            el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
    };
}
(function($) {
    $(function(){

        const CSS_CLS_HAS_CTR = 'hasCtr';

        var setTabListWidth = function(){
                $('.tabElem-section').each(function(){
                    var $tabSection = $(this),
                        $tabContainer = $('.tab-ctr', $tabSection),
                        $tabList = $('.tab-list', $tabSection),
                        $tab = $('.tab-elem', $tabList),
                        numTabListWidth = 100,
                        numTabLength = $tab.length
                    ;

                    // get allDisplayFlg
                    var allDisplayFlg = $(this).attr('data-all-display-flg');
                    if (allDisplayFlg == 'true') {
                        $('.tab-display', $tabContainer).addClass('no-limit');
                    }
                    // get tabNumbers
                    var tabNumbers = $(this).attr('data-display-num');
                    var numMax = checkBreakPoint(tabNumbers);

                    if (numMax > numTabLength) {
                        numMax = numTabLength;
                    }
                    var numCoef = numTabListWidth / numMax;
                    if ( numTabLength > numMax ) {
                        numTabListWidth = ((numTabLength - numMax) * numCoef) + numTabListWidth;
                        $tabList.width(numTabListWidth + '%');
                        $tabContainer.addClass(CSS_CLS_HAS_CTR);
                    } else {
                        $tabList.width('100%');
                    }
                    $('.tab-label', $tabSection).each(function(){
                        var $tabLabel = $(this),
                            numLabelHeight = $tabLabel.outerHeight(),
                            numLineHeight = parseInt($tabLabel.css('line-height'), 10),
                            numMaxLabelLine = 2,
                            numMaxLabelHeight = numLineHeight * numMaxLabelLine
                        ;
                        if (numLabelHeight > numMaxLabelHeight) {
                            if (allDisplayFlg == 'true') {
                                $tabLabel
                                .addClass('text-over')
                                .addClass('no-limit');
                            } else {
                                var strThisText = $tabLabel.text(),
                                strThisHtml = $tabLabel.html(),
                                numLabelWidth = $tabLabel.width(),
                                numLabelFontSize = parseInt($tabLabel.css('font-size'), 10),
                                numThisLine = numLabelHeight / numLineHeight,
                                numTextLength = strThisText.length,
                                numTextLengthPerLineByWidth = Math.floor(numLabelWidth / numLabelFontSize),
                                numTextLengthPerLineByLine = Math.ceil(numTextLength / numThisLine),
                                numMaxLengthPerLine = Math.max(numTextLengthPerLineByWidth, numTextLengthPerLineByLine) - 1,
                                strBeforeText = strThisText.slice(0, numMaxLengthPerLine) // 改行を入れる位置までの文言
                            ;
                            var idx = 0;
                            var strReplaceHTML = '';
                            for (var i = 0 ; i < strThisHtml.length ; i++) {

                                // 変換元のHtmlを1文字ずつ取り出す。
                                var ch = strThisHtml[i];

                                // 改行を入れる位置までの文言が見つかるごとにカウントアップ
                                if (ch == strBeforeText[idx]) {
                                    idx++;
                                }
                                // 変換後のHtmlへ1文字ずつ詰める。
                                strReplaceHTML += ch;

                                // 改行を入れる位置までの文言が全て見つかったら改行を入れる。
                                if (idx == strBeforeText.length) {
                                    strReplaceHTML += '<br class="tabJsCtr">';
                                    idx++;
                                }
                            }
                            $tabLabel
                                .html(strReplaceHTML)
                                .addClass('text-over')
                            ;
                            }
                        }
                    });
                });
            },
            resetTabProps = function() {
                $('.tab-label').each(function(){
                    $(this).removeClass('no-limit');
                    $(this).removeClass('text-over');
                    $('br.tabJsCtr', this).remove();
                });
                setTabListWidth();
                $('.tabElem-section').each(function(){
                    var $tabDisplay = $('.tab-display', this),
                        $tabList = $('.tab-list', $tabDisplay),
                        $tabSelected = $('.tab-elem.tab-selected', $tabList),
                        numSetLeft = 0
                    ;
                    if ($tabSelected.length) {
                        // タブ表示幅＜タブ全体の幅の場合
                        var numTabDisplayWidth = $tabDisplay.outerWidth(),
                            numTabListWidth = $tabList.outerWidth()
                        ;
                        // 初期表示位置を算出（+5は既存処理から）
                        var numTabSelectedLeftDistance = $tabSelected.position().left + 5;
                        if (numTabDisplayWidth < numTabSelectedLeftDistance) {
                            // タブ表示幅＜初期選択タブの位置の場合（１ページ目で初期選択タブが表示されていない場合）
                            // タブのページ数算出
                            var numDividerLength = Math.ceil(numTabListWidth / numTabDisplayWidth),
                                arrDividePosition = [];
                            // 各タブページの位置を計算
                            for (var i = 1; i <= numDividerLength; i++) {
                                arrDividePosition.push(numTabDisplayWidth * i);
                            }
                            // 各タブページ位置と初期表示位置を比較して、スクロール位置を算出する
                            $.each(arrDividePosition, function(numIndex, numVal){
                                if (numTabSelectedLeftDistance < numVal) {
                                    // 初期表示位置＜各タブページ位置（タブページの表示範囲内に収まった）場合、終了
                                    return false;
                                }
                                // スクロール位置算出(-100%で左に１スクロール移動する)
                                numSetLeft = -(numIndex + 1) * 100;
                            });
                        }
                        // タブのスクロール実行
                        $tabList.css({
                            left: numSetLeft + '%'
                        });
                        checkTabPosition();
                        setTabHeight();
                    }
                });
            },
            checkTabPosition = function() {
                $('.tabElem-section').each(function(){
                    var $tabSection = $(this),
                        $tabCtr = $('.tab-ctr', $tabSection),
                        $tabPrev = $('.tab-prev', $tabCtr),
                        $tabNext = $('.tab-next', $tabCtr),
                        $tabDisplay = $('.tab-display', $tabSection),
                        $tabList = $('.tab-list', $tabDisplay),
                        numTabDisplayWidth = $tabDisplay.outerWidth(),
                        numTabListWidth = $tabList.outerWidth(),
                        numTabListLeftDistance = $tabList.position().left
                    ;
                    if (numTabListLeftDistance < 0) {
                        $tabPrev.show();
                    } else {
                        $tabPrev.hide();
                    }
                    if (numTabListWidth > numTabDisplayWidth) {
                        $tabCtr.addClass(CSS_CLS_HAS_CTR);
                        if ((numTabListWidth - numTabDisplayWidth) <= Math.ceil(Math.abs(numTabListLeftDistance))) {
                            $tabNext.hide();
                        } else {
                            $tabNext.show();
                        }
                    } else {
                        $tabNext.hide();
                        $tabCtr.removeClass(CSS_CLS_HAS_CTR);
                    }
                });
                isExec = false;
            },
            checkBreakPoint = function(tabNumbers) {
                var numWindowWidth = $(window).width(),
                    numBPforPCtoTablet = 980,
                    numBPforTablettoSMP = 768
                ;
                var tabNumberArray = [];
                if(tabNumbers != null && tabNumbers != '' && typeof(tabNumbers) != 'undefined') {
                    tabNumberArray = tabNumbers.split(',');
                } else {
                    // default
                    tabNumberArray = [5,4,3];
                }
                if (numWindowWidth >= numBPforPCtoTablet) {
                    return tabNumberArray[0];
                } else if (numWindowWidth >= numBPforTablettoSMP) {
                    return tabNumberArray[1];
                }
                return tabNumberArray[2];
            },
            setTabHeight = function(){
                $('.tab-display').each(function(){
                    var tabHeight = $(this).height();
                    $(this).next('.tab-switcher').children('a').css('height' ,tabHeight);
                });
            },
            timer = false
        ;

    // event

        $(document)
            .on('click', '.tabElem-section .tab-elem.tab-link', function(){
                var $tab = $(this),
                    strContentsID = $tab.attr('data-contents'),
                    strActiveClass = 'tab-selected',
                    $tabSection = $tab.parents('.tabElem-section'),
                    $tabcontentsContainer = $('.tab-cont-ctr', $tabSection),
                    $tabContents = $('.tab-cont-display', $tabcontentsContainer),
                    $selectedContents = $('#' + strContentsID, $tabContents)
                ;

                $tab.addClass(strActiveClass)
                    .siblings('.tab-elem').removeClass(strActiveClass)
                ;

                if ( $selectedContents.length ) {
                    $selectedContents.addClass(strActiveClass)
                        .siblings().removeClass(strActiveClass)
                    ;
                }
            })
            .on('click', '.tabElem-section .tab-switcher > *', function(){

                if (isExec) {
                    return;
                }
                isExec = true;

                var $tabSwitcher = $(this),
                    $tabSection = $tabSwitcher.parents('.tabElem-section'),
                    $tabDisplay = $('.tab-display', $tabSection),
                    $tabList = $('.tab-list', $tabDisplay),
                    numTabDisplayWidth = $tabDisplay.outerWidth(),
                    numTabListLeftDistance = $tabList.position().left,
                    numLeftDistance = Math.round(numTabListLeftDistance / numTabDisplayWidth * 100),
                    numSetLeft = 0
                ;
                if ($tabSwitcher.is('.tab-prev')) {
                    numSetLeft = numLeftDistance + 100;
                    if (numSetLeft > 0) {
                        numSetLeft = 0;
                    }
                } else {
                    numSetLeft = numLeftDistance - 100;
                }
                $tabList.animate({
                    left: numSetLeft + '%'
                }, 200, 'swing', checkTabPosition);
            })
        ;
        var isExec = false;

        $('.tabElem-section').each(function(){
            var $tabSelected = $('.tab-elem.tab-selected', this)
            ;
            if ($tabSelected.length) {
                $tabSelected.trigger('click');
            }
        });

        // save window width
        var currentWidth = window.innerWidth;
        $(window).on('load resize', function(e){
            // Mobile Safari scrolling support
            if (e.type == 'resize' && currentWidth == window.innerWidth) {
                // resize event and window of the same width , event canceled
                return;
            }
            // window width updated
            currentWidth = window.innerWidth;
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(resetTabProps, 200);
        });

        // end of jquery
    });
})(jQuery);
(function($) {
    'use strict';

    function getValue(elem, variablesName) {
        var $parent = $(elem).closest('.cmp-au-com-sns');
        var $variablesElem = $parent.children('input[name=' + variablesName + ']');
        return $variablesElem.val() || '';
    }

    $(function() {
        if ($('.cmp-au-com-sns').length) {
            window.sns = {};
            window.sns.getValue = getValue;
        }
    });

})(jQuery);

(function($) {

  $(function() {
    $('.link-btn-print--pc a,.print-btn a').on('click', function() {
      window.print();
      return false;
    });
  });

})(jQuery);

(function($) {
    function anchorScroll(e) {
        e.preventDefault();

        const strID = $(this).attr('href').split('#')[1];
        if (strID) {
            window.location.hash = strID;
            $(window).trigger("hashchange");
        }
    }

    $(function(){

        var strURL = location.href,
            numScrollSpeed = 500,
            strEasing = 'easeOutQuart',
            $localNav = $('.mainHeadLocalNav, .cmp-au-com-localnav'),
            $sidecont = $('.sidecontArea'),
            $smpHeader = $('.headerSmp'),
            touch_timer,
            calcNumHeaderHeight = function(){
                var numHeaderHeight = $localNav.length ? $localNav.outerHeight() : 0,
                    numWindowWidth = $(window).width();
                if (numWindowWidth < 1200 && !$sidecont.is('.stored-header-ismove')) {
                    numHeaderHeight += $sidecont.length ? $sidecont.outerHeight() : 0;
                }
                if (numWindowWidth < 768 && $smpHeader.is('.stored-header-ishide')) {
                    numHeaderHeight -= $smpHeader.length ? $smpHeader.outerHeight() : 0;
                }
                return numHeaderHeight;
            },
            setAnchorPosition = function($target, isLagged) {
                    var _setPosition = function() {
                        var numTop = $target.length ? $target.offset().top : 0;
                        numTop -= calcNumHeaderHeight();
                        numTop -= 30; //stop above 30px
                        $(window).scrollTop(numTop);
                    }
                ;
                if (isLagged) {
                    setTimeout(_setPosition, 550);
                } else {
                    _setPosition();
                }
            }
        ;

        if (strURL.indexOf('#') !== -1) {
            var strID = strURL.split('#')[1],
                $target = $('#' + strID)
            ;
                setAnchorPosition($target, true);
            }

        $(document)

            // アンカーリンクの挙動
            .on('click', 'a[href*="#"]:not([href*="/"])', anchorScroll)

            // リンクタップ時の挙動（リンク配下の画像周辺には tap-highlight を出さないための処理）
            .on({
                'touchstart': function(){
                    var touchTarget = $(this);
                    clearTimeout(touch_timer);
                    touch_timer = setTimeout(function(){
                        touchTarget.addClass('tapping tapped');
                    }, 250);
                },
                'touchend focusout': function(){
                    clearTimeout(touch_timer);
                    $(this).removeClass('tapping')
                }
            }, 'a.cardBox-cont')

        ;

        // end of jquery
    });

})(jQuery);
(function($) {
    'use strict';

    var NS = "cmp";
    var IS = "carousel";

    var selectors = {
        self: "[data-" +  NS + '-is="' + IS + '"]'
    };

    /**
     * Carousel Configuration
     *
     * @typedef {Object} CarouselConfig Represents a Carousel configuration
     * @property {HTMLElement} element The HTMLElement representing the Carousel
     * @property {Object} options The Carousel options
     */

    /**
     * Carousel
     *
     * @class Carousel
     * @classdesc An interactive Carousel component for navigating a list of generic items
     * @param {CarouselConfig} config The Carousel configuration
     */
    function Carousel(config) {
        var that = this;

        if (config && config.element) {
            init(config);
        }

        /**
         * Initializes the Carousel
         *
         * @private
         * @param {CarouselConfig} config The Carousel configuration
         */
        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            cacheElements(config.element);

            that._active = 0;

            if (that._elements.item) {
                refreshActive();
            }

            if (window.Granite && window.Granite.author && window.Granite.author.MessageChannel) {
                /*
                 * Editor message handling:
                 * - subscribe to "cmp.panelcontainer" message requests sent by the editor frame
                 * - check that the message data panel container type is correct and that the id (path) matches this specific Carousel component
                 * - if so, route the "navigate" operation to enact a navigation of the Carousel based on index data
                 */
                new window.Granite.author.MessageChannel("cqauthor", window).subscribeRequestMessage("cmp.panelcontainer", function(message) {
                    if (message.data && message.data.type === "cmp-carousel" && message.data.id === that._elements.self.dataset["cmpPanelcontainerId"]) {
                        if (message.data.operation === "navigate") {
                            navigate(message.data.index);
                        }
                    }
                });
            }
        }

        /**
         * Caches the Carousel elements as defined via the {@code data-carousel-hook="ELEMENT_NAME"} markup API
         *
         * @private
         * @param {HTMLElement} wrapper The Carousel wrapper element
         */
        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                var capitalized = IS;
                capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                var key = hook.dataset[NS + "Hook" + capitalized];
                if (that._elements[key]) {
                    if (!Array.isArray(that._elements[key])) {
                        var tmp = that._elements[key];
                        that._elements[key] = [tmp];
                    }
                    that._elements[key].push(hook);
                } else {
                    that._elements[key] = hook;
                }
            }
        }

        /**
         * Refreshes the item markup based on the current {@code Carousel#_active} index
         *
         * @private
         */
        function refreshActive() {
            var items = that._elements["item"];

            if (items) {
                if (Array.isArray(items)) {
                    for (var i = 0; i < items.length; i++) {
                        if (i === parseInt(that._active)) {
                            items[i].classList.add("cmp-carousel__item--active");
                            items[i].removeAttribute("aria-hidden");
                        } else {
                            items[i].classList.remove("cmp-carousel__item--active");
                            items[i].setAttribute("aria-hidden", true);
                        }
                    }
                } else {
                    // only one item
                    items.classList.add("cmp-carousel__item--active");
                }
            }
        }

        /**
         * Navigates to the item at the provided index
         *
         * @private
         * @param {Number} index The index of the item to navigate to
         */
        function navigate(index) {
            if (index < 0 || index > (that._elements["item"].length - 1)) {
                return;
            }

            that._active = index;
            refreshActive();

        }

    }

    /**
     * Reads options data from the Carousel wrapper element, defined via {@code data-cmp-*} data attributes
     *
     * @private
     * @param {HTMLElement} element The Carousel element to read options data from
     * @returns {Object} The options read from the component data attributes
     */
    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    /**
     * Document ready handler and DOM mutation observers. Initializes Carousel components as necessary.
     *
     * @private
     */
    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Carousel({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body             = document.querySelector("body");
        var observer         = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Carousel({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    /**
    *
    * ready 処理
    *
    */
    $(function() {

        if (CommonUtil.isAuthorEditor()) {
            onDocumentReady();
        }

    });

})(jQuery);

var carousel = {};

(function($) {
    carousel.init = function(id) {
        carouselTimer[id] = false;
        var $carouselSection = $('#' + id);
        if ($carouselSection && $carouselSection.length) {
            $('.carousel-display', $carouselSection).each(function(){
                var $carousel = $(this),
                    container = $carousel.parents('.carousel-ctr'),
                    $carouselswitcher = $('.carousel-switcher', container),
                    $imgs = $('img.lazyload', $carousel),
                    readyAllImg = false,
                    loadAllImg = false,
                    matchedHeight = false,
                    matchHeightCarousel = function() {
                        $('.carousel-cont', $carousel).matchHeight();
                        return true;
                    },
                    initialyzeCarousel = function() {
                        if (!readyAllImg) {
                            readyAllImg = responsiveImage.prepareLoadAll($imgs, false);
                        }
                        if (readyAllImg && !loadAllImg) {
                            loadAllImg = responsiveImage.confirmLoadAll($imgs);
                        }
                        if (loadAllImg && !matchedHeight) {
                            matchedHeight = matchHeightCarousel();
                        }
                    },
                    objCarouselSettings = {
                        appendArrows: $carouselswitcher,
                        dots: false,
                        infinite: true,
                        autoplay: true,
                        autoplaySpeed: 4000
                    },
                    setCarousel = function(){
                        $carousel.not('.slick-initialized')
                        .on('init refresh', function() {
                            $imgs = $('img.lazyload', $carousel),
                            $imgs.on('img:load', function() {
                                initialyzeCarousel();
                            });
                            initialyzeCarousel();
                        }).slick(objCarouselSettings);
                    }
                ;
                // set properties by each types of carousel
                if ($carousel.is('.carousel-col1_2')) {
                    objCarouselSettings.slidesToShow = 2;
                    objCarouselSettings.responsive = [
                        {
                            breakpoint: 768,
                            settings: {
                                slidesToShow: 1
                            }
                        }
                    ];
                }
                if ($carousel.is('.carousel-col1_3')) {
                    objCarouselSettings.slidesToShow = 3;
                    objCarouselSettings.responsive = [
                        {
                            breakpoint: 980,
                            settings: {
                                slidesToShow: 2
                            }
                        },{
                            breakpoint: 768,
                            settings: {
                                slidesToShow: 1
                            }
                        }
                    ];
                }
                if ($carousel.is('.carousel-col2_4')) {
                    objCarouselSettings.slidesToShow = 4;
                    objCarouselSettings.responsive = [
                        {
                            breakpoint: 980,
                            settings: {
                                slidesToShow: 3
                            }
                        },{
                            breakpoint: 640,
                            settings: {
                                slidesToShow: 2
                            }
                        }
                    ];
                }
                if ($carousel.is('.carousel-col2_5')) {
                    objCarouselSettings.slidesToShow = 5;
                    objCarouselSettings.responsive = [
                        {
                            breakpoint: 980,
                            settings: {
                                slidesToShow: 4
                            }
                        },{
                            breakpoint: 768,
                            settings: {
                                slidesToShow: 3
                            }
                        },{
                            breakpoint: 640,
                            settings: {
                                slidesToShow: 2
                            }
                        }
                    ];
                }
                if ($carousel.is('.carousel-varWidth')) {
                    objCarouselSettings.variableWidth = true;
                }

                // set carousels
                setCarousel();

                //declare as gloval valueable to be able to checked by common.js 
                $(window).on('resize', function(){
                    if (carouselTimer[id] !== false) {
                        clearTimeout(carouselTimer[id]);
                    }
                    carouselTimer[id] = setTimeout(function(){
                        matchedHeight = false;
                        initialyzeCarousel();
                    }, 500);
                })
                ;
            });
        }
    }

})(jQuery);

/* card.js */
(function($) {
    'use strict';

    $(function() {

        $('.cmp-au-com-card').parent().parent().filter(function() {
            // セクションコンテナ内にflexboxで並んでいるカードのみが対象。
            return ($(this).css('display') === "flex");
        }).each(function() {
            matchHeight($(this));
        });

        $('.cmp-carousel__items').each(function() {
            // カルーセル内のカードの高さを揃える
            if ($(this).find('.cmp-au-com-card')) {
                matchHeight($(this));
            }
        });

    });

    function matchHeight($this) {
            const $imgs = $('img.lazyload', $this);

            /* カードの高さ揃え処理 */
            const matchHeightCard = function() {
                $this.find('.cmp-au-com-card .cmp-au-com-card__display').matchHeight({
                    byRow: true // 行ごとに高さを揃えるなら：true
                });
                return true;
            };

            const imgStatus = {};
            imgStatus.readyAllImg = false;
            imgStatus.loadAllImg = false;

            const initialyzeCard = function() {
                if (!imgStatus.readyAllImg) {
                    imgStatus.readyAllImg = responsiveImage.prepareLoadAll($imgs, false);
                }
                if (imgStatus.readyAllImg && !imgStatus.loadAllImg) {
                    imgStatus.loadAllImg = responsiveImage.confirmLoadAll($imgs);
                }
                if (imgStatus.loadAllImg) {
                    matchHeightCard();
                }
            };

            if ($imgs.length) {

                $imgs.on('img:load', function() {
                    initialyzeCard();
                });
                initialyzeCard();
            } else {

                // モーダルを表示した際に高さ揃えを行う。
                $(document).on('shown.bs.modal', function () {
                    matchHeightCard();
                });
                matchHeightCard();
            }
    }

})(jQuery);

(function($) {
    'use strict';
    $(function(){
        $('.modal-openBtn').on('click', function () {
            var modalTarget = $(this).attr('data-target'),
                src = $(modalTarget).find('iframe').attr('src'),
                $modalDialog = $('.cmp-au-com-modal-dialog', $(modalTarget)),
                $modalBody = $('.cmp-au-com-modal-body', $(modalTarget));

            $(modalTarget).on('hide.bs.modal', function () {
                //close時の動画対応
                $(modalTarget).find('iframe').attr('src', src);
            });
            $(modalTarget).on('shown.bs.modal', function () {
                //表示時の中央揃え対応
                var $imgs = $('img.lazyload', $modalBody);
                var modalHeight = $modalBody.outerHeight();
                $modalDialog.height(modalHeight);
                if ($imgs.length) {
                    window.responsiveImage.prepareLoadAll($imgs, true);
                    $imgs.on('img:load', function() {
                        if (responsiveImage.confirmLoadAll($imgs)) {
                            modalHeight = $modalBody.outerHeight();
                            $modalDialog.height(modalHeight);
                            adjustMargin();
                        }
                    })
                } else {
                    adjustMargin();
                }
            });
        });
    });

    function adjustMargin() {
        var $modalDialog = $('.cmp-au-com-modalElem.in .cmp-au-com-modal-dialog');
        if ($modalDialog.length) {
            var minMarginTop = 50;
            if ($modalDialog.parents().hasClass('cmp-au-com-modal__color__transparent')) {
                minMarginTop = 80;
            }
            if ($modalDialog.height() + (minMarginTop * 2) > $(window).height()) {
                $modalDialog.css('margin-top', minMarginTop + 'px');
            } else {
                $modalDialog.css('margin-top', '');
            }
        }
    }

    var modalTimer = false;
    $(window).on('resize', function(){
        if (modalTimer !== false) {
            clearTimeout(modalTimer);
        }
        modalTimer = setTimeout(function(){
            adjustMargin();
        }, 500);
    });

// end of jquery
})(jQuery);
(function($) {

    window.auModal = {};
    $(function(){
        $('.modal-openBtn').on('click', function () {
            var modalTarget = $(this).attr('data-target'),
                src = $(modalTarget).find('iframe').attr('src'),
                $modalDialog = $('.modal-dialog', $(modalTarget)),
                $modalBody = $('.modal-body', $(modalTarget));

            $(modalTarget).on('hide.bs.modal', function () {
                //close時の動画対応
                $(modalTarget).find('iframe').attr('src', src);
            });
            $(modalTarget).on('shown.bs.modal', function () {
                //表示時の中央揃え対応
                var $imgs = $('img.lazyload', $modalBody);
                var modalHeight = $modalBody.outerHeight();
                $modalDialog.height(modalHeight);
                if ($imgs.length) {
                    window.responsiveImage.prepareLoadAll($imgs, true);
                    $imgs.on('img:load', function() {
                        if (responsiveImage.confirmLoadAll($imgs)) {
                            modalHeight = $modalBody.outerHeight();
                            $modalDialog.height(modalHeight);
                            adjustMargin();
                        }
                    })
                } else {
                    adjustMargin();
                }
            });
        });
    });

    function adjustMargin() {
        var $modalDialog = $('.modalElem.in .modal-dialog');
        if ($modalDialog.length) {
            var minMarginTop = 50;
            if ($modalDialog.parent().hasClass('modal-movie')) {
                minMarginTop = 80;
            }
            if ($modalDialog.height() + (minMarginTop * 2) > $(window).height()) {
                $modalDialog.css('margin-top', minMarginTop + 'px');
            } else {
                $modalDialog.css('margin-top', '');
            }
        }
    }
    window.auModal.adjustMargin = adjustMargin;

    var modalTimer = false;
    $(window).on('resize', function(){
        if (modalTimer !== false) {
            clearTimeout(modalTimer);
        }
        modalTimer = setTimeout(function(){
            adjustMargin();
        }, 500);
    });

// end of jquery
})(jQuery);
/*******************************************************************************
 * Copyright 2019 Adobe
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 ******************************************************************************/

/**
 * Element.matches()
 * https://developer.mozilla.org/enUS/docs/Web/API/Element/matches#Polyfill
 */
if (!Element.prototype.matches) {
    Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
}

// eslint-disable-next-line valid-jsdoc
/**
 * Element.closest()
 * https://developer.mozilla.org/enUS/docs/Web/API/Element/closest#Polyfill
 */
if (!Element.prototype.closest) {
    Element.prototype.closest = function(s) {
        "use strict";
        var el = this;
        if (!document.documentElement.contains(el)) {
            return null;
        }
        do {
            if (el.matches(s)) {
                return el;
            }
            el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
    };
}

/* accordion.js(v2) */
(function($) {
    "use strict";

    var NS = "cmp";
    var IS = "accordion";

    var keyCodes = {
        ENTER: 13,
        SPACE: 32,
        END: 35,
        HOME: 36,
        ARROW_LEFT: 37,
        ARROW_UP: 38,
        ARROW_RIGHT: 39,
        ARROW_DOWN: 40
    };

    var selectors = {
        self: "[data-" +  NS + '-is="' + IS + '"]'
    };

    var cssClasses = {
        button: {
            disabled: "cmp-accordion__button--disabled",
            expanded: "cmp-accordion__button--expanded"
        },
        panel: {
            hidden: "cmp-accordion__panel--hidden",
            expanded: "cmp-accordion__panel--expanded"
        }
    };

    var dataAttributes = {
        item: {
            expanded: "data-cmp-expanded",
            expandedSp: "data-cmp-expanded-sp"
        }
    };

    var dataSetAttributes = {
        item: {
            expanded: "cmpExpanded",
            expandedSp: "cmpExpandedSp"
        }
    };

    var properties = {
        /**
         * Determines whether a single accordion item is forced to be expanded at a time.
         * Expanding one item will collapse all others.
         *
         * @memberof Accordion
         * @type {Boolean}
         * @default false
         */
        "singleExpansion": {
            "default": false,
            "transform": function(value) {
                return !(value === null || typeof value === "undefined");
            }
        }
    };

    var numSpeed = 400;
    var breakPointMaxSMP = 767;     // px

    /**
     * Accordion Configuration.
     *
     * @typedef {Object} AccordionConfig Represents an Accordion configuration
     * @property {HTMLElement} element The HTMLElement representing the Accordion
     * @property {Object} options The Accordion options
     */

    /**
     * Accordion.
     *
     * @class Accordion
     * @classdesc An interactive Accordion component for toggling panels of related content
     * @param {AccordionConfig} config The Accordion configuration
     */
    function Accordion(config) {
        var that = this;

        if (config && config.element) {
            init(config);
        }

        /**
         * Initializes the Accordion.
         *
         * @private
         * @param {AccordionConfig} config The Accordion configuration
         */
        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            setupProperties(config.options);
            cacheElements(config.element);

            if (that._elements["item"]) {
                // ensures multiple element types are arrays.
                that._elements["item"] = Array.isArray(that._elements["item"]) ? that._elements["item"] : [that._elements["item"]];
                that._elements["button"] = Array.isArray(that._elements["button"]) ? that._elements["button"] : [that._elements["button"]];
                that._elements["panel"] = Array.isArray(that._elements["panel"]) ? that._elements["panel"] : [that._elements["panel"]];

                if (that._properties.singleExpansion) {
                    var expandedItems = getExpandedItems();
                    // no expanded item annotated, force the first item to display.
                    if (expandedItems.length === 0) {
                        toggle(0);
                    }
                    // multiple expanded items annotated, display the last item open.
                    if (expandedItems.length > 1) {
                        toggle(expandedItems.length - 1);
                    }
                }

                refreshItems();
                bindEvents();

                if (window.Granite && window.Granite.author && window.Granite.author.MessageChannel) {
                    /*
                     * Editor message handling:
                     * - subscribe to "cmp.panelcontainer" message requests sent by the editor frame
                     * - check that the message data panel container type is correct and that the id (path) matches this specific Accordion component
                     * - if so, route the "navigate" operation to enact a navigation of the Accordion based on index data
                     */
                    new window.Granite.author.MessageChannel("cqauthor", window).subscribeRequestMessage("cmp.panelcontainer", function(message) {
                        if (message.data && message.data.type === "cmp-accordion" && message.data.id === that._elements.self.dataset["cmpPanelcontainerId"]) {
                            if (message.data.operation === "navigate") {
                                // switch to single expansion mode when navigating in edit mode.
                                var singleExpansion = that._properties.singleExpansion;
                                that._properties.singleExpansion = true;
                                toggle(message.data.index);

                                // revert to the configured state.
                                that._properties.singleExpansion = singleExpansion;
                            }
                        }
                    });
                }
            }
        }

        /**
         * Caches the Accordion elements as defined via the {@code data-accordion-hook="ELEMENT_NAME"} markup API.
         *
         * @private
         * @param {HTMLElement} wrapper The Accordion wrapper element
         */
        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                if (hook.closest("." + NS + "-" + IS) === that._elements.self) { // only process own accordion elements
                    var capitalized = IS;
                    capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                    var key = hook.dataset[NS + "Hook" + capitalized];
                    if (that._elements[key]) {
                        if (!Array.isArray(that._elements[key])) {
                            var tmp = that._elements[key];
                            that._elements[key] = [tmp];
                        }
                        that._elements[key].push(hook);
                    } else {
                        that._elements[key] = hook;
                    }
                }
            }
        }

        /**
         * Sets up properties for the Accordion based on the passed options.
         *
         * @private
         * @param {Object} options The Accordion options
         */
        function setupProperties(options) {
            that._properties = {};

            for (var key in properties) {
                if (properties.hasOwnProperty(key)) {
                    var property = properties[key];
                    var value = null;

                    if (options && options[key] != null) {
                        value = options[key];

                        // transform the provided option
                        if (property && typeof property.transform === "function") {
                            value = property.transform(value);
                        }
                    }

                    if (value === null) {
                        // value still null, take the property default
                        value = properties[key]["default"];
                    }

                    that._properties[key] = value;
                }
            }
        }

        /**
         * Binds Accordion event handling.
         *
         * @private
         */
        function bindEvents() {
            var buttons = that._elements["button"];
            if (buttons) {
                for (var i = 0; i < buttons.length; i++) {
                    (function(index) {
                        buttons[i].addEventListener("click", function(event) {
                            toggle(index);
                            focusButton(index);
                        });
                        buttons[i].addEventListener("keydown", function(event) {
                            onButtonKeyDown(event, index);
                        });
                    })(i);
                }
            }
        }

        /**
         * Handles button keydown events.
         *
         * @private
         * @param {Object} event The keydown event
         * @param {Number} index The index of the button triggering the event
         */
        function onButtonKeyDown(event, index) {
            var lastIndex = that._elements["button"].length - 1;

            switch (event.keyCode) {
                case keyCodes.ARROW_LEFT:
                case keyCodes.ARROW_UP:
                    event.preventDefault();
                    if (index > 0) {
                        focusButton(index - 1);
                    }
                    break;
                case keyCodes.ARROW_RIGHT:
                case keyCodes.ARROW_DOWN:
                    event.preventDefault();
                    if (index < lastIndex) {
                        focusButton(index + 1);
                    }
                    break;
                case keyCodes.HOME:
                    event.preventDefault();
                    focusButton(0);
                    break;
                case keyCodes.END:
                    event.preventDefault();
                    focusButton(lastIndex);
                    break;
                case keyCodes.ENTER:
                case keyCodes.SPACE:
                    event.preventDefault();
                    toggle(index);
                    focusButton(index);
                    break;
                default:
                    return;
            }
        }

        /**
         * General handler for toggle of an item.
         *
         * @private
         * @param {Number} index The index of the item to toggle
         */
        function toggle(index) {
            var item = that._elements["item"][index];
            if (item) {
                if (that._properties.singleExpansion) {
                    // ensure only a single item is expanded if single expansion is enabled.
                    for (var i = 0; i < that._elements["item"].length; i++) {
                        if (that._elements["item"][i] !== item) {
                            var expanded = getItemExpanded(that._elements["item"][i]);
                            if (expanded) {
                                setItemExpanded(that._elements["item"][i], false);
                            }
                        }
                    }
                    setItemExpanded(item, true);
                } else {
                    setItemExpanded(item, !getItemExpanded(item));
                }
            }
        }

        function getDataAttribute(dataAttr) {
            var cmpExpanded = dataAttr.item.expanded;
            if ($(window).width() <= breakPointMaxSMP) {
                cmpExpanded = dataAttr.item.expandedSp;
            }
            return cmpExpanded;
        }

        /**
         * Sets an item's expanded state based on the provided flag and refreshes its internals.
         *
         * @private
         * @param {HTMLElement} item The item to mark as expanded, or not expanded
         * @param {Boolean} expanded true to mark the item expanded, false otherwise
         */
        function setItemExpanded(item, expanded) {
            if (expanded) {
                item.setAttribute(getDataAttribute(dataAttributes), "");
            } else {
                item.removeAttribute(getDataAttribute(dataAttributes));
            }
            refreshItem(item);
        }

        /**
         * Gets an item's expanded state.
         *
         * @private
         * @param {HTMLElement} item The item for checking its expanded state
         * @returns {Boolean} true if the item is expanded, false otherwise
         */
        function getItemExpanded(item) {
            return item && item.dataset && item.dataset[getDataAttribute(dataSetAttributes)] !== undefined;
        }

        /**
         * Refreshes an item based on its expanded state.
         *
         * @private
         * @param {HTMLElement} item The item to refresh
         */
        function refreshItem(item) {
            var expanded = getItemExpanded(item);
            if (expanded) {
                expandItem(item);
            } else {
                collapseItem(item);
            }
        }

        /**
         * Refreshes all items based on their expanded state.
         *
         * @private
         */
        function refreshItems() {
            for (var i = 0; i < that._elements["item"].length; i++) {
                refreshItem(that._elements["item"][i]);
            }
        }

        /**
         * Returns all expanded items.
         *
         * @private
         * @returns {HTMLElement[]} The expanded items
         */
        function getExpandedItems() {
            var expandedItems = [];

            for (var i = 0; i < that._elements["item"].length; i++) {
                var item = that._elements["item"][i];
                var expanded = getItemExpanded(item);
                if (expanded) {
                    expandedItems.push(item);
                }
            }

            return expandedItems;
        }

        /**
         * Annotates the item and its internals with
         * the necessary style and accessibility attributes to indicate it is expanded.
         *
         * @private
         * @param {HTMLElement} item The item to annotate as expanded
         */
        function expandItem(item) {
            var index = that._elements["item"].indexOf(item);

            if (index > -1) {
                var button = that._elements["button"][index];
                var panel = that._elements["panel"][index];
                var $panel = $(that._elements["panel"][index]);
                button.classList.add(cssClasses.button.expanded);
                button.setAttribute("aria-expanded", true);
                $panel.slideDown(numSpeed, function() {
                    $panel.addClass(cssClasses.panel.expanded);
                    $panel.removeClass(cssClasses.panel.hidden);
                    $panel.attr("aria-hidden", false);
                });
                if (that._properties.singleExpansion) {
                    button.classList.add(cssClasses.button.disabled);
                    button.setAttribute("aria-disabled", true);
                }
            }
        }

        /**
         * Annotates the item and its internals with
         * the necessary style and accessibility attributes to indicate it is not expanded.
         *
         * @private
         * @param {HTMLElement} item The item to annotate as not expanded
         */
        function collapseItem(item) {
            var index = that._elements["item"].indexOf(item);
            if (index > -1) {
                var button = that._elements["button"][index];
                var panel = that._elements["panel"][index];
                var $panel = $(that._elements["panel"][index]);
                button.classList.remove(cssClasses.button.disabled);
                button.classList.remove(cssClasses.button.expanded);
                button.removeAttribute("aria-disabled");
                button.setAttribute("aria-expanded", false);
                $panel.slideUp(numSpeed, function(){
                    $panel.addClass(cssClasses.panel.hidden);
                    $panel.removeClass(cssClasses.panel.expanded);
                    $panel.attr("aria-hidden", true);
                });
            }
        }

        /**
         * Focuses the button at the provided index.
         *
         * @private
         * @param {Number} index The index of the button to focus
         */
        function focusButton(index) {
            var button = that._elements["button"][index];
            button.focus();
        }
    }

    /**
     * Reads options data from the Accordion wrapper element, defined via {@code data-cmp-*} data attributes.
     *
     * @private
     * @param {HTMLElement} element The Accordion element to read options data from
     * @returns {Object} The options read from the component data attributes
     */
    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    /**
     * Document ready handler and DOM mutation observers. Initializes Accordion components as necessary.
     *
     * @private
     */
    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Accordion({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Accordion({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady());
    }
})(jQuery);

(function ($) {

    function showHideCloseButton($accordionButton) {
        var $closeButton = $accordionButton.nextAll('.cmp-accordion__closebtn');
        if ($closeButton.length > 0) {
            if ($accordionButton.hasClass('cmp-accordion__button--expanded')) {
                $closeButton.show();
            } else {
                $closeButton.hide();
            }
        }
    }

    $('.cmp-accordion__button').on('click', function () {
        showHideCloseButton($(this));
    });

    $('.cmp-accordion__closebtn').on('click', function () {
        var acc_winWid = $(window).innerWidth();
        var acc_winHi = $(window).innerHeight() / 2;
        var acc_parent = $(this).closest('.cmp-accordion__item');
        var acc_parTop = acc_parent.length ? acc_parent.offset().top : 0;
        acc_parent.children('.cmp-accordion__panel').removeClass('cmp-accordion__panel--expanded').addClass('cmp-accordion__panel--hidden').attr('aria-hidden', 'true').slideUp(400);
        acc_parent.children('.cmp-accordion__button').removeClass('cmp-accordion__button--expanded').attr('aria-expanded', 'false');
        $(this).hide();
        if (acc_winWid > 767) {
            acc_parent.removeAttr('data-cmp-expanded');
        } else {
            acc_parent.removeAttr('data-cmp-expanded-sp');
        }
        $('html,body').animate({
            scrollTop: acc_parTop - acc_winHi
        }, 400);
        return false;
    });

    $(function() {
        $('.cmp-accordion__button').each(function () {
            showHideCloseButton($(this));
        });
    });

})(jQuery);
(function($) {
    $(function(){

        $(document)
            .on('click', '.accordion-label a', function(e){
                var $accordion = $(this).parents('.accordionElem'),
                    $accordionContents = $('.accordion-cont', $accordion),
                    $toolTipOpened = $('.toolTip-display', $accordionContents),
                    strClassOpened = 'accordion-opened',
                    numSpeed = 400
                ;
                if ($(window).width() < 768) {
                    strClassOpened = 'accordion-opened-sp';
                }

                if ($accordion.parents('.footerGlobalNav').length) { // for lte IE10
                    var numWindowWidth = window.innerWidth ? window.innerWidth : $(window).width()
                    if (numWindowWidth >= 768) {
                        return true;
                    }
                }

                $accordion.addClass('set');
                if ($accordion.is('.' + strClassOpened)) {
                    $accordion.removeClass(strClassOpened);
                    $accordionContents.slideUp(numSpeed, function(){
                        $accordion.removeClass('set');
                        $accordionContents.removeAttr('style')
                    });
                } else {
                    $accordion.addClass(strClassOpened);
                    $accordionContents.slideDown(numSpeed);
                }
                if ($toolTipOpened.length) {
                    $('.toolTip-closer', $toolTipOpened).trigger('click');
                }
                return false;
            })
        ;

        $(window).on('load', function(){
            $('.accordionElem').each(function(){
                var $accordion = $(this),
                    $contents = $('.accordion-cont', $accordion)
                ;
                var cls = 'accordion-opened';
                if ($(window).width() < 768) {
                    cls = 'accordion-opened-sp';
                }
                if ($accordion.hasClass(cls)) {
                    $accordion.addClass('set');
                    $contents.css('display', 'block');
                }
            });
        });

    // end of jquery
    });
})(jQuery);
(function($) {
    $(function(){
        var footerElem = $('.footerElem');
        if (footerElem && footerElem.length) {
            var adjustPosition = function(){
                    var footerHeight = footerElem.outerHeight(true);
                    if (footerHeight > 0) {
                        $('#maincontArea').css('padding-bottom', footerHeight + 'px');
                    }
                }
            ;

            var minContentsCheck = function(){
                return window.innerHeight > footerElem[0].getBoundingClientRect().bottom + window.pageYOffset;
            }
            var isMinContents = false;
            if (isMinContents = minContentsCheck()) {
                setTimeout(function(){
                    adjustPosition();
                }, 200);
            }

            //#maincontAreaにfooter分の高さを保持
            var timer = false;
            $(window)
                .on('resize', function(){
                    if (isMinContents || (isMinContents = minContentsCheck())) {
                        if (timer !== false) {
                            clearTimeout(timer);
                        }
                        timer = setTimeout(adjustPosition, 400);
                    }
                })
            ;
        }
        // end of jquery
    });
})(jQuery);
(function($) {
    $(function(){
        //scroll top bittpm component
        $('.btn-pageTop').on('click', function(){
            var effect = 'easeOutQuart',
                speed = 500;
            $('body,html').animate({
            scrollTop: 0},speed,effect);
            return false;
        });
    });
})(jQuery);

var modelSelection = {};

(function($) {
    "use strict";

    var EXPIRE_DAY = 30;
    var DEFAULT_VALUE = 'default';
    var SELECT_TYPE_SERIES = 'series';
    var DEFAULT_BRAND_TEXT_SERIES = 'シリーズ名を選択してください';
    var DEFAULT_BRAND_TEXT_SERIES_EN = 'Select a series';
    var DEFAULT_BRAND_TEXT_MAKER = 'メーカー名を選択してください';
    var DEFAULT_BRAND_TEXT_MAKER_EN = 'Select a brand';
    var DEFAULT_MODEL_TEXT = '機種を選択してください';
    var DEFAULT_MODEL_TEXT_EN = 'Select a model';

    function isEnglish() {
        var lang  = $('html').attr('lang');
        if (lang && lang == 'en') {
            return true;
        } else {
            return false;
        }
    }

    function setCookie(productCode) {
        var secure = "";
        if ($(location).attr('protocol') == 'https:') {
            secure = "secure";
        }
        AU_COMMON.setCookie('world-service.productCode', productCode, '/', EXPIRE_DAY, null, secure);
    };

    function clearModelSelection() {
        disableModelSelection();
        disableSubmitButton();

        $('.select-auws-brand').empty();
        $('.select-auws-model').empty();

        $('.list-auws-category li').each(function(index, element){
            if ($(element).hasClass('is-active')) {
                $(element).removeClass('is-active');
            }
        });
    }

    modelSelection.clearModelSelection = clearModelSelection;

    function setDefaultModelSelection() {
        $('.list-auws-category li[data-category-code="iphone"]').addClass('is-active');
        setModelSelectionByCategory('iphone');
    }

    modelSelection.setDefaultModelSelection = setDefaultModelSelection;

    function setModelSelectionByProduct(productCode) {
        var isExist = false;
        $.each(categoryInfos, function(indexCategory, categoryInfo) {
            $.each(categoryInfo.brandInfos, function(indexBrand, brandInfo) {
                $.each(brandInfo.modelInfos, function(indexModel, modelInfo) {
                    if (modelInfo.productCode == productCode.split(' ', 1)) {
                        isExist = true;
                        $('.list-auws-category li[data-category-code="' + categoryInfo.categoryCode + '"]').addClass('is-active');
                        var defaultBrandOption = createDefaultBrandOption(categoryInfo.selectType);
                        var brandOptions = createBrandOptions(categoryInfo.brandInfos);
                        $('.select-auws-brand').append(defaultBrandOption);
                        $('.select-auws-brand').append(brandOptions);
                        $('.select-auws-brand').val(brandInfo.brandCode);
                        var defaultModelOption = createDefaultModelOption();
                        var modelOptions = createModelOptions(brandInfo.modelInfos);
                        $('.select-auws-model').append(defaultModelOption);
                        $('.select-auws-model').append(modelOptions);
                        $('.select-auws-model').val(modelInfo.productCode);
                        if (productCode.match('5gsa')) {
                            $('.select-auws-model').val(modelInfo.productCode + " 5gsa");
                        }
                        enableModelSelection();
                        enableSubmitButton();
                    }
                });
            });
        });

        if (!isExist) {
            setDefaultModelSelection();
        }
    }

    modelSelection.setModelSelectionByProduct = setModelSelectionByProduct;

    function setModelSelectionByCategory(categoryCode) {
        $.each(categoryInfos, function(indexCategory, categoryInfo) {
            if (categoryInfo.categoryCode == categoryCode) {
                var defaultBrandOption = createDefaultBrandOption(categoryInfo.selectType);
                var brandOptions = createBrandOptions(categoryInfo.brandInfos);
                $('.select-auws-brand').append(defaultBrandOption);
                $('.select-auws-brand').append(brandOptions);
                if (brandOptions && brandOptions.length == 1) {
                    $('.select-auws-brand').val($(brandOptions[0]).val());
                } else {
                    $('.select-auws-brand').val($(defaultBrandOption).val());
                }
                var defaultModelOption = createDefaultModelOption();
                $('.select-auws-model').append(defaultModelOption);
                $.each(categoryInfo.brandInfos, function(indexBrand, brandInfo) {
                    var modelOptions = createModelOptions(brandInfo.modelInfos);
                    $('.select-auws-model').append(modelOptions);
                });
                if ($('.select-auws-model option') && $('.select-auws-model option').length == 2) {
                    $('.select-auws-model').val($('.select-auws-model option').eq(1).val());
                    enableSubmitButton();
                } else {
                    $('.select-auws-model').val($(defaultModelOption).val());
                }
            }
        });
        enableModelSelection();
    }

    function createDefaultBrandOption(selectType) {
        var brandOption = $('<option></option>');
        brandOption.val(DEFAULT_VALUE);

        if (SELECT_TYPE_SERIES == selectType) {
            if (!isEnglish()) {
                brandOption.text(DEFAULT_BRAND_TEXT_SERIES);
            } else {
                brandOption.text(DEFAULT_BRAND_TEXT_SERIES_EN);
            }
        } else {
            if (!isEnglish()) {
                brandOption.text(DEFAULT_BRAND_TEXT_MAKER);
            } else {
                brandOption.text(DEFAULT_BRAND_TEXT_MAKER_EN);
            }
        }

        return brandOption[0];
    }

    function createBrandOptions(brandInfos) {
        if (!brandInfos) {
            return null;
        }
        var brandOptions = [];
        $.each(brandInfos, function(indexBrand, brandInfo) {
            brandOptions.push(createBrandOption(brandInfo));
        });
        return brandOptions;
    }

    function createBrandOption(brandInfo) {
        if (!brandInfo) {
            return null;
        }
        var brandOption = $('<option></option>');
        brandOption.val(brandInfo.brandCode);
        brandOption.text(brandInfo.brandName);
        return brandOption[0];
    }

    function createDefaultModelOption() {
        var brandOption = $('<option></option>');
        brandOption.val(DEFAULT_VALUE);

        if (!isEnglish()) {
            brandOption.text(DEFAULT_MODEL_TEXT);
        } else {
            brandOption.text(DEFAULT_MODEL_TEXT_EN);
        }

        return brandOption[0];
    }

    function createModelOptions(modelInfos) {
        if (!modelInfos) {
            return null;
        }
        var modelOptions = [];
        $.each(modelInfos, function(indexModel, modelInfo) {
            if (modelInfo.is5gNsa || (!modelInfo.is5gNsa && !modelInfo.is5gSa)) {
                modelOptions.push(createModelOption(modelInfo));
            }
            if (modelInfo.is5gSa) {
                modelOptions.push(createModelOption5gSa(modelInfo));
            }
        });
        return modelOptions;
    }

    function createModelOption(modelInfo) {
        if (!modelInfo) {
            return null;
        }
        var modelOption = $('<option></option>');
        modelOption.val(modelInfo.productCode);
        modelOption.text(modelInfo.modelName);
        return modelOption[0];
    }

    function createModelOption5gSa(modelInfo) {
        if (!modelInfo) {
            return null;
        }
        const modelOption = $('<option></option>');
        modelOption.val(modelInfo.productCode + " 5gsa");
        modelOption.text(modelInfo.modelName + " (5G SA)");
        return modelOption[0];
    }

    function enableModelSelection() {
        $('.list-auws-category li a').each(function() {
            $(this).removeAttr('disabled');
        });
        $('.select-auws-brand').removeAttr('disabled');
        $('.select-auws-model').removeAttr('disabled');
    }

    function disableModelSelection() {
        $('.list-auws-category li a').each(function() {
            $(this).attr('disabled', '');
        });
        $('.select-auws-brand').attr('disabled', '');
        $('.select-auws-model').attr('disabled', '');
    }

    function enableSubmitButton() {
        $('.button-auws-submit').removeAttr('disabled');
        $('.button-auws-submit').removeClass('is-disabled');
    }

    function disableSubmitButton() {
        $('.button-auws-submit').attr('disabled', '');
        $('.button-auws-submit').addClass('is-disabled');
    }

    $(function(){
        $('.list-auws-category li a').on('click', function() {
            if (!$(this).attr('disabled')) {
                clearModelSelection();
                $(this).parent().addClass('is-active');

                setModelSelectionByCategory($(this).parent().data('category-code'));
            }
        });

        $('.select-auws-brand').on('change', function() {
            $('.select-auws-model').empty();
            disableSubmitButton();

            var categoryCode = $('.list-auws-category li.is-active').data('category-code');
            var brandCode = $(this).val();
            var defaultModelOption = createDefaultModelOption();
            $('.select-auws-model').append(defaultModelOption);
            $.each(categoryInfos, function(indexCategory, categoryInfo) {
                if (categoryInfo.categoryCode == categoryCode) {
                    $.each(categoryInfo.brandInfos, function(indexBrand, brandInfo) {
                        if (brandCode == DEFAULT_VALUE || brandInfo.brandCode == brandCode) {
                            var modelOptions = createModelOptions(brandInfo.modelInfos);
                            $('.select-auws-model').append(modelOptions);
                        }
                    });
                    if ($('.select-auws-model option') && $('.select-auws-model option').length == 2) {
                        $('.select-auws-model').val($('.select-auws-model option').eq(1).val());
                        enableSubmitButton();
                    } else {
                        $('.select-auws-model').val($(defaultModelOption).val());
                    }
                }
            });
        });

        $('.select-auws-model').on('change', function() {
            var productCode = $(this).val();
            if (!productCode || productCode == DEFAULT_VALUE) {
                disableSubmitButton();
            } else {
                enableSubmitButton();
            }
        });

        $('.button-auws-submit').on('click', function() {
            var productCode = $('.select-auws-model').val();
            if (productCode && productCode != DEFAULT_VALUE) {
                const modelName = $('.select-auws-model option[value="' + productCode + '"]').text();
                if (modelName && modelName != DEFAULT_VALUE) {
                    setCookie(productCode);
                    location.href = location.href;
                }
            }
            return false;
        });

        if ($('.model-selection').length && !$('.auws-loginArea').length) {
            var productCode = AU_COMMON.getCookie('world-service.productCode');
            if (productCode) {
                setModelSelectionByProduct(productCode);
            } else {
                setDefaultModelSelection();
            }
        }

    });
})(jQuery);

/* auwsViewCountry.js */

(function($) {
    "use strict";

    var BID_PARAM_NAME ="aa_bid=";
    var BID_ISSUEID_WE ="we";
    var BID_GROUPID_WE ="we";
    var BID_GROUPID_AWS ="aws";
    var BID_AREA_AC = "ac";
    var BID_AREA_AC_EN = "eac";
    var DEFAULT_VALUE = 'default';


    // ---------------------
    // ページ言語取得
    // ---------------------
    var bidLang = $("html").attr("lang");
    var localeBidAreaAc = (bidLang === "en") ? BID_AREA_AC_EN : BID_AREA_AC;
    // ---------------------
    // bid計測
    // ---------------------

    // データチャージ登録
    var bidParamDtChargeURL = $("#dataChargeURL").attr("href");
    if (bidParamDtChargeURL) {
        bidParamDtChargeURL = getBidParam(bidParamDtChargeURL, BID_ISSUEID_WE + "-" + BID_GROUPID_WE + "-" + localeBidAreaAc, "0002");
        // データチャージ href設定
        $("#dataChargeURL").attr("href", bidParamDtChargeURL);
    }

    // auStar会員登録
    var bidParamAuStarURL = $("#auStarURL").attr("href");
    if (bidParamAuStarURL) {
        bidParamAuStarURL = getBidParam(bidParamAuStarURL, BID_ISSUEID_WE + "-" + BID_GROUPID_WE + "-" + localeBidAreaAc, "0003");
        // auStar href設定
        $("#auStarURL").attr("href", bidParamAuStarURL);
    }

    // bid計測パラメータ設定
    function getBidParam(url, bidKey, bidSeq) {
        var paraStr = (url.indexOf("?") != -1) ? "&" : "?";
        return url + paraStr + BID_PARAM_NAME + bidKey + $("#hiddenSelector1st").val() + "." + $("#hiddenSelector2nd").val() + "-" + bidSeq;
    }


    // ---------------------
    // click計測
    // ---------------------

    // 契約情報を使う（ログイン済）ボタンクリック
    $('.button-auws-contract--clickCount').on('click', function() {
        executeClickCount(BID_ISSUEID_WE + "-" + BID_GROUPID_AWS + "-" + localeBidAreaAc, "0001");
    });

    // 契約情報を取得（ログイン）ボタンクリック
    $('.modal-openBtn--clickCount').on('click', function() {
        executeClickCount(BID_ISSUEID_WE + "-" + BID_GROUPID_AWS + "-" + localeBidAreaAc, "0002");
    });

    // この機種情報で調べるボタンクリック
    $('.button-auws-submit--clickCount').on('click', function() {
        var productCode = $('.select-auws-model').val();
        if (productCode && productCode != DEFAULT_VALUE) {
            var modelName = $('.select-auws-model option[value="' + productCode + '"]').text();
            if (modelName && modelName != DEFAULT_VALUE) {
                if ($('.awwsViewCountry-model-select').length) {
                    executeClickCount(BID_ISSUEID_WE + "-" + BID_GROUPID_AWS + "-" + localeBidAreaAc, "0003");
                }
            }
        }
    });

    // ログインリンククリック（ご契約内容にもとづいた正確な・・・）
    $(function() {
        $('.link-login--exact-price a').on('click', function() {
          // クリック計測
          executeClickCount(BID_ISSUEID_WE + "-" + BID_GROUPID_AWS + "-" + localeBidAreaAc, "0004");
        });
      });

    // 印刷するボタンクリック
    $(function() {
        $('.link-btn-print--pc--clickCount a').on('click', function() {
          // クリック計測
          executeClickCount(BID_ISSUEID_WE + "-" + BID_GROUPID_AWS + "-" + localeBidAreaAc, "0005");
        });
      });

    function executeClickCount(clkKey, clkSeq) {
        if ((clkKey) && (clkSeq)) {
            var clkParam = clkKey + $("#hiddenSelector1st").val() + "." + $("#hiddenSelector2nd").val() + "-"+ clkSeq;
            if (typeof clickCount == "function") {
                clickCount(clkParam);
            }
        }
    }


})(jQuery);
(function($) {

  $(function() {
    $('.grid-data-contact-info a').on('click', function() {
      var $win = window.innerWidth ? window.innerWidth: $(window).width();
      if ($win >= 980) {
        return false;
      }
    });
  });

  $(function() {

    var trigger = $('.js-tooltip');

    $(trigger).on('click', function() {

      if ($(this).hasClass('is-active')) {
        //return false;
      } else if ($(trigger).hasClass('is-active')) {
        $(trigger).removeClass('is-active').find('.tooltipContent').fadeOut(300);
        $(this).addClass('is-active').find('.tooltipContent').fadeIn(300);
      } else {
        $(this).addClass('is-active').find('.tooltipContent').fadeIn(300);
      }

      $(this).find('a').on('click', function() {
        var thisHref = $(this).attr('href');
        location.href = thisHref;
      });

      $('.js-tooltip-close').on('click', function() {
        $(trigger).removeClass('is-active').find('.tooltipContent').fadeOut(300);
        return false;
      });

      $('body').on('click', function() {
        $(trigger).removeClass('is-active').find('.tooltipContent').fadeOut(300);
        //return false;
      });

      return false;
    });
  });


})(jQuery);

(function($) {
    'use strict';
    $(function() {
        $('.auwsDeviceInfo').each(function() {

            const $targetElm = $(this);
            const COOKIE_NAME_MODELNAME = 'modelName';
            const COOKIE_NAME_PRODUCTCODE = 'world-service.productCode';

            // コンポーネントのデバイスリソースパスを取得
            const resourcePath = $targetElm.children('div').attr('data-resourcepath');
            // Cookie製品コードを取得
            let productCode = AU_COMMON.getCookie(COOKIE_NAME_PRODUCTCODE);
            let _5gsaFlg = '0';
            if (productCode.match('5gsa')) {
                productCode = productCode.split(' ', 1);
                _5gsaFlg = '1';
            }
            if (productCode && productCode !== 'null') {

                if ((CommonUtil.isPublish() || CommonUtil.isAuthorPreview) && resourcePath) {
                    // デバイス情報表示
                    setDeviceInfo($targetElm, resourcePath, productCode, _5gsaFlg);
                }

            }

        });
    });

    function setDeviceInfo($targetElm, resourcePath, productCode, _5gsaFlg) {
        let postfix = "";
        if (CommonUtil.isAuthorPreview()) {
            postfix = '.html?wcmmode=disabled';
        } else {
            resourcePath = resourcePath.replace('/content/au-com', '');
            postfix = '/';
        }
        const url = resourcePath + "." + productCode + "." + _5gsaFlg +  postfix;
        $.ajax({
            type: "GET",
            url: url,
            cache: false,
        }).done(function(html) {
            $targetElm.html(html);
        });
    }

})(jQuery);

/* keyword.js */

/* MapCls.js */
(function ($) {
    "use strict";

    if (window.MapCls) {
        return; // 2重初期化防止
    }

    /** 
     * 地図クラス
     */
    window.MapCls = (function () {

        /**
         * コンストラクタ
         */
        var MapCls = function () {
            if (!(this instanceof MapCls)) {
                return new MapCls();
            }

            // Maplibre の Mapオブジェクト
            this.map = null;

            // 店舗アイコンの集合
            this.shops = new ShopCollectionCls();
            
            // 縮尺のデフォルト値
            this.scale = 14;
            if ($('#scale').val()) {
                this.scale = Number($('#scale').val());
            }
            
            // 検索パラメーター
            this.search = {};
            
            // 検索キーワード(表示用)
            this.dispKeyword = '';
            
            // 詳細ページパス
            this.detailPagePath = $('#detailPagePath').val();
            
            // 検索タイプ
            this.searchType = $('#searchType').val();
            
            // メンテナンスページパス
            this.maintenancePageUrl = $('#maintenancePageUrl').val();
        };

        // 定数
        MapCls.MAP_ID = 'map';
        MapCls.SEARCH_MODE_KEYWORD = 'kwd';
        MapCls.SEARCH_MODE_COORDINATES = 'coords';
        MapCls.SEARCH_MODE_SHOP = 'shop';
        MapCls.STYLE_JSON = '/etc.clientlibs/settings/wcm/designs/vendor/maplibre/resources/json/style.json';
        MapCls.FIRST_DELAY_TIME = 1000;
        MapCls.MIN_ZOOM = 5;
        MapCls.MAX_ZOOM = 18
        
        // メソッド定義
        var p = MapCls.prototype;

        /**
         * 地図を初期化
         */
        p.init = function () {

            window.loading.start();
            
            // 適当な座標で地図を初期化
            var mapObj = this;

            var pos = {};
            pos.coords = {};
            pos.coords.latitude = '35.692375';
            pos.coords.longitude = '139.701949';
            if ($('#latitude').val() && $('#longitude').val()) {
                pos.coords.latitude = $('#latitude').val();
                pos.coords.longitude = $('#longitude').val();
            }
            
            var data = pos.coords ;
            var lat = data.latitude ;
            var lng = data.longitude ;
            
            // 地図オブジェクトを初期化
            const map = new maplibregl.Map({
                container: MapCls.MAP_ID,
                style: MapCls.STYLE_JSON,
                center: [lng, lat],
                zoom: this.scale,
                minZoom: MapCls.MIN_ZOOM,
                maxZoom: MapCls.MAX_ZOOM,
                scrollZoom: false,
                transformRequest: function(url, resourceType) {
                    if (resourceType === 'Tile') {
                        return {
                            headers: {
                                'Accept': 'application/x-protobuf'
                            },
                            url: url
                        };
                    } else {
                        return {url: url};
                    }
                }
            });
            map.addControl(new maplibregl.NavigationControl());
            map.on('load', function() {
                mapObj.initMap(pos);

                this.on('moveend', function(event) {
                    // console.log("moveend");
                    if (!event.isAuto) {
                        mapObj.eventHandler(false); 
                    }
                });
            });

            mapObj.map = map;
        };
        
        /**
         * モードに応じて地図を初期化
         */
        p.initMap = function(pos) {
            var promise = new Promise(function (resolve, reject) {

                if (mapObj.search.mode == MapCls.SEARCH_MODE_COORDINATES
                        && mapObj.search.lat && mapObj.search.lng) {
                    
                    // 座標指定検索の場合
                    pos.coords.latitude = mapObj.search.lat;
                    pos.coords.longitude = mapObj.search.lng;
                    mapObj.dispKeyword = $('#specifiedLocation').val();
                    resolve();
                } else if (mapObj.search.mode == MapCls.SEARCH_MODE_SHOP
                            && mapObj.search.shopId) {
                    
                    // ショップ指定検索の場合
                    $.ajax({
                        type: "GET",
                        url: "/bin/wcm/au-com/storelocator.json",
                        data: {
                            shopId: mapObj.search.shopId,
                            detailPagePath: mapObj.detailPagePath,
                            locale: $('html').attr('lang'),
                            _charset_: "UTF-8"
                        },
                        success: function (shopData) {
                            
                            pos.coords.latitude = Number(shopData.latitude);
                            pos.coords.longitude = Number(shopData.longitude);
                            mapObj.search.dispKeyword = shopData.storeNameDisp;
                            resolve();
                        },
                        error: function (XMLHttpRequest) {
                            // 初期化
                            mapObj.removeObj();
                            
                            var json = JSON.parse(XMLHttpRequest.responseText);
                            if (json.errorKind == 'serverError') {
                                location.href = mapObj.maintenancePageUrl;
                            } else {
                                // エラーメッセージ表示
                                $('.search-result-unknown-error-message').css('display', 'block');
                            }
                            window.loading.stop();
                        }
                    });
                } else if (mapObj.search.mode == MapCls.SEARCH_MODE_KEYWORD
                            && mapObj.search.keyword) {
                    resolve();
                } else {
                    
                    var optionObj = {
                        "enableHighAccuracy": true,
                        "timeout": 8000,
                        "maximumAge": 5000,
                    };
                    
                    // GPSを取得
                    navigator.geolocation.getCurrentPosition(
                        function (position) {
                            pos = position;
                            mapObj.dispKeyword = $('#yourLocation').val();
                            resolve();
                        }
                        , function () {
                            mapObj.eventHandler(true);
                        }
                        , optionObj
                    );

                    mapObj.eventHandler(true);
                }
            });
            
            promise.then(function () {
                
                // 取得した座標で地図を再表示
                var data = pos.coords ;
                var lat = data.latitude ;
                var lng = data.longitude ;
                mapObj.map.easeTo({
                    center: [lng, lat],
                    zoom: mapObj.scale,
                    animate: false
                }, {
                    isAuto: true
                });

                mapObj.eventHandler(true);
            });
        }
        
        /**
         * 店舗情報を取得し、地図・一覧へ描画
         */
        p.dispShopInfo = function (doFit) {
    
            // 編集時は検索を行わない。
            if (AU_COMMON.getCookie("wcmmode") == "edit"
                && AU_COMMON.getParameter(document.location.href, 'wcmmode') != 'disabled') {
                
                window.loading.stop();
                return;
            }
            
            // 店舗のピンを表示
            $.ajax({
                type: "GET",
                url: "/bin/wcm/au-com/storelocator.json",
                data: {
                    keyword: this.search.keyword,
                    northWestLat: this.map.getBounds().getNorthWest().lat,
                    northWestLng: this.map.getBounds().getNorthWest().lng,
                    northEastLat: this.map.getBounds().getNorthEast().lat,
                    northEastLng: this.map.getBounds().getNorthEast().lng,
                    southWestLat: this.map.getBounds().getSouthWest().lat,
                    southWestLng: this.map.getBounds().getSouthWest().lng,
                    southEastLat: this.map.getBounds().getSouthEast().lat,
                    southEastLng: this.map.getBounds().getSouthEast().lng,
                    detailPagePath: this.detailPagePath,
                    searchType: this.searchType,
                    locale: $('html').attr('lang'),
                    _charset_: "UTF-8"
                },
                success: function (shopData) {
                    
                    // 初期化
                    mapObj.removeObj();
                    
                    var maxCount = Number($("#maxCount").val());
                    var shopCount = shopData.length;
                    var maxOver = (maxCount < shopCount);
                    
                    // メッセージ表示
                    mapObj.dispMessage(shopCount, maxOver);
                    
                    // 最大値を超えている場合は描画しない
                    if (maxOver) {
                        window.loading.stop();
                        return;
                    }
                    
                    mapObj.shops = new ShopCollectionCls(); // 初期化
                    $.each(shopData, function (idx, shop) {
                        var shopObj = new ShopCls(shop);
                        mapObj.shops.add(shopObj);
                    });
                    
                    // 地図サイズを調整
                    if (doFit) {
                        mapObj.fit();
                    }
                    
                    // 一覧を表示
                    mapObj.shops.dispResultList(true);
                    
                    // フィルタリング
                    mapObj.shops.filter('serviceFilter');
                    
                    window.loading.stop();
                },
                error: function (XMLHttpRequest) {
                    // 初期化
                    mapObj.removeObj();
                    
                    // 検索キーワードがあれば、表示用に詰め替える。
                    mapObj.setDispKeyword();
                    
                    var json = JSON.parse(XMLHttpRequest.responseText);
                    
                    if (json.errorKind == 'invalid') {
                        // エラーメッセージ表示
                        $('.search-result-invalid-keyword-message').css('display', 'block');
                    } else if (json.errorKind == 'serverError') {
                        location.href = mapObj.maintenancePageUrl;
                    } else {
                        // エラーメッセージ表示
                        $('.search-result-unknown-error-message').css('display', 'block');
                    }
                    
                    window.loading.stop();
                }
            });
        };
        
        /**
         * ピン、一覧、メッセージを初期化
         */
        p.removeObj = function () {
            
            // メッセージを初期化
            this.initMessage();

            // ピンを削除
            this.shops.clear();
            
            // 一覧を初期化
            this.shops.removeResultList();
            
        };
        
        /**
         * 表示されている店舗に合わせて地図のサイズを調整
         */
        p.fit = function () {
            
            var coordinates = [];
            $.each(this.shops.shops, function (idx, shop) {
                var lngLat = shop.icon.getLngLat();
                coordinates.push(lngLat);
            });

            if (coordinates.length > 0) {
                var bounds = coordinates.reduce(function (bounds, coord) {
                    return bounds.extend(coord);
                }, new maplibregl.LngLatBounds(coordinates[0], coordinates[0]));

                let maxScale = Number($('#maxScale').val());
                maxScale = maxScale >= MapCls.MIN_ZOOM && maxScale <= MapCls.MAX_ZOOM ? maxScale : MapCls.MAX_ZOOM;

                const camera = this.map.cameraForBounds(bounds, {
                    padding: {
                        top: 88,
                        bottom:20,
                        left: 20,
                        right: 20
                    },
                    maxZoom: maxScale
                });

                camera.zoom = camera.zoom - 1 >= MapCls.MIN_ZOOM ? camera.zoom - 1 : MapCls.MIN_ZOOM;

                mapObj.map.easeTo({
                    center: camera.center,
                    zoom: camera.zoom,
                    animate: false
                }, {
                    isAuto: true
                });
            }
        };
        
        /**
         * メッセージを初期化
         */
        p.initMessage = function () {
            $('.search-result-message').css('display', 'none');
            $('.search-result-empty-message').css('display', 'none');
            $('.search-result-too-many-message').css('display', 'none');
            $('.search-result-invalid-keyword-message').css('display', 'none');
            $('.search-result-unknown-error-message').css('display', 'none');
        }
        
        /**
         * メッセージ表示
         */
        p.dispMessage = function (shopCount, maxOver) {
            
            // メッセージ初期化
            this.initMessage();
            
            // 検索キーワードがあれば、表示用に詰め替える。
            this.setDispKeyword();
            
            if (maxOver) {
                $(".search-result-too-many-message").css('display', 'block');
            } else if (shopCount > 0) {
                if (this.dispKeyword) {
                    $('.search-result-message .search-word').text(this.dispKeyword);
                    $('.search-result-message .search-count').text(shopCount);
                    $('.search-result-message').css('display', 'block');
                }
            } else {
                if (this.dispKeyword) {
                    $('.search-result-empty-message .search-word').text(this.dispKeyword);
                    $('.search-result-empty-message').css('display', 'block');
                }
            }
        };
        
        /**
         * 検索キーワードがあれば、表示用に詰め替える。
         */
        p.setDispKeyword = function () {
            var keyword = this.search.dispKeyword || this.search.keyword;
            this.search.keyword = '';
            this.search.dispKeyword = '';
            if (keyword) {
                this.dispKeyword = $("#keywordPrefix").val() + keyword + $("#keywordPostfix").val();
            }
        }
        
        /**
         * 地図を拡大・縮小・移動した際のイベント処理.
         */
        var timerId = null;
        p.eventHandler = function (isFirst) {
            if (timerId) {
                clearTimeout(timerId);
                //console.log("cancel !");
            }
            var promise = new Promise(function (resolve, reject) {
                //console.log("wait...");
                timerId = setTimeout(function () {
                    //console.log("wait finished !");
                    resolve();
                    timerId = null;
                }, isFirst ? MapCls.FIRST_DELAY_TIME : Number($('#delayTime').val()));
            });

            promise.then(function () {
                if (!isFirst) {
                    mapObj.dispKeyword = $('#displayRange').val();
                }
                mapObj.dispShopInfo(isFirst);
            });
        };

        return MapCls;

    })();
})(jQuery);
/* ShopCollectionCls.js */
(function ($) {
    "use strict";

    if (window.ShopCollectionCls) {
        return; // 2重初期化防止
    }

    /** 
     * 店舗アイコンの集合クラス
     */
    window.ShopCollectionCls = (function () {

        /**
         * コンストラクタ
         */
        var ShopCollectionCls = function () {
            if(!(this instanceof ShopCollectionCls)) {
                return new ShopCollectionCls();
            }
            this.shops = [];
            this.count = Number($('#count').val());
            this.total = 0;
        };

        // メソッド定義
        var p = ShopCollectionCls.prototype;

        // 店舗情報追加
        p.add = function (shop) {
            this.shops.push(shop);
        };
        
        /**
         * 店舗アイコンを削除
         */
        p.clear = function () {
            $.each(this.shops, function (i, shop) {
                shop.remove();
            });
        };
        
        /**
         * 一覧を削除
         */
        p.removeResultList = function () {
            $('div.cmp-au-com-store-search__resultlist div').remove();
        };

        /**
         * 一覧表示
         * 
         * @param isReset
         */ 
        p.dispResultList = function (isReset) {

            // 画面初期化
            this.removeResultList();

            var displayedCnt = 0; // 表示される件数

            if (isReset) {
                mapObj.shops.total = 0; // 一覧表示件数を初期化
                $('.list-area .moreBtn').css('display', 'inline-block'); // 「もっと見る」 ボタンを再表示
            }

            // 一覧表示件数に1回当たりの表示件数を加算
            mapObj.shops.total += mapObj.shops.count;

            var isEnd = true;
            $.each(this.shops, function (i, shop) {
                if (shop.isMatch) {
                    var template = $('.rowTemplate').html();
                    var content = template;
                    var matches = template.match(/\$.*?\$/g);
                    $.each(matches, function (i, match) {
                        var key = match.replace(/\$/g, '');
                        content = contentReplace(content, key, key, shop.jsonObj);
                    });

                    var $content = $(content);

                    // NPSスコアに関する処理
                    process4NpsScore($content);

                    // お知らせ用の処理
                    process4Notification($content)

                    // 来店予約ボタンに関する処理
                    process4VisitReserveBtn($content);

                    $content.appendTo('div.cmp-au-com-store-search__resultlist');
                    displayedCnt++;
                }

                // 一覧表示件数に到達した場合は処理終了
                if (displayedCnt == mapObj.shops.total) {
                    // 未表示のものが残っている場合
                    if (displayedCnt != mapObj.shops.shops.length) {
                        isEnd = false;
                    }
                    return false;
                }
            });

            // カードの高さを揃える
            $('.cmp-au-com-store-search__resultlist  .cmp-au-com-card .cmp-au-com-card__display').matchHeight({
                byRow:true
            });

            // 全て走査していれば 「もっと見る」 ボタンを消す
            if (isEnd) {
                $('.list-area .moreBtn').css('display', 'none');
            }
        }

        /**
         * 
         * HTMLの置換処理.
         * 
         * @param {*} content テンプレートのHTML
         * @param {*} replaceKey 置換するキー(HTML側に書かれているもの)
         * @param {*} key キー
         * @param {*} obj データオブジェクト
         * @returns 
         */
        function contentReplace (content, replaceKey, key, obj) {

            var tmpKey = key;
            var tmpObj = obj;

            if (tmpKey.indexOf('.') > 0) {
                var keys = tmpKey.split(".");
                for (var i = 0; i < keys.length ; i++) {
                    tmpKey = keys[i];
                    if (i == keys.length - 1) {
                        break;
                    }
                    tmpObj = tmpObj[tmpKey];
                }
            }

            return tmpObj ? content.replace(new RegExp('\\$' + replaceKey + '\\$', 'g'), tmpObj[tmpKey]) : content;
        }

        /**
         * NPSスコアのための処理.
         */
        function process4NpsScore ($content) {
            var storeClassification = $content.data("storeClassification");
            var npsScoreCls = $content.data("npsScoreCls");

            var $npsStarElem = $content.find(".cmp-au-com-store-search__npsstar");

            if (storeClassification !== 4 && storeClassification !== 9) {
                if (npsScoreCls === 1) {
                    $npsStarElem.css("display", "block");
                }
            }
        }

        /**
         * 「お知らせ」のための処理.
         */
        function process4Notification ($content) {
            if ($content.find(".cmp-au-com-store-search__notification").text()) {
                var html =  $content.find(".cmp-au-com-store-search__notification").html();
                if (html.length > 100) {
                    var result = "";
                    var cnt = 0;
                    var isOverflow = false;
                    for (var i = 0 ; i < html.length ; i++) {
                        if (cnt >= 100) {
                            isOverflow = true;
                            break;
                        }
                        var tmp = html.substring(i, i + 4);
                        if (tmp === "<br>") {
                            i = i + 3;
                            result = result + "<br>"; 
                            continue;
                        }
                        result = result + html[i];
                        cnt++;
                    }
                            
                    if (isOverflow) {
                        result = result + "...";
                        $content.find(".cmp-au-com-store-search__notificationlink").css("display", "block");
                    }
                    $content.find(".cmp-au-com-store-search__notification").html(result);
                }
            } else {
                $content.find(".cmp-au-com-store-search__notification").text("現在ありません。");
            }
        }
        
        /**
         * 来店予約ボタンに関する処理
         */
        function process4VisitReserveBtn($content) {
            const storeClassification = $content.data("storeClassification");
            const visitReserveFlg = $content.data("visitReserveFlg");

            const $footerElem = $content.find(".cmp-au-com-store-search__footer");
            const $visitReserveElem = $footerElem.find(".cmp-au-com-store-search__section-visit-reserve");

            if (storeClassification === 4) {
                if (visitReserveFlg === 0) {
                    $footerElem.attr("data-visit-reserve-btn", "0");
                    $visitReserveElem.attr("data-visit-reserve-btn", "0");
                }
            }
        }

        /**
         * サービス選択での絞り込み
         */
        p.filter = function (name) {
            var $services = $('[name=' + name + ']:checked');
            $.each(this.shops, function (i, shop) {
                var isMatch = true;
                $.each($services, function (j, service) {
                    var shopServices = shop.jsonObj.services;
                    if (!shopServices[$(service).val()]) {
                        shop.setIcon(ShopCls.ICON_DEACTIVE);
                        isMatch = false;
                        return false;
                    }
                });
                if (isMatch) {
                    shop.setIcon(shop.getActiveIcon());
                }
                shop.isMatch = isMatch;
            });

            // メッセージ表示
            mapObj.dispMessage(this.getCount(), false);

            // 一覧を表示
            this.dispResultList(true);
        };

        /**
         * 件数の取得
         */
        p.getCount = function () {
            var count = 0;
            $.each(this.shops, function (i, shop) {
                if (shop.isMatch) {
                    count++;
                }
            });
            return count;
        };
        return ShopCollectionCls;
    })();
})(jQuery);
/* ShopCls.js */
(function ($) {
    "use strict";
    
    if (window.ShopCls) {
        return; // 2重初期化防止
    }
    
    /** 
     * 店舗情報クラス
     */
    window.ShopCls = (function () {
    
        /**
         * コンストラクタ
         */
        var ShopCls = function (jsonObj) {
            if(!(this instanceof ShopCls)) {
                return new ShopCls(jsonObj);
            }
            this.jsonObj = jsonObj;

            this.isMatch = true;
            var icon = this.getActiveIcon();
            if (!this.isMatch) {
                icon = ShopCls.ICON_DEACTIVE;
            }

            const shopIcon = this.createIcon(icon);
            const shopTooltip = this.createTooltip();

            shopIcon.setPopup(shopTooltip);
            shopIcon.addTo(mapObj.map);

            this.tooltip = shopTooltip;
            this.icon = shopIcon;
        };
    
        // 定数
        ShopCls.ICON_NPS_STAR_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_nps_star.png';
        ShopCls.ICON_NPS_NORMAL_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_nps_normal.png';
        ShopCls.ICON_PIPIT_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_pipit.png';
        ShopCls.ICON_DEACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin-grey.png';
        ShopCls.POPUP_OFFSET_BOTTOM = [0, -78];
        ShopCls.CENTERING_OFFSET = [0, 100];

        // メソッド定義
        var p = ShopCls.prototype;
        
        p.getActiveIcon = function () {
            var activeIcon = ShopCls.ICON_NPS_NORMAL_ACTIVE;
            if (this.jsonObj.storeClassification === '4' || this.jsonObj.storeClassification === '9') {
                activeIcon = ShopCls.ICON_PIPIT_ACTIVE;
            } else {
                if (this.jsonObj.npsScoreCls === '1') {
                    activeIcon = ShopCls.ICON_NPS_STAR_ACTIVE;
                }
            }
            return activeIcon;
        }

        /**
         * アイコンを生成する.
         * @param {String} icon 
         * @returns {maplibregl.Marker} アイコン
         */
        p.createIcon = function (icon) {
            const markerElem = jQuery('<div></div>');
            markerElem.addClass('map__shop-icon');
            markerElem.css('background-image', 'url("' + icon + '")');

            const marker = new maplibregl.Marker({
                element: markerElem.get(0),
                anchor: 'bottom'
            }).setLngLat([Number(this.jsonObj.longitude), Number(this.jsonObj.latitude)]);

            return marker;
        };
        
        /**
         * ツールチップを生成する.
         * @returns {maplibregl.Popup} ツールチップ
         */
        p.createTooltip = function () {

            var address = this.jsonObj.address1 + ' ' + this.jsonObj.address2 + ' ' + this.jsonObj.address3;

            var template = $('#popup').html();
            var content = template.replace(/titleTemplate/g, this.jsonObj.storeNameDisp);
            content = content.replace(/bodyTemplate/g, address);
            content = content.replace(/linkTemplate/g, this.jsonObj.url);

            const popup = new maplibregl.Popup({
                anchor: 'bottom',
                offset: {
                    'bottom': ShopCls.POPUP_OFFSET_BOTTOM
                },
                maxWidth: 'none',
                className: 'fukidashi',
            }).setHTML(content);

            var shopObj = this;
            popup.on('open', function() {
                shopObj.centering();
            });

            return popup;
        };

        /**
         * 中央に配置されるよう地図を動かし、ポップアップを表示する.
         */
        p.centering = function () {
            const lngLat = this.icon.getLngLat();
            mapObj.map.panTo(lngLat, {
                offset: ShopCls.CENTERING_OFFSET
            }, {
                isAuto: true
            });
        };
        
        /**
         * 地図から削除
         */
        p.remove = function () {
            this.tooltip.remove();
            this.icon.remove();
        };

        /**
         * アイコンを設定する.
         * @param {String} icon 
         */
        p.setIcon = function (icon) {
            this.remove();

            const shopIcon = this.createIcon(icon);
            const shopTooltip = this.createTooltip();

            shopIcon.setPopup(shopTooltip);
            shopIcon.addTo(mapObj.map);

            this.tooltip = shopTooltip;
            this.icon = shopIcon;
        }
        
        return ShopCls;
    })();
    
})(jQuery);
/* store-search.js */
(function ($) {

    if (window.storeSearchAPI) {
        return; // 2重初期化防止
    }

    /* 公開APIの箱 */
    window.storeSearchAPI = {};

    /**
     * 初期化処理.
     */
    var init = function () {

        var mapObj = new MapCls();

        // 検索パラメータを取得
        var mode = AU_COMMON.getParameter(document.location.href, "mode");
        mapObj.search.mode = mode;
        if (mode == MapCls.SEARCH_MODE_KEYWORD) {
            var keyword = AU_COMMON.getParameter(document.location.href, "search");
            mapObj.search.keyword = keyword.split('+').join(' ');
        } else if (mode == MapCls.SEARCH_MODE_COORDINATES) {
            var lat = AU_COMMON.getParameter(document.location.href, "lat");
            var lng = AU_COMMON.getParameter(document.location.href, "lng");
            mapObj.search.lat = lat;
            mapObj.search.lng = lng;
        } else if (mode == MapCls.SEARCH_MODE_SHOP) {
            var shopId = AU_COMMON.getParameter(document.location.href, "shop");
            mapObj.search.shopId = shopId;
        }

        var serviceFilterParam=AU_COMMON.getParameter(document.location.href, "serviceFilter");
        var serviceFilterFlg =false;
        if(serviceFilterParam){
            var serviceFilterParams= serviceFilterParam.split(',');
            for(var i=0;serviceFilterParams[i];i++) {
                if($('input[name="serviceFilter"][value="'+serviceFilterParams[i]+'"]').get(0)){
                    serviceFilterFlg = true;
                    $('input[name="serviceFilter"][value="'+serviceFilterParams[i]+'"]').prop("checked",true);
                }
            }
            if(serviceFilterFlg){
                $('#service-filter .cmp-accordion__button')[0].click();
            }
        }
        mapObj.init();

        window.mapObj = mapObj;
    }
    window.storeSearchAPI.init = init;
})(jQuery);
(function($) {
    'use strict';

    var NS = "cmp";
    var IS = "storecontainer";

    var selectors = {
        self: "[data-" +  NS + '-is="' + IS + '"]',
        show: {
            tab: "cmp-storecontainer__tab--show",
            conditions: "cmp-storecontainer__conditions--show",
            tabpanel: "cmp-storecontainer__tabpanel--show"
        }
    };

    var comparisonItems = {
                    storeClassification: "store-classification",
                    storeNumber: "store-number",
                    storeUqMobieHandling: "store-uqmobiehandling"
                };

    /**
     * 店舗別表示コンテナ
     *
     * @class Display Container By Store
     * @classdesc 設定ダイアログで指定した表示条件に一致した場合に表示するコンテナ
     * @param {DisplayContainerByStoreConfig} 店舗別表示コンテナのコンフィグ
     */
    function DisplayContainerByStore(config) {
        var that = this;

        if (config && config.element) {
            init(config);
        }

        /**
         * 初期化処理
         *
         * @private
         * @param {DisplayContainerByStoreConfig} 店舗別表示コンテナのコンフィグ
         */
        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            cacheElements(config.element);

            if (CommonUtil.isAuthorEditor()) {
                showContents(0);
            } else {
                showContents();
            }

            if (window.Granite && window.Granite.author && window.Granite.author.MessageChannel) {
                /*
                 * Editor message handling:
                 * - subscribe to "cmp.panelcontainer" message requests sent by the editor frame
                 * - check that the message data panel container type is correct and that the id (path) matches this specific Tabs component
                 * - if so, route the "navigate" operation to enact a navigation of the Tabs based on index data
                 */
                new window.Granite.author.MessageChannel("cqauthor", window).subscribeRequestMessage("cmp.panelcontainer", function(message) {
                    if (message.data && message.data.type === "cmp-storecontainer" && message.data.id === that._elements.self.dataset["cmpPanelcontainerId"]) {
                        if (message.data.operation === "navigate") {
                            navigate(message.data.index);
                        }
                    }
                });
            }
        }

        /**
        *
        * コンテンツ表示処理
        *
        * @param {String} showIndex 表示するコンテンツのインデックス（固定値の場合のみ指定）
        */
        function showContents(showIndex) {

            if (showIndex !== undefined) {
                that._show = showIndex;
            }else{
                that._show = getShowIndex();
            }

            if (that._elements.tabpanel) {
                refreshShowContents();
            }

        }

        /**
         *
         * 表示するアイテムのインデックスを取得する。
         * 表示対象のアイテムが存在しない場合は、-1を返却する。
         *
         * @returns {Number} 表示するアイテムのインデックス（存在しない場合は -1 を返却）
         */
        function getShowIndex() {
            var showIndex = -1;
            var displayConditionsList = $(that._elements.self).data("display-conditions");

            if (displayConditionsList) {

                // 一致するアイテムのインデックスを取得
                showIndex = getDisplayItemIndex(displayConditionsList);

            }

            return showIndex;
        }

        /**
        *
        * 比較項目に応じた比較値を取得する.
        *
        * @param {String} comparisonItem 比較項目
        * @returns {String} 対象の比較値
        */
        function getComparisonValue(comparisonItem) {

            var comparisonValue = "";
            switch (comparisonItem) {
                case comparisonItems.storeClassification :
                    comparisonValue = that._elements.self.storeInfo.storeClassification;
                    break;
                case comparisonItems.storeNumber :
                    comparisonValue = that._elements.self.storeInfo.storeNumber;
                    break;
                case comparisonItems.storeUqMobieHandling :
                    comparisonValue = that._elements.self.storeInfo.storeUqMobieHandling;
                    break;
            }

            return comparisonValue;
        }

        /**
         *
         * 表示アイテムのインデックスを取得する.
         *
         * @param {Array} displayConditionsList 表示条件リスト
         * @returns {Number} 表示アイテムのインデックス
         */
        function getDisplayItemIndex(displayConditionsList) {
            var displayItemIndex = -1;

            // 条件に一致するまで判定
            $(displayConditionsList).each(function() {
                var condition = this;
                var comparisonValue = getComparisonValue(condition.comparisonItem);
                var displayCondition = condition.displayCondition;
                var displayItem = condition.displayItem;

                // 文字列比較（正規表現）
                if (displayCondition && comparisonValue !== undefined && String(comparisonValue).match(displayCondition)) {
                    displayItemIndex = getItemIndex(displayItem);
                    return false;
                }

            });

            return displayItemIndex;
        }

        /**
        *
        * 指定されたアイテムのインデックスを取得する.
        *
        * @param {String} targetItemName 対象のアイテム名
        * @returns {Number} 対象のアイテムのインデックス
        */
        function getItemIndex(targetItemName) {
            var itemIndex = -1;
            var tabs = that._elements["tabpanel"];

            if (Array.isArray(tabs)) {

                for (var index in tabs) {
                    var itemName = $(tabs[index]).data("item-name");
                    if ( itemName == targetItemName ) {
                        itemIndex = index;
                        break;
                    }
                }

            } else {

                var itemName = $(tabs).data("item-name");
                if ( itemName == targetItemName ) {
                    itemIndex = 0;
                }

            }

            return itemIndex;
        }

       /**
         * Caches the DisplayContainerByStore elements as defined via the {@code data-tabs-hook="ELEMENT_NAME"} markup API
         *
         * @private
         * @param {HTMLElement} wrapper The DisplayContainerByStore wrapper element
         */
        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                if (hook.closest("." + NS + "-" + IS) === that._elements.self) { // only process own tab elements
                    var capitalized = IS;
                    capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                    var key = hook.dataset[NS + "Hook" + capitalized];
                    if (that._elements[key]) {
                        if (!Array.isArray(that._elements[key])) {
                            var tmp = that._elements[key];
                            that._elements[key] = [tmp];
                        }
                        that._elements[key].push(hook);
                    } else {
                        that._elements[key] = hook;
                    }
                }
            }
        }

        /**
         * 店舗別表示コンテナの表示／非表示を更新する
         *
         * @private
         */
        function refreshShowContents() {
            var tabpanels = that._elements["tabpanel"];
            var tabs = that._elements["tab"];
            var conditions = that._elements["conditions"];

            if (tabpanels) {

                if (Array.isArray(tabpanels)) {

                    // 表示アイテム数分、判定を行う
                    for (var i = 0; i < tabpanels.length; i++) {

                        var itemName = $(tabpanels[i]).data("item-name");

                        if (i === parseInt(that._show)) {
                            // 表示設定
                            tabpanels[i].classList.add(selectors.show.tabpanel);
                            tabpanels[i].removeAttribute("aria-hidden");
                            if (CommonUtil.isAuthorEditor()) {
                                tabs[i].classList.add(selectors.show.tab);
                                tabs[i].setAttribute("aria-selected", true);
                                tabs[i].setAttribute("tabindex", "0");
                                switchDisplayConditionClass(conditions, itemName, true);
                            }
                        } else {
                            // 非表示設定
                            tabpanels[i].classList.remove(selectors.show.tabpanel);
                            tabpanels[i].setAttribute("aria-hidden", true);
                            if (CommonUtil.isAuthorEditor()) {
                                tabs[i].classList.remove(selectors.show.tab);
                                tabs[i].setAttribute("aria-selected", false);
                                tabs[i].setAttribute("tabindex", "-1");
                                switchDisplayConditionClass(conditions, itemName, false);
                            }
                        }

                    }

                } else {

                    if (parseInt(that._show) >= 0) {

                        var itemName = $(tabpanels).data("item-name");

                        // 表示設定
                        tabpanels.classList.add(selectors.show.tabpanel);
                        tabpanels.removeAttribute("aria-hidden");
                        if (CommonUtil.isAuthorEditor()) {
                            tabs.classList.add(selectors.show.tab);
                            tabs.setAttribute("aria-selected", true);
                            tabs.setAttribute("tabindex", "0");
                            switchDisplayConditionClass(conditions, itemName, true);
                        }

                    }

                }

            }
        }

        /**
         * 表示条件の表示／非表示を更新する
         *
         * @private
         * @param {Array} conditions 表示条件リスト
         * @param {String} itemName 対象のアイテム名
         * @param {Boolean} addClass 追加／削除
         * @returns {Number} 対象のアイテムのインデックス
         */
        function switchDisplayConditionClass(conditions, itemName, addClass) {

            if (conditions) {

                if (Array.isArray(conditions)) {

                    for (var i = 0; i < conditions.length; i++) {
                        if ($(conditions[i]).data("display-item") == itemName) {
                            if (addClass) {
                                conditions[i].classList.add(selectors.show.conditions)
                            }else{
                                conditions[i].classList.remove(selectors.show.conditions)
                            }
                        }
                    }

                } else {

                    if ($(conditions).data("display-item") == itemName) {
                        if (addClass) {
                            conditions.classList.add(selectors.show.conditions)
                        }else{
                            conditions.classList.remove(selectors.show.conditions)
                        }
                    }

                }

            }

        }

        /**
         * Navigates to the tab at the provided index
         *
         * @private
         * @param {Number} index The index of the tab to navigate to
         */
        function navigate(index) {
            that._show = index;
            refreshShowContents();
        }

    }

    /**
    *
    * 店舗情報を取得する.
    *
    * @param {Object} element 対象のエレメント
    * @returns {Object} 店舗情報
    */
    function getStoreInfo(element) {

        var $storeDetail = $(element).closest('.au-store-detail');
        if ( $storeDetail.length > 0) {
            var storeInfo = {};
            storeInfo.storeClassification = $storeDetail.data(comparisonItems.storeClassification);
            storeInfo.storeNumber = $storeDetail.data(comparisonItems.storeNumber);
            storeInfo.storeUqMobieHandling = $storeDetail.data(comparisonItems.storeUqMobieHandling);
        }

        return storeInfo;
    }

    /**
     * Reads options data from the DisplayContainerByStore wrapper element, defined via {@code data-cmp-*} data attributes
     *
     * @private
     * @param {HTMLElement} element The DisplayContainerByStore element to read options data from
     * @returns {Object} The options read from the component data attributes
     */
    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    /**
     *
     * ready 処理
     *
     */
    $(function() {

        var displayContainerByStoreElems = $(selectors.self);
        displayContainerByStoreElems.each( function() {
            this.storeInfo = getStoreInfo(this);
            new DisplayContainerByStore({ element: this, options: readData(this)});
        });

        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            elements[i].storeInfo = getStoreInfo(elements[i]);
            new DisplayContainerByStore({ element: elements[i], options: readData(elements[i])});
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                element.storeInfo = getStoreInfo(element);
                                new DisplayContainerByStore({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });

    });

})(jQuery);

/* DetailMapCls.js */

(function ($) {
    "use strict";

    if (window.DetailMapCls) {
        return; // 2重初期化防止
    }

    /** 
     * 地図クラス
     */
    window.DetailMapCls = (function () {

        /**
         * コンストラクタ
         */
        var DetailMapCls = function (mapId, lat, lng) {
            if (!(this instanceof DetailMapCls)) {
                return new DetailMapCls(mapId, lat, lng);
            }

            // 地図を描画する要素のID
            this.mapId = mapId;

            // 縮尺
            var scale = 15;
            if ($('#scale').val()) {
                scale = Number($('#scale').val());
            }

            // Maplibre の Mapオブジェクト
            this.map = new maplibregl.Map({
                container: this.mapId,
                style: DetailMapCls.STYLE_JSON,
                center: [lng, lat],
                zoom: scale,
                minZoom: 6,
                maxZoom: 18,
                scrollZoom: false,
                transformRequest: function(url, resourceType) {
                    if (resourceType === 'Tile') {
                        return {
                            headers: {
                                'Accept': 'application/x-protobuf'
                            },
                            url: url
                        };
                    } else {
                        return {url: url};
                    }
                }
            });
            this.map.addControl(new maplibregl.NavigationControl());

            // 店舗オブジェクト
            this.shop = new DetailShopCls(lat, lng);

            this.shop.marker.addTo(this.map);
        };

        DetailMapCls.STYLE_JSON = '/etc.clientlibs/settings/wcm/designs/vendor/maplibre/resources/json/style.json';

        return DetailMapCls;
    })();

})(jQuery);

/* DetailShopCls.js */
(function ($) {
    "use strict";

    if (window.DetailShopCls) {
        return; // 2重初期化防止
    }

    /** 
     * 店舗情報クラス
     */
    window.DetailShopCls = (function () {
        /**
         * コンストラクタ
         */
        var DetailShopCls = function (lat, lng) {
            if(!(this instanceof DetailShopCls)) {
                return new DetailShopCls(lat, lng);
            }

            this.icon = {};
            this.icon.url = getActiveIcon();

            const markerElem = jQuery('<div></div>');
            markerElem.addClass('map__shop-icon');
            markerElem.css('background-image', 'url("' + this.icon.url + '")');

            this.marker = new maplibregl.Marker({
                element: markerElem.get(0),
                anchor: 'bottom'
            }).setLngLat([lng, lat]);
        };

        // 定数
        DetailShopCls.ICON_NPS_STAR_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_nps_star.png';
        DetailShopCls.ICON_NPS_NORMAL_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_nps_normal.png';
        DetailShopCls.ICON_PIPIT_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/pin_icon_orange_pipit.png';

        function getActiveIcon() {
            var $content = $('.au-store-detail');
            var storeClassification = $content.data("storeClassification");
            var npsScoreCls = $content.data("npsScoreCls");
            var activeIcon = DetailShopCls.ICON_NPS_NORMAL_ACTIVE;
            if (storeClassification === 4 || storeClassification === 9) {
                activeIcon = DetailShopCls.ICON_PIPIT_ACTIVE;
            } else {
                if (npsScoreCls === 1) {
                    activeIcon = DetailShopCls.ICON_NPS_STAR_ACTIVE;
                }
            }
            return activeIcon;
        }

        return DetailShopCls;
    })();
})(jQuery);

(function($) {
    'use strict';

    /**
     * 特定クラス表示処理.
     */
    function showSpecificClass(shopObj, $targetElem, $self) {

        switch (shopObj.strClfkb) {
            case '1':
                $('.auShop' , $targetElem).show();
                break;
            case '2':
                $('.auPlace' , $targetElem).show();
                break;
            case '3':
                $('.flagshipShop' , $targetElem).show();
                break;
            case '4':
                $('.pipit' , $targetElem).show();
                break;
            case '5':
                $('.auOne' , $targetElem).show();
                break;
            case '6':
                $('.auShopS' , $targetElem).show();
                break;
            case '7':
                $('.auSquare' , $targetElem).show();
                break;
            case '8':
                $('.agency' , $targetElem).show();
                break;
            case '9':
                $('.auShopStar' , $targetElem).show();
                break;
        }

        if (getStoreReservationUrl(shopObj.strNo, $self)) {
            $('.existStoreReservationUrl' , $targetElem).show();
        } else {
            $('.notExistStoreReservationUrl' , $targetElem).show();
        }

    }

    /**
     * 店舗予約URL取得処理.
     */
    function getStoreReservationUrl(key, $self) {
        var storeReservationUrlJson = $('[name="storeReservationUrlJson"]', $self).val();
        var storeReservationUrl = undefined;
        if (storeReservationUrlJson && key) {
            var storeReservationUrlMap = JSON.parse(storeReservationUrlJson);
            storeReservationUrl = storeReservationUrlMap[key];
        }
        return storeReservationUrl || '' ;
    }

    /**
     * 検索結果コンテンツ取得処理.
     */
    function getResultContents(templateHtml, shopObj, prefectureName, $self) {

        var contents = templateHtml.replace(/titleTemplate/g, shopObj.strNmDisp);
        var address = shopObj.addr1 + ' ' + shopObj.addr2 + ' ' + shopObj.addr3;
        contents = contents.replace(/addressTemplate/g, address);
        contents = contents.replace(/linkTemplate/g, shopObj.shopDetailUrl);
        contents = contents.replace(/businessHoursTemplate/g, shopObj.businessHoursStr);
        contents = contents.replace(/closedHolidayTemplate/g, shopObj.rglrhldy);
        contents = contents.replace(/temporaryOpeningHoursTemplate/g, shopObj.temporaryOpeningHours);
        contents = contents.replace(/prefectureTemplate/g, prefectureName);

        var freeDial = shopObj.fredl || ''
        contents = contents.replace(/freeDialTemplate/g, freeDial);
        contents = contents.replace(/noHyphenFreeDialTemplate/g, freeDial.replace(/-/g, ''));

        var storeReservationUrl = getStoreReservationUrl(shopObj.strNo, $self);
        contents = contents.replace(/storeReservationUrlTemplate/g, storeReservationUrl);

        return contents;
    }

    /**
     * 絞り込み条件判定処理.
     */
    function isMatched(shopObj, $self) {
        var targetColumn = $('[name="targetColumn"]', $self).val();
        var conditionValue = $('[name="conditionValue"]', $self).val();
        if (targetColumn && conditionValue) {
            var targetValue = shopObj[targetColumn];
            return targetValue && String(targetValue).match(conditionValue);
        } else {
            return true;
        }
    }

    /**
     * 特定店舗一覧取得処理.
     */
    function getSpecificShopList($self, $prefecture, isSelected) {

        if (!$prefecture.length) {
            return false;
        }

        var $result = $('.specific-store-list__result-field', $self);
        var $resultTitle = $('.specific-store-list__result-title', $result);
        var $resultContents = $('.specific-store-list__result-contents', $result);
        var $resultTemplate = $('.specific-store-list__result-template', $result);
        var $nothingMessage = $('.specific-store-list__nothing-message', $result);
        var detailPagePath = $('[name="detailPagePath"]', $self).val() || '';

        $result.addClass('hide');
        $resultTitle.empty();
        $resultContents.empty();

        // 都道府県名取得
        var prefectureName = '';
        if (isSelected) {
            prefectureName = $('option:selected', $prefecture).data('prefecture-name');
        } else {
            prefectureName = $prefecture.data('prefecture-name');
        }

        // Faceショップリスト取得
        $.ajax({
            url: '/bin/wcm/au-com/faceshoplist.json',
            type: 'GET',
            data: {
                prefectures: $prefecture.val(),
                locale: $('html').attr('lang'),
                detailPagePath: detailPagePath,
                _charset_: 'UTF-8'
            }
        }).done(function(shopData, status, xhr) {

            if (shopData && shopData.length) {

                $.each(shopData, function (idx, shopObj) {

                    // 店舗絞り込み条件に一致しているか判定
                    if (isMatched(shopObj, $self)) {
                        var templateHtml = $resultTemplate.html();
                        var resultHtml = getResultContents(templateHtml, shopObj, prefectureName, $self);
                        if (resultHtml) {
                            let $resultHtml = $(resultHtml);
                            $resultHtml.attr('data-sortkey', shopObj.sortKey);
                            $resultContents.append($resultHtml);
                            showSpecificClass(shopObj, $resultHtml, $self);
                        }
                    }

                });

            }

        }).always(function() {

            // 検索結果タイトルの設定
            var resultTitleTemplate = $resultTitle.data('result-title');
            if (resultTitleTemplate) {
                var resultTitle = resultTitleTemplate.replace(/prefectureTemplate/g, prefectureName);
                $resultTitle.html(resultTitle);
            }

            // 該当なしメッセージの表示／非表示
            if ($resultContents.html()) {
                if (!$nothingMessage.hasClass('hide')) {
                    $nothingMessage.addClass('hide');
                }
            }else{
                $nothingMessage.removeClass('hide');
            }

            // 検索結果を表示
            $result.removeClass('hide');

            // フォーカスを移動
            let $target = $resultTitle.find("[id]");
            if ($target.length > 0) {
                let id = $target.attr('id');
                if (id) {
                    // アンカーリンクをリセット
                    location.href="#";
                    location.href="#" + id;
                }
            }

            // カードの高さを揃える
            $('.cardBox-ctr', $result).matchHeight({
                byRow: true // 行ごとに高さを揃えるなら：true
            });

        });
    }

    /**
     * Ready処理.
     */
    $(function() {
        $('.specific-store-list').each(function() {
            var $self = $(this);
            var $prefecture = $('[name="prefecture"]', $self);
            var $prefecturesListSize = $('[name="prefecturesListSize"]', $self);

            if ($prefecturesListSize.val() == 1) {
                // 都道府県が一つのみの場合、処理を実行
                getSpecificShopList($self, $prefecture, false);
            } else {
                var $form = $('.specific-store-list__search-form', $self);
                var $formItem = $('.specific-store-list__form-item', $self);
                var $submitBtn = $('.specific-store-list__form-button', $self);
                // 都道府県が複数の場合、submit時に処理を実行
                $form.on('submit', function() {
                    getSpecificShopList($self, $prefecture, true);
                    return false;
                });
                $formItem.on('change', function() {
                    if ($formItem.val()) {
                        $submitBtn.prop('disabled', false);
                    } else {
                        $submitBtn.prop('disabled', true);
                    }
                    return false;
                });
            }
        });
    });

})(jQuery);
/* searchResult.js */
(function($) {
    'use strict';

    let allStores = {};
    let count = 0;
    let searchType = null;
    let maxCount = null;

    let vueObjects = {};

    const matchHeight = function($target) {
        $target.find('.cmp-au-com-card .cmp-au-com-card__display').matchHeight({
            byRow: true
        });
    }

    const buildDetailPageLink = function ($container) {
        $container.find('.cmp-au-com-store-search-result_link')
            .not('.builtLink')
            .each(function() {
                const $target = $(this);
                let href = $target.attr('href');
                href += '?shopId=' + $target.data('shopNo');
                href += CommonUtil.isAuthorPreview() ? '&wcmmode=disabled' : '';
                $target.attr('href', href).addClass('builtLink');
        });
        
    }

    /**
     * Vueオブジェクト生成。
     * 
     * @param {Element} コンテナ
     * @param {Object} 条件
     */
    const createVue = function(container) {
        return new Vue({
            el: container,
            data: {
                allStores: allStores,
                count: count,
            },
            computed: {
                listItems() {
                    const stores = this.allStores;
                    return stores.length != undefined ? stores.slice(0, this.count) : {};
            	},
                display() {
                    const hasData = this.allStores && this.allStores.length;
            
                    return {
                        hasData: hasData
                    };
                }
            },
            methods: {
                viewMore() {
                    this.count += count;
                }
            },
            mounted: function() {
                matchHeight($(this.$el));
                buildDetailPageLink($(this.$el));
            },
            updated: function() {
                matchHeight($(this.$el));
                buildDetailPageLink($(this.$el));
            }
        });
    }

    /**
     * 検索結果を表示する.
     *
     * @param {jQueryElement} 対象コンポーネント
     * @private
     */
    function showSearchResults($searchResults) {

        $searchResults.each(function() {
            const searchResults = this;
            const id = $(this).attr('id');

            if (!(id in vueObjects)) {
                const vueObj = createVue(searchResults);
                vueObjects[id] = vueObj;
        	} else {
                vueObjects[id].allStores = allStores;
                vueObjects[id].count = count;
            }
        });
    }

    $(function (){
        const $searchResults = $('.cmp-au-com-store-search-result_list');
        if (!$searchResults || !$searchResults.length) {
            return;
        }

        count = $searchResults.data('cmpCount');

        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
            allStores = window.auDataLayer.get('/storeLocator');
            
            maxCount = $searchResults.data('cmpMaxCount');
            if (maxCount && allStores.length > maxCount) {
                allStores = {};
            }
            showSearchResults($searchResults);
        });
        if ($searchResults.data('cmpDataGetMethod') === 'queryParameter') {
            searchType = $searchResults.data('cmpSearchType');
            window.auDataLayer.storeLocator.initStoreLocatorByParams(searchType);
        }
    });

})(jQuery);

/* searchMap.js */
(function($) {
    'use strict';

    // CSS セレクター
    const COMP_CSS_SELECTOR = '.cmp-au-com-store-search-map';
    const MAP_ID = 'map';
    const TOO_MANY_MESSAGE_SELECTOR = '.cmp-au-com-store-search-map_too-many-message';
    const POPUP_TEMPLATE_ID = 'popup-template';
    const MAP_CSS_SELECTOR = COMP_CSS_SELECTOR + ' #' + MAP_ID;
    const POPUP_TEMPLATE_CSS_SELECTOR = COMP_CSS_SELECTOR + ' #' + POPUP_TEMPLATE_ID;

    const LNG_DEFAULT = 139.701949;
    const LAT_DEFAULT = 35.692375;

    const MIN_ZOOM = 5;
    const MAX_ZOOM = 18

    // アイコンのパス
    const ICON_AU_NPS_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_au_nps.svg';
    const ICON_AU_ETC_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_au_etc.svg';
    const ICON_UQ_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_uq.svg';
    const ICON_PIPIT_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_toyota.svg';

    const STYLE_JSON_PATH = '/etc.clientlibs/settings/wcm/designs/vendor/maplibre/resources/json/style.json';

    const ICON_CENTERING_OFFSET = [0, 100];

    let initialized = false;
    let vueObj = null;
    let icons = [];

    let searchType = null;
    let maxCount = null;
    let scale = null;
    let maxScale = null;
    let delayTime = null;
    let latitude = null;
    let longitude = null;

    let mapWidth = null;
    let mapHeight = null;

    /**
     * 初期化処理.
     */
    $(function () {
        const $map = $(MAP_CSS_SELECTOR);
        if ($map.length !== 0) {
            
            window.loading.start();

            // ダイアログ設定の取得
            loadSettings($map);

            // 現在地の取得
            let promise = getCurrentPosition();
            promise.then(function(pos) {

                // データレイヤーの初期化後にレンダリング。
                let shops = [];
                window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
                    shops = window.auDataLayer.get('/storeLocator');
                });
                window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.always, function(){

                    // アイコンをクリア
                    icons.forEach(icon => icon.remove());
                    icons = [];

                    let tooManyMessage = $(COMP_CSS_SELECTOR).find(TOO_MANY_MESSAGE_SELECTOR);
                    tooManyMessage.hide();
                    // 最大件数を超えていたらメッセージを表示し、画面表示をしない。
                    if (shops.length > maxCount) {
                        tooManyMessage.show();
                        window.loading.stop();
                        return;
                    }

                    // ポップアップ用のHTMLを生成。
                    if (vueObj == null) {
                        vueObj = new Vue({
                            el: $(POPUP_TEMPLATE_CSS_SELECTOR)[0],
                            data: {
                                shops: shops,
                            },
                            mounted: function() {
                                buildDetailPageLink($(this.$el));
                                renderingIcons(mapObj, shops);
                            },
                            updated: function() {
                                buildDetailPageLink($(this.$el));
                                renderingIcons(mapObj, shops);
                            }
                        });
                    } else {
                        vueObj.shops = shops;
                    }

                    mapObj.on('dragend', function(event) {
                        if (!event.isAuto) {
                            eventHandler(mapObj);
                        }
                    });
                    mapObj.on('zoomend', function(event) {
                        if (!event.isAuto) {
                            eventHandler(mapObj);
                        }
                    });

                    mapObj.on('resize', function(event) {
                        let afterHeight = $(mapObj.getContainer()).css('height');
                        let afterWidth = $(mapObj.getContainer()).css('width');
                        
                        // 地図を表示する div のサイズが変わったときだけ処理を行う。
                        if (mapHeight !== afterHeight || mapWidth !== afterWidth) {
                            if (!event.isAuto) {
                                eventHandler(mapObj);
                            }
                        }
                        mapHeight = afterHeight;
                        mapWidth = afterWidth;
                    });

                    window.loading.stop();
                });

                // 地図の生成
                const mapObj = createMap(pos);
                

                if (!CommonUtil.isAuthorEditor()) {
                    // ショップ情報を取得
                    getShopsByCoords(mapObj);
                } else {
                    window.loading.stop();
                }
            });
        }
    });

    function renderingIcons (mapObj, shops) {
        // レンダリング
        shops.forEach(shop => {
            // アイコンの生成
            const iconObj = createIcon(shop);
            iconObj.addTo(mapObj);
            icons.push(iconObj);

            // ポップアップの生成
            const popupObj = createPopup(shop);
            iconObj.setPopup(popupObj);
            popupObj.on('open', function() {
                centering(mapObj, iconObj);
            });
        });

        // 初期表示時はアイコンが画面に収まるように調整。
        if (!initialized) {
            fit(mapObj, shops);
        }
        initialized = true;
    }

    const buildDetailPageLink = function ($container) {
        $container.find('.cmp-au-com-store-map_popup-link')
            .not('.builtLink')
            .each(function() {
                const $target = $(this);
                let href = $target.attr('href');
                href += '?shopId=' + $target.data('shopNo');
                href += CommonUtil.isAuthorPreview() ? '&wcmmode=disabled' : '';
                $target.attr('href', href).addClass('builtLink');
        });
        
    }

    /**
     * 
     * ダイアログの設定情報を取得.
     * 
     */
    function loadSettings() {
        
        let $target = $(COMP_CSS_SELECTOR);

        searchType = $target.data('cmpSearchType');
        maxCount = $target.data('cmpMaxCount');
        scale = $target.data('cmpScale');
        maxScale = $target.data('cmpMaxScale');
        delayTime = $target.data('cmpDelayTime');
        latitude = $target.data('cmpLatitude');
        longitude = $target.data('cmpLongitude');
    }

    /**
     * 
     * GPS から現在地を取得.
     * 
     * @returns Promise オブジェクト
     */
    function getCurrentPosition () {

        return new Promise(function (resolve, reject) {
            const optionObj = {
                "enableHighAccuracy": true,
                "timeout": 8000,
                "maximumAge": 5000,
            };
        
            // GPSを取得(ブロックされた場合を考慮して、先に初期化)
            let pos = {};
            pos.coords = {};
            pos.coords.longitude = longitude || LNG_DEFAULT;
            pos.coords.latitude = latitude || LAT_DEFAULT;

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    pos = position;
                    resolve(pos);
                }
                , function () {
                    //mapObj.eventHandler(true);
                    resolve(pos);
                }
                , optionObj
            );
        });
    }

    /**
     * 
     * 地図の生成.
     * 
     * @param {*} pos 座標
     * @returns mapObj
     */
    function createMap(pos) {

        // 縮尺の初期値
        let _scale = 15;
        if(scale) {
            _scale = scale;
        }

        // 店舗の座標
        let lng = pos.coords.longitude;
        let lat = pos.coords.latitude;

        // Maplibre の Mapオブジェクト
        let mapObj = new maplibregl.Map({
            container: MAP_ID,
            style: STYLE_JSON_PATH,
            center: [lng, lat],
            zoom: _scale,
            minZoom: 6,
            maxZoom: 18,
            scrollZoom: false,
            transformRequest: function(url, resourceType) {
                if (resourceType === 'Tile') {
                    return {
                        headers: {
                            'Accept': 'application/x-protobuf'
                        },
                        url: url
                    };
                } else {
                    return {url: url};
                }
            }
        });
        mapObj.addControl(new maplibregl.NavigationControl());
        mapHeight = $(mapObj.getContainer()).css('height');
        mapWidth = $(mapObj.getContainer()).css('width');

        return mapObj;
    }

    /**
     * 
     * アイコンの生成.
     * 
     * @param {*} shopData 店舗情報
     * @returns iconObj
     */
    function createIcon(shopData) {
    
        // 店舗の座標
        let lng = shopData.longitude;
        let lat = shopData.latitude;

        const iconInfo = getActiveIconInfo(shopData);
        const markerElem = $('<div></div>');
        markerElem.addClass('cmp-au-com-store-search-map__shop-icon');
        markerElem.addClass(iconInfo.class);
        markerElem.css('background-image', 'url("' + iconInfo.icon + '")');
        markerElem.css('background-size', iconInfo.size);

        const iconObj = new maplibregl.Marker({
            element: markerElem.get(0),
            anchor: 'bottom'
        }).setLngLat([lng, lat]);

        return iconObj;
    }

    /**
     * 
     * ポップアップを生成.
     * 
     * @param {*} shopData 店舗情報
     * @returns popupObj
     */
    function createPopup(shopData) {

        // 店舗の座標
        let lng = shopData.longitude;
        let lat = shopData.latitude;
        
        const iconInfo = getActiveIconInfo(shopData);
        const popupHtml = $(POPUP_TEMPLATE_CSS_SELECTOR)
                            .find('[data-shop-no='+ shopData.shopNo +']')
                            .html();
        const popupObj = new maplibregl.Popup({
            anchor: 'bottom',
            offset: {
                'bottom': iconInfo.popupBottom
            },
            maxWidth: 'none',
            className: 'maplibregl-popup-custom',
        }).setLngLat([lng, lat]).setHTML(popupHtml);

        return popupObj;
    }

    /**
     * 
     * 店舗のステータスに合わせて、アイコンの情報を返す.
     * 
     * @param {*} shopData 店舗情報
     * @returns activeIconInfo
     */
    function getActiveIconInfo(shopData) {
        var activeIconInfo = {};
        activeIconInfo.class = "cmp-au-com-store-search-map__shop-icon--default";
        activeIconInfo.size = "42px";
        activeIconInfo.popupBottom = [0, -70];
        if (shopData.storeClassification === '4') {
            activeIconInfo.icon = ICON_PIPIT_ACTIVE;
        } else if (shopData.storeClassification === '9' && shopData.npsScoreCls == '1') {
            activeIconInfo.icon = ICON_UQ_ACTIVE;
        } else if (shopData.npsScoreCls == '1') {
            activeIconInfo.icon = ICON_AU_NPS_ACTIVE;
        } else {
            activeIconInfo.icon = ICON_AU_ETC_ACTIVE;
            activeIconInfo.class = "cmp-au-com-store-search-map__shop-icon--etc";
            activeIconInfo.size = "21px";
            activeIconInfo.popupBottom = [0, -50];
        }
        return activeIconInfo;
    }

    /**
     * 
     * ポップアップ表示時のセンタリング.
     * 
     * @param {*} mapObj Maplibre 地図オブジェクト
     * @param {*} iconObj Maplibre マーカーオブジェクト
     */
    function centering(mapObj, iconObj) {
        const lngLat = iconObj.getLngLat();
        mapObj.panTo(lngLat, {
            offset: ICON_CENTERING_OFFSET
        }, {
            isAuto: true
        });
    }

    /**
     * 表示されている店舗に合わせて地図のサイズを調整
     * 
     * @param {*} mapObj Maplibre 地図オブジェクト
     * @param {*} shops ショップ情報
     * 
     */
    function fit(mapObj, shops) {

        let coordinates = [];
        $.each(shops, function (idx, shop) {
            let lng = shop.longitude;
            let lat = shop.latitude;
            coordinates.push([lng, lat]);
        });

        if (coordinates.length > 0) {
            let bounds = coordinates.reduce(function (bounds, coord) {
                return bounds.extend(coord);
            }, new maplibregl.LngLatBounds(coordinates[0], coordinates[0]));

            maxScale = maxScale >= MIN_ZOOM && maxScale <= MAX_ZOOM ? maxScale : MAX_ZOOM;

            const camera = mapObj.cameraForBounds(bounds, {
                padding: {
                    top: 88,
                    bottom:20,
                    left: 20,
                    right: 20
                },
                maxZoom: maxScale
            });

            camera.zoom = camera.zoom - 1 >= MIN_ZOOM ? camera.zoom - 1 : MIN_ZOOM;

            mapObj.easeTo({
                center: camera.center,
                zoom: camera.zoom,
                animate: false
            }, {
                isAuto: true
            });
        }
    }

    var timerId = null;
    function eventHandler(mapObj) {
        if (timerId) {
            clearTimeout(timerId);
            //console.log("cancel !");
        }
        var promise = new Promise(function (resolve, reject) {
            //console.log("wait...");
            timerId = setTimeout(function () {
                //console.log("wait finished !");
                resolve();
                timerId = null;
            }, delayTime);
        });
        promise.then(function () {
            getShopsByCoords(mapObj);
        });
    }

    /**
     * 
     * 位置情報を元にショップ情報を取得.
     * 
     * @param {*} mapObj Maplibre 地図オブジェクト
     */
    function getShopsByCoords(mapObj) {

        const coords = {};
        coords.northWestLat = mapObj.getBounds().getNorthWest().lat;
        coords.northWestLng = mapObj.getBounds().getNorthWest().lng;
        coords.northEastLat = mapObj.getBounds().getNorthEast().lat;
        coords.northEastLng = mapObj.getBounds().getNorthEast().lng;
        coords.southWestLat = mapObj.getBounds().getSouthWest().lat;
        coords.southWestLng = mapObj.getBounds().getSouthWest().lng;
        coords.southEastLat = mapObj.getBounds().getSouthEast().lat;
        coords.southEastLng = mapObj.getBounds().getSouthEast().lng;

        window.auDataLayer.storeLocator.initStoreLocatorByGps(searchType, coords);
    }

})(jQuery);

/** searchCount.js */
(function ($){
    'use strict';

    let count = 0;

    let searchType = null;
    let maxCount = null;

    let vueObjects = {};

    /**
     * Vueオブジェクト生成。
     * 
     * @param {Element} コンテナ
     * @param {Object} 条件
     */
    const createVue = function(container) {
        return new Vue({
            el: container,
            data: {
                count: count,
            },
            computed: {
                display() {
                    return {
                        hasData: (this.count > -1)
                    };
                }
            }
        });
    }
    /**
     * 検索結果件数を表示する.
     *
     * @param {jQueryElement} 対象コンポーネント
     * @private
     */
    function showSearchCount($searchCount) {

        $searchCount.each(function() {
            const searchCount = this;
            const id = $(this).attr('id');

            if (!(id in vueObjects)) {
                const vueObj = createVue(searchCount);
                vueObjects[id] = vueObj;
            } else {
                vueObjects[id].count = count;
            }
            
        });

    }

    $(function (){
        const $searchCount = $('.cmp-au-com-store-search-count');
        if (!$searchCount || !$searchCount.length) {
            return;
        }

        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
            let stores = window.auDataLayer.get('/storeLocator');
            if (stores) {
                count = stores.length;
            }
        });
        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.always, function(){
            
            maxCount = $searchCount.data('cmpMaxCount');
            if (maxCount && count > maxCount) {
                count = -1;
            }
            showSearchCount($searchCount);
            
        });
        if ($searchCount.data('cmpDataGetMethod') === 'queryParameter') {
            searchType = $searchCount.data('cmpSearchType');
            window.auDataLayer.storeLocator.initStoreLocatorByParams(searchType);
        }
    });
})(jQuery);
(function($) {
    'use strict';

    const SEARCH_TYPE_PARAM_NAME = 'mode';
    let prefectures = {};

    /**
     * 表示制御オブジェクト生成。
     * 
     * @param {Object} 条件
     */
    const createDisplay = function(conditions) {
        let hasData = (type => ({
            'keyword': conditions.keyword != null,
            'prefecture': conditions.prefecture != null
        })[type])(conditions.type);

        hasData = hasData != null ? hasData : false;

        return {
            hasData: hasData
        };
    }

    /**
     * Vueオブジェクト生成。
     * 
     * @param {Element} コンテナ
     * @param {Object} 条件
     */
    const createVue = function(container, conditions) {
        return new Vue({
            el: container,
            data: {
                display: createDisplay(conditions),
                conditions: conditions
            }
        });
    }

    /**
     * 条件情報取得。
     * 
     * @param {Object} 設定情報
     */
    const getConditions = function(settings, paramValues) {
        const conditions = {};
        conditions.type = paramValues.type;

        const setConditions = (type => ({
            'keyword': function() {
                conditions.keyword = paramValues.keyword;
            },
            'prefecture': function() {
                const prefecture = prefectures.find(dto => dto.code == paramValues.prefecture);
                conditions.prefecture = (prefecture != null) ? prefecture.name : null;

                const cities = (prefecture != null) ? prefecture.cities : null;
                const city = (cities != null) ? cities.find(dto => dto.code == paramValues.city) : null;
                conditions.city = (city != null) ? city.name : null;

                conditions.businesses = settings.businessesJson
                .filter(businessJson => paramValues.businesses
                    .find(business => businessJson.name == business)
                );

                conditions.facilities = settings.facilitiesJson
                .filter(facilityJson => paramValues.facilities
                    .find(facility => facilityJson.name == facility)
                );
            }
        })[type])(conditions.type);

        if (typeof setConditions === 'function') {
            setConditions();
        }

        return conditions;
    }

    /**
     * クエリパラメータ値取得。
     * 
     * @param {Object} 設定情報
     */
    const getParamValues = function(settings) {
        const paramValues = {};
        paramValues.type = AU_COMMON.getParameter(document.location.href, SEARCH_TYPE_PARAM_NAME);

        if (!settings) {
            return paramValues;
        }

        paramValues.keyword = (settings.keywordParamName != null) ? AU_COMMON.getParameter(document.location.href, settings.keywordParamName) : '';
        paramValues.prefecture = (settings.prefectureParamName != null) ? AU_COMMON.getParameter(document.location.href, settings.prefectureParamName) : '';
        paramValues.city = (settings.cityParamName != null) ? AU_COMMON.getParameter(document.location.href, settings.cityParamName) : '';
        paramValues.businesses = (settings.businessesParamName != null) ? AU_COMMON.getParameter(document.location.href, settings.businessesParamName) : '';
        paramValues.businesses = (paramValues.businesses != null) ? paramValues.businesses.split(settings.separator) : [];
        paramValues.facilities = (settings.facilitiesParamName != null) ? AU_COMMON.getParameter(document.location.href, settings.facilitiesParamName) : '';
        paramValues.facilities = (paramValues.facilities != null) ? paramValues.facilities.split(settings.separator) : [];

        return paramValues;
    }

    /**
     * 設定情報取得。
     * 
     * @param {jQueryElement} 対象コンポーネント
     */
    const getSettings = function($searchCondition) {
        const settings = {};
        if (!$searchCondition || !$searchCondition.length) {
            return settings;
        }

        settings.keywordParamName = $searchCondition.data('cmpKeywordParamName');
        settings.prefectureParamName = $searchCondition.data('cmpPrefectureParamName');
        settings.cityParamName = $searchCondition.data('cmpCityParamName');
        settings.businessesParamName = $searchCondition.data('cmpBusinessesParamName');
        settings.facilitiesParamName = $searchCondition.data('cmpFacilitiesParamName');
        settings.businessesJson = $searchCondition.data('cmpBusinessesJson');
        settings.facilitiesJson = $searchCondition.data('cmpFacilitiesJson');
        settings.separator = $searchCondition.data('cmpSeparator');

        return settings;
    }

    /**
     * 検索条件を表示する.
     *
     * @param {jQueryElement} 対象コンポーネント
     * @private
     */
    function showSearchCondition($searchConditions) {

        $searchConditions.each(function() {
            const searchCondition = this;
            const $searchCondition = $(this);

            const settings = getSettings($searchCondition);

            const paramValues = getParamValues(settings);
            
            const conditions = getConditions(settings, paramValues);
            
            createVue(searchCondition, conditions);
        });

    }

    $(function (){
        const $searchConditions = $('.cmp-au-com-store-search-condition');
        if (!$searchConditions || !$searchConditions.length) {
            return;
        }

        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.prefecture.ready, function(){
            prefectures = window.auDataLayer.get('/storeLocator.prefecture');
            showSearchCondition($searchConditions);
        });
        window.auDataLayer.storeLocator.initPrefecture();
    });

})(jQuery);

function toggleSubmitButton(keywordInput) {
    const submitButton = keywordInput.parentElement.querySelector('.cmp-au-com-store-keyword-search__submit');
    if (keywordInput.value.trim() === '') {
        submitButton.disabled = true;
    } else {
        submitButton.disabled = false;
    }
}

/* store-services.js */
(function($) {

  // CSS セレクター
  const COMP_CSS_SELECTOR = '.cmp-au-com-store-services';
  const COMP_ITEM_SELECTOR = '.cmp-au-com-store-services_item';

  $(function() {

    const $list = $(COMP_CSS_SELECTOR);
    if ($list.length !== 0) {
      window.loading.start();
      window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
        const services = window.auDataLayer.get('/storeLocator/servicesRaw');

        const $items = $(COMP_CSS_SELECTOR + " " + COMP_ITEM_SELECTOR);
        $items.each(function(){

          const name = $(this).data('name');
          const serviceValue = services[name];
          if (typeof serviceValue == 'boolean' && serviceValue) {
            $(this).addClass("cmp-au-com-store-services_item-enabled");
            $(this).removeClass("cmp-au-com-store-services_item-disabled");
          }
        });
      });
      window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.always, function(){
        window.loading.stop();
      });
      window.auDataLayer.storeLocator.initStoreLocatorBySingleStore();
    }
  });
})(jQuery);

/* store-map.js */
(function($) {

  // CSS セレクター
  const COMP_CSS_SELECTOR = '.cmp-au-com-store-map';
  const MAP_ID = 'map';
  const POPUP_TEMPLATE_ID = 'popup-template';
  const MAP_CSS_SELECTOR = COMP_CSS_SELECTOR + ' #' + MAP_ID;
  const POPUP_TEMPLATE_CSS_SELECTOR = COMP_CSS_SELECTOR + ' #' + POPUP_TEMPLATE_ID;

  // Author 用の店舗座標
  const SHOP_LNG_FOR_AUTHOR = 139.701949;
  const SHOP_LAT_FOR_AUTHOR = 35.692375;

  const STYLE_JSON_PATH = '/etc.clientlibs/settings/wcm/designs/vendor/maplibre/resources/json/style.json';

  // アイコンのパス
  const ICON_AU_NPS_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_au_nps.svg';
  const ICON_AU_ETC_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_au_etc.svg';
  const ICON_UQ_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_uq.svg';
  const ICON_PIPIT_ACTIVE = '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/store-locator/images/map_icon_toyota.svg';
  
  const ICON_CENTERING_OFFSET = [0, 100];
  const POPUP_OFFSET_BOTTOM = [0, -70];

  /**
   * 初期化処理.
   */
  const $map = $(MAP_CSS_SELECTOR);
  if ($map.length !== 0) {

    window.loading.start();

    $(window).on("load", function() {
    
      let shopData = {};
      window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
        shopData = window.auDataLayer.get('/storeLocator');
      });
      
      window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.failed, function(){
        if (!CommonUtil.isAuthorEditor()) {
          $(COMP_CSS_SELECTOR).css('display', 'none');
        }
      });

      window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.always, function(){

        // 地図の生成
        const mapObj = createMap(shopData);

        // アイコンの生成
        const iconObj = createIcon(shopData);
        iconObj.addTo(mapObj);

        
        new Vue({
          el: $(POPUP_TEMPLATE_CSS_SELECTOR)[0],
          data: {
              shop: shopData,
          },
          mounted: function() {
            // Vue.js のオブジェクト生成後にポップアップの生成を行う
            const popupObj = createPopup(shopData);
            popupObj.addTo(mapObj);
            iconObj.setPopup(popupObj);
            popupObj.on('open', function() {
              centering(mapObj, iconObj);
            });
          }
      });
        window.loading.stop();
      });
      window.auDataLayer.storeLocator.initStoreLocatorBySingleStore();
    });
  }

  /**
   * 
   * 地図の生成.
   * 
   * @param {*} shopData 店舗情報
   * @returns mapObj
   */
  function createMap(shopData) {

    // 縮尺の初期値
    let scale = 15;
    if($(COMP_CSS_SELECTOR).data('scale')) {
      scale = $(COMP_CSS_SELECTOR).data('scale');
    }

    // 店舗の座標
    let lng = shopData.longitude || SHOP_LNG_FOR_AUTHOR;
    let lat = shopData.latitude || SHOP_LAT_FOR_AUTHOR;

    // Maplibre の Mapオブジェクト
    let mapObj = new maplibregl.Map({
      container: MAP_ID,
      style: STYLE_JSON_PATH,
      center: [lng, lat],
      zoom: scale,
      minZoom: 6,
      maxZoom: 18,
      scrollZoom: false,
      transformRequest: function(url, resourceType) {
        if (resourceType === 'Tile') {
          return {
            headers: {
              'Accept': 'application/x-protobuf'
            },
            url: url
          };
        } else {
          return {url: url};
        }
      }
    });
    // アイコン、ポップアップを初期表示するため、中心位置をズラす
    mapObj.panTo([lng, lat], {
      offset: ICON_CENTERING_OFFSET,
      duration: 0
    });
    mapObj.addControl(new maplibregl.NavigationControl());

    return mapObj;
  }

  /**
   * 
   * アイコンの生成.
   * 
   * @param {*} shopData 店舗情報
   * @returns iconObj
   */
  function createIcon(shopData) {
    
    // 店舗の座標
    let lng = shopData.longitude || SHOP_LNG_FOR_AUTHOR;
    let lat = shopData.latitude || SHOP_LAT_FOR_AUTHOR;

    const iconUrl = getActiveIcon(shopData);
    const markerElem = $('<div></div>');
    markerElem.addClass('cmp-au-com-store-search-map__shop-icon');
    markerElem.css('background-image', 'url("' + iconUrl + '")');
    markerElem.css('background-size', '42px');

    const iconObj = new maplibregl.Marker({
      element: markerElem.get(0),
      anchor: 'bottom'
    }).setLngLat([lng, lat]);

    return iconObj;
  }

  /**
   * 
   * ポップアップを生成.
   * 
   * @param {*} shopData 店舗情報
   * @returns popupObj
   */
  function createPopup(shopData) {

    // 店舗の座標
    let lng = shopData.longitude || SHOP_LNG_FOR_AUTHOR;
    let lat = shopData.latitude || SHOP_LAT_FOR_AUTHOR;
    
    const popupHtml = $(POPUP_TEMPLATE_CSS_SELECTOR).html();
    const popupObj = new maplibregl.Popup({
      closeOnClick: false,
      anchor: 'bottom',
      offset: {
          'bottom': POPUP_OFFSET_BOTTOM
      },
      maxWidth: 'none',
      className: 'maplibregl-popup-custom',
    }).setLngLat([lng, lat]).setHTML(popupHtml);

    return popupObj;
  }

  /**
   * 
   * 店舗のステータスに合わせて、アイコンのパスを返す.
   * 
   * @param {*} shopData 店舗情報
   * @returns activeIcon
   */
  function getActiveIcon(shopData) {
    var activeIcon = ICON_AU_ETC_ACTIVE;
    if (shopData.storeClassification === '4') {
        activeIcon = ICON_PIPIT_ACTIVE;
    } else if (shopData.storeClassification === '9' && shopData.npsScoreCls == '1') {
        activeIcon = ICON_UQ_ACTIVE;
    } else if (shopData.npsScoreCls == '1') {
        activeIcon = ICON_AU_NPS_ACTIVE;
    }
    return activeIcon;
  }

  /**
   * 
   * ポップアップ表示時のセンタリング.
   * 
   * @param {*} mapObj 
   * @param {*} iconObj 
   */
  function centering(mapObj, iconObj) {
    const lngLat = iconObj.getLngLat();
    mapObj.panTo(lngLat, {
      offset: ICON_CENTERING_OFFSET
    }, {
      isAuto: true
    });
  }

})(jQuery);


/* store-floating-button.js */
(function($) {
  
  let $target = $('.cmp-au-com-store-floating-button');
  if(!CommonUtil.isAuthorEditor() && $target.length > 0) {
    $(function() {

      let $target = $('.cmp-au-com-store-floating-button');
      $target.addClass("cmp-au-com-store-floating-button_fixed");

      $target.hide();

      let timer = false;
      $(window).on("scroll", function () {
        if (timer !== false) {
            clearTimeout(timer);
        }
        timer = setTimeout(function(){
            let $target = $('.cmp-au-com-store-floating-button');
            if ($(this).scrollTop() > 100) { // 100px以上スクロールしたら出てくる
              $target.fadeIn();
              $('.au-footer').css('margin-bottom', $target.height());
            }
        }, 50);
      });
    });
  }
})(jQuery);
  
  
(function($) {
    'use strict';

    const JSON_URL_GET_PRODUCT_DETAIL = '/bin/wcm/au-com/ols/product';
    const JSON_URL_GET_PRODUCT_DETAIL_V2 = '/bin/wcm/au-com/ols/product/v2';
    const JSON_URL_EXT = '.json';
    const PRODUCT_READY_EVENT_NAME = 'auVariable:product.ready';
    const PRODUCT_FAILED_EVENT_NAME = 'auVariable:product.failed';
    const SHOP_READY_EVENT_NAME = 'auVariable:shop.ready';
    const SHOP_FAILED_EVENT_NAME = 'auVariable:shop.failed';
    const DEFAULT_DATA_DISPLAY = {
        hasData: false,
        hasError: false
    };
    const DEFAULT_DATA_PRODUCT = {
        olsSalesAttribute: {},
        salesPrice: {
            residualValueInstallment: {}
        }
    };
    const DEFAULT_DATA_SHOP = {
        businessHours: {},
        services: {},
        servicesRaw: {}
    };

    var products = {};
    var containerProducts = {};
    var vueProducts = {};
    let shop = {};
    let containerShops = {};
    let vueShops = {};
    let isMetaUpdated = false;

    /**
     * OLS商品コード取得。
     * 
     * @returns {String[]} OLS商品コード
     */
    var getOlsProductCodes = function () {
        var productPath = '/' + window.productDataLayerAPI.DATA_LAYER_KEY;
        var productCodes = window.productDataLayerAPI.get(productPath);
        var olsProductCodes = [];
        $.each(productCodes, function() {
            $.each(this, function() {
                olsProductCodes.push(this);
            });
        });
        return olsProductCodes;
    }

    /**
     * 商品詳細取得。
     * 
     * @param {String[]} olsProductCodes OLS商品コード
     * @returns {Object} 商品詳細
     */
    var getAsyncProducts = function (olsProductCodes) {
        var selector = "";
        $.each(olsProductCodes, function() {
            selector = selector + "." + this;
        });

        // サーバへアクセス
        let vc = document.querySelector("[id^='variableContainer-']");
        let url = "";
        if(vc.getAttribute("servlet-version") == "v2") {
            url = JSON_URL_GET_PRODUCT_DETAIL_V2 + selector +  JSON_URL_EXT;
        }else{
            url = JSON_URL_GET_PRODUCT_DETAIL + selector +  JSON_URL_EXT;
        };

        // データ
        var data = {};
        data.currentPagePath = CommonUtil.getCurrentPagePath();
        data = CommonUtil.appendOlsApiParams(data);

        $.ajax({
            type : 'GET',
            dataType : 'json',
            url : url,
            data : data
        }).done( function (result, textStatus, jqXHR) {
            console.log(result);
            products = result;
            $(document).trigger(PRODUCT_READY_EVENT_NAME);
        }).fail( function (jqXHR, textStatus, errorThrown) {
            console.log(jqXHR);
            $(document).trigger(PRODUCT_FAILED_EVENT_NAME);
        });
    };

    /**
     * 店舗詳細取得。
     * 
     * @param {String} shopId 店舗特定コード
     * @returns {Object} 店舗詳細
     */
    const getAsyncShop = function () {

        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.ready, function(){
            shop = window.auDataLayer.get('/storeLocator');
            $(document).trigger(SHOP_READY_EVENT_NAME);
        });
        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.failed, function(){
            shop = window.auDataLayer.get('/storeLocator');
            $(document).trigger(SHOP_FAILED_EVENT_NAME);
        });
        window.auDataLayer.storeLocator.initStoreLocatorBySingleStore();
    }

    /**
     * データ表示。
     * 
     * @param {VueObject} Vueオブジェクト
     */
    var showData = function(vm) {
        vm.$set(vm.display, 'hasData', true);
    }

    /**
     * エラー表示。
     * 
     * @param {VueObject} Vueオブジェクト
     */
    var showError = function(vm) {
        vm.$set(vm.display, 'hasError', true);
    }

    /**
     * エラー表示対象の製品かどうか。
     * 
     * @param {Object} 製品オブジェクト
     */
    var isErrorProduct = function(product) {
        return !product || !product.productStockCode;
    }

    /**
     * 非表示の製品かどうか。
     * 
     * @param {Object} 製品オブジェクト
     */
    var isHideProduct = function(product) {
        return !product || !product.isDisplayPrice;
    }

    /**
     * エラー表示対象の店舗かどうか。
     * 
     * @param {Object} 店舗オブジェクト
     */
    const isErrorShop = function(shop) {
        return !shop || !Object.keys(shop).length || shop.errorInfo;
    }

    /**
     * Vueオブジェクト生成。
     * 
     * @param {Element} 変数コンテナ
     */
    var createVue = function(variableContainer) {
        return new Vue({
            el: variableContainer,
            data: {
                display: DEFAULT_DATA_DISPLAY,
                product: DEFAULT_DATA_PRODUCT,
                shop: DEFAULT_DATA_SHOP
            },
            filters: {
                formatNumber: CommonUtil.formatNumber
            },
            updated: function() {

                const shop = this.shop;
                // ショップ検索の場合、1回だけメタデータを更新する
                if (shop.shopNo && !isMetaUpdated) {
                    metaDataReplace();
                    isMetaUpdated = true;
                } else if (this.display.hasError) {
                    document.title = 'エラー';
                    isMetaUpdated = true;
                }
            }
        });
    }

    /**
     * メタデータの更新
     */
    const metaDataReplace = function () {
        // title
        if (document.title) {
            document.title = contentReplace(document.title);
        }

        // description
        let description = $("meta[name='description']").attr('content');
        if (description) {
            $("meta[name='description']").attr('content', contentReplace(description));
        }

        // keywords
        let keywords = $("meta[name='keywords']").attr('content');
        if (keywords) {
            $("meta[name='keywords']").attr('content', contentReplace(keywords));
        }

        // 構造化JSON
        let structuredJson = $('script[type="application/ld+json"]').html();
        if (structuredJson) {
            $('script[type="application/ld+json"]').html(contentReplace(structuredJson));
        }
    }

    /**
     * 
     * {{shop.xxx}} の形式の変数を探して置換する.
     * 
     * @param {*} src 置換元文字列
     * @returns 置換後文字列
     */
    const contentReplace = function (src) {
        let result = src;
        let matches = src.match(/\{\{shop\..*?\}\}/g);
        $.each(matches, function (i, match) {
            let key = match.replace(/\{\{shop\./g, '');
            key = key.replace(/\}\}/g, '');
            result = result.replace(match, shop[key]);
        });

        return result;
    }

    /**
     * 製品情報取得終了処理。
     * 
     * @param {Object} イベント
     */
    var selectProduct = function(event) {
        $.each(Object.keys(vueProducts), function() {
            var containerId = this;
            var vueProduct = vueProducts[containerId];
            vueProduct.$set(vueProduct.display, 'hasData', false);
            vueProduct.$set(vueProduct.display, 'hasError', false);
            vueProduct.$set(vueProduct, 'product', DEFAULT_DATA_PRODUCT);

            var olsProductCode = null;
            if (event && event.eventInfo && event.eventInfo.olsProductCode) {
                olsProductCode = event.eventInfo.olsProductCode;
            }

            if (!olsProductCode) {
                return;
            }

            var targetProduct = null;
            $.each(products, function() {
                var product = this;
                if (product.olsProductCode == olsProductCode) {
                    targetProduct = product;
                }
            });

            if (isHideProduct(targetProduct)) {
                return;
            }

            if (isErrorProduct(targetProduct)) {
                showError(vueProduct);
                return;
            }

            vueProduct.$set(vueProduct, 'product', jQuery.extend({}, vueProduct.product, targetProduct));
            showData(vueProduct);
        });
    }

    /**
     * 製品情報取得終了処理。
     */
    var readyProduct = function() {
        $.each(Object.keys(containerProducts), function() {
            var containerId = this;
            var containerProduct = containerProducts[containerId];
            if (!vueProducts[containerId]) {
                vueProducts[containerId] = createVue(containerProduct);
            }
        });
        window.productDataLayerAPI.addEventListener(window.productDataLayerAPI.SELECT_EVENT_NAME, function (event) {
            selectProduct(event);
        });
    }

    /**
     * 製品情報初期化。
     */
    var initializeProduct = function() {
        var $variableContainers = $('.cmp-au-com-variable-container');
        var $containerProducts = $('.cmp-au-com-container[data-cmp-source="product"]', $variableContainers);
        $containerProducts.each(function() {
            var containerProduct = this;
            var $containerProduct = $(containerProduct);
            var containerId = $containerProduct.attr('id');
            if (!containerProducts[containerId]) {
                containerProducts[containerId] = containerProduct;
            }
        });
        if (Object.keys(containerProducts).length) {
            var olsProductCodes = getOlsProductCodes();
            getAsyncProducts(olsProductCodes);
        }
    }

    /**
     * 店舗情報取得終了処理。
     */
    const selectShop = function() {
        $.each(Object.keys(vueShops), function() {
            const containerId = this;
            const vueShop = vueShops[containerId];
            vueShop.$set(vueShop.display, 'hasData', false);
            vueShop.$set(vueShop.display, 'hasError', false);
            vueShop.$set(vueShop, 'shop', DEFAULT_DATA_SHOP);

            if (isErrorShop(shop)) {
                showError(vueShop);
                return;
            }

            vueShop.$set(vueShop, 'shop', jQuery.extend({}, vueShop.shop, shop));
            showData(vueShop);
        });
    }

    /**
     * 店舗情報取得終了処理。
     */
    const readyShop = function() {
        $.each(Object.keys(containerShops), function() {
            const containerId = this;
            const containerShop = containerShops[containerId];
            if (!vueShops[containerId]) {
                vueShops[containerId] = createVue(containerShop);
            }
        });
        selectShop();
    }

    /**
     * 店舗情報初期化。
     */
    const initializeShop = function() {
        const $variableContainers = $('.cmp-au-com-variable-container');
        const $containerShops = $('.cmp-au-com-container[data-cmp-source="shop"]', $variableContainers);
        $containerShops.each(function() {
            const containerShop = this;
            const $containerShop = $(containerShop);
            const containerId = $containerShop.attr('id');
            if (!containerShops[containerId]) {
                containerShops[containerId] = containerShop;
            }
        });
        if (Object.keys(containerShops).length) {
            getAsyncShop();
        }
    }

    $(document).on(window.productDataLayerAPI.READY_EVENT_NAME, function() {
        if (CommonUtil.isAuthorEditor()) {
            return;
        }
        $(document).on(PRODUCT_READY_EVENT_NAME, function() {
            readyProduct();
        });
        $(document).on(PRODUCT_FAILED_EVENT_NAME, function() {
            readyProduct();
        });
        initializeProduct();
    });

    $(function() {
        if (CommonUtil.isAuthorEditor()) {
            return;
        }
        $(document).on(SHOP_READY_EVENT_NAME, function() {
            readyShop();
        });
        $(document).on(SHOP_FAILED_EVENT_NAME, function() {
            readyShop();
        });
        initializeShop();
    });
})(jQuery);

(function ($) {
    'use strict';

    var ADD_NUM = 8;

    $(function () {
        // クエリパラメータを取得し検索条件のvalueに設定
        var param = [];
        var keyValues = location.search.substring(1).split('&');
        if (location.search) {
            for (var i = 0; keyValues[i]; i++) {
                var keyValue = keyValues[i].split('=');
                param[keyValue[0]] = keyValue[1];
            }
        }
        if (param.productcategory) {
            $('[name=category_id]').val(param.productcategory);
        }
        if (param.maker) {
            $('[name=maker_id]').val(param.maker);
        }
        if (param.keyword) {
            $('[name=terminal_name]').val(decodeURI(param.keyword));
            collateInputKeywords(decodeURI(param.keyword));
        } else {
            showItems(null);
        }
    });

    $(function () {
        $('input[name=terminal_name]').autocomplete({
            source: function (req, resp) {
                var ctgs = $('[name=hidCtgs]').val();
                var suggestUrl = $('[name=hidSuggestUrl]').val();
                $.ajax({
                    url: suggestUrl,
                    type: "get",
                    cache: false,
                    dataType: "jsonp",
                    data: {
                        product_category: ctgs,
                        keyword: $('input[name=terminal_name]').val(),
                    },
                    success: function (json) {
                        var result = [];
                        if (json.terminalList) {
                            $.each(json.terminalList, function (i, val) {
                                var prodName = val.pet_name;
                                if (val.product_name != "") {
                                    prodName = prodName + " " + val.product_name
                                }
                                result.push(prodName);
                            });
                        }
                        resp(result);
                    },
                    error: function (xhr, ts, err) {
                        console.log("err:", err);
                    }
                });
            }
        });
    });

    // 検索条件により表示するアイテムを選別
    function showItems(collatedInputKeywords) {
        var matchCount = 0;
        var selectedCategoryVal = $('[name=category_id]').val();
        var selectedMakerVal = $('[name=maker_id]').val();
        var inputKeywords = $('[name=terminal_name]').val();
        $('.cmp-au-com-supportByProd__cardBox__ctr').addClass('is-hidden');
        var $items = $('.cmp-au-com-supportByProd__cardBox__ctr.is-hidden');
        $items.each(function () {
            var $item = $(this);
            var category = $item.data('category');
            var maker = $item.data('maker');
            var suggestkeyword = $item.data('suggestkeyword');
            var isMatch = false;
            if (selectedCategoryVal == '' || category == selectedCategoryVal) {
                isMatch = true;
                if (selectedMakerVal == '' || maker == selectedMakerVal) {
                    if (inputKeywords) {
                        isMatch = includesKeyword(suggestkeyword, collatedInputKeywords);
                    }
                } else {
                    isMatch = false;
                }
            }
            if (isMatch) {
                matchCount++;
                $item.addClass('selected');
                $('.cmp-au-com-supportByProd__noData').hide();
                if (matchCount <= ADD_NUM) {
                    // 最初の8件まで表示
                    $item.removeClass('is-hidden');
                }
            } else {
                $item.removeClass('selected');
            }
        });
        if (matchCount > ADD_NUM) {
            // 検索結果が8件以上の場合もっと見るボタンを表示
            $('.cmp-au-com-supportByProd__moreBtn').css('display', 'block');
        } else {
            // 検索結果が8件以下の場合もっと見るボタンは表示しない
            $('.cmp-au-com-supportByProd__moreBtn').hide();
            if (matchCount == 0) {
                // 検索結果が0の場合検索結果無し時メッセージを表示
                $('.cmp-au-com-supportByProd__noData').css('display', 'block');
            }
        }
        setResultMsg(matchCount);
    }

    // 入力されたキーワードを名寄せする
    function collateInputKeywords(inputKeywords) {
        $.ajax({
            url: '/bin/wcm/au-com/pimCollateStrings.json',
            type: 'GET',
            cache: false,
            data: {
                suggestKeyword: inputKeywords
            },
        }).done(function (collatedInputKeywords, status, xhr) {
            showItems(collatedInputKeywords);
        }).fail(function(data) {
            // 検索結果無し時メッセージを表示
            $('.cmp-au-com-supportByProd__noData').css('display', 'block');
        })
    }

    // 名寄せされたキーワードがサジェストキーワードに含まれるか判定
    function includesKeyword(suggestkeyword, collatedInputKeywords) {
        var isMatch = false;
        if (collatedInputKeywords) {
            for (var i in collatedInputKeywords) {
                var collatedKeyword = collatedInputKeywords[i];
                if (suggestkeyword.includes(collatedKeyword)) {
                    isMatch = true;
                } else {
                    isMatch = false;
                    break;
                }
            }
        }
        return isMatch;
    }

    $('.cmp-au-com-supportByProd__searchBtn').on('click', function () {
        var category = $('[name=category_id]').val();
        var maker = $('[name=maker_id]').val();
        var suggestkeyword = $('[name=terminal_name]').val();
        var currentUrl = location.href;
        var splitUrl = currentUrl.split('?');
        var url = splitUrl[0];
        var queryList = [];
        var queryParam = '';
        var searchParams = ['productcategory', 'maker', 'keyword'];

        // 検索条件以外のパラメータを残す
        if (splitUrl.length >= 2) {
            var queryStr = splitUrl[1];
            queryList = queryStr.split('&');
            queryList = queryList.filter(function(item){
                var result = true;
                for (var i in searchParams) {
                    var param = searchParams[i];
                    if (item.indexOf(param) == 0) {
                        result = false;
                        break;
                    }
                }
                return result;
            })
        }

        // クエリパラメータに検索条件を設定
        if (category) {
            queryList.push(searchParams[0] + '=' + category);
        }
        if (maker) {
            queryList.push(searchParams[1] + '=' + maker);
        }
        if (suggestkeyword) {
            queryList.push(searchParams[2] + '=' + suggestkeyword);
        }
        if (queryList.length > 0) {
            queryList.forEach(function(item, index) {
                if (queryParam) {
                    queryParam += '&';
                }
                queryParam += item;
            })
        }

        if (queryParam) {
            url += '?' + queryParam;
        }

        window.history.pushState(null, null, url);
        if (suggestkeyword) {
            collateInputKeywords(suggestkeyword);
        } else {
            showItems(null);
        }
    });

    $('.cmp-au-com-supportByProd__moreBtn').on('click', function () {
        // もっと見るボタンが押された際に追加で製品を表示する
        var $unDisplayedItems = $('.cmp-au-com-supportByProd__cardBox__ctr.is-hidden.selected');
        if ($unDisplayedItems.length > ADD_NUM) {
            $unDisplayedItems.slice(0, ADD_NUM).removeClass('is-hidden');
        } else {
            // 表示されていない製品が8件以下の場合はもっと見るボタンを隠す
            $unDisplayedItems.removeClass('is-hidden');
            $('.cmp-au-com-supportByProd__moreBtn').hide();
        }
    });

    // 検索結果件数の表示文言作成
    function setResultMsg(matchCount) {
        var resultNum = matchCount;
        var resutlMsg = '検索結果（合計：' + resultNum + '件）';
        $('.cmp-au-com-supportByProd__resultTotal').text(resutlMsg);
    }

})(jQuery);
/* product_IntroImage.js */
(function($) {
    $(function(){
        $(document).on('click', '.product-color', function(){
            var $productColor = $(this),
                strFigure = $productColor.attr('data-figure'),
                $productDisplay = $productColor.parents('.product-display'),
                $productFigure = $('.product-figure', $productDisplay),
                numFadeSpeed = 300,
                strEasing = 'swing'
            ;

            // カラバリセレクタ切り替え
            $('.product-color').removeClass('is-selected');
            var $figureKey = $('.' + strFigure);
            $figureKey.addClass('is-selected');

            // カラバリ名切り替え
            var colorName = $($figureKey.find('.produnt-color-label')[0]).text();
            $('span.color-variation-name').text(colorName);

            // 端末価格切り替え
            var productPrice = $figureKey.data('productPrice');
            var $productPriceValuePrice = $('span.product-price-value-price');
            if (productPrice != undefined) {
                $productPriceValuePrice.text(productPrice);
                $('.product-price-inner').css('display', 'inline');
                $('.product-price-disabled').css('display', 'none');
            } else {
                $productPriceValuePrice.text('');
                $('.product-price-inner').css('display', 'none');
                $('.product-price-disabled').css('display', 'inline');

            }

            // オンラインショップステータス切り替え
            var stockStatus = $figureKey.data('stockStatus');
            var $productStockStatusValue = $('span.product-stock-status-value');
            var $productStockStatus = $('span.product-stock-status');
            if (stockStatus != undefined) {
                $productStockStatusValue.text(stockStatus);
                $productStockStatus.css('display', '')
            } else {
                $productStockStatusValue.text('');
                $productStockStatus.css('display', 'none')
            }

            // 画像切り替え
            $('img[data-figure="' + strFigure + '"]')
                .css('z-index', 1)
                .fadeIn(numFadeSpeed, strEasing)
                .siblings('img')
                .css('z-index', 0)
                .fadeOut(numFadeSpeed, strEasing)
            ;

            // 表示制御前のスクロール位置とカラーバリエーションボタンの位置を取得
            var scrollPositionBefore = $(window).scrollTop();
            var buttonPositionBefore = $(this).length ? $(this).offset().top : 0;

            // 表示制御
            window.olsProductDetail.displayControl();

            // 選択製品切り替え（変数コンテナ制御用）
            var olsProductCode = $figureKey.data('olsProductCode');
            if (olsProductCode) {
                window.productDataLayerAPI.addEventTrigger(window.productDataLayerAPI.SELECT_EVENT_NAME, {olsProductCode: olsProductCode});
            }

            // 表示制御後のスクロール位置とカラーバリエーションボタンの位置をを取得
            var scrollPositionAfter = $(window).scrollTop();
            var buttonPositionAfter = $(this).length ? $(this).offset().top : 0;
            var adjustPosition = buttonPositionAfter - buttonPositionBefore;
            // スクロール位置の調整　※ブラウザでスクロール位置の調整がされていない場合のみ
            if (adjustPosition != 0 && scrollPositionBefore == scrollPositionAfter) {
                // 差分をスクロール位置に反映
                $(window).scrollTop(scrollPositionAfter + adjustPosition);
            }
       });

        // 初期選択製品（変数コンテナ制御用）
        var $selectedElement = $('.is-selected[data-ols-product-code]');
        if ($selectedElement.length) {
            var selectedOlsProductCode = $selectedElement.eq(0).data('olsProductCode');
            if (selectedOlsProductCode) {
                window.productDataLayerAPI.addEventTrigger(window.productDataLayerAPI.SELECT_EVENT_NAME, {olsProductCode: selectedOlsProductCode});
            }
        }
    });
})(jQuery);
(function($) {
    $(function(){

        var strClassDisplay = 'toolTip-display',
            strClassPositionTop = 'toolTip-top',
            strClassPositionBottom = 'toolTip-bottom',
            timer = false,
            setTipHidden = function() {
                $('.' + strClassDisplay)
                    .removeClass(strClassDisplay)
                    .removeClass(strClassPositionTop)
                    .removeClass(strClassPositionBottom)
                ;
                $('.toolTip').removeAttr('style');
            },
            setTipDisplayed = function($tipContainer, blnRemain) {
                setTipHidden();

                if (!$tipContainer.hasClass(strClassDisplay) || blnRemain) {
                    var $tip = $('.toolTip', $tipContainer),
                        $area = $tip.parents('.toolTip-section'),
                        $localNav = $('#jsi-local-nav'),
                        objLocalNavOffsetTop = $localNav.length ? $localNav.offset().top : 0,
                        numTipWidth = $tip.outerWidth(),
                        numContainerWidth = $tipContainer.outerWidth(),
                        numLeft = (numContainerWidth - numTipWidth) / 2,
                        numLocalNavHeight = $localNav.outerHeight(),
                        numActualScroll = ($localNav.length>0)?numLocalNavHeight + objLocalNavOffsetTop:$(window).scrollTop() //ローカルナビが無い場合はスクロール位置を設定
                    ;

                    $tip.css({left: numLeft});
                    $tipContainer.addClass(strClassPositionTop);

                    var objAreaOffsetLeft = $area.length ? $area.offset().left : 0,
                        objTipContainerOffsetLeft = $tipContainer.length ? $tipContainer.offset().left : 0,
                        objTipOffsetTop = $tip.length ? $tip.offset().top : 0,
                        objTipOffsetLeft = $tip.length ? $tip.offset().left : 0,
                        numAreaWidth =  $area.outerWidth(),
                        numTipContainerWidth = $tipContainer.outerWidth(),
                        numAreaRightEnd = objAreaOffsetLeft + numAreaWidth,
                        numTipContainerRightEnd = objTipContainerOffsetLeft + numTipContainerWidth,
                        numTipRightEnd = objTipOffsetLeft + numTipWidth,
                        numWindowWidth = $(window).width()
                    ;
                    if (numActualScroll > objTipOffsetTop) {
                        $tipContainer
                            .removeClass(strClassPositionTop)
                            .addClass(strClassPositionBottom)
                        ;
                    } else {
                        $tipContainer
                            .removeClass(strClassPositionBottom)
                            .addClass(strClassPositionTop)
                        ;
                    }
                    if (numWindowWidth >= 640) {
                        if (objAreaOffsetLeft > objTipOffsetLeft) {
                            numLeft = objAreaOffsetLeft - objTipContainerOffsetLeft;
                            $tip.css({left: numLeft});
                        }
                        if (numAreaRightEnd < numTipRightEnd) {
                            var numRight = numTipContainerRightEnd - numAreaRightEnd;
                            $tip
                                .removeAttr('style')
                                .css({right: numRight})
                            ;
                        }
                    } else {
                        numLeft = -objTipContainerOffsetLeft;
                        $tip.css({width:numWindowWidth*0.98,left: numLeft});
                    }
                    $tipContainer.addClass(strClassDisplay);
                }
            }
        ;

        $(document)
            .on('click', '.toolTip-caller', function(){
                var $tipContainer = $(this).parent('.toolTip-ctr');
                setTipDisplayed($tipContainer, false);
            })
            .on('click', '.toolTip-closer', setTipHidden)
            .on('click', function(e) {
                if (!$(e.target).closest('.toolTip-ctr').length) {
                    setTipHidden();
                }
            })
        ;

        $(window).on('load resize scroll', function(e){
            if (timer !== false) {
                clearTimeout(timer);
            }
            timer = setTimeout(function(){
                var $tipContainer = $('.toolTip-display');
                if ($tipContainer.length) {
                    setTipDisplayed($tipContainer, true);
                }
            });
        });

        // end of jquery
    });
})(jQuery);
(function($) {
    'use strict'

    var SELECT_TYPE_MANUFACTURER = "manufacturer";
    var SELECT_TYPE_MODEL = "model";
    var PARAM_TYPE_PRODUCT = "product";
    var PARAM_TYPE_MAKER = "maker"; 

    const getQueryParams = function() {
        // URLから絞り込み条件を取得（メーカー名[maker], 機種名[product]）
        const makerParams = AU_COMMON.getParameters(document.location.href, PARAM_TYPE_MAKER);
        const productParams = AU_COMMON.getParameters(document.location.href, PARAM_TYPE_PRODUCT);
        const params = {};
   
        // 取得した絞り込み条件をセット
        params.makers = makerParams;
        params.products = productParams;
        return params;
    }
    // メーカー名での絞り込み処理
    const isTargetMaker = function(makers, manufacturer) {
        // 絞り込み条件のメーカー名と製品のメーカー名が一致する場合、trueを返す。
        return makers.some(maker => maker && manufacturer && maker.toLowerCase() == manufacturer);
    }    
    // 機種名での絞り込み処理
    const isTargetProduct = function(products, model) {
        // 製品の機種名に絞り込み条件の機種名が含まれる場合、trueを返す。
        return products.some(product => product && model && model.indexOf(product.toLowerCase()) != -1);
    }

    $(function() {   
        var $targetNode = $('.product-list');
        if ($targetNode && $targetNode.length) {
            $targetNode.closest('.parts-sec').each(function(index) {
                var $productList = $(this);
                var $products = $('.cardBox', $productList);
                var $imgs = $('img.lazyload', $productList);
                var $result = $('.card-section', $productList);
                var $warnMessage = $('.warn-message', $productList);

                var loadStartAllImg = function() {
                    responsiveImage.prepareLoadAll($imgs, true);
                }
                var matchHeightProduct = function() {
                    if (responsiveImage.confirmLoadAll($imgs)) {
                        var $targetProducts = $products.not('.hide');
                        var $cardInner = $('.cardBox-ctr', $targetProducts);
                        $.fn.matchHeight._apply($cardInner, {
                            byRow: true
                        });
                        return true;
                    } else {
                        return false;
                    }
                }
                var filterProduct = function() {
                    // URLに指定された絞り込み条件を取得
                    const params = getQueryParams();
                    $result.stop().animate({
                        opacity: 0
                    }, {
                        duration: 200,
                        complete: function() {
                            var hasProduct = false;
                            $products.each(function() {
                                var $product = $(this);
                                let result = false;
                                $product.removeClass('hide');
                                // 製品情報を取得（メーカー名, 機種名）
                                var manufacturer = $product.attr(SELECT_TYPE_MANUFACTURER);
                                var model = $product.attr(SELECT_TYPE_MODEL);

                                // メーカー名と機種名での絞り込み条件がある場合                                
                                if (params.makers && params.products) {
                                    result = isTargetMaker(params.makers, manufacturer) && isTargetProduct(params.products, model);
                                // メーカー名のみでの絞り込み条件がある場合
                                } else if (params.makers) {
                                    result = isTargetMaker(params.makers, manufacturer);
                                // 機種名のみでの絞り込み条件がある場合
                                } else if (params.products) {
                                    result = isTargetProduct(params.products, model);
                                // 絞り込み条件がない場合
                                } else {
                                    result = true;
                                }

                                if (result) {
                                    hasProduct = true;
                                } else {
                                    $product.addClass('hide');
                                }
                            });

                            if (hasProduct) {
                                $warnMessage.hide();
                                $result.show();
                            } else {
                                $result.hide();
                                $warnMessage.show();
                            }

                            matchHeightProduct();
                        }
                    }).animate({
                        opacity: 1
                    }, {
                        duration: 800,
                    });
                }

                loadStartAllImg();

                var heightMatched = false;
                $imgs.on('img:load', function() {
                    if (!heightMatched) {
                        heightMatched = matchHeightProduct();
                    }
                });
                filterProduct();
                                
                var resizeTimer = false;
                $(window).on('resize', function(){
                    if (resizeTimer !== false) {
                        clearTimeout(resizeTimer);
                    }
                    resizeTimer = setTimeout(function(){
                        matchHeightProduct();
                    }, 1000);
                })
            });
        }
    });
})(jQuery);

(function($) {
    $(function() {
        "use strict";

        if ($('.productComparisonRegistForDetailV2').length) {

            $(document)
                .on('click', '.productComparisonRegistForDetailV2 .compare-spec-prices-btn', function(event) {
                    // デフォルトの動作をキャンセル
                    event.preventDefault();

                    // クリックされた要素を取得
                    let clickedElement = event.target;
                    // クリックされた要素がaタグでない場合、その先祖のaタグを探す
                    while (clickedElement && clickedElement.tagName !== 'A') {
                        clickedElement = clickedElement.parentElement;
                    }
                    if (clickedElement && clickedElement.tagName === 'A') {
                        // 本ページの製品コードを製品Cookieに登録
                        setCookieComparisonProduct();
                        // 製品比較リストページ（aタグのhref属性に設定されたURL）へ遷移
                        window.location.href = clickedElement.href;
                    }
                })
            ;

            $(window)
                .on('load', function() {
                    $('.productComparisonRegistForDetailV2').show();
                })
            ;
        }

    });

    function setCookieComparisonProduct() {
        let comparisonProducts = $('#hidProductCode').val();
        const productsArray = getComparisonProductsArray();
        if (!matchProductCode(productsArray, comparisonProducts)) {
            $.each(productsArray, function(i, product) {
                comparisonProducts = comparisonProducts + '^' + product;
            });
            const encodedProducts = encodeURIComponent(comparisonProducts);
            const date = new Date();
            date.setTime(date.getTime() + 30*24*60*60*1000);
            if ($(location).attr('protocol') == 'https:') {
                document.cookie = 'comparison_product=' + encodedProducts + ';path=/;expires=' + date + ';secure';
            } else {
                document.cookie = 'comparison_product=' + encodedProducts + ';path=/;expires=' + date;
            }
        }
    }

    function getComparisonProductsArray() {
        let returnArray =[];
        if (AU_COMMON.getCookie('comparison_product')) {
            const products = AU_COMMON.getCookie('comparison_product');
            returnArray = products.split('^');
        }
        return returnArray;
    }

    function matchProductCode(productsArray, productCode) {
        let result = false;
        $.each(productsArray, function(i, product) {
            const reg = new RegExp(product, 'i');
            if (productCode.match(reg)) {
                result = true;
                return false;
            }
        });
        return result;
    }

})(jQuery);

(function($) {
    $(function() {
        "use strict";

        if ($('#productComparisonRegistForDetailComponent').length) {

            $(document)
                .on('click', '#productComparisonRegistForDetailComponent .compare-add-btn a', function() {
                    var comparisonProducts = $('#hidProductCode').val();
                    var productsArray = getComparisonProductsArray();
                    var comparisonProductsNum = productsArray.length;
                    if (!matchProductCode(productsArray, comparisonProducts)) {
                        $.each(productsArray, function(i, product) {
                            comparisonProducts = comparisonProducts + '^' + product;
                        });
                        var encodedProducts = encodeURIComponent(comparisonProducts);
                        var date = new Date();
                        date.setTime(date.getTime() + 30*24*60*60*1000);
                        if ($(location).attr('protocol') == 'https:') {
                            document.cookie = 'comparison_product=' + encodedProducts + ';path=/;expires=' + date + ';secure';
                        } else {
                            document.cookie = 'comparison_product=' + encodedProducts + ';path=/;expires=' + date;
                        }
                        comparisonProductsNum++;
                    }
                    changeButtonText();
                    var productsNum = comparisonProductsNum + $('#productComparisonRegistForDetailComponent #numSub').text().trim();
                    $('#productComparisonRegistForDetailComponent .outputCountProductList').text(productsNum);
                    $('#productComparisonRegistForDetailComponent #numSub').hide();
                })
            ;

            $(window)
                .on('load', function() {
                    if (AU_COMMON.getCookie("wcmmode") != "edit"
                        || AU_COMMON.getParameter(document.location.href, 'wcmmode') == 'disabled') {
                        var pageProductCode = $('#hidProductCode').val();
                        var comparisonProductsArray = getComparisonProductsArray();
                        if (!pageProductCode || pageProductCode.trim() === '') {
                            $('#productComparisonRegistForDetailComponent .compare-add-btn').hide();
                        } else {
                            if (matchProductCode(comparisonProductsArray, pageProductCode)) {
                                changeButtonText();
                            }
                        }
                        var num = comparisonProductsArray.length;
                        var sub = $('#numSub').text().trim();
                        $('#productComparisonRegistForDetailComponent .outputCountProductList').text(num + sub);
                        $('#productComparisonRegistForDetailComponent #numSub').hide();
                    }
                    $('#productComparisonRegistForDetailComponent').show();
                })
            ;

        }

        function changeButtonText() {
            $('#productComparisonRegistForDetailComponent .compare-add-btn a').css('pointer-events', 'none');
//            var buttonText = Granite.I18n.get('Added Product');
            var buttonText = '追加済';
            $('#productComparisonRegistForDetailComponent .compare-add-btn a').text(buttonText);
            $('#productComparisonRegistForDetailComponent .compare-add-btn a').css('background-color', 'gray');
        }

        function getComparisonProductsArray() {
            var returnArray =[];
            if (AU_COMMON.getCookie('comparison_product')) {
                var products = AU_COMMON.getCookie('comparison_product');
                returnArray = products.split('^');
            }
            return returnArray;
        }

        function matchProductCode(productsArray, productCode) {
            var result = false;
            $.each(productsArray, function(i, product) {
                var reg = new RegExp(product, 'i');
                if (productCode.match(reg)) {
                    result = true;
                    return false;
                }
            });
            return result;
        }

    });
})(jQuery);

(function($) {
    $(function(){
        var linkSpans = $(".product-specs span.icnBullet");
        for (var i = 0; i < linkSpans.length; i++) {
            var links = $(linkSpans[i]).children("a");
            for (var j = 0; j < links.length; j++) {
                $(links[j]).addClass("link-text-blue txtSize-mSmall");
            }
        }
    });
})(jQuery);
/**
 * ProductComparisonListCls.js
 */

(function ($) {

    'use strict';

    if (window.ProductComparisonListCls) {
        return; // 2重初期化防止
    }
    /**
     * 製品比較リストクラス。
     */
    window.ProductComparisonListCls = (function () {

        /**
         * コンストラクタ。
         */
        var ProductComparisonListCls = function () {
            // 多重生成の抑止
            if (!(this instanceof ProductComparisonListCls)) {
                return new ProductComparisonListCls();
            }
        };

        /** 定数 **********************************************************************************/
        var WINDOW_WIDTH_SMP = 768;                                // スマートフォンの画面幅
        var WINDOW_MIN_WIDTH = 320;                                // 画面幅の最小値
        var PRODUCT_IMAGE_WIDTH = 172;                            // 製品画像の幅（大）
        var COOKIE_NAME_PRODUCT = 'comparison_product';            // Cookieの名前（製品）
        var COOKIE_NAME_COMPARISON_ITEM = 'comparison_item';    // Cookieの名前（比較項目）
        var COOKIE_SEPARATOR = '^';                                // Cookieのセパレータ
        var COOKIE_EXPIRES = 30;                                // Cookieの保存日数
        var COOKIE_PATH = '/';                                    // Cookieのパス
        const PARAM_MODEL_CODE = 'modelcode';                   // URLクエリパラメータの製品コードのキー
        const URL_PARAMETER_PRODUCT_CODE_SEPARATOR = ',';         // URLクエリパラメータの製品コードのセパレータ
        var BTN_CLASS_UNSELECTED = 'btn-negativeGray';            // ボタン未選択
        var BTN_CLASS_SELECTED = 'btn-auOrange';                // ボタン選択済み
        var PRODUCT_CELL_SELECTED = 'product-cell-selected';    // 選択セル
        var SPEC_ITEM_EMPTY = '―';                                // スペック項目（空）
        // 比較項目リスト取得URL
        var JSON_URL_GET_COMPARISON_ITEM = '/bin/wcm/au-com/product-comparison-list/comparison-item.json';
        // 製品リスト取得URL
        var JSON_URL_GET_PRODUCT_LIST = '/bin/wcm/au-com/product-comparison-list/product-list.json';


        /** 変数 **********************************************************************************/
        var cookieArrayProduct = [];                // Cookieから取得した製品コードの配列
        var cookieArrayComparisonItem = [];            // Cookieから取得した比較項目の配列
        var urlParamArrayProduct = [];                // URLクエリパラメータから取得した製品コードの配列
        var productList = null;                    // 製品リスト
        var comparisonItemList = null;                // 比較項目リスト
        var comparisonItemInitialDisplayList = null;        // 比較項目リスト（初期表示）
        var $win;
        var $productComparisonList;
        var $comparisonList, $comparisonGuideSection, $comparisonListSection, $comparisonButtonSection;
        let $comparisonButtonSectionAddProduct;
        var $comparisonListFloat, $comparisonListFloatTable;
        var $comparisonListScroll, $comparisonListScrollTable, $comparisonListScrollTableSpecRow;
        var $comparisonListSlideLeft, $comparisonListSlideRight;
        var $comparisonListLabel;
        let $productListModal, $productListArea, $productListSelectModel,
            $productListShowProductArchiveLabel, $productListSearch;
        var $comparisonItemModal, $comparisonItemArea;
        var scrollHint;                                        // スクロールヒント
        var localNavHeight = 0;                                // ローカルナビの高さ
        var comparisonListScrollWidth = 0;                    // 比較リスト（スクロール）の幅
        var comparisonListScrollTableOffsetTop = 0;            // 比較リスト（スクロール）の先頭位置
        var comparisonListScrollTableSpecOffsetTop = 0;        // 比較リスト（スクロール）のスペック行の先頭位置
        var comparisonListFloatLimit = 0;                    // 比較リスト（フローティング）の表示限界
        var isDisplayPrice = false; // 機種代金表示の有無

        /** メソッド ******************************************************************************/
        var p = ProductComparisonListCls.prototype;

        /**
         * 初期処理。
         */
        p.init = function () {
            // 編集時はスキップ
            if (AU_COMMON.getCookie("wcmmode") == "edit"
                && AU_COMMON.getParameter(document.location.href, 'wcmmode') != 'disabled') {
                return;
            }

            // 変数取得
            $win = $(window);
            $productComparisonList = $('.product-comparison-list');
            $comparisonGuideSection = $productComparisonList.find('.comparison-guide-section');
            $comparisonListSection = $productComparisonList.find('.comparison-list-section');
            $comparisonButtonSection = $productComparisonList.find('.comparison-button-section');
            $comparisonButtonSectionAddProduct = $comparisonButtonSection.find('a[data-target="#product_list_modal"]');
            $comparisonList = $comparisonListSection.find('.comparison-list');
            $comparisonListFloat = $comparisonList.find('.float-product');
            $comparisonListFloatTable = $comparisonListFloat.find('.table');
            $comparisonListScroll = $comparisonList.find('.scroll-product');
            $comparisonListScrollTable = $comparisonListScroll.find('.table');
            $comparisonListScrollTableSpecRow = $comparisonListScrollTable.find('.comparison-row.spec-row');
            $comparisonListSlideLeft = $comparisonList.find('.slide-left');
            $comparisonListSlideRight = $comparisonList.find('.slide-right');
            $comparisonListLabel = $comparisonList.find('.spec-label');
            $productListModal = $productComparisonList.find('.product-list-modal');
            $productListSelectModel = $productListModal .find('.select-model');
            $productListShowProductArchiveLabel = $productListModal.find('.show-product-archive-label');
            $productListSearch = $productListModal.find('.product-search');
            $productListArea = $productListModal.find('.product-list-area');
            $comparisonItemModal = $productComparisonList.find('.comparison-item-modal');
            $comparisonItemArea = $comparisonItemModal.find('.comparison-item-area');

            // Windowのイベント登録
            addWindowEvent();
            // Cookieの取得
            getCookie();
            // URLクエリパラメータの取得
            getProductUrlParams();
            // 比較項目、製品リストの取得
            $.when(getComparisonItemList(), getProductList()).done( function () {
                // スクロールヒントを作成
                setScrollHint();
                // 比較リストのリロード
                reloadComparisonList();
            });
        };

        /**
         * 比較項目のクリアボタンクリックイベント。
         * @param {Object} elm クリックしたボタンのElement。
         */
        p.clickComparisonItemClear = function (elm) {
            // 比較項目のリセット
            resetComparisonItem();
        };

        /**
         * 比較項目の反映ボタンクリックイベント。
         * @param {Object} elm クリックしたボタンのElement。
         */
        p.clickComparisonItemReflection = function (elm) {
            // チェック済みの比較項目の保存
            saveCkechedComparisonItem();
            // 比較リストのリロード
            reloadComparisonList();
        };

        /** Windowの操作 **************************************************************************/

        /**
         * Windowのイベントを登録する。
         */
        var addWindowEvent = function () {
            // スクロールイベント
            $win.on('load scroll', scrollWindow);
            $comparisonListScroll.on('scroll', scrollComparisonList);
            // リサイズイベント
            $win.on('resize', resizeWindow);
            // ドラッグスクロールイベント
            dragScrollComparisonList();
            // 左スライドクリックイベント
            $comparisonListSlideLeft.on('click', clickLeftSlideComparisonList);
            // 右スライドクリックイベント
            $comparisonListSlideRight.on('click', clickRightSlideComparisonList);

        };

        /**
         * Windowスクロールイベント。
         * @param {Object} e jQueryイベント
         */
        var scrollWindow = function (e) {
            // フローティングラベルの表示位置設定
            setComparisonListFloat();
        };

        /**
         * Windowリサイズイベント。
         * @param {Object} e jQueryイベント
         */
        var resizeWindow = function (e) {
            // 比較リストのラベルを調整する。
            adjustComparisonListSpecLabel();
        };

        /**
         * Window内の各コンポーネントの位置を取得する。
         */
        var getWindowComponentPosition = function () {
            // ローカルナビの位置取得
            localNavHeight = $('.mainHeadLocalNav').height();
            // 比較エリアの幅と高さ取得
            comparisonListScrollWidth = $comparisonListScroll.width();
            var comparisonListScrollImageRowHeight = $comparisonListScroll.find('.image-row').height();
            // フローティングラベルの高さ取得
            var comparisonFloatProductHeight = $comparisonListFloat.height();
            // フローティングラベルの位置設定
            $comparisonListFloat.css('top', localNavHeight);
            $comparisonListFloat.css('width', comparisonListScrollWidth - 1 + 'px');
            let comparisonListScrollOffsetLeft = $comparisonListScroll.length ? $comparisonListScroll.offset().left : 0;
            $comparisonListFloat.css('left', comparisonListScrollOffsetLeft + 1 + 'px');
            // フローティングラベルの表示境界値取得
            comparisonListScrollTableOffsetTop = $comparisonListScrollTable.length ? $comparisonListScrollTable.offset().top : 0;
            comparisonListScrollTableOffsetTop = comparisonListScrollTableOffsetTop - localNavHeight
                + (comparisonListScrollImageRowHeight - comparisonFloatProductHeight);
            let comparisonListScrollTableSpecRowOffsetTop = $comparisonListScrollTableSpecRow.length ? $comparisonListScrollTableSpecRow.offset().top : 0;
            comparisonListScrollTableSpecOffsetTop = comparisonListScrollTableSpecRowOffsetTop;
        };

        /**
         * 比較リストのドラッグスクロールイベント。
         */
        var dragScrollComparisonList = function () {

            if (window.ontouchstart === null) {
                // タッチデバイスの場合はイベント登録しない
                return;
            }

            // カーソル変更
            $comparisonListScroll.css('cursor', 'grab');
            // mousedownイベント
            $comparisonListScroll.on('mousedown', function (event) {
                // 比較リストにマーキング
                $(this).data('down', true)
                .data('x', event.clientX)
                .data('scrollLeft', this.scrollLeft);
                return false;
            });
            // mousemoveイベント
            $(document).on('mousemove', function (event) {
                if ($comparisonListScroll.data('down') == true) {
                    // 横スクロール
                    $comparisonListScroll.scrollLeft($comparisonListScroll.data('scrollLeft') + $comparisonListScroll.data('x') - event.clientX);
                    // カーソル変更
                    $comparisonListScroll.css('cursor', 'grabbing');
                    return false;
                }
            });
            // mouseupイベント
            $(document).on('mouseup', function (event) {
                // 比較リストのマーキング解除
                $comparisonListScroll.data('down', false);
                // カーソル変更
                $comparisonListScroll.css('cursor', 'grab');
            });
        };

        /** 比較リストの操作 ******************************************************************/

        /**
         * 比較リストスクロールイベント。
         * @param {Object} e jQueryイベント
         */
        var scrollComparisonList = function (e) {
            // 製品比較リストのフローティングラベルの横スクロール位置を設定する
            setComparisonListFloatScrollLeft();
        };

        /**
         * 比較リストのスペック行を作成する。
         */
        var createComparisonListSpecRow = function () {

            // 価格
            // 行を作成
            var $row = $('<div>');
            $row.addClass('comparison-row');
            $row.attr('data-comparison-item-key', 'price');
            // 行を追加
            $comparisonListScrollTable.append($row);

            // 比較項目の数だけ繰り返す
            $.each(comparisonItemList, function (i, elm) {
                // 行を作成
                var $row = $('<div>');
                $row.addClass('comparison-row');
                $row.attr('data-comparison-item-key', elm.tagId);
                // 行を追加
                $comparisonListScrollTable.append($row);
            });
        };

        /**
         * 製品比較リストをリロードする。
         */
        var reloadComparisonList = function () {
            // ローディング画面表示
            window.loading.start();
            // 比較リストの全ての行のセルを全て削除
            $.each($comparisonListFloatTable.children(), function (i, elm) {
                $(this).empty();
            });
            $.each($comparisonListScrollTable.children(), function (i, elm) {
                $(this).empty();
            });
            if (!urlParamArrayProduct || urlParamArrayProduct.length === 0) {
                // URLクエリパラメータで製品コードの指定がない場合は、cookieの製品リストを再設定
                resetProductCookie();
            }
            // CookieまたはURLクエリパラメータの製品コードを取得
            var selectedProductList = getSelectedProductList();

            if (selectedProductList.length > 0) {
                // 製品コードがある場合、比較リストに追加
                $.each(selectedProductList, function (i,elm) {
                    addComparisonList(elm);
                });
                // Lazy Load
                var $imgs = $comparisonList.find('img');
                responsiveImage.lazyload($imgs, true);
                $imgs.on('img:load', function() {
                    if (responsiveImage.confirmLoadAll($imgs)) {
                        adjustComparisonListSpecLabel();
                    }
                });

                // 比較リストを表示する
                $comparisonListSection.show();
                // 比較リストのガイドを非表示にする
                $comparisonGuideSection.hide();
                // 比較リストのスペックラベルを設定する
                setComparisonListSpecLabel();
                if (urlParamArrayProduct && urlParamArrayProduct.length > 0) {
                    // URLクエリパラメータで製品コードの指定がある場合は、「製品を追加」ボタンを非表示にする
                    $comparisonButtonSection.addClass('url-params');

                }    
                // 比較リストのボタンを表示する
                $comparisonButtonSection.show();
            } else {
                // Cookieに製品コードがない場合
                // 比較リストを非表示にする
                $comparisonListSection.hide();
                // 比較リストのガイドを表示する
                $comparisonGuideSection.show();
                // ローディング画面消去
                window.loading.stop();
                // 比較リストのボタンを非表示にする
                $comparisonButtonSection.hide();
            }
            // スライドボタン設定
            setSlideButton();
        };

        /**
         * 比較リストに製品を追加する。
         * @param {string} productCode 追加する製品コード
         */
        var addComparisonList = function (productCode) {
            var productItem = productList[productCode];
            // 製品イメージを追加
            addComparisonListItemImage(productItem);
            // 製品名とイメージを追加（フローティング用）
            addComparisonListFloating(productItem);

            // 価格
            var $row = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="price"]');
            var $cell = $('<div>');
            $cell.addClass('comparison-cell price');
            if (productItem.price) {
                $cell.html(CommonUtil.formatNumber(productItem.price) + "円");
            } else {
                $cell.html(SPEC_ITEM_EMPTY);
            }
            $cell.attr('data-product-code', productCode);
            $row.append($cell);

            // 比較項目を追加
            $.each(comparisonItemList, function (i, elm) {
                if (hasComparisonItemCookie(elm.tagId)) {
                    // 比較項目で選択されたものだけを表示対象
                    var $row = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="' + elm.tagId + '"]');
                    var textValue = productItem.specMap[elm.tagId];
                    var $cell = $('<div>');
                    $cell.addClass('comparison-cell spec');
                    if (textValue && textValue !== '') {
                        $cell.html(textValue);
                    } else {
                        $cell.html(SPEC_ITEM_EMPTY);
                    }
                    $cell.attr('data-product-code', productCode);
                    $row.append($cell);
                }
            });
        };

        /**
         * 製品イメージを比較リストに追加する。
         * @param {Object} productItem 製品
         */
        var addComparisonListItemImage = function (productItem) {
            var $row = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key=list_product_image_url]');
            var $header = $('<div>');
            $header.addClass('cardBox-header');
            if (!urlParamArrayProduct || urlParamArrayProduct.length === 0) {
                // URLクエリパラメータで製品コードの指定がない場合は、製品の削除ボタンを表示する
                var $closebtn = $('<input>');
                $closebtn.attr('type', 'image');
                $closebtn.addClass('itemCloseBtn');
                $closebtn.attr('src', '/etc.clientlibs/settings/wcm/designs/au-com/clientlib-site/resources/images/icon/icon_close_circle_gray.png');
                $closebtn.on('click', clickProductItemRemoveEvent);
                $header.append($closebtn);
            }
            var $img = $('<img>');
            $img.attr('data-original', productItem.listProductImageUrl);
            $img.attr('data-alternative', productItem.listProductImageUrlOrg);
            $img.attr('alt', productItem.productName);
            var $link = $('<a>');
            $link.addClass('link-img cardBox-cont');
            $link.attr('href', productItem.detailUrl);
            $link.attr('target', '_blank');
            $link.append($img);

            var enableBuyBtn = false;
            var olsStatusCode = productItem.olsStatusCode;
            if (productItem.olsStatusCode && (olsStatusCode == '10' || olsStatusCode == '20' || olsStatusCode == '30')) {
                    enableBuyBtn = true;
            } else {
                if (productItem.reserveStatus == '10') {
                    enableBuyBtn = true;
                }
            }
            if (enableBuyBtn) {
                var $buyBtn = $('<a>');
                $buyBtn.attr('href', productItem.detailUrl);
                $buyBtn.addClass('btnElem btn-basicauOrange cardBox-btn-center btn-width-full');
                $buyBtn.html('予約・購入');
                var $footer = $('<div>');
                $footer.addClass('cardBox-footer padding-r-20 padding-l-20 padding-r-sp-10 padding-l-sp-10');
                $footer.append($buyBtn);
            }

            var $box = $('<div>');
            $box.addClass('link-box');
            $box.append($header);
            $box.append($link);
            $box.append($footer);
            var $cell = $('<div>');
            $cell.addClass('comparison-cell');
            $cell.attr('data-product-code', productItem.productCode);
            $cell.append($box);
            $row.append($cell);
        };

        /**
         * フローティング用の製品名とイメージを比較リストに追加する。
         * @param {Object} productItem 製品
         */
        var addComparisonListFloating = function (productItem) {
            // 画面の幅を取得
            var winWidth = $win.width();
            var $row = $comparisonListFloatTable.find('.comparison-row');
            var $petName = $('<span>');
            $petName.addClass('txtW-bold');
            $petName.html(productItem.petName);
            var $br = $('<br>');
            var $productName = $('<span>');
            $productName.addClass('txtW-bold');
            $productName.html(productItem.productName);
            var $div = $('<div>');
            $div.addClass('padding-t-10 padding-r-10 padding-b-10 padding-l-10 padding-t-sp-5 padding-r-sp-5 padding-b-sp-5 padding-l-sp-5');
            if ($petName.html() != '') {
                $div.append($petName);
                $div.append($br);
            }
            $div.append($productName);
            $div.attr('data-product-code', productItem.productCode);
            var $cell = $('<div>');
            $cell.addClass('comparison-cell float');
            $cell.append($div);
            $row.append($cell);
        };

        /**
         * 比較リストのスペックラベルを設定する。
         */
        var setComparisonListSpecLabel = function () {
            // スペックラベルを非表示にする
            hideComparisonListSpecLabel();
            // ラベル全削除
            $comparisonListLabel.empty();

            if (isDisplayPrice) {
                var $row = $('<div>');
                $row.addClass('comparison-row');
                $row.attr('data-comparison-item-key', 'price');
                $row.html('機種代金(税込)');
                $comparisonListLabel.append($row);
                $row.show();
            }

            // 比較項目の数だけ繰り返す
            $.each(comparisonItemList, function (i, elm) {
                var $row = $('<div>');
                $row.addClass('comparison-row');
                $row.attr('data-comparison-item-key', elm.tagId);
                $row.html(elm.title);
                $comparisonListLabel.append($row);
                // 表示制御
                var $specificationRow = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="'
                        + elm.tagId + '"]');
                if (hasComparisonItemCookie(elm.tagId)) {
                    // 比較項目として選択されたものだけを表示対象
                    $specificationRow.show();
                    $row.show();
                } else {
                    // 比較項目としてチェックされていない行は非表示
                    $specificationRow.hide();
                    $row.hide();
                }
            });
            // 比較リストのラベルを調整する。
            adjustComparisonListSpecLabel();
        };

        /**
         * 比較リストのスペックラベルを調整する。
         */
        var adjustComparisonListSpecLabel = function () {
            // スペックラベルを非表示にする
            hideComparisonListSpecLabel();
            // Windowの各コンポーネントの位置を取得
            getWindowComponentPosition();
            // 比較リストを調整
            adjustComparisonList();

            // 比較リストの価格行を取得
            var $priceRow = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="price"]');
            // ラベル行を取得
            var $labelRow = $comparisonListLabel.find('.comparison-row[data-comparison-item-key="price"]');
            // ラベル行の高さ（外部余白込み）を取得
            var labelRowHeight = $labelRow.outerHeight(true);
            // スペック行のpadding-topを設定してラベルの高さに合わせる
            var priceRowHeight = labelRowHeight + 4;
            $priceRow.find('.comparison-cell.price').css('padding-top', priceRowHeight + 'px');

            if ($priceRow.length > 0) {
                // スペック行の先頭位置を取得
                var priceTop = $priceRow.position().top;
                // ラベル行の先頭位置を設定
                $labelRow.css('top', priceTop + 'px');
                $labelRow.css('width', comparisonListScrollWidth - 1 + 'px');
            }

            // スペックラベル位置を調整する
            $.each(comparisonItemList, function (i, elm) {
                // 比較リストのスペック行を取得
                var $specificationRow = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="'
                        + elm.tagId + '"]');
                if ($specificationRow) {
                    // ラベル行を取得
                    var $labelRow = $comparisonListLabel.find('.comparison-row[data-comparison-item-key="'
                            + elm.tagId + '"]');
                    // ラベル行の高さ（外部余白込み）を取得
                    var labelRowHeight = $labelRow.outerHeight(true);
                    // スペック行のpadding-topを設定してラベルの高さに合わせる
                    var specificationRowHeight = labelRowHeight + 4;
                    $specificationRow.find('.comparison-cell.spec').css('padding-top', specificationRowHeight + 'px');
                    // スペック行の先頭位置を取得
                    var specificationTop = $specificationRow.position().top;
                    // ラベル行の先頭位置を設定
                    $labelRow.css('top', specificationTop + 'px');
                    $labelRow.css('width', comparisonListScrollWidth - 1 + 'px');
                }
            });
            // スペックラベルを表示する
            showComparisonListSpecLabel();
            // フローティングラベルの表示限界を算出
            let comparisonListScrollTableOffsetTop = $comparisonListScrollTable.length ? $comparisonListScrollTable.offset().top : 0;
            var comparisonListScrollTableBottom = comparisonListScrollTableOffsetTop
                + $comparisonListScrollTable.outerHeight(true);
            var comparisonListFloatTableHeight = $comparisonListFloatTable.outerHeight(true);
            comparisonListFloatLimit = comparisonListScrollTableBottom - comparisonListFloatTableHeight;
            // ローディング画面消去
            window.loading.stop();
            // スクロールヒントを更新
            if (scrollHint) {
                scrollHint.updateItems();
            }
        };

        /**
         * 比較リストを調整する。
         */
        var adjustComparisonList = function () {
            // 画面の幅を取得
            var winWidth = $win.width();
            // 比較リストの１製品を取得
            var $comparisonListSctollTableCell = $comparisonListScrollTable.find('.comparison-cell');
            var $comparisonListScrollTableImg = $comparisonListScrollTable.find('.comparison-cell img');
            var $comparisonListFloatTableCell = $comparisonListFloatTable.find('.comparison-cell');
            var $comparisonListFloatTableSpec = $comparisonListFloatTable.find('.comparison-cell .spec');
            var $comparisonListFloatTableHref = $comparisonListFloatTableCell.find('a');
            if (winWidth < WINDOW_WIDTH_SMP) {
                // 画面幅がスマートフォンの場合
                if (winWidth >= WINDOW_MIN_WIDTH) {
                    // 画面幅が最小値以上の場合
                    // 比較リストの幅を半分にする
                    var cellWidth = comparisonListScrollWidth / 2.2;
                    // 比較リストの１製品の幅を設定
                    $comparisonListSctollTableCell.css('min-width', cellWidth + 'px');
                    $comparisonListSctollTableCell.css('max-width', cellWidth + 'px');
                    // 比較リストの１製品の画像幅を設定
                    var linkWidth = $comparisonListScrollTable.find('.link-box').width();
                    var imgWidth = linkWidth - 4;
                    if (imgWidth < PRODUCT_IMAGE_WIDTH) {
                        // 画像の枠＜元の画像イメージの場合、画像のサイズを指定して縮小する
                        $comparisonListScrollTableImg.css('width', imgWidth + 'px');
                        var imgHeight = Math.floor( imgWidth * 1.15 )
                        $comparisonListScrollTableImg.css('height', imgHeight + 'px');
                    } else {
                        // 上記以外の場合、サイズ指定を削除する
                        $comparisonListScrollTableImg.css('width', '');
                        $comparisonListScrollTableImg.css('height', '');
                    }
                    // フローティングラベルの幅を設定
                    $comparisonListFloatTableCell.css('min-width', cellWidth + 'px');
                    $comparisonListFloatTableCell.css('max-width', cellWidth + 'px');

                    var height = 0;
                    $.each($comparisonListFloatTableHref, function (i, elm) {
                        var tmpHeight = $(elm).height();
                        if (height < tmpHeight) {
                            height = tmpHeight;
                        }
                    });
                    $comparisonListFloatTableHref.css('height', height + 'px');


                }
            } else {
                // 上記以外の場合、サイズ指定を削除する
                $comparisonListSctollTableCell.css('min-width', '');
                $comparisonListSctollTableCell.css('max-width', '');
                $comparisonListScrollTableImg.css('width', '');
                $comparisonListScrollTableImg.css('height', '');
                $comparisonListFloatTableCell.css('min-width', '');
                $comparisonListFloatTableCell.css('max-width', '');
            }
        };

        /**
         * スクロールヒントを設定する。
         */
        var setScrollHint = function () {
            var scrollHintText = $comparisonList.find('input[name=scrollHint]').val();
            scrollHint = new ScrollHint('.comparison-table-area .comparison-table .scroll-product', {
                scrollHintIconAppendClass: 'scroll-hint-icon-adjust-top',
                remainingTime: 5000,
                i18n: {
                    scrollable: scrollHintText,
                },
            });
        };

        /**
         * 製品比較リストのフローティングラベルの横スクロール位置を設定する。
         */
        var setComparisonListFloatScrollLeft = function () {
            var scrollLeft = $comparisonListScroll.scrollLeft();
            $comparisonListFloat.scrollLeft(scrollLeft);
            // スライドボタン設定
            setSlideButton();
        };

        /**
         * フローティング用の製品名とイメージの表示制御を行う。
         */
        var setComparisonListFloat = function () {
            var scrollTop = $win.scrollTop();
            if ( scrollTop > comparisonListScrollTableOffsetTop ) {
                // スクロール位置＞比較リストのスペックの先頭の場合
                if (scrollTop > comparisonListFloatLimit) {
                    // スクロール位置＞比較リストの最後の場合
                    // フローティング用の製品名とイメージを非表示にする
                    hideComparisonListFloat();
                } else {
                    // 上記以外の場合、フローティング用の製品名とイメージを表示する
                    showComparisonListFloat();
                    // 製品比較リストのフローティングラベルの横スクロール位置を設定する
                    setComparisonListFloatScrollLeft();
                }
            } else {
                // フローティング用の製品名とイメージを非表示にする
                hideComparisonListFloat();
            }
        };

        /**
         * フローティング用の製品名とイメージを表示する。
         */
        var showComparisonListFloat = function () {
            $comparisonListFloat.css('visibility', 'visible');
        };

        /**
         * フローティング用の製品名とイメージを非表示にする。
         */
        var hideComparisonListFloat = function () {
            $comparisonListFloat.css('visibility', 'hidden');
        };

        /**
         * スペックラベルを表示する。
         */
        var showComparisonListSpecLabel = function () {
            $comparisonListLabel.css('visibility', 'visible');
        };

        /**
         * スペックラベルを非表示にする。
         */
        var hideComparisonListSpecLabel = function () {
            $comparisonListLabel.css('visibility', 'hidden');
        };

        /** 製品リストの操作 **********************************************************************/

        /**
         * 製品行クリックイベント。
         * @param {Object} e jQueryイベント
         */
        var clickProductListRowEvent = function (e) {
            // 追加ボタン取得
            var $checkbox = $(this).find('.product-checkbox');
            // 行の状態をチェック
            if ($(this).hasClass(PRODUCT_CELL_SELECTED)) {
                // 背景色解除
                $(this).removeClass(PRODUCT_CELL_SELECTED);
                // チェック状態を解除
                $checkbox.removeClass('checked');
            } else {
                // 追加状態でない場合、追加処理を行う
                // 背景色変更
                $(this).addClass(PRODUCT_CELL_SELECTED);
                // チェック状態にする
                $checkbox.addClass('checked');
            }
            // 比較リストのリロード
            reloadComparisonList();
        };

        /**
         * 製品削除クリックイベント。
         * @param {Object} e jQueryイベント
         */
        var clickProductItemRemoveEvent = function (e) {
            var $comparisonCell = $(this).parents(".comparison-cell");
            var productCode = $comparisonCell.data("product-code");
            if (productCode) {
                // 商品をクッキーから削除する
                removeProductCookie(productCode)
                // 最新のクッキーで製品リストを再設定
                setProductList();
                // 比較リストのリロード
                reloadComparisonList();
            }
        };

        /**
         * 製品リストの更新イベント。
         * @param {Object} e jQueryイベント
         * @param {Object} ui UI
         */
        var updateProductListEvent = function (e, ui) {
            // 比較リストのリロード
            reloadComparisonList();
        };

        /**
         * 製品リストを取得する。
         * @return {Object} jQuery.Deferred
         */
        var getProductList = function () {
            var d = $.Deferred();
            // データ
            var data = {};
            data.productCategoryTags = $productListModal.find('input[name=productCategoryTagPath]').val();
            data.currentPagePath = CommonUtil.getCurrentPagePath();
            data.locale = $('html').attr('lang');
            data._charset_ = 'UTF-8';
            data = CommonUtil.appendOlsApiParams(data);
            // サーバへアクセス
            $.ajax({
                type : 'GET',
                dataType : 'json',
                url : JSON_URL_GET_PRODUCT_LIST,
                data: data
            }).done( function (result, textStatus, jqXHR) {
                productList = result;
                // 製品リストの設定
                setProductList();
                d.resolve();
            }).fail( function (jqXHR, textStatus, errorThrown) {
                console.log('ProductComparisonListCls.getProductList fail');
                console.log(jqXHR);
                d.reject();
            });
            return d.promise();
        };

        /**
         * 製品リストを設定する。
         */
        var setProductList = function () {
            // 製品リストを全削除
            $productListArea.find('.product-cell').remove();
            // テンプレート取得
            var $template = $productListModal.find('.product-list-template .product-cell');
            // 製品リストの数だけ繰り返す
            $.each(productList, function (i, elm) {
                isDisplayPrice = elm.isDisplayPrice; // ラベルの制御用にフラグを更新
                if (!elm.isDisplayPrice) {
                    var $priceArea = $comparisonListScrollTable.find('.comparison-row[data-comparison-item-key="price"]');
                    if ($priceArea.length) {
                        // 価格非表示
                        $priceArea.remove();
                    }
                }
                var $cell = $template.clone(true);
                // カテゴリーを付加
                $cell.attr('data-product-category', elm.productCategory);
                // 製品コードを付加
                $cell.attr('data-product-code', elm.productCode);
                // 機種名を付加
                $cell.attr('data-model-name', elm.productName + ' ' + elm.petName);
                // 製品アーカイブフラグを付加
                $cell.attr('data-product-archive-flag', elm.productArchiveFlag);

                // 画像(Lazy Load対応)
                var $productPic = $cell.find('.product-pic img');
                $productPic.attr('data-original', elm.listProductImageUrl);
                $productPic.attr('data-alternative', elm.listProductImageUrlOrg);
                $productPic.attr('alt', elm.productName);

                // 販売ステータス
                var $productStatus = $cell.find('.product-status p');
                $productStatus.html(elm.saleStatus);

                // NEW設定
                if (elm.isNew) {
                    $cell.addClass('product-new');
                } else {
                    $cell.removeClass('product-new');
                }

                // チェックボックスの設定
                var $productCheckbox = $cell.find('.product-checkbox');
                if (hasProductCookie(elm.productCode)) {
                    // 背景色を選択色にする
                    $cell.addClass(PRODUCT_CELL_SELECTED);
                    // チェック状態にする
                    $productCheckbox.addClass('checked');
                } else {
                    // 背景色を選択色にする
                    $cell.removeClass(PRODUCT_CELL_SELECTED);
                    // チェック状態を解除する
                    $productCheckbox.removeClass('checked');
                }
                // 行クリックイベントの追加
                $cell.on('click', clickProductListRowEvent);
                // 項目をリストに追加
                $productListArea.append($cell);
            });
            // Lazy Load
            responsiveImage.lazyload($productListArea.find('img'), true);
            // Sortable（要素を並び替え）※不要になったためコメントアウト
//            sortableProductList();
            // 製品モーダルの検索ボタンクリック
            $productListSearch.on('click', switchProductList);
            // 製品モーダルの絞り込み設定
            switchProductList();

        };

        /**
         * 製品リストのソートを設定する。
         */
        var sortableProductList = function () {
            $productListArea.sortable({
                handle: '.product-pic img',
                cursor: 'grabbing',
                opacity: 0.2,
                delay: 200,
                update: updateProductListEvent,
            });
            $productListArea.disableSelection();
        };

        /**
         * 製品リストの表示切り替えを行う。
         * @param {string} 機種名
         */
        var switchProductList = function () {
            const filterModelName = $productListSelectModel.val()
            const isShowProductArchive = $productListShowProductArchiveLabel.hasClass('checked');
            let count = 0;
            // 対象製品なしメッセージ削除
            let $productListNoneTargetMsg = $productListArea.find('.none-target-msg');
            $productListNoneTargetMsg.remove();
            // 各行の表示制御
            $.each($productListArea.find('.product-cell'), function (i, elm) {
                // 行の機種名、製品アーカイブフラグを取得
                const modelName = $(this).data('model-name');
                const productArchiveFlag = $(this).data('product-archive-flag');
                if (modelName.toLowerCase().indexOf(filterModelName) >= 0
                        && (isShowProductArchive || (!isShowProductArchive && !productArchiveFlag))) {
                    // 「販売終了した製品を表示する」がチェックOFFの場合は、製品アーカイブフラグがチェックOFFの機種のみを表示
                        // 行を表示する
                        $(this).show();
                        count++;
                } else {
                    // 行を非表示にする
                    $(this).hide();
                }
            });
            if (count === 0) {
                // 対象製品なしメッセージ表示
                let $noneMsg = $('<div>');
                $noneMsg.addClass('none-target-msg');
                $noneMsg.html('リストに追加可能な製品はありません。');
                $productListArea.append($noneMsg);
                $noneMsg.show();
            }
        };

        /**
         * 比較リスト左スライドイベント
         */
        var clickLeftSlideComparisonList = function () {
            var $comparisonCell = $('.comparison-cell');
            if ($comparisonCell && !$comparisonListScroll.is(':animated')) {
                // 左にスクロール
                var scrollLeft = $comparisonListScroll.scrollLeft()
                $comparisonListScroll.animate({scrollLeft: scrollLeft - $comparisonCell.width()}, 500, setSlideButton);
            }
        };

        /**
         * 比較リスト右スライドイベント
         */
        var clickRightSlideComparisonList = function () {
            var $comparisonCell = $('.comparison-cell');
            if ($comparisonCell && !$comparisonListScroll.is(':animated')) {
                // 右にスライド
                var scrollLeft = $comparisonListScroll.scrollLeft()
                $comparisonListScroll.animate({scrollLeft: scrollLeft + $comparisonCell.width()}, 500, setSlideButton);
            }
        };

        /**
         * 比較リストスライドボタン設定
         */
        var setSlideButton = function () {
            // 左スライドボタン
            if ($comparisonListScroll.scrollLeft() == 0) {
                $comparisonListSlideLeft.addClass('slide-arrow-is-disable');
            } else {
                $comparisonListSlideLeft.removeClass('slide-arrow-is-disable');
            }
            // 右スライドボタン
            if ($comparisonListScroll.scrollLeft() >= $comparisonListScroll[0].scrollWidth  - $comparisonListScroll.width()) {
                $comparisonListSlideRight.addClass('slide-arrow-is-disable');
            } else {
                $comparisonListSlideRight.removeClass('slide-arrow-is-disable');
            }
        }

        /** 比較項目の操作 ************************************************************************/

        /**
         * 比較項目（スペック大項目）チェックボックスクリックイベント.
         * @param {Object} e jQueryイベント
         */
        var clickComparisonLargeItem = function (e) {
            var $input = $(this).closest('.comparison-item-group').find('input:checkbox[name=comparison_item_m]');
            if ($(this).prop('checked')) {
                // スペック大項目がチェックされたら配下のスペック項目をチェック済みに変更する
                $input.prop('checked', true);
                $input.parent().addClass('checked');
            } else {
                // 大分類のチェックが外れたら小分類を未チェックに変更する
                $input.prop('checked', false);
                $input.parent().removeClass('checked');
            }
        };

        /**
         * 比較項目（スペック項目）チェックボックスクリックイベント.
         * @param {Object} e jQueryイベント
         */
        var clickComparisonSpecItem = function (e) {
            if ($(this).prop('checked') == true) {
                // 小分類がチェックされた
                $(this).parent().addClass('checked');
            } else {
                // 小分類のチェックが外れた
                $(this).parent().removeClass('checked');
                // スペック大項目を未チェックに変更する
                var $input = $(this).closest('.comparison-item-group').find('input:checkbox[name=comparison_item_l]');
                $input.prop('checked', false);
                $input.parent().removeClass('checked');
            }
        };

        /**
         * 比較項目を取得する。
         * @return {Object} jQuery.Deferred
         */
        var getComparisonItemList = function () {
            var d = $.Deferred();
            // パラメタ取得
            var comparisonItemTagPath = $comparisonItemModal.find('input[name=comparisonItemTagPath]').val();
            // サーバへアクセス
            $.ajax({
                type : 'GET',
                dataType : 'json',
                url : JSON_URL_GET_COMPARISON_ITEM,
                data: {
                    comparisonItemTags: comparisonItemTagPath,
                    locale: $('html').attr('lang'),
                    _charset_: 'UTF-8',
                },
            }).done( function (result, textStatus, jqXHR) {
                // 比較項目の設定
                setComparisonItem(result);
                // 比較リストにスペック行を作成する
                createComparisonListSpecRow();
                d.resolve();
            }).fail( function (jqXHR, textStatus, errorThrown) {
                console.log('ProductComparisonListCls.getComparisonItemList fail');
                console.log(jqXHR);
                d.reject();
            });
            return d.promise();
        };

        /**
         * 比較項目を設定する。
         * @param {Object} specList スペックリスト
         */
        var setComparisonItem = function (specList) {
            comparisonItemList = [];
            comparisonItemInitialDisplayList = [];
            if (cookieArrayComparisonItem.length > 0) {
                comparisonItemInitialDisplayList = cookieArrayComparisonItem;
            } else {
                var $comparisonItemInitialDisplayElm = $comparisonItemModal.find('input[name=initialComparisonItemTagPath]');
                if ($comparisonItemInitialDisplayElm && $comparisonItemInitialDisplayElm.val()) {
                    comparisonItemInitialDisplayList = $comparisonItemInitialDisplayElm.val().split(',');
                }
            }
            $.each(specList, function (i, elm) {
                var $groupDiv = $('<div>');
                $groupDiv.addClass('comparison-item-group');
                $groupDiv.append(createComparisonSpecLargeItem(elm.title));
                var $mDiv = $('<div>');
                $mDiv.addClass('comparison-item-area-m');
                for (var i = 0; i < elm.specList.length; i++) {
                    var specItem = elm.specList[i];
                    $mDiv.append(createComparisonSpecItem(specItem));
                    comparisonItemList.push(specItem);
                    if (comparisonItemInitialDisplayList && comparisonItemInitialDisplayList.indexOf(specItem.tagId) >= 0){
                        // 比較項目をクッキーリストに追加
                        cookieArrayComparisonItem.push(specItem.tagId);
                    }
                }
                $groupDiv.append($mDiv);

                // スペック項目が全てチェックされている場合
                if ( elm.specList.length == $mDiv.find('input:checkbox[name=comparison_item_m]:checked').length ) {
                    // スペック大項目をチェック済に変更する
                    var $groupInput = $groupDiv.find('input:checkbox[name=comparison_item_l]');
                    $groupInput.prop('checked', true);
                    $groupInput.parent().addClass('checked');
                }

                $comparisonItemArea.append($groupDiv);
            });
        };

        /**
         * 比較項目（スペック大項目）を作成する。
         * @param {string} title タイトル
         * @return {Object} divオブジェクト
         */
        var createComparisonSpecLargeItem = function (title) {
            var $input = $('<input>');
            $input.attr('type', 'checkbox');
            $input.attr('name', 'comparison_item_l');
            $input.val('1');
            $input.on('click', clickComparisonLargeItem);
            var $label = $('<label>');
            $label.addClass('comparison-item-label');
            $label.html(title);
            $label.append($input);
            var $div = $('<div>');
            $div.addClass('comparison-item-area-l');
            $div.append($label);
            return $div;
        };

        /**
         * 比較項目（スペック項目）を作成する。
         * @param {Object} item スペック項目オブジェクト
         * @return {Object} divオブジェクト
         */
        var createComparisonSpecItem = function (item) {
            var $input = $('<input>');
            $input.attr('type', 'checkbox');
            $input.attr('name', 'comparison_item_m');
            $input.attr('data-comparison-item-key', item.tagId);
            $input.val(item.tagId);
            $input.on('click', clickComparisonSpecItem);
            var $label = $('<label>');
            $label.addClass('comparison-item-label');
            $label.html(item.title);
            $label.append($input);
            var $div = $('<div>');
            $div.addClass('comparison-item-tag');
            $div.append($label);
            // 比較項目を選択済みにしておく
            // （Cookieに1つでも比較項目が登録されていた場合はそれを、1つも登録されていなかった場合は初期表示比較項目を対象にする）
            if ((cookieArrayComparisonItem.length > 0
                        && cookieArrayComparisonItem && cookieArrayComparisonItem.indexOf(item.tagId) >= 0)
                    || (comparisonItemInitialDisplayList && comparisonItemInitialDisplayList.indexOf(item.tagId) >= 0)){
                $input.prop('checked', true);
                $label.addClass('checked');
            }

            return $div;
        };

        /**
         * 比較項目をリセットする。
         */
        var resetComparisonItem = function () {
            // ジャンル・目的のクリア
            var $comparisonItemL = $comparisonItemArea.find('input:checkbox[name=comparison_item_l]');
            $comparisonItemL.prop('checked', false);
            $comparisonItemL.parent().removeClass('checked');
            var $comparisonItemM = $comparisonItemArea.find('input:checkbox[name=comparison_item_m]');
            $comparisonItemM.prop('checked', false);
            $comparisonItemM.parent().removeClass('checked');
        };

        /**
         * チェック済みの比較項目を保存する。
         */
        var saveCkechedComparisonItem = function () {
            cookieArrayComparisonItem = [];
            var checkItems = $comparisonItemArea.find('input:checkbox[name=comparison_item_m]:checked');
            $.each(checkItems, function (i, elm) {
                cookieArrayComparisonItem.push($(elm).data('comparison-item-key'));
            });
            // 比較項目をCookieに保存する
            setComparisonItemCookie();
        };

        /** Cookieの操作 **************************************************************************/

        /**
         * Cookieを取得する。
         */
        var getCookie = function () {
            // 製品コードの取得
            getProductCookie();
            // 比較項目の取得
            getComparisonItemCookie();
        };

        /**
         * Cookieから製品コードを取得する。
         */
        var getProductCookie = function () {
            var cookieValue = AU_COMMON.getCookie(COOKIE_NAME_PRODUCT);
            if (cookieValue && cookieValue !== 'null') {
                // Cookieに値が存在する場合、セパレータで分割して変数に保存
                cookieArrayProduct = cookieValue.split(COOKIE_SEPARATOR);
            } else {
                // 上記以外の場合、変数は空にする
                cookieArrayProduct = [];
            }
        };

        /**
         * 製品Cookieを登録する。
         */
        var setProductCookie = function () {
            AU_COMMON.setCookie(COOKIE_NAME_PRODUCT, cookieArrayProduct.join(COOKIE_SEPARATOR), COOKIE_PATH,
                    COOKIE_EXPIRES);
        };

        /**
         * 製品Cookieを再設定する。
         */
        var resetProductCookie = function () {

            var newCookieArrayProduct = [];
            // 製品リストの各行をチェック
            $.each($productListArea.children(), function (i, elm) {
                if ($(elm).hasClass(PRODUCT_CELL_SELECTED)) {
                    // 選択行の場合、製品コードを取得
                    newCookieArrayProduct.push($(elm).data('product-code'));
                }
            });

            // 表示対象外の製品コードと結合してcookie製品に再設定
            cookieArrayProduct = newCookieArrayProduct.concat(getNotDisplayProductList());

            setProductCookie();
        };

        /**
         * 製品Cookieから指定された製品コードを削除する。
         */
        var removeProductCookie = function (productCode) {
            var newCookieArrayProduct = [];
            for (var index in cookieArrayProduct) {
                if (cookieArrayProduct[index] != productCode) {
                    newCookieArrayProduct.push(cookieArrayProduct[index]);
                }
            }
            cookieArrayProduct = newCookieArrayProduct;
            setProductCookie();
        };

        /**
         * cookie製品リストまたはURLクエリパラメータから有効な製品コードのみを抽出しリストで返却する。
         * @return {ArrayList} 有効な製品コードリスト
         */
        var getSelectedProductList = function () {
            var selectedProductList = [];
            let arrayProduct = getTargetArrayProduct();
            arrayProduct.forEach( function (productCode) {
                if (productList[productCode] ){
                    selectedProductList.push(productCode);
                }
            });
            return selectedProductList;
        };

        /**
         * cookie製品リストから表示対象外の製品コードのみを抽出しリストで返却する。
         * @return {ArrayList} 表示対象外の製品コードリスト
         */
        var getNotDisplayProductList = function () {
            var notDisplayProductList = [];
            cookieArrayProduct.forEach( function (productCode) {
                if (!productList[productCode] ){
                    notDisplayProductList.push(productCode);
                }
            });
            return notDisplayProductList;
        };

        /**
         * CookieまたはURLクエリパラメータに製品コードがあるかどうか判定する。
         * @param {string} productCode 製品コード
         * @return {boolean} 製品コードが存在する場合、trueを返す。
         */
        var hasProductCookie = function (productCode) {
            if (productCode) {
                let arrayProduct = getTargetArrayProduct();
                for (var i = 0; i < arrayProduct.length; i++) {
                    if (arrayProduct[i] === productCode) {
                        return true;
                    }
                }
            }
            return false;
        };

        /**
         * Cookieから比較項目を取得する。
         */
        var getComparisonItemCookie = function () {
            var cookieValue = AU_COMMON.getCookie(COOKIE_NAME_COMPARISON_ITEM);
            if (cookieValue && cookieValue !== 'null') {
                // Cookieに値が存在する場合、セパレータで分割して変数に保存
                cookieArrayComparisonItem = cookieValue.split(COOKIE_SEPARATOR);
            } else {
                // 上記以外の場合、変数は空にする
                cookieArrayComparisonItem = [];
            }
        };

        /**
         * 比較項目Cookieを登録する。
         */
        var setComparisonItemCookie = function () {
            AU_COMMON.setCookie(COOKIE_NAME_COMPARISON_ITEM, cookieArrayComparisonItem.join(COOKIE_SEPARATOR), COOKIE_PATH,
                    COOKIE_EXPIRES);
        };

        /**
         * Cookieに比較項目があるかどうか判定する。
         * @param {string} comparisonItemKey 比較項目キー
         * @return {boolean} 比較項目が存在する場合、trueを返す。
         */
        var hasComparisonItemCookie = function (comparisonItemKey) {
            if (comparisonItemKey) {
                for (var i = 0; i < cookieArrayComparisonItem.length; i++) {
                    if (cookieArrayComparisonItem[i] === comparisonItemKey) {
                        return true;
                    }
                }
            }
            return false;
        };

        /**
         * URLクエリパラメータから製品コードを取得する。
         */
        const getProductUrlParams = function () {
            const productCodeParams = AU_COMMON.getParameter(document.location.href, PARAM_MODEL_CODE);
            if (productCodeParams && productCodeParams.length > 0) {
                urlParamArrayProduct = productCodeParams.split(URL_PARAMETER_PRODUCT_CODE_SEPARATOR);
            } else {
                urlParamArrayProduct = [];
            }
        };

        /**
         * 以下の優先順位で製品コードリストを返却する。
         *  1. URLクエリパラメータから取得した製品コード
         *  2. Cookieから取得した製品コード
         * @return {ArrayList} 製品コードリスト
         */
        var getTargetArrayProduct = function () {
            let arrayProduct = [];
            arrayProduct = urlParamArrayProduct && urlParamArrayProduct.length > 0
                    ? urlParamArrayProduct : cookieArrayProduct;
            return arrayProduct;
        };

        return ProductComparisonListCls;

    })();
})(jQuery);

/**
 * product-comparison-list.js
 */

(function ($) {

    'use strict';

    if (window.productComparisonListAPI) {
        return; // 2重初期化防止
    }

    /* 公開APIの箱 */
    window.productComparisonListAPI = {};

    /**
     * 初期処理。
     */
    var init = function () {
        // 製品比較リストクラスの生成
        var productComparisonListCls = new ProductComparisonListCls();
        productComparisonListCls.init();
        window.productComparisonListCls = productComparisonListCls;
    }

    window.productComparisonListAPI.init = init;
})(jQuery);

/* ols-product-detail-modal.js */
(function($) {

    window.olsProductDetailModal = {};

   /**
    *
    * 指定された製品の情報をモーダルに読み込む
    *
    * @param $target 読み込み先のjQueryオブジェクト
    * @param code 製品コード
    *
    */
   function _loadContents ($target, code) {
       return new Promise(function(resolve) {
           var targetId = $target.attr('id');
           var path = $target.data('nodePath');

           if (targetId && targetId != undefined
                   && path && path != undefined) {

               var postfix = "";
               if (CommonUtil.isAuthorPreview()) {
                   postfix = '.html?wcmmode=disabled';
               } else {
                   path = path.replace('/content/au-com', '');
                   postfix = '/';
               }

               var url = path + '.' + code + postfix;
               var data = {};
               data = CommonUtil.appendOlsApiParams(data);
               $.ajax({
                   url: url,
                   data: data,
                   cache : true,
                   dataType: "html"
               }).done(function (html) {
                   $('#' + targetId).html(html);
               }).always(function () {
                   resolve();
               });
           } else {
               resolve();
           }
       });
   }

   /**
    *
    * 指定された製品の情報をモーダルに読み込む
    *
    * @param modalId 読み込み先のモーダルのID
    * @param code 製品コード
    *
    */
   function loadContents(modalId, code) {

       var $rootElem = $('.ols-product-detail-modal #' + modalId);

       window.loading.start();
       $('.ols-product-detail section', $rootElem).addClass('initDisplayNone');

       var promises =[];

       // product-logo-image
       var $productLogoImage = $('.product-logo-image div.targetArea', $rootElem);
       if ($productLogoImage && $productLogoImage.length == 1) {
           promises.push(_loadContents ($productLogoImage, code));
       }

       // product-image
       var $productImage = $('.product-image div.targetArea', $rootElem);
       if ($productImage && $productImage.length == 1) {
           promises.push(_loadContents ($productImage, code));
       }

       // ols-product-detail-partial
       var $olsProductDetailPartial = $('.ols-product-detail-partial div.targetArea', $rootElem);
       if ($olsProductDetailPartial && $olsProductDetailPartial.length == 1) {
           promises.push(_loadContents ($olsProductDetailPartial, code));
       }

       // product-bundle-item-tooltip
       var $productBundleItemTooltip = $('.product-bundle-item-tooltip div.targetArea', $rootElem);
       if ($productBundleItemTooltip && $productBundleItemTooltip.length == 1) {
           promises.push(_loadContents ($productBundleItemTooltip, code));
       }

       // product-color-variation
       var $productColorVariation = $('.product-color-variation div.targetArea', $rootElem);
       if ($productColorVariation && $productColorVariation.length == 1) {
           promises.push(_loadContents ($productColorVariation, code));
       }

       Promise.all(promises).then(function(results) {

           window.olsProductDetail.displayControl();

           $('.ols-product-detail section', $rootElem).removeClass('initDisplayNone');

           var $imgs = $('img.lazyload', $rootElem);
           $rootElem.modal('show');
           window.responsiveImage.prepareLoadAll($imgs, true);

           $imgs.on('img:load', function() {
               if (responsiveImage.confirmLoadAll($imgs)) {
                   var $modalDialog = $('.modal-dialog', $rootElem);
                   var $modalBody = $('.modal-body', $rootElem);
                   var modalHeight = $modalBody.outerHeight();
                   $modalDialog.height(modalHeight);
                   window.auModal.adjustMargin();
                   window.loading.stop();
               }
           });
       });
   }
   window.olsProductDetailModal.loadContents = loadContents;

})(jQuery);
/* ols-product-detail.js */
(function($) {

    $(function() {

        if (!CommonUtil.isAuthorEditor()) {
            // 表示制御
            displayControl();
        }
        $('.ols-product-detail section').removeClass('initDisplayNone');

        $(document).on('click', '.unitPurchaseLink', function () {
            // 端末単体購入導線リンク生成
            var obj = $('.is-selected[data-ols-product-code]')[0];
            var olsProductCode = $(obj).data('olsProductCode');
            var $purchaseLinkUnit = $(this).children('a');
            if ($purchaseLinkUnit.length) {
                var link = $purchaseLinkUnit.attr("href");
                var url = link.substring(0, link.indexOf("="));
                url += "=" + olsProductCode;
            }
            window.open(url);
            return false;
        });

        // カートに入れる
        $(document).on('click', '.addCartBtn', function () {
            var obj = $('.is-selected[data-ols-product-code]')[0];
            var olsProductCode = $(obj).data('olsProductCode');

            var cart = window.cartAPI.getCartObj();
            if (cart[olsProductCode] != undefined) {
                // カートに追加済みの場合はモーダルでメッセージを表示。
                var $addCartAlert = $('#addCartAlert .modal-dialog');
                var $productDetailModal = $addCartAlert.closest('#product-detail');
                if ($productDetailModal.length > 0) {
                    // 製品詳細モーダルの場合はスクロール位置を先頭にしてからメッセージを表示する。
                    if ($productDetailModal.scrollTop() > 0) {
                        $productDetailModal.animate({scrollTop: 0}, 200, 'easeOutQuart');
                    }
                    $addCartAlert.css('position', 'fixed');
                }
                $('.addCartAlertBtn')[0].click();
            } else {
                var url = $(this).attr('href');
                if (url.indexOf('?') != -1) {
                    url += '&olsitemcd=' + olsProductCode;
                } else {
                    url += '?olsitemcd=' + olsProductCode;
                }
                location.href = url;
            }

            return false;
        });

        // 店舗で予約・購入する
        $(document).on('click', '.reserveBtn1, .reserveBtn2', function () {
            var obj = $('.is-selected[data-ols-product-code]')[0];
            var olsProductCode = $(obj).data('olsProductCode');

            var url = $(this).attr('href');
            url += '&GOODS_STK_NO=' + olsProductCode;
            url += '&BRAND=0';
            window.open(url);

            return false;
        });

        // お届け可能地域と所要日数
        $(document).on('click', '.delivery-note a', function () {

            var url = $(this).attr('href');
            if (url == 'http://onlineshop.au.com/files/logistics/') {
                if (window.CommonUtil.isPc() || window.CommonUtil.isTablet()) {
                    url += "pc/pc/";
                } else if (window.CommonUtil.isSp()) {
                    url += "sp/sp/";
                }
            }
            window.open(url);

            return false;
        });

    });

    window.olsProductDetail = {};
    /**
     * 表示制御
     */
    function displayControl() {

        var $selected = $('.product-color.is-selected');
        var statusCode = String($selected.data('stockStatusCode'));
        var reserveStatus = String($selected.data('reserveStatus'));
        var obj = $('.is-selected[data-ols-product-code]')[0];
        var olsProductCode = $(obj).data('olsProductCode');

        // 画面オブジェクト
        var $addCartBtn = $('.addCartBtn').parents('.button');
        var $reserveBtn1 = $('.reserveBtn1').parents('.button');
        var $reserveBtn2 = $('.reserveBtn2').parents('.button');
        var $storeLocatorBtn = $('.storeLocatorBtn').parents('.button');
        var $storeLocatorHideArea = $('.hideWhenStoreLocator').find('div.layout-ctr');
        var $deliveryNote = $('.delivery-note').parent('.section-container');
        var $purchaseLink = $('.unitPurchaseLink').parents('.link');

        // 商品コードがない場合は表示しない
        if (olsProductCode === undefined) {
            $purchaseLink.css('display', 'none');
        }

        if (statusCode == '10') {
            // 10 予約受付中
            $addCartBtn.css('display', 'none');
            $reserveBtn1.css('display', '');
            $reserveBtn2.css('display', 'none');
            $storeLocatorBtn.css('display', 'none');
            $storeLocatorHideArea.css('display', '');
            $deliveryNote.css('display', 'none');
            $purchaseLink.css('display', 'none');
        } else if (statusCode == '20' || statusCode == '30') {
            $addCartBtn.css('display', '');
            $reserveBtn1.css('display', 'none');
            $reserveBtn2.css('display', 'none');
            $storeLocatorBtn.css('display', 'none');
            $storeLocatorHideArea.css('display', '');
            $deliveryNote.css('display', '');
            $purchaseLink.css('display', '');
        } else if (statusCode == '40' || statusCode == '50' ||
                    statusCode == '60' || statusCode == '70') {
            // 40 在庫なし
            // 50 販売停止
            // 60 販売終了
            // 70 受付停止中
            $addCartBtn.css('display', 'none');
            if (reserveStatus == '10') {
                $reserveBtn1.css('display', 'none');
                $reserveBtn2.css('display', '');
                $storeLocatorBtn.css('display', 'none');
                $storeLocatorHideArea.css('display', '');
            } else {
                $reserveBtn1.css('display', 'none');
                $reserveBtn2.css('display', 'none');
                $storeLocatorBtn.css('display', '');
                $storeLocatorHideArea.css('display', 'none');
            }
            $deliveryNote.css('display', 'none');
            $purchaseLink.css('display', 'none');
        } else {
            $addCartBtn.css('display', 'none');
            if (reserveStatus == '10') {
                $reserveBtn1.css('display', 'none');
                $reserveBtn2.css('display', '');
                $storeLocatorBtn.css('display', 'none');
                $storeLocatorHideArea.css('display', '');
            } else {
                $reserveBtn1.css('display', 'none');
                $reserveBtn2.css('display', 'none');
                $storeLocatorBtn.css('display', '');
                $storeLocatorHideArea.css('display', 'none');
            }
            $deliveryNote.css('display', 'none');
            $purchaseLink.css('display', 'none');
        }
    }
    window.olsProductDetail.displayControl = displayControl;

})(jQuery);

/**
 * ols-cart.js
 */

(function($) {

    'use strict';

    /** 定数 **********************************************************************************/
    var PARAM_OLS_PRODUCT_CODE = 'olsitemcd';        // バリエーション製品コード
    var PARAM_CONTRACT_TYPE = 'CONTRACT_TP';      // 契約形態
    var JSON_URL_GET_PRODUCT_DETAIL = '/bin/wcm/au-com/ols/product';    // 商品詳細取得URL
    var JSON_URL_GET_PRODUCT_DETAIL_V2 = '/bin/wcm/au-com/ols/product/v2';    // 商品詳細取得URL V2
    var JSON_URL_EXT = '.json';                                            // URLの拡張子
    var OLS_STATUS_RESERVE = '10';                // オンラインショップステータス：予約受付中
    var OLS_STATUS_STOCK = '20';                // オンラインショップステータス：在庫あり
    var OLS_STATUS_LESS = '30';                    // オンラインショップステータス：在庫わずか
    var OLS_STATUS_DISCONTINUED = '50';            // オンラインショップステータス：販売中止
    var RESERVE_STATUS_ACCEPTING = '10';        // オンライン予約ステータス：受付中
    var MESSAGE_DELETE = ' はカートから削除されました。';    // カート削除メッセージ
    const TAG_ID_CATEGORY_IPHONE = 'au-com:pim/product_category/iphone';

    /** 変数 **********************************************************************************/
    var $olsCart, $olsCartIn, $olsCartNone;

    /**
     * 初期処理。
     */
    var initialize = function () {
        console.log('ols-cart.js initialize');
        // 変数取得
        $olsCartIn = $olsCart.find('.cart-in');
        $olsCartNone = $olsCart.find('.cart-none');

        // カート取得
        var cart = getCart();
        // 商品詳細リスト取得
        var productDetailList = getProductDetailList(cart);

        // URLに指定された商品詳細を取得
        var addProductDetail = getProductDetailFromUrl(cart);
        if (addProductDetail) {
            // 商品詳細が有効な場合
            // カートに追加
            addCart(addProductDetail.olsProductCode, addProductDetail.contractType);
            // 商品詳細リストを再取得
            cart = getCart();
            productDetailList = getProductDetailList(cart);

            _sc.events += ',scAdd';
        }

        // カート描画
        renderCart(productDetailList);

        $.each(productDetailList, function (i, elm) {
            if (i != 0) {
                _sc.products += ',';
            }
            _sc.products += ';' + elm.olsProductCode;
        });

        // 計測処理呼び出し
        if (typeof reRequest === 'function') {
            reRequest();
        } else {
            console.log(_sc);
        }
    };

    /** イベント **********************************************************************************/
    /**
     * カート削除ボタンクリックイベント。
     * @param {Object} e jQueryイベント
     */
    var clickRemoveCartEvent = function (e) {
        // カラーバリエーション製品コード取得
        var $item = $(this).closest('.product-item');
        var olsProductCode = $item.data('ols-product-code');
        // カートから削除
        removeCart(olsProductCode);
        // flashmodal
        window.flashmodal.dispMessage($(this).data('delete-msg'));
        // カートから残りの商品を取得
        var cartNum = getCartNum();
        if (cartNum > 0) {
            // 1件以上ある場合、Effectで消去
            $item.hide('blind', 500);
        } else {
            // 空になった場合、消去してカート無しメッセージ表示
            $item.hide();
            $olsCartNone.show();
        }

        // 計測処理呼び出し
        _sc.events = 'scRemove';
        _sc.products = ';' + olsProductCode;
        if (typeof reRequest === 'function') {
            reRequest();
        } else {
            console.log(_sc);
        }
    };

    /** メソッド **********************************************************************************/
    /**
     * 商品詳細リスト取得。
     * @param {Object} cart カート
     * @returns {Object} 商品詳細リスト
     */
    var getProductDetailList = function (cart) {
        var productDetailList = [];

        var productCodes = [];
        $.each(cart, function(productCode) {
            productCodes.push(productCode);
        });
        productDetailList = getProductDetail(productCodes);
        $.each(productDetailList, function(i, productDetail) {
            var olsProductCode = productDetail.olsProductCode;
            var cartObj = cart[olsProductCode];
            if (cartObj.contractType) {
                productDetail.contractType = cartObj.contractType;
            }
        });

        return productDetailList;
    };

    /**
     * 商品詳細取得。
     * @param {string} olsProductCodes オンラインショップ商品コード
     * @returns {Object} 商品詳細
     */
    var getProductDetail = function (olsProductCodes) {
        var items = [];

        var selector = "";
        $.each(olsProductCodes, function(i, code) {
            selector = selector + "." + code;
        });

        // サーバへアクセス
        let sc = document.querySelector(".section-cart");
        let url = "";
        if(sc.getAttribute("servlet-version") == "v2") {
            url = JSON_URL_GET_PRODUCT_DETAIL_V2 + selector +  JSON_URL_EXT;
        }else{
            url = JSON_URL_GET_PRODUCT_DETAIL + selector +  JSON_URL_EXT;
        };

        // データ
        var data = {};
        data.currentPagePath = CommonUtil.getCurrentPagePath();
        data = CommonUtil.appendOlsApiParams(data);

        $.ajax({
            type : 'GET',
            dataType : 'json',
            url : url,
            data : data,
            async : false,    // 非同期に取得
        }).done( function (result, textStatus, jqXHR) {
            console.log(result);
            items = result;
        }).fail( function (jqXHR, textStatus, errorThrown) {
            console.log(jqXHR);
        });
        return items;
    };

    /**
     * 商品詳細チェック。
     * @param {Object} productDetail 商品詳細
     * @returns {boolean} 有効な商品の場合、trueを返す。
     */
    var checkProductDetail = function (productDetail) {

        if (!productDetail) {
            // 商品詳細が無い場合、Falseを返す
            return false;
        }

        // 販売ステータスが「販売中止」の場合、falseを返す。
        if (productDetail.olsStatusCode === OLS_STATUS_DISCONTINUED) {
            return false;
        }

        return true;
    };

    /**
     * URLに指定された商品を取得。
     * @param {Object} cart カート
     * @returns {Object} 商品詳細
     */
    var getProductDetailFromUrl = function (cart) {
        var item;
        // URLからバリエーション製品コード、契約形態を取得
        var olsProductCode = AU_COMMON.getParameter(document.location.href, PARAM_OLS_PRODUCT_CODE);
        var contractType = AU_COMMON.getParameter(document.location.href, PARAM_CONTRACT_TYPE);
        if (olsProductCode !== null && olsProductCode !== '') {
            // 値が取得できた場合
            // URLから取得したバリエーション商品コードがカートに無い場合
            // 商品詳細取得
            var olsProductCodes = [];
            olsProductCodes.push(olsProductCode);
            var productDetails = getProductDetail(olsProductCodes);
            if (productDetails && productDetails.length > 0) {
                var productDetail = productDetails[0];
                // 商品詳細のチェック
                if (checkProductDetail(productDetail)) {
                    item = productDetail;

                    // 契約形態をセット
                    item.contractType = contractType;
                }
            }
            // URL書き換え
            replaceUrl();
        }
        return item;
    };

    /** 画面描画 **********************************************************************************/
    /**
     * カート描画。
     * @params {Object} productDetailList 商品詳細リスト
     */
    var renderCart= function (productDetailList) {
        if (productDetailList && productDetailList.length > 0) {
            // 商品詳細ありの場合、カート無しメッセージ非表示
            $olsCartNone.hide();
            // カートを空にする
            $olsCartIn.empty();
            // テンプレート取得
            var $template = $olsCart.find('.product-list-template > .item');
            // 商品詳細リストの数だけ繰り返す
            $.each(productDetailList, function (i, elm) {
                // 商品描画
                renderItem(elm, $template);
            });
            // LazyLoad対応
            responsiveImage.lazyload($olsCartIn.find('img'), true);
        } else {
            // 商品詳細なしの場合、カート無しメッセージ表示
            $olsCartNone.show();
        }
    };

    /**
     * 商品描画。
     * @param {Object} productDetailItem 商品詳細
     * @param {Object} $template テンプレート
     */
    var renderItem = function (productDetailItem, $template) {
        // テンプレートを複製
        var $item = $template.clone(true);
        if (!productDetailItem.isDisplayPrice) {
            var $priceArea = $item.find('.price-area').remove();
            if ($priceArea.length) {
                $priceArea.remove();
            }
        }
        // バリエーション商品コード
        $item.attr('data-ols-product-code', productDetailItem.olsProductCode);
        // 契約形態
        $item.attr('data-contract-type', productDetailItem.contractType);
        // 画像
        var $img = $item.find('img');
        $img.attr('data-original', productDetailItem.colorVariationProductThumbnailImage);
        $img.attr('data-alternative', productDetailItem.colorVariationProductThumbnailImageOriginal);    // damのパス
        $img.attr('alt', productDetailItem.variationProductCode);
        // 商品名
        var $petName = $item.find('.pet-name');
        if (productDetailItem.productName) {
            $petName.html(productDetailItem.productName);
        } else {
            var productName = '';
            if (productDetailItem.petName != undefined) {
                productName += productDetailItem.petName;
            } else {
                if (productDetailItem.title != undefined) {
                    productName += productDetailItem.title;
                }
            }
            if (productDetailItem.colorVariationName != undefined) {
                productName += ' ' + productDetailItem.colorVariationName;
            }
            $petName.html(productName);
        }
        // ランク
        var $rank = $item.find('.rank');
        if (productDetailItem.rank) {
            $rank.html("ランク：" + productDetailItem.rank);
        }

        // URLにパラメータを付与
        var productCategoryMapJson = JSON.parse($olsCartIn.attr('data-productCategoryMapJson')) ;
        var productCategoryTagId = productDetailItem.categoryTagId;
        var productUrl = productDetailItem.productDetailUrl;
        var queryParam = "";
        for(var i=0;i<productCategoryMapJson.length;i++){
            var categoryTagId = productCategoryMapJson[i].categoryTagId;
            var queryParameter = productCategoryMapJson[i].queryParameter;
            if (productCategoryTagId.indexOf(categoryTagId ) != -1){
                if (productUrl.indexOf('?') != -1){
                    queryParam = '&' + queryParameter ;
                } else {
                    queryParam = '?' + queryParameter ;
                }
                break;
            }
        }

        var $productDetailUrl = $item.find('.product-link');
        $productDetailUrl.attr('href',productUrl + queryParam);

        // 在庫
        var $olsStatus = $item.find('.ols-status');
        if (productDetailItem.olsStatus != '') {
            $olsStatus.html(productDetailItem.olsStatus);
        }
        // お届け日の目安リンク
        var $deliveryDate = $item.find('.link-delivery-date');

        // リンクの設定
        $deliveryDate.data('baseLink', $deliveryDate.attr('href'));

        if (productDetailItem.olsStatusCode === OLS_STATUS_STOCK || productDetailItem.olsStatusCode === OLS_STATUS_LESS) {
            // オンラインショップステータスが在庫ありor在庫わずかの場合、リンク先を設定する
        } else {
            // 上記以外の場合、非表示にする
            $deliveryDate.hide();
        }
        // 機種代金（円フォーマット）
        var priceValue = CommonUtil.formatNumber(productDetailItem.price);
        // 機種代金
        var $rowPrice = $item.find('.row-price');
        if ($rowPrice.length) {
            if (priceValue && priceValue !== '') {
                // 機種代金が取得できた場合、設定する
                var $price = $item.find('.price');
                $price.html(priceValue);
            } else {
                // 機種代金が取得できない場合、ハイフン表示にする
                $rowPrice.text('―');
            }
        }
        // オンラインで購入ボタン
        var $purchaseOnline = $item.find('.btn-to-online');
        // オンラインで予約ボタン
        var $onlineReservation = $item.find('.btn-to-online-reservation');
        if (productDetailItem.olsStatusCode === OLS_STATUS_RESERVE) {
            // オンラインショップステータスが予約中の場合、
            //     オンラインで購入ボタンは非表示にする
            //     オンラインで予約ボタンは活性にする
            $purchaseOnline.css('display', 'none');
        } else if (productDetailItem.olsStatusCode === OLS_STATUS_STOCK
                || productDetailItem.olsStatusCode === OLS_STATUS_LESS) {
            // オンラインショップステータスが在庫ありor在庫わずかの場合、
            //     オンラインで購入ボタンは活性にする
            //     オンラインで予約ボタンは非表示にする
            $onlineReservation.css('display', 'none');
        } else {
            // 上記以外の場合、
            //     オンラインで購入ボタンは非活性にする
            //     オンラインで予約ボタンは非表示にする
            $purchaseOnline.removeClass('btn-auOrange');
            $purchaseOnline.addClass('btn-negativeGray');
            $purchaseOnline.addClass('btn-disabled');
            $onlineReservation.css('display', 'none');
        }
        // 店舗で購入ボタン
        var $purchaseStore = $item.find('.btn-to-store');
        if (isValidButtonToStore(productDetailItem)) {
            // オンライン予約ステータスが受付中、かつiPhone以外の端末の場合、リンク先を設定する
        } else {
            // 上記以外の場合、非活性にする
            $purchaseStore.removeClass('btn-auOrange');
            $purchaseStore.addClass('btn-negativeGray');
            $purchaseStore.addClass('btn-disabled');
        }
        // 削除ボタン
        var $btnRemoveCart = $item.find('.btn-remove-cart');
        $btnRemoveCart.attr('data-delete-msg', makeCartDeleteMessage(productDetailItem));
        $btnRemoveCart.on('click', clickRemoveCartEvent);
        // リストに追加
        $olsCartIn.append($item);
    };

    /**
     * カートから削除するメッセージを作成する。
     * @param {Object} productDetailItem 商品詳細
     * @returns {string} メッセージ
     */
    var makeCartDeleteMessage = function (productDetailItem) {
        return productDetailItem.productName + MESSAGE_DELETE;
    };

    /**
     * 「店舗で契約・購入する」 ボタン有効/無効判定.
     * 
     * @param {Object} 商品詳細
     * @return true：有効、false：無効
     */
    function isValidButtonToStore(productDetailItem) {
        var categoryTagIds = productDetailItem.categoryTagId;
        var isIPhone = false;
        if (categoryTagIds && categoryTagIds.length) {
            $.each(categoryTagIds, function() {
                if (this == TAG_ID_CATEGORY_IPHONE) {
                    isIPhone = true;
                    return false;
                }
            });
        }
        return productDetailItem.reserveStatusCode === RESERVE_STATUS_ACCEPTING && !isIPhone;
    }

    /**
     * 「オンラインで購入する」 ボタンクリック時処理.
     */
    $(document).on('click', '.btn-to-online', function () {
       var url = $(this).attr('href');

       var $productItem = $(this).parents('.product-item');
       var olsProductCode = $productItem.data('olsProductCode');
       var contractType = $productItem.data('contractType');

       url += url.indexOf('?') != -1 ? '&' : '?';
       url += 'GOODS_STK_NO=' + olsProductCode;
       if (contractType !== null && contractType !== undefined) {
           url += '&CONTRACT_TP=' + contractType;
       }
       location.href = url;

       return false;
    });

    /**
     * 「オンラインで予約する」 ボタンクリック時処理.
     */
    $(document).on('click', '.btn-to-online-reservation', function () {
        var url = $(this).attr('href');

        var $productItem = $(this).parents('.product-item');
        var olsProductCode = $productItem.data('olsProductCode');
        var contractType = $productItem.data('contractType');

        url += url.indexOf('?') != -1 ? '&' : '?';
        url += 'GOODS_STK_NO=' + olsProductCode;
        if (contractType !== null && contractType !== undefined) {
            url += '&CONTRACT_TP=' + contractType;
        }
        url += '&receiveKind=1';
        url += '&BRAND=0';
        window.open(url);

        return false;
    });

     /**
     * 「店舗で契約・購入する」 ボタンクリック時処理.
     */
    $(document).on('click','.btn-to-store', function () {
        var url = $(this).attr('href');

        var $productItem = $(this).parents('.product-item');
        var olsProductCode = $productItem.data('olsProductCode');
        var contractType = $productItem.data('contractType');

        url += '&GOODS_STK_NO=' + olsProductCode;
        if (contractType !== null && contractType !== undefined) {
            url += '&CONTRACT_TP=' + contractType;
        }
        url += '&receiveKind=0';
        url += '&BRAND=0';
        window.open(url);

        return false;
    });

    /** ユーティリティ **********************************************************************************/
    /**
     * URL書き換え。
     */
    var replaceUrl = function () {
        var arg = null;
        // URLのパラメタ取得
        var pair = document.location.search.substring(1).split('&');
        for (var i = 0; pair[i]; i++) {
            var kv = pair[i].split('=');
            // バリエーション製品コード、契約形態を除く
            if (kv[0] !== PARAM_OLS_PRODUCT_CODE
                    && kv[0] !== PARAM_CONTRACT_TYPE
                    && kv[0] !== "BRAND") {
                if (arg === null) {
                    arg = '?';
                } else {
                    arg = arg + '&';
                }
                arg = arg + kv[0] + '=' + kv[1];
            }
        }
        // 書き換えるURL作成
        var replaceUrl = document.location.pathname;
        if (arg !== null) {
            replaceUrl = replaceUrl + arg;
        }
        // URL書き換え
        window.history.replaceState(null, null, replaceUrl);
    };

    /** カートAPIアクセス **********************************************************************************/
    /**
     * カート件数取得。
     * @returns {number} 件数
     */
    var getCartNum = function () {
        return window.cartAPI.getCartNum();
    };

    /**
     * カート取得。
     * @returns {Object} カート
     */
    var getCart = function () {
        var cart = window.cartAPI.getCartObj();
        console.log(cart);
        return cart;
    };

    /**
     * カート追加。
     * @param {string} olsProductCode オンラインショップ商品コード
     * @param {string} contractType 契約形態
     */
    var addCart = function (olsProductCode, contractType) {
        window.cartAPI.add(olsProductCode, contractType, '1');
    };

    /**
     * カート削除。
     * @param {string} olsProductCode オンラインショップ商品コード
     */
    var removeCart = function (olsProductCode) {
        window.cartAPI.remove(olsProductCode);
    };

    /** 起動時処理 **********************************************************************************/
    $(function () {

        // 編集時はスキップ
        if (AU_COMMON.getCookie("wcmmode") == "edit"
            && AU_COMMON.getParameter(document.location.href, 'wcmmode') != 'disabled') {
            return;
        }
        $olsCart = $('.ols-cart');
        if ($olsCart && $olsCart.length) {
            console.log('start ols-cart');
            // 初期処理
            initialize();
        }
    });

})(jQuery);

/* inquiryFormZipCode.js */
(function($) {
    Form = {};

    function isEnglish() {
        var lang  = $('html').attr('lang');
        if (lang && lang == 'en') {
            return true;
        } else {
            return false;
        }
    }

    $(function(){

        $('.zip_address_button').click(function(){
            var name     = $(this).attr('name');
            var path     = $(this).attr('data-config-path');
            var prefix = name.replace('addressBtn', '');

            Form.zipSearch(prefix, prefix, prefix, '', '', '1',path);
            return false;
        });

            var prefmap = [null,
                        '0',  '1',  '2',  '3',  '4',  '5',  '6',  '7',  '8',  '9',
                       '10', '11', '12', '13', '14', '15', '16', '17', '18', '19',
                       '20', '21', '22', '23', '24', '25', '26', '27', '28', '29',
                       '30', '31', '32', '33', '34', '35', '36', '37', '38', '39',
                       '40', '41', '42', '43', '44', '45', '46', '47'];

        Form.zipSearch = function(zip_prefix, pref_prefix, address_prefix, zip_aft, pref_aft, address_aft, path){
            var fZip1      = document.getElementsByName(zip_prefix  + 'zip1' + zip_aft)[0].value;
            var fZip2      = document.getElementsByName(zip_prefix  + 'zip2' + zip_aft)[0].value;
            var fPref      = document.getElementsByName(pref_prefix + 'pref' + pref_aft)[0];
            var fAddress   = document.getElementsByName(address_prefix + 'address' + address_aft)[0];

            // var errMsg = Granite.I18n.get("Please check the zip code.");
            var errMsg = "郵便番号を確認してください。";
            var errMsg_en = "Please check the zip code.";

            var ziperrorid = zip_prefix + 'ziperror';

            var ziperror = function(msg){
                $('#' + ziperrorid).remove();
                var err_disp_positon = $(document.getElementsByName(zip_prefix + 'zip1' + zip_aft)[0]).closest("div.input-zip");
                err_disp_positon.before('<p class="form-errorMessage" id="' + ziperrorid + '">'+msg+'</p>');
            }

            if (!fZip1.match(/\d{3}/) || !fZip2.match(/\d{4}/)) {
                if (isEnglish()) {
                    ziperror(errMsg_en);
                } else {
                    ziperror(errMsg);
                }
                return false;
            }

            $.getJSON(path+'zip-'+fZip1+'.json', function(json){

                var getResponseText = function(txt) {
                    //if ($.browser.safari) {
                    if (window.navigator.userAgent.toLowerCase().indexOf('safari') != -1) {
                        var esc = escape( txt );
                        if ( esc.indexOf("%u") < 0 && esc.indexOf("%") > -1 ) {
                            txt = decodeURIComponent( esc );
                        }
                    }
                    return txt;
                }

                var data = json[fZip1+''+fZip2];
                if (!data) {
                    if (isEnglish()) {
                        ziperror(errMsg_en);
                    } else {
                        ziperror(errMsg);
                    }
                    return false;
                }
                var jpref = getResponseText(prefmap[data[0]]);

                for (var i=0,len=fPref.options.length;i<len;i++) {
                    if (jpref == fPref.options[i].value) {
                        fPref.selectedIndex = i;
                    }
                }

                fAddress.value = getResponseText(data[1] + data[2]);
                $('#' + ziperrorid).remove();
            });
        };
    });
})(jQuery);

/* inquiryFormRadioText.js */
(function($) {
    $(function(){
    
        //formにある連動ラジオ分回す
        $('.radio-link-text', this).each(function(){
            inquiryFormLinkedEnable($(this).find('input:radio'));
        });
    
        $(document)
             .on('click', '.radio-link-text :radio', function(){
                inquiryFormLinkedEnable($(this));
        })
    
    });
    
    function inquiryFormLinkedEnable(radio) {
    
        // get parent
        var parent = radio.closest('.radio-link-text');
    
        // get enable value and type
        var textEnableValue = parent.attr('data-enable-value');
        var textEnableType = parent.attr('data-enable-type');
    
        // target
        var target = parent.find('input:text,textarea');
    
        var radioChecked = parent.find(':radio:checked');
    
        // enable/disable
        if (textEnableType == "enable-disable") {
            if( radioChecked.val() == textEnableValue ){
                target.attr("disabled", false);
            }else{
                target.attr("disabled", true);
            }
        // show/hide
        } else if (textEnableType == "show-hide") {
       // } else {
            if( radioChecked.val() == textEnableValue ){
                target.attr("style", "display:block");
                target.attr("disabled", false);
            }else{
                target.attr("style", "display:none");
                target.val("");
            }
        }
    }
})(jQuery);

(function($) {

    $(function(){

        /**
         * ラベル  クリックイベント
         */
        $(document).on('click', '.modificationField-label', function(e){
            var $modificationField = $(this).parent('.modificationFieldElem');
            var $modificationFieldContents = $('.modificationField-cont', $modificationField);
            var numSpeed = 400;
            // 修正フィールドを開く
            if ($modificationField.attr('data-displaymodificationfield')){
                // 開閉状況を判定
                if ($modificationField.hasClass('set')) {
                    // 既に開いている場合
                    $modificationFieldContents.slideUp(numSpeed, function(){
                        $modificationField.removeClass('set');
                        $modificationFieldContents.removeAttr('style')
                    });
                } else {
                    // 閉じている場合
                    $modificationField.addClass('set');
                    $modificationFieldContents.slideDown(numSpeed);
                }
            }
            return false;
        });

        /**
         * 元に戻るボタン  クリックイベント
         */
        $(document)
        .on('click', '.modificationField-revert', function(){

            // 親要素を取得
            var $modificationField = $(this).parents('.modificationFieldElem');

            // data-oldvalue属性から入力コントロール要素の値に設定
            setOldValueToControlValue($modificationField);

            // 配下の入力コントロール要素の値をラベルに設定
            refreshUnionLabel($modificationField);

            // 次ページボタンの活性/非活性を切り替える
            activateNextPageBtn();

        });

        /**
         * 変更イベント
         */
        $('.modificationFieldElem').on('change', function() {

            // 配下の入力コントロール要素の値をラベルに設定
            refreshUnionLabel($(this));

            // 次ページボタンの活性/非活性を切り替える
            activateNextPageBtn();

       });

    });

    /**
     * ロードイベント
     */
    $(window).on('load', function(){

        if (AU_COMMON.getCookie('wcmmode') != 'edit'
            || AU_COMMON.getParameter(document.location.href, 'wcmmode') == 'disabled') {

            var $modificationField = $('.modificationFieldElem');

            if ( $modificationField.length ) {

                // リレーJSONを取得
                var relayJson =  getRelayJson();

                // リレーJSONから登録結果JSONを取得
                var RESULTJSON_KEY = '__this_is_RegisteredResultJson__';
                var resultStr = getRelayJsonValues(relayJson, RESULTJSON_KEY)

                // 全体にエラーがあるかどうかを取得
                var isErrorHappenedElem = $('[name="__this_is_aucomErrorHappened__"]');
                var isErrorHappenedVal = 'false';
                if (isErrorHappenedElem) {
                    isErrorHappenedVal = isErrorHappenedElem.val();
                }

                if (resultStr) {

                    var resultJson =  JSON.parse(resultStr);

                    $modificationField.each(function(){

                        var $target = $(this);

                        // 登録結果JSONの値を配下の入力コントロール要素のdata-oldvalue属性に設定
                        setOldValue($target, resultJson);

                        // 配下の入力コントロール要素にエラーがある場合は修正フィールドを開いた状態にする
                        var $hasErrorElem = $target.find('.form-hasError');
                        if ($hasErrorElem.length) {
                            var $modificationFieldContents = $target.find('.modificationField-cont');
                            $target.addClass('set');
                            $modificationFieldContents.attr("style", "display:block");
                        }

                        if (!isCameBack(relayJson) && isErrorHappenedVal === 'false'){
                            // data-oldvalue属性から入力コントロール要素の値に設定
                            setOldValueToControlValue($target);
                        }

                        // 配下の入力コントロール要素の値をラベルに設定
                        refreshUnionLabel($target);

                        // 変更アイコンの表示/非表示切り替え
                        if ($target.attr('data-displaymodificationfield')) {
                            $target.find('.modificationField-changeIconLabel').each(function(){
                                $(this).css('display', '');
                            });
                        }

                    });

                    // 次ページボタンの活性/非活性を切り替える
                    activateNextPageBtn();

                }

            }
        }

    });

    /**
     * バケツリレーJSONを取得する
     */
    function getRelayJson() {
        var AU_COM_FORMID_SELECTOR = '#auComForm';
        var AU_COM_RELAY_JSON = '__this_is_aucomRelayJson__';

        var relayJsonStr = $(AU_COM_FORMID_SELECTOR + ' [name="' + AU_COM_RELAY_JSON + '"]').val();

        return JSON.parse(relayJsonStr);
    }

    /**
     * バケツリレーJSONから値を取得する
     * @param {String} relayJson バケツリレーJSON
     * @param {String} name バケツリレーJSON内のname
     * @return {Array} values バケツリレーJSON内のvalue
     */
    function getRelayJsonValues(relayJson, name) {
        var values;
        if (relayJson && relayJson.formData && relayJson.formData.pages) {
            var pages = relayJson.formData.pages.concat().reverse();// ページ逆順に漁る(バンドル側処理で行う値復元がページ逆順なのに合わせる)
            // ページ内スキャン
            pages.some(function(page) {
                /**
                 * ページ内elemsを再帰でスキャン
                 */
                function recursiveSearchElem(elems) {
                    if (elems) {
                        return elems.some(function(elem) {
                            if (elem.name == name) {
                                // valueかvaluesを取得
                                if (elem.value) {
                                    values = [ elem.value ];
                                    return true;
                                }
                                if (elem.values) {
                                    values = elem.values;
                                    return true;
                                }
                            }
                            // 子elemsに再帰
                            return recursiveSearchElem(elem.elems);
                        });
                    } else {
                        return false;
                    }
                }
                // ページ内elemsを再帰でスキャン
                return recursiveSearchElem(page.elems);
            });
        }
        return values;
    }

    /**
     * 登録結果JSONの値を各入力コントロール要素のdata属性に設定する
     * @param {ElementObject} $target 対象の当コンポーネント
     */
    function setOldValue($target, resultJson) {

        $target.find('[name]').each( function(index, element){
            var $targetElem = $(this);
            var resultValue = resultJson[$targetElem.attr('name')];

            if (resultValue !== undefined){

                switch ($targetElem.prop('tagName')) {
                case 'INPUT':
                    switch ($targetElem.prop('type')) {
                    case 'checkbox':
                    case 'radio':
                        var values = resultValue.split(',');
                        if (values.indexOf($targetElem.val()) >= 0) {
                            $targetElem.attr('data-oldvalue', 'on');
                        }else{
                            $targetElem.attr('data-oldvalue', 'off');
                        }
                        break;
                    default:
                        $targetElem.attr('data-oldvalue', resultValue);
                        break;
                    }
                    break;
                default:
                    $targetElem.attr('data-oldvalue', resultValue);
                    break;
                }

            }
        });
    }

    /**
     * data-oldvalue属性の値を各入力コントロール要素に適用する
     * @param {ElementObject} $target 対象の当コンポーネント
     */
    function setOldValueToControlValue($target) {

        $target.find('[name]').each( function(index, element){
            var $targetElem = $(this);
            var oldValue = $targetElem.attr('data-oldvalue');

            if (oldValue !== undefined){

                switch ($targetElem.prop('tagName')) {
                case 'INPUT':
                    switch ($targetElem.prop('type')) {
                    case 'text':
                        $targetElem.val(oldValue).trigger('change');
                        break;
                    case 'checkbox':
                    case 'radio':
                        if (oldValue === 'on') {
                            $targetElem.prop('checked', true).trigger('change');
                            $targetElem.parent().addClass('checked');
                        }else{
                            $targetElem.prop('checked', false).trigger('change');
                            $targetElem.parent().removeClass('checked');
                        }
                        break;
                    default:
                        $targetElem.val(oldValue).trigger('change');
                        break;
                    }
                    break;
                case 'SELECT':
                    $targetElem.val(oldValue).trigger('change');
                    break;
                case 'TEXTAREA':
                    $targetElem.val(oldValue).trigger('change');
                    break;
                }

                window.inquiryFormAPI.fireRefreshEvent($targetElem.attr('name'));

            }
        });
    }

    /**
     * 配下の入力コントロール要素から値を取得しラベルに設定する
     * @param {ElementObject} $target 対象の当コンポーネント
     */
    function refreshUnionLabel($target) {

        // 配下の入力コントロール要素から値を取得
        var unionValues = getUnionValues($target);

        // 取得した値をラベルに設定
        var $unionLabelElm = $('.modificationField-unionLabel', $target);
        $unionLabelElm.text(unionValues['currentUnionValue']);

        // ラベルのCSSを切り替える
        switchUnionLabelCss($unionLabelElm, unionValues);

        // 合体した値（旧）が空の場合、設定ダイアログの「未入力項目は表示しない」に応じて非表示設定を行う
        var notDispUnset = $target.attr('data-notDisplayEmpty');
        if (unionValues['oldUnionValue'] === '' && notDispUnset) {
            $target.css('display', 'none');
        }

    }

    /**
     * 配下にある入力コントロール要素の入力値を設定ダイアログで設定した書式に合わせた形で結合し返却する
     * 新旧の値を連想配列で返却する
     * @param {ElementObject} $target 対象の当コンポーネント
     * @return {currentUnionValue: String, oldUnionValue: String} unionValues
     *            配下の入力コントロール要素の値を合体させた値（新旧）
     */
    function getUnionValues ($target) {
        var $contents = $('.modificationField-cont', $target);
        var VALUE_DISPLAY_FORMAT = $contents.attr('data-valueDisplayFormat');
        var currentUnionValue = VALUE_DISPLAY_FORMAT;
        var oldUnionValue = VALUE_DISPLAY_FORMAT;
        var currentIsEmpty = true;
        var oldIsEmpty = true;

        if (VALUE_DISPLAY_FORMAT){

            // 配下にある入力コントロール要素のnameを全て取得
            var controlNameList = getControlNameList($contents);
            var currentValue = '';
            var oldValue = '';

            // nameリストに基づいて処理を繰り返す
            for (var i=0; i<controlNameList.length; i++){
                var controlName = controlNameList[i];
                var regExp = new RegExp('\\[' + controlName + '\\]', 'g');

                // 対象のnameから値を取得
                var controlValues = getControlValues($contents, controlName);

                // 現在の値を書式に合わせて結合
                if (controlValues['currentValues']){
                    currentValue = controlValues['currentValues'].join(',');
                    if (currentValue.trim() !== ''){
                        currentIsEmpty = false;
                    }
                    currentUnionValue = currentUnionValue.replace(regExp, currentValue);
                }

                // 過去の値を書式に合わせて結合
                if (controlValues['oldValues']){
                    oldValue = controlValues['oldValues'].join(',');
                    if (oldValue.trim() !== ''){
                        oldIsEmpty = false;
                    }
                    oldUnionValue = oldUnionValue.replace(regExp, oldValue);
                }
            }
        }

        // 現在の値が全て未入力の場合
        if (currentIsEmpty){
            currentUnionValue = '';
        }

        // 過去の値が全て未入力の場合
        if (oldIsEmpty){
            oldUnionValue = '';
        }

        return {currentUnionValue: currentUnionValue, oldUnionValue: oldUnionValue};
    }

    /**
     * 配下にある入力コントロール要素のnameを全て取得する
     * @param {ElementObject} $target 対象の当コンポーネント
     * @return {Array} controlNameList 配下の入力コントロール要素のnameリスト
     */
    function getControlNameList ($target) {
        var controlNameList = [];
        $target.find('input,select,textarea').each( function(index, element){
            var controlName = $(this).attr('name');
            // 既にリストにある場合はスキップ
            if (controlName && controlNameList.indexOf(controlName) == -1) {
                controlNameList.push(controlName);
            }
        });
        return controlNameList;
    }

    /**
     * 指定されたnameの入力値を取得する
     * 新旧の値を連想配列で返却する
     * @param {ElementObject} $target 対象の当コンポーネント
     * @param {Array} controlNameList 配下の入力コントロール要素のnameリスト
     * @return {currentUnionValue: String, oldUnionValue: String} unionValues
     *            配下の入力コントロール要素の値を合体させた値（新旧）
     */
    function getControlValues($target, name) {

        var currentValues = [];
        var oldValues = [];

        $target.find('[name="' + name + '"]').each( function(index, element){

            var $control = $(element);

            // 現在と過去の値を取得
            var currentValue;
            var oldValue;

            switch ($control.prop('tagName')) {
            case 'INPUT':
                switch ($control.prop('type')) {
                case 'checkbox':
                case 'radio':
                    $parent = $control.parent();
                    if ($control.prop('checked')) {
                        currentValue = $parent.text();
                    }
                    if ($control.attr('data-oldvalue') === 'on') {
                        oldValue = $parent.text();
                    }
                    break;
                default:
                    currentValue = $control.val();
                    oldValue = $control.attr('data-oldvalue');
                    break;
                }
                break;
            case 'SELECT':
                currentValue = $control.find('option:selected').text();
                oldValue = $control.find('[value="' + $control.attr('data-oldvalue') + '"]').text();
                break;
            case 'TEXTAREA':
                currentValue = $control.val();
                oldValue = $control.attr('data-oldvalue');
                break;
            }

            if (currentValue) {
                currentValues.push(currentValue);
            }

            if (oldValue) {
                oldValues.push(oldValue);
            }

        });

        return {currentValues: currentValues, oldValues: oldValues};
    }

    /**
     * 新旧の値を比較してCSSを切り替える
     * @param {ElementObject} $target 対象の当コンポーネント
     * @param {currentUnionValue: String, oldUnionValue: String} unionValues
     *            配下の入力コントロール要素の値を合体させた値（新旧）
     */
    function switchUnionLabelCss($target, unionValues) {

        // 配下の入力コントロール要素から値を取得
        var $contents = $('.modificationField-cont', $target);
        var $unionLabelElm = $('.modificationField-unionLabel', $target);

        // 新旧比較
        if (unionValues['currentUnionValue'] === unionValues['oldUnionValue']){
            $target.addClass('oldValue');
            $target.removeClass('newValue');
        }else{
            $target.removeClass('oldValue');
            $target.addClass('newValue');
        }
    }

    /**
     * 入力コントロールの値の変更状況に応じて次ページボタンの活性／非活性を切り替える
     */
    function activateNextPageBtn() {

        // 新しい値が入力された要素を取得
        var $newValueElm = $('.newValue');
        // 次ページボタン要素を取得
        var $nextPageBtn = $('button[value="USER_FORWARD"]');

        $nextPageBtn.each(function(){
            var $target = $(this);
            if ($newValueElm.length){
                $target.prop("disabled", false);
            }else{
                $target.prop("disabled", true);
            }
        });

    }

    /**
     * 次ページ以降から戻ってきたかを判定する
     * @return {Boolean} isCameBack
     *             true：次ページ以降から戻ってきた
     *             false：次ページ以降から戻ってきていない
     */
    function isCameBack(relayJson){
        var isCameBack = false;
        if (relayJson && relayJson.formData && relayJson.formData.pages && relayJson.formData.pagePathStack) {
            // リレーJSONの pages要素数（"--init--"除く）が pagePathStack要素数 より多い場合、次ページ以降から戻ってきたと判断
            if (relayJson.formData.pages.length -1 > relayJson.formData.pagePathStack.length ){
                isCameBack = true;
            }
        }

        return isCameBack;
    }

    // end of jquery

})(jQuery);


/* inquiryFormLinkageShowContainer.js */

(function($) {
    $(function() {
        if (AU_COMMON.getCookie('wcmmode') != 'edit'
            || AU_COMMON.getParameter(document.location.href, 'wcmmode') == 'disabled') {
            // 特定イベントハンドラ登録
            $('.show-hide-container').each(function() {
                var target = $(this);

                // ターゲットから属性を取得
                var dataShowName = target.attr('data-show-name');
                var dataShowValue = target.attr('data-show-value');

                // イベントリスナで表示非表示を切り替える
                var listener = function(isHit) {
                    if (isHit) {
                        $(target).removeClass('hide');
                    } else {
                        $(target).addClass('hide');
                    }
                }
                // イベントリスナーを登録
                var dataShowValues = [];
                if (dataShowValue) {
                    dataShowValues = dataShowValue.split(",");
                }
                inquiryFormAPI.addRefreshEventMonitoringListener(listener, dataShowName, dataShowValues);
            });
        }
    });
})(jQuery);

/* inquiryFormDesiredAvailableService.js */
(function($) {
    $(function(){
    
        //formにある連動ラジオ分回す
        $('section.desired-available-service', this).each(function(){
            inquiryFormLinkedEnableSp($(this).find('input:radio'));
        });
    
        $(document)
             .on('click', '.desired-available-service :radio', function(){
                inquiryFormLinkedEnableSp($(this));
        })
    
    });
    
    function inquiryFormLinkedEnableSp(radio) {
    
        // get parent
        var parent = radio.closest('section.desired-available-service');
    
        // get enable value
        var textEnableValue = parent.attr('data-enable-value');
    
        // target
        var targets = parent.find('input:checkbox,input:text,textarea');
    
        var radioChecked = parent.find(':radio:checked');
    
        // enable/disable
        if( radioChecked.val() == textEnableValue ){
            for ( var i=0;i< targets.length ;i++) {
                targets[i].disabled=false;
                if(targets[i].type == "checkbox"){
                    $(targets[i]).parent().removeClass("disabled");
                }
            }
        }else{
            for ( var i=0;i< targets.length ;i++) {
                if(targets[i].type == "checkbox"){
                    targets[i].checked = false;
                    $(targets[i]).parent().removeClass("checked");
                    $(targets[i]).parent().addClass("disabled");
                }else if(targets[i].type == "textarea"){
                    targets[i].value = "";
                }
                targets[i].disabled=true;
            }
            $('.form-list label.form-checkbox').toggleClass("checked",false);
        }
    }
})(jQuery);

/* inquiryFormAuIdContractsZipAddress.js */

(function($) {

    if (window.inquiryFormAuIdContractsZipAddressAPI) {
        return; // 2重初期化防止
    }
    window.inquiryFormAuIdContractsZipAddressAPI = {}; // 公開APIの箱

    var bindEvent = function(selectName) {
        setDisableZipAddressText($('input[type=radio][name=' + selectName + ']:checked'));
        $('input[type=radio][name=' + selectName + ']').on('change', function() {
            setDisableZipAddressText($(this));
        });
    }

    window.inquiryFormAuIdContractsZipAddressAPI.bindEvent = bindEvent;// 公開

    var setDisabled = function($item, disable) {
        if(disable) {
            if($item.attr('placeholder')) {
                $item.data('placeholder', $item.attr('placeholder'));
                $item.attr('placeholder', '');
            }
            $item.val('');
        } else {
            var dataPlaceholder = $item.data('placeholder');
            $item.attr('placeholder', dataPlaceholder);
        }
        $item.prop('disabled', disable);
    }

    function setDisableZipAddressText($selectAddress) {
        var $zipAndAddress = $('.inquiryFormAuIdContractsZipAndAddress');
        if($zipAndAddress) {
            var $zip1 = $zipAndAddress.find('input[name=user_contract_split_zip1]');
            var $zip2 = $zipAndAddress.find('input[name=user_contract_split_zip2]');
            var $pref = $zipAndAddress.find('[name=user_contract_split_pref]');
            var $address1 = $zipAndAddress.find('input[name=user_contract_split_address1]');
            var $address2 = $zipAndAddress.find('input[name=user_contract_split_address2]');
            var $address3 = $zipAndAddress.find('input[name=user_contract_split_address3]');
            var $addressBtn = $zipAndAddress.find('[name=user_contract_split_addressBtn]');

            if ($selectAddress.val() == '_change_') {
                setDisabled($zip1, false);
                setDisabled($zip2, false);
                setDisabled($pref, false);
                setDisabled($address1, false);
                setDisabled($address2, false);
                setDisabled($address3, false);
                $addressBtn.css('pointer-events','');
            } else {
                setDisabled($zip1, true);
                setDisabled($zip2, true);
                setDisabled($pref, true);
                setDisabled($address1, true);
                setDisabled($address2, true);
                setDisabled($address3, true);
                $addressBtn.css('pointer-events','none');
            }
        }

    }
})(jQuery);

/* inquiryFormAuIdContractsTelsWithOther.js */

(function($) {

    if (window.inquiryFormAuIdContractsTelsWithOtherAPI) {
        return; // 2重初期化防止
    }
    window.inquiryFormAuIdContractsTelsWithOtherAPI = {}; // 公開APIの箱

    var bindEvent = function(selectName) {
        setDisableTelText($('input[type=radio][name=' + selectName + ']:checked'));
        $('input[type=radio][name=' + selectName + ']').change(function() {
            setDisableTelText($(this));
        });
    }

    window.inquiryFormAuIdContractsTelsWithOtherAPI.bindEvent = bindEvent;// 公開

    function setDisableTelText($selectTel) {
        if ($selectTel.val() == '_change_') {
            $('input[type=text][name=telNo]').prop('disabled', false);
        } else {
            $('input[type=text][name=telNo]').prop('disabled', true);
            $('input[type=text][name=telNo]').val('');
        }
    }
})(jQuery);

/* inquiryFormAuIdContractsEmails.js */

(function($) {
    
    if (window.inquiryFormAuIdContractsEmailsAPI) {
        return; // 2重初期化防止
    }
    window.inquiryFormAuIdContractsEmailsAPI = {}; // 公開APIの箱
    
    var bindEvent = function(selectName) {
        setDisableEmailText($('input[type=radio][name=' + selectName + ']:checked'));
        $('input[type=radio][name=' + selectName + ']').on('change', function() {
            setDisableEmailText($(this));
        });
    }
    
    window.inquiryFormAuIdContractsEmailsAPI.bindEvent = bindEvent;// 公開
    
    function setDisableEmailText($selectMail) {
    
        if ($selectMail.val() == '_change_') {
            $('input[type=text][name=mail_address]').prop('disabled', false);
            $('input[type=text][name=r_mail_address]').prop('disabled', false);
        } else {
            $('input[type=text][name=mail_address]').prop('disabled', true);
            $('input[type=text][name=mail_address]').val('');
            $('input[type=text][name=r_mail_address]').prop('disabled', true);
            $('input[type=text][name=r_mail_address]').val('');
        }
    }
})(jQuery);

/* inquiryFormLinkageOnRequired.js */

(function($) {
    $(function() {
        // 特定イベントハンドラ登録
        $('.inquiryForm-linkage-on-required').each(function() {
            var target = $(this);
    
            // ターゲットから属性を取得
            var dataConditionName = target.attr('data-condition-name');
            var dataConditionValue = target.attr('data-condition-value').split(",");
            var dataOnReqName = target.attr('data-on-req-name');
            var dataAddRequiredDisplay = target.attr('data-add-required-display');
    
            // イベントリスナで表示非表示を切り替える
            var listener = function(isHit) {
                // 必須spanタグHTMLの元ネタ(隠してある)
                var requiredSpan = $(inquiryFormAPI.AU_COM_FORMID_SELECTOR + " #inquiryFormRequiredLabel");
                // 必須にする項目
                var injectRequiredTarget = $("[name='" + dataOnReqName + "']:first");// nameに複数一致する場合は最初の1件目を基準に
                if (injectRequiredTarget.length == 0) {
                    return;
                }
                // 必須表示付与がON出ない場合処理続行しない。
                if (!dataAddRequiredDisplay) {
                    return;
                }
                // 必須を差し込む基準位置になるタイトルのタグを親form-contを起点にして探す。
                var parentFormCont = injectRequiredTarget.closest(".form-cont");
                // 1)親form-contの子孫のノードの中の、1つ目の子ulの下にあるinquiryForm-titleクラス
                var titleTag = parentFormCont.find("ul:first-child .inquiryForm-title");
                if (titleTag.length == 0) {
                    // 2)それで見つからなければ親form-contの兄弟の1つ目にあるulの下にあるinquiryForm-titleクラス
                    titleTag = parentFormCont.parent().children("ul:first").find(".inquiryForm-title");
                }
                var requiredLabelExisted = titleTag.children(".inquiryForm-requiredLabel");// title内部にある
                if (isHit) {
                    requiredSpan = requiredSpan.clone().removeClass("hide").removeAttr("id");
                    // 2重必須防止。まだ必須になっていなければ必須を追加
                    if (requiredLabelExisted.length == 0) {
                        titleTag.append(requiredSpan);
                    }
                } else {
                    requiredLabelExisted.remove();
                }
            }
            // イベントリスナーを登録
            inquiryFormAPI.addRefreshEventMonitoringListener(listener, dataConditionName, dataConditionValue);
        });
    });
})(jQuery);

(function($) {
    var isFirst = true;
    $(function(){
        $(':submit', "form#auComForm").on('click', function() {
            if (isFirst) {
                isFirst = false;

                // hidden項目に次ページパス設定
                var nextPageBtnPathParam = $('<input>');
                nextPageBtnPathParam.attr('type', 'hidden');
                nextPageBtnPathParam.attr('name', 'nextPageBtnPath');
                nextPageBtnPathParam.val($(this).data('nextpagepath-btns'));
                $('form#auComForm').append(nextPageBtnPathParam);

            } else {
                return false;
            }
        });
    });
})(jQuery);
(function($) {
    $(function(){
        var onFocusClass = 'onFocus';
        $.fn.checked = function(){
            var $input = this.not('option'),
                $label = $input.parent('label'),
                strName = $input.attr('name'),
                $siblingRadio = $('[name="' + strName + '"]:radio').parent('label'),
                strChecked = 'checked',
                blnChecked = $input.prop('checked')
            ;
            if (blnChecked) {
                if ($input.is(':radio')) {
                    $siblingRadio.removeClass(strChecked);
                }
                $label.addClass(strChecked);
            } else {
                $label.removeClass(strChecked).removeClass(onFocusClass);
            }
        };

        $(document)

            .on('change', ':checkbox, :radio', function(){
                $(this).checked();
            })

            .on('focusin', '.form-radio :radio, .form-checkbox :checkbox', function(){
                var $radio = $(this),
                    $label = $radio.parent('label')
                ;
                if(!$label.hasClass(onFocusClass)){
                    $label.addClass(onFocusClass);
                }
            })
            .on('focusout', '.form-radio :radio, .form-checkbox :checkbox', function(){
                var $radio = $(this),
                    $label = $radio.parent('label'),
                    onFocusClass = 'onFocus'
                ;
                if($label.hasClass(onFocusClass)){
                    $label.removeClass(onFocusClass);
                }
            })

        /* テキストフィールドフォーカス時にプレースホルダ削除 */
            .on({
                'focusin': function(){
                    var $field = $(this),
                        strPlaceholder = $field.attr('placeholder')
                    ;
                    $field
                        .attr('data-placeholder', strPlaceholder)
                        .attr('placeholder', '')
                    ;
                },
                'blur': function(){
                    var $field = $(this),
                        strPlaceholder = $field.attr('data-placeholder')
                    ;
                    $field.attr('placeholder', strPlaceholder);
                }
            },'[placeholder]')

        ;

        $(window)

            .on('load', function(){
                $(':checked').checked();
            })

        ;

        // end of jquery
    });
})(jQuery);
/* inquiryForm.js */

//問合せフォーム共通API
(function($) {
    if (window.inquiryFormAPI) {
        return; // 2重初期化防止
    }
    window.inquiryFormAPI = {}; // 公開APIの箱

    /* 定数 */
    var AU_COM_FORMID_SELECTOR = "#auComForm";
    window.inquiryFormAPI.AU_COM_FORMID_SELECTOR = AU_COM_FORMID_SELECTOR;// 公開
    var AU_COM_RELAY_JSON = "__this_is_aucomRelayJson__";
    var REFRESH_EVENT_NAME = 'au-com-refresh';

    var relayJson; // バケツリレーJSONパース結果キャッシュ

    // 以下は値変更イベント関係メソッド

    /**
     * 値変更リフレッシュリスナー追加
     * 
     * @param f
     *            コールバックfunction(event)
     */
    var addRefreshEventListener = function(f) {
        $(document).on(REFRESH_EVENT_NAME, f);
    }
    window.inquiryFormAPI.addRefreshEventListener = addRefreshEventListener;// 公開

    /**
     * 値変更リフレッシュリスナー追加。引数monitoringNameに値変更があった場合に、最新の項目値にmonitoringValuesが含まれるかどうかのフラグを伴ってコールバック関数を呼び出す。
     * 
     * @param f
     *            コールバック function(isHit, コントロールのname、コントロールの値配列)
     *            引数isHitはmonitoringNameのmonitoringValuesに一致したかどうかのboolean
     * @param monitoringName
     *            監視対象項目名
     * @param monitoringValues
     *            監視値
     */
    var addRefreshEventMonitoringListener = function(f, monitoringName, monitoringValues) {

        /**
         * 新しい項目値が監視値に合致するかどうかを調べる
         */
        function checkMonitoringValue(newValues) {
            if (newValues === undefined || newValues.length == 0) {
                return false;
            }
            return newValues.some(function(newV) {
                return monitoringValues.some(function(monitoringV) {
                    return (newV == monitoringV);
                });
            });
        }

        /**
         * 値監視コールバックファンクション
         */
        function monitoringFunc(event, eventSourceName, newValues) {
            if (eventSourceName != monitoringName) {
                return; // 値変更された項目名がmonitoringNameでないなら無視
            }
            // 値合致判定
            var isHit = checkMonitoringValue(newValues);
            // 本来のコールバックを呼び出し
            f(isHit, eventSourceName, newValues);
        }

        /**
         * 画面初期化時処理：画面内コントロールまたはバケツリレーJSONに指定monitoringName項目があれば反応する
         */
        function fireInitRefresh(monitoringName) {
            // 画面内コントロールから最新値を取得
            var values = getControlValues(monitoringName);
            if (values == undefined) {
                // 前画面データ(バケツリレーJSON)にあればそこから取得 ※リスナー登録時のみ
                values = getRelayJsonValues(monitoringName);
            }
            // イベント発火
            fireRefreshEvent(monitoringName, values);
        }

        // documentにイベントリスナー登録
        $(document).on(REFRESH_EVENT_NAME, monitoringFunc);
        // 初期化のためにイベント強制発火
        fireInitRefresh(monitoringName);
    }
    window.inquiryFormAPI.addRefreshEventMonitoringListener = addRefreshEventMonitoringListener;// 公開

    /**
     * コントロールの値を取得する
     * 
     * @param name
     *            コントロールのname
     */
    function getControlValues(name) {
        var controls = $("[name='" + name + "']");
        // JQuieryでselectしてみて存在しないならundefined
        if (controls.length == 0) {
            return undefined;
        }
        // checkbox,radio,select対応
        var values = [];
        for (var i = 0; i < controls.length; i++) {
            var control = $(controls[i]);
            var value = null;
            switch (control.prop("tagName")) {
            case "INPUT":
                switch (control.prop("type")) {
                case "checkbox":
                case "radio":
                    var checkedControl = control.filter(":checked");
                    if (checkedControl.length > 0) {
                        value = checkedControl.val();
                    }
                    break;
                default:
                    value = control.val();
                    break;
                }
                break;
            case "SELECT":
                value = control.val();
                break;
            }
            if (value != null) {
                values.push(value);
            }
        }
        return values;
    }

    /**
     * バケツリレーJSONからの値を取得する
     * 
     * @param name
     *            バケツリレーJSON内のname
     */
    function getRelayJsonValues(name) {
        var values;
        if (getRelayJson() && getRelayJson().formData && getRelayJson().formData.pages) {
            var pages = getRelayJson().formData.pages.concat().reverse();// ページ逆順に漁る(バンドル側処理で行う値復元がページ逆順なのに合わせる)
            // ページ内スキャン
            pages.some(function(page) {
                /**
                 * ページ内elemsを再帰でスキャン
                 */
                function recursiveSearchElem(elems) {
                    if (!elems) {
                        return false;
                    }
                    var found = elems.some(function(elem) {
                        // valueかvaluesを取得
                        if (elem.name == name) {
                            if (elem.value !== undefined) {
                                values = [ elem.value ];
                                return true;
                            }
                            if (elem.values !== undefined) {
                                values = elem.values;
                                return true;
                            }
                        }
                        // 子elemsに再帰
                        if (elem.elems) {
                            if (recursiveSearchElem(elem.elems)) {
                                return true;
                            }
                        }
                    });
                    return found;
                }
                // ページ内elemsを再帰でスキャン
                return recursiveSearchElem(page.elems);
            });
        }
        return values;
    }

    /**
     * 値変更リフレッシュイベントを発火する
     * 
     * @param name
     *            項目名
     * @param values
     *            新項目値(配列)
     */
    var fireRefreshEvent = function(name, values) {
        // 第2引数が無指定なら値を自前で取得
        if (values === undefined) {
            values = getControlValues(name);
        }
        // イベント発火
        $(document).trigger(REFRESH_EVENT_NAME, [ name, values ]);
    }
    window.inquiryFormAPI.fireRefreshEvent = fireRefreshEvent;// 公開

    /**
     * 値変更リフレッシュイベントを発火する
     * 
     * @param onchangeなどのイベント
     */
    var fireRefreshEventStd = function(event) {
        // イベントから情報を収集
        var c = event.target;
        var control = $(c);
        var name = control.prop("name");
        fireRefreshEvent(name);
    }
    window.inquiryFormAPI.fireRefreshEventStd = fireRefreshEventStd;// 公開

    /**
     * バケツリレーJSONを取得する
     */
    function getRelayJson() {
        if (relayJson) {
            return relayJson;
        }
        var relayJsonStr = $(AU_COM_FORMID_SELECTOR + " [name=" + AU_COM_RELAY_JSON + "]").val();
        if (!relayJsonStr) {
            relayJsonStr = "{}";
        }
        relayJson = JSON.parse(relayJsonStr);
        return relayJson;
    }
})(jQuery);
(function($) {
    // document ready func
    $(function() {
        // レコメンド部品対応のモーダルポップアップとのバインディング
        if ($(window.inquiryFormAPI.AU_COM_FORMID_SELECTOR).attr("data-do-show-recommend")) {
            $('.qaModal-openBtn').trigger('click');
            $("#ContentScrollView", parent.document).scrollTop(0, 0);// editor.htmlのiframe時モーダル見えない対応。強制スクロール
        }

        // 値変更イベントハンドラを登録(ラジオ、チェックボックス、セレクト)
        $('.form-radio,.form-checkbox,.inquiryForm-select').on('change', function(event) {
            // 特定イベントをトリガする
            window.inquiryFormAPI.fireRefreshEventStd(event);
        })
    });
})(jQuery);
(function($) {

    /**
     * ロードイベント
     */
    $(window).on('load', function(){

        if (AU_COMMON.getCookie('wcmmode') != 'edit'
            || AU_COMMON.getParameter(document.location.href, 'wcmmode') == 'disabled') {

            var $dispAndMailElem  = $('.hikkoshiFormDispAndMailForModify');
            if ($dispAndMailElem.length) {

                // リレーJSON取得
                var relayJson = getRelayJson();

                // リレーJSONから登録結果JSONを取得
                var RESULTJSON_KEY = "__this_is_RegisteredResultJson__";
                var resultJson =  JSON.parse(getRelayJsonValues(relayJson, RESULTJSON_KEY));

                $dispAndMailElem.each( function(){

                    $target = $(this);

                    // リレーJSONから確認画面で表示する項目のnameを取得
                    var typeList = ['PARTIAL', 'PARTIAL_LIST'];
                    var nameList =  getRelayJsonNames(relayJson, typeList);

                    nameList.forEach( function(names){

                        // 比較結果初期化
                        var isMatched = true;

                        // 郵便番号はnameが二つ入っているため分割（例："zip1,zip2"）
                        var namesArray = names.split(',');

                        // このnameをキーに新旧比較を行う
                        namesArray.forEach( function(name){

                            // 登録結果JSONとリレーJSONから新旧の値を取得し値を比較
                            var oldValue = resultJson[name];
                            var newValue = getRelayJsonValues(relayJson, name);

                            if (newValue){
                                newValue = newValue.join(',');
                            }

                            // 新旧の値を比較
                            if (oldValue !== newValue){
                                isMatched = false;
                            }

                        });

                        // 一致しない場合
                        if (!isMatched) {
                            // 文字色を赤文字にする
                            $target.find('[data-name="' + names + '"]').each( function(){
                                $(this).addClass('txtColor-alert');
                            });
                        }

                    });
                });
            }

        }

    });

    /**
     * バケツリレーJSONを取得する
     */
    function getRelayJson() {
        var AU_COM_FORMID_SELECTOR = "#auComForm";
        var AU_COM_RELAY_JSON = "__this_is_aucomRelayJson__";

        var relayJsonStr = $(AU_COM_FORMID_SELECTOR + " [name=" + AU_COM_RELAY_JSON + "]").val();
        if (!relayJsonStr) {
            relayJsonStr = "{}";
        }

        return JSON.parse(relayJsonStr);;
    }

    /**
     * バケツリレーJSONからnameのリストを取得する
     * @param {String} relayJson バケツリレーJSON
     * @param {Array} typeList バケツリレーJSON内のtypeのリスト
     * @return {Array} nameList バケツリレーJSON内のnameのリスト
     */
    function getRelayJsonNames(relayJson, typeList) {
        var nameList = [];
        if (relayJson && relayJson.formData && relayJson.formData.pages) {
            // ページ逆順に漁る(バンドル側処理で行う値復元がページ逆順なのに合わせる)
            var pages = relayJson.formData.pages.concat().reverse();
            // ページ内スキャン
            pages.forEach(function(page) {
                /**
                 * ページ内elemsを再帰でスキャン
                 */
                function recursiveSearchElem(elems) {
                    if (elems) {
                        elems.forEach(function(elem) {
                            // nameを取得
                            if ( typeList.indexOf(elem.type) >= 0 ) {
                                if (elem.name) {
                                    nameList.push(elem.name);
                                }
                            }
                            // 子elemsに再帰
                            recursiveSearchElem(elem.elems);
                        });
                    }
                }
                // ページ内elemsを再帰でスキャン
                return recursiveSearchElem(page.elems);
            });
        }
        return nameList;
    }

    /**
     * バケツリレーJSONから値を取得する
     * @param {String} relayJson バケツリレーJSON
     * @param {String} name バケツリレーJSON内のname
     * @return {Array} values バケツリレーJSON内のvalue
     */
    function getRelayJsonValues(relayJson, name) {
        var values;
        if (relayJson && relayJson.formData && relayJson.formData.pages) {
            var pages = relayJson.formData.pages.concat().reverse();// ページ逆順に漁る(バンドル側処理で行う値復元がページ逆順なのに合わせる)
            // ページ内スキャン
            pages.some(function(page) {
                /**
                 * ページ内elemsを再帰でスキャン
                 */
                function recursiveSearchElem(elems) {
                    if (elems) {
                        return elems.some(function(elem) {
                            if (elem.name == name) {
                                // valueかvaluesを取得
                                if (elem.value) {
                                    values = [ elem.value ];
                                    return true;
                                }
                                if (elem.values) {
                                    values = elem.values;
                                    return true;
                                }
                            }
                            // 子elemsに再帰
                            return recursiveSearchElem(elem.elems);
                        });
                    } else {
                        return false;
                    }
                }
                // ページ内elemsを再帰でスキャン
                return recursiveSearchElem(page.elems);
            });
        }
        return values;
    }
    // end of jquery
})(jQuery);


(function($) {
    $(function(){
        "use strict";

        var relatedQuestion = $('.cmp-au-com-faq-related-question');
        if (relatedQuestion.length != 0) {
            var cnt, queryKbanIds = [], callbacks = [];
            // 「関連する質問」の役に立った数設定
            var listingKbanIds = {};
            $("ul.qaList > li > a").each(function(){
                var mat, href = $(this).attr('href');
                if (href) {
                    if (href.match(/\/support\/faq\/detail/)) {
                        mat = href.split('/support/faq/detail/')[1].split('?')[0].split('/')[1].split('.')[0]
                    } else {
                        mat = href.split('/support/faq/view.')[1].split('?')[0].replace('/','').split('.')[0]
                    }
                    listingKbanIds[mat] = 0;
                }
            });
            if (! $.isEmptyObject(listingKbanIds)) {
                queryKbanIds = queryKbanIds.concat(Object.keys(listingKbanIds));
                callbacks.push(function(kbanCountMap) {
                    $("ul.qaList > li > a").each(function() {
                        var mat, href = $(this).attr('href');
                        if (href) {
                            if (href.match(/\/support\/faq\/detail/)) {
                                mat = href.split('/support/faq/detail/')[1].split('?')[0].split('/')[1].split('.')[0]
                            } else {
                                mat = href.split('/support/faq/view.')[1].split('?')[0].replace('/','').split('.')[0]
                            }
                            var kbanId = mat,
                                target = $("span.iconCount", $(this).parent());
                            if (target.length && kbanCountMap[kbanId]) {
                                target.text(kbanCountMap[kbanId]);
                            }
                        }
                    });
                });
            }

            if (queryKbanIds.length) {
                $.ajax({url: '/bin/wcm/au-com/questionnaire_list.json',
                    type: 'GET',
                    dataType: 'json',
                    data: {questionIds: queryKbanIds.join(',')},
                    cache: false}
                ).done(function(data) {
                    var kbanCountMap = {};
                    if (data && data.qa_information && data.qa_information.length) {
                        data.qa_information.forEach(function(i) {
                            kbanCountMap[i.questionId] = i.questionnaire_yes;
                        });
                        callbacks.forEach(function(f) {
                            f(kbanCountMap);
                        });
                    }
                }).fail(function(data, textStatus, errorThrown) {
                    console.log('questionnaire_list.json request failed. ' + textStatus + ' ' + errorThrown);
                });
            }
        }
    });
})(jQuery);
(function($) {
    $(function(){
        "use strict";

        var faqlistdetail = $('.cmp-au-com-faq-list-detail');
        if (faqlistdetail.length != 0) {
            // アコーディオンのクリック処理
            $('.cmp-faq-list-detail-list-acdn__header').on('click', function(){
                var target = $(this).data('target');
                // アコーディオンの開閉
                $('#' + target).slideToggle();
                // 開閉マーク用のクラスを追加／削除
                var expand = $('div[name=' + target + ']');
                const accordionLink = expand.find('.cmp-faq-list-detail-list-acdn__header');
                var classNames = expand.attr("class");
                if (classNames.indexOf("cmp-faq-list-detail-list-acdn__expanded") >= 0) {
                    expand.removeClass('cmp-faq-list-detail-list-acdn__expanded');
                    accordionLink.attr('aria-expanded','false');
                }
                else {
                    expand.addClass('cmp-faq-list-detail-list-acdn__expanded');
                    accordionLink.attr('aria-expanded','true');
                }
            });

            // モーダル表示
            var scrollPos;
            var iframe = $('.cmp-faq-list-detail-model__frame');
            $('a.cmp-faq-list-detail__modal__js').on('click', function() {
                scrollPos = $(window).scrollTop();//topからのスクロール位置を格納
                var url = $(this).data('url');
                if (iframe.length != 0) {
                    if (AU_COMMON.getParameter(document.location.href, 'wcmmode') == 'disabled') {
                        url += "?wcmmode=disabled";
                    }
                    iframe.attr("src", url);
                }
                $('.cmp-faq-list-detail-modal').fadeIn();
                $('body').addClass('fixed').css({ top: -scrollPos });//背景固定
                return false;
            });

            // モーダルクローズ
            $('.cmp-faq-list-detail-modal__close__js').on('click',function(){
                $('.cmp-faq-list-detail-modal').fadeOut();
                $('body').removeClass('fixed').css({ top: 0 });//背景固定を解除
                $(window).scrollTop(scrollPos);//元の位置までスクロール
                if (iframe.length != 0) {
                    iframe.attr("src", "");
                }
                return false;
            });

            // K番をwindowsのChromeのiframeで表示するとmaincontAreaに無駄な縦スクロールバーが表示されるのでiframeのロード時に消す。
            $('.cmp-faq-list-detail-model__frame').on('load',function(){
                var result = $('.cmp-faq-list-detail-model__frame').contents().find('#maincontArea');
                if (result.length) {
                    result.css('overflow-y','hidden');
                }
            });
        }
    });
})(jQuery);
(function($) {
    $(function(){
        "use strict";

        var faqcategorysearch = $('.cmp-au-com-faq-category-search');
        if (faqcategorysearch.length != 0) {
            // アコーディオンのクリック処理
            $('.cmp-faq-category-search-acdion').on('click', function(){
                var target = $(this).data('target');
                // アコーディオンの開閉
                $('#' + target).slideToggle();
                // 開閉マーク用のクラスを追加／削除
                var expand = $('div[name=' + target + ']');
                var classNames = expand.attr("class");
                if (classNames.indexOf("expanded") >= 0) {
                    expand.removeClass('expanded');
                }
                else {
                    expand.addClass('expanded');
                }
            });
        }
    });
})(jQuery);
(function($) {
    "use strict";

    $(document).ready(function(){

        $('a.suggestWordListItem-link').on('click', function() {
            $('#qaSrch-cont-suggest input.form-searchKwSgst').val($(this).text());
            var suggestParam = $('<input>');
            suggestParam.attr('type', 'hidden');
            suggestParam.attr('name', 'suggest');
            suggestParam.val($('#clickParam').val());
            $('#qaSrch-cont-suggest form').append(suggestParam);
            $('#qaSrch-cont-suggest form').trigger('submit');
        });
    });
})(jQuery);


(function($) {
    $(function() {
        "use strict";

        addHrefToFaqliSgst("ol li.clspageNumSgst");
        addClickToFaqPageSgst(".qaLayout-resoulCount.suggest ol li.clspageNumSgst a", 'clspageNumSgst');
        addClickToFaqPageSgst(".qaLayout-resoulCount.suggest a.pagenation-prevSgst", 'prev');
        addClickToFaqPageSgst(".qaLayout-resoulCount.suggest a.pagenation-nextSgst", 'next');

        $('select[name=sortbySgst]').on('change', function() {
            if ($('#qaSrch-cont-suggest').length && $('[name=hidKeyWord]').val()) {
                $('#qaSrch-cont-suggest input.form-searchKwSgst').val($('[name=hidKeyWord]').val());
                $('#qaSrch-cont-suggest input[name=pageNum]').val('1');
                $('#qaSrch-cont-suggest input[name=sortby]').val($(this).val());
                // 計測パラメータ有無判定と設定
                var url   = location.href;
                setMeasurementParams(url);

                $('#qaSrch-cont-suggest form').trigger('submit');
            } else {
                var url = $('input[name=hidPagePath]').val();
                var sortby = $(this).val();
                url = url + "?pageNum=1&sortby=" + sortby;
                window.location.href = url;
            }
        });

        function addHrefToFaqliSgst (pageNumObj) {
            var hidPageNum = $('input[name=hidPageNum]').val();
            var totalPage = $('input[name=hidTotalPage]').val();

            $(pageNumObj).each(function( index ) {
                var liVal = $(this).text();
                if (index == 0) {
                    $(this).addClass("firstChild");
                }
                if (liVal == hidPageNum) {
                    $(this).addClass("active");
                } else {
                    $(this).text('');
                    if (index == 0) {
                        if (hidPageNum > 2 && totalPage > 3) {
                            $(this).before('<li class="ellipsis">...</li>');
                        }
                    }
                    $(this).append($("<a>", { href: '#' }).text(liVal));
                }
                if (index == 2 && (Number(hidPageNum)+1) < totalPage && totalPage > 3) {
                    $(this).after('<li class="ellipsis">...</li>');
                }
            });
        }

        function setMeasurementParams(url) {
            var params    = (url.split("?")) ? url.split("?") : "";
            var spparams   = (params[1]) ? params[1].split("&") : "";
            var paramArray = [];
            for (var i = 0; i < spparams.length; i++) {
                var vol = spparams[i].split("=");
                paramArray.push(vol[0]);
                paramArray[vol[0]] = vol[1];
            }
            if ( paramArray["suggest"]) {
                var suggestParam = $('<input>');
                suggestParam.attr('type', 'hidden');
                suggestParam.attr('name', 'suggest');
                suggestParam.val(paramArray["suggest"]);
                $('#qaSrch-cont-suggest form').append(suggestParam);
            }
        }

        function addClickToFaqPageSgst(selector, eventid) {
            $(selector).on('click', function() {
                var pageNum;
                var totalPage = $('input[name=hidTotalPage]').val();
                if (eventid == "clspageNumSgst") {
                    pageNum = $(this).text();
                } else if (eventid == "prev") {
                    pageNum = $('input[name=hidPageNum]').val();
                    if(Number(pageNum) > 1) {
                        pageNum--;
                    }
                } else if (eventid == "next") {
                    pageNum = $('input[name=hidPageNum]').val();
                    if(Number(pageNum) < Number(totalPage)) {
                        pageNum++;
                    }
                }

                if ($('#qaSrch-cont-suggest').length && $('[name=hidKeyWord]').val()) {
                    $('#qaSrch-cont-suggest input.form-searchKwSgst').val($('[name=hidKeyWord]').val());
                    $('#qaSrch-cont-suggest input[name=pageNum]').val(pageNum);
                    $('#qaSrch-cont-suggest input[name=sortby]').val($('select[name=sortbySgst]').val());
                    // 計測パラメータ有無判定と設定
                    var url   = location.href;
                    setMeasurementParams(url);

                    $('#qaSrch-cont-suggest form').trigger('submit');
                } else {
                    var url = $('input[name=hidPagePath]').val();
                    var sortby = $('select[name=sortbySgst]').val();
                    url = url + "?pageNum=" + pageNum + "&sortby=" + sortby;
                    window.location.href = url;
                }
            });
        }

    });
})(jQuery);

(function($) {
    "use strict";
    
    $(function(){
        $('a.keywordListItem-link').on('click', function() {
            $('#qaSrch-cont input.form-searchKw').val($(this).text());
            $('#qaSrch-cont form').trigger('submit');
        });
    });
})(jQuery);

(function($) {
    $(function(){
        "use strict";

        var faqQuestionnaire = $('.faq-questionnaire');
        if (faqQuestionnaire.length != 0) {
            if (window.CommonUtil.isAuthorEditor()) {
                $('.cmp-au-com-questionnaire-officialfeedback').show();
                $('.cmp-au-com-evaluate-officialfeedback').show();
                $('.cmp-au-com-questionnaire-sns').show();
                $('.cmp-au-com-evaluate-sns').show();
            }

            var questionId = $('#questionId').val();
            var date = new Date();
            date.setTime(date.getTime() + 3*24*60*60*1000);

            // 役に立ちましたか「はい」
            var isFirst = true;
            $(document).on('click', 'a.cmp-au-com-helpful', function () {
                QuestionnaireButtonProc("1");
            });

            // 役に立ちましたか「いいえ」
            $(document).on('click', 'a.cmp-au-com-unhelpful', function () {
                QuestionnaireButtonProc("2");
            });

            // 役に立ちましたか「探していた質問ではなかった」
            $(document).on('click', 'a.cmp-au-com-wrong', function () {
                QuestionnaireButtonProc("5");
            });

            // アンケートボタン処理
            function QuestionnaireButtonProc(type) {
                if(isFirst){
                    questionId = $('#questionId').val();
                    date = new Date();
                    date.setTime(date.getTime() + 3*24*60*60*1000);
                    isFirst = false;
                    document.cookie = 'CakeCookie[myUsefuled][' + questionId + ']=1' + ';path=/;expires=' + date + ';secure';
                    $.ajax({
                        url: '/bin/wcm/au-com/vote_qa.do',
                        type: 'GET',
                        data: {
                            'questionId' : questionId ,
                            'questionnaireType' : type
                        },
                        cache : false,
                    }).done(function(data) {
                    }).fail(function(data) {
                    });
                } else {
                    return;
                }
                var questionnaireTypeList = $('input[name="questionnaireType"]');
                if (questionnaireTypeList.length != 0) {
                    for (var i=0; i<questionnaireTypeList.length; i++) {
                        questionnaireTypeList[i].value = type;
                    }
                }
                // 「はい」「いいえ」ボタン非表示
                $('.cmp-au-com-questionnaire-btn').hide();
                $('.cmp-au-com-evaluate-btn').hide();
                // フィードバックエリア表示
                $('.cmp-au-com-questionnaire-officialfeedback').show();
                $('.cmp-au-com-evaluate-officialfeedback').show();
                if (type != "1") {
                    var sns = $('.cmp-au-com-questionnaire-sns');
                    var snsEval = $('.cmp-au-com-evaluate-sns');
                    // チャット起動ボタン非表示か判定
                    var noSearch = document.getElementsByName('noChat');
                    if (noSearch.length == 0) {
                        // チャット起動ボタン非表示ではないなく、ボタンがある場合は表示する。
                        var snsList = sns.find('.cmp-au-com-sns__list-item');
                        if (sns.length != 0 && snsList.length != 0) {
                            if (snsList.css('display') != 'none') {
                                sns.show();
                            }
                        }
                        var snsEvalList = snsEval.find('.cmp-au-com-sns__list-item');
                        if (snsEval.length != 0 && snsEvalList.length != 0) {
                            if (snsEvalList.css('display') != 'none') {
                                snsEval.show();
                            }
                        }
                    }
                }
            }

            var isSendFirst = true;
            //送信ボタン押下
            $(document).on('click', 'a#cmp-au-com-questionnaire-officialfeedback-submit', function () {
                if (!isSendFirst) {
                    return false;
                }

                //入力メッセージチェック
                if ($('.cmp-au-com-questionnaire-officialfeedback_comment')[0].value == "") {
                    $('.cmp-au-com-questionnaire-error-message').html( $('#cmp-au-com-questionnaire-input-error-message').val() );
                    return;
                }
                $('.cmp-au-com-questionnaire-error-message').html(''); //クリア

                if (isSendFirst) {
                    isSendFirst = false;
                }

                var officialfeedback = $('.cmp-au-com-questionnaire-officialfeedback');
                var officialfeedbackEval = $('.cmp-au-com-evaluate-officialfeedback');
                var thanksmessage = $('.cmp-au-com-questionnaire-thanks-message');
                var thanksmessageEval = $('.cmp-au-com-evaluate-thanks-message');
                $.ajax({
                    type : 'POST',
                    url : '/bin/wcm/au-com/officialfeedback.do',
                    data : $('#cmp-au-com-questionnaire-officialfeedback-form').serialize(),
                    success : function(data) {
                        officialfeedback.hide();
                        thanksmessage.show();
                        officialfeedbackEval.hide();
                        thanksmessageEval.show();
                    },
                    error : function(data) {
                        officialfeedback.hide();
                        thanksmessage.show();
                        officialfeedbackEval.hide();
                        thanksmessageEval.show();
                    }
                });
            });

            var allcookies = document.cookie;
            var cookieName = 'CakeCookie[myUsefuled][' + questionId + ']';
            var position = allcookies.indexOf( cookieName );
            if(position != -1) {
                $(".qa-evaluate").hide();
            }

            var cnt, queryKbanIds = [], callbacks = [];
            // このK番の役に立った数設定
            if ((cnt = $('head meta[name=questionnaire_yes]').attr('content'))
                    && window.CommonUtil.isNumeric(cnt) && '0' !== cnt) { // metaタグに役に立った数がセットされていればそれを利用
                $('span.count-result').text(cnt);
            } else if (questionId) {  // metaタグに役立った数がセットされていなければAPIを呼び出し
                queryKbanIds.push(questionId);
                callbacks.push(function(kbanCountMap) {
                    if (kbanCountMap[questionId]) {
                        $("span.count-result").text(kbanCountMap[questionId]);
                    }
                });
            }

            if (queryKbanIds.length) {
                $.ajax({url: '/bin/wcm/au-com/questionnaire_list.json',
                    type: 'GET',
                    dataType: 'json',
                    data: {questionIds: queryKbanIds.join(',')},
                    cache: false}
                ).done(function(data) {
                    var kbanCountMap = {};
                    if (data && data.qa_information && data.qa_information.length) {
                        data.qa_information.forEach(function(i) {
                            kbanCountMap[i.questionId] = i.questionnaire_yes;
                        });
                        callbacks.forEach(function(f) {
                            f(kbanCountMap);
                        });
                    }
                }).fail(function(data, textStatus, errorThrown) {
                    console.log('questionnaire_list.json request failed. ' + textStatus + ' ' + errorThrown);
                });
            }
        }
    });
})(jQuery);
(function($) {
    $(function(){
        "use strict";
        $(function() {
            //前のページに戻る の リンク先URL生成
            $("#before-page-link").attr("href", document.referrer.replace(/\?.*$/, "") );

            var isFirst = true;
            //送信ボタン押下
            $('#officialfeedback-submit').on('click', function() {
                if (!isFirst) {
                    return false;
                }

                //入力メッセージチェック
                if ($('.officialfeedback_comment')[0].value == "") {
                    $('.error-message').html( $('#input-error-message').val() );
                    return;
                }
                $('.error-message').html(''); //クリア

                if (isFirst) {
                    isFirst = false;
                }

                $.ajax({
                    type : 'POST',
                    url : '/bin/wcm/au-com/officialfeedback.do',
                    data : $('#officialfeedback-form').serialize(),
                    success : function(data) {
                        $('.qa-opinions-bdy').fadeOut('slow');
                    },
                    error : function(data) {
                        $('.qa-opinions-bdy').fadeOut('slow');
                    }
                });
            });

        });
    });
})(jQuery);

(function($) {
    $(function() {
        "use strict";
        if ($(".qaList-moreBtn-gray1").text() != "") {
            $(".qaList-inc1 li").slice(6).hide();
            $(".qaList-moreBtn-gray1").on('click', function() {
                if(!$(this).hasClass('isOpen')) {
                    $(".qaList-inc1 li").show('blind');
                    $(this).addClass('isOpen');
                }else{
                    var scrollDistance = 90;
                    let qaLayoutOffsetTop = $('.qaLayout-resoulCount').length ? $('.qaLayout-resoulCount').offset().top : 0;
                    $("html,body").animate({scrollTop: qaLayoutOffsetTop - scrollDistance});
                    $(".qaList-inc1 li").slice(6).hide();
                    $(this).removeClass('isOpen');
                }
            });
        }

        addHrefToFaqli("ol li.clspageNum");
        addClickToFaqPage('.qaLayout-resoulCount ol li.clspageNum a', 'clspageNum');
        addClickToFaqPage(".qaLayout-resoulCount a.pagenation-prev", 'prev');
        addClickToFaqPage(".qaLayout-resoulCount a.pagenation-next", 'next');

        $('select[name=sortby]').on('change', function() {
            if ($('#qaSrch-cont').length && $('[name=hidKeyWord]').val()) {
                $('#qaSrch-cont input.form-searchKw').val($('[name=hidKeyWord]').val());
                $('#qaSrch-cont input[name=pageNum]').val('1');
                $('#qaSrch-cont input[name=sortby]').val($(this).val());
                $('#qaSrch-cont form').trigger('submit');
            } else {
                var url = $('input[name=hidPagePath]').val();
                var sortby = $(this).val();
                url = url + "?pageNum=1&sortby=" + sortby;
                window.location.href = url;
            }
        });

    function addHrefToFaqli (pageNumObj) {
        var hidPageNum = $('input[name=hidPageNum]').val();
        var totalPage = $('input[name=hidTotalPage]').val();

        $(pageNumObj).each(function( index ) {
            var liVal = $(this).text();
            if (index == 0) {
                $(this).addClass("firstChild");
            }
            if (liVal == hidPageNum) {
                $(this).addClass("active");
            } else {
                $(this).text('');
                if (index == 0) {
                    if (hidPageNum > 2 && totalPage > 3) {
                        $(this).before('<li class="ellipsis">...</li>');
                    }
                }
                $(this).append($("<a>", { href: '#' }).text(liVal));
            }
            if (index == 2 && (Number(hidPageNum)+1) < totalPage && totalPage > 3) {
                $(this).after('<li class="ellipsis">...</li>');
            }
        });
    }

    function addClickToFaqPage(selector, eventid) {
        $(selector).on('click', function() {
            var pageNum;
            var totalPage = $('input[name=hidTotalPage]').val();
            if (eventid == "clspageNum") {
                pageNum = $(this).text();
            } else if (eventid == "prev") {
                pageNum = $('input[name=hidPageNum]').val();
                if(Number(pageNum) > 1) {
                    pageNum--;
                }
            } else if (eventid == "next") {
                pageNum = $('input[name=hidPageNum]').val();
                if(Number(pageNum) < Number(totalPage)) {
                    pageNum++;
                }
            }

            if ($('#qaSrch-cont').length && $('[name=hidKeyWord]').val()) {
                $('#qaSrch-cont input.form-searchKw').val($('[name=hidKeyWord]').val());
                $('#qaSrch-cont input[name=pageNum]').val(pageNum);
                $('#qaSrch-cont input[name=sortby]').val($('select[name=sortby]').val());
                $('#qaSrch-cont form').trigger('submit');
            } else {
                var url = $('input[name=hidPagePath]').val();
                var sortby = $('select[name=sortby]').val();
                url = url + "?pageNum=" + pageNum + "&sortby=" + sortby;
                window.location.href = url;
            }
        });
    }

        var listingKbanIds = {};
        $("div.qaLayout-resoulCount > ul.qaList > li > a").each(function(){
            var mat, href = $(this).attr('href');
            if (href) {
                if (href.match(/\/support\/faq\/detail/)) {
                    mat = href.split('/support/faq/detail/')[1].split('?')[0].split('/')[1].split('.')[0]
                } else {
                    mat = href.split('/support/faq/view.')[1].split('?')[0].replace('/','').split('.')[0]
                }
                listingKbanIds[mat] = 0;
            }
        });
        if (! $.isEmptyObject(listingKbanIds)) {
            $.ajax({url: '/bin/wcm/au-com/questionnaire_list.json',
                type: 'GET',
                dataType: 'json',
                data: {questionIds: Object.keys(listingKbanIds).join(',')},
                cache: false}
            ).done(function(data) {
                var kbanCountMap = {};
                if (data && data.qa_information && data.qa_information.length) {
                    data.qa_information.forEach(function(i) {
                        kbanCountMap[i.questionId] = i.questionnaire_yes;
                    });
                    $("div.qaLayout-resoulCount > ul.qaList > li > a").each(function() {
                        var mat, href = $(this).attr('href');
                        if (href) {
                            if (href.match(/\/support\/faq\/detail/)) {
                                mat = href.split('/support/faq/detail/')[1].split('?')[0].split('/')[1].split('.')[0]
                            } else {
                                mat = href.split('/support/faq/view.')[1].split('?')[0].replace('/','').split('.')[0]
                            }
                            var kbanId = mat,
                                target = $("span.iconCount", $(this).parent());
                            if (target.length && kbanCountMap[kbanId]) {
                                target.text(kbanCountMap[kbanId]);
                            }
                        }
                    });
                }
            }).fail(function(data, textStatus, errorThrown) {
                console.log('questionnaire_list.json request failed. ' + textStatus + ' ' + errorThrown);
            });
        }
    });
})(jQuery);

(function($) {
  function QaEvaluate() {
    this.$float = $('.cmp-au-com-evaluate');
    this.$close = this.$float.find('.qa-evaluate-close');
    this.$btns = this.$float.find('a.cmp-au-com-helpful, a.cmp-au-com-unhelpful');
    this.$pagetop = $('.footerElem .btn-pageTop');
    this.$footer = $('.footerSiteMap');
    this.$btmEv = $('.qa-evaluate.cardBox');
    this.$faqQues = $('.faq-questionnaire');
    this.isBtnon = false;
    this.hideFlag = false;
    if ($('.cmp-au-com-evaluate-hide').length != 0) {
        this.hideFlag = true;
    }

    this.scrollTop = $(window).innerHeight() + $(window).scrollTop();
    this.btmEvTop = '';

    this.CookieName = 'QaEvaluateHidden';
    this.bind();
    var _this = this;

    var isSendFirst = true;
    //送信ボタン押下
    $('a#cmp-au-com-evaluate-officialfeedback-submit').on("click", function() {
        if (!isSendFirst) {
            return false;
        }

        //入力メッセージチェック
        if ($('.cmp-au-com-evaluate-officialfeedback_comment')[0].value == "") {
            $('.cmp-au-com-evaluate-error-message').html( $('#cmp-au-com-evaluate-input-error-message').val() );
            return;
        }
        $('.cmp-au-com-evaluate-error-message').html(''); //クリア

        if (isSendFirst) {
            isSendFirst = false;
        }

        var officialfeedback = $('.cmp-au-com-questionnaire-officialfeedback');
        var officialfeedbackEval = $('.cmp-au-com-evaluate-officialfeedback');
        var thanksmessage = $('.cmp-au-com-questionnaire-thanks-message');
        var thanksmessageEval = $('.cmp-au-com-evaluate-thanks-message');
        $.ajax({
            type : 'POST',
            url : '/bin/wcm/au-com/officialfeedback.do',
            data : $('#cmp-au-com-evaluate-officialfeedback-form').serialize(),
            success : function(data) {
                officialfeedback.hide();
                thanksmessage.show();
                officialfeedbackEval.hide();
                thanksmessageEval.show();
            },
            error : function(data) {
                officialfeedback.hide();
                thanksmessage.show();
                officialfeedbackEval.hide();
                thanksmessageEval.show();
            }
        });
    });
  };


  // bind event handlers
  QaEvaluate.prototype.bind = function(){
    var _this = this;

    this.$close.on('click', function(){ _this.hide(); _this.setCookie(); _this.isBtnon = false;});
    this.$btns.on('click', function(){
        if (_this.$faqQues.length == 0) {
            _this.hide();
        }
        else {
            _this.isBtnon = true;
        }
    });

    $(window).on('load', function(){
      // フローティングボタンが非表示の場合は何もしない。
      if (_this.hideFlag) { return; }
      const offset =  _this.$btmEv.length ? _this.$btmEv.offset() : 0;
      if(offset){
        _this.btmEvTop = offset.top;
      }
      _this.show();
    });

    $(window).on('scroll', function() {
      // フローティングボタンが非表示の場合は何もしない。
      if (_this.hideFlag) { return; }
      this.scrollTop = $(this).innerHeight() + $(this).scrollTop();

      if(this.scrollTop < _this.btmEvTop){
        _this.show();
      } else {
        _this.hide();
      }
    });
  };


  // hide banner and set cookie
  QaEvaluate.prototype.hide = function(){
    this.$float.fadeOut(200);
    this.$pagetop.css('margin-bottom', 0);
    this.$footer.css('padding-bottom', 30);

    return false;
  };


  // get cookie for banner
  QaEvaluate.prototype.getCookie = function() {
    var cookies = document.cookie.split(';'), cookie = null;

    for (var i = 0, len = cookies.length; i < len; i++) {
      if (cookies[i].indexOf(this.CookieName) >= 0) {
        cookie = cookies[i];
        break;
      }
    }
    return cookie;
  };

  // create a cookie for banner
  QaEvaluate.prototype.setCookie = function() {
    var d = new Date(), t = d.getTime();
    t += 24 * 60 * 60 * 1000;
    d.setTime(t);
    document.cookie = this.CookieName + '=1;path=/;expires=' + d.toUTCString();
  };


  // display banner of there is no cookie
  QaEvaluate.prototype.show = function(){
    // get cookie
    var cookie = this.getCookie();

    var b = $('#questionId').val();
    var k = 'CakeCookie[myUsefuled][' + b + ']';
    var CakeCookie = document.cookie.indexOf(k);

    if((!cookie && CakeCookie === -1) || this.isBtnon) {

      if(this.scrollTop < this.btmEvTop) {
        this.$float.fadeIn(200);
        this.$pagetop.css('margin-bottom', 65);
        this.$footer.css('padding-bottom', 80);
      }
    }
  };

  if ($('.qa-evaluate-element').length) {
    var q = new QaEvaluate();
  }
})(jQuery);
(function($) {
    $(function(){

    // event

        $(document)
            .on('click', '.qa-movie-swtchr .swtchr', function(){
                var $tab = $(this),
                    $box = $tab.parents('.qa-movie-bdy'),
                    $movie = $('.qa-movie-disp iframe', $box),
                    strMovieID = $tab.attr('data-movie-id'),
                    strActiveClass = 'swtchr-selected tapped',
                    strMovieURL = 'https://www.youtube.com/embed/',
                    strMovieParam = '?wmode=transparent'
                ;

                strMovieURL += strMovieID + strMovieParam;
                $movie.attr('src', strMovieURL);

                $tab.addClass(strActiveClass)
                    .closest('.slick-slide').siblings().find('.swtchr').removeClass(strActiveClass)
                ;
            })
        ;

    // show and hide of qa lists
        $(".qaList-inc li").slice(6).hide();
        $(".qaList-moreBtn-gray").on('click', function(){
            if(!$(this).hasClass('isOpen')) {
                $(".qaList-inc li").show('blind');
                $(this).addClass('isOpen');
            }else{
                var scrollDistance = 90;
                let qaInfoBoxTop = $('.qa-infoBox').length ? $('.qa-infoBox').offset().top : 0;
                $("html,body").animate({scrollTop:qaInfoBoxTop - scrollDistance});
                $(".qaList-inc li").slice(6).hide();
                $(this).removeClass('isOpen');
            }
        });

        // end of jquery
    });
})(jQuery);

(function($) {
    'use strict';
    $(function() {
        $('.displayWaitTime').each(function() {

            var $targetElm = $(this);

            // コンポーネントのリソースパスを取得
            var resourcePath = $targetElm.children('div').attr('data-resourcepath');
            // 更新間隔を取得
            var updateIntervalTimeMin = parseInt($targetElm.children('div').attr('data-updateinterval'));
            // 更新間隔をミリ秒に変換
            var updateIntervalTimeSec = 60000;
            if (updateIntervalTimeMin){
                updateIntervalTimeSec = updateIntervalTimeMin * 60000;
            }

            //ブラウザの表示域に表示されたときに実行する処理
            var id;
            $targetElm.on('inview', function() {

                if ((CommonUtil.isPublish() || CommonUtil.isAuthorPreview) && resourcePath) {
                    // 表示されているか判定
                    if ($targetElm.isVisible()) {
                        // お待たせ時間を設定
                        setWaitTime($targetElm, resourcePath);
                        // 一定間隔でお待たせ時間を再設定
                        id = setInterval(function(){
                            setWaitTime($targetElm, resourcePath);
                        }
                        , updateIntervalTimeSec);
                    } else {
                        if (id) {
                            clearInterval(id);
                        }
                    }
                }

            });

        });
    });

    function setWaitTime($targetElm, resourcePath) {
        $.ajax({
            type: "GET",
            url: resourcePath,
            cache: false,
        }).done(function(html) {
            $targetElm.html(html);
        });
    }

})(jQuery);
(function($) {
    "use strict";

    $(function() {
        if ($('.display-terms').length) {
            if (CommonUtil.isPublish()) {
                $('.display-terms').each(function() {
                    var displayTermsText = $(this).find('.display-terms-text');
                    if(!displayTermsText.length){
                       var kiyakuCode = $(this).find('.terms-code').val();
                       window.agreementsAPI.updateIndividualTermsList(kiyakuCode);
                    }
                });
            }
        }
    });

})(jQuery);

(function($) {
    'use strict';

    var NS = "cmp";
    var IS = "displaycontainerbytarget";

    var selectors = {
        self: "[data-" +  NS + '-is="' + IS + '"]',
        show: {
            tab: "cmp-displaycontainerbytarget__tab--show",
            conditions: "cmp-displaycontainerbytarget__conditions--show",
            tabpanel: "cmp-displaycontainerbytarget__tabpanel--show"
        }
    };

    var conditionType = {
        userAgent: "userAgent",
        referrer: "referrer",
        currentUrl: "currentUrl",
        userType: "userType",
        userInfo: "userInfo",
        formData: "formData",
        auShopData: "auShopData"
    };

    /**
     * ターゲット別表示コンテナ
     *
     * @class Display Container By Target
     * @classdesc 設定ダイアログで指定した表示条件に一致した場合に表示するコンテナ
     * @param {DisplayContainerByTargetConfig} ターゲット別表示コンテナのコンフィグ
     */
    function DisplayContainerByTarget(config) {
        var that = this;

        if (config && config.element) {
            init(config);
        }

        /**
         * 初期化処理
         *
         * @private
         * @param {DisplayContainerByTargetConfig} ターゲット別表示コンテナのコンフィグ
         */
        function init(config) {
            // prevents multiple initialization
            config.element.removeAttribute("data-" + NS + "-is");

            cacheElements(config.element);

            if (CommonUtil.isAuthorEditor()) {
                showContents(0);
            } else {
                if (isNeedUserInfo()) {
                    window.auDataLayer.addEventListener(window.auDataLayer.userInfo.always, function(){
                        showContents();
                    });
                } else if (isNeedFormData()) {
                    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){
                        $(document).on(window.formDataLayerAPI.CHANGE_EVENT_NAME, function (){
                            showContents();
                            $(document).trigger(window.formDataLayerAPI.FORM_SHOW_HIDE_EVENT);
                        });
                        showContents();
                    });
                } else if (isNeedAuShopData()) {
                    window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.always, function(){
                        showContents();
                    });
                } else {
                    showContents();
                }
            }

            if (window.Granite && window.Granite.author && window.Granite.author.MessageChannel) {
                /*
                 * Editor message handling:
                 * - subscribe to "cmp.panelcontainer" message requests sent by the editor frame
                 * - check that the message data panel container type is correct and that the id (path) matches this specific Tabs component
                 * - if so, route the "navigate" operation to enact a navigation of the Tabs based on index data
                 */
                new window.Granite.author.MessageChannel("cqauthor", window).subscribeRequestMessage("cmp.panelcontainer", function(message) {
                    if (message.data && message.data.type === "cmp-displaycontainerbytarget" && message.data.id === that._elements.self.dataset["cmpPanelcontainerId"]) {
                        if (message.data.operation === "navigate") {
                            navigate(message.data.index);
                        }
                    }
                });
            }
        }


        /**
        *
        * ユーザー情報要否判定
        *
        * @returns {Boolean} ユーザー情報要否判定結果（必要な場合は true を返却）
        */
        function isNeedUserInfo() {
            var displayConditionType = $(that._elements.self).data("condition-type");
            if (displayConditionType == conditionType.userType ||
                displayConditionType == conditionType.userInfo) {
                return true;
            }
            return false;
        }


        /**
        *
        * フォームデータ要否判定
        *
        * @returns {Boolean} フォームデータ要否判定結果（必要な場合は true を返却）
        */
        function isNeedFormData() {
            var displayConditionType = $(that._elements.self).data("condition-type");
            if (displayConditionType == conditionType.formData) {
                return true;
            }
            return false;
        }

        /**
         * auショップ情報要否判定
         * 
         * @returns {Boolean} auショップ情報要否判定結果（必要な場合は true を返却）
         */
        function isNeedAuShopData() {
            const displayConditionType = $(that._elements.self).data("condition-type");
            return displayConditionType == conditionType.auShopData;
        }

        /**
        *
        * 数値比較要否判定
        *
        * @returns {Boolean} 数値比較要否判定結果（必要な場合は true を返却）
        */
        function isNeedNumericalComparison() {
            var displayConditionType = $(that._elements.self).data("condition-type");
            return (displayConditionType == conditionType.userInfo 
                || displayConditionType == conditionType.formData
                || displayConditionType == conditionType.auShopData);
        }

        /**
        *
        * コンテンツ表示処理
        *
        * @param {String} showIndex 表示するコンテンツのインデックス（固定値の場合のみ指定）
        */
        function showContents(showIndex) {

            if (showIndex !== undefined) {
                that._show = showIndex;
            }else{
                that._show = getShowIndex();
            }

            if (that._elements.tabpanel) {
                refreshShowContents();
            }

            $(document).trigger($(that._elements.self).attr('id') + ':showHide');
        }

        /**
         *
         * 表示するアイテムのインデックスを取得する。
         * 表示対象のアイテムが存在しない場合は、-1を返却する。
         *
         * @returns {Number} 表示するアイテムのインデックス（存在しない場合は -1 を返却）
         */
        function getShowIndex() {
            var showIndex = -1;
            var displayConditionType = $(that._elements.self).data("condition-type");
            var displayConditionsList = $(that._elements.self).data("display-conditions");

            if (displayConditionType && displayConditionsList) {

                // 一致するアイテムのインデックスを取得
                showIndex = getDisplayItemIndex(displayConditionType, displayConditionsList);

            }

            return showIndex;
        }

        /**
        *
        * 条件タイプに応じた比較値を取得する.
        *
        * @param {String} displayConditionType 表示条件タイプ
        * @returns {String} 対象の比較値
        */
        function getComparisonValue(displayConditionType, condition) {

            var comparisonValue = "";

            // 条件タイプに応じて比較値を取得
            switch (displayConditionType) {

                // 「User Agent」の場合
                case conditionType.userAgent:
                    comparisonValue = navigator.userAgent;
                    break;
                // 「Referrer」の場合
                case conditionType.referrer:
                    comparisonValue = document.referrer;
                    break;
                // 「Current Url」の場合
                case conditionType.currentUrl:
                    comparisonValue = location.href;
                    break;
                // 「User Type」の場合
                case conditionType.userType:
                    comparisonValue = getUserType();
                    break;
                // 「User Info」の場合
                case conditionType.userInfo:
                    comparisonValue = window.auDataLayer.get(condition.comparisonItemPath);
                    break;
                // 「Form Data」の場合
                case conditionType.formData:
                    comparisonValue = window.formDataLayerAPI.get(condition.comparisonItemPath);
                    break;
                // 「au Shop Data」の場合
                case conditionType.auShopData:
                    comparisonValue = window.auDataLayer.get(condition.comparisonItemPath);
                    break;
            }

            // 取得したアイテムがオブジェクトの場合、JSON化する
            if (comparisonValue instanceof Object){
                comparisonValue = JSON.stringify(comparisonValue);
            }

            return comparisonValue;
        }

        /**
        *
        * ユーザータイプ取得.
        *
        * @returns {String} ユーザータイプ
        */
        function getUserType() {

            var USERTYPE_NOT_LOGIN = 'notLogin';
            var USERTYPE_AU_USER_FOR_INDIVIDUAL = 'auUserForIndividual';
            var USERTYPE_OPEN_USER_FOR_INDIVIDUAL = 'openUserForIndividual';
            var USERTYPE_AU_USER_FOR_BUSINESS = 'auUserForBusiness';
            var USERTYPE_OPEN_USER_FOR_BUSINESS = 'openUserForBusiness';
            var USERTYPE_OPEN_USER_FOR_BUSINESS = 'openUserForBusiness';
            var AUTHENTICATION_ERROR = 'authenticationError';

            var userType = "";

            if (window.auDataLayer.userInfo.isError()) {
                userType = AUTHENTICATION_ERROR;
            } else {
                // ログイン判定
                if (window.auDataLayer.userInfo.isLive()){
                    // 個人ユーザー/法人ユーザー判定
                    if (window.auDataLayer.userInfo.isBusinessUser()) {

                        // au ユーザー/オープンユーザー判定
                        if (window.auDataLayer.userInfo.isAuUser()){
                            // au ユーザー（法人）
                            userType = USERTYPE_AU_USER_FOR_BUSINESS;
                        }else{
                            // オープンユーザー（法人）
                            userType = USERTYPE_OPEN_USER_FOR_BUSINESS;
                        }

                    }else{

                        // au ユーザー/オープンユーザー判定
                        if (window.auDataLayer.userInfo.isAuUser()){
                            // au ユーザー（個人）
                            userType = USERTYPE_AU_USER_FOR_INDIVIDUAL;
                        }else{
                            // オープンユーザー（個人）
                            userType = USERTYPE_OPEN_USER_FOR_INDIVIDUAL;
                        }

                    }

                } else {
                    // 未ログイン
                    userType = USERTYPE_NOT_LOGIN;
                }
            }

            return userType;
        }

        /**
         *
         * 表示アイテムのインデックスを取得する.
         *
         * @param {Array} displayConditionsList 表示条件リスト
         * @param {String} comparisonValue 比較値
         * @returns {Number} 表示アイテムのインデックス
         */
        function getDisplayItemIndex(displayConditionType, displayConditionsList) {
            var displayItemIndex = -1;

            // 条件に一致するまで判定
            var isMatchedBefore = true;
            $(displayConditionsList).each(function() {
                var condition = this;
                var comparisonValue = getComparisonValue(displayConditionType, condition)
                var displayCondition = condition.displayCondition || '';
                var displayItem = condition.displayItem;
                var isMatched = false;
                var combineConditions = condition.combineConditions == 'on';

                if (isNeedNumericalComparison()) {
                    // 数値比較
                    if ( comparisonValue === undefined) {
                        isMatched = condition.acquisitionError == 'on';
                    } else {
                        let displayConditionStr = String(displayCondition);
                        let comparisonValueStr = String(comparisonValue);
                        var displayConditionInt = parseInt(displayCondition, 10);
                        var comparisonValueInt = parseInt(comparisonValue, 10);
                        var comparisonMethod = condition.comparisonMethod;
                        switch (comparisonMethod) {
                            case '==':
                                isMatched = comparisonValueStr == displayConditionStr;
                                break;
                            case '!=':
                                isMatched = comparisonValueStr != displayConditionStr;
                                break;
                            case '>=':
                                isMatched = comparisonValueInt >= displayConditionInt;
                                break;
                            case '<=':
                                isMatched = comparisonValueInt <= displayConditionInt;
                                break;
                            default :
                                isMatched = displayCondition && comparisonValueStr.match(displayConditionStr);
                                break;
                        }
                    }

                } else {
                    // 文字列比較（正規表現）
                   if (displayCondition && comparisonValue.match(displayCondition)) {
                        isMatched = true;
                    }
                }

                if (combineConditions) {
                    isMatchedBefore = isMatchedBefore && isMatched;
                } else {
                    if (isMatchedBefore && isMatched) {
                        displayItemIndex = getItemIndex(displayItem);
                        return false;
                    }
                    isMatchedBefore = true;
                }

            });

            return displayItemIndex;
        }

        /**
        *
        * 指定されたアイテムのインデックスを取得する.
        *
        * @param {String} targetItemName 対象のアイテム名
        * @returns {Number} 対象のアイテムのインデックス
        */
        function getItemIndex(targetItemName) {
            var itemIndex = -1;
            var tabs = that._elements["tabpanel"];
            var itemName = undefined;

            if (Array.isArray(tabs)) {

                for (var index in tabs) {
                    itemName = $(tabs[index]).data("item-name");
                    if ( itemName == targetItemName ) {
                        itemIndex = index;
                        break;
                    }
                }

            } else {

                itemName = $(tabs).data("item-name");
                if ( itemName == targetItemName ) {
                    itemIndex = 0;
                }

            }

            return itemIndex;
        }

       /**
         * Caches the DisplayContainerByTarget elements as defined via the {@code data-tabs-hook="ELEMENT_NAME"} markup API
         *
         * @private
         * @param {HTMLElement} wrapper The DisplayContainerByTarget wrapper element
         */
        function cacheElements(wrapper) {
            that._elements = {};
            that._elements.self = wrapper;
            var hooks = that._elements.self.querySelectorAll("[data-" + NS + "-hook-" + IS + "]");

            for (var i = 0; i < hooks.length; i++) {
                var hook = hooks[i];
                if (hook.closest("." + NS + "-" + IS) === that._elements.self) { // only process own tab elements
                    var capitalized = IS;
                    capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
                    var key = hook.dataset[NS + "Hook" + capitalized];
                    if (that._elements[key]) {
                        if (!Array.isArray(that._elements[key])) {
                            var tmp = that._elements[key];
                            that._elements[key] = [tmp];
                        }
                        that._elements[key].push(hook);
                    } else {
                        that._elements[key] = hook;
                    }
                }
            }
        }

        /**
         * ターゲット別表示コンテナの表示／非表示を更新する
         *
         * @private
         */
        function refreshShowContents() {
            var tabpanels = that._elements["tabpanel"];
            var tabs = that._elements["tab"];
            var conditions = that._elements["conditions"];
            var itemName = undefined;

            if (tabpanels) {

                if (Array.isArray(tabpanels)) {

                    // 表示アイテム数分、判定を行う
                    for (var i = 0; i < tabpanels.length; i++) {

                        itemName = $(tabpanels[i]).data("item-name");

                        if (i === parseInt(that._show)) {
                            // 表示設定
                            tabpanels[i].classList.add(selectors.show.tabpanel);
                            tabpanels[i].removeAttribute("aria-hidden");
                            if (CommonUtil.isAuthorEditor()) {
                                if (tabs) {
                                    tabs[i].classList.add(selectors.show.tab);
                                    tabs[i].setAttribute("aria-selected", true);
                                    tabs[i].setAttribute("tabindex", "0");
                                    switchDisplayConditionClass(conditions, itemName, true);
                                }
                            }
                        } else {
                            // 非表示設定
                            tabpanels[i].classList.remove(selectors.show.tabpanel);
                            tabpanels[i].setAttribute("aria-hidden", true);
                            if (CommonUtil.isAuthorEditor()) {
                                if (tabs) {
                                    tabs[i].classList.remove(selectors.show.tab);
                                    tabs[i].setAttribute("aria-selected", false);
                                    tabs[i].setAttribute("tabindex", "-1");
                                    switchDisplayConditionClass(conditions, itemName, false);
                                }
                            }
                        }

                    }

                } else {

                    itemName = $(tabpanels).data("item-name");

                    if (parseInt(that._show) >= 0) {

                        // 表示設定
                        tabpanels.classList.add(selectors.show.tabpanel);
                        tabpanels.removeAttribute("aria-hidden");
                        if (CommonUtil.isAuthorEditor()) {
                            if (tabs) {
                                tabs.classList.add(selectors.show.tab);
                                tabs.setAttribute("aria-selected", true);
                                tabs.setAttribute("tabindex", "0");
                                switchDisplayConditionClass(conditions, itemName, true);
                            }
                        }

                    } else {
                        // 非表示設定
                        tabpanels.classList.remove(selectors.show.tabpanel);
                        tabpanels.setAttribute("aria-hidden", true);
                        if (CommonUtil.isAuthorEditor()) {
                            if (tabs) {
                                tabs.classList.remove(selectors.show.tab);
                                tabs.setAttribute("aria-selected", false);
                                tabs.setAttribute("tabindex", "-1");
                                switchDisplayConditionClass(conditions, itemName, false);
                            }
                        }
                    }

                }

            }
        }

        /**
         * 表示条件の表示／非表示を更新する
         *
         * @private
         * @param {Array} conditions 表示条件リスト
         * @param {String} itemName 対象のアイテム名
         * @param {Boolean} addClass 追加／削除
         * @returns {Number} 対象のアイテムのインデックス
         */
        function switchDisplayConditionClass(conditions, itemName, addClass) {

            if (conditions) {

                if (Array.isArray(conditions)) {

                    var targetConditions = [];
                    for (var i = 0; i < conditions.length; i++) {
                        if ($(conditions[i]).data("combine-conditions")) {
                            targetConditions.push(i);
                        } else {
                            if ($(conditions[i]).data("display-item") == itemName) {
                                targetConditions.push(i);
                                $(targetConditions).each(function(){
                                    if (addClass) {
                                        conditions[this].classList.add(selectors.show.conditions);
                                    } else {
                                        conditions[this].classList.remove(selectors.show.conditions)
                                    }
                                })
                            }
                            targetConditions = [];
                        }
                    }

                } else {

                    if ($(conditions).data("display-item") == itemName) {
                        if (addClass) {
                            conditions.classList.add(selectors.show.conditions)
                        }else{
                            conditions.classList.remove(selectors.show.conditions)
                        }
                    }

                }

            }

        }

        /**
         * Navigates to the tab at the provided index
         *
         * @private
         * @param {Number} index The index of the tab to navigate to
         */
        function navigate(index) {
            that._show = index;
            refreshShowContents();
        }

    }

    /**
     * Reads options data from the DisplayContainerByTarget wrapper element, defined via {@code data-cmp-*} data attributes
     *
     * @private
     * @param {HTMLElement} element The DisplayContainerByTarget element to read options data from
     * @returns {Object} The options read from the component data attributes
     */
    function readData(element) {
        var data = element.dataset;
        var options = [];
        var capitalized = IS;
        capitalized = capitalized.charAt(0).toUpperCase() + capitalized.slice(1);
        var reserved = ["is", "hook" + capitalized];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                var value = data[key];

                if (key.indexOf(NS) === 0) {
                    key = key.slice(NS.length);
                    key = key.charAt(0).toLowerCase() + key.substring(1);

                    if (reserved.indexOf(key) === -1) {
                        options[key] = value;
                    }
                }
            }
        }

        return options;
    }

    /**
     *
     * ready 処理
     *
     */
    $(function() {

        var displayContainerByTargetElems = $(selectors.self);
        displayContainerByTargetElems.each( function() {
            new DisplayContainerByTarget({ element: this, options: readData(this) });
        });

        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new DisplayContainerByTarget({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body = document.querySelector("body");
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new DisplayContainerByTarget({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });

    });

})(jQuery);

(function($) {
    'use strict';

    $(function() {
        if(CommonUtil.isPublish() && $(".change-agreement-status-button").length > 0) {
            window.auDataLayer.addEventListener(window.auDataLayer.userInfo.ready, function(){
                if(window.auDataLayer.userInfo.isLive()) {
                    function changeAgreementStatus(event,agreementStatus) {
                        var kiyakuCode = event.attr("data-terms-code");
                        var kiyakuNumCode = event.attr("data-kiyaku-num-code");
                        if(kiyakuCode && kiyakuNumCode) {

                            $(document).on(window.agreementsAPI.POST_ALL_EVENT_NAME, function (){
                                window.agreementsAPI.updateIndividualTermsList(kiyakuCode);
                            });

                            window.agreementsAPI.ppmPostModAgreements([{kiyakuCode: kiyakuCode,kiyakuNumCode: kiyakuNumCode,agreementStatus: agreementStatus}]);
                        }
                    }

                    $(".change-agreement-status-button .agree-btn").on( "click", function() {
                        changeAgreementStatus($(this), window.agreementsAPI.AGREESTATUS);
                    });

                    $(".change-agreement-status-button .disagree-btn").on( "click", function() {
                        changeAgreementStatus($(this), window.agreementsAPI.DISAGREESTATUS);
                    });
                }
            });
        }
    });
})(jQuery);

/* MobileServiceFromGenreFilteringCls.js */
(function ($) {
    "use strict";

    if (window.MobileServiceFromGenreFilteringCls) {
        return; // 2重初期化防止
    }

    /**
     * モバイルサービス（ジャンル・目的から探す）絞り込みクラス.
     */
    window.MobileServiceFromGenreFilteringCls = (function () {

        /**
         * コンストラクタ.
         */
        var MobileServiceFromGenreFilteringCls = function () {
            if (!(this instanceof MobileServiceFromGenreFilteringCls)) {
                return new MobileServiceFromGenreFilteringCls();
            }
        };

        // 定数

        // 変数
        var serviceList;
        var initialDisplayCount = 10;
        var totalDisplayCount = 0;

        // メソッド定義
        var p = MobileServiceFromGenreFilteringCls.prototype;

        /**
         * 初期化.
         */
        p.init = function () {
            // 編集時はスキップ
            if (AU_COMMON.getCookie("wcmmode") == "edit"
                && AU_COMMON.getParameter(document.location.href, 'wcmmode') != 'disabled') {
                return;
            }

            console.log('MobileServiceFromGenreFilteringCls.init start')

            // 各種情報取得
            var mobileServiceFromGenre = getMobileServiceFromGenre();
            var resultArea = getResultArea(mobileServiceFromGenre);
            var modalDialog = getModalDialog(mobileServiceFromGenre);
            // 初期表示件数の取得
            initialDisplayCount = parseInt($('input[name=count]', resultArea).val());
            console.log('initialDisplayCount:[' + initialDisplayCount + ']');
            // 対象機種選択イベント追加
            $(document).on('change', 'select[name=targetDevice]',changeSelectionTargetDevice);
            // ジャンル・目的の大分類のチェックイベント追加
            $(document).on('click', 'input:checkbox[name=genre_l]', clickSelectionGenreL);
            // ジャンル・目的の小分類のチェックイベント追加
            $(document).on('click', 'input:checkbox[name=genre_m]', clickSelectionGenreM);
            // ジャンル活性化制御
            disableFileringGenre();
            // 絞り込むボタンの活性化制御
            disableFileringButton();
            // 検索結果見出し非表示
            visibleResultHeading(false);
            // 検索結果0件メッセージ非表示
            visibleNothingResulMessage(false);
            // もっとみるボタン非表示
            visibleResultListMoreButton(false);

            console.log('MobileServiceFromGenreFilteringCls.init end')
        };

        /**
         * クリアボタンクリックイベント.
         */
        p.clickModalClearButton = function (e) {
            // モーダルダイアログをリセット
            resetModalDialog();
            // 絞り込むボタンの活性化制御
            disableFileringButton();
        };

        /**
         * 絞り込むボタンクリックイベント.
         */
        p.clickModalFileringButton = function (e) {
            // モバイルサービスリスト取得
            getMobileServiceList();
        };

        /**
         * もっと見るボタンクリックイベント.
         */
        p.clickResultListMoreButton = function (e) {
            renderServiceList(false);
        }

        /**
         * 対象機種の選択変更イベント.
         */
        var changeSelectionTargetDevice = function (e) {
            // ジャンル活性化制御
            disableFileringGenre();
            // 絞り込むボタンの活性化制御
            disableFileringButton();
        }

        /**
         * ジャンル・目的の大分類のチェックボックスクリックイベント.
         */
        var clickSelectionGenreL = function (e) {
            var genreAreaGroup = $(this).closest('.genre-area-group');
            if ($(this).prop('checked') == true) {
                // 大分類がチェックされたら小分類をチェック済みに変更する
                $('input:checkbox[name=genre_m]', genreAreaGroup).prop('checked', true);
                $('input:checkbox[name=genre_m]', genreAreaGroup).parent().addClass('checked onFocus');
            } else {
                // 大分類のチェックが外れたら小分類を未チェックに変更する
                $('input:checkbox[name=genre_m]', genreAreaGroup).prop('checked', false);
                $('input:checkbox[name=genre_m]', genreAreaGroup).parent().removeClass('checked onFocus');
            }
            // 絞り込むボタンの活性化制御
            disableFileringButton();
        }

        /**
         * ジャンル・目的の小分類のチェックボックスクリックイベント.
         */
        var clickSelectionGenreM = function (e) {
            var genreAreaGroup = $(this).closest('.genre-area-group');
            if ($(this).prop('checked') == true) {
                // 小分類がチェックされた
                $(this).parent().addClass('checked onFocus');
            } else {
                // 小分類のチェックが外れた
                $(this).parent().removeClass('checked onFocus');
                // 大分類を未チェックに変更する
                $('input:checkbox[name=genre_l]', genreAreaGroup).prop('checked', false);
                $('input:checkbox[name=genre_l]', genreAreaGroup).parent().removeClass('checked onFocus');
            }
            // 絞り込むボタンの活性化制御
            disableFileringButton();
        }

        /**
         * ジャンルの活性化制御.
         */
        var disableFileringGenre = function () {
            // 各種情報取得
            var mobileServiceFromGenre = getMobileServiceFromGenre();
            var modalDialog = getModalDialog(mobileServiceFromGenre);
            var selectedTargetDevice = $('select[name=targetDevice]', modalDialog).val();
            var genreCheckboxes = $('input:checkbox[name=genre_m]', modalDialog);

            if (selectedTargetDevice !== null && selectedTargetDevice !== '') {
                // 選択した機種に対応したジャンルの場合、活性
                $.each(genreCheckboxes, function () {
                    var flg = false;
                    var genreTargetDevices = $(this).data('device');
                    if (genreTargetDevices) {
                        var targetDevices = genreTargetDevices.split(',');
                        $.each(targetDevices, function (i, value) {
                            if (value === selectedTargetDevice) {
                                flg = true;
                                return false;
                            }
                        });
                    }

                    if (flg) {
                        $(this).prop('disabled', false);
                        $(this).closest('label').removeClass('disabled');
                    } else {
                        $(this).prop('disabled', true);
                        $(this).closest('label').addClass('disabled');
                    }
                });
            } else {
                // 未選択の場合、全て有効
                $.each(genreCheckboxes, function () {
                    $(this).prop('disabled', false);
                    $(this).closest('label').removeClass('disabled');
                });
            }
        }

        /**
         * 絞り込むボタンの活性化制御.
         */
        var disableFileringButton = function () {

            // モーダルダイアログの絞り込むボタン取得
            var mobileServiceFromGenre = getMobileServiceFromGenre();
            var modalDialog = getModalDialog(mobileServiceFromGenre);
            var buttonFiltering = $('div.button a', modalDialog).last();
            // 対象機種の選択チェック
            var selectedFlag = false;
            var selectedTargetDevice = $('select[name=targetDevice]', modalDialog).val();
            if (selectedTargetDevice !== null && selectedTargetDevice !== '') {
                // 選択ありの場合
                selectedFlag = true;
            } else {
                // ジャンル・目的のチェック
                var genreCheckboxes = $('input:checkbox[name=genre_m]', modalDialog);
                $.each(genreCheckboxes, function () {
                    if ($(this).prop('checked') == true) {
                        // チェック済み
                        selectedFlag = true;
                        return false;
                    }
                });
            }

            if (selectedFlag) {
                // 対象機種またはジャンル・目的のいずれかが選択済みの場合、絞り込むボタンを活性化する
                $(buttonFiltering).removeClass('btn-disabled');
            } else {
                // 上記以外の場合、絞り込むボタンを非活性化する
                $(buttonFiltering).addClass('btn-disabled');
            }
        }

        /**
         * モバイルサービスリスト取得.
         */
        var getMobileServiceList = function () {
            console.log('MobileServiceFromGenreFilteringCls.getMobileServiceList start')
            // 各種情報取得
            var mobileServiceFromGenre = getMobileServiceFromGenre();
            var conditionSection = getConditionSection(mobileServiceFromGenre);
            var modalDialog = getModalDialog(mobileServiceFromGenre);
            var mobileServiceTags = $('input[name=mobileServiceTags]', mobileServiceFromGenre).val();
            var selectedTargetDeviceTags = getSelectedTargetDevice(conditionSection, modalDialog);
            var selectedGenreTags = getSelectedGenre(conditionSection, modalDialog);

            // サーバへ問い合わせ
            try {
                window.loading.start();
                $.ajax({
                    type: "GET",
                    url: "/bin/wcm/au-com/mobile-service/from-genre.json",
                    data: {
                        mobileServiceTags: mobileServiceTags,
                        selectedTargetDeviceTags: selectedTargetDeviceTags,
                        selectedGenreTags: selectedGenreTags,
                        locale: $('html').attr('lang'),
                        _charset_: "UTF-8"
                    }
                }).done( function (data, textStatus, jqXHR) {
                    // 成功
                    console.log('MobileServiceFromGenreFilteringCls.getMobileServiceList ajax done');
                    console.log(data);
                    // 検索結果見出し表示
                    visibleResultHeading(true);
                    if (data && data.length > 0) {
                        // 検索結果ありの場合、サービス一覧を再描画する
                        serviceList = data;
                        renderServiceList(true);
                        visibleNothingResulMessage(false);
                    } else {
                        // 検索結果無しの場合
                        // サービス一覧エリアのクリア
                        removeServiceList();
                        // 検索結果無しメッセージ表示
                        visibleNothingResulMessage(true);
                        // もっとみるボタン非表示
                        visibleResultListMoreButton(false);
                    }
                }).fail( function (jqXHR, textStatus, errorThrown) {
                    // エラー
                    console.log('MobileServiceFromGenreFilteringCls.getMobileServiceList ajax error')
                    // エラーメッセージ表示
                }).always( function (data) {
                    console.log('MobileServiceFromGenreFilteringCls.getMobileServiceList ajax always')
                    window.loading.stop();
                });
            } catch (e) {
                // エラー
                console.log(e);
                window.loading.stop();
            }

            console.log('MobileServiceFromGenreFilteringCls.getMobileServiceList end')
        }

        /**
         * 選択された対象機種を取得する.
         */
        var getSelectedTargetDevice = function (conditionSection, modalDialog) {
            // 各種情報取得
            var targetDeviceConditionUnselected = $('.targetDeviceConditionUnselected', conditionSection);
            var targetDeviceConditionSelected = $('.targetDeviceConditionSelected', conditionSection);
            // 選択値の取得
            var value = $('select[name=targetDevice]', modalDialog).val();
            if (value == null || value == '') {
                // 未選択の場合、選択値情報をクリアする
                $(targetDeviceConditionUnselected).removeClass('hide');
                $(targetDeviceConditionSelected).addClass('hide');
                $(targetDeviceConditionSelected).html('');
            } else {
                // 選択ありの場合
                $(targetDeviceConditionUnselected).addClass('hide');
                $(targetDeviceConditionSelected).removeClass('hide');
                var text = $('select[name=targetDevice] option:selected', modalDialog).text();
                $(targetDeviceConditionSelected).html(text);
            }
            return value;
        }

        /**
         * 選択されたジャンル・目的を取得する.
         */
        var getSelectedGenre = function (conditionSection, modalDialog) {
            // 各種情報取得
            var genreConditionUnselected = $('.genreConditionUnselected', conditionSection);
            var genreConditionSelected = $('.genreConditionSelected', conditionSection);
            // 選択値の取得
            var genreCheckboxes = $('input:checkbox', modalDialog);
            var selectedValues = [];
            var selectedtext = [];
            $.each(genreCheckboxes, function () {
                if ($(this).prop('checked') == true && $(this).prop('disabled') == false) {
                    // チェック済み
                    selectedValues.push($(this).val());
                    selectedtext.push($(this).parent('label').text());
                }
            });
            if (selectedValues.length > 0) {
                // 選択ありの場合
                $(genreConditionUnselected).addClass('hide');
                $(genreConditionSelected).removeClass('hide');
                var selectedgenre = selectedtext.join(',');
                $(genreConditionSelected).html(selectedgenre);
            } else {
                // 選択なしの場合
                $(genreConditionUnselected).removeClass('hide');
                $(genreConditionSelected).addClass('hide');
                $(genreConditionSelected).html('');
            }
            return selectedValues.join(',');
        }

        /**
         * モーダルダイアログリセット.
         */
        var resetModalDialog = function () {
            // 各種情報取得
            var modalDialog = getModalDialog();
            // 対象機種のクリア
            $('select[name=targetDevice] option').first().prop('selected', true);
            // ジャンル・目的のクリア
            $('input:checkbox[name=genre_l]', modalDialog).prop('checked', false);
            $('input:checkbox[name=genre_m]', modalDialog).prop('checked', false);
            $('input:checkbox[name=genre_l]', modalDialog).parent().removeClass('checked onFocus');
            $('input:checkbox[name=genre_m]', modalDialog).parent().removeClass('checked onFocus');
            // ジャンル活性化制御
            disableFileringGenre();
        }

        /**
         * 検索結果見出し表示切替.
         */
        var visibleResultHeading = function (visible) {
            var resultArea = getResultArea();
            if (visible) {
                // 表示
                $('#heading_section', resultArea).removeClass('hide');
            } else {
                // 非表示
                $('#heading_section', resultArea).addClass('hide');
            }
        }

        /**
         * 0件メッセージ表示切替.
         */
        var visibleNothingResulMessage = function (visible) {
            var resultArea = getResultArea();
            if (visible) {
                // 表示
                $('#nothing_message', resultArea).removeClass('hide');
            } else {
                // 非表示
                $('#nothing_message', resultArea).addClass('hide');
            }
        }

        /**
         * もっとみるボタン表示切替.
         */
        var visibleResultListMoreButton = function (visible) {
            var resultArea = getResultArea();
            if (visible) {
                // 表示
                $('#button_section', resultArea).removeClass('hide');
            } else {
                // 非表示
                $('#button_section', resultArea).addClass('hide');
            }
        }

        /**
         * サービス一覧描画.
         */
        var renderServiceList = function (isReset) {
            console.log('MobileServiceFromGenreFilteringCls.renderServiceList start')
            // 各種情報取得
            var mobileServiceFromGenre = getMobileServiceFromGenre();
            var resultArea = getResultArea(mobileServiceFromGenre);
            var resultlistDrawingArea = $('.result-list .card-display', resultArea);
            // サービス一覧エリアのクリア
            removeServiceList();
            // 変数初期化
            var displayedCnt = 0;
            if (isReset) {
                // 初期表示時、合計表示件数の初期化
                totalDisplayCount = 0;
            }
            // もっとみるボタン非表示
            visibleResultListMoreButton(false);
            // 合計表示件数に初期表示件数を加算
            totalDisplayCount += initialDisplayCount;
            // テンプレートの取得
            var templateItem = $('.cardTemplate', resultArea);
            // 取得したデータ件数分処理する
            var listTotalCount = serviceList.length;
            $.each(serviceList, function (i, item) {
                var serviceItem = $(templateItem).clone(true);
                $(serviceItem).css('display', '');
                $('.service-title', serviceItem).text(item.title);
                $('.service-link', serviceItem).attr('href', item.servicePagePath);
                if (item.servicePagePathTarget == 'on') {
                    $('.service-link', serviceItem).attr('target', '_blank');
                }
                var deviceIconArea = $('.deviceList ul', serviceItem);
                for (var n = 0; n < item.deviceTagList.length; n++) {
                    var deviceTag = item.deviceTagList[n];
                    var deviceIconItem = $('<span></span>', {
                        addClass: 'iconElem icon-text icon-white margin-t-10 margin-r-10 margin-b-0 margin-l-0',
                    });
                    $(deviceIconItem).text(deviceTag.title);
                    var deviceIconLi = $('<li></li>').append(deviceIconItem);
                    $(deviceIconArea).append(deviceIconLi);
                }
                $('.service-description', serviceItem).text(item.serviceDescription);
                var serviceIconArea = $('.iconList ul', serviceItem);
                for (var n = 0; n < item.genreTagList.length; n++) {
                    var genreTag = item.genreTagList[n];
                    var serviceIconItem = $('<span></span>', {
                        addClass: 'iconElem icon-text icon-lightGrey margin-t-10 margin-r-10 margin-b-0 margin-l-0',
                    });
                    $(serviceIconItem).text(genreTag.title);
                    var serviceIconLi = $('<li></li>').append(serviceIconItem);
                    $(serviceIconArea).append(serviceIconLi);
                }
                $(resultlistDrawingArea).append(serviceItem);
                displayedCnt++;
                if (displayedCnt > totalDisplayCount - 1) {
                　　　　// 表示件数＞合計表示件数の場合
                    if (listTotalCount !== displayedCnt) {
                        // 総件数が表示件数でない場合、もっとみるボタン表示
                        visibleResultListMoreButton(true);
                    }
                    return false;
                }
            });
            // カードの高さを揃える
            $('.cardBox-ctr', resultArea).matchHeight({
                byRow: true // 行ごとに高さを揃えるなら：true
            });

            console.log('MobileServiceFromGenreFilteringCls.renderServiceList end')
        }

        /**
         * サービス一覧削除.
         */
        var removeServiceList = function () {
            var resultArea = getResultArea();
            var resultlistDrawingArea = $('.result-list .card-display', resultArea);
            $(resultlistDrawingArea).empty();
        };

        /**
         * モバイルサービスジャンルエリア取得.
         */
        var getMobileServiceFromGenre = function () {
            return $('.mobile-service-from-genre');
        }

        /**
         * 条件エリア取得.
         */
        var getConditionSection = function (mobileServiceFromGenre) {
            if (mobileServiceFromGenre) {
                return $('.search-card-section', mobileServiceFromGenre);
            }
            return $('.mobile-service-from-genre .search-card-section');
        }

        /**
         * 結果エリア取得.
         */
        var getResultArea = function (mobileServiceFromGenre) {
            if (mobileServiceFromGenre) {
                return $('.result-area', mobileServiceFromGenre);
            }
            return $('.mobile-service-from-genre .result-area');
        }

        /**
         * モーダルダイアログ取得.
         */
        var getModalDialog = function (mobileServiceFromGenre) {
            if (mobileServiceFromGenre) {
                return $('#mobile_service_from_genre_modal', mobileServiceFromGenre);
            }
            return $('#mobile_service_from_genre_modal');
        }

        return MobileServiceFromGenreFilteringCls;

    })();
})(jQuery);

/* mobile-service-from-genre.js */

(function ($) {

    if (window.mobileServieFromGenreAPI) {
        return; // 2重初期化防止
    }

    /* 公開APIの箱 */
    window.mobileServieFromGenreAPI = {};

    /**
     * 初期化処理.
     */
    var init = function () {
        // 対象機種およびジャンル・目的絞り込みクラスの生成
        var mobileServiceFromGenreFilteringCls = new MobileServiceFromGenreFilteringCls();
        mobileServiceFromGenreFilteringCls.init();
        window.mobileServiceFromGenreFilteringCls = mobileServiceFromGenreFilteringCls;
    }

    window.mobileServieFromGenreAPI.init = init;
})(jQuery);

(function($) {
    'use strict';

    /**
     * 文字をデコードする
     * ※v1の処理を継承
     *
     * @private
     * @param {String} 文字列
     */
    function decode(str) {
        let result = str;
        if (str && window.navigator.userAgent.toLowerCase().indexOf('safari') != -1) {
            let esc = escape( str );
            if ( esc.indexOf("%u") < 0 && esc.indexOf("%") > -1 ) {
                result = decodeURIComponent( esc );
            }
        }
        return result;
    }

    /**
     * エラーメッセージの表示／非表示を切り替える
     *
     * @private
     * @param {jQueryElement} 対象の郵便番号検索ボタン
     * @param {Boolean} true：表示、false：非表示
     */
    function errorMsg($elem, isShow) {

        let $errMsgElem = $('.cmp-au-com-form-zip-search__error-message', $elem.parent());
        if (isShow) {
            $errMsgElem.show();
        } else {
            $errMsgElem.hide();
        }

    }

    /**
     * ready 処理
     */
    $(function() {

        // 郵便番号検索ボタンの click イベントをキャッチ
        $(document).on('click', '.cmp-au-com-form-zip-search__button', function(){

            let $button = $(this);
            let prefecturesJson = $button.data('prefectures-json');
            let zipJsonPath = $button.data('zip-json-path');
            let zip = '';
            let zip1Name = $button.data('in-zip1');
            let zip2Name = $button.data('in-zip2');
            let prefectures = $button.data('out-prefectures');
            let city = $button.data('out-city');
            let formName = window.auForm.getFormName($button);
            let $prefectures = $('[name=' + prefectures + ']');
            let $city = $('[name=' + city + ']');

            // 出力するフィールドの値を初期化
            $prefectures.val('');
            $city.val('');

            // エラーメッセージを非表示
            errorMsg($button, false);

            // 郵便番号１を取得
            if (zip1Name) {
                let zip1val=window.formDataLayerAPI.get('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + zip1Name + '/value');
                if (zip1val) {
                    zip = zip1val;
                }
            }

            // 郵便番号２を取得
            if (zip2Name) {
                let zip2val=window.formDataLayerAPI.get('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + zip2Name + '/value');
                if (zip2val) {
                    zip += zip2val;
                }
            }

            if (zip) {
                zip = zip.replace('-', '');
            }

            // 郵便番号検索
            if (zipJsonPath && zip.length >= 7) {

                $.getJSON(zipJsonPath+'/zip-'+zip.substring(0, 3)+'.json', function(json){

                    // 結果が返ってきた場合
                    if (json) {

                        // 郵便番号を基に住所情報を取得
                        let zipJson = json[zip];

                        // 住所情報が取得できた場合
                        if (zipJson && zipJson.length >= 3) {

                            // 都道府県キーを取得
                            let prefecturesKey = zipJson[0];
                            // 住所１を取得
                            let address1 = zipJson[1];
                            // 住所２を取得
                            let address2 = zipJson[2];

                            // 都道府県キーを基に都道府県名を取得（都道府県名はポリシーで定義している）
                            let prefecturesName = prefecturesJson[prefecturesKey];

                            // 都道府県設定
                            if (prefectures && prefecturesName) {
                                $prefectures.val(prefecturesName).trigger('change');
                            }

                            // 市区町村設定
                            if (city && address1 && address2) {
                                let address = decode(address1 + address2);
                                $city.val(address).trigger('blur');
                            }

                        // 住所情報が取得できなかった場合
                        } else {

                            // エラーメッセージを表示
                            errorMsg($button, true);
                        }

                    // 結果が返ってこなかった場合
                    } else {

                        // エラーメッセージを表示
                        errorMsg($button, true);
                    }

                });

            }

        });

    });

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormText:ready';
    const EMAIL_TYPE = 'email';

    // 祝日リスト
    let publicHolidayList = {};

    /** 全角英字 → 半角英字 */
    function convertAlphabetFullToHalf(str) {
        return str.replace(/[Ａ-Ｚａ-ｚ]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
        });
    }

    /** 半角英字 → 全角英字 */
    function convertAlphabetHalfToFull(str) {
        return str.replace(/[A-Za-z]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) + 0xFEE0);
        });
    }

    /** 全角数字 → 半角数字 */
    function convertNumberFullToHalf(str) {
        return str.replace(/[０-９]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
        });
    }

    /** 半角数字 → 全角数字 */
    function convertNumberHalfToFull(str) {
        return str.replace(/[0-9]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) + 0xFEE0);
        });
    }

    /** 全角記号 → 半角記号 */
    function convertSymbolsFullToHalf(str) {
        let regex = /[！＂＃＄％＆＇（）＊＋，－．／：；＜＝＞？＠［＼］＾＿｀｛｜｝]/g;

        // 入力値の全角を半角の文字に置換
        let value = str
          .replace(regex, function (s) {
            return String.fromCharCode(s.charCodeAt(0) - 0xfee0);
          })
          .replace(/[‐－―]/g, "-") // ハイフンなど
          .replace(/[～〜]/g, "~") // チルダ
          .replace(/　/g, " "); // スペース

        return value;
    }

    /** 半角記号 → 全角記号 */
    function convertSymbolsHalfToFull(str) {
        let regex = /[!"#$%&'()*+,-.\/:;<=>?@\\^_`{|}]/g;

        // 入力値の半角を全角の文字に置換
        let value = str
          .replace(regex, function (s) {
            return String.fromCharCode(s.charCodeAt(0) + 0xfee0);
          })
          .replace(/[-]/g, "－") // ハイフンなど
          .replace(/[~]/g, "～") // チルダ
          .replace(/ /g, "　"); // スペース

        return value;
    }

    /** ひらがな → カタカナ */
    function convertHiraganaToKatakana(str) {
        return str.replace(/[\u3041-\u3096]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) + 0x60);
        });
    }

    /** カタカナ → ひらがな */
    function convertKatakanaToHiragana(str) {
        return str.replace(/[\u30a1-\u30f6]/g, function(s) {
            return String.fromCharCode(s.charCodeAt(0) - 0x60);
        });
    }

    /**
     * フォームテキストに入力された値を指定された変換タイプに応じた値に変換する
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function convertStr($elem) {

        let $formParts = $elem.closest('.cmp-au-com-form-text');
        let convertType = $formParts.data('cmp-convert-type');
        let autoDeleteHyphen = $formParts.data('cmp-auto-delete-hyphen');
        let result = $elem.val();

        if (result) {

            switch(convertType) {
                // 全角から半角（数字）
                case 'numFromFullToHalf':
                    result = convertNumberFullToHalf(result);
                    break;
                // 半角から全角（数字）
                case 'numFromHalfToFull':
                    result = convertNumberHalfToFull(result);
                    break;
                // 全角から半角（英数字記号）
                case 'alphaNumSymbolFromFullToHalf':
                    result = convertAlphabetFullToHalf(result);
                    result = convertNumberFullToHalf(result);
                    result = convertSymbolsFullToHalf(result);
                    break;
                // 半角から全角（英数字記号）
                case 'alphaNumSymbolFromHalfToFull':
                    result = convertAlphabetHalfToFull(result);
                    result = convertNumberHalfToFull(result);
                    result = convertSymbolsHalfToFull(result);
                    break;
                // ひらがなからカタカナ
                case 'hiraganaToKatakana':
                    result = convertHiraganaToKatakana(result);
                    break;
                // カタカナからひらがな
                case 'katakanaToHiragana':
                    result = convertKatakanaToHiragana(result);
                    break;
            }

            if (autoDeleteHyphen) {
                result = result.replace(/[-‐－―]/g, '');
            }

            $elem.val(result);

        }

    }


    /**
     * 入力部品を取得する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @return 対象の入力部品
     */
    function getInputParts($formParts) {
        return $('.cmp-au-com-form__inputparts' ,$formParts)
    }

    /**
     * フォームテキスト入力部品に対しバリデーションチェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function validationCheck($formParts) {

        let $elem = getInputParts($formParts);
        let elem = $elem[0];
        let errMsg = [];
        let requiredMessage = $formParts.data('cmp-required-message');
        let inputValuesCheck = $formParts.data('cmp-input-values-check');
        let conditionSettings = $formParts.data('cmp-condition-settings-json');
        let type = $elem.get(0).type;
        let validationMessage = '';
        let readOnly = elem.readOnly;

        if (!window.auForm.isEnableElement($elem)) {
            return validationMessage;
        }

        // 文字列変換
        convertStr($elem);

        let val = $elem.val();

        // input.typeに依存する制約を無効化する
        if ($elem.hasClass('cmp-au-com-form-text__text')) {
            $elem.get(0).type = 'text';
        }

        // 必須チェック
        if (isRequiredError($formParts)) {

            if (requiredMessage) {
                errMsg.push(requiredMessage);
            }

        // カスタム制約チェック
        } else {

            if (inputValuesCheck && conditionSettings) {

                conditionSettings.forEach(function(condition, index) {

                    let errorMessage = '';
                    // 桁数チェック
                    if (condition.conditionType == 'charactersCount') {

                        let min = condition.min || 0;
                        let max = condition.max || val.length;

                        if ( val.length < min || max < val.length) {
                            errorMessage = condition.errorMessage;
                        }

                    // 他の入力項目と比較する
                    } else if (condition.conditionType == 'formData') {
                        if (condition.comparisonItemPath) {
                            let itemValue = window.formDataLayerAPI.get(condition.comparisonItemPath) || '';
                            if (itemValue !== val) {
                                errorMessage = condition.errorMessage;
                            }
                        }
                    // 存在チェック
                    } else if (condition.conditionType == 'registeredCheck') {
                        let cmpIsRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
                        let cmpIsRegistered = cmpIsRegisteredList[index];

                        if ((condition.checkType == "registered" && cmpIsRegistered === true) ||
                                (condition.checkType == "unRegistered" && cmpIsRegistered === false)) {
                            errorMessage = condition.errorMessage;
                        } else if (cmpIsRegistered == "apiError" && condition.treatAsError == "on") {
                            errorMessage = condition.apiErrorMessage;
                        }
                    } else {
                        if (val && condition.regExp && !String(val).match(condition.regExp)) {
                            errorMessage = condition.errorMessage;
                        }
                    }

                    if (errorMessage && errMsg.indexOf(errorMessage) < 0) {
                        errMsg.push(errorMessage);
                    }

                });

            }

        }

        // HTMLのカスタムバリデーションにメッセージを設定
        if (errMsg.length) {
            elem.setCustomValidity(errMsg.join('\n'));
        } else {
            elem.setCustomValidity('');
        }

        // 読み取り専用を一時的に解除
        // （ブラウザによって制約メッセージが取得できないため）
        if (readOnly) {
            $elem.prop('readonly', false);
        }

        // 制約メッセージを取得
        validationMessage = elem.validationMessage;

        // 読み取り専用の設定を戻す
        $elem.prop('readonly', readOnly);

        // input.typeの設定を戻す
        if ($elem.hasClass('cmp-au-com-form-text__text')) {
            $elem.get(0).type = type;
        }

        // data属性に値を設定
        let deleteNonNumericCharacters = $elem.data('cmp-delete-non-numeric-characters');
        let dataValue = val && deleteNonNumericCharacters ? val.replace(/\D/g, '') : val;
        $elem.data('value', dataValue);

        return validationMessage;
    }

    /**
     * URLのクエリパラメータを取得して、その値を入力部品へ入れる。
     *
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
     function setParamVal($formParts) {

        let $elem = getInputParts($formParts);
        let queryParam = $formParts.data('cmp-query-param');
        let queryParamVal = CommonUtil.getParam(queryParam);

        // 入力部品が有効かつクエリパラメータがセットされている場合にemailタイプにクエリパラメータの値を自動補完
        if (window.auForm.isEnableElement($elem) && queryParam != null && $elem.get(0).type == EMAIL_TYPE && queryParamVal && !$elem.val()) {

            //復号化
            $.ajax({
                type: 'GET',
                url: '/bin/wcm/au-com/chiper',
                dataType: 'text',
                data: {queryParamVal:queryParamVal}
                }).done(function (data) {
                    $elem.val(JSON.parse(data)["decryption"]).trigger('blur');
                }).fail(function(XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.status + " "+ textStatus + " " + errorThrown.message);
            });
        }
    }

    /**
     * フォームテキスト入力部品に対し必須チェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function isRequiredError($formParts) {

        let $elem = getInputParts($formParts);
        let elem = $elem[0];
        let isError = false;
        let required = $formParts.data('cmp-required') === true || $formParts.data('cmp-required') === "";
        let readOnly = elem.readOnly;

        // 入力部品が有効な場合のみチェック
        if (window.auForm.isEnableElement($elem)) {

            $elem.prop('required', required);

            // 必須 && 読み取り専用の場合、読み取り専用を一時的に解除
            // （ブラウザによって必須チェックが効かなくなるため）
            if (required && readOnly) {
                $elem.prop('readonly', false);
            }

            // 必須チェック
            isError = elem.validity.valueMissing;

            // 読み取り専用の設定を戻す
            $elem.prop('readonly', readOnly);

        }

        return isError;
    }

    /**
     * キャンペーンフォームの登録済みチェックを実行するpromiseを返却する
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function registeredCheckPromise ($formParts, formId, index) {

        return new Promise(function(resolve, reject) {

            let $elem = getInputParts($formParts);
            let val = $elem.val();
            let isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};

            if (window.auForm.isEnableElement($elem) && val) {

                // 文字列変換
                convertStr($elem);

                window.auForm.registeredCheck(formId, val)
                .then(function(data){
                    isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
                    if (data) {
                        isRegisteredList[index] = data.isRegistered;
                    } else {
                        isRegisteredList[index] = "apiError";
                    }
                    $formParts.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                })
                .fail(function(){
                    isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
                    isRegisteredList[index] = "apiError";
                    $formParts.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                });

            } else {
                resolve();
            }

        });

    }

    /**
     * DatePickerのオプションに設定する日数を取得する
     *
     * @private
     * @param {Int} 設定日数
     * @param {Boolean} 土日を除いて計算するか
     * @param {Boolean} 祝日を除いて計算するか
     * @return {String} DatePickerのオプションに設定する日数
     */
    function getDayCountOption(dayCount, excludeHoliday, excludePublicHoliday) {

        dayCount = parseInt(dayCount);
        let day = dayCount < 0 ? dayCount * -1 : dayCount;
        let sign = dayCount < 0 ? '-' : '+';
        let currentDate = new Date();

        for (let i = 0; i < day; i++) {
            currentDate.setDate(currentDate.getDate() + 1);
            // 土日の場合
            if (currentDate.getDay() == '0'|| currentDate.getDay() == '6') {
                if (excludeHoliday == 'on') {
                    // 土日除外の場合、日数に1日加算
                    day += 1;
                } else if (excludePublicHoliday == 'on') {
                    // 祝日除外の場合、日数に1日加算
                    if (dateFormat(currentDate) in publicHolidayList) {
                        day += 1;
                    }
                }
            // 平日の場合
            }else{
                if (excludePublicHoliday == 'on') {
                    // 祝日除外の場合、日数に1日加算
                    if (dateFormat(currentDate) in publicHolidayList) {
                        day += 1;
                    }
                }
            }
        }

        return sign + day + 'd';

    }


    /**
     * DatePickerのオプションを設定する
     *
     * @private
     * @param {jQueryObject} 対象の日付入力部品
     */
    function setDatepickerOptions($elems) {

        $elems.each(function() {

            let datePickerOption = {};
            let $dateInputParts = $(this);
            let selectableStartDate = $dateInputParts.data('cmp-selectable-start-date');
            let excludeHolidayInStartDate = $dateInputParts.data('cmp-exclude-holiday-in-start-date');
            let excludePublicHolidayInStartDate = $dateInputParts.data('cmp-exclude-public-holiday-in-start-date');
            let selectableEndDate = $dateInputParts.data('cmp-selectable-end-date');
            let excludeHolidayInEndDate = $dateInputParts.data('cmp-exclude-holiday-in-end-date');
            let excludePublicHolidayInEndDate = $dateInputParts.data('cmp-exclude-public-holiday-in-end-date');
            let dateFormatStr = $dateInputParts.data('cmp-date-format');

            // 日付の範囲（開始日）
            if (selectableStartDate != undefined) {
                datePickerOption.minDate = getDayCountOption(selectableStartDate, excludeHolidayInStartDate, excludePublicHolidayInStartDate);
            }

            // 日付の範囲（終了日）
            if (selectableEndDate != undefined) {
                datePickerOption.maxDate = getDayCountOption(selectableEndDate, excludeHolidayInEndDate, excludePublicHolidayInEndDate);
            }

            // 日付の形式
            if (dateFormatStr) {
                datePickerOption.dateFormat = dateFormatStr;
            }

            // DatePickerのオプションに設定
            $dateInputParts.datepicker('option' , datePickerOption);

            // フォームデータレイヤーから入力部品に値を反映
            window.formDataLayerAPI.setDataLayerToInputValues($dateInputParts);

        });

    }


    /**
     * 各日付入力部品にカレンダーを設定する
     *
     * @private
     */
    function setDatePicker() {

        let $dateInputParts = $('.cmp-au-com-form__inputparts--date');

        if ($dateInputParts.length > 0) {

            // カレンダー追加
            $dateInputParts.datepicker();

            if ($('.cmp-au-com-form__inputparts--date[data-cmp-exclude-public-holiday-in-start-date=on]').length > 0 ||
                $('.cmp-au-com-form__inputparts--date[data-cmp-exclude-public-holiday-in-end-date=on]').length > 0) {
                // 祝日情報を取得（Googleカレンダー）
                getPublicHoliday($dateInputParts)
                .then(function (res) {
                    // 祝日リスト生成｛日付：祝日の名前｝
                    $.each (res.items, function() {
                        publicHolidayList[this.start.date] = this.summary;
                    });
                    // Datepicker オプション設定
                    setDatepickerOptions($dateInputParts);
                })
                .fail(function () {
                    // Datepicker オプション設定
                    setDatepickerOptions($dateInputParts);
                });
            } else {
                // Datepicker オプション設定
                setDatepickerOptions($dateInputParts);
            }

        }

    }


    /**
     * GoogleAPIから祝日情報を取得する
     *
     * @private
     * @param {jQueryObject} 日付
     * @return {Object} ajaxの返却値
     */
    function getPublicHoliday($elems) {
        let url = $elems.data('cmp-google-api-url');
        return $.ajax({
            url: url,
            type: 'GET',
            cache: false
          });
    }

    /**
     * 日付を特定のフォーマットに変換して文字列型で返却する
     *
     * @private
     * @param {Date} 日付
     * @return {String} フォーマット後の日付
     */
    function dateFormat(date) {
        return date.getFullYear() + '-' + ('0' + (date.getMonth()+1)).slice(-2) + '-' + ('0' + date.getDate()).slice(-2);
    }

    /**
     * blurイベントをキャッチしてバリデーションチェック
     */
    $(document).on("blur", ".cmp-au-com-form-text", function () {
        let $formElem = $(this);
        let $inputParts = getInputParts($formElem);
        let $alertParts = $('.cmp-au-com-form__alertparts', $formElem);
        let $alertPartsText = $('.cmp-au-com-form__alertparts__text', $alertParts);
        let formName = window.auForm.getFormName($inputParts);
        let name = $inputParts.attr('name');
        let timeout = $inputParts.hasClass('cmp-au-com-form__inputparts--date') ? 200 : 0;
        $formElem.removeData('cmpIsRegisteredList');
        if (formName && name && $inputParts.length > 0) {
            setTimeout(function(){
                let errMsg = validationCheck($formElem);
                $alertPartsText.text(errMsg);
                if (errMsg) {
                    $alertParts.css('display', 'inline-flex');
                } else {
                    $alertParts.hide();
                }
                window.formDataLayerAPI.set('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name + '/value', $inputParts.val());
            }, timeout);
        }
    });

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        let $auFormParts = $('.cmp-au-com-form-text');

        $auFormParts.each(function() {

            let $formElem = $(this);
            let $inputParts = getInputParts($formElem);
            let formName = window.auForm.getFormName($inputParts);
            let name = $inputParts.attr('name');

            // バリデーションチェック設定
            if (formName && name && $inputParts.length > 0) {
                // ロード時のバリデーションチェック
                validationCheck($formElem);

                // ロード時のクエリパラメータの読み込み
                setParamVal($formElem);
            }

        });

        $(document).trigger(READY_EVENT);

    });

    /**
     * ready 処理
     */
    $(function() {

        // カレンダー設定
        setDatePicker();

    });

    window.auForm = window.auForm || {};
    window.auForm.text = {};
    window.auForm.text.validationCheck = validationCheck;
    window.auForm.text.registeredCheckPromise = registeredCheckPromise;
    window.auForm.text.isRequiredError = isRequiredError;
    window.auForm.text.getInputParts = getInputParts;
    window.auForm.text.ready = READY_EVENT;

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormStoreServiceOption:ready';

    /**
     * オプションエレメントを作成する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @private
     */
    function cleateOptionsElem($auFormParts) {

        $auFormParts.each(function() {

            const $formParts = $(this);
            const name = $formParts.data('cmpName');

            if (!name) {
                return;
            }

            $formParts.removeClass('cmp-au-com-form-options--hide');

            const values = AU_COMMON.getParameter(document.location.href, name);

            const $inputParts = window.auForm.option.getInputParts($formParts)
            if (values != null) {
                window.formDataLayerAPI.setCheckedValues($inputParts, values);
            } else {
                window.formDataLayerAPI.setDataLayerToInputValues($inputParts);
            }
        });

    }

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        let $auFormParts = $('.cmp-au-com-form-store-service-options');

        if (!$auFormParts.length) {
            $(document).trigger(READY_EVENT);
            return;
        }

        cleateOptionsElem($auFormParts);
        $(document).trigger(READY_EVENT);
    });

    window.auForm = window.auForm || {};
    window.auForm.storeServiceOption = {};
    window.auForm.storeServiceOption.ready = READY_EVENT;

})(jQuery);
(function($) {
    'use strict';

    const READY_EVENT = 'auFormStorePrefectureOption:ready';
    let prefectures = {};

    /**
     * 初期値を設定する.
     *
     * @private
     * @param {jQueryElement} 入力部品のエレメント
     */
    function setInitialValue($inputParts) {
        if (!$inputParts || !$inputParts.length) {
            return;
        }
        const formName = window.auForm.getFormName($inputParts);
        const name =$inputParts.attr('name');

        const param = AU_COMMON.getParameter(document.location.href, name);
        if (param != null) {
            if ($inputParts.children('option[value="' + param + '"]').length) {
                $inputParts.val(param);
                const inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);
                if (inputInfo != null) {
                    window.formDataLayerAPI.set('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name, inputInfo)
                }
            }
        } else {
            window.formDataLayerAPI.setDataLayerToInputValues($inputParts);
        }
    }

    /**
     * セレクトボックスを追加する.
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     * @param {Array} オプション
     */
    function addSelectElem($formElem, options) {

        const $optionsField = $('.cmp-au-com-form-options__field', $formElem);
        const $select = $('.cmp-au-com-form-options__input--drop-down', $optionsField);
        const id = $formElem.data('cmp-id');
        let value = '';

        $select.empty();

        // オプションの数だけエレメントを追加する
        options.forEach(function(option, index) {

            let $option = undefined;
            const itemId = id + '-' + index
            // オプション
            $option = $('<option></option>', {
                'value': option.value,
                'data-text': option.text,
                'data-value': option.value,
                'label': option.text
            });

            $option.text(option.text);

            $option.attr('id', itemId);
            $select.append($option);

        });

        $select.val(value);

    }

    /**
     * 都道府県一覧を取得する.
     *
     * @private
     */
    function getPrefectureOptions() {
        const options = [];

        if (!prefectures || !prefectures.length) {
            return options;
        }

        prefectures.forEach(dto => {
            const option = {};
            option.value = dto.code;
            option.text = dto.name;
            options.push(option);
        });

        return options;
    }

    /**
     * 市区町村一覧を取得する.
     *
     * @private
     */
    function getCityOptions(prefectureCode) {
        const options = [];
        
        if (!prefectures || !prefectures.length) {
            return options;
        }

        const prefecture = prefectures.find(dto => {
            return dto.code == prefectureCode;
        });

        if (!prefecture) {
            return options;
        }

        const cities = prefecture.cities;

        if (!cities || !cities.length) {
            return options;
        }

        cities.forEach(dto => {
            const option = {};
            option.value = dto.code;
            option.text = dto.name;
            options.push(option);
        });

        return options;
    }

    /**
     * オプションエレメントを作成する.
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @private
     */
    function cleateOptionsElem($auFormParts) {

        $auFormParts.each(function() {

            const $formParts = $(this);
            const $prefectureFormParts = $('[data-cmp-pattern="prefecture"]', $formParts);
            const $cityFormParts = $('[data-cmp-pattern="city"]', $formParts);
            const $prefectureInputParts = $('.cmp-au-com-form__inputparts', $prefectureFormParts);
            const $cityInputParts = $('.cmp-au-com-form__inputparts', $cityFormParts);
            const prefectureName = $prefectureFormParts.data('cmpName');
            const cityName = $cityFormParts.data('cmpName');

            if (!prefectureName || !cityName) {
                return;
            }

            const $prefectureDefaultOption = $prefectureInputParts.children('option').eq(0);
            const prefectureDefaultOption = {};
            prefectureDefaultOption.value = $prefectureDefaultOption.data('value');
            prefectureDefaultOption.text = $prefectureDefaultOption.data('text');

            const $cityDefaultOption = $cityInputParts.children('option').eq(0);
            const cityDefaultOption = {};
            cityDefaultOption.value = $cityDefaultOption.data('value');
            cityDefaultOption.text = $cityDefaultOption.data('text');

            let prefectureOptions = [];
            prefectureOptions.push(prefectureDefaultOption);
            prefectureOptions = prefectureOptions.concat(getPrefectureOptions());
            addSelectElem($prefectureFormParts, prefectureOptions);

            $prefectureInputParts.on('change', function() {
                const $inputParts = $(this);

                let cityOptions = [];
                cityOptions.push(cityDefaultOption);
                cityOptions = cityOptions.concat(getCityOptions($inputParts.val()));
                addSelectElem($cityFormParts, cityOptions);

                $cityInputParts.val('').trigger('change');
            });

            $prefectureFormParts.removeClass('cmp-au-com-form-options--hide');
            $cityFormParts.removeClass('cmp-au-com-form-options--hide');

            setInitialValue($prefectureInputParts);

            let cityOptions = [];
            cityOptions.push(cityDefaultOption);
            cityOptions = cityOptions.concat(getCityOptions($prefectureInputParts.val()));
            addSelectElem($cityFormParts, cityOptions);

            setInitialValue($cityInputParts);
        });

    }

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        let $auFormParts = $('.cmp-au-com-form-store-prefecture-options');

        if (!$auFormParts.length) {
            $(document).trigger(READY_EVENT);
            return;
        }

        window.auDataLayer.addEventListener(window.auDataLayer.storeLocator.prefecture.ready, function(){
            prefectures = window.auDataLayer.get('/storeLocator.prefecture');
            cleateOptionsElem($auFormParts);
            $(document).trigger(READY_EVENT);
        });
        window.auDataLayer.storeLocator.initPrefecture();

    });

    window.auForm = window.auForm || {};
    window.auForm.storePrefectureOption = {};
    window.auForm.storePrefectureOption.ready = READY_EVENT;

})(jQuery);

(function($) {
    'use strict';

    /**
    *
    * ユーザータイプ取得.
    *
    * @private
    * @returns {String} ユーザータイプ
    */
    function getUserType() {

        var USERTYPE_NOT_LOGIN = 'notLogin';
        var USERTYPE_AU_USER_FOR_INDIVIDUAL = 'auUserForIndividual';
        var USERTYPE_OPEN_USER_FOR_INDIVIDUAL = 'openUserForIndividual';
        var USERTYPE_AU_USER_FOR_BUSINESS = 'auUserForBusiness';
        var USERTYPE_OPEN_USER_FOR_BUSINESS = 'openUserForBusiness';
        var AUTHENTICATION_ERROR = 'authenticationError';

        if (window.auDataLayer.userInfo.isError()) {
            return AUTHENTICATION_ERROR;
        }

        var userType = "";

        // ログイン判定
        if (window.auDataLayer.userInfo.isLive()){
            // 個人ユーザー/法人ユーザー判定
            if (window.auDataLayer.userInfo.isBusinessUser()) {

                // au ユーザー/オープンユーザー判定
                if (window.auDataLayer.userInfo.isAuUser()){
                    // au ユーザー（法人）
                    userType = USERTYPE_AU_USER_FOR_BUSINESS;
                }else{
                    // オープンユーザー（法人）
                    userType = USERTYPE_OPEN_USER_FOR_BUSINESS;
                }

            }else{

                // au ユーザー/オープンユーザー判定
                if (window.auDataLayer.userInfo.isAuUser()){
                    // au ユーザー（個人）
                    userType = USERTYPE_AU_USER_FOR_INDIVIDUAL;
                }else{
                    // オープンユーザー（個人）
                    userType = USERTYPE_OPEN_USER_FOR_INDIVIDUAL;
                }

            }

        } else {
            // 未ログイン
            userType = USERTYPE_NOT_LOGIN;
        }

        return userType;

    }

    /**
     * 指定された方法で値を比較する
     *
     * @private
     * @param {String} 比較方法
     * @param {String} 値１
     * @param {String} 値２
     * @return {Boolean} true：一致、false：不一致
     */
    function isMatch(method, value1, value2) {

        var isMatched = false;
        let value1Str = String(value1);
        let value2Str = String(value2);
        var value1Int = parseInt(value1, 10);
        var value2Int = parseInt(value2, 10);
        switch (method) {
            case '==':
                isMatched = value1Str == value2Str;
                break;
            case '!=':
                isMatched = value1Str != value2Str;
                break;
            case '>=':
                isMatched = value1Int >= value2Int;
                break;
            case '<=':
                isMatched = value1Int <= value2Int;
                break;
            default :
                isMatched = value2 && value1Str.match(value2Str);
                break;
        }

        return isMatched;

    }

    /**
     * 条件タイプ＝フォームデータの場合の比較を実施し、比較結果を返却する
     *
     * @private
     * @param {Object} リダイレクト条件
     * @return {Boolean} 比較結果（true：一致／false：不一致）
     */
    function isFormDataMatched(redirectCondition) {

        var result = false;
        var comparisonItem = window.formDataLayerAPI.get(redirectCondition.comparisonItemPath);
        var comparisonMethod = redirectCondition.comparisonMethod;
        var comparisonValue = redirectCondition.comparisonValue || '';
        var acquisitionError = redirectCondition.acquisitionError;

        // 比較アイテムが取得できた場合
        if (comparisonItem != undefined) {

            // 取得したアイテムがオブジェクトの場合、JSON化する
            if (comparisonItem instanceof Object){
                comparisonItem = JSON.stringify(comparisonItem);
            }

            // 比較値が一致した場合、リダイレクトする
            if (isMatch(comparisonMethod, comparisonItem, comparisonValue)) {
                result = true;
            }

        // 比較アイテムが取得できなかった場合
        } else {
            if (acquisitionError == 'on') {
                result = true;
            }
        }

        return result;

    }

    /**
     * 条件タイプ＝ユーザータイプの場合の比較を実施し、比較結果を返却する
     *
     * @private
     * @param {Object} リダイレクト条件
     * @return {Boolean} 比較結果（true：一致／false：不一致）
     */
    function isUserTypeMatched(redirectCondition) {

        var result = false;
        var targetUserTypes = redirectCondition.userTypes ? redirectCondition.userTypes.split(', ') : [];

        if (targetUserTypes.indexOf(getUserType()) >= 0) {
            result = true;
        }

        return result;

    }

    /**
     * 条件タイプ＝存在チェック（キャンペーンフォーム用）の場合の比較を実施し、比較結果を返却する
     *
     * @private
     * @param {Object} リダイレクト条件
     * @return 比較結果
     */
    function getRegisteredResult($formRedirect, redirectCondition, index) {

        let result = {};
        result.isMatched = false;
        let checkType = redirectCondition.checkType;
        let isRegisteredList = $formRedirect.data('cmpIsRegisteredList');
        let isRegistered = isRegisteredList[index];
        if (isRegistered == "apiError") {
            result.isApiError = true;
        } else if ((isRegistered === true && checkType == "registered") ||
                (isRegistered === false && checkType == "unRegistered")) {
            result.isMatched = true;
        }

        return result;

    }

    /**
     * 指定された値を比較して一致した場合、リダイレクトを行う
     *
     * @private
     * @param {jQureryElement} フォームリダイレクト
     */
    function formRedirect($auComformRedirect) {

        var isRedirected = false;

        $auComformRedirect.each(function(){

            var $formRedirect = $(this);

            // リダイレクト条件を取得
            var redirectConditions = $formRedirect.data('redirect-conditions');

            if (redirectConditions) {

                var isMatchedBefore = true;
                for (var index in redirectConditions) {
                    var redirectCondition = redirectConditions[index];

                    var isMatched = false;
                    switch (redirectCondition.conditionType) {
                    case "formData":
                        isMatched = isFormDataMatched(redirectCondition);
                        break;
                    case "userType":
                        isMatched = isUserTypeMatched(redirectCondition);
                        break;
                    case "registeredCheck":
                        let result = getRegisteredResult($formRedirect, redirectCondition, index);
                        if (result.isApiError && redirectCondition.apiErrorRedirectUrl) {
                            window.location.href = redirectCondition.apiErrorRedirectUrl;
                            isRedirected = true;
                        } else {
                            isMatched = result.isMatched;
                        }
                        break;
                    }

                    if (isRedirected) {
                        break;
                    } else {
                        if (redirectCondition.combineConditions  == 'on') {
                            isMatchedBefore = isMatchedBefore && isMatched;
                        } else {
                            if (isMatchedBefore && isMatched) {
                                if (redirectCondition.redirectUrl) {
                                    window.location.href = redirectCondition.redirectUrl;
                                    isRedirected = true;
                                }
                                break;
                            }
                            isMatchedBefore = true;
                        }
                    }
                }
            }

        });

        return isRedirected;

    }

    /**
     * リダイレクト実行処理
     */
    function exec() {

        // Author（編集画面）以外の場合に処理を行う
        if (!CommonUtil.isAuthorEditor()) {
            var $auComformRedirect = $('.cmp-au-com-form-redirect');
            if ($auComformRedirect.length > 0) {
                return formRedirect($auComformRedirect);
            }
        }

        return false;

    }

    /**
     * キャンペーンフォームの登録済みチェックを実行するpromiseを返却する
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function registeredCheckPromise ($formRedirect, redirectCondition, index) {
        return new Promise(function(resolve, reject) {

            let key = undefined;
            let formId = redirectCondition.formId;
            let keyItemPath = redirectCondition.keyItemPath;
            let keyType = redirectCondition.keyType;
            let isRegisteredList = $formRedirect.data('cmpIsRegisteredList') || {};

            if (keyType == "userInfo" && keyItemPath) {
                key = window.auDataLayer.get(keyItemPath);
            }
            if (!key && keyType != "systemAuId") {
                isRegisteredList[index] = "apiError";
                $formRedirect.data('cmpIsRegisteredList', isRegisteredList);
                resolve();
            } else {
                window.auForm.registeredCheck(formId, key, keyType)
                .then(function(data){
                    isRegisteredList = $formRedirect.data('cmpIsRegisteredList') || {};
                    if (data) {
                        isRegisteredList[index] = data.isRegistered;
                    } else {
                        isRegisteredList[index] = "apiError";
                    }
                    $formRedirect.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                })
                .fail(function(){
                    isRegisteredList = $formRedirect.data('cmpIsRegisteredList') || {};
                    isRegisteredList[index] = "apiError";
                    $formRedirect.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                });
            }
        });
    }

    function registeredCheckPromises(){
        let $auComformRedirect = $('.cmp-au-com-form-redirect');
        let promises = [];
        $auComformRedirect.each(function(){
            let $formRedirect = $(this);
            // リダイレクト条件を取得
            let redirectConditions = $formRedirect.data('redirect-conditions') || [];
            redirectConditions.forEach((redirectCondition, index) => {
                if (redirectCondition.conditionType == "registeredCheck") {
                    promises.push(registeredCheckPromise($formRedirect, redirectCondition, index));
                }
            });
        })
        return promises;
    }

    window.auForm = window.auForm || {};
    window.auForm.redirect = {};
    window.auForm.redirect.exec = exec;
    window.auForm.redirect.registeredCheckPromises = registeredCheckPromises;

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormOption:ready';

    /**
     * 入力部品を取得する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @return 対象の入力部品
     */
    function getInputParts($formParts) {
        let type = $formParts.data('cmp-type');
        let $inputParts = [];

        if (type == 'checkbox' || type == 'radio') {
            let $optionLabels = $formParts.children('.cmp-au-com-form-options__wrapper').children('.cmp-au-com-form-options__field').children('.cmp-au-com-form-options__item').children('.cmp-au-com-form-options__label');
            $inputParts = $('.cmp-au-com-form__inputparts', $optionLabels);
        } else {
            $inputParts = $('.cmp-au-com-form__inputparts', $formParts);
        }

        return $inputParts;
    }

    /**
     * 対象のエレメントがチェックされているか判定
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     * @return true：チェックあり、false：チェックなし
     */
    function hasChecked($elem) {
        let hasChecked = false;
        $elem.each(function() {
            if($(this).prop('checked')){
                hasChecked = true;
                return;
            }
        });
        return hasChecked;
    }

    /**
     * 対象のエレメントのカスタムバリデーションチェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     */
    function customValidationCheck(condition, $formParts, index) {

        let errorMessage = '';

        let cmpIsRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
        let cmpIsRegistered = cmpIsRegisteredList[index];

        // 存在チェック
        if (condition.conditionType == 'registeredCheck') {
            if ((condition.checkType == "registered" && cmpIsRegistered === true) ||
                    (condition.checkType == "unRegistered" && cmpIsRegistered === false)) {
                errorMessage = condition.errorMessage;
            } else if (cmpIsRegistered == "apiError" && condition.treatAsError == "on") {
                errorMessage = condition.apiErrorMessage;
            }
        } else if (condition.conditionType == 'mailAddressRfcCompliance') {
            let $inputParts = getInputParts($formParts);
            let inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);

            if (window.auForm.isEnableElement($inputParts) && inputInfo && inputInfo.value
                    && condition.regExp && !String(inputInfo.value).match(condition.regExp)) {
                errorMessage = condition.errorMessage;
            }
        }

        return errorMessage;
    }

    /**
     * 対象のエレメントのバリデーションチェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     */
    function validationCheck($formParts) {

        let $elem = getInputParts($formParts);
        let requiredMessage = $formParts.data('cmp-required-message') || "このフィールドは選択必須です";
        let selectedValuesCheck = $formParts.data('cmpSelectedValuesCheck');
        let conditionSettings = $formParts.data('cmpConditionSettingsJson');

        if ($elem.length == 0) {
            return '';
        }

        let elem = $elem[0];
        let errMsg = [];

        // 必須チェック
        if (isRequiredError($formParts)) {
            errMsg.push(requiredMessage);
        } else {

            if (selectedValuesCheck && conditionSettings) {

                conditionSettings.forEach(function(condition, index) {

                    // カスタムバリデーションチェック
                    let errorMessage = customValidationCheck(condition, $formParts, index);

                    if (errorMessage && errMsg.indexOf(errorMessage) < 0) {
                        errMsg.push(errorMessage);
                    }

                });

            }

        }


        // HTMLのカスタムバリデーションにメッセージを設定
        if (errMsg) {
            elem.setCustomValidity(errMsg.join('\n'));
        } else {
            elem.setCustomValidity('');
        }

        return elem.validationMessage;
    }

    /**
     * 対象のエレメントの必須チェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     */
    function isRequiredError($formParts) {

        let $elem = getInputParts($formParts);
        let required = $formParts.data('cmp-required') === true || $formParts.data('cmp-required') === "";
        let isError = false

        if ($elem.length > 0) {

            let type = $elem.attr('type');

            // 必須かつ、表示状態の場合
            if (required && window.auForm.isEnableElement($elem)) {
                // 値が設定されていなければ必須を付ける
                if (type == 'checkbox' || type == 'radio') {
                    // チェックボタン・ラジオボタン
                    isError = !hasChecked($elem);
                } else {
                    // セレクトボックス
                    let value = $('option:selected', $elem).data('value');
                    if (value == null || value === "") {
                        isError = true;
                    }
                }
            }
        }

        return isError;
    }

    /**
     * ソース＝「ローカル」用のチェックボックス／ラジオボタンを追加する
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     * @param {Array} オプション
     */
    function addLocalRadioCheckboxElems($formElem, options) {

        let $optionsField = $formElem.children('.cmp-au-com-form-options__wrapper').children('.cmp-au-com-form-options__field');
        let $fixedValueItems = $optionsField.children('.cmp-au-com-form-options__item');
        let type = $formElem.data('cmp-type');
        let name = $formElem.data('cmp-name');
        let id = $formElem.data('cmp-id');
        let separator = $formElem.data('cmp-separator');
        let disabled = $formElem.data('cmp-disabled') !== undefined;
        let fixedValuesIndex = 0;

        $optionsField.empty();

        // オプションの数だけエレメントを追加する
        options.forEach(function(option, index) {

            let itemId = id + '-' + index
            let $item = undefined;

            if (option.fixedValue) {
                $item = $($fixedValueItems[fixedValuesIndex]);
                fixedValuesIndex += 1;
            } else {

                // アイテム
                $item = $('<div></div>', {
                    'class': 'cmp-au-com-form-options__item '
                });

                // ラベル
                let $label = $('<label></label>', {
                    'class': 'cmp-au-com-form-options__label '
                });

                // 入力部品
                let $input = $('<input></input>', {
                    'class': 'cmp-au-com-form__inputparts cmp-au-com-form-options__input--' + type,
                    'name': name,
                    'value': option.value,
                    'type': type,
                    'data-text': option.text,
                    'data-cmp-separator': separator
                });

                // 見出し
                let $span = $('<span></span>', {
                    'class': 'cmp-au-com-form-options__description',
                    text: option.text
                });

                $label.append($input);
                $label.append($span);
                $item.append($label);

            }

            let $inputLabel = $item.children('.cmp-au-com-form-options__label');
            let $inputParts = $inputLabel.children('.cmp-au-com-form__inputparts');
            let $addField = $item.children('.cmp-au-com-form-options__add-field');

            if (option.selected) {
                $inputLabel.addClass('checked')
                $inputParts.prop('checked', true);
            }

            if (disabled || option.disabled) {
                $inputLabel.addClass('cmp-au-com-form-options__label--disabled')
                $inputParts.prop('disabled', true);
            }

            // ID
            $inputParts.attr('id', itemId);

            // 追加フィールド
            $addField.addClass('cmp-au-com-form-options__add-field__' + itemId);

            $optionsField.append($item);

        });

    }

    /**
     * ソース＝「ローカル」用のセレクトボックスを追加する
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     * @param {Array} オプション
     */
    function addLocalSelectElem($formElem, options) {

        let $optionsField = $('.cmp-au-com-form-options__field', $formElem);
        let $select = $('.cmp-au-com-form-options__input--drop-down', $optionsField);
        let $fixedValueOptions = $('option', $select);
        let id = $formElem.data('cmp-id');
        let fixedValuesIndex = 0;
        let value = '';

        $select.empty();

        // オプションの数だけエレメントを追加する
        options.forEach(function(option, index) {

            let $option = undefined;
            let itemId = id + '-' + index
            if (option.fixedValue) {
                $option = $($fixedValueOptions[fixedValuesIndex]);
                fixedValuesIndex += 1;
                if (($option && $option.get(0).defaultSelected) || option.selected) {
                    value = $option.val();
                }
            } else {
                // オプション
                $option = $('<option></option>', {
                    'value': option.value,
                    'disabled': option.disabled,
                    'data-text': option.text,
                    'data-value': option.value,
                    'label': option.text
                });

                $option.text(option.text);

                if (option.selected) {
                    value = option.value;
                }

            }

            $option.attr('id', itemId);
            $select.append($option);

        });

        $select.val(value);

    }

    /**
     * 各オプションに追加タグの表示非表示を切り替える
     *
     * @private
     * @return {jQueryElement} 追加用のタグ
     */
    function showHideAddField($formParts) {

        let $inputParts = getInputParts($formParts);
        let $addField = $('.cmp-au-com-form-options__add-field', $formParts);
        let type = $inputParts.attr('type');

        $addField.removeClass('cmp-au-com-form-options__add-field--show').addClass('cmp-au-com-form__hide');
        if (type == 'checkbox' || type == 'radio') {
            $inputParts.each(function(){
                if ($(this).prop('checked')) {
                    $('.cmp-au-com-form-options__add-field__' + $(this).attr('id'), $formParts)
                        .addClass('cmp-au-com-form-options__add-field--show')
                        .removeClass('cmp-au-com-form__hide');
                }
            });
        }

    }

    /**
     * 「au契約電話番号一覧」を取得する
     *
     * @private
     */
    function getAuMobileTelsOption(){
        let options = [];
        let dataSourcePath = '/userInfo/biscuitInfo/auCntrctAttribList';
        let auCntrctAttribList = window.formDataLayerAPI.get(dataSourcePath);

        if (auCntrctAttribList) {
            auCntrctAttribList.forEach(function(auCntrctAttrib){
                if (auCntrctAttrib.mobileTel) {
                    let option = {};
                    option.value = auCntrctAttrib.mobileTel;
                    option.text = auCntrctAttrib.mobileTel;
                    options.push(option);
                }
            });
        }

        return options;

    }

    /**
     *
     * 「BBC品目契約コード一覧」を取得する
     *
     * @returns
     */
    function getbbcHnmkCntrctCdsOptions() {
        let options = [];
        let dataSourcePath = '/userInfo/biscuitInfo/bbcCntrctAttribList';
        let bbcCntrctAttribList = window.formDataLayerAPI.get(dataSourcePath);

        if (bbcCntrctAttribList) {
            bbcCntrctAttribList.forEach(function(bbcCntrctAttrib){
                if (bbcCntrctAttrib.bbcHnmkCntrctCd) {
                    let option = {};
                    option.value = bbcCntrctAttrib.bbcHnmkCntrctCd;
                    option.text = bbcCntrctAttrib.bbcHnmkCntrctCd;
                    options.push(option);
                }
            });
        }

        return options;
    }

    /**
     * 「顧客Eメールアドレス」を取得する
     *
     * @private
     */
    function getCsEmailsOption(){
        let options = [];
        let dataSourcePath = '/userInfo/biscuitInfo/csAttrib';
        let csAttrib = window.formDataLayerAPI.get(dataSourcePath);

        if (csAttrib) {

            if (csAttrib.eMail1SendFlg == '1' && csAttrib.eMail1) {
                let eMail1Option = {};
                eMail1Option.value = csAttrib.eMail1;
                eMail1Option.text = csAttrib.eMail1;
                options.push(eMail1Option);
            }

            if (csAttrib.eMail2SendFlg == '1' && csAttrib.eMail2) {
                let eMail2Option = {};
                eMail2Option.value = csAttrib.eMail2;
                eMail2Option.text = csAttrib.eMail2;
                options.push(eMail2Option);
            }

            if (csAttrib.ezMailSendFlg == '1' && csAttrib.ezMail) {
                let ezMailOption = {};
                ezMailOption.value = csAttrib.ezMail;
                ezMailOption.text = csAttrib.ezMail;
                options.push(ezMailOption);
            }

        }

        return options;

    }

    /**
     * 「顧客住所」を取得する
     *
     * @private
     * @param {Object} オプション設定情報
     */
    function getCsAddressOption(){
        let options = [];
        let dataSourcePath = '/userInfo/biscuitDbInfo/csAttrib';
        let csAttrib = window.formDataLayerAPI.get(dataSourcePath);

        if (csAttrib) {

            if (csAttrib.zip && csAttrib.addr) {
                let zip = csAttrib.zip;
                let zip1 = zip.substr(0,3);
                let zip2 = zip.substr(3);
                let addressVal = '〒'+ zip1 + "-" + zip2 + ' ' + csAttrib.addr;
                let option = {};
                option.value = addressVal;
                option.text = addressVal;
                options.push(option);
            }

        }

        return options;

    }

    /**
     * 都道府県一覧を取得する
     *
     * @private
     */
    function getPrefecturesOption(){
        let options = [];
        let PREFECTURES = ['北海道', '青森県', '岩手県', '宮城県', '秋田県',
                                             '山形県', '福島県', '茨城県', '栃木県', '群馬県',
                                             '埼玉県', '千葉県', '東京都', '神奈川県', '山梨県',
                                             '長野県', '新潟県', '富山県', '石川県', '福井県',
                                             '岐阜県', '静岡県', '愛知県', '三重県', '滋賀県',
                                             '京都府', '大阪府', '兵庫県', '奈良県', '和歌山県',
                                             '鳥取県', '島根県', '岡山県', '広島県', '山口県',
                                             '徳島県', '香川県', '愛媛県', '高知県', '福岡県',
                                             '佐賀県', '長崎県', '熊本県', '大分県', '宮崎県',
                                             '鹿児島県', '沖縄県'];

        PREFECTURES.forEach(function(value) {
            let option = {};
            option.value = value;
            option.text = value;
            options.push(option);
        });

        return options;

    }

    /**
     * ソース＝「ローカル」用のオプション情報を取得する
     *
     * @private
     * @param {Array} アイテム
     * @return オプション情報
     */
    function getOptions(items) {

        let options = [];

        items.forEach(function(item) {

            let createdOptions = [];

            switch(item.dataSource) {
                case 'fixedValue' :
                    let fixedValueOption = {};
                    fixedValueOption.fixedValue = true;
                    createdOptions.push(fixedValueOption);
                    break;
                case 'auMobileTels' :
                    createdOptions = getAuMobileTelsOption();
                    break;
                case 'bbcHnmkCntrctCds' :
                    createdOptions = getbbcHnmkCntrctCdsOptions();
                    break;
                case 'csEmails' :
                    createdOptions = getCsEmailsOption();
                    break;
                case 'csAddress' :
                    createdOptions = getCsAddressOption();
                    break;
                case 'formData' :
                    let formDataOption = {};
                    if (item.path) {
                        formDataOption.text = window.formDataLayerAPI.get(item.path);
                        formDataOption.value = item.valueType == 'differentValue' ? window.formDataLayerAPI.get(item.valuePath) : formDataOption.text;
                        if (formDataOption.text) {
                            createdOptions.push(formDataOption)
                        }
                    }
                    break;
                case 'prefectures' :
                    createdOptions = getPrefecturesOption();
                    break;
            }

            if (createdOptions.length > 0) {
                createdOptions[0].selected = item.selected == 'true';
                createdOptions.forEach(function(option) {
                    option.disabled = item.disabled == 'true';
                });
                options = options.concat(createdOptions);
            }

        });

        return options;

    }

    /**
     * ソース＝「ローカル」用のオプションエレメントを作成する
     *
     * @private
     */
    function cleateLocalOptionsElem() {

        let $localOptions = $('.cmp-au-com-form-options[data-cmp-source=local]');

        $localOptions.each(function() {

            let $formElem = $(this);

            let settingMethod = $formElem.data('cmp-setting-method');
            let items = $formElem.data('cmp-items-json');
            let type = $formElem.data('cmp-type');
            let hideOneOption = $formElem.data('cmp-hide-one-option') != undefined;

            // ローカル用のオプションを追加
            if (items.length > 0 || settingMethod == 'auto') {

                // オプション情報を取得
                let options = getOptions(items);

                // オプションが１つのみの場合、「選択肢が一つの場合はフィールドを表示しない」に応じて値を変更
                if (options.length == 1 && hideOneOption) {
                    options[0].selected = true;
                }

                // ラジオボタン・チェックボックスの場合
                if (type == 'radio' || type == 'checkbox' ) {
                    addLocalRadioCheckboxElems($formElem, options);
                // セレクトボックスの場合
                } else {
                    addLocalSelectElem($formElem, options);
                }

                // オプションが１つ以上、または「選択肢が一つの場合はフィールドを表示しない」が false の場合、フィールドを表示する
                if (options.length > 1 || !hideOneOption) {
                    $formElem.removeClass('cmp-au-com-form-options--hide');
                }

                // フォームデータレイヤーから入力部品に値を反映
                window.formDataLayerAPI.setDataLayerToInputValues(getInputParts($formElem));

                // 追加フィールドを切り替え
                showHideAddField($formElem);

            }

        });

    }

    /**
     * キャンペーンフォームの登録済みチェックを実行するpromiseを返却する
     *
     * @private
     * @param {jQueryElement} 対象のフォームテキスト入力部品
     */
    function registeredCheckPromise ($formParts, formId, index) {

        return new Promise(function(resolve, reject) {

            let $inputParts = getInputParts($formParts);
            let inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);
            let isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};

            if (window.auForm.isEnableElement($inputParts)
                    && inputInfo && inputInfo.value) {

                window.auForm.registeredCheck(formId, inputInfo.value)
                .then(function(data){
                    isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
                    if (data) {
                        isRegisteredList[index] = data.isRegistered;
                    } else {
                        isRegisteredList[index] = "apiError";
                    }
                    $formParts.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                })
                .fail(function(){
                    isRegisteredList = $formParts.data('cmpIsRegisteredList') || {};
                    isRegisteredList[index] = "apiError";
                    $formParts.data('cmpIsRegisteredList', isRegisteredList);
                    resolve();
                });

            } else {
                resolve();
            }

        });

    }

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        let $auFormParts = $('.cmp-au-com-form-options');

        // ソース＝ローカルのエレメントを作成
        cleateLocalOptionsElem();

        $auFormParts.each(function() {

            let $formElem = $(this);
            let $inputParts = getInputParts($formElem);
            let $alertParts = $('.cmp-au-com-form__alertparts', $formElem);
            let $alertPartsText = $('.cmp-au-com-form__alertparts__text', $alertParts);
            let name = $formElem.data('cmp-name');
            let formName = window.auForm.getFormName($inputParts);

            if (formName && name && $inputParts.length > 0) {

                $(document).on('focus', '.cmp-au-com-form-options__label', function(){
                    $(this).addClass('focused');
                });

                $(document).on('focusout', '.cmp-au-com-form-options__label', function(){
                    $(this).removeClass('focused');
                });

                $(document).on('focus', '.cmp-au-com-form-options__input--drop-down', function(){
                    $(this).parent().addClass('focused');
                });

                $(document).on('focusout', '.cmp-au-com-form-options__input--drop-down', function(){
                    $(this).parent().removeClass('focused');
                });

                // 入力部品の change イベントをキャッチ
                $inputParts.on('change', function(){

                    $formElem.removeData('cmpIsRegisteredList');
                    let errMsg = validationCheck($formElem);
                    $alertPartsText.text(errMsg);
                    if (errMsg) {
                        $alertParts.css('display', 'inline-flex');
                    } else {
                        $alertParts.hide();
                    }

                    showHideAddField($formElem);

                    let inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);
                    if (inputInfo != null) {
                        window.formDataLayerAPI.set('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name, inputInfo)
                    }
                });

                // 表示の出し分け時のバリデーションチェック
                $(document).on(window.formDataLayerAPI.FORM_SHOW_HIDE_EVENT, function() {
                    validationCheck($formElem);
                });

                // ロード時のバリデーションチェック
                if (!validationCheck($formElem) && !$formElem.hasClass('no-default-value')) {
                    // オプションのデフォルト値をデータレイヤーに設定
                    let partsPath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name
                    let inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);
                    let inputInfoOld = window.formDataLayerAPI.get(partsPath);
                    if (inputInfo && (!inputInfoOld || inputInfoOld && inputInfoOld.resourcePath == inputInfo.resourcePath)) {
                        window.formDataLayerAPI.set(partsPath, inputInfo);
                    }
                }

            }
        });

        if ($auFormParts.length && $auFormParts.closest('.cmp-au-com-card').length) {
            $.fn.matchHeight._update();
        }

        $(document).trigger(READY_EVENT);
        
    });

    window.auForm = window.auForm || {};
    window.auForm.option = {};
    window.auForm.option.validationCheck = validationCheck;
    window.auForm.option.registeredCheckPromise = registeredCheckPromise;
    window.auForm.option.isRequiredError = isRequiredError;
    window.auForm.option.getInputParts = getInputParts;
    window.auForm.option.ready = READY_EVENT;

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormProductOption:ready';
    const RECEIVE_ONLINE_SHOP = '1';
    const RECEIVE_REAL_SHOP = '0';
    const COLOR_SELECTOR = 'input[name="color"]';
    const CAPACITY_SELECTOR = 'input[name="capacity"]';
    const CONTRACT_SELECTOR = 'input[name="contract"]';
    const RECEIVE_SELECTOR = 'input[name="receive"]';
    const DEVICE_SELECTOR = '.cmp-au-com-form-product-options__carousel-cell';
    const FORM_OPTION_WRAPPER_CLASS = '.cmp-au-com-form-product-options__wrapper';
    const SHOP_DOT = '.flickity-page-dots .dot';
    const SELECTED_COLOR_NAME_TEXT = '選択中のカラー：';
    const NEED_AUID_TEXT = 'オンラインショップは、「au ID」によるログインが必要です。<br/>製品は自宅または店舗で受け取れます。';
    const NEED_AUID_ID = 'needAuId';
    const NEED_AUID_SELECTOR = `#${NEED_AUID_ID}`;
    const RECEIVE_ONLINE_SHOP_SELECTOR = 'input[name="receive"][value="1"]';

    let disableObserver = {};
    let initObserver = {};
    let productCarousels = {};
    let productColors = {};
    let productCapacities = {};
    let productButtons = {};
    let locals = {};
    let relatedInputValues = [];
    let selectedCapacity = '';
    let initialized = false;
    let initializedCarousel = false;
    let carouselTimer = false;
    let isCarousel = false;
    let hasCheckedColor = false;
    let hasCheckedCapacity = false;
    let selectedLocals = [];

    /**
     * 数値かどうか判定する。
     *
     * @param {String} 値
     * @return 数値かどうか
     */
    function isNumber(val) {
        let regexp = new RegExp(/^\d+(\.\d+)?$/);
        return regexp.test(val);
    }


    function setSelectedLocals($inputParts) {
        if ($inputParts.length && $inputParts.is(':checked')) {
            const id = $inputParts.closest('.cmp-au-com-form-product-options__field').attr('id');
            selectedLocals[id] = $inputParts.val();
        }
    }

    function switchEnabled($targetInputParts, enabled) {
        if (!$targetInputParts || !$targetInputParts.length) {
          return;
        }
        $targetInputParts.each(function () {
          const $inputParts = $(this);
          const $label = $inputParts.closest('label');
          if (enabled) {
            $inputParts.prop('disabled', false);
            const fieldId = $inputParts.closest('.cmp-au-com-form-product-options__field').attr('id');
            if ($inputParts.val() == selectedLocals[fieldId]) {
              checkAction($inputParts, true);
            }
            $label.removeClass('cmp-au-com-form-product-options__label--disabled');
          } else {
            if ($inputParts.prop('checked')) {
              checkAction($inputParts, false);
            }
            $inputParts.prop('disabled', true);
            $label.addClass('cmp-au-com-form-product-options__label--disabled');
          }
        });
    }

    function contractSelectorCheck() {
        const $inputContracts = $(CONTRACT_SELECTOR);
        if ($inputContracts.length) {
            if (!$inputContracts.filter(':checked').length) {
                checkAction($inputContracts.eq(0), true);
            }
        }
    }

    function receiveSelectorCheck() {
        const $inputReceives = $(RECEIVE_SELECTOR);
        if ($inputReceives.length) {
          const $disabled = $inputReceives.eq(0).closest('label').hasClass('cmp-au-com-form-product-options__label--disabled');
          if ($disabled) {
            return;
          }
          if (!$inputReceives.filter(':checked').length) {
            checkAction($inputReceives.eq(0), true);
          }
        }
    }

    function createNeedAuIdDiv() {
        const $needAuIdDiv = $('<div></div>');
        $needAuIdDiv.attr('id', NEED_AUID_ID);
        $needAuIdDiv.addClass(`padding-t-15 ${NEED_AUID_ID}`);
        $needAuIdDiv.css('font-size', '12px');
        $needAuIdDiv.html(NEED_AUID_TEXT);

        return $needAuIdDiv;
    };

    /**
     * nameを取得する
     *
     * @param {jQueryElement} フォーム入力部品
     * @return name
     */
    function getInputName($elem) {
        let name = undefined;
        if ($elem.length) {
            if ($elem.is('.cmp-au-com-form-product-options')) {
                name = $elem.data('cmp-name');
            } else {
                let $formParts = $elem.closest('.cmp-au-com-form-product-options');
                if ($formParts.length) {
                    name = $formParts.data('cmp-name');
                }
            }
        }
        return name;
    }

    /**
     * 入力部品を取得する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @return 対象の入力部品
     */
    function getInputParts($formParts) {
        let source = $formParts.data('cmpSource');
        let $inputParts = $('.cmp-au-com-form__inputparts', $formParts);

        if ($inputParts.length && source == 'productCarousel') {
            return $inputParts.filter(':not(:disabled)');
        }

        return $inputParts;
    }

    /**
     * 対象のエレメントがチェックされているか判定
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     * @return true：チェックあり、false：チェックなし
     */
    function hasChecked($elem) {
        let hasCheckedValue = false;
        $elem.each(function() {
            if ($(this).prop('checked')) {
                hasCheckedValue = true;
                return false;
            }
        });
        return hasCheckedValue;
    }


    /**
     * 対象のエレメントのバリデーションチェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     */
    function validationCheck($formParts) {

        let $elems = getInputParts($formParts);
        let source = $formParts.data('cmpSource');
        let requiredMessage = $formParts.data('cmp-required-message') || "このフィールドは選択必須です";

        if ($elems.length == 0 || source == 'productCarousel') {
            return '';
        }

        let elem = $elems[0];
        let errMsg = '';

        // 必須チェック
        if (isRequiredError($formParts)) {
            errMsg = requiredMessage;
        }

        // HTMLのカスタムバリデーションにメッセージを設定
        if (errMsg) {
            elem.setCustomValidity(errMsg);
        } else {
            elem.setCustomValidity('');
        }

        return elem.validationMessage;
    }

    /**
     * 対象のエレメントの必須チェックを行う
     *
     * @private
     * @param {jQueryElement} 対象のエレメント
     */
    function isRequiredError($formParts) {
        let isError = false;

        let $elems = getInputParts($formParts);
        let source = $formParts.data('cmpSource');

        if ($elems.length && source != 'productCarousel') {
            let required = $formParts.data('cmp-required') === true || $formParts.data('cmp-required') === "";

            // 必須かつ、表示状態の場合
            if (required && window.auForm.isEnableElement($elems.eq(0))) {
                isError = !hasChecked($elems);
            }
        }

        return isError;
    }


    /**
     * 指定されたキーに指定された値を設定する
     * （値の指定がない場合は、対象のデータを削除する）
     *
     * @param {String} キー
     * @param {String} 値
     */
    function setLocalStorage(key, value) {
        if (!key) {
            return;
        }
        if (value) {
            window.localStorage.setItem(key, value);
        } else {
            window.localStorage.removeItem(key);
        }
    }

    /**
     * 指定されたキーの値を取得する
     *
     * @param {String} キー
     * @return 値
     */
    function getLocalStorage(key) {
        return window.localStorage.getItem(key);
    }

    /**
    *
    * 変更をトリガー
    *
    * @param {jQueryElement} 入力部品
    *
    */
    let triggerChange = function($targetInputParts) {
        $targetInputParts.each(function() {
            $(this).trigger('change', true);
        });
    }

    /**
    *
    * 選択アクション
    *
    * @param {jQueryElement} 入力部品
    * @param {Boolean} チェック
    *
    */
    let checkAction = function($targetInputParts, checked) {
        $targetInputParts.each(function() {
            let $inputParts = $(this);
            $inputParts.prop('checked', checked);
            if (checked || $targetInputParts.attr('name') == 'receive') {
                triggerChange($inputParts);
            }
        });
    }

    /**
    *
    * 先頭要素選択
    *
    * @param {jQueryElement} 入力部品
    * @return {Boolean} チェックを付けたか
    *
    */
    let setFirstItem = function($targetInputParts) {
        let hasCheckedItem = false;
        $targetInputParts.each(function() {
            let $inputParts = $(this);
            if (!$inputParts.prop('disabled')) {
                checkAction($inputParts, true);
                hasCheckedItem = true;
                return false;
            }
        });
        return hasCheckedItem;
    }

    /**
    *
    * 容量設定
    *
    * @param {jQueryElement} 製品容量入力部品
    * @param {String} 製品容量
    *
    */
    let setCapacity = function($productCapacityInputParts, targetValue) {
        $productCapacityInputParts.each(function() {
            let $inputParts = $(this);
            if ($inputParts.prop('disabled')) {
                return true;
            }
            if ($inputParts.data('cmpSelectorValue') != targetValue) {
                return true;
            }
            checkAction($inputParts, true);
            hasCheckedCapacity = true;
        });
        if (!hasCheckedCapacity) {
            hasCheckedCapacity = setFirstItem($productCapacityInputParts);
        }
    }

    /**
    *
    * 容量初期設定
    *
    * @param {jQueryElement} 製品容量入力部品
    * @param {String} 製品容量
    *
    */
    let setInitialCapacity = function($productCapacityInputParts, targetValue) {
        $productCapacityInputParts.each(function() {
            let $inputParts = $(this);
            if ($inputParts.prop('disabled')) {
                return true;
            }
            if (isNumber(targetValue)) {
                if ($inputParts.data('cmpSelectorValue') != targetValue) {
                    return true;
                }
            } else {
                if ($inputParts.val() != targetValue) {
                    return true;
                }
            }
            checkAction($inputParts, true);
            hasCheckedCapacity = true;
            selectedCapacity = $inputParts.data('cmpSelectorValue');
        });
        if (!hasCheckedCapacity) {
            hasCheckedCapacity = setFirstItem($productCapacityInputParts);
        }
    }

    /**
    *
    * 容量設定
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * @param {String} 製品容量
    *
    */
    let setCapacities = function(productCode, productColor, productCapacity) {
        $.each(productCapacities, function() {
            let $productCapacity = $(this);

            if ($productCapacity.data('cmpProductCode') != productCode) {
                return true;
            }

            if (!$productCapacity.data('cmpColorCode') || !productColor
                || String($productCapacity.data('cmpColorCode')).toLowerCase() != String(productColor).toLowerCase()) {
                return true;
            }

            let inputName = getInputName($productCapacity);
            let relatedInputValue = relatedInputValues[inputName];

            let $productCapacityInputParts = $('.cmp-au-com-form__inputparts', $productCapacity);

            let targetValue = null;
            if (!initialized) {
                targetValue = relatedInputValue;
                setInitialCapacity($productCapacityInputParts, targetValue);
            } else {
                targetValue = productCapacity;
                setCapacity($productCapacityInputParts, targetValue);
            }

            $productCapacity.addClass('cmp-au-com-form-product-options__field--loaded');
        });
    }

    /**
    *
    * カラー画像設定
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    *
    */
    let setColorImages = function(productCode, productColor) {
        $.each(productCarousels, function() {
            let $productCarousel = $(this);
            let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
            let $carouselCells = $('.cmp-au-com-form-product-options__carousel-cell', $carousel);
            let $carouselCell = $carouselCells.filter(function() {
                return $(this).data('cmpProductCode') == productCode;
            });
            if (!$carouselCell.length) {
                return true;
            }

            $carouselCell.data('cmpColorCode', productColor);

            let $productImages = $carouselCell.children('.cmp-au-com-form-product-options__carousel-image');
            if (!$productImages.length) {
                return true;
            }

            let $productImage = $productImages.filter(function() {
                return $(this).data('cmpColorCode') && productColor
                    && String($(this).data('cmpColorCode')).toLowerCase() == String(productColor).toLowerCase();
            });
            if (!$productImage.length) {
                return true;
            }

            let $imageElem = $productImage.children('img');
            if ($imageElem.hasClass('lazyloaded')) {
                $productImages.hide();
                $productImage.show();
            } else {
                $imageElem.on('img:load', function() {
                    $productImages.hide();
                    $productImage.show();
                });
                responsiveImage.lazyload($imageElem, true);
            }
        });
        $.each(productButtons, function() {
            let $productButton = $(this);
            let $productButtonItems = $productButton.children('.cmp-au-com-form-product-options__item');
            $productButtonItems.each(function() {
                let $productButtonItem = $(this);
                if ($productButtonItem.data('cmpProductCode') == productCode) {
                    $productButtonItem.data('cmpColorCode', productColor);
                }
            });
        });
    }

    /**
    *
    * 選択中のカラー名設定
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    *
    */
    let setSelectedColorName = function(productCode, productColor) {
        $.each(productColors, function() {
            let $productColor = $(this);

            if ($productColor.data('cmpProductCode') != productCode) {
                return true;
            }

            let inputName = getInputName($productColor);
            let relatedInputValue = relatedInputValues[inputName];

            let targetValue = null;
            let $selectedProductColor;
            if (!initialized) {
                targetValue = relatedInputValue;
                if (targetValue) {
                    $selectedProductColor = $productColor.children('.cmp-au-com-form-product-options__item').filter(function() {
                        return $(this).find('.cmp-au-com-form__inputparts')[0].value == targetValue;
                    });
                } else {
                    $selectedProductColor = $productColor.children('.cmp-au-com-form-product-options__item')[0];
                }
            } else {
                $selectedProductColor = $productColor.children('.cmp-au-com-form-product-options__item').filter(function() {
                    return $(this).find('.cmp-au-com-form__inputparts')[0].value == productColor;
                });
            }

            let $productColorDescription = $('.cmp-au-com-form-product-options__description', $selectedProductColor);
            let targetColorName = $productColorDescription.text();

            let wrapper = $productColor.closest('.cmp-au-com-form-product-options__wrapper');
            let selectedColorName = wrapper.find('.cmp-au-com-form-product-options__selected-color-name');
            selectedColorName.text(SELECTED_COLOR_NAME_TEXT + targetColorName);
        });
    }

    /**
    *
    * カラー設定
    *
    * @param {jQueryElement} 製品カラー入力部品
    * @param {String} 製品カラー
    *
    */
    let setColor = function($productColorInputParts, targetValue) {
        $productColorInputParts.each(function() {
            let $inputParts = $(this);
            if ($inputParts.prop('disabled')) {
                return true;
            }
            if (!$inputParts.val() || !targetValue || String($inputParts.val()).toLowerCase() != String(targetValue).toLowerCase()) {
                return true;
            }
            checkAction($inputParts, true);
            hasCheckedColor = true;
        });
        if (!hasCheckedColor) {
            hasCheckedColor = setFirstItem($productColorInputParts);
        }
    }

    /**
    *
    * カラー設定
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    *
    */
    let setColors = function(productCode, productColor) {
        $.each(productColors, function() {
            let $productColor = $(this);

            if ($productColor.data('cmpProductCode') != productCode) {
                return true;
            }

            let inputName = getInputName($productColor);
            let relatedInputValue = relatedInputValues[inputName];

            let $productColorInputParts = $('.cmp-au-com-form__inputparts', $productColor);

            let targetValue = null;
            if (!initialized) {
                targetValue = relatedInputValue;
                setColor($productColorInputParts, targetValue);
            } else {
                targetValue = productColor;
                setColor($productColorInputParts, targetValue);
            }

            $productColor.addClass('cmp-au-com-form-product-options__field--loaded');
        });
    }

    /**
    *
    * カラー選択クリア
    * @return クリア前の入力部品
    *
    */
    let clearColors = function() {
        if (!Object.keys(productColors).length) {
            return null;
        }
        let values = Object.keys(productColors).map(function(key) {
            return productColors[key];
        });
        if (values.length) {
            let $productColors = $(values);
            $productColors.filter('.cmp-au-com-form-product-options__field--loaded').removeClass('cmp-au-com-form-product-options__field--loaded');
            let $productColorsLabels = $productColors.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
            let $productColorsInputParts = $productColorsLabels.children('.cmp-au-com-form__inputparts');
            let $checkedInputParts = $productColorsInputParts.filter(':checked');
            if ($checkedInputParts.length) {
                checkAction($checkedInputParts, false);
                hasCheckedColor = false;
                return $checkedInputParts;
            }
        }
        return null;
    }

    /**
    *
    * 容量選択クリア
    * @return クリア前の入力部品
    *
    */
    let clearCapacities = function() {
        if (!Object.keys(productCapacities).length) {
            return null;
        }
        let values = Object.keys(productCapacities).map(function(key) {
            return productCapacities[key];
        });
        if (values.length) {
            let $productCapacities = $(values);
            $productCapacities.filter('.cmp-au-com-form-product-options__field--loaded').removeClass('cmp-au-com-form-product-options__field--loaded');
            let $productCapacitiesLabels = $productCapacities.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
            let $productCapacitiesInputParts = $productCapacitiesLabels.children('.cmp-au-com-form__inputparts');
            let $checkedInputParts = $productCapacitiesInputParts.filter(':checked');
            if ($checkedInputParts.length) {
                checkAction($checkedInputParts, false);
                hasCheckedCapacity = false;
                return $checkedInputParts;
            }
        }
        return null;
    }

    /**
    *
    * 容量変更
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * @param {String} 製品容量
    * @param {String} OLS製品コード
    *
    */
    let changeCapacities = function(productCode, productColor, productCapacity, olsProductCode) {
        console.log({
            productCode: productCode,
            productColor: productColor,
            productCapacity: productCapacity,
            olsProductCode: olsProductCode
        });
    }

    /**
    *
    * サムネイルコンテンツを変更
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * 
    */
    let changeThumbnailContents = function(productCode, productColor) {
        changeThumbnailCarouselPart(productCode, productColor);
        changeThumbnailThumbnailPart(productCode, productColor);
    }

    /**
    *
    * 製品によるサムネイルコンテンツのカルーセル部の表示制御
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * 
    */
    let changeThumbnailCarouselPart = function(productCode, productColor) {
        // 製品によるカルーセル部の表示制御
        let $carouselProducts = $('.cmp-au-com-form-product-options__thumbnail-carousel-product');
        if ($carouselProducts.length) {
            $carouselProducts.each(function() {
                let carouselProductCode = $(this).data('cmpProductCode');
                $(this).removeClass('js-thumbnail-carousel-product-hide');
                $(this).removeClass('js-thumbnail-carousel-product-show');
                if (carouselProductCode == productCode) {
                    $(this).addClass('js-thumbnail-carousel-product-show');
                } else {
                   $(this).addClass('js-thumbnail-carousel-product-hide');
                }

                // カラーによるカルーセル部の表示制御
                let $carouselColors = $(this).children('.cmp-au-com-form-product-options__thumbnail-carousel-color');
                if($carouselColors.length) {
                    $carouselColors.each(function() {
                        $(this).removeClass('js-thumbnail-carousel-color-show');
                    });
                    $carouselColors.each(function() {
                        let carouselColorCode = $(this).data('cmpColorCode');
                        if (carouselColorCode == productColor) {
                            $(this).addClass('js-thumbnail-carousel-color-show');
                            $(this).slick('setPosition');
                        }
                    });
                }
            });
        }
    }

    /**
    *
    * 製品によるサムネイルコンテンツのサムネイル部の表示制御
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * 
    */
    let changeThumbnailThumbnailPart = function(productCode, productColor) {
        let $thumbnailProducts = $('.cmp-au-com-form-product-options__thumbnail-thumbnail-product');
        if ($thumbnailProducts.length) {
            $thumbnailProducts.each(function() {
                let thumbnailProductCode = $(this).data('cmpProductCode');
                $(this).removeClass('js-thumbnail-thumbnail-product-hide');
                $(this).removeClass('js-thumbnail-thumbnail-product-show');
                if (thumbnailProductCode == productCode) {
                    $(this).addClass('js-thumbnail-thumbnail-product-show');
                } else {
                   $(this).addClass('js-thumbnail-thumbnail-product-hide');
                }

                let $thumbnailColors = $(this).children('.cmp-au-com-form-product-options__thumbnail-thumbnail-color');
                if($thumbnailColors.length) {
                    $thumbnailColors.each(function() {
                        // 各サムネイルにindexのdata属性を付与
                        $(this).children('.cmp-au-com-form-product-options__thumbnail-thumbnail-item').each(function() {
                            let index = $(this).index();
                            $(this).attr('data-slick-index', index);
                        });

                        // カラーによるサムネイル部の表示制御
                        let thumbnailColorCode = $(this).data('cmpColorCode');
                        $(this).removeClass('js-thumbnail-thumbnail-color-hide');
                        $(this).removeClass('js-thumbnail-thumbnail-color-show');
                        if (thumbnailColorCode == productColor) {
                            $(this).addClass('js-thumbnail-thumbnail-color-show');
                        } else {
                           $(this).addClass('js-thumbnail-thumbnail-color-hide');
                        }
                    });
                }
            });
        }
    }

    /**
    *
    * カラー変更
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    * @param {String} 製品画像ソース
    *
    */
    let changeColors = function(productCode, productColor, productCapacity) {
        let $clearedCapacity = clearCapacities();
        setColorImages(productCode, productColor);
        setSelectedColorName(productCode, productColor);
        setCapacities(productCode, productColor, productCapacity);
        if (!hasCheckedCapacity && $clearedCapacity && $clearedCapacity.length) {
            triggerChange($clearedCapacity);
        }
    }

    /**
    *
    * 製品変更
    *
    * @param {String} 製品コード
    * @param {String} 製品カラー
    *
    */
    let changeProducts = function(productCode, productColor) {
        let $clearedCapacity = clearCapacities();
        let $clearedColor = clearColors();
        if (Object.keys(productColors).length) {
            setColors(productCode, productColor);
        } else {
            setCapacities(productCode, productColor, selectedCapacity);
        }
        if (!hasCheckedCapacity && $clearedCapacity && $clearedCapacity.length) {
            triggerChange($clearedCapacity);
        }
        if (!hasCheckedColor && $clearedColor && $clearedColor.length) {
            triggerChange($clearedColor);
        }
        if (Object.keys(productColors).length) {
            setColors(productCode, productColor);
        }
    }

    /**
    *
    * カルーセル変更
    *
    * @param {JQueryElement} 選択セル
    */
    let changeCarousel = function($selectedCell) {
        let $carousel = $selectedCell.closest('.cmp-au-com-form-product-options__carousel');
        let $formElem = $carousel.closest('.cmp-au-com-form-product-options');
        let $inputParts = $('.cmp-au-com-form__inputparts', $selectedCell);

        $('.cmp-au-com-form__inputparts', $carousel).prop('disabled', true);
        $inputParts.prop('disabled', false);

        let inputInfo = getInputInfo($inputParts);
        let formName = window.auForm.getFormName($inputParts);
        let name = $formElem.data('cmp-name');
        if (inputInfo && formName && name) {
            let partsPath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name;
            let localStorageKey = formName + '_' + name;
            window.formDataLayerAPI.set(partsPath, inputInfo);
            setLocalStorage(localStorageKey, inputInfo.value);
        }

        let productCode = $selectedCell.data('cmpProductCode');
        let productColor = $selectedCell.data('cmpColorCode');

        changeProducts(productCode, productColor);
    }

    /**
     * 指定されたフォーム入力部品の値に追加情報を付与して規定のオブジェクトにして返却する
     *
     * @param {JQueryElement} フォーム入力部品
     * @return {Object} 入力情報（追加情報付）
     */
    let getInputInfo = function($inputParts) {
        let inputInfo = window.formDataLayerAPI.getInputInfo($inputParts);

        // statusInfo
        let statusInfo = {};
        statusInfo.olsStatusCode = $inputParts.data('cmpOlsStatusCode');
        statusInfo.stockInOnlineShop = $inputParts.data('cmpStockInOnlineShop') !== undefined ? true: false;
        statusInfo.stockInRealShop = $inputParts.data('cmpStockInRealShop') !== undefined ? true: false;
        statusInfo.stockOnUnlockedSim = $inputParts.data('cmpStockOnUnlockedSim');
        statusInfo.webPreorderAvailable = $inputParts.data('cmpWebPreorderAvailable');
        inputInfo.statusInfo = statusInfo;

        return inputInfo;
    }

    /**
    *
    * オプション変更
    *
    * @param {JQueryElement} 選択セル
    */
    let changeOption = function($inputParts) {
        let $formElem = $inputParts.closest('.cmp-au-com-form-product-options');
        let $alertParts = $('.cmp-au-com-form__alertparts', $formElem);
        let $alertPartsText = $('.cmp-au-com-form__alertparts__text', $alertParts);

        let errMsg = validationCheck($formElem);
        $alertPartsText.text(errMsg);
        if (errMsg) {
            $alertParts.css('display', 'inline-flex');
        } else {
            $alertParts.hide();
        }

        let inputInfo = getInputInfo($inputParts);
        let formName = window.auForm.getFormName($inputParts);
        let name = $formElem.data('cmp-name');
        if (inputInfo && formName && name) {
            let partsPath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name;
            let localStorageKey = formName + '_' + name;
            window.formDataLayerAPI.set(partsPath, inputInfo);
            setLocalStorage(localStorageKey, inputInfo.value);
        }
    }

    /**
    *
    * 容量初期化
    *
    * @param {JQueryElement} 容量フィールド
    *
    */
    let initializeCapacities = function($productCapacityField) {
        productCapacities[$productCapacityField.attr('id')] = $productCapacityField[0];

        let $productCapacityLabels = $productCapacityField.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
        let $productCapacityInputParts = $productCapacityLabels.children('.cmp-au-com-form__inputparts');

        $productCapacityInputParts.on('change', function(event, isAuto) {
            let $inputParts = $(this);
            changeOption($inputParts);
            if ($inputParts.is(':checked')) {
                let productCode = $inputParts.closest('fieldset').data('cmpProductCode');
                let productColor = $inputParts.closest('fieldset').data('cmpColorCode');
                let productCapacity = $inputParts.data('cmpSelectorValue');
                if (!isAuto) {
                    selectedCapacity = productCapacity;
                }
                let olsProductCode = $inputParts.val();
                changeCapacities(productCode, productColor, productCapacity, olsProductCode);
                window.productDataLayerAPI.addEventTrigger(window.productDataLayerAPI.SELECT_EVENT_NAME, { olsProductCode: olsProductCode });
            } else {
                window.productDataLayerAPI.addEventTrigger(window.productDataLayerAPI.SELECT_EVENT_NAME);
            }
        });

        initializeDisabled($productCapacityInputParts);
        initializeHideCapacities($productCapacityInputParts);
    }

    /**
    *
    * カラー初期化
    *
    * @param {JQueryElement} カラーフィールド
    *
    */
    let initializeColors = function($productColorField) {
        productColors[$productColorField.attr('id')] = $productColorField[0];

        let $productColorLabels = $productColorField.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
        let $productColorInputParts = $productColorLabels.children('.cmp-au-com-form__inputparts');

        $productColorInputParts.on('change', function() {
            let $inputParts = $(this);
            changeOption($inputParts);
            if ($inputParts.is(':checked')) {
                let productCode = $inputParts.closest('fieldset').data('cmpProductCode');
                let productColor = $inputParts.val();
                let productCapacity = selectedCapacity;
                changeColors(productCode, productColor, productCapacity);
                changeThumbnailContents(productCode, productColor);
            }
        });

        initializeDisabled($productColorInputParts);
        initializeHideColors($productColorInputParts);
    }

    /**
    *
    * カルーセル有効化解除
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let unbindEnabledCarousel = function($productCarousel) {
        initializedCarousel = false;
        $productCarousel.filter('.cmp-au-com-form-product-options__products--loaded').removeClass('cmp-au-com-form-product-options__products--loaded');

        let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
        if ($carousel.is('.flickity-enabled')) {
            $carousel.flickity('destroy');
        }
        $('.cmp-au-com-form-product-options__frame-prev, .cmp-au-com-form-product-options__arrow-prev', $productCarousel).off();
        $('.cmp-au-com-form-product-options__frame-next, .cmp-au-com-form-product-options__arrow-next', $productCarousel).off();

        $productCarousel.children('.cmp-au-com-form-product-options__selected-frame').filter('.is-selected').removeClass('is-selected');
    }

    /**
    *
    * カルーセル無効化解除
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let unbindDisabledCarousel = function($productCarousel) {
        initializedCarousel = false;
        $productCarousel.filter('.cmp-au-com-form-product-options__products--loaded').removeClass('cmp-au-com-form-product-options__products--loaded');

        let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
        let $carouselCells = $('.cmp-au-com-form-product-options__carousel-cell', $carousel);

        $carouselCells.filter('.is-selected').removeClass('is-selected');
        $carouselCells.off();

        $productCarousel.filter('.cmp-au-com-form-product-options__products--carousel-disabled').removeClass('cmp-au-com-form-product-options__products--carousel-disabled');
    }

    /**
    *
    * カルーセル有効化
    *
    * @param {JQueryElement} 製品カルーセル
    * @param {int} 初期インデックス
    *
    */
    let enableCarousel = function($productCarousel, initialIndex) {
        let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
        $carousel.flickity({
            prevNextButtons: false,
            pageDots: true,
            resize: true,
            wrapAround: true,
            freeScroll: false,
            initialIndex: initialIndex,
            on: {
                ready: function() {
                    let $selectedCell = $(this.selectedElement);
                    let $flickityCarousel = this.$element.closest('.cmp-au-com-form-product-options__products');

                    $('.cmp-au-com-form-product-options__frame-prev, .cmp-au-com-form-product-options__arrow-prev', $flickityCarousel).on('click', function() {
                        $flickityCarousel.children('.cmp-au-com-form-product-options__carousel').flickity('previous');
                    });
                    $('.cmp-au-com-form-product-options__frame-next, .cmp-au-com-form-product-options__arrow-next', $flickityCarousel).on('click', function() {
                        $flickityCarousel.children('.cmp-au-com-form-product-options__carousel').flickity('next');
                    });

                    $flickityCarousel.children('.cmp-au-com-form-product-options__selected-frame').addClass('is-selected');

                    if (!initialized) {
                        changeCarousel($selectedCell);
                    }

                    $flickityCarousel.addClass('cmp-au-com-form-product-options__products--loaded');
                    initializedCarousel = true;
                    isCarousel = true;
                },
                change: function() {
                    if (initializedCarousel) {
                        let $selectedCell = $(this.selectedElement);

                        changeCarousel($selectedCell);
                    }
                }
            }
        });
    }

    /**
    *
    * カルーセル無効化
    *
    * @param {JQueryElement} 製品カルーセル
    * @param {int} 初期インデックス
    *
    */
    let disableCarousel = function($productCarousel, initialIndex) {
        $productCarousel.addClass('cmp-au-com-form-product-options__products--carousel-disabled');

        let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
        let $carouselCells = $('.cmp-au-com-form-product-options__carousel-cell', $carousel);
        $carouselCells.on('click', function() {
            let $selectedCell = $(this);
            $('.cmp-au-com-form-product-options__carousel-cell', $selectedCell.parent()).filter('.is-selected').removeClass('is-selected');
            $selectedCell.addClass('is-selected');
            changeCarousel($selectedCell);
        });

        let $initialCell = $carouselCells.eq(initialIndex);
        $initialCell.addClass('is-selected');

        if (!initialized) {
            changeCarousel($initialCell);
        }

        $productCarousel.addClass('cmp-au-com-form-product-options__products--loaded');
        initializedCarousel = true;
        isCarousel = false;
    }

    /**
    *
    * 製品カルーセルリサイズ
    *
    */
    let resizeCarousels = function() {
        $.each(productCarousels, function() {
            let $productCarousel = $(this);
            let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
            let $carouselCells = $('.cmp-au-com-form-product-options__carousel-cell', $carousel);
            let $inputParts = $('.cmp-au-com-form__inputparts', $carousel);
            let initialIndex = $inputParts.index($inputParts.filter(':not(:disabled)'));
            if (isCarousel) {
                unbindEnabledCarousel($productCarousel);
            } else {
                unbindDisabledCarousel($productCarousel);
            }
            if ($carouselCells.length > 3 || ($carouselCells.length == 3 && CommonUtil.isSp())) {
                enableCarousel($productCarousel, initialIndex);
            } else {
                disableCarousel($productCarousel, initialIndex);
            }
        });
    }

    /**
    *
    * 製品カルーセル初期化
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let initializeProductCarousels = function($productCarousel) {
        productCarousels[$productCarousel.attr('id')] = $productCarousel[0];

        let inputName = getInputName($productCarousel);
        let relatedInputValue = relatedInputValues[inputName];

        let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
        let $carouselCells = $('.cmp-au-com-form-product-options__carousel-cell', $carousel);
        let initialIndex = 0
        $carouselCells.each(function(index) {
            let $carouselCell = $(this);
            let productCode = $carouselCell.data('cmpProductCode');
            if (relatedInputValue && relatedInputValue == productCode) {
                initialIndex = index;
            }

            let $productImages = $carouselCell.children('.cmp-au-com-form-product-options__carousel-image');
            if (!$productImages.length) {
                return true;
            }
            let $productImage = $productImages.eq(0);
            let $imageElem = $productImage.children('img');
            responsiveImage.lazyload($imageElem, true);
            $productImage.show();
        });

        if ($carouselCells.length > 3 || ($carouselCells.length == 3 && CommonUtil.isSp())) {
            enableCarousel($productCarousel, initialIndex);
        } else {
            disableCarousel($productCarousel, initialIndex);
        }
    }

    /**
    *
    * 製品サムネイル初期化
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let initializeProductThumbnails = function($productThumbnail) {
        prepareLoadProductThumbnails($productThumbnail);
        initializeProductThumbnailSlicks($productThumbnail);
        AddProductThumbnailEvents($productThumbnail);
    }

    /**
    *
    * 製品サムネイルLazyLoad処理
    *
    * @param {JQueryElement} 製品サムネイル
    *
    */
    let prepareLoadProductThumbnails = function($productThumbnail) {
        let $imgs = $('img.lazyload', $productThumbnail);
        if ($imgs.length) {
            window.responsiveImage.prepareLoadAll($imgs, true);
        }
    }

    /**
    *
    * 製品サムネイルのslick初期化
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let initializeProductThumbnailSlicks = function($productThumbnail) {
        let $carouselColors = $productThumbnail.children('.cmp-au-com-form-product-options__thumbnail-carousel-product')
                .children('.cmp-au-com-form-product-options__thumbnail-carousel-color');
        if($carouselColors.length) {
            $carouselColors.each(function() {
                // スライダーが属するカルーセル部の製品コード、カラーに紐付くスライド枚数表示を取得
                let targetColorCode = $(this).data('cmpColorCode');
                let $targetCarouselProduct = $(this).parent('.cmp-au-com-form-product-options__thumbnail-carousel-product');
                let targetProductCode = $targetCarouselProduct.data('cmpProductCode');
                let $targetThumbnailProduct = $targetCarouselProduct.parent('.cmp-au-com-form-product-options__thumbnail')
                        .children('.cmp-au-com-form-product-options__thumbnail-thumbnail-product[data-cmp-product-code="'
                        + targetProductCode + '"]');
                let $targetThumbnailColor = $targetThumbnailProduct
                        .children('.cmp-au-com-form-product-options__thumbnail-thumbnail-color[data-cmp-color-code="'
                        + targetColorCode + '"]');
                let $slidecnt = $targetThumbnailColor.find('.slide-count');

                let $firstSlideItem = $targetThumbnailColor.children('.cmp-au-com-form-product-options__thumbnail-thumbnail-item').first();
                $firstSlideItem.addClass('active');

                // スライダーが初期化された時、再初期化、切り替え後に発火
                 $(this).on('init reInit afterChange', function (event, slick) {
                     $slidecnt.text((slick.currentSlide + 1) + '/' + slick.slideCount);
                });

                // スライダーが切り替え後に発火
                $(this).on('afterChange', function (event, slick, currentSlide) {
                    let targetColorCode = $(this).data('cmpColorCode');
                    let $targetCarouselProduct = $(this).parent('.cmp-au-com-form-product-options__thumbnail-carousel-product');
                    let targetProductCode = $targetCarouselProduct.data('cmpProductCode');
                    let $targetThumbnailProduct = $targetCarouselProduct.parent('.cmp-au-com-form-product-options__thumbnail')
                            .children('.cmp-au-com-form-product-options__thumbnail-thumbnail-product[data-cmp-product-code="'
                            + targetProductCode + '"]');
                    let $targetThumbnailColor = $targetThumbnailProduct
                            .children('.cmp-au-com-form-product-options__thumbnail-thumbnail-color[data-cmp-color-code="'
                            + targetColorCode + '"]');
    
                    $targetThumbnailColor.children('.cmp-au-com-form-product-options__thumbnail-thumbnail-item').each(function() {
                        $(this).removeClass('active');
                        let slickIndex = $(this).data('slickIndex');
                        if (slickIndex == currentSlide) {
                            $(this).addClass('active');
                        }
                    });
                });

                // スライド切り替え前に発火
                $(this).on("beforeChange", function (event, slick, currentSlide, nextSlide) {
                    $slidecnt.text((nextSlide + 1) + '/' + slick.slideCount);
                });

                // sliderのslick初期化
                $(this).slick({
                    infinite: true,
                    autoplay: false,
                    speed: 300,
                    fade: false,
                    cssEase: 'ease'
                });

                // タブ切替時
                $('.cmp-au-com-tabs__tablist .cmp-au-com-tab-label').click(function () {
                    setTimeout(function(){
                        let $carouselColorsSlick = $('.cmp-au-com-form-product-options__thumbnail .cmp-au-com-form-product-options__thumbnail-carousel-color');
                        if($carouselColorsSlick.length) {
                            $carouselColorsSlick.each(function() {
                                // slickのサイズや位置をリセット
                                $(this).slick('setPosition');
                            });
                        }
                    },30);
                });
            });
        }
    }

    /**
    *
    * 製品サムネイルのイベント登録
    *
    * @param {JQueryElement} 製品カルーセル
    *
    */
    let AddProductThumbnailEvents = function($productThumbnail) {
        // 各サムネイルクリック時処理
        let $productImgs = $productThumbnail.find('.cmp-au-com-form-product-options__thumbnail-thumbnail-item');
        $productImgs.on('click', function() {
            // クリックしたサムネイルが属するサムネイル部の製品コード、カラーに紐付くカルーセルを取得
            let $targetThumbnailColor = $(this).parent('.cmp-au-com-form-product-options__thumbnail-thumbnail-color');
            let targetColorCode = $targetThumbnailColor.data('cmpColorCode');
            let $targetThumbnailProduct = $targetThumbnailColor.parent('.cmp-au-com-form-product-options__thumbnail-thumbnail-product');
            let targetProductCode = $targetThumbnailProduct.data('cmpProductCode');
            let $targetCarouselProduct = $targetThumbnailProduct.parent('.cmp-au-com-form-product-options__thumbnail')
                    .children('.cmp-au-com-form-product-options__thumbnail-carousel-product[data-cmp-product-code="'
                     + targetProductCode + '"]');
            let $targetSlides = $targetCarouselProduct
                    .children('.cmp-au-com-form-product-options__thumbnail-carousel-color[data-cmp-color-code="'
                    + targetColorCode + '"]');

            $targetThumbnailColor.children('.cmp-au-com-form-product-options__thumbnail-thumbnail-item').each(function() {
                $(this).removeClass('active');
            });
            $(this).addClass('active');

            let index = $(this).attr('data-slick-index');
            $targetSlides.slick('slickGoTo', index, false);
        });

        $('.thumbnail-modal-openBtn').on('click', function () {
            let modalTarget = $(this).attr('data-target'),
                src = $(modalTarget).find('iframe').attr('src'),
                $modalDialog = $('.cmp-au-com-form-product-options__thumbnail-modal-dialog', $(modalTarget)),
                $modalBody = $('.cmp-au-com-form-product-options__thumbnail-modal-body', $(modalTarget));

            $(modalTarget).on('hide.bs.modal', function () {
                //close時の動画対応
                $(modalTarget).find('iframe').attr('src', src);
            });

            $(modalTarget).on('shown.bs.modal', function () {
                //表示時の中央揃え対応
                let $imgs = $('img.lazyload', $modalBody);
                let modalHeight = $modalBody.outerHeight();
                $modalDialog.height(modalHeight);
                if ($imgs.length) {
                    window.responsiveImage.prepareLoadAll($imgs, true);
                    $imgs.on('img:load', function() {
                        if (responsiveImage.confirmLoadAll($imgs)) {
                            modalHeight = $modalBody.outerHeight();
                            $modalDialog.height(modalHeight);
                            adjustMargin();
                        }
                    })
                } else {
                    adjustMargin();
                }
            });

        });
    }

    function adjustMargin() {
        let $modalDialog = $('.cmp-au-com-form-product-options__thumbnail-modalElem.in .cmp-au-com-form-product-options__thumbnail-modal-dialog');
        if ($modalDialog.length) {
            let minMarginTop = 50;
            if ($modalDialog.parents().hasClass('cmp-au-com-modal__color__transparent')) {
                minMarginTop = 80;
            }
            if ($modalDialog.height() + (minMarginTop * 2) > $(window).height()) {
                $modalDialog.css('margin-top', minMarginTop + 'px');
            } else {
                $modalDialog.css('margin-top', '');
            }
        }
    }

    let modalTimer = false;
    $(window).on('resize', function(){
        if (modalTimer !== false) {
            clearTimeout(modalTimer);
        }
        modalTimer = setTimeout(function(){
            adjustMargin();
        }, 500);
    });


    /**
    *
    * 無効状態初期化
    *
    * @param {jQueryElement} 入力部品
    *
    */
    let initializeDisabled = function($targetInputParts) {
        let parentDisabled = ($targetInputParts.closest('.cmp-au-com-form-product-options').data('cmpDisabled') !== undefined);
        $targetInputParts.each(function() {
            let $inputParts = $(this);
            let disabled = $inputParts.prop('disabled');
            if (!disabled && parentDisabled) {
                let $targetLabel = $inputParts.closest('.cmp-au-com-form-product-options__label');
                $inputParts.prop('disabled', true);
                $targetLabel.addClass('cmp-au-com-form-product-options__label--disabled');
            }
        });
    }

    /**
    *
    * 容量非表示初期化
    *
    * @param {jQueryElement} 入力部品
    *
    */
    let initializeHideCapacities = function($targetInputParts) {
        $targetInputParts.each(function() {
            // OLS商品コードが未設定の場合に容量ボタンを非表示にする
            if (!$(this).attr('value')) {
                let $targetItem = $(this).closest('.cmp-au-com-form-product-options__item');
                if ($targetItem) {
                    $targetItem.addClass('cmp-au-com-form-product-options__item--hide');
                }
            }
        });
    }

    /**
    *
    * カラー非表示初期化
    *
    * @param {jQueryElement} 入力部品
    *
    */
    let initializeHideColors = function($targetInputParts) {
        $targetInputParts.each(function() {
            let targetInputPart = this;
            let colorCode = targetInputPart.value;
            if (!colorCode) {
                return true;
            }
            let $productColorField = $(targetInputPart).closest('.cmp-au-com-form-product-options__field');
            let productCode = $productColorField.data('cmpProductCode');

            $.each(productCapacities, function() {
                let $productCapacity = $(this);
                if ($productCapacity.data('cmpProductCode') != productCode) {
                    return true;
                }
                if (!$productCapacity.data('cmpColorCode')
                    || String($productCapacity.data('cmpColorCode')).toLowerCase() != String(colorCode).toLowerCase()) {
                    return true;
                }

                hideColor($productCapacity, targetInputPart);
            });
        });
    }

    /**
    *
    * カラー非表示
    *
    * @param {jQueryElement} 製品容量
    * @param {jQueryElement} 入力部品
    *
    */
    let hideColor = function($productCapacity, targetInputPart) {
        // カラーに紐付く容量がすべて取り扱いなしの場合にカラーボタンを非表示にする
        if ($productCapacity.children('.cmp-au-com-form-product-options__item.cmp-au-com-form-product-options__item--hide').length
                == $productCapacity.data('cmpOptionsSize')) {
            let $productColorItem = $(targetInputPart).closest('.cmp-au-com-form-product-options__item');
            if ($productColorItem) {
                $productColorItem.addClass('cmp-au-com-form-product-options__item--hide');
            }
        }
    }

    /**
    *
    * 設定値初期化
    *
    * @param {jQueryElement} 入力部品
    * @param {String} 設定値
    *
    */
    let initializeTargetValues = function($targetInputParts, targetValue) {
        $targetInputParts.each(function() {
            let $inputParts = $(this);
            let inputValue = $inputParts.val();
            let disabled = $inputParts.prop('disabled');

            if (targetValue && targetValue == inputValue && !disabled) {
                checkAction($inputParts, true);
                return false;
            }
        });
    }

    /**
    *
    * 製品ボタン初期化
    *
    * @param {JQueryElement} 製品ボタンフィールド
    *
    */
    let initializeProductButtons = function($productButtonlFields) {
        productButtons[$productButtonlFields.attr('id')] = $productButtonlFields[0];

        let $productButtonLabels = $productButtonlFields.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
        let $productButtonInputParts = $productButtonLabels.children('.cmp-au-com-form__inputparts');
        $productButtonInputParts.on('change', function() {
            let $inputParts = $(this);
            changeOption($inputParts);
            if ($inputParts.is(':checked')) {
                let productCode = $inputParts.val();
                let productColor = $inputParts.closest('.cmp-au-com-form-product-options__item').data('cmpColorCode');
                changeProducts(productCode, productColor);
            }
        });

        initializeDisabled($productButtonInputParts);

        let inputName = getInputName($productButtonlFields);
        let relatedInputValue = relatedInputValues[inputName];

        initializeTargetValues($productButtonInputParts, relatedInputValue);

        if (!$productButtonInputParts.filter(':checked').length) {
            setFirstItem($productButtonInputParts);
        }

        $productButtonlFields.addClass('cmp-au-com-form-product-options__field--loaded');
    }

    /**
    *
    * 固定値初期化
    *
    * @param {JQueryElement} 固定値フィールド
    *
    */
    let initializeLocals = function($localFields) {
        locals[$localFields.attr('id')] = $localFields[0];

        let $matchHeightItems = $localFields.children('.cmp-au-com-form-product-options__item:not(.cmp-au-com-form-product-options__item--full-width)');
        if ($matchHeightItems.length) {
            $matchHeightItems.matchHeight({
                byRow: false
            });
        }

        let $localLabels = $localFields.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
        let $localInputParts = $localLabels.children('.cmp-au-com-form__inputparts');
        $localInputParts.on('change', function() {
            let $inputParts = $(this);
            changeOption($inputParts);
        });

        initializeDisabled($localInputParts);

        let inputName = getInputName($localFields);
        let relatedInputValue = relatedInputValues[inputName];

        initializeTargetValues($localInputParts, relatedInputValue);
    }

    /**
    *
    * 入力値初期化
    *
    * @param {String} フォームID
    * @param {String[]} name配列
    *
    */
    let initializeRelatedInputValues = function(formName, inputNames) {
        let formInputValues = [];
        let queryValues = [];
        let localStorageValues = [];

        if (!formName) {
            return;
        }

        $.each(inputNames, function() {
            let inputName = this;
            let partsPath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + inputName;
            let inputInfo = window.formDataLayerAPI.get(partsPath);
            if (inputInfo && inputInfo.value) {
                formInputValues[inputName] = inputInfo.value;
            }

            let queryValue = AU_COMMON.getParameter(document.location.href, inputName);
            if (queryValue) {
                queryValues[inputName] = queryValue;
            }

            let localStorageKey = formName + '_' + inputName;
            let localStorageValue = getLocalStorage(localStorageKey);
            if (localStorageValue) {
                localStorageValues[inputName] = localStorageValue;
            }
        });

        let navigation = performance ? performance.navigation : null;

        if (navigation && navigation.type == navigation.TYPE_BACK_FORWARD) {
            relatedInputValues = localStorageValues;
        } else {
            if (Object.keys(queryValues).length) {
                relatedInputValues = queryValues;
            } else {
                relatedInputValues = formInputValues
            }
        }
    }

    /**
    *
    * 製品初期化
    *
    */
    let initializeProducts = function() {
        $.each(productButtons, function() {
            let $productButton = $(this);
            let $productButtonLabels = $productButton.children('.cmp-au-com-form-product-options__item').children('.cmp-au-com-form-product-options__label');
            let $productButtonInputParts = $productButtonLabels.children('.cmp-au-com-form__inputparts');
            let $checkedInputParts = $productButtonInputParts.filter(':checked');
            if ($checkedInputParts.length) {
                $checkedInputParts.trigger('change', true);
            }
        });
        $.each(productCarousels, function() {
            let $productCarousel = $(this);
            let $carousel = $productCarousel.children('.cmp-au-com-form-product-options__carousel');
            let carouselFlickity = $carousel.data('flickity');
            let $selectedCell = null;
            if (carouselFlickity) {
                $selectedCell = $(carouselFlickity.selectedElement);
            } else {
                $selectedCell = $('.cmp-au-com-form-product-options__carousel-cell.is-selected', $carousel);
            }
            if ($selectedCell.length) {
                changeCarousel($selectedCell);
            }
        });
    }

    /**
    *
    * フォーム情報クリア
    *
    * @param {JQueryElement} フォーム部品
    *
    */
    let clearRelatedInputValues = function($auFormParts) {
        let formName = window.auForm.getFormName($auFormParts);
        $auFormParts.each(function() {
            let $formElem = $(this);
            let name = getInputName($formElem);
            if (formName && name) {
                let partsPath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name;
                let localStorageKey = formName + '_' + name;
                window.formDataLayerAPI.set(partsPath, null);
                setLocalStorage(localStorageKey, null);
            }
        });
    }

    /**
    *
    * 初期化オブザーバー実行
    *
    * @param {JQueryElement} フォーム部品
    *
    */
    let executeInitObserver = function($auFormParts) {
        if (!$auFormParts.length) {
            return;
        }
        clearRelatedInputValues($auFormParts);
        let $clearedCapacity = clearCapacities();
        let $clearedColor = clearColors();
        if (!hasCheckedCapacity && $clearedCapacity && $clearedCapacity.length) {
            triggerChange($clearedCapacity);
        }
        if (!hasCheckedColor && $clearedColor && $clearedColor.length) {
            triggerChange($clearedColor);
        }
        initialize($auFormParts);
        setDisableObserver($auFormParts);
    }

    /**
    *
    * 初期化オブザーバー初期化
    *
    */
    let initializeInitObserver = function() {
        let MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        let body = document.querySelector("body");
        initObserver = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                let nodesArray = [].slice.call(mutation.addedNodes);
                if (!nodesArray.length) {
                    return;
                }
                nodesArray.forEach(function(addedNode) {
                    if (!addedNode.querySelectorAll) {
                        return;
                    }
                    let $auFormParts = $(addedNode).find('.cmp-au-com-form-product-options');
                    executeInitObserver($auFormParts);
                });
            });
        });

        initObserver.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    /**
    *
    * 無効化オブザーバー設定
    *
    * @param {JQueryElement} フォーム部品
    *
    */
    let setDisableObserver = function($auFormParts) {
        let $inputParts = $();
        $auFormParts.each(function() {
            let $formElem = $(this);
            let source = $formElem.data('cmpSource');
            if (source != 'productCarousel') {
                $inputParts = $inputParts.add($('.cmp-au-com-form__inputparts', $formElem));
            }
        });

        $inputParts.each(function() {
            disableObserver.observe(this, {
                attributes: true,
                attributeFilter: ['disabled']
            });
        });
    }

    /**
    *
    * 無効化オブザーバー初期化
    *
    */
    let initializeDisableObserver = function() {
        let MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        disableObserver = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                let $target = $(mutation.target);
                if (!$target.length) {
                    return;
                }
                let $targetLabel = $target.closest('.cmp-au-com-form-product-options__label');
                if ($target.prop('disabled')) {
                    $targetLabel.addClass('cmp-au-com-form-product-options__label--disabled');
                } else {
                    $targetLabel.removeClass('cmp-au-com-form-product-options__label--disabled');
                }
            });
        });
    }

    /**
    *
    * オブザーバー初期化
    *
    */
    let initializeObservers = function() {
        initializeDisableObserver();
        initializeInitObserver();
    }

    /**
    *
    * 初期化
    *
    * @param {JQueryElement} フォーム部品
    *
    */
    let initialize = function($auFormParts) {
        initialized = false;
        let tempProductCarousels = {};
        let tempProductButtons = {};
        let tempProductColors = {};
        let tempProductCapacities = {};
        let tempProductThumbnails = {};
        let tempLocals = {};
        let inputNames = [];

        $auFormParts.each(function() {
            let $formElem = $(this);
            let inputName = getInputName($formElem);
            inputNames.push(inputName);

            let source = $formElem.data('cmpSource');

            if (source == 'productCarousel') {
                let $productCarousel = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__products');
                tempProductCarousels[$productCarousel.attr('id')] = $productCarousel[0];
            } else if (source == 'productButton' || source == 'productRank') {
                let $productButtonlFields = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__field');
                tempProductButtons[$productButtonlFields.attr('id')] = $productButtonlFields[0];
            } else if (source == 'productColor') {
                let $productColorFields = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__field');
                $productColorFields.each(function() {
                    tempProductColors[$(this).attr('id')] = this;
                });
            } else if (source == 'productCapacity') {
                let $productCapacityFields = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__field');
                $productCapacityFields.each(function() {
                    tempProductCapacities[$(this).attr('id')] = this;
                });
            } else if (source == 'productThumbnailCarousel') {
                let $productThumbnailFields = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__thumbnail');
                $productThumbnailFields.each(function() {
                    tempProductThumbnails[$(this).attr('id')] = this;
                });
            } else if (source == 'local') {
                let $localFields = $formElem.children('.cmp-au-com-form-product-options__wrapper').children('.cmp-au-com-form-product-options__field');
                tempLocals[$localFields.attr('id')] = $localFields[0];
            }

            $(document).on(window.formDataLayerAPI.FORM_SHOW_HIDE_EVENT, function() {
                validationCheck($formElem);
            });
        });

        let formName = window.auForm.getFormName($auFormParts);
        initializeRelatedInputValues(formName, inputNames);

        $.each(tempLocals, function() {
            initializeLocals($(this));
        });
        $.each(tempProductCapacities, function() {
            initializeCapacities($(this));
        });
        $.each(tempProductThumbnails, function() {
            initializeProductThumbnails($(this));
        });
        $.each(tempProductColors, function() {
            initializeColors($(this));
        });
        $.each(tempProductButtons, function() {
            initializeProductButtons($(this));
        });
        $.each(tempProductCarousels, function() {
            initializeProductCarousels($(this));
        });

        if (!Object.keys(tempProductCarousels).length && !Object.keys(tempProductButtons).length) {
            initializeProducts();
        }

        $auFormParts.addClass('cmp-au-com-form-product-options--loaded');
        initialized = true;
    }

    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function() {
        let $auFormParts = $('.cmp-au-com-form-product-options');
        if ($auFormParts.length) {
            initialize($auFormParts);
        }

        $(window).on('resize', function() {
            if (carouselTimer !== false) {
                clearTimeout(carouselTimer);
            }
            carouselTimer = setTimeout(function() {
                resizeCarousels();
            }, 500);
        });

        initializeObservers();
        setDisableObserver($auFormParts);

        $(document).trigger(READY_EVENT);

    });

    $(document).on('change', COLOR_SELECTOR, function () {
        const $selectedCapacity = $(CAPACITY_SELECTOR).filter(':checked');
        if (!$selectedCapacity.length) {
            switchEnabled($(RECEIVE_SELECTOR), false);
            switchEnabled($(CONTRACT_SELECTOR), false);
        } else {
            receiveSelectorCheck();
        }
    });

    $(document).on('change', CAPACITY_SELECTOR, function () {
        const $inputParts = $(this);
        const $inputContracts = $(CONTRACT_SELECTOR);
        const $inputReceives = $(RECEIVE_SELECTOR);
        if ($inputParts.is(':checked')) {
            switchEnabled($inputContracts, true);
            const stockInOnlineShop = ($inputParts.data('cmpStockInOnlineShop') !== undefined);
            const webPreorderAvailable = $inputParts.data('cmpWebPreorderAvailable');
            $inputReceives.each(function () {
                const $inputReceive = $(this);
                if ($inputReceive.val() == RECEIVE_ONLINE_SHOP) {
                    switchEnabled($inputReceive, stockInOnlineShop);
                } else if ($inputReceive.val() == RECEIVE_REAL_SHOP) {
                    switchEnabled($inputReceive, webPreorderAvailable);
                }
            });
        } else {
            switchEnabled($inputReceives, false);
            switchEnabled($inputContracts, false);
        }
    });

    $(document).on('change', CONTRACT_SELECTOR, function () {
        const $inputParts = $(this);
        if ($inputParts.is(':checked')) {
            setSelectedLocals($inputParts);
        }
        const $inputReceive = $(RECEIVE_ONLINE_SHOP_SELECTOR);
        if (!$inputReceive.length) {
            return;
        }
        const $optionsWrapper = $inputReceive.closest(FORM_OPTION_WRAPPER_CLASS);
        let $needAuIdDiv = $optionsWrapper.children(NEED_AUID_SELECTOR);
        if ($needAuIdDiv.length) {
            $needAuIdDiv.remove();
        }
        if ($inputParts.is(':checked')) {
            if (($inputParts.val() == 2)||($inputParts.val() == 5)) {
                $needAuIdDiv = createNeedAuIdDiv();
                $optionsWrapper.append($needAuIdDiv);
            }
        }
    });

    $(document).on('change', RECEIVE_SELECTOR, function () {
        const $inputParts = $(this);
        if ($inputParts.is(':checked')) {
            const $inputCapacity = $(CAPACITY_SELECTOR);
            const $inputPartsValue = $inputParts.val();
            if ($inputCapacity.length) {
                if ($inputPartsValue === '0') {
                    $inputCapacity.parent().find('.cmp-au-com-form-product-options__stock').hide();
                } else if ($inputPartsValue === '1') {
                    $inputCapacity.parent().find('.cmp-au-com-form-product-options__stock').show();
                }
            }
            setSelectedLocals($inputParts);
        }
    });


    //機種選択時に"online shopで契約・購入"にチェックを付ける
    $(document).on('click', DEVICE_SELECTOR, function () {
        if ($(this).hasClass('is-selected')) {
            receiveSelectorCheck();
        }
    });

    //機種選択時に"online shopで契約・購入"にチェックを付ける(shopページ/インジケーター)
    $(document).on('click', SHOP_DOT, function () {
        if ($(this).hasClass('is-selected')) {
            receiveSelectorCheck();
        }
    });

      //機種選択時に"online shopで契約・購入"にチェックを付ける(shopページ/カルーセルの矢印、選択外の機種待機部分)
    $(document).on('click', '.cmp-au-com-form-product-options__arrow-prev,.cmp-au-com-form-product-options__arrow-next,.cmp-au-com-form-product-options__frame-prev,.cmp-au-com-form-product-options__frame-next', function () {
        receiveSelectorCheck();
    });

    window.auForm = window.auForm || {};
    window.auForm.productOption = {};
    window.auForm.productOption.validationCheck = validationCheck;
    window.auForm.productOption.isRequiredError = isRequiredError;
    window.auForm.productOption.getInputParts = getInputParts;
    window.auForm.productOption.ready = READY_EVENT;

    $(document).on(window.auForm.productOption.ready, function () {
        contractSelectorCheck();
        receiveSelectorCheck();
    });

})(jQuery);
(function($) {
    'use strict';

    const READY_EVENT = 'auFormPartsController:ready';

    function action($controller, actionSetting) {

        let $formParts = $('.cmp-au-com-form__formparts', $controller);
        let $inputParts = $('.cmp-au-com-form__inputparts', $formParts);
        let $formLabel = $('.cmp-au-com-form-label', $controller);
        let $optionsLabel = $('.cmp-au-com-form-options__label', $formParts);

        switch (actionSetting.action) {
            case 'setRequired':
                $formParts.data('cmp-required', true);
                if (actionSetting.setRequiredIcon) {
                    $formLabel.parent().addClass('cmp-au-com-form-label__required__icon--show');
                }
                break;
            case 'removeRequired':
                $formParts.data('cmp-required', false);
                if (actionSetting.removeRequiredIcon) {
                    $formLabel.parent().removeClass('cmp-au-com-form-label__required__icon--show');
                }
                break;
            case 'setDisabled':
                $inputParts.prop('disabled', true);
                $inputParts.next('.ui-datepicker-trigger').css('pointer-events','none');
                $optionsLabel.addClass('cmp-au-com-form-options__label--disabled');
                break;
            case 'removeDisabled':
                $inputParts.prop('disabled', false);
                $inputParts.next('.ui-datepicker-trigger').css('pointer-events','');
                $optionsLabel.removeClass('cmp-au-com-form-options__label--disabled');
                break;
            case 'setValue':
            case 'clearValue':
                let val = actionSetting.action == 'setValue' ? actionSetting.value : '';
                $formParts.each(function(){
                    let $input = window.auForm.getInputParts($(this));
                    if ($input.length > 0) {
                        let formName = window.auForm.getFormName($input)
                        let name = $input.attr('name');
                        let type = $input.attr('type');
                        type == 'checkbox' || type == 'radio' ? window.formDataLayerAPI.setCheckedValues($input, val) : $input.val(val);
                        let inputInfo = window.formDataLayerAPI.getInputInfo($input)
                        window.formDataLayerAPI.set('/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name, inputInfo, false);
                    }
                });
                break;
        }

        // バリデーションチェックの再実施
        $formParts.each(function(){

            let $alertParts = $('.cmp-au-com-form__alertparts', $(this));
            let $alertPartsText = $('.cmp-au-com-form__alertparts__text', $alertParts);

            let errMsg = window.auForm.validationCheck($(this));

            // 制約メッセージをアラート部品に設定
            $alertPartsText.text(errMsg);
            if (!errMsg) {
                $alertParts.hide();
            }

        });

    }

    /**
     * 指定された方法で値を比較する
     *
     * @private
     * @param {String} 比較方法
     * @param {String} 値１
     * @param {String} 値２
     * @return {Boolean} true：一致、false：不一致
     */
    function isMatch(method, value1, value2) {

        let isMatched = false;
        let value1Str = String(value1);
        let value2Str = String(value2);
        let value1Int = parseInt(value1, 10);
        let value2Int = parseInt(value2, 10);
        switch (method) {
            case '==':
                isMatched = value1Str == value2Str;
                break;
            case '!=':
                isMatched = value1Str != value2Str;
                break;
            case '>=':
                isMatched = value1Int >= value2Int;
                break;
            case '<=':
                isMatched = value1Int <= value2Int;
                break;
            default :
                isMatched = value2 && value1Str.match(value2Str);
                break;
        }

        return isMatched;

    }


    /**
     * 条件が一致した場合にアクションを実行する
     *
     * @private
     * @param {String} 動作設定
     * @return {jQueryObject} 対象の部品
     */
    function takeActionIfMatched (actionSetting, $controller) {

        let comparisonItem = window.formDataLayerAPI.get(actionSetting.comparisonItemPath);
        let comparisonMethod = actionSetting.comparisonMethod;
        let comparisonValueType = actionSetting.comparisonValueType;
        let acquisitionError = actionSetting.acquisitionError;

        let comparisonValue = undefined;
        switch (comparisonValueType) {
            case 'fixedValue':
                comparisonValue = actionSetting.comparisonValue || '';
                break;
            case 'formData':
                comparisonValue = window.formDataLayerAPI.get(actionSetting.formDataPath);
                break;
        }

        // 比較アイテムと比較値が取得できた場合
        if (comparisonItem != undefined && comparisonValue != undefined) {

            // 取得したアイテムがオブジェクトの場合、JSON化する
            if (comparisonItem instanceof Object){
                comparisonItem = JSON.stringify(comparisonItem);
            }

            // 取得した値がオブジェクトの場合、JSON化する
            if (comparisonValue instanceof Object){
                comparisonValue = JSON.stringify(comparisonValue);
            }

            // 比較値が一致した場合、実行する
            if (isMatch(comparisonMethod, comparisonItem, comparisonValue)) {
                action($controller, actionSetting);
            }

        // 比較アイテムが取得できなかった場合
        } else {
            if (acquisitionError == 'on') {
                action($controller, actionSetting);
            }
        }        

    }

    /**
     * アクションを実行する
     */
    function takeActions () {

        let $formPartsController = $('.cmp-au-com-form-parts-controller');
        $formPartsController.each(function(){

            let $controller = $(this);

            // 動作設定情報を取得
            let actionSettings =$controller.data('cmp-action-setting-json');

            if (actionSettings) {
                actionSettings.forEach( actionSetting => takeActionIfMatched(actionSetting, $controller));
            }

        });

        // フォームパーツコントローラーの処理後に、フォーム隠しフィールドのイベントをトリガーする
        $(document).trigger(window.auForm.hidden.HIDDEN_TRIGGER_EVENT);

    }

    /**
     * フォームコンテナの ready イベント、およびフォームデータレイヤーの change イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){
        takeActions();
        $(document).trigger(READY_EVENT);
    });

    $(document).on(window.formDataLayerAPI.CHANGE_EVENT_NAME, function (){
        takeActions();
    });

    window.auForm = window.auForm || {};
    window.auForm.partsController = {};
    window.auForm.partsController.ready = READY_EVENT;
 
})(jQuery);

(function($) {
    'use strict';

    let HIDDEN_TRIGGER_EVENT = 'auForm:hidden';


    /**
     * 入力部品を取得する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @return 対象の入力部品
     */
    function getInputParts($formParts) {
        return $('.cmp-au-com-form__inputparts' ,$formParts)
    }

    /**
     * クエリパラメータの値を取得する
     *
     * @param {String} データレイヤーの値のパス
     * @param {String} 名前
     * @return 値
     */
    function getQueryParamValue(dataLayerValuePath, name) {
        // クエリパラメータから取得できない場合はデータレイヤーの値を利用する
        return CommonUtil.getParam(name) || window.formDataLayerAPI.get(dataLayerValuePath);
    }

    /**
     * フォーム隠しフィールドに値を設定する
     *
     * @private
     * @param {jQueryElement} フォーム隠しフィールド部品
     */
    function setHiddenValue($auFormParts) {

        $auFormParts.each(function(){
            let value = '';
            let $formHidden = $(this);
            let settingMethod = $formHidden.data('cmp-setting-method');
            let valueDataType = $formHidden.data('cmp-value-data-type');

            // フォーム隠しフィールドの入力部品を取得
            let $inputParts = getInputParts($formHidden)
            let formName = window.auForm.getFormName($inputParts);
            let name = $inputParts.attr('name');
            let dataLayerValuePath = '/' + window.formDataLayerAPI.DATA_LAYER_KEY + '/' + formName + '/' + name + '/value';

            // フォーム隠しフィールドが有効なフィールドであるか判定（非表示領域ではないか判定）
            if(window.auForm.isEnableElement($inputParts)) {

                if (settingMethod == 'formData') {

                    // アイテム情報を取得する
                    let targetItemsJson = $formHidden.data('cmp-target-items-json');
                    if (targetItemsJson) {
                        targetItemsJson.forEach(function(item, i){

                            if (item.path) {

                                // フォームデータレイヤーから対象の入力情報を取得
                                let result = window.formDataLayerAPI.get(item.path);
                                if (typeof result === 'number'){
                                    result = String(result);
                                }
                                if (result != null) {
                                    // 取得した値がオブジェクトの場合はJSON化する
                                    if (result instanceof Object){
                                        result = JSON.stringify(result);
                                    }

                                    // 切り出し処理を行う
                                    let indexStart = item.indexStart ? parseInt(item.indexStart) : 1;
                                    let indexEnd = item.indexEnd ? parseInt(item.indexEnd) : result.length;
                                    if (indexStart > indexEnd) {
                                        indexEnd = item.indexEnd - 1;
                                    } else {
                                        indexStart = item.indexStart - 1;
                                    }
                                    result = result.substring(indexStart, indexEnd);

                                    // 値を設定
                                    value += result;
                                }
                            }

                            // 結合文字を追加
                            if (item.combiningCharacter) {
                                value += item.combiningCharacter;
                            }
                        });
                    }

                    // フォーム隠しフィールドに値を設定
                    $inputParts.val(value);

                } else if (settingMethod == 'queryParam') {
                    let queryParamName = $formHidden.data('cmpQueryParamName');
                    value = getQueryParamValue(dataLayerValuePath, queryParamName);

                    // フォーム隠しフィールドに値を設定
                    $inputParts.val(value);

                } else {

                    value = $inputParts.val();

                }

                let dataLayerValue = ''
                if (valueDataType == 'json' && value) {
                    dataLayerValue = JSON.parse(value);
                } else {
                    dataLayerValue = value;
                }

                window.formDataLayerAPI.set(dataLayerValuePath, dataLayerValue, false);

            }

        });

    }

    /**
     * 初期化処理
     */
    function init() {

        // フォーム隠しフィールドを取得
        let $auFormParts = $('.cmp-au-com-form-hidden');

        if ($auFormParts.length > 0) {

            // フォームパーツコントローラーの処理後にトリガーされるイベントをキャッチ
            // フォームコンテナの ready イベント、およびフォームデータレイヤーの change イベント後に必ずトリガーされる
            $(document).on(HIDDEN_TRIGGER_EVENT, function (){
                setHiddenValue($auFormParts);
            });

            setHiddenValue($auFormParts);

        }

     }

    window.auForm = window.auForm || {};
    window.auForm.hidden = {};
    window.auForm.hidden.init = init;
    window.auForm.hidden.reset = setHiddenValue;
    window.auForm.hidden.HIDDEN_TRIGGER_EVENT = HIDDEN_TRIGGER_EVENT;
    window.auForm.hidden.getInputParts = getInputParts;

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormDisplayText:ready';

    /**
     * 表示テキストを設定する
     *
     * @private
     * @param {jQueryElement} フォームテキスト表示
     */
    function setDisplayText($formElem) {

        var value = '';
        var targetItemsJson = $formElem.data('cmp-target-items-json');
        var $textElem = $('.cmp-au-com-form-display-text__text', $formElem);

        if (targetItemsJson) {
            targetItemsJson.forEach(function(item, i){
                if (item.formDataPath) {
                    // フォームデータレイヤーから対象の入力情報を取得
                    var result = window.formDataLayerAPI.get(item.formDataPath);
                    if (result != null) {
                        value = setValue(value, result, item, $formElem);
                    }
                }
            });
            $textElem.text(value);
        }
    }

    function setValue(value, result, item, $formElem) {
        var $lebelElem = $('.cmp-au-com-form-display-text__label', $formElem);
        // 取得した値がオブジェクトの場合
        if (result instanceof Object){
            // ラベルを設定
            var label = result.label;
            if (label) {
                $lebelElem.text(label);
                $lebelElem.show();
            }
            result = result.text || result.value;
            if (result == null) {
                result = '';
            }
        }

        if (typeof result === 'number'){
            result = String(result);
        }
        // 切り出し処理を行う
        var indexStart = item.indexStart ? parseInt(item.indexStart) : 1;
        var indexEnd = item.indexEnd ? parseInt(item.indexEnd) : result.length;
        if (indexStart > indexEnd) {
            indexEnd = item.indexEnd - 1;
        } else {
            indexStart = item.indexStart - 1;
        }
        result = result.substring(indexStart, indexEnd);

        // 値を設定
        value += result;
        // 結合文字を追加
        if (item.combiningCharacter) {
            value += item.combiningCharacter;
        }
        return value;
    }

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        // フォームテキスト表示を取得
        var $auFormParts = $('.cmp-au-com-form-display-text');

        $auFormParts.each(function() {
            var $formElem = $(this)

            // フォームデータレイヤーの change イベントをキャッチ
            $(document).on(window.formDataLayerAPI.CHANGE_EVENT_NAME, function (){
                // 表示テキストを設定
                setDisplayText($formElem);
            });

            // 表示テキストを設定
            setDisplayText($formElem);
        });

        $(document).trigger(READY_EVENT);
        
    });

    window.auForm = window.auForm || {};
    window.auForm.displayText = {};
    window.auForm.displayText.ready = READY_EVENT

})(jQuery);

(function($) {
    'use strict';

    const SERVLET_PATH_CAMPAIGN_REGISTER = "/bin/wcm/au-com/form/campaignRegister.do";
    const ALL_READY_EVENT = "auForm:allReady";
    let auFormCsrfToken = "";

    /**
     * 指定された入力部品が属するフォームコンテナの名前を取得する
     *
     * @param {jQueryElement} フォーム入力部品
     */
    function getFormName($elem) {
        let formName = undefined;
        if ($elem.length > 0) {
            formName = $elem.closest('[data-form-name]').data('form-name');
        }
        return formName;
    }

    /**
     * 指定された入力部品が属するフォームコンテナのIDを取得する
     *
     * @param {jQueryElement} フォーム入力部品
     */
    function getFormId($elem) {
        let formId = undefined;
        if ($elem.length > 0) {
            formId = $elem.closest('.cmp-au-com-form').attr('id');
        }
        return formId;
    }

    /**
     * 指定の入力部品が有効であるかを判定する
     * （表示されている場合：有効、非表示の場合：無効）
     *
     * @param {jQueryElement} フォーム入力部品
     * @param {Boolean} 有効：true、無効：false
     */
    function isEnableElement($elem) {

        let isEnabled = false;
        if ($elem && $elem.length && !$elem.closest('.cmp-displaycontainerbytarget__tabpanel[aria-hidden=true], .cmp-au-com-form__hide').length) {
            isEnabled = true;
        }

        return isEnabled;

    }


    /**
     * 入力部品を取得する
     *
     * @param {jQueryElement} 対象のフォーム部品
     * @return 対象の入力部品
     */
    function getInputParts($formParts) {

        let $inputParts = [];
        if ($formParts && $formParts.length > 0) {
            // 入力部品を取得
            if ($formParts.hasClass('cmp-au-com-form-text')) {
                $inputParts = window.auForm.text.getInputParts($formParts);
            } else if ($formParts.hasClass('cmp-au-com-form-options')) {
                $inputParts = window.auForm.option.getInputParts($formParts);
            } else if ($formParts.hasClass('cmp-au-com-form-product-options')) {
                $inputParts = window.auForm.productOption.getInputParts($formParts);
            } else if ($formParts.hasClass('cmp-au-com-form-hidden')) {
                $inputParts = window.auForm.hidden.getInputParts($formParts);
            }
        }

        return $inputParts;

    }

    /**
     * バリデーションチェック
     *
     * @param {jQueryElement} 対象の入力部品
     * @return エラーメッセージ
     */
    function validationCheck($formParts) {

        let errMsg = '';
        if ($formParts.length > 0) {
            // バリデーションチェックを実施
            if ($formParts.hasClass('cmp-au-com-form-text')) {
                errMsg = window.auForm.text.validationCheck($formParts);
            } else if ($formParts.hasClass('cmp-au-com-form-options')) {
                errMsg = window.auForm.option.validationCheck($formParts);
            } else if ($formParts.hasClass('cmp-au-com-form-product-options')) {
                errMsg = window.auForm.productOption.validationCheck($formParts);
            }
        }

        return errMsg;

    }

    /**
     * 必須チェック
     *
     * @param {jQueryElement} 対象の入力部品
     * @return エラーメッセージ
     */
    function isRequiredError($formParts) {

        let isError = false;
        if ($formParts.length > 0) {
            // 必須チェックを実施
            if ($formParts.hasClass('cmp-au-com-form-text')) {
                isError = window.auForm.text.isRequiredError($formParts)
            } else if ($formParts.hasClass('cmp-au-com-form-options')) {
                isError = window.auForm.option.isRequiredError($formParts)
            } else if ($formParts.hasClass('cmp-au-com-form-product-options')) {
                isError = window.auForm.productOption.isRequiredError($formParts)
            }
        }

        return isError;

    }

    /**
     * バリデーションチェック
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     * @return 判定結果
     */
    function hasValidationError($form) {

        let $formPartsList = $('.cmp-au-com-form__formparts', $form)
        let $firstErrorElem = undefined;
        let hasError = false;

        $formPartsList.each(function(){
            let $formParts = $(this);
            let $alertParts = $formParts.children('.cmp-au-com-form__alertparts');
            let $alertPartsText = $('.cmp-au-com-form__alertparts__text', $alertParts);

            // バリデーションチェックを実施
            let errMsg = validationCheck($formParts);

            // 制約メッセージをアラート部品に設定＆表示
            $alertPartsText.text(errMsg);
            if (errMsg) {
                $alertParts.css('display', 'inline-flex');
                if (!$firstErrorElem) {
                    $firstErrorElem = $(this);
                }
            } else {
                $alertParts.hide();
            }

        });

        if ($firstErrorElem) {
            let offsetTop = $firstErrorElem.length ? $firstErrorElem.offset().top : 0;
            $("html, body").animate({ scrollTop: offsetTop }, 200);
            hasError = true;
        }

        return hasError;

    }

    /**
     * 必須チェック
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     * @return 判定結果
     */
    function hasRequiredError($form) {

        let $formPartsList = $('.cmp-au-com-form__formparts', $form)
        let hasError = false;

        $formPartsList.each(function(){
            // 必須チェックを実施
            let $formParts = $(this);
            if (isRequiredError($formParts)) {
                hasError = true;
                return false;
            }
        });

        return hasError;

    }

    /**
     * クエリパラメータ取得
     *
     * @private
     * @param {jQueryElement} クリックしたフォームボタン
     * @param {String} サンクスページパス
     */
    function getQueryParams($clickButton) {
        let queryParams = '';

        let queryParamItemPaths = '';
        if ($clickButton.length) {
            queryParamItemPaths = $clickButton.data('queryParamItemPaths');
        }
        let queryParamItemPathArray = [];
        if (queryParamItemPaths) {
            queryParamItemPathArray = queryParamItemPaths.split(',');
        }
        $.each(queryParamItemPathArray, function () {
            let queryParamItemPath = this;
            let queryParamItem = window.formDataLayerAPI.get(queryParamItemPath);
            if (queryParamItem) {
                if (queryParams) {
                    queryParams = queryParams + '&';
                }

                let queryParamItemName = queryParamItemPath.split('/').pop();
                queryParams = queryParams + decodeURIComponent(queryParamItemName);

                let queryParamItemValue = queryParamItem.value;
                if (queryParamItemValue) {
                    queryParams = queryParams + '=' + decodeURIComponent(queryParamItemValue);
                }
            }
        });

        return queryParams;
    }

    /**
     * 遷移先ページ取得
     *
     * @private
     * @param {jQueryElement} クリックしたフォームボタン
     * @param {String} サンクスページパス
     */
    function getTargetPage($clickButton, thanksPage) {
        if (!thanksPage) {
            return '';
        }

        // サンクスページパスを分解
        let targetPageAnchor = '';

        let targetPageParts = thanksPage.split('#');
        if (targetPageParts.length > 1) {
            targetPageAnchor = targetPageParts.pop();
        }
        let targetPage = targetPageParts.shift();

        if (!targetPage) {
            return targetPageAnchor;
        }

        let targetPageParams = '';

        targetPageParts = targetPage.split('?');
        if (targetPageParts.length > 1) {
            targetPageParams = targetPageParts.pop();
        }
        targetPage = targetPageParts.shift();

        if (!targetPage) {
            return targetPageAnchor;
        }

        // 指定された要素のnameとvalueをクエリパラメータに追加する
        let queryParams = getQueryParams($clickButton);
        if (queryParams) {
           if (targetPageParams) {
                targetPageParams = targetPageParams + '&';
            }
            targetPageParams = targetPageParams + queryParams;
        }

        // URL生成
        if (targetPageParams) {
            targetPage = targetPage + '?' + targetPageParams;
        }
        if (targetPageAnchor) {
            targetPage = targetPage + '#' + targetPageAnchor;
        }

        return targetPage;
    }

    /**
     * サーバーエラーメッセージを隠す
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     */
    function hideServerErrorMessage($formContainer) {
        $('.cmp-au-com-form__error-message .cmp-au-com-form__error-message-text', $formContainer).hide();
    }

    /**
     * サーバーエラーメッセージを表示する
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     * @param {String} エラーメッセージ
     */
    function showServerErrorMessage($formContainer, errorMessage) {

        let $errorMsgTextElem = $('.cmp-au-com-form__error-message .cmp-au-com-form__error-message-text', $formContainer);

        if (errorMessage) {

            $errorMsgTextElem.text(errorMessage);
            $errorMsgTextElem.show();

            // フォームコンテナのトップに移動（エラーメッセージを表示するため）
            let offsetTop = $formContainer.length ? $formContainer.offset().top : 0;
            $("html, body").animate({ scrollTop: offsetTop }, 200);

        }

    }

    /**
     * サーバーエラーメッセージを取得する
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     * @param {String} キー
     */
    function getServerErrorMessage($formContainer, key) {
        return $('.cmp-au-com-form__error-message .cmp-au-com-form__error-message-text', $formContainer).data(key);
    }

    /**
     * 動作設定「次ページへ遷移」処理
     *
     * @private
     * @param {jQueryElement} クリックしたボタン
     */
    function nextPageTransitionAction($clickButton) {

        // フォームデータレイヤーのサブミット処理を実行
        window.formDataLayerAPI.submit($clickButton, auFormCsrfToken);

        // 次ページパスを取得
        let nextPage = $clickButton.data('next-page-path');

        if (nextPage) {

            // セッションストレージにフォームデータレイヤーの情報を保存
            window.formDataLayerAPI.save();

            // 次ページパスにリダイレクト
            window.location.href = nextPage;
        }

    }

    /**
     * 送信成功時の処理
     *
     * @private
     * @param {jQueryElement} クリックしたボタン
     */
    function submitSuccessProcess($clickButton) {

        // 送信処理・サンクスページパスを取得
        let submitProcess = $clickButton.data('submit-process');
        let thanksPage = $clickButton.data('thanks-page-path');

        // フォームデータレイヤーの情報を全てクリア
        window.formDataLayerAPI.clear();

        // auHOME情報をクリア
        window.auDataLayer.auHomeInfo.invalidate();

        // サンクスページパスにリダイレクト
        if (thanksPage) {
            if (submitProcess == SERVLET_PATH_CAMPAIGN_REGISTER) {
                window.location.href = getTargetPage($clickButton, thanksPage);
            } else {
                window.location.href = thanksPage;
            }
        } else {
            window.loading.stop();
        }

    }

    /**
     * 送信エラー時の処理
     *
     * @private
     * @param {jQueryElement} クリックしたボタン
     */
    function submitErrorProcess(jqXHR, textStatus, errorThrown, _$formContainer, _$clickButton) {
        /* 送信失敗 */
        console.error(textStatus + " : " + errorThrown);
        if (jqXHR.status == 400) {
            showServerErrorMessage(_$formContainer, getServerErrorMessage(_$formContainer, 'errorMessageBadRequest'));
        } else if (jqXHR.status == 403) {
            showServerErrorMessage(_$formContainer, getServerErrorMessage(_$formContainer, 'errorMessageForbidden'));
        } else if (jqXHR.status == 415) {
            showFrontendErrorMessage('emailRfcErrorMessage', _$formContainer, _$clickButton);
        } else if (jqXHR.status == 416) {
            showFrontendErrorMessage('wrongMailSettingMessage', _$formContainer, _$clickButton, 'errorMessageWrongMailSetting');
        } else {
            showServerErrorMessage(_$formContainer, getServerErrorMessage(_$formContainer, 'errorMessageDefault'));
        }

        // ローディング表示を停止
        window.loading.stop();

    }

    function showFrontendErrorMessage(
        dataAttr,
        _$formContainer,
        _$clickButton,
        defaultMessage) {
        let msg = _$clickButton.data(dataAttr);
        let defaultMsg = defaultMessage || 'errorMessageUnsupportedMediaType';
        showServerErrorMessage(_$formContainer, msg || getServerErrorMessage(_$formContainer, defaultMsg));
    }

    /**
     * 動作設定「送信」処理
     *
     * @private
     * @param {jQueryElement} クリックしたボタン
     */
    function submitAction($formContainer, $clickButton) {

        // ローディング表示を開始
        window.loading.start();

        // 送信処理・サンクスページパスを取得
        let submitProcess = $clickButton.data('submit-process');
        let thanksPage = $clickButton.data('thanks-page-path');

        if (submitProcess && submitProcess != 'default') {
            // フォームデータレイヤーのサブミット処理を実行
            window.formDataLayerAPI.submit($clickButton, auFormCsrfToken);

            // フォームデータレイヤーを取得
            let parameter = window.formDataLayerAPI.get(window.formDataLayerAPI.DATA_LAYER_KEY);

            // セッションストレージにフォームデータレイヤーの情報を保存
            window.formDataLayerAPI.save();

            let data = {
                'formParam' : JSON.stringify({'form' : parameter}),
                'lang' : $('html').attr('lang')
            };

            if (submitProcess == SERVLET_PATH_CAMPAIGN_REGISTER) {
                data.formId = getFormId($clickButton);
            }

            // サーバー送信処理実行
            $.ajax({
                method: 'POST',
                url: submitProcess,
                data: data,
                dataType: 'json',
                cache: false
            }).done(function () {

                /* 送信成功 */
                submitSuccessProcess($clickButton);

            }).fail(function(jqXHR, textStatus, errorThrown){

                /* 送信失敗 */
                submitErrorProcess(jqXHR, textStatus, errorThrown, $formContainer, $clickButton);

            });

        } else {

            // 遷移先ページ取得
            let targetPage = getTargetPage($clickButton, thanksPage);

            // ターゲットを指定
            let target = $clickButton.data('target');
            if (!target) {
                target = '_self';
            }

            if (targetPage) {

                // セッションストレージにフォームデータレイヤーの情報を保存
                window.formDataLayerAPI.save();

                // 遷移先ページにリダイレクト
                window.loading.stop();
                window.open(targetPage, target);
            } else {
                window.loading.stop();
            }

        }

    }

    /**
     * サブミット処理
     *
     * @private
     * @param {jQueryElement} 対象のフォーム
     */
    function submit($formContainer) {

        let $submitButton = $formContainer.children('.cmp-au-com-form__submit');
        let clickButtonId = $submitButton.val();
        $submitButton.val(false);

        if (clickButtonId && !hasValidationError($formContainer)) {

            // フォーム隠しフィールドを再設定
            let $auHiddenParts = $('.cmp-au-com-form-hidden');
            window.auForm.hidden.reset($auHiddenParts);

            // クリックしたフォームボタンを取得
            let $clickButton = $('#' + clickButtonId , $formContainer);

            if ($clickButton.length > 0) {

                // アクションタイプを取得
                let actionType = $clickButton.data('action-type');

                // アクションタイプ＝「次ページへ遷移」の場合
                if (actionType == 'nextPageTransition') {

                    nextPageTransitionAction($clickButton);

                // アクションタイプ＝「送信」の場合
                } else if (actionType == 'submit' && auFormCsrfToken) {

                    submitAction($formContainer, $clickButton);

                }

            }

        }

    }

    /**
     * キャンペーンフォームの登録済みチェックを実行する
     *
     * @param {jQueryElement} フォーム入力部品
     */
    function registeredCheck(formId, key, keyType) {
        return $.ajax({
            method: 'POST',
            url: '/bin/wcm/au-com/form/campaign/isRegistered.json',
            data: {formId: formId, key: key, keyType: keyType},
            dataType: 'json',
            cache: false
        })
    }

    /**
     * キャンペーンフォームの登録済みチェックのpromiseを取得
     *
     * @private
     * @param {jQueryElement} 対象の入力部品
     * @return promise
     */
    function registeredCheckPromises($formParts) {
        let promises = [];
        if ($formParts.length > 0) {
            let $inputParts = getInputParts($formParts);
            let conditionSettings = $formParts.data('cmp-condition-settings-json') || [];
            conditionSettings.forEach(function(condition, index) {
                if (condition.conditionType == 'registeredCheck') {
                    let formId = condition.formId || window.auForm.getFormId($inputParts);
                    // 登録済みチェックのpromiseを取得
                    if ($formParts.hasClass('cmp-au-com-form-text')) {
                        promises.push(window.auForm.text.registeredCheckPromise($formParts, formId, index));
                    } else if ($formParts.hasClass('cmp-au-com-form-options')) {
                        promises.push(window.auForm.option.registeredCheckPromise($formParts, formId, index));
                    }
                }
            });
            return promises;
        }
    }

    /**
     * キャンペーンフォームの登録済みチェックのpromiseを取得
     *
     * @private
     * @param {jQueryElement} 対象のフォームコンテナ
     * @return array
     */
    function getRegisteredCheckPromiseList($formContainer) {
        let promises = [];
        $('.cmp-au-com-form__formparts[data-cmp-required-registered-check]', $formContainer)
        .each((_, elem) => promises = promises.concat(registeredCheckPromises($(elem))));
        return promises;
    }

    /**
     * イベントをキャッチするPromiseを取得する
     *
     * @private
     * @param {String} イベント名 
     * @return promise
     */
     function getEventCatchPromise(event) {
        return new Promise(function(resolve) { 
            $(document).on(event, resolve);
        });
    }

    /**
     * ready 処理
     */
    $(function() {

        // フォームコンテナ部品取得
        let $auComform = $('.cmp-au-com-form');
        if ($auComform.length > 0) {

            // フォームボタン（アクションタイプ＝送信）が存在する場合、CSRFトークンを取得
            if ($('.cmp-au-com-form-button[data-action-type=submit]').length > 0) {

                // au.com.form のCSRFトークンを取得
                $.ajax({
                    method: 'GET',
                    url: '/bin/wcm/au-com/csrfToken.json',
                    contentType: 'application/json',
                    cache: false
                }).done(function (data) {
                    auFormCsrfToken = data.token;
                })

            }

            // submit イベントをキャッチ
            let isSubmited = false;
            $auComform.on('submit', function() {

                if (!isSubmited) {

                    isSubmited = true;
                    let $formContainer = $(this);

                    // エラーメッセージを非表示
                    hideServerErrorMessage($formContainer);

                    // キャンペーンフォーム登録済みチェックのpromiseを取得
                    let promises = getRegisteredCheckPromiseList($formContainer)
                    if (promises.length > 0) {

                        // キャンペーンフォームの登録済みチェックが必要な場合は、そのあとにサブミット処理を実行
                        Promise.all(promises)
                        .then(function() {
                            submit($formContainer);
                        })
                        .catch(function() {
                            showServerErrorMessage($formContainer, getServerErrorMessage($formContainer, 'errorMessageServerError'));
                        })
                        .then(function() {
                            isSubmited = false;
                        });

                    } else {

                        // キャンペーンフォームの登録済みチェックが必要ない場合は、そのままサブミット処理を実行
                        submit($formContainer);
                        isSubmited = false;

                    }

                }

                return false;

            });

            // フォームデータレイヤーの ready イベントをキャッチ
            $(document).on(window.formDataLayerAPI.READY_EVENT_NAME, function () {

                let promises = window.auForm.redirect.registeredCheckPromises();
                if (promises.length > 0) {
                    Promise.all(promises)
                    .then(function() {
                        exec();
                    })
                } else {
                    exec();
                }

            });

            let readyEvents = [];

            // ユーザー情報のalwaysイベントをキャッチ
            readyEvents.push(new Promise(function(resolve) {
                window.auDataLayer.addEventListener(window.auDataLayer.userInfo.always, function(){
                    resolve();
                });
            }));

            // auHOME情報のalwaysイベントをキャッチ
            readyEvents.push(new Promise(function(resolve) {
                window.auDataLayer.addEventListener(window.auDataLayer.auHomeInfo.always, function(){
                    resolve();
                });
            }));

            // 全てのイベントをキャッチしたらフォームデータレイヤーを初期化
            Promise.all(readyEvents).then(function() {
                // フォームデータレイヤーを初期化
                window.formDataLayerAPI.init();
            });

        }

    });

    /**
     * 実行処理
     */
    function exec() {
        // フォームリダイレクト実行
        if (window.auForm.redirect.exec()) {
            return false;
        }

        // フォーム隠しフィールドを初期化
        window.auForm.hidden.init();

        // 各フォーム部品の完了イベントを定義
        let formReadyEvents = [];
        formReadyEvents.push(getEventCatchPromise(window.auForm.button.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.displayText.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.option.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.productOption.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.storePrefectureOption.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.storeServiceOption.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.text.ready));
        formReadyEvents.push(getEventCatchPromise(window.auForm.partsController.ready));
        $('.cmp-displaycontainerbytarget[data-condition-type="formData"]').each((_, displayContainer) =>
            formReadyEvents.push(getEventCatchPromise($(displayContainer).attr('id') + ':showHide')))

        // 各フォーム部品の完了イベントをキャッチしたらフォーム準備完了イベントを発火
        Promise.all(formReadyEvents).then(function(){
            $(document).trigger(window.auForm.allReady);
        });

        // フォームの ready イベントを発火
        $(document).trigger(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT);

        // ローディング表示を停止
        window.loading.stop();
    }

    window.auForm = window.auForm || {};
    window.auForm.validationCheck = validationCheck;
    window.auForm.registeredCheck = registeredCheck;
    window.auForm.getInputParts = getInputParts;
    window.auForm.isEnableElement = isEnableElement;
    window.auForm.getFormName = getFormName;
    window.auForm.getFormId = getFormId;
    window.auForm.hasRequiredError = hasRequiredError;
    window.auForm.allReady = ALL_READY_EVENT;

})(jQuery);

(function($) {
    'use strict';

    const READY_EVENT = 'auFormButton:ready';

    /**
     * フォームボタンの無効化判定を行う
     *
     * @param {jQueryElement} 対象のボタン
     */
    function isDisabled($buttonElem) {
        var result = false;
        var activationConditions = $buttonElem.data('activation-conditions');
        if (activationConditions) {
            result = activationConditions.some(function(activationCondition) {
                if (activationCondition.formDataPath && window.auDataLayer.get(activationCondition.formDataPath) == null) {
                    return true;
                }
            });
        }
        return result;
    }

    /**
     * 商品詳細から購入画面遷移時にカートに商品を追加する
     */
    function addCart(elem) {
        if ($(elem).hasClass('submit-iphone') || $(elem).hasClass('submit-procedure')) {
            const statusCode = $('input[name="capacity"]:checked')?.data('cmpOlsStatusCode');
            const receiveValue = $('input[name="receive"]:checked')?.attr('value');
            if (statusCode && statusCode != 10 && receiveValue == '1') {
                const productCode = window.localStorage.getItem("form_capacity");
                const contractType = window.localStorage.getItem("form_contract");
                window.cartAPI.add(productCode, contractType, '1');
            }
        }
    }

    /**
     * フォームコンテナの ready イベントをキャッチ
     */
    $(document).on(window.formDataLayerAPI.FORM_CONTAINER_READY_EVENT, function (){

        // フォームボタンを取得
        var $auFormParts = $('.cmp-au-com-form-button');
        $auFormParts.each(function() {
            var $buttonElem = $(this);

            // フォームボタンの click イベントをキャッチ
            $buttonElem.on('click', function() {

                // アクションタイプを取得
                var actionType = $(this).data('action-type');

                // アクションタイプ＝「前ページに戻る」の場合
                if (actionType == 'prevPageTransition') {

                    // 前ページパスを取得
                    var prevPage = $(this).data('prev-page-path');
                    if (prevPage) {

                        // フォームデータレイヤーの情報をセッションストレージに保存
                        window.formDataLayerAPI.save();

                        // 前ページにリダイレクト
                        window.location.href = prevPage;
                    }

                // 上記以外の場合
                } else {

                    // フォームボタンのIDを取得
                    var id = $buttonElem.attr('id');

                    // フォームコンテナ直下にあるサブミットボタンを取得
                    var $auComForm = $buttonElem.closest('.cmp-au-com-form');
                    var $submitButton = $auComForm.children('.cmp-au-com-form__submit');
                    if ($submitButton.length) {
                        // 購入フロー遷移時にカートに商品を追加
                        addCart(this);

                        /* サブミット時にクリックしたボタンを判別するため、
                         * 非表示のサブミットボタンの値にフォームボタンのIDを設定し受け渡す */

                        // サブミットボタンの値にフォームボタンのIDを設定
                        $submitButton.val(id);
                        // サブミットボタンをクリック
                        $submitButton.trigger('click');

                    }

                }

            });

            // フォームデータレイヤーの change イベントをキャッチ
            $(document).on(window.formDataLayerAPI.CHANGE_EVENT_NAME, function () {
                // 特定の必須チェックでエラーがない場合のみ、「次へ」および「送信」ボタンを活性化
                $buttonElem.prop('disabled', isDisabled($buttonElem));
            });

            // 特定の必須チェックでエラーがない場合のみ、「次へ」および「送信」ボタンを活性化
            $buttonElem.prop('disabled', isDisabled($buttonElem));

        });

        $(document).trigger(READY_EVENT);

    });

    window.auForm = window.auForm || {};
    window.auForm.button = {};
    window.auForm.button.ready = READY_EVENT;

})(jQuery);


</script>

</body>
</html>
