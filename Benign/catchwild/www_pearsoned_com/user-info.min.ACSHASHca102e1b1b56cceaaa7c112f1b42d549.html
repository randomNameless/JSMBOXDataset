<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>user-info.min.ACSHASHca102e1b1b56cceaaa7c112f1b42d549.html</title>
</head>
<body>

<script>
'use strict';(function(){var localeToSite={ca:"learnerca",gb:"learneruk"};var isSubscriptionsSet=false;$(window).on("load",fillUserInformation);function fillUserInformation(){updateIesInformation();document.addEventListener("userDataReceived",userLoggedInEventHandler)}var setUserInfoProperty=function(key,value){for(var index in window.dataLayer)if(dataLayer[index]["userInfo"]&&dataLayer[index]["userInfo"][key]!=undefined){dataLayer[index]["userInfo"][key]=value;return}dataLayer.push({"userInfo":{[key]:value}})};
async function updateIesInformation(event){var token=await getToken();if(!token&&!event){document.dispatchEvent(new CustomEvent("userNotAuthenticated"));return}if(!isSubscriptionsSet){setSubscriptions(token);isSubscriptionsSet=true}if(event){var isFound=isUserCredentialsFound(event.detail.userData.role,event.detail.userData.email);if(!isFound)addUserCredentialsToDataLayer(event.detail.userData.role,event.detail.userData.email);document.dispatchEvent(new CustomEvent("userInfoReceived"));return}if(!hasMyAccountMenuComponent()){setUserDetails(token);
document.dispatchEvent(new CustomEvent("userInfoReceived"));return}}function hasMyAccountMenuComponent(){return typeof HEPMC!="undefined"&&Array.isArray(HEPMC.instances)&&HEPMC.instances.find((i)=>i.type==="MyAccountMenuComponent")!=undefined}function setSubscriptions(token){var subscriptionEntitlements=getSubscriptionEntitlements(token);setUserInfoProperty("mojoSubscriptionId",subscriptionEntitlements.subscriptionId);setUserInfoProperty("mojoSubscriptionTier",subscriptionEntitlements.entitlementLevel);
setUserInfoProperty("mojoSubscriptionTitles_PIID",subscriptionEntitlements.entitlementData);setUserInfoProperty("mojoSubscriptionStatus",subscriptionEntitlements.subscriptionStatus)}function isUserCredentialsFound(role,email){return dataLayer.some((item)=>{if(item.userInfo&&item.userInfo.email&&item.userInfo.visitorRole)return true})}function addUserCredentialsToDataLayer(role,email){dataLayer.push({"userInfo":{"visitorRole":role,"email":email}})}function userLoggedInEventHandler(event){var userDetails=
event.detail.userData;setUserInfoProperty("visitorId",piSession.userId());setUserInfoProperty("iesSessionID",piSession.getContextId());setUserInfoProperty("internalCustomer","INTERNAL"==userDetails.userType?"Yes":"No");setUserInfoProperty("visitorType","Logged in");updateIesInformation(event)}function getToken(){return new Promise(function(resolve){if(!window.piSession||!window.piSession.userId()){resolve();return}window.piSession.getToken(function(status,rToken){if(status===window.piSession.Success){resolve(rToken);
return}resolve()})})}function getLocale(){var pathname=window.location.pathname;var localeMatch=pathname.match(/^\/en-([a-zA-Z-]{2,2})[/.]/);var localeFromURL=localeMatch&&localeMatch[1].toLowerCase();var cookieLocale=$.cookie("geotargetchosenlocale");return(localeFromURL||cookieLocale||"").toLowerCase()}function setUserDetails(iesToken){var url="/sling/servlet/default.getUserInfo.json";var locale=localeToSite[getLocale()]||"learner";if(window.piSession&&window.piSession.userId())$.ajax({type:"GET",
url:url,dataType:"json",async:false,headers:{"userId":piSession.userId(),"X-Authorization":iesToken,"locale":locale},success:function(userDetails){dataLayer.push({"userInfo":{"visitorRole":userDetails.role,"email":userDetails.email}});var userInfoEvent=new CustomEvent("userInfoReceived");document.dispatchEvent(userInfoEvent)},error:function(){console.log("Unable to get user data.")}})}function getSubscriptionEntitlements(iesToken){var url="/sling/servlet/default.getSubscriptionEntitlements.json",
subscriptionEntitlements={entitlementLevel:"",entitlementData:[],subscriptionId:getActiveSubscriptionId(iesToken),subscriptionStatus:""},subscriptionEntitlementsResponse;if(window.piSession&&window.piSession.userId()&&subscriptionEntitlements.subscriptionId!=="")$.ajax({type:"GET",url:url,dataType:"json",async:false,headers:{"userId":piSession.userId(),"X-Authorization":iesToken,"subscriptionId":subscriptionEntitlements.subscriptionId},success:function(entitlements){subscriptionEntitlementsResponse=
entitlements;if(entitlements!==null){subscriptionEntitlements.entitlementLevel=entitlements.entitlementLevel;subscriptionEntitlements.entitlementData=entitlements.entitlementData;subscriptionEntitlements.subscriptionId=entitlements.subscriptionId;subscriptionEntitlements.subscriptionStatus=entitlements.status}},error:function(){console.log("Unable to get subscription entitlements.")}});var subscriptionEntitlementsEvent=new CustomEvent("subscriptionEntitlements",{detail:{subscriptionEntitlementsResponse}});
document.dispatchEvent(subscriptionEntitlementsEvent);return subscriptionEntitlements}function getActiveSubscriptionId(iesToken){if(!window.piSession||!window.piSession.userId())return"";var url="/sling/servlet/default.getSubscriptions.json",subscriptionId="",subscriptionsResponse,allowedSubscriptionLevel=["SINGLE","MULTI"];$.ajax({type:"GET",url:url,dataType:"json",async:false,headers:{"userId":piSession.userId(),"X-Authorization":iesToken},success:function(subscriptions){subscriptionsResponse=subscriptions;
if(subscriptions)subscriptions.forEach(function(subscription){var isAllowedSubscriptionLevel=allowedSubscriptionLevel.includes(subscription.entitlementLevel);if(subscription.status==="ACTIVE"&&isAllowedSubscriptionLevel)subscriptionId=subscription.subscriptionId})},error:function(){console.log("Unable to get user subscription id.")}});var subscriptionResponseEvent=new CustomEvent("subscriptionResponseReceived",{detail:{subscriptionsResponse}});document.dispatchEvent(subscriptionResponseEvent);return subscriptionId}
})();
$(window).on("load",function(){var dataLayer=window.dataLayer||[];var isGlobalStore=globalProperties.siteId.startsWith("global-store-en");var element=document.getElementsByClassName("logged_in");var isUserSignedIn=document.querySelector(".userNav.userSignedIn");var isLoggedIn=element.length>0||isUserSignedIn!=null;var defaultB2BUnitDataId=document.getElementById("defaultB2BUnitDataId");var context=defaultB2BUnitDataId&&defaultB2BUnitDataId.getAttribute("data-my-unit-type")==="ORGANIZATION"?"organization":"individual";
var visitorId="";if(isGlobalStore&&(window.piSession&&window.piSession.userId()))dataLayer.push({"userInfo":{"visitorType":"Logged in","context":context}});else if(!isGlobalStore&&isLoggedIn){visitorId=element.length>0?element[0].getAttribute("data-user-id"):"";dataLayer.push({"userInfo":{"visitorType":"Logged in","visitorId":visitorId,"context":context}})}else{visitorId="Anonymous";dataLayer.push({"userInfo":{"visitorType":visitorId,"context":"individual","mojoSubscriptionId":"","mojoSubscriptionTier":"",
"mojoSubscriptionTitles_PIID":[]}})}if(window.CQ||!window.piSession||!window.piSession.userId()){setIesSessionID("");return}if(visitorId===""||getGlobalProperty("ies-sessionid-enabled","false")==="true")callPiSession(getGlobalProperty("ies-sessionid-max-attempts",10),getGlobalProperty("ies-sessionid-timeout",1E3),function(){var dataLayer=window.dataLayer||[];dataLayer.push({"userInfo":{"visitorId":piSession.userId()}});setIesSessionID(piSession.getContextId())},function(){console.log("callPiSession failed");
setIesSessionID("")});else console.log("ies-sessionid-enabled: "+getGlobalProperty("ies-sessionid-enabled","false"));function setIesSessionID(iesSessionID){var dataLayer=window.dataLayer||[];dataLayer.push({"userInfo":{"iesSessionID":iesSessionID}})}function getGlobalProperty(key,defaultValue){if(globalProperties){for(var itemKey in globalProperties.globalProperties)if(globalProperties.globalProperties[itemKey][key])return globalProperties.globalProperties[itemKey][key];return defaultValue}else return defaultValue}
function callPiSession(maxAttempts,timeoutValue,onSuccess,onFail){if(window.piSession.Unknown===window.piSession.hasValidSession(0))if(maxAttempts>0)setTimeout(callPiSession,timeoutValue,maxAttempts-1,timeoutValue,onSuccess,onFail);else onFail();else onSuccess()}});
</script>

</body>
</html>
