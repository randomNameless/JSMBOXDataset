<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main.f394b4c4.html</title>
</head>
<body>

<script>
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a8249ef0-66b3-4022-8f11-2f474813ae2f",e._sentryDebugIdIdentifier="sentry-dbid-a8249ef0-66b3-4022-8f11-2f474813ae2f")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"05b6d5e46fb98c354ba899eb967fcb67e572f8a5"},(()=>{"use strict";var e,t,a,n,r={44956:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(50533),i=a(85846),s=a(45648),o=a(59310);const c=r.forwardRef(((e,t)=>{const a=(0,l.useSelector)(o.yK),{toggleSigninModal:c}=(0,s.EY)(),{to:d,href:m,onClick:u,...p}=e;return a?r.createElement(i.Z,(0,n.Z)({ref:t},e)):r.createElement(i.Z,(0,n.Z)({ref:t},p,{onClick:()=>{c()}}))}))},65838:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(28680);const r="positions",l=(0,n.x)("getPositions",(e=>["positions",{include:["parent"],limit:30,page:e}]),{namespace:r,reducerDefault:"loadMore"}),i={namespace:r,actions:{getAllPositions:()=>async(e,t)=>{const a=["data","positions"];for(;!t().getIn([...a,"noMore"]);)await e(l.action((t().getIn([...a,"currentPage"])??0)+1));return!0}},reducer:l.reducer}},15490:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(72739);const r="communityApplication",l=(0,a(28680).x)("getInvolvements",(e=>[`/users/${e}/involvements`,{limit:100,include:["entry"]}]),{namespace:r,reducerDefault:"result"}),i={namespace:r,actions:{[l.name]:l.action},reducer:(e,t)=>(0,n.U)({involvements:l.reducer})(e,t)}},93760:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(3024),l=a(85846),i=a(85896);const s=n.forwardRef(((e,t)=>{let{title:a,backTo:r,extra:s,style:o}=e;const c=(0,i.pC)(r);return n.createElement("div",{className:"am_card_header",ref:t,style:o},c&&n.createElement(l.Z,{plain:!0,className:"am_card_header_back",icon:["gfas","angle-left"],onClick:c},"返回"),n.createElement("h3",null,a),n.createElement("span",{className:"am_card_header_right"},s))})),o=e=>{let{className:t,title:a,children:l,backTo:i,extra:o,sticky:c=!0}=e;return i?c?n.createElement("div",{className:t},n.createElement(r.Z,{innerZ:10},n.createElement(s,{title:a,backTo:i,extra:o})),l):n.createElement("div",{className:t},n.createElement(s,{title:a,backTo:i,extra:o}),l):n.createElement("div",{className:t},a&&o&&n.createElement(s,{title:a,extra:o}),l)}},14761:(e,t,a)=>{a.d(t,{OS:()=>d,ZP:()=>m});var n=a(67294),r=a(3024),l=a(45841),i=a(52004);let s=function(e){return e[e.Normal=0]="Normal",e[e.Sticky=1]="Sticky",e[e.Mobile=2]="Mobile",e}({});const o=n.createContext({status:s.Normal});var c=a(85896);const d=e=>{let{children:t,fixed:a=!0,bottom:r=!1,top:l=!1}=e;const{status:c}=(0,n.useContext)(o),d=c===s.Sticky&&!a||c===s.Mobile&&!l&&!r;return n.createElement("div",{style:{display:d?"none":void 0},className:(0,i.Z)({"flowLayout_sideItem-btm":c===s.Mobile&&r,"flowLayout_sideItem-top":c===s.Mobile&&l})},t)},m=e=>{let{renderSide:t,children:a,className:d}=e;const[m,u]=(0,n.useState)(void 0),p=(0,c.$0)("flowLayout");(0,n.useEffect)((()=>{const e=()=>{const e=(0,l.Ty)(".flowLayout");u("mobile"===e)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);return n.createElement("div",{className:(0,i.Z)("pageContainer",d)},n.createElement("div",{className:"flowLayout"},n.createElement("div",{className:"flowLayout_main"},a),!0===m||void 0===m?n.createElement("div",{className:"flowLayout_side"},n.createElement("div",{className:"flowLayout_sideContent"},n.createElement(o.Provider,{value:{status:!0===m?s.Mobile:s.Normal}},t()))):n.createElement("div",{className:"flowLayout_side",id:p},n.createElement(r.Z,{bottomBoundary:`#${p}`,innerZ:10},(e=>{const a=e.status===r.Z.STATUS_FIXED;return n.createElement("div",{className:"flowLayout_sideContent"},n.createElement(o.Provider,{value:{status:a?s.Sticky:s.Normal}},t()))})))))}},165:(e,t,a)=>{a.d(t,{Z:()=>f});var n=a(67294),r=a(85846),l=a(80239),i=a(73126),s=a(28326);const o=e=>{let{visible:t,close:a,data:r,onConfirm:l,...o}=e;const c=(0,n.useCallback)((e=>{l(e)}),[l]);return n.createElement(s.Z,(0,i.Z)({storyEditorContext:!1,visible:t,close:a,onConfirmClick:c,galleryEditorProps:{onlyImages:!0},data:r},o))};var c=a(733),d=a.n(c),m=a(4250),u=a(35018),p=a(72753),g=a(85896),h=a(45578),v=a.n(h);const E=e=>v()(e,(e=>e.path)),f=e=>{let{value:t,onChange:a}=e;const i=(0,g.$0)("images-uploader"),[s,c]=(0,n.useState)(!1),h=(0,p.nO)(),[v,f]=(0,n.useState)(!1),y=(0,g.II)(a),b=(0,g.II)(t),k=()=>{h?(0,p.pj)("upload-image",{key:i,maxSelectedAssets:9}):c(!0)};return(0,n.useEffect)((()=>{const e=e=>{var t;if(null==e||null===(t=e.data)||void 0===t||!t.data)return;const{data:a}=e.data;a.key===i&&("uploading"===a.state?f(!0):"uploaded"!==a.state&&"error"!==a.state||(f(!1),"uploaded"===a.state&&y.current(E([...b.current,{path:a.path}]))))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[i,y,b]),void 0===h?null:n.createElement("div",{className:"gallerySliderEditor"},n.createElement(o,{visible:s,data:{images:t},close:()=>{c(!1)},onConfirm:e=>{let{images:t}=e;a(E(t))},countLimit:9}),n.createElement(m.Z,{variableWidth:!0,circleArrow:!0,slidesToShow:1},t.length<9&&n.createElement("div",{className:"slick-item"},n.createElement("div",{className:"gallerySliderEditor_item"},n.createElement(r.Z,{className:"gallerySliderEditor_addBtn",plain:!0,onClick:k},v?n.createElement(d(),{type:"bubbles",color:"#999",height:50,width:50}):"+"))),t.map((e=>{let{path:i}=e;return n.createElement("div",{key:i,className:"slick-item"},n.createElement("div",{className:"gallerySliderEditor_item"},n.createElement(r.Z,{className:"gallerySliderEditor_item_mask",plain:!0,onClick:k}),n.createElement(r.Z,{plain:!0,className:"gallerySliderEditor_item_close",onClick:()=>{a(t.filter((e=>e.path!==i)))}},n.createElement(u.Z,{icon:["gfas","times-circle"]})),n.createElement("img",{src:(0,l.cR)(i,{resize:{m:"lfit",w:180,h:180}})})))}))))}},19045:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(67294),r=a(35218),l=a(91433),i=a(52004),s=a(80239);const o=e=>{let{tag:t}=e;const a="string"==typeof t;return n.createElement("span",{className:(0,i.Z)("game_label",{is_highlight:a})},a?t:t.getAttr("name"))},c=e=>{let{game:t,className:a,meta:c,horizental:d=!1,talksPlaceholder:m="有新动态"}=e;const u=((e,t,a)=>{let n=e;return t&&(n=n.unshift("BOOOM作品")),a&&(n=n.unshift("机核发行")),n})(t.getSortedTags(),t.isBooom(),t.isGcoresPublishing()),p=t.getCover(),g=c?n.createElement("div",{className:"news_meta"},c):(null==u?void 0:u.size)>0?n.createElement("div",{className:"news_meta"},u.map((e=>n.createElement(o,{tag:e,key:"string"==typeof e?e:e.getKey()})))):null,h=t.getAttr("content-count")>10?`${t.getAttr("content-count")} 动态`:m;return n.createElement(r.Z,{className:(0,i.Z)("news game",{"game-horizental":d},a),to:(0,l.ZP)(t)},n.createElement("div",{style:p?{backgroundImage:`url(${(0,s.cR)(p,{resize:{w:230,m:"lfit"}})})`}:void 0,className:"news_imgArea"},n.createElement("div",{className:"news_imgArea_cover"})),n.createElement("div",{className:"game_main"},n.createElement("div",{className:"news_content"},n.createElement("h3",null,t.getAttr("title").replace("【BOOOM】",""))),g,h&&n.createElement("div",{className:"game_talksCount"},h)))}},39047:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(73126),r=a(35369),l=a(67294),i=a(52004);const s=(e,t,a)=>e.map((e=>({node:e,children:s(t.filter((t=>t.getRel(a,"id")===e.get("id"))),t,a)}))),o=(e,t)=>e.map((e=>{return a=e,t.find((e=>e.get("id")===a));var a}));var c=a(85846);const d=e=>{let{option:t,titleField:a,active:n,columnIndex:r,onClick:s}=e;return l.createElement(c.Z,{plain:!0,className:(0,i.Z)("multilevelSelector_option",{is_active:n}),onClick:()=>{s(t,r)}},t?t.node.getAttr(a):"—")};var m=a(14017),u=a.n(m);const p=e=>{let{className:t,data:a,parentField:c,titleField:m="title",onlyParent:p,children:g,value:h,onChange:v}=e;const E=(0,l.useMemo)((()=>{return t=c,s((e=a).filter((e=>!e.getRel(t))),e,t);var e,t}),[a,c]),[f,y]=(0,l.useState)(!1),[b,k]=(0,l.useState)([]),C=[null,...b],_=(e,t)=>{let n=b;if(e){const{node:a,children:r}=e;if(n=[...b.slice(0,t),a.get("id")],k(n),r.size>0)return}else n=b.slice(0,t),k(n);const l=o(n,a);v(l.map((e=>e.get("id"))),(0,r.List)(l)),y(!1)},w=f?l.createElement("div",{className:(0,i.Z)("multilevelSelector_list",t)},C.map(((e,t)=>{const a=C.slice(0,t+1),i=C[t+1],s=((e,t)=>{const a=(0,r.List)();let n=a;for(const r of e){var l;n=null===r?t:(null===(l=n.find((e=>e.node.get("id")===r)))||void 0===l?void 0:l.children)||a}return n})(a,E);if(0===s.size)return null;const o={titleField:m,onClick:_,columnIndex:t};return l.createElement("ul",{className:"multilevelSelector_column",key:e||"first"},e&&p&&l.createElement(d,(0,n.Z)({},o,{option:null,active:!1})),s.map((e=>l.createElement("li",{key:e.node.getKey()},l.createElement(d,(0,n.Z)({},o,{option:e,active:i===e.node.get("id")}))))))}))):null;return l.createElement(u(),{onClickOutside:()=>{y(!1)}},l.createElement("div",{className:(0,i.Z)("multilevelSelector")},g({selectedItems:o(h,a),showSelector:()=>{y(!0)}}),w))}},24757:(e,t,a)=>{a.d(t,{Z:()=>P});var n=a(73126),r=a(94184),l=a.n(r),i=a(35369),s=a(67294),o=a(50533),c=a(80675),d=a(28718),m=a(85551),u=a(71405),p=a(80239),g=a(49766),h=a(24320),v=a(26707),E=a(85846),f=a(74612),y=a(35018),b=a(34282),k=a(35218),C=a(20227),_=a(59310),w=a(78989);class N extends b.Z{state={actionSheetVisible:!1};getAuthor(e){const{original:t}=this.props,a=t.getRel("djs"),n=t.getRel("user");return i.List.isList(a)&&a.size>0?e?a.sort(((t,a)=>t.get("id")===e.get("id")?-1:0)):a:n}getAvatarSize(){const{feedStyle:e,focus:t}=this.props;return e?void 0:t?"xs":"xs-m1"}getPath(){const{original:e,path:t}=this.props;return t||(e=>(0,d.D)(e.get("type"),e.get("id")))(e)}handlePlayClick=()=>{const{original:e,dispatch:t}=this.props;t((0,c.lMO)(e))};handleAddClick=()=>{const{original:e,dispatch:t}=this.props;t((0,c.KTf)(e))};renderCover=()=>{const{original:e,hidePlayableBtns:t}=this.props,a=this.getPath(),r=e.isRadio()&&!t?{onClick:this.handlePlayClick}:{to:a};return s.createElement(s.Fragment,null,s.createElement(E.Z,{className:"original_imgArea_cover",to:a,plain:!0,anchor:!0},!e.isVolume()&&s.createElement("p",{className:"original_imgArea_desc"},e.getAttr("desc"))),e.isVolume()&&!t&&s.createElement(E.Z,(0,n.Z)({className:"original_imgArea_play"},r,{plain:!0,anchor:!0}),s.createElement("img",{src:C,alt:"play"})))};renderThumb(){const{original:e,feedStyle:t,hidePlayableBtns:a,metaContent:n}=this.props,r=e.getAttr("thumb"),l={backgroundImage:r&&`url(${(0,p.cR)(r,{resize:{w:t?532:313,m:"lfit"}})})`};if(!e.getPublishStatus().isLegal)return s.createElement(E.Z,{plain:!0,style:l,className:"original_imgArea",to:this.getPath()});const i=n?s.createElement("span",{className:"original_imgArea_info"},n):e.isVolume()&&e.getAttr("duration")>0?s.createElement("span",{className:"original_imgArea_info"},s.createElement(y.Z,{icon:["gfas",e.isRadio()?"music":"film"],className:"me-2"}),(0,m.dB)(e.getAttr("duration"))):null;return s.createElement("div",{style:l,className:"original_imgArea"},this.renderCover(),i,e.isRadio()&&!a&&s.createElement(E.Z,{className:"original_imgArea_addRadio",onClick:this.handleAddClick,plain:!0,anchor:!0},s.createElement(y.Z,{icon:["gfas","plus"]})))}renderCategory(){const{original:e}=this.props,t=e.getRel("category");return t?s.createElement("div",{className:"am_card_info mt-0"},s.createElement(g.Z,{categoryID:t.get("id")},(e=>s.createElement("span",(0,n.Z)({},e,{className:"original_category"}),s.createElement(k.Z,{to:(0,d.Z)("category",{id:t.get("id")})},t.getAttr("name")))))):null}renderUser(){const{original:e,actor:t}=this.props,a=this.getAvatarSize(),n=e.getPublishStatus().isLegal?s.createElement("div",{className:"original_createdDate avatar_sub",suppressHydrationWarning:!0},(0,m.Sy)(e.getAttr("published-at"))):s.createElement("span",{className:"u_color-theme-warning"},"未发布");if(t&&"users"!==t.get("type"))return s.createElement(v.Z,{users:t,size:a,to:(0,d.Z)(t),name:t.getTitle(),nameLimit:10,subText:n});const r=this.getAuthor(t);return r?s.createElement(h.Z,{users:r,subText:n,size:a}):s.createElement("span",null)}renderHead(){const{currentUser:e,original:t,showPortfolioOptions:a}=this.props,n=(null==e?void 0:e.get("id"))===t.getRel("user","id")&&a;return s.createElement("div",{className:"original_head"},this.renderUser(),n&&s.createElement(E.Z,{plain:!0,onClick:()=>{this.setState({actionSheetVisible:!0})},className:"o_moreIcon"},s.createElement(y.Z,{icon:["gfas","more"]})))}renderBtm(){const{feedStyle:e,searchResultStyle:t,original:a}=this.props;return e?a.getPublishStatus().isLegal?s.createElement(f.Z,{item:a}):s.createElement("div",{className:"cardBtmActions"},s.createElement("div",null,s.createElement(E.Z,{plain:!0,to:(0,d.Z)("originalEditor",{id:a.get("id"),type:a.get("type")}),className:"cardBtmAction"},"编辑"))):s.createElement("div",{className:"am_card_btm original_btm"},!t&&this.renderUser(),s.createElement("div",null,s.createElement("span",{className:"me-3"},s.createElement(y.Z,{icon:["gfas","thumbs-up"],className:"me-1 u_color-gray-icon"}),(0,p.Zx)(a.getAttr("likes-count"))),s.createElement("span",null,s.createElement(y.Z,{icon:["gfas","comment"],className:"me-1 u_color-gray-icon"}),(0,p.Zx)(a.getAttr("comments-count")))))}render(){const{original:e,focus:t,searchResultStyle:a,className:n,feedStyle:r,categoryContent:i,title:o,titleMoreInfo:c,hidePlayableBtns:d,onRemoveFromPortfolio:m}=this.props,{actionSheetVisible:p}=this.state;if(!e)return null;const g=this.getPath(),h=!a&&!r,v=h||i;return s.createElement(s.Fragment,null,s.createElement(w.Z,{work:e,visible:p,onSuccess:()=>{null==m||m(e.get("type"),e.get("id")),this.setState({actionSheetVisible:!1})},onClose:()=>{this.setState({actionSheetVisible:!1})}}),s.createElement("div",{className:l()("original","am_card",{"original-focus":t,"original-feed":r,"original-normal":!t&&!r,"original-volume":e.isVolume(),"original-radio":e.isRadio(),"original-article":!e.isVolume(),"original-withoutAddBtn":d},n)},r&&this.renderHead(),this.renderThumb(),s.createElement("div",{className:"am_card_inner"},i?s.createElement("div",{className:"am_card_info mt-0"},i):h?this.renderCategory():null,s.createElement(k.Z,{to:g},s.createElement("h3",{title:o||e.getAttr("title"),className:l()("am_card_title",{"mt-0":!v})},o||e.getAttr("title"),c?s.createElement("small",null,c):null),(r||t)&&s.createElement("p",{className:"am_card_desc"},r&&(0,u.io)(e.getAttr("excerpt"),100)||e.getAttr("desc"))),this.renderBtm())))}}const P=(0,o.connect)(((e,t)=>({currentUser:(0,_.ib)(e)})))(N)},29622:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),r=a(52004);const l=e=>{let{children:t,className:a}=e;return n.createElement("div",{className:(0,r.Z)("pageContainer",a)},n.createElement("div",{className:"container"},t))}},11998:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(67294),r=a(52004),l=a(80239);const i=e=>{let{showPrice:t,originalPrice:a,className:i}=e;return"number"!=typeof t?null:n.createElement("div",{className:(0,r.Z)("productPrice",i)},n.createElement("h3",null,(0,l.T4)(t)),a&&a>t&&n.createElement("span",null,(0,l.T4)(a)))}},41729:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(50533),l=a(59310),i=a(11998);const s=e=>{let{product:t,className:a}=e;const s=(0,r.useSelector)(l.ib);if(!t)return null;const[o,c]=t.getPriceInfo(null==s?void 0:s.getAttr("has-membership"));return n.createElement(i.Z,{showPrice:o,originalPrice:c,className:a})}},37813:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(85846),l=a(52004),i=a(80239);const s=e=>{let{item:t,onClick:a}=e;const s=t.get("type"),o=t.getTitle(),c=(e=>"radios"===e.get("type")?e.getAttr("cover"):e.getThumb())(t),d={albums:{w:68,h:68},radios:{w:68,h:68},products:{w:68,h:68},games:{w:92,h:44}}[s]||{w:120,h:68};return n.createElement(n.Fragment,null,n.createElement(r.Z,{className:(0,l.Z)("topicEditor_searchItem",{[`topicEditor_searchItem-${s}`]:s}),plain:!0,onClick:()=>{a(t)}},n.createElement("img",{src:(0,i.cR)(c,{resize:{...d},bright:i.jh}),alt:o}),n.createElement("h3",null,o)),n.createElement("hr",null))}},66437:(e,t,a)=>{a.d(t,{Z:()=>y,z:()=>h});var n=a(67294),r=a(50533),l=a(80675),i=a(10671),s=a(83476),o=a(33529),c=a(84644),d=a(1145),m=a(85896),u=a(59310),p=a(80239),g=a(37813);const h=e=>"albums"===e?"播单/有声书":p.AS[e],v=(0,u.P1)((e=>e.getIn(["data","topics","initialResults","ids"])),u.LF,((e,t)=>(0,d.BY)(e,t,{depth:5}))),E=(0,u.P1)((e=>e.getIn(["data","topics","repostSearchResults","ids"])),u.LF,((e,t)=>(0,d.BY)(e,t,{depth:5}))),f={dispatchSearch:l.rIL,dispatchGetInitialData:l.oZg},y=(0,r.connect)(((e,t)=>({initialResultsData:e.getIn(["data","topics","initialResults"]),initialResults:v(e),results:E(e),resultsData:e.getIn(["data","topics","repostSearchResults"])})),f)((e=>{let{initialResultsData:t,initialResults:a,resultsData:r,results:l,title:d,type:u,close:h,onSelect:v,dispatchSearch:E,dispatchGetInitialData:f}=e;const[y,b]=(0,n.useState)(""),k=y.length>0,C=k?l:a,_=k?r:t,w=(0,n.useRef)(u);w.current!==u&&(b(""),w.current=u);const{props:N,ref:P}=(0,c.kL)("topicEditor_repostSearchResults"),S=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(_.get("currentPage")??0)+1;e&&t.length>0&&await E({type:e,query:t},{page:a,meta:{refresh:1===a}})}),[E,u,y,_]),Z=(0,m.II)(S),I=(0,n.useCallback)((async()=>{var e,t;null===(e=P.current)||void 0===e||null===(t=e.scrollToTop)||void 0===t||t.call(e),y?await Z.current(u,y,1):u&&await f(u)}),[u,y,f,Z,P]);return n.createElement(o.Z,{title:d||`添加关联${p.AS[u]||""}`,width:500,visible:!!u,hideActionBtns:!0,onCloseClick:()=>{h()}},n.createElement(i.Z,{loading:_.get("isRequesting"),onSearch:e=>{b(e)},showCancel:k,onCancelClick:()=>{b("")}}),n.createElement(s.Z,{data:C,scrollableProps:N,state:_,onLoad:S,onInit:I},(e=>e.map((e=>n.createElement(g.Z,{key:e.getKey(),item:e,onClick:()=>{h(),v(e)}}))))))}))},23813:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(73126),r=a(67294),l=a(35018),i=a(85846),s=a(52004);const o=(e,t)=>t?r.createElement(i.Z,(0,n.Z)({},t,{plain:!0}),e):r.createElement("span",null,e),c=r.createElement("span",{className:"ps-3 ah_title_arrow"},r.createElement(l.Z,{icon:["gfas","angle-right"],className:"fa-sm"})),d=e=>{let{className:t,children:a,title:n,subTitle:l,moreTo:i,onMoreClick:d,titleClickable:m=!0,more:u}=e;const p=i||d?{onClick:d,to:i}:void 0,g=!!p&&m,h=!!p&&!m,v=r.createElement(r.Fragment,null,n,l&&r.createElement("span",{className:"ah_title_sub"},l),g&&c);return r.createElement("div",{className:(0,s.Z)("ah_section",t)},r.createElement("h2",{className:"ah_title"},o(v,m?p:void 0),u||(h?o(c,p):null)),a)}},6974:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(52004),l=a(28718),i=a(80239),s=a(35218);const o=e=>{let{originals:t,onlyTitle:a=!1}=e;return n.createElement("ul",{className:"sideOriginals"},t.map((e=>{const t=(0,i.cR)(e.getAttr("thumb"),{resize:{w:110,h:75}});return n.createElement("li",{key:e.getKey()},n.createElement(s.Z,{className:(0,r.Z)("sideOriginal",a?"sideOriginal-title":""),to:(0,l.D)(e.get("type"),e.get("id"))},!a&&n.createElement("img",{src:t,className:"sideOriginal_img"}),n.createElement("div",{className:"sideOriginal_content"},n.createElement("h3",null,e.getAttr("title")),n.createElement("p",null,n.createElement("span",null,(0,i.Zx)(e.getAttr("likes-count"))," 喜欢"),"•",n.createElement("span",null,(0,i.Zx)(e.getAttr("comments-count"))," ","评论")))))})))}},60843:(e,t,a)=>{a.d(t,{Mp:()=>d,ZP:()=>m});var n=a(73126),r=a(67294),l=a(85846),i=a(52004),s=a(44956);const o=e=>t=>r.createElement(e,(0,n.Z)({},t,{plain:!0,className:(0,i.Z)("sideButton","am_card","am_card_inner",t.className)})),c=o(l.Z),d=o(s.Z),m=c},29173:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),r=a(52004);const l=e=>{let{title:t,className:a,children:l}=e;return n.createElement("div",{className:(0,r.Z)("am_card",a)},t&&n.createElement("h2",{className:"am_card_header"},t),n.createElement("div",{className:"am_card_inner"},l))}},4250:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(73126),r=a(67294),l=a(46066),i=a(20525),s=a(51206),o=a(52004);const c=[1396,1256,1024,576];function d(e){return e instanceof Array?e.map(((e,t)=>"number"==typeof e?{breakpoint:c[t],settings:{slidesToShow:e,slidesToScroll:e}}:{breakpoint:e.breakpoint,settings:"number"==typeof e.settings?{slidesToShow:e.settings,slidesToScroll:e.settings}:e.settings})):null}const m=e=>{let{skeleton:t=r.createElement(i.Z,{height:"200px"}),...a}=e;const[c,m]=(0,r.useState)(!1),u=function(e){let{slidesToShowResponsive:t,circleArrow:a,...n}=e;const{variableWidth:l,vertical:i,className:c,slidesToShow:m=5,...u}=n,p=i?["up","down"]:["left","right"],[g,h]=p;return{variableWidth:l,vertical:i,className:(0,o.Z)(i?"slick-vertical":"slick-horizontal",{"slick-variableWidth":l,"slick-circleArrow":a},c),slidesToShow:m,draggable:!1,slidesToScroll:m,infinite:!1,touchThreshold:1e3,prevArrow:r.createElement(s.Z,{icon:!0,direction:g}),nextArrow:r.createElement(s.Z,{icon:!0,direction:h}),responsive:d(t),...u}}(a),{onInit:p}=u;return r.createElement(r.Fragment,null,!c&&t,r.createElement(l.Z,(0,n.Z)({},u,{onInit:()=>{m(!0),null==p||p()},className:(0,o.Z)(u.className,{"slider-loading":!c})})))};m.defaultProps={slidesToShowResponsive:void 0,circleArrow:!1};const u=m},29203:(e,t,a)=>{a.d(t,{Z:()=>S});var n=a(67294),r=a(33529),l=a(73126),i=a(50533),s=a(85846),o=a(10671),c=a(83476),d=a(84644),m=a(50718),u=a(1145),p=a(85896),g=a(52004),h=a(59310),v=a(23274),E=a(80675),f=a(70315);const y=e=>{let{title:t,catalog:a,currentCid:r,currentUser:l,dispatchLoadTopics:i,onClick:o}=e;const c="string"==typeof a?a:a.get("id");return n.createElement("li",null,n.createElement(s.Z,{plain:!0,className:(0,g.Z)("topicCatalogs_catalog",{is_active:c===r}),onClick:()=>{o(c)}},t))},b=(0,h.P1)((e=>e.getIn(["data","topics","topicCategories","ids"])),h.LF,((e,t)=>(0,u.BY)(e,t))),k=e=>e.getIn(["data","topics","catalogTopics"]),C=(0,h.P1)((e=>{var t;return null===(t=k(e))||void 0===t?void 0:t.get("ids")}),h.LF,((e,t)=>(0,u.BY)(e,t))),_=e=>e.getIn(["data","topics","topicSearchResults"]),w=(0,h.P1)((e=>{var t;return null===(t=_(e))||void 0===t?void 0:t.get("ids")}),h.LF,((e,t)=>(0,u.BY)(e,t))),N={dispatchLoadTopics:v.BBt,dispatchSearch:E.lV6,dispatchGetCategories:E.BzH},P=(0,i.connect)(((e,t)=>({catalogs:b(e),topics:C(e),topicsData:k(e),searchedTopics:w(e),searchedTopicsData:_(e),currentUser:(0,h.ib)(e)})),N)((e=>{let{onTopicChoose:t,currentTopic:a,topicsData:r,catalogs:i,topics:u,searchedTopics:g,searchedTopicsData:h,dispatchLoadTopics:v,dispatchGetCategories:E,dispatchSearch:b,currentUser:k}=e;const[C,_]=(0,n.useState)(""),[w,N]=(0,n.useState)(m.Od.HOT_TOPICS_CATALOG_ID),P={currentTopic:a,dispatchLoadTopics:v,currentUser:k,onClick:e=>{N(e),_("")}},S=C.length>0,Z=S?g:u,I=S?h:r,T=I.get("currentPage")??0,{ref:A,props:R}=(0,d.kL)("topicCatalogs_topics"),D=(0,n.useCallback)((async function(){let{cid:e=w,searchText:t=C,page:a=T+1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n={page:a,meta:{refresh:1===a}};t?await b({query:t},n):e&&await v({id:e,currentUserId:null==k?void 0:k.get("id")},n)}),[k,w,T,C,v,b]),x=(0,p.II)(D),M=(0,n.useCallback)((async()=>{var e;null===(e=A.current)||void 0===e||e.scrollToTop(),await x.current({cid:w,searchText:C,page:1})}),[w,C,x,A]);return(0,n.useEffect)((()=>{0===i.size&&E()}),[i.size,E]),n.createElement("div",null,n.createElement(o.Z,{className:"mb-3",showCancel:S,onSearch:e=>{_(e)},onCancelClick:()=>{_("")}}),n.createElement("div",{className:"topicCatalogs"},!S&&n.createElement("ul",{className:"topicCatalogs_catalogs"},k&&n.createElement(y,(0,l.Z)({currentCid:w,title:"收藏",key:m.Od.SUBSCRIBED_TOPICS_CATALOG_ID,catalog:m.Od.SUBSCRIBED_TOPICS_CATALOG_ID},P)),n.createElement(y,(0,l.Z)({currentCid:w,title:"热门",key:m.Od.HOT_TOPICS_CATALOG_ID,catalog:m.Od.HOT_TOPICS_CATALOG_ID},P)),i.map((e=>n.createElement(y,(0,l.Z)({title:e.getAttr("name"),key:e.getKey(),catalog:e,currentCid:w},P))))),n.createElement(c.Z,{scrollableProps:R,data:Z,state:I,onInit:M,onLoad:D},(e=>e.map((e=>n.createElement(s.Z,{plain:!0,className:"topicCatalogs_topic",key:e.getKey(),onClick:()=>{t(e)}},n.createElement(f.Z,null,e.getAttr("title")))))))))})),S=e=>{let{visible:t,onClose:a,topic:l,onChange:i}=e;return n.createElement(r.Z,{width:500,visible:t,title:"全部话题",contentLabel:"Modal",hideActionBtns:!0,onCloseClick:()=>{a()}},n.createElement(P,{currentTopic:l,onTopicChoose:e=>{a(),i(e)}}))}},70315:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),r=a(52004);const l=e=>{let{children:t,tagStyle:a=!1,tagStyleNoBg:l=!1,tagStyleGray:i=!1}=e;const s=(0,n.useMemo)((()=>{if("string"!=typeof t||0===t.length)return t;const e=t.trim(),a=((e,t)=>{const a=e.codePointAt(t);return String.fromCodePoint(a)})(e,0).length;e.slice(0,a),e.slice(a);return n.createElement(n.Fragment,null,t,null)}),[t]);return n.createElement("span",{className:(0,r.Z)("topicName",{topicTag:a,"topicTag-noBg":a&&l,"topicTag-gray":a&&i})},s)}},69757:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(28680);const r="catalogTags",l=(0,n.x)("getCatalogTags",(e=>["catalog-tags",{filters:{"tag-type":"Catalog"},include:["parent-tag"],limit:30,page:e}]),{namespace:r,reducerDefault:"loadMore"}),i={namespace:r,actions:{getAllCatalogTags:()=>async(e,t)=>{const a=["data","catalogTags"];for(;!t().getIn([...a,"noMore"]);)await e(l.action((t().getIn([...a,"currentPage"])??0)+1));return!0}},reducer:l.reducer}},59170:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(50533),l=a(45236),i=a(45648),s=a(28816);const o=e=>{let{portfolio:t,visible:a,onClose:o,onSuccess:c}=e;const{sendPopMessage:d}=(0,i.EY)(),m=(0,r.useDispatch)(),u=(0,n.useMemo)((()=>[{title:"仅删除作品合集",danger:!0,onClick:()=>{d({title:"删除作品合集",body:`你确定删除作品合集“${t.getAttr("title")}”吗？合集中的内容会从此合集中释放，单独在作品列表展示`,modalProps:{confirmBtnText:"删除",confirmBtnProps:{type:"danger"},onConfirmClick:async()=>!(await m((0,s.D$)({workId:t.get("id"),workType:"portfolios",removePortfolioType:"onlySelf"}))).error&&(null==c||c(),!0)}})}},{title:"删除作品合集并移除作品",danger:!0,onClick:()=>{d({title:"删除作品合集并移除作品",body:`你确定删除作品合集“${t.getAttr("title")}”并移除所有作品吗？合集中的内容不会被删除，仍可从动态中查看`,modalProps:{confirmBtnText:"删除",confirmBtnProps:{type:"danger"},onConfirmClick:async()=>!(await m((0,s.D$)({workId:t.get("id"),workType:"portfolios",removePortfolioType:"containChildren"}))).error&&(null==c||c(),!0)}})}},{title:"取消",requestClose:!0}]),[m,c,t,d]);return n.createElement(l.Z,{options:u,visible:a,onClose:o})}},57288:(e,t,a)=>{a.d(t,{Z:()=>_});var n=a(73126),r=a(67294),l=a(66688),i=a(50533),s=a(33529),o=a(69951),c=a(23736),d=a(59310),m=a(14810),u=a(22134),p=a(52004),g=a(80239),h=a(85846),v=a(35018);const E=e=>{let{onClick:t,type:a}=e;return r.createElement(h.Z,{plain:!0,className:(0,p.Z)("redirectSelector"),onClick:t},r.createElement("span",{className:"redirectSelector_icon"},r.createElement(v.Z,{icon:["gfas","plus"]})),"添加关联",a&&g.AS[a]||"内容")};var f=a(66437);const y=e=>{let{game:t,onChange:a}=e;const[n,l]=(0,r.useState)(!1);return t?r.createElement(u.Z,{type:"games",title:t.getAttr("title"),cover:t.getAttr("cover"),onClose:()=>{a(null)}}):r.createElement(r.Fragment,null,r.createElement(f.Z,{type:n?"games":null,close:()=>{l(!1)},onSelect:e=>{a(e)}}),r.createElement(E,{type:"games",onClick:()=>{l(!0)}}))},b=e=>{let{input:t}=e;return r.createElement(y,{game:t.value,onChange:e=>{t.onChange(e)}})},k="portfolioEditorForm",C={dispatchSubmit:(e,t)=>{let{id:a,currentUserId:n}=t;if(!n)return;const r=a?`portfolios/${a}`:"portfolios";return(0,m.D1)(r,{method:a?"PATCH":"POST",body:{data:{type:"portfolios",...a?{id:a}:null,attributes:{title:e.title,description:e.description},relationships:{user:{data:{id:n,type:"users"}},games:{data:e.game?[{id:e.game.get("id"),type:"games"}]:[]}}}}})}},_=(0,i.connect)(((e,t)=>({currentUser:(0,d.ib)(e)})),C)((e=>{let{defaultValue:t,onClose:a,onConfirm:i,confirmText:d,currentUser:m,dispatchSubmit:u}=e;const p=(0,r.useMemo)((()=>t?{title:t.getAttr("title"),description:t.getAttr("description"),game:t.getRel([["games",0]])}:{game:null}),[t]),g=(0,r.useCallback)((async e=>{const a=await u(e,{id:null==t?void 0:t.get("id"),currentUserId:null==m?void 0:m.get("id")});a.error||i(a)}),[u,t,m,i]);return r.createElement(l.l0,{onSubmit:g,initialValues:p},(e=>{let{handleSubmit:t,submitting:i}=e;return r.createElement(s.Z,{visible:!0,title:"新建作品合集",titleBar:!0,onConfirmClick:()=>{(0,o.Ps)(k)},onCloseClick:()=>{a()},confirmBtnText:d,confirmBtnProps:{loading:i}},r.createElement("form",{onSubmit:t,id:k},r.createElement(l.gN,(0,n.Z)({label:"标题",name:"title",placeholder:"请填写合集标题(最多10个字符)"},(0,c.Cr)([e=>(null==e?void 0:e.length)>10?"最多10个字符":void 0])),o.CF),r.createElement(l.gN,{label:"简介",componentType:"textarea",name:"description",placeholder:"请填写作品合集简介(选填)",wordsLimit:500,validate:e=>{if(e&&e.length>500)return"最多500个字符"}},o.CF),r.createElement(l.gN,{name:"game"},b)))}))}))},51831:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(72739);const r="portfolioSelector",l=(0,a(28680).x)("getPortfolios",((e,t)=>[`users/${e}/portfolios`,{page:t}]),{namespace:r,reducerDefault:"loadMore"}),i={namespace:r,actions:{[l.name]:l.action},reducer:(0,n.U)({portfolios:l.reducer})}},78989:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(50533),l=a(45236),i=a(45648),s=a(28816);const o=e=>{let{work:t,visible:a,onSuccess:o,onClose:c}=e;const{sendPopMessage:d}=(0,i.EY)(),m=(0,r.useDispatch)(),u=(0,n.useMemo)((()=>{const e=t.getRel([["portfolios",0]]),a=e?"将作品移出合集并移除作品":"移除作品";return[e?{title:"仅将作品移出合集",danger:!0,onClick:()=>{d({title:"移出合集",body:`你确定要将“${t.getTitle()}”移出合集吗？发布内容不会被删除，仍可从动态中查看`,modalProps:{confirmBtnText:"移出",confirmBtnProps:{type:"danger"},onConfirmClick:async()=>!(await m((0,s.wI)({id:t.get("id"),workType:t.get("type"),portfolio:null,successTip:"移出合集成功"}))).error&&(null==o||o(),!0)}})}}:null,{title:a,danger:!0,onClick:()=>{d({title:a,body:`你确定要将“${t.getTitle()}”移出合集并从作品中移除吗？发布内容不会被删除，仍可从动态中查看`,modalProps:{confirmBtnText:"移除",confirmBtnProps:{type:"danger"},onConfirmClick:async()=>!(await m((0,s.D$)({workId:t.get("id"),workType:t.get("type")}))).error&&(null==o||o(),!0)}})}},{title:"取消",requestClose:!0}].filter((e=>e))}),[t,m,o,d]);return n.createElement(l.Z,{options:u,visible:a,onClose:c})}},5396:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(85846),l=a(35018),i=a(35218),s=a(80239);const o=e=>{let{cover:t,title:a,info:o,link:c,onMoreClick:d}=e;const m=(0,s.qz)(t,{resize:{w:166,m:"lfit"},bright:s.jh});return n.createElement("div",{className:"workExhibition"},n.createElement(i.Z,{to:c,className:"workExhibition_cover",style:{backgroundImage:`url(${m})`}}),n.createElement("div",{className:"workExhibition_main"},n.createElement(i.Z,{to:c,className:"workExhibition_title"},a),n.createElement("p",{className:"workExhibition_btm"},n.createElement("span",null,o),d&&n.createElement(r.Z,{plain:!0,onClick:d},n.createElement(l.Z,{icon:["gfas","more"],className:"workExhibition_more"})))))}},40182:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(72739),r=a(28680),l=a(64794);const i="workExhibitionSelectorModal",s=(0,r.x)("getWorks",((e,t)=>(0,l.d)({page:t,userId:e})),{namespace:i,reducerDefault:"loadMore"}),o={namespace:i,actions:{[s.name]:s.action},reducer:(0,n.U)({works:s.reducer})}},52803:(e,t,a)=>{a.d(t,{r0:()=>q,Xn:()=>M,ZP:()=>F,s0:()=>x,aT:()=>D});var n=a(73126),r=a(67294),l=a(66688),i=a(74015),s=a(69951),o=a(30213),c=a(35369),d=a(85846),m=a(50533),u=a(22222),p=a(1145),g=a(59310),h=a(39047),v=a(69757);const E=(0,u.P1)((e=>e.getIn(["data","catalogTags","ids"])),g.LF,((e,t)=>(0,p.BY)(e,t).sort(((e,t)=>t.getAttr("weight")-e.getAttr("weight"))))),f={dispatchGetTags:v.Z.actions.getAllCatalogTags},y=(0,m.connect)(((e,t)=>({allTags:E(e)})),f)((e=>{let{allTags:t,dispatchGetTags:a,value:n,onChange:l}=e;return(0,r.useEffect)((()=>{0===t.size&&a()}),[t.size,a]),r.createElement(h.Z,{data:t,parentField:"parent-tag",titleField:"name",value:n,onChange:e=>l(e)},(e=>{let{selectedItems:t,showSelector:a}=e;return r.createElement("input",{type:"text",className:"form-control",readOnly:!0,value:t.map((e=>null==e?void 0:e.getAttr("name"))).join("/"),placeholder:"请选择分区",onClick:()=>{a()}})}))}));var b=a(51831),k=a(33529),C=a(83476),_=a(85896),w=a(84644),N=a(57288);const P=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["data",b.Z.namespace,...e]},S=(0,u.P1)((e=>e.getIn(P(["portfolios","ids"]))),g.LF,((e,t)=>(0,p.BY)(e,t))),Z={dispatchGetPortfolios:b.Z.actions.getPortfolios},I=(0,m.connect)(((e,t)=>({portfolios:S(e),portfoliosState:e.getIn(P(["portfolios"]))})),Z)((e=>{let{userId:t,selectedId:a,visible:n,onClose:l,onConfirm:i,portfolios:s,portfoliosState:o,dispatchGetPortfolios:c}=e;const{props:m,ref:u}=(0,w.kL)("portfolioSelector_body"),[p,g]=(0,r.useState)(!1),h=(0,r.useCallback)((e=>r.createElement("ul",{className:"portfolioSelector_list"},e.map((e=>r.createElement("li",{key:e.getKey()},r.createElement(d.Z,{plain:!0,className:"portfolioSelector_item",onClick:()=>{i(e)}},r.createElement("h3",null,e.getAttr("title"),r.createElement("small",null,e.getAttr("works-count")," 作品")),a===e.get("id")&&r.createElement("div",{className:"form-check"},r.createElement("input",{className:"form-check-input",type:"checkbox",checked:!0,readOnly:!0})))))))),[a,i]),v=(0,r.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(o.get("currentPage")??0)+1;await c(e,a)}),[o,t,c]),E=(0,_.II)(v),f=(0,r.useCallback)((async()=>{var e;null===(e=u.current)||void 0===e||e.scrollToTop(),await E.current(t,1)}),[t,E,u]);return r.createElement(r.Fragment,null,p&&r.createElement(N.Z,{onConfirm:()=>{f(),g(!1)},confirmText:"创建",onClose:()=>{g(!1)}}),r.createElement(k.Z,{visible:n,title:"选择作品合集",titleBar:!0,actionsCenter:!0,onCloseClick:l,confirmBtnProps:{type:"secondary"},confirmBtnText:"新建合集",onConfirmClick:()=>{g(!0)}},r.createElement(C.Z,{data:s,state:o,onLoad:v,onInit:f,scrollableProps:m,hideDoneTip:!0},h)))})),T=e=>{let{input:t,meta:a}=e;return r.createElement(s.cw,{label:"原创分区"},r.createElement(y,{value:t.value||(0,c.List)(),onChange:t.onChange}),(0,s.I1)(a))},A=e=>{var t,a;let{input:n,meta:l,userId:i}=e;const[o,c]=(0,r.useState)(!1),m=null===(t=n.value)||void 0===t||null===(a=t.get)||void 0===a?void 0:a.call(t,"id");return r.createElement(r.Fragment,null,r.createElement(I,{userId:i,visible:o,selectedId:m,onClose:()=>{c(!1)},onConfirm:e=>{n.onChange(e&&(e.get("id")===m?null:e)),c(!1)}}),r.createElement(s.cw,{label:"添加至作品合集",className:"form-group-rowComponent",horizontalCol:[["8"],["4"]]},r.createElement(d.Z,{type:n.value?"info":"secondary",ellipse:!0,onClick:()=>{c(!0)},icon:n.value?void 0:["gfas","plus"]},n.value?n.value.getAttr("title"):"添加"),(0,s.I1)(l)))},R=e=>r.createElement(A,e),D="workPropertiesForm",x={enable:!1,isProtected:!1,catalogTags:[],portfolio:null},M=function(e){var t;let{forceEnabled:a,defaultEnabled:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,o.dj)({enable:a??e.getAttr("work-enabled")??n,isProtected:e.getAttr("work-is-protected"),notificationEnabled:e.getAttr("work-notification-enabled"),catalogTags:null===(t=e.getIn(["relationships","catalog-tags","data"]))||void 0===t?void 0:t.map((e=>e.get("id"))).toJS(),portfolio:e.getRel([["portfolios",0]])})},L=e=>!1===e.enable?x:e,q=e=>{let{handleSubmit:t,values:{enable:a},portfolioEnabled:n=!1,userId:o,onChange:c}=e;const d=(0,r.useRef)(!1),m=a?r.createElement(r.Fragment,null,r.createElement(l.gN,{name:"catalogTags"},T),r.createElement(l.gN,{label:"原创转载权限",tip:"未经作者授权 禁止转载",name:"isProtected",type:"checkbox",alwaysTip:!0},s.k5),n&&o&&r.createElement(l.gN,{label:"添加至作品合集",name:"portfolio",userId:o},R)):r.createElement(i.Z,null,"个人原创内容可开启作品设置，非原创搬运内容可能会被隐藏展示或删除。连续创作内容可新建或添加至作品合集，方便作品展示与用户订阅，后续可接收更新通知");return r.createElement("form",{id:D,onSubmit:t},r.createElement(l.lP,{subscription:{values:!0},onChange:e=>{let{values:t}=e;d.current?null==c||c(L(t)):d.current=!0}}),r.createElement(l.gN,{label:"原创内容",name:"enable",type:"checkbox"},s.k5),m)},F=e=>{let{work:t,initialValues:a,initialValuesOnce:i,forceEnabled:s,defaultEnabled:o=!1,onSubmit:c,children:d,...m}=e;const u=(0,r.useMemo)((()=>a?{...x,...a}:t?{...x,...M(t,{defaultEnabled:o,forceEnabled:s})}:{...x,enable:s??o}),[t,a,o,s]),p=(0,r.useRef)(u);return r.createElement(l.l0,(0,n.Z)({onSubmit:e=>{null==c||c(L(e))},initialValues:i?p.current:u},m),d)}},20269:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(33529),i=a(69951),s=a(52803);const o=e=>e.enable&&0===e.catalogTags.length,c=e=>{let{visible:t,onConfirm:a,onClose:c,...d}=e;return r.createElement(s.ZP,(0,n.Z)({},d,{onSubmit:e=>{a(e)}}),(e=>{const{submitting:a,values:m}=e;return r.createElement(l.Z,{visible:t,title:"作品设置",titleBar:!0,onConfirmClick:()=>{(0,i.Ps)(s.aT)},onCloseClick:c,confirmBtnText:"完成",confirmBtnProps:{loading:a,disabled:o(m)}},r.createElement(s.r0,(0,n.Z)({},e,d)))}))}},85211:(e,t,a)=>{a.d(t,{Z:()=>T});var n=a(67294),r=a(50533),l=a(22222),i=a(10671),s=a(83476),o=a(33529),c=a(84644),d=a(29847),m=a(1145),u=a(85551),p=a(85896),g=a(59310),h=a(85846),v=a(45648),E=a(52004),f=a(71405),y=a(80239),b=a(20269),k=a(10772);const C=(0,l.P1)((e=>e.getIn(["data","ids"])),g.LF,((e,t)=>(0,m.BY)(e,t))),_={dispatchSelect:k.Z.actions.select,dispatchDeselect:k.Z.actions.deselect},w=(0,r.connect)(((e,t)=>({data:C(e)})),_)((e=>{var t;let{portfolioId:a,item:r,selected:l,dispatchSelect:i,dispatchDeselect:s}=e;const{sendPopMessage:o}=(0,v.EY)(),[c,d]=(0,n.useState)(!1),[m,p]=(0,n.useState)(!1),g=null==r||null===(t=r.getThumb)||void 0===t?void 0:t.call(r),k="talks"===(null==r?void 0:r.get("type"))?r.getDesc(!0):null==r?void 0:r.getTitle(),C=`“${k?(0,f.io)(k,10):"该作品"}”`,_=r.isWork(),w=r.getRel([["portfolios",0]]),N=(null==w?void 0:w.get("id"))??null,P=!!(a?N:_),S=!l&&P,Z="videos"===r.get("type")&&r.getRel("djs").size>1;return r?n.createElement(n.Fragment,null,m&&n.createElement(b.Z,{visible:!0,work:r,forceEnabled:!0,defaultEnabled:!0,onConfirm:async e=>{e.enable&&(d(!0),await i({portfolioId:a,work:r,isWorkBefore:!1,workProperties:e}),d(!1)),p(!1)},onClose:()=>{p(!1)}}),n.createElement(h.Z,{plain:!0,disabled:c,className:(0,E.Z)("workSelector_item",{"workSelector_item-disabled":Z}),onClick:async()=>{d(!0),await(async()=>{l?await s(l):_&&N===a||o(Z?{title:"无法操作",body:`${C}有多个参与者，无法将其添加为作品`}:w?{body:`${C}已被添加到“${w.getAttr("title")}”合集中，本次操作会将其从原来的合集中移除。`,modalProps:{onConfirmClick:async()=>{await i({portfolioId:a,work:r,isWorkBefore:!0})}}}:_?{title:"添加确认",body:`是否确认添加${C}到合集？`,modalProps:{onConfirmClick:async()=>{await i({portfolioId:a,work:r,isWorkBefore:!0})}}}:{title:"添加作品",body:`${C}为非作品内容，是否确定其为原创作品并进行创作相关设置`,modalProps:{onConfirmClick:()=>{p(!0)}}})})(),d(!1)}},g&&n.createElement("img",{src:(0,y.qz)(g,{resize:{w:120,m:"mfit"}}),alt:k??"thumb"}),n.createElement("div",{className:"workSelector_item_body"},n.createElement("h3",null,k),n.createElement("p",{suppressHydrationWarning:!0},(0,u.Sy)(r.getAttr("published-at"))," 发布")),n.createElement("div",{className:"form-check"},n.createElement("input",{className:"form-check-input",type:"checkbox",checked:P,disabled:S,readOnly:!0})))):null})),N=[{key:"articles",title:"文章"},{key:"news",title:"资讯"},{key:"videos",title:"视频"},{key:"talks",title:"动态"}],P=e=>["data","workSelector",e],S=(0,l.P1)((e=>e.getIn([...P("works"),"ids"])),g.LF,((e,t)=>(0,m.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))))),Z=(0,l.P1)((e=>e.getIn([...P("results"),"ids"])),g.LF,((e,t)=>(0,m.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))))),I={dispatchSearch:k.Z.actions.search,dispatchGetWorks:k.Z.actions.getWorks,dispatchClear:k.Z.actions.clearSelected},T=(0,r.connect)(((e,t)=>({works:S(e),results:Z(e),worksState:e.getIn(P("works")),resultsState:e.getIn(P("results")),selectedWorks:e.getIn(P("selected")),currentUser:(0,g.ib)(e)})),I)((e=>{let{portfolioId:t,onClose:a,works:r,worksState:l,results:m,resultsState:g,selectedWorks:h,dispatchGetWorks:v,dispatchSearch:E,dispatchClear:f,currentUser:y}=e;const b=null==y?void 0:y.get("id"),[k,C]=(0,n.useState)(N[0].key),[_,P]=(0,n.useState)(""),S=_.length>0,Z=S?g:l,I=S?m:r,{ref:T,props:A}=(0,c.kL)("workSelector_results"),R=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(g.get("currentPage")??0)+1;b&&e&&t.length>0&&await E({type:e,keyword:t,page:a,userId:b})}),[E,k,b,_,g]),D=(0,p.II)(R),x=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(b){const a=r.last(),n=a&&(0,u.u3)(a.getAttr("published-at"));await v({userId:b,type:e,timestamp:t?void 0:n})}}),[r,v,b,k]),M=(0,p.II)(x),L=(0,n.useCallback)((async()=>{var e,t;null===(e=T.current)||void 0===e||null===(t=e.scrollToTop)||void 0===t||t.call(e),_?await D.current(k,_,1):await M.current(k,!0)}),[k,_,D,T,M]);(0,n.useEffect)((()=>()=>{f()}),[f]);const q=(0,n.useCallback)((e=>e.map((e=>{const a=h.find((t=>t.id===e.get("id")&&t.type===e.get("type")));return n.createElement(w,{key:e.getKey(),item:e,portfolioId:t,selected:a})}))),[t,h]),F=(0,n.useCallback)((()=>{a(h)}),[h,a]);return n.createElement(o.Z,{visible:!0,shouldConfirmOnPressEnter:!1,title:"选择添加内容",titleBar:!0,className:"workSelector",actionsCenter:!0,actionsBorder:!0,confirmBtnProps:{style:{width:"40%"}},onConfirmClick:F,onCloseClick:F},n.createElement(d.Z,{tabs:N,noBorder:!0,hrefEnabled:!1,active:k,onTabChange:e=>{C(e)}}),n.createElement(i.Z,{loading:Z.get("isRequesting"),onSearch:e=>{P(e)},showCancel:S,onCancelClick:()=>{P("")}}),n.createElement(s.Z,{data:I,scrollableProps:A,state:Z,onLoad:S?R:x,onInit:L},q))}))},10772:(e,t,a)=>{a.d(t,{Z:()=>E});var n=a(35369),r=a(72739),l=a(23274),i=a(56648),s=a(28816),o=a(28680),c=a(14810);const d=e=>"articles"===e?"features":e,m="workSelector",u=(0,o.x)("search",(e=>{let{userId:t,type:a,keyword:n,page:r}=e;return["search",{query:{"filter[user-id]":t,query:n,type:d(a),"order-by":"date"},include:["topic","user","radios","videos","articles","games","category","djs","portfolios","catalog-tags.parent-tag"],limit:20,page:r}]}),{namespace:m,reducerDefault:"loadMore"}),p=(0,o.x)("getWorks",(e=>{let{userId:t,type:a,timestamp:n}=e;const r=Date.now()/1e3,l=n||r;return[`users/${t}/recommend`,{query:{"talk-include":`${c.Ck.join(",")},portfolios,catalog-tags.parent-tag`,"original-include":"topic,user,radios,videos,articles,games,category,djs,portfolios,catalog-tags.parent-tag",type:d(a),before:l},meta:{pageTimestamp:l,refresh:l===r}}]}),{namespace:m,reducerDefault:"loadMore"}),g=(0,i.q)("successFromSelect",(e=>e),m),h=(0,i.q)("successFromDeselect",(e=>e),m),v=(0,i.q)("clearSelected",void 0,m),E={namespace:m,actions:{[u.name]:u.action,[p.name]:p.action,select:e=>{let{portfolioId:t,work:a,workProperties:n,isWorkBefore:r}=e;return async e=>{if(!n&&void 0===t)return!1;return(await e((0,s.wI)({id:a.get("id"),workType:a.get("type"),...n,portfolio:t}))).error?(e((0,l.bG5)({body:"添加到合集失败"})),!1):(e(g({id:a.get("id"),type:a.get("type"),portfolioId:t,isWorkBefore:!!r})),!0)}},successFormSelect:g,deselect:e=>async t=>(await t((0,s.wI)({id:e.id,workType:e.type,portfolio:null,...e.isWorkBefore?{}:{enable:!1,isProtected:!1,notificationEnabled:!1,catalogTags:[]}}))).error?(t((0,l.bG5)({body:"移出合集失败"})),!1):(t(h(e)),!0),successFormDeselect:h,clearSelected:v},reducer:(0,r.U)({results:u.reducer,works:p.reducer,selected:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.List)(),t=arguments.length>1?arguments[1]:void 0;if(t.type===g.toString())return e.push(t.payload);if(t.type===h.toString()){const{payload:a}=t,n=e.findIndex((e=>e.id===a.id&&e.type===a.type));return n>=0?e.delete(n):e}return t.type===v.toString()?(0,n.List)():e}})}},34009:(e,t,a)=>{a.d(t,{By:()=>d,VZ:()=>c,rE:()=>o});var n=a(73126),r=(a(35369),a(67294)),l=a(24757),i=a(31636),s=a(35277);const o=function(){let{talkProps:e,originalProps:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a=>r.createElement("div",{className:"ajz_talks"},a.map((a=>{const s=a.item||a,o=a.props||{},c=s.getKey();return"talks"===s.get("type")?r.createElement(i.Z,(0,n.Z)({key:c,talk:s},e,o)):["articles","videos","radios"].includes(s.get("type"))?r.createElement(l.Z,(0,n.Z)({key:c,original:s,feedStyle:!0},t,o)):null})))},c=o(),d=e=>{let{render:t=c,blacklistEnable:a}=e;const n=(0,s.q)(),l=(0,r.useMemo)((()=>a?n:[]),[a,n]);return(0,r.useCallback)((e=>{const a=(null==l?void 0:l.length)>0?e.filter((e=>!((e,t)=>{var a,n;const r=e.item||e,l=r.getRel("user","id"),i=(null===(a=r.getRel("djs"))||void 0===a||null===(n=a.map((e=>e.get("id"))))||void 0===n?void 0:n.toJS())||[];if(i.length>1)return!1;const s=1===i.length?i[0]:l;return t.includes(s)})(e,l))):e;return t(a)}),[l,t])}},80675:(e,t,a)=>{a.d(t,{Ru4:()=>Ge,jNQ:()=>Ye,jUv:()=>re,GnC:()=>te,$VM:()=>Le.$VM,lpb:()=>B,I3D:()=>A,OYI:()=>l,_$y:()=>z,bmE:()=>V,HAt:()=>me,xKf:()=>ue,QAz:()=>p,wd1:()=>Y,zps:()=>D,wpn:()=>se,N7Q:()=>M,MgT:()=>q,D41:()=>Le.D41,mUC:()=>ge,PPq:()=>s,wBp:()=>N,ubC:()=>S,tpx:()=>I,VSm:()=>h,blJ:()=>ce,xQh:()=>m,QyM:()=>c,J7m:()=>E,KfB:()=>Q,Nzc:()=>Le.Nzc,qSY:()=>Le.qSY,ajx:()=>O,yu_:()=>Le.yu_,rM4:()=>Le.rM4,zKX:()=>Ce,GSD:()=>Le.GSD,dT9:()=>Le.dT9,qe6:()=>$,VJH:()=>b,uZq:()=>Fe,_0y:()=>Ke,iPo:()=>Le.iPo,EhV:()=>We,c0y:()=>He,HsB:()=>Ne,MuN:()=>fe,RiH:()=>ve,nde:()=>be,TUc:()=>Le.TUc,Bp5:()=>ut,D7A:()=>Qe,vs1:()=>Oe,wFn:()=>Pe,q3d:()=>Ze,kIl:()=>ot,Fcz:()=>ct,lMO:()=>st,KTf:()=>it,wCu:()=>Le.wCu,Xy2:()=>Le.Xy2,Lfj:()=>Xe,OXT:()=>Le.OXT,TBc:()=>Le.TBc,zb9:()=>Le.zb9,FPD:()=>ae,IAW:()=>ne,L7r:()=>le,tGz:()=>Le.tGz,$f6:()=>Le.$f6,QKH:()=>R,ZGo:()=>i,n37:()=>Le.n37,mXD:()=>j,c3J:()=>H,dId:()=>W,tse:()=>Le.tse,cAG:()=>pe,gfx:()=>g,dQq:()=>x,lQg:()=>oe,RUF:()=>L,oZg:()=>F,j33:()=>he,sEk:()=>P,bIi:()=>Z,GF:()=>T,SMG:()=>Le.SMG,k3z:()=>y,As2:()=>o,RQB:()=>v,xaK:()=>de,fcw:()=>u,rbB:()=>d,pl6:()=>f,fez:()=>Le.fez,SUC:()=>Le.SUC,CAj:()=>U,sMA:()=>Le.sMA,keW:()=>Le.keW,sBh:()=>_e,ccU:()=>Le.ccU,BzH:()=>Le.BzH,PRA:()=>Le.PRA,kKF:()=>G,iLj:()=>k,dJn:()=>we,ZQC:()=>Le.ZQC,ObF:()=>nt,WTD:()=>Le.WTD,Ukv:()=>Be,YVK:()=>tt,YlW:()=>Le.YlW,wFx:()=>Le.wFx,y1f:()=>Le.y1f,yap:()=>Le.yap,mH_:()=>gt,fDf:()=>je,ds7:()=>at,ORL:()=>Le.ORL,rIL:()=>ye,Vlz:()=>Ee,lV6:()=>ke,qa_:()=>Le.qa_,bG5:()=>Le.bG5,smX:()=>pt,nsk:()=>et,YDj:()=>mt,GjD:()=>Ue,GA2:()=>Le.GA2,J_T:()=>Se,CcW:()=>Le.CcW,G7L:()=>dt,OcJ:()=>Le.OcJ});var n=a(59129),r=a(14810);const l="GET_BANNERS_IN_FIRST_SCREEN",i=(0,r.qm)(l,(e=>{let{tagID:t,type:a}=e;const n={main:3,top:1,sub:2}[a]||0,l="sub"===a?"collection,album":"original,link",i="top"===a?"web-homepage-top":void 0;return(0,r.tD)({tagID:t,mode:l},{limit:n,extraQuery:{"filter[before-date]":(new Date).toISOString(),...i?{"filter[slug]":i}:{}},extraMeta:{inFirstScreen:{tagID:t,type:a}},include:["target"]})})),s="GET_LATEST_GADIO_NEWS_BANNERS",o=((0,r.qm)(s,(()=>(0,r.tD)(void 0,{limit:3,extraQuery:{"filter[category]":n.default.category.GADIO_NEWS}}))),(0,r.qm)("GET_ORIGINAL_TO_EDIT",(e=>(0,r.F1)(e,{includeQueryPush:["draft","draft.hosted-media","draft.draftable","draft.user","catalog-tags","portfolios","tags","entries","entities"],ctrlfields:{drafts:["+audit-censor-labels"]},metaFields:{tags:[],entries:[],entities:[]}})))),c="GET_ORIGINALS_IN_ORIGINAL_TYPE_PAGE",d=(0,r.qm)(c,((e,t)=>(0,r.Me)({type:e,withoutNews:"originals"===e||void 0,listAll:!0,listPurchasable:!1},{page:t}))),m="GET_ORIGINALS_IN_ORIGINAL_CATEGORY_PAGE",u=(0,r.qm)(m,((e,t,a)=>(0,r.Me)({parentUnique:{type:"categories",id:e},type:t},{page:a}))),p="GET_EDITOR_SHOWCASES_IN_FIRST_SCREEN",g=(0,r.qm)(p,(e=>(0,r.Me)({parentUnique:{type:"tags",id:e}},{...e?{}:{extraQuery:{"filter[is-focus-showcase]":1}},limit:e?3:5,extraMeta:{inFirstScreen:{tagID:e}}}))),h="GET_ORIGINALS_IN_COLLECTION_PAGE",v=(0,r.qm)(h,((e,t,a)=>(0,r.Me)({parentUnique:{type:"collections",id:e},type:t},{page:a}))),E="GET_ORIGINALS_IN_TAG_PAGE",f=(0,r.qm)(E,(function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,r.Me)({parentUnique:e,type:t,listAll:!n},{..."originals"===t&&n?{startOffset:3}:{},page:a,extraMeta:{inTagPage:{type:t,termUnique:e}}})})),y=(0,r.qm)("GET_ORIGINAL_IN_SHOW_PAGE",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.F1)(e,{...t,..."articles"===e.type?{extraQuery:{preview:1}}:null,includeQueryPush:[...t.includeQueryPush||[],"user.role","tags","entities","entries","similarities.user","similarities.djs","similarities.category","collections","operational-events.giveaways.winners","operational-events.public-candidates","portfolios"]})})),b="GET_WEEKLY_HOT_ORIGINALS",k=(0,r.qm)(b,(()=>(0,r.ro)({type:"articles",withoutNews:!0},{limit:20,sort:"score",extraQuery:{"filter[from]":(new Date).getTime()/1e3-604800}})));var C=a(54186),_=a(85551);const{category:w}=n.default,N="GET_LATEST_ORIGINALS_IN_HOMEPAGE",P=(0,r.qm)(N,((e,t)=>(0,r.Me)({withoutNews:!0},{extraMeta:{refresh:t},page:e,limit:C.default.latestOriginalsPageLimit+C.default.editorShowcasesPageLimit}))),S="GET_NEWS_IN_HOMEPAGE",Z=(0,r.qm)(S,(()=>(0,r.ro)({type:"news"},{limit:20,filters:{"review-verified":"true"}}))),I="GET_NEWS_LIST_IN_NEWS_LIST_PAGE",T=(0,r.qm)(I,(e=>(0,r.ro)({type:"news"},{limit:18,page:e,filters:{"review-verified":"true"}}))),A="GET_AUDIO_NEWS_IN_NEWS_LIST_PAGE",R=(0,r.qm)(A,(()=>(0,r.ro)({parentUnique:{type:"categories",id:w.GADIO_NEWS},type:"radios"},{limit:3,page:1}))),D="GET_GADIO_WAVE_IN_NEWS_LIST_PAGE",x=(0,r.qm)(D,(()=>(0,r.ro)({parentUnique:{type:"categories",id:w.GADIO_WAVE},type:"radios"},{limit:3,page:1}))),M="GET_HOT_NEWS_LIST",L=(0,r.qm)(M,(()=>(0,r.ro)({type:"news"},{sort:"score",limit:5,extraQuery:{"filter[from]":(0,_.ET)(new Date,7),"filter[to]":(0,_.u3)(new Date)}}))),q="GET_INITIAL_DATA_IN_REPOST_SELECTOR",F=(0,r.qm)(q,(e=>"games"===e?["games/search",{filters:{onsale:"true",revised:"true"},sorts:["-onsale-start"],limit:20,include:r.wE}]:"films"===e?["films",{limit:20}]:"albums"===e?(0,r.R1)(void 0,{limit:20,sorts:["-updated-at"]}):"products"===e?["products",{filters:{"is-published":1},limit:20}]:(0,r.ro)({type:e,withoutNews:!1},{limit:20}))),B="GET_AUDIOS_IN_HOMEPAGE",O=((0,r.qm)(B,(()=>(0,r.BB)("radios",{limit:30,include:["category","albums"],sort:"published-at",filters:{"is-require-purchase":0},fields:{radios:["title","duration","cover","category","albums"],categories:["name","logo","subscriptions-count"],albums:["title","cover"]},metaFields:{radios:[],categories:[],albums:[]}}))),"GET_RADIO_IN_PLAYER"),U=(0,r.qm)(O,(e=>(0,r.F1)({id:e,type:"radios"},{includeQueryPush:["media.timelines"]}))),$="GET_VIDEOS_IN_HOMEPAGE",G=(0,r.qm)($,(()=>(0,r.ro)({type:"videos"},{includeQueryPush:["media"],limit:8,extraQuery:{"filter[category-id]":"15,16,23,43,46,47,50,63,59","filter[is-require-privilege]":"false"}}))),z="GET_COLLECTIONS_IN_COLLECTION_TYPE_PAGE",H=(0,r.qm)(z,(e=>(0,r.Ov)(null,{page:e,limit:18}))),V="GET_COLLECTIONS_IN_HOMEPAGE",W=(0,r.qm)(V,(()=>(0,r.Ov)(null,{page:1,limit:8}))),j=(0,r.qm)("GET_COLLECTION_IN_COLLECTION_PAGE",(e=>(0,r.kT)(e)));var K=a(85311);const J=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,r.qm)(e,(function(e,n){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=n??t;return(0,r.R1)({filter:i},{page:e||1,limit:9,...a,...l})}))},Y="GET_FREE_ALBUMS_IN_HOMEPAGE",X=J(Y,"album",{sorts:["-updated-at"]}),Q="GET_PAID_ALBUMS_IN_HOMEPAGE",ee=J(Q,"audiobook"),te="GET_ALBUM_BUNDLES_IN_HOMEPAGE",ae=(0,r.qm)(te,(()=>["/album-bundles",{sorts:["-created-at"],page:1,limit:20}])),ne=()=>e=>Promise.all([e(ee()),e(X()),e(ae()),e(K.Z.actions.getAlbumsWithBanners())]),re="GET_ALBUMS_IN_COLLECTION_TYPE_PAGE",le=J(re,void 0,{limit:18}),{nextGeneration:ie}=n.default,se=((0,r.qm)("GET_SUPER_TAGS",(()=>(0,r.KW)({extraQuery:{"filter[tag-type]":"Super"}}))),"GET_GAMES_IN_TAG_PAGE"),oe=(0,r.qm)(se,((e,t,a)=>"tags"===e?["search/entries",{include:["game-stores"],query:{type:"games"},filters:{tags:t,"is-original":"all"},page:a,meta:{inTagPage:{termUnique:{type:"tags",id:t}}},fields:{games:["cover","title","game-stores"]},metaFields:{games:[]}}]:[`${e}/${t}/games`,{query:{include:["game-stores"]},page:a,meta:{inTagPage:{termUnique:{type:e,id:t}}},fields:{games:["cover","title","game-stores"]},metaFields:{games:[]}}])),ce="GET_ORIGINALS_IN_NEXT_PAGE",de=(0,r.qm)(ce,(e=>{let t,{source:a,filter:n,page:r=1}=e;if("videos"===a)t=ie.videoTagId;else if("hardware"===a)t=ie.hardwareTagId;else{if("news"!==a)throw Error("无效的 tagId");t="ps5"===n?ie.ps5TagId:"xsx"===n?ie.xsxTagId:ie.newsTagId}return[`tags/${t}/originals`,{page:r,sort:"published-time",include:["category","user","djs"],extraMeta:{source:a,filter:n}}]})),me="GET_DISCOUNT_GAMES",ue=((0,r.qm)(me,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",{onlyCh:t=!1,sort:[a,n]=["onsale-start",!1],page:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["/games/search",{page:r,query:{include:"game-stores","filter[revised]":"true","filter[onsale]":"true",...t?{"filter[chinese]":!0}:{},...e&&"all"!==e?{"filter[platform]":e}:{}},sorts:[`${n?"":"-"}${a}`]}]})),"GET_DISCUSSION_BANNERS_IN_HOMEPAGE"),pe=(0,r.qm)(ue,(()=>["banners",{filters:{"before-date":(new Date).toString(),slug:"home-discussions"},include:["target"],limit:3}])),ge="GET_LATEST_DISCUSSIONS_IN_HOMEPAGE",he=(0,r.qm)(ge,(()=>["discussions",{filters:{active:"1"},sorts:["-sort_at"],limit:3}])),ve="SEARCH_IN_SEARCH_PAGE",Ee=(0,r.qm)(ve,(function(){return(0,r.w4)(...arguments)})),fe="SEARCH_IN_REPOST_SELECTOR",ye=(0,r.qm)(fe,(function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.w4)(t[0],{...t[1],includeQueryPush:"games"===t[0].type?r.wE:[]})})),be="SEARCH_IN_TOPIC_CATALOGS",ke=(0,r.qm)(be,((e,t)=>(0,r.w4)({...e,type:"topics"},t))),Ce="GET_TALKS_IN_HOMEPAGE",_e=(0,r.qm)(Ce,(()=>["talk-recommendations",{include:["talk","talk.topic","talk.user"],metaFields:{topics:[],users:[]}}])),we=(0,r.qm)("lockTalk",((e,t)=>[`talks/${e}/admin-lock`,{method:"POST",body:{data:{reason:t}},meta:{type:"talks",id:e,successTip:"删除成功"}}])),Ne="RESET_ORIGINAL_EDITOR";const Pe="TOGGLE_ORIGINAL_EDITOR_NAV";function Se(e){return{type:Pe,editorMode:e}}const Ze="TOGGLE_ORIGINAL_EDITOR_POPBOX";var Ie=a(35369),Te=a(28718),Ae=a(50718),Re=a(1145),De=a(82285),xe=a(59310),Me=a(44671),Le=a(23274);const qe=async(e,t,a,n)=>{const r=Me.Xn[a]||a;return await e((0,Le.yap)({purchasableType:r,purchasableId:n})).catch((()=>null)),(0,xe._I)(t(),r,n)},Fe="PLAY_OR_PAUSE_RADIO_ITEM";function Be(e){return{type:Fe,playing:e}}const Oe="STOP_PLAYER";function Ue(){return{type:Oe}}let $e;const Ge="ADD_RADIO_ITEM";function ze(e){if("undefined"!=typeof window&&!$e){const e=window.document.querySelector(".gplayer_mini");e&&(e.classList.add("gplayer_mini-appending"),$e=setTimeout((()=>{e.classList.remove("gplayer_mini-appending"),$e=null}),1e3))}return{type:Ge,payload:e}}const He="REMOVE_RADIO_ITEM";function Ve(e){return{type:He,payload:e}}const We="REMOVE_ALL_RADIO_ITEMS";function je(){return{type:We}}const Ke="PLAY_RADIO_ITEM";function Je(e,t){return{type:Ke,payload:{item:e,shouldPlay:t}}}const Ye="CHANGE_PLAYER_MODE";function Xe(e){return{type:Ye,mode:e}}const Qe="SET_RADIO_ITEM_BREAKPOINT";function et(e,t,a){return{type:Qe,payload:{id:e,time:t,breakpointTimestamp:a}}}function tt(e){let{shouldPlay:t=!0,openFullScreen:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(n,r)=>{const l=r(),i=e.get("id"),s=l.getIn(["player","playingItem","id"]),o=l.getIn(["player","mode"]),c=(0,Te.Z)("timelines",{id:i,pi:"1"}),d=i!==s;d?n(Je(e,t)):t&&n(Be(!0)),o===Ae.R9.FULLSCREEN?d&&De.ZP.replace(c):a&&De.ZP.push(c)}}function at(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(a,n)=>{const r=n().getIn(["player","playlist"]).findIndex((t=>t.get("id")===e));if(r>=0&&(a(Ve(r)),t)){const e=n().getIn(["player","playlist"]),{size:t}=e;if(t>0){const n=r===t?r-1:r;a(tt(e.get(n)))}}}}function nt(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(t,a)=>{const n=a(),r=n.getIn(["player","playlist"]),l=n.getIn(["player","playingItem","id"]),i=r.findIndex((e=>e.get("id")===l));if(i>=0){let a=i+(e?1:-1);const n=r.size-1;a=a<0?n:a,a=a>n?0:a,t(tt(r.get(a)))}}}const rt=(e,t)=>{const a=e.isFree(),n=e.getRel("media"),r={id:e.get("id"),isFree:a,thumb:e.getAttr("cover"),channelName:e.getRelAttr("category","name"),title:e.getAttr("title"),source:null==n?void 0:n.getSingleSrc(e.get("id")),djs:e.getRel("djs")&&e.getRel("djs").map((e=>({id:e.get("id"),name:e.getAttr("nickname"),thumb:e.getAttr("thumb")}))).toJS(),duration:e.getAttr("duration"),publishedAt:e.getAttr("published-at"),trialInAlbum:t?{name:t.getAttr("title"),id:t.get("id")}:void 0};return(0,Ie.fromJS)(r)},lt=function(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=null===(a=t.getRel("albums"))||void 0===a?void 0:a.first(),l=null!=r&&r.getOwnSku()?r:null,i=rt(t,l&&t.isFree()?l:void 0).merge(n);return e(ze(i)),i};function it(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async(a,n)=>{let r,l=null;if("string"==typeof e?r=e:(r=e.get("id"),e.getRel("media")&&"boolean"==typeof e.getAttr("is-free")&&"boolean"==typeof e.getAttr("is-require-privilege")&&(l=e)),!l){const e=await a((0,Le.KuO)({type:"radios",id:r},{includeQueryPush:["albums"],ctrlfields:{radios:["-content"]}})),{payload:t}=e;l=(0,Re.Jg)(t.result,t.entities)}if(!l)return null;const i=l.getAttr("is-free"),s=(0,xe.ib)(n()),o=!!i||await qe(a,n,"radios",r);if(!l.isAvailable(s,o)){if(!s)return await a((0,Le.CcW)()),null;const e=l.getRel([["albums",0]]),t=e?["albums",e.get("id")]:["radios",r];return await a(mt(...t)),null}return lt(a,l,t)}}function st(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return n=>n(it(e,t)).then((e=>!!e&&(n(tt(e,a)),!0)))}function ot(e,t){let{album:a,sku:n}=t;return t=>{const r=e.map((e=>e.get("id"))).toJS(),l=e.map((e=>rt(e,n&&e.isFree()?a:void 0)));return t(Ve(r)),t(ze(l)),Promise.resolve(l)}}function ct(e){let{shouldPlay:t=!0,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>{n(ot(e,a)).then((e=>{n(Je(e.first(),t))}))}}function dt(e){return async t=>{const a=e.get("trialInAlbum");return!!a&&await t(mt("albums",a.get("id"),{afterTrial:!0,shouldCheck:!0}))}}function mt(e,t){let{afterTrial:a=!1,shouldCheck:n=!1,mediaType:r="audio"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async(l,i)=>{if(n&&await qe(l,i,e,t))return!1;const s={audio:"试听",video:"试看"}[r],o={audio:"收听",video:"观看"}[r];return l((0,Le.bG5)({type:Ae.ZQ.INFO,showMode:"pop",body:a?`${s}已结束，如喜欢可购买后继续${o}全部章节内容`:`本节目为付费内容，购买后即可${o}`,modalProps:{confirmBtnText:"去购买",onConfirmClick:()=>{De.ZP.push((0,Te.Z)({type:e,id:t}))}}})),!0}}const ut="SET_PLAYER_SETTINGS";function pt(e){return{type:ut,payload:e}}const gt=(0,r.qm)("recordRadioPlayLogs",(e=>["radio-play-logs",{method:"POST",body:{data:e.map((e=>({type:"radio-play-logs",attributes:{start:Math.floor(e.start),end:Math.floor(e.end),"evented-at":e.eventAt},relationships:{radio:{data:{id:e.radioId,type:"radios"}}}})))}}]))},99648:(e,t,a)=>{a.d(t,{Y:()=>l});var n=a(85540),r=a(80675);const l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(e,t)=>[e,t];return{[(0,n.Xk)(r.wCu.toString())]:t=>{let{meta:{type:a,id:n}}=t;return e(a,n)},[r.ORL.toString()]:t=>{let{reportableType:a,reportableId:n}=t;return e(a,n)},[(0,n.Xk)(r.dJn.toString())]:t=>{let{meta:{type:a,id:n}}=t;return e(a,n)}}}},99232:(e,t,a)=>{a.d(t,{Z:()=>P});var n=a(72739),r=a(28680),l=a(14810);const i=["title","content-tags","cover","icon","content-count","description","download-link","event-name","is-gcores-publishing","screenshots","featured-at","subscriptions-count","approved-game-link"],s={ctrlfields:{games:["+content-count","+content-tags"]},fields:{games:i,"game-links":["attachment-filename","attachment-path","external-links"]},metaFields:{games:[]}},o={ctrlfields:{games:["+content-tags"]},fields:{games:i,"game-links":["attachment-filename","attachment-path","external-links"]},metaFields:{games:[]}},c={"booom-online-play":"-1",windows:"163",macos:"175",linux:"176",android:"161",ios:"147",xbox:"148",playstation:"14846","nintendo-switch":"144",other:"-2"},d=[163,175,176,161,147,148,14846,144].join(","),m={single:"37","local-coop":"36","local-multi":"40","online-coop":"39","online-multi":"38"},u={"1d":()=>Date.now()-864e5,"1w":()=>Date.now()-6048e5,"1m":()=>Date.now()-2592e6,"3m":()=>Date.now()-7776e6,"1y":()=>Date.now()-31536e6},p=e=>Math.floor(e/1e3),g=e=>(0,r.x)("getBrowseGames",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,l.BB)("entries/booom-games",{include:["approved-game-link"],...s,page:t,limit:12,filters:{type:e.type||"hot-list","booom-platform":e.booomPlatform,"entry-type-tag-id":e.gameGenre,"entry-style-tag-id":e.gameStyle,"platform-tag-id":e.platform&&c[e.platform],"platform-exclude-tag-ids":"other"===e.platform?d:void 0,"playing-number-tag-id":e.playerCount&&m[e.playerCount],"started-published-at":e.releaseTime&&p(u[e.releaseTime]()),"ended-published-at":e.releaseTime&&p(Date.now())}})}),{namespace:e,reducerDefault:"loadMore"}),h="gameLib",v=(0,r.x)("getHomepageBanners",(()=>["banners",{filters:{slug:"pro-page-news"},include:["target"],limit:3}]),{namespace:h}),E=(0,r.x)("getFocusEntry",(()=>["focus-entries",{include:["linked-games","linked-games.approved-game-link"],limit:1,...o}]),{namespace:h,reducerDefault:"page"}),f=(0,r.x)("getHomepageHorizontalBanner",(()=>["banners",{filters:{slug:"booom-homepage-activity"},limit:4}]),{namespace:h}),y=(0,r.x)("getHomepageFeaturedGames",(()=>["entries/recommend-homepage-featured-games",{include:["approved-game-link"],limit:12,...s}]),{namespace:h,reducerDefault:"page"}),b=(0,r.x)("getNewestGameCollection",(()=>["entry-collections",{include:["featured-games","featured-games.approved-game-link"],limit:1,...o}]),{namespace:h}),k=(0,r.x)("getHomepageNewGames",(()=>["entries/recommend-homepage-new-games",{include:["approved-game-link"],limit:24,...s}]),{namespace:h,reducerDefault:"page"}),C=g(h),_=(0,r.x)("searchGames",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a="games";return(0,l.BB)("search",{include:["approved-game-link"],query:{type:a,query:e,"order-by":"score"},meta:{type:a,query:e},page:t,limit:12,...s})}),{namespace:h,reducerDefault:"loadMore"}),w=(0,r.x)("getGameCollectionsPage",(function(){return["entry-collections",{page:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,include:["featured-games"],limit:8,fields:{games:["cover"]}}]}),{namespace:h,reducerDefault:"page"}),N=(0,r.x)("getGameCollectionLinkedGames",(function(e){return[`entry-collections/${e}/linked-games`,{page:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,include:["approved-game-link"],limit:10,...o}]}),{namespace:h,reducerDefault:"loadMore"}),P={namespace:h,actions:{[v.name]:v.action,[E.name]:E.action,[f.name]:f.action,[y.name]:y.action,[b.name]:b.action,[k.name]:k.action,[C.name]:C.action,[_.name]:_.action,[w.name]:w.action,[N.name]:N.action},reducer:(0,n.U)({homepageBanners:v.reducer,focusEntry:E.reducer,homepageHorizontalBanner:f.reducer,homepageFeaturedGames:y.reducer,newestGameCollection:b.reducer,homepageNewGames:k.reducer,browseGames:C.reducer,gameSearch:_.reducer,gameCollectionsPage:w.reducer,gameCollectionLinkedGames:N.reducer})}},19740:(e,t,a)=>{a.d(t,{DevCommunityEntityEditPage:()=>xe,DevCommunityEntryEditPage:()=>Xt,DevCommunityEntryLinkEditPage:()=>Pa,DevCommunityLayout:()=>oa,DevCommunityManagePage:()=>P,DevPortalPageHeader:()=>i.Z,devCommunityManagePageSlice:()=>k.Z});var n=a(67294),r=a(50533),l=a(20374),i=a(14144),s=a(35218);const o=e=>{let{children:t,to:a,openNewWindow:r,id:l="",disabled:i=!1,buttonStyle:o="default",onClick:c}=e;const d=()=>{c&&c()};return a?n.createElement(s.Z,{id:l,disablePush:r,openNewWindow:r,onClick:d,className:`devPortal_button devPortal_button_${o} ${i?"disabled":""}`,to:i?void 0:a},t):n.createElement("button",{id:l,type:"button",disabled:i,onClick:d,className:`devPortal_button devPortal_button_${o}`},t)},c=e=>{let{onChange:t,searchTargetName:a}=e;const r=a?`搜索${a}`:void 0;return n.createElement("div",{className:"devPortal_inputWrapper devPortal_searchInput"},n.createElement(l.Z,{icon:"search"}),n.createElement("input",{type:"text",placeholder:r,onCompositionEnd:e=>{t(e.target.value)},onChange:e=>{e.nativeEvent.isComposing||t(e.target.value)}}))};var d=a(45236),m=a(91433),u=a(52004),p=a(72753),g=a(59310),h=a(80239);const v=e=>{let{entity:t,editable:a}=e;const l=(0,r.useSelector)(g.ib),[i,c]=(0,n.useState)(!1),v=l.getAttr("thumb"),E=t?(0,m.ZP)("devCommunityEntityEdit",{entity_id:t.get("id"),...(0,p.dl)("个人信息")}):(0,m.ZP)("devCommunityEntityEdit",{...(0,p.dl)("个人信息")}),f=t?(0,m.ZP)("devCommunityEntity",{id:t.get("id")}):E,y=t&&t.getAttr("cover")||v,b=t?t.getAttr("name"):l.getAttr("nickname"),k=t?t.getRel("positions").map((e=>e.getAttr("title"))).toJS().join(" / "):"完善个人信息";return n.createElement(n.Fragment,null,n.createElement(d.Z,{options:[{title:"编辑",to:E},{title:"取消",requestClose:!0}],visible:i,onClose:()=>{c(!1)}}),n.createElement("div",{className:(0,u.Z)("gcApp_item gcApp_item-entity devPortal_developerItem")},y&&n.createElement(s.Z,{className:"gcApp_item_img",to:f},n.createElement("img",{src:(0,h.cR)(y,{resize:{w:64,h:64}})})),n.createElement(s.Z,{className:"gcApp_item_text",to:f},n.createElement("h3",null,b),k&&n.createElement("p",null,k)),n.createElement(o,{openNewWindow:!1,to:f},"查看"),n.createElement(o,{disabled:!a,to:E},"编辑"),n.createElement("div",{className:"buttonGroup"},n.createElement(o,{openNewWindow:!1,to:f},"查看"),n.createElement(o,{disabled:!a,to:E},"编辑"))))},E=a.p+"210fb5325bc82a5cca58.png";var f=a(33529);const y=e=>{let{eidtable:t,game:a}=e;const r=a.getAttr("cover"),l=a.getAttr("icon"),[i,c]=(0,n.useState)(!1),d=()=>c(!1),p=(0,m.ZP)("devCommunityGame",{id:a.get("id")}),g=(0,m.ZP)("game",{id:a.get("id")});return n.createElement(n.Fragment,null,n.createElement("div",{className:(0,u.Z)("devPortal_indexGameItem")},r&&n.createElement(s.Z,{className:"devPortal_indexGameItem_cover",to:(0,m.ZP)("game",{id:a.get("id")}),disablePush:!0,openNewWindow:!0,style:{backgroundImage:`url(${(0,h.cR)(r,{resize:{w:408,h:192}})})`}},n.createElement("h3",null,a.getAttr("title"))),n.createElement("div",{className:"devPortal_indexGameItem_actions"},n.createElement("div",{className:"devPortal_indexGameItem_info"},n.createElement("p",{className:"devPortal_numberFont"},a.getAttr("subscriptions-count")),n.createElement("span",null,"关注")),n.createElement("div",{className:"spacer"}),n.createElement(o,{openNewWindow:!0,to:g},"查看"),n.createElement(o,{disabled:!t,to:p},"管理"))),n.createElement("div",{className:"devPortal_mobileIndexGameItem",onTouchStart:()=>{},onClick:()=>{c(!0)}},n.createElement("div",{className:"devPortal_mobileIndexGameItem_iconContainer"},n.createElement("div",{className:"devPortal_mobileIndexGameItem_icon",style:{backgroundImage:`url(${(0,h.cR)(l,{resize:{w:128,h:128}})})`}})),n.createElement("div",{className:"devPortal_mobileIndexGameItem_info"},n.createElement("h3",null,a.getAttr("title")),n.createElement("p",null,a.getAttr("subscriptions-count")," 关注"))),n.createElement(f.Z,{visible:i,title:a.getAttr("title"),onConfirmClick:()=>{d()},onCloseClick:d,confirmBtnText:"完成"},n.createElement("div",{className:"devPortal devPortal_mobileGameInfo"},n.createElement("h3",null,"基础信息"),n.createElement("div",{className:"devPortal_mobileGameInfo_infoItem"},n.createElement("h4",null,"关注人数"),n.createElement("p",null,a.getAttr("subscriptions-count"))),n.createElement("div",{className:"devPortal_mobileGameInfo_infoItem"},n.createElement("h4",null,"游戏页面"),n.createElement("p",null,n.createElement(s.Z,{to:g},"https://www.gcores.com"+g))),n.createElement("h3",null,"编辑游戏信息"),n.createElement("p",null,"若要编辑游戏信息，请使用电脑访问机核网，并在「投稿」菜单中选择「游戏项目」。"),n.createElement("img",{src:E,className:"tipsImage",alt:"",draggable:"false"}))))};var b=a(81765),k=a(84461),C=a(85846);let _=function(e){return e.Default="default",e.Claim="claim",e}({});var w=function(e){return e.Create="create",e.Claim="claim",e}(w||{});const N=e=>{let{visible:t,state:a,onClose:r,onNextStep:i}=e;const[o,c]=n.useState(w.Create),d=(0,n.useCallback)((()=>{c(w.Create),r()}),[r]),u=(0,n.useMemo)((()=>n.createElement(n.Fragment,null,n.createElement(C.Z,{onClick:a===_.Default?d:()=>{i(_.Default)}},a===_.Default?"取消":"上一步"),o===w.Create?n.createElement(C.Z,{className:"btn-theme",to:(0,m.ZP)("devCommunityEntryEdit")},"创建"):n.createElement(C.Z,{className:"btn-theme",onClick:a===_.Default?()=>i(_.Claim):d},a===_.Default?"下一步":"完成"))),[a,d,o,i]),p=(0,n.useMemo)((()=>{switch(a){case _.Default:return n.createElement(n.Fragment,null,n.createElement("p",null,"请选择添加游戏项目的方式"),n.createElement("div",{className:"devPortal_newGameModal_options"},n.createElement("button",{className:"devPortal_newGameModal_option "+(o===w.Create?"active":""),onClick:()=>c(w.Create)},n.createElement(l.Z,{icon:"add_circle"}),n.createElement("section",null,n.createElement("h4",null,"创建游戏项目"),n.createElement("p",null,"在游戏库中创建全新的项目"))),n.createElement("button",{className:"devPortal_newGameModal_option "+(o===w.Claim?"active":""),onClick:()=>c(w.Claim)},n.createElement(l.Z,{icon:"link"}),n.createElement("section",null,n.createElement("h4",null,"认领既有项目"),n.createElement("p",null,"认领目前已被游戏库收录的项目")))));case _.Claim:return n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement("h3",null,"认领既有项目说明"),n.createElement("p",null,"您好，为确保关联信息准确，我们需要您提供能够证明自己参与制作该游戏的材料，例如游戏内容物料、游戏制作过程等，并发送至工作人员邮箱，以确认信息的真实性。"),n.createElement("p",null,"请以「游戏关联申请-《xxx（游戏名）》」为邮件标题，把「游戏名」、「您在游戏制作中担任的职位」、「证明材料」、「您的机核昵称」等信息一并发送至邮箱：",n.createElement(s.Z,{to:"mailto:max@gcores.com"},"max@gcores.com")),n.createElement("p",null,"您可以一次性提交多位游戏制作者的关联信息，但请务必将各自的职位标注清楚。我们会尽快为您进行审核。")));default:return null}}),[o,a]);return n.createElement(f.Z,{visible:t,onCloseClick:d,title:"添加游戏",className:"devPortal_newGameModal",actions:u},n.createElement("div",{className:"devPortal devPortal_newGameModal_content"},p))},P=e=>{const t=(0,r.useSelector)(b.Uk),a=t.size>0,d=(0,r.useSelector)(b.dM),m=(0,r.useSelector)(b.E2),[u,p]=n.useState(""),[g,h]=n.useState(!1),[E,f]=n.useState(_.Default),C=m.filter((e=>"pending"===e.getAttr("state"))),w=C.size>=k.h,P=!w&&!C.find((e=>e.getAttr("pending-entity"))),S=(0,n.useMemo)((()=>0===C.size?null:n.createElement("div",{className:"devPortal_pendingTips"},n.createElement(l.Z,{icon:"lock"}),n.createElement("div",{className:"devPortal_pendingTips_text"},n.createElement("h3",null,"部分编辑功能锁定中"),n.createElement("p",null,"您有正在审核中的编辑申请，对应游戏编辑功能将在审核完毕后解锁")))),[C.size]),Z=()=>{f(_.Default),h(!0)},I=(0,n.useMemo)((()=>n.createElement(o,{id:"create_game_button",buttonStyle:"primary",disabled:w||C.find((e=>e.isCreateEntry())),onClick:Z},n.createElement(l.Z,{icon:"add_circle"}),"添加游戏")),[w,C]),T=(0,n.useMemo)((()=>{const e=u.toUpperCase().replace(/ /g,"");return d.filter((t=>t.getAttr("title").toUpperCase().replace(/ /g,"").includes(e)))}),[d,u]);return n.createElement(n.Fragment,null,n.createElement(i.Z,{title:"开发者控制台",subTitle:"Dev Dashboard"}),S,n.createElement("div",{className:"devPortal_sectionTitle"},n.createElement("h2",null,n.createElement(l.Z,{icon:"game_controller"}),"游戏管理",n.createElement(s.Z,{className:"helpLink",to:"https://docs.gcores.com/dev/docs/game-management/",openNewWindow:!0},n.createElement(l.Z,{icon:"help"})))),n.createElement("div",{className:"devPortal_toolbar"},n.createElement(c,{onChange:p,searchTargetName:"游戏"}),n.createElement("div",{className:"spacer"}),I),T.size>0&&n.createElement("div",{className:"devPortal_indexGameGrid"},T.map((e=>{const t=!w&&!C.find((t=>t.getPendingEntryId()===e.get("id")));return n.createElement(y,{eidtable:t,key:e.getKey(),game:e})}))),0===T.size&&n.createElement("div",{className:"devPortal_noGameTips"},u?"没有找到相关游戏":"暂无游戏"),n.createElement("div",{className:"devPortal_sectionTitle"},n.createElement("h2",null,n.createElement(l.Z,{icon:"manage_accounts"}),"入驻身份管理")),n.createElement("div",{className:"gcApp devPortal_entityList"},n.createElement("div",{className:"gcApp_body gcApp_container"},a?t.map((e=>n.createElement(v,{editable:P,key:e.getKey(),entity:e}))):P?n.createElement(v,{editable:!0}):"正在审核中")),n.createElement(N,{visible:g,state:E,onClose:()=>{h(!1)},onNextStep:e=>{f(e)}}))};var S=a(73126),Z=a(66688),I=a(69951),T=a(14810);const A=n.createContext(void 0),R=()=>{const e=(0,n.useContext)(A);if(!e)throw new Error("useDevCommunityFormContext must be used within a DevCommunityFormContext");return e},D=async(e,t,a)=>{if(!e)return null;const n=e.type,r=e.id?{id:e.id}:{};if("celebrities"===n){const l=await(async(e,t,a)=>{const n=e.filter((e=>"external-links"===e.type&&!e.id)),r=e.filter((e=>e.id));if(0===n.length)return r;const l="external-links",i=(await Promise.all(n.map((e=>t((0,T.D1)(l,{method:"POST",body:{data:{type:l,attributes:{title:e.title,link:e.permalink},relationships:{user:{data:a.toUnique()}}}}})))))).map((e=>{if(e.error)throw new Error("创建 linkages 失败");const{result:{id:t},data:a}=e.payload;return{type:l,id:t,title:a.attributes.title,image:a.attributes.image,permalink:a.attributes.link}}));return[...r,...i]})(e.linkages,a,t);return{...r,type:n,attributes:{name:e.name,specialization:e.specialization,description:e.description,resume:JSON.stringify(e.involvements),linkages:l},relationships:{positions:{data:e.positions.map((e=>({type:"positions",id:e})))},user:{data:t.toUnique()}}}}throw new Error(`formatPendingEntity: 未知类型的 entity ${n}`)};var x=a(23736);const M=(0,x.Cr)(),L=(0,x.Cr)([e=>{if(e.length>30)return"输入内容过长"}]),q=(0,x.Cr)([e=>{let t=0;for(let a=0;a<e.length;a++){const n=e.charAt(a).charCodeAt(0);t+=n>=19968&&n<=40959?1:.5}if(t>30)return"输入内容过长"}]),F=(0,x.Cr)([e=>{if(e.length>300)return"输入内容过长"}]),B=e=>{if(!(null===e||parseFloat(e)>0))return"请输入正确的时间（小时）"};var O=a(39047),U=a(1145),$=a(65838),G=a(35369),z=a(22222),H=a(59129);const V=e=>e.map((e=>null==e?void 0:e.getAttr("title"))).join("/");let W=!1;const j=e=>{let{value:t,onChange:a,initialText:l="",className:i,inputClassName:s="form-control",readMode:o=!1,disableLearning:c=!1}=e;const d=(0,r.useSelector)(K).filter((e=>!c||e.get("id")!==H.op)),m=(0,r.useDispatch)();return(0,n.useEffect)((()=>{0!==d.size||W||(W=!0,m($.Z.actions.getAllPositions()))}),[d.size,m]),n.createElement(O.Z,{data:d,parentField:"parent",titleField:"title",className:i,value:t,onChange:(e,t)=>a(e,V(t)),onlyParent:!0},(e=>{let{selectedItems:t,showSelector:a}=e;const r=V(t)||l;return o?n.createElement("span",null,r):n.createElement("input",{type:"text",className:s,readOnly:!0,value:r,placeholder:"点击选择职位",onClick:()=>{a()}})}))},K=(0,z.P1)((e=>e.getIn(["data","positions","ids"])),g.LF,((e,t)=>(0,U.BY)(e,t).sort(((e,t)=>t.getAttr("weight")-e.getAttr("weight"))))),J=e=>{let{input:t,meta:a,readMode:r,disableLearning:l,...i}=e;return n.createElement(I.cw,i,n.createElement(j,{readMode:r,disableLearning:l,value:t.value||(0,G.List)(),onChange:t.onChange}),(0,I.I1)(a))};var Y=a(26707),X=a(35018);const Q=e=>{let{entity:t}=e;const a=t.getRel("user");return a?n.createElement(s.Z,{to:(0,m.ZP)(a),className:(0,u.Z)("gcApp_cell p_entityAvatar")},n.createElement(Y.Z,{users:a,size:"lg",subText:"个人主页"}),n.createElement("span",{className:"gcApp_cell_arrow"},n.createElement(X.Z,{icon:["gfas","angle-right"]}))):null};var ee=a(23157);const te=[{label:"相关专业从业者",value:"practitioner"},{label:"兴趣创作者",value:"amateur"},{label:"在校学生",value:"student"}],ae=e=>{let{input:t,readMode:a,...r}=e;const l=(i=t.value,te.find((e=>e.value===i))??void 0);var i;return n.createElement(I.cw,r,a?n.createElement("span",null,null==l?void 0:l.label):n.createElement(ee.ZP,{classNamePrefix:"react-select",className:"react-select",isSearchable:!1,placeholder:"",options:te,value:l,onChange:e=>{t.onChange(e.value)}}))};var ne=a(85896);const re=e=>{if(!e)return"";const t=e.split("/");return t[t.length-1]},le=function(){let{appl:e,currentUser:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t;null!=e&&e.getRel("user")&&(a=e.getRel("user"));const n=a.get("id")===t.get("id");return{applicant:a,isStaffModify:t.isStaff()&&!n}},ie=e=>{let{input:t,label:a,readMode:r}=e;return 0===t.value.length&&r?null:n.createElement(I.cw,{label:a},n.createElement(ce,{readMode:r,value:t.value,onChange:e=>{t.onChange(e)}}))};let se=0;const oe=()=>se++,ce=e=>{let{value:t,onChange:a,readMode:r}=e;const l=(0,ne.II)(a),[i,s]=(0,n.useState)(t.map((e=>({...e,tempId:oe(),tempPositionIds:[]}))));return(0,n.useEffect)((()=>{l.current(i.filter((e=>e.title&&e.description&&e.position)).map((e=>({title:e.title,description:e.description,position:re(e.position)}))))}),[i,l]),n.createElement("div",{className:(0,u.Z)("listManager")},n.createElement("ul",null,i.map(((e,t)=>{let{title:a,tempPositionIds:l,description:i,position:o,tempId:c}=e;return n.createElement("li",{className:"listManager_item",key:t},n.createElement("div",{className:"listManager_field"},n.createElement("label",null,"项目名称"),r?n.createElement("span",{className:"listManager_input"},a):n.createElement("input",{type:"text",className:"listManager_input",placeholder:"请输入项目名",value:a,onChange:e=>{const a=e.target.value;s((e=>(e[t]={...e[t],title:a},[...e])))}})),n.createElement("div",{className:"listManager_field"},n.createElement("label",null,"职能"),r?n.createElement("span",{className:"listManager_input"},o):n.createElement(j,{className:"listManager_input",inputClassName:"",initialText:o,value:l,onChange:(e,a)=>{s((n=>(n[t]={...n[t],tempPositionIds:e,position:a},[...n])))}})),n.createElement("div",{className:"listManager_field"},n.createElement("label",null,"工作内容职责"),r?n.createElement("div",{className:"listManager_textarea"},i):n.createElement("textarea",{placeholder:"请输入你所负责的内容",className:"listManager_textarea",value:i,onChange:e=>{const a=e.target.value;s((e=>(e[t]={...e[t],description:a},[...e])))}})))}))),r?null:n.createElement(C.Z,{block:!0,onClick:()=>{s((e=>[...e,{title:"",description:"",tempPositionIds:[],position:"",tempId:oe()}]))}},"添加相关经历"))};var de=a(4250),me=a(5396),ue=a(40182),pe=a(83476),ge=a(84644);const he=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["data",ue.Z.namespace,...e]},ve=(0,z.P1)((e=>e.getIn(he(["works","ids"]))),g.LF,((e,t)=>(0,U.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))).filter((e=>e)))),Ee=e=>{let{userId:t,value:a,onChange:l,onClose:i,visible:s,formatValue:o}=e;const c=(0,r.useSelector)(ve),d=(0,r.useSelector)((e=>e.getIn(he(["works"])))),m=(0,r.useDispatch)(),{ref:p,props:g}=(0,ge.kL)("workSelector_results"),h=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(d.get("currentPage")??0)+1;await m(ue.Z.actions.getWorks(t,e))}),[t,d,m]),v=(0,ne.II)(h),E=(0,n.useCallback)((async()=>{var e,a;null===(e=p.current)||void 0===e||null===(a=e.scrollToTop)||void 0===a||a.call(e),t&&await v.current(1)}),[t,v,p]),y=(0,ne.n5)(E);return n.createElement(f.Z,{visible:s,shouldConfirmOnPressEnter:!1,title:"选择作品",titleBar:!0,className:"workExhibitionSelectorModal",actionsCenter:!0,actionsBorder:!0,confirmBtnProps:{style:{width:"40%"}},onConfirmClick:()=>{i()},hideCloseBtn:!0},n.createElement(pe.Z,{data:c,scrollableProps:g,state:d,onLoad:h,onInit:y},(e=>e.map((e=>{const t=e.toUnique(),r=e=>e.type===t.type&&t.id===e.id,i=a.some(r);return n.createElement(C.Z,{key:e.getKey(),plain:!0,className:(0,u.Z)("w-100 py-3 o_bottomDivider d-flex justify-content-between align-items-center"),onClick:()=>{l(i?a.filter((e=>!r(e))):[...a,o(e)])}},n.createElement("div",null,n.createElement("h3",{className:"u_fontSize-base"},e.getTitle()),n.createElement("p",{className:"m-0 u_color-gray-info"},"portfolios"===(s=e).get("type")?`${s.getAttr("published-work-count")} 作品`:s.getCatalogTagNames())),n.createElement("div",{className:"form-check"},n.createElement("input",{className:"form-check-input",type:"checkbox",checked:i,readOnly:!0})));var s})))))};var fe=a(98658);const ye=e=>{let{input:t,label:a,readMode:r}=e;const[l,i]=(0,n.useState)(!1);return 0===t.value.length&&r?null:n.createElement(I.cw,{label:a,labelClassName:"gcApp_linkageField",labelExtra:r?null:n.createElement("span",{className:"gcApp_linkageField_edit"},n.createElement(C.Z,{type:"link",size:"sm",onClick:()=>{i(!0)}},"编辑"))},n.createElement(ke,{readMode:r,worksModalVisible:l,onCloseModal:()=>{i(!1)},value:t.value,onChange:e=>{t.onChange(e)}}))},be=e=>{let{link:t}=e;return(0,fe.jK)(t)?n.createElement(s.Z,{className:"listManager_input",to:t},t):n.createElement("span",null,"无")},ke=n.memo((e=>{let{value:t,onChange:a,worksModalVisible:r,onCloseModal:l,readMode:i}=e;const{applicant:s}=R(),o=t.filter((e=>["portfolios","articles","videos","radios","talks"].includes(e.type))),c=t.filter((e=>"external-links"===e.type)),[d,p]=(0,n.useState)(c),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:d).filter((e=>e.title&&e.permalink)).map((e=>({type:"external-links",title:e.title,permalink:e.permalink})));a([...t,...e])},h=(0,ne.II)(g);return(0,n.useEffect)((()=>{h.current(void 0,d)}),[d,h]),s?n.createElement(n.Fragment,null,n.createElement(de.Z,{variableWidth:!0,circleArrow:!0,slidesToShow:1},o.map((e=>n.createElement("div",{key:`${e.type}${e.id}`,className:"slick-item gcApp_work"},n.createElement(me.Z,{link:i?(0,m.ZP)({type:e.type,id:e.id}):void 0,title:e.title,cover:e.image??void 0,info:e["content-count"]?`${e["content-count"]} 作品`:""}))))),n.createElement("div",{className:(0,u.Z)("listManager")},n.createElement("ul",null,d.map(((e,t)=>{let{title:a,permalink:r}=e;return n.createElement("li",{className:"listManager_item",key:t},n.createElement("div",{className:"listManager_field"},n.createElement("label",null,"作品所在平台"),i?n.createElement("span",{className:"listManager_input"},a):n.createElement("input",{type:"text",className:"listManager_input",value:a,onChange:e=>{const a=e.target.value;p((e=>(e[t]={...e[t],title:a},[...e])))}})),n.createElement("div",{className:"listManager_field"},n.createElement("label",null,"链接地址"),i?n.createElement(be,{link:r}):n.createElement("input",{type:"text",className:"listManager_input",value:r,onChange:e=>{const a=e.target.value;p((e=>(e[t]={...e[t],permalink:a},[...e])))}})))}))),i?null:n.createElement(C.Z,{block:!0,onClick:()=>{p((e=>[...e,{type:"external-links",title:"",permalink:""}]))}},"添加站外作品链接")),n.createElement(Ee,{userId:s.get("id"),visible:r,value:o,onClose:()=>{l()},onChange:e=>{g(e)},formatValue:e=>({...e.toUnique(),title:e.getTitle(),image:e.getThumb(),permalink:"","content-count":e.getAttr("published-work-count")??0})})):null}));var Ce=a(32298);const _e={id:void 0,type:"celebrities",name:"",positions:[],specialization:"practitioner",description:"",involvements:[],linkages:[]},we=(e,t)=>{const{applicant:a}=R();let n=_e;return e?n=(e=>{var t;return{id:e.get("id")||_e.id,type:e.get("type")||_e.type,name:e.getAttr("name")||_e.name,positions:e.getRel("positions").map((e=>e.get("id"))).toJS()||_e.positions,specialization:e.getAttr("specialization")??_e.specialization,description:e.getAttr("description")??_e.description,involvements:(0,Ce.b)(e.getAttr("resume"),_e.involvements),linkages:(null===(t=e.getAttr("linkages"))||void 0===t?void 0:t.toJS())||_e.linkages}})(e):t&&(n=(e=>{var t,a,n;return{id:e.id??_e.id,type:e.type||_e.type,name:e.attributes.name||_e.name,positions:(null===(t=e.relationships)||void 0===t||null===(a=t.positions)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.map((e=>e.id)))??_e.positions,specialization:e.attributes.specialization??_e.specialization,description:e.attributes.description??_e.description,involvements:(0,Ce.b)(e.attributes.resume,e.attributes["updatable-involvements"]??_e.involvements),linkages:e.attributes.linkages??_e.linkages}})(t)),{...n,name:n.name||(null==a?void 0:a.getAttr("nickname"))||""}},Ne=e=>{let{readMode:t,formId:a,initialEntity:l,initialJson:i,onlyValues:s,disableLearningPosition:o,onConfirm:c,onSubmittig:d}=e;const m=(0,r.useDispatch)(),{applicant:u}=R(),p=we(l,i);return n.createElement(Z.l0,{onSubmit:async e=>{s?await(null==c?void 0:c(e)):await(async e=>{null==d||d(!0);const t=await m((0,T.D1)(e.id?`celebrities/${e.id}`:"celebrities",{method:e.id?"PATCH":"POST",body:{data:await D(e,u,m)}}));null==d||d(!1),await(null==c?void 0:c(e,t))})(e)},initialValues:p,initialValuesEqual:(e,t)=>!0},(e=>{let{handleSubmit:r,form:i}=e;const s={readMode:t},c=t?{}:M;return n.createElement("form",{id:a,onSubmit:e=>{i.getState().submitting?e.preventDefault():r(e)}},t&&l&&n.createElement(Q,{entity:l}),n.createElement(Z.gN,(0,S.Z)({label:"用户名",name:"name"},c,{disabled:!0},s),I.CF),n.createElement(Z.gN,(0,S.Z)({label:"职能",name:"positions",disableLearning:o},c,s),J),n.createElement(Z.gN,(0,S.Z)({label:"创作状态",name:"specialization"},c,s),ae),n.createElement(Z.gN,(0,S.Z)({label:"个人简介",name:"description",componentType:"textarea"},t?{}:F,s),I.CF),n.createElement(Z.gN,(0,S.Z)({label:"相关经历",name:"involvements"},s),ie),n.createElement(Z.gN,(0,S.Z)({label:"关联作品 / 作品集",name:"linkages"},s),ye))}))},Pe=e=>{var t,a;let{application:r,reason:l=(null==r||null===(t=r.getAttr)||void 0===t?void 0:t.call(r,"error"))}=e;const i=null==r?void 0:r.getRel("draft");if(!i)return null;const s=null===(a=i.getAttr("audit-censor-labels"))||void 0===a?void 0:a.toJS();if(!s)return null;const o=Object.keys(s.texts),c=s.images;return 0!==o.length||0!==c.length||l?n.createElement("div",{className:"devPortal_censorInfo"},n.createElement("div",{className:(0,u.Z)("alert alert-warning")},l&&n.createElement("p",null,"拒绝理由：",l),o.length>0&&n.createElement(n.Fragment,null,n.createElement("p",null,"以下段落里可能含有该修改内容"),n.createElement("ul",null,o.map(((e,t)=>n.createElement("li",{key:t},e,"..."))))),c.length>0&&n.createElement(n.Fragment,null,n.createElement("p",null,"以下图片待修改"),n.createElement("div",null,c.map((e=>n.createElement("img",{key:e,style:{display:"inline-block",margin:5},src:(0,h.cR)(e,{resize:{w:50,h:50}})}))))))):null},Se=e=>{const{genre:t,style:a,platform:n}=e,r=e=>e.map((e=>(e=>({type:"tags",id:e.value}))(e)));return{data:r(t).concat(r(a)).concat(r(n))}},Ze=function(e,t,a,n){var r,l,i;if(!e||!t||0===t.length)return null;let s={};const o={tags:Se({genre:e.genre,style:e.style,platform:e.platform}),user:{data:a.toUnique()}};for(const a of t)switch(a){case"base":s={...s,title:e.title.trim(),introduction:e.introduction.trim(),"project-type":null===(r=e["project-type"])||void 0===r?void 0:r.value,icon:e.icon};break;case"promotion":s={...s,description:e.description.trim(),screenshots:e.screenshots,cover:e.cover,"fulltext-description":e["fulltext-description"]};break;case"download":s={...s,"average-play-time":e["average-play-time"]};break;case"detail":s={...s,"other-names":e["other-names"].map((e=>{let{value:t}=e;return t})),"development-status":e["development-status"].map((e=>{let{value:t}=e;return t})).join(" / "),target:null===(l=e.target)||void 0===l?void 0:l.value,"event-name":e["event-name"].value||null};break;case"dev":s={...s,"booom-group-title":e["booom-group-title"],location:e.location,"involvements-to-replace-with":e.members.map(((e,t)=>({"user-id":e.userId,"user-name":e.userName,rank:t+1,title:e.position,position:"developer"})))}}return(null===(i=s["involvements-to-replace-with"])||void 0===i?void 0:i.find((e=>e["user-id"]===a.get("id"))))||(s["involvements-to-replace-with"]=s["involvements-to-replace-with"]||[],s["involvements-to-replace-with"].push({"user-id":a.get("id"),"user-name":a.getAttr("nickname"),rank:s["involvements-to-replace-with"].length+1,title:"制作人",position:"developer"})),{...e.id?{id:e.id}:{},type:"games",attributes:s,relationships:o}},Ie=e=>{let{applId:t,applicant:a,isStaffModify:l=!1}=e;const i=(0,r.useDispatch)(),s=(0,n.useCallback)((async e=>{const{entityValues:n,entryValues:r,entryParts:s,entryDirtyFields:o}=e,c=l&&t,d=await D(n,a,i),m=Ze(r,s,a,i,o),u={...c?{id:t}:{},type:"settlement-applications",attributes:{...c?{}:{action:a.getAttr("is-pro")?"update":"create"},"pending-entity":d&&JSON.stringify(d),"pending-entry":m&&JSON.stringify(m)},relationships:{user:{data:a.toUnique()}}};return await i((0,T.D1)(c?`settlement-applications/${t}`:"settlement-applications",{method:c?"PATCH":"POST",body:{data:u},query:c?{console:"1"}:{}}))}),[i,a,t,l]);return s};var Te=a(82285);const Ae="entity_form",Re=(0,g.zU)(),De=(0,g.zU)(),xe=e=>{let{entityId:t,applicationId:a,readMode:l}=e;const i=(0,r.useSelector)(b.dM),[s,c]=(0,n.useState)(!1),d=(0,g.xJ)(),h=(0,r.useSelector)((e=>Re(e,{type:"celebrities",id:t}))),v=(0,r.useSelector)((e=>De(e,{type:"settlement-applications",id:a}))),{applicant:E,isStaffModify:f}=le({appl:v,currentUser:d}),y=Ie({applId:a,applicant:E,isStaffModify:f}),k=(0,n.useMemo)((()=>{if(t&&!h)return null;if(a&&!v)return null;const e=null==v?void 0:v.getAttr("pending-entity"),r={readMode:l,formId:Ae,initialEntity:h??void 0,initialJson:e?JSON.parse(e):void 0,onlyValues:!0,disableLearningPosition:i.size>0,onConfirm:async e=>{c(!0);try{const t=await y({entityValues:e});c(!1),t.error||((0,p.CF)("提交成功"),(0,p.pj)("close",null,(()=>{Te.ZP.push((0,m.ZP)("devCommunityManage"))})))}catch(e){(0,p.CF)("提交失败"),c(!1)}}};return n.createElement(A.Provider,{value:{applicant:E}},n.createElement(Ne,r))}),[h,y,v,t,a,l,E,i]),C={key:"next",title:"提交申请",buttonProps:{type:"info",onClick:()=>{(0,I.Ps)(Ae)},loading:s}};return n.createElement("div",{className:(0,u.Z)("gcApp",l?"readOnlyForm":"")},n.createElement("div",{className:"gcApp_body gcApp_container"},!l&&n.createElement(Pe,{application:v}),k),!l&&n.createElement("div",{className:"devPortal_form_actions withBorder"},n.createElement("div",{className:"spacer"}),n.createElement(o,{onClick:C.buttonProps.onClick,buttonStyle:"primary"},"提交")))},Me="游戏名称",Le="项目类型",qe="一句话介绍",Fe="其它名称",Be="游戏类型",Oe="风格/题材",Ue="简介",$e="游戏图标",Ge="封面",ze="游戏截图",He="平均游玩时长",Ve="游戏状态",We="项目目标",je="运行平台",Ke=["持续更新","招募成员","预计Steam上架","预计TapTap上架","已发售"],Je=[{label:"上架销售",value:"sale"},{label:"活动参赛",value:"compete"},{label:"仅试玩展示",value:"demo"}],Ye=[{label:"游戏",value:"type:game"},{label:"软件",value:"type:software"},{label:"桌面游戏",value:"type:boardgame"},{label:"项目",value:"type:project"}];var Xe=a(39301),Qe=a(165);const et=e=>{let{input:t,meta:a,groupProps:r,label:l,required:i,tip:s,options:o,creatable:c=!0,isMulti:d=!0}=e;const m=c?Xe.Z:ee.ZP;return n.createElement(I.cw,(0,S.Z)({label:l,tip:s,required:i},r),n.createElement(m,(0,S.Z)({className:(0,I.Vk)(a,{base:"react-select"}),classNamePrefix:"react-select",placeholder:"",isMulti:d},t,{value:t.value,onChange:e=>{t.onChange(e)},onBlur:()=>{t.onBlur(t.value)},options:o})),(0,I.I1)(a))},tt=e=>{var t,a,r;let{input:l,meta:i,groupProps:s,request:o,label:c,tip:d,required:m,labelField:u="name"}=e;const[p,g]=(0,n.useState)([]),h=(null===(t=l.value)||void 0===t?void 0:t.length)>0&&!(null!==(a=l.value)&&void 0!==a&&null!==(r=a[0])&&void 0!==r&&r.label);return(0,n.useEffect)((()=>{o().then((e=>{var t;null!==(t=e.payload)&&void 0!==t&&t.data&&g(e.payload.data.map((e=>({label:e.attributes[u],value:e.id}))))}))}),[o,u]),(0,n.useEffect)((()=>{h&&l.onChange(((e,t)=>0===t.length?e:e.map((e=>e.label?e:t.find((t=>t.value===e.value))||null)).filter((e=>!!e)))(l.value,p))}),[h,p,l]),n.createElement(I.cw,(0,S.Z)({label:c,tip:d,required:m},s),n.createElement(ee.ZP,(0,S.Z)({className:(0,I.Vk)(i,{base:"react-select"}),classNamePrefix:"react-select",placeholder:"",isMulti:!0,options:p},l,{value:l.value,onChange:e=>{l.onChange(e)},onBlur:()=>{l.onBlur(l.value)}})),(0,I.I1)(i))},at=e=>{let{input:t,meta:a,groupProps:r,label:l,required:i,tip:s,description:o=[""]}=e;return n.createElement(I.cw,(0,S.Z)({label:l,tip:s,required:i},r),n.createElement("div",{className:"imageUploaderX"},n.createElement("div",{className:"imageUploaderX_preview"},n.createElement(Qe.Z,{value:t.value.map((e=>({path:e}))),onChange:e=>{t.onChange(e.map((e=>e.path)))}})),n.createElement("div",{className:"imageUploaderX_description"},n.createElement("ul",null,o.map(((e,t)=>n.createElement("li",{key:t},e)))))),(0,I.I1)(a))},nt=e=>n.createElement("section",{id:"devPortal_form_base",className:"devPortal_form_section"},n.createElement("h2",null,n.createElement(l.Z,{icon:"info"}),"基础信息"),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement(Z.gN,(0,S.Z)({label:Me,name:"title",tip:"字数不超过30个字符",alwaysTip:!0},L),I.CF),n.createElement(Z.gN,(0,S.Z)({label:qe,name:"introduction",tip:"用简洁有力的语言描述一下游戏的特点吧，字数不超过30个汉字",alwaysTip:!0},q),I.CF),n.createElement(Z.gN,(0,S.Z)({label:Le,name:"project-type",tip:"这是一个什么类型的项目？",alwaysTip:!0,options:Ye,creatable:!1,isMulti:!1},M),et)),n.createElement("div",{className:"devPortal_form_section_side"},n.createElement(Z.gN,(0,S.Z)({label:$e,tip:n.createElement(n.Fragment,null,"用于官方头像展示"),name:"icon",alwaysTip:!0},M),(e=>n.createElement(I.n$,(0,S.Z)({description:["文件大小：静态图大小不超过4MB","建议尺寸：256 x 256 及以上","格式：PNG、JPG"]},e)))))),rt=e=>{if(!e)return[];const t=e.map((e=>({label:e,value:e})));return G.List.isList(t)?t.toJS():t},lt=(e,t)=>it(e.filter((e=>e.getAttr("tag-type")===t)),"name"),it=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"title";return e?e.map((e=>({label:e.getAttr(t),value:e.get("id")}))).toJS():[]};var st=a(85551);const ot={label:"不参赛",value:""},ct={id:void 0,type:"games",title:"",introduction:"","project-type":Ye[0],"other-names":[],genre:[],style:[],target:Je[0],"development-status":[],platform:[],"download-link":null,"average-play-time":null,description:"",cover:"",icon:"",screenshots:[],"fulltext-description":"","booom-group-title":null,location:null,members:[],"event-name":ot},dt=e=>e?{label:e,value:e}:ct["event-name"],mt=e=>{if(!e)return null;const t=e.getRel("game-links").filter((e=>["approved","pending","under_review"].includes(e.getAttr("state")))).sort(((e,t)=>(0,st.u3)(t.getAttr("created-at"))-(0,st.u3)(e.getAttr("created-at")))).get(0);return t?{state:t.getAttr("state"),path:t.getAttr("attachment-path")||null,links:(0,Ce.b)(t.getAttr("external-links"),[]),uniqKey:t.toUnique()}:null},ut=e=>{var t,a;const n=(e=>e?{genre:lt(e,"GameGenre"),style:lt(e,"Style"),platform:lt(e,"Platform")}:{})(null==e?void 0:e.getRel("tags")),r=Ye.find((t=>t.value===(null==e?void 0:e.getAttr("project-type")))),l=Je.find((t=>t.value===(null==e?void 0:e.getAttr("target"))));return{id:(null==e?void 0:e.get("id"))??ct.id,type:ct.type,title:(null==e?void 0:e.getAttr("title"))??ct.title,"other-names":rt(null==e?void 0:e.getAttr("other-names")),introduction:(null==e?void 0:e.getAttr("introduction"))??ct.introduction,"project-type":r??ct["project-type"],genre:n.genre??ct.genre,style:n.style??ct.style,"development-status":rt(null==e||null===(t=e.getAttr("development-status"))||void 0===t?void 0:t.split(" / ")),target:l??ct.target,platform:n.platform??ct.platform,"download-link":(null==e?void 0:e.getAttr("download-link"))??ct["download-link"],"average-play-time":(null==e?void 0:e.getAttr("average-play-time"))??ct["average-play-time"],description:(null==e?void 0:e.getAttr("description"))??ct.description,cover:(null==e?void 0:e.getAttr("cover"))??ct.cover,icon:(null==e?void 0:e.getAttr("icon"))??ct.icon,screenshots:(null==e||null===(a=e.getAttr("screenshots"))||void 0===a?void 0:a.toJS())??ct.screenshots,"fulltext-description":(null==e?void 0:e.getAttr("fulltext-description"))??ct["fulltext-description"],"booom-group-title":(null==e?void 0:e.getAttr("booom-group-title"))??ct["booom-group-title"],location:(null==e?void 0:e.getAttr("location"))??ct.location,members:(i=e,i?i.getRel("involvements").filter((e=>e.getRel(["entity","user"]))).sort(((e,t)=>e.getAttr("rank")-t.getAttr("rank"))).map((e=>({position:e.getAttr("title"),userId:e.getRel(["entity","user"]).get("id"),userName:e.getRel(["entity","user"]).getAttr("nickname")}))).toJS():ct.members),"game-link":mt(e),"event-name":dt(null==e?void 0:e.getAttr("event-name"))};var i},pt=["id","title","introduction","project-type","icon"],gt=["description","cover","screenshots","fulltext-description"],ht=["platform","average-play-time"],vt=["event-name","other-names","genre","style","development-status","target"],Et=["booom-group-title","members","location"],ft=(e,t,a)=>(0,n.useMemo)((()=>{let n=ct;t?n=(e=>{var t,a,n,r,l,i,s,o,c,d,m,u,p,g,h,v,E,f,y,b,k,C;const _=null===(t=e.relationships)||void 0===t||null===(a=t.tags)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.map((e=>({value:e.id,label:""}))),w=Ye.find((t=>{var a;return t.value===(null===(a=e.attributes)||void 0===a?void 0:a["project-type"])})),N=Je.find((t=>{var a;return t.value===(null===(a=e.attributes)||void 0===a?void 0:a.target)}));return{id:e.id??ct.id,type:ct.type,title:(null===(r=e.attributes)||void 0===r?void 0:r.title)??ct.title,"other-names":rt(null===(l=e.attributes)||void 0===l?void 0:l["other-names"]),introduction:(null===(i=e.attributes)||void 0===i?void 0:i.introduction)??ct.introduction,"project-type":w??ct["project-type"],genre:_??ct.genre,style:_??ct.style,target:N??ct.target,platform:_??ct.platform,"development-status":rt(null===(s=e.attributes)||void 0===s||null===(o=s["development-status"])||void 0===o?void 0:o.split(" / ")),"download-link":(null===(c=e.attributes)||void 0===c?void 0:c["download-link"])??ct["download-link"],"average-play-time":(null===(d=e.attributes)||void 0===d?void 0:d["average-play-time"])??ct["average-play-time"],description:(null===(m=e.attributes)||void 0===m?void 0:m.description)??ct.description,cover:(null===(u=e.attributes)||void 0===u?void 0:u.cover)??ct.cover,icon:(null===(p=e.attributes)||void 0===p?void 0:p.icon)??ct.icon,screenshots:(null===(g=e.attributes)||void 0===g?void 0:g.screenshots)??ct.screenshots,"fulltext-description":(null===(h=e.attributes)||void 0===h?void 0:h["fulltext-description"])??ct["fulltext-description"],"booom-group-title":(null===(v=e.attributes)||void 0===v?void 0:v["booom-group-title"])??ct["booom-group-title"],location:(null===(E=e.attributes)||void 0===E?void 0:E.location)??ct.location,members:(null===(f=e.attributes)||void 0===f||null===(y=f["involvements-to-replace-with"])||void 0===y?void 0:y.map((e=>({userId:e["user-id"],userName:e["user-name"],position:e.title}))))??ct.members,"game-link":(null===(b=e.relationships["game-links"])||void 0===b||null===(k=b.data)||void 0===k?void 0:k[0])||null,"event-name":dt(null===(C=e.attributes)||void 0===C?void 0:C["event-name"])}})(t):e&&(n=ut(e));const r={};for(const e of a)switch(e){case"base":for(const e of pt)r[e]=n[e];break;case"promotion":for(const e of gt)r[e]=n[e];break;case"download":for(const e of ht)r[e]=n[e];break;case"detail":for(const e of vt)r[e]=n[e];break;case"dev":for(const e of Et)r[e]=n[e]}return r}),[e,t,a]),yt=e=>parseFloat(e)>0?parseFloat(e):null,bt=e=>{const t=yt(e);return t?`${t}小时`:null},kt=e=>{const t=yt(e);return t?String(t):""},Ct=e=>({dispatchGetGenres:()=>e((0,T.D1)("tags",{limit:100,filters:{"tag-type":"GameGenre"}})),dispatchGetStyles:()=>e((0,T.D1)("tags",{limit:100,filters:{"tag-type":"Style"}}))}),_t=e=>e.getIn(["data",k.Z.namespace,"eventNames"]),wt=e=>{var t;const a=(0,r.useDispatch)(),i=(0,n.useMemo)((()=>Ct(a)),[a]),s=(0,r.useSelector)(_t),o=null===(t=(0,Z.cl)({subscription:{values:!0}}))||void 0===t?void 0:t.values,c=o["event-name"],d=!o.id,m=((e,t)=>e.length?[...t?[ot]:[],...e.map((e=>({label:e,value:e})))]:[])(s.get("active")||[],d),p=((e,t,a)=>{const n=e.get("active")||[];return n.length&&(n.includes(t)||a)})(s,c.value,d);return n.createElement("section",{id:"devPortal_form_detail",className:(0,u.Z)("devPortal_form_section")},n.createElement("h2",null,n.createElement(l.Z,{icon:"article"}),"详细信息"),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement(Z.gN,{label:Fe,name:"other-names",tip:"其他外文名称或别名，字数不超过30个字符",alwaysTip:!0},et),n.createElement(Z.gN,(0,S.Z)({label:Be,tip:"可关联游戏类型与体验人数（如：解谜 / RPG / 单人 ）",name:"genre",request:i.dispatchGetGenres},M),tt),n.createElement(Z.gN,(0,S.Z)({label:Oe,tip:"可关联游戏风格题材（如：科幻 / 冒险 / 中国风 ）",name:"style",request:i.dispatchGetStyles},M),tt)),n.createElement("div",{className:"devPortal_form_section_side"},(()=>{const e="BOOOMJAM参赛选项";return p?n.createElement(Z.gN,(0,S.Z)({label:e,name:"event-name",initialValue:c,tip:"本作品是否为参与BOOOMJAM创作比赛的作品",alwaysTip:!0,options:m,creatable:!1,isMulti:!1},M),et):c.value?n.createElement(I.cw,{label:e},n.createElement("span",{className:"text-muted"},c.value)):null})(),n.createElement(Z.gN,(0,S.Z)({label:We,name:"target",alwaysTip:!0,options:Je,creatable:!1,isMulti:!1},M),et),n.createElement(Z.gN,(0,S.Z)({label:Ve,tip:"标记游戏状态，方便玩家与其它开发者更好的了解游戏开发进度和团队状态",name:"development-status",alwaysTip:!0,options:Ke.map((e=>({label:e,value:e}))),creatable:!1},M),et)))};var Nt=a(42047);const Pt=e=>{let{input:t,label:a,tip:r}=e;return n.createElement(I.cw,{label:a,tip:r},n.createElement(It,{value:t.value,onChange:e=>{t.onChange(e)}}))};let St=0;const Zt=()=>St++,It=e=>{let{value:t,onChange:a}=e;const r=(0,ne.II)(a),[l,i]=(0,n.useState)(t.map((e=>({...e,tempId:Zt(),tempPositionIds:[]}))));(0,n.useEffect)((()=>{const e=l.filter((e=>e.userId&&e.userName&&e.position)).map((e=>({userId:e.userId,userName:e.userName,position:re(e.position)})));r.current(e)}),[l,r]);const s=l.reduce(((e,t)=>(t.userId&&e.add(t.userId),e)),new Set).size;return n.createElement("div",{className:(0,u.Z)("memberFieldX")},n.createElement("div",{className:"memberFieldX_content"},n.createElement("ul",null,l.map(((e,t)=>{let{userId:a,userName:r,position:l,tempId:s,tempPositionIds:o}=e;return n.createElement("li",{className:"listManager_item",key:t},n.createElement(C.Z,{plain:!0,className:"listManage_item_close",onClick:()=>{i((e=>e.filter((e=>e.tempId!==s))))}},"×"),n.createElement("div",{className:"listManager_field positionField"},n.createElement(j,{className:"listManager_input",inputClassName:"",initialText:l,value:o,onChange:(e,a)=>{i((n=>(n[t]={...n[t],tempPositionIds:e,position:a},[...n])))}})),n.createElement("div",{className:"listManager_field"},n.createElement(Nt.Z,{className:"listManager_input",isClearable:!1,placeholder:"机核用户名",searchType:"users",value:a&&r?{label:r,value:{type:"users",id:a}}:void 0,onChange:e=>{e&&i((a=>(a[t]={...a[t],userId:e.value.id,userName:e.label},[...a])))},isMulti:!1})))})))),n.createElement("footer",null,l.length>0?n.createElement("span",null,"已关联 ",s," 位开发者"):n.createElement("span",null,"尚未关联开发者"),n.createElement(o,{onClick:()=>{i((e=>[...e,{userId:"",userName:"",position:"",tempId:Zt(),tempPositionIds:[]}]))}},"添加")))},Tt=e=>n.createElement("section",{id:"devPortal_form_dev",className:"devPortal_form_section"},n.createElement("h2",null,n.createElement(l.Z,{icon:"group"}),"开发团队"),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement(Z.gN,{label:"开发团队在机核",name:"members",tip:"可关联游戏创作团队成员的机核账号",alwaysTip:!0},Pt)),n.createElement("div",{className:"devPortal_form_section_side"},n.createElement(Z.gN,{label:"团队/组织名称",name:"booom-group-title",tip:"团队或组织的名称是什么？",alwaysTip:!0,parse:I.h0},I.CF),n.createElement(Z.gN,{label:"所在地",tip:"团队或组织的所在地在哪里？",alwaysTip:!0,name:"location",parse:I.h0},I.CF)));var At=a(37813),Rt=a(56196),Dt=a(15490);const xt=e=>{let{withModal:t=!1}=e;const[a,r]=(0,n.useState)(!1),l=t?n.createElement(C.Z,{onClick:()=>{r(!0)},anchor:!0,plain:!0},"请参照此说明"):"请参照以下说明";return n.createElement(n.Fragment,null,n.createElement(f.Z,{visible:a,title:"认领说明",hideActionBtns:!0,onCloseClick:()=>{r(!1)}},n.createElement(Mt,null)),n.createElement("p",{className:"alert alert-info"},"仅可关联你参与开发的游戏，如需要认领游戏，",l))},Mt=()=>n.createElement("div",null,n.createElement("p",null,"您好，为确保关联信息准确，我们需要您提供能够证明自己参与制作该游戏的材料，例如游戏内容物料、游戏制作过程等，并发送至工作人员邮箱，以确认信息的真实性。"),n.createElement("p",null,"请以「游戏关联申请-《xxx（游戏名）》」为邮件标题，把「游戏名」、「您在游戏制作中担任的职位」、「证明材料」、「您的机核昵称」等信息一并发送至邮箱：max@gcores.com"),n.createElement("p",null,"您可以一次性提交多位游戏制作者的关联信息，但请务必将各自的职位标注清楚。我们会尽快为您进行审核。")),Lt=["data","communityApplication","involvements"],qt=(0,g.TJ)([...Lt,"ids"]),Ft=(0,z.P1)(qt,g.VS),Bt=e=>{let{close:t,onSelect:a}=e;const l=(0,r.useSelector)(Ft),i=(0,r.useSelector)((e=>e.getIn([...Lt,"fetched"]))),s=(0,r.useSelector)((e=>e.getIn([...Lt,"loading"]))),o=(0,r.useDispatch)(),c=(0,r.useSelector)(g.yK);return(0,n.useEffect)((()=>{!i&&c&&o(Dt.Z.actions.getInvolvements(c))}),[o,i,c]),n.createElement(f.Z,{visible:!0,title:"添加关联游戏",width:500,hideActionBtns:!0,onCloseClick:()=>{t()}},n.createElement(Rt.Z,{loading:s,fetched:i,data:l,emptyContent:n.createElement(n.Fragment,null,n.createElement(xt,null),n.createElement(Mt,null))},(e=>n.createElement(n.Fragment,null,n.createElement(xt,{withModal:!0}),e.map((e=>n.createElement(At.Z,{key:e.getKey(),item:e,onClick:()=>{t(),a(e)}})))))))},Ot=e=>n.createElement("section",{id:"devPortal_form_promotion",className:"devPortal_form_section"},n.createElement("h2",null,n.createElement(l.Z,{icon:"image"}),"宣传材料"),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement(Z.gN,(0,S.Z)({label:Ue,tip:"简单介绍游戏的玩法和类型、特色等，字数不超过300个字符",name:"description",componentType:"textarea",alwaysTip:!0},F),I.CF),n.createElement(Z.gN,{label:`${ze}`,tip:n.createElement(n.Fragment,null,"用于游戏页面展示，推荐上传 3-5 张截图"),name:"screenshots",alwaysTip:!0},(e=>n.createElement(at,(0,S.Z)({description:["文件大小：静态图不超过4MB，GIF不超过6MB","建议尺寸：1080 x 606 及以上","格式：PNG、JPG、GIF"]},e))))),n.createElement("div",{className:"devPortal_form_section_side"},n.createElement(Z.gN,(0,S.Z)({label:Ge,tip:n.createElement(n.Fragment,null,"用于游戏库展示"),name:"cover",alwaysTip:!0},M),(e=>n.createElement(I.n$,(0,S.Z)({description:["文件大小：静态图不超过4MB，GIF不超过6MB","建议尺寸：1280 x 600 及以上","格式：PNG、JPG、GIF"]},e)))))),Ut=e=>({dispatchGetPlatforms:()=>e((0,T.D1)("tags",{limit:100,filters:{"tag-type":"Platform"}}))}),$t=e=>{let{lock:t}=e;const a=(0,r.useDispatch)(),i=(0,n.useMemo)((()=>Ut(a)),[a]);return n.createElement("section",{id:"devPortal_form_download",className:"devPortal_form_section"},n.createElement("h2",null,n.createElement(l.Z,{icon:"download_circle"}),"体验信息"),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement(Z.gN,(0,S.Z)({label:je,tip:"游戏可以在哪些平台运行？",name:"platform",request:i.dispatchGetPlatforms},M),tt),n.createElement("div",{className:"devPortal_formTips"},n.createElement(l.Z,{icon:"info"}),n.createElement("p",null,"下载链接及在线试玩相关设置，请",n.createElement(Z.lP,{subscription:{values:!0}},(e=>e.values.id?"":"在游戏资料通过审核后，从开发者控制台进入游戏管理页面并")),"前往「下载与试玩」板块进行配置"))),n.createElement("div",{className:"devPortal_form_section_side"},n.createElement(Z.gN,{label:`${He}`,alwaysTip:!0,tip:"单位为小时",name:"average-play-time",type:"number",min:"0.5",step:"0.5",validate:B,format:kt,parse:bt},I.CF)))},Gt=e=>{let{parts:t=["base","event","promotion","download","detail","dev"],visibleParts:a=t,formId:l,onlyValues:i,onConfirm:s,initialGame:o,initialJson:c,onSelectGame:d}=e;const[m,u]=(0,n.useState)(!1),p=(0,r.useDispatch)(),{applicant:g}=R(),h=ft(o,c,t),v=d&&a.includes("base");return n.createElement(Z.l0,{onSubmit:async(e,a)=>{i?await(null==s?void 0:s(e,void 0,a)):await(async(e,a)=>{const n=await p((0,T.D1)(e.id?`games/${e.id}`:"games",{method:e.id?"PATCH":"POST",body:{data:Ze(e,t,g,p,a.getState().dirtyFields)}}));await(null==s?void 0:s(e,n,a))})(e,a)},initialValues:h,initialValuesEqual:(e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id)},(e=>{let{handleSubmit:r,form:i}=e,s=null;for(const e of t){const t={display:a.includes(e)?"block":"none"};switch(e){case"base":s=n.createElement(n.Fragment,null,s,n.createElement("div",{style:t},n.createElement(nt,null)));break;case"promotion":s=n.createElement(n.Fragment,null,s,n.createElement("div",{style:t},n.createElement(Ot,null)));break;case"download":s=n.createElement(n.Fragment,null,s,n.createElement("div",{style:t},n.createElement($t,null)));break;case"detail":s=n.createElement(n.Fragment,null,s,n.createElement("div",{style:t},n.createElement(wt,null)));break;case"dev":s=n.createElement(n.Fragment,null,s,n.createElement("div",{style:t},n.createElement(Tt,null)))}}return n.createElement("form",{onSubmit:e=>{i.getState().submitting?e.preventDefault():r(e)},id:l},v&&n.createElement(n.Fragment,null,m&&n.createElement(Bt,{onSelect:e=>{confirm("关联游戏后会导致已填写内容被覆盖，是否继续？")&&d(e.get("id"))},close:()=>{u(!1)}}),n.createElement("p",{className:"gcApp_tip gcApp_gameSelect"},n.createElement("span",null,"是否选择关联已有的游戏条目"),n.createElement(C.Z,{plain:!0,onClick:()=>{u(!0)}},"关联"))),s)}))};var zt=a(3024),Ht=a(49986);const Vt={base:{label:"基础信息",id:"devPortal_form_base"},promotion:{label:"宣传材料",id:"devPortal_form_promotion"},download:{label:"体验信息",id:"devPortal_form_download"},detail:{label:"详细信息",id:"devPortal_form_detail"},dev:{label:"开发团队",id:"devPortal_form_dev"}},Wt=e=>{let{parts:t=["base","promotion","download","detail","dev"],onSubmit:a}=e;const r=e=>{e.preventDefault();const t=e.currentTarget.getAttribute("href");if(!t)return;const a=document.querySelector(t);a&&a.scrollIntoView({behavior:"smooth"})};return n.createElement(zt.Z,{top:0,bottomBoundary:"#devPortal_form_body"},n.createElement("div",{className:"devPortal_form_editHeader"},n.createElement(Ht.Z,{items:t.filter((e=>Vt[e])).map((e=>Vt[e].id)),currentClassName:"active",className:"devPortal_form_editHeader_scrollspy",offset:-60},t.map((e=>{const t=Vt[e];return t?n.createElement("li",{key:e},n.createElement("a",{href:`#${t.id}`,onClick:r,draggable:"false"},t.label)):null}))),n.createElement("div",{className:"spacer"}),n.createElement(o,{buttonStyle:"primary",onClick:()=>{a()}},"提交")))},jt=["base","event","promotion","download","detail","dev"],Kt="entry_form",Jt=(0,g.zU)({depth:3}),Yt=(0,g.zU)(),Xt=e=>{let{entryId:t,applicationId:a}=e;const[l,i]=(0,n.useState)(!1),s=(0,g.xJ)(),c=(0,r.useSelector)((e=>Jt(e,{type:"games",id:t}))),d=(0,r.useSelector)((e=>Yt(e,{type:"settlement-applications",id:a}))),{applicant:h,isStaffModify:v}=le({appl:d,currentUser:s}),E=Ie({applId:a,applicant:h,isStaffModify:v}),f=(0,n.useMemo)((()=>{if(t&&!c)return null;if(a&&!d)return null;const e=null==d?void 0:d.getAttr("pending-entry");return n.createElement(A.Provider,{value:{applicant:h}},n.createElement(Pe,{application:d}),n.createElement(Gt,{formId:Kt,initialGame:c??void 0,initialJson:e?JSON.parse(e):void 0,onlyValues:!0,parts:jt,visibleParts:jt,onConfirm:async(e,t,a)=>{i(!0);try{const t=await E({entryValues:e,entryParts:jt,entryDirtyFields:a.getState().dirtyFields});i(!1),t.error||((0,p.CF)("提交成功"),(0,p.pj)("close",null,(()=>{Te.ZP.push((0,m.ZP)("devCommunityManage"))})))}catch(e){(0,p.CF)("提交失败"),i(!1)}}}))}),[c,E,h,t,a,d]),y={key:"next",title:"完成",buttonProps:{type:"info",onClick:()=>{(0,I.Ps)(Kt)},loading:l}};return n.createElement(n.Fragment,null,n.createElement(Wt,{onSubmit:y.buttonProps.onClick}),n.createElement("div",{className:(0,u.Z)("gcApp")},n.createElement("div",{id:"devPortal_form_body",className:"gcApp_body gcApp_container"},f),n.createElement("div",{className:"devPortal_form_actions"},n.createElement("div",{className:"spacer"}),n.createElement(o,{onClick:y.buttonProps.onClick,buttonStyle:"primary"},"提交"))))};var Qt=a(83950),ea=a(93179);const ta=()=>n.createElement(n.Fragment,null,n.createElement(s.Z,{to:"/booom"},n.createElement("div",{className:"devPortal_header_logo"},n.createElement("svg",{className:"booom_logo",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1118.09 196.96"},n.createElement("path",{d:"M974.09 92.81V63.86h56.15V53.12h-55.88L988 2.36h28.42l-5.86 21.82h19.68V2.36h29.43v21.82h43.38v28.94h-43.38v10.74h48.84v28.95H974.09zm-35.68-39.69L924.77 2.36h28.43l13.64 50.76h-28.43zm67.68 141.4c-22.36 0-39.3-4.92-50.36-14.48l-.84-.72-8 15.2H915.5l23.65-45.94V92.8h-15.41V63.86h43.36v82c3.13 19.95 20.23 21.6 39 21.6h112v27zm65.36-35.41v-5.38h-60.3v5.38h-30.91v-58.29h122.13v58.29zm-60.3-28.05h60.3v-9.72h-60.3zm-138.77 8.8l19.84 24.26h30.19l-31-37.89h21.85V100H878.8v-8.82h27.66V63.4H878.8v-8.89h21.25V2.44h-158.5v52.07h21.26v8.89h-27.67v27.78h27.67V100h-34.47v26.19h21.85l-31 37.89h30.2l19.84-24.26 5.16 8.45-37.8 46.21h40.62l24.88-30.4h1.09v30.4h35.24v-30.4h1.1l24.87 30.4H905l-37.81-46.21zm-34 2.38v-16h13l-9.78 16zm-38.43 0l-9.79-16h13v16zM770.8 24.53h100v7.89h-100zm21.65 30h56.7v8.87h-56.7zm0 36.67h56.7v8.8h-56.7zM59.76 194.52H0V2.44h59.45c39 0 54.58 20.73 54.58 50.92C114 77.13 100 93 81.1 96c22.87 4.57 36.59 20.12 36.59 45.43 0 33.57-17.99 53.09-57.93 53.09zM43.6 80.49h10.06c15.25 0 18.9-8.84 18.9-20.73 0-12.2-3.65-21.65-18.9-21.65H43.6zm0 33.85v44.21h11.28c15.55 0 19.82-7.93 19.82-22 0-13.41-4.27-22.25-19.82-22.25zm205.51-3.97c0 55.18-17.38 86.59-62.2 86.59s-62.2-31.41-62.2-86.59V86.59C124.71 31.4 142.09 0 186.91 0s62.2 31.4 62.2 86.59zM171.05 132c0 17.07 2.75 28.66 15.86 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66s-15.86 11.59-15.86 28.66zm209.78-21.63c0 55.18-17.38 86.59-62.2 86.59s-62.2-31.41-62.2-86.59V86.59C256.43 31.4 273.81 0 318.63 0s62.2 31.4 62.2 86.59zM302.78 132c0 17.07 2.74 28.66 15.85 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66s-15.85 11.59-15.85 28.66zm209.77-21.63c0 55.18-17.37 86.59-62.19 86.59s-62.21-31.41-62.21-86.59V86.59C388.15 31.4 405.54 0 450.36 0s62.19 31.4 62.19 86.59zM434.5 132c0 17.07 2.74 28.66 15.86 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66S434.5 47.87 434.5 64.94zM601 100h1.22L620.5 2.44h56.4v192.08h-41.46V85.06h-1.22l-21 109.46h-28L563.48 85.06h-1.22v109.46h-39.33V2.44h57.62z"}),n.createElement("path",{d:"M156.143 46.7l82.541 82.541-21.022 21.022-82.541-82.541zm131.727.007l82.541 82.541-21.022 21.022-82.541-82.541zm131.721 0l82.541 82.541-21.022 21.022-82.541-82.541z"})),n.createElement("span",null,"开发者中心")))),aa=(0,r.connect)((e=>({currentUser:(0,g.ib)(e)})))((e=>{let{currentUser:t}=e;return n.createElement("div",{className:"devPortal_header"},n.createElement(ta,null),n.createElement("div",{className:"spacer"}),n.createElement(s.Z,{className:"devPortal_header_link",to:"https://docs.gcores.com/dev",openNewWindow:!0},"开发者文档"),n.createElement(ea.Z,{twoRow:!1,userItems:()=>[(0,Qt.C)(t)]}))})),na=a.p+"aa7fc5f31fe244bfe4b0.png",ra=(0,r.connect)((e=>({currentUser:(0,g.ib)(e)})))((e=>{let{currentUser:t}=e;return n.createElement("div",{className:"devPortal_top"},n.createElement("img",{src:na,alt:"",className:"figure",draggable:"false"}),n.createElement("div",{className:"bubble"},"欢迎回来，",n.createElement("b",null,t.getAttr("nickname"))))})),la=e=>{let{items:t}=e;const a=[{title:"开发者控制台",link:"/dev_community/manage"},...t];return n.createElement("div",{className:"devPortal_breadcrumb"},a.map((e=>n.createElement(n.Fragment,{key:e.title},n.createElement(s.Z,{key:e.title,to:e.link},e.title),n.createElement("div",{className:"arrowRight"},n.createElement("svg",{width:"7",height:"8",viewBox:"0 0 7 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M6.5 3.13397C7.16667 3.51887 7.16667 4.48113 6.5 4.86603L2 7.4641C1.33333 7.849 0.5 7.36788 0.5 6.59808L0.5 1.40192C0.5 0.632124 1.33333 0.150998 2 0.535898L6.5 3.13397Z",fill:"#565656"})))))))},ia=()=>n.createElement("div",{className:"devPortal_footer"},n.createElement("p",{className:"links"},n.createElement(s.Z,{to:"/"},"返回主站"),n.createElement(s.Z,{to:(0,m.ZP)("booomGameLib")},"游戏库"),n.createElement(s.Z,{to:"https://docs.gcores.com/dev",openNewWindow:!0},"开发者文档")),n.createElement("p",{className:"copy"},"© 2024 GAMECORES",n.createElement("br",null),"DESIGNED BY"," ",n.createElement(s.Z,{disablePush:!0,openNewWindow:!0,to:(0,m.ZP)("user",{id:164703})},"DRING"),". DEVELOPED BY DRING & GAMECORES.")),sa=()=>n.createElement("svg",{width:"0",height:"0",className:"hidden"},n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_eye"},n.createElement("path",{d:"M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm0-72q-45 0-76.5-31.5T372-500q0-45 31.5-76.5T480-608q45 0 76.5 31.5T588-500q0 45-31.5 76.5T480-392Zm0 192q-146 0-266-81.5T40-500q54-137 174-218.5T480-800q146 0 266 81.5T920-500q-54 137-174 218.5T480-200Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_delete"},n.createElement("path",{d:"M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm80-160h80v-360h-80v360Zm160 0h80v-360h-80v360Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_upload"},n.createElement("path",{d:"M440-320v-326L336-542l-56-58 200-200 200 200-56 58-104-104v326h-80ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_info"},n.createElement("path",{d:"M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_image"},n.createElement("path",{d:"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_download_circle"},n.createElement("path",{d:"M280-280h400v-80H280v80Zm200-120 160-160-56-56-64 62v-166h-80v166l-64-62-56 56 160 160Zm0 320q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_article"},n.createElement("path",{d:"M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_group"},n.createElement("path",{d:"M40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm720 0v-120q0-44-24.5-84.5T666-434q51 6 96 20.5t84 35.5q36 20 55 44.5t19 53.5v120H760ZM360-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Zm400-160q0 66-47 113t-113 47q-11 0-28-2.5t-28-5.5q27-32 41.5-71t14.5-81q0-42-14.5-81T544-792q14-5 28-6.5t28-1.5q66 0 113 47t47 113Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_manage_accounts"},n.createElement("path",{d:"m640-120-12-60q-12-5-22.5-10.5T584-204l-58 18-40-68 46-40q-2-14-2-26t2-26l-46-40 40-68 58 18q11-8 21.5-13.5T628-460l12-60h80l12 60q12 5 22.5 11t21.5 15l58-20 40 70-46 40q2 12 2 25t-2 25l46 40-40 68-58-18q-11 8-21.5 13.5T732-180l-12 60h-80ZM80-160v-112q0-33 17-62t47-44q51-26 115-44t141-18h14q6 0 12 2-29 72-24 143t48 135H80Zm600-80q33 0 56.5-23.5T760-320q0-33-23.5-56.5T680-400q-33 0-56.5 23.5T600-320q0 33 23.5 56.5T680-240ZM400-480q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_game_controller"},n.createElement("path",{d:"M182-200q-51 0-79-35.5T82-322l42-300q9-60 53.5-99T282-760h396q60 0 104.5 39t53.5 99l42 300q7 51-21 86.5T778-200q-21 0-39-7.5T706-230l-90-90H344l-90 90q-15 15-33 22.5t-39 7.5Zm498-240q17 0 28.5-11.5T720-480q0-17-11.5-28.5T680-520q-17 0-28.5 11.5T640-480q0 17 11.5 28.5T680-440Zm-80-120q17 0 28.5-11.5T640-600q0-17-11.5-28.5T600-640q-17 0-28.5 11.5T560-600q0 17 11.5 28.5T600-560ZM310-440h60v-70h70v-60h-70v-70h-60v70h-70v60h70v70Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_search"},n.createElement("path",{d:"M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_add_circle"},n.createElement("path",{d:"M440-280h80v-160h160v-80H520v-160h-80v160H280v80h160v160Zm40 200q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_lock"},n.createElement("path",{d:"M240-80q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640h40v-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240Zm240-200q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM360-640h240v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85v80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_open_in_new"},n.createElement("path",{d:"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h560v-280h80v280q0 33-23.5 56.5T760-120H200Zm188-212-56-56 372-372H560v-80h280v280h-80v-144L388-332Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_link"},n.createElement("path",{d:"M440-280H280q-83 0-141.5-58.5T80-480q0-83 58.5-141.5T280-680h160v80H280q-50 0-85 35t-35 85q0 50 35 85t85 35h160v80ZM320-440v-80h320v80H320Zm200 160v-80h160q50 0 85-35t35-85q0-50-35-85t-85-35H520v-80h160q83 0 141.5 58.5T880-480q0 83-58.5 141.5T680-280H520Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"dpicon_help"},n.createElement("path",{d:"M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm-36-154h74q0-33 7.5-52t42.5-52q26-26 41-49.5t15-56.5q0-56-41-86t-97-30q-57 0-92.5 30T342-618l66 26q5-18 22.5-39t53.5-21q32 0 48 17.5t16 38.5q0 20-12 37.5T506-526q-44 39-54 59t-10 73Zm38 314q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"}))),oa=e=>{let{children:t,isHomePage:a,breadcrumbItems:r}=e;const[l,i]=(0,n.useState)(!1);if((0,n.useEffect)((()=>{var e;window.innerWidth<=450&&(null===(e=document.querySelector("meta[name=viewport]"))||void 0===e||e.setAttribute("content","width=375, user-scalable=0"));if(!document.getElementById("devPortalFont")){const e=document.createElement("link");e.id="devPortalFont",e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&family=Inter:wght@400;700&display=swap",document.head.appendChild(e)}return i((0,p.d1)()?"app":"web"),document.body.classList.add("devPortalBody"),document.body.classList.add("devPortalColor"),()=>{document.body.classList.remove("devPortalBody"),document.body.classList.remove("devPortalColor")}}),[]),!l)return null;const s="devPortal devPortalColor "+(a?"devPortal_home":"");return"app"===l?n.createElement("div",{className:s},n.createElement("div",{className:"devPortal_bodyWrapper",style:{paddingTop:0}},n.createElement("div",{className:"devPortal_body"},t)),n.createElement(sa,null)):n.createElement("div",{className:s},n.createElement(aa,null),n.createElement(ra,null),n.createElement("div",{className:"devPortal_bodyWrapper"},n.createElement(la,{items:r||[]}),n.createElement("div",{className:"devPortal_body"},t)),n.createElement(ia,null),n.createElement(sa,null))},ca=e=>{let{className:t,children:a}=e;return n.createElement("div",{className:(0,u.Z)("devPortal_alert",t)},n.createElement("div",{className:"devPortal_alert_header"},n.createElement(l.Z,{icon:"info"}),"请留意"),n.createElement("div",{className:"devPortal_alert_content"},a))},da=e=>n.createElement(n.Fragment,null,n.createElement("ul",{className:"mb-0"},n.createElement("li",null,"上传前请先阅读 ",n.createElement(s.Z,{to:"https://docs.gcores.com/dev/docs/game-management/web-game/",openNewWindow:!0},"在线试玩说明文档",n.createElement(l.Z,{icon:"open_in_new"})),"，并按照文档要求进行操作。"),n.createElement("li",null,"如果您使用的是 Unity 引擎，请额外阅读 ",n.createElement(s.Z,{to:"https://docs.gcores.com/dev/docs/game-management/web-game/before-upload/unity",openNewWindow:!0},"Unity 引擎上传前准备文档",n.createElement(l.Z,{icon:"open_in_new"})),"。"),n.createElement("li",null,"频繁提交新的在线试玩版本可能导致游戏审核时间增加。"),n.createElement("li",null,"正式提交审核前，建议您点击下方「保存并预览」按钮，对在线试玩游戏进行内部测试。")));var ma=a(54186);const ua=1e3,pa=/(\.|\/)(html|zip)$/i,ga=["text/html","application/zip","application/octet-stream","application/x-zip-compressed","application/zip-compressed","multipart/x-zip","application/x-zip"],ha=e=>{let{tip:t,value:a,onChange:l}=e;const i=(0,r.useSelector)((e=>e.getIn(["session","token"]))),[s,c]=(0,n.useState)(!1),d=(0,n.useCallback)((async e=>{if(e.size>1048576e3)return alert("文件过大，请保持在 1000MB 以内");if(!ga.includes(e.type)||!pa.test(e.name))return alert("请上传 zip 或 html 文件");if(!i)return alert("请先登录");(new FormData).append("file",e),c(0);const t=await function(e){let{file:t,token:a,onProgress:n}=e;return new Promise(((e,r)=>{if(!a)return void r(new Error("请先登录"));const l=new XMLHttpRequest;l.open("POST",`${ma.default.api_url}/upload/game`),l.setRequestHeader("Authorization",`Token token=${a}`),l.upload.addEventListener("progress",(e=>{if(e.lengthComputable){const t=e.loaded/e.total*100;n(t)}})),l.addEventListener("load",(()=>{if(l.status>=200&&l.status<300){const t=JSON.parse(l.responseText);e({path:t.path,filename:t.filename})}else r(new Error(`上传失败: ${l.statusText}`))})),l.addEventListener("error",(()=>{r(new Error("上传失败"))}));const i=new FormData;i.append("file",t),l.send(i)}))}({file:e,token:i,onProgress:e=>{c(e)}}).catch((e=>{alert(e)}));t&&l(t),c(!1)}),[l,i]),m=(null==a?void 0:a.filename)||(null==a?void 0:a.path)||"";return n.createElement("div",{className:(0,u.Z)("gameLinkFieldX_uploader",{is_uploading:s})},n.createElement("div",null,"number"==typeof s&&s>=0?`${s.toFixed(2)}% ${s>=99?"处理中":"上传中"}`:null!=a&&a.path?n.createElement(n.Fragment,null,n.createElement("div",{className:"mt-1"},m),n.createElement("div",{className:"gameLinkFieldX_buttonGroup"},n.createElement("div",{className:"deleteButtonWrapper"},n.createElement(o,{onClick:()=>l(null)},"删除")),n.createElement(o,{buttonStyle:"primary"},"上传新版本"))):n.createElement(o,{buttonStyle:"primary"},"上传在线试玩文件")),n.createElement("input",{type:"file",accept:"text/html, application/zip",onChange:e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t.item(0);a&&d(a)}}))};var va=a(12978);const Ea="参赛链接",fa=["百度网盘","itch","奶牛快传","GoogleDrive","其它"].map((e=>({label:e,value:e}))),ya=e=>{let{link:t,onChange:a,eventMode:r=!1}=e;return n.createElement("div",{className:"d-flex gap-2 devPortal_form_link"},!r&&n.createElement(n.Fragment,null,n.createElement(C.Z,{plain:!0,type:"danger",className:"devPortal_form_link_del",onClick:()=>{a(null)}},"×"),n.createElement(ee.ZP,{className:"w-25",classNamePrefix:"react-select",options:fa,value:fa.find((e=>e.value===t.label))||fa.find((e=>"其它"===e.value)),onChange:e=>{e&&a({label:e.value,url:t.url})}})),n.createElement("input",{type:"text",className:"form-control","aria-label":"Text input with dropdown button",value:t.url,onChange:e=>{a({label:t.label,url:e.target.value.replace(/\s/g,"")})}}))},ba=e=>{let{input:t,meta:a,inEvent:r}=e;return r?n.createElement(I.cw,{label:"参赛链接",tip:"若您的游戏有可下载版本，可将网盘等链接填写在此处，链接和在线试玩必须至少填写一个才视为有效参赛。如果有访问密码请加到链接参数里（比如百度网盘的pwd=xxxx）。"},n.createElement(ya,{eventMode:!0,link:t.value.find((e=>e.label===Ea))||{label:Ea,url:""},onChange:e=>{const a=t.value.find((e=>e.label===Ea));t.onChange(a?t.value.map((t=>t.label===Ea?e:t)):[...t.value,e])}}),(0,I.I1)(a)):n.createElement(I.cw,{label:"相关链接",tip:"若您的游戏有可下载版本，可将网盘等链接填写在此处"},n.createElement("div",{className:"d-flex flex-column gap-2"},t.value.map(((e,a)=>n.createElement(ya,{key:a,link:e,onChange:e=>{t.onChange(t.value.map(((t,n)=>a===n?e:t)).filter((e=>e)))}}))),n.createElement(C.Z,{block:!0,onClick:()=>{t.onChange([...t.value,{label:fa[0].value,url:""}])}},"新增链接"),(0,I.I1)(a)))},ka=e=>{let{formId:t,entryId:a,eventStatus:r,gameLinks:l,previousGameLink:i,handleSubmit:s}=e;const o=(0,va.F1)(l),c=i||o.latest,d=null==c?void 0:c.get("id"),m=(null==c?void 0:c.getExternalLinks())||[],u=(0,n.useMemo)((()=>(0,va.SX)(c)),[c]),p=(null==c?void 0:c.getAttr("review-notes"))||null,g="normal"!==r;return n.createElement(Z.l0,{onSubmit:(e,t)=>{s(null==c?void 0:c.get("id"),e,t.getState().dirtyFields)},initialValues:{links:m,attachmentInfo:u}},(e=>{let{handleSubmit:a,form:r}=e;return n.createElement("form",{id:t,onSubmit:a},n.createElement(Z.gN,{label:"版本号",name:"version",tip:"为本版本命名，支持大小写英文字母、数字、“.”和“-”",alwaysTip:!0,parse:I.h0,validate:e=>{if(!/^[a-zA-Z0-9.-]+$/.test(e))return"版本号只能包含大小写英文字母、数字、“.”和“-”"}},I.CF),n.createElement(Z.gN,{inEvent:g,name:"links",alwaysTip:!0,validate:e=>{for(const{url:t,label:a}of e){if(!a)return"无效的标签";if(g){if(a===Ea&&t&&!(0,fe.jK)(t))return`无效的链接: ${t}`}else{if(!t)return"链接不能为空";if(!(0,fe.jK)(t))return`无效的链接: ${t}`}}return null}},ba),n.createElement(Z.gN,{label:"网页在线试玩",name:"attachment-info",tip:"如果游戏可以在网页上运行，你可以上传游戏的网页版供玩家试玩",initialValue:u},(e=>{let{input:t,label:a,tip:r,meta:l}=e;const i=(()=>{var e;if(o.latestIsSubmitted)return n.createElement(n.Fragment,null,"请耐心等待审核结果",null!==(e=t.value)&&void 0!==e&&e.filename?`，最新版本为 ${t.value.filename}`:"");const a=o.latest,r=d&&!l.dirty?`#${d}`:"",i=a?"approved"===a.getAttr("state")?`${r} 当前为线上版本`:"rejected"===a.getAttr("state")?`${r} 被拒绝：${a.getAttr("reject-reason")}`:r:null;return n.createElement(ha,{tip:i,value:t.value,onChange:e=>{t.onChange(e)}})})();return n.createElement(I.cw,{label:a,tip:r},n.createElement("div",{className:"gameLinkFieldX"},n.createElement("div",{className:"gameLinkFieldX_manageContainer"},i),n.createElement("div",{className:"gameLinkFieldX_toolbar"}),n.createElement("div",{className:"gameLinkFieldX_description"},n.createElement("ul",null,n.createElement("li",null,"基础要求：文件必须为一个包含 index.html 的 ZIP 文件，或一个包含全部游戏内容的 index.html 文件"),n.createElement("li",null,"文件大小：不超过 ",ua,"MB"),n.createElement("li",null,"该功能目前还在测试阶段，如果遇到问题请机核私信联系“暴造喵”")))))})),n.createElement(ca,null,n.createElement(da,null)),n.createElement(Z.gN,{label:"审核补充材料",name:"review-notes",tip:"为了加快审核速度，您可以在此提交游戏攻略、流程介绍等材料的网盘链接，这部分内容不会展示给玩家",alwaysTip:!0,parse:I.h0,initialValue:p},I.CF))}))},Ca=e=>{let{gameLink:t,entryId:a,eventStatus:r}=e;const l=t.getAttr("state"),i=va.AF[l].color,o=(0,va.z9)(l,r),c=t.getAttr("reject-reason"),d=t.getExternalLinks(),u=(0,va.FP)(t);return n.createElement("div",{className:"devPortal_gameLinkInfoPage"},n.createElement("h3",{className:"devPortal_numberFont devPortal_gameLinkInfoPage_versionTitle"},n.createElement("span",null,"版本"),(0,va.JO)(t)),n.createElement("div",{className:"devPortal_gameLinkInfoPage_item"},n.createElement("h4",null,"审核状态"),n.createElement("div",null,n.createElement("div",{className:"devPortal_gameLinkInfoPage_stateDot",style:{backgroundColor:i}}),o,c?(0,h.eL)("："+c):null)),n.createElement("div",{className:"devPortal_gameLinkInfoPage_item"},n.createElement("h4",null,"相关链接"),n.createElement("div",null,d.length>0?d.map(((e,t)=>n.createElement("div",{key:t},n.createElement("a",{href:e.url,target:"_blank",rel:"noreferrer"},e.label,": ",e.url)))):"无")),n.createElement("div",{className:"devPortal_gameLinkInfoPage_item"},n.createElement("h4",null,"在线试玩"),n.createElement("p",null,u||"无"),"testing"===t.getAttr("state")&&u&&n.createElement(s.Z,{to:(0,m.ZP)("game",{id:a})+"/play",openNewWindow:!0,disablePush:!0},"预览在线试玩")),n.createElement("div",{className:"devPortal_gameLinkInfoPage_item"},n.createElement("h4",null,"审核补充材料"),n.createElement("p",null,t.getAttr("review-notes")||"无")),n.createElement("div",{className:"devPortal_gameLinkInfoPage_item"},n.createElement("h4",null,"创建时间"),n.createElement("p",null,(0,va.Al)(t.getAttr("created-at"))||"无")))},_a="entry_form",wa=(0,g.zU)({depth:3}),Na=e=>e.getIn(["data",k.Z.namespace,"eventNames"]),Pa=e=>{var t,a;let{entryId:i}=e;const s=(0,r.useDispatch)(),[c,d]=(0,n.useState)(!1),m=(0,r.useSelector)((e=>wa(e,{type:"games",id:i}))),p=(0,r.useSelector)(Na),h=(0,va.kL)(m,p),v=(null==m?void 0:m.getRel("game-links"))||(0,G.List)(),E=null==m?void 0:m.getRel("previous-game-link"),f=(0,g.xJ)(),[y,b]=(0,n.useState)(void 0),k=(0,va.F1)(v),_=(0,n.useRef)(!1),w=null===(t=k.sorted.find((e=>"obsolete"!==e.state)))||void 0===t?void 0:t.id,[N,P]=(0,n.useState)(w||-1),S=(0,n.useMemo)((()=>v.find((e=>e.id===N))),[v,N]),Z="testing"!==(null===(a=k.latest)||void 0===a?void 0:a.getAttr("state")),A="voting"===h,R=-1===N,D="testing"===(null==S?void 0:S.getAttr("state")),x="pending"===(null==S?void 0:S.getAttr("state"));(0,n.useEffect)((()=>{s((0,T.D1)(`game-links/is-reviewable?entry-id=${i}`)).then((e=>{b(e.payload.origin)}))}),[i,s]);const M=e=>e?"pending"===e?A?n.createElement("div",{className:"devPortal_form_actions"},n.createElement("div",{className:"spacer"}),n.createElement(o,{disabled:!0},(0,va.z9)("pending","voting"))):n.createElement("div",{className:"devPortal_form_actions"},n.createElement("div",{className:"spacer"}),n.createElement(o,{disabled:c,onClick:async()=>{d(!0),await s((0,T.D1)(`game-links/${N}`,{method:"PATCH",body:{data:{type:"game-links",id:N,attributes:{state:"obsolete"}}}})),d(!1),alert("撤销审核成功"),window.location.reload()}},"撤销审核")):"create"===e?n.createElement("div",{className:"devPortal_form_actions"},n.createElement("div",{className:"spacer"}),n.createElement(o,{disabled:c||!y||!k.latestIsSubmitable&&-1!==N,onClick:()=>{_.current=!0,(0,I.Ps)(_a)}},"保存并预览"),!A&&n.createElement(o,{disabled:c||!y||!k.latestIsSubmitable&&-1!==N,onClick:()=>{_.current=!1,(0,I.Ps)(_a)},buttonStyle:"primary"},"提交审核")):"testing"===e?n.createElement("div",{className:"devPortal_form_actions"},n.createElement("div",{className:"spacer"}),n.createElement(o,{disabled:c||!y||!k.latestIsSubmitable&&-1!==N,onClick:async()=>{d(!0),await s((0,T.D1)(`game-links/${N}`,{method:"PATCH",body:{data:{type:"game-links",id:N,attributes:{state:"obsolete"}}}})),d(!1),alert("撤回成功，您可以重新编辑该版本"),window.location.reload()}},"撤回并编辑"),n.createElement(o,{disabled:A||c||!y||!k.latestIsSubmitable&&-1!==N,buttonStyle:"primary",onClick:async()=>{d(!0),await s((0,T.D1)(`game-links/${N}`,{method:"PATCH",body:{data:{type:"game-links",id:N,attributes:{state:"pending"}}}})),d(!1),alert("提交成功，请等待审核"),window.location.reload()}},(0,va.z9)("testing",h,"提交审核"))):null:null,L=m?n.createElement("section",{id:"devPortal_form_link"},n.createElement("div",{className:"devPortal_form_link_versions"},n.createElement(C.Z,{className:(0,u.Z)("devPortal_form_link_add",{active:-1===N}),plain:!0,disabled:!Z,onClick:()=>{P(-1)}},n.createElement(l.Z,{icon:"add_circle"}),n.createElement("span",null,"创建新版本")),k.sorted.map((e=>"obsolete"===e.getAttr("state")?null:n.createElement("button",{key:e.id,onClick:()=>{P(e.id)},className:N===e.id?"active":""},n.createElement("p",null,(0,va.JO)(e)),n.createElement("span",null,(e=>e===k.online?"当前公开":"testing"===e.getAttr("state")?"草稿":"pending"===e.getAttr("state")||"under_review"===e.getAttr("state")?"审核中":"approved"===e.getAttr("state")?"已过审":"rejected"===e.getAttr("state")?"未过审":"")(e)))))),n.createElement("div",{className:"devPortal_form_section_main"},n.createElement("div",{className:"devPortal_form_section_main_content"},R?n.createElement(n.Fragment,null,n.createElement("div",{className:"devPortal_gameLinkInfoPage"},n.createElement("h3",{className:"devPortal_numberFont devPortal_gameLinkInfoPage_versionTitle"},n.createElement("span",null,-1===N?`创建${"enrolling"!==h||w?"新":"参赛"}版本`:"测试版本"),-1!==N?(0,va.JO)(S):"")),n.createElement(ka,{eventStatus:h,formId:_a,entryId:m.get("id"),gameLinks:v,previousGameLink:E,handleSubmit:async(e,t,a)=>{if(!a.links&&!a["attachment-info"]&&!a["review-notes"])return void alert("您需要修改版本号以外的信息才能提交版本");const n=_.current,r=n?"testing":"pending";d(!0),await(0,va.af)(s,t,f,i,r),d(!1),alert(n?"保存成功，您已可以前往游戏页面预览和测试在线试玩版本":"提交成功，请等待审核"),window.location.reload()}})):n.createElement(Ca,{eventStatus:h,gameLink:S,entryId:i})),M(R?"create":D?"testing":x?"pending":null))):null;return n.createElement(n.Fragment,null,n.createElement("div",{className:(0,u.Z)("gcApp")},n.createElement("div",{id:"devPortal_form_body",className:"gcApp_body gcApp_container"},L)))}},12978:(e,t,a)=>{a.d(t,{AF:()=>m,Al:()=>s,F1:()=>l,FP:()=>c,JO:()=>o,SX:()=>d,af:()=>i,kL:()=>u,z9:()=>p});var n=a(85551),r=a(14810);const l=e=>{const t=e.filter((e=>!0)).sort(((e,t)=>(0,n.u3)(t.getAttr("created-at"))-(0,n.u3)(e.getAttr("created-at")))),a=t.filter((e=>["under_review","pending"].includes(e.getAttr("state")))),r=t.filter((e=>"approved"===e.getAttr("state"))),l=t.get(0)||null;return{sorted:t,latest:l,latestIsSubmitted:["under_review","pending"].includes((null==l?void 0:l.getAttr("state"))||""),latestIsSubmitable:"testing"===(null==l?void 0:l.getAttr("state")),submitted:a,latestSubmitted:a.get(0)||null,approved:r,online:r.get(0)||null}},i=async function(e,t,a,n){var l;let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"testing";const s=await e((0,r.D1)("game-links",{method:"POST",body:{data:{type:"game-links",attributes:{...t.version?{version:t.version}:{},...(null===(l=t.links)||void 0===l?void 0:l.length)>0?{"external-links":JSON.stringify(t.links.filter((e=>e&&e.url&&e.label)))}:{},...t["attachment-info"]&&t["attachment-info"].path?{"attachment-path":t["attachment-info"].path}:{},...t["attachment-info"]&&t["attachment-info"].filename?{"attachment-filename":t["attachment-info"].filename}:{},...t["review-notes"]?{"review-notes":t["review-notes"]}:{},state:i},relationships:{user:{data:{type:"users",id:a.get("id")}},entry:{data:{type:"games",id:n}}}}}}));if(s.error)throw s.payload;return{type:s.payload.data.type,id:s.payload.data.id}},s=e=>{const t=new Date(e);return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${t.getMinutes()}`},o=e=>e.getAttr("version")||s(e.getAttr("created-at")),c=e=>e.getAttr("attachment-filename")||e.getAttr("attachment-path")||"",d=e=>{if(null==e)return null;const t=e.getAttr("attachment-path")||"",a=e.getAttr("attachment-filename")||"";return t||a?{path:t,filename:a}:null},m={testing:{color:"#37BEE8",text:"待提交审核"},pending:{color:"#ECD141",text:"审核中"},approved:{color:"#50DF56",text:"已通过审核"},rejected:{color:"#D73636",text:"未通过审核"},under_review:{color:"#ECD141",text:"审核中"},obsolete:{color:"#898989",text:"已失效"}},u=(e,t)=>{const a=t.get("listable")||[],n=t.get("active")||[],r=e.getAttr("event-name");return!r||a.includes(r)?"normal":n.includes(r)?"enrolling":"voting"},p=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m[e].text;return"enrolling"===t?{pending:"该版本将在比赛截止时间开始审核"}[e]||a:"voting"===t&&{testing:"比赛评审阶段无法更新",pending:"此版本已参与比赛评选，请等待审核结果"}[e]||a}},14144:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294);const r=e=>{let{title:t,subTitle:a}=e;return n.createElement("div",{className:"devPortal_pageHeader"},n.createElement("div",{className:"titleText"},n.createElement("h1",null,t),n.createElement("p",{className:"devPortal_numberFont"},a)))}},81765:(e,t,a)=>{a.d(t,{E2:()=>o,Uk:()=>l,dM:()=>s});var n=a(59310);const r=e=>["data","devCommunityManagePage",e,"ids"],l=(0,n.TJ)(r("entities")),i=(0,n.TJ)(r("involvements")),s=(0,n.P1)(i,n.VS),o=(0,n.TJ)(r("applications"))},84461:(e,t,a)=>{a.d(t,{Z:()=>p,h:()=>s});var n=a(35369),r=a(72739),l=a(85540),i=a(28680);const s=5,o="devCommunityManagePage",c=(0,i.x)("getEntities",(e=>[`users/${e}/settled-entities`,{limit:100,include:["positions"]}]),{namespace:o,reducerDefault:"result"}),d=(0,i.x)("getInvolvements",(e=>[`users/${e}/involvements`,{limit:100,include:["entry"]}]),{namespace:o,reducerDefault:"result"}),m=(0,i.x)("getApplications",(()=>["settlement-applications",{filters:{state:"pending"},limit:s}]),{namespace:o,reducerDefault:"result"}),u=(0,i.x)("getEventNames",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return[`games/event-names?filter=${e}`,{meta:{filter:e}}]}),{namespace:o,reducerDefault:"origin"}),p={namespace:o,actions:{[c.name]:c.action,[d.name]:d.action,[m.name]:m.action,[u.name]:u.action},reducer:(e,t)=>(0,r.U)({entities:c.reducer,involvements:d.reducer,applications:m.reducer,eventNames:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),a=arguments.length>1?arguments[1]:void 0;if((null==a?void 0:a.type)!==(0,l.Xk)(u.action.toString()))return t;const{filter:r}=a.meta;return"all"===r?(0,n.Map)(a.payload.origin.data):t.set(r,(null===(e=a.payload.origin)||void 0===e?void 0:e.data)||[])}})(e,t)}},79989:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294);const r=e=>{let{icon:t}=e;return n.createElement("svg",{className:"gamePageX_icon"},n.createElement("use",{xlinkHref:`#${t}`}))}},32826:(e,t,a)=>{a.d(t,{Y:()=>Je,default:()=>Ye});var n=a(67294),r=a(50533),l=a(3024),i=a(35218),s=a(91433),o=a(80239),c=a(82106),d=a(79989);const m=e=>{let{children:t,content:a,className:r}=e;const[l,i]=n.useState(!1),s=n.useRef(null),o=n.useRef(new Date),m=(0,n.useCallback)((()=>{o.current=new Date,i(!0)}),[]),u=(0,n.useCallback)((()=>{const e=new Date;setTimeout((()=>{o.current.getTime()<e.getTime()&&i(!1)}),400)}),[]);return n.createElement("div",{className:"gamePageX_headerMenuContainer "+r,ref:s,onMouseEnter:m,onMouseLeave:u},n.createElement(c.Popover,{isOpen:l,content:()=>n.createElement("div",{onClick:()=>i(!1),className:"gamePageX_headerMenuInner"},a),positions:["bottom","top","left","right"],containerClassName:"gamePageX_headerMenu",boundaryInset:15,parentElement:s.current||void 0},n.createElement("a",{className:"gamePageX_header_link"},t,n.createElement(d.Z,{icon:"expand_more"}))))};var u=a(73935),p=a(59310),g=a(23274);const h=e=>{let{goal:t,dispatch:a}=e;a((0,g.CcW)(!0,{tip:`登录机核账号来${t}`}))};var v=a(26555);const E=e=>{let{gameInfo:t,onEditorClick:a}=e;return n.createElement(n.Fragment,null,n.createElement(i.Z,{to:`/dev_community/entries/${t.id}/edit`,className:"gamePageX_header_link"},"编辑游戏资料"),n.createElement("a",{onClick:a,className:"gamePageX_header_link"},"页面主题编辑器"))},f=e=>{let{children:t,mobileElement:a}=e;const[r,l]=n.useState(!1),i=(0,v.Fg)(),[s,o]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{o(!0)}),[]),n.createElement("div",{className:"gamePageX_header_foldArea "+(r?"expand":"")},n.createElement("span",{className:"gamePageX_header_foldToggle",onClick:()=>l((e=>!e))},n.createElement(d.Z,{icon:"menu"})),n.createElement("div",{className:"gamePageX_header_foldNormal"},t),s&&(0,u.createPortal)(n.createElement("div",{className:"gamePageX gamePageX_portal",style:null==i?void 0:i.style},n.createElement("div",{className:"gamePageX_header_foldExpand "+(r?"expand":"")},n.createElement("div",{className:"gamePageX_header_foldFloat"},n.createElement("a",{className:"closeBtn",onClick:()=>{l(!1)}},n.createElement(d.Z,{icon:"close"})),a,n.createElement("div",{onClick:()=>l(!1),className:"chilrenItems"},t)),n.createElement("div",{className:"gamePageX_header_foldClose",onClick:()=>{l(!1)}}))),document.body))},y=()=>n.createElement(n.Fragment,null,n.createElement(i.Z,{to:"/booom",className:"gamePageX_site_logo logo_full"},n.createElement("svg",{className:"booom_logo",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1118.09 196.96"},n.createElement("path",{d:"M974.09 92.81V63.86h56.15V53.12h-55.88L988 2.36h28.42l-5.86 21.82h19.68V2.36h29.43v21.82h43.38v28.94h-43.38v10.74h48.84v28.95H974.09zm-35.68-39.69L924.77 2.36h28.43l13.64 50.76h-28.43zm67.68 141.4c-22.36 0-39.3-4.92-50.36-14.48l-.84-.72-8 15.2H915.5l23.65-45.94V92.8h-15.41V63.86h43.36v82c3.13 19.95 20.23 21.6 39 21.6h112v27zm65.36-35.41v-5.38h-60.3v5.38h-30.91v-58.29h122.13v58.29zm-60.3-28.05h60.3v-9.72h-60.3zm-138.77 8.8l19.84 24.26h30.19l-31-37.89h21.85V100H878.8v-8.82h27.66V63.4H878.8v-8.89h21.25V2.44h-158.5v52.07h21.26v8.89h-27.67v27.78h27.67V100h-34.47v26.19h21.85l-31 37.89h30.2l19.84-24.26 5.16 8.45-37.8 46.21h40.62l24.88-30.4h1.09v30.4h35.24v-30.4h1.1l24.87 30.4H905l-37.81-46.21zm-34 2.38v-16h13l-9.78 16zm-38.43 0l-9.79-16h13v16zM770.8 24.53h100v7.89h-100zm21.65 30h56.7v8.87h-56.7zm0 36.67h56.7v8.8h-56.7zM59.76 194.52H0V2.44h59.45c39 0 54.58 20.73 54.58 50.92C114 77.13 100 93 81.1 96c22.87 4.57 36.59 20.12 36.59 45.43 0 33.57-17.99 53.09-57.93 53.09zM43.6 80.49h10.06c15.25 0 18.9-8.84 18.9-20.73 0-12.2-3.65-21.65-18.9-21.65H43.6zm0 33.85v44.21h11.28c15.55 0 19.82-7.93 19.82-22 0-13.41-4.27-22.25-19.82-22.25zm205.51-3.97c0 55.18-17.38 86.59-62.2 86.59s-62.2-31.41-62.2-86.59V86.59C124.71 31.4 142.09 0 186.91 0s62.2 31.4 62.2 86.59zM171.05 132c0 17.07 2.75 28.66 15.86 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66s-15.86 11.59-15.86 28.66zm209.78-21.63c0 55.18-17.38 86.59-62.2 86.59s-62.2-31.41-62.2-86.59V86.59C256.43 31.4 273.81 0 318.63 0s62.2 31.4 62.2 86.59zM302.78 132c0 17.07 2.74 28.66 15.85 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66s-15.85 11.59-15.85 28.66zm209.77-21.63c0 55.18-17.37 86.59-62.19 86.59s-62.21-31.41-62.21-86.59V86.59C388.15 31.4 405.54 0 450.36 0s62.19 31.4 62.19 86.59zM434.5 132c0 17.07 2.74 28.66 15.86 28.66s15.85-11.59 15.85-28.66V64.94c0-17.07-2.74-28.66-15.85-28.66S434.5 47.87 434.5 64.94zM601 100h1.22L620.5 2.44h56.4v192.08h-41.46V85.06h-1.22l-21 109.46h-28L563.48 85.06h-1.22v109.46h-39.33V2.44h57.62z"}),n.createElement("path",{d:"M156.143 46.7l82.541 82.541-21.022 21.022-82.541-82.541zm131.727.007l82.541 82.541-21.022 21.022-82.541-82.541zm131.721 0l82.541 82.541-21.022 21.022-82.541-82.541z"}))),n.createElement(i.Z,{to:"/booom",className:"gamePageX_site_logo logo_compact"},n.createElement("svg",{className:"booom_logo",viewBox:"0 0 249 210",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M204.38 161.163C196.472 177.681 180.429 183.515 167.609 176.981C156.464 171.303 151.428 158.145 155.496 143.952C157.324 143.419 159.213 142.785 161.152 142.06C161.059 142.447 160.971 142.837 160.892 143.235C158.524 155.013 163.259 166.244 171.467 168.32C173.207 168.76 174.961 168.755 176.671 168.359C177.473 168.173 178.112 169.096 177.815 170.007C177.409 171.244 177.363 172.436 177.752 173.459C178.951 176.605 183.813 176.955 188.613 174.241C193.415 171.527 196.335 166.776 195.137 163.629C194.296 161.417 191.643 160.588 188.475 161.233C187.576 161.416 186.947 160.237 187.461 159.332C188.88 156.837 189.975 153.939 190.615 150.752C192.304 142.349 190.376 134.228 186.155 129.508C191.039 126.524 195.809 123.324 200.247 120.073C208.812 128.413 211.307 146.696 204.38 161.163ZM108.255 99.0014C108.255 82.6187 120.928 59.6761 136.561 59.6761C152.196 59.6761 164.869 82.6187 164.869 99.0014C164.869 115.385 152.196 130.437 136.561 130.437C120.928 130.437 108.255 115.385 108.255 99.0014ZM105.515 176.981C92.6933 183.515 76.652 177.681 68.744 161.163C60.8347 144.645 65.208 123.152 76.8747 117.165C86.888 112.027 107.261 120.987 115.171 137.504C123.079 154.023 118.335 170.449 105.515 176.981ZM230.755 138.495C238.455 110.275 223.329 99.08 223.329 99.08C237.499 80.5107 239.449 57.0294 226.613 42.2961C215.14 29.1267 195.124 26.7054 176.481 34.5467L174.097 5.31961e-05C174.097 5.31961e-05 162.68 13.9907 153.011 30.6654C145.201 27.8147 135.599 27.7014 126.164 31.016C120.116 33.1414 114.9 36.412 110.793 40.3547L97.9173 23.0521C97.9173 23.0521 97.0267 30.86 96.6707 41.7C68.6213 39.2067 43.848 53.8614 39.8307 76.3227C39.0893 80.468 39.12 84.608 39.8067 88.652C26.4787 88.5254 13.5093 89.8361 0 92.7361C0 92.7361 14.7053 102.733 37.0547 113.817C30.26 121.561 27.876 131.192 30.5827 140.164C34.8533 154.319 47.884 156.428 47.884 156.428C46.896 164.503 52.4587 172.781 59 179.803C75.4707 197.485 124.183 206.571 170.972 194.929C183.107 203.78 193.723 209.816 193.723 209.816L187.568 189.952C201.853 184.901 216.027 173.359 226.821 152.693C239.891 152.36 248.068 151.48 248.068 151.48C242.072 146.416 237.057 142.595 230.755 138.495ZM93.0838 125.666C84.8758 127.742 80.1412 138.974 82.5078 150.753C83.1492 153.938 84.2438 156.838 85.6625 159.331C86.1772 160.237 85.5465 161.415 84.6492 161.233C81.4798 160.589 78.8278 161.418 77.9852 163.63C76.7878 166.775 79.7092 171.526 84.5092 174.241C89.3105 176.955 94.1732 176.606 95.3705 173.459C95.7612 172.437 95.7145 171.243 95.3092 170.006C95.0118 169.097 95.6492 168.173 96.4518 168.358C98.1612 168.754 99.9172 168.761 101.656 168.321C109.864 166.245 114.6 155.013 112.232 143.234C109.865 131.455 101.292 123.59 93.0838 125.666ZM138.272 121.529C137.173 120.095 137.348 117.922 138.506 115.623C138.884 114.875 138.297 114.017 137.461 114.062C137.162 114.078 136.864 114.086 136.561 114.086C125.704 114.086 116.901 103.631 116.901 92.2526C116.901 80.874 125.704 64.9393 136.561 64.9393C147.42 64.9393 156.222 80.874 156.222 92.2526C156.222 96.662 154.897 100.93 152.645 104.507C152.213 105.193 152.674 106.063 153.478 106.157C154.732 106.299 155.756 106.783 156.409 107.635C158.466 110.321 156.074 115.609 151.065 119.445C146.057 123.282 140.329 124.215 138.272 121.529Z"})))),b=()=>n.createElement(i.Z,{to:"/booom",className:"gamePageX_site_logo"},n.createElement("svg",{width:"716",height:"200",viewBox:"0 0 716 200",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"gameLib_logo"},n.createElement("g",{clipPath:"url(#clip0_417_80)"},n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M41.6667 0C18.6548 0 0 18.6548 0 41.6666V91.6667H17.0781C20.987 52.2965 52.2965 20.987 91.6667 17.0781V0H41.6667ZM182.922 91.6667C179.013 52.2965 147.703 20.987 108.333 17.0781V0H158.333C181.345 0 200 18.6548 200 41.6667V91.6667H182.922ZM108.333 182.922C147.703 179.013 179.013 147.703 182.922 108.333H200V158.333C200 181.345 181.345 200 158.333 200H108.333V182.922ZM17.0781 108.333C20.987 147.703 52.2965 179.013 91.6667 182.922V200H41.6666C18.6548 200 0 181.345 0 158.333V108.333H17.0781Z",fill:"currentColor"}),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M116.099 127.884C103.316 135.435 86.5749 133.718 75.5916 122.735C64.6083 111.752 62.892 95.0107 70.4426 82.2279L52.4402 64.2255C35.309 87.0741 37.1335 119.632 57.9139 140.413C78.6943 161.193 111.252 163.018 134.101 145.886L116.099 127.884ZM82.2284 70.4435C95.0107 62.8952 111.75 64.6122 122.732 75.5945C133.714 86.5768 135.431 103.316 127.883 116.098L145.886 134.101C163.015 111.252 161.189 78.6963 140.41 57.9168C119.63 37.1373 87.0742 35.312 64.2257 52.4408L82.2284 70.4435Z",fill:"currentColor"})),n.createElement("path",{d:"M561.552 171.84C565.248 160.435 567.782 149.294 569.155 138.418C570.634 127.435 571.373 114.816 571.373 100.56V34.3489H628.714V26.1121H650.256V34.3489H707.28V54.1489H591.648V100.56C591.648 113.971 591.014 126.432 589.747 137.942C588.586 149.347 586.579 160.646 583.728 171.84H561.552ZM595.925 135.091H644.237V124.003H600.835V104.995H607.646L619.526 84.0865H599.41V65.2369H630.298L635.208 56.5249H657.384L652.474 65.2369H704.904V84.0865H641.702L629.822 104.995H644.237V90.1057H664.354V104.995H701.102V124.003H664.354V135.091H708.389V154.416H664.354V171.84H644.237V154.416H595.925V135.091Z",fill:"currentColor"}),n.createElement("path",{d:"M469.838 145.546C474.59 144.067 478.814 142.114 482.51 139.685C486.312 137.15 489.955 134.035 493.44 130.339C488.054 117.667 485.362 102.197 485.362 83.928H467.462V64.6032H485.045V28.488H505.32V64.6032H546.504V83.928H505.795C505.901 91.1088 506.218 97.3392 506.746 102.619C507.274 107.899 508.277 112.704 509.755 117.034C514.085 109.536 517.464 101.035 519.893 91.5312H539.059C535.258 108.533 529.344 123.106 521.318 135.25C528.394 141.797 538.109 147.077 550.464 151.09V174.533C530.822 169.57 515.616 160.963 504.845 148.714C495.13 157.901 483.461 164.712 469.838 169.147V145.546ZM406.162 144.437C413.342 138.84 419.52 132.557 424.694 125.587C419.52 114.816 415.93 103.622 413.923 92.0064C412.022 80.2848 411.178 68.88 411.389 57.792H408.538V39.4176H464.453L463.344 56.5248C462.71 70.8864 461.021 83.8224 458.275 95.3328C455.635 106.738 451.57 117.35 446.078 127.171C450.83 133.296 456.586 138.893 463.344 143.962V168.514C452.256 161.755 442.91 153.307 435.307 143.17C427.704 152.779 417.989 162.019 406.162 170.89V144.437ZM429.13 57.792C429.235 68.0353 429.71 77.0641 430.555 84.8784C431.4 92.5873 432.931 99.768 435.149 106.421C440.429 93.3264 443.491 77.1168 444.336 57.792H429.13ZM528.763 31.9728L537.475 59.5344H518.784L510.072 31.9728H528.763Z",fill:"currentColor"}),n.createElement("path",{d:"M272.155 171.84C277.33 160.752 280.973 149.928 283.085 139.368C285.197 128.702 286.253 116.822 286.253 103.728V64.7616H278.65V44.328H294.965V29.28H314.923V44.328H330.605V64.7616H305.894V80.76H329.971V171.84H302.726V151.882H312.547V100.877H303.835V103.728C303.835 116.4 302.938 128.227 301.142 139.21C299.453 150.086 296.707 160.963 292.906 171.84H272.155ZM245.227 171.84C251.141 149.136 254.995 126.643 256.79 104.362H276.432C274.32 130.445 270.888 152.938 266.136 171.84H245.227ZM246.811 65.8704L276.907 73.1568V93.9072L246.811 86.9376V65.8704ZM249.346 29.28L276.115 35.9328V57.1584L249.346 50.5056V29.28ZM332.347 111.014H357.691L364.344 94.224H335.198V74.8992H390.322L376.699 111.014H392.856V130.339H374.957V171.84H340.426V152.04H355.157V130.339H332.347V111.014ZM339.634 29.28H360.701L357.533 45.12H391.747V64.7616H332.506L339.634 29.28Z",fill:"currentColor"}),n.createElement("defs",null,n.createElement("clipPath",{id:"clip0_417_80"},n.createElement("rect",{width:"200",height:"200",fill:"currentColor"}))))),k=e=>{let{gameInfo:t,mode:a,onDownloadClick:c,onEditorClick:d}=e;const u=t.icon?(0,o.cR)(t.icon,{resize:{h:64,w:64,m:"lfit"}}):"",g=(0,s.ZP)("game",{id:t.id}),v=(0,p.xJ)(),k=(0,r.useDispatch)();return n.createElement(l.Z,{top:0},n.createElement("header",{className:"gamePageX_header"},n.createElement("div",{className:"spacer showOnMobile"}),t.isBooom?n.createElement(y,null):n.createElement(b,null),n.createElement("div",{className:"divider"}),t.icon&&n.createElement(i.Z,{to:g,className:"game_icon",draggable:!1},n.createElement("img",{src:u,draggable:!1})),n.createElement(f,{mobileElement:n.createElement("div",{className:"gamePageX_header_foldFloat_gameInfo"},t.icon&&n.createElement("img",{className:"game_icon",src:u,draggable:!1}),n.createElement("span",null,t.title))},n.createElement(i.Z,{to:g,draggable:!1,className:"gamePageX_header_link "+("intro"===a?"is_active":"")},"游戏介绍"),!t.hideGameLink&&t.attachment&&t.attachment.path&&n.createElement(i.Z,{to:g+"/play",draggable:!1,className:"gamePageX_header_link "+("play"===a?"is_active":"")},"在线试玩"),n.createElement(i.Z,{to:g+"/community",draggable:!1,className:"gamePageX_header_link "+("community"===a?"is_active":"")},"游戏社区")),n.createElement("div",{className:"spacer"}),t.developer.isOwner&&n.createElement(m,{className:"gamePageX_developerMenu",content:n.createElement(E,{onEditorClick:d,gameInfo:t})},"开发者工具"),!t.hideGameLink&&t.download&&n.createElement("button",{className:"btn downloadBtn",onClick:v?c:()=>{h({dispatch:k,goal:`查看《${t.title}》的相关链接`})}},n.createElement("span",{className:"hideOnMobile"},"相关"),"链接")))};var C=a(52004);const _=e=>{let{title:t,link:a,type:r}=e;return"normal"===r&&n.createElement(i.Z,{to:a,className:(0,C.Z)("tag",{booom_tag:!a}),div:a?void 0:"span"},t)||n.createElement("span",{className:"tag booom_tag"},n.createElement("svg",{className:"tag_booom_icon",viewBox:"0 0 677 197",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("g",{clipPath:"url(#clip0_389_107)"},n.createElement("path",{d:"M59.76 194.52H0V2.44H59.45C98.45 2.44 114.03 23.17 114.03 53.36C114 77.13 100 93 81.1 96C103.97 100.57 117.69 116.12 117.69 141.43C117.69 175 99.7 194.52 59.76 194.52ZM43.6 80.49H53.66C68.91 80.49 72.56 71.65 72.56 59.76C72.56 47.56 68.91 38.11 53.66 38.11H43.6V80.49ZM43.6 114.34V158.55H54.88C70.43 158.55 74.7 150.62 74.7 136.55C74.7 123.14 70.43 114.3 54.88 114.3L43.6 114.34ZM249.11 110.37C249.11 165.55 231.73 196.96 186.91 196.96C142.09 196.96 124.71 165.55 124.71 110.37V86.59C124.71 31.4 142.09 0 186.91 0C231.73 0 249.11 31.4 249.11 86.59V110.37ZM171.05 132C171.05 149.07 173.8 160.66 186.91 160.66C200.02 160.66 202.76 149.07 202.76 132V64.94C202.76 47.87 200.02 36.28 186.91 36.28C173.8 36.28 171.05 47.87 171.05 64.94V132ZM380.83 110.37C380.83 165.55 363.45 196.96 318.63 196.96C273.81 196.96 256.43 165.55 256.43 110.37V86.59C256.43 31.4 273.81 0 318.63 0C363.45 0 380.83 31.4 380.83 86.59V110.37ZM302.78 132C302.78 149.07 305.52 160.66 318.63 160.66C331.74 160.66 334.48 149.07 334.48 132V64.94C334.48 47.87 331.74 36.28 318.63 36.28C305.52 36.28 302.78 47.87 302.78 64.94V132ZM512.55 110.37C512.55 165.55 495.18 196.96 450.36 196.96C405.54 196.96 388.15 165.55 388.15 110.37V86.59C388.15 31.4 405.54 0 450.36 0C495.18 0 512.55 31.4 512.55 86.59V110.37ZM434.5 132C434.5 149.07 437.24 160.66 450.36 160.66C463.48 160.66 466.21 149.07 466.21 132V64.94C466.21 47.87 463.47 36.28 450.36 36.28C437.25 36.28 434.5 47.87 434.5 64.94V132ZM601 100H602.22L620.5 2.44H676.9V194.52H635.44V85.06H634.22L613.22 194.52H585.22L563.48 85.06H562.26V194.52H522.93V2.44H580.55L601 100Z",fill:"currentColor"}),n.createElement("path",{d:"M156.143 46.7L238.684 129.241L217.662 150.263L135.121 67.722L156.143 46.7ZM287.87 46.707L370.411 129.248L349.389 150.27L266.848 67.7289L287.87 46.707ZM419.591 46.707L502.132 129.248L481.11 150.27L398.569 67.7289L419.591 46.707Z",fill:"currentColor"})),n.createElement("defs",null,n.createElement("clipPath",{id:"clip0_389_107"},n.createElement("rect",{width:"677",height:"197",fill:"white"})))),"作品")},w=e=>(e=e||"").startsWith("blob:")||e.startsWith("data:")?e.replace(/(\r\n|\n|\r)/gm,""):(0,o.cR)(e,{resize:{h:450,w:1200,m:"lfit"}}),N=e=>{let{images:t,duration:a}=e;const[r,l]=(0,n.useState)(0),i=t.join("  +  ");(0,n.useEffect)((()=>{const e=i.split("  +  ");if(1===e.length)return void l(0);const t=setInterval((()=>{l((t=>(t+1)%e.length))}),a);return e.forEach((e=>{(new Image).src=w(e)})),()=>clearInterval(t)}),[i,a]);const s=t.length>1?w(t[(r-1+t.length)%t.length]):"",o=w(t[r]);return n.createElement("div",{className:"background "+(1===t.length?"single":""),key:r},s&&n.createElement("div",{className:"background_image image_a",style:{backgroundImage:`url(${s})`}}),n.createElement("div",{className:"background_image image_b",style:{backgroundImage:`url(${o})`}}),n.createElement("div",{className:"shadow_top"}),n.createElement("div",{className:"shadow_bottom"}))},P=e=>{let{children:t,gameInfo:a,compact:r}=e;const l=(0,v.Fg)(),i=[];a.tags.Genre.forEach((e=>{"独立游戏"!==e.title&&i.push(n.createElement(_,{key:e.id,title:e.title,link:e.link,type:"normal"}))})),a.isBooom&&i.push(n.createElement(_,{key:"booom",title:"BOOOM 作品",link:"#",type:"booom"})),a.isG4g&&i.push(n.createElement(_,{key:"g4g",title:"G4G 作品",type:"normal"}));const s=null!=l&&l.header.backgroundImage?[null==l?void 0:l.header.backgroundImage]:a.screenshots.staticScreenshots.length>0?a.screenshots.staticScreenshots.map((e=>e.src)):[a.cover,a.cover];return n.createElement("section",{className:"gamePageX_hero "+(r?"compact":"")},n.createElement(N,{images:s,duration:5e3}),n.createElement("div",{className:"liquidContainer"},t,n.createElement("div",{className:"content_wrapper "+(null!=l&&l.header.backgroundImage?"hasHeaderBackground":"")},n.createElement("h1",null,a.title),n.createElement("p",{className:"lead"},((e,t)=>{let a=0,n="";for(let r=0;r<e.length;r++){const l=e.charAt(r),i=l.charCodeAt(0);if(a+=i>=19968&&i<=40959?1:.5,a>t)break;n+=l}return a>t&&(n+="…"),n})(a.oneLineDescription,30)),n.createElement("div",{className:"tags"},i))))};var S=a(1145),Z=a(59129);class I{title;items;constructor(e){this.title=e,this.items=[]}createItem(e){const t=new T(e);return this.items.push(t),t}}class T{title;values;constructor(e){this.title=e,this.values=[]}pushTags(e){e.forEach((e=>{this.values.push(new A(e.title,e.link))}))}}class A{title;link;style;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inline";this.title=e,this.link=t,this.style=a}}const R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return"string"==typeof e&&(e=new Date(e)),`${e.getFullYear()}${t}${e.getMonth()+1}${t}${e.getDate()}`},D=(e,t)=>(0,p.P1)(e,t,((e,t)=>{const a=new I("详细信息"),n=new I("游戏状态"),r=new I("额外信息");e.getAttr("title")&&a.createItem("名称").values.push(new A(e.getAttr("title"))),t.Genre.length&&a.createItem("类型").pushTags(t.Genre),t.Style.length&&a.createItem("标签").pushTags(t.Style),t.Platform.length&&a.createItem("平台").pushTags(t.Platform),e.getAttr("average-play-time")&&a.createItem("游戏时长").values.push(new A(e.getAttr("average-play-time"))),e.getAttr("event-name")&&(e.getAttr("created-at")&&n.createItem("创建日期").values.push(new A(R(e.getAttr("created-at")))),e.getAttr("updated-at")&&n.createItem("更新日期").values.push(new A(R(e.getAttr("updated-at")))));const l=e.getAttr("released-at")||e.getAttr("domestic-released-at");if(e.getAttr("development-status")&&"已发售"!==e.getAttr("development-status")?n.createItem("开发状态").values.push(new A(e.getAttr("development-status"))):!l&&e.getAttr("event-name")||n.createItem("发售日期").values.push(new A(l?R(l):"暂未公布")),e.getAttr("booom-group-title")&&n.createItem("开发团队").values.push(new A(e.getAttr("booom-group-title"))),t.Language.length){r.createItem("支持语言").pushTags(t.Language)}return{detailData:a,gameStateData:n,extraData:r}}));class x{id;title;type;link;constructor(e,t,a){this.id=e,this.title=t,this.type=a,this.link=(0,s.ZP)("tagOriginals",{id:e,tab:"games"})}}class M{Genre=[];Style=[];Language=[];Platform=[]}var L=a(45578),q=a.n(L);const F="玩家",B=(e,t)=>e.getRel("involvements").sort(((e,t)=>(e.rank||0)-(t.rank||0))).reduce(((e,a)=>{const n=a.getRel(["entity","user"]);return n?t(e,a,n):e}),[]),O=(e,t)=>({id:e.get("id"),name:e.getAttr("nickname"),thumb:e.getAttr("thumb"),position:t,model:e}),U=e=>q()(e,"id"),$=e=>B(e,((e,t,a)=>{const n=O(a,t.getAttr("title")),r=e.find((e=>e.id===n.id));return r?r.position+=`、${n.position}`:e.push(n),e})),G=(e,t)=>{let{gamers:a}=t;const n=(e=>B(e,((e,t,a)=>{const n=t.getAttr("title"),r=O(a,n),l=e.find((e=>e.position===n));return l?(l.users.push(r),e):(e.push({position:n,users:[r]}),e)})))(e);if(0===a.length)return n;const r=n.find((e=>e.position===F));return r?(r.users=U([...a,...r.users]),n):(n.push({position:F,users:U(a)}),n)};var z=a(14810),H=a(81765);const V=(0,p.P1)(((e,t)=>({type:"games",id:t.id})),p.LF,((e,t)=>(0,S.Jg)(e,t,{depth:3}))),W=(0,p.P1)(V,(e=>{const t=e.getRel("tags"),a=new M;return t&&t.size>0?(t.forEach((e=>{let t,n;switch(e.getAttr("tag-type")){case"GameGenre":t=a.Genre,n="Genre";break;case"Style":case"FilmGenre":t=a.Style,n="Style";break;case"Language":t=a.Language,n="Language";break;case"Platform":t=a.Platform,n="Platform"}t&&t.push(new x(e.get("id"),e.getTitle(),n))})),a):a})),j=(0,p.P1)(V,(e=>{const t=e.getRel("game-links");if(t&&t.size>0){return t.toJS().sort(((e,t)=>Date.parse(t.attributes["created-at"])-Date.parse(e.attributes["created-at"])))}return[]})),K=e=>({path:e.attributes["attachment-path"],"created-at":new Date(e.attributes["created-at"]),state:e.attributes.state,id:e.id}),J=(0,p.P1)(j,(e=>{const t=e.filter((e=>["approved","testing"].includes(e.attributes.state)));if(!t||0===t.length)return null;const a=[...t];let n;a.sort(((e,t)=>Date.parse(t.attributes["created-at"])-Date.parse(e.attributes["created-at"]))),"testing"===e[0].attributes.state&&(n=a.find((e=>"approved"===e.attributes.state)));return{...K(e[0]),alterVersion:n?K(n):null}}));class Y{src;type;constructor(e,t){this.src=e,this.type=t}}class X{screenshots=[];paddedScreenshots=[];staticScreenshots=[]}const Q=(0,p.P1)(V,(e=>{var t,a;const n=new X,r=e.getAttr("cover"),l=(r?[r]:[]).concat((null===(t=e.getAttr("screenshots"))||void 0===t||null===(a=t.toJS)||void 0===a?void 0:a.call(t))||[]).map((e=>new Y(e,e.endsWith(".gif")?"gif":"static")));return n.screenshots=l,n.paddedScreenshots=((e,t)=>{const a=e.length;if(a>=t||0===a)return e;let n=[...e];for(;n.length<t;)n=[...n,...e];return n})(l,4),n.staticScreenshots=l.filter((e=>"static"===e.type)),n})),ee=(0,p.P1)(V,(e=>e.getDownloadMeta())),te=(0,p.P1)(V,(e=>{const t=e.getAttr("theme-config"),a=e.getAttr("top-img")||null;return{themeRaw:t?JSON.parse(t):null,topImg:a}})),ae=(0,p.P1)(V,H.dM,p.ib,((e,t,a)=>{const n=a&&e.getRel("user","id")===a.get("id");return{isDeveloper:t.some((t=>t.get("id")===e.get("id"))),isOwner:n}})),ne=(0,p.P1)(V,(e=>{var t;const a=null===(t=e.getRel("active-entry-vote-activities"))||void 0===t?void 0:t.first(),n=e.getRel("active-entry-vote-activity-records");return a&&n?{activity:{...a.toUnique()||{},startedAt:a.getAttr("started-at"),endedAt:a.getAttr("ended-at"),title:a.getAttr("title"),description:a.getAttr("description"),link:a.getAttr("link")},options:a.getRel("vote-activity-options").map((e=>({type:e.get("type"),id:e.get("id"),title:e.getAttr("title")}))).toArray()||[],records:n.map((e=>{var t;return{type:e.get("type"),id:e.get("id"),optionId:null===(t=e.getRel("vote-activity-option"))||void 0===t?void 0:t.get("id")}})).toArray()||[]}:null})),re=(0,p.P1)(V,W,J,Q,D(V,W),ee,te,ae,ne,((e,t,a,n,r,l,i,s,o)=>{var c,d;const m=e.get("id")===Z.It;return{id:e.get("id"),title:e.getAttr("title"),oneLineDescription:e.getAttr("introduction")||(null===(c=e.getAttr("description"))||void 0===c?void 0:c.split("\n")[0])||"",cover:e.getAttr("cover")||"",isBooom:!!e.getAttr("event-name"),isG4g:!(null===(d=e.getAttr("development-status"))||void 0===d||!d.includes("GameforGood")),subscriptionsCount:e.getAttr("subscriptions-count"),icon:e.getAttr("icon")||"",specialMarks:new Set((u={"booom-meta-game":m},Object.entries(u).filter((e=>{let[t,a]=e;return!0===a})).map((e=>{let[t,a]=e;return t})))),eventName:e.getAttr("event-name")||"",tags:t,attachment:a,screenshots:n,introduction:e.getAttr("description")||"",description:e.getAttr("fulltext-description")||"",metaInfo:r,download:l,theme:i,developer:s,hideGameLink:e.getAttr("disable-game-link")??!1,voteActivity:o};var u})),le={dispatchGetGamer:e=>(0,z.D1)(`users/${e}`)};var ie=a(76731),se=a(7975);const oe=e=>{let{game:t,gameInfo:a,onDownloadClick:l}=e;const o=(0,p.xJ)(),c=(0,r.useDispatch)();return n.createElement("div",{className:"actionPanel_wrapper"},n.createElement("div",{className:"actionPanel"},!a.hideGameLink&&a.download&&n.createElement("div",{className:"actionPanel_item"},n.createElement("button",{className:"btn",onClick:o?l:()=>{h({goal:`查看《${a.title}》的相关链接`,dispatch:c})}},"相关链接"),n.createElement("span",null,"DEMO")),!a.hideGameLink&&a.attachment&&a.attachment.path&&n.createElement("div",{className:"actionPanel_item"},n.createElement(i.Z,{className:"btn",to:(0,s.ZP)("game",{id:a.id})+"/play"},n.createElement(d.Z,{icon:"play_circle"}),"在线试玩"),n.createElement("span",null,"即刻开始")),t.getAttr("is-booom")&&n.createElement("div",{className:"actionPanel_item"},n.createElement(se.Z,{onlyUp:!0,votable:t,upBtnProps:{type:"light",ellipse:!0,plain:!1,anchor:!1},source:"term"},((e,t)=>t?"已投票":"投票")),n.createElement("span",null,"支持该 BOOOM 作品")),"2023 Dice"===t.getAttr("event-name")&&n.createElement("div",{className:"actionPanel_item"},n.createElement(i.Z,{className:"btn",to:"https://wj.qq.com/s2/13297071/ec75/",openNewWindow:!0},"投票"),n.createElement("span",null,"BOOOM 投票问卷")),n.createElement("div",{className:"actionPanel_item"},o?n.createElement(ie.Z,{subscribable:t,actionName:"关注"}):n.createElement("button",{className:"btn",onClick:()=>{h({goal:`关注《${a.title}》`,dispatch:c})}},"关注"),t.isBooom()?n.createElement("span",null,"获取新资讯"):n.createElement("span",null,t.getAttr("subscriptions-count")>0?`${t.getAttr("subscriptions-count")} 人关注`:"支持新内容提醒"))))};var ce=a(94479);const de=e=>{let{gameInfo:t}=e;return n.createElement("div",{className:"gamePageX_description"},t.introduction&&n.createElement("div",{className:"introduction"},n.createElement("h1",null,"游戏简介"),n.createElement("p",null,t.introduction)),t.description&&n.createElement(ce.Z,{content:t.description}))},me=e=>{let{children:t,title:a,isCollapsed:r}=e;const[l,i]=(0,n.useState)(r);return n.createElement("div",{className:"gamePageX_foldout "+(l?"collapsed":"")},n.createElement("div",{className:"gamePageX_foldout_header",onClick:()=>i(!l)},n.createElement(d.Z,{icon:"arrow_drop_down"}),n.createElement("span",null,a)),n.createElement("div",{className:"gamePageX_foldout_content",style:{display:l?"none":"block"}},n.createElement("div",{className:"wrapper"},t)))},ue=e=>{let{group:t}=e;const a=[];for(const e of t.items){const t=[];for(const a of e.values)"inline"===a.style&&t.length>0&&t.push(n.createElement("span",{key:`separator-${t.length}`},"，")),a.link?t.push(n.createElement(i.Z,{to:a.link,key:a.title},a.title)):t.push(n.createElement("span",{key:a.title},a.title));a.push(n.createElement("div",{className:"gamePageX_meta_info_item",key:e.title},n.createElement("span",{className:"gamePageX_meta_info_title"},e.title),n.createElement("span",{className:"gamePageX_meta_info_content"},t)))}return n.createElement(n.Fragment,null,a)};var pe=a(26707),ge=a(33529),he=a(35018);const ve=e=>{let{users:t,staffs:a}=e;const[r,l]=(0,n.useState)(!1),o=()=>{l(!1)};return n.createElement(n.Fragment,null,n.createElement(ge.Z,{visible:r,title:"制作人员",contentLabel:"Modal",onCloseClick:o,onConfirmClick:o,className:"gamePageX_popBox"},n.createElement(n.Fragment,null,a.map((e=>{let{position:t,users:a}=e;return n.createElement("dl",{key:t,className:"gamePage_staffModal"},n.createElement("dt",null,t),n.createElement("dd",null,a.map((e=>{let{id:t,model:a}=e;return n.createElement(i.Z,{className:"gamePage_staffUser",key:t,to:(0,s.ZP)("user",{id:t})},n.createElement(pe.Z,{size:"lg",users:a}),n.createElement(he.Z,{icon:["gfas","angle-right"]}))}))))})))),n.createElement("div",{className:"gamePageX_developer_list"},t.slice(0,4).map((e=>{let{id:t,model:a,position:r}=e;return n.createElement(pe.Z,{to:(0,s.ZP)("user",{id:t}),size:"lg",key:t,users:a,subText:r})})),t.length>4&&n.createElement("div",{className:"gamePageX_developer_list_expand"},n.createElement("span",{className:"more_info"},"及其余 ",t.length-4," 位制作者"),n.createElement("button",{className:"expand_btn",onClick:()=>{l(!0)}},"显示全部"))))};var Ee=a(85551),fe=a(85846),ye=a(80675);const be=e=>{let{entryId:t,activity:a,option:l,initialRecord:i=null}=e;const s=(0,r.useSelector)(p.yK),o=(0,r.useDispatch)(),[c,d]=(0,n.useState)(i),[m,u]=(0,n.useState)(!1);return n.createElement(fe.Z,{key:l.id,plain:!0,className:(0,C.Z)("voteActivityCard_option",{is_active:c}),loading:m,onClick:async()=>{if(s){if(u(!0),c){(await o((0,z.D1)(`${c.type}/${c.id}`,{method:"DELETE"}))).error||d(null)}else{const e=await o((0,z.D1)("user-vote-activity-records",{method:"POST",body:{data:{type:"user-vote-activity-records",attributes:{},relationships:{user:{data:{type:"users",id:s}},"vote-activity":{data:{type:"vote-activities",id:a.id}},"vote-activity-option":{data:{type:"vote-activity-options",id:l.id}},source:{data:{id:t,type:"entries"}}}}}}));e.error||d(e.payload.data)}u(!1)}else o((0,ye.CcW)())}},l.title,c?"（已投）":"")},ke=e=>{let{entryId:t,voteActivityInfo:{activity:a,options:r,records:l}}=e;const s=(o=a.startedAt,c=a.endedAt,o&&c?`${(0,Ee.SI)(o)} 至 ${(0,Ee.SI)(c)}`:o?`${(0,Ee.SI)(o)} 开始`:c?`${(0,Ee.SI)(o)} 截止`:null);var o,c;return n.createElement("div",{className:(0,C.Z)("voteActivityCard")},n.createElement("div",{className:"voteActivityCard_head"},n.createElement("span",null,s),a.link&&n.createElement(i.Z,{className:"voteActivityCard_link",to:a.link},"关于活动")),n.createElement("div",{className:"voteActivityCard_options"},r.map((e=>{const r=l.find((t=>t.optionId===e.id));return n.createElement(be,{key:e.id,entryId:t,activity:a,initialRecord:r,option:e})}))))},Ce=e=>{let{gameInfo:t}=e;const a=t.metaInfo,r=(0,n.useRef)(null),i=(0,n.useRef)(null),s=(0,n.useRef)(null),[o,c]=(0,n.useState)(""),d=(0,n.useCallback)((()=>{const e=s.current;null!==e&&(e.updateInitialDimension(),e.update())}),[s]);return(0,n.useEffect)((()=>{const e=new ResizeObserver((()=>{requestAnimationFrame((()=>{d(),requestAnimationFrame((()=>{d()}))}))}));return r.current&&e.observe(r.current),i.current&&e.observe(i.current),()=>{e.disconnect()}}),[d]),n.createElement("div",{id:"gamePageX_intro_side",ref:r,className:o},n.createElement(l.Z,{top:90,bottomBoundary:"#gamePageX_intro_side",ref:s,onStateChange:e=>{e.status===l.Z.STATUS_RELEASED?requestAnimationFrame((()=>{c("sticky_released")})):c("")}},t.voteActivity&&n.createElement("div",{className:"gamePageX_card gamePageX_card-booom mb-3"},n.createElement(me,{title:t.voteActivity.activity.title||"投票",isCollapsed:!1},n.createElement(ke,{entryId:t.id,voteActivityInfo:t.voteActivity}))),n.createElement("div",{className:"gamePageX_card",ref:i},a.detailData.items.length>0&&n.createElement(me,{title:"详细信息",isCollapsed:!1},n.createElement(ue,{group:a.detailData})),t.users.length>0&&n.createElement(me,{title:"制作团队在机核",isCollapsed:!1},n.createElement(ve,{users:t.users,staffs:t.staffs})),a.gameStateData.items.length>0&&n.createElement(me,{title:"游戏状态",isCollapsed:!1},n.createElement(ue,{group:a.gameStateData})),a.extraData.items.length>0&&n.createElement(me,{title:"补充信息",isCollapsed:!1},n.createElement(ue,{group:a.extraData})))))};var _e=a(31875);const we=(0,p.P1)((e=>e.getIn(["data","gamePage","feeds","ids"])),p.LF,((e,t)=>(0,S.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))))),Ne={dispatchGetFeeds:_e.Z.actions.getFeeds};var Pe=a(34009),Se=a(83476),Ze=a(85896);const Ie=e=>{let{tab:t,tabs:a,onTabChange:r}=e;return n.createElement("div",{className:"communityTabs"},a.map((e=>{let{title:a,key:l}=e;return n.createElement("button",{key:l,className:"communityTabs_tab "+(t===l?"is_active":""),onClick:()=>(e=>{t!==e&&r(e)})(l)},a)})))};var Te=a(44956);const Ae=(0,Pe.rE)({talkProps:{hideRepost:!0}}),Re=[{key:"all",title:"动态"},{key:"official",title:"官方"},{key:"recommendation",title:"推荐"}],De=(0,r.connect)(((e,t)=>({data:we(e),dataState:e.getIn(["data","gamePage","feeds"])})),Ne)((e=>{let{id:t,data:a,gameInfo:r,dataState:i,dispatchGetFeeds:o}=e;const[c,d]=(0,n.useState)("all"),m=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),g=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;if(!i)return;const r=a.last(),l=e?void 0:r&&(0,Ee.u3)(r.getAttr("published-at"));await o(t,n,l)},h=(0,Ze.II)(g),v=(0,n.useCallback)((async()=>{await h.current(!0,c)}),[h,c]),E=(0,Ze.n5)(v);(0,n.useEffect)((()=>{const e=()=>{const e=m.current;if(!e)return;const t=e.getBoundingClientRect();p(t.top<=window.innerHeight/1.8)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[]);const f=(0,Pe.By)({blacklistEnable:!0,render:Ae});return n.createElement("div",{className:"gamePageX_community",ref:m},n.createElement("div",{className:"gamePageX_community_header"},n.createElement("h1",null,"游戏社区"),n.createElement(l.Z,{top:85},n.createElement("div",{className:"gamePageX_community_tab_wrapper"},n.createElement(Ie,{tab:c,tabs:Re,onTabChange:e=>{var t;null===(t=m.current)||void 0===t||t.scrollIntoView(),d(e)}}))),n.createElement("div",{className:(0,C.Z)("gamePageX_community_btmTalk",{is_visible:"all"===c&&u})},n.createElement(Te.Z,{to:(0,s.ZP)("topicEditor",{repost_type:"games",repost_id:t,topic_id:r.developer.isDeveloper?Z.V7:r.isBooom?Z.Ck:r.id===Z.OV?Z.cy:Z.wI})},"发布动态"))),n.createElement("div",{className:"gamePageX_community_body"},n.createElement("div",{className:"gamePageX_community_feeds"},n.createElement(Se.Z,{data:a,state:i,onLoad:g,onInit:E},f))))})),xe=()=>n.createElement(n.Fragment,null,n.createElement("svg",{width:"0",height:"0",className:"hidden"},n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"arrow_drop_down"},n.createElement("path",{d:"M480-360 280-559h400L480-360Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"chevron_left"},n.createElement("path",{d:"M561-240 320-481l241-241 43 43-198 198 198 198-43 43Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"chevron_right"},n.createElement("path",{d:"M530-481 332-679l43-43 241 241-241 241-43-43 198-198Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"more_horiz"},n.createElement("path",{d:"M207.858-432Q188-432 174-446.142q-14-14.141-14-34Q160-500 174.142-514q14.141-14 34-14Q228-528 242-513.858q14 14.141 14 34Q256-460 241.858-446q-14.141 14-34 14Zm272 0Q460-432 446-446.142q-14-14.141-14-34Q432-500 446.142-514q14.141-14 34-14Q500-528 514-513.858q14 14.141 14 34Q528-460 513.858-446q-14.141 14-34 14Zm272 0Q732-432 718-446.142q-14-14.141-14-34Q704-500 718.142-514q14.141-14 34-14Q772-528 786-513.858q14 14.141 14 34Q800-460 785.858-446q-14.141 14-34 14Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"tune"},n.createElement("path",{d:"M423.609-106.999V-345h73v83h353v73.001h-353v82h-73Zm-313.218-82V-262h260v73.001h-260Zm187-172.783v-82h-187v-72.436h187v-84h73v238.436h-73Zm126.218-82v-72.436h426v72.436h-426Zm166-171.218v-238.001h73v82h187V-698h-187v83h-73Zm-479.218-83v-73.001h426V-698h-426Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"close"},n.createElement("path",{d:"m249-207-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"collapse_all"},n.createElement("path",{d:"m290-85-42-42 232-232 232 232-42 42-190-190L290-85Zm190-517L248-834l42-42 190 190 190-190 42 42-232 232Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"expand_all"},n.createElement("path",{d:"M480-80 240-320l44-44 196 196 196-196 44 44L480-80ZM284-596l-44-44 240-240 240 240-44 44-196-196-196 196Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"expand_more"},n.createElement("path",{d:"M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"menu"},n.createElement("path",{d:"M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"fullscreen"},n.createElement("path",{d:"M200-200v-200h80v120h120v80H200Zm0-360v-200h200v80H280v120h-80Zm360 360v-80h120v-120h80v200H560Zm120-360v-120H560v-80h200v200h-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"refresh"},n.createElement("path",{d:"M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"play_circle"},n.createElement("path",{d:"m380-300 280-180-280-180v360ZM480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"info"},n.createElement("path",{d:"M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"warning"},n.createElement("path",{d:"m40-120 440-760 440 760H40Zm440-120q17 0 28.5-11.5T520-280q0-17-11.5-28.5T480-320q-17 0-28.5 11.5T440-280q0 17 11.5 28.5T480-240Zm-40-120h80v-200h-80v200Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"check_circle"},n.createElement("path",{d:"m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"cloud_upload"},n.createElement("path",{d:"M440-160H260q-91 0-155.5-63T40-377q0-78 47-139t123-78q25-92 100-149t170-57q117 0 198.5 81.5T760-520q69 8 114.5 59.5T920-340q0 75-52.5 127.5T740-160H520v-286l64 62 56-56-160-160-160 160 56 56 64-62v286Z"})),n.createElement("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",id:"error"},n.createElement("path",{d:"M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Z"}))));var Me=a(46066);const Le=e=>{let{children:t,onDrag:a,onClick:r,dragDistance:l=10}=e;const i=n.useRef(!1),s=n.useRef({x:0,y:0});return n.createElement("div",{onPointerDown:e=>{i.current=!1,s.current={x:e.clientX,y:e.clientY}},onPointerMove:e=>{Math.sqrt(Math.pow(e.clientX-s.current.x,2)+Math.pow(e.clientY-s.current.y,2))>l&&(i.current=!0)},onPointerUp:e=>{i.current?a&&a(e):r&&r(e)}},t)},qe=e=>{let{direction:t,currentSlide:a,slideCount:r,...l}=e;return n.createElement("button",l,n.createElement(d.Z,{icon:`chevron_${t}`}))},Fe=e=>{let{gameInfo:t}=e;const a=(0,n.useRef)(null),r=(0,n.useRef)(null);return n.createElement("div",{className:"liquidContainer gamePageX_slider_container"},0===t.screenshots.paddedScreenshots.length&&n.createElement("img",{className:"gamePageX_slider_cover",draggable:!1,src:(0,o.cR)(t.cover)}),n.createElement(Me.Z,{className:"gamePageX_screenshotSlider",slidesToShow:3,slidesToScroll:1,centerMode:!0,focusOnSelect:!0,infinite:!0,variableWidth:!0,nextArrow:n.createElement(n.Fragment,null),prevArrow:n.createElement(n.Fragment,null),ref:a,asNavFor:r.current},t.screenshots.paddedScreenshots.map((e=>{let{type:t,src:a}=e,r=null;{const e=(0,o.cR)(a,{resize:{h:460,w:1e3,m:"lfit"}});r=n.createElement(Le,{onClick:e=>((e,t)=>{var a,n,r,l;const i=e.target;i&&null!==(a=i.parentElement)&&void 0!==a&&null!==(n=a.parentElement)&&void 0!==n&&null!==(r=n.parentElement)&&void 0!==r&&null!==(l=r.parentElement)&&void 0!==l&&l.classList.contains("slick-current")&&window.open(t,"_blank","noopener noreferrer")})(e,(0,o.cR)(a))},n.createElement("img",{src:e}))}return n.createElement("div",{key:a,className:"slick-item"},r)}))),n.createElement(Me.Z,{className:"gamePageX_screenshotThumbnail",slidesToShow:Math.min(t.screenshots.paddedScreenshots.length,5),slidesToScroll:Math.min(t.screenshots.paddedScreenshots.length,5),focusOnSelect:!0,infinite:!1,prevArrow:n.createElement(qe,{direction:"left"}),nextArrow:n.createElement(qe,{direction:"right"}),ref:r,asNavFor:a.current},t.screenshots.paddedScreenshots.map((e=>{let{type:t,src:a}=e,r=null;{const e=(0,o.cR)(a,{resize:{h:150,w:300,m:"lfit"}});r=n.createElement("img",{draggable:!1,src:e})}return n.createElement("div",{key:a,className:"slick-item"},r)}))))};var Be=a(45236);const Oe=e=>{let{visible:t,onClose:a,gameInfo:r}=e;const l=r.download;return l&&l.length?n.createElement(Be.Z,{visible:t,onClose:a,options:[...l.map((e=>({title:e.label,to:e.url}))),{title:"取消",requestClose:!0}]}):null},Ue=e=>{let{children:t,className:a}=e;const{style:r}=(0,v.Fg)();return n.createElement("div",{className:a,style:r},t)},$e=(0,n.lazy)((()=>a.e(542).then(a.bind(a,66542)))),Ge=e=>{let{gameInfo:t,onClose:a}=e;const[r,l]=(0,n.useState)(!1);return n.createElement("div",{className:"gamePageX_themeEditor editorAppX "+(r?"collapsed":"")},n.createElement(n.Suspense,{fallback:n.createElement("div",{className:"loadingTips"},"加载中")},n.createElement($e,{collapsed:r,onToggleCollapse:()=>l((e=>!e)),onClose:a,gameInfo:t})))},ze=e=>{let{icon:t,tooltip:a,onClick:r}=e;return n.createElement("button",{onClick:()=>{r&&r()},className:"gamePageX_gamePlayer_iconButton"},n.createElement(d.Z,{icon:t}),a&&n.createElement("div",{className:"gamePageX_gamePlayer_iconButton_tooltip"},a))};var He=a(61804);const Ve=e=>{let{value:t,options:a,onSelect:r}=e;const[l,i]=(0,n.useState)(!1),s=(0,n.useRef)();return n.createElement("div",{className:"gamePageX_gamePlayer_optionButton",onPointerEnter:()=>{i(!0),s.current&&(window.clearTimeout(s.current),s.current=void 0)},onPointerLeave:()=>{s.current&&window.clearTimeout(s.current);const e=window.setTimeout((()=>{i(!1)}),300);s.current=e}},n.createElement("button",null,t),n.createElement("div",{className:"gamePageX_gamePlayer_optionButton_options",style:{display:l?"":"none"}},a.map((e=>n.createElement("button",{key:e,onClick:()=>{(e=>{i(!1),r(e)})(e)},className:e===t?"active":""},n.createElement("div",{className:"dot"}),e)))))},We=(0,r.connect)((e=>({currentUser:(0,p.ib)(e)})))((e=>{var t,a,r,l,i;let{gameInfo:s,currentUser:c}=e;const m=null!=(null===(t=s.attachment)||void 0===t?void 0:t.alterVersion),[u,p]=(0,n.useState)(!1),g=u?null===(a=s.attachment)||void 0===a?void 0:a.alterVersion:s.attachment,h=null==g?void 0:g.path,v=n.createRef(),E=n.createRef(),f="testing"===(null==g?void 0:g.state),{allowPlay:y,src:b,start:k,idCheckModal:C}=(0,He.o)(h,{skipValidate:f});(0,n.useEffect)((()=>(document.addEventListener("fullscreenchange",_),()=>{document.removeEventListener("fullscreenchange",_)})));const _=()=>{var e;document.fullscreenElement===E.current&&E.current?E.current.classList.add("fullscreen"):null===(e=E.current)||void 0===e||e.classList.remove("fullscreen")},w=(0,n.useMemo)((()=>{const e=s.cover;if(e&&!e.endsWith(".gif")){return`url(${(0,o.cR)(e,{resize:{w:768,m:"lfit"}})})`}return""}),[s.cover]),N=(null===(r=s.attachment)||void 0===r||null===(l=r["created-at"])||void 0===l?void 0:l.toLocaleString())||"";return n.createElement("div",{className:"gamePageX_gamePlayer"},f&&n.createElement("div",{className:"gamePageX_gamePlayer_pendingAlert"},n.createElement(d.Z,{icon:"warning"}),"正在预览待审核的内部测试游戏版本"),n.createElement("div",{className:"gamePageX_gamePlayer_gameWrapper",ref:E},!y&&n.createElement("div",{className:"gamePageX_gamePlayer_playConfirm"},C,n.createElement("div",{className:"playConfirm_background",style:{backgroundImage:w}}),n.createElement("button",{className:"btn",onClick:k},n.createElement(d.Z,{icon:"play_circle"}),"开始试玩")),y&&n.createElement(n.Fragment,null,n.createElement("iframe",{allowFullScreen:!0,webkitallowfullscreen:!0,msallowfullscreen:!0,allowtransparency:!0,mozallowfullscreen:!0,allow:"autoplay; fullscreen *; geolocation; microphone; camera; midi; monetization; xr-spatial-tracking; gamepad; gyroscope; accelerometer; xr; cross-origin-isolated",ref:v,src:b}),f&&n.createElement("div",{className:"gamePageX_gamePlayer_pendingWatermark"},n.createElement("div",{className:"watermarkWrapper"},n.createElement("div",{className:"gamePageX_gamePlayer_pendingWatermark_top"},n.createElement("p",null,"正以开发者身份预览待审核的内部测试游戏版本"),n.createElement("p",null,"该版本仅供开发者测试参考")),n.createElement("div",{className:"gamePageX_gamePlayer_pendingWatermark_bottom"},n.createElement("p",null,n.createElement("span",null,"GID: ",s.id),c&&n.createElement("span",null,"UID: ",c.id),n.createElement("span",null,"GLID: ",null===(i=s.attachment)||void 0===i?void 0:i.id)),n.createElement("p",null,"版本创建时间：",N)))))),n.createElement("div",{className:"gamePageX_gamePlayer_toolbar"},n.createElement(ze,{icon:"refresh",tooltip:"重新载入",onClick:()=>{const e=v.current;e&&(e.src=b)}}),n.createElement("div",{className:"spacer"}),m&&n.createElement(Ve,{value:u?"在线版本":"测试版本",options:["测试版本","在线版本"],onSelect:e=>{p("在线版本"===e)}}),n.createElement(ze,{icon:"fullscreen",tooltip:"进入全屏",onClick:()=>{const e=E.current;if(e){const t=document;if(document.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled){const t=e;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()}}}})))})),je=()=>{var e;const t=null===(e=(0,v.Fg)())||void 0===e?void 0:e.style;return(0,n.useEffect)((()=>(document.body.classList.add("gamePageX_body"),t&&Object.keys(t).forEach((e=>{document.body.style.setProperty(e,t[e])})),()=>{document.body.classList.remove("gamePageX_body"),t&&Object.keys(t).forEach((e=>{document.body.style.removeProperty(e)}))})),[t]),null};var Ke=a(82285);let Je=function(e){return e.Intro="intro",e.Play="play",e.Community="community",e}({});const Ye=(0,r.connect)(((e,t)=>{const a=(0,p.ib)(e),n=V(e,t),r=re(e,t),l=r.specialMarks.has("booom-meta-game"),i=[];a&&n.getMeta("subscription-id")&&l&&i.unshift(O(a,F));const s=((e,t)=>{let{gamers:a}=t;return U([...a,...$(e)])})(n,{gamers:i}),o=G(n,{gamers:i});return{currentUser:a,game:n,gameInfo:{...r,users:s,staffs:o}}}),le)((e=>{var t;let{id:a,mode:r,game:l,gameInfo:i,currentUser:o,dispatchGetGamer:c}=e;const[d,m]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),g=null===(t=i.attachment)||void 0===t?void 0:t.path;(0,n.useEffect)((()=>{r===Je.Play&&null==g&&Ke.ZP.replace((0,s.ZP)("game",{id:a}))}),[g,a,r]);const h=(0,n.useCallback)((()=>{m(!0)}),[]);return n.createElement(v.f6,{gameInfo:i},n.createElement(je,null),n.createElement(Ue,{className:"gamePageX"},n.createElement(P,{gameInfo:i,compact:"community"===r},n.createElement(k,{gameInfo:i,mode:r,onDownloadClick:h,onEditorClick:()=>p((e=>!e))})),r===Je.Intro&&n.createElement(n.Fragment,null,n.createElement(oe,{game:l,gameInfo:i,onDownloadClick:h}),n.createElement(Fe,{gameInfo:i}),n.createElement("div",{className:"liquidContainer gamePageX_row gamePageX_intro_main"},n.createElement("div",{className:"gamePageX_row_main"},n.createElement(de,{gameInfo:i})),n.createElement("div",{className:"gamePageX_row_side"},n.createElement(Ce,{gameInfo:i})))),r===Je.Play&&!i.hideGameLink&&i.attachment&&i.attachment.path&&n.createElement(n.Fragment,null,n.createElement("div",{className:"liquidContainer"},n.createElement(We,{gameInfo:i}))),n.createElement(De,{id:l.get("id"),gameInfo:i}),i.download&&n.createElement(Oe,{gameInfo:i,visible:d,onClose:()=>{m(!1)}}),n.createElement(xe,null)),u&&n.createElement(Ge,{gameInfo:i,onClose:()=>{p(!1)}}))}))},61804:(e,t,a)=>{a.d(t,{o:()=>k});var n=a(36808),r=a.n(n),l=a(67294),i=a(50533),s=a(54186),o=a(45648),c=a(72753),d=a(59310),m=a(14810),u=a(73126),p=a(33529),g=a(66688),h=a(23736),v=a(69951),E=a(37094);const f="idCheckForm",y=(0,h.Cr)(),b=e=>{let{visible:t,onSuccess:a,...n}=e;const[r,s]=(0,l.useState)(!1),o=(0,i.useDispatch)(),c=(0,l.useRef)();return t?l.createElement(p.Z,(0,u.Z)({},n,{title:"实名信息提交",visible:!0,actions:l.createElement(E.Z,{wrapperType:"button",className:"btn btn-primary",type:"button",disabled:r,onReceive:e=>{e&&(c.current=e.validate,(0,v.Ps)(f))}},r?"提交中...":"提交")}),l.createElement(g.l0,{onSubmit:async e=>{s(!0);const t=await o((0,m.D1)("security/verify-id-card",{method:"POST",body:{data:{number:e.id,name:e.name,"captcha-validate":c.current}}}));s(!1),t.error||(alert("验证成功"),a())}},(e=>{let{handleSubmit:t}=e;return l.createElement("form",{id:f,onSubmit:t},l.createElement(g.gN,(0,u.Z)({label:"真实姓名",name:"name"},y),v.CF),l.createElement(g.gN,(0,u.Z)({label:"身份证号码",name:"id"},(0,h.Cr)([e=>{if(!function(e){if(!/(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e))return!1;const t=Number(e.substring(6,10)),a=Number(e.substring(10,12)),n=Number(e.substring(12,14)),r=new Date,l=r.getMonth()+1,i=r.getDate();let s=r.getFullYear()-t;return(l<a||l==a&&i<n)&&s--,s>=18}(e))return"请填写正确的第二代身份证号码，且已满18岁"}])),v.CF),l.createElement("ul",{className:"u_fontSize-sm",style:{opacity:.7}},l.createElement("li",null,"为响应《国家新闻出版署关于防止未成年人沉迷网络游戏的通知》，需要认证您的真实身份信息。您提供的真实身份信息将受到严格保护，仅用于判断您是否满足进行在线DEMO测试的要求，不会用于其他用途，请您放心填写"),l.createElement("li",null,"请使用真实姓名及有效身份证号码进行实名信息提交"),l.createElement("li",null,"身份信息提交后不可进行修改"),l.createElement("li",null,"有意填写非本人身份信息者，被发现将对账号进行封禁处理"),l.createElement("li",null,"如有疑问，可联系机核官方或点击屏幕右下角反馈按钮寻求帮助")))}))):null},k=function(e){let{skipValidate:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{sendPopMessage:a,toggleSigninModal:n}=(0,o.EY)(),u=(0,i.useSelector)(d.ib),p="https://gamestatic.gcores.cn/"+e,[g,h]=(0,l.useState)(!1),v=(0,i.useDispatch)(),[E,f]=(0,l.useState)(!1),y=()=>{"true"!==r().get(s.default.cookie_keys.playOnlineTip)?a({title:"在线试玩",body:l.createElement(l.Fragment,null,"「在线试玩」功能仅为参与BOOOM游戏创作活动使用，所有使用该功能的游戏版本并未正式运营，更多详情见",l.createElement("a",{style:{textDecoration:"underline"},href:"https://www.gcores.com/terms#demo"},"「在线试玩」功能用户需知")),modalProps:{confirmBtnText:"继续",onConfirmClick:()=>{r().set(s.default.cookie_keys.playOnlineTip,"true",{expires:5}),h(!0)}}}):h(!0)};return{idCheckModal:l.createElement(b,{visible:E,onSuccess:()=>{y(),f(!1)},onCloseClick:()=>{f(!1)}}),allowPlay:g,start:async()=>{var r,l,i,s,o;if(!e)return void a({body:"地址错误"});if(!u)return void(0,c.pj)("navigate",{link:"app://gcores.Signin"},(()=>{n()}));if(t)return void h(!0);const d=await v((0,m.D1)("security/is-adult",{meta:{disableMessages:[404]}}));!0===(null==d||null===(r=d.payload)||void 0===r||null===(l=r.data)||void 0===l?void 0:l["is-adult"])?y():!1===(null==d||null===(i=d.payload)||void 0===i||null===(s=i.data)||void 0===s?void 0:s["is-adult"])?alert("未成年人不可使用在线试玩功能"):404===(null==d||null===(o=d.payload)||void 0===o?void 0:o.status)&&f(!0)},src:p}}},26555:(e,t,a)=>{a.d(t,{Fg:()=>u,f6:()=>m,l5:()=>p});var n=a(67294),r=a(28670),l=a.n(r),i=a(96486);const s=(0,n.createContext)(null),o=(0,n.createContext)(null),c={colors:{primaryColor:"#1C1C1C",secondaryColor:"#353535",textColor:"#DDDDDD",headerColor:"#F8CC2F",buttonColor:"#F8CC2F",buttonTextColor:"#222222"},header:{backgroundImage:""},style:{}},d=e=>{const{colors:t}=e,{primaryColor:a,secondaryColor:n,textColor:r,buttonColor:i,buttonTextColor:s,headerColor:o}=t,c=l()(l()(a).luminance()>.5?"#000000":"#FFFFFF");return e.style={"--gpx-primary-color":a,"--gpx-secondary-color":n,"--gpx-text-color":r,"--gpx-header-color":o||i,"--gpx-info-color":l()(a).luminance()>.5?"#000000":"#FFFFFF","--gpx-secondary-info-color":l()(n).luminance()>.5?"#000000":"#FFFFFF","--gpx-button-color":i,"--gpx-button-text-color":s,"--gpx-text-shadow":l().contrast(r,a)<=4.5&&l()(r).luminance()>.5?"0px 0px 3px rgba(0, 0, 0, 0.25)":"none","--gpx-overlay-color":c.alpha(.07).css(),"--gpx-overlay-color-strong":c.alpha(.15).css()},e};d(c);const m=e=>{let{children:t,gameInfo:a}=e;const[r,l]=(0,n.useReducer)(h,a.theme.themeRaw||a.theme.topImg?((e,t)=>{const a=(0,i.cloneDeep)(c);return e.colors&&Object.keys(a.colors).forEach((t=>{e.colors[t]&&(a.colors[t]=e.colors[t]+"")})),t&&(a.header.backgroundImage=t),d(a)})(a.theme.themeRaw,a.theme.topImg):c);return n.createElement(s.Provider,{value:r},n.createElement(o.Provider,{value:l},t))},u=()=>(0,n.useContext)(s),p=()=>(0,n.useContext)(o),g=e=>e.hasChanged||e.backup?e.backup:(0,i.cloneDeep)(e),h=(e,t)=>{switch(t.type){case"setColor":{const{color:a,value:n}=t.payload;return d({...e,colors:{...e.colors,[a]:n},hasChanged:!0,backup:g(e)})}case"setHeaderBackgroundImage":return{...e,header:{...e.header,backgroundImage:t.payload},hasChanged:!0,backup:g(e)};case"saveTheme":return{...e,backup:void 0,hasChanged:!1};case"recoverBackupTheme":return{...e,...e.backup,backup:void 0,hasChanged:!1}}return e}},4523:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(72739),r=a(28680);const l="gamesPage",i={fields:{games:"cover,title,tags,content-count,event-name,is-gcores-publishing,content-tags,released-at".split(","),films:"cover,title,tags,content-count,content-tags,released-at".split(",")},ctrlfields:{games:["+content-tags","+content-count"]}},s=(0,r.x)("getUpcomingGames",(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=new Date;return a.setHours(0,0,0,0),["all"!==e?"games/search":"games",{page:t,query:{..."all"!==e?{"filter[platform]":e}:{},"filter[release-after]":a.getTime()/1e3,"filter[revised]":"true"},...i,sorts:["released-at"]}]}),{namespace:l,reducerDefault:"loadMore"}),o=(0,r.x)("getHotGames",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";return["all"!==e?"games/search":"games",{page:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,query:{..."all"!==e?{"filter[platform]":e}:{},"filter[revised]":"true"},...i,sorts:["-content-updated-at","-created-at"]}]}),{namespace:l,reducerDefault:"loadMore"}),c={namespace:l,actions:{[s.name]:s.action,[o.name]:o.action},reducer:(0,n.U)({upcomingGames:s.reducer,hotGames:o.reducer})}},40696:(e,t,a)=>{a.r(t),a.d(t,{Hardware:()=>X,News:()=>K,NextGeneration:()=>z});var n=a(73126),r=a(67294),l=a(35369),i=a(50533),s=a(1145),o=a(59310),c=a(85551),d=a(91433),m=a(80239),u=a(52004),p=a(3024),g=a(29847),h=a(35218),v=a(85846),E=a(35018),f=a(23813),y=a(4250),b=a(24757),k=a(6974),C=a(29622),_=a(97757),w=a(46066);const N=e=>{let{xsx:t,ps5:a}=e;return r.createElement("div",{className:"nextGenerationPage_row"},r.createElement("div",null,t),r.createElement("div",null,a))},P=e=>{let{title:t,compare:a=!1,sub:n=!1,children:l}=e;return r.createElement("div",{className:(0,u.Z)("nextGenerationPage_block",{"nextGenerationPage_block-sub":n})},t&&r.createElement("h3",{className:(0,u.Z)("nextGenerationPage_title")},t),r.createElement("div",{className:a?"nextGenerationPage_compare":void 0},l))},S=e=>{let{main:t,data:a}=e;return r.createElement("div",{className:"nextGenerationPage_parameters"},t&&r.createElement("h3",null,t),a&&a.map((e=>r.createElement("p",{key:e},e))))},Z=a.p+"36b6605b3f14718abc9b.png",I=a.p+"23b2f4e246e43258e307.png",T=a.p+"a89d5557b2728563231b.png",A=a.p+"7c151d7746c9c9748571.png",R=a.p+"95c5df39c514046f6892.jpg";var D=a(22134);const x=(0,d.ZP)("topic",{id:142}),M=(0,d.ZP)("topic",{id:143}),L=[{key:"xsx",title:"XSX/S",to:x},{key:"parameters",title:"参数比较"},{key:"ps5",title:"PS5",to:M}],q=e=>{const t=(e=>{const t=[];let a;return e.forEach((e=>{const n=new Date(e.getAttr("published-at")),r=`${n.getMonth()+1} 月 ${n.getDate()} 日 ${(0,c.Ek)(n.getDay())}`;r!==a?(t.push([r,[e]]),a=r):t[t.length-1][1].push(e)})),t})(e);return t.map((e=>r.createElement(r.Fragment,null,r.createElement("p",{className:"nextGenerationPage_sideDay"},e[0]),r.createElement(k.Z,{originals:(0,l.List)(e[1])}))))},F=e=>r.createElement(r.Fragment,null,e.map((e=>{let{title:t,desc:a,image:n}=e;return n?r.createElement("img",{key:n,src:(0,m.cR)(n),className:"d-block w-100"}):r.createElement(S,{key:t||a&&a[0]||n,main:t,data:a})}))),B=(e,t)=>{let{image:a,gallery:l}=e;const i=l.length>0;return r.createElement(v.Z,(0,n.Z)({plain:!0,anchor:!0,className:(0,u.Z)("nextGeneration_thumb",{"nextGeneration_thumb-hasGallery":i})},i&&{onClick:()=>{t(l.map((e=>({preview:(0,m.cR)(e)}))))}}),r.createElement("div",null,a?r.createElement("img",{src:(0,m.cR)(a),className:"d-block w-100 h-100"}):r.createElement("p",null,"暂未公布")),r.createElement("p",{className:"nextGeneration_galleryLink"},"查看图库"))},O=function(e){let{key:t,title:a,data:n,children:l}=e,{sub:i=!1,xsVersion:s="xsx",ps5Version:o="ps5"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.createElement(r.Fragment,null,r.createElement(P,{key:t,title:a,compare:!0,sub:i},r.createElement(N,{xsx:F(n[s]),ps5:F(n[o])})),l&&l.map((e=>O(e,{sub:!0}))))},U=e=>(null==e?void 0:e.length)>0?r.createElement("div",{className:"nextGeneration_games"},e.map((e=>r.createElement(D.Z,{key:e.id,type:"games",to:(0,d.ZP)("game",{id:e.id}),title:e.attributes.title,cover:e.attributes.cover,imageResize:{w:81,h:38}})))):r.createElement("div",{className:"nextGeneration_noGames"},"暂未公布"),$=(0,o.P1)((e=>e.getIn(["data","nextGenerationPage","videos","ids"])),o.LF,((e,t)=>(0,s.b$)(e,"originals",t))),G=(0,o.P1)((e=>e.getIn(["data","nextGenerationPage","news","ids"])),o.LF,((e,t)=>(0,s.b$)(e,"originals",t))),z=(0,i.connect)(((e,t)=>({videos:$(e),articles:G(e)})))((e=>{let{videos:t,articles:a,json:n}=e;const{events:l,base:i,detail:s}=n,[o,c]=(0,r.useState)(null),[v,k]=(0,r.useState)("xsx"),[D,F]=(0,r.useState)("ps5"),$=i[v],G=i[D];return r.createElement(C.Z,null,(e=>r.createElement(f.Z,{title:"推荐视频"},r.createElement(y.Z,{slidesToShow:4,slidesToShowResponsive:[4,3,2,1]},e.map((e=>r.createElement("div",{className:"slick-item nextGenerationPage_video",key:e.getKey()},r.createElement(b.Z,{original:e,compact:!0})))))))(t),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-lg-7 col-xl-8"},r.createElement("img",{src:R,className:"nextGenerationPage_theme"}),r.createElement("div",{className:"nextGenerationPage_column"},r.createElement("div",{className:"am_card nextGenerationPage_main"},r.createElement(p.Z,{innerZ:10},(e=>{let{status:t}=e;return r.createElement("div",{className:(0,u.Z)("nextGenerationPage_header",{"nextGenerationPage_header-fixed":t===p.Z.STATUS_FIXED})},r.createElement(g.Z,{className:"am_card_header",active:"parameters",tabs:L,hrefEnabled:!1}),r.createElement("div",{className:"am_card_inner pb-0"},r.createElement(N,{xsx:r.createElement(h.Z,{to:x,className:"nextGenerationPage_platfrom",onClick:e=>{k((e=>"xss"===e?"xsx":"xss")),e.preventDefault()}},r.createElement("img",{src:"xsx"===v?T:A})),ps5:r.createElement(h.Z,{to:M,className:"nextGenerationPage_platfrom",onClick:e=>{F((e=>"ps5"===e?"ps5de":"ps5")),e.preventDefault()}},r.createElement("img",{src:"ps5"===D?Z:I}))})))})),r.createElement("div",{className:"am_card_inner"},r.createElement(P,null,o&&r.createElement(_.Z,{images:o,visible:!0,onCloseClick:()=>{c(null)}}),r.createElement(N,{xsx:B($,(e=>{c(e)})),ps5:B(G,(e=>{c(e)}))})),r.createElement(P,{title:"更多产品特性"},r.createElement(h.Z,{className:"nextGenerationPage_btn",to:(0,d.ZP)("nextHardware")},r.createElement("span",{className:"align-middle"},"更多产品相关的文章与资讯"),r.createElement(E.Z,{icon:["gfas","angle-right"],className:"ps-2 u_fontSize-sm align-middle"}))),r.createElement(P,{title:"主机发售日期",compare:!0},r.createElement(N,{xsx:r.createElement(S,{main:$["published-at"]}),ps5:r.createElement(S,{main:G["published-at"]})})),r.createElement(P,{title:"主机发售价格",compare:!0},r.createElement(N,{xsx:r.createElement(S,{main:$.price}),ps5:r.createElement(S,{main:G.price})})),r.createElement(P,{title:"新游戏阵容"},r.createElement(N,{xsx:U($.games),ps5:U(G.games)})),s.filter((e=>"price"!==e.key)).map((e=>O(e,{xsVersion:v,ps5Version:D,sub:!1}))))))),r.createElement("div",{className:"col-lg-5 col-xl-4 order-first order-lg-last"},r.createElement("div",{className:"nextGenerationPage_column"},l.length>0&&r.createElement("div",{className:"am_card"},r.createElement("div",{className:"am_card_header"},"活动日历"),r.createElement("div",{className:"am_card_inner"},r.createElement(w.Z,{fade:!0,draggable:!1,swipe:!1,infinite:!0,speed:500,autoplay:!0,autoplaySpeed:5e3,arrows:!1},l.map((e=>r.createElement(h.Z,{key:e.title,to:e.link?e.link:(0,d.ZP)("original",{id:e["original-id"]})},r.createElement("div",{className:"nextGenerationPage_eventThumb"},r.createElement("img",{src:(0,m.cR)(e.image)})),r.createElement("div",{className:"am_card_info u_color-category"},e.date),r.createElement("h3",{className:"am_card_title"},e.title),r.createElement("p",{className:"am_card_desc"},e.desc))))))),r.createElement("div",{className:"am_card nextGenerationPage_news"},r.createElement("div",{className:"am_card_header"},r.createElement(h.Z,{to:(0,d.ZP)("nextNews")},r.createElement("span",{className:"align-middle"},"资讯汇总"),r.createElement(E.Z,{icon:["gfas","angle-right"],className:"ps-2 u_fontSize-sm align-middle"}))),r.createElement("div",{className:"am_card_inner"},q(a)))))))}));var H=a(71391);const V=[{key:"all",title:"全部"},{key:"ps5",title:"PS5"},{key:"xsx",title:"XSX"}].map((e=>({...e,to:(0,d.ZP)("nextNews",{tab:e.key})}))),W=e=>r.createElement("div",{className:"row",key:"originals"},e.map((e=>r.createElement("div",{className:m.d9,key:e.getKey()},r.createElement(b.Z,{original:e}))))),j=(0,o.P1)((e=>e.getIn(["data","nextGenerationPage","news","ids"])),o.LF,((e,t)=>(0,s.b$)(e,"originals",t))),K=(0,i.connect)(((e,t)=>({articles:j(e),dataState:e.getIn(["data","nextGenerationPage","news"])})))((e=>{let{tab:t,page:a,articles:n,dataState:l}=e;return r.createElement(C.Z,null,r.createElement(f.Z,{title:"次世代资讯汇总"},r.createElement(g.Z,{tabs:V,active:t,hrefEnabled:!1}),r.createElement(H.Z,{data:n,isRequesting:l.get("isRequesting"),page:a,allPage:l.get("allPage"),fetched:l.get("fetched"),hrefEnabled:!1,linkBuilder:e=>(0,d.ZP)((0,d.ZP)("nextNews"),{tab:t,page:e})},W)))})),J=e=>r.createElement("div",{className:"row",key:"originals"},e.map((e=>r.createElement("div",{className:m.d9,key:e.getKey()},r.createElement(b.Z,{original:e}))))),Y=(0,o.P1)((e=>e.getIn(["data","nextGenerationPage","hardware","ids"])),o.LF,((e,t)=>(0,s.b$)(e,"originals",t))),X=(0,i.connect)(((e,t)=>({articles:Y(e),dataState:e.getIn(["data","nextGenerationPage","hardware"])})))((e=>{let{page:t,articles:a,dataState:n}=e;return r.createElement(C.Z,null,r.createElement(f.Z,{title:"次世代硬件资讯与文章"},r.createElement(H.Z,{data:a,isRequesting:n.get("isRequesting"),page:t,allPage:n.get("allPage"),fetched:n.get("fetched"),hrefEnabled:!1,linkBuilder:e=>(0,d.ZP)((0,d.ZP)("nextHardware"),{page:e})},J)))}))},49125:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(72739),r=a(28680);const l="settingsPage",i=(0,r.x)("getBlacklistedUsers",((e,t)=>[`users/${e}/blacklisted-users`,{page:t}]),{namespace:l,reducerDefault:"loadMore"}),s=(0,r.x)("getBlockedTopics",((e,t)=>[`users/${e}/blocked-topics`,{page:t}]),{namespace:l,reducerDefault:"loadMore"}),o=(0,r.x)("getBlockedAuthors",((e,t)=>[`users/${e}/blocked-authors`,{page:t}]),{namespace:l,reducerDefault:"loadMore"}),c={namespace:l,actions:{[i.name]:i.action,[s.name]:s.action,[o.name]:o.action},reducer:(0,n.U)({blacklistedUsers:i.reducer,blockedTopics:s.reducer,blockedAuthors:o.reducer})}},31875:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(72739),r=a(85551),l=a(28680),i=a(14810);const s="gamePage",o=(0,l.x)("getOriginals",((e,t)=>(0,i.ro)({parentUnique:{type:"entries",id:e}},{page:t,metaFields:{categories:[]}})),{namespace:s,reducerDefault:"loadMore"}),c=(0,l.x)("getFeeds",((e,t,a)=>{const n=(0,r.u3)(new Date),l=a||n;return["/entry-contents",{filters:{"entry-id":e,view:t,"published-before":l.toString()},meta:{pageTimestamp:l,refresh:l===n},include:[...i.De,...i.Sv],metaFields:{categories:[],users:["is-content-blocked","is-blacklisted"],topics:["is-content-blocked"]}}]}),{namespace:s,reducerDefault:"loadMore"}),d={namespace:s,actions:{[c.name]:c.action,[o.name]:o.action},reducer:(e,t)=>(0,n.U)({feeds:c.reducer,originals:o.reducer})(e,t)}},72835:(e,t,a)=>{a.d(t,{TalkPage:()=>Se,TopicEditor:()=>G,TopicPage:()=>Oe,TopicsHomePage:()=>be,topicsHomePageSlice:()=>oe.Z});var n=a(67294),r=a(50533),l=a(11860),i=a.n(l),s=a(165),o=a(85846),c=a(54186),d=a(1145),m=a(82285),u=a(91433),p=a(52004),g=a(59310),h=a(44671),v=a(14810),E=a(2186),f=a(35018);const y=(0,r.connect)(((e,t)=>({currentUser:(0,g.ib)(e)})))((e=>{let{currentUser:t,game:a,value:r,onChange:l}=e;return(0,n.useEffect)((()=>{a||l(!1)}),[a,l]),n.createElement(o.Z,{className:(0,p.Z)("topicEditor_optionBtn",{is_active:r}),plain:!0,onClick:()=>{a?a.isOwner(null==t?void 0:t.get("id"))?l(!r):alert("游戏制作人员需关联与发布内容相关的游戏后，才可使用该游戏官方身份发布内容"):alert("请选择要关联的游戏")}},n.createElement(f.Z,{icon:["gfas","check"],className:"topicEditor_optionIcon"}),"官方")}));var b=a(22134),k=a(66437);const C=e=>{let{optionsVisible:t,toggleOptionsVisible:a,value:r,onChange:l}=e;const[i,s]=(0,n.useState)(null),c=(0,n.useCallback)((e=>{a(!1),l(e)}),[l,a]);return r?n.createElement("div",{className:"topicEditor_repostSelected"},n.createElement(b.Z,{disablePush:!0,item:r,onClose:()=>{c(null)}})):t?n.createElement("div",{className:"topicEditor_repostTypesContainer"},n.createElement(k.Z,{type:i,close:()=>{s(null)},onSelect:c}),n.createElement(o.Z,{plain:!0,className:"topicEditor_optionIcon topicEditor_optionIcon-close",onClick:()=>{a(!1)}},n.createElement(f.Z,{icon:["gfas","plus"]})),n.createElement("div",{className:"topicEditor_repostTypes"},["games","radios","albums","articles","videos","films","products"].map((e=>n.createElement(o.Z,{className:"topicEditor_repostType",key:e,onClick:()=>{s(e)}},(0,k.z)(e)))))):n.createElement(o.Z,{className:"topicEditor_optionBtn",plain:!0,onClick:()=>{a(!0)}},n.createElement("span",{className:"topicEditor_optionIcon topicEditor_optionIcon-custom"},n.createElement(f.Z,{icon:["gfas","plus"]})),"添加关联内容")};var _=a(33529),w=a(31636);const N=e=>{let{close:t,talk:a}=e;return n.createElement(_.Z,{className:"topicEditor_previewModal",title:"发布预览",width:500,visible:!!a,hideActionBtns:!0,onCloseClick:()=>{t()}},a?n.createElement(w.Z,{hideHeadMore:!0,talk:a}):"暂无内容")};var P=a(56005),S=a(20269);const Z=e=>{let{onConfirm:t,work:a,userId:r,initialValues:l}=e;const[i,s]=(0,n.useState)((null==l?void 0:l.enable)??(null==a?void 0:a.getAttr("work-enabled"))??!1),[c,d]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement(S.Z,{visible:c,userId:r,initialValues:l,portfolioEnabled:!0,work:a,onConfirm:e=>{d(!1),s(e.enable),t(e)},onClose:()=>{d(!1)}}),n.createElement(o.Z,{plain:!0,className:(0,p.Z)("topicEditor_optionBtn",{is_active:i}),onClick:()=>{d(!0)}},n.createElement(f.Z,{icon:["gfac",i?"settings-highlight":"settings"],className:"topicEditor_optionIcon"}),"作品设置"))};var I=a(10948),T=a(67826),A=a(45648),R=a(50718),D=a(85896);const x=(0,r.connect)(((e,t)=>({currentUser:(0,g.ib)(e)})))((e=>{let{value:t,onChange:a}=e;return n.createElement(o.Z,{className:(0,p.Z)("topicEditor_optionBtn",{is_active:t}),plain:!0,onClick:()=>{(t||confirm("打开该开关会使动态发布图片呈现模糊不可见样式，并提示其它用户含有剧透、敏感不适等内容，需主动点击才可查看交互"))&&a(!t)}},n.createElement(f.Z,{icon:["gfas","topic-spoiler"],className:"topicEditor_optionIcon"}),"防剧透")}));var M=a(65114),L=a(6143),q=a(74484);const F=(0,r.connect)(((e,t)=>({currentUser:(0,g.ib)(e)})))((e=>{let{value:t,onChange:a}=e;return n.createElement(o.Z,{className:(0,p.Z)("topicEditor_optionBtn",{is_active:t}),plain:!0,onClick:()=>{a(!t)}},n.createElement(f.Z,{icon:["gfas","strategy"],className:"topicEditor_optionIcon"}),"攻略")})),B=(0,g.P1)(((e,t)=>{var a;return null===(a=t.draft)||void 0===a?void 0:a.topicId}),g.LF,((e,t)=>e?(0,d.tK)(e,"topics",t):void 0)),O=(0,g.P1)(((e,t)=>{var a;return null===(a=t.draft)||void 0===a?void 0:a.repostUnique}),g.LF,((e,t)=>e?(0,d.Jg)(e,t,{depth:5}):void 0)),U=(0,g.P1)(((e,t)=>{var a;return null===(a=t.draft)||void 0===a?void 0:a.talkId}),g.LF,((e,t)=>e?(0,d.Jg)({type:"talks",id:e},t):null)),$={dispatchPublish:e=>(0,v.D1)(e.talkId?`talks/${e.talkId}`:"talks",{method:e.talkId?"PATCH":"POST",body:{data:(0,I.g)(e)}}),dispatchGetGameFullInfo:e=>(0,v.D1)(`games/${e.id}`,{include:v.wE})},G=(0,r.connect)(((e,t)=>{const a=U(e,t);return{talkAudit:a,talkAuditAccepted:"accepted"===(null==a?void 0:a.getAttr("audit-state")),initialTopic:B(e,t),initialRepost:O(e,t),currentUser:(0,g.ib)(e),getPreviewTalk:t=>(0,d.PT)(t,(0,g.LF)(e),2),buildModel:(t,a)=>(0,d.Jg)({type:t,id:a},(0,g.LF)(e))}}),$)((e=>{let{mode:t,draft:a,talkAudit:r,talkAuditAccepted:l,initialTopic:d,initialRepost:g,currentUser:v,getPreviewTalk:f,buildModel:b,dispatchPublish:k,dispatchGetGameFullInfo:w}=e;const{sendMessage:S}=(0,A.EY)(),B=(0,D.II)(b),O=null==a?void 0:a.talkId,[U,$]=(0,n.useState)(!1),[G,z]=(0,n.useState)(!1),[H,V]=(0,n.useState)(!1),[W,j]=(0,n.useState)(null),[K,J]=(0,n.useState)(""),[Y,X]=(0,n.useState)(null),[Q,ee]=(0,n.useState)(),{type:te,id:ae}=(null==Q?void 0:Q.toUnique())||{},[ne,re]=(0,n.useState)([]),[le,ie]=(0,n.useState)(),[se,oe]=(0,n.useState)(!1),[ce,de]=(0,n.useState)(!1),[me,ue]=(0,n.useState)(!1),pe=(0,M.v)(),ge=K.trim();(0,n.useEffect)((()=>{U||(J((0,L.sS)(null==a?void 0:a.content,null==r?void 0:r.getTagData())),re((null==a?void 0:a.images)||[]),ee(g),X(d),$(!0),null!=a&&a.workProperties&&(a.workProperties.portfolio&&"string"!=typeof a.workProperties.portfolio&&(a.workProperties.portfolio=new h._Y(a.workProperties.portfolio)),ie(null==a?void 0:a.workProperties)))}),[]),(0,n.useEffect)((()=>{U&&(K||ne.length>0)&&i()(c.default.storage_keys.talkDraft,{talkId:O,content:K,topicId:null==Y?void 0:Y.get("id"),repostUnique:null==Q?void 0:Q.toUnique(),images:ne||[],workProperties:le})}),[K,O,Y,Q,ne,le,U]),(0,n.useEffect)((()=>{if(!te||!ae||"games"!==te)return;(async()=>{await w({id:ae}),ee(B.current(te,ae))})()}),[te,ae,B,w]);const he=(0,n.useCallback)((e=>{X(e)}),[]),ve=(0,n.useCallback)((e=>{ee(e)}),[]),Ee=(0,n.useCallback)((e=>{J(e.target.value)}),[]),fe=e=>{ie(e)},ye=(0,n.useCallback)((()=>{const{draftContent:e,tagData:t}=(0,I.M)(ge,ne);Y&&e?j(f(new h.v3((0,I.g)({workProperties:le,currentUser:v,topic:Y,repost:Q,content:e,tagData:t,isOfficial:se,isSpoiler:ce,isStrategy:me})))):alert("请添加动态发布内容并选择话题")}),[ge,le,ne,Y,Q,v,f,se,ce,me]),be=(0,n.useCallback)((async()=>{var e,t,a;const{draftContent:n,tagData:r}=(0,I.M)(ge,ne);if(!Y||!n)return void alert("请添加动态发布内容并选择话题");if(Y.getAttr("is-pro")&&!v.getAttr("is-pro"))return void S({type:R.ZQ.COMMUNITY_PRO});z(!0);const s=await k({talkId:O,currentUser:v,content:n,tagData:r,...l?{}:{topic:Y,repost:Q,isOfficial:se,isSpoiler:ce,isStrategy:me,workProperties:le}}).catch((()=>null));if(!s||null!==(e=s.payload)&&void 0!==e&&e.error)return void z(!1);const o=null==s||null===(t=s.payload)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.id;if(!o)return;const d=!!O;var p;(i()(c.default.storage_keys.talkDraft,null),(0,E.X_)({talkId:o,topic:Y,imagesCount:ne.length,repostContentId:null==Q?void 0:Q.get("id"),repostContentType:null==Q?void 0:Q.get("type"),repostContentTitle:null==Q?void 0:Q.getTitle(),workEnabled:!(null==le||!le.enable),isOfficial:se,isSpoiler:ce,isUpdate:d,isRecruitment:!1,isStrategy:me,source:"topicEditor"}),le&&le.enable&&!d)&&(0,E.oi)({type:"talks",id:o},v.get("id"),"topicEditor",null===(p=le.portfolio)||void 0===p?void 0:p.get("id"));m.ZP.push((0,u.ZP)("talk",{id:o}))}),[O,k,l,le,ge,v,Y,Q,ne,se,ce,me,S]);if(!U)return null;let ke=null;return ke=l?n.createElement("div",{className:(0,p.Z)("topicEditor")},n.createElement("h1",null,n.createElement("span",null,"话题动态文本编辑"),n.createElement("span",null,n.createElement(o.Z,{type:"danger",loading:G,onClick:()=>{i()(c.default.storage_keys.talkDraft,null),m.ZP.replace((0,u.ZP)("topicEditor"))},size:"sm me-3"},"放弃修改"),n.createElement(o.Z,{loading:G,onClick:be,size:"sm"},"发布动态"))),n.createElement("div",{className:"topicEditor_body"},n.createElement(q.Z,{value:K,onChange:Ee,placeholder:"请输入你想说的内容…",className:"topicEditor_content"},pe))):n.createElement("div",{className:(0,p.Z)("topicEditor")},n.createElement(N,{talk:W,close:()=>{j(null)}}),n.createElement("h1",null,n.createElement("span",null,"话题动态",O?"编辑":"发布"),n.createElement("span",null,n.createElement(o.Z,{outline:!0,onClick:ye,size:"sm me-3"},"发布预览"),n.createElement(o.Z,{loading:G,onClick:be,size:"sm"},"发布动态"))),n.createElement("div",{className:"topicEditor_body"},n.createElement(s.Z,{value:ne,onChange:e=>{re(e)}}),n.createElement(q.Z,{value:K,onChange:Ee,placeholder:"请输入你想说的内容…",className:"topicEditor_content"},pe),n.createElement("div",{className:"topicEditor_options"},n.createElement(C,{optionsVisible:H,toggleOptionsVisible:V,value:Q,onChange:ve}),n.createElement("div",{className:(0,p.Z)({"d-none":H})},n.createElement(Z,{onConfirm:fe,userId:null==v?void 0:v.get("id"),initialValues:null==a?void 0:a.workProperties})),n.createElement("div",{className:(0,p.Z)({"d-none":H})},n.createElement(y,{value:se,onChange:oe,game:"games"===(null==Q?void 0:Q.get("type"))?Q:null})),"games"===(null==Q?void 0:Q.get("type"))&&n.createElement("div",{className:(0,p.Z)({"d-none":H})},n.createElement(F,{value:me,onChange:ue})),n.createElement("div",{className:(0,p.Z)({"d-none":H||0===ne.length})},n.createElement(x,{value:ce,onChange:de}))),n.createElement(P.Z,{value:Y,onChange:he}))),n.createElement(n.Fragment,null,"confirm"===t&&n.createElement(_.Z,{visible:!0,messageStyle:!0,title:"检测到草稿",confirmBtnText:"继续编辑",onConfirmClick:()=>{m.ZP.replace((0,u.ZP)("topicEditor",{draft:"true"}))},onCloseClick:()=>{(0,T.iw)({draft:"false"})}},n.createElement("p",null,"检测到你有未完成的草稿，是否继续编辑？")),ke)}));var z=a(22222),H=a(14761),V=a(34009),W=a(30004),j=a(83476),K=a(85551),J=a(4250),Y=a(35218),X=a(80239);const Q=(0,z.P1)((e=>e.getIn(["data","topicsHomePage","banners","ids"])),g.LF,((e,t)=>(0,d.BY)(e,t))),ee=(0,r.connect)((e=>({banners:Q(e)})))((e=>{let{banners:t}=e;return t&&0!==t.size?n.createElement(J.Z,{circleArrow:!0,dots:!0,infinite:!0,autoplay:!0,slidesToShow:1,className:"topicsHomePage_banners"},t.map((e=>{const t=e.getHref(),a=(0,X.cR)(e.getAttr("image"),{resize:{w:564,h:155}});return n.createElement("div",{className:"slick-item",key:e.getKey()},n.createElement(Y.Z,{to:t,className:"topicsHomePage_banner"},n.createElement("img",{src:a})))}))):null}));var te=a(44956),ae=a(29173),ne=a(87489),re=a(76731);const le=e=>{let{topic:t}=e;return n.createElement(ae.Z,null,n.createElement("div",{className:"topicPage_buttons"},n.createElement(te.Z,{icon:["gfas","write"],type:"primary",to:(0,u.ZP)("topicEditor",{topic_id:null==t?void 0:t.get("id")})},t?"参与":"发布动态"),t&&n.createElement(re.Z,{type:"secondary",ellipse:!1,subscribable:t,actionName:"收藏"}),t&&n.createElement(ne.Z,{type:"secondary",data:t,plain:!1,anchor:!1})),!t&&n.createElement("p",{className:"mt-2 mb-0 text-muted u_fontSize-sm text-center"},"分享你的兴趣和创作，与同好深入交流"))};var ie=a(57853),se=a(70315),oe=a(74290);const ce=n.memo((e=>{let{currentUser:t,topics:a,topicsFetched:r,dispatchGetTopics:l}=e;return(0,n.useEffect)((()=>{!r&&t&&l(t.get("id"))}),[r,t,l]),0===a.size?null:n.createElement(ae.Z,{title:"机组收藏"},n.createElement("ul",{className:"ajz_topics"},a.map((e=>n.createElement("li",{key:e.getKey()},n.createElement(Y.Z,{to:(0,u.ZP)("topic",{id:e.get("id")})},n.createElement(se.Z,null,e.getTitle())))))))})),de=["data","topicsHomePage","subscribedTopics"],me=(0,g.P1)((e=>e.getIn([...de,"ids"])),g.LF,((e,t)=>(0,d.BY)(e,t))),ue={dispatchGetTopics:oe.Z.actions.getSubscribedTopics},pe=(0,r.connect)((e=>({topics:me(e),topicsFetched:e.getIn([...de,"fetched"]),currentUser:(0,g.ib)(e)})),ue)(ce);var ge=a(60843),he=a(29203);const ve=n.memo((()=>{const[e,t]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement(he.Z,{visible:e,onClose:()=>{t(!1)},onChange:e=>{m.ZP.push((0,u.ZP)("topic",{id:e.get("id")}))}}),n.createElement(ge.ZP,{className:"ajz_topicsButton",onClick:()=>{t(!0)}},n.createElement("span",null,"查看全部小组"),n.createElement(f.Z,{icon:["gfas","angle-right"]})))})),Ee=["data","topicsHomePage","latestData"],fe=(0,z.P1)((e=>e.getIn([...Ee,"ids"])),g.LF,((e,t)=>(0,d.BY)(e,t,{depth:3}).map((e=>({item:e.getRel(e.getAttr("content-key")),props:{promotion:e.getAttr("is-promotion")}}))).filter((e=>{let{item:t}=e;return t})))),ye={dispatchGetLatestData:oe.Z.actions.getLatestData},be=(0,r.connect)((e=>({data:fe(e),dataState:e.getIn(Ee)})),ye)((e=>{let{data:t,dataState:a,dispatchGetLatestData:r}=e;const l=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=t.find((e=>!e.props.promotion)),n=e?void 0:a&&(0,K.u3)(a.item.getAttr("published-at"));await r({timestamp:n,existedPromotionTalkIds:e?[]:t.filter((e=>e.props.promotion&&"talks"===e.item.get("type"))).map((e=>e.item.get("id"))).toJS(),talksCount:e?0:t.filter((e=>"talks"===e.item.get("type")&&!e.props.promotion)).size,originalsCount:e?0:t.filter((e=>["articles","radios","videos"].includes(e.item.get("type"))&&!e.props.promotion)).size})}),[r,t]),i=(0,D.II)(l),s=(0,n.useCallback)((()=>n.createElement(n.Fragment,null,n.createElement(H.OS,{top:!0},n.createElement(le,null)),n.createElement(H.OS,null,n.createElement(ve,null)),n.createElement(H.OS,null,n.createElement(ie.Z,null)),n.createElement(H.OS,null,n.createElement(pe,null)),n.createElement(H.OS,null,n.createElement(W.Z,null)))),[]),o=(0,n.useCallback)((async()=>{await i.current(!0)}),[i]),c=(0,D.n5)(o),d=(0,V.By)({blacklistEnable:!0});return n.createElement(H.ZP,{renderSide:s,className:"topicsHomePage"},n.createElement(ee,null),n.createElement(j.Z,{data:t,state:a,onLoad:l,onInit:c,limitForGuest:!0,limitCountForGuest:10,limitTextForGuest:"登录后查看更多机组动态"},d))}));var ke=a(56196),Ce=a(58802),_e=a(93760),we=a(43446);const Ne=e=>n.createElement(w.Z,{talk:e}),Pe=(0,z.P1)(((e,t)=>t.talkId),g.LF,((e,t)=>(0,d.tK)(e,"talks",t))),Se=(0,r.connect)(((e,t)=>({talk:Pe(e,t)})),{})((e=>{let{talk:t}=e;const a=(0,n.useCallback)((()=>n.createElement(n.Fragment,null,n.createElement(H.OS,null,n.createElement(ve,null)),n.createElement(H.OS,null,n.createElement(ie.Z,null)),n.createElement(H.OS,null,n.createElement(pe,null)),n.createElement(H.OS,null,n.createElement(W.Z,null)))),[]);return(0,n.useEffect)((()=>{"#comments"===location.hash&&setTimeout((()=>{var e;null===(e=window.document.querySelector("[name=comments]"))||void 0===e||e.scrollIntoView()}),500)}),[]),t?n.createElement(H.ZP,{renderSide:a,className:"talkPage"},n.createElement(_e.Z,{backTo:(0,u.ZP)("topic",{id:t.getRel("topic","id")})},n.createElement(ke.Z,{loading:null===t,data:t},Ne),n.createElement("div",{className:"talk"},t.getAttr("is-comment-hidden")?n.createElement(we.Z,{title:"",desc:"该内容暂时无法评论"}):n.createElement(Ce.Z,{count:t.getAttr("comments-count"),commentable:t,authorID:t.getRel("user","id"),infinitLoad:{bottomOffset:800},instantLoad:!1})))):n.createElement(we.Z,null)}));var Ze=a(85061);const Ie=e=>{let{data:t}=e;if(!t)return null;const a=t.get("content");return a?a.map((e=>"image"!==e.get("type")?null:n.createElement(Y.Z,{key:e.get("url"),to:e.get("link")},n.createElement("img",{src:(0,X.cR)(e.get("url"),{resize:{w:500,m:"lfit"}}),alt:t.get("title"),className:"d-block w-100 mb-5"})))):null};var Te=a(94823),Ae=a(29847);const Re=a.p+"746da518e2b454532e2b.jpg",De=e=>{var t;let{topic:a,tab:r}=e;const l=null===(t=a.getRel("operational-events"))||void 0===t?void 0:t.first(),i=a.getRel("recommended-topics"),s=a.getCustomSelections(),o=a.getCustomTabs(),d=a.getCustomCards(),m=a.getLinked().map((e=>n.createElement(b.Z,{key:e.getKey(),item:e,className:"mb-3"}))),p=l&&n.createElement(Te.Z,{event:l,className:"mb-3"}),g=(null==i?void 0:i.size)>0&&n.createElement("div",{className:"mb-3"},i.map((e=>n.createElement(Y.Z,{key:e.getKey(),to:(0,u.ZP)("topic",{id:e.get("id")}),className:"me-2 mb-2"},n.createElement(se.Z,{tagStyle:!0,tagStyleGray:!0},e.getAttr("title")))))),h=d.map((e=>{const t=e.get("content");return t?n.createElement(b.Z,{key:t.get("title"),title:t.get("title"),cover:t.get("cover"),desc:t.get("content"),to:t.get("url")}):null})),v=s.size>0||o.size>0?n.createElement(Ae.Z,{forceHistoryPush:!0,tabs:[{key:"recommendations",title:"最新"},...s.map((e=>({key:`selections_${e.get("star")}`,title:e.get("title")||"精选"}))).toJS(),...o.map(((e,t)=>({key:`tabs_${t}`,title:e.get("title")||"选项"}))).toJS()],active:r}):null,E=e=>n.createElement(b.Z,{type:"circleCover",cover:Re,title:"使用常见问题解答",to:`${c.default.faq_url}?tab=${encodeURIComponent(e)}`});return n.createElement("div",{className:"flowLayout_head"},n.createElement("h1",null,a.getTitle()),n.createElement("p",null,a.getAttr("desc")),"269"===a.get("id")&&E("机组相关"),"474"===a.get("id")&&E("付费相关"),m,h,p,g,v)};var xe=a(21422);const Me=(e,t)=>["data","topicPage",e,t],Le=(0,z.P1)(((e,t)=>t.topicId),g.LF,((e,t)=>(0,d.tK)(e,"topics",t,{depth:3}))),qe=(e,t)=>{const{tab:a}=t;return e.getIn([...Me(t.topicId,a.startsWith("selections_")?"selections":a)])},Fe=(0,z.P1)(((e,t)=>{var a;return null===(a=qe(e,t))||void 0===a?void 0:a.get("ids")}),g.LF,((e,t)=>(0,d.BY)(e,t))),Be={dispatchGetRecos:xe.Z.actions.getTopicRecommendations,dispatchSelections:xe.Z.actions.getTopicSelections},Oe=(0,r.connect)(((e,t)=>({topic:Le(e,t),data:Fe(e,t),dataState:qe(e,t)||(0,Ze.zu)()})),Be)((e=>{let{topicId:t,tab:a,topic:r,dataState:l,data:i,dispatchGetRecos:s,dispatchSelections:o}=e;const c=(0,n.useCallback)((()=>n.createElement(n.Fragment,null,n.createElement(H.OS,{top:!0},n.createElement(le,{topic:r})),n.createElement(H.OS,null,n.createElement(ve,null)),n.createElement(H.OS,null,n.createElement(ie.Z,null)),n.createElement(H.OS,null,n.createElement(pe,null)),n.createElement(H.OS,null,n.createElement(W.Z,null)))),[r]),d=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;if("recommendations"===n){const t=i.last(),a=t&&(0,K.u3)(t.getAttr("published-at"));await s(r,e?void 0:a)}else if(n.startsWith("selections_")){const[,t]=n.split("_");await o(r,t,e?1:(l.get("currentPage")??0)+1)}}),[s,o,t,i,l,a]),m=(0,D.II)(d),p=(0,n.useCallback)((async()=>{await m.current(!0,a,t)}),[a,t,m]),g=(0,D.n5)(p),h=(0,V.By)({blacklistEnable:!0}),v=(()=>{if(a.startsWith("tabs_")){const[,e]=a.split("_");return n.createElement(Ie,{data:r.getCustomTabs().get(Number(e))})}return"recommendations"===a||a.startsWith("selections_")?n.createElement(j.Z,{data:i,state:l,onLoad:d,onInit:g,limitForGuest:!0,limitTextForGuest:"登录后查看更多机组动态"},h):null})();return n.createElement(H.ZP,{renderSide:c,className:"topicPage"},n.createElement(_e.Z,{backTo:(0,u.ZP)("topicsHome")},n.createElement(De,{topic:r,tab:a}),v))}))},56005:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(29203),l=a(85846),i=a(35018),s=a(85896);const o=e=>{let{value:t,onChange:a,checked:o,onCheckboxClick:c,checkedLabel:d}=e;const[m,u]=(0,n.useState)(!1),p=(0,s.$0)();return n.createElement("div",{className:"topicEditor_topicSelector"},void 0!==o&&c?n.createElement("div",{className:"form-check"},n.createElement("input",{id:p,className:"form-check-input",type:"checkbox",readOnly:!0,checked:o,onClick:()=>{c()}}),d&&n.createElement("label",{className:"form-check-label",htmlFor:p},d)):null,n.createElement(l.Z,{className:"topicEditor_topicSelectorBtn",plain:!0,onClick:()=>{u(!0)}},t?t.getTitle():"请选择合适的话题发布",n.createElement(i.Z,{icon:["gfas","angle-down"]})),n.createElement(r.Z,{topic:t,visible:m,onClose:()=>{u(!1)},onChange:a}))}},10948:(e,t,a)=>{a.d(t,{M:()=>s,g:()=>i});var n=a(9041),r=a(6143),l=a(28816);const i=e=>{let{talkId:t,currentUser:a,content:n,tagData:r,topic:i,repost:s,workProperties:o,isOfficial:c,isSpoiler:d,isStrategy:m}=e;const u=null==s?void 0:s.toUnique(),p=(0,l.Pj)(o);return{...t?{id:t}:{},type:"talks",attributes:{content:n,...void 0!==c?{"entry-is-official":c}:{},...i?{"is-pro":!!i.getAttr("is-pro")}:{},...void 0!==d?{spoiler:d}:{},...void 0!==m?{"is-strategy":m}:{},...p.attributes,...void 0!==r?{"tag-data":r?"string"==typeof r?r:JSON.stringify(r):null}:{}},relationships:{...p.relationships,...i?{topic:{data:{type:"topics",id:i.get("id")}}}:{},...u?{[u.type]:{data:[u]}}:{},...a&&!t?{user:{data:{type:"users",id:null==a?void 0:a.get("id")}}}:{}}}},s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(""===e.trim()&&0===t.length)return{draftContent:null};const{text:a,tagData:l}=(0,r.pY)(e),i=t.length>0,s=n.ContentState.createFromText(`${i?"-\n":""}${a}`),o=(0,n.convertToRaw)(s),c=o.blocks[0];i&&(o.entityMap[0]={data:{caption:"",images:t},mutability:"IMMUTABLE",type:"GALLERY"},o.blocks[0]={...c,type:"atomic",entityRanges:[{key:0,length:1,offset:0}]});for(const e of o.blocks)e.data={spoiler:!1};return{draftContent:JSON.stringify(o),tagData:l}}},21422:(e,t,a)=>{a.d(t,{Z:()=>m});var n=a(35369),r=a(72739),l=a(28680),i=a(99648),s=a(14810);const o="topicPage",c=(0,l.x)("getTopicRecommendations",((e,t)=>{const a=Date.now()/1e3,n=t||a;return[`/topics/${e}/recommend`,{query:{"talk-include":s.Ck.join(","),"original-include":"user,djs,category","order-by":"time",before:n},metaFields:{users:["is-content-blocked","is-blacklisted"],topics:["is-content-blocked"]},meta:{pageTimestamp:n,topicId:e,refresh:n===a}}]}),{namespace:o,reducerDefault:"loadMore",removeIdActions:(0,i.Y)()}),d=(0,l.x)("getTopicSelections",((e,t,a)=>[`/topics/${e}/editor-selections`,{page:a,include:["user","topic","radios","videos","articles","games"],filters:{star:t},extraMeta:{topicId:e}}]),{namespace:o,reducerDefault:"loadMore"}),m={namespace:o,actions:{[c.name]:c.action,[d.name]:d.action},reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type.includes(c.action.toString())||t.type.includes(d.action.toString())){const{topicId:a}=t.meta||{};return e.set(a,(0,r.U)({recommendations:c.reducer,selections:d.reducer})(e.get(a),t))}return e}}},57853:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(67294),r=a(50533),l=a(29173),i=a(70315),s=a(35218),o=a(1145),c=a(91433),d=a(59310),m=a(74290);const u=n.memo((e=>{let{topics:t,dispatchGetHotTopics:a}=e;return(0,n.useEffect)((()=>{0===t.size&&a()}),[t.size,a]),n.createElement(l.Z,{title:"机组推荐"},n.createElement("ul",{className:"ajz_topics"},t.map((e=>n.createElement("li",{key:e.getKey()},n.createElement(s.Z,{to:(0,c.ZP)("topic",{id:e.get("id")})},n.createElement(i.Z,null,e.getTitle()),e.getAttr("has-giveaway")&&n.createElement("small",null,n.createElement("span",{className:"badge bg-warning ms-2"},"抽奖")),e.getAttr("is-event")&&n.createElement("small",null,n.createElement("span",{className:"badge badge-event ms-2"},"活动"))))))))})),p=(0,d.P1)((e=>e.getIn(["data","topicsHomePage","hotTopics","ids"])),d.LF,((e,t)=>(0,o.BY)(e,t))),g={dispatchGetHotTopics:m.Z.actions.getHotTopics},h=(0,r.connect)((e=>({topics:p(e)})),g)(u)},74290:(e,t,a)=>{a.d(t,{Z:()=>m});var n=a(72739),r=a(28680),l=a(14810);const i="topicsHomePage",s=(0,r.x)("getLatestData",(e=>{let{talksCount:t,originalsCount:a,timestamp:n,existedPromotionTalkIds:r}=e;const i=Date.now()/1e3,s=n||i,o=s===i;return["/talk-original-recommendations",{filters:{"published-before":s,"talk-total-count":t,"original-total-count":a,...r.length>0?{"talk-promotion-ids":r.join(",")}:null},include:[...l.De,...l.Sv],query:{"ctrlfields[articles]":"-content","ctrlfields[videos]":"-content","ctrlfields[radios]":"-content"},metaFields:{categories:[],users:["is-content-blocked","is-blacklisted"],topics:["is-content-blocked"]},meta:{pageTimestamp:s,refresh:o}}]}),{namespace:i,reducerDefault:"loadMore"}),o=(0,r.x)("getSubscribedTopics",(e=>[`users/${e}/subscribed-topics`,{limit:5}]),{namespace:i}),c=(0,r.x)("getHotTopics",(()=>["/popular-topics",{limit:10,metaFields:{topics:[]}}]),{namespace:i}),d=(0,r.x)("getBanners",(()=>["banners",{filters:{slug:"topics-page","before-date":(new Date).toISOString()},limit:3}]),{namespace:i}),m={namespace:i,actions:{[s.name]:s.action,[c.name]:c.action,[o.name]:o.action,[d.name]:d.action},reducer:(e,t)=>(0,n.U)({latestData:s.reducer,hotTopics:c.reducer,subscribedTopics:o.reducer,banners:d.reducer})(e,t)}},57361:(e,t,a)=>{a.d(t,{Z:()=>f});var n=a(67294),r=a(50533),l=a(22222),i=a(83476),s=a(33529),o=a(29847),c=a(30588),d=a(1145),m=a(85896),u=a(59310),p=a(28449);const g=[{key:"followees",title:"已关注"},{key:"followers",title:"被关注"}],h=e=>["data","profilePage",e,"followData"],v=(0,l.P1)(((e,t)=>e.getIn(h(t.userId).concat(["ids"]))),u.LF,((e,t)=>(0,d.BY)(e,t))),E={dispatchRequestUsers:p.Z.actions.getFollowUsers},f=(0,r.connect)(((e,t)=>{const{userId:a}=t;return{pageState:e.getIn(h(a)),followData:v(e,t)}}),E)((e=>{let{userId:t,initialFilter:a,visible:r,onClose:l,followData:d,pageState:u,selectText:p,onSelect:h,dispatchRequestUsers:v}=e;const[E,f]=(0,n.useState)(a??g[0].key),y=(0,n.useCallback)((e=>n.createElement(c.Z,{users:e,onSelect:h,selectText:p})),[h,p]),b=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:((null==u?void 0:u.get("currentPage"))??0)+1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;await v(t,a,e)}),[v,u,t,E]),k=(0,m.II)(b),C=(0,n.useCallback)((async()=>{await k.current(1,E)}),[k,E]);return n.createElement(s.Z,{visible:r,contentLabel:"Modal",onCloseClick:l,hideActionBtns:!0,overlayClassName:"e_followModal"},n.createElement(o.Z,{hrefEnabled:!1,tabs:g,active:E,onTabChange:e=>{f(e)},noBorder:!0}),n.createElement(i.Z,{data:d,state:u,onLoad:b,onInit:C,scrollableProps:{container:".e_followModal"}},y))}))},28449:(e,t,a)=>{a.d(t,{Z:()=>w});var n=a(35369),r=a(72739),l=a(85551),i=a(85540),s=a(28680),o=a(99648),c=a(14810),d=a(64794);const m="profilePage",u=(0,o.Y)(),p=(0,s.x)("getLatestUnmarkedMedals",(e=>[`users/${e}/users-medals`,{include:["medal"],filters:{"is-marked":"unmarked"},meta:{inProfilePage:{userID:e}}}]),{namespace:m,reducerDefault:"success",reducerAfter:(e,t)=>{let{action:a}=t;if((0,i.Xk)(p.action.toString())===a.type){var r;const t=(null===(r=a.payload)||void 0===r?void 0:r.data.map((e=>{var t;const a=null===(t=e.relationships.medal.data)||void 0===t?void 0:t.id;return a?{medalId:a,usersMedalId:e.id}:null})).filter((e=>e)))||[];return e.set("parsed",(0,n.Map)({medalIds:t.map((e=>({type:"medals",id:e.medalId}))),usersMedalIds:t.map((e=>e.usersMedalId))}))}return e}}),g=(0,s.x)("getMedalCenters",((e,t)=>[`users/${e}/medal-centers`,{page:t,limit:12,meta:{inProfilePage:{userID:e}}}]),{namespace:m,reducerDefault:"loadMore"}),h=(0,s.x)("getItemMedalCenters",((e,t)=>[`users/${e}/medal-centers`,{limit:100,filters:{"medal-id":t},meta:{inProfilePage:{userID:e}}}]),{namespace:m,reducerDefault:"result"}),v=(0,s.x)("getFeeds",((e,t)=>{const a=(0,l.u3)(new Date),n=t||a,r={};return(0,c.bR)(r),[`/users/${e}/recommend`,{query:{"talk-include":c.Ck.join(","),"original-include":"user,djs,category","order-by":"time",before:n,...r},meta:{pageTimestamp:n,refresh:n===a,inProfilePage:{userID:e}}}]}),{namespace:m,reducerDefault:"loadMore",removeIdActions:u}),E=(0,s.x)("getOriginals",((e,t,a)=>(0,c.Me)({parentUnique:{type:"users",id:e},type:t},{page:a,extraMeta:{inProfilePage:{userID:e,type:t}}})),{namespace:m,reducerDefault:"page"}),f=(0,s.x)("getBookmarks",((e,t,a)=>(0,c.Ll)(e,{page:a,limit:12,...t&&"all"!==t?{filters:{"bookmarkable-type":t}}:null,extraMeta:{inProfilePage:{userID:e}}})),{namespace:m,reducerDefault:"page"}),y=(0,s.x)("getSubscribeds",((e,t,a)=>(0,c.NT)({userID:e,type:t},{page:a,extraMeta:{inProfilePage:{userID:e}}})),{namespace:m,reducerDefault:"page"}),b=(0,s.x)("getFollowUsers",(function(e,t){return[`users/${e}/${t}`,{page:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,limit:12,meta:{inProfilePage:{userID:e}}}]}),{namespace:m,reducerDefault:"loadMore"}),k=(0,s.x)("getWorks",((e,t)=>(0,d.d)({userId:e,page:t},{meta:{inProfilePage:{userID:e}}})),{namespace:m,reducerDefault:"loadMore"}),C=(0,s.x)("getProducts",((e,t)=>[`users/${e}/products`,{include:["skus"],filters:{"include-bundle":"true","public-only":"1"},meta:{inProfilePage:{userID:e}},page:t}]),{namespace:m,reducerDefault:"loadMore"}),_=(0,r.U)({originals:function(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),r=arguments.length>1?arguments[1]:void 0;const l=null===(e=r.meta)||void 0===e||null===(t=e.inProfilePage)||void 0===t?void 0:t.type;return l?a.update(l,(e=>E.reducer(e,r))):a},subscribeds:y.reducer,bookmarks:f.reducer,followData:b.reducer,feeds:v.reducer,works:k.reducer,products:C.reducer,latestUnmarkedMedals:p.reducer,medalCenters:g.reducer,itemMedalCenters:h.reducer}),w={namespace:m,actions:{[E.name]:E.action,[f.name]:f.action,[y.name]:y.action,[b.name]:b.action,[v.name]:v.action,[k.name]:k.action,[C.name]:C.action,[p.name]:p.action,[g.name]:g.action,[h.name]:h.action},reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.meta&&t.meta.inProfilePage){const{userID:a}=t.meta.inProfilePage,n=_(e.get(a),t);return e.set(a,n)}if(Object.keys(u).includes(t.type)){const a=e.keySeq().toArray();let n=e;for(const e of a)n=n.update(e,(e=>_(e,t)));return n}return e}}},45236:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(67294),r=a(52004),l=a(85846),i=a(33529),s=a(65471);const o=e=>{let{option:{className:t,onClick:a,to:i,title:o,requestClose:c,danger:d},onClose:m}=e;const{back:u}=(0,s.VG)()||{};return n.createElement("li",null,n.createElement(l.Z,{plain:!0,className:(0,r.Z)("actionSheet_btn",{"u_color-red":d},t),to:i,onClick:e=>{null==a||a(e),c&&(m?m():null==u||u())}},o))},c=e=>{let{options:t,onClose:a}=e;return n.createElement("ul",{className:"actionSheet"},t.map((e=>n.createElement(o,{key:e.title,option:e,onClose:a}))))},d=e=>{let{options:t,visible:a,onClose:r}=e;return"boolean"==typeof a?n.createElement(i.Z,{visible:a,simple:!0,width:"auto",onCloseClick:r},n.createElement(c,{options:t,onClose:r})):n.createElement(c,{options:t})}},24320:(e,t,a)=>{a.d(t,{Z:()=>u});var n=a(73126),r=a(67294),l=a(35369),i=a(28718),s=a(7384),o=a(34282),c=a(26707),d=a(81266);class m extends o.Z{static defaultProps={size:"sm"};getAuthor(){const{users:e}=this.props;if(l.List.isList(e)){if(0===e.size)return null;if(1===e.size)return e.first()}return e}renderDjsBtn=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{users:a,...s}=e.props,o=e.getAuthor();return r.createElement(c.Z,(0,n.Z)({users:o,to:l.List.isList(o)?void 0:(0,i.Z)("user",{id:o.get("id")}),nameLimit:9},t,s))}})();renderDjsBody=(e,t)=>{const{users:a}=this.props;return r.createElement("ul",(0,n.Z)({className:"o_stylelessList mb-0 px-2"},t),a.map((e=>r.createElement("li",{key:e.getKey(),className:"my-1"},r.createElement(c.Z,{users:e,size:"sm",to:(0,i.Z)("user",{id:e.get("id")}),nameLimit:10})))))};render(){const e=this.getAuthor();return e?l.List.isList(e)?r.createElement(d.Z,{key:e.map((e=>e.getKey())).join(""),body:this.renderDjsBody,trigger:"hover",className:"avatarList_popOver"},this.renderDjsBtn):r.createElement(s.Z,{key:e.getKey(),userID:e.get("id")},this.renderDjsBtn):null}}const u=m},85846:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(35018),i=a(35218),s=a(52004);const o=r.forwardRef(((e,t)=>{let{prefixClass:a,type:o,size:c,circle:d,ellipse:m,block:u,outline:p,loading:g,disabled:h,disabledClass:v,className:E,icon:f,href:y,to:b,htmlType:k,anchor:C,children:_,plain:w,openNewWindow:N,div:P,...S}=e;const Z=y||b||C,I=g||h,T={...S,className:(0,s.Z)(w||a,w||{[`${a}-${c}`]:c,[`${a}${p?"-outline":""}-${o}`]:o,[`${a}-ellipse`]:m,[`${a}-circle`]:d},{"d-block w-100":u},E),disabled:I},A=g?"spinner":f;let R;if(A){const e={className:_&&"boolean"!=typeof _?"me-2":"",icon:A,...g?{spin:!0}:{}};R=r.createElement(l.Z,e)}const D=r.createElement(r.Fragment,null,R,_);if(P)return r.createElement("div",T,D);if(Z){const e=y||b?{href:y,to:b}:{role:"button",tabIndex:S.tabIndex??h?"-1":"0",...I?{"aria-disabled":"true"}:{}},a={...T,...e,openNewWindow:N,className:(0,s.Z)(T.className,{[v]:I})};return r.createElement(i.Z,(0,n.Z)({},a,{ref:t}),D)}const x={...T,type:k,className:(0,s.Z)(T.className,{o_plainButton:w})};return r.createElement("button",(0,n.Z)({},x,{ref:t}),D)}));o.defaultProps={type:"primary",prefixClass:"btn",outline:!1,ellipse:!1,circle:!1,loading:!1,anchor:!1,disabled:!1,disabledClass:"disabled",htmlType:"button",plain:!1};const c=o},74612:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(67294),r=a(7975),l=a(14018),i=a(35018),s=a(91433),o=a(85846),c=a(45648);const d=e=>{let{item:t,portfolioId:a}=e;const d=t.getAttr("comments-count")??0,{pageName:m}=(0,c.EY)();return n.createElement("div",{className:"cardBtmActions"},n.createElement("div",null,n.createElement(r.Z,{onlyUp:!0,upClassName:"cardBtmAction",votable:t,zeroText:"喜欢",portfolioId:a,source:m}),n.createElement(l.Z,{className:"cardBtmAction cardBtmAction-bookmark",bookmarkable:t,zeroText:"收藏",portfolioId:a})),n.createElement("div",null,n.createElement(o.Z,{plain:!0,to:`${(0,s.bv)(t.get("type"),t.get("id"))}#comments`,className:"cardBtmAction"},n.createElement(i.Z,{icon:["gfas","comment"],className:"o_action_icon-withNumber"}),n.createElement("span",{className:"o_action_num"},d>0?d:"评论"))))}},76997:(e,t,a)=>{a.d(t,{Z:()=>_});var n=a(67294),r=a(85846),l=a(50718),i=a(45648),s=a(91433),o=a(85551),c=a(85896),d=a(52004),m=a(80239),u=a(87022),p=a(92742),g=a.n(p),h=a(6143),v=a(1761);const E={text:"",status:{tip:"",warning:""},submitDisabled:!0,enableTimeNodeCheck:!1},f=(e,t)=>{let a=e;switch(t.type){case"init":a=E;break;case"change":{const n=t.payload,{tip:r,warningStatus:l}=(0,v.Me)(n,e.enableTimeNodeCheck?990:1e3);a={...a,text:n,status:{tip:r,warning:l}};break}case"toggleTimeNode":{const e=t.payload;a={...a,enableTimeNodeCheck:"boolean"==typeof e?e:!a.enableTimeNodeCheck};break}default:a=e}return{...a,submitDisabled:0===g()(a.text).length||"danger"===a.status.warning}},y=(e,t,a)=>{let{onSubmit:r,currentUser:l}=e,{currentPlayerStatus:i}=t;const s=(0,n.useReducer)(f,E),c=(0,n.useRef)(null),[d,m]=s,u=!l||l.isNeedBindPhone();(0,n.useImperativeHandle)(a,(()=>({focus:()=>{c.current&&c.current.focus()},reset:()=>{m({type:"init"})}})));const p=()=>{const{text:e,enableTimeNodeCheck:t,status:{submitDisabled:a}}=d;if(a)return;const n=((e,t)=>{let a=g()(e);return"number"==typeof t&&(a=`${(0,o.dB)(t)} ${a}`),a})(e,t?null==i?void 0:i.currentTime:null),{text:l,tagData:s}=(0,h.pY)(n);r(l,s.length>0?s:null)};return{reducer:s,handles:{handleSubmit:p,handleKeydown:e=>{if(u)return;const t=e.keycode||e.which;(e.metaKey||e.ctrlKey)&&13===t&&p()},handleChange:e=>{u||m({type:"change",payload:e.target.value})},handleToggleTimeNodeCheckbox:e=>{m({type:"toggleTimeNode"})}},inputRef:c,inputDisabled:u}};var b=a(65114),k=a(74484);const C=(e,t)=>{const{currentUser:a,isPosting:p,commentable:g}=e,h=(0,c.$0)(),v=(0,i.EY)(),{getCurrentStatus:E}=(0,i.gD)(),[f,C]=(0,n.useState)(null),[_,w]=(0,n.useState)(!1),[N,P]=(0,n.useState)(!1),S="commentsMana_input_container",Z=(0,b.v)(),{reducer:[{text:I,status:{tip:T,warning:A},submitDisabled:R,enableTimeNodeCheck:D},x],handles:M,inputRef:L,inputDisabled:q}=y(e,{currentPlayerStatus:f},t),F=(0,c.II)(I);(0,n.useEffect)((()=>{const e=e=>{const t=e.target.closest(`.${S}`);w(null!==t)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}}),[]),(0,n.useEffect)((()=>{""===F.current.trim()&&x({type:"toggleTimeNode",payload:!1})}),[_,F,x]);const B=(0,m.CA)(null==a?void 0:a.getAttr("thumb"),m.iT.UserThumbMd),O=(_||D)&&((e,t)=>e&&"radios"===e.get("type")&&(null==t?void 0:t.radioId)===e.get("id"))(g,f)&&"number"==typeof(null==f?void 0:f.currentTime)?n.createElement("div",{className:"commentsMana_input_timeNodeContiner"},n.createElement("div",{className:"form-check"},n.createElement("input",{id:h,className:"form-check-input",type:"checkbox",checked:D,onChange:M.handleToggleTimeNodeCheckbox}),n.createElement("label",{htmlFor:h},"标记时间节点",n.createElement("span",{className:"comment_timeNode"},(0,o.dB)(f.currentTime))))):null;return n.createElement(u.Z,{label:"评论输入框",openUrl:(0,s.sH)(g)},n.createElement("div",{className:S},n.createElement("img",{alt:null==a?void 0:a.getAttr("nickname"),src:B,className:"commentsMana_input_authorThumb rounded-circle"}),n.createElement("div",{className:"commentsMana_input_wrapper"},n.createElement(k.Z,{className:(0,d.Z)("commentsMana_input_text",{is_editting:_,is_focus:N}),inputRef:L,placeholder:a?"有什么想说的...":"请先登录再发表评论",value:I,onKeyDown:M.handleKeydown,onChange:M.handleChange,onFocus:()=>{q?((e,t,a)=>{let{currentUser:r}=e,{sendMessage:i,toggleSigninModal:o}=t,{inputRef:c}=a;if(!r)return o(!0),void c.current.blur();i({showMode:"pop",body:n.createElement("div",null,"如要发布内容，请先",n.createElement("strong",{className:"mx-1"},n.createElement("a",{href:(0,s.sH)("settings"),className:"u_undelineLink u_color-gray-text"},"绑定手机号"))),type:l.ZQ.WARNING}),c.current.blur()})(e,v,{inputRef:L}):(D||C(E()),P(!0))},onBlur:()=>{P(!1)}},Z),T?n.createElement("div",{className:"commentsMana_input_tip"},n.createElement("span",{className:(0,d.Z)({[`text-${A}`]:A})},T)):null,O),n.createElement(r.Z,{className:"commentsMana_input_btn",onClick:M.handleSubmit,loading:p,disabled:R,type:"primary",ellipse:!0},"发送")))},_=(0,n.forwardRef)(C)},89091:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(85846),l=a(1761),i=a(35277);const s=e=>e&&!e.descendants&&e.oldestDescendants.length<e.descendantsCount,o=(0,n.forwardRef)(((e,t)=>{let{comments:a,parent:o,onRenderComment:c,onLoad:d}=e;const[m,u]=(0,n.useState)(!(o&&!s(o))||a.length<=l.ro),p=(0,i.q)(),g=(m?a:a.slice(0,3)).filter((e=>{var t;return!p.includes(null===(t=e.user)||void 0===t?void 0:t.id)})),h=e=>n.createElement("li",{className:"commentsMana_showmore"},n.createElement(r.Z,{onClick:e,anchor:!0,plain:!0},"查看更多回复（",o.descendantsCount,"）")),v=s(o)?h((()=>{null==d||d()})):m?null:h((()=>{u(!0)}));return(0,n.useImperativeHandle)(t,(()=>({showAll:()=>u(!0)}))),n.createElement("div",null,n.createElement("ul",{className:"list-unstyled comments"},g.map((e=>c(e))),v))}))},43446:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(85846),l=a(45648);const i=e=>{let{needApp:t,needSignin:a}=e;return t?"请下载 App 并访问页面":a?"需登录后才可显示内容":""},s=e=>{let{image:t,title:a="没有任何内容",needSignin:s=!1,needApp:o=!1,desc:c=i({needApp:o,needSignin:s})}=e;const{toggleSigninModal:d}=(0,l.EY)();return n.createElement("div",{className:"emptyBlock"},t&&n.createElement("div",{className:"emptyBlock_image"},t),a&&n.createElement("h1",null,a),c&&n.createElement("p",null,c),s&&n.createElement(r.Z,{onClick:()=>{d()}},"登录机核"),o&&n.createElement(r.Z,{to:"/app"},"下载 App"))}},94823:(e,t,a)=>{a.d(t,{Z:()=>R});var n=a(73126),r=a(67294),l=a(50533),i=a(33529),s=a(82285),o=a(59310),c=a(80239),d=a(35018),m=a(85846),u=a(26707);const p=r.memo((e=>{const{event:t,users:a,...l}=e,i=t.getAttr("candidates-count");return(null==a?void 0:a.size)>0?r.createElement(u.Z,(0,n.Z)({name:`共 ${i} 人参与`,multiUsersLimit:5},l,{users:a,size:"xs",loose:!0})):r.createElement("span",null,"暂无用户参与抽奖")})),g=(0,o.P1)(((e,t)=>t.event),o.ib,((e,t)=>{var a,n;const r=e.getMeta("is-candidate");let l=null===(a=e.getRel("public-candidates"))||void 0===a?void 0:a.slice(0,5);if(r&&(null===(n=l)||void 0===n?void 0:n.size)>0&&t){const e=l.findIndex((e=>e.get("id")===t.get("id")));e>-1?(l=l.delete(e),l=l.push(t)):l=l.set(l.size-1,t)}return l})),h=(0,l.connect)(((e,t)=>({users:g(e,t)})))(p);var v=a(85551),E=a(35369);const f=(e,t)=>{const a=t.getAttr("rule"),n=t.getAttr("is-settled"),r=E.List.isList(a)&&a.includes("membership"),l=null==e?void 0:e.getAttr("has-membership");return{shouldShowTip:!n&&r&&!l,isMembershipOnly:r,isMembership:l}},y=e=>{let{event:t}=e;const a=(0,l.useSelector)(o.ib),{shouldShowTip:n,isMembershipOnly:i}=f(a,t),s=i?"u_color-gpass":"u_color-category";return n?r.createElement("span",{className:s},"仅 GPASS 机核会员可参与"):t.getAttr("is-settled")?r.createElement("span",null,"已开奖"):"reach_time"===t.getAttr("settlement-trigger")?r.createElement("span",{className:s},(0,v.p6)(t.getAttr("settled-at"),"YYYY 年 MM 月 DD 日 HH:mm"),"自动开奖"):"reach_candidates_cap"===t.getAttr("settlement-trigger")?r.createElement("span",{className:s},"达到 ",t.getAttr("candidates-cap")," 人参与 自动开奖"):null};var b=a(52004);const k=r.memo((e=>{var t,a,i;let{event:s,...u}=e;const p=(0,l.useSelector)(o.ib),g=s.getAttr("title"),v=s.getRel([["giveaways",0]]),E=null==v||null===(t=v.getPreview)||void 0===t||null===(a=t.call(v))||void 0===a||null===(i=a[0])||void 0===i?void 0:i.path,{shouldShowTip:k,isMembershipOnly:C}=f(p,s);return r.createElement(m.Z,(0,n.Z)({plain:!0,anchor:!0},u,{className:(0,b.Z)("eventCard",u.className,{is_membershipOnly:C,is_membershipShownTip:k})}),E&&r.createElement("img",{src:(0,c.cR)(E,{resize:{w:180,h:180}}),alt:g}),r.createElement("div",{className:"eventCard_content"},r.createElement("div",{className:"eventCard_title"},r.createElement("h3",null,g),r.createElement("p",null,r.createElement(y,{event:s}))),r.createElement("div",{className:"eventCard_candidates"},k?r.createElement("span",null,"加入 GPASS 机核会员"):r.createElement(h,{event:s}))),r.createElement(d.Z,{className:"eventCard_r",icon:["gfas","angle-right"]}))}));var C=a(94301),_=a.n(C),w=a(46066),N=a(51206),P=a(29847);const S=(e,t,a)=>{const n=e.getRel("winners");return r.createElement("li",{key:e.getKey()},r.createElement("h3",null,e.getAttr("title")),r.createElement("p",null,r.createElement("span",{className:`badge giveaway_badge giveaway_badge-${a?"onlyOne":t+1} me-3`},a?"奖品":`奖品${t+1}`),r.createElement("span",null,"奖品名额 ",e.getAttr("amount")," 名")),(null==n?void 0:n.size)>0&&(e=>r.createElement("div",{className:"giveaway_winners"},e.map((e=>r.createElement(u.Z,{key:e.getKey(),users:e,vertical:!0,size:"lg"})))))(n))},Z=r.memo((e=>{let{giveaways:t}=e;const a=I(t),n=1===a.size;return r.createElement("ul",{className:"giveaways"},a.map(((e,t)=>S(e,t,n))))})),I=e=>e.sort(((e,t)=>e.getAttr("level")-t.getAttr("level"))),T=Z,A=r.memo((e=>{let{event:t}=e;const[a,l]=(0,r.useState)(),i=I(t.getRel("giveaways")),s=i.map((e=>{var t,a;return null===(t=e.getPreview())||void 0===t||null===(a=t[0])||void 0===a?void 0:a.path}));return(0,r.useEffect)((()=>{_()("https://alioss.gcores.com/static_config/giveaway_announcement.txt").then((e=>e.text())).then((e=>{l(e)}))}),[]),r.createElement("div",{className:(0,b.Z)("eventDetail")},r.createElement("div",null,(e=>{const t={dots:!1,infinite:!0,speed:300,slidesToShow:1,variableWidth:!0,prevArrow:r.createElement(N.Z,{icon:!0,direction:"left"}),nextArrow:r.createElement(N.Z,{icon:!0,direction:"right"})};return r.createElement(w.Z,(0,n.Z)({},t,{className:"eventDetail_imgs slick-circleArrow"}),e.map((e=>r.createElement("div",{key:e,className:"eventDetail_img_cover slick-item"},r.createElement("img",{src:(0,c.cR)(e,{resize:{w:180,h:180}})})))))})(s.filter((e=>e)))),r.createElement(P.Z,{className:"gtabs-compact eventDetail_tabs",tabs:[{title:"抽奖活动详情",key:"detail"}],active:"detail",hrefEnabled:!1}),r.createElement("div",{className:"eventDetail_time"},r.createElement(y,{event:t})),r.createElement("h1",null,t.getAttr("title")),r.createElement("div",{className:"eventDetail_candidated"},r.createElement(h,{event:t})),r.createElement("div",{className:"eventDetail_giveaways"},r.createElement(T,{giveaways:i})),r.createElement("dl",{className:"eventDetail_info"},r.createElement("dt",null,"抽奖活动说明"),r.createElement("dd",null,t.getAttr("description"))),r.createElement("dl",{className:"eventDetail_info"},r.createElement("dt",null,"抽奖活动须知"),r.createElement("dd",{style:{whiteSpace:"pre-wrap"}},a)))})),R=r.memo((e=>{let{event:t,...a}=e;const[c,d]=(0,r.useState)(!1),m=(0,l.useSelector)(o.ib),{shouldShowTip:u}=f(m,t);return r.createElement(r.Fragment,null,((e,t)=>{let{modalVisible:a,setModalVisible:n}=t;return r.createElement(i.Z,{width:846,visible:a,onCloseClick:()=>{n(!1)},hideActionBtns:!0},r.createElement(A,{event:e}))})(t,{modalVisible:c,setModalVisible:d}),r.createElement(k,(0,n.Z)({event:t,onClick:()=>{u?s.ZP.push("/gpass"):d(!0)}},a)))}))},39260:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294);const r=()=>n.createElement("div",null,n.createElement("p",null,n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://alioss.gcores.com/download/yingyezhizhao.pdf"},"营业执照")),n.createElement("p",null,n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://alioss.gcores.com/download/zengzhi.jpeg"},"增值电信业务经营许可证 京B2-20191060")),n.createElement("p",null,n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://beian.miit.gov.cn/"},"京ICP备17068232号-1")),n.createElement("p",null,n.createElement("a",{href:"https://alioss.gcores.com/download/jingwangwen-2024-1733-082.pdf",target:"_blank",rel:"noopener noreferrer"},n.createElement("span",null,"网络文化经营许可证京网文[2024]1733-082号"))),n.createElement("p",null,n.createElement("a",{target:"_blank",href:"http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502036937",rel:"noopener noreferrer"},n.createElement("img",{src:"https://alioss.gcores.com/assets/gonganbeian-a20583c81805fe64f7fa210851ce29754af9d25fd6aa5a3225a9557529602513.png",alt:"",className:"me-1"}),n.createElement("span",null,"京公网安备 11010502036937号"))),n.createElement("p",null,n.createElement("span",null,"食品经营许可证 JY11105052461621")),n.createElement("p",null,n.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://alioss.gcores.com/download/chuban-230031.pdf"},"出版物经营许可证 新出发京零字第亦230031号")))},2933:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(33529),l=a(85846),i=a(35218),s=a(54186);const o=()=>{const[e,t]=(0,n.useState)(!1),a=n.createElement(r.Z,{width:500,visible:e,onCloseClick:()=>{t(!1)},title:"联系我们 / CONTACT US",hideActionBtns:!0},[["国内商务合作","haolun@gcores.com"],["Overseas Business Enquiry","jamesf@gcores.com"],["独立游戏","jamesf@gcores.com"],["内容合作","henrysum73@gcores.com"],["实体书/有声书合作","ann@gcores.com"],["发行咨询/Publishing Enquiry","publishing@gcores.com"],["站内游戏条目建立","publishing@gcores.com"],["PR 服务合作/PR Service Collaboration","lornalin@gcores.com"]].map((e=>n.createElement(l.Z,{key:e[0],className:"d-flex row g-0 my-2 text-start",type:"light",href:`mailto:${e[1]}`},n.createElement("span",{className:"col-sm-6"},e[0]),n.createElement("span",{className:"col-sm-6 text-end"},e[1])))));return n.createElement("p",null,n.createElement(l.Z,{className:"footer_inlineblock",onClick:()=>{t(!0)},anchor:!0,plain:!0},a,"联系我们 / CONTACT US"),n.createElement("a",{href:"https://www.gcores.com/articles/167778",target:"_blank",rel:"noopener noreferrer",className:"footer_inlineblock"},"投稿须知"),n.createElement("a",{href:s.default.protocol_url,target:"_blank",rel:"noopener noreferrer",className:"footer_inlineblock"},"用户协议"),n.createElement("a",{href:s.default.privacy_url,target:"_blank",rel:"noopener noreferrer",className:"footer_inlineblock"},"隐私政策"),n.createElement("a",{href:s.default.community_rules_url,target:"_blank",rel:"noopener noreferrer",className:"footer_inlineblock"},"社区规定"),n.createElement(i.Z,{to:"/jobs",className:"footer_inlineblock"},"工作招聘"))}},30004:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(67294),r=a(39260),l=a(2933);const i=n.memo((()=>n.createElement("div",{className:"footer footer-sm"},n.createElement("div",{className:"sideFooter_links"},n.createElement(l.Z,null)),n.createElement("div",{className:"sideFooter_certificates"},n.createElement(r.Z,null),n.createElement("p",null,"©2024 GAMECORES")))))},15045:(e,t,a)=>{a.d(t,{Z:()=>v});var n=a(67294),r=a(35369),l=a(1145),i=a(80239),s=a(52004),o=a(91433),c=a(42696),d=a(85846),m=a(35018),u=a(33529);const p=e=>{let{data:t}=e;const a=t.area_name,r=t.support_chinese;let l=10;if(t.discount&&t.discount.end){new Date(t.discount.end).getTime()>(new Date).getTime()&&(l=Math.ceil(t.discount.amount/(t.regular.amount||1)*100)/10)}const s=(0,i.T4)(l<10?t.discount.amount:t.regular.amount);return n.createElement("div",{className:"gameInfo"},n.createElement("div",{className:"gameInfo_body"},n.createElement("div",{className:"gameInfo_text"},n.createElement("p",null,n.createElement("span",{className:"gameInfo_fixedName"},a),l<10&&n.createElement("span",{className:"gameInfo_tag gameInfo_tag-discount"},`${l}折`),r&&n.createElement("span",{className:"gameInfo_tag gameInfo_tag-chinese"},"中文"))),n.createElement("div",{className:"gameInfo_append gameInfo_price"},n.createElement("p",null,s),n.createElement("p",null,t.regular.source_currency.toUpperCase()," ",(0,i.T4)(t.regular.source_amount,{withRmbMark:!1})))))},g=e=>{const{game:t,store:a,filters:n,platform:i}=e;let s,o;return t?o=t.getRel("game-stores",null,(0,r.List)()).map((e=>e.toJSFlat())).toJS():a&&(o=[a.toJSFlat()]),o&&(i&&(o=o.filter((e=>e.platformName===i))),s=(0,l.G)(o,n)),{info:s}};class h extends n.PureComponent{static defaultProps={cardMode:!1,showPlatform:!1};state={...g(this.props),modalVisible:!1};static getDerivedStateFromProps(e){return g(e)}render(){const{store:e,game:t,cardMode:a,muteNoDiscount:r,filters:l,showPlatform:u}=this.props,{info:p}=this.state,g=(null==p?void 0:p.priceCount)>1,h=(null==p?void 0:p.discount)<10,v=0===(null==p?void 0:p.bestPrice),E=!!e&&g;return!p&&(null!=l&&l.chinese||null!=l&&l.onsale)?null:n.createElement(d.Z,{plain:!0,anchor:!0,div:!!e&&!g,className:(0,s.Z)("gameInfo",{"gameInfo-card":a,"gameInfo-mutePrice":!v&&!h&&r}),onClick:E?this.handleClick:void 0,to:t?(0,o.ZP)("game",{id:t.get("id")}):void 0},E&&this.renderModal(),e?n.createElement("div",{className:"gameInfo_img gameInfo_store"},n.createElement(c.Z,{name:e.getAttr("platform")})):t&&n.createElement("img",{className:"gameInfo_img gameInfo_gameImg",src:(0,i.cR)(t.getCover(),{resize:{w:128,h:60}})}),n.createElement("div",{className:"gameInfo_body"},n.createElement("div",{className:"gameInfo_text"},n.createElement("p",null,e?e.getAttr("platform-name"):t&&t.getAttr("title")),p&&n.createElement("p",null,p.discount<10&&n.createElement("span",{className:"gameInfo_tag gameInfo_tag-discount"},`${p.discount}折`),p.supportChinese&&n.createElement("span",{className:"gameInfo_tag gameInfo_tag-chinese"},"中文"),p.mcScore&&n.createElement("span",{className:`gameInfo_tag gameInfo_tag-score gameInfo_tag-score-${this.getMcScoreColor(p.mcScore)}`},`metacritic ${p.mcScore}`),u&&n.createElement("span",{className:`gameInfo_tag gameInfo_tag-${(0,i.lE)(p.platform,{camelize:!0})}`},p.platform))),n.createElement("div",{className:(0,s.Z)("gameInfo_append gameInfo_price",{"gameInfo_append-withArrow":!a,"gameInfo_price-no":!p})},(E||t)&&!a&&n.createElement("span",{className:"gameInfo_arrow"},n.createElement(m.Z,{icon:["gfas","angle-right"]})),n.createElement("p",null,p?(0,i.T4)(p.bestPrice):"暂无价格"),p&&n.createElement("p",null,p.bestPriceArea,p.discount<10&&n.createElement("span",{className:"ms-1 o_deletedText"},(0,i.T4)(p.originalPrice))))))}renderModal(){const{modalVisible:e,info:t}=this.state;return n.createElement(u.Z,{width:500,visible:e,onCloseClick:this.handleCloseModal,hideActionBtns:!0,title:`${t.platform} 各区价格`},this.renderPriceList())}renderPriceList(){const{store:e}=this.props;return e?n.createElement("ul",{className:"o_stylelessList"},e.toJSFlat().priceInfo.details.map((e=>n.createElement("li",{key:e.area_code},n.createElement(p,{data:e}))))):null}handleClick=()=>{this.setState({modalVisible:!0})};handleCloseModal=()=>{this.setState({modalVisible:!1})};getMcScoreColor=e=>e>=75?"high":e>=50?"normal":"low"}const v=h},97757:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(67294),r=a(52004),l=a(46066),i=a(35018),s=a(85846);const o=e=>e.origin||e.preview,c=e=>{let{visible:t,images:a,active:c,showDownload:d=!1,onCloseClick:m}=e;const u=(0,n.useRef)(null),[p,g]=(0,n.useState)(o(a[c??0]));(0,n.useEffect)((()=>{const e=null==u?void 0:u.current;e&&c>=0&&e.slickGoTo(c)}),[a,c]);const h=a.length>=4?a:(e=>{let t=e;for(let a=1;a<=4-e.length;a+=e.length)t=t.concat(e);return t})(a);return n.createElement("div",{className:(0,r.Z)("imagesViewerWrapper",{"d-none":!t})},n.createElement(l.Z,{ref:u,slidesToShow:3,centerMode:!0,infinite:!0,focusOnSelect:!0,arrows:!1,className:"imagesViewer",centerPadding:0,afterChange:e=>{g(o(h[e]))},responsive:[{breakpoint:700,settings:{variableWidth:!1,slidesToShow:1,centerPadding:"20px",className:"imagesViewer imagesViewer-small"}}]},h.map(((e,t)=>n.createElement("div",{key:`${e.preview}${t}`,className:"imagesViewer_item slick-item"},n.createElement("div",{className:"imagesViewerBg",onClick:()=>{m()}}),n.createElement("div",{className:"imagesViewer_img"},n.createElement("img",{src:e.preview})))))),d&&p&&n.createElement(s.Z,{className:"imagesViewer_download",plain:!0,anchor:!0,href:p},n.createElement(i.Z,{icon:["gfas","download"]})))}},10671:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(35018),l=a(52004),i=a(85846);const s=e=>{let{onChange:t,onSearch:a,loading:s,showCancel:o,onCancelClick:c,className:d}=e;const[m,u]=(0,n.useState)(""),p=m.trim();return n.createElement("div",{className:(0,l.Z)("inputSearch_container",d)},n.createElement("div",{className:"inputSearch"},n.createElement(r.Z,{className:"inputSearch_searchIcon",icon:["gfas","search"]}),n.createElement("input",{type:"text",placeholder:"搜索关键词",value:m,onChange:e=>{const a=e.target.value;u(a),null==t||t(a)},onKeyUp:e=>{13===e.keyCode&&p.length>0&&!s&&a(p)}}),n.createElement(i.Z,{style:{visibility:p.length>0?"visible":"hidden"},disabled:0===p.length,loading:s,onClick:()=>{s||a(p)}},"搜索")),o&&n.createElement(i.Z,{className:"ms-1",type:"link",onClick:()=>{u(""),null==c||c()}},"取消"))}},83476:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(73126),r=a(67294),l=a(85061),i=a(59589);const s=function(e){let{state:t=(0,l.zu)(),...a}=e;return t?r.createElement(i.Z,(0,n.Z)({loading:t.get("isRequesting"),fetched:t.get("fetched"),allLoaded:t.get("noMore")},a)):null}},59589:(e,t,a)=>{a.d(t,{Z:()=>y});var n=a(73126),r=a(67294),l=a(56196),i=a(73925),s=a(30213),o=a(85896),c=a(50533),d=a(59310),m=a(85846),u=a(23274),p=a(80239),g=a(2186),h=a(45648);const v=e=>{var t,a,n;return e&&(e.type||(null===(t=e.get)||void 0===t?void 0:t.call(e,"type"))||(null===(a=e.item)||void 0===a||null===(n=a.get)||void 0===n?void 0:n.call(a,"type")))},E=e=>{var t;if(((e,t)=>!!(e&&e.size&&e.length)&&!!e.find((e=>v(e)===t)))(e,"talks"))return"机组动态";const a=v(e&&(e[0]||(null===(t=e.get)||void 0===t?void 0:t.call(e,0))));return p.AS[a]||"内容"},f=(e,t,a)=>!(!t||a<=0)&&((null==e?void 0:e.size)??(null==e?void 0:e.length)??0);const y=function(e){let{scrollableProps:t,onLoad:a,onInit:p,allLoaded:v,className:y,hideDoneTip:b,limitForGuest:k,limitTextForGuest:C,limitCountForGuest:_=5,children:w,...N}=e;const{pageName:P}=(0,h.EY)(),S=(0,c.useDispatch)(),Z=(0,c.useSelector)(d.yK),I=(0,r.useRef)(3),{loading:T,data:A}=N,R=(0,o.II)(a),D=k&&!Z,x=!(0,s.xb)(A),M=!T&&v&&x,[L,q]=(0,r.useState)(!1),F=(0,r.useRef)(p);F.current!==p&&(q(!1),F.current=p);const B=(0,r.useCallback)((()=>{D&&x||T||v||!R.current||(R.current(),I.current-=1)}),[T,v,R,D,x]);return(0,r.useEffect)((()=>{(async()=>{p&&(I.current=3,await p(),q(!0))})()}),[p]),r.createElement(i.Z,(0,n.Z)({onScrollToBottom:B,onNotScrollable:B,checkNotScrollableKey:f(A,L,I.current),bottomOffset:400,inWindow:!0},t),r.createElement(l.Z,(0,n.Z)({},N,{loadingMore:!0}),(e=>w(D?e.slice(0,_):e))),(()=>{if(M)return b?null:r.createElement("p",{className:"mutedInfo"},"已全部加载");if(D&&!(0,s.xb)(A)){const e=E(A);return r.createElement(m.Z,{className:"limitedButton",plain:!0,onClick:()=>{(0,g.lw)("LimitedButton",e||"Unknown","button",{source:P}),S((0,u.CcW)())}},C||`登录后查看更多${e}`)}return null})())}},47042:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(73126),r=a(67294),l=a(74015);const i=e=>r.createElement(l.Z,(0,n.Z)({bold:!0},e),"⚠️ 未经作者授权 禁止转载")},74015:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),r=a(52004);const l=e=>{let{bold:t,inline:a,children:l,className:i}=e;return n.createElement("div",{className:(0,r.Z)("notice",{"notice-bold":t,"notice-inline":a},i)},l)}},87544:(e,t,a)=>{a.d(t,{Z:()=>A});var n=a(67294),r=a(50533),l=a(85896),i=a(59310),s=a(38854),o=a(14293),c=a.n(o),d=a(92742),m=a.n(d),u=a(66688),p=a(85846),g=a(69951),h=a(73126),v=a(23157),E=a(52004);const f={options:[],data:{}},y=(e,t)=>{if(!e||!t)return f;for(const a of Object.keys(t)){const n=t[a];if(e==a)return{options:C(Object.keys(n).map((e=>n[e].name))),data:n}}return f},b=(e,t)=>{if(!t||!e)return null;for(const a of Object.keys(t)){const n=t[a];if(("string"==typeof n?n:n.name)===e)return a}return null},k=e=>e?{label:e,value:e}:null,C=e=>e.map((e=>k(e))).filter((e=>!!e)),_=e=>{let{value:{province:t,city:r,district:l},onChange:i}=e;const[s,o]=(0,n.useState)(),c=b(t,null==s?void 0:s.provincesData),d=C(Object.values((null==s?void 0:s.provincesData)||{})||[]),{options:m,data:u}=y(c,null==s?void 0:s.citiesData),p=b(r,u),{options:g}=y(p,null==s?void 0:s.citiesData);(0,n.useEffect)((()=>{(async()=>{const e=await a.e(859).then(a.bind(a,33859));o(e)})()}),[]);const f={classNamePrefix:"react-select",className:"react-select",isSearchable:!1};return n.createElement("div",{className:(0,E.Z)("districtSelect")},n.createElement(v.ZP,(0,h.Z)({},f,{options:d,value:k(t),placeholder:"省",onChange:e=>{i({province:null==e?void 0:e.value,city:void 0,district:void 0})}})),n.createElement(v.ZP,(0,h.Z)({},f,{placeholder:"市",options:m,value:k(r),onChange:e=>{i({province:t,city:null==e?void 0:e.value,district:void 0})}})),n.createElement(v.ZP,(0,h.Z)({},f,{placeholder:"区",options:g,value:k(l),onChange:e=>{i({province:t,city:r,district:null==e?void 0:e.value})}})))};var w=a(54186);const{phoneRegexp:N,phoneFormatTip:P}=w.default,S=e=>{const t=e["contact-number"],a={};return Object.keys(e).filter((e=>"thumb"!==e)).forEach((t=>{const n=!c()(e[t])&&m()(String(e[t]));n&&n.length>0||(a[t]="请填写完整数据")})),Object.values(e.district).findIndex((e=>!e))>=0&&(a.district="请完善地址"),t&&N.test(t)||(a["contact-number"]=`手机号格式错误，${P}`),a},Z=e=>{let{input:t,meta:a}=e;return n.createElement(g.cw,{required:!0},n.createElement(_,t),(0,g.I1)(a))},I=e=>{let{onSubmit:t,initialValues:a}=e;return n.createElement(u.l0,{onSubmit:t,validate:S,initialValues:a},(e=>{let{handleSubmit:t,submitting:a}=e;return n.createElement("form",{onSubmit:t},n.createElement(u.gN,{name:"contact-name",placeholder:"请输入收件人姓名"},g.CF),n.createElement(u.gN,{name:"contact-number",placeholder:"请输入收件人手机号码"},g.CF),n.createElement(u.gN,{name:"district"},Z),n.createElement(u.gN,{name:"detail",componentType:"textarea",placeholder:"请输入收件地址"},g.CF),n.createElement(u.gN,{label:"默认地址",name:"is-default",type:"checkbox",alwaysTip:!0},g.k5),n.createElement(p.Z,{block:!0,type:"primary",htmlType:"submit",loading:a},"保存"))}))},T={dispatchCreateAddress:(e,t)=>(0,s.D1)("post-addresses",{method:"POST",body:{data:{type:"post-addresses",attributes:e,relationships:{user:{data:{type:"users",id:t.get("id")}}}}}}),dispatchUpdateAddress:(e,t)=>(0,s.D1)(`post-addresses/${t}`,{method:"PATCH",body:{data:{type:"post-addresses",id:t,attributes:e}}})},A=(0,r.connect)(((e,t)=>({currentUser:(0,i.ib)(e)})),T)((e=>{let{address:t,dispatchCreateAddress:a,dispatchUpdateAddress:r,currentUser:i,onSubmiteSuccess:s}=e;const o=(0,l.II)(t),c=(0,n.useMemo)((()=>{const e=o.current;return{"contact-name":(null==e?void 0:e.getAttr("contact-name"))||"","contact-number":(null==e?void 0:e.getAttr("contact-number"))||"",detail:(null==e?void 0:e.getAttr("detail"))||"","is-default":(null==e?void 0:e.getAttr("is-default"))??!1,district:{province:(null==e?void 0:e.getAttr("province"))??void 0,city:(null==e?void 0:e.getAttr("city"))??void 0,district:(null==e?void 0:e.getAttr("district"))??void 0}}}),[o]);return n.createElement(I,{onSubmit:e=>{const n={...e,...e.district};let l;l=t?r(n,t.get("id")):a(n,i),l.then((()=>{null==s||s()}))},initialValues:c})}))},98140:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(73126),r=a(67294),l=a(50533),i=a(85846),s=a(1145),o=a(52004),c=a(59310),d=a(38854);const m=(0,c.P1)(((e,t)=>t.payload.result),c.LF,((e,t)=>(0,s.BY)(e,t,{originalPreview:"draft"}))),u={dispatchGetAddresses:e=>(0,d.D1)(`users/${e}/post-addresses`),dispatchDeleteAddress:e=>(0,d.D1)(`post-addresses/${e}`,{method:"DELETE"})},p=(0,l.connect)(((e,t)=>({currentUser:(0,c.ib)(e),parseAddresses:t=>m(e,t)})),u)((e=>{let{dispatchGetAddresses:t,dispatchDeleteAddress:a,currentUser:l,parseAddresses:s,inSettingPage:c,onGetData:d,onEdit:m,onSelect:u}=e;const[p,g]=(0,r.useState)(-1),[h,v]=(0,r.useState)(null),[E,f]=(0,r.useState)(),y=c?{size:"sm",ellipse:!0,type:"secondary"}:{size:"sm",plain:!0},b=()=>{l&&t(l.get("id")).then((e=>{f(e),g(-1)}))};return(0,r.useEffect)((()=>{if(u){const e=null==h?void 0:h.get(p);u(p>=0&&e?e:null)}}),[p,h,u]),(0,r.useEffect)((()=>{b()}),[]),(0,r.useEffect)((()=>{if(E){const e=s(E);v(e),null==d||d(e)}}),[s,E,d]),l?null===h?r.createElement("p",{className:"my-3"},"加载中..."):0===h.size?r.createElement("p",{className:"mutedInfo"},"暂无数据"):r.createElement("ul",{className:(0,o.Z)("postAddresses",{"postAddresses-inPage":c})},h.map(((e,t)=>{const l=`${e.getAttr("province")??""} ${e.getAttr("city")??""} ${e.getAttr("district")??""}`.trim();return r.createElement("li",(0,n.Z)({key:e.getKey(),className:(0,o.Z)({is_active:u&&t===p,is_choosable:u})},u?{tabIndex:-1,role:"button",onClick:()=>{g(t)}}:{}),r.createElement("div",{className:"postAddress_desc"},r.createElement("p",null,e.getAttr("is-default")&&r.createElement("span",{className:"badge me-2"},"默认"),e.getAttr("contact-name")," • ",e.getAttr("contact-number")),r.createElement("p",null,l," ",l?" | ":"",e.getAttr("detail"))),r.createElement("p",{className:"postAddress_actions"},r.createElement(i.Z,(0,n.Z)({},y,c?{type:"danger",outline:!0}:{},{onClick:()=>{confirm("是否确定删除该地址？")&&a(e.get("id")).then((()=>{b()}))}}),"删除"),r.createElement(i.Z,(0,n.Z)({},y,{onClick:()=>{null==m||m(e)}}),"编辑")))}))):null}))},22134:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(73126),r=a(67294),l=a(91433),i=a(52004),s=a(80239),o=a(85846),c=a(35018);const d=(e,t)=>{var a,n,r;return(null===(a=e.get)||void 0===a?void 0:a.call(e,"image"))||(null===(n=e.getAttr)||void 0===n?void 0:n.call(e,t))||(null===(r=e.getThumb)||void 0===r?void 0:r.call(e))},m=e=>{var t,a;return(null===(t=e.get)||void 0===t?void 0:t.call(e,"title"))||(null===(a=e.getTitle)||void 0===a?void 0:a.call(e))},u=e=>{var t;return(null===(t=e.get)||void 0===t?void 0:t.call(e,"permalink"))||(0,l.ZP)(e)},p=e=>{const t=(e=>{if(!e)return{};const t={type:e.get("type"),title:m(e),cover:d(e,"cover"),desc:"",to:u(e)};if("portfolios"===t.type){const a=((e,t,a)=>{var n,r;return(null===(n=e.get)||void 0===n?void 0:n.call(e,t))||(null===(r=e.getAttr)||void 0===r?void 0:r.call(e,a))})(e,"","published-work-count");return{...t,resize:{w:120,h:68},desc:a?`${a} 作品`:""}}return["games","films"].includes(t.type)?{...t,resize:{w:81,h:38}}:["articles","videos"].includes(t.type)?{...t,resize:{w:120,h:68}}:["radios","albums","album-bundles","products"].includes(t.type)?{...t,resize:{w:68,h:68}}:"discussions"===t.type?{...t,cover:["gfac","discussion"]}:t})(e.item),{item:a,type:l=t.type,title:p=t.title||"",desc:g=t.desc||"",cover:h=t.cover||"",imageResize:v=t.resize,to:E=t.to,icon:f=["gfas","angle-right"],gray:y,className:b,onClick:k,onIconClick:C,onClose:_,...w}=e,N=E||k,P=h?"string"==typeof h?r.createElement("img",{src:(0,s.cR)(h,v&&{resize:v}),alt:p}):h instanceof Array?r.createElement(c.Z,{icon:h,className:"redirectEntry_prefix"}):null:null;return r.createElement(o.Z,(0,n.Z)({plain:!0,anchor:!0,div:!N,to:E,className:(0,i.Z)("redirectEntry",{"redirectEntry-gray":y,[`redirectEntry-${l}`]:l},b),onClick:k},w),P,r.createElement("h3",null,p,g&&r.createElement("small",null,g)),r.createElement(o.Z,{className:(0,i.Z)("redirectEntry_icon",{"redirectEntry_icon-close":_}),plain:!0,onClick:e=>{_?_():C&&C(),(_||C)&&(e.preventDefault(),e.stopPropagation())}},r.createElement(c.Z,{icon:_?["gfas","times"]:f})))}},69951:(e,t,a)=>{a.d(t,{CF:()=>w,cw:()=>s.Z,AS:()=>k,jM:()=>C,n$:()=>_,k5:()=>b,I1:()=>f,Vk:()=>E,h0:()=>P,Ps:()=>N});var n=a(73126),r=a(67294),l=a(83432),i=a(52004),s=a(90854),o=a(66688),c=a(85896),d=a(72753),m=a(18387),u=a(12870),p=a(12769);const g=(0,u.Z)(p.Z),h=e=>{const t=(0,d.nO)();return void 0===t?null:t?r.createElement(m.Z,e):r.createElement(g,e)},v=e=>{let{touched:t,error:a}=e;return!(!t||!a)},E=function(e){let{errorClassName:t="is-invalid",base:a="",shouldShowError:n=v}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.Z)(a,{[t]:n(e)})},f=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;const{error:n}=e;let l=null;return a(e)?l=(e=>r.createElement("div",{className:"invalid-feedback d-block"},e))(n):t&&(l=r.createElement("div",{className:"ms-1"},r.createElement("small",{className:"form-text text-muted"},t))),l},y=e=>{let{input:t,meta:a,label:l,inlineStyle:s,showFeedback:o}=e;const d=(0,c.$0)(t.value);return r.createElement("div",{className:(0,i.Z)({col:s})},r.createElement("div",{className:"form-check"},r.createElement("input",(0,n.Z)({className:(0,i.Z)("form-check-input",E(a)),id:d},t)),r.createElement("label",{className:"form-check-label",htmlFor:d},l),o?f(a):null))},b=e=>{let{input:t,meta:a,tip:l,label:i,alwaysTip:o=!1,groupProps:c={},required:d,...m}=e;const u={...t,...m,className:E(a,{base:"form-check-input"})},p=f(a,o?void 0:l);return r.createElement(s.Z,(0,n.Z)({label:i,htmlFor:u.id,tip:o&&l,required:d,horizontalCol:[["8"],["4"]],className:"form-group-rowComponent"},c),r.createElement("div",{className:"form-check form-switch"},r.createElement("input",u)),p)},k=e=>{let{name:t,label:a,options:l,inlineStyle:c=!0,type:d="radio",inputProps:m,...u}=e;return r.createElement(s.Z,(0,n.Z)({label:a},u),r.createElement("div",{className:(0,i.Z)({"row gx-3 gy-2 row-cols-auto":c})},l.map(((e,a)=>{const{value:i,label:s}=e,u=a===l.length-1;return r.createElement(o.gN,(0,n.Z)({key:i,name:t,type:d,value:i,label:s,inlineStyle:c,showFeedback:u},m),y)}))))},C=e=>{let{label:t,input:a,meta:i,groupProps:o={},alwaysTip:c,tip:d,required:m,imageContainerClassName:u,imageClassName:p,...g}=e;return r.createElement(s.Z,(0,n.Z)({label:t,tip:c&&d,required:m},o),a.value,r.createElement("div",{className:u},r.createElement(l.Z,(0,n.Z)({image:a.value,onChange:a.onChange,className:p},g))),f(i,c?void 0:d))},_=e=>{let{label:t,input:a,meta:l,groupProps:i={},alwaysTip:o,tip:c,required:d,imageContainerClassName:m,imageClassName:u,description:p=[""],...g}=e;return r.createElement(s.Z,(0,n.Z)({label:t,tip:o&&c,required:d},i),r.createElement("div",{className:m},r.createElement(h,(0,n.Z)({image:a.value,onChange:a.onChange,className:u,description:p},g))),f(l,o?void 0:c))},w=e=>{let{input:t,meta:a,tip:l,label:o,componentType:c,className:d="form-control",alwaysTip:m=!1,groupProps:u={},wordsLimit:p=0,required:g,readMode:h,shouldShowError:v,...y}=e;const b={...t,...y,className:E(a,{base:d,shouldShowError:v})};let k=null;if(h)k=r.createElement("span",null,t.value);else if("textarea"===c){if(k=r.createElement("textarea",(0,n.Z)({},b,{rows:5})),p>0){const e=p-t.value.length;k=r.createElement("div",{className:(0,i.Z)("form_textareaWithCounter",{"form_textareaWithCounter-warning":e<0})},k,r.createElement("span",null,e>=0?e:`已超出 ${Math.abs(e)} 个字`))}}else k=r.createElement("input",b);const C=f(a,m?void 0:l,v);return r.createElement(s.Z,(0,n.Z)({label:o,htmlFor:b.id,tip:m&&l,required:g},u),k,C)},N=e=>{var t,a;null===(t=document)||void 0===t||null===(a=t.getElementById(e))||void 0===a||a.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},P=e=>e||null},23736:(e,t,a)=>{a.d(t,{Cr:()=>r});var n=a(35369);const r=function(){return{required:!0,validate:l([i,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]])}},l=e=>(t,a,n)=>{for(const a of e){const e=a(t);if(e)return e}},i=e=>{if(!e||"string"==typeof e&&0===e.trim().length||e instanceof Array&&0===e.length||n.List.isList(e)&&0===e.size)return"该项不能为空"}},73925:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(67294),r=a(85896),l=a(52004),i=a(84644);const s=(0,n.forwardRef)(((e,t)=>{const a={...i.lG,...e,inWindow:!e.container&&(e.inWindow??i.lG.inWindow)},{children:s,className:o,inWindow:c,container:d,checkNotScrollableKey:m}=a,u=(0,r.II)(a),p=(0,n.useRef)(null),g=(0,i.uK)(a,p),h=(0,i.Xj)(g,u),v=c||d;return(0,n.useEffect)((()=>{const e=g(!0);if(e)return e.addEventListener("scroll",h),()=>{e.removeEventListener("scroll",h)}}),[g,h]),(0,n.useEffect)((()=>{!1!==m&&h(void 0,{onlyNotScrollable:!0})}),[m,h]),(0,n.useImperativeHandle)(t,(()=>({scrollToTop:()=>{const e=g(!1);e&&(e.scrollTop=0)},scrollToBottom:()=>{const e=g(!1);e&&(e.scrollTop=99999)}}))),v?n.createElement(n.Fragment,null,s):n.createElement("div",{ref:p,className:(0,l.Z)("o_scrollableContainer",o)},s)}))},84644:(e,t,a)=>{a.d(t,{Xj:()=>o,kL:()=>c,lG:()=>i,uK:()=>s});var n=a(67294),r=a(23493),l=a.n(r);const i={inWindow:!1,bottomOffset:0},s=(e,t)=>{let{inWindow:a,container:r}=e;return(0,n.useCallback)((e=>r?document.querySelector(r):a?e?window:window.document.documentElement:t.current),[a,r,t])},o=(e,t)=>(0,n.useMemo)((()=>l()((function(a){let{onlyNotScrollable:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.current)return;const{inWindow:r,bottomOffset:l,onScroll:i,onScrollToBottom:s,onScrollToTop:o,onNotScrollable:c}=t.current,d=e(!1);if(!d)return;const m=((e,t)=>{let{inWindow:a,bottomOffset:n}=t;const r=a?window.pageYOffset:e.scrollTop,l=a?window.innerHeight:e.offsetHeight,i=e.scrollHeight,s=r+l,o=i>l+n;return{scrollable:o,totalScroll:i,currentScroll:s,isBottom:o&&s+n+20>=i,isTop:o&&r<20}})(d,{inWindow:r,bottomOffset:l});m.scrollable||!c?n||(i&&i(a,m),m.isBottom&&s&&s(a,m),m.isTop&&o&&o(a,m)):c()}),330)),[e,t]),c=e=>{const t=(0,n.useRef)();return{props:(0,n.useMemo)((()=>({className:e,inWindow:!1,ref:t})),[e]),ref:t}}},51206:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(73126),r=a(67294),l=a(85846),i=a(35018);const s=function(){let{currentSlide:e,slideCount:t,children:a,icon:s,direction:o="left",...c}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.createElement(l.Z,(0,n.Z)({},c,{anchor:!0,plain:!0}),s?r.createElement(i.Z,{icon:["gfas",`angle-${o}`]}):a)}},65471:(e,t,a)=>{a.d(t,{VG:()=>c,ZP:()=>d});var n=a(73126),r=a(67294),l=a(33529),i=a(85896);const s="_initial",o=r.createContext({}),c=()=>(0,r.useContext)(o),d=e=>{let{initialStep:t,children:a,steps:c={},className:d,modalProps:m,onClose:u}=e;const p=(0,i.aC)(),[g,h]=(0,r.useState)([[a?s:t??"nokey"]]),v=(0,r.useRef)({}),E={...a?{[s]:()=>a}:{},...c,...v.current};(0,r.useEffect)((()=>{0===g.length&&u()}),[g,u]);const f=e=>{h((t=>{if(t.pop(),e&&t.length>0){const a=t[t.length-1];t[t.length-1]=[a[0],a[1],e]}return[...t]}))};return p?r.createElement(o.Provider,{value:{extendSteps:e=>{v.current={...v.current,...e}},next:(e,t)=>{h((a=>(a.push([e,t]),[...a])))},back:f,close:()=>{h([])}}},r.createElement("div",{className:d},g.map(((e,t)=>r.createElement(r.Fragment,{key:e[0]},((e,t)=>{let[a,i]=e,{back:s,totalSteps:o,isFirst:c,isLast:d,modalProps:m}=t;const u=o[a];if(void 0===u)return null;const p="function"==typeof u?{render:u}:u,g=p.render(i);return!1===p.modalProps?r.createElement(r.Fragment,{key:a},g):r.createElement(l.Z,(0,n.Z)({key:a,visible:!0,onCloseClick:()=>{s()},hideActionBtns:!0},m,p.modalProps),g)})(e,{back:f,totalSteps:E,isLast:t===g.length-1,isFirst:0===t,modalProps:m})))))):null}},29012:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(73126),r=a(67294),l=a(52004);const i=e=>{let{labels:t,withLabel:a,children:i,className:s,...o}=e;return r.createElement("div",(0,n.Z)({},o,{className:(0,l.Z)(s,{story_censor:t})}),t&&a&&r.createElement("span",{className:"story_censor_label"},"string"==typeof a?a:"待修改"),i)}},16684:(e,t,a)=>{a.d(t,{Z:()=>E});var n=a(73126),r=a(67294),l=a(46066),i=a(35218),s=a(52004),o=a(80239),c=a(29012),d=a(35018),m=a(85846);const u=e=>{let{currentSlide:t,slideCount:a,...l}=e;return r.createElement(m.Z,(0,n.Z)({},l,{plain:!0}),r.createElement("span",null,r.createElement(d.Z,{icon:["gfas","angle-right"]})))},p=e=>{let{currentSlide:t,slideCount:a,...l}=e;return r.createElement(m.Z,(0,n.Z)({},l,{plain:!0}),r.createElement("span",null,r.createElement(d.Z,{icon:["gfas","angle-left"]})))};var g=a(27178);const h={dots:!0,infinite:!0,speed:500,draggable:!1,slidesToShow:1,slidesToScroll:1,nextArrow:r.createElement(u,null),prevArrow:r.createElement(p,null)},v=e=>{let{images:t,ratio:a,onChange:s,censorImages:d}=e;return(null==t?void 0:t.length)>0?r.createElement(l.Z,(0,n.Z)({},h,{afterChange:s}),t.map(((e,n)=>{const{path:l,caption:s}=e,{height:m}=(0,o.Eo)(l)||{},u=a>=1&&m&&m<350&&1===t.length?Math.max(20,m/7):100*a;return r.createElement("div",{key:`${e}${n}`,className:"slick-item"},r.createElement(i.Z,{href:(0,o.cR)(l),className:"gallery_item",style:{paddingBottom:`${u}%`},openNewWindow:!0},r.createElement(c.Z,{className:"gallery_item_inner",labels:null==d?void 0:d.includes(l)},r.createElement(g.Z,{src:(0,o.cR)(l,{resize:{w:1e3,m:"mfit"},bright:o.jh}),alt:s})),((null==s?void 0:s.length)??0)>0&&r.createElement("p",{className:"gallery_imageCaption"},s)))}))):null},E=e=>{let{width:t,height:a,caption:n,spoiler:l,onSpoilerChange:i,images:o,className:m,censorImages:u}=e;const p=((e,t)=>{let{width:a,height:n}=e;if(a&&n)return n/a;const r=t[0];return r&&r.width&&r.height?r.height/r.width:1})({width:t,height:a},o),[g,h]=(0,r.useState)(0),E=o.length>1;let f=!1;for(const{path:e}of o)null!=u&&u.includes(e)&&(f=!0);return r.createElement(r.Fragment,null,r.createElement(c.Z,{className:(0,s.Z)("gallery",{"gallery-multi":E},{"gallery-spoiler":!0===l},{"gallery-spoiler-pending":"pending"===l},m),labels:f},r.createElement(v,{images:o,ratio:Math.min(p,4/3),onChange:h,censorImages:u}),l&&r.createElement("div",{className:"gallery_spoiler story_hidden",role:"button",tabIndex:-1,onClick:()=>{null==i||i(!1)}},r.createElement(d.Z,{icon:["gfas","eye-slash"]}),r.createElement("p",null,"内容因剧透、敏感不适等原因被隐藏"),r.createElement("strong",null,"点击查看")),E&&r.createElement("div",{className:"gallery_indexOf"},r.createElement("span",null,g+1)," / ",r.createElement("span",null,o.length))),((null==n?void 0:n.length)??0)>0&&!1===l&&r.createElement("div",{className:"story_caption"},n))}},89307:(e,t,a)=>{a.d(t,{dX:()=>l.dX,FB:()=>l.FB,ZP:()=>Se,Zy:()=>we,_s:()=>Ne,zE:()=>h,N$:()=>E});var n=a(73126),r=a(9041),l=a(1190),i=a(67294),s=a(35018),o=a(52004),c=a(35369);const d="gallery",m="image",u="embed",p="widget",g=(e,t,a)=>{const n=r.EditorState.push(e,t,"activate-entity-data"),l=r.EditorState.forceSelection(n,n.getSelection());return a(l),l},h=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=e.getCurrentContent(),l=n.getBlockForKey(t),i=a?l.getText().length:0,s=new r.SelectionState({anchorKey:t,anchorOffset:i,focusKey:t,focusOffset:i}),o=r.Modifier.splitBlock(n,s),c=a?o.getSelectionAfter():s,d=r.Modifier.setBlockType(o,c,"unstyled").merge({selectionBefore:c,selectionAfter:c.set("hasFocus",!0)});return r.EditorState.push(e,d,"insert-fragment")},v=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const l=e.getCurrentContent().createEntity(t.toUpperCase(),"IMMUTABLE",a);return((e,t)=>{let{type:a="unstyled",initData:n=(0,c.Map)(),character:l="",selection:i,entityKey:s,appendNewBlock:o=!1}=t;const d=e.getCurrentContent(),m=i||e.getSelection(),u=m.getStartKey(),p=d.getKeyAfter(u),g=r.Modifier.setBlockType(d,m,a),h=r.CharacterMetadata.create(s?{entity:s}:void 0),v=(0,c.List)((0,c.Repeat)(h,l.length)),E=[new r.ContentBlock({key:(0,r.genKey)(),type:a,text:l,data:n,characterList:v}),...o||!p?[new r.ContentBlock({key:(0,r.genKey)(),type:"unstyled",text:"",characterList:(0,c.List)()})]:[]],f=r.BlockMapBuilder.createFromArray(E),y=r.Modifier.replaceWithFragment(g,m,f),b=y.merge({selectionBefore:m,selectionAfter:y.getSelectionAfter().set("hasFocus",!0)});return r.EditorState.push(e,b,"insert-fragment")})(e,{type:"atomic",entityKey:l.getLastCreatedEntityKey(),character:"-",...n})},E=(e,t)=>{const a=e.getCurrentContent(),n=a.getBlockForKey(t),l=a.getBlockAfter(t),i=l?l.getKey():t,s=new r.SelectionState({anchorKey:t,anchorOffset:0,focusKey:i,focusOffset:t===i?n.getText().length:0}),o=new r.SelectionState({anchorKey:t,anchorOffset:0,focusKey:t,focusOffset:0});let c=e,d=a;return d=r.Modifier.setBlockType(d,o,l?l.getType():"unstyled"),d=r.Modifier.removeRange(d,s,"forward"),d=d.merge({selectionBefore:o,selectionAfter:o.set("hasFocus",!0)}),c=r.EditorState.push(c,d,"remove-range"),c};var f=a(45697),y=a.n(f),b=a(4397),k=a(81015);class C extends i.Component{constructor(e){super(e),this.state={caption:e.data.caption,content:e.data.content},this.handleContentChange=this.handleChange.bind(this,"content"),this.handleCaptionChange=this.handleChange.bind(this,"caption"),this.handleConfirm=this.handleConfirm.bind(this),this.close=this.close.bind(this)}close(){this.props.close()}handleChange(e,t){this.setState({[e]:t.target.value})}handleConfirm(){const e=(0,k.ZP)(this.state.content);if(!e)return void alert(k.IE);const{useFlash:t}=e;t&&alert("提醒：该代码不支持手机端使用"),this.close(),this.props.onConfirmClick(this.state)}render(){return i.createElement(b.Z,{className:"popBox",overlayClassName:"popBox_overlay",visible:this.props.visible,title:"嵌入代码编辑",onCloseClick:this.close,onConfirmClick:this.handleConfirm},i.createElement("div",{className:"form-group"},i.createElement("textarea",{className:"form-control j_modal_autofocus o_disableResize",rows:"6",placeholder:k.IE,value:this.state.content,onChange:this.handleContentChange})),i.createElement("div",{className:"form-group"},i.createElement("input",{type:"text",className:"form-control",placeholder:"说明",value:this.state.caption,onChange:this.handleCaptionChange})))}}C.propTypes={visible:y().bool.isRequired,onConfirmClick:y().func.isRequired,close:y().func.isRequired,data:y().object},C.defaultProps={data:{caption:"",content:""}};const _=C;var w=a(28326),N=a(92742),P=a.n(N);const S="story_mdBlockMark story_block",Z="story_block";var I=a(16684),T=a(85846);class A extends i.Component{constructor(e){super(e),this.state={visible:!1}}render(){const{actions:e}=this.props;let t=null;if(e&&e.length>0){const a=e.map((e=>{let{extraComponent:t}=e;return t})).filter((e=>!!e)),n=e.map(((e,t)=>{let{label:a,callback:n,customComponent:r,name:l,extraComponent:s}=e;return i.createElement("li",{key:`${a}${t}`},i.createElement(T.Z,{title:a,onClick:n,anchor:!0,plain:!0},r||l))}));t=i.createElement(i.Fragment,null,a,i.createElement("ul",{className:"story_editor_toolActions",style:{display:this.state.visible?"block":"none"}},n))}return i.createElement("div",{className:"story_editor_toolActionsContainer",onMouseEnter:()=>{this.setState({visible:!0})},onMouseLeave:()=>{this.setState({visible:!1})}},i.createElement("div",{className:"story_embed_wrapper"},i.createElement("div",{className:"story_embed_disabled"}),t,this.props.children))}}A.propTypes={actions:y().array.isRequired,children:y().oneOfType([y().element,y().array,y().string]).isRequired};const R=A;class D extends i.Component{constructor(e){super(e),this.state={showModal:!1}}handleModalClick=()=>{this.setState({showModal:!0})};handleConfirmEdit=e=>{const{onEntityDataChange:t}=this.props;t(e),this.closeModal()};closeModal=()=>{this.setState({showModal:!1})};render(){const{editorEnabled:e,data:t,censorImages:a}=this.props;if(!e)return i.createElement(I.Z,t);const r=[{label:"编辑",customComponent:i.createElement("span",null,i.createElement(s.Z,{icon:["gfas","edit"]})),extraComponent:i.createElement(w.Z,{onConfirmClick:this.handleConfirmEdit,close:this.closeModal,visible:this.state.showModal,data:t}),callback:this.handleModalClick}];return i.createElement(R,{actions:r.concat(this.props.actions)},i.createElement(I.Z,(0,n.Z)({},t,{censorImages:a})))}}D.propTypes={data:y().object.isRequired,actions:y().array.isRequired,editorEnabled:y().bool.isRequired,onEntityDataChange:y().func.isRequired,censorImages:y().array};const x=D;var M=a(50533),L=a(1216),q=a(80239),F=a(20525),B=a(23274),O=a(6592),U=a(94301),$=a.n(U),G=a(27178);const z=e=>{let{src:t,onLoad:a,alt:r,ossOptions:l=[],enablePlaceholderColor:s=!1,size:c,...d}=e;const m=(e=>/^http/.test(e)||/^blob/.test(e))(t),[u,p]=(0,i.useState)(!1),[g,h]=(0,i.useState)(s?"rgba(0, 0, 0, 0.02)":void 0),[v,E]=c||[],f=v&&E&&E/v,y=(0,i.useMemo)((()=>m?t:(0,q.cR)(t,...l)),[t,m,l]),b=(0,i.useCallback)((e=>{u||(p(!0),null==a||a(e))}),[a,u]);return(0,i.useEffect)((()=>{if(s&&!m&&t){(async()=>{const e=(0,q.cR)(t,"image/average-hue"),a=await $()(e,{}).then((e=>e.json()));null!=a&&a.RGB&&h(`#${a.RGB.slice(2)}`)})()}}),[s,t,m]),i.createElement("div",{className:(0,o.Z)("graceMedia",{"graceMedia-success":u}),style:{width:v}},i.createElement("div",{className:(0,o.Z)("graceMedia_placeholder",{"graceMedia_placeholder-ratio":f}),style:{backgroundColor:g,...f?{paddingBottom:100*f+"%"}:null}},i.createElement(G.Z,(0,n.Z)({alt:r,src:y,onLoad:b},d))))};var H=a(29012);const V=e=>{const t=!!e.data.file,a=e.data.caption;return{showModal:!1,isRequesting:t,caption:a,prevPropsIdentity:`${t}${a}`}};class W extends i.PureComponent{static getDerivedStateFromProps(e,t){const a=V(e);return t.prevPropsIdentity!==a.prevPropsIdentity?a:null}constructor(e){super(e),this.handleConfirm=this.handleConfirm.bind(this),this.postCallback=this.postCallback.bind(this),this.handleCaptionChange=this.handleCaptionChange.bind(this),this.state={isInit:!1,...V(e)}}componentDidMount(){const{data:e,dispatch:t,editorEnabled:a}=this.props;a&&e.file instanceof File&&t((0,B.mh_)(e.file)).then((t=>{(0,O.C)(e.file,(e=>{this.postCallback(t,e)}))})),this.setState({isInit:!0})}getImageWidth(){const{data:e}=this.props;return"center"===e.pos?1500:window.innerWidth<=500?300:700}postCallback(e){let{width:t,height:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setState({isRequesting:!1}),e.error?this.setState({error:e.error}):this.props.onEntityDataChange({path:e.payload.origin.path,file:!1,width:t,height:a})}handleConfirm(){this.setState({showModal:!1}),this.props.onEntityDataChange({caption:this.state.caption})}handleCaptionChange(e){this.setState({caption:e.target.value})}handlePositionChange(e){const{onEntityDataChange:t,data:a}=this.props;t({pos:a.pos===e?void 0:e})}renderInEditor=e=>{const{imageAdvancedPosition:t,data:a}=this.props;let n=[{label:"编辑",customComponent:i.createElement("span",null,i.createElement(s.Z,{icon:["gfas","edit"]})),extraComponent:i.createElement(b.Z,{className:"popBox",overlayClassName:"popBox_overlay",visible:this.state.showModal,title:"图片编辑",hideCloseBtn:!0,onConfirmClick:this.handleConfirm},i.createElement("div",{className:"form-group"},i.createElement("input",{type:"text",className:"form-control",placeholder:"图片说明",value:this.state.caption||"",onChange:this.handleCaptionChange}))),callback:()=>{this.setState({showModal:!0})}}];return t&&(n=n.concat([{label:"居左",customComponent:i.createElement(s.Z,{icon:["gfas","image-pos-left"],className:"left"===a.pos?"active":""}),callback:this.handlePositionChange.bind(this,"left")},{label:"居中",customComponent:i.createElement(s.Z,{icon:["gfas","image-pos-center"],className:"center"===a.pos?"active":""}),callback:this.handlePositionChange.bind(this,"center")},{label:"居右",customComponent:i.createElement(s.Z,{icon:["gfas","image-pos-right"],className:"right"===a.pos?"active":""}),callback:this.handlePositionChange.bind(this,"right")}])),i.createElement(R,{actions:n.concat(this.props.actions)},e)};render(){const{isRequesting:e,caption:t,error:a,isInit:n}=this.state,{editorEnabled:r,data:l,scrollContainer:o,censorImages:c}=this.props,{path:d,file:m,width:u,height:p}=l,g=u&&p?p/u:null,h=this.getImageWidth(),v=g&&h*g;let E=null;if(d||m instanceof File||(E=i.createElement("span",null,"Error: 这是一个未上传完全的图片，请删除")),a&&(E=i.createElement("span",null,"Error: 上传失败，请删除后重新上传")),E)return r?i.createElement(R,{actions:this.props.actions.filter((e=>"删除"===e.label))},E):null;if(!n)return i.createElement(F.Z,{height:"300px"});const f=d||URL.createObjectURL(m),y=d?(0,q.cR)(d,[q.iT.Watermark]):URL.createObjectURL(m);let b,k,C;return e&&(C=i.createElement("div",{className:"form_uploading"},i.createElement(s.Z,{icon:["gfas","spinner"],className:"fa-fw form_uploading_icon",pulse:!0}))),k=i.createElement("a",{href:y,target:"_blank",rel:"noopener noreferrer"},i.createElement(z,{src:f,size:[h,v],ossOptions:[[q.iT.Watermark],{resize:{w:h,m:"lfit"}}]})),r||(k=i.createElement(L.ZP,{height:v||500,offset:-200,scrollContainer:o},k)),b=i.createElement(H.Z,{labels:null==c?void 0:c.includes(d),withLabel:!0},i.createElement("div",{className:"story_image form_uploading_container"},C,k,t&&t.length>0&&i.createElement("div",{className:"story_caption"},t))),r&&(b=this.renderInEditor(b)),b}}W.propTypes={data:y().object.isRequired,actions:y().array.isRequired,editorEnabled:y().bool.isRequired,adminMode:y().bool.isRequired,imageAdvancedPosition:y().bool.isRequired,scrollContainer:y().string,onEntityDataChange:y().func.isRequired,censorImages:y().array,dispatch:y().func.isRequired},W.defaultProps={scrollContainer:void 0,censorImages:void 0};const j=(0,M.connect)()(W);var K=a(34282),J=a(13216);class Y extends K.Z{constructor(e){super(e),this.state={showModal:!1},this.handleConfirmEdit=this.handleConfirmEdit.bind(this)}handleConfirmEdit(e){const{onEntityDataChange:t}=this.props;t(e),this.setState({showModal:!1})}render(){const{editorEnabled:e,data:t,scrollContainer:a}=this.props,{caption:n,content:r}=t;let l,o;const c=(0,k.ZP)(r);if(o=c?c.isVideo?i.createElement("div",{className:"story_embed story_embed-video"},i.createElement("div",{className:"story_embed-video_inner"},i.createElement("div",{className:"story_embed-video_video"},(0,J.o)(c)))):i.createElement("div",{className:"story_embed"},(0,J.o)(c)):i.createElement("div",{className:"story_embed"},"不支持该嵌入控件"),l=i.createElement(i.Fragment,null,o,n&&n.length>0&&i.createElement("div",{className:"story_caption"},n)),e){const e=[{label:"编辑",customComponent:i.createElement("span",null,i.createElement(s.Z,{icon:["gfas","edit"]})),extraComponent:i.createElement(_,{onConfirmClick:this.handleConfirmEdit,close:()=>{this.setState({showModal:!1})},visible:this.state.showModal,data:t}),callback:()=>{this.setState({showModal:!0})}}];l=i.createElement(R,{actions:e.concat(this.props.actions)},l)}else l=i.createElement(L.ZP,{height:500,offset:-200,scrollContainer:a},l);return l}}Y.propTypes={data:y().object.isRequired,actions:y().array.isRequired,editorEnabled:y().bool.isRequired,onEntityDataChange:y().func.isRequired};const X=Y;var Q=a(35218),ee=a(20540),te=a(98658),ae=a(83432);class ne extends i.Component{constructor(e){super(e);const{title:t,image:a,type:n,url:r,info:l}=e.data;this.state={info:l,title:t,url:r,image:a,type:n},this.handleTitleChange=this.handleChange.bind(this,"title"),this.handleTypeChange=this.handleChange.bind(this,"type"),this.handleUrlChange=this.handleChange.bind(this,"url"),this.handleInfoChange=this.handleChange.bind(this,"info"),this.htmlForCreator=(0,q.FZ)()}close=()=>{this.props.close()};checkUrl=()=>{const{url:e}=this.state;return(0,te._N)(e)||(0,te.jK)(e)};handleChange(e,t){this.setState({[e]:t.target.value})}handleImageChange=e=>{this.setState({image:e})};handleConfirm=()=>{const{title:e,image:t,type:a}=this.state,n=!this.checkUrl(),r=(0,te.ke)(t)||n;"normal"===a&&(0,te.ke)(e)||r?alert(n?"请输入正确的地址":"请填入完整数据"):(this.close(),this.props.onConfirmClick(this.state))};render(){const{visible:e}=this.props,{title:t,url:a,image:n,type:r,info:l}=this.state;return i.createElement(b.Z,{className:"popBox",overlayClassName:"popBox_overlay",visible:e,title:"挂件编辑",onCloseClick:this.close,onConfirmClick:this.handleConfirm},i.createElement("div",{className:"form-group"},i.createElement("div",{className:"form-check"},i.createElement("input",{id:this.htmlForCreator("normal"),type:"radio",className:"form-check-input",name:"type",checked:"normal"===r,value:"normal",onChange:this.handleTypeChange}),i.createElement("label",{className:"form-check-label",htmlFor:this.htmlForCreator("normal")},"默认")),i.createElement("div",{className:"form-check"},i.createElement("input",{id:this.htmlForCreator("image"),type:"radio",className:"form-check-input",name:"type",checked:"image"===r,value:"image",onChange:this.handleTypeChange}),i.createElement("label",{className:"form-check-label",htmlFor:this.htmlForCreator("image")},"纯图片"))),"normal"===r&&i.createElement(i.Fragment,null,i.createElement("div",{className:"form-group"},i.createElement("input",{type:"text",className:"form-control",placeholder:"标题",value:t,onChange:this.handleTitleChange})),i.createElement("div",{className:"form-group"},i.createElement("input",{type:"text",className:"form-control",placeholder:"说明（可选）",value:l,onChange:this.handleInfoChange}))),i.createElement("div",{className:"form-group"},i.createElement("input",{type:"text",className:"form-control",placeholder:"网址",value:a,onChange:this.handleUrlChange})),i.createElement("div",{className:"form-group"},i.createElement(ae.Z,{image:n,onChange:this.handleImageChange,tip:"image"===r?"推荐尺寸 920 x 268":"推荐尺寸 160 x 160"})))}}ne.propTypes={visible:y().bool.isRequired,onConfirmClick:y().func.isRequired,close:y().func.isRequired,data:y().object},ne.defaultProps={data:{title:"",url:"",image:"",type:"normal"}};const re=ne;class le extends K.Z{constructor(e){super(e),this.state={showModal:!1}}handleConfirmEdit=e=>{const{onEntityDataChange:t}=this.props;t(e),this.setState({showModal:!1})};render(){const{editorEnabled:e,data:t}=this.props,{title:a,image:n,type:r,url:l,info:o}=t;let c,d;const m=(0,q.cR)(n,{resize:{w:120,h:120}});if("normal"===r?d=i.createElement(ee.Z,{className:"story_widget",title:a,image:m,url:l,info:o}):"image"===r&&(d=i.createElement(Q.Z,{to:l,className:"story_widgetImage",openNewWindow:!0},i.createElement("img",{src:m,alt:"外链挂件"}))),c=d,e){const e=[{label:"编辑",customComponent:i.createElement("span",null,i.createElement(s.Z,{icon:["gfas","edit"]})),extraComponent:i.createElement(re,{onConfirmClick:this.handleConfirmEdit,close:()=>{this.setState({showModal:!1})},visible:this.state.showModal,data:t}),callback:()=>{this.setState({showModal:!0})}}];c=i.createElement(R,{actions:e.concat(this.props.actions)},c)}return c}}le.propTypes={data:y().object.isRequired,actions:y().array.isRequired,editorEnabled:y().bool.isRequired,onEntityDataChange:y().func.isRequired};const ie=le;class se extends i.PureComponent{constructor(e){super(e),this.shouldShowSpoiler=!!e.enabled&&e.hasSpoiler}handleSpoilerClick=e=>{let t=e.target.closest(".story_block-spoiler");for(;t&&t.className.includes("story_block-spoiler");)t.classList.remove("story_block-spoiler"),t=t.nextElementSibling};render(){const{children:e}=this.props;return i.createElement(i.Fragment,null,this.shouldShowSpoiler&&i.createElement("div",{className:"story_hidden",role:"button",tabIndex:"-1",onClick:this.handleSpoilerClick},i.createElement(s.Z,{icon:["gfas","eye-slash"]}),i.createElement("p",null,"内容因剧透、敏感不适等原因被隐藏"),i.createElement("strong",null,"点击查看")),e)}}se.propTypes={children:y().oneOfType([y().element,y().array,y().string]).isRequired,hasSpoiler:y().bool,enabled:y().bool},se.defaultProps={hasSpoiler:!1,enabled:!0};const oe=se,ce={block:y().shape({getData:y().func,getEntityAt:y().func}).isRequired,blockProps:y().shape({components:y().object.isRequired,getEditorState:y().func.isRequired,setEditorState:y().func.isRequired,editorEnabled:y().bool,adminMode:y().bool,onChangeEditorState:y().func,imageAdvancedPosition:y().bool,scrollContainer:y().string}).isRequired};class de extends K.Z{constructor(e){super(e),this.state={focus:!1},this.hasSpoiler=e.block.getData().get("spoiler"),this.handleSpoilerChange=this.handleSpoilerChange.bind(this),this.handleEditEntity=this.handleEditEntity.bind(this)}componentDidMount(){this.props.blockProps.editorEnabled&&window.document.body.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){this.props.blockProps.editorEnabled&&window.document.body.removeEventListener("keydown",this.handleKeyDown)}getEntity(){const{block:e,blockProps:t}=this.props,a=e.getEntityAt(0);return a?t.getEditorState().getCurrentContent().getEntity(a):null}setSelection(){const{blockProps:e,block:t}=this.props,a=t.getKey(),n=e.getEditorState(),l=new r.SelectionState({anchorKey:a,anchorOffset:0,focusKey:a,focusOffset:0}),i=r.EditorState.acceptSelection(n,l);e.setEditorState(i)}handleEditEntity(e){const{block:t,blockProps:a}=this.props,n=t.getEntityAt(0),r=a.getEditorState(),l=r.getCurrentContent().mergeEntityData(n,e),i=g(r,l,a.setEditorState);a.onChangeEditorState(i,(()=>{}),!0)}handleDelClick=()=>{const{blockProps:e,block:t}=this.props,a=e.getEditorState(),n=t.getKey();e.setEditorState(E(a,n))};handleFocus=()=>{this.setState({focus:!0}),setTimeout((()=>{this.setSelection()}),300)};handleBlur=()=>{this.setState({focus:!1})};handleKeyDown=e=>{if(13===e.which&&this.state.focus){const{blockProps:t,block:a}=this.props,n=a.getKey(),r=t.getEditorState(),l=h(r,n);t.setEditorState(l),e.preventDefault(),e.stopPropagation()}};handleSpoilerChange(){const{blockProps:e,block:t}=this.props,a=e.getEditorState(),n=a.getCurrentContent(),l=r.SelectionState.createEmpty(t.getKey()),i=r.Modifier.setBlockData(n,l,{spoiler:!t.getData().get("spoiler")});g(a,i,e.setEditorState)}render(){const{blockProps:e,block:t}=this.props,a=this.getEntity();if(!a)return i.createElement("span",null,"Error: Unsupported Atomic Block，请用退格键删除此行");const r=a.getData(),l=a.getType().toLowerCase(),o=e.components[l];if(!o)return i.createElement("p",null,"Block of type ",i.createElement("b",null,l)," is not supported.");const c=[{label:"剧透",customComponent:i.createElement("span",{className:t.getData().get("spoiler")?"active":"",title:"防剧透"},i.createElement(s.Z,{icon:["gfas","spoiler"]})),callback:this.handleSpoilerChange},{label:"删除",customComponent:i.createElement(s.Z,{icon:["gfas","times-circle"]}),callback:this.handleDelClick}],d=i.createElement(oe,{hasSpoiler:this.hasSpoiler,enabled:!e.editorEnabled},i.createElement(o,(0,n.Z)({data:r,editorEnabled:e.editorEnabled,adminMode:e.adminMode,actions:c,censorImages:e.censorImages,onEntityDataChange:this.handleEditEntity},l===m?{imageAdvancedPosition:e.imageAdvancedPosition,scrollContainer:e.scrollContainer}:{})));return e.editorEnabled?i.createElement("div",{onFocus:this.handleFocus,onBlur:this.handleBlur,role:"button",tabIndex:"0",style:this.state.focus?{outline:"2px solid red"}:void 0},d):d}}de.propTypes=ce;const me=de,ue=e=>{const{block:t,blockProps:a}=e,n=t.getType(),l=/^header-/.test(n)?t.getKey():void 0,s=i.createElement(r.EditorBlock,e);return i.createElement(oe,{hasSpoiler:!!t.getData().get("spoiler"),enabled:!a.editorEnabled},l?i.createElement("div",{id:`nopop_${l}`},s):s)};function pe(e){return i.createElement("button",{className:"md-sb-button",type:"button",title:"添加嵌入代码",onClick:e.onOpenModal},i.createElement(s.Z,{icon:["gfas","code"]}))}function ge(e){return i.createElement("button",{className:"md-sb-button",type:"button",title:"添加图库",onClick:e.onOpenModal},i.createElement(s.Z,{icon:["gfas","image-gallery"]}))}pe.propTypes={onOpenModal:y().func.isRequired},ge.propTypes={onOpenModal:y().func.isRequired};class he extends l.DT{onChange(e){const{files:t}=e.target,a=(0,O.ox)(t,{limitFilesNum:20});if(this.props.close(),a.errors)return void alert(a.errorsStr);let n=this.props.getEditorState();a.files.forEach((e=>{n=v(n,m,{file:e},{appendNewBlock:!0})})),this.props.setEditorState(n)}render(){return i.createElement("button",{className:"md-sb-button",type:"button",onClick:this.onClick,title:"添加图片"},i.createElement(s.Z,{icon:["gfac","image"]}),i.createElement("input",{type:"file",multiple:!0,ref:e=>{this.input=e},onChange:this.onChange,style:{display:"none"}}))}}const ve=he,Ee=(0,c.Map)({"spoiler-text":{element:"div"}}).merge(l.uL),fe=[{label:i.createElement(s.Z,{icon:["gfas","title"]}),style:"header-one",description:"标题"},{label:i.createElement(s.Z,{icon:["gfas","quote-right"]}),style:"blockquote",description:"引用"},{label:i.createElement(s.Z,{icon:["gfas","list-ul"]}),style:"unordered-list-item",description:"无序列表"},{label:i.createElement(s.Z,{icon:["gfas","list-ol"]}),style:"ordered-list-item",description:"有序列表"}],ye=[{label:i.createElement(s.Z,{icon:["gfas","spoiler"]}),dataKey:"spoiler",dataValue:!0,description:"防剧透"},{label:i.createElement(s.Z,{icon:["gfas","align-left"]}),dataKey:"align",dataValue:"left",description:"居左"},{label:i.createElement(s.Z,{icon:["gfas","align-center"]}),dataKey:"align",dataValue:"center",description:"居中"},{label:i.createElement(s.Z,{icon:["gfas","align-right"]}),dataKey:"align",dataValue:"right",description:"居右"}],be=[{label:i.createElement(s.Z,{icon:["gfas","bold"]}),style:"BOLD",description:"粗体"},{label:"I",style:"ITALIC",description:"斜体"},{label:i.createElement(s.Z,{icon:["gfas","link"]}),style:"hyperlink",description:"链接"},{label:i.createElement(s.Z,{icon:["gfas","spoiler"]}),style:"spoiler",description:"防剧透"}];function ke(e){return i.createElement("button",{className:"md-sb-button",type:"button",title:"添加挂件",onClick:e.onOpenModal},i.createElement(s.Z,{icon:["gfas","widget"]}))}ke.propTypes={onOpenModal:y().func.isRequired};var Ce=a(5885),_e=a(71395);const we=e=>JSON.stringify((0,r.convertToRaw)(e)),Ne=function(e){let t,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[_e.e];const i=new r.CompositeDecorator(n);try{a=e?JSON.parse(e):null,t=(0,l.l8)(a,i)}catch(e){0,t=(0,l.l8)(null,i)}return{editorState:t,json:a}};class Pe extends i.PureComponent{static defaultProps={editorEnabled:!0,adminMode:!1,imageAdvancedPosition:!1,galleryAdvanced:!0,widgetAdvanced:!0};state={enableInEditing:!0,newEmbedModalVisible:!1,newGalleryModalVisible:!1,newWidgetModalVisible:!1};render(){const{editorEnabled:e,editorState:t,adminMode:a,galleryAdvanced:r,widgetAdvanced:c,...d}=this.props,{enableInEditing:m,newEmbedModalVisible:u,newWidgetModalVisible:p,newGalleryModalVisible:g}=this.state,h=[{title:"Image",component:ve},{title:"Embed",component:this.NewEmbedModal}];return r&&h.push({title:"Gallery",component:this.NewGalleryModal}),c&&h.push({title:"Widget",component:this.NewWidgetModal}),i.createElement(Ce.Z.Provider,{value:this.contextFuncs},u&&i.createElement(_,{onConfirmClick:this.handleConfirmNewEmbedModalEdit,close:this.handleEmbedModalHide,visible:u}),g&&i.createElement(w.Z,{onConfirmClick:this.handleConfirmNewGalleryModalEdit,close:this.handleGalleryModalHide,visible:g}),p&&i.createElement(re,{onConfirmClick:this.handleConfirmNewWidgetModalEdit,close:this.handleWidgetModalHide,visible:p}),i.createElement("div",{className:(0,o.Z)("story",e?"story-editor":"story-show")},i.createElement(l.ML,(0,n.Z)({},d,{placeholder:e?d.placeholder||"在这里输入内容...":"",editorState:t,blockButtons:fe,inlineButtons:be,blockDataButtons:ye,blockRenderMap:Ee,blockStyleFn:this.blockStyleFn,editorEnabled:m&&e,onChange:this.handleChange,rendererFn:this.rendererFn,sideButtons:h,addButtonIcon:i.createElement(s.Z,{icon:["gfas","plus"]})})),i.createElement("div",{className:"clearfix"})))}contextFuncs={enableEditor:()=>{this.setState({enableInEditing:!0})},disableEditor:()=>{this.setState({enableInEditing:!1})}};blockStyleFn=(e=>t=>{const{editorEnabled:a,censorLabels:n,editorState:r,editedBlocks:i}=e();if(!a&&""===P()(t.getText()))return`${Z}-empty d-none`;const s=t.getKey(),o=(null==n?void 0:n.texts[s])&&!(null!=i&&i.includes(s)),c=t.getData();let d=Z;switch(c.get("spoiler")&&(d=`${d} ${Z}-spoiler`),c.get("align")&&(d=`${d} ${Z}-align-${c.get("align")}`),o&&(d=`${d} story_censor`),t.getType()){case l.gO.TODO:case l.gO.IMAGE:case l.gO.BLOCKQUOTE_CAPTION:case l.gO.CAPTION:return`${S} ${S}-caption`;case l.gO.BLOCKQUOTE:return`${d} ${Z}-quote`;case l.gO.UNSTYLED:{const e=t.getText(),a=e&&e.length>0?"":`${Z}-text-empty`;return`${d} ${Z}-text ${a}`}case l.gO.ATOMIC:{const e=t.getEntityAt(0);let a=`${d} ${Z}-atomic`;if(!e)return a;const n=r.getCurrentContent().getEntity(e),l=n.getData(),i=n.getType().toLowerCase();return a=`${a} ${Z}-atomic-${i}`,i===m&&(a=`${a} ${Z}-atomic-image-${l.pos||"normal"}`),a}default:return d}})((()=>this.props));NewEmbedModal=function(e){return function(t){return i.createElement(pe,(0,n.Z)({onOpenModal:e},t))}}((()=>{this.setState({newEmbedModalVisible:!0})}));NewGalleryModal=function(e){return function(t){return i.createElement(ge,(0,n.Z)({onOpenModal:e},t))}}((()=>{this.setState({newGalleryModalVisible:!0})}));NewWidgetModal=function(e){return function(t){return i.createElement(ke,(0,n.Z)({onOpenModal:e},t))}}((()=>{this.setState({newWidgetModalVisible:!0})}));handleEmbedModalHide=()=>{this.setState({newEmbedModalVisible:!1})};handleGalleryModalHide=()=>{this.setState({newGalleryModalVisible:!1})};handleWidgetModalHide=()=>{this.setState({newWidgetModalVisible:!1})};handleConfirmModalEdit(e,t){return a=>{const{editorState:n}=this.props;this.setState({[e]:!1}),this.handleChange(v(n,t,a))}}handleConfirmNewEmbedModalEdit=this.handleConfirmModalEdit("newEmbedModalVisible",u);handleConfirmNewGalleryModalEdit=this.handleConfirmModalEdit("newGalleryModalVisible",d);handleConfirmNewWidgetModalEdit=this.handleConfirmModalEdit("newWidgetModalVisible",p);handleChange=(e,t,a)=>{this.props.onChange(e,t,a)};rendererFn=((e,t)=>{let{editorEnabled:a,adminMode:n,imageAdvancedPosition:r,scrollContainer:i,censorLabels:s}=e;return(e,o)=>c=>{if(c.getType()===l.gO.ATOMIC){return{component:me,editable:!1,props:{components:{[d]:x,[m]:j,[u]:X,[p]:ie},setEditorState:e,getEditorState:o,editorEnabled:a,adminMode:n,onChangeEditorState:t,imageAdvancedPosition:r,scrollContainer:i,censorImages:null==s?void 0:s.images}}}return{component:ue,props:{editorEnabled:a}}}})(this.props,this.handleChange)}const Se=Pe},71395:(e,t,a)=>{a.d(t,{e:()=>s});var n=a(1190),r=a(67294),l=a(35218);const i=e=>{let{contentState:t,entityKey:a,children:n}=e;const{url:i}=t.getEntity(a).getData();return r.createElement(l.Z,{className:"md-link",href:i},n)},s={strategy:n.mg,component:i}},94479:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(73925),i=a(89307),s=a(45648),o=a(2186);const c=e=>{const{content:t,original:a,editorKey:c,...d}=e,m=(0,r.useRef)(!1),{pageName:u}=(0,s.EY)(),{editorState:p}=(0,i._s)(t);return p?r.createElement(l.Z,{inWindow:!0,bottomOffset:1e3,onScrollToBottom:()=>{m.current||a&&((0,o.gS)(a,u),m.current=!0)}},r.createElement(i.ZP,(0,n.Z)({editorState:p,editorEnabled:!1,onChange:()=>{},editorKey:c||(null==a?void 0:a.getKey())},d))):r.createElement("div",null,"内容为空")}},31636:(e,t,a)=>{a.d(t,{Z:()=>de});var n=a(67294),r=a(50533),l=a(44956),i=a(70315),s=a(26707),o=a(91433),c=a(85551),d=a(59310),m=a(85846),u=a(74612),p=a(35018),g=a(35218),h=a(47042),v=a(22222),E=a(33529),f=a(1145),y=a(85896),b=a(13214),k=a(83476),C=a(30588);const _=e=>n.createElement(C.Z,{users:e}),w=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.getIn(["data","voters",t.votableType,t.votableId,...a])},N=(0,v.P1)(((e,t)=>w(e,t,["ids"])),d.LF,((e,t)=>(0,f.BY)(e,t))),P={dispatchGetVoters:b.Z.actions.getVoters},S=(0,r.connect)(((e,t)=>({voters:N(e,t),votersState:w(e,t)})),P)((e=>{let{votableType:t,votableId:a,voters:r,votersState:l,onClose:i,dispatchGetVoters:s}=e;const o=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];await s(t,a,e?1:((null==l?void 0:l.get("currentPage"))??0)+1)}),[s,l,a,t]),c=(0,y.II)(o),d=(0,n.useCallback)((async()=>{await c.current(!0)}),[c]);return n.createElement(E.Z,{visible:!0,title:"喜欢的用户",hideActionBtns:!0,onCloseClick:i,overlayClassName:"e_voters"},n.createElement(k.Z,{data:r,state:l,onLoad:o,onInit:d,scrollableProps:{container:".e_voters"}},_))}));var Z=a(78989),I=a(45648),T=a(23274),A=a(6379),R=a(52279),D=a(80675),x=a(80115);var M=a(45236),L=a(43170),q=a(65471),F=a(73126),B=a(66688),O=a(69951),U=a(23736);const $="banForm",G={dispatchBan:T.QT0},z=(0,r.connect)(((e,t)=>({})),G)((e=>{let{user:t,dispatchBan:a,onConfirmClick:r,...l}=e;const{sendPopMessage:i}=(0,I.EY)(),s=()=>{(0,O.Ps)($)};return n.createElement(B.l0,{onSubmit:e=>{let{days:n,reason:l}=e;i({body:-1===n?"是否永久禁言该用户？":`是否禁言用户 ${n} 天`,modalProps:{confirmBtnText:"禁言",confirmBtnProps:{type:"danger"},onConfirmClick:async()=>{const e=-1===n?-1:24*n*60*60;await a(t.get("id"),{reason:l,seconds:e}),null==r||r()}}})},initialValues:{days:1}},(e=>{let{handleSubmit:a,valid:r}=e;return n.createElement(E.Z,(0,F.Z)({title:`禁言用户 ${t.getAttr("nickname")}`,titleBar:!0},l,{onConfirmClick:s,confirmBtnText:"提交",confirmBtnProps:{disabled:!r},shouldConfirmOnPressEnter:!1}),n.createElement("form",{id:$,onSubmit:a},n.createElement(B.gN,(0,F.Z)({name:"reason",componentType:"textarea",placeholder:"请填写禁言理由，将以私信形式发送给被禁言用户，请谨慎填写"},(0,U.Cr)()),O.CF),n.createElement(O.AS,{label:"选择禁言时长",name:"days",options:[{label:"1 天",value:1},{label:"3 天",value:3},{label:"7 天",value:7},{label:"永久",value:-1}],inputProps:{parse:e=>Number(e)}})))}))}));var H=a(65634),V=a(82285);const W=e=>{let{talk:t,currentUser:a,showPortfolioOptions:l}=e;const{sendPopMessage:i}=(0,I.EY)(),s=t.getRel([["portfolios",0]]),c=t.getRel("user","id")===(null==a?void 0:a.get("id")),{next:d,close:m}=(0,q.VG)(),u=(0,y.l1)(m),p=(0,r.useDispatch)(),[g,h]=(0,n.useState)(!1),{report:v,modal:E}=(0,L.n)({reportableType:t.get("type"),reportableId:t.get("id"),reportableUserId:t.getRel("user","id"),onConfirm:u}),{isBookmarked:f,bookmark:b}=(0,A.BW)(t,{currentUserId:null==a?void 0:a.get("id"),portfolioId:null==s?void 0:s.get("id")});return n.createElement(n.Fragment,null,n.createElement(H.Z,{visible:g,onCloseClick:()=>{h(!1)},data:t}),E,n.createElement(M.Z,{options:[...null!=a&&a.isStaff()?[{title:"运营管理",onClick:()=>{d("staff")}}]:[],{title:"分享",onClick:()=>{h(!0)}},...c&&l?[{title:"移出",danger:!0,onClick:()=>{d("portfolio")}}]:[],{title:"不感兴趣",onClick:()=>{d("block")}},{title:f?"取消收藏":"收藏",onClick:async()=>{await b(),m()}},{title:"举报",danger:!0,onClick:()=>{v()}},...c?[{title:"编辑文本",onClick:()=>{V.ZP.push((0,o.ZP)("topicEditor",{talk_id:t.get("id")})),m()}},{title:"删除",danger:!0,onClick:()=>{i({body:"确认删除？",modalProps:{confirmBtnProps:{type:"danger"},onConfirmClick:async()=>{await p((0,T.$R0)(t.get("id"))),m()}}})}}]:[],{title:"取消",requestClose:!0}]}))},j=e=>{let{talk:t}=e;const a=(0,r.useDispatch)(),{close:l}=(0,q.VG)(),{lock:i,modal:s}=(e=>{const t=(0,r.useDispatch)(),[a,l]=(0,n.useState)(!1),i=(0,x.a)("talks");return{modal:n.createElement(R.Z,{visible:a,options:i,desc:"选择违规理由",onCloseClick:()=>{l(!1)},onChoose:a=>{t((0,D.dJn)(e.get("id"),a)),l(!1)}}),lock:()=>{l(!0)}}})(t),{isSelected:o,toggleSelect:c}=(e=>{const t=e.getAttr("is-editor-selected"),a=(0,r.useDispatch)();return{isSelected:t,toggleSelect:async()=>{t?await a((0,T.Bwi)(e.get("id"))):await a((0,T.uSr)(e.get("id")))}}})(t),{isRecommended:d,toggleRecommend:m}=(e=>{const t=e.getAttr("is-recommended"),a=(0,r.useDispatch)();return{isRecommended:t,toggleRecommend:async()=>{t?await a((0,T.x_x)(e.get("id"))):await a((0,T.Zl8)(e.get("id")))}}})(t),[u,p]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,n.createElement(z,{user:t.getRel("user"),visible:u,onCloseClick:()=>{p(!1)},onConfirmClick:()=>{p(!1),l()}}),s,n.createElement(M.Z,{options:[{title:"禁言",onClick:()=>{p(!0)}},{title:"删除帖子",onClick:()=>{i()}},{title:o?"取消标记精选":"标记精选",onClick:async()=>{await c(),l()}},{title:d?"取消推送首页":"推送首页",onClick:async()=>{await m(),l()}},{title:"折叠帖子",onClick:async()=>{await a((0,T.wCu)(t.get("id"))),l()}},{title:"取消",requestClose:!0}]}))},K=e=>{let{talk:t,currentUser:a,hideTopicBlockOption:r}=e;const{close:l}=(0,q.VG)(),{isBlocked:i,block:s}=(0,A.rL)(t.getRel("topic"),{currentUserId:null==a?void 0:a.get("id")}),{isBlocked:o,block:c}=(0,A.rL)(t.getRel("user"),{currentUserId:null==a?void 0:a.get("id")});return n.createElement(M.Z,{options:[{title:o?"取消不想看此用户内容":"不想看此用户内容",onClick:async()=>{await c(),l()}},...r?[]:[{title:i?"取消不想看此小组内容":"不想看此小组内容",onClick:async()=>{await s(),l()}}],{title:"取消",requestClose:!0}]})},J=e=>{let{talk:t,showPortfolioOptions:a,hideTopicBlockOption:r,currentUser:l,onClose:i,onRemoveFromPortfolio:s}=e;const o={index:()=>n.createElement(W,{talk:t,currentUser:l,showPortfolioOptions:a}),portfolio:()=>n.createElement(Z.Z,{work:t,onSuccess:()=>{null==s||s(t.get("id")),i()}}),staff:()=>n.createElement(j,{talk:t}),block:()=>n.createElement(K,{talk:t,currentUser:l,hideTopicBlockOption:r})};return n.createElement(q.ZP,{steps:o,initialStep:"index",onClose:i,modalProps:{simple:!0,width:"auto"}})};var Y=a(22134),X=a(80239),Q=a(14810),ee=a(81765);const te=e=>{let{talk:t,entry:a,hideEntry:l}=e;const i=(0,r.useDispatch)(),s=t.getRel("helpful"),o=s&&"helpful"===s.getAttr("status"),c=(0,r.useSelector)(ee.dM),u=(0,r.useSelector)(d.ib),g=c.some((e=>e.get("id")===a.get("id"))),[h,v]=(0,n.useState)(!1),[E,f]=(0,n.useState)(!1),y=async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(E||!u)return;f(!0);(await i((0,Q.D1)(s?`helpfuls/${s.get("id")}`:"helpfuls",{method:s?"PATCH":"POST",body:{data:{type:"helpfuls",...s?{id:s.get("id")}:{},attributes:{status:e?"helpful":"cancel",...e?{thumb:u.getAttr("thumb")}:{}},...s?{}:{relationships:{user:{data:{type:"users",id:u.get("id")}},helpfulable:{data:t.toUnique()}}}}}}))).error||await i((0,Q.D1)(`${t.get("type")}/${t.get("id")}`,{include:["helpful"]})),f(!1)},b=o||g?n.createElement(n.Fragment,null,n.createElement(M.Z,{options:[{title:"取消此操作",danger:!0,onClick:()=>{y(!1),v(!1)}},{title:"取消",requestClose:!0}],visible:h,onClose:()=>{v(!1)}}),n.createElement("div",{className:"devInteraction"},n.createElement("p",null,o?n.createElement(n.Fragment,null,s.getAttr("thumb")&&n.createElement("img",{src:(0,X.cR)(s.getAttr("thumb"),{resize:{w:24,h:24,m:"fill"}})}),n.createElement("strong",null,"游戏制作者"),n.createElement("span",null,"认为有帮助")):"认为建议有帮助时可以告知对方"),g?o?n.createElement(m.Z,{plain:!0,className:"o_moreIcon",onClick:()=>{v(!0)}},n.createElement(p.Z,{icon:["gfas","more"]})):n.createElement(m.Z,{loading:E,plain:!0,className:"devInteraction_helpBtn",onClick:()=>{y()}},"有帮助"):null)):null;return!l&&b?n.createElement("div",{className:"devInteractionContainerWithEntry"},n.createElement(Y.Z,{item:a}),b):b||(l?null:n.createElement(Y.Z,{item:a}))},ae=e=>{let{talk:t,repost:a,hide:r}=e;return a?a.getAttr("allow-helpful")?n.createElement(te,{talk:t,entry:a,hideEntry:r}):r?null:n.createElement(Y.Z,{item:a}):null};var ne=a(16684),re=a(11860),le=a.n(re),ie=a(54186),se=a(6143);const oe=n.memo((e=>{let{talk:t}=e;const a=t.get("id"),r=t.getAttr("spoiler"),l=t.getAttr("content"),{gallery:i,paragraphs:s}=(0,n.useMemo)((()=>(e=>({gallery:(0,X.N5)(e),paragraphs:(0,X.KO)(e)}))(l)),[l]),[o,c]=(0,n.useState)(!0===r&&"pending");return(0,n.useEffect)((()=>{if("pending"!==o)return;const e=le()(ie.default.storage_keys.spoilerUnblockedTalkIds);c(!e||!e.includes(a))}),[o,a]),n.createElement(n.Fragment,null,i.length>0&&n.createElement(ne.Z,{images:i,className:"talk_gallery",spoiler:o,onSpoilerChange:e=>{c(e);const t=le()(ie.default.storage_keys.spoilerUnblockedTalkIds)||[];t.push(a),le()(ie.default.storage_keys.spoilerUnblockedTalkIds,t)}}),n.createElement("div",{className:"talk_paragraphs"},s.map(((e,a)=>n.createElement("p",{key:a},(0,se.Te)(e,t.getTagData()))))))})),ce=e=>{let{actor:t,talk:a,showPortfolioOptions:r,hideTopicBlockOption:i,currentUser:d,onRemoveFromPortfolio:m,promotion:u,hideMore:h}=e;const[v,E]=(0,n.useState)(!1);return n.createElement(n.Fragment,null,v&&n.createElement(J,{talk:a,showPortfolioOptions:r,currentUser:d,onRemoveFromPortfolio:m,hideTopicBlockOption:i,onClose:()=>{E(!1)}}),n.createElement("div",{className:"talk_head"},n.createElement(g.Z,{to:(0,o.bv)(t.get("type"),t.get("id"))},n.createElement(s.Z,{className:"talk_author",users:t,size:"sm",subText:u?"":(0,c.Sy)(a.getAttr("published-at"))})),!h&&n.createElement(l.Z,{plain:!0,onClick:()=>{E(!0)},className:u?"talk_labelMore":"o_moreIcon"},u?"推荐":n.createElement(p.Z,{icon:["gfas","more"]}))))},de=(0,r.connect)(((e,t)=>({currentUser:(0,d.ib)(e)})))((e=>{var t;let{talk:a,promotion:r,actor:l,showPortfolioOptions:s,hideTopicBlockOption:c,hideRepost:d,currentUser:p,hideHeadMore:v,onRemoveFromPortfolio:E}=e;const[f,y]=(0,n.useState)(!1),b=a.getAttr("likes-count"),k=a.getRel("user"),C=a.getRel("topic"),_=a.getRepost(),w=a.getAttr("entry-is-official")&&"games"===(null==_?void 0:_.get("type")),N=a.getRel([["portfolios",0]],"id");return n.createElement("div",{className:"talk"},f&&n.createElement(S,{votableType:a.get("type"),votableId:a.get("id"),onClose:()=>{y(!1)}}),n.createElement(ce,{actor:w?_:l||k,talk:a,promotion:r,showPortfolioOptions:s,currentUser:p,onRemoveFromPortfolio:E,hideTopicBlockOption:c,hideMore:v}),a.getAttr("work-is-protected")&&n.createElement(h.Z,null),(null===(t=a.getRel("poll-options"))||void 0===t?void 0:t.size)>0&&n.createElement("div",{className:"polledOption"},n.createElement("span",null,"📊 ",a.getRelAttr([["poll-options",0]],"title"))),n.createElement(oe,{talk:a}),n.createElement(ae,{talk:a,repost:_,hide:d}),n.createElement("div",{className:"talk_topic"},C&&n.createElement(g.Z,{to:(0,o.ZP)("topic",{id:C.get("id")})},n.createElement(i.Z,{tagStyle:!0,tagStyleNoBg:!0},C.getAttr("title"))),b>=0&&n.createElement(m.Z,{plain:!0,className:"talk_likes",disabled:0===b,onClick:()=>{y(!0)}},b," 喜欢")),n.createElement("div",{className:"talk_actions"},a.get("id")&&n.createElement(u.Z,{item:a,portfolioId:N})))}))},18909:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(67294),r=a(47467),l=a(91433),i=a(52004),s=a(71405),o=a(26707),c=a(85846);const d=e=>{let{user:t,onSelect:a,selectText:d="选择",selectType:m="info",selectActive:u=!1,className:p}=e;return n.createElement("div",{className:(0,i.Z)("d-flex justify-content-between align-items-center py-3",p),key:t.getKey()},n.createElement(o.Z,{users:t,size:"md",to:(0,l.ZP)("user",{id:t.get("id")}),subText:(0,s.io)(t.getAttr("intro"),15)}),a?n.createElement(c.Z,{type:m,onClick:()=>{a(t)},className:u?"is_active":void 0},d):n.createElement(r.Z,{followee:t,type:m,className:"p_userItemFollowButton"}))}},30588:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),r=a(18909);const l=e=>{let{users:t,onSelect:a,selectType:l,selectText:i="选择"}=e;return n.createElement("div",null,t.map((e=>n.createElement(r.Z,{key:e.getKey(),user:e,onSelect:a,selectText:i,selectType:l}))))}},20540:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(98658),l=a(52004),i=a(35218),s=a(35018);const o=e=>{let{title:t,image:a,url:o,info:c,className:d}=e;return n.createElement(i.Z,{to:o,className:(0,l.Z)("widget",d),openNewWindow:!0},n.createElement("div",{className:"widget_image",style:{backgroundImage:`url(${a})`}}),n.createElement("div",{className:"widget_title"},n.createElement("h3",null,t),n.createElement("p",null,(0,r.ke)(c)?"查看详情":c)),n.createElement("div",{className:"widget_arrow"},n.createElement(s.Z,{icon:["gfas","angle-right"]})))}},14018:(e,t,a)=>{a.d(t,{Z:()=>m});var n=a(67294),r=a(50533),l=a(85846),i=a(35018),s=a(52004),o=a(59310),c=a(6379);const d=n.memo((e=>{const{className:t,hideCount:a,hideZeroCount:r,zeroText:o,bookmarkable:d,currentUser:m,portfolioId:u,children:p}=e,{bookmark:g,bookmarksCount:h,bookmarkId:v}=(0,c.BW)(d,{currentUserId:null==m?void 0:m.get("id"),portfolioId:u}),E=(0,n.useMemo)((()=>p?"function"==typeof p?p(h):p:null),[p,h]);return n.createElement(l.Z,{onClick:g,className:(0,s.Z)("o_bookmark",t,{is_active:v}),anchor:!0,plain:!0},E||n.createElement(i.Z,{className:"o_bookmark_icon",icon:["gfas","bookmark"]}),!a&&(!r||h>0)&&n.createElement("span",{className:"o_bookmark_num"},h<=0?o||0:h))})),m=(0,r.connect)(((e,t)=>({currentUser:(0,o.ib)(e)})))(d)},47467:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(73126),r=a(67294),l=a(50533),i=a(85846),s=a(34282),o=a(45648),c=a(52004),d=a(23274),m=a(2186);class u extends s.Z{static defaultProps={eachOther:!0};isRequesting;constructor(e){super(e),this.isRequesting=!1}render(){const{className:e,followee:t,dispatch:a,session:l,eachOther:s,text:o,...d}=this.props,m={follow:"关注",unfollow:"已关注",each:"互相关注",...o},u=!!t.getMeta("followship-id"),p=!!t.getMeta("inverse-followship-id");return r.createElement(i.Z,(0,n.Z)({onClick:this.handleClick,className:(0,c.Z)(e,{is_active:u,is_each:p&&u})},d),u?s&&p?m.each:m.unfollow:m.follow)}handleClick=()=>{if(this.isRequesting)return;this.isRequesting=!0;const{followee:e,session:t,dispatch:a}=this.props,n=t.get("userID");if(!n)return void a((0,d.CcW)());const r=!!e.getMeta("followship-id"),l=[n,e.get("id")];a(r?(0,d.F6_)(...l):(0,d.P_k)(...l)).then((()=>{this.isRequesting=!1,r||(0,m.tP)(e.get("id"),this.context.pageName)}))}}u.contextType=o.qe;const p=(0,l.connect)((e=>({session:e.get("session")})))(u)},18387:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(73126),r=a(67294),l=a(19931),i=a(72753),s=a(85896);const o=e=>{let{image:t,onChange:a,...o}=e;const c=(0,s.$0)("image-uploader"),[d,m]=(0,r.useState)(!1),u=(0,s.II)(a);return(0,r.useEffect)((()=>{const e=e=>{var t;if(null==e||null===(t=e.data)||void 0===t||!t.data)return;const{data:a}=e.data;a.key===c&&("uploading"===a.state?m(!0):"uploaded"!==a.state&&"error"!==a.state||(m(!1),u.current("uploaded"===a.state?a.path:null)))};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}}),[c,u]),r.createElement(l.Z,(0,n.Z)({forGcoresApp:!0,image:t,onUpload:()=>{(0,i.pj)("upload-image",{key:c,maxSelectedAssets:1})},onRemove:()=>{a(null)},isRequesting:d,initialFileUploaded:!0},o))}},19931:(e,t,a)=>{a.d(t,{Z:()=>d});var n=a(73126),r=a(52004),l=a(67294),i=a(80239),s=a(35018),o=a(85846),c=a(20525);const d=e=>{let{image:t,tip:a="点击上传图片",hideDeleteButton:d,hideUpdateButton:m,className:u,isRequesting:p,initialFileUploaded:g,onUpload:h,onRemove:v,forGcoresApp:E=!1}=e;const f=!t&&g,y=(!d||!m)&&!f,b=!E,k=e=>{p||h(e)},C=()=>{p||b||h()},_=()=>y?l.createElement("div",{className:"imageUploader_actions"},!d&&l.createElement(o.Z,{plain:!0,anchor:!0,onClick:()=>{v()},className:"imageUploader_action"},l.createElement(s.Z,{icon:["gfas","times"]})),!m&&l.createElement("div",{className:"imageUploader_action form_fileBlock",onClick:C},l.createElement(s.Z,{icon:["gfas","replace"]}),b&&l.createElement("input",{key:t,type:"file",onChange:k}))):null,w={className:(0,r.Z)("imageUploader form_fileBlock",u),style:t?{backgroundImage:`url(${(0,i.cR)(t)})`}:{}};return b?l.createElement(c.Z,{loading:p,height:"auto"},l.createElement("div",w,f?a:null,y?_():l.createElement("input",{key:t,type:"file",onChange:k}))):l.createElement(c.Z,{loading:p,height:"auto"},l.createElement(o.Z,(0,n.Z)({plain:!0,anchor:!0},w,y?{div:!0}:{onClick:C}),f?a:null,y&&_()))}},83432:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(67294),r=a(72753),l=a(18387),i=a(12870),s=a(19931);const o=(0,i.Z)(s.Z),c=e=>{const t=(0,r.nO)();return void 0===t?null:t?n.createElement(l.Z,e):n.createElement(o,e)}},52279:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(73126),r=a(67294),l=a(33529),i=a(85896);const s=e=>{var t;let{options:a,onChoose:s,...o}=e;const c=(0,i.MB)(),[d,m]=(0,r.useState)(null===(t=a[0])||void 0===t?void 0:t.value);return r.createElement(l.Z,(0,n.Z)({},o,{contentLabel:"Modal",onConfirmClick:()=>{s(d)}}),r.createElement("fieldset",{className:"form-group"},a.map((e=>{const t=e.value,a=c(t);return r.createElement("div",{className:"form-check",key:t},r.createElement("input",{id:a,type:"radio",className:"form-check-input",name:"reason",checked:d===t,value:t,onClick:()=>{m(t)},readOnly:!0}),r.createElement("label",{className:"form-check-label",htmlFor:a},e.title))}))))}},16798:(e,t,a)=>{a.d(t,{Z:()=>m});var n=a(67294),r=a(50533),l=a(59310),i=a(23274),s=a(2186),o=a(52279),c=a(80115);const d={dispatchReport:i.zJ,dispatchReportAndHandle:i.LWS},m=(0,r.connect)(((e,t)=>{var a;return{currentUserId:null===(a=(0,l.ib)(e))||void 0===a?void 0:a.get("id")}}),d)((e=>{let{currentUserId:t,reportableType:a,reportableId:r,reportableUserId:l,reportPrivateMail:i,visible:d,handle:m,onConfirmClick:u,onCloseClick:p,dispatchReport:g,dispatchReportAndHandle:h}=e;const v=(0,c.a)(a,i),E=(0,n.useCallback)((async e=>{if(!a||!r)return;const n={userId:t,reportableType:a,reportableId:r,reason:e},i=m?await h(n):await g(n);i.error||((0,s.Ms)(a,r,l,e),u(i))}),[m,t,a,r,l,g,h,u]);return n.createElement(o.Z,{options:v,visible:d,title:"举报",desc:"选择举报理由",onCloseClick:p,onChoose:E})}))},43170:(e,t,a)=>{a.d(t,{n:()=>s});var n=a(67294),r=a(50533),l=a(59310),i=a(16798);const s=e=>{let{reportableId:t,reportableType:a,reportableUserId:s,reportPrivateMail:o,handle:c,onConfirm:d}=e;const[m,u]=(0,n.useState)(!1),p=(0,r.useSelector)(l.ib),g=(0,n.useCallback)((e=>{u(!1),null==d||d(e)}),[d]),h=(0,n.useCallback)((()=>{u(!1)}),[]);return{report:()=>{a&&t&&(p?o&&!confirm("请授权同意机核审核人员查看你与对方的私信对话记录，以作为你举报的举证凭证信息，提高举报判定效率")||u(!0):alert("请先登录"))},modal:m?n.createElement(i.Z,{visible:!0,handle:c,reportableType:a,reportableId:t,reportableUserId:s,onConfirmClick:g,onCloseClick:h}):null}}},42047:(e,t,a)=>{a.d(t,{Z:()=>E});var n=a(73126),r=a(67294),l=a(50533),i=a(92332),s=a(66244),o=a(44671),c=a(80239),d=a(1145),m=a(23274),u=a(23279),p=a.n(u);const g={indicatorSeparator:()=>({display:"none"}),dropdownIndicator:()=>({display:"none"}),multiValue:(e,t)=>{let{data:a}=t;return{...e,..."entries"===(0,o.lt)(a.value.type)?{color:"#2f54eb",backgroundColor:"#e9edfd"}:{},..."entities"===(0,o.lt)(a.value.type)?{color:"#722ed1",backgroundColor:"#e3d5f6"}:{}}},multiValueLabel:(e,t)=>{let{data:a}=t;return{...e,..."entries"===(0,o.lt)(a.value.type)?{color:"#2f54eb"}:{},..."entities"===(0,o.lt)(a.value.type)?{color:"#722ed1"}:{}}}},h=e=>`${(e=>{let{label:t,value:a}=e;return"users"===a.type?t.replace(/\s/g,""):t})(e)}(${(e=>{let{value:t,model:a}=e;const n=null==a?void 0:a.getIn(["attributes","tag-type"]);if(n)return n;const r=null==a?void 0:a.getIn(["relationships","role","data","id"]);return"users"===t.type&&["1","2"].includes(r)?"Staff":c.AS[t.type]})(e)})`,v=e=>`${e.value.type}${e.value.id}`;const E=function(e){let{value:t,searchType:a,onChange:o,isMulti:c,searchRequestOptions:u,tagCreatable:E=!1,...f}=e;const y=(0,l.useDispatch)(),[b,k]=(0,r.useState)(!1),C=(0,r.useRef)(""),_=(0,r.useMemo)((()=>p()(((e,t)=>{y((0,m.yC4)({type:a,query:e},{page:1,limit:12,...u||{}})).then((a=>{if(e!==C.current)return;if(a.error)return void t([]);const n=(0,d.BY)(a.payload.result,a.payload.entities).map((e=>({label:e.getTitle(),value:e.toUnique(),model:e}))).toJSON();t(n)}))}),500)),[y,a,u]),w={className:"react-select",classNamePrefix:"react-select",loadingMessage:e=>{let{inputValue:t}=e;return`正在搜索"${t}"...`},noOptionsMessage:()=>"请输入关键词",getOptionValue:e=>{let{value:{type:t,id:a}}=e;return`${t}${a}`},getOptionLabel:h,isClearable:!0,isMulti:c,isLoading:b,isDisabled:b,cacheOptions:!0,loadOptions:_,onInputChange:e=>{C.current=e},onChange:e=>{if(!(c&&e instanceof Array))return void o(e);const t=e.reduce(((e,t)=>(void 0===e.find((e=>v(e)===v(t)))&&e.push(t),e)),[]);o(t)},value:t,styles:g};return E?r.createElement(i.Z,(0,n.Z)({},w,{formatCreateLabel:e=>`创建"${e}"标签`,onCreateOption:e=>{k(!0),y((0,m._Ip)({name:e,type:"Normal"})).then((e=>{if(e.error)return;const a={value:{id:e.payload.data.id,type:e.payload.data.type},label:e.payload.data.attributes.name},n=c?[...t,a]:a;o(n),k(!1)}))}},f)):r.createElement(s.Z,(0,n.Z)({},w,f))}},65634:(e,t,a)=>{a.d(t,{Z:()=>b});var n=a(73126),r=a(84059),l=a(67294),i=a(50533),s=a(26707),o=a(85846),c=a(35018),d=a(33529),m=a(81266);function u(e){const{title:t,link:a,children:r,image:i,...s}=e,[o,c]=(0,l.useState)(!1);if((0,l.useEffect)((()=>{c({title:encodeURIComponent(t),link:encodeURIComponent(a),image:i?encodeURIComponent(i):""})}),[t,a,i]),!o)return null;const{title:d,link:m,image:u}=o;let p=`https://service.weibo.com/share/share.php?url=${m}&title=${d}`;return u&&(p+=`&pic=${u}`),l.createElement("a",(0,n.Z)({href:p},s),r||"分享至微博")}var p=a(91433),g=a(71405),h=a(80239),v=a(23274);const E=e=>{const t=e.get("type");let a="",n="",r="";if("talks"===t){a=(0,p.o0)("talk",{id:e.get("id")});const t=e.getRelAttr("topic","title");n=[t?`来自 @机核网 话题 ${t}`:"",[e.getRelAttr("user","nickname"),e.getDesc(!1,20)].filter((e=>e)).join(" : ")].filter((e=>e)).join(" | ");const l=e.getThumb();l&&(r=(0,h.cR)(l,"style/content_watermark"))}else"albums"===t?(a=(0,p.o0)("album",{id:e.get("id")}),n=`机核播单 - ${e.getAttr("title")}`,r=(0,h.cR)(e.getAttr("cover"))):"album-bundles"===t?(a=(0,p.o0)("albumBundle",{id:e.get("id")}),n=e.getAttr("title"),r=(0,h.cR)(e.getAttr("cover"))):(a=(0,p.o0)((0,p.bv)(e.get("type"),e.get("id"))),n=`来自 @机核网：${e.getTitle()}`,r=(0,h.cR)(e.getThumb()));return{url:a,title:n,imageURL:r}};class f extends l.PureComponent{linkInput=void 0;componentDidUpdate(e){let{visible:t}=e;const{visible:a}=this.props;a&&a!==t&&this.postEventLog()}postEventLog(){const{data:e,dispatchPostEventLog:t}=this.props;t(e)}handleCopyLinkClick=()=>{var e;const{url:t}=E(this.props.data);this.linkInput.select(),(0,g.vQ)(t,null===(e=this.linkInput)||void 0===e?void 0:e.parentElement)};handleWechatShareClick=()=>{const e=E(this.props.data);this.props.saClickTalkWechatShare(e.title)};handleWeiboShareClick=()=>{const e=E(this.props.data);this.props.saClickTalkWeiboShare(e.title)};renderWeiboShare(){const e=E(this.props.data);return l.createElement(u,{className:"btn btn-primary me-2",link:e.url,title:e.title,image:e.imageURL,onClick:()=>this.handleWeiboShareClick()},l.createElement(c.Z,{icon:["gfas","weibo"]}))}renderPopoverForWechat(){const e=E(this.props.data),t={body:l.createElement(r.Qd,{value:e.url,size:200}),outside:!0};return l.createElement(m.Z,t,(e=>l.createElement(o.Z,(0,n.Z)({className:"btn btn-primary me-2",onClick:this.handleWechatShareClick,plain:!0,anchor:!0},e),l.createElement(c.Z,{icon:["gfas","weixin"]}))))}render(){const{data:e,visible:t,saClickTalkWeiboShare:a,saClickTalkWechatShare:r,dispatchPostEventLog:i,...o}=this.props,m=E(this.props.data);let u=null;e.getRel("djs")?u=l.createElement(s.Z,{users:e.getRel("djs"),size:"md"}):e.getRel("user")&&(u=l.createElement(s.Z,{users:e.getRel("user"),size:"md"}));const p=l.createElement("div",null,u,l.createElement("h3",{className:"popBox-share_title"},m.title));return t?l.createElement(d.Z,(0,n.Z)({},o,{className:"popBox-share popBox-bgHeader",header:p,headerImage:m.imageURL,hideActionBtns:!0,visible:t}),l.createElement("h3",null,"分享："),l.createElement("div",{className:"mb-3"},this.renderWeiboShare(),this.renderPopoverForWechat()),l.createElement("div",{className:"input-group mb-3"},l.createElement("input",{type:"text",className:"form-control",defaultValue:m.url,onClick:this.handleCopyLinkClick,ref:e=>{this.linkInput=e}}),l.createElement("button",{className:"btn btn-primary",type:"button",onClick:this.handleCopyLinkClick},l.createElement(c.Z,{icon:["gfas","link"]})))):null}}const y={saClickTalkWeiboShare:v.rnS,saClickTalkWechatShare:v.VlE,dispatchPostEventLog:e=>(0,v.T2o)({type:"share",loggable:e})},b=(0,i.connect)(void 0,y)(f)},87489:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(85846),i=a(35018),s=a(65634);class o extends r.PureComponent{state={visible:!1};handleShareClick=()=>{this.setState({visible:!0})};handleModalCloseClick=()=>{this.setState({visible:!1})};render(){const{children:e,data:t,text:a,modalProps:o,...c}=this.props,{visible:d}=this.state;return r.createElement(l.Z,(0,n.Z)({onClick:this.handleShareClick,plain:!0,anchor:!0},c),e||r.createElement(r.Fragment,null,r.createElement(i.Z,{icon:["gfas","share"]}),a),r.createElement(s.Z,{visible:d,data:t,onCloseClick:this.handleModalCloseClick}))}}const c=o},76731:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(73126),r=a(67294),l=a(63075);const i=e=>{let{actionName:t="订阅",subscribable:a,children:i,...s}=e;const o=a.getMeta("subscription-id"),c=i||(o?`已${t}`:t);return r.createElement(l.Z,(0,n.Z)({subscribable:a,type:"light",ellipse:!0},s),c)}},63075:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(73126),r=a(67294),l=a(85846),i=a(35018),s=a(6379),o=a(52004);const c=e=>{let{subscribable:t,onStatusChange:a,children:c,disableActiveClass:d=!1,className:m,...u}=e;const{subscribed:p,subscribe:g}=(0,s.Q3)(t,{onStatusChange:a});let h;return h="function"==typeof c?c(p):c||(p?"取消":r.createElement(i.Z,{icon:["gfas","plus"]})),r.createElement(l.Z,(0,n.Z)({onClick:g,className:(0,o.Z)(m,{is_active:p&&!d})},u),h)}},7975:(e,t,a)=>{a.d(t,{Z:()=>f});var n=a(73126),r=a(67294),l=a(50533),i=a(2186),s=a(50718),o=a(45648),c=a(52004),d=a(59310),m=a(23274),u=a(85846),p=a(35018);const g=e=>{let{votable:t}=e;return{votable:t,likesCount:(null==t?void 0:t.getAttr("likes-count"))||0}},h={onlyUp:!1,hideCount:!1,hideZeroCount:!1,upClassName:"",upIcon:["gfas","thumbs-up"],downIcon:["gfas","thumbs-down"],disableVoteForSelf:!1};class v extends r.Component{static contextType=o.qe;context;static defaultProps=h;static getDerivedStateFromProps(e,t){var a;let n=null;return(null===(a=t.votable)||void 0===a?void 0:a.getKey())!==e.votable.getKey()&&(n=g(e)),n}state=g(this.props);isVoting=!1;voteCallback(e,t,a){const{votable:n,portfolioId:r,source:l}=this.props;if(this.isVoting=!1,e.error)return;const{likesCount:s}=this.state;t&&this.setState({likesCount:s+t}),void 0!==a&&("comments"===n.get("type")?a?(0,i.Ug)(n,n.getRel("commentable")):(0,i.AN)(n,n.getRel("commentable")):["articles","videos","radios"].includes(n.get("type"))?(0,i.Im)(n,{source:l}):"talks"===n.get("type")&&(a?(0,i.sm)(n,{portfolioId:r}):(0,i.tZ)(n,{portfolioId:r})))}handleVote(e){const{votable:t,currentUser:a,disableVoteForSelf:n}=this.props;if(!a)return void this.props.toggleSigninModalWithTip();if(n&&a&&t.getRel("user","id")===a.get("id"))return void this.context.sendMessage({body:e?"无法为自己点赞":"无法反对自己",type:s.ZQ.WARNING});const{likesCount:r}=this.state,l=a?a.get("id"):0,i=t.getMeta("vote-id"),o=t.getMeta("vote-flag"),c={type:t.get("type"),id:t.get("id")};this.isVoting||(this.isVoting=!0,i?o===e?this.props.deleteVote(i,c).then((t=>{this.voteCallback(t,e?-1:1,void 0)})):this.props.patchVote(i,e,c).then((t=>{let a=0;a=e?0===r?1:2:-2,this.voteCallback(t,a,e)})):this.props.postVote(l,c,e).then((t=>{this.voteCallback(t,e?1:-1,e)})))}handleVoteUp=this.handleVote.bind(this,!0);handleVoteDown=this.handleVote.bind(this,!1);renderVoteUpComponent(){const{votable:e,upBtnProps:t,upClassName:a,hideCount:l,hideZeroCount:i,zeroText:s,upIcon:o,onlyUp:d}=this.props,{likesCount:m}=this.state,g=e.getMeta("vote-flag"),h=!l&&(!i||m>0);return r.createElement(u.Z,(0,n.Z)({className:(0,c.Z)("o_vote","o_vote-up",a,{is_active:g},{"o_vote-up-withDown":!d}),onClick:this.handleVoteUp,anchor:!0,plain:!0},t),this.renderChildren()||r.createElement(r.Fragment,null,r.createElement(p.Z,{icon:o,className:"o_vote_icon"}),h&&r.createElement("span",{className:"o_action_num"},m<=0?s||0:m)))}renderVoteDownComponent(){const{votable:e,downIcon:t}=this.props,a=!1===e.getMeta("vote-flag");return r.createElement(u.Z,{className:(0,c.Z)("o_vote","o_vote-down",{is_active:a}),onClick:this.handleVoteDown,plain:!0,anchor:!0},r.createElement(p.Z,{icon:t,className:"o_vote_icon"}))}renderChildren(){const{children:e,votable:t}=this.props;return e?"function"==typeof e?e(this.state.likesCount,t.getMeta("vote-flag")):e:null}render(){const{onlyUp:e}=this.props;return r.createElement(r.Fragment,null,this.renderVoteUpComponent(),!e&&this.renderVoteDownComponent())}}const E={patchVote:m.VgH,postVote:m.D7c,deleteVote:m.OU3,toggleSigninModalWithTip:m.CcW},f=(0,l.connect)(((e,t)=>({currentUser:(0,d.ib)(e)})),E)(v)},50718:(e,t,a)=>{a.d(t,{GW:()=>p,JW:()=>m,ON:()=>d,Od:()=>c,R9:()=>i,Tc:()=>r,ZQ:()=>s,ff:()=>g,ot:()=>u,qP:()=>o,sT:()=>l,uh:()=>h});var n=a(59129);const r=50;let l=function(e){return e[e.Latest=1]="Latest",e[e.Audit=2]="Audit",e}({});const i={MINI:0,NORMAL:1,FULLSCREEN:2},s={ERROR:"ERROR",WARNING:"WARNING",SUCCESS:"SUCCESS",INFO:"INFO",SIGNIN_ALERT:"SIGNIN_ALERT",LOADING:"LOADING",APP_ALERT:"APP_ALERT",APP_SUGGEST_ALERT:"APP_SUGGEST_ALERT",BIND_PHONE:"BIND_PHONE",COMMUNITY_PRO:"COMMUNITY_PRO"},o={GAME:{path:"/game",name:"游戏"},ACG:{path:"/acg",name:"二次元"},MEDIA:{path:"/media",name:"书影音"},LIFESTYLE:{path:"/lifestyle",name:"生活"},TOY:{path:"/toy",name:"模玩"},TECH:{path:"/tech",name:"科技"},DESIGN:{path:"/design_and_art",name:"设计与艺术"}};Object.keys(o).forEach((e=>{o[e].id=n.default.tag[e]}));const c={SUBSCRIBED_TOPICS_CATALOG_ID:"subscribed-topics",HOT_TOPICS_CATALOG_ID:"hot-topics"},d={slidesToShow:6,slidesToShowResponsive:[5,4,3,2]},m="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 row-cols-xxl-5",u="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xxl-6",p=/(@([^@]*))$/,g="@[__display__](__id__)",h=/@\[(\S+)\]\((\d+)\)/g},1145:(e,t,a)=>{a.d(t,{BY:()=>i,G:()=>m,Jg:()=>l,PT:()=>r,Wz:()=>c,b$:()=>o,tK:()=>s,yq:()=>d});var n=a(35369);const r=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const r=e.get("relationships");return!r||a<=0?e.update("rels",(()=>(0,n.Map)())):e.set("rels",r.map((e=>{if(!e)return;const r=e.get("data");return r?n.List.isList(r)?i(r,t,{depth:a-1}):l(r,t,{depth:a-1}):void 0})))},l=function(e,t){let{depth:a=3,toJSFlat:l=!1,toJS:i=!1,originalPreview:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=(0,n.Map)(e),c=n.Map.isMap(t)?t:(0,n.Map)(t);let d=c.getIn([o.get("type"),o.get("id")]);return d&&(d=r(d,c,a),s&&(d=r(((e,t)=>{const a=e.getRel(t.split(".")[0]);if(!a)return e;const r=a.get("attributes").update("cover",(t=>t||e.getAttr("cover"))).update("thumb",(t=>t||e.getAttr("thumb"))).delete("is-published").delete("is-verified");return e.mergeDeep((0,n.fromJS)({attributes:r,relationships:{"hosted-media":a.getIn(["relationships","hosted-media"])}}))})(d,s),c,a)),l?d=d.toJSFlat():i&&(d=d.toJS())),d};function i(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(0,n.List)(e),{toJSFlat:i=!1,toJS:s=!1}=a;let o=(0,n.List)();return r&&r.size>0&&(o=r.reduce(((e,n)=>{const r=l(n,t,a);return r?e.push(r):e}),o)),i||s?o.toJS():o}const s=(e,t,a,n)=>l("object"==typeof e?e:{id:e,type:t},a,n),o=(e,t,a,r)=>{const l=(0,n.List)(e);let s=(0,n.List)();return l.size>0&&(s=l.reduce(((e,a)=>e.push("object"==typeof a?a:{id:a,type:t})),s)),i(s,a,r)},c=e=>e.map((e=>e.toJSFlat())).toJS(),d=(e,t)=>m([e],t),m=(e,t)=>{const a=Array.from(e);if(!a.length)return null;const n=a.map((e=>{if(!e.priceInfo)return null;const a=e.priceInfo.details.map((e=>h(e))),n=t?a.filter((e=>((e,t)=>!(e.chinese&&!t.supportChinese||e.onsale&&t.discount>=10))(t,e))):a,r=g(n),l=p(n);return r?{lowestPrice:l,bestPrice:r,store:e}:null})).filter((e=>e)),r=u(n,(e=>{var t;return null==e||null===(t=e.bestPrice)||void 0===t?void 0:t.bestPrice})),l=u(n,(e=>{var t;return null==e||null===(t=e.lowestRecordFormattedPrice)||void 0===t?void 0:t.lowestPrice}));return r?{...r.bestPrice,lowestRecordFormattedPrice:null==l?void 0:l.lowestPrice,mcScore:r.store.mcScore,platform:r.store.platform,priceCount:r.store.priceInfo.details.length}:null},u=(e,t)=>{if(1===e.length)return e[0];let a,n=0;return e.forEach(((e,r)=>{const l="string"==typeof t?e[t]:t(e);"number"==typeof l&&(void 0===a||l<a)&&(a=l,n=r)})),void 0===n?null:e[n]},p=e=>u(e,"lowestPrice"),g=e=>u(e,"bestPrice"),h=e=>{const{discount:t,regular:a,lowest_recorded_price:n,area_name:r,support_chinese:l}=e,i=(new Date).getTime(),s=null!=t&&t.end?new Date(t.end).getTime():null,o=t?Math.round(t.amount/(a.amount||1)*100)/10:10,c=null==n?void 0:n.amount,d=t?t.amount:a.amount;return{lowestPrice:c,bestPrice:d,isLowest:c===d,bestPriceArea:r?r+"区":"",discount:o>10?10:o,endDay:s?Math.ceil((s-i<0?0:s-i)/864e5):null,originalPrice:a.amount,supportChinese:l}}},35277:(e,t,a)=>{a.d(t,{q:()=>s});var n=a(67294),r=a(85896),l=a(59310),i=a(15754);const s=()=>{var e;const t=(0,r.aC)(),a=(0,l.dO)(),[s,o]=(0,n.useState)(t&&(null===(e=i.L.get(a))||void 0===e?void 0:e.ids)||[]);return(0,n.useEffect)((()=>{var e;t&&o((null===(e=i.L.get(a))||void 0===e?void 0:e.ids)||[])}),[t,a]),s}},80115:(e,t,a)=>{a.d(t,{a:()=>s});var n=a(50533);const r=[{title:"垃圾信息（含广告）",value:2},{title:"色情、暴力、血腥等违反法律法规内容",value:0},{title:"挑衅、人身攻击等不友善内容",value:1},{title:"金钱欺诈或违法交易",value:8},{title:"政治相关内容",value:9}];var l=a(67294),i=a(91162);const s=(e,t)=>{const a=(0,n.useSelector)(o),s=null==a?void 0:a.get("fetched"),{contentReasons:c,userReasons:d}=(()=>{var e;const t=null==a||null===(e=a.toJS().origin)||void 0===e?void 0:e.data;if(!t)return{contentReasons:[],userReasons:[]};const n=e=>e?e.map((e=>({title:e[1],value:e[0]}))):[];return{contentReasons:n(t.content),userReasons:n(t.user)}})(),m=(0,n.useDispatch)();return(0,l.useEffect)((()=>{s||m((0,i.H)())}),[s,m]),e?["talks","comments","articles","videos","radios"].includes(e)?c:["users"].includes(e)?t?r:d:[]:[]},o=e=>e.getIn(["reportReasons"])},6379:(e,t,a)=>{a.d(t,{BW:()=>u,Q3:()=>p,rL:()=>m});var n=a(67294),r=a(50533),l=a(45648),i=a(85896),s=a(2186),o=a(23274),c=a(59310);const d={users:"当你对此用户设置不感兴趣后，你将不会在首页最新、关注、机组首页及单一小组界面下看到此用户的任何动态内容。可至【机组设置】-【机组动态管理】中取消操作",topics:"当你对此小组设置不感兴趣后，你将不会在首页最新、机组首页界面下看到此小组的任何动态内容。可至【机组设置】-【机组动态管理】中取消操作"},m=(e,t)=>{let{currentUserId:a,needConfirm:l=!0}=t;const i=(0,r.useDispatch)(),s=!(null==e||!e.getMeta("is-content-blocked")),[c,m]=(0,n.useState)(!1),u=(0,n.useCallback)((async()=>{if(!e||!a)return;m(!0);const t=await i((0,o.Gew)(a,{type:e.get("type"),id:e.get("id")}));t.error&&t.payload.toString().includes("数量限制")&&alert("不感兴趣的设置已达数量上限"),m(!1)}),[e,i,a]),p=(0,n.useCallback)((async()=>{e&&a&&(m(!0),await i((0,o.h2o)(a,{type:e.get("type"),id:e.get("id")})),m(!1))}),[i,e,a]),g=(0,n.useCallback)((async()=>{if(e)if(s)await p();else{if(l&&!confirm(d[e.get("type")]))return;await u()}}),[s,e,u,p,l]);return{isBlocked:s,block:g,loading:c}},u=(e,t)=>{let{portfolioId:a,currentUserId:c}=t;const d=(0,r.useDispatch)(),{pageName:m}=(0,l.EY)(),u=null==e?void 0:e.getAttr("bookmarks-count"),[p,g]=(0,n.useState)(u||0),h=e.getMeta("bookmark-id");(0,n.useEffect)((()=>{g(u||0)}),[u]);const v=(0,n.useCallback)((async()=>{if(c){if(e)if(h){(await d((0,o.TcX)(h,{type:e.get("type"),id:e.get("id")}))).error||g((e=>e-1))}else{(await d((0,o.Dyf)(c,{type:e.get("type"),id:e.get("id")}))).error||((0,s.V0)(e,{source:m,portfolioId:a}),g((e=>e+1)))}}else d((0,o.CcW)())}),[e,c,d,m,h,a]);return{bookmarksCount:p,bookmark:(0,i.m_)(v),isBookmarked:!!h,bookmarkId:h}},p=function(e){let{onStatusChange:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[a,i]=(0,n.useState)(!1),d=e.getMeta("subscription-id"),m=(0,c.xJ)(),{pageName:u}=(0,l.EY)(),p=(0,r.useDispatch)();return{isSubscribing:a,subscriptionId:d,subscribed:!!d,subscribe:async()=>{if(!m)return void p((0,o.CcW)());if(a)return;let n;i(!0),n=d?p((0,o.X$M)(d,e.toUnique())):p((0,o.MnA)(m.get("id"),e.toUnique())).then((t=>(t.error||(0,s.L2)(e,u),t)));const r=await n.then((e=>!e.error)).catch((e=>!1));return i(!1),r&&(null==t||t(!d)),r}}}},45648:(e,t,a)=>{a.d(t,{ET:()=>s,EY:()=>d,Ny:()=>r,fm:()=>i,gD:()=>o,mZ:()=>l,qe:()=>c});var n=a(67294);const r=n.createContext(void 0),l=()=>{const e=(0,n.useContext)(r);if(!e)throw new Error("useSessionAppContext must be used within a SessionAppContext");return e},i=()=>(0,n.useContext)(r),s=n.createContext(void 0),o=()=>{const e=(0,n.useContext)(s);if(!e)throw new Error("usePlayerContext must be used within a PlayerContext");return e},c=n.createContext(void 0),d=()=>{const e=(0,n.useContext)(c);if(!e)throw new Error("useCommonAppContext must be used within a CommonAppContext");return e}},91433:(e,t,a)=>{a.d(t,{O9:()=>Z,Qn:()=>C,SP:()=>_,YH:()=>w,ZP:()=>E,bv:()=>y,hW:()=>b,nl:()=>N,o0:()=>f,oD:()=>S,sH:()=>v,xE:()=>P});var n=a(85553),r=a(54186),l=a(65019),i=a(50718),s=a(30213),o=a(53275),c=a(67826),d=a(44671),m=a(85540),u=a(86716),p=a(98658),g=a(71405),h=a(2738);const v=(e=>{const t=(0,n.Z)(e,{stringifyQueryParams:e=>(0,c.nZ)(e,!1)});return(e,a)=>{if(/^\//.test(e))return`${e}${(0,c.nZ)(a)}`;let n,r=e,l=a;var i,s;"object"==typeof r&&(r=(0,d.Y_)(e.type||(null===(i=e.get)||void 0===i?void 0:i.call(e,"type"))),l={id:e.id||(null===(s=e.get)||void 0===s?void 0:s.call(e,"id")),...a||{}});const o=d.pK.map((e=>(0,d.Y_)(e)));if(o.includes(r)){const{id:e,type:t,...a}=l;let i=t;"term"!==r&&(i=(0,d.rG)(r)),n=`/${i}/${e}`,l=a}const m=new RegExp(`(${o.join("|")})Originals`).exec(r);if(m){const{id:e,...t}=l;n=`/${(0,d.rG)(m[1])}/${e}/originals`,l=t}if(["session","signin","signup","signout"].includes(r)&&("session"===r||"signin"===r?n="/account/signin":"signup"===r?n="/account/signup":"signout"===r&&(n="/account/signout")),n)return`${n}${(0,c.nZ)(l)}`;try{n=t(r,l)}catch(e){n="/404"}return n}})(u.Z),E=v,f=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e;return/^\//.test(a)||(a=v(a,t)),a=`${r.default.main_url}${a}`,a},y=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v((0,d.Y_)(e),{...a,id:t})},b=e=>v("originalEditor",{id:e.get("id"),type:e.isArticleNews()?"news":e.get("type")}),k=(e,t)=>!!e&&!!e.find((e=>e.test(t))),C=e=>{if(!e)return null;if((0,p.AZ)(e))return e;if(e.startsWith(`${r.default.main_url}`)){const t=e.replace(r.default.main_url,"")||"/";return(0,p.AZ)(t)?t:null}return null},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.LD;const a=C(e);if("string"!=typeof a)return;let n;for(const e of Object.values(t))if(e.paths){if(k(e.paths,a)){n=e;break}}else 0===a.indexOf(e.path)&&(!n||n.path.length<e.path.length)&&(n=e);return n},w=(e,t)=>{const a=C(e);if(!a)return!0;const n=t?C(t):window.location.pathname,r=_(n),l=_(a);return!r||!l||r.module!==l.module},N=e=>{return e!==_(window.location.pathname).module&&(window.location.reload(),!0)},P=function(e){let t,a,n,{titleKey:r="title",descKey:l="desc",descFormat:i=(e=>e),titleFormat:c=(e=>e),imageKey:d="thumb",fromState:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){const{payload:i}=e;if((0,m.GN)(e))throw e.payload;const s=i?i.data.attributes:e.attributes;a=s[d],t=s[r]||s.name,n=s[l]||s.description}else if(u){const{store:e,type:i,id:s}=u,o=e.getState().getIn(["entities",i,s]);if(!o)throw(0,h.vu)();t=o.getAttr(r)||o.getTitle(),n=o.getAttr(l),a=o.getAttr(d)}return t?(0,s.uk)({title:c((0,g.So)(t)),description:n?i((0,g.So)(n),(0,g.So)(t)):n,shareImg:a&&(0,o.cR)(a,{resize:{w:100,h:100}})}):null},S=(e,t)=>{const a=Number(e),n=a===i.sT.Latest,r=a===i.sT.Audit;let l;n?l="draft":r&&(l="audit-draft"),l&&"videos"===t&&(l+=".hosted-media");return{isPreview:n||r,isLatestPreview:n,isAuditPreview:r,previewType:a,needInclude:l?[l]:[],draft:l}},Z=e=>`${r.default.main_url}/link?target=${encodeURIComponent(e)}`},30213:(e,t,a)=>{a.d(t,{Hd:()=>v,dj:()=>g,hE:()=>p,uk:()=>h,xb:()=>u});var n=a(35369),r=a(35937),l=a.n(r),i=(a(50361),a(53888)),s=a.n(i),o=a(68630),c=a.n(o),d=a(2525),m=a.n(d);function u(e){return!e||n.List.isList(e)&&0===e.size||"object"==typeof e&&0===e.length}function p(e,t){let a,{childrenName:n="children",keyName:r="name"}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=0;for(;l<t.length;l++){if(t[l][r]===e)return t[l];if(t[l][n]&&(a=p(e,t[l][n]),a))return a}return null}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l()(e,(e=>void 0!==e&&(t||null!==e)))}function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=g(e,t);return s()(a,(e=>e!==a&&c()(e)?h(e,t):void 0))}function v(e,t,a){let n=!0;return m()(e,((e,r)=>{const l=a?`${a}.${r}`:r;return c()(e)?v(e,t,l):(n=t(e,r,l),n)})),n}},56845:(e,t,a)=>{a.d(t,{Od:()=>r,Uu:()=>i,y:()=>l});var n=a(85551);const r=()=>Date.now()>new Date("2024-02-27T00:00:00.000+08:00").getTime()&&Date.now()<new Date("2024-03-12T00:00:00.000+08:00").getTime(),l=e=>{if(!e)return 180;return e.getAttr("has-membership")?90:180},i=e=>{if(!e)return!1;const t=e.getAttr("name-changed-at"),a=(0,n.kB)(t);if(!a)return!0;return((e,t)=>{const a=new Date;return e.getTime()+t<a.getTime()})(a,24*l(e)*60*60*1e3)}},85551:(e,t,a)=>{a.d(t,{CH:()=>u,ET:()=>E,Ek:()=>b,Qk:()=>h,SI:()=>c,Sy:()=>v,TZ:()=>C,VA:()=>k,ab:()=>d,d7:()=>y,dB:()=>m,kB:()=>p,p6:()=>o,u3:()=>g,vn:()=>_});var n=a(27484),r=a.n(n),l=a(70178),i=a.n(l),s=a(46684);r().extend(i());const o=(e,t)=>r()(e).utcOffset(8).format(t),c=e=>o(e,"YYYY-MM-DD"),d=e=>o(e,"YYYY-MM-DD HH:mm:ss"),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,{includeHours:t=!1,alwaysHours:a=!1,pad:n=!0,padHour:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=parseInt(e,10);let i=0,s=0,o=0;t?(i=Math.floor(l/3600),s=Math.floor((l-3600*i)/60),o=l-3600*i-60*s):(s=Math.floor(l/60),o=l-60*s);let c=String(i).padStart(r?2:0,"0");return c=a?`${c}:`:0===i?"":`${c}:`,`${c}${String(s).padStart(n?2:0,"0")}:${String(o).padStart(n?2:0,"0")}`},u=e=>{const t=e.split(":").map((e=>Number(e)));if(t.length>3||0===t.length)return null;let a=0;for(const[e,n]of Object.entries(t.reverse())){const t=Number(e);if(!(n>=0)||0===t&&n>=60)return null;a+=n*Math.pow(60,t)}return a},p=e=>e?e instanceof Date?e:new Date(e):null,g=e=>{const t=p(e);return t?t.getTime()/1e3:0},h=(e,t,a)=>{if(a&&a<120)return["刚刚","片刻后"];if(a&&a<600)return["不久前","不久后"];return[["刚刚","片刻后"],["%s 秒前","%s 秒后"],["1 分钟前","1 分钟后"],["%s 分钟前","%s 分钟后"],["1 小时前","1 小时后"],["%s 小时前","%s 小时后"],["1 天前","1 天后"],["%s 天前","%s 天后"],["1 周前","1 周后"],["%s 周前","%s 周后"],["1 月前","1 月后"],["%s 月前","%s 月后"],["1 年前","1 年后"],["%s 年前","%s 年后"]][t]},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:604800,{nowLimit:a=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new Date;let r=p(e);return r instanceof Date?t&&g(n)-g(r)>t?c(r):(a&&g(n)<g(r)&&(r=n),(0,s.WU)(r,"zh_CN")):""},E=(e,t)=>e.setDate(e.getDate()-t)/1e3,f={1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二"},y=e=>{const t=new Date(e),a=t.getMonth()+1,n=t.getFullYear();return n===(new Date).getFullYear()?`${f[a]}月`:`${n} 年${f[a]}月`},b=e=>["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][e],k=e=>new Date((new Date).getTime()+1e3*e),C=e=>{if(!e)return"上线时间暂未公布";const t=new Date(e);return`${c(t)} ${t.getTime()>Date.now()?"上线":"已上线"}`},_=e=>Math.floor(e/864e5)},45841:(e,t,a)=>{a.d(t,{Ty:()=>n,cP:()=>l,vQ:()=>i});const n=e=>window.getComputedStyle(window.document.querySelector(e),":after").getPropertyValue("content").replace(/"|'/g,""),r="html_route_",l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=document.documentElement.classList;for(const e of Array.from(t))e.includes(r)&&t.remove(e);for(const a of e)t.add(`${r}${a}`)},i=e=>{var t,a;return null===(t=navigator.clipboard)||void 0===t||null===(a=t.writeText)||void 0===a?void 0:a.call(t,e)}},23417:(e,t,a)=>{a.d(t,{N5:()=>d,Xk:()=>p,_K:()=>g,p$:()=>c,rF:()=>m,tg:()=>o});var n=a(92742),r=a.n(n),l=a(70894),i=a.n(l);const s=e=>{if(!e)return null;let t;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){return null}else t=e;return t.blocks||t.entityMap?t:null},o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;const a=s(e);if(!a)return"";let n="";return a.blocks.forEach((e=>{e.text&&"atomic"!==e.type&&(n+=` ${e.text}`)})),n=r()(n),n.length>t&&(n=`${n.slice(0,t)}...`),n},c=e=>{const t=s(e);if(!t)return[];const a=[];return t.blocks.forEach((e=>{"unstyled"===e.type&&a.push(e.text)})),a},d=e=>{const t=s(e);if(!t)return[];let a=[];return Object.keys(t.entityMap).forEach((e=>{const n=t.entityMap[e],r=n.type.toLowerCase();"image"===r?a.push(n.data):"gallery"===r&&(a=a.concat(n.data.images))})),a},m=e=>{const t=s(e);if(!t)return null;const a=i()(t.entityMap,(e=>["image","gallery"].includes(e.type.toLowerCase())&&e.data&&!e.data.spoiler));if(!a)return null;const n=t.entityMap[a];return"gallery"===n.type.toLowerCase()?n.data.images[0]&&n.data.images[0].path:n.data.path},u=e=>{let{key:t}=e;return`nopop_${t}`},p=(e,t)=>{try{const a=((e,t)=>{const a=new RegExp(`^header-${t||""}`);return e.blocks.filter((e=>a.test(e.type)))})(JSON.parse(e),t);return{blocks:a,convertToAnchor:u}}catch(e){return null}},g=(e,t)=>{const a=p(e);return!a||a.blocks.length<2?null:t({blocks:a.blocks,currentClassName:"is_current",anchorItems:a.blocks.map(u)})}},6592:(e,t,a)=>{a.d(t,{C:()=>r,FW:()=>s,RT:()=>i,ox:()=>l});var n=a(54186);const r=(e,t)=>{try{const a=new FileReader;a.onload=()=>{const e=new Image;e.onload=()=>{t({width:e.naturalWidth,height:e.naturalHeight})},e.src=a.result},a.readAsDataURL(e)}catch(e){t({})}},l=function(e){let{acceptFileTypes:t=n.default.acceptFileTypes,maxFileSize:a=n.default.fileSizeLimit,limitFilesNum:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=e instanceof File?[e]:Array.prototype.slice.call(e),i=[];return r>0&&l.length>r&&i.push(`上传文件不能超过 ${r} 个`),l.forEach((e=>{t.test(e.type)&&t.test(e.name)||i.push(`${e.name}:不支持该文件格式`),e.size&&e.size>a&&i.push(`${e.name}:文件过大，文件不能大于 ${(a/1024/1024).toFixed(2)} MB`)})),{files:l,errors:i.length>0&&i,errorsStr:i.length>0?i.join("\n"):""}},i=e=>{if(!e)return null;const t=e.includes(".")&&e.split(".").pop();return t&&/[a-zA-Z]+/.test(t)?t:null},s=(e,t)=>{const a=i(e);return`${a?e.replace(new RegExp(`\\.${a}$`),""):e}${t?`.${t}`:""}`}},85896:(e,t,a)=>{a.d(t,{$0:()=>E,HN:()=>m,II:()=>d,MB:()=>v,P5:()=>c,aC:()=>b,l1:()=>u,m_:()=>p,n5:()=>g,pC:()=>f,tr:()=>h});var n=a(36808),r=a.n(n),l=a(67294),i=a(45648),s=a(80239),o=a(82285);const c=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(e,t)=>null!==e&&e!==t;const[n,i]=(0,l.useState)(void 0),s=(0,l.useCallback)((()=>{var a,n;e&&t&&(i(t),a=e,n=t,r().set(a,n,{expires:365}))}),[e,t]);return(0,l.useEffect)((()=>{const t=e?(a=e,r().get(a)??null):null;var a;null===t?s():i(t)}),[e,s]),{flag:void 0!==n&&void 0!==t&&a(n,t),last:n,current:t,save:s}},d=e=>{const t=(0,l.useRef)(e);return t.current=e,t},m=(e,t)=>{let{format:a=(e=>e)}=t;const n=(0,l.useRef)(e),r=(0,l.useRef)(null),i=null!==r.current||n.current!==e;return n.current=e,(0,l.useMemo)((()=>i?(r.current=n.current,a(r.current)):null),[i,a])},u=e=>(0,l.useCallback)((()=>{e()}),[e]),p=e=>{const t=(0,l.useRef)(!1);return(0,l.useCallback)((async function(){if(t.current)return;t.current=!0;const a=await e(...arguments);return t.current=!1,a}),[e])},g=e=>{const{historyBackwardCount:t}=(0,i.EY)(),a=d(t),n=(0,l.useRef)(0===a.current);return(0,l.useCallback)((async()=>{n.current||a.current>1?await e():n.current=!0}),[e,a])},h=(e,t)=>{const a=(0,l.useCallback)((()=>{((e,t)=>{const a=document.querySelector(t),n=document.querySelectorAll(e);a&&0!==n.length&&n.forEach((e=>{e.style.height=`${a.offsetHeight}px`}))})(e,t)}),[e,t]),n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const a=(0,l.useRef)(null);return(0,l.useCallback)((()=>{a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{e()}),t)}),[e,t])}(a,300);(0,l.useEffect)((()=>{a()})),(0,l.useEffect)((()=>(window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)})),[n])},v=()=>(0,l.useRef)((0,s.FZ)()).current,E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return v()(e)},f=e=>{const{prevPageName:t,pageName:a}=(0,i.EY)();return e?()=>{t&&t!==a?o.ZP.goBack():o.ZP.push(e)}:null};let y=!1;const b=()=>{const[e,t]=(0,l.useState)(y);return(0,l.useEffect)((()=>{y=!0,t(!0)}),[]),e}},53275:(e,t,a)=>{a.d(t,{cR:()=>n.cR,wf:()=>n.wf,zy:()=>n.zy});var n=a(60245)},72753:(e,t,a)=>{a.d(t,{CF:()=>l,d1:()=>i,dl:()=>o,nO:()=>s,pj:()=>r});var n=a(67294);const r=(e,t,a)=>{if(!i())return void(null==a||a());const n=JSON.stringify({type:e,...t?{data:t}:{}});window.ReactNativeWebView.postMessage(n)},l=function(e){r("show-toast",{message:e},!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?()=>{alert(e)}:void 0)},i=()=>!!window.ReactNativeWebView,s=()=>{const[e,t]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{t(i())}),[]),e},o=e=>({webviewTitle:e,webviewShowHeaderRight:"false",webviewShowNavBar:"false"})},71405:(e,t,a)=>{a.d(t,{So:()=>n,gt:()=>o,io:()=>i,oH:()=>l,v3:()=>r,vQ:()=>s,yI:()=>c});const n=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/\s/g,"")},r=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/[\n\r]/g,"")},l=e=>null==e?void 0:e.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"").replace(/\s+/g," ").trim(),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60;if("string"!=typeof e)return e;let a=e;return e.length>t&&(a=`${e.slice(0,t)}...`),a},s=(e,t)=>{const a="string"==typeof e;let n;const r=t||document.body;a?(n=document.createElement("div"),r.appendChild(n)):n=e,n.contentEditable=!0,n.innerHTML=e,n.unselectable="off",n.focus(),document.execCommand("SelectAll"),document.execCommand("Copy",!1),a&&r.removeChild(n)};function o(e){return parseFloat((100*e).toFixed(2))+"%"}function c(e){return e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}},67826:(e,t,a)=>{a.d(t,{CO:()=>b,CX:()=>y,Hm:()=>p,On:()=>E,XW:()=>h,e2:()=>v,iw:()=>f,nZ:()=>g});var n=a(54061),r=a.n(n),l=a(45220),i=a.n(l),s=a(52353),o=a.n(s),c=a(8575),d=a(92426),m=a(82285),u=a(30213);const p=e=>{m.ZP&&("REPLACE"===m.ZP.action?m.ZP.push(e):m.ZP.goBack())},g=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e||0===Object.keys(e).length)return"";let a=r()(e,((e,t,a)=>{let n=e;return n=!i()(t)&&!o()(t)?n+=`${a}=${encodeURIComponent(t)}&`:n,n}),"");return a=a.slice(0,-1),a=`${t?"?":""}${a}`,a},h=()=>{if("undefined"!=typeof window){return c.parse(window.location.href,!0)}return null},v=e=>{const t=h();return t?(t.query={...t.query,...e},c.format({pathname:t.pathname,query:(0,u.uk)(t.query)})):null},E=(e,t)=>{const a=v(e);a&&(m.ZP.push(a),t&&t(m.ZP))},f=(e,t)=>{const a=v(e);a&&(m.ZP.replace(a),t&&t(m.ZP))},y=(e,t)=>{const a=v(e);if(a){const e=(0,d.lX)();e.replace(a),t&&t(e)}},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=Number(e);return Number.isNaN(a)||a<=0?t:a}},98658:(e,t,a)=>{a.d(t,{AZ:()=>c,PV:()=>m,_N:()=>d,jK:()=>s,ke:()=>l,pn:()=>o,r5:()=>i});var n=a(92742),r=a.n(n);const l=e=>!("string"==typeof e&&r()(e).length>0),i=e=>/^mailto:/.test(e),s=e=>/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/.test(e),o=e=>{if("string"!=typeof e)return!1;for(const t of["gcores","app","mqq","zhihu","weixin","wxwork","dingtalk","weibo","weibointernational","alipay","taobao","pinduoduo","openapp.jdmobile","iosamap","baidumap","snssdk1128"])if(e.startsWith(`${t}://`))return!0;return!1},c=e=>/^\//.test(e),d=e=>/^app:\/\//.test(e),m=e=>/^((\d{1,}:){1,2}\d{2})(.*)/.exec(e)},74484:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(73126),r=a(67294),l=a(52004),i=a(91388);const s=e=>{let{...t}=e;return r.createElement(i.r,(0,n.Z)({customSuggestionsContainer:e=>r.createElement(r.Fragment,null,r.createElement("div",{className:"mentionMana__suggestions__tip"},"选择想要@的用户或直接输入搜索"),e)},t,{className:(0,l.Z)("mentionMana",t.className)}))}},65114:(e,t,a)=>{a.d(t,{v:()=>h});var n=a(67294),r=a(91388),l=a(50718),i=a(96486),s=a(85540),o=a(14810),c=a(50533),d=a(59310),m=a(80239);const u=e=>({id:e.id,display:e.attributes.nickname,avatar:e.attributes.thumb}),p=(0,i.debounce)(((e,t,a)=>{e((0,s.ZP)((0,o.w4)({type:"users",query:t,orderBy:"score"},{limit:10}))).then((e=>{a(e.payload.origin.data.map(u))}))}),500),g=(0,i.debounce)((async(e,t,a,n)=>{if(n.get(t))return a(n.get(t));const[r,l]=await Promise.all([e((0,o.D1)(`users/${t}/mutual-friends`,{limit:10})),e((0,o.D1)(`users/${t}/followees-not-mutual`,{limit:10}))]),i=[...r.payload.origin.data,...l.payload.origin.data].reduce(((e,t)=>(e.find((e=>e.id===t.id))||e.push(t),e)),[]).slice(0,10).map(u);n.set(t,i),a(i)}),500),h=()=>{const e=(0,c.useDispatch)(),t=(0,d.dO)(),a=(0,n.useRef)(new Map),i={trigger:l.GW,data:(n,r)=>{n?p(e,n,r):g(e,t,r,a.current)},displayTransform:(e,t)=>`@${t}`,renderSuggestion:(e,t,a,r,l)=>n.createElement(n.Fragment,null,n.createElement("div",{className:"mentionMana__suggestions__item__avatar",style:e.avatar?{backgroundImage:`url(${(0,m.cR)(e.avatar,{resize:{w:60,m:"lfit"}})})`}:void 0}),n.createElement("span",null,e.display)),markup:l.ff,appendSpaceOnAdd:!0};return n.createElement(r.p,i)}},6143:(e,t,a)=>{a.d(t,{Te:()=>m,pY:()=>c,sS:()=>u});var n=a(67294),r=a(35218),l=a(50718),i=a(91433),s=a(71405),o=a(80239);const c=e=>{const t=e=>`@${e[1]}`,{result:a,matched:n}=(0,o.xK)(e,{matcher:l.uh,replacer:t}),r=n.map((e=>{let[a]=e;return{type:"mention",data:{type:"users",id:a[2]},text:t(a)}}));return{text:a.join(""),tagData:r}},d=e=>{const t=e.map((e=>e.text)),a=new Map;e.forEach((e=>{a.set(e.text,e)}));return{matcher:new RegExp(t.map((e=>(0,s.yI)(e))).join("|"),"g"),termsMap:a}};function m(e,t){if(!e||!t)return e;const{termsMap:a,matcher:l}=d(t);return(0,o.xK)(e,{matcher:l,replacer:(e,t)=>{let[l]=e;const s=l&&a.get(l);return s?n.createElement(r.Z,{to:(0,i.ZP)(s.data),key:t},n.createElement("strong",null,l)):null}}).result}const u=(e,t)=>{if(!e)return"";if(!t||0===t.length)return e;const{termsMap:a,matcher:n}=d(t),{result:r}=(0,o.xK)(e,{matcher:n,replacer:(e,t)=>{var n;const r=e[0],{id:l}=(null===(n=a.get(r))||void 0===n?void 0:n.data)||{};return`@[${r.slice(1)}](${l})`}});return r.join("")}},59310:(e,t,a)=>{a.d(t,{LF:()=>o,P1:()=>l.P1,TJ:()=>u,VS:()=>f,_I:()=>g,dO:()=>E,hm:()=>h,ib:()=>d,is:()=>c,xJ:()=>v,yK:()=>m,zU:()=>p});var n=a(35369),r=a(50533),l=a(22222),i=a(44815),s=a(1145);(0,l.wN)(i.PW,((e,t)=>(0,n.is)(e,t)));const o=(e,t)=>e.get("entities"),c=(e,t)=>e.get("session"),d=(0,l.P1)(((e,t)=>e.getIn(["session","userID"])),o,((e,t)=>(0,s.tK)(e,"users",t))),m=(0,l.P1)(d,(e=>(null==e?void 0:e.get("id"))??null)),u=(e,t)=>(0,l.P1)((e=>(0,l.P1)(((e,t)=>e),"function"==typeof e?(t,a)=>e(a).join(","):()=>e.join(","),((e,t)=>e.getIn(t.split(",")))))(e),o,((e,a)=>(0,s.BY)(e,a,t))),p=e=>(0,l.P1)(((e,t)=>{let{type:a}=t;return a}),((e,t)=>{let{id:a}=t;return a}),o,((t,a,n)=>t&&a?(0,s.tK)(a,t,n,e):null)),g=(e,t,a)=>e.getIn(["pay","availabilityHistory",t,a,"currentlyAvailable"]),h=e=>e.getIn(["pay","credit"]),v=()=>(0,r.useSelector)(d),E=()=>{var e;return null===(e=v())||void 0===e?void 0:e.get("id")},f=e=>e.map((e=>e.getRel("entry"))).filter((e=>e&&"games"===e.get("type"))).reduce(((e,t)=>e.find((e=>e.get("id")===t.get("id")))?e:e.push(t)),(0,n.List)())},50546:(e,t,a)=>{a.d(t,{N5:()=>n.N5,Xk:()=>n.Xk,_K:()=>n._K,p$:()=>n.p$,tg:()=>n.tg});var n=a(23417)},13216:(e,t,a)=>{a.d(t,{o:()=>l});var n=a(73126),r=a(67294);const l=e=>{let{type:t,src:a,props:l={},attributes:i,sourceAttributes:s}=e;if(!t||!a)return null;const o={style:{width:"100%"},...i||{},...l};switch(t){case"iframe":return r.createElement("iframe",(0,n.Z)({},o,{src:a}));case"embed":return r.createElement("embed",(0,n.Z)({},o,{src:a}));case"video":return s?r.createElement("video",o,r.createElement("source",(0,n.Z)({},s,{src:a}))):r.createElement("video",(0,n.Z)({},o,{src:a}));case"a":return null}return null}},80239:(e,t,a)=>{a.d(t,{AS:()=>p,CA:()=>m.CA,Eo:()=>m.Eo,FZ:()=>k,GS:()=>N,KO:()=>c.p$,N5:()=>c.N5,RL:()=>g,T4:()=>C,Xk:()=>c.Xk,Zx:()=>b,cR:()=>m.cR,cn:()=>h,d9:()=>f,eL:()=>d.e,hd:()=>v,iT:()=>m.iT,jh:()=>m.jh,lE:()=>E,p$:()=>u,pn:()=>m.pn,q0:()=>y,qz:()=>m.qz,tg:()=>c.tg,xK:()=>S,yH:()=>P});var n=a(56264),r=a(73955),l=a.n(r),i=a(92077),s=a.n(i),o=a(67294),c=a(50546),d=a(67430),m=a(60245);const u={articles:"篇",news:"篇",radios:"期",audiobooks:"期",videos:"个",talks:"条"},p={originals:"综合",articles:"文章",news:"资讯",videos:"视频",radios:"播客",users:"用户",categories:"频道",collections:"专题",albums:"播单",talks:"动态",topics:"小组",comments:"评论",animations:"动画",games:"游戏",audiobooks:"有声书",books:"书籍",films:"影视",celebrities:"人物",organizations:"组织",tags:"标签",portfolios:"作品合集",products:"商品","album-bundles":"有声书套装"},g={...p,publish:"发布了",like:"赞了",comment:"评论了",reply:"回复了",title:"标题",desc:"摘要",categoryID:"频道",mediaID:"媒体关联",djs:"参与者",content:"内容",thumb:"封面图",weibo:"微博",wechat:"微信",wexin:"微信",audioBooks:"有声书"},h=e=>{const t=g[e];return t||(/hosted-media/.test(e)?"视频上传相关内容":e)},v=[{key:"originals",title:"全部"},{key:"radios",title:"播客"},{key:"articles",title:"文章"},{key:"news",title:"资讯"},{key:"videos",title:"视频"}],E=function(e){let{camelize:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=e.toLowerCase();let r=a;return/switch/.test(a)?r="nintendo-switch":/ps|station/.test(a)?r="playstation":/xbox/.test(a)?r="xbox":/deot/.test(a)?r="deot":/steam/.test(a)&&(r="steam"),t&&r&&(r=(0,n.camelize)(r)),r},f="col-xl-3 col-md-4 col-sm-6",y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,a=null;const n=()=>{t-=1,0===t&&a&&clearInterval(a),e(t)};return n(),a=setInterval(n,1e3),a},b=e=>s()(e).format("0[.]0a"),k=()=>{const e=l()();return t=>`htmlFor_${e}_${t}`},C=function(e){let{withRmbMark:t=!0,withFixed:a=!0,showFree:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=Number(e);if(null==e||isNaN(r))return"-";if(0===r&&n)return"免费";let l=r/100;return l=a?l.toFixed(2).replace(/\.00$/,""):l,t?`￥${l}`:`${l}`},_={4:"col-12",3:"offset-md-1 col-md-10 offset-lg-2 col-lg-8",2:"offset-md-2 col-md-8",1:"offset-md-4 col-md-4"},w={4:"col-sm-6 col-md-3",3:"col-md-4",2:"col-sm-6",1:"col-12"},N=e=>({container:_[e],col:w[e]}),P=(e,t)=>{if("string"!=typeof e)return"";const a=e.replace(/(\r\n|\r|\n)+/g,"\n").split("\n"),n=[];return a.forEach(((e,r)=>{n.push(o.createElement("span",{key:`p${e}${r}`},t?t(e,r):e)),r<a.length-1&&n.push(o.createElement("br",{key:`b${e}${r}`}))})),n},S=(e,t)=>{let{matcher:a,replacer:n=(e=>e[0])}=t;const r="|difjas--GCREPLACING--difjas|",l=e.replace(a,r).split(r),i=[],s=[];let o=0;return l.forEach(((t,r)=>{t&&i.push(t),o+=t.length;const l=a.exec(e.slice(o));if(!l)return;const c=n(l,r);c&&i.push(c),s.push([l,c]),o+=l.length})),{result:i,matched:s}}},67430:(e,t,a)=>{a.d(t,{e:()=>l});var n=a(67294),r=a(35218);const l=e=>{let t=0;const a=[],l=e.replace(/\[([^\]]+)\]\(([^)]+)\)/g,((e,t,n)=>(a.push([t,n]),`$LINK$_${a.length-1}_$LINK$`))).split("$LINK$");return l.length<=1?e:l.map((e=>{const l=/_(\d)+_/.exec(e);if(!l)return n.createElement("span",{key:t++},e);const i=a[l[1]];return i?n.createElement(r.Z,{key:t++,href:i[1]},i[0]):n.createElement("span",{key:t++})}))}},60245:(e,t,a)=>{a.d(t,{CA:()=>k,Eo:()=>C,cR:()=>y,iT:()=>m,jh:()=>d,pn:()=>h,qz:()=>E,wf:()=>b,zy:()=>p});var n=a(82492),r=a.n(n),l=a(93220),i=a.n(l),s=a(54186),o=a(44189),c=a(6592);const d=-8;let m=function(e){return e[e.OriginalItem=0]="OriginalItem",e[e.UserThumbXsM1=1]="UserThumbXsM1",e[e.UserThumbXs=2]="UserThumbXs",e[e.UserThumbSm=3]="UserThumbSm",e[e.UserThumbMd=4]="UserThumbMd",e[e.UserThumbLg=5]="UserThumbLg",e[e.UserThumbSizeNotification=6]="UserThumbSizeNotification",e[e.UserThumbSizeArticle=7]="UserThumbSizeArticle",e[e.UserThumbSizeFollow=8]="UserThumbSizeFollow",e[e.UserThumbSizeSetting=9]="UserThumbSizeSetting",e[e.Blur=10]="Blur",e[e.Watermark=11]="Watermark",e}({});const u=e=>{let t;switch(e){case m.UserThumbXsM1:t={resize:{w:20,h:20}};break;case m.UserThumbXs:t={resize:{w:26,h:26}};break;case m.UserThumbSm:t={resize:{w:36,h:36}};break;case m.UserThumbMd:t={resize:{w:44,h:44}};break;case m.UserThumbLg:t={resize:{w:55,h:55}};break;case m.UserThumbSizeNotification:t={resize:{w:40,h:40}};break;case m.UserThumbSizeArticle:t={resize:{w:60,h:60}};break;case m.UserThumbSizeFollow:t={resize:{w:72,h:72}};break;case m.UserThumbSizeSetting:t={resize:{w:100,h:100}};break;case m.Blur:t={blur:{r:50,s:50},resize:{w:100,h:100,m:"fixed"},format:"jpg"};break;case m.Watermark:t={watermark:{image:"d2F0ZXJtYXJrLnBuZw",g:"se",x:10,y:10}};break;default:t={}}return[m.UserThumbXsM1,m.UserThumbXs,m.UserThumbSm,m.UserThumbMd,m.UserThumbLg,m.UserThumbSizeNotification,m.UserThumbSizeArticle,m.UserThumbSizeFollow].includes(e)&&(t={...t,bright:d}),t},p=(e,t,a)=>{if(!t)return"";if(/^http/.test(t))return t;let n=t;if(a){const[e,r]=t.split(".");n=`${e}_${a}.${r}`}return`${s.default.alioss_url}/uploads/${e}/${n}`},g=(e,t)=>{if(!e)return!1;const a=e.toLowerCase();for(const e of t)if(a.endsWith(`.${e}`))return!0;return!1},h=e=>{const t=g(e,["gif"]),a=g(e,["heic"]),n=g(e,["jpg","jpeg"]),r=g(e,["webp"]),l=C(e);return{isGif:t,isHEIC:a,isJpg:n,isWebp:r,...l||{},...l?{aliyunProcessable:l.width<s.default.imgAliyunProcessLengthLimit&&l.height<s.default.imgAliyunProcessLengthLimit&&l.width*l.height<s.default.imgAliyunProcessResolutionLimit}:{aliyunProcessable:!0}}},v=(e,t)=>{let{isGif:a,isWebp:n,aliyunProcessable:l}=t,s=e;return s=r()({...s.resize?{resize:{limit:1,m:"fill"}}:{},quality:{q:90},...n?{}:{format:"webp"}},s),!a&&l||(s={}),Object.keys(s).length>0?`image/${function(e){let{isGif:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(e).map((e=>`${e[0]},${"object"==typeof e[1]?i()(e[1]).map((a=>{const[n]=a;let r=a[1];return"number"!=typeof r||"resize"!==e[0]||"w"!==n&&"h"!==n||(r=Math.min(Math.round(t?r:f(r)),"w"===n?3e3:9999)),n+"_"+r})).join(","):e[1]}`)).join("/")}(s,{isGif:a})}`:""},E=(e,t)=>{if(!e)return e;const a=h(e),n=`${s.default.img_url}/${e}`;if(!1===t)return n;if("string"==typeof t)return`${n}?x-oss-process=${t}`;const r=v(t||{},a);return r?`${n}?x-oss-process=${r}`:n},f=e=>{let t=2;return"undefined"!=typeof window&&(t=window.devicePixelRatio),e*t},y=function(e,t){let a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!e||/^(https?:)?\/\/|^\//.test(e)?e:(a=t instanceof Array?t.map((e=>u(e))).reduce(((e,t)=>r()(e,t))):"number"==typeof t?u(t):t,"object"==typeof a&&(a=r()(a,n)),E(e,a))},b=e=>`${s.default.alioss_url}/uploads/audio/${e}`,k=function(e,t){return e?"system"===e?o:y(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}):`${s.default.alioss_url}/page_resources/misc/avatar-default.png?x-oss-process=image/bright,-20`},C=e=>{if(!e)return null;const t=(0,c.FW)(e,null).split("-");if(t.reverse(),t.length<3)return null;const[a,n]=t,r=Number(n),l=Number(a);return r>0&&l>0?{width:r,height:l}:null}},2738:(e,t,a)=>{a.d(t,{EQ:()=>s,Tr:()=>r,Yl:()=>l,fg:()=>i,mO:()=>o,vu:()=>c});const n="GCBaseError",r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return((e,t)=>{let{name:a=n,message:r,status:l,routePage:i,disableLog:s,hideStack:o}=t;return e.name=a,e.message=r,e.status=l,e.routePage=i,e.disableLog=s,o&&(e.stack=void 0),e})(new Error,{name:e,...t})},l="GCNeedSigninError",i=function(){let{message:e="需要登录",status:t=403,hideStack:a=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(l,{message:e,status:t,hideStack:a,...n})},s="GCNeedBindPhoneError",o=function(){let{message:e="请先绑定手机才可发布内容",status:t=403,hideStack:a=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(s,{message:e,status:t,hideStack:a,...n})},c=function(){let{message:e="未能找到相关内容",status:t=404,hideStack:a=!0,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r("GCNotFoundError",{message:e,status:t,hideStack:a,...n})}},13913:(e,t,a)=>{a.d(t,{Uo:()=>l,WH:()=>n,iF:()=>r});let n=function(e){return e.Audiobook="AUDIOBOOK",e.Booom="BOOOM",e.CommissionEshop="COMMISSION_ESHOP",e.Gadio="GADIO",e.Gcores="GCORES",e.GcoresIndustries="GCORES_INDUSTRIES",e.GcoresIndustriesEshop="GCORES_INDUSTRIES_ESHOP",e.GcoresMart="GCORES_MART",e.GcoresMartEshop="GCORES_MART_ESHOP",e}({}),r=function(e){return e.Canceled="CANCELED",e.Created="CREATED",e.Delivered="DELIVERED",e.DeliverySigned="DELIVERY_SIGNED",e.Done="DONE",e.Obsolete="OBSOLETE",e.Paid="PAID",e.Processing="PROCESSING",e.WaitingForPayment="WAITING_FOR_PAYMENT",e}({}),l=function(e){return e.Album="ALBUM",e.AlbumBundle="ALBUM_BUNDLE",e.Article="ARTICLE",e.Original="ORIGINAL",e.Radio="RADIO",e.Sku="SKU",e.Video="VIDEO",e}({})},61756:(e,t,a)=>{a.d(t,{EJ:()=>m,G6:()=>s,JQ:()=>r,L8:()=>l,Mh:()=>c,N8:()=>i,ND:()=>o,Q$:()=>v,S6:()=>E,iz:()=>p,ju:()=>g,kD:()=>h,ot:()=>f,w1:()=>d,yO:()=>u});var n=a(31429);const r=n.Ps`
  query Credit {
    credit {
      latestCredit
    }
  }
`,l=n.Ps`
  query Sku($skuId: ID!, $preview: Boolean = false) {
    sku(id: $skuId) {
      name
      amount(preview: $preview)
      tagAmount
    }
  }
`,i=n.Ps`
  query PurchasableAvailability(
    $purchasableType: PurchasableType!
    $purchasableId: ID!
  ) {
    purchasableAvailability(
      purchasableType: $purchasableType
      purchasableId: $purchasableId
    ) {
      currentlyAvailable
      availableUntil
    }
  }
`,s=n.Ps`
  mutation PlaceOrder($skuId: String!) {
    placeOrder(skuId: $skuId) {
      id
    }
  }
`,o=n.Ps`
  query CheckPurchase($purchasableType: PurchasableType!, $purchasableId: ID!) {
    checkPurchase(
      purchasableType: $purchasableType
      purchasableId: $purchasableId
    )
  }
`,c=n.Ps`
  query Order($orderId: ID!) {
    order(id: $orderId) {
      id
      skuId
      userId
      status
      amount
      redeemCode {
        id
        code
        state
      }
      createdAt
      updatedAt
    }
  }
`,d=n.Ps`
  mutation PlaceWeChatPayOrderFromDesktopWeb($orderId: String!) {
    placeWeChatPayOrderFromDesktopWeb(orderId: $orderId) {
      codeUrl
    }
  }
`,m=n.Ps`
  mutation PlaceWeChatPayOrderFromJsBridge(
    $orderId: String!
    $openId: String!
  ) {
    placeWeChatPayOrderFromJsBridge(orderId: $orderId, openId: $openId) {
      appId
      timeStamp
      nonceStr
      package
      signType
      paySign
    }
  }
`,u=n.Ps`
  mutation PlaceAlipayOrderFromDesktopWeb($orderId: String!, $pageUrl: String) {
    placeAlipayOrderFromDesktopWeb(orderId: $orderId, pageUrl: $pageUrl) {
      url
    }
  }
`,p=n.Ps`
  mutation PlaceAlipayOrderFromMobileWeb($orderId: String!, $pageUrl: String) {
    placeAlipayOrderFromMobileWeb(orderId: $orderId, pageUrl: $pageUrl) {
      url
    }
  }
`,g=n.Ps`
  query OrderHistory(
    $first: Int
    $offset: Int
    $status: OrderStatus
    $scenario: OrderScenarioFilter
    $merchant: OrderMerchant
  ) {
    orderHistory(
      first: $first
      offset: $offset
      status: $status
      scenario: $scenario
      merchant: $merchant
    ) {
      totalCount
      orders {
        id
        amount
        skuId
        manifest {
          receipt {
            amount
            skuId
          }
        }
        status
        redeemCode {
          code
          skuId
          consumerId
          producerId
        }
        deviceId
        expiredAt
        createdAt
        merchant
      }
    }
  }
`,h=e=>(0,n.Ps)(`mutation {\n   ${e.map((e=>`\n       mutation${e}: purchaseWithCredit(skuId: "${e}") {\n         order {\n           id\n           skuId\n           redeemCode {\n             code\n             consumerId\n           }\n           userId\n           status\n           amount\n           createdAt\n           updatedAt\n         }\n       }\n     `))}\n }\n`),v=n.Ps`
  query AudioBookHistory($first: Int, $offset: Int, $merchant: OrderMerchant) {
    audioBookHistory(first: $first, offset: $offset, merchant: $merchant) {
      totalCount
      audioBooks {
        id
        type
        title
        cover
        author
        isExpired
        isRedundant
      }
    }
  }
`,E=(n.Ps`
  query RedeemCodeHistory($first: Int, $offset: Int) {
    redeemCodeHistory(first: $first, offset: $offset) {
      totalCount
      redeemCodes {
        id
        code
        skuId
        consumerId
        producerId
      }
    }
  }
`,n.Ps`
  mutation RedeemCode($code: String!, $antibot: Antibot!) {
    redeemCode(code: $code, antibot: $antibot) {
      success
    }
  }
`),f=n.Ps`
  mutation PurchaseWithGcoins($skuId: String!) {
    purchaseWithGcoins(skuId: $skuId) {
      order {
        id
        amount
        skuId
        redeemCode {
          code
          skuId
          consumerId
          producerId
        }
        createdAt
      }
    }
  }
`},5305:(e,t,a)=>{a.d(t,{Z:()=>o,v:()=>s});var n=a(18185),r=a(59129);const l={type:"albums",id:void 0,attributes:{title:void 0,description:void 0,author:void 0,information:void 0,cover:void 0,"gift-cover":void 0,notice:void 0,credit:void 0,"chapters-count":void 0,"radios-count":void 0,"subscriptions-count":void 0,"is-free":void 0,"created-at":void 0,"updated-at":void 0,"published-at":void 0,"purchase-notes":void 0,"is-require-privilege":void 0,"display-type":void 0,"content-type":void 0,"owner-type":void 0},meta:{"subscription-id":void 0},relationships:{"shop-item":void 0,radios:void 0,"published-radios":void 0,"published-audiobooks":void 0,skus:void 0,wallpapers:void 0,"sale-options":void 0,"album-bundles":void 0}},i=(0,n.Z)(l),s=e=>"albums"===e.get("type");class o extends i{isFree(){return this.getAttr("is-free")&&!this.getAttr("is-require-privilege")}displayAs(){return"audiobook"===this.getAttr("display-type")?this.getAttr("display-type"):this.getAttr("is-require-privilege")?"privilege_album":"album"}isAvailable(e,t){const a=this.getAttr("is-require-privilege")&&(null==e?void 0:e.getAttr("has-membership"))||!this.getAttr("is-free")&&t;return this.isFree()||a}getGiftSku(){const e=this.getRel("sale-options");return null==e?void 0:e.find((e=>0===e.getAttr("package")&&"redeem_code"===e.getAttr("delivery-type")))}getOwnSku(){const e=this.getRel("sale-options");return null==e?void 0:e.find((e=>0===e.getAttr("package")&&"ownership"===e.getAttr("delivery-type")))}getExpirableOwnSku(){const e=this.getRel("sale-options");return null==e?void 0:e.find((e=>"expirable_ownership"===e.getAttr("delivery-type")))}getAmount(){const e=this.getOwnSku();return null==e?void 0:e.getAttr("amount")}getSaleType(){if("join_podcast"===this.getAttr("owner-type"))return"join";const e=this.getAttr("is-free"),t=this.getAttr("is-require-privilege"),a=t&&!e;return a&&"radio"===this.getAttr("content-type")?"spec":a&&"video"===this.getAttr("content-type")?"devtalk":t||e?t&&e?"privilege":null:"audiobook"}getSaleTypeName(){const e=this.getSaleType();return e?r.gR[e]:null}}},59129:(e,t,a)=>{a.d(t,{gR:()=>T,It:()=>_,OV:()=>Z,yo:()=>f,fv:()=>c,D9:()=>E,$N:()=>h,w8:()=>g,Zc:()=>u,To:()=>v,op:()=>C,ad:()=>w,cn:()=>b,mo:()=>k,VW:()=>y,Ck:()=>N,cy:()=>I,V7:()=>P,wI:()=>S,default:()=>A});var n=a(17437),r=a(4148),l=a(43624),i=a(26270),s=a(34653),o=a(18351);const c="480",d={timeText:"一年",unit:"年",days:365,months:12,icon:r,card:l,avatar:s},m={timeText:"半年",unit:"半年",days:180,months:6,icon:n,card:i,avatar:o},u={479:{...d,skuId:"479",isGift:!1,test:!0},481:{...m,skuId:"481",isGift:!1,test:!0},488:{...d,skuId:"488",isGift:!1},489:{...m,skuId:"489",isGift:!1},[c]:{...d,skuId:c,isGift:!0},482:{...m,skuId:"482",isGift:!0}},p=e=>Object.keys(u).filter((t=>{const a=u[t];return e(a)})),g=p((e=>!e.isGift&&!e.test)),h=p((e=>e.isGift&&!e.test)),v=p((e=>!e.isGift)),E=p((e=>e.isGift)),f=p((()=>!0)),y="0",b=["0","625403"],k="69",C="42",_="85727",w=["257036","226085","326010"],N="421",P="524",S="307",Z="22860",I="562",T={spec:"SPEC",join:"入驻播客",privilege:"会员专享",devtalk:"DevTalk",audiobook:"有声书"},A={draftType:{ARTICLE:0,NEWS:1,TALK:2,RADIO:3,VIDEO:4},feedback:{type:{BUG:0,SUGGESTION:1,ACCOUNT:3,CONTENT_AUDIT:2},platform:{IOS:0,ANDROID:1,WEB:2}},tag:{GAME:"14054",ACG:"291",MEDIA:"14065",LIFESTYLE:"442",TOY:"14162",TECH:"14064",DESIGN:"14063"},category:{NEWS:"2",GADIO_NEWS:"45",GADIO_WAVE:"87"},audioCategoryIds:["12","13","14","45","49","53","62","87","38","52","64","84","85"],videoCategoryIds:["15","16","23","43","46","47","50","63","82"],audioBookLikeAlbumIds:["81","43","99"],articleCategoryIds:["6","18","19","20","27","28","29","35","41","42","55","56","58","59","60","61"],normalUserCategoryIds:["2","18","19","20","27","28","29","35","41","42","55","56","58","60","61","66"],paidAlbumIds:["69","66","64"],nextGeneration:{videoTagId:"22180",hardwareTagId:"22179",newsTagId:"22181",ps5TagId:"19562",xsxTagId:"22043"},tagNamesHidden:["次世代硬件汇总","次世代预告片","次世代资讯汇总"],page2077CategoryId:"66"}},44671:(e,t,a)=>{a.d(t,{WD:()=>u.Z,Xn:()=>Le,Y_:()=>Te,_Y:()=>se.Z,dp:()=>N.Z,ll:()=>qe,lt:()=>Me,n5:()=>C.Z,pK:()=>xe,pT:()=>Re,rG:()=>Ae,v3:()=>y.Z});var n=a(23450),r=a.n(n),l=a(56264),i=a(13913),s=a(90402),o=a(31378),c=a(8667),d=a(50286),m=a(45100),u=a(5933),p=a(17398),g=a(47084),h=a(28682),v=a(30672),E=a(87206),f=a(43721),y=a(99778),b=a(4251),k=a(21434),C=a(16227),_=a(27320),w=a(24755),N=a(5305),P=a(50695),S=a(30716),Z=a(21799),I=a(21455),T=a(54881),A=a(69939),R=a(70435),D=a(3975),x=a(39257),M=a(66831),L=a(51688),q=a(73624),F=a(33424),B=a(83447),O=a(21483),U=a(12736),$=a(23698),G=a(32693),z=a(62805),H=a(10765),V=a(34751),W=a(89897),j=a(35206),K=a(17506),J=a(73995),Y=a(8163),X=a(4466),Q=a(8567),ee=a(74940),te=a(26853),ae=a(70755),ne=a(50823),re=a(23316),le=a(3506),ie=a(11085),se=a(74250),oe=a(10715),ce=a(80392),de=a(94954),me=a(7751),ue=a(76495),pe=a(33764),ge=a(50463),he=a(36978),ve=a(43735),Ee=a(45828),fe=a(93627),ye=a(962),be=a(80500),ke=a(50235),Ce=a(33882),_e=a(84397),we=a(18211),Ne=a(10629),Pe=a(71315),Se=a(84928),Ze=a(33827),Ie=a(89816);const Te=e=>(0,l.camelize)(r().singular(e)),Ae=e=>(0,l.decamelize)(r()(e),{separator:"-"}),Re=["animations","games","books","films","entries"],De=["celebrities","organizations","entities"],xe=[...Re,...De,"tags","terms"],Me=e=>Re.includes(e)?"entries":De.includes(e)?"entities":["tags"].includes(e)?"tags":e,Le={albums:i.Uo.Album,"album-bundles":i.Uo.AlbumBundle,articles:i.Uo.Article,originals:i.Uo.Original,radios:i.Uo.Radio,skus:i.Uo.Sku,videos:i.Uo.Video},qe={categories:u.Z,articles:s.Z,radios:o.Z,videos:c.Z,comments:p.Z,drafts:g.Z,notifications:v.Z,feeds:h.Z,reports:E.Z,sessions:f.Z,topics:b.Z,talks:y.Z,roles:k.Z,users:C.Z,votes:_.Z,tags:m.Z,"catalog-tags":de.Z,medias:w.Z,labels:d.Z,albums:N.Z,"album-bundles":W.Z,collections:P.Z,timelines:S.Z,banners:Z.Z,bookmarks:I.Z,subscriptions:T.Z,preferences:A.Z,"private-mails":R.Z,"private-mail-threads":D.Z,celebrities:x.Z,organizations:M.Z,animations:L.Z,games:q.Z,"game-stores":F.Z,books:B.Z,films:O.Z,"shop-items":$.Z,"hosted-medias":U.Z,involvements:G.Z,skus:z.Z,wallpapers:H.Z,tickets:V.Z,"app-versions":j.Z,"operational-events":K.Z,giveaways:J.Z,"post-addresses":Y.Z,"giveaway-records":X.Z,"radio-catalogs":Q.Z,medals:ee.Z,"hosted-files":te.Z,"notable-entries":ae.Z,"talk-recommendations":ne.Z,"topic-recommendations":re.Z,"latest-updates":le.Z,"entry-contents":ie.Z,portfolios:se.Z,"portfolio-catalogs":oe.Z,"work-exhibitions":ce.Z,products:me.Z,"program-previews":ue.Z,"gapi-objects":pe.Z,"talk-original-recommendations":ge.Z,positions:he.Z,discussions:ve.Z,"organization-members":Ee.Z,"settlement-applications":fe.Z,helpfuls:ye.Z,"game-links":be.Z,"medal-centers":ke.Z,"app-configs":Ce.Z,"poll-records":_e.Z,"poll-options":we.Z,"entry-collections":Ne.Z,"user-vote-activity-records":Pe.Z,"vote-activity-options":Se.Z,"entry-vote-activities":Ze.Z,"latest-radios":Ie.Z}},6820:(e,t,a)=>{a.d(t,{ZW:()=>d,c2:()=>o,$F:()=>i,Nn:()=>I,ZD:()=>T,HL:()=>b,OX:()=>m,TB:()=>c,$f:()=>y,SM:()=>f,s1:()=>N,y:()=>s,AJ:()=>R,uV:()=>A,XT:()=>D,Ud:()=>P,_g:()=>S});var n=a(61756),r=a(57416);const l=(e,t)=>(0,r.V)((async t=>{const a=t.query({query:n.N8,variables:e});return await a}),t),i="PURCHASABLE_AVAILABILITY_SUCCEEDED",s=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return async a=>{let n;if(e instanceof Array){n=(await Promise.all(e.map((e=>a(l(e,t)))))).map(((t,a)=>({...t.data.purchasableAvailability,...e[a]})))}else{n={...(await a(l(e,t))).data.purchasableAvailability,...e}}a((e=>({type:i,payload:e}))(n))}},o="CHECK_SKU_SUCCEEDED",c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return async a=>{a((e=>({type:"CHECK_SKU",payload:e}))(e));const l=await a(((e,t)=>(0,r.V)((async t=>await t.query({query:n.L8,variables:e})),t,!1))(e,t)),i={...l.data.sku,...e};return a((e=>({type:o,payload:e}))(i)),i}},d="CHECK_PURCHASE_SUCCEEDED",m=function(e){return async t=>{t((e=>({type:"CHECK_PURCHASE",payload:e}))(e));const a=await t(((e,t)=>(0,r.V)((async t=>await t.query({query:n.ND,variables:e}))))(e));t((e=>({type:d,payload:e}))({isPurchased:a.data.checkPurchase,...e}))}};var u=a(91433),p=a(13913),g=a(59129),h=a(14810);const v=e=>(0,r.V)((async t=>await t.query({query:n.Mh,variables:{orderId:e}}))),E=(e,t,a)=>{var n,r;const l=null==e||null===(n=e.relationships)||void 0===n||null===(r=n[t])||void 0===r?void 0:r.data;if(!l||l instanceof Array&&0===l.length)return null;const i=l instanceof Array?l[0]:l;return a.find((e=>i.type===e.type&&i.id===e.id))},f=e=>{let{page:t,scenario:a,merchant:l}=e;return async e=>{const i=await e((e=>{let{page:t,limit:a,scenario:l,merchant:i}=e;return(0,r.V)((async e=>{const{limit:r,offset:s}=(0,h.hG)({page:t,limit:a});return await e.query({query:n.ju,variables:{scenario:l,merchant:i,first:r,offset:s,status:p.iF.Done}})}))})({page:t,limit:10,scenario:a,merchant:l})).catch((e=>e)),{orders:s,totalCount:o}=i.data.orderHistory,c=s.map((e=>e.skuId));if(c){const t=await e((0,h.D1)("/skus",{include:["albums","album-bundles","redeemed-sku"],filters:{id:Array.from(new Set(c)).join(",")},limit:10})),{included:a=[],data:n}=t.payload.origin;return{data:s.map((e=>((e,t,a)=>{const n=e.skuId,r=a.find((e=>e.id===n));if(!r)return null;const l=E(r,"album-bundles",t),i=E(r,"albums",t),s=E(r,"products",t),o=E(r,"redeemed-sku",t),c=l||i||s||o||r;let d,m=null==c?void 0:c.attributes.title,p=null==c?void 0:c.attributes.cover,h=null==c?void 0:c.attributes["gift-cover"];var v;if("skus"===c.type&&"membership"===c.attributes["delivery-type"])d="membership",m=c.attributes.name,p=c.attributes.image,h=(null===(v=g.Zc[c.id])||void 0===v?void 0:v.card)||h;else if("album-bundles"===c.type)d="album-bundles";else if("products"===c.type){var f,y;d="products",((null===(f=e.manifest)||void 0===f||null===(y=f.receipt)||void 0===y?void 0:y.length)??0)>1&&(m=`${m} 等`)}else{if("albums"!==c.type)return null;d="albums"}let b;return["album-bundles","albums"].includes(c.type)?b=(0,u.ZP)({type:c.type,id:c.id}):"membership"===d&&(b=(0,u.ZP)("gpass")),{sku:r,itemType:d,productType:c.type,productId:c.id,productLink:b,amount:e.amount??(null==r?void 0:r.attributes.amount),cover:p,giftCover:h,title:m,author:c.attributes.author,orderId:e.id,createdAt:e.createdAt,expiredAt:e.expiredAt,...e.redeemCode?{redeemCode:e.redeemCode}:null}})(e,a,n))).filter((e=>null!==e)),allPage:Math.ceil(o/10)||1}}return null}},y=(e,t)=>async a=>{var l;const i=await a(((e,t,a)=>(0,r.V)((async r=>{const{limit:l,offset:i}=(0,h.hG)({page:t,limit:a});return await r.query({query:n.Q$,variables:{first:l,offset:i,status:p.iF.Done,merchant:e}})})))(e,t,10)).catch((e=>e)),{audioBooks:s,totalCount:o}=(null==i||null===(l=i.data)||void 0===l?void 0:l.audioBookHistory)||{};return{data:s||[],allPage:Math.ceil((o||0)/10)||1}},b=e=>async t=>{var a,n;const r=await t(v(e));return(null==r||null===(a=r.data)||void 0===a||null===(n=a.order)||void 0===n?void 0:n.status)===p.iF.Done?[!0,r.data.order]:[!1,r]};var k=a(2738),C=a(57852);const _=(e,t)=>{var a;e((0,C.bG)({body:`失败：${(null==t||null===(a=t.toString)||void 0===a?void 0:a.call(t))||"未知错误"}`}))},w=async(e,t)=>{var a;const l=await t((e=>(0,r.V)((async t=>await t.mutate({mutation:n.G6,variables:{skuId:e}}))))(e)).catch((e=>{e.name===k.Yl?t((0,C.Cc)()):t((0,C.bG)({body:"支付失败：未能获取订单"}))}));return null==l||null===(a=l.data)||void 0===a?void 0:a.placeOrder.id},N=e=>async t=>await w(e,t),P=e=>async t=>{t({type:"WECHAT_PLACE_ORDER_FROM_DESKTOP_WEB",payload:e});const a=await w(e,t);if(!a)return null;const l=await(async(e,t)=>{var a,l;const i=await t((0,r.V)((t=>t.mutate({mutation:n.w1,variables:{orderId:e}})))).catch((e=>{_(t,e)}));return i&&(null===(a=i.data)||void 0===a||null===(l=a.placeWeChatPayOrderFromDesktopWeb)||void 0===l?void 0:l.codeUrl)})(a,t);return l?{qrCode:l,orderId:a}:null},S=(e,t)=>async a=>{const l=await w(e,a);if(!l)return null;const i=await(async(e,t,a)=>{var l;const i=await a((0,r.V)((a=>a.mutate({mutation:n.EJ,variables:{orderId:e,openId:t}})))).catch((e=>{_(a,e)}));return null==i||null===(l=i.data)||void 0===l?void 0:l.placeWeChatPayOrderFromJsBridge})(l,t,a);return i?{invokeArgs:i,orderId:l}:null},Z=(e,t)=>"function"==typeof e?e(t):e,I=(e,t)=>async a=>{const l=await w(e,a);if(!l)return null;const i=await(async(e,t,a)=>{var l,i;const s=await a((0,r.V)((a=>a.mutate({mutation:n.yO,variables:{orderId:e,pageUrl:t}})))).catch((e=>{_(a,e)}));return null==s||null===(l=s.data)||void 0===l||null===(i=l.placeAlipayOrderFromDesktopWeb)||void 0===i?void 0:i.url})(l,Z(t,l),a);return i?{url:i,orderId:l}:null},T=(e,t)=>async a=>{const l=await w(e,a);if(!l)return null;const i=await(async(e,t,a)=>{var l,i;const s=await a((0,r.V)((a=>a.mutate({mutation:n.iz,variables:{orderId:e,pageUrl:Z(t,e)}})))).catch((e=>{_(a,e)}));return null==s||null===(l=s.data)||void 0===l||null===(i=l.placeAlipayOrderFromMobileWeb)||void 0===i?void 0:i.url})(l,t,a);return i?{url:i,orderId:l}:null},A=e=>async t=>{var a,l;const i=await t((0,r.V)((async t=>await t.mutate({mutation:n.ot,variables:{skuId:e}}))));return null==i||null===(a=i.data)||void 0===a||null===(l=a.purchaseWithGcoins)||void 0===l?void 0:l.order},R=e=>async t=>await t((0,r.V)((async t=>await t.mutate({mutation:(0,n.kD)(e),variables:{}})))),D=(e,t)=>async a=>{var l,i;const s=await a(((e,t)=>(0,r.V)((async a=>await a.mutate({mutation:n.S6,variables:{code:e,antibot:t}}))))(e,t)).catch((e=>e));return[null==s||null===(l=s.data)||void 0===l||null===(i=l.redeemCode)||void 0===i?void 0:i.success,s]}},23274:(e,t,a)=>{a.d(t,{N0f:()=>S.N0,xdX:()=>S.xd,ZW8:()=>F.ZW,c2n:()=>F.c2,emq:()=>g,VRJ:()=>n.VR,xUA:()=>w.xU,NqK:()=>D.Nq,A4A:()=>x.A4,Ss:()=>Z.Ss,pR5:()=>n.pR,OUY:()=>S.OU,$VM:()=>R.$V,MNG:()=>m,PBR:()=>S.PB,C9j:()=>b.C9,D41:()=>A.D,lXd:()=>b.lX,Nzc:()=>M.Nz,ElI:()=>M.El,qSY:()=>T.qS,yu_:()=>r.yu,rM4:()=>o,GSD:()=>P.GS,dT9:()=>P.dT,sij:()=>i,no9:()=>n.no,VKP:()=>b.VK,DTh:()=>b.DT,G1l:()=>Z.G1,grs:()=>D.gr,lC1:()=>v,TQf:()=>M.TQ,iPo:()=>M.iP,iB1:()=>x.iB,CUB:()=>Z.CU,$F5:()=>F.$F,z6A:()=>w.z6,TUc:()=>r.TU,a4N:()=>N.a4,rf9:()=>N.rf,wwb:()=>n.ww,Jut:()=>n.Ju,I8L:()=>n.I8,CpY:()=>n.Cp,LcC:()=>S.Lc,rOf:()=>S.rO,xRD:()=>S.xR,r3w:()=>N.r3,wCu:()=>_.wC,QT0:()=>S.QT,YOx:()=>N.YO,DzS:()=>N.Dz,Xy2:()=>S.Xy,Gew:()=>S.Ge,x_x:()=>_.x_,Cpd:()=>N.Cp,OXT:()=>F.OX,TBc:()=>F.TB,oer:()=>h,YGx:()=>n.YG,TcX:()=>D.Tc,YFy:()=>p,bto:()=>M.bt,X$M:()=>x.X$,$R0:()=>_.$R,OU3:()=>Z.OU,Bwi:()=>_.Bw,uSr:()=>_.uS,zb9:()=>n.zb,P_k:()=>S.P_,tGz:()=>R.tG,$f6:()=>F.$f,n37:()=>R.n3,d7q:()=>d,liG:()=>u,tse:()=>S.ts,uNh:()=>b.uN,Z1U:()=>b.Z1,SMG:()=>F.SM,KuO:()=>I.Ku,gPM:()=>M.gP,fez:()=>M.fe,SUC:()=>T.SU,sMA:()=>r.sM,keW:()=>c,ccU:()=>T.cc,SPY:()=>L.SP,BN1:()=>P.BN,BzH:()=>P.Bz,BBt:()=>P.BB,PRA:()=>S.PR,cVO:()=>S.cV,rw3:()=>s,txL:()=>n.tx,$Eb:()=>b.$E,Wlr:()=>b.Wl,ZQC:()=>n.ZQ,WTD:()=>I.WT,S5b:()=>L.S5,qSR:()=>S.qS,I6Z:()=>S.I6,VgH:()=>Z.Vg,Dyf:()=>D.Dy,waY:()=>E,T2o:()=>q.T,qr2:()=>f.q,mh_:()=>y.m,wHW:()=>b.wH,dag:()=>b.d,YlW:()=>M.Yl,wFx:()=>I.wF,y1f:()=>M.y1,zJ:()=>k.zJ,MnA:()=>x.Mn,_Ip:()=>T._I,D7c:()=>Z.D7,yap:()=>F.y,AJ2:()=>F.AJ,Zl8:()=>_.Zl,g$u:()=>w.g$,LWS:()=>k.LW,ORL:()=>k.OR,yD9:()=>n.yD,VlE:()=>n.Vl,rnS:()=>n.rn,tRK:()=>n.tR,yC4:()=>r.yC,qa_:()=>r.q,Zn9:()=>N.Zn,bG5:()=>n.bG,bFx:()=>C.b,I3_:()=>N.I3,tjw:()=>n.tj,GA2:()=>n.GA,CcW:()=>n.Cc,i9Z:()=>N.i9,OcJ:()=>S.Oc,h2o:()=>S.h2,F6_:()=>S.F6});var n=a(57852),r=a(65865),l=a(14810);const i="GET_WECHAT_TICKET",s=(0,l.qm)(i,(()=>["wechat-tickets/apply",{method:"POST",body:{data:{"wechat-type":"service"}}}])),o="GET_SHOP_ITEMS",c=(0,l.qm)(o,(e=>["shop-items",{filters:{"on-sale-state":"yes","shop-type":e},limit:18}])),d=(0,l.qm)("GET_COMMENT",(function(){return(0,l.wx)(...arguments)})),m="GET_COMMENTS",u=(0,l.qm)(m,(e=>{let{commentable:t,subCommentable:a,page:n,sort:r,refresh:i,includeSubCommentable:s}=e;return(0,l.gw)({commentable:t,subCommentable:a,refresh:i,includeSubCommentable:s},{page:n,sort:r,extraMeta:{sort:r}})})),p=(0,l.qm)("DELETE_COMMENT",(e=>(0,l.IJ)(e))),g="CLEAR_COMMENTS",h=e=>({type:g,payload:e}),v="POST_COMMENT",E=(0,l.qm)(v,(function(){return(0,l.Lf)(...arguments)}));a(48451);var f=a(70189),y=a(90171),b=a(26070),k=a(10233),C=a(32529),_=a(50077),w=a(67698),N=a(66487),P=a(20658),S=a(8362),Z=a(48353),I=a(87425),T=a(21889),A=a(70170),R=a(29069),D=a(64673),x=a(94040),M=a(97263),L=a(1361),q=a(27855),F=a(6820)},57852:(e,t,a)=>{a.d(t,{Cc:()=>o,Cp:()=>i,GA:()=>w,I8:()=>_,Ju:()=>N,OS:()=>s,VR:()=>c,Vl:()=>f,YG:()=>d,ZQ:()=>n.ZQ,bG:()=>u,no:()=>r,pR:()=>p,rn:()=>v,tR:()=>C,tj:()=>P,tx:()=>l,ww:()=>m,yD:()=>b,zb:()=>g});var n=a(50718);const r="LOADING_PAGE";function l(e){return{type:r,state:e}}const i="TOGGLE_SIGNIN_MODAL";function s(e){return{type:i,open:e}}function o(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],{tip:t="登录后可进行操作",tipType:a=n.ZQ.INFO}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=>{n(s(e)),t&&e&&n(u({body:t,type:a}))}}const c="CLOSE_MESSAGE",d=e=>({type:c,index:e}),m="SEND_MESSAGE",u=e=>{let{showMode:t="list",type:a=n.ZQ.ERROR,...r}=e;return{type:m,data:{showMode:[n.ZQ.SIGNIN_ALERT,n.ZQ.APP_ALERT,n.ZQ.APP_SUGGEST_ALERT,n.ZQ.BIND_PHONE,n.ZQ.LOADING,n.ZQ.COMMUNITY_PRO].includes(a)?"pop":t,type:a,...r}}},p="EXPIRE_TOKEN";function g(){return{type:p}}const h="SA_CLICK_TALK_WEIBO_SHARE";function v(e){return{type:h,category:"分享 - 讨论",action:"分享到微博",label:e,value:1}}const E="SA_CLICK_TALK_WECHAT_SHARE";function f(e){return{type:E,category:"分享 - 讨论",action:"分享到微信",label:e,value:1}}const y="SA_CLICK_SPEECH_PLAY";function b(e){return{type:y,category:"朗读",action:"点击播放",label:e,value:1}}const k="SA_STOP_SPEECH";function C(e){return{type:k,category:"朗读",action:"停止播放",label:e,value:1}}const _="TOGGLE_NAV_LAYOUT_COLLAPSED";function w(e){return{type:_,payload:e}}const N="SWITCH_THEME";function P(e){return{type:N,payload:e}}},91162:(e,t,a)=>{a.d(t,{H:()=>l,V:()=>r});var n=a(14810);const r=(0,n.qm)("getAppConfigs",(()=>["app-configs",{limit:1}])),l=(0,n.qm)("getReportReasons",(()=>["reports/reasons"]))},64673:(e,t,a)=>{a.d(t,{Dy:()=>l,Nq:()=>i,Tc:()=>s,gr:()=>r});var n=a(14810);const r="POST_BOOKMARK",l=(0,n.qm)(r,((e,t)=>(0,n.O4)({userID:e,bookmarkable:t}))),i="DELETE_BOOKMARK",s=(0,n.qm)(i,((e,t)=>(0,n.fK)({bookmarkID:e,bookmarkable:t})))},29069:(e,t,a)=>{a.d(t,{$V:()=>r,n3:()=>i,tG:()=>l});var n=a(14810);(0,n.qm)("GET_CATEGORIES",(e=>(0,n.XK)(e)));const r="GET_ALL_CATEGORIES",l=(0,n.qm)(r,(e=>(0,n.XK)({limit:100,...e,metaFields:{categories:[],...null==e?void 0:e.metaFields}}))),i=(0,n.qm)("GET_CATEGORY",(e=>(0,n.RP)(e)))},27855:(e,t,a)=>{a.d(t,{T:()=>n});const n=(0,a(14810).qm)("POST_EVENT_LOG",(e=>{let{type:t,loggable:a}=e;return["event-logs",{method:"POST",body:{data:{type:"event-logs",attributes:{"event-type":t},relationships:{loggable:{data:{id:a.get("id"),type:a.get("type")}}}}},meta:{disableMessages:!0}}]}))},70189:(e,t,a)=>{a.d(t,{q:()=>r});var n=a(14810);const r=(0,n.qm)("POST_FEEDBACK",(e=>(0,n.rL)(e)))},26070:(e,t,a)=>{a.d(t,{$E:()=>p,C9:()=>c,DT:()=>s,VK:()=>u,Wl:()=>o,Z1:()=>l,d:()=>i,lX:()=>r,uN:()=>d,wH:()=>m});var n=a(14810);const r="GET_NOTIFICATION_FEEDS",l=(0,n.qm)(r,(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,n.Lt)(e,{page:t,extraMeta:{refresh:a},limit:15})})),i=(0,n.qm)("POST_MARK_NOTIFICATION_FEEDS_SEEN",(e=>(0,n.kd)(e))),s="MARK_NOTIFICATION_FEEDS_SEEN",o=()=>({type:s}),c="GET_INTERACTION_FEEDS",d=(0,n.qm)(c,(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,n.RW)(e,{page:t,extraMeta:{refresh:a},limit:15})})),m=(0,n.qm)("POST_MARK_INTERACTION_FEEDS_SEEN",(e=>(0,n.Jp)(e))),u="MARK_INTERACTION_FEEDS_SEEN",p=()=>({type:u})},70170:(e,t,a)=>{a.d(t,{D:()=>r});var n=a(14810);const r="GET_LABELS";(0,n.qm)(r,(()=>(0,n.mF)()))},87425:(e,t,a)=>{a.d(t,{Ku:()=>r,WT:()=>i,wF:()=>l});var n=a(14810);const r=(0,n.qm)("GET_ORIGINAL",(function(){return(0,n.F1)(...arguments)})),l=(0,n.qm)("POST_ORIGINAL",(function(){return(0,n.LZ)(...arguments)})),i=(0,n.qm)("PATCH_ORIGINAL",(function(){return(0,n.eK)(...arguments)}));(0,n.qm)("DELETE_ORIGINAL",(e=>(0,n.C6)(e)))},97263:(e,t,a)=>{a.d(t,{El:()=>s,Nz:()=>c,TQ:()=>r,Yl:()=>l,bt:()=>i,fe:()=>d,gP:()=>o,iP:()=>m,y1:()=>u});var n=a(14810);const r="POST_MARK_PRIVATE_MAIL_THREADS_READ",l=(0,n.qm)(r,(e=>(0,n.au)(e))),i=(0,n.qm)("DELETE_PRIVATE_MAIL_THREAD",(e=>(0,n.lp)(e))),s="GET_PRIVATE_MAIL_THREADS",o=(0,n.qm)(s,(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,n.hF)(e,{page:t,limit:20,extraMeta:{refresh:a}})})),c=((0,n.qm)("GET_PRIVATE_MAIL_THREAD",(e=>(0,n.fk)(e))),"GET_PRIVATE_MAILS"),d=(0,n.qm)(c,(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return(0,n.Kx)({userID:e,opponentID:t},{page:a,extraMeta:{refresh:r}})})),m="POST_PRIVATE_MAIL",u=(0,n.qm)(m,((e,t,a)=>(0,n.Ke)({senderID:e,recipientID:t,bodyText:a})))},10233:(e,t,a)=>{a.d(t,{LW:()=>s,OR:()=>i,zJ:()=>l});var n=a(14810),r=a(56648);const l=(0,n.qm)("POST_REPORT",(e=>(0,n.QP)(e))),i=(0,r.q)("reportAndDeleteTalkSuccess",(e=>e)),s=e=>async t=>{t((0,r.q)("reportAndHandle"));const a=await t(l(e));if(a.error)return;(await t((0,n.D1)(`reports/${a.payload.data.id}/handle`,{method:"POST",meta:{successTip:"处理动态成功"}}))).error||t(i(e))}},65865:(e,t,a)=>{a.d(t,{TU:()=>s,q:()=>o,sM:()=>i,yC:()=>r,yu:()=>l});var n=a(14810);const r=(0,n.qm)("SEARCH",(function(){return(0,n.w4)(...arguments)})),l="GET_SEARCH_HOT",i=(0,n.qm)(l,((e,t)=>["search/recent-hot",{...t,meta:{type:e||"common",...null==t?void 0:t.meta},query:{type:e,...null==t?void 0:t.query}}])),s="SEARCH_SUGGEST",o=(0,n.qm)(s,(e=>(0,n.WL)(e)))},66487:(e,t,a)=>{a.d(t,{Cp:()=>p,Dz:()=>c,I3:()=>u,YO:()=>m,Zn:()=>o,a4:()=>i,i9:()=>d,r3:()=>g,rf:()=>r});var n=a(14810);const r="SECURITY_SIGN_UP_WITH_PHONE",l=(0,n.qm)(r,(e=>{let{avatar:t,location:a,nickname:n,password:r,phoneNumber:l,sex:i,verificationCode:s,intro:o}=e;return["security/signup",{method:"POST",body:{data:{avatar:t??void 0,location:a??void 0,nickname:n??void 0,password:r??void 0,intro:o??void 0,"phone-number":l,sex:i,"verification-code":s}}}]})),i="SECURITY_SIGN_UP_WITH_OAUTH",s=(0,n.qm)(i,(e=>{let{provider:t,avatar:a,location:n,nickname:r,password:l,phoneNumber:i,sex:s,verificationCode:o,authCode:c,intro:d,uid:m,wechatType:u}=e;return["security/signup-with-oauth",{method:"POST",body:{data:{avatar:a??void 0,code:c??void 0,location:n??void 0,nickname:r??void 0,password:l??void 0,intro:d??void 0,"phone-number":i,provider:t,sex:s,uid:m??void 0,"verification-code":o,"wechat-type":u}}}]})),o=e=>t=>"identity"===e.provider?t(l(e)):t(s(e)),c=(0,n.qm)("BIND_SOCIAL_ACCOUNT",((e,t)=>["security/bind-social-account",{method:"POST",body:{data:{provider:e,code:t}},meta:{successTip:"绑定成功"},requireSignin:!0}])),d=(0,n.qm)("UNBIND_SOCIAL_ACCOUNT",((e,t)=>["security/unbind-social-account",{method:"POST",body:{data:{provider:"wechat"===e?"weixin":e,password:t}},meta:{successTip:"解绑成功"},requireSignin:!0}])),m=(0,n.qm)("BIND_PHONE_NUMBER",((e,t,a)=>["security/bind-phone-number",{method:"POST",body:{data:{code:t,password:a,"phone-number":e}},meta:{successTip:"绑定成功"},requireSignin:!0}])),u=(0,n.qm)("SET_PASSWORD_FOR_LEGACY_USER",((e,t,a)=>["security/set-password-for-legacy-user",{method:"POST",body:{data:{"verification-code":t,password:a,"phone-number":e}},meta:{successTip:"绑定成功"},requireSignin:!0}])),p=(0,n.qm)("CHANGE_PASSWORD",((e,t)=>["security/reset-password",{method:"POST",body:{data:{"new-password":t,"new-password-confirmation":t,...e?{password:e}:{}}},meta:{successTip:"修改成功"},requireSignin:!0}])),g=(0,n.qm)("APPLY_FOR_ACCOUNT_DELETION",((e,t)=>["security/apply-for-account-deletion",{method:"POST",body:{data:{nickname:e,reason:t}}}]))},94040:(e,t,a)=>{a.d(t,{A4:()=>i,Mn:()=>l,X$:()=>s,iB:()=>r});var n=a(14810);const r="POST_SUBSCRIPTION",l=(0,n.qm)(r,((e,t)=>(0,n.VV)({userID:e,subscribable:t}))),i="DELETE_SUBSCRIPTION",s=(0,n.qm)(i,((e,t)=>(0,n.h1)({subscriptionID:e,subscribable:t})))},50077:(e,t,a)=>{a.d(t,{$R:()=>r,Bw:()=>s,Zl:()=>o,uS:()=>i,wC:()=>l,x_:()=>c});var n=a(14810);(0,n.qm)("POST_TALK",(function(){return(0,n.n0)(...arguments)})),(0,n.qm)("PATCH_TALK",(e=>(0,n.IA)(e)));const r=(0,n.qm)("DELETE_TALK",(e=>[`talks/${e}`,{method:"DELETE",meta:{deleteEntities:[{type:"talks",id:e}],successTip:"删除成功"}}])),l=(0,n.qm)("archiveTalk",(e=>[`talks/${e}/archive`,{method:"POST",meta:{type:"talks",id:e,successTip:"折叠成功"}}])),i=(0,n.qm)("editorSelectTalk",(e=>[`talks/${e}/editor-select`,{method:"POST",meta:{successTip:"标记精选成功"}}])),s=(0,n.qm)("editorDeselectTalk",(e=>[`talks/${e}/editor-deselect`,{method:"POST",meta:{successTip:"取消成功"}}])),o=(0,n.qm)("recommendTalk",(e=>[`talks/${e}/make-recommendation`,{method:"POST",meta:{successTip:"推送首页成功"}}])),c=(0,n.qm)("cancelRecommendTalk",(e=>[`talks/${e}/cancel-recommendation`,{method:"POST",meta:{successTip:"取消成功"}}]))},21889:(e,t,a)=>{a.d(t,{SU:()=>i,_I:()=>r,cc:()=>s,qS:()=>l});var n=a(14810);const r=(0,n.qm)("POST_TAG",(e=>(0,n.Um)(e))),l="GET_RADIO_CATALOGS",i=(0,n.qm)(l,(()=>["radio-catalogs",{limit:100,include:["tag"]}])),s=(0,n.qm)("GET_TERM",((e,t)=>{let{type:a,id:n}=e;return[`${a}/${n}`,t]}))},1361:(e,t,a)=>{a.d(t,{S5:()=>l,SP:()=>r});var n=a(14810);const r=(0,n.qm)("GET_TICKETS",((e,t)=>[e?`users/${e}/tickets`:"tickets",t])),l=(0,n.qm)("PATCH_TICKET",((e,t)=>[`tickets/${e}`,{method:"PATCH",body:{data:{type:"tickets",id:e,attributes:t}}}]));(0,n.qm)("POST_TICKET",(e=>{let{title:t,content:a,catalog:n,userId:r}=e;return["tickets",{method:"POST",meta:{successTip:"申请成功"},body:{data:{type:"tickets",attributes:{title:t,content:a,catalog:n},relationships:{user:{data:{id:r,type:"users"}}}}}}]}))},20658:(e,t,a)=>{a.d(t,{BB:()=>m,BN:()=>o,Bz:()=>p,GS:()=>d,dT:()=>u});var n=a(50718),r=a(59129),l=a(14810),i=a(82492),s=a.n(i);const o=(0,l.qm)("GET_TOPIC",((e,t)=>(0,l.nf)(e,t))),c=function(e){let{id:t,currentUserId:a}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{path:o,queryOptions:c={}}=((e,t)=>e===n.Od.HOT_TOPICS_CATALOG_ID?{path:"popular-topics"}:e===n.Od.SUBSCRIBED_TOPICS_CATALOG_ID?t?{path:`users/${t}/subscribed-topics`}:{path:""}:{path:`categories/${e}/topics`,queryOptions:e===r.mo?{filters:{"is-pro":"1"}}:{}})(t,a);return(0,l.BB)(o,{limit:20,...s()({metaFields:{topics:[]}},c,i)})},d="GET_TOPICS",m=(0,l.qm)(d,c),u=((0,l.qm)("GET_PRO_TOPICS",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return c({id:r.mo},e)})),"GET_TOPIC_CATEGORIES"),p=(0,l.qm)(u,(e=>(0,l.XK)({limit:100,filters:{scope:"topic"},...e})))},8362:(e,t,a)=>{a.d(t,{F6:()=>p,Ge:()=>y,I6:()=>c,Lc:()=>v,N0:()=>g,OU:()=>d,Oc:()=>E,PB:()=>r,PR:()=>i,P_:()=>m,QT:()=>C,Xy:()=>h,cV:()=>s,h2:()=>k,qS:()=>o,rO:()=>b,ts:()=>l,xR:()=>u,xd:()=>f});var n=a(14810);const r="GET_CURRENT_USER",l=(0,n.qm)(r,((e,t)=>(0,n.lc)(e,{includeQueryPush:["role"],...t}))),i=(0,n.qm)("GET_USER",((e,t)=>(0,n.lc)(e,t))),s=(0,n.qm)("GET_USER_WITH_PREFERENCE",((e,t)=>(0,n.ii)(e,t))),o=(0,n.qm)("PATCH_USER",((e,t)=>[`users/${e}`,{method:"PATCH",body:{data:{type:"users",id:e,attributes:t}},meta:{successTip:"更新成功"},requireSignin:!0}])),c=(0,n.qm)("PATCH_USER_PREFERENCE",((e,t)=>[`preferences/${e}`,{method:"PATCH",body:{data:{type:"preferences",id:e,attributes:t}},meta:{successTip:"更新成功"},requireSignin:!0}])),d="FOLLOW_USER",m=(0,n.qm)(d,((e,t)=>(0,n.AV)({followerID:e,followeeID:t}))),u="UNFOLLOW_USER",p=(0,n.qm)(u,((e,t)=>(0,n.Dd)({followerID:e,followeeID:t}))),g="BLACKLIST_USER",h=(0,n.qm)(g,((e,t)=>[`users/${e}/relationships/blacklisted-users`,{method:"POST",body:{data:[{type:"users",id:t}]},meta:{actorID:e,blacklistedId:t}}])),v="UNBLACKLIST_USER",E=(0,n.qm)(v,((e,t)=>[`users/${e}/relationships/blacklisted-users`,{method:"DELETE",body:{data:[{type:"users",id:t}]},meta:{actorID:e,unblacklistedId:t}}])),f="BLOCK",y=(0,n.qm)(f,((e,t)=>{let{type:a,id:n}=t;return[`users/${e}/relationships/${"users"===a?"blocked-authors":"blocked-topics"}`,{method:"POST",body:{data:[{type:a,id:n}]},meta:{successTip:"请求成功",blockable:{type:a,id:n}}}]})),b="UNBLOCK",k=(0,n.qm)(b,((e,t)=>{let{type:a,id:n}=t;return[`users/${e}/relationships/${"users"===a?"blocked-authors":"blocked-topics"}`,{method:"DELETE",body:{data:[{type:a,id:n}]},meta:{successTip:"取消成功",blockable:{type:a,id:n}}}]})),C=(0,n.qm)("banUser",((e,t)=>{let{reason:a,seconds:n}=t;return[`users/${e}/ban`,{method:"POST",body:{data:{reason:a,seconds:n}},meta:{successTip:"禁言成功"}}]}))},48353:(e,t,a)=>{a.d(t,{CU:()=>r,D7:()=>l,G1:()=>i,OU:()=>c,Ss:()=>o,Vg:()=>s});var n=a(14810);const r="POST_VOTE",l=(0,n.qm)(r,((e,t,a)=>(0,n.OB)({userID:e,votable:t,voteFlag:a}))),i="PATCH_VOTE",s=(0,n.qm)(i,((e,t,a)=>(0,n.d1)({voteID:e,voteFlag:t,votable:a}))),o="DELETE_VOTE",c=(0,n.qm)(o,((e,t)=>(0,n.a5)({voteID:e,votable:t})))},28816:(e,t,a)=>{a.d(t,{D$:()=>s,Pj:()=>o,wI:()=>c});var n=a(30213),r=a(14810),l=a(57852);const i=(0,r.qm)("resetWork",(function(e){return[`${arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"talks":"originals"}/${e}/reset-work`,{method:"POST",meta:{successTip:"移除作品成功"}}]})),s=e=>{let{workId:t,workType:a,removePortfolioType:n}=e;return async e=>{const s="portfolios"===a?await e((o=t,c=n,e=>e("containChildren"===c?(0,r.D1)(`portfolios/${o}/delete-and-reset-works`,{method:"POST",meta:{successTip:"删除合集成功"}}):(0,r.D1)(`portfolios/${o}`,{method:"DELETE"})))):await e(i(t,"talks"===a));var o,c;return s.error&&e((0,l.bG)({body:"请求失败，请稍后重试"})),s}},o=e=>{if(!e)return{attributes:{},relationships:{}};const{enable:t,isProtected:a,notificationEnabled:r,catalogTags:l,portfolio:i}=e,s=(0,n.uk)({"work-enabled":t,"work-is-protected":a,"work-notification-enabled":r}),o={};if(void 0!==i)if(i){const e="string"==typeof i?i:i.get("id");o.portfolios={data:[{id:e,type:"portfolios"}]}}else o.portfolios={data:[]};return void 0!==l&&(o["catalog-tags"]={data:l.map((e=>({id:e,type:"tags"})))}),{attributes:s,relationships:o}},c=(0,r.qm)("updateWorkProperties",(e=>{let{id:t,workType:a,successTip:n="更新成功",...r}=e;return[`${a}/${t}`,{method:"PATCH",body:{data:{id:t,type:a,...o(r)}},include:["user","portfolios","catalog-tags.parent-tag"],meta:{successTip:n}}]}))},85540:(e,t,a)=>{a.d(t,{AA:()=>y,G5:()=>E,GN:()=>C,JW:()=>k,MR:()=>p,P7:()=>N,Xk:()=>f,Z:()=>u,ZP:()=>S,an:()=>g,i8:()=>P,vd:()=>b});var n=a(94301),r=a.n(n),l=a(41609),i=a.n(l),s=a(42554),o=a(54186),c=a(82285),d=a(57852),m=a(52435);const u="REQUEST",p="SUCCESS",g="FAILURE",h=`${u}_FROM_`,v=`${p}_FROM_`,E=e=>`${h}${e}`,f=e=>`${v}${e}`,y=e=>e.includes(u),b=e=>e.includes(p),k=e=>e.includes(g),C=function(){let{payload:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e instanceof Error};function _(e,t,a){const{status:n}=t;let{statusText:r}=t;if(404===n)r="未找到指定资源";else if(403===n)r="权限不足";else if(401===n)r="身份验证会话已过期，请重新登录",c.ZP.push("/waiting"),setTimeout((()=>{e((0,d.zb)()),c.ZP.push("/")}),1e3);else{const e=(0,m.y)(a);e&&(r=e)}const l=new s.ApiError(n,r,a);return l.code=n,l}function w(e){for(var t,a=arguments.length,n=new Array(a>1?a-1:0),r=1;r<a;r++)n[r-1]=arguments[r];console.warn(...n,`Response[${null===(t=e.constructor)||void 0===t?void 0:t.name}]`,`[url]${e.url}`,`[ok]${e.ok}`,`[status]${e.status}`,`[statusText]${e.statusText}`,`[type]${e.type}`)}function N(e){const{method:t="GET",requireSignin:a=!1,meta:n={},path:l,secondaryActionTypes:c,endpoint:h,...v}=e,E=h||`${o.default.api_url}/${l}`,f=Array.isArray(c)&&3===c.length,[y,b,k]=f?c:[u,p,g];const C=Object.assign({fetch:r()},"undefined"!=typeof FormData&&v.body instanceof FormData?{}:{headers:{"Content-Type":"application/vnd.api+json"}},v);return(e,r)=>{const l=r().getIn(["session","token"]);if(a&&i()(l)){const t={error:!0,type:k,payload:new s.ApiError(403,"需要登录才能执行此操作",null),meta:n};return e(t),e((0,d.OS)(!0)),Promise.resolve(t)}i()(l)||(C.headers={...C.headers,Authorization:`Token token=${l}`});const o={method:t,endpoint:E,...f?{credentials:"same-origin"}:{},types:[{type:y,meta:n},{type:b,payload:(e,t,a)=>function(e,t){return 204===t.status?t.text():t.json().then((e=>(0,m.L)(e))).catch((e=>(w(t,"API SUCCESS: 请求出错或返回结果解析失败: ",`Error: ${e}`),e)))}(0,a),meta:n},{type:k,payload:(t,a,n)=>function(e,t){return w(t,"API FAILURE"),t.json().then((a=>_(e,t,a))).catch((()=>_(e,t)))}(e,n),meta:n}],...C};return e({[s.RSAA]:o})}}function P(e,t){const a=t([`REQUEST_FROM_${e}`,`SUCCESS_FROM_${e}`,`FAILURE_FROM_${e}`]);return a.toString=()=>e,a}const S=N},85061:(e,t,a)=>{a.d(t,{PR:()=>I,zu:()=>y,VP:()=>k,CG:()=>_,Aw:()=>C,kU:()=>f,Du:()=>v,rh:()=>E,UQ:()=>h});var n=a(35369),r=a(85564),l=a.n(r),i=a(45578),s=a.n(i),o=a(89734),c=a.n(o),d=a(44671),m=a(85540);a(56264);const u={START:"START",COMPLETED:"COMPLETED",FAILED:"FAILED"};function p(e){this.currentAction=void 0,this.handlers={},this.afterReducer=function(e){return e},this.ASYNC_PHASES=e.ASYNC_PHASES||u,this.typeConstructor=e.typeConstructor||((e,t)=>`${t}_${e}`)}p.prototype={when(e,t){return Array.isArray(e)?(this.currentAction=void 0,e.forEach((e=>{this.handlers[e]=t}))):(this.currentAction=e,this.handlers[this.typeConstructor(this.ASYNC_PHASES.START,this.currentAction)]=t),this},start(e){return this._guardDoneAndFailed(),this.handlers[this.typeConstructor(this.ASYNC_PHASES.START,this.currentAction)]=e,this},done(e){return this._guardDoneAndFailed(),this.handlers[this.typeConstructor(this.ASYNC_PHASES.COMPLETED,this.currentAction)]=e,this},failed(e){return this._guardDoneAndFailed(),this.handlers[this.typeConstructor(this.ASYNC_PHASES.FAILED,this.currentAction)]=e,this},build(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=arguments.length>1?arguments[1]:void 0;const r=n?e.handlers[n.type]:void 0;let l=a;return"function"==typeof r&&(l=r(a,n)),e.afterReducer(l,{prevState:a,action:n})}},after(e){return e&&(this.afterReducer=e),this},_guardDoneAndFailed(){if(!this.currentAction)throw new Error('Method "done" & "failed" must follow the "when(action, ?handler)", and "action" should not be an array')}};const g=e=>{const t=e&&!e.error&&e.payload&&!(e.payload instanceof Error);return t||console.warn("检测到错误的 action payload",e),t},h=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,n.Map)();return a&&a.get("ids")?a.update("ids",(a=>function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,n.List)();if(!a)return(0,n.List)();const r=a.findIndex((a=>a.get("type")===e&&a.get("id")===t));return r>=0?a.delete(r):a}(e,t,a))):a},v=()=>{let e=null;return e=window.__PRELOADED_STATE__,e&&((e=>{if(!e)return;Object.keys(e).forEach((t=>{const a=e[t];Object.keys(a).forEach((e=>{const n=a[e],r=new(0,d.ll[t])(n);a[e]=r}))}))})(e.entities),e=(0,n.fromJS)(e),delete window.__PRELOADED_STATE__),e},E=e=>new RegExp(`^(${m.Z}|${m.MR}|${m.an})`).test(e.type),f={success:"success",page:"page",result:"result",loadMore:"loadMore",origin:"origin"};function y(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)()).merge({isRequesting:!1,error:null,fetched:!1})}function b(e){return!e.error&&e.meta?{actionMeta:e.meta}:null}function k(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;return e.merge({...b(t),isRequesting:!t.error,error:t.error?t.payload:null,fetched:!1})}function C(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;return e.merge({...b(t),isRequesting:!1,error:t.payload,fetched:!0})}function _(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),a=arguments.length>1?arguments[1]:void 0;const{payload:r}=a;return t.merge({...b(a),isRequesting:!1,error:a.error?r:null,fetched:!0,fetchedAt:Date.now(),meta:null==r||null===(e=r.origin)||void 0===e?void 0:e.meta})}function w(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),a=arguments.length>1?arguments[1]:void 0;return _(t,a).set("origin",null===(e=a.payload)||void 0===e?void 0:e.origin)}function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0,a=_(e,t);if(!g(t))return a;const{result:r}=t.payload;return a=a.set(r instanceof Array?"ids":"id","object"==typeof r?(0,n.fromJS)(r):r),a.set("noMore",!0)}function P(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;const a=_(e,t);if(!g(t))return a;const r=t.payload,{meta:l}=r.origin,i=l?l["record-count"]:0,s=Number(t.meta.page)||0,o=Math.ceil(i/t.meta.limit)||1;return a.merge({ids:(0,n.fromJS)(r.result||[]),currentPage:s,allPage:o,noMore:s===o,recordCount:i})}const S=e=>s()(e,(e=>`${e.type}${e.id}`));function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0,a=_(e,t);if(!g(t))return a;const{payload:r,meta:i}=t,{result:s=[],origin:{meta:{"record-count":o}={}}}=r,{pageTimestamp:d,refresh:m}=i;if(!(s instanceof Array))return a;if(d)return a.merge({ids:(0,n.fromJS)(S(m?s:a.get("ids",(0,n.List)()).toJS().concat(s))),fetchedPagesMap:(0,n.Map)(),fetchedPages:(0,n.List)(),currentPage:d,allPage:-1,noMore:0===s.length||"number"==typeof i.limit&&s.length<i.limit,recordCount:-1});const u=i.recordCount??o??0,p=Number(i.page)||1,h=Math.ceil(u/i.limit)||1,v=m??1===p,E=0===s.length||0!==u&&p>=h||"number"==typeof i.limit&&s.length<i.limit,f=v?{}:e.get("fetchedPagesMap",(0,n.Map)()).toJS();f[p]=s;const y=c()(Object.keys(f).map((e=>Number(e)))),b=S(l()(y.map((e=>f[e]))));return a=a.merge({ids:(0,n.fromJS)(b),fetchedPagesMap:(0,n.Map)(f),fetchedPages:(0,n.fromJS)(y),currentPage:p,allPage:h,noMore:E,recordCount:u}),a}function I(e,t){return new p({ASYNC_PHASES:{START:"REQUEST_FROM",COMPLETED:"SUCCESS_FROM",FAILED:"FAILURE_FROM"},typeConstructor:(e,t)=>`${e}_${t}`}).when(e,((e,t)=>k(e,t))).done(((e,a)=>{let n;switch(t){case f.success:n=_;break;case f.origin:n=w;break;case f.page:n=P;break;case f.result:n=N;break;case f.loadMore:n=Z;break;default:n=_}return n(e,a)})).failed(((e,t)=>C(e,t)))}},28680:(e,t,a)=>{a.d(t,{b:()=>l,x:()=>s});var n=a(14810),r=a(85061);const l=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const r=(0,n.wH)(e,a);return{name:e,actionName:r,action:(0,n.qm)(r,t)}},i=e=>{var t;if(!e)return null;const a=null===(t=e.payload)||void 0===t?void 0:t.data;if(null!=a&&a.type&&null!=a&&a.id)return[a.type,a.id];const n=e.meta;return null!=n&&n.type&&null!=n&&n.id?[n.type,n.id]:null},s=function(e,t){let{namespace:a="",reducerDefault:n="result",initialData:s=(0,r.zu)(),withoutReducer:o=!1,reducerAfter:c,removeIdActions:d}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{actionName:m,action:u}=l(e,t,a);return{name:e,action:u,...o?null:{reducer:(0,r.PR)(m,r.kU[n]).after(((e,t)=>{const a=c?c(e,t):e;if(!d)return a;const n=Object.keys(d);for(const e of n){const n=d[e],l="function"==typeof n?n:i;if(t.action.type===e){const e=l(t.action);if(!e)return a;const[n,i]=e;return(0,r.UQ)(n,i,a)}}return a})).build(s)}}}},85311:(e,t,a)=>{a.d(t,{Z:()=>p});var n=a(72739),r=a(14810),l=a(28680);const i="gpass",s=(0,l.x)("getAlbums",(()=>(0,r.R1)({filter:"privilege_album"},{limit:10})),{namespace:i,reducerDefault:"result"}),o=(0,l.x)("getDiscountProducts",(()=>["products",{filters:{"is-privilege-discount":"true","is-published":"true"},limit:10}]),{namespace:i,reducerDefault:"result"}),c=(0,l.x)("getPrivilegeProducts",(()=>["products",{filters:{"is-require-privilege":"true","is-published":"true"},limit:10}]),{namespace:i,reducerDefault:"result"}),d=(0,l.x)("getAudiobooks",(()=>["albums",{filters:{"redeemable-with-credit":"true"},sorts:["-published-at"],limit:10}]),{namespace:i,reducerDefault:"result"}),m=(0,l.x)("getPrivilegeBanners",(()=>["banners",{filters:{"before-date":(new Date).toISOString(),slug:"gpass-privilege-albums"},limit:1}])),u=()=>async e=>await Promise.all([e(s.action())]),p={namespace:i,actions:{[s.name]:s.action,[o.name]:o.action,[c.name]:c.action,[d.name]:d.action,[m.name]:m.action,getAlbumsWithBanners:u,getGpassRecommendations:()=>async e=>await Promise.all([e(o.action()),e(c.action()),e(d.action()),e(u())])},reducer:(0,n.U)({albums:s.reducer,discountProducts:o.reducer,privilegeProducts:c.reducer,audiobooks:d.reducer,privilegeBanners:m.reducer})}},13214:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(35369);const r="voters",l=(0,a(28680).x)("getVoters",((e,t,a)=>[`/${e}/${t}/up-voters`,{limit:10,page:a,meta:{votableType:e,votableId:t}}]),{reducerDefault:"loadMore",namespace:r}),i={namespace:r,actions:{[l.name]:l.action},reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type.includes(l.action.toString())){const{votableType:a,votableId:n}=t.meta,r=[a,n];return e.updateIn(r,(e=>l.reducer(e,t)))}return e}}},80859:(e,t,a)=>{a.d(t,{H:()=>l,R:()=>r});var n=a(38854);function r(){let{tagId:e,filter:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;const r=e?`tags/${e}/albums`:"albums";return(0,n.BB)(r,{sorts:["-published-at"],...a,filters:{"hide-albums-require-privilege":"0","hide-albums-video-type":"false",...t?{"display-type":"audiobook"===t?"audiobook":"album","is-require-privilege":"privilege_album"===t?"true":"false","limit-published-at":"privilege_album"===t?"0":"1"}:{},...null==a?void 0:a.filters},metaFields:{albums:[],...null==a?void 0:a.metaFields}})}function l(e,t){return(0,n.BB)(`albums/${e}`,t)}},26362:(e,t,a)=>{a.d(t,{$:()=>r});var n=a(38854);function r(){let{tagID:e,mode:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)("banners",{include:["target"],filters:{"before-date":(new Date).toISOString(),tags:e,mode:t},sorts:["-published-at"],...a})}},49182:(e,t,a)=>{a.d(t,{Ll:()=>l,O4:()=>r,fK:()=>i});var n=a(38854);function r(e){let{userID:t,bookmarkable:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=(0,n.I0)({type:"bookmarks",relationships:{user:{type:"users",id:t},bookmarkable:a}});return(0,n.BB)("bookmarks",{method:"POST",body:l,meta:{bookmarkable:a,successTip:"收藏成功"},requireSignin:!0,...r})}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`users/${e}/bookmarks`,{query:{include:["bookmarkable"]},...t})}function i(e){let{bookmarkID:t,bookmarkable:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`bookmarks/${t}`,{method:"DELETE",requireSignin:!0,meta:{bookmarkable:a,deleteEntities:[{type:"bookmarks",id:t}]},...r})}},92940:(e,t,a)=>{a.d(t,{O:()=>l,k:()=>r});var n=a(38854);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`collections/${e}`,{...t})}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="collections";return e&&(a=`tags/${e}/${a}`),(0,n.BB)(a,{sort:"updated-time",...t,metaFields:{collections:[],...t.metaFields}})}},38854:(e,t,a)=>{a.d(t,{I0:()=>n.I0,TF:()=>n.TF,wH:()=>n.wH,wE:()=>m,qm:()=>r.qm,D1:()=>r.D1,Sv:()=>o,hG:()=>n.hG,BB:()=>r.BB,Ck:()=>c,De:()=>d});var n=a(13718),r=a(92380),l=a(85564),i=a.n(l);const s=["article","radio","video"],o=[...s,...i()(s.map((e=>["category","user","djs","media"].map((t=>`${e}.${t}`)))))],c=["topic","user","helpful","poll-options",...["radio","video","article","game","film","album","album-bundle","product","discussion"].map((e=>`related-content.${e}`))],d=["talk",...c.map((e=>`talk.${e}`))],m=["involvements.entity.user"]},13718:(e,t,a)=>{a.d(t,{I0:()=>o,TF:()=>s,hG:()=>c,ix:()=>u,pS:()=>d,wH:()=>p});var n=a(54186),r=a(30213),l=a(56264);const i=e=>e&&e.type&&Number(e.id)>0,s=e=>e.data&&e.data.type&&e.data.id,o=e=>{if(s(e))return e;const{type:t,id:a,dataAttributes:n,relationships:l}=e,o={data:{id:a,type:t,attributes:n}};return l&&Object.keys(l).forEach((e=>{const t=l[e];((e,t,a)=>{if(!e||!a)return;let n=null;a instanceof Array?0===a.length?n=a:(n=a.filter((e=>i(e))),0===n.length&&(n=null)):i(a)&&(n=a),n&&(e.relationships=e.relationships??{},e.relationships[t]={data:n})})(o.data,e,t)})),(0,r.uk)(o)},c=function(){let{page:e=1,limit:t=n.default.pageLimit,startOffset:a=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{limit:t,offset:t*(e-1)+a}},d=function(){const{limit:e,offset:t}=c(...arguments);return{"page[limit]":e,"page[offset]":t}},m={"updated-time":"-updated-at","published-time":"-published-at",time:"-created-at",hits:"-hits",score:"-score"},u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"time";return m[e]||`-${e}`},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,l.decamelize)(`${e}${t&&`_in_${t}`}`).toUpperCase()}},14810:(e,t,a)=>{a.d(t,{AV:()=>g.AV,BB:()=>w.BB,C6:()=>l.C6,CS:()=>s.CS,Ck:()=>w.Ck,D1:()=>w.D1,DO:()=>s.DO,Dd:()=>g.Dd,De:()=>w.De,F1:()=>l.F1,Hj:()=>h.H,IA:()=>m.IA,IJ:()=>i.IJ,Jp:()=>c.Jp,KW:()=>f.K,Ke:()=>_.Ke,Kx:()=>_.Kx,LZ:()=>l.Jp,Lf:()=>i.Lf,Ll:()=>k.Ll,Lt:()=>c.Lt,Me:()=>l.Me,NT:()=>C.NT,Nl:()=>b.N,O4:()=>k.O4,OB:()=>p.OB,Ov:()=>v.O,QP:()=>d.Q,R1:()=>h.R,RP:()=>r.R,RW:()=>c.RW,Sv:()=>w.Sv,Um:()=>f.U,VV:()=>C.VV,WL:()=>E.W,XK:()=>r.X,a5:()=>p.a5,au:()=>_.au,bR:()=>l.bR,d1:()=>p.d1,eK:()=>l.eK,fK:()=>k.fK,fk:()=>_.fk,gw:()=>i.gw,h1:()=>C.h1,hA:()=>s.hA,hF:()=>_.hF,hG:()=>w.hG,ii:()=>g.ii,kT:()=>v.k,kd:()=>c.kd,lc:()=>g.lc,lp:()=>_.lp,mF:()=>y.m,n0:()=>m.n0,nf:()=>u.n,qm:()=>w.qm,rL:()=>o.r,ro:()=>l.ro,tD:()=>n.$,w4:()=>E.w,wE:()=>w.wE,wH:()=>w.wH,wx:()=>i.wx});var n=a(26362),r=a(8629),l=a(86757),i=a(30229),s=a(39192),o=a(2546),c=a(9653),d=a(42064),m=a(78845),u=a(76489),p=a(57591),g=a(37456),h=a(80859),v=a(92940),E=a(29163),f=a(25028),y=a(65853),b=a(33357),k=a(49182),C=a(50901),_=a(77849),w=a(38854)},33357:(e,t,a)=>{a.d(t,{N:()=>r});var n=a(38854);function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.BB)("medias",{needSort:!0,...e})}},86757:(e,t,a)=>{a.d(t,{C6:()=>b,F1:()=>E,Fl:()=>d,Jp:()=>f,Me:()=>v,bR:()=>g,eK:()=>y,ro:()=>h});var n=a(38854),r=a(59129),l=a(44671),i=a(90402),s=a(8667),o=a(31378);const{category:c}=r.default,d=e=>{if((0,n.TF)(e))return e;const{userID:t,categoryID:a,mediaID:r,dataAttributes:l={},...i}=e;return(0,n.I0)({...i,dataAttributes:l,relationships:{media:{type:"medias",id:r},user:{type:"users",id:t},category:{type:"categories",id:a},...i.relationships}})},m=(e,t,a)=>a&&!e.includes(t)?`${e},${t}`:e,u=e=>Object.keys(e.relationships),p=function(e,t){let{isStaff:a=!1,withContent:n=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(e=>"articles"===e?u(i.f):"videos"===e?u(s.f):"radios"===e?u(o.f):[])(t);let l=e[`fields[${t}]`]||"title,desc,excerpt,is-published,thumb,app-cover,cover,comments-count,likes-count,bookmarks-count,is-verified,published-at,option-is-official,option-is-focus-showcase,duration".split(",").concat(r).join(",");l=m(l,"created-at",a),l=m(l,"content",n),l=m(l,"is-free",["radios","videos"].includes(t)),l=m(l,"is-require-privilege",["radios","videos"].includes(t)),e[`fields[${t}]`]=l},g=(e,t)=>{for(const a of["articles","videos","radios"])p(e,a,t)};function h(){let{parentUnique:e,type:t="originals",withoutNews:a="articles"===t,listAll:r=!(null==e||!e.type),listPurchasable:i,isStaff:s=!1,withContent:o=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const m={},u={},h="news"===t?"articles":t,v=null!=e&&e.type&&null!=e&&e.id?`${(0,l.lt)(e.type)}/${e.id}/${h}`:h;"news"!==t?"articles"!==h&&"originals"!==h||e&&e.id===c.NEWS||!a||(u["is-news"]="0"):u["is-news"]="1",u["list-all"]=r?"1":"0",void 0!==i&&["originals","radios","videos"].includes(h)&&(u["is-require-purchase"]=i?"1":"0");const E={isStaff:s,withContent:o};return"originals"===h?g(m,E):p(m,h,E),(0,n.BB)(v,{query:m,include:["category","user"],meta:{type:t,parentUnique:e},limit:12,sort:"published-time",...d,filters:{...u,...d.filters||{}},metaFields:{categories:[],users:[],...d.metaFields}})}function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{includeQueryPush:t,...a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{type:n="originals"}=e;return h(e,{...a,includeQueryPush:(t||[]).concat(["originals","videos","radios"].includes(n)?["djs"]:[])})}function E(e){let{type:t,id:a,token:r}=e,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=["category","user"];"radios"!==t&&"videos"!==t||(i=i.concat(["media","djs"]));const s=r?`original-auth-tokens/${r}`:`${"news"===t?"articles":t}/${a}`;return(0,n.BB)(s,{include:i,meta:{originalID:a},...l})}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=d(e),{type:r}=a.data;return(0,n.BB)(r,{method:"POST",meta:{successTip:"创建成功"},body:a,requireSignin:!0,include:["draft"],...t})}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=d(e),{type:r}=a.data;return(0,n.BB)(`${r}/${a.data.id}`,{method:"PATCH",body:a,requireSignin:!0,include:["draft"],...t})}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`${e.type}/${e.id}`,{method:"DELETE",meta:{deleteEntities:[e],successTip:"删除成功"},...t})}},50901:(e,t,a)=>{a.d(t,{NT:()=>l,VV:()=>r,h1:()=>i});var n=a(38854);function r(e){let{userID:t,subscribable:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=(0,n.I0)({type:"subscriptions",relationships:{user:{type:"users",id:t},subscriptable:a}});return(0,n.BB)("subscriptions",{method:"POST",body:l,meta:{successTip:"关注成功",subscribable:a},requireSignin:!0,...r})}function l(e){let{userID:t,type:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`users/${t}/subscribed-${a}`,{needPage:!0,..."games"===a?{include:["game-stores"]}:null,...r})}function i(e){let{subscriptionID:t,subscribable:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.BB)(`subscriptions/${t}`,{method:"DELETE",requireSignin:!0,meta:{subscribable:a,deleteEntities:[{type:"subscriptions",id:t}]},...r})}},25028:(e,t,a)=>{a.d(t,{K:()=>l,U:()=>i});var n=a(38854);const r=e=>{let{name:t,type:a}=e;return(0,n.I0)({type:"tags",dataAttributes:{name:t,"tag-type":a}})};function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.BB)("tags",e)}function i(e,t){const a=r(e);return(0,n.BB)("tags",{method:"POST",meta:{successTip:"创建标签成功"},body:a,requireSignin:!0,...t})}},64794:(e,t,a)=>{a.d(t,{d:()=>r});var n=a(38854);const r=(e,t)=>{let{userId:a,portfolioId:r,page:l}=e;return(0,n.BB)("work-exhibitions",{page:l,filters:{...a?{"user-id":a}:{},...r?{"portfolio-id":r}:{}},include:["article.catalog-tags.parent-tag","article.user","article.category","article.portfolios","video.catalog-tags.parent-tag","video.djs","video.category","video.portfolios","game","album","collection","portfolio.user",...n.De,...["catalog-tags.parent-tag","portfolios"].map((e=>`talk.${e}`))],...t})}},2186:(e,t,a)=>{a.d(t,{AN:()=>R,D3:()=>C,HW:()=>O,Im:()=>I,JP:()=>Q,K7:()=>q,L2:()=>S,MZ:()=>_,Ms:()=>B,Qt:()=>V,U3:()=>L,Ug:()=>A,V0:()=>Z,V5:()=>U,Wf:()=>W,X_:()=>N,Yd:()=>J,eX:()=>Y,eZ:()=>F,gS:()=>j,j8:()=>z,je:()=>k,kS:()=>f,ku:()=>G,lw:()=>X,oi:()=>K,sm:()=>x,t9:()=>$,tN:()=>b,tP:()=>P,tZ:()=>M,wm:()=>y,x4:()=>E,xn:()=>w,zK:()=>H});var n=a(35369),r=a(64549),l=a.n(r),i=a(54186),s=a(44671),o=a(36808),c=a.n(o);let d=0;const m=e=>!window.__IS_CRAWLER__&&"false"!==c().get(i.default.cookie_keys.sensorable)&&(!(d>=15)&&(0===d&&setTimeout((()=>{d=0}),1e4),d+=1,!0)),{phoneRegexp:u}=i.default;m()&&l()&&(l().init({sdk_url:"https://cdn.jsdelivr.net/npm/sa-sdk-javascript@1.14.14/sensorsdata.min.js",name:"sensors",server_url:`https://jihe.datasink.sensorsdata.cn/sa?token=${i.default.sensors.token}&project=production`,is_track_single_page:!1,show_log:!1,heatmap:{clickmap:"not_collect",scroll_notice_map:"not_collect"},preset_properties:{latest_referrer_host:!0,latest_landing_page:!0}}),l().registerPage({platform:"web"}));let p=null;const g=e=>e?`web.${e}`:"web.unknown",h=e=>{if(!e||!["articles","videos","radios"].includes(e.get("type")))return[];return(e.getRel("tags")||(0,n.List)()).concat(e.getRel("entities")||(0,n.List)()).concat(e.getRel("entries")||(0,n.List)()).map((e=>e.getTitle())).toJS()},v=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${`00${t.getMonth()+1}`.slice(-2)}-${`00${t.getDate()}`.slice(-2)} ${`00${t.getHours()}`.slice(-2)}:${`00${t.getMinutes()}`.slice(-2)}:${`00${t.getSeconds()}`.slice(-2)}.${`000${t.getSeconds()}`.slice(-3)}`},E=e=>{m()&&e&&l().login(e)},f=()=>{m()},y=e=>{m()&&null!=e&&l().setProfile({is_superior:e})},b=e=>{let{screenName:t,source:a,isLoadingFirstPage:n=!1}=e;if(!m())return;const r={...t?{screenName:g(t)}:{},...a?{source:g(a)}:{}};n?l().quick("autoTrack",r):l().quick("autoTrackSinglePage",r)},k=(e,t)=>{if(!m())return;let a="手机";"wechat"===e?a="微信":"weibo"===e&&(a="微博"),l().track("Register",{register_type:a,source:g(t)})},C=(e,t,a)=>{if(!m())return;let n="老账号";"wechat"===t?n="微信":"weibo"===t?n="微博":"identity"===t&&a&&u.test(a)?n="手机":"qr"===t&&(n="扫码"),l().track("Login",{login_type:n,source:g(e)})},_=(e,t)=>{m()&&e&&l().track("PostRead",{data_created_at:v(e.getAttr("published-at")),data_id:e.get("id"),data_title:e.getAttr("title"),data_type:e.get("type"),data_user_id:!e.isVolume()&&e.getRel("user")?e.getRel("user","id"):"",dj_ids:e.isVolume()&&e.getRel("djs")?e.getRel("djs").map((e=>e.get("id"))).toJS():[],is_news:e.isNews(),source:g(t),tags:h(e)})},w=e=>{let{commentId:t,commentable:a,replyTo:n,hasTimeStamp:r=!1}=e;if(!m())return;const i="entries"===(0,s.lt)(a.get("type"))?a.getAttr("released-at"):a.getAttr("published-at")||a.getAttr("created-at");l().track("Comment",{commentable_created_at:v(i),commentable_id:a.get("id"),commentable_title:a.getAttr("title")||"",commentable_type:a.get("type"),data_id:t,existed_comments_count:a.getAttr("comments-count")||a.getAttr("reviews-count")||0,reply_to_user_id:n&&n.getRel("user")?n.getRel("user","id"):"",portfolio_id:a.getRel([["portfolios",0]],"id")??"",comment_has_timestamp:r})},N=e=>{let{talkId:t,topic:a,imagesCount:n,repostContentType:r,repostContentId:i,repostContentTitle:s,workEnabled:o,isUpdate:c,isStrategy:d,isOfficial:u,isSpoiler:p,isRecruitment:h,source:v}=e;m()&&a&&l().track("TalkCreate",{data_id:t,existed_talks_count:a.getAttr("participants-count"),talk_images_count:n,topic_id:a.get("id"),topic_title:a.getAttr("title",""),repost_content_id:i??"",repost_content_type:r??"",repost_content_title:s??"",talk_is_update:c,talk_is_work_enabled:o,talk_is_strategy:d,talk_is_official:u,talk_is_spoiler:p,talk_is_recruitment:h,source:g(v)})},P=(e,t)=>{m()&&e&&l().track("Follow",{data_user_id:e,source:g(t)})},S=(e,t)=>{m()&&e&&l().track("Subscribe",{data_id:e.get("id"),data_type:e.get("type"),source:g(t)})},Z=(e,t)=>{var a,n;let{source:r,portfolioId:i}=t;m()&&l().track("Bookmark",{data_created_at:v(e.getAttr("published-at")),data_id:e.get("id"),data_title:e.getAttr("title")||"",data_type:e.get("type"),data_user_id:e.getRel("user")?e.getRel("user","id"):"",dj_ids:null!==(a=e.isVolume)&&void 0!==a&&a.call(e)?e.getRel("djs").map((e=>e.get("id"))).toJS():[],is_news:!(null===(n=e.isNews)||void 0===n||!n.call(e)),source:g(r),tags:h(e),portfolio_id:i??e.getRel([["portfolios",0]],"id")??""})},I=function(e){let{source:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m()&&l().track("PostLike",{data_created_at:v(e.getAttr("published-at")),data_id:e.get("id"),data_title:e.getAttr("title"),data_type:e.get("type"),data_user_id:e.isArticle()&&e.getRel("user")?e.getRel("user","id"):"",dj_ids:e.isVolume()?e.getRel("djs").map((e=>e.get("id"))).toJS():[],is_news:e.isNews(),tags:h(e),portfolio_id:e.getRel([["portfolios",0]],"id")??"",source:g(t)})},T=(e,t,a)=>{if(!m())return;if(!e||!t)return;const n=a?"CommentLike":"CommentDislike";l().track(n,{commentable_id:t.get("id"),commentable_title:t.getAttr("title"),commentable_type:t.get("type"),data_id:e.get("id"),data_user_id:e.getRel("user")?e.getRel("user","id"):""})},A=(e,t)=>{T(e,t,!0)},R=(e,t)=>{T(e,t,!1)},D=function(e){if(!m())return;for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];const[r,{portfolioId:i}={portfolioId:void 0}]=a;if(!r)return;const s=e?"TalkLike":"TalkDislike",o={data_id:r.get("id"),data_user_id:r.getRel("user","id")||"",topic_id:r.getRel("topic","id")||"",topic_title:r.getRelAttr("topic","title")||"",talk_is_recommended:(r.getAttr("is-editor-selected")||r.getAttr("is-recommended"))??!1,portfolio_id:i??r.getRel([["portfolios",0]],"id")??""};l().track(s,o)},x=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];D(!0,...t)},M=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];D(!1,...t)},L=(e,t,a,n,r,i,s)=>{m()&&l().track("Search",{search_has_results:r,search_is_history_word_pressed:n,search_is_hot_word_pressed:a,search_is_suggestion_pressed:t,search_query:e,search_results_count:i,search_sort_by:s})},q=(e,t)=>{m()&&(l().track("RadioPlayStart",{data_created_at:e.publishedAt&&v(e.publishedAt),data_id:e.id,data_title:e.title,dj_ids:e.djs?e.djs.map((e=>e.id)):[],media_duration:e.duration,source:g(t)}),p=(new Date).getTime())},F=(e,t,a)=>{if(!m())return;let n=null;p&&(n=Math.floor(((new Date).getTime()-p)/1e3),p=null),l().track("RadioPlayStop",{data_created_at:e.publishedAt&&v(e.publishedAt),data_id:e.id,data_title:e.title,dj_ids:e.djs&&e.djs.map((e=>e.id)),media_duration:e.duration,media_stop_at:a,media_stop_reason:t,...n?{event_duration:n}:{}})},B=(e,t,a,n)=>{m()&&l().track("Report",{report_reason:n,reportable_id:t,reportable_type:e,reportable_user_id:a||""})},O=e=>{m()&&l().track("RequestPurchaseAlbum",{data_id:e.productId,data_title:e.title,source:g(e.source),sku_id:e.skuId,purchase_type:e.purchaseType,purchase_amount:e.amount,is_gift:e.isGift})},U=e=>{m()&&l().track("FinishPurchaseAlbum",{data_id:e.productId,data_title:e.title,source:g(e.source),sku_id:e.skuId,purchase_type:e.purchaseType,purchase_amount:e.amount,is_gift:e.isGift})},$=e=>{m()&&l().track("RequestPurchaseAlbumBundle",{data_id:e.productId,data_title:e.title,source:g(e.source),sku_id:e.skuId,purchase_type:e.purchaseType,purchase_amount:e.amount,is_gift:e.isGift})},G=e=>{m()&&l().track("FinishPurchaseAlbumBundle",{data_id:e.productId,data_title:e.title,source:g(e.source),sku_id:e.skuId,purchase_type:e.purchaseType,purchase_amount:e.amount,is_gift:e.isGift})},z=e=>{let{type:t,id:a,consumerId:n,producerId:r,isSuccess:i,message:s}=e;m()&&l().track("RedeemCode",{album_id:"albums"===t?a:"",data_type:t,data_id:a,consumer_id:n,producer_id:r,is_success:i,message:s})},H=(e,t,a)=>{m()&&l().track("PlayTrialRadio",{sku_id:e,purchase_album_id:t})},V=(e,t)=>{m()&&l().track("AppDownload",{download_platform:e,download_channel:t})},W=e=>{let{ids:t,userId:a}=e;m()&&l().track("GetTrialAudioBook",{audio_book_ids:t,data_user_id:a,data_created_at:v(new Date)})},j=(e,t)=>{var a;if(!m())return;if(!e)return;const n=(null===(a=e.getRel("djs"))||void 0===a?void 0:a.map((e=>e.get("id"))).toJS())||[],r=e.getRel("user","id");l().track("PostReadComplete",{data_created_at:v(new Date(e.getAttr("published-at"))),data_id:e.get("id"),data_title:e.getAttr("title"),data_type:e.get("type"),data_user_id:n[0]||r||"",dj_ids:n,is_news:e.isNews(),source:g(t),tags:h(e)})},K=(e,t,a,n)=>{let{type:r,id:i}=e;if(!m())return;if(!r||!i)return;const s={data_id:i,data_type:r,data_user_id:t,source:g(a),portfolio_id:n??""};l().track("AddWork",s)},J=e=>{m()&&l().track("RequestPurchaseGPass",{source:g(e.source),sku_id:e.skuId,is_gift:e.isGift,purchase_type:e.purchaseType,purchase_amount:e.amount??0})},Y=e=>{m()&&l().track("FinishPurchaseGPass",{source:e.source,sku_id:e.skuId,is_gift:e.isGift,purchase_type:e.purchaseType,purchase_amount:e.amount??0})},X=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"button",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};m()&&e&&l().track("WebButtonPress",{button_id:e,button_label:t||"",button_type:a,...n,...n.source?{source:g(n.source)}:{}})},Q=(e,t,a,n)=>{m()&&l().track("Poll",{option_id:e,option_title:t,discussion_id:a,discussion_title:n})}},30636:(e,t,a)=>{a.d(t,{oH:()=>l});var n=a(14988),r=a(65019);a(30213);const l=()=>[{path:"",name:"writing"},{path:"/published",name:"writingPublished"},{path:"/drafts",name:"writingDrafts"},{path:"/talks",name:"writingTalks"},{path:"/games",name:"writingGames"}];i={path:"",children:l()},(0,n.p)(i,{baseUrl:r.ZP.Creation.path});var i},49766:(e,t,a)=>{a.d(t,{Z:()=>C});var n=a(67294),r=a(45697),l=a.n(r),i=a(23930),s=a.n(i),o=a(50533),c=a(1145),d=a(59310),m=a(28718),u=a(80239),p=a(23274),g=a(35218),h=a(81266),v=a(20525),E=a(34282),f=a(85846);class y extends E.Z{handleFirstShow=()=>{const{category:e,categoryID:t}=this.props;e||this.props.getCategory(t)};renderPopoverBody(){const{category:e,isRequesting:t}=this.props;let a=n.createElement("p",{className:"mutedInfo"},"暂无数据");if(e){const t=(0,m.Z)("category",{id:e.get("id")});a=n.createElement("div",{className:"popoverSocial"},n.createElement("div",{className:"popoverSocial_intro"},n.createElement("div",{className:"popoverSocial_section text-center"},n.createElement(g.Z,{to:t},n.createElement("div",{className:"popoverSocial_channelThumb"},n.createElement("img",{src:(0,u.cR)(e.getAttr("logo"),{resize:{w:72,h:72,m:"lfit"}}),alt:e.getAttr("name")})),n.createElement("div",{className:"fw-bold"},e.getAttr("name"))),n.createElement("div",null,n.createElement("small",null,e.getAttr("subscriptions-count")," 人订阅"))),e.getAttr("desc")&&n.createElement("p",{className:"popoverSocial_section u_color-gray-desc"},e.getAttr("desc"))),n.createElement("div",{className:"text-center"},n.createElement(f.Z,{type:"dark",outline:!0,className:"w-50",to:t},"查看")))}else t&&(a=n.createElement(v.Z,null));return a}render(){const{children:e}=this.props,t={body:this.renderPopoverBody(),trigger:"hover",delay:700,onFirstShow:this.handleFirstShow};return n.createElement(h.Z,t,e)}}y.propTypes={categoryID:l().string.isRequired,children:l().func.isRequired,category:s().record,isRequesting:l().bool},y.defaultProps={category:void 0,isRequesting:!1};const b=(0,d.P1)(((e,t)=>t.categoryID),d.LF,((e,t)=>(0,c.tK)(e,"categories",t))),k={getCategory:p.n37},C=(0,o.connect)(((e,t)=>({category:b(e,t),isRequesting:e.getIn(["network","getCategory","isRequesting"])})),k)(y)},7384:(e,t,a)=>{a.d(t,{Z:()=>_});var n=a(67294),r=a(45697),l=a.n(r),i=a(23930),s=a.n(i),o=a(50533),c=a(1145),d=a(59310),m=a(28718),u=a(80239),p=a(23274),g=a(81266),h=a(35218),v=a(44956),E=a(20525),f=a(34282),y=a(47467);class b extends f.Z{constructor(e){super(e),this.refresh=void 0}componentDidUpdate(e){this.props.user!==e.user&&this.refresh&&this.refresh()}handleFirstShow=()=>{const{userID:e,user:t}=this.props;t&&t.getRel("latest-articles")||this.props.getUser(e,{includeQueryPush:["latest-articles"]})};renderUserArticles=()=>{const{user:e,isRequesting:t}=this.props,a=e.getRel("latest-articles");let r;return a&&a.size>0?r=n.createElement("div",{className:"popoverSocial_section u_fontSize-sm"},n.createElement("div",{className:"mb-2 font-weight-bold"},"TA 的最新发布"),n.createElement("ol",{className:"mb-0 o_paddinglessList"},a.slice(0,3).map((e=>n.createElement("li",{key:e.getKey()},n.createElement(h.Z,{className:"u_undelineLink",to:(0,m.D)(e.get("type"),e.get("id"))},e.getAttr("title"))))))):t&&(r=n.createElement(E.Z,{height:"100px"})),r};renderPopoverBody=(e,t)=>{const{user:a,isRequesting:r}=this.props;let l=n.createElement("p",{className:"mutedInfo"},"暂无数据");if(this.refresh=e.update,a){const e=(0,m.Z)("user",{id:a.get("id")});l=n.createElement("div",{className:"popoverSocial"},n.createElement("div",{className:"popoverSocial_section popoverSocial_intro"},n.createElement(h.Z,{to:e,className:"d-block text-center"},n.createElement("img",{className:"popoverSocial_userThumb mb-2",src:(0,u.CA)(a.getAttr("thumb"),{resize:{w:64,h:64}}),alt:a.getAttr("nickname")}),n.createElement("div",{className:"font-weight-bold"},a.getAttr("nickname")),n.createElement("div",null,n.createElement("small",null,a.getAttr("followers-count")," 人关注")))),this.renderUserArticles(),n.createElement("div",{className:"row"},n.createElement("div",{className:"col-6 text-center"},n.createElement(y.Z,{type:"dark",outline:!0,className:"w-100",followee:a})),n.createElement("div",{className:"col-6 text-center"},n.createElement(v.Z,{to:(0,m.Z)("mails",{opponentID:a.get("id")}),outline:!0,type:"dark",className:"w-100"},"私信"))))}else r&&(l=n.createElement(E.Z,null));return n.createElement("div",t,l)};render(){const{children:e}=this.props,t={trigger:"hover",body:this.renderPopoverBody,onFirstShow:this.handleFirstShow,delay:700};return n.createElement(g.Z,t,e)}}b.propTypes={userID:l().string.isRequired,children:l().func.isRequired,user:s().record,isRequesting:l().bool},b.defaultProps={user:void 0,isRequesting:!1};const k=(0,d.P1)(((e,t)=>t.userID),d.LF,((e,t)=>(0,c.tK)(e,"users",t))),C={getUser:p.PRA},_=(0,o.connect)(((e,t)=>({user:k(e,t),isRequesting:e.getIn(["network","getUser","isRequesting"])})),C)(b)},71228:(e,t,a)=>{var n=a(43263),r=a(50718),l=a(80675),i=a(53894),s=a(14890),o=a(42554),c=a(14308),d=a(72739),m=a(86784),u=a(35793),p=a(35341),g=a(74710),h=a(91162),v=a(85061);const E=(0,v.PR)(h.V.toString(),v.kU.result).build((0,v.zu)()),f=(0,v.PR)(h.H.toString(),v.kU.origin).build((0,v.zu)());var y=a(96764),b=a(9895),k=a(35369),C=a(36808),_=a.n(C),w=a(54186),N=a(23274);function P(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===N.CpY?t.open:e}function S(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;return t.type===N.no9?t.state:e}const Z=w.default.cookie_keys.navLayoutCollapsed,I=w.default.cookie_keys.navLayoutLabelsCollapsed,T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)({nav:"true"===_().get(Z),labels:"true"===_().get(I)}),t=arguments.length>1?arguments[1]:void 0;return t.type===N.I8L?("boolean"==typeof t.payload.nav&&_().set(Z,t.payload.nav,{expires:365}),"boolean"==typeof t.payload.labels&&_().set(I,t.payload.labels,{expires:365}),e.merge(t.payload)):e},A=w.default.cookie_keys.theme,R=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_().get(A)||"system",t=arguments.length>1?arguments[1]:void 0;if(t.type===N.Jut&&t.payload){_().set(A,t.payload,{expires:365});{const e=document.documentElement;e.classList.forEach((t=>{t.startsWith("theme-")&&e.classList.remove(t)})),e.classList.add(`theme-${t.payload}`)}return t.payload}return e},D=new((0,k.Record)({nav:!1,popbox:!1}));function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.HsB:return D;case l.wFn:return e.merge({nav:t.editorMode});case l.q3d:return e.merge({popbox:t.open});default:return e}}const M=function(e,t){return(0,d.U)({loadingPage:S,navLayoutCollapsed:T,originalEditor:x,theme:R,signinModalVisible:P})(e,t)};var L=a(11860),q=a.n(L),F=a(86820);const B=e=>_().get(e),O=e=>q()(e),U=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["playing"];const a=e.get("playingItem"),n=e.get("playlist");if(!a)return e;const r=e=>e.get("id")===a.get("id"),l=n.find(r);if(!l)return e;let i=e;for(const e of t)switch(e){case"playing":i=i.set("playingItem",(0,F.$)(a,l));break;case"list":i=i.update("playlist",(e=>e.update(r,(e=>(0,F.$)(e,a)))))}return i},$=(0,v.PR)(l.ajx,v.kU.result).build((0,v.zu)());const G=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.fromJS)({playingItem:O("playingItem"),playing:!1,playlist:O("playlist")||[],mode:r.R9.MINI,radio:$(),volume:(()=>{const e=B(w.default.cookie_keys.volume);return e?Number(e):.5})(),continuous:"false"!==B(w.default.cookie_keys.playerContinuous)}),t=arguments.length>1?arguments[1]:void 0,a=e;if(t.type===l.jNQ)a=a.withMutations((e=>{e.set("mode",t.mode)}));else if(t.type===l.vs1)a=a.withMutations((e=>{e.delete("playingItem"),e.set("playing",!1)}));else if(t.type===l.uZq)a=a.update("playing",(e=>void 0===t.playing?!e:t.playing));else if(t.type===l._0y)a=a.withMutations((e=>{e.set("playingItem",t.payload.item),t.payload.shouldPlay&&e.set("playing",!0),U(e,["list","playing"])}));else if(t.type===l.Ru4){const{payload:e}=t,n=k.List.isList(e)?e:(0,k.List)([e]);a=a.update("playlist",(e=>e.map((e=>{const t=n.find((t=>t.get("id")===e.get("id")));return t?(0,F.$)(e,t):e})).concat(n.filter((t=>!e.find((e=>e.get("id")===t.get("id")))))))),a=U(a)}else if(t.type===l.c0y){const{payload:e}=t;if("number"==typeof e){const t=e;a=a.update("playlist",(e=>e.delete(t)))}else e instanceof Array&&(a=a.update("playlist",(t=>t.filter((t=>!e.includes(t.get("id")))))))}else if(t.type===l.EhV)a=a.set("playlist",(0,k.List)());else if(t.type===l.D7A){const{id:e,time:n,breakpointTimestamp:r}=t.payload;a=a.update("playlist",(t=>{const a=t.findIndex((t=>t.get("id")===e));return a>-1?t.update(a,(e=>e.set("breakpoint",n).set("breakpointTimestamp",r))):t})).update("playingItem",(t=>t&&t.get("id")===e?t.set("breakpoint",n).set("breakpointTimestamp",r):t))}else if(t.type===l.Bp5){const e=t.payload.key,n={volume:w.default.cookie_keys.volume,continuous:w.default.cookie_keys.playerContinuous};Object.keys(n).includes(e)&&(a=a.set(t.payload.key,t.payload.value),_().set(n[e],t.payload.value,{domain:w.default.cookie_domain,expires:365}))}return a=a.update("radio",(e=>$(e,t))),(e=>{q()("playlist",e.get("playlist",(0,k.List)()).toJS());const t=e.get("playingItem");t?q()("playingItem",t.toJS()):q().remove("playingItem")})(a),a};var z=a(44671),H=a(28680),V=a(14810);const W="albumPage",j=(0,H.b)("getAlbum",(e=>(0,V.Hj)(e,{include:["sale-options","shop-item","album-bundles.sale-options","wallpapers"]})),W),K=(0,H.x)("getOriginals",(function(e,t){let a=arguments.length>3?arguments[3]:void 0;const n=["media","category","albums"];return[`albums/${e}/${t}`,{include:n,page:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,limit:20,..."boolean"==typeof a?{sorts:a?["-published-at"]:["published-at"]}:{},fields:{categories:["name"],radios:["title","is-free","is-require-privilege","published-at","duration","comments-count","cover",...n]}}]}),{namespace:W,reducerDefault:"loadMore"}),J=(0,H.x)("getPreview",(e=>["program-previews",{include:["radio.category","radio.media","radio.skus","video.category"],limit:30,filters:{"album-id":e,"published-after":""+Date.now()/1e3,"published-before":""+(Date.now()/1e3+31536e3)}}])),Y={namespace:W,actions:{[j.name]:j.action,[K.name]:K.action,[J.name]:J.action,init:e=>async t=>{const a=(await t(j.action(e))).payload.data;if(!a)return;const n=new z.dp(a),r=n.isFree(),l=n.getAttr("content-type")||"radio",i=n.isFree()||"radio"!==l?`published-${l}s`:"published-audiobooks";return n.getAttr("is-require-privilege")&&await t(J.action(e)),await t(K.action(e,i,1,!0===r||void 0)),{relationName:i,sortable:r}}},reducer:(0,d.U)({originals:K.reducer,previewOriginals:J.reducer})},X=Y;var Q=a(69757),ee=a(51831),te=a(10772);const ae="editor",ne=(0,H.x)("getMedias",(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,V.Nl)({page:e,limit:10})}),{namespace:ae,reducerDefault:"loadMore"}),re=(0,H.x)("searchMedias",((e,t)=>(0,V.w4)({...e,type:"medias"},t)),{namespace:ae,reducerDefault:"loadMore"}),le={namespace:ae,actions:{[ne.name]:ne.action,[re.name]:re.action},reducer:(0,d.U)({medias:ne.reducer,searchedMedias:re.reducer})};var ie=a(99648);const se="feedsPage",oe=(0,H.x)("getFeeds",(e=>{const t={};return(0,V.bR)(t),["/latest-updates",{page:e,include:["feed",...["lead-actors","lead-objects","target"].map((e=>`feed.${e}`)),...V.Sv,...V.De],query:t}]}),{namespace:se,reducerDefault:"loadMore",removeIdActions:(0,ie.Y)(((e,t)=>["latest-updates",`${(0,z.Y_)(e)}:${t}`]))}),ce=(0,H.x)("markSeen",(e=>[`users/${e}/updates-feeds/mark-seen`,{method:"POST"}]),{withoutReducer:!0}),de={namespace:se,actions:{[oe.name]:oe.action,[ce.name]:ce.action},reducer:(e,t)=>(0,d.U)({feeds:oe.reducer})(e,t)};var me=a(13913),ue=a(61756),pe=a(57416),ge=a(56648);const he=(0,ge.q)("getUserCreditSucceeded",(e=>e)),ve={namespace:"pay",actions:{getUserCredit:()=>async e=>{var t;const a=(null===(t=(await e((0,pe.V)((async e=>await e.query({query:ue.JQ,variables:{}}))))).data.credit)||void 0===t?void 0:t.latestCredit)??0;a>=0&&e(he(a))}},reducer:(0,d.U)({credit:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return t.type===he.toString()?t.payload:e},purchasedHistory:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type!==N.ZW8)return e;const{purchasableId:a,purchasableType:n,isPurchased:r}=t.payload;return e.get(n)?e.setIn([n,a],r):e.set(n,(0,k.Map)({[a]:r}))},skuHistory:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type!==N.c2n)return e;const{skuId:a,name:n,amount:r,tagAmount:l}=t.payload;return e.set(a,(0,k.Map)({name:n,amount:r,tagAmount:l}))},availabilityHistory:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type!==N.$F5)return e;const a=(e,t)=>{let{purchasableType:a,purchasableId:n,currentlyAvailable:r,availableUntil:l}=t;return e.setIn([a,n],(0,k.Map)({currentlyAvailable:r,availableUntil:l}))};let n=e;return t.payload instanceof Array?t.payload.forEach((e=>{n=a(n,e)})):n=a(n,t.payload),n}})},Ee=ve;var fe=a(2186);const ye="creditPurchasePage",be=(0,H.x)("getAlbums",(e=>["albums",{filters:{"redeemable-with-credit":"true"},include:["sale-options"],page:e}]),{namespace:ye,reducerDefault:"loadMore"}),ke={namespace:ye,actions:{getAlbumsWithAvailability:e=>async t=>{const a=await t(be.action(e));if(a.payload.error)return;const n=a.payload.data.map((e=>e.id));t((0,N.yap)(n.map((e=>({purchasableType:me.Uo.Album,purchasableId:e}))),!0))},creditPlaceOrder:e=>{let{orders:t,source:a}=e;return async e=>{if(!t||0===t.length)return void e((0,N.bG5)({showMode:"pop",body:"兑换数量不能为 0"}));const n=t.filter((e=>null!==e.skuId));if(0===n.length)return void e((0,N.bG5)({showMode:"pop",body:"未能找到可兑换的商品 SKU"}));n.forEach((e=>{(0,fe.HW)({skuId:e.skuId,productId:e.purchasableId,amount:0,source:a,title:e.title,purchaseType:"credit",isGift:!1})}));const r=await e((0,N.AJ2)(n.map((e=>e.skuId))));if(r.error)return void e((0,N.bG5)({showMode:"pop",body:"兑换失败"}));const l=[],i=null==r?void 0:r.data;return i&&Object.keys(r.data).forEach((e=>{var t;const a=null===(t=i[e])||void 0===t?void 0:t.order;null!=a&&a.id&&l.push(a.skuId)})),l.forEach((e=>{const t=n.findIndex((t=>t.skuId===e));if(t>=0){const e=n[t];(0,fe.V5)({skuId:e.skuId,productId:e.purchasableId,amount:0,source:a,title:e.title,purchaseType:"credit",isGift:!1})}})),l.length===n.length?e((0,N.bG5)({type:N.ZQC.SUCCESS,body:"兑换成功，可在设置页查看你的订单记录"})):e((0,N.bG5)({type:N.ZQC.WARNING,body:"部分兑换成功，可在设置页查看你的订单记录"})),e(Ee.actions.getUserCredit()),l}}},reducer:(0,d.U)({albums:be.reducer})},Ce=ke;var _e=a(64794);const we="portfolioPage",Ne=(0,H.b)("getPorfolio",(e=>[`portfolios/${e}`,{include:["user","games"]}]),we),Pe=(0,ge.q)("removeFromPortfolio",((e,t)=>({type:e,id:t})),we),Se=(e,t)=>["work-exhibitions",`${(0,z.Y_)(e)}:${t}`],Ze=(0,H.x)("getWorks",((e,t,a)=>(0,_e.d)({page:a,portfolioId:e,userId:t})),{namespace:we,reducerDefault:"loadMore",removeIdActions:{[Pe.toString()]:e=>{let{action:{payload:{type:t,id:a}}}=e;return Se(t,a)},...(0,ie.Y)(Se)}}),Ie={namespace:we,actions:{[Ne.name]:Ne.action,[Ze.name]:Ze.action,removeFromPortfolio:Pe},reducer:(0,d.U)({works:Ze.reducer})};var Te=a(31875),Ae=a(21422),Re=a(74290),De=a(28449);const xe="worksPage",Me=(0,H.x)("getBanners",(()=>["banners",{filters:{"before-date":(new Date).toISOString(),slug:"works-page"},include:["target"],limit:1}]),{namespace:xe}),Le=(0,H.x)("getTags",(()=>["catalog-tags",{limit:30,filters:{"parent-tag-id":"null"}}]),{namespace:xe}),qe=(0,H.x)("getTalks",((e,t)=>["talks",{include:V.Ck,sorts:["-published-at"],page:t,limit:6,filters:{"work-enabled":"1",...e?{"catalog-tags":e}:{}}}]),{namespace:xe,reducerDefault:"loadMore"}),Fe=(0,H.x)("getOriginals",((e,t)=>(0,V.ro)(void 0,{page:t,limit:6,filters:{"work-enabled":"1",...e?{"catalog-tags":e}:{}}})),{namespace:xe,reducerDefault:"loadMore"}),Be=(e,t)=>{var a,n;const r=(null===(a=e.get("fetchedPages"))||void 0===a?void 0:a.size)>=(null===(n=t.get("fetchedPages"))||void 0===n?void 0:n.size)?e.get("fetchedPages"):t.get("fetchedPages");let l=(0,k.Map)();return null==r||r.forEach((a=>{const n=String(a);l=l.set(n,((e,t)=>e&&t?e.concat(t):(0,k.List)())(e.getIn(["fetchedPagesMap",n])||(e.get("noMore")?(0,k.List)():null),t.getIn(["fetchedPagesMap",n])||(t.get("noMore")?(0,k.List)():null)))})),(0,k.Map)({currentPage:Math.max(e.get("currentPage"),t.get("currentPage")),isRequesting:e.get("isRequesting")||t.get("isRequesting"),fetched:e.get("fetched")&&t.get("fetched"),noMore:e.get("noMore")&&t.get("noMore"),fetchedPagesMap:l})},Oe={namespace:xe,actions:{[Me.name]:Me.action,[qe.name]:qe.action,[Fe.name]:Fe.action,[Le.name]:Le.action,getData:(e,t)=>async a=>{await Promise.all([a(qe.action(e,t)),a(Fe.action(e,t))])}},reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const a=(0,d.U)({banners:Me.reducer,talks:qe.reducer,originals:Fe.reducer,tags:Le.reducer})(e.delete("mixed"),t);return a.set("mixed",t.type.includes(qe.action.toString())||t.type.includes(Fe.action.toString())?Be(a.get("talks"),a.get("originals")):e.get("mixed"))}},Ue=Oe;var $e=a(85540);const Ge=(0,v.PR)(N.MNG,v.kU.loadMore).build((0,v.zu)());const ze=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0,a=e;const{meta:n}=t,r=n&&(n.subCommentable||n.commentable);if(t.type===N.emq){const{type:e,id:n}=t.payload;a=a.deleteIn([e,n])}else r&&(a=a.updateIn([r.type,r.id],(e=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,v.zu)(),t=arguments.length>1?arguments[1]:void 0;const{payload:a,meta:n}=t,r=Ge(e,t);return t.type!==(0,$e.Xk)(N.lC1)||n.parentID?r:r.updateIn(["ids"],(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.List)()).unshift((0,k.Map)({type:a.result.type,id:a.result.id}))}))}(e,t))));return a},He=(0,v.PR)(N.lXd,v.kU.loadMore).build((0,v.zu)()),Ve=(0,v.PR)(N.C9j,v.kU.loadMore).build((0,v.zu)()),We=(0,v.PR)(N.ElI,v.kU.loadMore).build((0,v.zu)()),je=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)({notificationFeedsLastSeenAt:null,notificationFeedsUnseenCount:0}),t=arguments.length>1?arguments[1]:void 0,a=e;if(a=a.merge({privateMailThreads:We(a.get("privateMailThreads"),t),notificationFeeds:He(a.get("notificationFeeds"),t),interactionFeeds:Ve(a.get("interactionFeeds"),t)}),[(0,$e.Xk)(N.PBR),(0,$e.Xk)(N.lXd)].includes(t.type)){const{meta:e}=t.payload.origin;a=a.merge({notificationFeedsLastSeenAt:e["notification-feeds-last-seen-at"],notificationFeedsUnseenCount:e["notification-feeds-unseen-count"]})}if([N.DTh].includes(t.type)&&(a=a.merge({notificationFeedsLastSeenAt:(new Date).toString(),notificationFeedsUnseenCount:0})),[(0,$e.Xk)(N.PBR)].includes(t.type)){const{meta:e}=t.payload.origin;a=a.merge({interactionFeedsLastSeenAt:e["interaction-feed-last-seen-at"],interactionFeedsUnseenCount:e["interaction-feed-unseen-count"]})}if([(0,$e.Xk)(N.C9j)].includes(t.type)){const{meta:e}=t.payload.origin;a=a.merge({interactionFeedsLastSeenAt:e["interaction-feeds-last-seen-at"],interactionFeedsUnseenCount:e["interaction-feeds-unseen-count"]})}if([N.VKP].includes(t.type)&&(a=a.merge({interactionFeedsLastSeenAt:(new Date).toString(),interactionFeedsUnseenCount:0})),[(0,$e.Xk)(N.PBR)].includes(t.type)){const{meta:e}=t.payload.origin;a=a.merge({updatesFeedLastSeenAt:e["updates-feed-last-seen-at"],updatesFeedUnseenCount:e["updates-feed-unseen-count"]})}if([(0,$e.Xk)(de.actions.markSeen.toString())].includes(t.type)&&(a=a.merge({updatesFeedLastSeenAt:(new Date).toString(),updatesFeedUnseenCount:0})),[(0,$e.Xk)(N.PBR),(0,$e.Xk)(N.ElI),(0,$e.Xk)(N.TQf)].includes(t.type)){const{meta:e}=t.payload.origin;a=a.merge({privateMailThreadsUnseenCount:e["private-mails-unread-count"]})}return a};var Ke=a(85311),Je=a(13214);const Ye=(0,v.PR)(l.wBp,v.kU.loadMore).build((0,v.zu)()),Xe=(0,v.PR)(l.ubC,v.kU.page).build((0,v.zu)()),Qe=(0,v.PR)(l.lpb,v.kU.page).build((0,v.zu)()),et=(0,v.PR)(l.qe6,v.kU.page).build((0,v.zu)()),tt=(0,v.PR)(l.bmE,v.kU.page).build((0,v.zu)()),at=(0,v.PR)(l.xKf,v.kU.result).build((0,v.zu)()),nt=(0,v.PR)(l.mUC,v.kU.result).build((0,v.zu)()),rt=(0,v.PR)(l.zKX,v.kU.result).build((0,v.zu)()),lt=(0,v.PR)(l.wd1,v.kU.page).build((0,v.zu)()),it=(0,v.PR)(l.KfB,v.kU.page).build((0,v.zu)()),st=(0,v.PR)(l.GnC,v.kU.page).build((0,v.zu)()),ot=(0,d.U)({paidAlbums:it,freeAlbums:lt,bundles:st}),ct=(0,v.PR)(l.rM4,v.kU.result).after(((e,t)=>{let{action:a}=t;return a.type===(0,$e.Xk)(l.rM4)?e.update("ids",(e=>e.sortBy((()=>.5-Math.random())))):e})).build((0,v.zu)()),dt=(0,d.U)({data:ct,randomKey:e=>e||(Math.random()>.5?"jihepu":"heshi")}),mt=(0,d.U)({latestOriginals:Ye,news:Xe,audios:Qe,videos:et,collections:tt,albums:ot,shopItems:dt,discussionBanners:at,discussions:nt,talks:rt});var ut=a(83608),pt=a.n(ut);const gt={include:["target"],limit:1,meta:{inFirstScreen:{}}},ht=(0,H.x)("getFixedBanner",(()=>["banners",{filters:{slug:"web-homepage","before-date":(new Date).toISOString()},...gt}])),vt=(0,H.x)("getAltFixedBanner",(()=>["banners",{filters:{slug:"web-homepage-alt","before-date":(new Date).toISOString()},...gt}])),Et=(0,v.PR)(l.QyM,v.kU.page).build((0,v.zu)()),ft=(0,v.PR)(l._$y,v.kU.page).build((0,v.zu)()),yt=(0,v.PR)(l.jUv,v.kU.page).build((0,v.zu)()),bt=(0,v.PR)(l.xQh,v.kU.page).build((0,v.zu)()),kt=(0,v.PR)(l.VSm,v.kU.page).build((0,v.zu)()),Ct=(0,v.PR)(l.J7m,v.kU.page).build((0,v.zu)()),_t=(0,v.PR)(l.wpn,v.kU.page).build((0,v.zu)());const wt=(0,v.PR)(l.HAt,v.kU.loadMore).build((0,v.zu)()),Nt=(0,v.PR)(l.blJ,v.kU.page).build((0,v.zu)()),Pt=(0,v.PR)(l.OYI,v.kU.result).build((0,v.zu)()),St=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const{type:a}=t.meta.inFirstScreen;return a?e.update(a,(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),a=e.get("random"),n=Pt(e,t);const r=n.get("ids");return r&&void 0===a&&(a=pt()(0,0===r.size?0:r.size-1),n=n.set("random",a)),n})):e},Zt=(0,v.PR)(l.QAz,v.kU.result).build((0,v.zu)());const It=(0,v.PR)(l.I3D,v.kU.result).build((0,v.zu)()),Tt=(0,v.PR)(l.zps,v.kU.result).build((0,v.zu)()),At=(0,v.PR)(l.tpx,v.kU.page).build((0,v.zu)()),Rt=(0,d.U)({newsRadios:It,gadioWaveRadios:Tt,newsList:At}),Dt=(0,v.PR)(l.Nzc,v.kU.loadMore).build((0,v.zu)());var xt=a(69983),Mt=a.n(xt);const Lt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.List)(),t=arguments.length>1?arguments[1]:void 0;if(t.type===(0,$e.Xk)(l.TUc)){const e=t.payload.data;return(0,k.List)(e)}return e},qt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;if(t.type===(0,$e.Xk)(l.yu_)){const a=t.payload.data;return null==e?void 0:e.set(t.meta.type,(0,k.Map)({list:(0,k.List)(a),random:Mt()(a).pop()}))}return e},Ft=(0,v.PR)(l.RiH,v.kU.page).build((0,v.zu)((0,k.Map)())),Bt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const{meta:a}=t;return a&&a.type?e.set(a.type,Ft(e.get(a.type),t)):e},Ot=(e,t)=>(0,d.U)({suggests:Lt,results:Bt,hot:qt})(e,t),Ut=(0,v.PR)(l.PPq,v.kU.page).build((0,v.zu)()),$t=(0,v.PR)(l.N7Q,v.kU.page).build((0,v.zu)()),Gt=(0,v.PR)(l.$VM,v.kU.page).build((0,v.zu)()),zt=(0,v.PR)(l.qSY,v.kU.page).build((0,v.zu)()),Ht=(0,v.PR)(l.VJH,v.kU.page).build((0,v.zu)()),Vt=((0,v.PR)(l.D41,v.kU.page).build((0,v.zu)()),(0,v.PR)(l.dT9,v.kU.page).build((0,v.zu)())),Wt=(0,v.PR)(l.GSD,v.kU.loadMore).build((0,v.zu)()),jt=(0,v.PR)(l.MuN,v.kU.loadMore).build((0,v.zu)()),Kt=(0,v.PR)(l.nde,v.kU.loadMore).build((0,v.zu)()),Jt=(0,v.PR)(l.MgT,v.kU.result).build((0,v.zu)());var Yt=a(65838),Xt=a(40182),Qt=a(84461),ea=a(15490);const ta="discussionsPage",aa=(0,H.x)("getActiveDiscussions",(e=>["discussions",{filters:{active:"1"},include:["poll-options","poll-records.poll-option"],sorts:["-sort_at"],page:e}]),{namespace:ta,reducerDefault:"loadMore"}),na=(0,H.x)("getInActiveDiscussions",(e=>["discussions",{filters:{active:"0"},include:["poll-options","poll-records.poll-option"],sorts:["-closed-at"],page:e}]),{namespace:ta,reducerDefault:"loadMore",reducerAfter(e,t){let{action:a}=t;return"CLEAR_IN_DISCUSSIONS_PAGE"===a.type?(0,v.zu)():e}}),ra={namespace:ta,actions:{[aa.name]:aa.action,[na.name]:na.action,clearInDiscussionsPage:()=>({type:"CLEAR_IN_DISCUSSIONS_PAGE"})},reducer:(0,d.U)({activeDiscussions:aa.reducer,inactiveDiscussions:na.reducer})},la="activityHistory",ia=(0,H.x)("getActivityHistory",(()=>["history",{}]),{namespace:la,reducerDefault:"origin"}),sa=["cover","thumb","published-at","title","comments-count","category","duration"],oa=(0,H.x)("getRadios",(e=>{let{ids:t,page:a,limit:n,recordCount:r}=e;return["radios",{include:["category"],filters:{id:t.join(",")},meta:{recordCount:r,page:a,limit:n},fields:{radios:sa}}]}),{namespace:la,reducerDefault:"loadMore"}),ca=(0,H.x)("getOriginals",(e=>{let{ids:t,page:a,limit:n,recordCount:r}=e;return["originals",{include:["category"],filters:{id:t.join(",")},meta:{recordCount:r,page:a,limit:n},fields:{radios:sa,videos:sa,articles:sa}}]}),{namespace:la,reducerDefault:"loadMore"});let da=null,ma=null;const ua={namespace:la,actions:{[ia.name]:ia.action,[oa.name]:oa.action,[ca.name]:ca.action,addItem:e=>async(t,a)=>{if(a().getIn(["session","signined"]))return"radios"!==e.type||"number"!=typeof e.progress||da&&da.id===e.id&&da.progress===e.progress?void(ma&&ma.id===e.id||(ma=e,await t((0,V.D1)("history/readlist/add",{method:"PUT",body:e})))):(await t((0,V.D1)("history/playlist/add",{method:"PUT",body:e})),void(da=e))}},reducer:(0,d.U)({history:ia.reducer,radios:oa.reducer,originals:ca.reducer})},pa=ua;var ga=a(99232),ha=a(49125);const va="productPage",Ea=(0,H.x)("getProduct",(e=>[`products/${e}`,{include:["skus","user"]}]),{namespace:va}),fa=(0,H.x)("getRecommendedProducts",((e,t)=>["products",{limit:4,include:["skus"],filters:{"public-only":"1",shop:e,"is-require-privilege":t?"1":"0"}}]),{namespace:va}),ya={namespace:va,actions:{[Ea.name]:Ea.action,[fa.name]:fa.action},reducer:(0,d.U)({product:Ea.reducer,recommendedProducts:fa.reducer})},ba="radiosPage",ka=(0,H.x)("getRadios",((e,t)=>["latest-radios",{page:e,limit:20,include:["radio.category","radio.djs","album"],fields:{radios:["title","duration","cover","thumb","published-at","is-published","is-verified","likes-count","comments-count","category","albums","djs"],categories:["name","logo","subscriptions-count"],albums:["title","cover","is-require-privilege","content-type","is-free","owner-type"],users:["nickname","thumb"]},metaFields:{radios:[],categories:[],albums:[],users:[]},meta:{refresh:t}}]),{namespace:ba,reducerDefault:"page"}),Ca={namespace:ba,actions:{[ka.name]:ka.action},reducer:(0,d.U)({radios:ka.reducer})};var _a=a(4523);const wa=(0,d.U)({latestGadioNewsBanners:Ut,hotNewsList:$t,hotOriginals:Ht,comments:ze,notificationsCenter:je,[pa.namespace]:pa.reducer,categories:Gt,radioCatalogs:zt,topics:(e,t)=>(0,d.U)({topicCategories:Vt,catalogTopics:Wt,repostSearchResults:jt,topicSearchResults:Kt,initialResults:Jt})(e,t),search:Ot,privateMails:(e,t)=>{let a=Dt(e,t);return t.type===(0,$e.Xk)(l.iPo)&&(a=a.update("ids",(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.List)()).unshift(t.payload.result)}))),a},[le.namespace]:le.reducer,[Je.Z.namespace]:Je.Z.reducer,[te.Z.namespace]:te.Z.reducer,[Q.Z.namespace]:Q.Z.reducer,[Yt.Z.namespace]:Yt.Z.reducer,[ee.Z.namespace]:ee.Z.reducer,[Ke.Z.namespace]:Ke.Z.reducer,[Xt.Z.namespace]:Xt.Z.reducer,[ea.Z.namespace]:ea.Z.reducer,[ga.Z.namespace]:ga.Z.reducer,[Ca.namespace]:Ca.reducer,firstScreen:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const a=t.meta||{},{inFirstScreen:n}=a;if(n){const{tagID:a}=n,r=void 0===a?"all":a,l=(0,d.U)({fixedBanners:ht.reducer,fixedAltBanners:vt.reducer,banners:St,editorShowcases:Zt})(e.get(r),t);return e.set(r,l)}return e},homepage:mt,newsListPage:Rt,originalTypePage:Et,collectionTypePage:(e,t)=>{let a=e;return a=ft(a,t),a=yt(a,t),a},categoryPage:bt,collectionPage:kt,tagPage:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const a=t.meta||{},{inTagPage:n}=a;if(n){const{termUnique:a}=n,{id:r,type:l}=a,i=`${l}${void 0===r?"all":r}`,s=(0,d.U)({originals:Ct,games:_t})(e.get(i),t);return e.set(i,s)}return e},gamesDiscountPage:wt,nextGenerationPage:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)(),t=arguments.length>1?arguments[1]:void 0;const{meta:a,type:n}=t;return n.indexOf(l.blJ)<0?e:e.update(null==a?void 0:a.source,(e=>Nt(e,t)))},[X.namespace]:X.reducer,[Te.Z.namespace]:Te.Z.reducer,[De.Z.namespace]:De.Z.reducer,[Re.Z.namespace]:Re.Z.reducer,[Ae.Z.namespace]:Ae.Z.reducer,[de.namespace]:de.reducer,[Ie.namespace]:Ie.reducer,[Ue.namespace]:Ue.reducer,[Ce.namespace]:Ce.reducer,[Qt.Z.namespace]:Qt.Z.reducer,[ra.namespace]:ra.reducer,[ha.Z.namespace]:ha.Z.reducer,[ya.namespace]:ya.reducer,[_a.Z.namespace]:_a.Z.reducer}),Na=(0,d.U)({reportReasons:f,appConfigs:E,data:wa,entities:u.Z,loadingBar:m.N$,messages:p.Z,network:g.Z,session:y.Z,services:b.Z,status:M,player:G,[Ee.namespace]:Ee.reducer});var Pa=a(90307);const Sa=(0,s.md)(o.apiMiddleware,i.Z,(0,c.Z)()),Za=e=>{const t=((e,t)=>(0,Pa.Z)(e,t).mergeDeep((0,k.fromJS)({})))(e,(e=>e.set("player",void 0))),a=Sa;return(0,s.MT)(Na,t,a)};var Ia=a(65019),Ta=a(67294),Aa=a(73126);const Ra=a.p+"6a7bb5bfd823f17fada9.png";var Da=a(35018),xa=a(81266),Ma=a(52004),La=a(39260),qa=a(2933);class Fa extends Ta.PureComponent{static defaultProps={mobileStyle:!1};state={contactVisible:!1};render(){const{mobileStyle:e}=this.props;return Ta.createElement("footer",{className:(0,Ma.Z)("footer",{"footer-sm":e})},Ta.createElement("div",{className:(0,Ma.Z)({container:!e})},Ta.createElement("div",{className:"footer_title"}),Ta.createElement("div",{className:"row justify-content-between footer_body"},Ta.createElement("div",{className:e?"d-none":"col-md-5 col-sm-7"},Ta.createElement(Da.Z,{icon:["gfas","gcores"],className:"footer_logo"}),Ta.createElement("div",{className:"footer_intro"},Ta.createElement("p",null,"机核从2010年开始一直致力于分享游戏玩家的生活，以及深入探讨游戏相关的文化。我们开发原创的播客以及视频节目，一直在不断寻找民间高质量的内容创作者。"),Ta.createElement("p",null,"我们坚信游戏不止是游戏，游戏中包含的科学，文化，历史等各个层面的知识和故事，它们同时也会辐射到二次元甚至电影的领域，这些内容非常值得分享给热爱游戏的您。"))),Ta.createElement("div",{className:(0,Ma.Z)("footer_side",{"col-md-5 col-offset-md-2":!e,"col-12":e})},Ta.createElement("div",{className:"footer_thirdPlatforms footer_links"},Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.zhihu.com/org/ji-he-61-7/activities",className:"footer_inlineblock"},"知乎"),Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://weibo.com/gamecore",className:"footer_inlineblock"},"微博"),this.renderWeixin(),Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://podcasts.apple.com/cn/podcast/id420660752",className:"footer_inlineblock"},"播客"),Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:w.default.taobao_url,className:"footer_inlineblock"},"吉考斯工业"),Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:w.default.taobao_book_url,className:"footer_inlineblock"},"核市奇谭"),Ta.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://www.gcores.com/rss",className:"footer_inlineblock"},"RSS")),Ta.createElement(La.Z,null))),Ta.createElement("div",{className:"row footer_btm"},Ta.createElement("div",{className:(0,Ma.Z)("footer_links",e?"col-12":"col-md-7")},Ta.createElement(qa.Z,null)),Ta.createElement("div",{className:(0,Ma.Z)("footer_side",e?"col-12":"col-md-5")},Ta.createElement("p",null,"Copyright © 2009 - 2024 GAMECORES. All Rights Reserved")))))}renderWeixin=()=>{const e={body:Ta.createElement("div",{style:{width:200,height:200}},Ta.createElement("img",{src:Ra,alt:"微信公众号",style:{width:"100%",height:"100%"}})),outside:!0,trigger:["click","hover"]};return Ta.createElement(xa.Z,e,(e=>Ta.createElement("span",(0,Aa.Z)({className:"footer_inlineblock"},e),"微信")))}}const Ba=Fa;var Oa=a(95984),Ua=a(45648),$a=a(45697),Ga=a.n($a),za=a(73935),Ha=a(23930),Va=a.n(Ha),Wa=a(22004),ja=a.n(Wa),Ka=a(50533),Ja=a(28718),Ya=a(85846),Xa=a(34282),Qa=a(82285),en=a(84022),tn=a(80239),an=a(94299),nn=a(67826),rn=a(85551),ln=a(1145),sn=a(59310),on=a(23157),cn=a(26707),dn=a(35218),mn=a(87489),un=a(24320),pn=a(14018),gn=a(7975),hn=a(95109);const vn=100/60,En=e=>vn*e;class fn extends Ta.PureComponent{scrollContainer=Ta.createRef();refCurrentTime=Ta.createRef();isScrollerInited=!1;scroller;scrolling=!1;manualScrolling=!1;componentDidMount(){this.initScroller()}componentDidUpdate(){this.initScroller()}componentWillUnmount(){this.isScrollerInited&&(window.removeEventListener("player:progress",this.handleProgress),this.scroller.off("scrollStart",this.handleScrollerScrollStart),this.scroller.off("scrollEnd",this.handleScrollerScrollEnd))}render(){const{timelines:e,duration:t,initTime:a,dotBg:n,breakpoint:r}=this.props;if(!e)return Ta.createElement("div",{className:"gpf_tlProgress"});const l=Math.ceil(t/60);return Ta.createElement("div",{className:"gpf_tlProgress"},Ta.createElement("div",{className:"gpf_tlProgress_mid"},Ta.createElement("div",{className:(0,Ma.Z)("gpf_tlProgress_breakpointTipLabel",{is_active:r>0})},"已为你定位至 ",(0,rn.dB)(r)),Ta.createElement("div",{className:"gpf_tlProgress_mid_time"},Ta.createElement("span",{ref:this.refCurrentTime},(0,rn.dB)(a||0)),Ta.createElement("b",null,"/"),Ta.createElement("span",null,(0,rn.dB)(t)))),Ta.createElement("div",{className:"gpf_tlProgress_wrapper",ref:this.scrollContainer},e&&Ta.createElement("div",{className:"gpf_tlProgress_bar",style:{width:`${En(t)}px`}},Ta.createElement("div",{className:"gpf_tlProgress_scales"},e.map((e=>Ta.createElement(Ya.Z,{className:"gpf_tlProgress_timeline",key:e.getKey(),style:{left:En(e.getAttr("at"))},"data-time":e.getAttr("at"),onClick:this.handleTimelineClick,plain:!0,anchor:!0,tabIndex:-1},Ta.createElement("div",{className:"gpf_tlProgress_timeline_text",style:{backgroundImage:n&&`url(${(0,tn.cR)(n,tn.iT.Blur,{resize:{w:20,h:30},bright:-50})})`}},e.getTitle()),Ta.createElement("div",{className:"gpf_tlProgress_timeline_time"},(0,rn.dB)(e.getAttr("at")))))),new Array(l).fill("").map(((e,t)=>Ta.createElement("span",{key:t,className:"gpf_tlProgress_scale",style:{left:t*En(60)}})))))))}initScroller=()=>{const{initTime:e,duration:t}=this.props;this.scrollContainer.current&&t>0&&!this.isScrollerInited&&(window.addEventListener("player:progress",this.handleProgress),this.scroller=new hn.ZP(`.${this.scrollContainer.current.className}`,{startX:e?-En(e):0,scrollX:!0,scrollY:!1}),this.scroller.on("scrollStart",this.handleScrollerScrollStart),this.scroller.on("scrollEnd",this.handleScrollerScrollEnd),this.isScrollerInited=!0)};handleTimelineClick=e=>{const{onTimelineClick:t}=this.props,a=e.currentTarget.getAttribute("data-time");this.scrollToTime(a,500),t&&t(Number(a))};handleProgress=e=>{const t=e.detail.playedSeconds;this.refCurrentTime.current&&(this.refCurrentTime.current.innerHTML=(0,rn.dB)(t)),this.scrolling||this.scrollToTime(t)};scrollToTime=(()=>{var e=this;return function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.manualScrolling=!0,e.scroller&&e.scroller.scrollTo(-En(t),0,a,void 0,!1)}})();handleScrollerScrollStart=e=>{this.scrolling=!0};handleScrollerScrollEnd=e=>{const{onScrollEnd:t}=this.props;this.manualScrolling?this.manualScrolling=!1:t&&(t(e.x),setTimeout((()=>{this.scrolling=!1}),300))}}const yn=fn;var bn=a(76997),kn=a(89091),Cn=a(83476),_n=a(33529),wn=a(29847),Nn=a(58802),Pn=a(52949);const Sn=[{key:"score",title:"热门"},{key:"time",title:"最新"}];class Zn extends Ta.PureComponent{constructor(e){super(e),this.refInput=Ta.createRef(),this.refSideScroller=Ta.createRef(),this.state={isPosting:!1},this.handleTabClickScore=this.handleTabClick.bind(this,"score"),this.handleTabClickTime=this.handleTabClick.bind(this,"time")}handleCommentSubmit=(e,t)=>{this.setState({isPosting:!0}),this.props.onCommentSubmit(e,t).then((e=>{const t=!e.error;this.setState({isPosting:!1}),t&&this.refInput.current.reset()}))};handleTabClick=e=>{var t,a;null===(t=this.refSideScroller.current)||void 0===t||null===(a=t.scrollToTop)||void 0===a||a.call(t),this.props.onTabClick(e)};renderComments=e=>{const{onRenderComment:t}=this.props;return Ta.createElement(kn.Z,{comments:e,parent:void 0,onRenderComment:t})};renderHeader(){const{count:e,sort:t,popoverLayout:a}=this.props;return a?Ta.createElement("div",{className:"d-flex justify-content-between align-items-center"},Ta.createElement("div",null,"共 ",e," 条评论"),Ta.createElement("div",null,Sn.map((e=>Ta.createElement(Ya.Z,{key:e.key,type:"link",size:"sm",className:t===e.key?"":"u_color-gray-desc",onClick:"score"===e.key?this.handleTabClickScore:this.handleTabClickTime},e.title))))):Ta.createElement(wn.Z,{tabs:Sn,active:t,onTabChange:this.handleTabClick,subContent:`共 ${e} 条评论`,hrefEnabled:!1})}renderActions(){const{currentUser:e,commentable:t}=this.props,{isPosting:a}=this.state;return Ta.createElement(bn.Z,{commentable:t,isPosting:a,currentUser:e,onSubmit:this.handleCommentSubmit,ref:this.refInput})}render(){const{count:e,comments:t,commentsState:a,onCloseClick:n,popoverVisible:r,popoverLayout:l,onLoadMore:i}=this.props,s={onLoad:i,state:a,data:t,limitForGuest:!0,limitCountForGuest:3,limitTextForGuest:`登录后查看全部 ${e} 条评论`};return l?Ta.createElement(_n.Z,{overlayClassName:"theme-dark j_commentsPopover",className:"gpf_modal commentsMana-compact",visible:r,onCloseClick:n,hideCloseBtn:!0,header:this.renderHeader(),actions:this.renderActions(),disableOutterScroll:!1},Ta.createElement(Cn.Z,(0,Aa.Z)({},s,{scrollableProps:{bottomOffset:200,container:".j_commentsPopover",ref:this.refSideScroller}}),this.renderComments)):Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"gpf_side_header"},this.renderHeader()),Ta.createElement("div",{className:"gpf_side_body"},Ta.createElement(Cn.Z,(0,Aa.Z)({},s,{scrollableProps:{bottomOffset:200,inWindow:!1,className:"gpf_side_body_inner",ref:this.refSideScroller}}),this.renderComments)),Ta.createElement("div",{className:"gpf_side_footer"},this.renderActions()))}}const In=(0,Nn.N)(Zn);In.propTypes={...In.propTypes||{},popoverVisible:Ga().bool.isRequired,onCloseClick:Ga().func.isRequired},Zn.propTypes={...In.propTypes,currentUser:Va().record,commentable:Ga().object.isRequired,comments:Pn.ZP.comments.isRequired,commentsState:Ga().object,count:Ga().number,popoverLayout:Ga().bool.isRequired,onCommentSubmit:Ga().func.isRequired,onLoadMore:Ga().func.isRequired,onTabClick:Ga().func.isRequired,onRenderComment:Ga().func.isRequired},Zn.defaultProps={commentsState:void 0,currentUser:void 0,count:void 0};const Tn=In,An=e=>{const{progressDotRef:t,progressBarRef:a,curPercentage:n,handleProgressBarClick:r,handleProgressCurrentDotMouseDown:l}=(e=>{let{played:t=0,onDragEnd:a,onJump:n}=e;const r=(0,Ta.useRef)(null),l=(0,Ta.useRef)(null),i=(0,Ta.useRef)(0),s=(0,Ta.useRef)(0),o=(0,Ta.useRef)(!1),[c,d]=(0,Ta.useState)(-1),m=(0,Ta.useRef)(-1),u=e=>{d(e),m.current=e},p=(0,Ta.useCallback)((e=>{var a;o.current=!0,i.current=e,s.current=((null===(a=l.current)||void 0===a?void 0:a.offsetWidth)||0)*t||0}),[t]),g=(0,Ta.useCallback)((e=>{if(!o.current||!l.current)return;const t=e-i.current;let a=(s.current+t)/l.current.offsetWidth;a=Math.max(Math.min(a,1),0),u(a)}),[]),h=(0,Ta.useCallback)((()=>{o.current&&(o.current=!1,i.current=0,s.current=0,m.current>=0&&a&&a(m.current))}),[a]);return(0,Ta.useEffect)((()=>{const e=r.current,t=e=>{p(e.targetTouches[0].screenX),e.preventDefault()},a=e=>{g(e.targetTouches[0].screenX)},n=e=>{g(e.screenX)},l=()=>{h()},i=()=>{h()};return document.body.addEventListener("mouseup",l),document.body.addEventListener("mousemove",n),document.body.addEventListener("touchmove",a),document.body.addEventListener("touchend",i),null==e||e.addEventListener("touchstart",t,{passive:!1}),()=>{document.body.removeEventListener("mouseup",l),document.body.removeEventListener("mousemove",n),document.body.removeEventListener("touchmove",a),document.body.removeEventListener("touchend",i),null==e||e.removeEventListener("touchstart",t)}}),[t,a,n,g,h,p]),(0,Ta.useEffect)((()=>{o.current||u(-1)}),[t]),{handleProgressCurrentDotMouseDown(e){p(e.screenX)},handleProgressBarClick(e){if(!l.current||o.current||e.target===r.current)return;const t=l.current.getBoundingClientRect().x,a=(e.pageX-t)/l.current.offsetWidth;u(a),n&&n(a)},progressDotRef:r,progressBarRef:l,draggedScreenXRef:i,draggedWidthRef:s,draggingRef:o,progressBarWillTo:c,setProgressBarWillTo:u,curPercentage:c<0?t:c}})(e);return Ta.createElement("div",{className:"controlledProgressBar",ref:a,role:"presentation",onClick:r},Ta.createElement("div",{className:"controlledProgressBar_inner"},Ta.createElement("div",{className:"controlledProgressBar_current",style:{width:100*n+"%"}},Ta.createElement("div",{ref:t,role:"presentation",className:"controlledProgressBar_currentDot",onMouseDown:l}))))};class Rn extends Ta.PureComponent{constructor(e){super(e),this.state={played:0}}componentDidMount(){window.addEventListener("player:progress",this.handleProgress)}componentWillUnmount(){window.removeEventListener("player:progress",this.handleProgress)}handleProgress=e=>{const{played:t}=e.detail;this.setState({played:t})};render(){const{played:e}=this.state;return Ta.createElement(An,(0,Aa.Z)({},this.props,{played:e}))}}const Dn=Rn;class xn extends Xa.Z{constructor(e){super(e),this.handlePlayClick=this.handlePlayClick.bind(this),this.handleRemoveClick=this.handleRemoveClick.bind(this),this.handleRemoveAllClick=this.handleRemoveAllClick.bind(this),this.handleContinuousClick=this.handleContinuousClick.bind(this),this.handleClose=this.handleClose.bind(this),this.selectedRef=Ta.createRef(null),this.listContainerRef=Ta.createRef(null)}componentDidMount(){const e=this.selectedRef.current,t=this.listContainerRef.current;if(e&&t){const a=e.offsetTop;t.scrollTop=a-80}}handlePlayClick(e){const{list:t,dispatch:a,onPlay:n}=this.props,r=e.currentTarget.getAttribute("data-id"),i=t.find((e=>e.get("id")===r));a((0,l.YVK)(i)),n&&n(r)}handleRemoveClick(e){this.props.dispatch((0,l.ds7)(e.currentTarget.getAttribute("data-id")))}handleRemoveAllClick(){this.props.dispatch((0,l.fDf)())}handleClose(){this.props.onClose()}handleContinuousClick(){const{dispatch:e,continuous:t}=this.props;e((0,l.smX)({key:"continuous",value:!t}))}render(){const{list:e,selectedRadioID:t,continuous:a}=this.props,n=e.size>0?e.map((e=>{const a=e.get("id")===t;return Ta.createElement("li",{key:e.get("id"),"data-id":e.get("id"),className:a?"is_playing":void 0,ref:a?this.selectedRef:void 0},Ta.createElement(Ya.Z,{onClick:this.handlePlayClick,"data-id":e.get("id"),className:"gplayer_list_item_img o_backgroundCover",style:{backgroundImage:`url(${(0,tn.cR)(e.get("thumb"),{resize:{w:60,h:60}})})`},anchor:!0,plain:!0},Ta.createElement(Da.Z,{icon:["gfas","play"]})),Ta.createElement("div",{className:"gplayer_list_item_text"},Ta.createElement("div",null,e.get("channelName")),e.get("title")),Ta.createElement("div",{className:"gplayer_list_item_actions"},Ta.createElement(Ya.Z,{onClick:this.handleRemoveClick,"data-id":e.get("id"),anchor:!0,plain:!0},Ta.createElement(Da.Z,{icon:["gfas","times"]}))))})):Ta.createElement("li",null,"没有数据");return Ta.createElement("div",{className:"gplayer_list"},Ta.createElement("div",{className:"gplayer_list_header"},"播放列表(",e.size,")",Ta.createElement("div",{className:"form-check form-switch"},Ta.createElement("input",{className:(0,Ma.Z)("form-check-input"),type:"checkbox",id:"continuous",checked:!!a,onClick:this.handleContinuousClick,readOnly:!0}),Ta.createElement("label",{className:"form-check-label",htmlFor:"continuous"},"连续播放"))),Ta.createElement("ul",{className:"o_stylelessList mb-0",ref:this.listContainerRef},n),Ta.createElement("div",{className:"gplayer_list_actionsBar"},e.size>0?Ta.createElement(Ya.Z,{onClick:this.handleRemoveAllClick,anchor:!0,plain:!0},Ta.createElement(Da.Z,{className:"me-2",icon:["gfas","empty"]}),"清空全部"):Ta.createElement("span",null),Ta.createElement(Ya.Z,{onClick:this.handleClose,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","angle-down"]}))))}}xn.propTypes={list:Va().list.isRequired,dispatch:Ga().func.isRequired,selectedRadioID:Ga().string,continuous:Ga().bool.isRequired,onClose:Ga().func.isRequired,onPlay:Ga().func},xn.defaultProps={selectedRadioID:void 0,onPlay:void 0};const Mn=(0,Ka.connect)((e=>({continuous:e.getIn(["player","continuous"])})))(xn);var Ln=a(14017),qn=a.n(Ln);const Fn=a.p+"b04c9cda5160076a5a5b.png",Bn=[{label:"0.8x",value:.8},{label:"1x",value:1},{label:"1.2x",value:1.2},{label:"1.5x",value:1.5}],On=()=>{(0,nn.Hm)("/")},Un=e=>(0,tn.cR)(e,tn.iT.Blur),$n=e=>e?{backgroundImage:`url(${Un(e)})`}:void 0,Gn=(e,t)=>{let a=e.findIndex((e=>e.getAttr("at")>t));return a<0?a=e.size-1:a>0&&(a-=1),a},zn=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{playingItem:a}=e,n=a&&a.get("breakpoint");return{lock:!0,initTime:t?e.initTime:n||0,currentIndex:n?Gn(e.timelines,n):0,currentCommentable:e.radio}};class Hn extends Xa.Z{static getDerivedStateFromProps(e,t){var a;const{radio:n}=e;let r=null;const l=null===(a=t.propRadio)||void 0===a?void 0:a.get("id"),i=null==n?void 0:n.get("id");return l&&i&&l!==i&&(r={...zn(e),propRadio:n,lastBlurImg:t.propRadio&&t.propRadio.getAttr("cover"),blurOverPos:!t.blurOverPos}),r}constructor(e){super(e),this.state={...zn(e,!0),propRadio:e.radio,blurOverPos:!0,init:!1,phoneLayout:!1,sideDisabled:!1,sideVisible:!0,popoverVisible:!1,playlistVisible:!1},this.refPlayedSeconds=Ta.createRef(),this.playedSeconds=null,this.handleNextTimelineClick=this.handleOtherTimelineClick.bind(this,!0),this.handlePrevTimelineClick=this.handleOtherTimelineClick.bind(this,!1),this.handleReplayTimelineClick=this.handleReplayTimelineClick.bind(this),this.handleBlurImageLoaded=this.handleBlurImageLoaded.bind(this)}closeCommentsPopover=()=>{this.setState({popoverVisible:!1})};progressJump=(e,t)=>{this.props.onProgressBarJump(e,t),this.lockTimeline(e)};lockTimeline=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.playedSeconds;const{timelines:a}=e.props,n=Gn(a,t);e.setState({lock:!0,currentIndex:n})}})();componentDidMount(){window.addEventListener("player:progress",this.handleProgress),window.addEventListener("resize",this.relayout),this.relayout(),this.setState({init:!0,sideVisible:this.checkSideInitVisible()}),(0,an.a9)(!1)}componentDidUpdate(e){const{radio:t}=this.props,{radio:a}=e;(a&&a.get("id"))!==(t&&t.get("id"))&&(this.playedSeconds=0)}componentWillUnmount(){window.removeEventListener("player:progress",this.handleProgress),window.removeEventListener("resize",this.relayout),(0,an.a9)(!0)}checkPhoneLayout=()=>window.innerWidth<=860;checkSideLayoutDisabled=()=>window.innerWidth<=1060;checkSideInitVisible=()=>window.innerWidth>=1400;relayout=()=>{const{phoneLayout:e,sideDisabled:t}=this.state,a=this.checkPhoneLayout(),n=this.checkSideLayoutDisabled();e!==a&&(this.setState({phoneLayout:a}),a&&this.lockTimeline()),t!==n&&this.setState({sideDisabled:n})};handleProgress=e=>{const{lock:t}=this.state,{timelines:a}=this.props,{playedSeconds:n}=e.detail;if(this.playedSeconds=n,t&&a&&n>=0){const{currentIndex:e}=this.state,t=Gn(a,n);if(e!==t){const e={currentIndex:t};this.setState(e)}}this.refPlayedSeconds.current&&(this.refPlayedSeconds.current.innerHTML=(0,rn.dB)(n))};handleTimelineCommentClick=e=>{const{timelines:t}=this.props,a=e.currentTarget.getAttribute("data-id");this.setState({currentCommentable:t.find((e=>e.get("id")===a)),popoverVisible:!0,sideVisible:!0})};handleLockTimelineClick=()=>{this.lockTimeline()};handleTimelineProgressScrollEnd=e=>{const t=-e/vn;this.progressJump(t,!1)};handleTimelineClick=e=>{this.progressJump(e)};handleToggleList=()=>{this.setState((e=>({playlistVisible:!e.playlistVisible})))};handleCloseList=()=>{this.setState({playlistVisible:!1})};handleProgressBarJump=e=>{const{duration:t}=this.props,a=t*e;this.progressJump(a,!1)};handleRadioCommentsClick=()=>{const{radio:e}=this.props;this.setState({currentCommentable:e,sideVisible:!0,popoverVisible:!0})};handleOtherTimelineClick(e){const{currentIndex:t}=this.state,a=e?t+1:t-1;this.setState({lock:!1,currentIndex:a})}handleReplayTimelineClick(){const{currentIndex:e}=this.state,{timelines:t}=this.props;this.progressJump(t.get(e).getAttr("at"))}handleBlurImageLoaded(){const{radio:e}=this.props;e&&this.setState({blurImg:e.getAttr("cover")})}handleVolumeChange=e=>{const{onVolumeChange:t}=this.props;t&&t(Number(e.toFixed(2)))};renderCloseBtn=()=>Ta.createElement(Ya.Z,{type:"opacity",className:"fa-sm rounded-max",onClick:On},Ta.createElement(Da.Z,{icon:["gfas","angle-down"],className:"me-2 fa-w-14"}),"收起");renderControls=e=>{const{playing:t,buffering:a,onPrevClick:n,onPlayPauseClick:r,onBackward15Click:l,onForward15Click:i,onNextClick:s}=this.props,{phoneLayout:o}=this.state;return Ta.createElement("div",{className:(0,Ma.Z)("gpf_controls",e)},Ta.createElement(Ya.Z,{onClick:n,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","fast-backward"]})),!o&&Ta.createElement("div",{className:"gpf_controls_15-backward"},Ta.createElement(Ya.Z,{className:"gpf_controls_circle",onClick:l,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","fast-backward-15s"]}))),Ta.createElement(Ya.Z,{className:"gpf_controls_play gpf_controls_circle",onClick:r,plain:!0,anchor:!0},a?Ta.createElement(Da.Z,{icon:["gfas","spinner"],pulse:!0}):Ta.createElement(Da.Z,{icon:["gfas",t?"pause":"play"],className:t?"":"p_circlePlayIcon"})),!o&&Ta.createElement("div",{className:"gpf_controls_15-forward"},Ta.createElement(Ya.Z,{className:"gpf_controls_circle",onClick:i,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","fast-forward-15s"]}))),Ta.createElement(Ya.Z,{onClick:s,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","fast-forward"]})))};renderProgressBar=()=>{const{duration:e}=this.props,{initTime:t}=this.state;return Ta.createElement("div",{className:"gpf_progressBar"},Ta.createElement("span",{ref:this.refPlayedSeconds},(0,rn.dB)(t||0)),Ta.createElement("div",null,Ta.createElement(Dn,{onDragEnd:this.handleProgressBarJump,onJump:this.handleProgressBarJump})),Ta.createElement("span",null,(0,rn.dB)(e)))};renderPlaylist(){const{selectedRadioID:e,dispatch:t,playlist:a}=this.props,{playlistVisible:n}=this.state;return n&&Ta.createElement(Mn,{selectedRadioID:e,list:a,dispatch:t,onClose:this.handleToggleList,fullscreen:!0})}renderRateBtn=()=>{const{onRateChange:e,rate:t}=this.props;return Ta.createElement(on.ZP,{menuPlacement:"top",className:"gpf_rate",isSearchable:!1,options:Bn,value:Bn.find((e=>e.value===t)),onChange:t=>{e(t.value)},styles:{indicatorsContainer:()=>({display:"none"}),control:e=>({...e,color:"white",borderColor:"transparent !important",boxShadow:"none",width:"60px",background:"none",fontWeight:"bold",cursor:"pointer"}),singleValue:e=>({...e,color:"white",textAlign:"center"}),menu:e=>({...e,background:"#111",width:"70px"}),option:(e,t)=>{let{isFocused:a,isSelected:n}=t;return{...e,backgroundColor:"transparent",color:n?"white":a?"#888":"#666",cursor:"pointer"}}},theme:e=>({...e,colors:{...e.colors,primary:"white"}})})};renderListBtn=()=>Ta.createElement(qn(),{className:"gpf_listBtn",onClickOutside:this.handleCloseList},this.renderPlaylist(),Ta.createElement(Ya.Z,{onClick:this.handleToggleList,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","list-ul"]})));renderDjs(){const{radio:e}=this.props;if(!e)return null;const t=e.getRel("djs");return t&&t.size>0?Ta.createElement("div",null,t.size>5?Ta.createElement(un.Z,{users:t,size:"sm",onlyImage:!0}):t.map((e=>Ta.createElement(cn.Z,{key:e.getKey(),onlyImage:!0,users:e,size:"xs",to:(0,Ja.Z)("user",{id:e.get("id")})})))):"无"}renderSocialActions(){const{radio:e}=this.props,{phoneLayout:t,sideDisabled:a}=this.state;return e?Ta.createElement("div",{className:"gpf_socialActions"},Ta.createElement(gn.Z,{votable:e,upIcon:["gfas","thumbs-up"],onlyUp:!0,source:"timelines"}),a&&Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:this.handleRadioCommentsClick},Ta.createElement(Da.Z,{icon:["gfas","comment"]}),e.getAttr("comments-count")),Ta.createElement(pn.Z,{bookmarkable:e}),!t&&Ta.createElement(mn.Z,{data:e,text:"分享",modalProps:{disableOutterScroll:!1}})):null}renderHeaderContainer(e){return Ta.createElement("div",{className:"gpf_header"},e,Ta.createElement("div",{className:"gpf_actions"},this.renderCloseBtn()))}renderHeader(){const{radio:e}=this.props;if(!e)return this.renderHeaderContainer();const t=(0,Ja.Z)("radio",{id:e.get("id")});return this.renderHeaderContainer(Ta.createElement("div",{className:"gpf_header_original"},Ta.createElement("div",{className:"gpf_header_info"},Ta.createElement(dn.Z,{to:t},Ta.createElement("img",{src:(0,tn.cR)(e.getImage(),{resize:{w:54,h:54}}),alt:e.getAttr("title"),className:"rounded"})),Ta.createElement("div",{className:"gpf_header_info_text"},Ta.createElement("h3",{className:"gpf_header_title"},Ta.createElement(dn.Z,{to:(0,Ja.Z)("category",{id:e.getRel("category","id")})},e.getRelAttr("category","name"))),Ta.createElement("p",null,Ta.createElement(dn.Z,{to:t},e.getAttr("title"))))),Ta.createElement("div",{className:"gpf_header_djs"},Ta.createElement("h3",{className:"gpf_header_title"},"参与者"),this.renderDjs())))}renderPhoneHeader=()=>Ta.createElement("div",{className:"gpf_phoneHeader"},this.renderCloseBtn());renderTimeline=(()=>{var e=this;return function(t){let{prev:a,next:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{radio:r}=e.props;if(!r&&!t)return Ta.createElement("div",{className:"gpf_loading"},"没有数据");const{lock:l}=e.state,i=t&&t.getAttr("quote-href"),s=t?t.getAttr("title"):r.getTitle(),o=t?t.getAttr("content"):r.getAttr("desc"),c=t&&t.getAttr("asset")?t.getAttr("asset"):r.getAttr("thumb"),d=c&&(0,tn.cR)(c,{resize:{m:"lfit",w:500,h:500}}),m=c&&(0,tn.cR)(c);return Ta.createElement("div",{className:"gpf_playingTimeline"},t?!l&&Ta.createElement(Ya.Z,{type:"opacity",className:"gpf_playingTimeline_lock rounded-max",onClick:e.handleLockTimelineClick,size:"sm"},"返回当前播放"):Ta.createElement(Ya.Z,{type:"opacity",className:"gpf_playingTimeline_lock rounded-max",size:"sm",disabled:!0},"本节目未提供时间轴内容"),Ta.createElement("div",{className:"gpf_playingTimeline_l"},a&&Ta.createElement(Ya.Z,{onClick:e.handlePrevTimelineClick,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","angle-left"]}))),Ta.createElement("div",{className:"gpf_playingTimeline_show",key:t?t.getKey():"noTimeline"},Ta.createElement("div",{className:"timeline"},d&&Ta.createElement("div",{className:"timeline_img"},Ta.createElement(dn.Z,{className:"timeline_img_inner",href:m},Ta.createElement("img",{src:d,alt:s,className:"rounded"}))),Ta.createElement("div",{className:"timeline_body"},Ta.createElement("div",{className:"timeline_body_inner"},Ta.createElement("h3",{className:(0,Ma.Z)("timeline_header",{"timeline_header-withQuote":i})},i&&Ta.createElement(dn.Z,{className:"timeline_more",href:i,target:"_blank",openNewWindow:!0},Ta.createElement("img",{src:Fn,alt:"来源链接"})),t&&Ta.createElement(Ya.Z,{onClick:e.handleReplayTimelineClick,anchor:!0,plain:!0,className:"me-2"},l?Ta.createElement(Da.Z,{icon:["gfas","replay-circle"]}):Ta.createElement(Da.Z,{icon:["gfas","play-circle"]})),s,t&&Ta.createElement("small",null,(0,rn.dB)(t.getAttr("at")))),Ta.createElement("p",{className:"timeline_content"},o))))),Ta.createElement("div",{className:"gpf_playingTimeline_r"},n&&Ta.createElement(Ya.Z,{onClick:e.handleNextTimelineClick,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","angle-right"]}))))}})();renderPlayingBody(){const{currentIndex:e}=this.state,{timelines:t,radioState:a}=this.props;if(null!=a&&a.get("isRequesting"))return Ta.createElement("div",{className:"gpf_loading"},"loading...");if(!t)return this.renderTimeline();const n=e-1<0?void 0:t.get(e-1),r=t.get(e+1),l=t.get(e);return l?this.renderTimeline(l,{prev:n,next:r}):this.renderTimeline()}renderBody(){return Ta.createElement("div",{className:"gpf_body"},this.renderPlayingBody())}renderPhoneBody=()=>Ta.createElement("div",{className:"gpf_phoneBody"},this.renderPlayingBody());renderBtm(){const{volume:e,radio:t,timelines:a,duration:n,startBreakpoint:r}=this.props,{initTime:l}=this.state,i=null==t?void 0:t.getAttr("cover");return Ta.createElement("div",{className:"gpf_btm"},Ta.createElement(yn,{key:t&&t.getKey(),breakpoint:r,duration:n,timelines:a,initTime:this.playedSeconds||l,dotBg:i,onScrollEnd:this.handleTimelineProgressScrollEnd,onTimelineClick:this.handleTimelineClick}),Ta.createElement("div",{className:"gpf_controlPanel"},Ta.createElement("div",{className:"gpf_controlPanel_l"},this.renderSocialActions()),this.renderControls("gpf_controlPanel_buttons"),Ta.createElement("div",{className:"gpf_controlPanel_r"},Ta.createElement("div",{className:"gpf_controlPanel_volume"},Ta.createElement(Da.Z,{icon:["gfas","volume-up"]}),Ta.createElement("div",{style:{width:"60px"}},Ta.createElement(An,{played:e,onDragEnd:this.handleVolumeChange,onJump:this.handleVolumeChange}))),this.renderRateBtn(),this.renderListBtn())),this.renderProgressBar())}renderPhoneBtm=()=>Ta.createElement("div",{className:"gpf_phoneBtm"},this.renderProgressBar(),Ta.createElement("div",{className:"gpf_phoneBtm_controls"},Ta.createElement("div",{className:"gpf_phoneBtm_controls_l"}),this.renderControls(),Ta.createElement("div",{className:"gpf_phoneBtm_controls_r"},this.renderListBtn())),Ta.createElement("div",{className:"gpf_phoneBtm_actions"},this.renderSocialActions()));renderResponsiveLayout=()=>{const{phoneLayout:e,sideDisabled:t,sideVisible:a}=this.state;return e?Ta.createElement(Ta.Fragment,null,this.renderPhoneHeader(),this.renderPhoneBody(),this.renderPhoneBtm(),this.renderComments()):Ta.createElement("div",{className:(0,Ma.Z)("gpf_split",{"gpf_split-disabled":t,"gpf_split-visible":a})},Ta.createElement("div",{className:"gpf_split_content"},Ta.createElement("div",{className:"gpf_split_content_fix"},this.renderHeader(),this.renderBody(),this.renderBtm())),Ta.createElement("div",{className:"gpf_split_side"},Ta.createElement("div",{className:"gpf_split_side_closeArea"},Ta.createElement(Ya.Z,{className:"gpf_split_side_close",plain:!0,anchor:!0,onClick:()=>{this.setState((e=>({sideVisible:!e.sideVisible})))}},"toggle")),Ta.createElement("div",{className:"gpf_split_side_inner"},this.renderComments())))};renderComments=()=>{const{currentCommentable:e,popoverVisible:t,sideDisabled:a}=this.state,{radio:n}=this.props;return n?Ta.createElement(Tn,{containerClassName:"gpf_side commentsMana commentsMana-compact mt-0",popoverVisible:t,onCloseClick:this.closeCommentsPopover,commentable:n,subCommentable:"timelines"===e.get("type")?e:void 0,count:e.getAttr("comments-count"),popoverLayout:a}):null};renderBlurContainer(e){const{radio:t}=this.props,{blurImg:a,lastBlurImg:n,blurOverPos:r}=this.state,l=null==t?void 0:t.getAttr("cover");if(!l)return e;const i=a&&a===n,s=i&&r||!i&&!r;return Ta.createElement(Ta.Fragment,null,Ta.createElement("img",{onLoad:this.handleBlurImageLoaded,src:Un(l),alt:"thumb preloader",className:"o_outHidden"}),Ta.createElement("div",{className:(0,Ma.Z)("gpf_blur gpf_blur-btm",{"gpf_blur-hidden":!s})},Ta.createElement("div",{className:"gpf_blur_bg",style:$n(r?n:l)}),Ta.createElement("div",{className:(0,Ma.Z)("gpf_blur",{"gpf_blur-hidden":s})},Ta.createElement("div",{className:"gpf_blur_bg",style:$n(r?l:n)}),e)))}render(){const{init:e,phoneLayout:t}=this.state;return Ta.createElement("div",{className:(0,Ma.Z)("gpf theme-dark")},this.renderBlurContainer(Ta.createElement("div",{className:(0,Ma.Z)("gpf_layout",{"gpf_layout-phone":t})},e?this.renderResponsiveLayout():Ta.createElement("div",{className:"gpf_body"},Ta.createElement("div",{className:"gpf_loading"},"加载中...")))))}}Hn.propTypes={volume:Ga().number.isRequired,radio:Va().record,radioState:Va().map.isRequired,timelines:Va().list,playlist:Va().list,selectedRadioID:Ga().string,startBreakpoint:Ga().number,playing:Ga().bool.isRequired,buffering:Ga().bool.isRequired,duration:Ga().number.isRequired,onPrevClick:Ga().func.isRequired,onPlayPauseClick:Ga().func.isRequired,onNextClick:Ga().func.isRequired,onProgressBarJump:Ga().func.isRequired,onVolumeChange:Ga().func.isRequired,onRateChange:Ga().func.isRequired,onBackward15Click:Ga().func.isRequired,onForward15Click:Ga().func.isRequired},Hn.defaultProps={radio:void 0,timelines:void 0};const Vn=(0,sn.P1)((e=>e.getIn(["player","radio","id"])),sn.LF,((e,t)=>(0,ln.tK)(e,"radios",t))),Wn=(0,Ka.connect)(((e,t)=>{const a=Vn(e,t),n=e.getIn(["player","radio"]),r=e.getIn(["player","playingItem"]),l=a?a.getRel(["media","timelines"]).sort(((e,t)=>e.getAttr("at")-t.getAttr("at"))):void 0;return{radio:a,radioState:n,timelines:l,playingItem:r,duration:t.duration||a&&a.getAttr("duration")||0}}))(Hn),jn={duration:0,startBreakpoint:0},Kn={...jn,init:!1,rate:1,initPlayer:!1,buffering:!1,audioUrl:void 0};class Jn extends Xa.Z{static getDerivedStateFromProps(e,t){var a;let n={};t.initPlayer||!e.playing&&e.mode!==r.R9.FULLSCREEN||(n={...n,initPlayer:!0}),t.propPlayingItem!==e.playingItem&&(n={...n,propPlayingItem:e.playingItem});const l=e.playingItemId;return(null===(a=t.propPlayingItem)||void 0===a?void 0:a.get("id"))!==l&&(n={...n,...jn,audioUrl:void 0}),n}constructor(e){super(e);const{playingItem:t}=e;this.playedSeconds=t&&t.get("breakpoint")||0,this.playerRef=Ta.createRef(),this.rewindPaidTimeout=null,this.recordPlayTimeTask=null,this.recordData=[],this.lastRecorded=null,this.recordLock=!1,this.lockTrack=null,this.state=Kn,this.handleBackward15Click=this.handle15Click.bind(this,!0),this.handleForward15Click=this.handle15Click.bind(this,!1)}componentDidMount(){this.setState({init:!0}),window.addEventListener("unload",this.handleUnloadEvent),document.addEventListener("keydown",this.handleKeyboard),document.body.classList.toggle("has_playerMini",!!this.props.playingItemId),this.state.initPlayer&&this.getPlayingItemUrl(),en.Z.ready((()=>{const e=this.playerInstance();e&&"function"==typeof e.load&&e.load()})),this.startRecordPlayTimeTask()}startRecordPlayTimeTask=()=>{this.recordPlayTimeTask=setInterval((async()=>{if(this.recordLock)return;const{isSignined:e,playing:t,playingItem:a,dispatch:n}=this.props,{audioUrl:r}=this.state;if(t&&r){if(this.recordLock=!0,this.saveBreakpoint(a.get("id")),this.recordData.length>5){let t={},a=null,r=null;for(const{progress:e,radioId:n,eventAt:l}of this.recordData){if(!a||!r||a!==n||e-r<=0||e-r>15e3){a=n,r=e;continue}const i=e-r;t[n]?t[n].duration+=i:t[n]={start:e,duration:i,eventAt:l},a=n,r=e}e&&await n((0,l.mH_)(Object.keys(t).map((e=>{const a=t[e];return{radioId:e,start:a.start,end:a.start+a.duration,eventAt:a.eventAt}})))),this.recordData=[this.recordData[this.recordData.length-1]]}else{const e=a.get("id"),t=new Date,n={radioId:e,progress:this.playedSeconds,eventAt:t.toISOString()};this.recordData.push(n)}this.recordLock=!1}}),1e4)};componentDidUpdate(e,t){const{playingItem:a,playing:n}=this.props,{audioUrl:r,initPlayer:l}=this.state,i=e.playingItem&&e.playingItem.get("id"),s=a&&a.get("id"),o=i!==s;if(document.body.classList.toggle("has_playerMini",!!s),(!t.initPlayer&&l||o)&&this.getPlayingItemUrl(),!o){if(!a||n===e.playing)return;return void(n?(this.lockTrack=null,null===r?this.handleError():(0,fe.K7)(a.toJS(),this.context.pageName)):this.lockTrack!==a.get("id")&&null!==r&&(0,fe.eZ)(a.toJS(),"pause",this.playedSeconds))}n&&a&&(0,fe.K7)(a.toJS(),this.context.pageName);const c=e.playingItem;if(!c)return;const d=c.get("id");this.lockTrack!==d&&this.saveBreakpoint(d),this.lockTrack=null,a?e.playing&&(0,fe.eZ)(c.toJS(),"skip",this.playedSeconds):(0,fe.eZ)(c.toJS(),"quit",this.playedSeconds)}componentWillUnmount(){window.removeEventListener("unload",this.handleUnloadEvent),document.removeEventListener("keydown",this.handleKeyboard),this.clearRewindPaidTimeout(),clearInterval(this.recordPlayTimeTask)}clearRewindPaidTimeout=()=>{this.rewindPaidTimeout&&(clearTimeout(this.rewindPaidTimeout),this.rewindPaidTimeout=null)};playerInstance(){var e;return null===(e=this.playerRef.current)||void 0===e?void 0:e.getInternalPlayer()}setAudioUrl=(e,t)=>{const{playingItemId:a}=this.props;return!(!t||a!==t)&&(this.setState({audioUrl:e}),!0)};getPlayingItemUrl=async()=>{var e,t;const{playingItem:a,dispatch:n}=this.props;if(!a)return;const r=a.get("source")??null,l=a.get("id");if(!r||!r.includes("protected"))return void this.setAudioUrl(r,l);const i=await n((0,$e.P7)({endpoint:`${r}?format=json`})).catch((e=>null)),s=(null==i||null===(e=i.payload)||void 0===e||null===(t=e.origin)||void 0===t?void 0:t.url)??null;this.setAudioUrl(s,l)&&!s&&this.props.playing&&this.handleError()};saveBreakpoint=(()=>{var e=this;return function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.playedSeconds||0;const{isSignined:n}=e.props,r=Date.now();n&&e.props.dispatch(pa.actions.addItem({id:t,type:"radios",progress:a,timestamp:r})),e.props.dispatch((0,l.nsk)(t,a,r))}})();saveCurrentBreakpoint=e=>{const{playingItem:t}=this.props;t&&this.saveBreakpoint(t.get("id"),e)};seekTo=e=>{this.playerRef.current?this.playerRef.current.seekTo(e):this.willSeekTo=e};getCurrentStatus=()=>{const{playingItem:e,playing:t}=this.props;return e?{radioId:e.get("id"),currentTime:this.playedSeconds,playing:t}:null};getBreakpoint=async()=>{const{isSignined:e}=this.props;if("number"==typeof this.willSeekTo)return this.willSeekTo;let{playingItem:t}=this.props;if(!t)return null;const a=t.get("breakpoint")||null,n=t.get("breakpointTimestamp");if(!e)return a;if("number"==typeof a&&(!n||Date.now()-n<1e4))return a;let r=this.getBpFromHistory();return!1===r&&(await this.props.dispatch(pa.actions.getActivityHistory()),r=this.getBpFromHistory()),!1===r?a:r??a};getBpFromHistory=()=>{const{playingItem:e,playlistHistory:t,playlistHistoryStamp:a}=this.props;if(!a||Date.now()-a>1e4)return!1;if(!((null==t?void 0:t.length)>0))return null;const n=t.find((t=>t.id===e.get("id")));return(null==n?void 0:n.progress)??null};dispatchTimeChange=e=>{this.playedSeconds=Math.floor(e.playedSeconds);const t=new CustomEvent("player:progress",{detail:e});window.dispatchEvent(t)};handleUnloadEvent=()=>{this.saveCurrentBreakpoint()};handleKeyboard=e=>{const{mode:t}=this.props,{key:a,target:n}=e;t!==r.R9.FULLSCREEN||["TEXTAREA","INPUT"].includes(n.tagName)||[" ","ArrowRight","ArrowLeft"].includes(a)&&(" "===a?this.handlePlayPauseClick():"ArrowRight"===a?this.handleForward15Click():"ArrowLeft"===a&&this.handleBackward15Click(),e.preventDefault())};handleError=()=>{const{playingItem:e}=this.props;if(!e)return;const{getCurrentUser:t,toggleSigninModal:a,sendPopMessage:n}=this.context,r=t(),l=e.get("isFree");l||r?n({body:l?"无法加载音频文件，请保证网络连接可用，或尝试刷新页面":Ta.createElement("div",null,Ta.createElement("p",null,"无法加载音频文件"),Ta.createElement("ol",null,Ta.createElement("li",null,"请保证您已经购买此付费项目，并保持网络正常，或尝试刷新页面。"),Ta.createElement("li",null,"可尝试登出并重新登入账号再尝试播放。"),Ta.createElement("li",null,"如还有问题，可以通过右下角的反馈功能联系我们。")))}):a()};handleDuration=async e=>{const{playingItem:t}=this.props;let a=await this.getBreakpoint();a&&a+5>=e&&(a=null),this.clearRewindPaidTimeout(),!1===t.get("isFree")&&(this.rewindPaidTimeout=setTimeout((()=>{this.saveCurrentBreakpoint(),this.getPlayingItemUrl()}),96e4)),this.setState({duration:e}),a&&(this.setState({startBreakpoint:a}),this.seekTo(a)),this.willSeekTo=null};handleProgress=e=>{const{startBreakpoint:t}=this.state;t>0&&Math.abs(e.playedSeconds-t)>6&&this.setState({startBreakpoint:0}),this.dispatchTimeChange(e)};handleProgressBarJump=(()=>{var e=this;return function(t){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e.props.dispatch((0,l.Ukv)(!0)),e.seekTo(t)}})();handleBuffer=()=>{this.setState({buffering:!0})};handleBufferEnd=()=>{this.setState({buffering:!1})};handleEnded=async()=>{const{playingItem:e,dispatch:t,continuous:a}=this.props,{duration:n}=this.state;this.lockTrack=e.get("id"),(0,fe.eZ)(e.toJS(),"complete",this.playedSeconds),t((0,l.Ukv)(!1)),this.seekTo(0),this.playedSeconds=0,this.saveCurrentBreakpoint(n);!await t((0,l.G7L)(e))&&a&&t((0,l.ObF)(!0))};handlePlayPauseClick=()=>{const{buffering:e}=this.state;e||this.props.dispatch((0,l.Ukv)())};handleStopClick=()=>{this.props.dispatch((0,l.GjD)())};handleNextClick=()=>{this.props.dispatch((0,l.ObF)(!0))};handlePrevClick=()=>{this.props.dispatch((0,l.ObF)(!1))};handle15Click=e=>{const t=this.playedSeconds+(e?-15:15);this.seekTo(t)};handleToFullScreenClick=()=>{const{playingItemId:e}=this.props;e&&Qa.ZP.push((0,Ja.Z)("timelines",{id:e}))};handleRateChange=e=>{this.setState({rate:e})};handleVolumeChange=e=>{const{dispatch:t}=this.props;t((0,l.smX)({key:"volume",value:e}))};renderPlayer(){const{rate:e,initPlayer:t,audioUrl:a}=this.state,{playing:n,volume:r}=this.props;return a&&t?Ta.createElement(ja(),{ref:this.playerRef,url:a,playing:n,config:{file:{forceAudio:!0,attributes:{preload:"metadata"}}},volume:r,playbackRate:e,style:{display:"none"},onDuration:this.handleDuration,onProgress:this.handleProgress,onEnded:this.handleEnded,onError:this.handleError,onBuffer:this.handleBuffer,onBufferEnd:this.handleBufferEnd}):null}renderMini(){const{mode:e,playing:t,playingItem:a}=this.props;if(!a)return null;const n=e===r.R9.MINI,l=Ta.createElement("div",{className:(0,Ma.Z)("gplayer_mini",{"d-none":!n})},Ta.createElement(Ya.Z,{className:(0,Ma.Z)("gplayer_mini_btn",{"gplayer_mini_btn-playing":t}),onClick:this.handleToFullScreenClick,plain:!0,anchor:!0},Ta.createElement("div",{className:"gplayer_mini_appending"}),Ta.createElement("img",{src:(0,tn.cR)(a.get("thumb"),{resize:{w:80,h:80}}),alt:"正在播放"})),Ta.createElement(Ya.Z,{plain:!0,anchor:!0,className:"gplayer_mini_control",onClick:this.handlePlayPauseClick},Ta.createElement(Da.Z,{icon:["gfas",t?"pause":"play"]})),Ta.createElement(Ya.Z,{plain:!0,anchor:!0,className:"gplayer_mini_close",onClick:this.handleStopClick},Ta.createElement(Da.Z,{icon:["gfas","times"]})));return(0,za.createPortal)(l,document.querySelector(".globalActions"))}renderFullScreen(){const{mode:e,playing:t,playlist:a,playingItemId:n,volume:l}=this.props;if(!n||e!==r.R9.FULLSCREEN)return null;const{duration:i,rate:s,buffering:o,startBreakpoint:c}=this.state;return Ta.createElement(Wn,{startBreakpoint:c,playing:t,buffering:o,playlist:a,selectedRadioID:n,initTime:this.playedSeconds,duration:i,volume:l,rate:s,onPrevClick:this.handlePrevClick,onPlayPauseClick:this.handlePlayPauseClick,onNextClick:this.handleNextClick,onProgressBarJump:this.handleProgressBarJump,onVolumeChange:this.handleVolumeChange,onRateChange:this.handleRateChange,onBackward15Click:this.handleBackward15Click,onForward15Click:this.handleForward15Click})}render(){const{init:e}=this.state;return e?Ta.createElement("div",null,this.renderMini(),this.renderFullScreen(),this.renderPlayer()):null}}Jn.contextType=Ua.qe,Jn.propTypes={continuous:Ga().bool.isRequired,volume:Ga().number.isRequired,mode:Ga().number.isRequired,playing:Ga().bool.isRequired,playingItemId:Ga().string,playingItem:Va().map,playlist:Va().list.isRequired},Jn.defaultProps={playingItemId:void 0,playingItem:void 0};const Yn=(0,Ka.connect)((e=>{var t;const a=(e=>e.getIn(["player","playlist"]))(e),n=e.getIn(["player","playing"]),r=e.getIn(["player","mode"]),l=e.getIn(["player","volume"]),i=e.getIn(["player","continuous"]),s=(e=>e.getIn(["player","playingItem","id"]))(e),o=e.getIn(["player","playingItem"]);return{isSignined:e.getIn(["session","signined"]),volume:l,continuous:i,playing:n,playingItemId:s,playingItem:o,playlist:a,mode:r,playlistHistory:null===(t=e.getIn(["data",pa.namespace,"history","origin"]))||void 0===t?void 0:t.playlist,playlistHistoryStamp:e.getIn(["data",pa.namespace,"history","fetchedAt"])}}),null,null,{forwardRef:!0})(Jn);var Xn=a(66261),Qn=a(69951),er=a(66688),tr=a(59129);const ar=Qn.CF,{BUG:nr,SUGGESTION:rr,ACCOUNT:lr,CONTENT_AUDIT:ir}=tr.default.feedback.type,sr=e=>{const{content:t}=e,a={};return t&&t.length>0||(a.content="内容不能为空"),a},or=e=>{let{onSubmit:t,initialType:a}=e;return Ta.createElement(er.l0,{validate:sr,onSubmit:t,initialValues:{type:a??`${nr}`}},(e=>{let{handleSubmit:t}=e;return Ta.createElement("form",{onSubmit:t,method:"post",id:"feedbackForm"},Ta.createElement(Qn.AS,{name:"type",options:[{label:"功能反馈",value:`${nr}`},{label:"优化建议",value:`${rr}`},{label:"账号解封",value:`${lr}`},{label:"内容审核",value:`${ir}`}]}),Ta.createElement(er.gN,{name:"email",type:"email",placeholder:"邮箱（可选）"},ar),Ta.createElement(er.gN,{name:"content",placeholder:"内容",componentType:"textarea"},ar),Ta.createElement(er.gN,{name:"image"},Qn.jM))}))};or.propTypes={onSubmit:Ga().func.isRequired,initalType:Ga().string};const cr=or,dr={dispatchFeedback:N.qr2},mr=(0,Ka.connect)(((e,t)=>({session:e.get("session")})),dr)((e=>{let{initialType:t,appendMsg:a="",visible:n,onClose:r,session:l,dispatchFeedback:i}=e;return Ta.createElement(_n.Z,{visible:n,title:"反馈",desc:"填写反馈内容",contentLabel:"Modal",onCloseClick:r,onConfirmClick:()=>{(0,Qn.Ps)("feedbackForm")},subActions:Ta.createElement(Ya.Z,{type:"secondary",size:"lg",to:w.default.faq_url},"常见问题解答")},Ta.createElement(cr,{onSubmit:async e=>{const{email:t,type:n,content:s,image:o}=e;(await i({userID:l.get("userID"),email:t,type:n,content:`${s}${a?`\n${a}`:""}`,image:o})).error||r()},initialType:t}))})),ur=e=>{let{children:t,...a}=e;const[n,r]=(0,Ta.useState)(!1);return(0,Ta.useEffect)((()=>{const e=window.location.href,t=new URL(e),a=t.searchParams;"1"===a.get("feedback")&&(a.delete("feedback"),t.search=a.toString(),history.replaceState(null,"",t.toString()),r(!0))}),[]),Ta.createElement(Ta.Fragment,null,Ta.createElement(mr,{visible:n,onClose:()=>{r(!1)}}),Ta.createElement(Ya.Z,(0,Aa.Z)({},a,{onClick:()=>{r(!0)}}),t||"反馈"))},pr=()=>{Xn.NY.scrollTo(0)},gr=(0,tn.FZ)(),hr={light:"浅色样式",dark:"深色样式",system:"跟随系统"},vr={dispatchSwitchTheme:N.tjw},Er=(0,Ka.connect)((e=>({inAlbumPage:e.getIn(["album","showing","id"]),currentTheme:e.getIn(["status","theme"])})),vr)((e=>{let{children:t,inAlbumPage:a,currentTheme:n,dispatchSwitchTheme:r}=e;const{modal:l,setModalVisible:i}=((e,t)=>{const[a,n]=(0,Ta.useState)(!1),r=Ta.createElement(_n.Z,{visible:a,title:"外观样式",contentLabel:"Modal",onCloseClick:()=>{n(!1)},onConfirmClick:()=>{n(!1)}},Ta.createElement("fieldset",{className:"form-group"},["dark","light","system"].map((a=>Ta.createElement("div",{key:a,className:"form-check"},Ta.createElement("input",{id:gr(a),type:"radio",className:"form-check-input",name:"theme",checked:e===a,value:a,onChange:()=>{t(a)}}),Ta.createElement("label",{className:"form-check-label",htmlFor:gr(a)},hr[a]))))));return{modal:r,setModalVisible:n}})(n,r);return Ta.createElement("div",{className:(0,Ma.Z)("globalActions",{"globalActions-inAlbumPage":a})},l,Ta.createElement("div",null,Ta.createElement(Ya.Z,{className:"globalActions_item",plain:!0,anchor:!0,onClick:pr},Ta.createElement("div",null,Ta.createElement(Da.Z,{icon:["gfas","back-to-top"],className:"small"})),Ta.createElement("p",null,"回到顶部")),Ta.createElement(Ya.Z,{className:"globalActions_item",plain:!0,anchor:!0,onClick:()=>{i(!0)}},Ta.createElement("div",null,Ta.createElement(Da.Z,{icon:["gfas","theme"],className:"globalActions_icon-theme"})),Ta.createElement("p",null,"外观样式")),Ta.createElement(ur,{plain:!0,anchor:!0,className:"globalActions_item"},Ta.createElement("div",null,Ta.createElement(Da.Z,{icon:["gfas","feedback"]})),Ta.createElement("p",null,"建议反馈"))),t)}));var fr=a(54333),yr=a(85896),br=a(87022);const kr=e=>{let{visible:t,toggleVisible:a,onRightIconClick:n,rightIcon:r,rightDeepLinkTo:l,transparent:i,fixed:s=!0}=e;const[o,c]=(0,Ta.useState)(!0),[d,m]=(0,Ta.useState)(!1);return(0,Ta.useEffect)((()=>s?(0,an.Vp)((e=>{let{top:t,hide:a}=e;"boolean"==typeof t&&c(t),"boolean"==typeof a&&m(a)})):(c(!0),void m(!1))),[s]),Ta.createElement("div",{className:(0,Ma.Z)("navLayout_mobileNavPlaceholder",{"navLayout_mobileNavPlaceholder-transparent":i})},Ta.createElement("nav",{className:(0,Ma.Z)("navLayout_mobileNav",{"navLayout_mobileNav-top":o,"navLayout_mobileNav-hide":d,"navLayout_mobileNav-transparent":o&&i})},Ta.createElement("div",null,Ta.createElement(Ya.Z,{plain:!0,onClick:a},Ta.createElement(Da.Z,{icon:["gfas",t?"times":"bars"]}))),Ta.createElement(dn.Z,{to:"/"},Ta.createElement(Da.Z,{icon:["gfas","gcores"]})),Ta.createElement("div",null,r&&n&&Ta.createElement(br.Z,{label:"导航搜索按钮",openUrl:l},Ta.createElement(Ya.Z,{plain:!0,onClick:n},Ta.createElement(Da.Z,{icon:r}))))))};var Cr=a(73742);class _r extends Ta.PureComponent{static defaultProps={visible:!1};state={contentVisible:!1,initialized:!1};componentDidMount(){this.setState({initialized:!0})}render(){const{contentVisible:e,initialized:t}=this.state,{visible:a,children:n}=this.props;return t?(0,za.createPortal)(Ta.createElement(qn(),{onClickOutside:this.handleOuterClick},Ta.createElement(Cr.Z,{in:a,classNames:"sideDrawer",onExited:this.handleExited,onEnter:this.handleEnter,timeout:500},Ta.createElement("div",{className:(0,Ma.Z)("sideDrawer")},e&&n))),document.body):null}handleOuterClick=()=>{const{onRequestClose:e}=this.props;e&&e()};handleExited=()=>{this.setState({contentVisible:!1})};handleEnter=()=>{this.setState({contentVisible:!0})}}const wr=_r;var Nr=a(83950),Pr=a(60471);const Sr=e=>{let{tabs:t,afterContent:a,children:n,...r}=e;return Ta.createElement("div",{className:"notificationsCenter"},Ta.createElement(Pr.Z,(0,Aa.Z)({baseClass:"notificationsCenter_tabs",className:1===t.length?"notificationsCenter_tabs-onlyOne":void 0,tabs:t,hrefEnabled:!1},r)),Ta.createElement("div",{className:"notificationsCenter_body"},n),a)},Zr=()=>Ta.createElement("div",{className:"notificationsCenter_body_empty"},Ta.createElement("p",null,"没有任何动态"));var Ir=a(91433),Tr=a(71405),Ar=a(73925),Rr=a(56196);class Dr extends Xa.Z{componentDidMount(){this.request(!0)}request(e){const{currentUser:t,threadsState:a}=this.props,n=e?0:a.get("currentPage")||0;a.get("isRequesting")||a.get("noMore")||this.props.dispatch((0,N.gPM)(t.get("id"),n+1,e))}getUserInfo=e=>{const t=e.getAttr("is-system"),a=e.getIn(["relationships","opponent","data","id"]),n=t||tr.cn.includes(a),r=t?"机核":e.getRelAttr("opponent","nickname");return{isSystem:t,isOfficial:n,path:(0,Ir.ZP)("mails",{opponentID:a}),nickname:r}};handleScroll=()=>{this.request()};handleNotScrollable=()=>{const{threads:e}=this.props;e&&e.size>0&&this.request()};handleDeleteThreadClick=e=>{const{dispatch:t,deleting:a,threads:n}=this.props;if(a)return;const r=e.currentTarget.getAttribute("data-id"),l=n.find((e=>e.get("id")===r));if(!l)return;const{nickname:i}=this.getUserInfo(l);confirm(`确认删除和 ${i} 的私信记录？`)&&t((0,N.bto)(r)).then((()=>{const e=(0,nn.XW)(),{opponentID:t}=e.query;r.split("|")[1]===t&&Qa.ZP.replace((0,Ir.ZP)("mails"))}))};renderName=e=>{const{isOfficial:t,nickname:a}=e;return Ta.createElement(Ta.Fragment,null,a,t&&Ta.createElement("span",{className:"badge bg-dark ms-2"},"官方"))};renderBody=e=>{const t=this.getUserInfo(e),{path:a}=t,n=e.getAttr("unread-count");return Ta.createElement(dn.Z,{to:a,className:"thread_body"},Ta.createElement("p",null,Ta.createElement("strong",null,this.renderName(t)),Ta.createElement("span",{suppressHydrationWarning:!0},(0,rn.Sy)(e.getAttr("updated-at")))),Ta.createElement("p",null,Ta.createElement("span",null,(0,Tr.io)(e.getRelAttr("latest-private-mail","body"),30)),n>0?Ta.createElement("span",{className:"thread_unreadCount"},n>10?"..":n):Ta.createElement("span",null)))};renderThumb=e=>{const{nickname:t,path:a,isSystem:n}=this.getUserInfo(e);return Ta.createElement(dn.Z,{to:a,className:"thread_avatar"},Ta.createElement("img",{src:(0,tn.CA)(n?"system":e.getRelAttr("opponent","thumb"),{resize:{w:50,h:50}}),alt:t}))};renderThread=e=>{const{editable:t}=this.props;return Ta.createElement("li",{key:e.getKey()},Ta.createElement("div",{className:(0,Ma.Z)("thread",{"thread-editable":t})},this.renderThumb(e),this.renderBody(e),t&&Ta.createElement(Ya.Z,{"data-id":e.get("id"),onClick:this.handleDeleteThreadClick,type:"link",className:"thread_close"},Ta.createElement(Da.Z,{icon:["gfas","times"],className:"fa-sm"}))))};renderList=e=>{const{editable:t,threadsState:a}=this.props;return Ta.createElement("ul",{className:(0,Ma.Z)("mailThreads",{"mailThreads-editable":t})},e.map((e=>this.renderThread(e))),a.get("isRequesting")&&Ta.createElement("li",{className:"mutedInfo"},"读取中..."))};render(){const{threads:e,threadsState:t,className:a,emptyContent:n}=this.props;return Ta.createElement(Ar.Z,{onScrollToBottom:this.handleScroll,onNotScrollable:this.handleNotScrollable,checkNotScrollableKey:`${e.size}`,className:a},Ta.createElement(Rr.Z,{loading:t.get("isRequesting"),fetched:t.get("fetched"),data:e,emptyContent:n},this.renderList))}}Dr.propTypes={threads:Va().list.isRequired,currentUser:Va().record,deleting:Ga().bool},Dr.defaultProps={currentUser:void 0,deleting:!1};const xr=(0,sn.P1)((e=>e.getIn(["data","notificationsCenter","privateMailThreads","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Mr=(0,Ka.connect)(((e,t)=>{const a=xr(e,t),n=e.getIn(["data","notificationsCenter","privateMailThreads"]),r=e.getIn(["network","deletePrivateMailThread","isRequesting"]);return{threads:a,threadsState:n,currentUser:(0,sn.ib)(e,t),deleting:r}}))(Dr);Mr.propTypes={opponentID:Ga().string,className:Ga().string,emptyContent:Ga().node,editable:Ga().bool},Mr.defaultProps={opponentID:void 0,className:void 0,emptyContent:void 0,editable:!1};const Lr=Mr;var qr=a(47467),Fr=a(68611);const Br=e=>(0,Tr.io)(e,15),Or=e=>e?(0,Ir.bv)(e.get("type"),e.get("id")):"/",Ur=e=>{const t=e.getRel("target"),a=e.getRel("lead-actors"),n=a.first();return{target:t,actors:a,actor:n,object:e.getRel("lead-objects",0)}},$r=function(e){let{overrideLinkData:t,fallbackText:a="详情",noLink:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return null;let r=e.getTitle();if("comments"===e.get("type")?r=Br(e.getAttr("body")):"talks"===e.get("type")?r=Br((0,tn.tg)(e.getAttr("content"))):"games"===e.get("type")&&(r=Br(e.getAttr("title"))),r=r||a,!r)return null;if(n)return r;const l=Or(t||e);return Ta.createElement(dn.Z,{to:l},r)},Gr=function(e){let{forYou:t,hideActors:a,noLink:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{object:r,actors:l,target:i}=Ur(e),s=e.getAttr("verb"),o=i&&i.get("type");let c="未知消息",d="未知对象",m=t?"你的":"";"games"===o&&(m="");const u=null==r?void 0:r.get("type"),p=tn.AS[u]||"内容",g=tn.AS[o];if(!a&&l.size>0){const t=l.first();if("users"===t.get("type")&&l.size>1){const a=l.get(1);d=Ta.createElement(Ta.Fragment,null,Ta.createElement(dn.Z,{div:!!n&&"span",to:(0,Ir.bv)(t.get("type"),t.get("id"))},t.getAttr("nickname")),"、",Ta.createElement(dn.Z,{div:!!n&&"span",to:(0,Ir.bv)(a.get("type"),a.get("id"))},a.getAttr("nickname"))," ","等",e.getAttr("actors-count"),"人")}else d=Ta.createElement(dn.Z,{div:!!n&&"span",to:(0,Ir.bv)(t.get("type"),t.get("id"))},t.getTitle()," ")}return"like"===s?c=Ta.createElement(Ta.Fragment,null,d,"喜欢了",m,p," ",$r(r,{noLink:n})):"bookmark"===s?c=Ta.createElement(Ta.Fragment,null,d,"收藏了",m,p," ",$r(r,{noLink:n})):"reply"===s?c=Ta.createElement(Ta.Fragment,null,d,"回复了",Ta.createElement(dn.Z,{to:Or(i)},m,g," : ",Br(r.getAttr("body")))):"comment"===s?c=Ta.createElement(Ta.Fragment,null,d,"games"===o?"评价":"评论","了",m,g," ",$r(i,{overrideLinkData:r,noLink:n})," :"," ",(0,Tr.io)(r.getAttr("body"),15)):"publish"===s?c=Ta.createElement(Ta.Fragment,null,d,g&&Ta.createElement(Ta.Fragment,null,"于",g," ",$r(i,{noLink:n})),"发布了",p," ",$r(r,{noLink:n})):"follow"===s?c=Ta.createElement(Ta.Fragment,null,d,"关注了你"):"subscribe"===s?c=Ta.createElement(Ta.Fragment,null,d,"games"===u?"关注了":"订阅了",p," ",$r(r,{noLink:n})):"helpful"===s?c=Ta.createElement(Ta.Fragment,null,$r(i,{noLink:n})," 的"," ",Ta.createElement(dn.Z,{to:Or(l.get(0))},"游戏制作者")," 认为你的",p,"很有帮助 ",$r(r,{noLink:n})):"mention"===s&&(c=Ta.createElement(Ta.Fragment,null,d," 在",p," ",$r(r,{noLink:n})," ","中提到了你")),Ta.createElement("span",{className:"o_feedDescription"},c)};var zr=a(15070);const Hr={resize:{w:40,h:40}},Vr=e=>{let{body:t,actors:a,meta:n,image:r,action:l,to:i}=e;return Ta.createElement("div",{className:"feed"},Ta.createElement(dn.Z,{to:(0,Ir.ZP)(a.first()),className:(0,Ma.Z)("feed_actors",{"feed_actors-multi":a.size>1})},a.map((e=>(e=>{if("users"===e.get("type"))return Ta.createElement(zr.Z,{key:e.getKey(),thumb:e.getAttr("thumb"),ossOptions:Hr});if("categories"===e.get("type")){const t=e.getTitle(),[a]=t;return Ta.createElement("div",{key:e.getKey(),className:"feed_categoryThumb"},a)}return"albums"===e.get("type")?Ta.createElement("img",{key:e.getKey(),src:(0,tn.cR)(e.getAttr("cover"),Hr),alt:e.getTitle()}):"games"===e.get("type")?Ta.createElement("img",{key:e.getKey(),src:(0,tn.cR)(e.getAttr("icon")||e.getThumb(),Hr),alt:e.getTitle()}):Ta.createElement("img",{key:e.getKey(),src:(0,tn.CA)(void 0,Hr),alt:"unknown"})})(e)))),Ta.createElement("div",{className:"feed_body"},Ta.createElement("span",{className:"me-1"},t),Ta.createElement("span",{className:"o_minFontSize u_color-gray-nearly-text",suppressHydrationWarning:!0},n)),r&&Ta.createElement(dn.Z,{to:i,className:(0,Ma.Z)("feed_original",{"feed_original-local":/^\//.test(r)}),style:{backgroundImage:`url(${(0,tn.cR)(r,Hr)})`}}),l)};Vr.propTypes={body:Ga().node.isRequired,meta:Ga().string.isRequired,actors:Va().list.isRequired,image:Ga().string,action:Ga().node,to:Ga().string},Vr.defaultProps={image:void 0,action:void 0,to:"/"};const Wr=Vr,jr=e=>{let{feed:t,forYou:a}=e;const{object:n,actors:r,actor:l}=Ur(t);if(!n)return null;const i=(0,rn.Sy)(t.getAttr("updated-at")),s=(0,Ir.bv)(n.get("type"),n.get("id")),o=Gr(t,{forYou:a}),c=(e=>{const{object:t,target:a}=Ur(e),n=e.getAttr("image");if("portfolios"===(null==t?void 0:t.get("type")))return t.getAttr("cover")||Fr;let r;if("talks"===(null==t?void 0:t.get("type"))?r=t:"talks"===(null==a?void 0:a.get("type"))&&(r=a),!r)return n;return r.getThumb()||("helpful"===e.getAttr("verb")?null:n)})(t),d=(()=>{if("follow"===t.getAttr("verb")&&"users"===l.get("type"))return Ta.createElement(qr.Z,{followee:l,className:"feed_action",type:"info",size:"sm",eachOther:!1})})();return Ta.createElement(Wr,{body:o,actors:r,meta:i,image:c,action:d,to:s})};jr.propTypes={feed:Va().record.isRequired,forYou:Ga().bool},jr.defaultProps={forYou:!1};const Kr=jr;class Jr extends Xa.Z{componentWillUnmount(){const{currentUserID:e,markFeedsSeen:t,postMarkFeedsSeen:a}=this.props;t(),a(e)}render(){const{feeds:e,lastSeen:t}=this.props,a=((e,t)=>{const a=e.reduce(((e,t)=>e.findIndex((e=>e.getKey()===t.getKey()))>=0?e:e.push(t)),(0,k.List)()).filter((e=>e.getRel("lead-objects",0))),n=t?a.findIndex((e=>(0,rn.u3)(e.getAttr("updated-at"))<(0,rn.u3)(t))):-1;return n>0?a.insert(n,"old"):a})(e,t);return this.renderList(a)}renderList=e=>{const{forYou:t,className:a}=this.props,n=!!e.find((e=>"old"===e));return Ta.createElement("ul",{className:(0,Ma.Z)("notificationsCenter_list",a)},n?Ta.createElement("li",{className:"notificationsCenter_br"},"最新"):null,e.map((e=>"old"===e?Ta.createElement("li",{key:"old",className:"notificationsCenter_br"},"较早"):Ta.createElement("li",{key:e.getKey()},Ta.createElement(Kr,{feed:e,forYou:t})))))}}const Yr=Jr,Xr=(0,sn.TJ)(["data","notificationsCenter","interactionFeeds","ids"]),Qr=e=>{let{onClick:t}=e;const a=(0,Ka.useSelector)(Xr),n=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","interactionFeedsUnseenCount"]))),r=a.first(),l=r?Gr(r,{forYou:!0,noLink:!0}):"暂无喜欢与收藏通知",i=r?(0,rn.Sy)(r.getAttr("updated-at")):null;return Ta.createElement(Ya.Z,{plain:!0,onClick:t,className:(0,Ma.Z)("feed interactionRow")},Ta.createElement("span",{className:"interactionRow_icon"},Ta.createElement(Da.Z,{icon:["gfas","thumbs-up"]})),Ta.createElement("div",{className:"interactionRow_body"},Ta.createElement("h3",null,Ta.createElement("span",null,"喜欢和收藏"),Ta.createElement("b",{suppressHydrationWarning:!0},i)),Ta.createElement("p",null,n>0&&Ta.createElement("b",null,"number"!=typeof(s=n)?0:s<100?s:"99+"),Ta.createElement("span",null,l))));var s},el=e=>{let{lastSeen:t,unseenCount:a,fetched:n=!1}=e;return(0,yr.II)(!(n&&0===a&&t&&Date.now()-new Date(t).getTime()<=15e3))},tl=(0,sn.P1)((e=>e.getIn(["data","notificationsCenter","notificationFeeds","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),al=(0,sn.TJ)(["data","notificationsCenter","interactionFeeds","ids"]),nl=e=>{let{onInteractionSectionClick:t}=e;const a=(0,Ka.useDispatch)(),n=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","notificationFeedsLastSeenAt"]))),r=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","notificationFeedsUnseenCount"]))),l=(0,Ka.useSelector)((e=>(0,sn.ib)(e))),i=null==l?void 0:l.get("id"),s=(0,Ka.useSelector)(tl),o=(0,Ka.useSelector)(al),c=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","notificationFeeds"]))),d=(c.get("currentPage")??0)+1,m=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return 1===t&&await a((0,N.uNh)(e,1,!0)),await a((0,N.Z1U)(e,t,1===t))}),[i,d,a]),u=(0,yr.II)(m),p=el({lastSeen:n,fetched:null==c?void 0:c.get("fetched"),unseenCount:r}),g=(0,Ta.useCallback)((async()=>{p.current&&await u.current(i,1)}),[i,p,u]),h=Ta.createElement(Qr,{onClick:()=>{t()}});return Ta.createElement(Cn.Z,{data:s,state:c,onLoad:m,onInit:g,scrollableProps:{inWindow:!1,bottomOffset:100},emptyContent:(null==o?void 0:o.size)>0?h:Ta.createElement(Zr,null)},(e=>Ta.createElement(Ta.Fragment,null,h,Ta.createElement(Yr,{feeds:e.filter((e=>!["like","bookmark"].includes(e.getAttr("verb")))),forYou:!0,lastSeen:n,currentUserID:i,markFeedsSeen:()=>{a((0,N.Wlr)())},postMarkFeedsSeen:()=>{a((0,N.dag)(i))}}))))},rl=(0,sn.P1)((e=>e.getIn(["data","notificationsCenter","interactionFeeds","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),ll=()=>{const e=(0,Ka.useDispatch)(),t=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","interactionFeedsLastSeenAt"]))),a=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","interactionFeedsUnseenCount"]))),n=(0,Ka.useSelector)((e=>(0,sn.ib)(e))),r=null==n?void 0:n.get("id"),l=(0,Ka.useSelector)(rl),i=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","interactionFeeds"]))),s=(i.get("currentPage")??0)+1,o=(0,Ta.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;return await e((0,N.uNh)(t,a,1===a))}),[r,s,e]),c=(0,yr.II)(o),d=el({unseenCount:a,lastSeen:t,fetched:null==i?void 0:i.get("fetched")}),m=(0,Ta.useCallback)((async()=>{d.current&&await c.current(r,1)}),[r,d,c]);return Ta.createElement(Cn.Z,{data:l,state:i,onLoad:o,onInit:m,scrollableProps:{inWindow:!1,bottomOffset:100},emptyContent:Ta.createElement(Zr,null)},(a=>Ta.createElement(Ta.Fragment,null,Ta.createElement(Yr,{feeds:a,forYou:!0,lastSeen:t,currentUserID:r,markFeedsSeen:()=>{e((0,N.$Eb)())},postMarkFeedsSeen:()=>{e((0,N.wHW)(r))}}))))},il=()=>{const e=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","notificationFeedsUnseenCount"]))),t=(0,Ka.useSelector)((e=>e.getIn(["data","notificationsCenter","privateMailThreadsUnseenCount"]))),[a,n]=(0,Ta.useState)("notifications"),[r,l]=(0,Ta.useState)(!1),i=(0,Ta.useCallback)(((a,n)=>{const r={notifications:e,mails:t}[a];return Ta.createElement("span",{className:r>0?"is_unseen":void 0},n)}),[e,t]),s=(0,Ta.useMemo)((()=>[{key:"notifications",title:"通知",render:i},{key:"mails",title:"私信",render:i}]),[i]);if(r)return Ta.createElement(Sr,{tabs:[{key:"interaction",title:"喜欢和收藏",render:(e,t)=>Ta.createElement("span",null,Ta.createElement(Da.Z,{icon:["gfas","angle-left"]})," ",t)}],active:"interaction",onTabChange:()=>{l(!1)}},Ta.createElement(ll,null));const o="notifications"===a?Ta.createElement(nl,{onInteractionSectionClick:()=>{l(!0)}}):Ta.createElement(Lr,{emptyContent:Ta.createElement(Zr,null)});return Ta.createElement(Ta.Fragment,null,Ta.createElement(Sr,{tabs:s,active:a,onTabChange:e=>{n(e)},afterContent:Ta.createElement(dn.Z,{to:(0,Ir.ZP)("settings"),className:"notificationsCenter_icon"},Ta.createElement(Da.Z,{icon:["gfas","settings"]}))},o))};var sl=a(84644);const ol=e=>{let{original:t,type:a,meta:n}=e;const r=(0,Ka.useDispatch)(),i=t.getAttr("duration"),s=null==n?void 0:n.get("progress"),o="radios"===a,c=Ta.createElement("img",{className:"historyItem_img",src:(0,tn.cR)(o?t.getAttr("cover"):t.getAttr("thumb"),{resize:{w:80,m:"lfit"},bright:tn.jh})}),d=i?o?Ta.createElement(Ta.Fragment,null,Ta.createElement("span",null,t.getAttr("comments-count")," 评论"),(()=>{if(!(i&&s>0))return null;const e=parseInt((100*s/i).toFixed(0));return e>0?100===e?Ta.createElement("span",null,"已播完"):Ta.createElement("span",null,"已播 ",`${e}%`):null})()):null!=n&&n.get("timestamp")?(0,rn.Sy)(new Date(n.get("timestamp"))):null:null;return Ta.createElement("li",{key:t.get("id"),className:(0,Ma.Z)("historyItem",{[`historyItem-${a}`]:a})},"radios"===t.get("type")&&o?Ta.createElement(Ya.Z,{plain:!0,className:"historyItem_playBtn",onClick:()=>{r((0,l.lMO)(t.get("id"),s>0?{breakpoint:s}:{}))}},c):Ta.createElement(dn.Z,{to:(0,Ir.ZP)(t)},c),Ta.createElement("div",{className:"historyItem_body"},Ta.createElement("h3",null,Ta.createElement(dn.Z,{to:(0,Ir.ZP)(t)},t.getAttr("title"))),Ta.createElement("p",{suppressHydrationWarning:!0},d)))},cl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["data",pa.namespace,...e]},dl=(0,sn.TJ)((e=>{let{type:t}=e;return cl([t,"ids"])})),ml=e=>{let{list:t=(0,k.List)(),type:a}=e;const n=(0,Ka.useDispatch)(),r=(0,Ka.useSelector)((e=>dl(e,{type:a}))),l=t.map((e=>r.find((t=>t.get("id")===e.get("id"))))).filter((e=>e)),i=(0,Ka.useSelector)((e=>e.getIn(cl([a])).merge(0===t.size?{isRequesting:!1,noMore:!0,fetched:!0}:{}))),s=t.map((e=>e.get("id"))),o=s.join(","),c=i.get("currentPage")??1,{props:d}=(0,sl.kL)(),m=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c+1;const t=10*(e-1),r=s.slice(t,t+10);if(!(r.size>0))return;const l="originals"===a?"getOriginals":"getRadios";await n(pa.actions[l]({ids:r,page:e,limit:10,recordCount:s.size}))}),[c,n,s,a]),u=(0,yr.II)(m),p=(0,Ta.useCallback)((async()=>{await u.current(1)}),[o,u]);return Ta.createElement(Cn.Z,{data:l,scrollableProps:d,state:i,onLoad:m,onInit:p},(e=>Ta.createElement("ul",{className:"historyList"},e.map((e=>{const n=t.find((t=>t.get("id")===e.get("id")));return Ta.createElement(ol,{key:e.get("id"),type:a,original:e,meta:n})})))))},ul=[{key:"play",title:"收听"},{key:"view",title:"浏览"}],pl=e=>(0,k.fromJS)(e),gl=e=>{const t=(0,Ka.useDispatch)(),[a,n]=(0,Ta.useState)(ul[0].key),r=(0,Ka.useSelector)((e=>e.getIn(["data",pa.namespace,"history","origin"]))),l=(0,yr.HN)(r,{format:pl});(0,Ta.useEffect)((()=>{t(pa.actions.getActivityHistory())}),[t]);const i="play"===a?Ta.createElement(ml,{type:"radios",list:null==l?void 0:l.get("playlist")}):"view"===a?Ta.createElement(ml,{type:"originals",list:null==l?void 0:l.get("readlist")}):null;return Ta.createElement(Sr,{tabs:ul,active:a,onTabChange:e=>{n(e)}},i)};var hl=a(93179);const vl=e=>e<100?e:"99+",El=(e,t)=>(0,Ir.o0)("signin",{from_page:e,return:(0,Ir.o0)(t)});class fl extends Ta.PureComponent{static defaultProps={currentUser:void 0,notificationsUnseenCount:0};refUserPopover=Ta.createRef();popoverBtnRefs;requestTask;hintTimeout;requestCountRemain=8;constructor(e){super(e),this.state={signinHintVisible:!1,notificationsModalVisible:!1,notificationsDrawerVisible:!1,historyModalVisible:!1,historyDrawerVisible:!1},this.refUserPopover=Ta.createRef(),this.popoverBtnRefs=[this.refUserPopover,...e.popoverRefsToHide?e.popoverRefsToHide:[]]}componentDidMount(){this.startRequestTask(),this.forReviwer(),this.tempHideSigninHint(),window.addEventListener("scroll",this.tempHideSigninHint)}componentDidUpdate(e,t){const{notificationsDrawerVisible:a}=this.state;t.notificationsDrawerVisible!==a&&(a?this.stopRequestTask():this.startRequestTask())}componentWillUnmount(){this.stopRequestTask(),window.removeEventListener("scroll",this.tempHideSigninHint)}render(){return Ta.createElement(Ta.Fragment,null,this.renderDrawer(),Ta.createElement(hl.Z,(0,Aa.Z)({},this.props,{userItems:this.userItems,popoverRefsToHide:this.popoverBtnRefs,onLinkClick:this.handleLinkClick,onStyleChange:this.handleNavBarStyleChange})))}tempHideSigninHint=()=>{this.props.currentUser||(this.setState({signinHintVisible:!1}),this.hintTimeout&&clearTimeout(this.hintTimeout),this.hintTimeout=setTimeout((()=>{this.setState({signinHintVisible:!0})}),3e3))};startRequestTask=()=>{const{currentUser:e}=this.props;e&&this.request()};forReviwer=()=>{var e,t;if("undefined"==typeof window)return;const{currentUser:a}=this.props;(null===(e=(0,nn.XW)())||void 0===e||null===(t=e.query)||void 0===t?void 0:t.reviewer_mode)&&(a?!a.isReviewer()&&confirm("当前账户没有 reviewer 权限，是否退出当前账户并重新验证？")&&(location.href=(0,Ir.o0)("signout",{return:`${location.pathname}${location.search}`})):this.context.toggleSigninModal("reviewerMode",{tip:"请使用 reviewer 账户登录",tipType:l.ZQC.WARNING}))};request=()=>{this.requestTask||this.requestCountRemain<=0||(this.requestTask=setTimeout((()=>{const{dispatch:e,currentUser:t}=this.props;t&&Promise.all([e((0,l.tse)(t.get("id")))]).then((()=>{this.requestTask&&(this.requestTask=null,this.requestCountRemain--,this.request())}))}),2e4))};stopRequestTask=()=>{this.requestTask&&(clearTimeout(this.requestTask),this.requestTask=null)};hideAllVisibleComponent=()=>{this.setState({signinHintVisible:!1,historyDrawerVisible:!1,historyModalVisible:!1,notificationsModalVisible:!1,notificationsDrawerVisible:!1})};userItems=e=>{const{signinHintVisible:t}=this.state,{currentUser:a,userItems:n}=this.props;let r=a?[(0,Nr.C)(a,this.context),{key:"bookmarks",title:"收藏",to:(0,Ir.ZP)("userBookmarks",{id:a.get("id")})},{key:"history",component:"历史",title:this.renderHistoryModalBtn(),onClick:this.handleHistoryBtnClick,onSmClick:this.handleShowHistoryModalClick},{key:"notification",component:this.renderNotificationCompBtn(),title:this.renderNotificationsModalBtn(),onClick:this.handleNotificationsBtnClick,onSmClick:this.handleShowNotificationsModalClick}]:((e,t,a,n)=>{const r={onClick:()=>{a(!0)},toSm:El(e,t),onSmClick:()=>{}},l=Ta.createElement("div",{className:"avatar"},Ta.createElement(zr.Z,{className:"avatar_img",size:"sm"}));return[{key:"writing",component:Ta.createElement(Da.Z,{icon:["gfas","post-button"]}),title:"投稿管理",props:{plain:!0,className:"p_svgNavBtn"},...r},{key:"signin",component:Ta.createElement("div",{className:(0,Ma.Z)("gnav_avatarNotSignin")},l,Ta.createElement(Cr.Z,{in:n,classNames:"gnav_signinHint",timeout:500,unmountOnExit:!0},Ta.createElement("div",{className:"gnav_signinHint"},Ta.createElement("h3",null,"登录机核你可以："),Ta.createElement("div",{className:"gnav_signinHint_features"},[{key:"download",title:"下载收藏播客节目"},{key:"history",title:"多端历史播放同步"},{key:"topic",title:"发布内容动态/评论"},{key:"follow",title:"关注喜欢的创作者"}].map((e=>{let{key:t,title:a}=e;return Ta.createElement("div",{key:t},Ta.createElement(Da.Z,{icon:["gfas",`hint-feature-${t}`]}),a)}))),Ta.createElement(Ya.Z,{type:"info",block:!0,onClick:()=>{a(!0)}},"登录 / 注册")))),props:{div:!0},title:Ta.createElement(Ta.Fragment,null,l,Ta.createElement("div",{className:"gnav_drawer_user_name"},"登录以浏览更多功能")),...r},{key:"bookmarks",title:"收藏",...r},{key:"history",title:"历史",...r},{key:"notification",title:"消息",...r}]})(this.context.getPageLocation(),this.context.pathname,(e=>{this.context.toggleSigninModal(e,{tip:null})}),t);return r=[...e,...r],n?n(r):r};handleLinkClick=e=>{const{onLinkClick:t}=this.props;this.hideAllVisibleComponent(),t&&t(e)};handleNavBarStyleChange=()=>{this.hideAllVisibleComponent()};handleShowHistoryModalClick=()=>{this.setState({historyModalVisible:!0})};handleCloseHistoryModalClick=()=>{this.setState({historyModalVisible:!1})};handleHistoryBtnClick=()=>{this.setState({historyDrawerVisible:!0})};handleHistoryClose=()=>{this.setState({historyDrawerVisible:!1})};handleShowNotificationsModalClick=()=>{this.setState({notificationsModalVisible:!0})};handleCloseNotificationsModalClick=()=>{this.setState({notificationsModalVisible:!1})};handleNotificationsBtnClick=()=>{this.setState({notificationsDrawerVisible:!0})};handleNotificationsClose=()=>{this.setState({notificationsDrawerVisible:!1})};renderHistoryModalBtn=()=>{const{historyModalVisible:e}=this.state;return Ta.createElement(Ta.Fragment,null,Ta.createElement(_n.Z,{visible:e,hideActionBtns:!0,onCloseClick:this.handleCloseHistoryModalClick},Ta.createElement(gl,null)),"历史")};renderNotificationsModalBtn=()=>{const{notificationsModalVisible:e}=this.state,{notificationsUnseenCount:t}=this.props,a=Ta.createElement(_n.Z,{visible:e,hideActionBtns:!0,onCloseClick:this.handleCloseNotificationsModalClick},Ta.createElement(il,null));return Ta.createElement(Ta.Fragment,null,a,"消息",t>0&&`(${vl(t)})`)};renderNotificationCompBtn(){const{notificationsUnseenCount:e}=this.props;return e>0?Ta.createElement("span",{className:"gnav_notificationsCount"},vl(e)):"消息"}renderDrawer(){const{notificationsDrawerVisible:e}=this.state,{historyDrawerVisible:t}=this.state;return Ta.createElement(Ta.Fragment,null,Ta.createElement(wr,{visible:t,onRequestClose:this.handleHistoryClose},Ta.createElement(gl,null)),Ta.createElement(wr,{visible:e,onRequestClose:this.handleNotificationsClose},Ta.createElement(il,null)))}}fl.contextType=Ua.qe;const yl=(0,Ka.connect)((e=>{const t=e.getIn(["data","notificationsCenter","notificationFeedsUnseenCount"])+e.getIn(["data","notificationsCenter","interactionFeedsUnseenCount"])+e.getIn(["data","notificationsCenter","privateMailThreadsUnseenCount"]);return{currentUser:(0,sn.ib)(e),notificationsUnseenCount:t}}))(fl),bl=e=>{let{...t}=e;return Ta.createElement(yl,t)},kl=(e,t)=>e&&t&&new RegExp(`^${e.replace("/","\\/")}(\\/\\w+)*$`).test(t),Cl=(e,t,a)=>{let{component:n,pureComponent:r,shorthand:l,title:i,icon:s,unfoldMode:o,sub:c,append:d,hasNotification:m}=e,{isCustom:u=!1,unfold:p=!1,inSub:g=!1}=a;const{navCollapsed:h,layoutMode:v}=t;if(r){if(void 0===h||void 0===v)return null;const e="mobile"===v?"mobile":h?"collapsed":"normal";return r.forMode&&!r.forMode.includes(e)?null:r.render(t)}let E=null;return m?E=Ta.createElement("span",{className:"navLayout_item_append u_color-gcores"},Ta.createElement(Da.Z,{icon:["gfas","news-notify"]})):d?E=Ta.createElement("span",{className:"navLayout_item_append"},d instanceof Array?Ta.createElement(Da.Z,{icon:d}):d):c&&"list"===o&&(E=Ta.createElement("span",{className:(0,Ma.Z)("navLayout_item_append",{is_active:p})},Ta.createElement(Da.Z,{icon:["gfas","用户管理"===i?"fold-2":"fold"]}))),Ta.createElement("span",{className:(0,Ma.Z)("navLayout_item",{"navLayout_item-custom":n})},!(g&&h)&&(e=>{if(!e)return null;let t=null;if(e instanceof Array){let a="100%";e.includes("fusion-tour")||e.includes("collection")||e.includes("tag")||e.includes("gfest")?a="80%":e.includes("portfolio")||e.includes("follow")||e.includes("year-fav")||e.includes("album")||e.includes("discussion")?a="90%":e.includes("original-games")?a="106%":e.includes("spark")&&(a="120%"),t=Ta.createElement(Da.Z,{icon:e,style:{fontSize:a}})}else t=e;return Ta.createElement("span",{className:"navLayout_item_icon"},t)})(s),u&&n?Ta.createElement("div",{className:"navLayout_item_text"},n(p,t)):Ta.createElement("span",{className:"navLayout_item_text"},h&&l||i),E)},_l=e=>{const{to:t,className:a,layoutMode:n,navCollapsed:r,forceListMode:l,initialUnfold:i,hideInMobile:s,showInMobile:o,onRequestCloseMobileMenu:c}=e,{notificationFlag:d,...m}=e,{flag:u,save:p}=(0,yr.P5)(null==d?void 0:d.cookieKey,null==d?void 0:d.current),g=u?{hasNotification:!0,onClick:(t,a)=>{var n;null==e||null===(n=e.onClick)||void 0===n||n.call(e,t,a),p()}}:{},h={...m,...g},v=(0,Ua.EY)(),[E,f]=(0,Ta.useState)(!r&&"mobile"!==n&&i),y=(0,Ta.useRef)(null),b="mobile"===n&&E,k=()=>{y.current&&y.current.hidePopover(),null==c||c()};return(0,Ta.useEffect)((()=>{(r||"mobile"===n)&&f(!1)}),[r,n]),"mobile"===n&&s||"mobile"!==n&&o?null:Ta.createElement("div",{className:(0,Ma.Z)(a)},b&&!l&&Ta.createElement("div",{className:"navLayout_coverMask"}),((e,t,a)=>{let{afterClickedLink:n,context:r,unfold:l,navCollapsed:i,popoverRef:s,setUnfold:o,isMobileActive:c}=t;const{sub:d,unfoldMode:m,layoutMode:u,forceListMode:p}=e;if(!d)return a();const g=d?Ta.createElement("ul",{className:"navLayout_subList"},d.map((t=>{const{title:a,to:l,onClick:i,key:s,buttonProps:o}=t;return Ta.createElement("li",{key:s||a},Ta.createElement(Ya.Z,(0,Aa.Z)({plain:!0,anchor:!0,to:l,onClick:e=>{n(),null==i||i(e,!1)},className:(0,Ma.Z)({is_active:kl(l,r.pathname)})},o),Cl(t,e,{unfold:!1,inSub:!0})))}))):null;return"list"===m&&"normal"===u&&!i||p&&"mobile"===u?l?Ta.createElement(Ta.Fragment,null,a(),g):a():Ta.createElement(xa.Z,{ref:s,body:g,trigger:"mobile"===u?"click":["hover","click","active"],placement:"mobile"===u?"top":"right",className:"navLayout_popover",onVisibleChange:e=>{o(e)},onUpdate:e=>{var t;return c&&null!=e&&null!==(t=e.style)&&void 0!==t&&t.transform?{...e,style:{...e.style,transform:e.style.transform.replace(/\([^,]+px/,"(0px")}}:e}},a)})(h,{afterClickedLink:k,context:v,unfold:E,navCollapsed:r,popoverRef:y,setUnfold:f,isMobileActive:b},(e=>((e,t,a)=>{let{unfold:n,setUnfold:r,afterClickedLink:l}=t;const{component:i,forceComponent:s,buttonProps:o,to:c,sub:d,unfoldMode:m,onClick:u}=e;let p=null,g=null;const h=function(){return Cl(e,e,{isCustom:arguments.length>0&&void 0!==arguments[0]&&arguments[0],unfold:n})};return i&&(g=h(!0)),p=s&&g?g:i?Ta.createElement(Ta.Fragment,null,g,h()):h(),Ta.createElement(Ya.Z,(0,Aa.Z)({to:c,plain:!0},a,o,{onClick:e=>{var t;d?r((e=>!e)):c&&l(),null==u||u(e,!n),null==a||null===(t=a.onClick)||void 0===t||t.call(a,e)},className:(0,Ma.Z)("navLayout_itemButton",null==a?void 0:a.className,{"navLayout_itemButton-list":"list"===m})}),p)})(h,{unfold:E,setUnfold:f,afterClickedLink:k},{...e,className:(0,Ma.Z)({is_active:E||kl(t,v.pathname)},null==e?void 0:e.className)}))))};_l.defaultProps={unfoldMode:"popover",forceListMode:!1,forceComponent:!1,initialUnfold:!1};const wl=_l,Nl=e=>{let{...t}=e;const[a,n]=(0,Ta.useState)([]);if((0,Ta.useEffect)((()=>{const e=e=>{var t;n(null==e||null===(t=e.detail)||void 0===t?void 0:t.userItems)};return window.addEventListener("navbar:update",e),()=>window.removeEventListener("navbar:update",e)}),[]),!a||0===a.length)return null;const r={title:"用户管理",className:"navLayout_mobileUser",unfoldMode:"list",forceListMode:!0,forceComponent:!0};if(a.map((e=>e.key)).includes("signin")){const e=a.find((e=>"signin"===e.key));return r.component=()=>e.title,r.to=e.toSm,r.buttonProps={openNewWindow:!1},Ta.createElement(Ta.Fragment,null,Ta.createElement(wl,(0,Aa.Z)({},r,t)),Ta.createElement(wl,(0,Aa.Z)({title:"加入 GPASS 会员",to:"/gpass"},t)))}r.component=()=>{var e;return null===(e=a.find((e=>"user"===e.key)))||void 0===e?void 0:e.title};const l=[...a];return l.shift(),r.sub=l.map((e=>{let{key:t,title:a,to:n,toSm:r,onSmClick:l}=e;return{key:t,title:a,to:n||r,onClick:l,..."signout"===t?{buttonProps:{openNewWindow:!1}}:{}}})),Ta.createElement(wl,(0,Aa.Z)({},r,t))},Pl=e=>{let{mobileSideShown:t,layoutMode:a,isCollapsedLayout:n,fixedMenu:r,onRequestCloseMobileMenu:l,menu:i}=e;const s={layoutMode:a,navCollapsed:n,onRequestCloseMobileMenu:l},o=(e,t)=>"-"===e?Ta.createElement("div",{key:`${t}-`,className:"navLayout_sideDivider"}):Ta.createElement(wl,(0,Aa.Z)({key:e.key||e.title},e,s));return Ta.createElement("section",{className:(0,Ma.Z)("navLayout_side",{"navLayout_side-shown":t})},"mobile"!==a&&Ta.createElement(dn.Z,{to:"/",className:"navLayout_side_logo"},void 0!==n&&Ta.createElement(Da.Z,{icon:["gfas",n?"g":"gcores"],className:(0,Ma.Z)({navLayout_side_logo_g:n,navLayout_side_logo_gcores:!n})})),Ta.createElement("div",{className:"navLayout_side_main",tabIndex:0,onTouchStart:e=>{let{currentTarget:t}=e;null==t||t.focus()}},Ta.createElement("div",null,"mobile"===a&&Ta.createElement(Nl,s),i&&i.map(o))),r&&(null==r?void 0:r.length)>0&&Ta.createElement("div",{className:"navLayout_side_fixed"},r.map(o)))};var Sl=a(45841);const Zl={dispatchToggleNavLayoutCollapsed:l.GA2},Il=(0,Ka.connect)(void 0,Zl)((e=>{let{centerContent:t,navProps:a,mobileNavProps:n,children:r,menu:l,fixedMenu:i,onLayout:s,dispatchToggleNavLayoutCollapsed:o,onMobileRightIconClick:c,mobileRightIcon:d}=e;const{collapsed:m,isCollapsedLayout:u,mobileSideShown:p,layoutMode:g,setMobileSideShown:h}=(()=>{const e=(0,Ka.useSelector)((e=>!!e.getIn(["status","navLayoutCollapsed","nav"]))),[t,a]=(0,Ta.useState)(!1),[n,r]=(0,Ta.useState)(),l=n&&("normal"===n&&e||"restricted"===n),i=(0,Ta.useCallback)((e=>{r((a=>{const n="function"==typeof e?e(a):e;return t&&n!==a&&[n,a].includes("mobile")&&(0,an.a9)("mobile"!==n),n}))}),[t,r]),s=(0,Ta.useCallback)((e=>{a((t=>{const a="function"==typeof e?e(t):e;return"mobile"===n&&t!==a&&(0,an.a9)(!a),a}))}),[n,a]);return(0,Ta.useEffect)((()=>{const e=()=>{i((0,Sl.Ty)(".navLayout"))};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}}),[i]),{collapsed:e,isCollapsedLayout:l,layoutMode:n,mobileSideShown:t,setMobileSideShown:s}})(),v=(0,yr.II)(s),E=null==i?void 0:i.filter((e=>"-"===e||!(e.hideInMobile&&"mobile"===g))),f={key:"collapsedButton",title:Ta.createElement(Da.Z,{icon:["gfas","bars"]}),onClick:()=>{o({nav:!m})},props:{className:"me-3"}};return(0,Ta.useEffect)((()=>{window.document.body.classList.toggle("is_navSidebarCollapsed",u)}),[u]),(0,Ta.useEffect)((()=>{var e;null===(e=v.current)||void 0===e||e.call(v,{collapsed:m,isCollapsedLayout:u,mobileSideShown:p,layoutMode:g})}),[v,m,u,p,g]),Ta.createElement("div",{className:(0,Ma.Z)("navLayout",{"navLayout-collapsed":m,"navLayout-notCollapsed":!m,"navLayout-prepare":void 0===g})},Ta.createElement(Pl,{mobileSideShown:p,layoutMode:g,isCollapsedLayout:u,menu:l,fixedMenu:E,onRequestCloseMobileMenu:()=>h(!1)}),Ta.createElement("div",{className:"navLayout_main"},Ta.createElement(kr,(0,Aa.Z)({visible:p,toggleVisible:()=>{h((e=>!e))},onRightIconClick:c,rightIcon:d,rightDeepLinkTo:"app://gcores.Search"},n)),Ta.createElement(bl,(0,Aa.Z)({containerClassName:"navLayout_navContainer",className:"navLayout_nav",twoRow:!1,logo:Ta.createElement("div",null),logoCenter:!0,logoContent:g?t(g):null},a,{contentItems:e=>{const t=[...e];return"normal"===g&&t.unshift(f),null!=a&&a.contentItems?a.contentItems(t,{layoutMode:g}):t}})),"mobile"===g&&Ta.createElement("div",null),r))}));var Tl=a(92742),Al=a.n(Tl),Rl=a(29069);const{articleCategoryIds:Dl,audioCategoryIds:xl,videoCategoryIds:Ml}=tr.default;class Ll extends Ta.PureComponent{componentDidMount(){const{categoriesFetched:e,dispatch:t}=this.props;e||t((0,Rl.tG)())}render(){const{categoriesRequesting:e,articleCategories:t,audioCategories:a,videoCategories:n}=this.props;if(e)return null;const r=[{title:"播客",to:"/radios",categories:a},{title:"视频",to:"/videos",categories:n},{title:"综合",to:"/articles",categories:t,rows:!0}];return Ta.createElement("div",{className:"channelsFullscreen"},Ta.createElement("div",{className:"row"},r.map((e=>Ta.createElement("div",{className:"col-md-4",key:e.title},Ta.createElement("h2",{className:"channelsFullscreen_title"},Ta.createElement(dn.Z,{to:e.to},e.title)),e.categories&&Ta.createElement("div",{className:"row"},(e=>{const t=[];let a=[];return e.forEach(((n,r)=>{a.push(n),(r+1)%4==0?(t.push(a),a=[]):r===e.size-1&&t.push(a)})),t})(e.categories).map((t=>Ta.createElement("div",{className:e.rows?"col-6":"col-md-12 col-6",key:t[0].getKey()},(e=>e&&Ta.createElement("ul",{className:"channelsFullscreen_ul o_stylelessList"},e.map((e=>Ta.createElement("li",{key:e.getKey()},Ta.createElement(dn.Z,{to:(0,Ja.Z)("category",{id:e.get("id")})},e.getAttr("name")))))))(t))))))))))}}Ll.propTypes={articleCategories:Va().list.isRequired,audioCategories:Va().list.isRequired,videoCategories:Va().list.isRequired,categoriesFetched:Ga().bool,categoriesRequesting:Ga().bool,dispatch:Ga().func.isRequired},Ll.defaultProps={categoriesFetched:!1,categoriesRequesting:!1};const ql=e=>(0,sn.P1)(sn.LF,(t=>(0,ln.b$)(e,"categories",t))),Fl=ql(Dl),Bl=ql(Ml),Ol=ql(xl),Ul=(0,Ka.connect)(((e,t)=>({articleCategories:Fl(e,t),videoCategories:Bl(e,t),audioCategories:Ol(e,t),categoriesFetched:e.getIn(["network","getAllCategories","fetched"]),categoriesRequesting:e.getIn(["network","getAllCategories","isRequesting"])})))(Ll),$l=e=>{let{title:t,className:a,onClick:n}=e;const r=q()("searchHistory");if(!r)return null;const l=r.map((e=>Ta.createElement(Ya.Z,{key:e,className:"label",onClick:()=>{null==n||n(e)},plain:!0,anchor:!0},e)));return Ta.createElement("div",{className:(0,Ma.Z)(a)},t,l,Ta.createElement(Ya.Z,{type:"link",outline:!0,size:"sm",onClick:()=>{q().remove("searchHistory")}},"清除历史"))};class Gl extends Xa.Z{constructor(e){super(e),this.state={searchText:e.initQuery||"",inputFocus:!1},this.requestTimeout=void 0,this.inputRef=Ta.createRef(),this.handleSuggestTermClick=this.handleTermClick.bind(this,"suggestion"),this.handleHotTermClick=this.handleTermClick.bind(this,"hot")}componentDidMount(){const{hotSuggests:e,dispatch:t}=this.props,{searchText:a}=this.state;this.afterShow(!1,0===a.length),e||t((0,l.sMA)())}componentDidUpdate(e){this.afterShow(e.visible,!0),this.props.visible&&e.fullscreen&&!this.props.fullscreen&&(0,an.a9)(!0)}componentWillUnmount(){this.props.visible&&this.props.fullscreen&&(0,an.a9)(!0)}afterShow(e,t){const{visible:a}=this.props;!e&&a&&t&&this.inputRef.current.focus(),this.props.fullscreen&&(!e&&a?(0,an.a9)(!1):e&&!a&&(0,an.a9)(!0))}confirm=(e,t)=>{const{onConfirm:a,dispatch:n,randomKeyword:r,currentUserId:i}=this.props;if(!i)return(0,fe.lw)("LimitedButton","SearchConfirm"),void n((0,l.CcW)());const{searchText:s}=this.state,o=Al()("string"==typeof e?e:s||r);o.length>0&&(this.inputRef.current&&this.inputRef.current.blur(),this.setState({searchText:o}),a(o,t),(e=>{let t=q()("searchHistory")||[];t.includes(e)||(t.unshift(e),t=t.slice(0,20),q()("searchHistory",t))})(o))};handleCloseClick=()=>{this.props.onClose()};handleInputChange=e=>{const t=e.target.value;this.setState({searchText:t}),t.length>0&&(this.requestTimeout&&clearTimeout(this.requestTimeout),this.requestTimeout=setTimeout((()=>{this.props.dispatch((0,l.qa_)(t))}),800))};handleInputFocus=()=>{this.setState({inputFocus:!0})};handleInputBlur=()=>{setTimeout((()=>{this.setState({inputFocus:!1})}),300)};handleConfirmKeyUp=e=>{13===e.keyCode&&this.confirm()};handleTermClick=(e,t)=>{this.confirm(t.currentTarget.getAttribute("data-text"),e)};handleHistoryTermClick=e=>{this.confirm(e,"history")};renderSecTitle=e=>Ta.createElement("h3",{className:"h5 mb-3 u_color-gray-desc u_fontSize-sm"},e);renderHot=()=>{const{hotSuggests:e}=this.props;return e?Ta.createElement("div",{className:"mb-3"},this.renderSecTitle("热门搜索"),Ta.createElement("div",null,e.map((e=>Ta.createElement(Ya.Z,{key:e,className:"label",onClick:this.handleHotTermClick,"data-text":e,anchor:!0,plain:!0},e))))):null};renderSuggests(){const{searchText:e}=this.state,{suggests:t}=this.props;if(""===e)return Ta.createElement("div",null);let a;if(t&&t.size>0){const e=t.map((e=>Ta.createElement("li",{key:e,className:"py-2"},Ta.createElement(Ya.Z,{onClick:this.handleSuggestTermClick,"data-text":e,anchor:!0,plain:!0},e))));a=Ta.createElement("div",{className:"mb-3 gsearch_suggests"},this.renderSecTitle("搜索建议"),Ta.createElement("ul",{className:"o_stylelessList"},e))}return a}renderHistory(){return Ta.createElement($l,{title:this.renderSecTitle("搜索历史"),className:"mb-3",onClick:this.handleHistoryTermClick})}render(){const{searchText:e,inputFocus:t}=this.state,{fullscreen:a,visible:n,inSearchPage:r,randomKeyword:l}=this.props;return n?Ta.createElement("div",{className:(0,Ma.Z)(a?"fullscreen":"gsearch_container")},Ta.createElement("div",{className:(0,Ma.Z)("gsearch",{"gsearch-focus":t})},Ta.createElement("div",{className:"container"},Ta.createElement("div",{className:"gsearch_input"},Ta.createElement(Da.Z,{icon:["gfas","search"],className:"gsearch_icon"}),Ta.createElement("input",{type:"text",ref:this.inputRef,onChange:this.handleInputChange,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onKeyUp:this.handleConfirmKeyUp,value:e,placeholder:l||"请输入关键词"}),e.length>0&&Ta.createElement(Ya.Z,{onClick:this.confirm,plain:!0,anchor:!0},"搜索"),Ta.createElement(Ya.Z,{className:"u_fontSize-lg",onClick:this.handleCloseClick,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","times"]}))),Ta.createElement("div",{className:"gsearch_body"},Ta.createElement(Ta.Fragment,null,t&&Ta.createElement(Ta.Fragment,null,this.renderSuggests(),this.renderHistory(),this.renderHot()),!r&&Ta.createElement(Ul,null)))))):null}}Gl.propTypes={randomKeyword:Ga().string,visible:Ga().bool,suggests:Va().list,initQuery:Ga().string,fullscreen:Ga().bool,inSearchPage:Ga().bool,onConfirm:Ga().func.isRequired,onClose:Ga().func.isRequired},Gl.defaultProps={visible:!1,suggests:void 0,fullscreen:!1,initQuery:"",inSearchPage:!1,randomKeyword:void 0};const zl=(0,Ka.connect)((e=>{const t=e.getIn(["data","search","suggests"]),a=e.getIn(["data","search","hot","common","list"]),n=(0,sn.yK)(e);return{suggests:t,hotSuggests:a,randomKeyword:e.getIn(["data","search","hot","common","random"]),currentUserId:n}}))(Gl);var Hl=a(84059);const Vl=(e,t)=>t?e.map((e=>"string"==typeof e?e:e.key&&t[e.key]?{...e,...t[e.key]}:e)):e;let Wl;const jl={fixed:e=>{let{currentUser:t}=e;return[{key:"app_qr",to:"/app",title:"",pureComponent:{render:e=>{let{navCollapsed:a}=e;return!1!==a?null:Ta.createElement("div",{className:(0,Ma.Z)("navLayout_itemApp",{"navLayout_itemApp-signedIn":t})},Ta.createElement("div",{className:"navLayout_itemApp_qr"},Ta.createElement(Hl.Qd,{value:"https://www.gcores.com/app",bgColor:"#fff",size:200})),Ta.createElement("div",{className:"navLayout_itemApp_text"},Ta.createElement("h3",null,Ta.createElement("strong",null,"扫描二维码"),Ta.createElement("strong",null,"下载 机核App")),Ta.createElement("p",null,"来吧！探索热爱")))}},hideInMobile:!0},{key:"app",icon:["gfas","app"],title:"下载机核 APP",shorthand:"APP下载",to:"/app",hideInMobile:!0}]},menu:e=>[{key:"homepage",icon:["gfas","feed"],title:"首页",to:"/"},{key:"follow",icon:["gfas","follow"],title:"关注",to:"/feeds",showInMobile:!0},{key:"topic",icon:["gfas","topic"],title:"机组",to:"/topics/home"},{key:"discussion",icon:["gfas","discussion"],title:"讨论",to:"/discussions"},{key:"news",icon:["gfas","news"],title:"资讯",to:"/news"},{key:"radio",icon:["gfas","radio"],title:"播客",to:"/radios"},{key:"article",icon:["gfas","article"],title:"文章",to:"/articles"},{key:"video",icon:["gfas","video"],title:"视频",to:"/videos"},"-",{key:"audio-book",icon:["gfas","audio-book"],title:"有声书",to:"/audio_books"},{key:"shop",icon:["gfas","shop"],title:"商店",sub:[{to:"https://shop124260606.taobao.com/",title:"吉考斯工业"},{to:"https://shop463835368.taobao.com/index.htm",title:"核市奇谭"}]},"-",{key:"original-games",icon:["gfas","original-games"],title:"游戏库",to:"/booom/game_lib/browse"},{key:"album",icon:["gfas","album"],title:"播单",to:"/albums"},{key:"collection",icon:["gfas","collection"],title:"专题",to:"/collections"}]},Kl=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=(0,yr.II)(a),[r,l]=(0,Ta.useState)(Vl(jl[e](n.current)??[],t)),i=t?JSON.stringify(t):"{}";return(0,Ta.useEffect)((()=>{l(Vl(jl[e](n.current)??[],JSON.parse(i)))}),[n,e,i]),(0,Ta.useEffect)((()=>{(async()=>{const t=(await(async()=>{if(void 0!==Wl)return Wl;const e=await fetch("https://alioss.gcores.com/static_config/g-spa-nav-menu-config.json?v=4").then((e=>e.json())).catch((e=>null));return Wl=e,Wl})()||{})[e];t&&(t.modify&&l((e=>Vl(e,t.modify))),t.append&&l((e=>[...e,...t.append])))})().then()}),[e]),r},Jl="/feeds",Yl=[{title:"关注",to:Jl},{title:"最新",to:"/"},{title:"游戏",to:"/booom"}],Xl=e=>e.startsWith("/booom")?2:Yl.map((e=>e.to)).indexOf(e),Ql=()=>{const{pathname:e}=(0,Ua.EY)();return Xl(e)>-1},ei=(0,Ka.connect)((e=>({updatesFeedCount:e.getIn(["data","notificationsCenter","updatesFeedUnseenCount"])})))((e=>{let{updatesFeedCount:t}=e;const{pathname:a}=(0,Ua.EY)();return Ql()?Ta.createElement("div",{className:(0,Ma.Z)("navTabs",{[`navTabs-${Xl(a)}`]:a})},Ta.createElement("div",null,Yl.map((e=>{let{to:n,title:r}=e;return Ta.createElement(Ya.Z,{key:r,to:n,plain:!0,className:(0,Ma.Z)("navTab",{is_active:n===a,is_new:n===Jl&&t>0})},Ta.createElement("span",null,r))})))):null})),ti=(0,Ka.connect)((e=>({randomKeyword:e.getIn(["data","search","hot","common","random"])})))((e=>{let{randomKeyword:t,small:a}=e;return Ta.createElement("div",{className:(0,Ma.Z)("input-group input-group-sm navLayout_search",{"navLayout_search-sm":a})},Ta.createElement("div",{className:"input-group-text"},Ta.createElement(Da.Z,{icon:["gfas","search"]})),Ta.createElement("input",{type:"text",className:"form-control",placeholder:t||"搜索"}))})),ai={dispatchToggleNavLayoutCollapsed:l.GA2,dispatchSigninTip:l.CcW},ni=(0,Ka.connect)(((e,t)=>({currentUser:(0,sn.ib)(e),navLabelsCollapsed:e.getIn(["status","navLayoutCollapsed","labels"]),updatesFeedCount:e.getIn(["data","notificationsCenter","updatesFeedUnseenCount"])})),ai)((e=>{let{currentUser:t,updatesFeedCount:a,navProps:n,mobileNavProps:r,navLabelsCollapsed:l,dispatchToggleNavLayoutCollapsed:i,dispatchSigninTip:s,...o}=e;const c={currentUser:t},d=Kl("fixed",{},c),m=Kl("menu",{follow:{hasNotification:a>0}},c),[u,p]=(0,Ta.useState)(!1),g=Ql();return Ta.createElement(Ta.Fragment,null,Ta.createElement(zl,{fullscreen:!0,visible:u,onClose:()=>{p(!1)},onConfirm:(e,t)=>{Qa.ZP.push((0,Ir.ZP)("search",{keyword:e,from:t}))}}),Ta.createElement(Il,(0,Aa.Z)({},o,{centerContent:()=>g?Ta.createElement(ei,null):null,onMobileRightIconClick:()=>{Qa.ZP.push((0,Ir.ZP)("search"))},mobileRightIcon:["gfas","search"],navProps:{...n,userItems:e=>{const a=[{key:"gpass",component:Ta.createElement(Da.Z,{icon:["gfas","gpass-button"]}),title:"GPASS",to:null!=t&&t.getAttr("has-membership")?(0,Ir.ZP)("gpassPanel"):(0,Ir.ZP)("gpass"),props:{plain:!0,className:"p_svgNavBtn"}}];return t&&a.push((0,fr.t)({currentUser:t})),[...a,...e]},contentItems:(e,a)=>{let{layoutMode:n}=a;return[...e,{key:"search",title:"搜索",component:Ta.createElement(ti,{small:"normal"!==n}),onClick:()=>{if(!t)return(0,fe.lw)("LimitedButton","NavSearchInput"),void s();p(!0)}}]},onLinkClick:()=>{p(!1)}},mobileNavProps:r,fixedMenu:d,menu:m})))})),ri=Ta.memo((e=>{let{store:t,children:a,context:{hideNav:n,hideFooter:r,hideGlobalActions:i,navTransparent:s,navProps:o={},mobileNavProps:c={}}}=e;const d=(0,Ta.useRef)(),m=(0,Ta.useMemo)((()=>({seekToTimeline:(e,a)=>{t.dispatch((0,l.lMO)(e)).then((()=>{var e;null===(e=d.current)||void 0===e||e.seekTo(a)}))},getCurrentStatus:()=>{var e;return(null===(e=d.current)||void 0===e?void 0:e.getCurrentStatus())??null}})),[t]),u=Ta.createElement(Ta.Fragment,null,a,!r&&Ta.createElement(Ba,null));return Ta.createElement(Ua.ET.Provider,{value:m},Ta.createElement(Oa.Z,null),n?u:Ta.createElement(ni,{navProps:{transparent:s,...o},mobileNavProps:c},u),Ta.createElement("div",{style:{display:i?"none":"block"}},Ta.createElement(Er,null),Ta.createElement(Yn,{ref:d})))})),li=ri;var ii=a(24016),si=a(24757),oi=a(71391),ci=a(23813),di=a(29622),mi=a(63075);const ui=e=>{let{subscribable:t,...a}=e;const n=t.getMeta("subscription-id");return Ta.createElement(mi.Z,(0,Aa.Z)({subscribable:t,type:"dark",circle:!0,outline:!n},a))};ui.propTypes={subscribable:Va().record.isRequired};const pi=ui,gi=e=>{let{className:t,collection:a,withSubscription:n,whiteboard:r}=e;const l=(0,Ja.Z)("collection",{id:a.get("id")});return Ta.createElement(dn.Z,{className:(0,Ma.Z)("collection am_card",{"collection-subscription":n},t),style:{backgroundImage:`url(${(0,tn.cR)(a.getAttr("cover"),{resize:{w:262,m:"lfit"}})})`},to:l,div:!r},!r&&Ta.createElement(dn.Z,{to:l,className:"collection_body"},Ta.createElement("div",{className:"collection_text"},Ta.createElement("h3",null,a.getAttr("title")),Ta.createElement("p",{className:"mb-0"},Ta.createElement("span",{className:"me-1"},(0,tn.Zx)(a.getAttr("subscriptions-count"))),"人订阅"))),Ta.createElement("div",{className:"collection_action"},n?Ta.createElement(pi,{subscribable:a,type:"light"}):!r&&Ta.createElement(Ya.Z,{type:"opacity",ellipse:!0,className:"collection_btn",to:l},"进入专题")))};gi.propTypes={collection:Va().record.isRequired,withSubscription:Ga().bool,whiteboard:Ga().bool,className:Ga().string},gi.defaultProps={withSubscription:!1,className:void 0,whiteboard:!0};const hi=gi;var vi=a(4250);const Ei=e=>{let{collections:t}=e;return Ta.createElement(vi.Z,r.ON,t.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(hi,{className:"mb-0",collection:e})))))};var fi=a(5305),yi=a(6379);const bi=function(e){let{directToAlbum:t=!0,shouldShowTip:a=(0,fi.v)(e)&&0===e.getAttr("radios-count")}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,sn.xJ)(),{sendPopMessage:r}=(0,Ua.EY)(),l=(null==n?void 0:n.getAttr("has-membership"))??!1,{subscribed:i,subscribe:s}=(0,yi.Q3)(e);return()=>{if(!e)return;(0,fi.v)(e)&&e.getAttr("is-require-privilege")&&a?r(l?{title:"节目尚未发布",body:`节目尚未发布，${i?"已提前订阅该播单":"你可提前订阅该播单"}，发布时将收到更新通知与提醒`,modalProps:{confirmBtnText:i?"取消订阅":"订阅播单",onConfirmClick:async()=>await s()}}:{title:"节目尚未发布",body:"节目尚未发布，你可先行开通 GPASS 会员服务并提前订阅该播单，待发布时将收到更新通知与提醒",modalProps:{confirmBtnText:"开通会员",confirmBtnProps:{to:(0,Ir.ZP)("gpass"),type:"gpass"}}}):t&&Qa.ZP.push((0,Ir.ZP)(e))}},ki=a.p+"2c0e8959fbad285e1da8.png",Ci=e=>{let{label:t}=e;if(!t)return null;if("gcores"===t)return Ta.createElement("img",{src:ki,className:"albumGolden_logo"});const a=tr.gR[t];return a?Ta.createElement("span",{className:`albumGolden_${t}`},"SPEC"===a?a.toLowerCase():a):null},_i=e=>{let{children:t,className:a,label:n,thin:r=!1,golden:l=!1}=e;return Ta.createElement("div",{className:(0,Ma.Z)("albumGolden",{"albumGolden-thinBorder":r,"albumGolden-hideGolden":!l},a)},t,Ta.createElement(Ci,{label:n}))},wi=e=>{let{album:t,...a}=e;return Ta.createElement(_i,(0,Aa.Z)({},(e=>{if("albums"!==e.get("type"))return{golden:!0};{const t=e.getSaleType();if("audiobook"===t)return{golden:!0};if(t)return{label:t}}return{}})(t),a))},Ni=e=>{let{title:t,path:a,onClick:n,children:r,className:l}=e;return Ta.createElement(Ya.Z,{plain:!0,to:a,onClick:n,className:(0,Ma.Z)("coverShowcase",l)},r,Ta.createElement("h3",null,t))},Pi=e=>{let{album:t,className:a}=e;const n=(0,tn.cR)(t.getAttr("cover"),{resize:{w:180,h:180}}),r=bi(t);return Ta.createElement(Ni,{onClick:r,title:t.getAttr("title"),className:a},Ta.createElement(wi,{album:t},Ta.createElement("div",{className:"coverShowcase_img",style:{backgroundImage:`url(${n})`}})))},Si=e=>{let{item:t,...a}=e;return"albums"===t.get("type")||"album-bundles"===t.get("type")?Ta.createElement(Pi,(0,Aa.Z)({album:t},a)):"banners"===t.get("type")?Ta.createElement(Ni,(0,Aa.Z)({path:t.getHref(),title:t.getAttr("title")},a),Ta.createElement("img",{src:(0,tn.cR)(t.getAttr("image"),{resize:{w:180,h:180}})})):"products"===t.get("type")?Ta.createElement(Ni,(0,Aa.Z)({path:(0,Ir.ZP)("product",{id:t.get("id")}),title:t.getAttr("title")},a),Ta.createElement("img",{src:(0,tn.cR)(t.getAttr("cover"),{resize:{w:180,h:180},bright:tn.jh})})):null},Zi=e=>{let{albums:t}=e;return Ta.createElement(vi.Z,{slidesToShow:6,slidesToShowResponsive:[5,4,3,2]},t.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(Si,{item:e,className:"mb-0"})))))};var Ii=a(20227);const Ti=Ta.memo((e=>{let{videos:t,currentPlayID:a,onPlayVideo:n}=e;const l=e=>(0,Ja.D)(e.get("type"),e.get("id")),i=t.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement("div",{className:(0,Ma.Z)("originalVideo",{is_active:a===e.get("id")})},Ta.createElement(Ya.Z,{className:"originalVideo_img o_backgroundCover",style:{backgroundImage:`url(${(0,tn.cR)(e.getAttr("thumb"),{resize:{w:230,m:"lfit"}})})`},"data-id":e.get("id"),onClick:()=>{null==n||n(e.get("id"))},plain:!0,anchor:!0},Ta.createElement("div",{className:"originalVideo_img_content"},Ta.createElement("span",null,(0,rn.dB)(e.getAttr("duration"))),Ta.createElement("img",{className:"originalVideo_img_play",src:Ii,alt:"play"}))),Ta.createElement("div",{className:"originalVideo_text"},Ta.createElement("p",null,e.getRel("category")?Ta.createElement(dn.Z,{to:(0,Ja.Z)("category",{id:e.getRel("category","id")||"not_found"})},e.getRelAttr("category","name")):"未知频道"),Ta.createElement("h2",null,Ta.createElement(dn.Z,{to:l(e)},e.getAttr("title"))))))));return Ta.createElement(vi.Z,r.ON,i)})),Ai=Ti,Ri=e=>Ta.createElement("div",{className:"row",key:"articles"},e.map((e=>Ta.createElement("div",{className:tn.d9,key:e.getKey()},Ta.createElement(si.Z,{original:e,small:!0})))));class Di extends Xa.Z{renderPagingOriginals(){const{type:e,page:t,pageState:a,originals:n}=this.props;return Ta.createElement(Ta.Fragment,null,Ta.createElement(ci.Z,{title:"originals"===e?"综合":(0,tn.cn)(e)},Ta.createElement(oi.Z,{data:n,isRequesting:a.get("isRequesting"),fetched:a.get("fetched"),gcPageProps:{current:t,linkBuilder:t=>(0,Ir.ZP)("originals"===e?"latest":e,{page:t})}},Ri)))}render(){const{type:e,collections:t,albums:a,videos:n}=this.props;let r,l,i;return"articles"===e?(r=Ta.createElement(Ei,{collections:t}),l="专题推荐",i=(0,Ir.ZP)("collections")):"radios"===e?(r=Ta.createElement(Zi,{albums:a}),l="播单推荐",i=(0,Ir.ZP)("albums")):"videos"===e&&(r=Ta.createElement(Ai,{videos:n,onPlayVideo:e=>{Qa.ZP.push((0,Ir.ZP)("video",{id:e}))}}),l="推荐"),r&&(r=Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:l,moreTo:i},r))),Ta.createElement(Ta.Fragment,null,Ta.createElement(di.Z,null,this.renderPagingOriginals()),r)}}Di.propTypes={type:Ga().string.isRequired,page:Ga().number,pageState:Va().map.isRequired,originals:Va().list.isRequired},Di.defaultProps={page:1};const xi=(0,sn.P1)((e=>e.getIn(["data","originalTypePage","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Mi=(0,sn.P1)((e=>e.getIn(["data","homepage","collections","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"collections",t))),Li=(0,sn.P1)((e=>e.getIn(["data","homepage","albums","freeAlbums","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"albums",t))),qi=(0,sn.P1)((e=>e.getIn(["data","homepage","videos","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"videos",t))),Fi=(0,Ka.connect)(((e,t)=>{const a=xi(e);return{type:t.type,originals:a,pageState:e.getIn(["data","originalTypePage"]),collections:Mi(e),albums:Li(e),videos:qi(e)}}))(Di),Bi=e=>Ta.createElement("div",{className:(0,Ma.Z)(r.ot,"o_equalHeightRow"),key:"articles"},e.map((e=>(e=>{const t="collections"===e.get("type");return Ta.createElement("div",{className:"col",key:e.getKey()},t?Ta.createElement(hi,{collection:e}):Ta.createElement(Pi,{album:e}))})(e)))),Oi=e=>({collections:"专题",albums:"播单",audioBooks:"有声书",privilegeAlbums:"GPASS 会员"}[e]);class Ui extends Xa.Z{renderPagingList(){const{type:e,page:t,pageState:a,list:n}=this.props;return Ta.createElement(ci.Z,{title:Oi(e)},Ta.createElement(oi.Z,{data:n,page:t,isRequesting:a.get("isRequesting"),fetched:a.get("fetched"),allPage:a.get("allPage"),linkBuilder:t=>(0,Ir.ZP)(e,{page:t})},Bi))}renderBundles(){const{type:e,bundles:t}=this.props;return"audioBooks"===e&&(null==t?void 0:t.size)>0?Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"有声书套装"},Ta.createElement("div",{className:"row"},t.map((e=>Ta.createElement("div",{className:"col-xl-2 col-lg-3 col-md-4 col-6",key:e.getKey()},Ta.createElement(Pi,{album:e}))))))):null}render(){return Ta.createElement(Ta.Fragment,null,this.renderBundles(),Ta.createElement(di.Z,null,this.renderPagingList()))}}Ui.propTypes={type:Ga().string.isRequired,page:Ga().number,pageState:Va().map.isRequired,list:Va().list.isRequired,bundles:Va().list.isRequired},Ui.defaultProps={page:1};const $i=(0,sn.P1)((e=>e.getIn(["data","collectionTypePage","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Gi=(0,sn.P1)((e=>e.getIn(["data","homepage","albums","bundles","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),zi=(0,Ka.connect)(((e,t)=>{const a=$i(e),n=Gi(e);return{type:t.type,list:a,bundles:n,pageState:e.getIn(["data","collectionTypePage"])}}))(Ui);async function Hi(e,t){let{store:a,query:n,isBrowserFirstLoad:r}=t;const i=n.page?Number(n.page):1;r||await a.dispatch((0,l.rbB)(e,i));const s=Ta.createElement(Fi,{type:e,page:i});return{preloadState:!0,title:tn.RL[e],component:s}}async function Vi(e,t,a){const n=a.page?Number(a.page):1;"collections"===e?await t.dispatch((0,l.c3J)(n)):"albums"===e?await t.dispatch((0,l.L7r)(n,"album",{sorts:["-updated-at"]})):"audioBooks"===e?(await t.dispatch((0,l.L7r)(n,"audiobook")),await t.dispatch((0,l.FPD)())):"privilegeAlbums"===e&&await t.dispatch((0,l.L7r)(n,"privilege_album"));const r=Ta.createElement(zi,{type:e,page:n});return{context:{appProps:{className:"is_inWiderPage"}},title:tn.RL[e],component:r}}var Wi=a(1216);const ji=e=>{const{data:t}=e;return Ta.createElement(dn.Z,{className:"news",to:(0,Ja.D)(t.get("type"),t.get("id"))},Ta.createElement("div",{style:{backgroundImage:`url(${(0,tn.cR)(t.getAttr("thumb"),{resize:{w:204,m:"lfit"}})})`},className:"news_imgArea"},Ta.createElement("div",{className:"news_imgArea_cover"})),Ta.createElement("div",{className:"news_content"},Ta.createElement("h3",null,t.getAttr("title"))),Ta.createElement("div",{className:"news_meta"},Ta.createElement("span",{className:"me-3",suppressHydrationWarning:!0},(0,rn.Sy)(t.getAttr("published-at"))),Ta.createElement("span",null,(0,tn.Zx)(t.getAttr("likes-count"))," 喜欢"),Ta.createElement("span",null,Ta.createElement("b",null,"•"),(0,tn.Zx)(t.getAttr("comments-count"))," 评论")))};ji.propTypes={data:Va().record.isRequired};const Ki=ji,Ji=e=>{let{data:t}=e;return t.size>0?Ta.createElement("div",{className:"ah_newsBanner ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"资讯",moreTo:(0,Ja.Z)("newsList")},Ta.createElement("div",null,Ta.createElement(vi.Z,r.ON,t.map((e=>Ta.createElement("div",{key:e.getKey(),className:"slick-item"},Ta.createElement(Ki,{data:e}))))))))):null},Yi=[{breakpoint:1200,settings:2},{breakpoint:700,settings:1}],Xi=e=>{let{banner:t}=e;const a=(0,tn.cR)(t.getAttr("thumb"),{resize:{w:478,h:268}});return Ta.createElement("div",{className:"slick-item"},Ta.createElement(dn.Z,{to:(0,Ir.ZP)(t),className:"homePage_banner"},Ta.createElement("img",{src:a})))},Qi=e=>{let{banner:t}=e;const a=t.getHref(),n=(0,tn.cR)(t.getAttr("image"),{resize:{w:478,h:268}});return Ta.createElement("div",{className:"slick-item"},Ta.createElement(dn.Z,{to:a,className:"homePage_banner"},Ta.createElement("img",{src:n})))},es=e=>{let{banner:t}=e;return"banners"===t.get("type")?Ta.createElement(Qi,{banner:t}):Ta.createElement(Xi,{banner:t})},ts=e=>{let{banners:t}=e;return Ta.createElement("div",{className:"homePage_banners homePage_bannersSkeleton"},t.map((e=>Ta.createElement(es,{banner:e,key:e.getKey()}))))},as=e=>{let{banners:t,fixedBanner:a}=e;const n=a?t.pop().push(a):t;return Ta.createElement(vi.Z,{slidesToShow:3,slidesToShowResponsive:Yi,className:"homePage_banners",skeleton:Ta.createElement(ts,{banners:n})},n.map((e=>Ta.createElement(es,{banner:e,key:e.getKey()}))))},ns=e=>{let{album:t}=e;return Ta.createElement(wi,{album:t,className:"albumCover",thin:!0},Ta.createElement("img",{alt:t.getAttr("title"),src:(0,tn.cR)(t.getAttr("cover"),{resize:{w:180,h:180}})}))},rs=e=>{let{to:t,tip:a="推荐专题",title:n,buttonText:r="进入专题",whiteboard:l,moreText:i,children:s,moreTo:o,small:c}=e;const d=(0,Ma.Z)("collectionEntry_inner",{"collectionEntry_inner-withBody":s,"collectionEntry_inner-whiteboard":l});return l?Ta.createElement("div",{className:d},Ta.createElement("div",{className:"collectionEntry_label"},a)):Ta.createElement("div",{className:d},Ta.createElement("div",{className:(0,Ma.Z)("collectionEntry_header","d-flex","align-self-stretch",{"justify-content-between":o})},Ta.createElement("div",null,Ta.createElement("div",{className:"mb-2"},a),Ta.createElement("h3",{className:"m-0"},n)),o&&Ta.createElement("div",{className:"ms-3"},Ta.createElement(Ya.Z,{className:"collectionEntry_more",to:o,size:"sm",type:"link",ellipse:!0},i||Ta.createElement(Da.Z,{icon:["gfas","angle-right"]})))),s&&Ta.createElement("div",{className:"collectionEntry_body"},s),Ta.createElement(Ya.Z,{to:o?t:void 0,type:"opacity",size:c?"sm":"lg",className:"collectionEntry_btn",ellipse:!0},r))},ls=e=>{const{moreTo:t,whiteboard:a=!1,background:n,albumStyle:r=!1,to:l,small:i=!1,fixedRatio:s=!1}=e,o={className:(0,Ma.Z)("collectionEntry",{"collectionEntry-small":i,"collectionEntry-fixedRatio":s}),style:r?void 0:{backgroundImage:`url(${n})`}};return Ta.createElement(dn.Z,(0,Aa.Z)({to:l,div:!a&&!!t},o),r&&Ta.createElement("div",{className:"collectionEntry-albumStyle_bg",style:{backgroundImage:`url(${n})`}}),Ta.createElement(rs,e))},is=e=>{let{album:t,...a}=e;return Ta.createElement(ls,(0,Aa.Z)({albumStyle:!0,tip:"推荐播单",buttonText:"进入播单"},a,{title:t.getAttr("title"),background:(0,tn.cR)(t.getAttr("cover"),tn.iT.Blur),to:(0,Ja.Z)("album",{id:t.get("id")})}),Ta.createElement("div",{className:"collectionEntry_albumCover"},Ta.createElement(ns,{album:t})))},ss=e=>{let{collection:t,...a}=e;return Ta.createElement(ls,(0,Aa.Z)({whiteboard:!0},a,{title:t.getAttr("title"),background:(0,tn.cR)(t.getAttr("cover"),{resize:{w:360,h:420}}),to:(0,Ja.Z)("collection",{id:t.get("id")})}))};ss.propTypes={collection:Va().record.isRequired};const os=ss;var cs=a(11465);const ds=[{breakpoint:1400,settings:4},{breakpoint:1e3,settings:3},{breakpoint:800,settings:2},{breakpoint:500,settings:1}],ms=e=>{let{original:t}=e;return Ta.createElement(si.Z,{original:t,focus:!0,className:"mb-0"})},us=e=>{let{originals:t,banner:a}=e;const n=a?t.slice(0,w.default.editorShowcasesPageLimit-1):t;return Ta.createElement("div",{className:"homePage_focusSkeleton"},n.map((e=>Ta.createElement(ms,{original:e,key:e.getKey()}))),a&&Ta.createElement(ps,{banner:a}))},ps=e=>{let{banner:t}=e;const a=t.getRel("target"),n=t.getAttr("image");if("collections"===(null==a?void 0:a.get("type")))return Ta.createElement(os,{collection:a,moreTo:(0,Ir.ZP)("collections"),small:!0});if("albums"===(null==a?void 0:a.get("type")))return Ta.createElement(is,{album:a,small:!0});if(n){const e=a?(0,Ir.ZP)(a):t.getAttr("link");return e?Ta.createElement(dn.Z,{to:e,className:"p_homeAltFixedBanner",style:{backgroundImage:`url(${(0,tn.cR)(n,{resize:{w:500,m:"lfit"}})})`}}):Ta.createElement(cs.Z,null)}return Ta.createElement(cs.Z,null)},gs=e=>{let{originals:t,banner:a,altBanner:n}=e;const r=n||a,l=r?t.slice(0,w.default.editorShowcasesPageLimit-1):t;return(0,yr.tr)(".p_homeFocusSlider .collectionEntry",".p_homeFocusSlider .original"),(0,yr.tr)(".p_homeFocusSlider .albumEntry",".p_homeFocusSlider .original"),(0,yr.tr)(".p_homeFocusSlider .p_homeAltFixedBanner",".p_homeFocusSlider .original"),Ta.createElement("div",{className:"p_homeFocusSliderContainer"},Ta.createElement(vi.Z,{slidesToShow:5,slidesToShowResponsive:ds,skeleton:Ta.createElement(us,{originals:t,banner:r}),className:"p_homeFocusSlider"},l.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(ms,{original:e})))),r&&Ta.createElement("div",{className:"slick-item"},Ta.createElement(ps,{banner:r}))))},hs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["ids"];return(a,n)=>a.getIn(["data","firstScreen",n.tagID,"banners",e,...t])},vs=(0,sn.P1)(hs("main"),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Es=(0,sn.P1)(hs("sub"),hs("sub",["random"]),sn.LF,((e,t,a)=>(0,ln.BY)(e,a).get(t))),fs=(0,sn.P1)(((e,t)=>e.getIn(["data","firstScreen",t.tagID,"editorShowcases","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),ys=e=>(0,sn.P1)((t=>t.getIn(["data","firstScreen","all",e,"ids"])),sn.LF,((e,t)=>{var a;return null===(a=(0,ln.BY)(e,t))||void 0===a?void 0:a.first()})),bs=ys("fixedBanners"),ks=ys("fixedAltBanners"),Cs=(0,Ka.connect)(((e,t)=>{const a=vs(e,t),n=bs(e),r=ks(e);return{focusImages:a,subFocusOriginals:fs(e,t),collectionEntry:Es(e,t),fixedBanner:n,fixedAltBanner:r}}))((e=>{const{fixedBanner:t,fixedAltBanner:a,focusImages:n,collectionEntry:r,subFocusOriginals:l,className:i,withBottomBorder:s=!0,inHomepage:o=!1}=e;return Ta.createElement("div",{className:(0,Ma.Z)("ah_block",i,{"ah_block-firstScreen":!o})},Ta.createElement("div",{className:"container"},Ta.createElement("div",{className:(0,Ma.Z)("ah_block-firstScreen_inner",{"u_borderNone pb-0":!s})},n&&n.size>0&&Ta.createElement(as,{banners:n,fixedBanner:t}),l&&l.size>0&&Ta.createElement(ci.Z,{title:"精选"},Ta.createElement(gs,{originals:l,banner:r,altBanner:a})))))})),_s=e=>Ta.createElement(Zi,{albums:e}),ws=(0,sn.P1)((e=>e.getIn(["data","homepage","albums","freeAlbums","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"albums",t))),Ns=(0,sn.P1)((e=>e.getIn(["data","homepage","albums","paidAlbums","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"albums",t))),Ps=e=>(0,sn.P1)((t=>t.getIn(["data","gpass",e,"ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Ss=Ps("privilegeBanners"),Zs=Ps("albums"),Is=(0,sn.P1)(Ss,Zs,((e,t)=>t.concat(e))),Ts=(0,sn.P1)((e=>e.getIn(["data","homepage","albums","bundles","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"albums",t))),As=ws,Rs=(0,sn.P1)(Ns,Ts,((e,t)=>e.concat(t).sort(((e,t)=>{const a=e=>new Date(e.getAttr("published-at")||e.getAttr("created-at")),n=a(e);return a(t).getTime()-n.getTime()})).slice(0,9))),Ds=(e,t)=>e.getIn(["data","homepage","albums","albums","freeAlbums",t])||e.getIn(["data","homepage","albums","paidAlbums",t])||e.getIn(["data","homepage","albums","bundles",t])||e.getIn(["data","gpass","albums",t]),xs={dispatchGetAlbumDataInHomepage:l.IAW},Ms=(0,Ka.connect)((e=>{const t=As(e),a=Rs(e),n=Is(e);return{isRequesting:Ds(e,"isRequesting"),isFetched:Ds(e,"fetched"),freeProducts:t,paidProducts:a,privilegeAlbums:n}}),xs)((e=>{let{needInitialRequest:t=!0,isRequesting:a,isFetched:n,freeProducts:r,paidProducts:l,privilegeAlbums:i,dispatchGetAlbumDataInHomepage:s}=e;return(0,Ta.useEffect)((()=>{t&&s()}),[]),Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"GPASS 会员",moreTo:(0,Ja.Z)("privilegeAlbums")},Ta.createElement(Rr.Z,{fetched:n,loading:a,data:i,height:"260px"},_s)))),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"播单推荐",moreTo:(0,Ja.Z)("albums")},Ta.createElement(Rr.Z,{fetched:n,loading:a,data:r,height:"260px"},_s)))),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"有声书推荐",moreTo:(0,Ja.Z)("audioBooks")},Ta.createElement(Rr.Z,{fetched:n,loading:a,data:l,height:"260px"},_s)))))}));var Ls=a(49766);const qs=e=>{let{bg:t,bgTo:a,meta:n,onPlayClick:r,onAddClick:l,className:i}=e;return Ta.createElement("div",{className:(0,Ma.Z)("volumeCover",{"volumeCover-withoutAdd":!l},i),style:t?{backgroundImage:`url(${t})`}:void 0},Ta.createElement(dn.Z,{to:a,className:"volumeCover_mask",div:!a}),r&&Ta.createElement(Ya.Z,{className:"volumeCover_play",onClick:r,plain:!0,anchor:!0},Ta.createElement("img",{src:Ii,alt:"play"})),n&&Ta.createElement("div",{className:"volumeCover_meta"},n),Ta.createElement("div",{className:"volumeCover_actions"},l&&Ta.createElement(Ya.Z,{className:"volumeCover_add",onClick:l,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","plus"]}))))},Fs=e=>{let{className:t,likesCount:a,commentsCount:n,users:r,title:l,desc:i,date:s,path:o,image:c,meta:d,info:m,onPlayClick:u,onAddClick:p}=e;const g=a||n||r?Ta.createElement("div",{className:"am_card_btm"},Ta.createElement("span",{className:"float-end"},a&&Ta.createElement("span",{className:"me-3"},Ta.createElement(Da.Z,{icon:["gfas","thumbs-up"],className:"me-1 u_color-gray-icon"}),(0,tn.Zx)(a)),n&&Ta.createElement("span",null,Ta.createElement(Da.Z,{icon:["gfas","comment"],className:"me-1 u_color-gray-icon"}),(0,tn.Zx)(n))),r&&Ta.createElement(un.Z,{size:"xs",users:r,subText:s?Ta.createElement("div",{className:"original_createdDate avatar_sub",suppressHydrationWarning:!0},(0,rn.Sy)(s)):void 0})):null;return Ta.createElement("div",{className:(0,Ma.Z)("originalMedia am_card",{"originalMedia-withDesc":i},t)},Ta.createElement("div",{className:"am_card_inner"},Ta.createElement(qs,{className:"originalMedia_image",bg:(0,tn.cR)(c,{resize:{w:223,h:223}}),bgTo:o,meta:d,onPlayClick:u,onAddClick:p}),Ta.createElement("p",{className:"am_card_info"},m),Ta.createElement(dn.Z,{to:o},Ta.createElement("h2",{className:"am_card_title"},l,i&&Ta.createElement("small",null,i))),g))},Bs=e=>{const t=e.getRel("category");return t?Ta.createElement(Ls.Z,{categoryID:t.get("id")},(e=>Ta.createElement("span",e,Ta.createElement(dn.Z,{to:(0,Ja.Z)("category",{id:t.get("id")}),className:"originalMedia_category"},t.getAttr("name"))))):null},Os={dispatchAddAndPlayRadio:l.lMO,dispatchAddRadio:l.KTf},Us=(0,Ka.connect)(void 0,Os)((e=>{let{volume:t,hideBtm:a=!1,dispatchAddAndPlayRadio:n,dispatchAddRadio:r}=e;const l=(0,Ja.D)(t.get("type"),t.get("id")),i=t.getImage(),s=(0,Ta.useCallback)((()=>{n(t)}),[t,n]),o=(0,Ta.useCallback)((()=>{r(t)}),[t,r]);return Ta.createElement(Fs,(0,Aa.Z)({},a?{}:{likesCount:t.getAttr("likes-count"),commentsCount:t.getAttr("comments-count"),users:t.getRel("djs"),date:t.getAttr("published-at")},{title:t.getAttr("title"),path:l,image:i,meta:(0,rn.dB)(t.getAttr("duration")),info:Bs(t),onPlayClick:s,onAddClick:o}))})),$s=e=>Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:(0,Ma.Z)(r.JW,"ah_audios")},e.map((e=>{const t=e.getRel("album"),a=e.getRel("radio");return Ta.createElement("div",{className:"col",key:a.getKey()},t?Ta.createElement(Fs,{className:"originalMedia-gpass",title:t.getAttr("title"),desc:a.getAttr("title"),path:(0,Ja.Z)(t),image:t.getAttr("cover"),meta:t.getSaleTypeName()||"播单",info:"现已更新"}):Ta.createElement(Us,{hideBtm:!0,volume:a}))}))),Ta.createElement(dn.Z,{className:"loadMoreButton loadMoreButton-center",to:(0,Ja.Z)("radios")},"查看更多")),Gs=()=>["data",Ca.namespace,"radios"],zs=(0,sn.TJ)([...Gs(),"ids"]),Hs=e=>{let{needInitialRequest:t=!0}=e;const a=(0,Ka.useDispatch)(),n=(0,Ka.useSelector)(zs),r=(0,Ka.useSelector)((e=>e.getIn(Gs())));return(0,Ta.useEffect)((()=>{t&&a(Ca.actions.getRadios(1,!0))}),[]),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"播客",moreTo:(0,Ja.Z)("radios")},Ta.createElement(Rr.Z,{loading:null==r?void 0:r.get("isRequesting"),fetched:null==r?void 0:r.get("fetched"),data:n.slice(0,10),height:"1000px"},$s))))},Vs=e=>Ta.createElement(Ei,{collections:e}),Ws=(0,sn.P1)((e=>e.getIn(["data","homepage","collections","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"collections",t))),js={dispatchGetCollectionsInHomepage:l.dId},Ks=(0,Ka.connect)(((e,t)=>({collections:Ws(e),dataState:e.getIn(["data","homepage","collections"])})),js)((e=>{let{needInitialRequest:t=!0,dataState:a,collections:n,dispatchGetCollectionsInHomepage:r}=e;return(0,Ta.useEffect)((()=>{t&&r()}),[]),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"专题",moreTo:(0,Ir.ZP)("collections")},Ta.createElement(Rr.Z,{loading:null==a?void 0:a.get("isRequesting"),fetched:null==a?void 0:a.get("fetched"),data:n,height:"420px"},Vs))))}));var Js=a(19045);const Ys=e=>{let{discussion:t}=e;const a=t.getAttr("participants-count")>0?`${t.getAttr("participants-count")} 人参与`:"暂无用户参与",n=t.getRemainingTime(),r=n?n>=0?`  还有 ${(0,rn.vn)(n)} 天结束`:"  讨论已结束":"",l=(()=>{const e=(new Date).getTime(),a=t.getAttr("published-at")?new Date(t.getAttr("published-at")).getTime():0;return e-a>=0&&e-a<2592e5})();return Ta.createElement(dn.Z,{to:(0,Ir.ZP)(t),className:(0,Ma.Z)("discussionItem")},l?Ta.createElement(Da.Z,{icon:["gfac","discussion-new"]}):Ta.createElement(Da.Z,{icon:["gfac","discussion"]}),Ta.createElement("div",null,Ta.createElement("h3",null,t.getTitle()),Ta.createElement("p",null,a," ",r)))},Xs=a.p+"22334cc1ce81e07092e9.png",Qs=e=>Ta.createElement(vi.Z,r.ON,e.map((e=>Ta.createElement("div",{key:e.getKey(),className:"slick-item"},Ta.createElement(Js.Z,{game:e}))))),eo=e=>Ta.createElement(vi.Z,(0,Aa.Z)({},r.ON,{className:"p_homeBooomGamesSlider"}),e.slice(0,11).map((e=>Ta.createElement("div",{key:e.getKey(),className:"slick-item"},Ta.createElement(Js.Z,{game:e})))),Ta.createElement("div",{className:"slick-item"},Ta.createElement(dn.Z,{className:(0,Ma.Z)("news game game-booomMore"),to:"/booom/game_lib"},Ta.createElement("div",{className:"news_imgArea"},Ta.createElement("img",{src:Xs,alt:"booom"})),Ta.createElement("div",{className:"news_content"},Ta.createElement("h3",null,"点击查看更多原创游戏"))))),to=(0,sn.TJ)(["data",_a.Z.namespace,"hotGames","ids"]),ao=(0,sn.P1)((e=>e.getIn(["data","homepage","discussions","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),no=(0,sn.P1)((e=>e.getIn(["data","homepage","discussionBanners","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t).map((e=>e.getRel("target"))))),ro=(0,sn.P1)(no,ao,((e,t)=>e.concat(t).slice(0,3))),lo=(0,sn.TJ)(["data","gameLib","homepageFeaturedGames","ids"]),io={dispatchGetNotableGames:_a.Z.actions.getHotGames,dispatchGetBooomGames:ga.Z.actions.getHomepageFeaturedGames,dispatchGetDiscussionBanners:l.cAG,dispatchGetLatestDiscussions:l.j33},so=(0,Ka.connect)(((e,t)=>({games:to(e),gamesState:e.getIn(["data",_a.Z.namespace,"hotGames"]),booomGames:lo(e),booomGamesState:e.getIn(["data","gameLib","homepageFeaturedGames"]),discussions:ro(e)})),io)((e=>{let{games:t,discussions:a,gamesState:n,booomGames:r,booomGamesState:l,dispatchGetNotableGames:i,dispatchGetBooomGames:s,dispatchGetDiscussionBanners:o,dispatchGetLatestDiscussions:c}=e;return(0,Ta.useEffect)((()=>{i(),o(),c(),s()}),[i,o,c,s]),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"大家在聊",moreTo:(0,Ir.ZP)("discussions")},(e=>Ta.createElement("div",{className:"ah_discussions"},e.map((e=>Ta.createElement(Ys,{key:e.getKey(),discussion:e})))))(a)),Ta.createElement(ci.Z,{title:"游戏影视动态",moreTo:(0,Ir.ZP)("gamesHot")},Ta.createElement(Rr.Z,{loading:null==n?void 0:n.get("isRequesting"),fetched:null==n?void 0:n.get("fetched"),data:t,height:"1000px"},Qs)),Ta.createElement(ci.Z,{title:"编辑推荐游戏",moreTo:"/booom/game_lib"},Ta.createElement(Rr.Z,{loading:null==l?void 0:l.get("isRequesting"),fetched:null==l?void 0:l.get("fetched"),data:r,height:"1000px"},eo))))})),oo="9e83697a-32e1-4d85-9688-32382fdd8764.jpg",co=e=>Ta.createElement(dn.Z,(0,Aa.Z)({},e,{to:"https://www.gcores.com/articles/134546",className:(0,Ma.Z)("am_topic",e.className)}),Ta.createElement("div",{className:"am_topic_cover",style:{backgroundImage:`url(${(0,tn.cR)(oo,{resize:{w:510,m:"lfit"}})})`}}),Ta.createElement("div",{className:"am_topic_inner",style:{backgroundImage:`url(${(0,tn.cR)(oo,tn.iT.Blur)})`}},Ta.createElement("div",{className:"am_topic_content"},Ta.createElement("h3",{className:"am_topic_title"},"机核需要你！GCORES 2022 招聘信息"),Ta.createElement("div",{className:"am_topic_info"},Ta.createElement(Ya.Z,{type:"opacity",ellipse:!0},"查看详情"))))),mo=(e,t)=>{let{topicIndex:a}=t;if(!e)return null;if(a>=0&&e.size<a+1)return null;const n=a>=0?e.insert(a,a).pop():e;return Ta.createElement("div",{className:(0,Ma.Z)(r.JW,"o_equalHeightRow"),key:"articles"},n.map((e=>((e,t)=>{let a;return a=e===t?Ta.createElement(co,{className:"o_marginBottomGridGutter"}):Ta.createElement(si.Z,{original:e}),Ta.createElement("div",{className:"col",key:e===t?"collection":e.getKey()},a)})(e,a))))},uo=(e,t,a)=>e.getIn(["data","homepage"].concat(a)),po=(0,sn.P1)(((e,t)=>uo(e,0,["latestOriginals"])),(e=>e.getIn(["data","firstScreen","all","editorShowcases","ids"])),(e=>e.getIn(["data","firstScreen","all","banners","sub","ids"])),sn.LF,((e,t,a,n)=>{const r=e.get("currentPage"),l=w.default.latestOriginalsPageLimit;let i=e.get("ids");if(!i)return(0,k.List)();if(t&&t.size>0){const e=(null==a?void 0:a.size)>0?t.slice(0,w.default.editorShowcasesPageLimit-1):t,n=e=>`${e.get("type")}${e.get("id")}`;i=i.filterNot((t=>e.map((e=>n(e))).includes(n(t))))}const s=l*(r-1);return i=i.slice(0,s+l),(0,ln.BY)(i,n)})),go={dispatchGetLatestOriginalsInHomepage:l.sEk},ho=(0,Ka.connect)(((e,t)=>({latestArticles:po(e,t),dataState:uo(e,0,["latestOriginals"])})),go)((e=>{let{dataState:t,latestArticles:a,dispatchGetLatestOriginalsInHomepage:n,needInitialRequest:r=!0}=e;const[l,i]=(0,Ta.useState)(1);let s;(0,Ta.useEffect)((()=>{n(l,r&&1===l)}),[l]);const o=Ta.createElement(Rr.Z,{loading:null==t?void 0:t.get("isRequesting"),fetched:null==t?void 0:t.get("fetched"),data:a,height:"1180px"},(e=>mo(e,{topicIndex:-1})));return s=l>3?Ta.createElement(dn.Z,{to:(0,Ja.Z)("latest",{page:3}),className:"loadMoreButton loadMoreButton-center"},"查看更多"):Ta.createElement(Ya.Z,{className:"loadMoreButton loadMoreButton-center",disabledClass:"is_disabled",loading:null==t?void 0:t.get("isRequesting"),onClick:()=>{i((e=>e+1))},plain:!0},"查看更多"),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"综合",moreTo:(0,Ja.Z)("latest")},o,s)))})),vo=e=>{let{title:t,url:a,thumb:n,className:r}=e;return Ta.createElement(dn.Z,{to:a,className:(0,Ma.Z)("album album-shop am_card",r)},Ta.createElement("div",{className:"album_bg"}),Ta.createElement("div",{className:"album_inner"},Ta.createElement("div",{className:"album_cover"},Ta.createElement("div",{className:"album_cover_img",style:{backgroundImage:`url(${(0,tn.cR)(n,{resize:{w:120,h:120}})})`}})),Ta.createElement("div",{className:"album_text"},Ta.createElement("div",{className:"album_title"},Ta.createElement("h3",null,t)),Ta.createElement("span",{className:"u_color-notification u_fontSize-sm"},"查看详情"))))},Eo=e=>{let{shopItem:t,className:a}=e;return Ta.createElement(vo,{title:t.getAttr("name"),url:t.getAttr("url"),thumb:t.getAttr("image-path"),className:a})},fo=a.p+"0c3ffd1f2f7f88834da6.jpg",yo=[fo,fo],bo=()=>Ta.createElement("a",{href:"https://shop124260606.taobao.com",rel:"noopener noreferrer",target:"_blank",className:"d-block"},Ta.createElement("img",{src:yo[pt()(0,1)],alt:"吉考斯工业贩售",className:"img-fluid"})),ko=e=>Ta.createElement(vi.Z,{slidesToShow:4,slidesToShowResponsive:[3,3,2,1]},e.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(Eo,{shopItem:e,className:"mb-0"}))))),Co=(0,sn.P1)((e=>e.getIn(["data","homepage","shopItems","data","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"shop-items",t))),_o=e=>e.getIn(["data","homepage","shopItems","randomKey"]),wo=(0,sn.P1)(Co,_o,((e,t)=>e.filter((e=>e.getAttr("shop-type")===t)))),No={dispatchGetShopItems:l.keW},Po=(0,Ka.connect)((e=>{const t=wo(e);return{shopType:_o(e),shopItems:t,dataState:e.getIn(["data","homepage","shopItems"])}}),No)((e=>{let{needInitialRequest:t=!0,dispatchGetShopItems:a,shopType:n,shopItems:r,dataState:l}=e;return(0,Ta.useEffect)((()=>{t&&a(n)}),[]),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"jihepu"===n?"吉考斯工业推荐":"核市奇谭推荐"},Ta.createElement(Rr.Z,{loading:null==l?void 0:l.get("isRequesting"),fetched:null==l?void 0:l.get("fetched"),data:r,emptyContent:Ta.createElement(bo,null),height:"260px"},ko))))}));var So=a(70315);const Zo=e=>{let{talk:t}=e;const a=(0,tn.cR)(t.getThumb(),{resize:{w:88,h:88}}),n=(0,Ir.ZP)("talk",{id:t.get("id")});return Ta.createElement("div",{className:"talkRecommendation"},a&&Ta.createElement(dn.Z,{className:"talkRecommendation_thumb",to:n},Ta.createElement("img",{src:a,alt:t.getAttr("title")})),Ta.createElement("div",{className:"talkRecommendation_body"},Ta.createElement("p",{className:"talkRecommendation_topic"},Ta.createElement(dn.Z,{to:(0,Ir.ZP)("topic",{id:t.getRel("topic","id")})},Ta.createElement(So.Z,null,t.getRelAttr("topic","title")))),Ta.createElement(dn.Z,{to:n,className:"talkRecommendation_title"},Ta.createElement("h3",null,t.getDesc())),Ta.createElement("p",{className:"talkRecommendation_btm"},Ta.createElement("span",{suppressHydrationWarning:!0},t.getAttr("entry-is-official")?"官方":(0,Tr.io)(t.getRelAttr("user","nickname"),10),"· ",(0,rn.Sy)(t.getAttr("published-at"))),Ta.createElement("span",null,t.getAttr("likes-count")," 喜欢 ·"," ",t.getAttr("comments-count")," 评论"))))},Io=e=>{const t=[e.slice(0,3),e.slice(3,6),e.slice(6,9)];return Ta.createElement(vi.Z,{slidesToShow:3,slidesToShowResponsive:[3,2,2,1]},t.map((e=>{const t=e.first();return t?Ta.createElement("div",{key:t.getKey(),className:"slick-item"},Ta.createElement("div",null,e.map((e=>Ta.createElement(Zo,{key:e.getKey(),talk:e}))))):null})))},To=(0,sn.P1)((e=>e.getIn(["data","homepage","talks","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))))),Ao={dispatchGetTalks:l.sBh},Ro=(0,Ka.connect)(((e,t)=>({talks:To(e),dataState:e.getIn(["data","homepage","talks"])})),Ao)((e=>{let{dataState:t,talks:a,dispatchGetTalks:n}=e;return(0,Ta.useEffect)((()=>{n()}),[n]),Ta.createElement("div",{className:"ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"机组精选",moreTo:"/topics/home"},Ta.createElement(Rr.Z,{loading:null==t?void 0:t.get("isRequesting"),fetched:null==t?void 0:t.get("fetched"),data:a,height:"300px"},Io))))}));var Do=a(81015),xo=a(13216);const Mo={border:"0",frameBorder:"0",allowFullScreen:!0},Lo=(e,t)=>{if(e){const{type:t,src:a,attributes:n,sourceAttributes:r}=(0,Do.ZP)(e)||{};return(0,xo.o)({type:t,src:a,props:"iframe"===t?Mo:{},attributes:n,sourceAttributes:r})}return t?(0,xo.o)({type:"iframe",src:t,props:Mo}):null},qo=e=>{let{src:t,hostedSrc:a}=e;const n=Lo(t,a);return n?Ta.createElement("div",{className:"videoPlayer_embed"},n):Ta.createElement("div",{className:"videoPlayer_embed"},"无法播放该视频")},Fo=e=>{let{video:t,vodId:n,onError:r}=e;const l=((e,t,n)=>{const r=(0,Ka.useDispatch)(),l=(0,yr.$0)(`${e}${t}`),i=(0,yr.II)(l),s=(0,yr.II)(n),o=(0,Ta.useCallback)((async()=>{var n;const o=await a.e(210).then(a.t.bind(a,51210,23)),c=await r((0,V.D1)(`medias/protected/videos/${e}/play-auth`)),d=null==c||null===(n=c.payload)||void 0===n?void 0:n.origin;if(!o||!d)return null;if(l!==i.current)return null;o.default.__unable2Anti9Debugger13Key="error";const m=new o.default({id:l,width:"100%",height:"100%",vid:t,playauth:d["play-auth"],useH5Prism:!0,loadDataTimeout:10,encryptType:1,autoplay:!1,defaultDefinition:"SD"});return m.on("error",(e=>{var t,a;null===(t=s.current)||void 0===t||t.call(s,null===(a=e.paramData)||void 0===a?void 0:a.error_code)})),m}),[r,e,t,l,i,s]);return(0,Ta.useEffect)((()=>{let e;return(async()=>{e=await o()})(),()=>{e&&e.dispose()}}),[o]),l})(t.get("id"),n,r);return Ta.createElement("div",{id:l,className:(0,Ma.Z)("videoPlayer_embed")})},Bo=e=>{let{children:t,className:a,...n}=e;return Ta.createElement("div",{className:"videoPlayer_container"},Ta.createElement("div",(0,Aa.Z)({className:(0,Ma.Z)("videoPlayer_embed",a)},n),t))},Oo=e=>{let{video:t,children:a,className:n,onButtonClick:r,...l}=e;return Ta.createElement(Bo,{className:(0,Ma.Z)(n,"videoPlayer_cover"),style:{backgroundImage:`url(${(0,tn.cR)(t.getImage(),{resize:{w:1600}})})`}},Ta.createElement(Ya.Z,{plain:!0,className:"videoPlayer_cover_btn",onClick:()=>{r()}},Ta.createElement(Da.Z,{icon:["gfas","play"]})))},Uo=e=>{let{video:t,preview:a,className:n}=e;const{sendMessage:r}=(0,Ua.EY)(),[i,s]=(0,Ta.useState)(!1),[o,c]=(0,Ta.useState)(!1),d=t.get("id"),m=t.getRel([["albums",0]]),u=t.getRel("media"),p=null==u?void 0:u.getSingleSrc(),g=t.getRel("draft")||t.getRel("audit-draft"),h=null==g?void 0:g.getRel("hosted-media"),v=null==h?void 0:h.getAttr("playable-url"),E=null==u?void 0:u.getAttr("vod-file-id"),f=(0,Ka.useDispatch)(),y=(0,Ka.useSelector)(sn.ib),b=(0,Ka.useSelector)((e=>(0,sn._I)(e,me.Uo.Video,t.get("id")))),k=t.isAvailable(y,b);if((0,Ta.useEffect)((()=>{f((0,l.yap)({purchasableType:me.Uo.Video,purchasableId:d})),s(!0)}),[f,d]),!i)return Ta.createElement(Bo,{className:n});if(!k)return Ta.createElement(Oo,{video:t,className:n,onButtonClick:()=>{m&&f((0,l.YDj)("albums",m.get("id"),{mediaType:"video"}))}});if("failed"===o)return Ta.createElement(Oo,{video:t,className:n,onButtonClick:()=>{r({type:l.ZQC.APP_ALERT})}});let C="";a&&(h?C=`视频状态：${h.getAttr("host-side-status")}`:t.getAttr("is-published")||(C="请先发布才能进行视频转码与审核"));const _=C&&Ta.createElement("div",{className:"videoPlayer_tip"},C);return Ta.createElement("div",{className:"videoPlayer_container"},_,E&&!0!==o?Ta.createElement(Fo,{video:t,vodId:E,onError:e=>{if(!Lo(p,v))return c("failed"),void r({type:l.ZQC.APP_SUGGEST_ALERT});c(!0)}}):Ta.createElement(qo,{src:p,hostedSrc:v}))};class $o extends Ta.PureComponent{constructor(e){super(e),this.state={currentPlayID:e.data.first().get("id")},this.handlePlayVideo=this.handlePlayVideo.bind(this)}handlePlayVideo(e){this.setState({currentPlayID:e})}render(){const{data:e}=this.props,{currentPlayID:t}=this.state,a=e.find((e=>e.get("id")===t));return Ta.createElement("div",{className:"videosShowcase"},Ta.createElement(Uo,{video:a}),Ta.createElement("div",{className:"videosShowcase_list"},Ta.createElement(Ai,{videos:e,currentPlayID:t,onPlayVideo:this.handlePlayVideo})))}}$o.propTypes={data:Va().list.isRequired};const Go=$o,zo=e=>Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"d-none d-sm-block"},Ta.createElement(Go,{data:e})),Ta.createElement("div",{className:"d-sm-none"},e.slice(0,3).map((e=>Ta.createElement("div",{key:e.getKey()},Ta.createElement(si.Z,{original:e}))))),Ta.createElement(dn.Z,{className:"loadMoreButton loadMoreButton-center mt-5",to:(0,Ja.Z)("videos")},"查看更多")),Ho=(0,sn.P1)((e=>e.getIn(["data","homepage","videos","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"videos",t))),Vo={dispatchGetVideosInHomepage:l.kKF},Wo=(0,Ka.connect)((e=>({videos:Ho(e),dataState:e.getIn(["data","homepage","videos"])})),Vo)((e=>{let{dataState:t,videos:a,dispatchGetVideosInHomepage:n,needInitialRequest:r=!0}=e;return(0,Ta.useEffect)((()=>{r&&n()}),[]),Ta.createElement("div",{className:"ah_block ah_block"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"视频",moreTo:(0,Ja.Z)("videos")},Ta.createElement(Rr.Z,{loading:null==t?void 0:t.get("isRequesting"),fetched:null==t?void 0:t.get("fetched"),data:a,height:"1060px"},zo))))})),jo=(e,t)=>{if(!t)return e;return Ta.createElement(Wi.ZP,{height:1300,offset:-200},e)},Ko=(0,sn.P1)((e=>((e,t)=>e.getIn(["data","homepage"].concat(t)))(e,["news","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"news",t))),Jo=(0,sn.TJ)(["data","firstScreen","all","banners","top","ids"]),Yo=(0,Ka.connect)(((e,t)=>{var a;return{news:Ko(e),topBanner:null===(a=Jo(e))||void 0===a?void 0:a.get(0)}}))((e=>{const{news:t,topBanner:a,needLazyLoad:n}=e,r={needInitialRequest:n};return Ta.createElement(Ta.Fragment,null,a?Ta.createElement("div",{className:"homePage_topBanner",style:a.getAttr("bg-image")?{backgroundImage:`url(${(0,tn.cR)(a.getAttr("bg-image"))})`}:{}},Ta.createElement("div",{className:"container"},Ta.createElement(dn.Z,{to:a.getHref(),className:"homePage_topBanner_padding"},Ta.createElement("div",{className:"homePage_topBanner_md"},Ta.createElement("img",{src:(0,tn.cR)(a.getAttr("image"))})),Ta.createElement("div",{className:"homePage_topBanner_sm"},Ta.createElement("img",{src:(0,tn.cR)(a.getAttr("app-image")||a.getAttr("image"))}))))):null,Ta.createElement("div",{className:"pageContainer py-0"},Ta.createElement(Cs,{tagID:"all",inHomepage:!0}),Ta.createElement(Ji,{data:t}),jo(Ta.createElement(Ta.Fragment,null,Ta.createElement(so,r),Ta.createElement(ho,r)),n),jo(Ta.createElement(Ta.Fragment,null,Ta.createElement(Ro,r),Ta.createElement(Ms,r)),n),jo(Ta.createElement(Ta.Fragment,null,Ta.createElement(Hs,r),Ta.createElement(Po,r)),n),jo(Ta.createElement(Ta.Fragment,null,Ta.createElement(Wo,r),Ta.createElement(Ks,r)),n)))})),Xo=Yo,Qo={path:"",children:[{...(0,ii.r3)("home"),async action(e){var t;let{store:a,next:n,isRefresh:r,isPathnameChangedNotBrowserFirst:i}=e,s="home";r&&(s=(new Date).toUTCString());const o=await n();if(o)return o;const{dispatch:c}=a;i&&await Promise.all([c((0,l.ZGo)({type:"top"})),c((0,l.ZGo)({type:"main"})),c((0,l.ZGo)({type:"sub"})),c((0,l.gfx)()),c(ht.action()),c(vt.action()),c((0,l.bIi)())]);const d=(null===(t=a.getState().getIn(["data","firstScreen","all","banners","top","ids"]))||void 0===t?void 0:t.size)>0;return{context:{navTransparent:d,mobileNavProps:{transparent:d},appProps:{className:"is_inWiderPage"}},component:Ta.createElement(Xo,{key:s,needLazyLoad:!0}),preloadState:!0,restoreScroll:!0}}},{...(0,ii.r3)("latest"),action:async e=>Hi("originals",e)}]};async function ec(e,t,a,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"originals",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,{isPathnameChangedNotBrowserFirst:s,isBrowserFirstLoad:o}=arguments.length>6?arguments[6]:void 0;const c={type:a,id:n};let d=[],m=!1;s&&(d=d.concat([t((0,l.ccU)(c))]),m=!0,e&&(d=d.concat([t((0,l.ZGo)({tagID:n,type:"main"})),t((0,l.ZGo)({tagID:n,type:"sub"})),t((0,l.gfx)(n))]))),o||(d="games"===r?d.concat([t((0,l.lQg)(a,n,i))]):d.concat([t((0,l.pl6)(c,r,i,e))]));const u=await Promise.all(d);return m?u[0]:null}class tc extends Ta.PureComponent{render(){const{children:e,actions:t,withNav:a,withBgCircle:n,background:r,white:l,backgroundCover:i,className:s,containerClassName:o,footerContent:c,bodyCenter:d,...m}=this.props,{tabs:u}=m,p=u&&u.length>0,g=/^#/.test(r),h=r&&!g,v=p?Ta.createElement(wn.Z,(0,Aa.Z)({inHeader:!0},m)):Ta.createElement("div",{className:"pageHeader_footerInfo"},c);return Ta.createElement("div",{className:(0,Ma.Z)("pageHeader",s,{gnav_next:a,"pageHeader-withFooter":p||t,"pageHeader-white":l})},Ta.createElement("div",{className:(0,Ma.Z)("pageHeader_bg",{"pageHeader_bg-image":h}),style:{...g?{backgroundColor:r}:{},...h?{backgroundImage:`url(${r})`}:{}}}),i&&Ta.createElement("div",{className:"pageHeader_cover"}),Ta.createElement("div",{className:"pageHeader_inner"},n&&Ta.createElement("div",{className:`${o} pageHeade_relative`},Ta.createElement("div",{className:"pageHeader_circle"})),Ta.createElement("div",{className:"pageHeader_body"},Ta.createElement("div",{className:d?o:void 0},e)),(t||v)&&Ta.createElement("div",{className:o},Ta.createElement("div",{className:"pageHeader_footer"},t&&Ta.createElement("div",{className:"pageHeader_actions"},t),v))))}}tc.propTypes={className:Ga().string,children:Ga().node.isRequired,actions:Ga().node,footerContent:Ga().node,withNav:Ga().bool,withBgCircle:Ga().bool,background:Ga().string,white:Ga().bool,backgroundCover:Ga().bool,bodyCenter:Ga().bool,containerClassName:Ga().string},tc.defaultProps={className:void 0,actions:void 0,footerContent:void 0,withNav:!1,withBgCircle:!1,background:void 0,white:!1,bodyCenter:!0,backgroundCover:!1,containerClassName:"container"};const ac=tc,nc=a.p+"b89e3a14ca8851aca04a.jpg";var rc=a(46066);const lc=e=>{let{currentSlide:t,slideCount:a,children:n,...r}=e;return Ta.createElement(Ya.Z,(0,Aa.Z)({},r,{anchor:!0,plain:!0}),n)},ic={dots:!0,fade:!0,draggable:!1,swipe:!1,infinite:!0,speed:500,nextArrow:Ta.createElement(lc,null,Ta.createElement(Da.Z,{icon:["gfas","angle-right"]})),prevArrow:Ta.createElement(lc,null,Ta.createElement(Da.Z,{icon:["gfas","angle-left"]})),customPaging:e=>Ta.createElement("span",null,Ta.createElement(Ya.Z,{anchor:!0,plain:!0},e),Ta.createElement("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",viewBox:"0 0 14 14",preserveAspectRatio:"none"},Ta.createElement("circle",{cx:"7",cy:"7",r:"6"})))},sc=e=>{let{focus:t}=e;const a=t.get("outlink"),n=t.get("src"),r={className:"focusImages_item",style:{backgroundImage:`url(${(0,tn.cR)(t.get("image"),{resize:{w:750,h:420}})})`}};return a?Ta.createElement("a",(0,Aa.Z)({href:n},r),"焦点链接"):Ta.createElement(dn.Z,(0,Aa.Z)({to:n},r),"焦点链接")};sc.propTypes={focus:Va().map.isRequired};const oc=e=>{let{data:t,className:a,...n}=e;const r=t.map((e=>Ta.createElement(sc,{key:e.get("src"),focus:e})));return Ta.createElement("div",{className:(0,Ma.Z)("focusImages",a)},Ta.createElement(rc.Z,(0,Aa.Z)({},ic,n),r))};oc.propTypes={data:Va().list.isRequired,className:Ga().string},oc.defaultProps={className:void 0};const cc=oc,dc=e=>{let{data:t,...a}=e;const n=t.map((e=>{const t=e.getRel("target"),a=e.getAttr("image"),n=e.getAttr("link");let r=n,l=!0;return t?(l=!1,r=(0,Ir.bv)(t.get("type"),t.get("id"))):"string"==typeof n&&n.includes(w.default.main_url)&&(l=!1,r=n.replace(w.default.main_url,"")),(0,k.fromJS)({src:r,outlink:l,image:a})}));return Ta.createElement(cc,(0,Aa.Z)({data:n,autoplay:!0,autoplaySpeed:5e3},a))};dc.propTypes={data:Va().list.isRequired};const mc=dc;class uc extends Xa.Z{render(){const{tagID:e,focusImages:t,subFocusOriginals:a,collectionEntry:n,className:r,withBottomBorder:l=!0,inHomepage:i=!1}=this.props,s=t&&t.size>0?Ta.createElement(mc,{data:t}):Ta.createElement(cs.Z,null),o=a&&a.size>0?Ta.createElement("div",{className:"row"},a.map((e=>Ta.createElement("div",{className:"col-md-4",key:e.getKey()},Ta.createElement(si.Z,{original:e,focus:!0}))))):Ta.createElement(cs.Z,null);return Ta.createElement("div",{className:(0,Ma.Z)("ah_block",r,{"ah_block-firstScreen":!i})},Ta.createElement("div",{className:"container"},Ta.createElement("div",{className:(0,Ma.Z)("ah_block-firstScreen_inner",{"u_borderNone pb-0":!l})},Ta.createElement("div",{className:"row ah_focusRow"},Ta.createElement("div",{className:"col-lg-8"},s),Ta.createElement("div",{className:"col-lg-4"},"all"===e?Ta.createElement("a",{href:"https://site.gcores.com/booom2022/games/",className:"ah_specialEntry",style:{backgroundImage:`url(${nc})`},target:"_blank",rel:"noreferrer"}):this.renderEntry(n))),o)))}renderEntry=e=>{const t=e&&e.getRel("target");return t?"collections"===t.get("type")?Ta.createElement(os,{collection:t,moreTo:(0,Ja.Z)("collections")}):"albums"===t.get("type")?Ta.createElement(is,{album:t}):Ta.createElement(cs.Z,null):Ta.createElement(cs.Z,null)}}const pc=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["ids"];return(a,n)=>a.getIn(["data","firstScreen",n.tagID,"banners",e,...t])},gc=(0,sn.P1)(pc("main"),sn.LF,((e,t)=>(0,ln.BY)(e,t))),hc=(0,sn.P1)(pc("sub"),pc("sub",["random"]),sn.LF,((e,t,a)=>(0,ln.BY)(e,a).get(t))),vc=(0,sn.P1)(((e,t)=>e.getIn(["data","firstScreen",t.tagID,"editorShowcases","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Ec=(0,Ka.connect)(((e,t)=>({focusImages:gc(e,t),subFocusOriginals:vc(e,t),collectionEntry:hc(e,t)})))(uc),fc=a.p+"ab622ef6ec023ed3eb45.png",yc=a.p+"cde97004b0f645387ad1.png",bc=a.p+"4d46bd2f66bf3f7f47ab.png",kc=a.p+"fd7115e29809f02a4e95.png",Cc=a.p+"0af2102c229a2b7ad514.png",_c=a.p+"95d590de5c7936d4beff.png",wc=a.p+"ec3e9cecc5bcdeaa6730.png",Nc=e=>tn.hd.map((t=>({...t,to:(0,Ir.ZP)(e,{tab:t.key,page:1})}))),Pc={GAME:{color:"#5F2F90",image:fc},LIFESTYLE:{color:"#00DFB7",image:yc},ACG:{color:"#00C8F9",image:bc},MEDIA:{color:"#F1592A",image:kc},TECH:{color:"#333",image:wc},DESIGN:{color:"#f0324f",image:_c},TOY:{color:"#F4909D",image:Cc}},Sc=e=>Ta.createElement("div",{className:"row",key:"originals"},e.map((e=>Ta.createElement("div",{className:tn.d9,key:e.getKey()},Ta.createElement(si.Z,{original:e,small:!0})))));class Zc extends Xa.Z{renderHeader(){const{name:e}=this.props;return Ta.createElement(ac,{withNav:!0,withBgCircle:!0,background:Pc[e].color,className:"tagPage_header"},Ta.createElement("img",{src:Pc[e].image,alt:"title",className:"pageHeader_img"}))}renderOriginals(){const{originals:e,originalsState:t,pathname:a,page:n,tab:r}=this.props;return Ta.createElement(Ta.Fragment,null,Ta.createElement(wn.Z,{tabs:Nc(a),active:r}),Ta.createElement(oi.Z,{data:e,isRequesting:t.get("isRequesting"),fetched:t.get("fetched"),gcPageProps:{current:n,linkBuilder:e=>(0,Ir.ZP)(a,{page:e,tab:r})}},Sc))}render(){const{tagId:e}=this.props;return Ta.createElement(Ta.Fragment,null,this.renderHeader(),Ta.createElement("div",{className:"pageContainer pb-0"},Ta.createElement(Ec,{tagID:e,withBottomBorder:!1}),Ta.createElement("div",{className:"ah_block pt-4"},Ta.createElement("div",{className:"container"},this.renderOriginals()))))}}const Ic=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.getIn(["data","tagPage",`tags${t.tagId||"all"}`,...a])},Tc=(0,sn.P1)(((e,t)=>Ic(e,t,["originals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Ac=(0,Ka.connect)(((e,t)=>({originals:Tc(e,t),originalsState:Ic(e,t,["originals"])})))(Zc);Ac.propTypes={pathname:Ga().string.isRequired,page:Ga().number.isRequired,tab:Ga().string.isRequired},Zc.propTypes={...Ac.propTypes,originals:Va().list},Zc.defaultProps={...Ac.defaultProps,originals:void 0};const Rc=Ac;var Dc=a(43446);const xc=(e,t)=>({path:e,async action(e){const{store:a,query:n}=e,l=await async function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"originals",l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5?arguments[5]:void 0;return Number(l)>r.Tc?Ta.createElement(Dc.Z,null):(await ec(!0,e,"tags",a,n,l,i),{title:t,preloadState:!0,context:{navTransparent:!0},component:Ta.createElement(Rc,{name:t,pathname:i.pathname,tagId:a,key:a,page:Number(l),tab:n})})}(a.dispatch,t,r.qP[t].id,n.tab,(0,nn.CO)(n.page),e);return l}}),Mc=Object.keys(r.qP).map((e=>xc(r.qP[e].path,e)));var Lc=a(45578),qc=a.n(Lc),Fc=a(76731),Bc=a(15045),Oc=a(51206),Uc=a(94479),$c=a(22222),Gc=a(34009);const zc=(0,Gc.rE)({talkProps:{hideRepost:!0}}),Hc=[{key:"all",title:"动态"},{key:"official",title:"官方"},{key:"recommendation",title:"推荐"}],Vc=(0,$c.P1)((e=>e.getIn(["data","gamePage","feeds","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))))),Wc={dispatchGetFeeds:Te.Z.actions.getFeeds},jc=(0,Ka.connect)(((e,t)=>({data:Vc(e),dataState:e.getIn(["data","gamePage","feeds"])})),Wc)((e=>{let{type:t,id:a,data:n,dataState:r,dispatchGetFeeds:l}=e;const[i,s]=(0,Ta.useState)(Hc[0].key),o=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!r)return;const t=n.last(),s=e?void 0:t&&(0,rn.u3)(t.getAttr("published-at"));await l(a,i,s)},c=(0,yr.II)(o),d=(0,Ta.useCallback)((async()=>{await c.current(!0,i)}),[c,i]),m=(0,yr.n5)(d);return Ta.createElement("div",{className:"gamePage_feedsContainer story_container"},Ta.createElement("div",{className:"flowLayout_head"},Ta.createElement("h3",null,tn.AS[t],"相关内容"),Ta.createElement(wn.Z,{hrefEnabled:!1,tabs:Hc,active:i,onTabChange:s})),Ta.createElement(Cn.Z,{data:n,state:r,onLoad:o,onInit:m},zc))})),Kc=(e,t)=>e.getRel("involvements").sort(((e,t)=>(e.rank||0)-(t.rank||0))).reduce(((e,a)=>{const n=a.getRel(["entity","user"]);return n?t(e,a,n):e}),[]),Jc=(e,t)=>({id:e.get("id"),name:e.getAttr("nickname"),thumb:e.getAttr("thumb"),position:t,model:e}),Yc=e=>(e=>qc()(e,"id"))((e=>Kc(e,((e,t,a)=>{const n=Jc(a,t.getAttr("title")),r=e.find((e=>e.id===n.id));return r?r.position+=`、${n.position}`:e.push(n),e})))(e)),Xc="gamePage_slider slick-circleArrow";class Qc extends Xa.Z{staffRef=Ta.createRef();state={staffMoreVisible:!1,pageMounted:!1,staffModalVisible:!1};componentDidMount(){window.addEventListener("resize",this.handleWinResize),this.handleWinResize(),this.setState({pageMounted:!0})}render(){return Ta.createElement(Ta.Fragment,null,this.renderHeader(),Ta.createElement("div",{className:"gamePage"},this.renderInfo(),Ta.createElement("div",{className:"originalPage_bottom"},this.renderOriginals(),this.renderTalks())))}renderOriginals(){const{originals:e}=this.props,t=null==e?void 0:e.slice(0,4);if(!(t&&t.size>0))return null;const{container:a,col:n}=(0,tn.GS)(t.size);return Ta.createElement("div",{className:"container gamePage_latestOriginals"},Ta.createElement("div",{className:"row"},Ta.createElement("div",{className:a},Ta.createElement("div",{className:"row"},t.map((e=>Ta.createElement("div",{className:n,key:e.getKey()},Ta.createElement(si.Z,{original:e}))))))))}renderTalks(){const{game:e}=this.props;return Ta.createElement(jc,{type:e.get("type"),id:e.get("id")})}renderActions(){const{game:e}=this.props;return Ta.createElement("span",null,Ta.createElement("span",{className:"me-2"},e.getAttr("subscriptions-count")>0?`${e.getAttr("subscriptions-count")} 人关注`:"支持新内容提醒"),Ta.createElement(Fc.Z,{subscribable:e,actionName:"关注"}))}renderReleaseInfo(){const{game:e}=this.props;if("games"===e.get("type")){const t=e.getAttr("released-at")||e.getAttr("domestic-released-at");return e.getAttr("development-status")||(t?`${(0,rn.SI)(new Date(t))} 发售`:"暂未公布")}return(0,rn.TZ)(e.getAttr("released-at"))}renderHeader(){const{game:e}=this.props,t=e.getCover(),a=(0,tn.pn)(t).isGif?null:(0,tn.cR)(e.getCover(),tn.iT.Blur);return Ta.createElement(ac,{withNav:!0,actions:this.renderActions(),containerClassName:"story_container",className:"gamePage_header",background:a,footerContent:this.renderReleaseInfo(),bodyCenter:!1},this.renderHeaderBody())}renderHeaderBody(){const{game:e,screenshots:t}=this.props,{pageMounted:a}=this.state;if(!a)return null;let n;if(1===t.length){const[{type:e,src:a}]=t;n="iframe"===e?Ta.createElement("iframe",{className:"gamePage_cover",src:a}):Ta.createElement("img",{className:"gamePage_cover",src:(0,tn.cR)(a,{resize:{h:260,w:1e3,m:"lfit"}})})}else t.length>1&&(n=Ta.createElement(rc.Z,{slidesToShow:1,variableWidth:!0,centerMode:!0,focusOnSelect:!0,className:Xc,nextArrow:Ta.createElement(Oc.Z,{icon:!0,direction:"right"}),prevArrow:Ta.createElement(Oc.Z,{icon:!0,direction:"left"}),responsive:[{breakpoint:600,settings:{variableWidth:!1,slidesToShow:1,className:`${Xc} gamePage_slider-small`}}]},t.map((e=>{let{type:t,src:a}=e,n=null;if("iframe"===t)n=Ta.createElement("iframe",{src:a});else{const e=(0,tn.cR)(a,{resize:{h:260,w:1e3,m:"lfit"}});n=Ta.createElement("img",{src:e})}return Ta.createElement("div",{key:a,className:"slick-item"},n)}))));return Ta.createElement(Ta.Fragment,null,n,Ta.createElement("div",{className:"gamePage_title"},e.getAttr("official-names")&&Ta.createElement("h2",null,e.getAttr("official-names")),Ta.createElement("h1",null,e.getAttr("title"))))}renderDevelopers(){const{game:e}=this.props;if("games"!==e.get("type"))return null;const t=e.getRel("involvements",null,(0,k.List)()).filter((e=>"developer"===e.getAttr("position")&&"organizations"===e.getRel("entity","type"))).map((e=>e.getRel("entity")));return 0===t.size?null:t.map((e=>Ta.createElement(dn.Z,{to:(0,Ir.ZP)(`${(0,z.Y_)(e.get("type"))}Originals`,{id:e.get("id"),tab:"games"}),className:"label",key:e.getKey()},e.getAttr("name"))))}renderInfoContainer(e){let{desc:t,descExtra:a=null,info:n=null}=e;return Ta.createElement("div",{className:"gamePage_body"},Ta.createElement("div",{className:"story_container"},Ta.createElement("div",{className:"gamePage_intro"},Ta.createElement("p",{className:"gamePage_desc"}," ",t," "),a),n))}renderInfo(){const{game:e}=this.props,t=(0,tn.yH)(e.getAttr("description")),a=e.getAttr("fulltext-description");if("games"!==e.get("type"))return this.renderInfoContainer({desc:t,info:this.renderTags()});const n=e.getAttr("average-play-time"),r=e.getAttr("booom-group-title");return this.renderInfoContainer({desc:t,descExtra:Ta.createElement(Ta.Fragment,null,n&&Ta.createElement("p",{className:"my-1"},"平均游戏时长：",n),r&&Ta.createElement("p",{className:"my-1"},"制作团队：",r)),info:Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"gamePage_fullDesc"},a&&Ta.createElement(Uc.Z,{content:a,editorKey:e.getKey()})),this.renderTags(),this.renderStaff(),this.renderPlatforms(),this.renderEditActions())})}renderTags(){const{game:e}=this.props,t=e.getSortedTags();return 0===t.size?null:Ta.createElement("div",{className:"mb-4"},this.renderDevelopers(),t.map((e=>Ta.createElement(dn.Z,{key:e.getKey(),to:(0,Ir.ZP)("tagOriginals",{id:e.get("id"),tab:"games"}),className:"label"},e.getTitle()))))}renderStaff(){const{game:e}=this.props,{staffModalVisible:t,staffMoreVisible:a}=this.state,n=Yc(e),r=(e=>Kc(e,((e,t,a)=>{const n=t.getAttr("title"),r=Jc(a,n),l=e.find((e=>e.position===n));return l?(l.users.push(r),e):(e.push({position:n,users:[r]}),e)})))(e);return 0===n.length?null:Ta.createElement(Ta.Fragment,null,Ta.createElement(_n.Z,{visible:t,title:"制作人员",contentLabel:"Modal",onCloseClick:()=>{this.setState({staffModalVisible:!1})},onConfirmClick:()=>{this.setState({staffModalVisible:!1})}},Ta.createElement(Ta.Fragment,null,r.map((e=>{let{position:t,users:a}=e;return Ta.createElement("dl",{key:t,className:"gamePage_staffModal"},Ta.createElement("dt",null,t),Ta.createElement("dd",null,a.map((e=>{let{id:t,model:a}=e;return Ta.createElement(dn.Z,{className:"gamePage_staffUser",key:t,to:(0,Ir.ZP)("user",{id:t})},Ta.createElement(cn.Z,{size:"lg",users:a}),Ta.createElement(Da.Z,{icon:["gfas","angle-right"]}))}))))})))),Ta.createElement("div",{className:"gamePage_section"},Ta.createElement("h3",{className:"mb-0"},"制作人员"),Ta.createElement("div",{className:"gamePage_staffWrapper"},a&&Ta.createElement(Ya.Z,{className:"gamePage_staff_more",plain:!0,onClick:()=>{this.setState({staffModalVisible:!0})}},Ta.createElement(Da.Z,{icon:["gfas","angle-right"]})),Ta.createElement("div",{className:"gamePage_staff",ref:this.staffRef},n.map((e=>{let{id:t,model:a,position:n}=e;return Ta.createElement(cn.Z,{to:(0,Ir.ZP)("user",{id:t}),size:"lg",nameLimit:6,vertical:!0,key:t,users:a,subText:n})}))))))}renderPlatforms(){const{stores:e}=this.props,t=e&&e.map((e=>{const t=this.renderStoreItem(e);return t&&Ta.createElement("li",{key:e.getKey()},t)})).filter((e=>!!e));return t&&t.size>0?Ta.createElement("div",{className:"gamePage_section"},Ta.createElement("h3",{className:"mb-0"},"发行平台与价格"),Ta.createElement("ul",{className:"gamePage_storeList o_stylelessList"},t)):null}renderEditActions(){const{game:e,currentUser:t}=this.props;return t&&e.getRel("user","id")===t.get("id")?Ta.createElement("div",{className:"gamePage_section text-end"},Ta.createElement(Ya.Z,{outline:!0,size:"sm",to:(0,Ir.ZP)("devCommunityGameEdit",{id:e.get("id")})},"申请编辑游戏信息")):null}renderStoreItem(e){return(0,ln.yq)(e.toJSFlat())?Ta.createElement(Bc.Z,{store:e}):null}handleWinResize=()=>{const e=this.staffRef.current;if(!e)return;const t=e.offsetWidth,a=e.scrollWidth;this.setState({staffMoreVisible:a-t>10})}}const ed=(0,sn.P1)(((e,t)=>({type:t.type,id:t.id})),sn.LF,((e,t)=>(0,ln.Jg)(e,t,{depth:3}))),td=(0,sn.P1)(ed,(e=>{if("games"!==e)return null;const t=e.getRel("game-stores");return t&&t.size>0?t:null})),ad=(0,sn.P1)((e=>e.getIn(["data","gamePage","originals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),nd=(0,sn.P1)((e=>e.getIn(["data","gamePage","talks","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),rd=(0,sn.P1)(ed,(e=>{var t,a,n,r;const l=((null===(t=e.getAttr("screenshots"))||void 0===t||null===(a=t.toJS)||void 0===a?void 0:a.call(t))||[]).map((e=>({type:"image",src:e}))),i=((null===(n=e.getAttr("trailers"))||void 0===n||null===(r=n.toJS)||void 0===r?void 0:r.call(n))||[]).map((e=>({type:"iframe",src:e.player}))),s=e.getAttr("cover"),o=s?[{type:"image",src:s}]:[];return[...i.length>0?i:o,...l]})),ld={dispatchSubscribe:N.MnA,dispatchToggleSignin:N.CcW,dispatchGetGamer:e=>(0,V.D1)(`users/${e}`)},id=(0,Ka.connect)(((e,t)=>{const a=ed(e,t),n=td(e,t),r=ad(e),l=nd(e),i=rd(e,t);return{currentUser:(0,sn.ib)(e),game:a,stores:n,talks:l,originals:r,screenshots:i,gamersSelector:t=>(0,ln.BY)(t.map((e=>({type:"users",id:e}))),(0,sn.LF)(e))}}),ld)(Qc),sd={...(0,ii.r3)("term"),async action(e){let{params:{0:t,1:a},store:n}=e;if(!["games","films"].includes(t))return{redirect:`/${t}/${a}/originals`};const[r]=await Promise.all([n.dispatch((0,l.ccU)({type:t,id:a},{include:["tags","user",..."games"===t?["game-stores","involvements.entity.user"]:[]],metaFields:{tags:[]}})),n.dispatch(Te.Z.actions.getOriginals(a,1))]);return{...(0,Ir.xE)(r,{imageKey:"cover"}),context:{navTransparent:!0,hideFooter:!0},component:Ta.createElement(id,{type:t,id:a})}}},od=e=>{var t;let{entry:a}=e;const n=(e=>{var t;return e.getAttr("cover")?e.getAttr("cover"):(null===(t=e.getAttr("screenshots"))||void 0===t?void 0:t.size)>0?e.getAttr("screenshots").first():null})(a);return Ta.createElement(dn.Z,{to:(0,Ir.ZP)(a),className:(0,Ma.Z)("entryCommonItem")},n&&Ta.createElement("img",{src:(0,tn.cR)(n,{resize:{w:150,m:"lfit"}})}),Ta.createElement("div",{className:"entryCommonItem_body"},Ta.createElement("h3",null,a.getAttr("title")),Ta.createElement("p",{className:"entryCommonItem_tags"},null===(t=a.getRel("tags"))||void 0===t?void 0:t.map((e=>Ta.createElement("span",{key:e.getKey()},e.getAttr("name"))))),Ta.createElement("p",{className:"entryCommonItem_release"},(0,rn.TZ)(a.getAttr("released-at")))))},cd=e=>Ta.createElement("div",{className:"row",key:"articles"},e.map((e=>Ta.createElement("div",{className:tn.d9,key:e.getKey()},Ta.createElement(si.Z,{original:e}))))),dd=e=>{let{tab:t,page:a,name:n,logo:r,desc:l,actions:i,getLink:s,pageState:o,originals:c}=e;return Ta.createElement(Ta.Fragment,null,Ta.createElement(ac,{withNav:!0,withBgCircle:!0,tabs:tn.hd.map((e=>({...e,to:s({tab:e.key,page:1})}))),background:"#222",active:t,actions:i,className:"categoryPage_header"},r?Ta.createElement("img",{className:"categoryPage_logo pageHeader_img",src:(0,tn.cR)(r,{resize:{m:"lfit",w:500}}),alt:n}):Ta.createElement("h1",{className:"h3 mb-3"},n),Ta.createElement("p",{className:"m-0"},l)),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:n},Ta.createElement(oi.Z,{data:c,page:a,isRequesting:o.get("isRequesting"),fetched:o.get("fetched"),allPage:o.get("allPage"),linkBuilder:e=>s({page:e,tab:t})},cd)))))},md=tn.hd,ud=e=>{const t=e.get(0).get("type");return["videos","radios","articles"].includes(t)?Ta.createElement("div",{className:"row",key:"originals"},e.map((e=>Ta.createElement("div",{className:tn.d9,key:e.getKey()},Ta.createElement(si.Z,{original:e}))))):"games"===t?Ta.createElement("ul",{className:"o_stylelessList"},e.map((e=>Ta.createElement("li",{key:e.getKey()},Ta.createElement(Bc.Z,{game:e,muteNoDiscount:!0}))))):"films"===t?Ta.createElement("div",{className:"row",key:"originals"},e.map((e=>Ta.createElement("div",{className:"col-md-6",key:e.getKey()},Ta.createElement(od,{entry:e}))))):null};class pd extends Xa.Z{tabs=md.map((e=>({...e,to:(0,Ir.ZP)(this.props.pathname,{tab:e.key,page:1})})));render(){const{tab:e,page:t,tag:a,dataState:n,data:r}=this.props;return"tags"===a.get("type")&&"29055"===a.get("id")?Ta.createElement(dd,{tab:e,page:t,name:a.getAttr("name"),logo:(0,tn.cR)("85f093c1-034b-4345-bb72-15c678ae67e0.jpg"),getLink:e=>{let{tab:t,page:n}=e;return(0,Ir.ZP)("tagOriginals",{id:a.get("id"),page:n,tab:t})},pageState:n,originals:r}):Ta.createElement(Ta.Fragment,null,this.renderHeader(),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"games"===e?"story_container":"container"},"games"!==e&&Ta.createElement(wn.Z,{tabs:this.tabs,active:e}),this.renderOriginals())))}renderOriginals(){const{data:e,dataState:t,page:a,pathname:n,tab:r}=this.props;return t?Ta.createElement(oi.Z,{data:e,isRequesting:t.get("isRequesting"),fetched:t.get("fetched"),hrefEnabled:!1,gcPageProps:{current:a,linkBuilder:e=>(0,Ir.ZP)(n,{tab:r,page:e})}},ud):null}renderHeader(){const{tag:e}=this.props;return Ta.createElement(ac,{withBgCircle:!0,white:!0},Ta.createElement("h1",null,e.getTitle()))}}const gd=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.getIn(["data","tagPage",`${t.tagType}${t.tagID||"all"}`,...a])},hd=(0,sn.P1)(((e,t)=>gd(e,t,["originals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),vd=(0,sn.P1)(((e,t)=>gd(e,t,["games","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Ed=(0,sn.P1)(((e,t)=>({type:t.tagType,id:t.tagID})),sn.LF,((e,t)=>(0,ln.Jg)(e,t))),fd=(0,Ka.connect)(((e,t)=>({data:"games"===t.tab?vd(e,t):hd(e,t),games:vd(e,t),tag:Ed(e,t),dataState:gd(e,t,["games"===t.tab?"games":"originals"])})))(pd),yd=Object.keys(r.qP).map((e=>[e,r.qP[e].id])),bd={...(0,ii.r3)("termOriginals"),async action(e){const{pathname:t,params:a,query:n,store:l}=e,{0:i,1:s}=a;if("tags"===i){const e=yd.findIndex((e=>e[1]===s));if(e>0)return{redirect:r.qP[yd[e][0]].path}}const{tab:o="originals",page:c}=n,d=(0,nn.CO)(c);if(d>r.Tc)return Ta.createElement(Dc.Z,null);const m=await ec(!1,l.dispatch,i,s,o,d,e);return{...(0,Ir.xE)(m,{imageKey:"cover",titleKey:"name",fromState:{store:l,type:i,id:s}}),preloadState:!0,..."29055"===s?{context:{navTransparent:!0}}:{},component:Ta.createElement(fd,{key:`${i}${s}`,pathname:t,page:d,tab:o,tagType:i,tagID:s})}}},kd={path:"",children:[sd,bd,...Mc]},Cd=Ta.memo((e=>{let{original:t,currentUser:a}=e;const n=(0,Ka.useDispatch)(),{prevPageName:r,pageName:l,sendPopMessage:i}=(0,Ua.EY)(),s=t.get("id"),o=t.get("type"),c=t.isTiming(),d=(0,yr.II)(t),m=(0,yr.II)(r);(0,Ta.useEffect)((()=>{c||((0,fe.MZ)(d.current,m.current),n(pa.actions.addItem({id:s,type:o,timestamp:Date.now()})))}),[n,s,o,c,m,d]);const u=(0,Ta.useCallback)((()=>{const e=`${(0,Ir.o0)((0,Ir.bv)(t.get("type"),t.get("id")))}?utm_campaign=official_account&utm_source=weibo&utm_medium=social`,a=`${t.getKey()}_copylink`;setTimeout((()=>{const e=document.getElementById(a);e&&(0,Tr.vQ)(e)}),400),i({body:Ta.createElement("span",{className:"text-break"},Ta.createElement("span",{key:"text"},"结果已复制到粘贴板，如果复制失败请手动复制链接："),Ta.createElement("a",{key:e,href:e,target:"_blank",rel:"noopener noreferrer",id:a},e))})}),[t,i]),p=e=>Ta.createElement(br.Z,{label:"内容页底部交互",openUrl:(0,Ir.ZP)(t)},e);return Ta.createElement("div",{className:"mt-5 d-flex justify-content-between"},Ta.createElement("div",{className:"text-nowrap d-flex gap-3"},p(Ta.createElement(gn.Z,{onlyUp:!0,upClassName:"me-3 originalButton",votable:t,source:l})),p(Ta.createElement(pn.Z,{className:"originalButton",bookmarkable:t}))),Ta.createElement("div",{className:"text-nowrap d-flex gap-3"},p(Ta.createElement(mn.Z,{data:t,className:"originalButton originalButton-circle"})),t.getRel("media")&&"radios"===t.get("type")&&t.isFree()&&!tr.default.audioBookLikeAlbumIds.includes(t.getRel("albums",[0,"id"]))&&p(Ta.createElement(Ya.Z,(0,Aa.Z)({plain:!0,className:"originalButton originalButton-circle"},a?{to:`${t.getRel("media").getSingleSrc()}?download=1`,download:`${t.get("id")}.mp3`,urlParser:!1}:{},{onClick:e=>{a||n((0,N.CcW)())}}),Ta.createElement(Da.Z,{icon:["gfas","download"]}))),a&&(t.getRel("user","id")===a.get("id")||a.isStaff())&&Ta.createElement(dn.Z,{className:"originalButton originalButton-circle",to:(0,Ir.hW)(t)},Ta.createElement(Da.Z,{icon:["gfas","edit"]})),a&&a.isStaff()&&Ta.createElement(Ta.Fragment,null,!t.isRadio()&&Ta.createElement(dn.Z,{className:"originalButton originalButton-circle",target:"_blank",to:`${w.default.console_url}/users/${t.getRel("user","id")}`},Ta.createElement(Da.Z,{icon:["gfas","user"]})),Ta.createElement(Ya.Z,{className:"originalButton originalButton-circle",onClick:u,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","link"]})))))})),_d=(0,Ka.connect)(((e,t)=>({currentUser:(0,sn.ib)(e)})))(Cd),wd=e=>{let{className:t,thumb:a,actionBtn:n,to:r,title:l,desc:i,subCount:s,hideDesc:o}=e;const c=i&&!o;return Ta.createElement("div",{className:(0,Ma.Z)("originalPage_addition",{"originalPage_addition-withoutDesc":!c},t)},Ta.createElement(dn.Z,{className:"originalPage_addition_l",to:r},a),Ta.createElement("div",{className:"originalPage_addition_main"},Ta.createElement("h5",null,Ta.createElement(dn.Z,{to:r},l)),(s>0||c)&&Ta.createElement("div",{className:(0,Ma.Z)("originalPage_addition_subText")},s>0&&Ta.createElement("p",{className:"originalPage_addition_subText_meta"},s," 人关注"),c&&Ta.createElement("p",{className:"originalPage_addition_desc"},i))),Ta.createElement("span",{className:"ms-2"},n))};wd.propTypes={to:Ga().string.isRequired,thumb:Ga().node.isRequired,actionBtn:Ga().node.isRequired,title:Ga().string.isRequired,subCount:Ga().number.isRequired,desc:Ga().string,hideDesc:Ga().bool,className:Ga().string},wd.defaultProps={className:void 0,hideDesc:!0,desc:null};const Nd=wd,Pd=e=>{let{user:t,...a}=e;return Ta.createElement(Nd,(0,Aa.Z)({},a,{to:(0,Ja.Z)("user",{id:t.get("id")}),actionBtn:Ta.createElement(qr.Z,{followee:t,type:"dark",ellipse:!0}),thumb:Ta.createElement(cn.Z,{users:t,block:!0,size:"size-article",onlyImage:!0}),title:t.getAttr("nickname"),desc:t.getAttr("location"),subCount:t.getAttr("followers-count")}))};Pd.propTypes={user:Va().record.isRequired};const Sd=Pd,Zd=e=>{let{category:t,cardStyle:a,...n}=e;return Ta.createElement(Nd,(0,Aa.Z)({},n,{className:(0,Ma.Z)("originalPage_addition-category",{"originalPage_addition-category-card":a}),to:(0,Ja.Z)("category",{id:t.get("id")}),actionBtn:Ta.createElement(Fc.Z,{subscribable:t,type:"dark"}),thumb:Ta.createElement("div",{className:"originalPage_addition-category_img"},Ta.createElement("div",{className:"categoryThumb",style:{background:t.getAttr("background-color")}},Ta.createElement("div",{className:"categoryThumb_inner"},Ta.createElement("img",{src:(0,tn.cR)(t.getAttr("logo"),{resize:{...a?{w:250,h:250}:{w:60,h:60},m:"lfit"}}),alt:t.getAttr("name")})))),title:t.getAttr("name"),desc:t.getAttr("desc"),subCount:t.getAttr("subscriptions-count")}))};Zd.propTypes={category:Va().record.isRequired,cardStyle:Ga().bool},Zd.defaultProps={cardStyle:!1};const Id=Zd,Td=e=>{let{album:t,...a}=e;return Ta.createElement(Nd,(0,Aa.Z)({},a,{to:(0,Ja.Z)("album",{id:t.get("id")}),actionBtn:t.isFree()?Ta.createElement(Fc.Z,{subscribable:t,type:"dark"}):Ta.createElement(Ya.Z,{type:"primary",ellipse:!0,to:(0,Ja.Z)("album",{id:t.get("id")})},"试听"),thumb:Ta.createElement(ns,{album:t}),title:t.getAttr("title"),desc:t.getAttr("description"),subCount:t.isFree()?t.getAttr("subscriptions-count"):0}))};Td.propTypes={album:Va().record.isRequired};const Ad=Td,Rd=e=>{let{albumBundle:t,...a}=e;return Ta.createElement(Nd,(0,Aa.Z)({},a,{to:(0,Ja.Z)("albumBundle",{id:t.get("id")}),actionBtn:Ta.createElement(Ya.Z,{type:"primary",ellipse:!0,to:(0,Ja.Z)("albumBundle",{id:t.get("id")})},"试听"),thumb:Ta.createElement(ns,{album:t}),title:t.getAttr("title"),desc:t.getAttr("description"),subCount:0}))},Dd=e=>{var t;const{original:a}=e,n=a.getRel("category"),r=a.get("type"),l=a.getRel("user"),i=a.getRel("albums"),s=("radios"===r||"videos"===r)&&i&&i.size>0&&i.first(),o=s&&(null===(t=s.getRel("album-bundles"))||void 0===t?void 0:t.first()),c=[];return s&&c.push(s),o&&c.push(o),"articles"===r&&l&&c.push(l),n&&c.push(n),0===c.length?null:Ta.createElement("div",{className:"originalPage_additions"},Ta.createElement("div",{className:"row"},c.slice(0,2).map((e=>((e,t)=>{const a=1===t.length,n=e.get("type");let r;return"users"===n?r=Ta.createElement(Sd,{user:e}):"categories"===n?r=Ta.createElement(Id,{category:e}):"albums"===n?r=Ta.createElement(Ad,{album:e}):"album-bundles"===n&&(r=Ta.createElement(Rd,{albumBundle:e})),Ta.createElement("div",{key:n,className:"col-sm-"+(a?12:6)},r)})(e,c)))))};Dd.propTypes={original:Va().record.isRequired};const xd=Dd;var Md=a(7384);const Ld=e=>{var t;const{original:a,showCategory:n}=e,r=(null===(t=a.getRel("djs"))||void 0===t?void 0:t.size)>0?a.getRel("djs").get(0):a.getRel("user");return Ta.createElement("div",{className:"originalPage_userInfo"},r&&Ta.createElement(Md.Z,{userID:r.get("id")},(e=>Ta.createElement(cn.Z,(0,Aa.Z)({users:r,size:"md",to:(0,Ja.Z)(r)},e),Ta.createElement("span",{className:"me-2"},r.getAttr("nickname"))))),Ta.createElement("span",{className:"me-2 u_color-gray-info",title:(0,rn.ab)(a.getAttr("published-at")),suppressHydrationWarning:!0},(0,rn.Sy)(a.getAttr("published-at"))),n&&a.getRel("category")&&Ta.createElement("span",null,Ta.createElement("span",{className:"me-1"},"发布于"),Ta.createElement(Ls.Z,{categoryID:a.getRel("category","id")},(e=>Ta.createElement(dn.Z,(0,Aa.Z)({className:"u_color-category",to:(0,Ja.Z)("category",{id:a.getRel("category","id")})},e),a.getRelAttr("category","name"))))))};Ld.propTypes={original:Va().record.isRequired,showCategory:Ga().bool},Ld.defaultProps={showCategory:!0};const qd=Ld,Fd=e=>262*e+17*(e-1)+75,Bd=4,Od=e=>{let{original:t}=e;const a=(0,Ta.useMemo)((()=>(e=>{let t=e.getRel("similarities");if(!(t&&t.size>0))return null;let a=e.getRel("collections");const n=a?Math.min(Bd,a.size):0;a=a&&a.slice(0,n),t=t.slice(0,a?Bd-n:Bd);const r=t.size;return{similarities:t,collections:a,colsCount:a?r+n:r}})(t)),[t]);if((0,yr.tr)(".originalPage_bottomSlider .collectionEntry",".originalPage_bottomSlider .original"),(0,yr.tr)(".originalPage_bottomSlider .albumEntry",".originalPage_bottomSlider .original"),!a)return null;const{similarities:n,collections:r}=a;return Ta.createElement("div",{className:"originalPage_bottomSlider"},Ta.createElement(vi.Z,{slidesToShow:4,slidesToShowResponsive:[{breakpoint:Fd(4),settings:3},{breakpoint:Fd(3),settings:2},{breakpoint:Fd(2),settings:1}]},r&&r.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(br.Z,{label:"内容页底推荐专题",openUrl:(0,Ir.ZP)(t)},Ta.createElement(os,{tip:"所属专题",collection:e}))))),n.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(br.Z,{label:"内容页底推荐内容",openUrl:(0,Ir.ZP)(t)},Ta.createElement(si.Z,{original:e})))))))};Od.propTypes={original:Va().record.isRequired};const Ud=Od,$d=(0,Ka.connect)(((e,t)=>({currentUser:(0,sn.ib)(e)})))((e=>{let{original:t,currentUser:a}=e;const n=null==a?void 0:a.isStaff(),r=(0,Ta.useMemo)((()=>{const e=!t.isTiming()&&!t.getAttr("is-comment-hidden");return n||e?Ta.createElement("div",{className:"originalPage_comments"},Ta.createElement(Nn.Z,{count:t.getAttr("comments-count"),commentable:t,authorID:t.getRel("user","id"),djIDs:t.getRel("djs",void 0,(0,k.List)()).map((e=>e.get("id"))).toJS(),infinitLoad:{bottomOffset:800},instantLoad:!1})):Ta.createElement(Dc.Z,{title:"",desc:"该内容暂时无法评论"})}),[n,t]);return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"originalPage_bottom"},Ta.createElement(Ud,{original:t})),r)}));var Gd=a(3024),zd=a(49986),Hd=a(50546),Vd=a(94823),Wd=a(53275);const jd=e=>{const t=q()("audioPlayed")||{};return e?t[e]:t},Kd=(e,t)=>{const a=jd();t>0?a[e]=t:delete a[e],q()("audioPlayed",a)},Jd=(e,t)=>{e&&e.current&&e.current.seekTo(t)},Yd=(0,Ka.connect)()((e=>{let{url:t,dispatch:a}=e;const n=/^http/.test(t)?t:(0,Wd.wf)(t),r=(0,Ta.useRef)(null),[l,i]=(0,Ta.useState)(!1),[s,o]=(0,Ta.useState)(0),[c,d]=(0,Ta.useState)(!1),[m,u]=(0,Ta.useState)(0),[p,g]=(0,Ta.useState)(!1),[h,v]=(0,Ta.useState)(0);if((0,Ta.useEffect)((()=>{i(!0),en.Z.ready((()=>{if(r.current){const e=r.current.getInternalPlayer();"function"==typeof e.load&&e.load()}}))}),[]),!l)return null;const E=_().get(w.default.cookie_keys.volume),f=E?Number(E):1;return Ta.createElement(Ta.Fragment,null,Ta.createElement(ja(),{ref:r,url:n,playing:c,style:{display:"none"},config:{file:{forceAudio:!0,attributes:{preload:"metadata"}}},onProgress:e=>{const{played:t,playedSeconds:a}=e;v(a),u(t),t>0&&Kd(n,t)},onDuration:e=>{const t=jd(n);t&&Jd(r,t),o(e)},volume:f,onEnded:()=>{g(!1),d(!1),Jd(r,0),Kd(n,0),a((0,N.tRK)())}}),Ta.createElement("div",{className:"simplePlayer"},Ta.createElement("div",{className:"simplePlayer_progress",style:{width:100*m+"%"}}),Ta.createElement("div",{className:"simplePlayer_content"},Ta.createElement("span",{className:"simplePlayer_content_control"},Ta.createElement(Ya.Z,{onClick:()=>{p||a((0,N.yD9)()),d(!c),g(!0)},plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas",c?"pause":"play"]})),Ta.createElement("span",null,((e,t)=>e?"正在收听":t?"继续收听":"收听本文")(c,m),Ta.createElement("span",{className:"ms-2"},(0,rn.dB)(p?h:s)))),Ta.createElement(Ya.Z,{className:"u_color-gray-icon",onClick:()=>{r&&r.current&&r.current.seekTo(0),d(!0),a((0,N.yD9)())},plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","replay"]})))))})),Xd=()=>{Xn.ZP.scroller.scrollTo("comments",{smooth:!0,duration:800})},Qd=Ta.memo((e=>{let{original:t,className:a}=e;const{pageName:n}=(0,Ua.EY)();return Ta.createElement("div",{className:(0,Ma.Z)("articlePage_info",a)},Ta.createElement(gn.Z,{onlyUp:!0,hideCount:!0,upClassName:"mb-3 originalButton originalButton-circle",votable:t,source:n}),Ta.createElement(pn.Z,{className:"mb-3 originalButton originalButton-circle",bookmarkable:t,hideCount:!0}),Ta.createElement(mn.Z,{data:t,className:"mb-3 originalButton originalButton-circle"}),Ta.createElement(Ya.Z,{className:"mb-3 originalButton originalButton-circle",onClick:Xd,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","comment"]})))})),em=Qd;var tm=a(22134);const am=["games","films"],nm=(e,t)=>e.getRel("entries",null,(0,k.List)()).filter(t),rm=e=>{let{original:t,currentUser:a,dispatch:n,...r}=e;const l=(e=>nm(e,(e=>am.includes(e.get("type")))))(t),i=t.getRel([["portfolios",0]]);return Ta.createElement("div",{className:"originalPage_btmTags"},i&&Ta.createElement(tm.Z,{item:i}),l.size>0&&Ta.createElement("div",{className:"row"},l.map((e=>Ta.createElement("div",{key:e.getKey(),className:1===l.size?"col-12":"col-sm-6"},Ta.createElement(tm.Z,{item:e}))))),Ta.createElement("div",(0,Aa.Z)({className:(0,Ma.Z)("originalPage_labels",{is_staff:a&&a.isStaff()})},r),t.getRel("tags",null,(0,k.List)()).concat((e=>nm(e,(e=>!am.includes(e.get("type")))))(t)).concat(t.getRel("entities",null,(0,k.List)())).filter((e=>!tr.default.tagNamesHidden.includes(e.getAttr("name")))).map((e=>Ta.createElement(dn.Z,{key:e.getKey(),to:(0,Ir.ZP)("term",{type:e.get("type"),id:e.get("id")}),className:`label is_${(0,z.lt)(e.get("type"))}`},e.getTitle())))))};rm.propTypes={original:Va().record.isRequired,currentUser:Va().record,dispatch:Ga().func.isRequired},rm.defaultProps={currentUser:null};const lm=(0,Ka.connect)((e=>({currentUser:(0,sn.ib)(e)})))(rm);var im=a(47042);const sm=e=>{var t;let{original:a,events:n,session:r,className:l,withSticky:i=!0}=e;const s=null===(t=(0,sn.xJ)())||void 0===t?void 0:t.get("id"),o=(0,Ka.useDispatch)(),c=(0,Ta.useRef)(!1),[d,m]=(0,Ta.useState)(!1),u=a.getAttr("content"),p=i&&d,g=(0,yr.MB)(),h=(0,Ta.useMemo)((()=>d?(0,Hd._K)(u,(e=>{let{blocks:t,anchorItems:a,currentClassName:n}=e;return Ta.createElement(zd.Z,{items:a,currentClassName:n},t.map(((e,t)=>{let{key:n,text:r}=e;return Ta.createElement("li",{key:n},Ta.createElement("a",{href:`#${a[t]}`},Ta.createElement("span",null,r)))})))})):null),[d,u]);return(0,Ta.useEffect)((()=>{m(!0)}),[]),(0,Ta.useEffect)((()=>{if(s)return;const e=()=>{if(c.current)return;const e=document.body.clientHeight/window.innerHeight;e>6&&window.scrollY>e/2*window.innerHeight&&(o((0,N.CcW)(!0,{tip:"登录以查看更多内容"})),c.current=!0)};return window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[s,o]),(0,Ta.useEffect)((()=>{const e=(0,nn.XW)();if(e&&e.hash){const t=e.hash.slice(1);setTimeout((()=>{var e;null===(e=document.getElementById(t))||void 0===e||e.scrollIntoView()}),1e3)}}),[]),Ta.createElement("div",{className:(0,Ma.Z)("articlePage_content",l)},Ta.createElement("div",{className:(0,Ma.Z)("story_container","story_enableImagePos")},(null==n?void 0:n.size)>0&&Ta.createElement(Vd.Z,{event:n.get(0)}),a.getAttr("speech-path")&&Ta.createElement("div",{className:"mt-4"},Ta.createElement(Yd,{url:a.getAttr("speech-path")})),a.getAttr("work-is-protected")&&Ta.createElement(im.Z,{inline:!0,className:"mt-3"}),Ta.createElement(Uc.Z,{content:u,original:a}),Ta.createElement(lm,{original:a})),p&&Ta.createElement("div",{className:"articlePage_infoContainer",id:g("info")},Ta.createElement(Gd.Z,{bottomBoundary:`#${g("info")}`},(e=>{let{status:t}=e;return Ta.createElement(em,{original:a,className:t===Gd.Z.STATUS_FIXED?"articlePage_info-fixed":void 0})}))),h&&Ta.createElement("div",{className:"articlePage_index",id:g("index")},Ta.createElement(Gd.Z,{bottomBoundary:`#${g("index")}`},(e=>{let{status:t}=e;return Ta.createElement("div",{className:(0,Ma.Z)("articlePage_index_inner",{"articlePage_index_inner-fixed":t===Gd.Z.STATUS_FIXED})},h)}))))};sm.defaultProps={className:void 0,withSticky:!0};const om=(0,sn.P1)(((e,t)=>{var a;let{original:n}=t;return null===(a=n.getRel("operational-events"))||void 0===a?void 0:a.map((e=>e.get("id")))}),sn.LF,((e,t)=>(0,ln.b$)(e,"operational-events",t))),cm=(0,Ka.connect)(((e,t)=>({events:om(e,t)})))(sm),dm=e=>{let{original:t}=e;return Ta.createElement("div",{className:(0,Ma.Z)("originalPage_titleGroup",{"originalPage_titleGroup-center":t.isVolume()&&!t.isVideoNews()})},Ta.createElement("h1",{className:"originalPage_title"},t.getAttr("title")),Ta.createElement("p",{className:"originalPage_desc"},t.getAttr("desc")))};dm.propTypes={original:Va().record.isRequired};const mm=dm,um=e=>{let{original:t,className:a}=e;return t.getAttr("option-is-official")||t.getAttr("is-official")?null:Ta.createElement("div",{className:(0,Ma.Z)("u_coloe-gray-desc small mt-5",a)},"本文系用户投稿，不代表机核网观点")},pm=e=>{let{original:t}=e;const a=t.getAttr("content"),n=t.getRelAttr("audit-draft","content"),r=t.getRelAttr("draft","content");return Ta.createElement(Ta.Fragment,null,a&&Ta.createElement(gm,{title:"复制线上内容",content:a}),n&&n!==a&&Ta.createElement(gm,{title:"复制待审内容",content:n,hasDiff:!0}),r&&r!==a&&Ta.createElement(gm,{title:"复制最新内容",content:r,hasDiff:!0}))},gm=e=>{let{content:t,title:a,hasDiff:n=!1}=e;return Ta.createElement(Ya.Z,{size:"sm",type:n?"primary":"secondary",onClick:()=>{const e=JSON.stringify(JSON.parse(t),null,4);(0,Sl.vQ)(e)}},a)},hm=Ta.memo((e=>{let{preview:t,original:a,currentUser:n}=e;const r=(0,Ta.useMemo)((()=>{if(a&&null!=n&&n.isStaff()){const{isLegal:e,text:t}=a.getPublishStatus();if(!e)return t}return""}),[a,n]),[l,i]=(0,Ta.useMemo)((()=>{if(t){if(/^draft/.test(t))return["预览","highlight"];if(/^audit-draft/.test(t))return["审核","warning"]}return["","info"]}),[t]);return l||r?Ta.createElement("div",{className:`alert alert-${i} rounded-0 text-center d-flex gap-2 align-items-center justify-content-center`},l&&Ta.createElement("span",null,"内容状态: ",l),r&&Ta.createElement("span",null,"文章状态: ",r),(null==n?void 0:n.isStaff())&&Ta.createElement(pm,{original:a})):null})),vm=(0,Ka.connect)((e=>({currentUser:(0,sn.ib)(e)})))(hm);var Em=a(6592),fm=a(20525),ym=a(29012);const bm="不同比例头图会有相应的布局效果";class km extends Ta.PureComponent{constructor(e){super(e),this.state={headerStyle:void 0,showImage:!1,isRequesting:!1}}componentDidMount(){this.setState({showImage:!0})}handleImageChange=e=>{const{dispatch:t,onImageChange:a}=this.props,[n]=e.target.files;if(!n)return;const r=(0,Em.ox)(n);r.errors?alert(r.errorsStr):(this.setState({isRequesting:!0}),t((0,N.mh_)(n)).then((e=>{if(this.setState({isRequesting:!1}),e.error)alert(e.error);else{const t=e.payload.origin.path;a&&a(t)}})))};handleCoverLoad=e=>{const t=e.target,a=t.clientHeight/t.clientWidth;let n="normal";a>=.5?n="row":a>.25&&(n="center"),this.setState({headerStyle:n})};handleCoverError=()=>{this.setState({headerStyle:"error"})};renderCover(){const{image:e,editable:t,censorImages:a}=this.props,{showImage:n}=this.state;let r;return e&&n?r=Ta.createElement(Ta.Fragment,null,Ta.createElement("img",{alt:"封面图",key:e,src:(0,tn.cR)(e,{resize:{m:"lfit",w:2e3,h:2e3}}),onLoad:this.handleCoverLoad,onError:this.handleCoverError}),t&&Ta.createElement("div",{className:"originalEditor_imageAction form_fileBlock"},Ta.createElement("input",{title:bm,type:"file",onChange:this.handleImageChange}),Ta.createElement(Da.Z,{icon:["gfas","replace"]}))):t&&(r=Ta.createElement("div",{className:"originalEditor_widget originalEditor_widget-image form_fileBlock"},Ta.createElement("input",{title:bm,type:"file",onChange:this.handleImageChange}),Ta.createElement(Ya.Z,{className:"originalEditor_widget_btn",anchor:!0,plain:!0},"上传文章头图"),Ta.createElement("p",{className:"mb-0 mt-3"},bm))),Ta.createElement(ym.Z,{labels:null==a?void 0:a.includes(e),className:(0,Ma.Z)("articlePage_header_image",{originalEditor_articleHeader_image:t}),withLabel:!0},r)}render(){const{children:e,image:t,editable:a}=this.props,{headerStyle:n,isRequesting:r}=this.state,l=!(t&&void 0===n);return Ta.createElement(fm.Z,{loading:r},Ta.createElement("div",{className:(0,Ma.Z)("articlePage_header",{originalEditor_articleHeader:a,"articlePage_header-row":"row"===n,"articlePage_header-center":"center"===n,"articlePage_header-placeholder":!l,"articlePage_header-error":"error"===n})},this.renderCover(),Ta.createElement("div",{className:(0,Ma.Z)("articlePage_header_content")},l?e:Ta.createElement("div",{className:"d-none"},e))))}}km.propTypes={image:Ga().string,editable:Ga().bool,children:Ga().node.isRequired,onImageChange:Ga().func,dispatch:Ga().func,censorImages:Ga().array},km.defaultProps={image:void 0,editable:!1,onImageChange:void 0,dispatch:void 0,censorImages:void 0};const Cm=km,_m=e=>{let{category:t}=e;return Ta.createElement("div",{className:"originalPage_category"},Ta.createElement(Ls.Z,{categoryID:t.get("id")},(e=>Ta.createElement(dn.Z,(0,Aa.Z)({to:(0,Ja.Z)("category",{id:t.get("id")})},e),t.getAttr("name")))))},wm=(0,sn.P1)(((e,t)=>t.articleID),((e,t)=>t.preview),sn.LF,((e,t,a)=>(0,ln.tK)(e,"articles",a,{originalPreview:t,depth:3}))),Nm=(0,sn.P1)(((e,t)=>t.articleID),sn.LF,((e,t)=>(0,ln.tK)(e,"articles",t))),Pm=(0,Ka.connect)(((e,t)=>({article:wm(e,t),originalArticle:Nm(e,t),session:e.get("session")})))((e=>{let{article:t,originalArticle:a,session:n,preview:r}=e;return Ta.createElement("div",{className:"articlePage"},Ta.createElement(vm,{preview:r,original:a}),Ta.createElement(Cm,{image:t.getImage()},Ta.createElement("div",{className:"articlePage_header_content_inner story_container"},t.getRel("category")&&Ta.createElement(_m,{category:t.getRel("category")}),Ta.createElement(mm,{original:t}),Ta.createElement(qd,{original:t,showCategory:!1}))),Ta.createElement("div",{className:"articlePage_body"},Ta.createElement(um,{className:"story_container",original:t}),Ta.createElement(cm,{original:t,session:n}),Ta.createElement("div",{className:"story_container"},Ta.createElement(_d,{original:t}),Ta.createElement(xd,{original:t}))),Ta.createElement($d,{original:t}))}));var Sm=a(6974),Zm=a(29173);const Im=(0,$c.P1)((e=>e.getIn(["data","hotOriginals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t).sort(((e,t)=>(0,rn.u3)(t.getAttr("published-at"))-(0,rn.u3)(e.getAttr("published-at")))))),Tm={dispatchGetHotOriginals:l.iLj},Am=(0,Ka.connect)(((e,t)=>{var a;return{originals:null===(a=Im(e))||void 0===a?void 0:a.slice(0,t.limit??20)}}),Tm)((e=>{let{className:t,sectionTitle:a="文章精选",originals:n,dispatchGetHotOriginals:r,onlyTitle:l=!1,more:i=!1}=e;return(0,Ta.useEffect)((()=>{0===n.size&&r()}),[n.size,r]),Ta.createElement(Zm.Z,{title:a,className:t},Ta.createElement(Sm.Z,{originals:i?n:n.slice(0,5),onlyTitle:l}))})),Rm=(0,$c.P1)((e=>e.getIn(["data","hotNewsList","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t).sort(((e,t)=>(0,rn.u3)(t.getAttr("published-at"))-(0,rn.u3)(e.getAttr("published-at")))))),Dm={dispatchGetHotNewsList:l.RUF},xm=(0,Ka.connect)(((e,t)=>{var a;return{originals:null===(a=Rm(e))||void 0===a?void 0:a.slice(0,t.limit??10)}}),Dm)((e=>{let{className:t,sectionTitle:a="最热资讯",originals:n,dispatchGetHotNewsList:r,onlyTitle:l=!1}=e;return(0,Ta.useEffect)((()=>{0===n.size&&r()}),[n.size,r]),Ta.createElement(Zm.Z,{title:a,className:t},Ta.createElement(Sm.Z,{originals:n,onlyTitle:l}))}));class Mm extends Xa.Z{constructor(e){super(e),this.state={showMoreHotOriginals:!1}}renderNewsHeader(){const{news:e}=this.props,t=e.getImage();let a=null;return"videos"===e.get("type")?a=Ta.createElement(Uo,{video:e}):t&&(a=Ta.createElement("img",{className:"newsPage_cover",src:(0,tn.cR)(e.getImage(),{resize:{m:"lfit",w:800}}),alt:e.getAttr("title")})),Ta.createElement(Ta.Fragment,null,a&&Ta.createElement("div",{className:"mb-5"},a),Ta.createElement(mm,{original:e}),Ta.createElement(qd,{original:e}))}componentDidMount(){var e;(null===(e=document.querySelector(".newsPage_content"))||void 0===e?void 0:e.offsetHeight)>2500&&this.setState({showMoreHotOriginals:!0})}render(){const{showMoreHotOriginals:e}=this.state,{news:t,originalNews:a,session:n,preview:r,events:l}=this.props;return Ta.createElement("div",{className:"newsPage"},Ta.createElement(vm,{preview:r,original:a}),Ta.createElement("div",{className:"container"},Ta.createElement("div",{className:"newsPage_main"},Ta.createElement("div",{className:"newsPage_inner"},Ta.createElement("div",{className:"newsPage_content"},this.renderNewsHeader(),Ta.createElement(um,{original:t}),Ta.createElement("div",{className:"newsPage_story"},Ta.createElement("div",{className:"newsPage_info",id:"newsPage_info"},Ta.createElement(Gd.Z,{top:80,bottomBoundary:"#newsPage_info"},(e=>{let{status:a}=e;return Ta.createElement(em,{className:(0,Ma.Z)({"articlePage_info-fixed":a===Gd.Z.STATUS_FIXED}),original:t,session:n})}))),Ta.createElement("div",{className:"newsPage_news"},l&&l.size>0&&Ta.createElement(Vd.Z,{event:l.get(0)}),t.getAttr("speech-path")&&Ta.createElement("div",{className:"mt-4"},Ta.createElement(Yd,{url:t.getAttr("speech-path")})),Ta.createElement(Uc.Z,{content:t.getAttr("content"),original:t}),Ta.createElement(lm,{original:t}),Ta.createElement(_d,{original:t})))),Ta.createElement("div",{className:"newsPage_r"},Ta.createElement(xm,{className:"am_card-bg"}),Ta.createElement(Am,{className:"am_card-bg",more:e}))))),Ta.createElement($d,{original:t}))}}Mm.propTypes={videoMode:Ga().bool,news:Va().record.isRequired,hotOriginals:Va().list,session:Va().map.isRequired},Mm.defaultProps={videoMode:!1,hotOriginals:void 0};const Lm=(0,sn.P1)(((e,t)=>t.newsID),((e,t)=>t.preview),((e,t)=>t.videoMode),sn.LF,((e,t,a,n)=>(0,ln.tK)(e,a?"videos":"articles",n,{originalPreview:t,depth:3}))),qm=(0,sn.P1)(((e,t)=>t.newsID),((e,t)=>t.videoMode),sn.LF,((e,t,a)=>(0,ln.tK)(e,t?"videos":"articles",a))),Fm=(0,sn.P1)((0,sn.P1)(Lm,(e=>e.getIn(["relationships","operational-events","data"]))),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Bm=(0,Ka.connect)(((e,t)=>{const a=Lm(e,t),n=qm(e,t),r=Fm(e,t);return{news:a,originalNews:n,session:e.get("session"),events:r}}))(Mm),Om={path:"/articles",children:[{...(0,ii.r3)("articles"),async action(e){const{store:t,isPathnameChangedNotBrowserFirst:a}=e,n=await Hi("articles",e);return a&&await t.dispatch((0,l.dId)()),n}},{...(0,ii.r3)("article"),async action(e){let{store:t,params:{id:a},query:{preview:n,token:r,"sentry-error":i},getCurrentUser:s}=e;if("sentry-test"===a)throw new Error(i||"sentry test");const o=(0,Ir.oD)(n),c=await t.dispatch((0,l.k3z)({type:"articles",id:a,token:r},{includeQueryPush:o.needInclude})),d=(0,Ir.xE)(c);if(a!==c.payload.data.id){const e=new Error("目标文章不匹配");throw e.status=403,e}let m;const u=c.payload.data.relationships.category;return m=u.data&&u.data.id===tr.default.category.NEWS?Ta.createElement(Bm,{newsID:a,preview:o.draft}):Ta.createElement(Pm,{articleID:a,preview:o.draft}),t.dispatch(pa.actions.addItem({id:a,type:"articles",timestamp:Date.now()})),{...d,htmlClassNames:["lightBg"],component:m}}}]},Um=e=>{let{error:t,cover:a,title:n,desc:r,actions:l,tabs:i,tabsProps:s,extraSections:o,children:c}=e;const[d,m]=(0,Ta.useState)(i[0].key);return t?Ta.createElement("div",{className:"albumDetail_error"},t):Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"albumDetail_header"},Ta.createElement("div",{className:"albumDetail_img"},a),Ta.createElement("div",{className:"albumDetail_content"},Ta.createElement("div",null,Ta.createElement("h1",{className:"u_fontSize-h3 mb-3"},n),Ta.createElement("p",{className:"u_color-gray-info"},r)),Ta.createElement("div",{className:"albumDetail_actions"},l))),o&&o.map((e=>Ta.createElement("div",{key:e.title,className:"albumDetail_section"},Ta.createElement("h3",null,e.title),Ta.createElement("div",null,e.body)))),Ta.createElement(wn.Z,(0,Aa.Z)({className:"albumDetail_tabs",compact:!0,tabs:i,active:d,hrefEnabled:!1,onTabChange:e=>{m(e)}},s)),Ta.createElement("div",{className:"albumDetail_body"},c(d)))},$m=e=>{let{modalProps:t,...a}=e;const{backgroundImage:n,onCloseClick:r}=a;return Ta.createElement(_n.Z,(0,Aa.Z)({width:846,visible:!0,onCloseClick:r,hideActionBtns:!0,className:"albumDetail",style:{overlay:n?{backgroundImage:`url(${(0,tn.cR)(n,tn.iT.Blur)})`}:void 0}},t),Ta.createElement(Um,a))},Gm=e=>{const{album:t,onAddClick:a}=e,n=Ta.createElement(qs,{bg:(0,tn.cR)(t.getAttr("cover"),{resize:{w:180,h:180}}),onAddClick:a});return t.getAttr("is-free")?n:Ta.createElement(wi,{album:t},n)},zm=[{key:"radios",title:"节目"},{key:"intro",title:"简介"},{key:"wallpapers",title:"壁纸"}];var Hm=a(45236),Vm=a(73377),Wm=a(6820),jm=a(97108),Km=a(44956);const Jm=(0,Ka.connect)(((e,t)=>({isPurchased:e.getIn(["pay","purchasedHistory",me.Uo.Sku,t.sku.get("id")]),amount:e.getIn(["pay","skuHistory",t.sku.get("id"),"amount"])||t.sku.getAttr("amount"),currentUser:(0,sn.ib)(e)})),(e=>({dispatchCheckOrderStatus:t=>e((0,Wm.HL)(t)),dispatchCheckPurchase:t=>e((0,l.OXT)({purchasableType:me.Uo.Sku,purchasableId:t})),dispatchWechatAccessToken:t=>e((0,V.D1)("tokens/wechat-access-token",{method:"POST",body:{data:{code:t}}})),dispatchWechatPlaceOrderFromJsBridge:(t,a)=>e((0,Wm._g)(t,a)),dispatchSendMessage:t=>e((0,l.bG5)(t)),dispatchWechatPlaceOrderFromDesktopWeb:t=>e((0,Wm.Ud)(t)),dispatchAlipayPlaceOrderFromDesktopWeb:function(){return e((0,Wm.Nn)(...arguments))},dispatchAlipayPlaceOrderFromMobileWeb:function(){return e((0,Wm.ZD)(...arguments))},dispatchPurchaseWithGcoins:function(){return e((0,Wm.uV)(...arguments))}})))((e=>{let{currentUser:t,amount:a,sku:n,product:r,wechatPayUrl:i,alipayUrl:s,dispatchSendMessage:o,dispatchCheckOrderStatus:c,dispatchCheckPurchase:d,dispatchWechatAccessToken:m,dispatchWechatPlaceOrderFromJsBridge:u,dispatchWechatPlaceOrderFromDesktopWeb:p,dispatchAlipayPlaceOrderFromDesktopWeb:g,dispatchAlipayPlaceOrderFromMobileWeb:h,dispatchPurchaseWithGcoins:v,children:E,isPurchased:f,onCompletePay:y,onBeforePay:b,originalAmount:k=(null==n?void 0:n.getAttr("amount")),displayDiscount:C=!0,containerClassName:_,...N}=e;const P=null==n?void 0:n.get("id"),S=(0,Ua.EY)(),[Z,I]=(0,Ta.useState)(!0),[T,A]=(0,Ta.useState)(!1),[R,D]=(0,Ta.useState)(!1),[x,M]=(0,Ta.useState)(null),[L,q]=(0,Ta.useState)(null);(0,Ta.useEffect)((()=>{const e=(0,nn.XW)();if(!e)return;const t=e.query.code,a=e.query.sku_id;"string"==typeof t&&a===n.get("id")&&(z(t),Qa.ZP.replace(e.pathname))}),[]),(0,Ta.useEffect)((()=>{const e=(0,nn.XW)();if(!e)return;const t=e.query.method,a=e.query.sku_id,r=e.query.order_id;t&&/alipay/.test(t)&&a===n.get("id")&&(Qa.ZP.replace(e.pathname),G(r,"alipay_mobile"))}),[]),(0,Ta.useEffect)((()=>{P&&d(P)}),[P,d]),(0,Ta.useEffect)((()=>{let e;return Z||(e=setTimeout((()=>{I(!0)}),9e5)),()=>{clearTimeout(e)}}),[Z]);const F={skuId:n.get("id"),amount:a,source:S.pageName,isGift:"redeem_code"===n.getAttr("delivery-type")},B=e=>({...F,purchaseType:e}),O=(e,t)=>{const a=(e=>({...F,purchaseType:e,productId:"skus"!==r.get("type")?r.get("id"):"",title:r.getTitle()}))(t);"request"===e?"albums"===r.get("type")?(0,fe.HW)(a):"album-bundles"===r.get("type")?(0,fe.t9)(a):n.aboutGpass()&&(0,fe.Yd)(B(t)):"albums"===r.get("type")?(0,fe.V5)(a):"album-bundles"===r.get("type")?(0,fe.ku)(a):n.aboutGpass()&&(0,fe.eX)(B(t))},U=(e,t)=>{e?G(e,t).then((e=>{e&&(A(!1),D(!1))})):(y(!1,null),o({body:"购买失败，请重试"}))},$=e=>{let{type:t,needCheck:a=!0,order:r}=e;o({body:"购买成功",type:l.ZQC.SUCCESS}),a&&d(n.get("id")),O("finish",t),(0,Vm.v)("464895","shopping"),y(!0,r)},G=(e,t,a)=>c(e).then((e=>{let[n,r]=e;return n?$({type:t,order:r,...a}):(y(!1,r),o({body:"购买失败，请重试"})),n})),z=async e=>{var t,a;const r=await m(e),l=null==r||null===(t=r.payload)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.openid;if(!l)return void alert("微信支付加载失败");const i=await u(n.get("id"),l);if(!i)return;const s=()=>{const{invokeArgs:e,orderId:t}=i;window.WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},(e=>{"get_brand_wcpay_request:ok"===e.err_msg?G(t,"wechat_jsapi"):o({body:"支付失败"})}))};void 0!==window.WeixinJSBridge?s():document.addEventListener("WeixinJSBridgeReady",s,!1)},H=()=>{A(!0),M(null),I(!1),p(n.get("id")).then((e=>{M(e||!1)}))},V=()=>{if(b&&!1===b())return;const{env:{isWXBrowser:e,isMobile:t}}=S;O("request",e?"wechat_jsapi":"wechat"),e?window.location.href=i:t&&confirm("如您使用的是移动设备，可下载App后进行购买，是否前往下载？")?((0,Vm.v)("464888","other"),setTimeout((()=>{window.location.href=w.default.app_download_url}),1e3)):H()},W=()=>{if(b&&!1===b())return;const{env:{isWXBrowser:e,isMobile:t}}=S;e&&confirm("如您使用的是移动设备，可下载App后进行购买，是否前往下载？")?setTimeout((()=>{window.location.href=w.default.app_download_url}),1e3):(t?(O("request","alipay_mobile"),h(n.get("id"),s).then((e=>{e&&(location.href=e.url)}))):(O("request","alipay"),g(n.get("id"),s).then((e=>{q(e||!1),e&&window.open(e.url)}))),D(!0))},j=e=>"function"==typeof E?E(a):E||e,K=Ta.createElement(_n.Z,{title:"支付宝支付",visible:R,onCloseClick:()=>{D(!1)},actions:Ta.createElement(Ta.Fragment,null,Ta.createElement(Ya.Z,{type:"secondary",size:"lg",onClick:()=>{D(!1)}},"取消"),Ta.createElement(Ya.Z,{type:"pay",size:"lg",onClick:()=>{U(L&&L.orderId,"alipay")}},"已完成支付"))},L?"请您在新打开的页面完成支付":!1===L?"创建订单失败":"订单创建中..."),J=Ta.createElement(_n.Z,{title:"微信支付",visible:T,onCloseClick:()=>{A(!1)},actions:Ta.createElement(Ta.Fragment,null,Ta.createElement(Ya.Z,{type:"secondary",size:"lg",onClick:()=>{A(!1)}},"取消"),Ta.createElement(Ya.Z,{type:"pay",size:"lg",onClick:()=>{U(x&&x.orderId,"wechat")}},"已完成支付"))},Ta.createElement("div",{className:"payModal row"},Ta.createElement("div",{className:"col-sm-6 payModal_code"},Z?Ta.createElement(Ya.Z,{anchor:!0,plain:!0,className:"payModel_refresh",onClick:()=>{H()}},Ta.createElement("div",null,Ta.createElement(Da.Z,{icon:["gfas","refresh"]})),Ta.createElement("p",null,"二维码已失效",Ta.createElement("br",null),"点击刷新")):Ta.createElement("div",{className:"payModal_codeImg"},Ta.createElement("div",null,x?Ta.createElement(Hl.Qd,{value:x.qrCode,size:200}):!1===x&&Ta.createElement("p",null,"未获得支付二维码"))),Ta.createElement("p",null,Ta.createElement(Da.Z,{icon:["gfas","wechat-pay"]}),Ta.createElement("span",null,"请使用",Ta.createElement("strong",null,"微信扫一扫"),Ta.createElement("br",null),"扫描二维码支付"))),Ta.createElement("div",{className:"col-sm-6 payModal_amount"},Ta.createElement("p",null,"应付金额：",Ta.createElement("strong",null,(0,tn.T4)(a))))));return Ta.createElement(Ta.Fragment,null,(()=>{const{env:{isWXBrowser:e}}=S;if(f&&!n.getAttr("repurchasable"))return Ta.createElement(Ya.Z,(0,Aa.Z)({},N,{className:(0,Ma.Z)(N.className,"is_active"),disabled:!0}),j("已购买"));const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=j((0,tn.T4)(a)),n=C&&"number"==typeof k&&a<k,r=Ta.createElement(Km.Z,(0,Aa.Z)({},e,N,{className:(0,Ma.Z)(N.className,{[_]:!n&&_})}),t);return n?Ta.createElement("div",{className:(0,Ma.Z)("payButtonWithDiscount",_)},r,Ta.createElement("p",null,"原价 ",Ta.createElement("span",null,(0,tn.T4)(k)))):r};if(!t)return r();const l=Ta.createElement("ul",{className:"payModal_popover"},Ta.createElement("li",null,Ta.createElement(jm.Z,{pathname:S.pathname,fallback:Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:V},"微信支付")},Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:()=>{}},"机核App支付"))),!e&&Ta.createElement("li",null,Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:W},"支付宝支付")),(null==t?void 0:t.isStaff())&&Ta.createElement("li",null,Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:()=>{b&&!1===b()||v(n.get("id")).then((e=>{e&&$({type:"gcoins",order:e})}))}},"余额支付")));return Ta.createElement(xa.Z,{trigger:["click","hover","focus"],onFirstShow:()=>{(0,Vm.v)("464893","shopping")},body:l},r)})(),K,J)}));var Ym=a(56845);const Xm=e=>{let{album:t,currentUser:a,bundle:n,isBundleAvailable:r,isAvailable:l,onCompletePay:i}=e;const s=t.isAvailable(a,l);if(t.getAttr("is-free")||s)return null;const o=t.getOwnSku();return o?Ta.createElement(Jm,{type:"pay",ellipse:!0,size:"lg",sku:o,product:t,wechatPayUrl:w.default.wechat.payAlbumUrl(t.get("id"),o.get("id")),alipayUrl:e=>(0,Ir.o0)("album",{id:t.get("id"),sku_id:o.get("id"),order_id:e}),onBeforePay:()=>{if(!n||r)return!0;const e=confirm("推荐购买本书所属套装，价格更加优惠, 是否前往？");return e&&Qa.ZP.push((0,Ir.ZP)(n)),!e},onCompletePay:i}):Ta.createElement(Ya.Z,{ellipse:!0,size:"lg",type:"primary",disabled:!0},"已下架")},Qm=e=>{const{album:t,currentUser:a}=e;return null!=a&&a.getAttr("has-membership")?null:t.getAttr("is-require-privilege")||"audiobook"===t.getAttr("display-type")&&t.getAttr("credit")>0?Ta.createElement("span",{className:"albumDetail_buttonWithBtmText albumDetail_buttonWithBtmText-promotion"},Ta.createElement(Ya.Z,{type:"gpass",size:"lg",ellipse:!0,to:(0,Ir.ZP)("gpass")},"开通会员"),(0,Ym.Od)()?Ta.createElement("b",null,"周年特惠中"):null):null},eu=e=>{const{album:t,isAvailable:a,currentUser:n,onCompletePay:r}=e,l=(0,Ka.useSelector)(sn.hm),i=t.isAvailable(n,a),s=(0,Ka.useDispatch)(),{pageName:o}=(0,Ua.EY)(),[c,d]=(0,Ta.useState)(!1),[m,u]=(0,Ta.useState)(!1),p=t.getOwnSku();return!p||i||!(t.getAttr("credit")>0&&l>0)||l<t.getAttr("credit")?null:Ta.createElement(Ta.Fragment,null,Ta.createElement(_n.Z,{title:"GPASS 权益兑换",titleBar:!0,visible:c,onCloseClick:()=>{d(!1)},confirmBtnText:"确认兑换",confirmBtnProps:{type:"gpass",loading:m},onConfirmClick:async()=>{if(m)return;u(!0);const e={productId:t.get("id"),skuId:p.get("id"),amount:0,title:t.getTitle()||"",source:o,purchaseType:"credit",isGift:!1};(0,fe.HW)(e);const a=await s((0,N.AJ2)([p.get("id")]));u(!1),a&&!a.error&&(s((0,N.bG5)({type:N.ZQC.SUCCESS,body:"兑换成功，可在设置页查看你的订单记录"})),(0,fe.V5)(e),d(!1),r(!0))}},Ta.createElement("div",{className:"creditPurchaseModal_body"},Ta.createElement(ns,{album:t}),Ta.createElement("div",null,Ta.createElement("p",null,"应付金额：",Ta.createElement("span",null,"￥0.00")),Ta.createElement("p",null,"剩余可兑换 ",l," 本"))),Ta.createElement("div",{className:"albumDetail_body"},Ta.createElement("h3",null,"兑换须知"),Ta.createElement("div",null,"1.本兑换产品为 机核·核市奇谭 原创出品； ",Ta.createElement("br",null),"2.有声书兑换为 GPASS 权益的一部分，如需查看可兑换额度，可至【我的】-【GPASS】-【权益兑换】中查看 ；",Ta.createElement("br",null),"3.本兑换有声书在手机、平板及网页端均可兑换收听；",Ta.createElement("br",null),"4.兑换后可在【我的】-【我的已购】中查看本书； ",Ta.createElement("br",null),"5.本产品由机核提供，与 Apple Inc. 无关；",Ta.createElement("br",null),"6.兑换有声书为虚拟信息服务类产品，一经兑换概不退换，敬请理解。"))),Ta.createElement(Ya.Z,{type:"gpass",size:"lg",ellipse:!0,onClick:()=>{d(!0)}},"权益兑换"))},tu=e=>{const{album:t,onPlayAllClick:a,currentUser:n,isAvailable:r,hasRadios:l,onPlayTrialClick:i}=e;return l?t.isAvailable(n,r)?Ta.createElement(Ya.Z,{type:"secondary",size:"lg",ellipse:!0,onClick:a},"播放全部"):i?Ta.createElement(Ya.Z,{type:"secondary",size:"lg",ellipse:!0,onClick:i},"试听"):null:null},au=e=>{const{album:t,currentUser:a,isAvailable:n}=e;if(!t.isAvailable(a,n))return null;const r=t.getAttr("is-require-privilege");return Ta.createElement(Fc.Z,{type:r?"gpass-reverse":"primary",size:"lg",subscribable:t})},nu=e=>{const{album:t}=e;return t.getAttr("is-require-privilege")?Ta.createElement(Ta.Fragment,null,Ta.createElement(au,e),Ta.createElement(Qm,e),Ta.createElement(eu,e),Ta.createElement(Xm,e),Ta.createElement(tu,e)):Ta.createElement(Ta.Fragment,null,Ta.createElement(au,e),Ta.createElement(Xm,e),Ta.createElement(Qm,e),Ta.createElement(eu,e),Ta.createElement(tu,e))},ru=e=>{const{album:t,gpassGiftSku:a,onGiftClick:n}=e,r=t.getGiftSku(),[l,i]=(0,Ta.useState)(!1);if(t.isFree())return null;return Ta.createElement(Ta.Fragment,null,Ta.createElement(Hm.Z,{visible:l,onClose:()=>{i(!1)},options:[{title:"赠送GPASS",onClick:()=>{n(a,a),i(!1)}},{title:"赠送付费播单",onClick:()=>{n(r,t),i(!1)}},{title:"取消",requestClose:!0}]}),Ta.createElement(Ya.Z,{type:"secondary",ellipse:!0,size:"lg",onClick:()=>{(r||a)&&(r&&a?i(!0):n(r||a,r?t:a))}},"赠送"))},lu=e=>{const{album:t,sortReverse:a,onToggleSortReverse:n}=e;return Ta.createElement(Ta.Fragment,null,Ta.createElement(ru,e),n&&Ta.createElement(Ya.Z,{type:"secondary",circle:!0,size:"lg",onClick:n},Ta.createElement(Da.Z,{icon:["gfas",a?"order-reverse":"order"]})),Ta.createElement(mn.Z,{type:"secondary",circle:!0,size:"lg",data:t,plain:!1,anchor:!1}))},iu=e=>Ta.createElement(Ta.Fragment,null,Ta.createElement("div",null,Ta.createElement(nu,e)),Ta.createElement("div",null,Ta.createElement(lu,e))),su=e=>{let{div:t,to:a,cover:n,isVideo:r,title:l,desc:i,right:s,goldenBorder:o,onClick:c,locked:d}=e;const m={to:a,onClick:c},u=r?9/16:1,p=Ta.createElement("img",{src:(0,tn.cR)(n,{resize:{w:72,h:72*u}}),alt:l}),g=Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"albumRadio_l"},Ta.createElement(dn.Z,(0,Aa.Z)({className:"albumRadio_img"},m),Ta.createElement(_i,{thin:!0,golden:o},p)),Ta.createElement("div",{className:"albumRadio_title"},Ta.createElement("h3",null,Ta.createElement(dn.Z,m,l)),Ta.createElement("div",null,i))),Ta.createElement("div",{className:"albumRadio_r"},s)),h=(0,Ma.Z)("albumRadio","",{is_video:r,is_locked:d});return t?Ta.createElement("div",{className:h},g):Ta.createElement("li",{className:h},g)},ou=e=>{let{children:t}=e;return Ta.createElement("ul",{className:"albumRadios"},t)},cu=e=>{const{bundle:t,bundleAmount:a,isAvailable:n}=e,r=(0,Ir.ZP)("albumBundle",{id:t.get("id")}),l={to:r,cover:t.getAttr("cover"),title:t.getAttr("title"),div:!0,goldenBorder:!0};return n?Ta.createElement(su,(0,Aa.Z)({},l,{desc:Ta.createElement("span",{key:"info",className:"u_color-gray-info"},"共 ",t.getAttr("albums-count")??0," 本 •"," ",t.getAttr("is-unfinished")?"更新中":"已完结"),right:Ta.createElement(Ya.Z,{type:"secondary",size:"lg",ellipse:!0,to:r},"查看")})):Ta.createElement(su,(0,Aa.Z)({},l,{desc:Ta.createElement("span",null,Ta.createElement("span",{className:"u_color-category me-1"},"优惠价",(0,tn.T4)(a)),Ta.createElement("span",{className:"u_color-gray-info o_deletedText"},(0,tn.T4)(t.getAttr("original-amount")))),right:Ta.createElement(Ya.Z,{type:"gift",size:"lg",ellipse:!0,to:r},"推荐")}))};var du=a(74015);const mu=e=>{let{original:t,isAlbumAvailable:a,onPreviewClick:n}=e;const r=!!t.getAttr("published-at")&&Date.now()<new Date(t.getAttr("published-at")).getTime(),i=(0,Ka.useDispatch)();return Ta.createElement(su,{to:(0,Ir.ZP)(t),locked:r,cover:t.getImage(),isVideo:t.isVideo(),title:t.getAttr("title"),desc:r?`将于 ${(0,rn.SI)(t.getAttr("published-at"))} 发布`:Ta.createElement("div",{className:"d-flex gap-3"},Ta.createElement(dn.Z,{key:"category",className:"u_color-category",to:(0,Ir.ZP)("category",{id:t.getRel("category","id")})},t.getRelAttr("category","name")),Ta.createElement("span",{className:"u_color-gray-info"},(0,rn.dB)(t.getAttr("duration"))),t.getAttr("comments-count")>0&&Ta.createElement("span",{key:"count",className:"u_color-gray-info"},t.getAttr("comments-count")," 评论")),right:r||!t.isFree()&&!a?Ta.createElement("span",{key:"lock"},Ta.createElement(Da.Z,{icon:["gfas","lock"]})):"radios"===t.get("type")?Ta.createElement(Ta.Fragment,null,Ta.createElement(Ya.Z,{key:"add",anchor:!0,plain:!0,onClick:()=>{i((0,l.KTf)(t))}},Ta.createElement(Da.Z,{icon:["gfas","plus"]})),Ta.createElement(Ya.Z,{key:"play",anchor:!0,plain:!0,onClick:()=>{i((0,l.lMO)(t))}},Ta.createElement(Da.Z,{icon:["gfas","play"]}))):Ta.createElement(Ya.Z,{anchor:!0,plain:!0,to:(0,Ir.ZP)(t)},Ta.createElement(Da.Z,{icon:["gfas","play"]})),onClick:e=>{r&&(null==n||n(),e.preventDefault())}})},uu=e=>{let{originals:t,isAlbumAvailable:a,onPreviewClick:n}=e;return Ta.createElement(ou,null,t.map((e=>Ta.createElement(mu,{key:e.getKey(),original:e,isAlbumAvailable:a,onPreviewClick:n}))))};var pu=a(20540);const gu=e=>{const{album:t}=e;if(t.isFree())return null;const a=t.getRel("shop-item");return Ta.createElement(Ta.Fragment,null,t.getAttr("description")&&Ta.createElement("pre",null,t.getAttr("description")),t.getAttr("information")&&Ta.createElement(Ta.Fragment,null,Ta.createElement("h3",null,"实体书信息"),Ta.createElement("pre",null,t.getAttr("information"))),a&&Ta.createElement("div",{className:"mb-4"},Ta.createElement(pu.Z,{title:a.getAttr("name"),image:(0,tn.cR)(a.getAttr("image-path"),{resize:{w:120,h:120}}),url:a.getAttr("url")})),t.getAttr("purchase-notes")&&Ta.createElement(Ta.Fragment,null,Ta.createElement("h3",null,"购买需知"),Ta.createElement("pre",null,t.getAttr("purchase-notes"))))};var hu=a(97757);const vu=e=>{var t,a;let{wallpapers:n,onItemClick:r}=e;const[l,i]=(0,Ta.useState)(null);null!==(t=n)&&void 0!==t&&t.filter&&(n=n.filter((e=>e.getAttr("desktop-image"))));return((null===(a=n)||void 0===a?void 0:a.size)??0)>0?Ta.createElement(Ta.Fragment,null,Ta.createElement(hu.Z,{images:n.map((e=>{const t=e.getAttr("desktop-image");return{preview:(0,tn.cR)(t,{resize:{w:700,m:"lfit"}}),origin:(0,tn.cR)(t,!1)}})).toJS(),visible:null!==l,onCloseClick:()=>{i(null)},active:null!==l?l:void 0,showDownload:!0}),Ta.createElement("div",{className:"albumDetail_wallpapers"},n.map(((e,t)=>Ta.createElement("div",{key:e.get("id")},Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:e=>{const t=e.currentTarget.getAttribute("data-index");r&&!1===r(t)||i(t)},"data-index":t,className:"albumDetail_wallpaper",style:{backgroundImage:`url(${(0,tn.cR)(e.getAttr("desktop-image"),{resize:{w:380,h:214}})})`}})))))):Ta.createElement("p",null,"该节目不提供壁纸下载")},Eu=e=>{let{cover:t,golden:a}=e;if(!t)return null;if("string"==typeof t){const e=Ta.createElement("img",{src:(0,tn.cR)(t,{resize:{w:265,m:"lfit"}})});return a?Ta.createElement(_i,{label:"gcores"},e):e}return t},fu=e=>{let{cover:t,className:a,golden:n,gpass:r,...l}=e;const i=t&&Ta.createElement("div",{className:"giftModal_cover"},Ta.createElement("div",{className:"giftModal_image"},Ta.createElement(Eu,{cover:t,golden:!r&&n})));return Ta.createElement(_n.Z,(0,Aa.Z)({className:(0,Ma.Z)("popBox-bgHeader","giftModal",{"giftModal-gpass":r},a),header:i,headerImage:r||"string"!=typeof t||t.startsWith("/")?void 0:(0,tn.cR)(t,tn.iT.Blur)},l))},yu=(0,sn.P1)(((e,t)=>{var a;return null==t||null===(a=t.redeemCode)||void 0===a?void 0:a.consumerId}),sn.LF,((e,t)=>(0,ln.tK)(e||void 0,"users",t))),bu={dispatchGetUser:N.PRA},ku=(0,Ka.connect)(((e,t)=>({consumer:yu(e,t)})),bu)((e=>{let{redeemCode:{code:t,producerId:a,consumerId:n},product:r,producerId:l,consumer:i,productLinkVisible:s=!1,dispatchGetUser:o,...c}=e;const d=a||l,m=(0,Ta.useRef)(null),u=(0,Ir.o0)("redeem_code",{code:t,type:r.type,id:r.id,producer_id:d});function p(){m.current&&(m.current.select(),(0,Tr.vQ)(u,m.current.parentElement))}return(0,Ta.useEffect)((()=>{n&&o(n)}),[n,o]),Ta.createElement(fu,(0,Aa.Z)({width:550,cover:r.cover},s&&["albums","album-bundles"].includes(r.type)?{actions:Ta.createElement(Ya.Z,{className:"w-100 ms-0 u_fontSize-lg u_color-gray-info",type:"link",to:"albums"===r.type?(0,Ir.ZP)("album",{id:r.id}):(0,Ir.ZP)("albumBundle",{id:r.id})},"查看礼物详情")}:{hideActionBtns:!0},c),Ta.createElement("div",{className:"redeemCodePage_body"},Ta.createElement("h1",null,r.title),Ta.createElement("p",null,"该礼物",(e=>e?`礼物已被 ${e.getAttr("nickname")} 领取`:"礼物尚未领取，请复制分享链接发送给朋友")(i))),Ta.createElement("div",{className:"input-group mt-4"},Ta.createElement("input",{type:"text",className:"form-control",value:u,disabled:!0,onClick:p,ref:m}),Ta.createElement("button",{className:"btn btn-primary",type:"button",onClick:p},"复制链接")))})),Cu=e=>"skus"===e.get("type")&&e.isGiftGpass(),_u=e=>{const t=e.get("type");return"albums"===t||"album-bundles"===t?e.getAttr("gift-cover"):Cu(e)?Ta.createElement("div",{className:"ag_giftCardImage"},(0,Ym.Od)()?Ta.createElement("span",{className:"ag_giftCardImage_promotion"},"周年特惠"):null,Ta.createElement("img",{style:{width:"100%"},src:tr.Zc[e.get("id")].card}),Ta.createElement("p",null,"购买则表示你已阅读并同意"," ",Ta.createElement(dn.Z,{href:w.default.gpass_policy_url},"《会员服务协议》"))):e.getImage()},wu=e=>{let{visible:t,giftSku:a,alipayUrl:n,wechatPayUrl:r,product:l,onClose:i}=e;const[s,o]=(0,Ta.useState)(null),c=(0,Ka.useSelector)(sn.ib),d=(0,Ta.useMemo)((()=>l?{id:l.get("id"),type:l.get("type"),title:l.getTitle()||"礼物",cover:_u(l)}:null),[l]);if(!a||!d)return null;const m=Cu(l);return Ta.createElement(Ta.Fragment,null,s&&Ta.createElement(ku,{visible:!0,redeemCode:s,producerId:c.get("id"),product:d,onCloseClick:()=>{o(null)},gpass:m}),Ta.createElement(fu,{cover:d.cover,visible:t,hideActionBtns:!0,onCloseClick:i,gpass:m},Ta.createElement("div",{className:"albumDetail_body"},Ta.createElement("h3",null,"礼物信息"),Ta.createElement("pre",null,d.title),Ta.createElement("h3",null,"购买须知"),Ta.createElement("pre",null,a.getAttr("description")||"无")),Ta.createElement("div",{className:"mt-4 d-flex justify-content-end"},Ta.createElement(Jm,{type:m?"gpass":"gift",size:"lg",sku:a,product:l,displayDiscount:!1,alipayUrl:n,wechatPayUrl:r,onCompletePay:(e,t)=>{e&&o(t.redeemCode)}},(e=>`购买并赠送 ${(0,tn.T4)(e)}`)))))},Nu="t_albumPageScrollableContainer",Pu=(0,sn.P1)(((e,t)=>t.albumId),sn.LF,((e,t)=>(0,ln.tK)(e||void 0,"albums",t))),Su=(0,sn.P1)((e=>e.getIn(["data","albumPage","originals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Zu=(0,sn.P1)((e=>e.getIn(["data","albumPage","previewOriginals","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))).filter((e=>e)))),Iu=(0,sn.P1)(sn.LF,(e=>(0,ln.tK)(tr.fv,"skus",e))),Tu={dispatchAddAlbum:l.kIl,dispatchPlayAlbum:l.Fcz,dispatchPlayRadio:l.lMO,dispatchShowPayTip:l.YDj,dispatchGetOriginals:X.actions.getOriginals},Au=(0,Ka.connect)(((e,t)=>{var a,n;const r=Pu(e,t),l=Iu(e),i=Su(e),s=r.getAttr("is-require-privilege")?Zu(e):(0,k.List)(),o=null==r||null===(a=r.getRel("album-bundles"))||void 0===a?void 0:a.get(0),c=null==r?void 0:r.getOwnSku(),d=null==r?void 0:r.getGiftSku(),m=(0,sn._I)(e,me.Uo.Album,t.albumId),u=!!o&&(0,sn._I)(e,me.Uo.AlbumBundle,o.get("id")),p=e.getIn(["pay","skuHistory",null==o||null===(n=o.getOwnSku())||void 0===n?void 0:n.get("id"),"amount"])||(null==o?void 0:o.getAmount()),g=(0,sn.ib)(e);return{currentUser:g,album:r,bundle:o,bundleAmount:p,originals:i.concat(s),originalsState:e.getIn(["data","albumPage","originals"]),sku:c,gpassGiftSku:l,giftSku:d,isAvailable:null==r?void 0:r.isAvailable(g,m),isBundleAvailable:u}}),Tu)((e=>{var t;const{sortable:a,albumId:n,sku:r,giftSku:i,gpassGiftSku:s,album:o,currentUser:c,bundle:d,relationName:m,originals:u,originalsState:p,background:g,isAvailable:h,isBundleAvailable:v,bundleAmount:E,dispatchAddAlbum:f,dispatchPlayRadio:y,dispatchPlayAlbum:b,dispatchShowPayTip:k,dispatchGetOriginals:C}=e,_=null==d?void 0:d.get("id"),N=null==d||null===(t=d.getOwnSku())||void 0===t?void 0:t.get("id"),P=null==r?void 0:r.get("id"),S=o.isFree(),Z=S?zm.filter((e=>"radios"===e.key)):0===o.getRel("wallpapers").size?zm.filter((e=>"wallpapers"!==e.key)):zm,[I,T]=(0,Ta.useState)(!0===a||void 0),[A,R]=(0,Ta.useState)(null),D=(e=>{let{albumId:t,bundleId:a,skuId:n,bundleSkuId:r}=e;const i=(0,Ka.useDispatch)();return(0,Ta.useCallback)((()=>{t&&i((0,l.yap)({purchasableType:me.Uo.Album,purchasableId:t})),a&&i((0,l.yap)({purchasableType:me.Uo.AlbumBundle,purchasableId:a})),n&&i((0,l.TBc)({skuId:n})),r&&i((0,l.TBc)({skuId:r}))}),[i,t,a,n,r])})({albumId:n,bundleId:_,skuId:P,bundleSkuId:N}),x=u.find((e=>e.isFree())),M=bi(o,{directToAlbum:!1,shouldShowTip:!0}),L=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(p.get("currentPage")??0)+1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"boolean"==typeof I?I:void 0;await C(n,m,e,t)}),[m,n,I,p,C]),q=e=>"radios"===e?Ta.createElement(Ta.Fragment,null,o.getAttr("notice")&&Ta.createElement(du.Z,null,o.getAttr("notice")),Ta.createElement(Cn.Z,{onLoad:L,state:p,data:u,emptyContent:Ta.createElement("p",{className:"mutedInfo"},"该播单暂无节目"),scrollableProps:{container:`.${Nu}`}},(e=>Ta.createElement(uu,{originals:e,isAlbumAvailable:h,onPreviewClick:M})))):"intro"===e?Ta.createElement(gu,{album:o}):"wallpapers"===e?Ta.createElement(vu,{wallpapers:o.getRel("wallpapers"),onItemClick:()=>{if(!h)return k("albums",o.get("id"),o.getAttr("title")),!1}}):null;return(0,Ta.useEffect)((()=>{S||D()}),[D,S]),(0,Ta.useEffect)((()=>{var e,t,a,n;const r=null===(e=(0,nn.XW)())||void 0===e||null===(t=e.query)||void 0===t?void 0:t.sku_id;r&&(r===(null==i||null===(a=i.get)||void 0===a?void 0:a.call(i,"id"))?R({sku:i,product:o}):r===(null==s||null===(n=s.get)||void 0===n?void 0:n.call(s,"id"))&&R({sku:s,product:s}))}),[]),Ta.createElement(Ta.Fragment,null,A&&Ta.createElement(wu,{visible:!0,giftSku:A.sku,product:A.product,wechatPayUrl:w.default.wechat.payAlbumUrl(o.get("id"),A.sku.get("id")),alipayUrl:e=>(0,Ir.o0)("album",{id:o.get("id"),sku_id:A.sku.get("id"),order_id:e}),onClose:()=>{R(null)}}),Ta.createElement($m,{backgroundImage:g?o.getAttr("cover"):void 0,cover:Ta.createElement(Gm,{album:o,onAddClick:()=>{u.size>0&&f(u,{album:o,sku:r})}}),tabs:Z,title:o.getAttr("title"),desc:o.getAttr("author")||o.getAttr("description"),modalProps:{overlayClassName:Nu},actions:Ta.createElement(iu,{album:o,currentUser:c,bundle:d,gpassGiftSku:s,isBundleAvailable:v,isAvailable:h,sortReverse:I,onToggleSortReverse:a?()=>{T((e=>{if(p.get("isRequesting"))return e;const t=!e;return L(1,t),t}))}:void 0,onPlayAllClick:()=>{u.size>0&&b(u,{album:o,sku:r})},onPlayTrialClick:x?()=>{x&&((0,Vm.v)("464790","other"),(0,fe.zK)(r.get("id"),o.get("id"),o.getAttr("is-require-privilege")??!1),y(x))}:void 0,hasRadios:"radio"===o.getAttr("content-type")&&u.size>0,onCompletePay:e=>{e&&D()},onGiftClick:(e,t)=>{R({sku:e,product:t})}}),extraSections:d?[{title:"本书所属套装",body:Ta.createElement(cu,{bundle:d,isAvailable:h,bundleAmount:E})}]:[],onCloseClick:()=>{(0,nn.Hm)("/")}},q))})),Ru={path:"",children:[{...(0,ii.r3)("audioBooks"),async action(e){let{store:t,query:a}=e;return Vi("audioBooks",t,a)}},{...(0,ii.r3)("albums"),async action(e){let{store:t,query:a}=e;return Vi("albums",t,a)}},{...(0,ii.r3)("privilegeAlbums"),async action(e){let{store:t,query:a}=e;return Vi("privilegeAlbums",t,a)}},{...(0,ii.r3)("album"),async action(e){let{store:t,params:a,currentUserId:n,isLoadingFirstPage:r}=e;const l=await t.dispatch(X.actions.getAlbum(a.id)),i=(0,Ir.xE)(l,{imageKey:"cover"}),[{relationName:s,sortable:o}]=await Promise.all([t.dispatch(X.actions.init(a.id)),t.dispatch((0,V.D1)(`skus/${tr.fv}`)),...n?[t.dispatch(Ee.actions.getUserCredit())]:[]]);return{...i,description:"欢迎收听机核有声书、播单",modal:Ta.createElement(Au,{sortable:o,relationName:s,albumId:a.id,background:r,key:a.id}),restoreScroll:!1}}}]},Du=(e,t)=>{let{currentUser:a,sku:n,giftSku:r,albumBundle:l,albums:i,isAvailable:s,amount:o}=e;const[c,d]=(0,Ta.useState)(!1);(0,Ta.useEffect)((()=>{var e,t,a;(null===(e=(0,nn.XW)())||void 0===e||null===(t=e.query)||void 0===t?void 0:t.sku_id)===(null==r||null===(a=r.get)||void 0===a?void 0:a.call(r,"id"))&&d(!0)}),[]);const m=l.getAttr("original-amount"),u=s?Ta.createElement(Ya.Z,{type:"pay",className:"is_active",ellipse:!0,size:"lg",disabled:!0},"已购买"):n?Ta.createElement(Jm,{type:"pay",ellipse:!0,size:"lg",sku:n,originalAmount:m,displayDiscount:!s,product:l,wechatPayUrl:w.default.wechat.payAlbumBundleUrl(l.get("id"),n.get("id")),alipayUrl:e=>(0,Ir.o0)("albumBundle",{id:l.get("id"),sku_id:n.get("id"),order_id:e}),onBeforePay:()=>i.findIndex((e=>e.isAvailable))<0||confirm("你已拥有本套装内的单本有声书，是否继续购买套装"),onCompletePay:()=>{t()}}):Ta.createElement(Ya.Z,{size:"lg",ellipse:!0,type:"primary",disabled:!0},"已下架"),p=n?Ta.createElement(Ya.Z,{type:"secondary",ellipse:!0,size:"lg",onClick:()=>{d(!0)}},"赠送"):null;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",null,u),Ta.createElement("div",null,p,Ta.createElement(mn.Z,{type:"secondary",circle:!0,size:"lg",data:l,plain:!1,anchor:!1})),Ta.createElement(wu,{visible:c,giftSku:r,product:l,wechatPayUrl:w.default.wechat.payAlbumBundleUrl(l.get("id"),r.get("id")),alipayUrl:e=>(0,Ir.o0)("albumBundle",{id:l.get("id"),sku_id:r.get("id"),order_id:e}),onClose:()=>{d(!1)}}))},xu=[{key:"albums",title:"有声书"},{key:"intro",title:"简介"},{key:"wallpapers",title:"壁纸"}],Mu=(e,t,a,n)=>{const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;const a=(new Date).getMonth()+1,n=(new Date).getFullYear(),r=e.getMonth()+1,l=e.getFullYear();return l!==n?t?"明年":`${l}年${r}月`:`${r===a?"本":r}月`}(n,!0),l=t?"已发布":r?`预期${r}发布`:"尽请期待",i=e?"已购买":`单本${(0,tn.T4)(a)}`;return Ta.createElement("span",{className:"u_color-gray-info"},Ta.createElement("span",null,l),Ta.createElement("span",{className:"mx-1"},"•"),Ta.createElement("span",null,i))},Lu=e=>{let{albumBundle:t,albums:a}=e;return Ta.createElement(Ta.Fragment,null,t.getAttr("notice")&&Ta.createElement(du.Z,null,t.getAttr("notice")),Ta.createElement(ou,null,a.map((e=>(e=>{let{model:t,isAvailable:a,amount:n}=e;const r=t.getAttr("published-at"),l=r?new Date(r):void 0,i=l instanceof Date&&new Date>=l,s=(0,Ir.ZP)("album",{id:t.get("id")}),o={key:t.getKey(),locked:!i,to:i?s:void 0,goldenBorder:!0,cover:t.getAttr("cover"),title:t.getAttr("title"),desc:Mu(a,i,n,l),right:i?a?Ta.createElement(dn.Z,{to:s,className:"albumBundlePage_itemPlay"},Ta.createElement(Da.Z,{icon:["gfac","golden-play"]})):Ta.createElement(Ya.Z,{type:"secondary",size:"lg",ellipse:!0,to:s},Ta.createElement(Da.Z,{icon:["gfas","play"]}),"免费试听"):Ta.createElement("span",null,Ta.createElement(Da.Z,{icon:["gfas","lock"]}))};return Ta.createElement(su,o)})(e)))))},qu=(e,t)=>"albums"===e?Lu(t):"intro"===e?(e=>{let{albumBundle:t}=e;const a=t.getRel("shop-item");return Ta.createElement(Ta.Fragment,null,Ta.createElement("pre",null,t.getAttr("description")),t.getAttr("information")&&Ta.createElement(Ta.Fragment,null,Ta.createElement("h3",null,"实体书信息"),Ta.createElement("pre",null,t.getAttr("information"))),a&&Ta.createElement("div",{className:"mb-4"},Ta.createElement(pu.Z,{title:a.getAttr("name"),image:(0,tn.cR)(a.getAttr("image-path"),{resize:{w:120,h:120}}),url:a.getAttr("url")})),Ta.createElement("h3",null,"购买需知"),Ta.createElement("pre",null,t.getAttr("purchase-notes")))})(t):"wallpapers"===e?(e=>{let{albumBundle:t,isAvailable:a,dispatchShowAlbumPayTip:n}=e;return Ta.createElement(vu,{wallpapers:t.getRel("wallpapers"),onItemClick:()=>{if(!a)return n("album-bundles",t.get("id"),t.getAttr("title")),!1}})})(t):Ta.createElement("div",null,"body"),Fu=e=>{const{background:t,sku:a,albumBundle:n,albums:r,dispatchPurchasableAvailability:l,dispatchCheckSku:i}=e,s=((e,t,a)=>{const[n,r]=(0,Ta.useState)("inited");return(0,Ta.useEffect)((()=>{Promise.all([a({purchasableType:me.Uo.AlbumBundle,purchasableId:e.get("id")},!0),...t.map((e=>a({purchasableType:me.Uo.Album,purchasableId:e.model.get("id")},!0)))])}),[n,a]),()=>{r((e=>`${e} `))}})(n,r,l);return(0,Ta.useEffect)((()=>{a&&i({skuId:a.get("id")})}),[]),Ta.createElement($m,{onCloseClick:()=>{(0,nn.Hm)("/")},backgroundImage:t?n.getAttr("cover"):void 0,cover:Ta.createElement(_i,{golden:!0,thin:!0,className:"albumBundlePage_cover"},Ta.createElement("img",{alt:n.getAttr("title"),src:(0,tn.cR)(n.getAttr("cover"),{resize:{w:180,h:180}})})),tabs:xu,title:n.getAttr("title"),desc:n.getAttr("author"),actions:Du(e,s),tabsProps:{subContent:(null==r?void 0:r.length)>0?Ta.createElement("span",{className:"u_color-gray-info u_fontSize-base"},"本套装共 ",r.length," 本有声书"):void 0}},(t=>qu(t,e)))},Bu=(0,sn.P1)(((e,t)=>t.bundleId),sn.LF,((e,t)=>(0,ln.tK)(e||void 0,"album-bundles",t))),Ou=(0,sn.P1)(Bu,(e=>e),((e,t)=>{var a;return null==e||null===(a=e.getRel("albums"))||void 0===a?void 0:a.map((e=>({model:e,amount:e.getAmount(),isAvailable:(0,sn._I)(t,me.Uo.Album,e.get("id"))}))).toJSON()})),Uu={dispatchPurchasableAvailability:l.yap,dispatchShowAlbumPayTip:l.YDj,dispatchCheckSku:l.TBc},$u=(0,Ka.connect)(((e,t)=>{const a=Bu(e,t),n=null==a?void 0:a.getOwnSku(),r=e.getIn(["pay","skuHistory",null==n?void 0:n.get("id"),"amount"])||(null==n?void 0:n.getAttr("amount")),l=null==a?void 0:a.getGiftSku();return{currentUser:(0,sn.ib)(e),albumBundle:a,albums:Ou(e,t),isAvailable:(0,sn._I)(e,me.Uo.AlbumBundle,a.get("id")),amount:r,sku:n,giftSku:l}}),Uu)(Fu),Gu={...(0,ii.r3)("albumBundle"),async action(e){let{store:t,params:a,isLoadingFirstPage:n}=e;const r=await t.dispatch((0,V.D1)(`album-bundles/${a.id}`,{include:["albums.sale-options","wallpapers","sale-options","shop-item"]}));return{...(0,Ir.xE)(r,{imageKey:"cover"}),modal:Ta.createElement($u,{bundleId:a.id,background:n}),restoreScroll:!1}}},zu=e=>Ta.createElement("div",{className:"row",key:"articles"},e.map((e=>Ta.createElement("div",{className:tn.d9,key:e.getKey()},Ta.createElement(si.Z,{original:e,small:!0})))));class Hu extends Xa.Z{renderHeader(){const{collectionID:e,collection:t,tab:a}=this.props,n=Ta.createElement("span",null,t.getAttr("subscriptions-count")," 人已订阅",Ta.createElement(Fc.Z,{subscribable:t,className:"ms-3"}));return Ta.createElement(ac,{withNav:!0,backgroundCover:!0,background:(0,tn.cR)(t.getAttr("banner"),tn.iT.Blur),tabs:(r=e,tn.hd.map((e=>({...e,to:(0,Ir.ZP)("collection",{id:r,tab:e.key,page:1})})))),active:a,actions:n},Ta.createElement("h3",{className:"mb-3"},t.getAttr("title")),Ta.createElement("p",{className:"m-0"},t.getAttr("description")));var r}renderPagingOriginals(){const{pageState:e,originals:t,tab:a,page:n,collectionID:r}=this.props;return Ta.createElement(Ta.Fragment,null,Ta.createElement(oi.Z,{data:t,page:n,isRequesting:e.get("isRequesting"),fetched:e.get("fetched"),allPage:e.get("allPage"),linkBuilder:e=>(0,Ir.ZP)("collection",{id:r,tab:a,page:e})},zu))}render(){const{collection:e}=this.props;return Ta.createElement(Ta.Fragment,null,this.renderHeader(),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:e.getAttr("title")},this.renderPagingOriginals()))))}}Hu.propTypes={collection:Va().record.isRequired,originals:Va().list,page:Ga().number.isRequired,tab:Ga().string.isRequired},Hu.defaultProps={originals:void 0};const Vu=(0,sn.P1)(((e,t)=>t.collectionID),sn.LF,((e,t)=>(0,ln.tK)(e,"collections",t))),Wu=(0,sn.P1)((e=>e.getIn(["data","collectionPage","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),ju=(0,Ka.connect)(((e,t)=>({collection:Vu(e,t),originals:Wu(e),pageState:e.getIn(["data","collectionPage"])})))(Hu),Ku={path:"/collections",children:[{...(0,ii.r3)("collections"),async action(e){let{store:t,query:a}=e;return Vi("collections",t,a)}},{...(0,ii.r3)("collection"),async action(e){let{params:t,query:a,store:n,isPathnameChangedNotBrowserFirst:r,isBrowserFirstLoad:i}=e;const s=t.id,o=(0,nn.CO)(a.page),c=a.tab||"originals";let d;r&&(d=await n.dispatch((0,l.mXD)(s))),i||await n.dispatch((0,l.RQB)(s,c,o));return{...(0,Ir.xE)(d,{imageKey:"cover",fromState:{store:n,type:"collections",id:s}}),preloadState:!0,context:{navTransparent:!0},component:Ta.createElement(ju,{collectionID:s,page:o,tab:c})}}}]},Ju=e=>Ta.createElement("div",{className:r.ot},e.map((e=>Ta.createElement("div",{key:e.getKey(),className:"col mb-5"},Ta.createElement(Ki,{data:e}))))),Yu=(0,sn.TJ)(["data","newsListPage","newsRadios","ids"]),Xu=(0,sn.TJ)(["data","newsListPage","gadioWaveRadios","ids"]),Qu=(0,sn.P1)(Yu,Xu,((e,t)=>e.concat(t).sort(((e,t)=>new Date(t.getAttr("published-at")).getTime()-new Date(e.getAttr("published-at")).getTime())).slice(0,3))),ep=(0,sn.TJ)(["data","newsListPage","newsList","ids"]),tp=e=>{let{page:t}=e;const a=(0,Ka.useSelector)(Qu),n=(0,Ka.useSelector)(ep),r=(0,Ka.useSelector)((e=>e.getIn(["data","newsListPage","newsList"])));return Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"container"},Ta.createElement(ci.Z,{title:"资讯"},Ta.createElement(as,{banners:a})),Ta.createElement(ci.Z,{title:"最新"},Ta.createElement(oi.Z,{data:n,isRequesting:r.get("isRequesting"),fetched:r.get("fetched"),gcPageProps:{current:t,linkBuilder:e=>(0,Ir.ZP)("newsList",{page:e})}},Ju))))},ap={...(0,ii.r3)("newsList"),async action(e){let{store:t,query:{page:a},isPathnameChangedNotBrowserFirst:n,isBrowserFirstLoad:r}=e;const i=(0,nn.CO)(a);return n&&await Promise.all([t.dispatch((0,l.QKH)()),t.dispatch((0,l.dQq)())]),r||await t.dispatch((0,l.GF)(i)),{title:"资讯",preloadState:!0,context:{appProps:{className:"is_inWiderPage"}},component:Ta.createElement(tp,{page:i})}}},np=e=>{let{djs:t}=e;return Ta.createElement("div",{className:"mb-5"},Ta.createElement("p",{className:"text-center u_fontSize-lg"},"参与者"),Ta.createElement("div",{className:"text-center"},t.map((e=>Ta.createElement(cn.Z,{key:e.getKey(),className:"mx-3 mb-3",users:e,size:"lg",vertical:!0,noBold:!0,to:(0,Ja.Z)("user",{id:e.get("id")})})))))};np.propTypes={djs:Va().list.isRequired};const rp=np,lp=(0,Ka.connect)((e=>({session:e.get("session")})))((e=>{let{volume:t,session:a}=e;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"articlePage_body"},Ta.createElement("div",{className:"story_container"},Ta.createElement(rp,{djs:t.getRel("djs")}),Ta.createElement(mm,{original:t}),Ta.createElement("p",{className:"u_color-gray-desc text-center"},Ta.createElement("span",{className:"me-2",title:(0,rn.ab)(t.getAttr("published-at")),suppressHydrationWarning:!0},(0,rn.Sy)(t.getAttr("published-at"))),t.getRel("category")&&Ta.createElement(Ta.Fragment,null,"发布于",Ta.createElement(Ls.Z,{categoryID:t.getRel("category","id")},(e=>Ta.createElement(dn.Z,(0,Aa.Z)({className:"ms-1 u_color-category",to:(0,Ir.ZP)("category",{id:t.getRel("category","id")})},e),t.getRelAttr("category","name")))))),Ta.createElement(um,{original:t})),Ta.createElement(cm,{original:t,session:a,withSticky:!1}),Ta.createElement("div",{className:"story_container mt-3"},Ta.createElement(_d,{original:t}),Ta.createElement(xd,{original:t}))),Ta.createElement($d,{original:t}))})),ip=(0,sn.P1)(((e,t)=>t.videoID),((e,t)=>t.preview),sn.LF,((e,t,a)=>(0,ln.tK)(e,"videos",a,{originalPreview:t,depth:3}))),sp=(0,sn.P1)(((e,t)=>t.videoID),sn.LF,((e,t)=>(0,ln.tK)(e,"videos",t))),op=e=>{let{videoID:t,preview:a}=e;const n=(0,Ka.useSelector)((e=>ip(e,{videoID:t,preview:a}))),r=(0,Ka.useSelector)((e=>sp(e,{videoID:t})));return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"videoPage_header gnav_next"},Ta.createElement("div",{className:"videoPage_header_mask",style:{backgroundImage:`url(${(0,tn.cR)(n.getAttr("thumb"),tn.iT.Blur)})`}}),Ta.createElement(vm,{preview:a,original:r}),Ta.createElement("div",{className:"container"},Ta.createElement(Uo,{video:n,preview:"string"==typeof a}))),Ta.createElement(lp,{volume:n}))},cp={path:"/videos",children:[{...(0,ii.r3)("videos"),async action(e){e.isPathnameChangedNotBrowserFirst&&await e.store.dispatch((0,l.kKF)());return await Hi("videos",e)}},{...(0,ii.r3)("video"),async action(e){let{store:t,query:{preview:a},params:n,getCurrentUser:r}=e;const i=(0,Ir.oD)(a,"videos"),s=await t.dispatch((0,l.k3z)({type:"videos",id:n.id},{includeQueryPush:["media","albums",...i.needInclude]})),o=(0,Ir.xE)(s),c=s.payload.data.relationships.category,d={...o};return c.data&&c.data.id===tr.default.category.NEWS?d.component=Ta.createElement(Bm,{newsID:n.id,videoMode:!0,preview:i.draft}):(d.context={navTransparent:!0},d.component=Ta.createElement(op,{videoID:n.id,preview:i.draft})),d.htmlClassNames=["lightBg"],d}}]};class dp extends Xa.Z{componentDidMount(){this.purchasableAvailability()}componentDidUpdate(e){var t;const{radio:a}=this.props;(null==a?void 0:a.get("id"))!==(null===(t=e.radio)||void 0===t?void 0:t.get("id"))&&this.purchasableAvailability()}render(){const{radio:e,originalRadio:t,preview:a}=this.props;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"radioPage_header gnav_next"},Ta.createElement("div",{className:"radioPage_header_mask",style:{backgroundImage:`url(${(0,tn.cR)(e.getImage(),tn.iT.Blur)})`}}),Ta.createElement(vm,{preview:a,original:t}),Ta.createElement("div",{className:"radioPage_header_inner"},Ta.createElement("div",{className:"radioPage_radio",style:{backgroundImage:`url(${(0,tn.cR)(e.getImage(),{resize:{w:280,h:280}})})`}},Ta.createElement("span",{className:"radioPage_radio_duration"},(0,rn.dB)(e.getAttr("duration"))),Ta.createElement(br.Z,{openUrl:(0,Ir.ZP)(e),label:"电台页播放",className:"radioPage_radio_play",onClick:this.handlePlayClick,onLinkFallback:null},Ta.createElement(Ya.Z,{plain:!0,onClick:this.handlePlayClick},Ta.createElement("img",{src:Ii,alt:"play"}))),Ta.createElement(br.Z,{label:"电台页添加",openUrl:(0,Ir.ZP)(e),className:"radioPage_radio_add"},Ta.createElement(Ya.Z,{onClick:this.handleAddClick,plain:!0,anchor:!0},Ta.createElement(Da.Z,{icon:["gfas","plus"]})))))),Ta.createElement(lp,{volume:e}))}purchasableAvailability=()=>{const{radio:e,dispatch:t}=this.props;e.getAttr("is-free")||t((0,l.yap)({purchasableType:me.Uo.Radio,purchasableId:e.get("id")}))};authCheckForPaidAlbum=()=>{var e;const{dispatch:t,radio:a,isAvailable:n,currentUser:r}=this.props;if(a.isAvailable(r,n))return!0;const i=null===(e=a.getRel("albums"))||void 0===e?void 0:e.first();return i&&t((0,l.YDj)("albums",i.get("id"))),!1};handlePlayClick=()=>{if(!this.authCheckForPaidAlbum())return;const{radio:e,dispatch:t}=this.props;t((0,l.lMO)(e,{},{openFullScreen:!0}))};handleAddClick=()=>{if(!this.authCheckForPaidAlbum())return;const{radio:e,dispatch:t}=this.props;t((0,l.KTf)(e))}}const mp=(0,sn.P1)(((e,t)=>t.radioID),((e,t)=>t.preview),sn.LF,((e,t,a)=>(0,ln.tK)(e,"radios",a,{originalPreview:t,depth:3}))),up=(0,sn.P1)(((e,t)=>t.radioID),sn.LF,((e,t)=>(0,ln.tK)(e,"radios",t))),pp=(0,Ka.connect)(((e,t)=>{const a=mp(e,t),n=(0,sn._I)(e,me.Uo.Radio,a.get("id"));return{radio:a,originalRadio:up(e,t),isAvailable:n,currentUser:(0,sn.ib)(e)}}))(dp),gp=e=>Ta.createElement("div",{className:"row"},e.map((e=>{const t=e.getRel("album"),a=e.getRel("radio");return Ta.createElement("div",{className:tn.d9,key:a.getKey()},t?Ta.createElement(si.Z,{original:a,hidePlayableBtns:!0,metaContent:t.getSaleTypeName()||"播单",categoryContent:Ta.createElement("span",{className:t.getAttr("is-require-privilege")?"u_color-gpass":"original_category"},e.getAttr("is-latest")?"现已更新":a.getRelAttr("category","name")),title:t.getAttr("title"),titleMoreInfo:a.getAttr("title"),path:(0,Ir.ZP)(t)}):Ta.createElement(si.Z,{original:a}))}))),hp=()=>["data",Ca.namespace,"radios"],vp=(0,sn.TJ)([...hp(),"ids"]),Ep=e=>{let{page:t}=e;const a=(0,Ka.useSelector)(vp),n=(0,Ka.useSelector)((e=>e.getIn(hp())));return Ta.createElement(di.Z,null,Ta.createElement(ci.Z,{title:"播客"},Ta.createElement(oi.Z,{data:a,page:t,isRequesting:n.get("isRequesting"),fetched:n.get("fetched"),allPage:n.get("allPage"),linkBuilder:e=>(0,Ir.ZP)("radios",{page:e})},gp)))},fp=e=>e.getState().getIn(["player","playingItem","id"]),yp={path:"/radios",children:[{...(0,ii.r3)("radios"),async action(e){const{store:t,query:{page:a},isBrowserFirstLoad:n}=e,r=a?Number(a):1;return n||await t.dispatch(Ca.actions.getRadios(r,!0)),{preloadState:!0,component:Ta.createElement(Ep,{page:r})}}},{...(0,ii.r3)("radio"),children:[{...(0,ii.r3)("timelines"),async action(e){let{store:t,params:{id:a},query:{pi:n}={},isBrowserFirstLoad:i}=e;const s=Ta.createElement(Dc.Z,{title:"获取节目信息中..."});fp(t)===a&&n||await t.dispatch((0,l.lMO)(a,{},{shouldPlay:!1}));const o=fp(t)===a,c=o?await(async(e,t)=>{const a=t.getState(),n=a.getIn(["player","radio","id","id"]);let r="";if(e!==n){const a=await t.dispatch((0,l.CAj)(e)),{payload:n}=a;if((0,$e.GN)(a))throw n;r=n.data.attributes.title}else r=a.getIn(["entities","radios",n,"data","attributes","title"]);return r})(a,t):"请求中...";return t.dispatch((0,l.Lfj)(o?r.R9.FULLSCREEN:r.R9.MINI)),{title:c,component:!!i&&s,restoreScroll:!1,onRendered:o?void 0:()=>{Qa.ZP.replace(`/radios/${a}`)}}}}],async action(e){let{next:t,store:a,query:n,params:r,getCurrentUser:i}=e;const{preview:s}=n,o=(0,Ir.oD)(s),c=await t();if(c)return c;const d=await a.dispatch((0,l.k3z)({type:"radios",id:r.id},{includeQueryPush:["albums.album-bundles",...o.needInclude]}));return{...(0,Ir.xE)(d),htmlClassNames:["lightBg"],context:{navTransparent:!0},component:Ta.createElement(pp,{radioID:r.id,preview:o.draft})}}}]},bp={...(0,ii.r3)("userBookmarks"),async action(e){let{params:t,query:n,store:r}=e;const{Bookmarks:l}=await a.e(95).then(a.bind(a,98095)),{id:i}=t,{page:s=1,tab:o="radios"}=n,c=Number(s);return await r.dispatch(De.Z.actions.getBookmarks(i,o,c)),Ta.createElement(l,{userID:i,page:c,filter:o})}},kp={...(0,ii.r3)("userContent"),async action(e){let{params:t,store:n,query:r}=e;const{Content:l,contentFilters:i,contentValidTabs:s}=await a.e(95).then(a.bind(a,98095)),{id:o}=t,{tab:c,page:d}=r,m=(0,nn.CO)(d),u=((e,t,a)=>e.getState().getIn(["data","profilePage",t,"originals",a[0].key,"fetched"]))(n,o,i);u||await Promise.all(i.map((e=>e.key)).map((e=>n.dispatch(De.Z.actions.getOriginals(o,e,1)))));const p=s(n.getState(),o,c),g=c||p[0];return await n.dispatch(De.Z.actions.getOriginals(o,g,m)),Ta.createElement(l,{userID:o,validTabs:p,tab:g,page:m})}},Cp={...(0,ii.r3)("userSubscriptions"),async action(e){let{params:t}=e;const{Subscriptions:n}=await a.e(95).then(a.bind(a,98095)),{id:r}=t;return Ta.createElement(n,{userID:r})}},_p={...(0,ii.r3)("userTalks"),async action(e){let{params:{id:t}}=e;const{Talks:n}=await a.e(95).then(a.bind(a,98095));return Ta.createElement(n,{userId:t})}},wp={...(0,ii.r3)("userWorks"),async action(e){let{store:{dispatch:t},params:{id:n}}=e;const{Works:r}=await a.e(95).then(a.bind(a,98095));return Ta.createElement(r,{userId:n})}},Np={...(0,ii.r3)("userProducts"),async action(e){let{params:{id:t}}=e;const{Products:n}=await a.e(95).then(a.bind(a,98095));return Ta.createElement(n,{userId:t})}},Pp=async function(e,t,a){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const[r]=await Promise.all([e((0,l.PRA)(t,{includeQueryPush:["entities.involvements.entry"]})),...t===a?[e(De.Z.actions.getLatestUnmarkedMedals(t))]:[],e((0,V.D1)(`games/${tr.It}`)),...n?[e(De.Z.actions.getWorks(t,1))]:[]]);return r},Sp={path:"/users",children:[{...(0,ii.r3)("user"),children:[_p,kp,Cp,bp,wp,Np],async action(e){let{next:t,params:n,getCurrentUser:r,store:{dispatch:l,getState:i},pathname:s}=e;const{Layout:o}=await a.e(95).then(a.bind(a,98095)),{id:c}=n,d=r(),m=s.includes("works"),u=await(async(e,t,a,n,r)=>{const l=n.getIn(["entities","users",e]);return n.getIn(["data",De.Z.namespace,e])?{payload:{data:l.toJS()}}:await Pp(r,e,t,!a)})(c,null==d?void 0:d.get("id"),m,i(),l),p=(0,Ir.xE)(u,{titleKey:"nickname"}),g=await t(),[h,v]=g||[];if(!v){const e={redirect:(0,Ir.ZP)("userTalks",{id:c})};return h?[h,e]:e}const E={...p,context:{hideFooter:!0},component:Ta.createElement(o,{key:c,userId:c,standalone:m},v)};return h?[h,E]:E}}]};var Zp=a(14761),Ip=a(93760);const Tp=e=>{let{portfolio:t}=e;const a=t.getRel([["games",0]]),n=a&&Ta.createElement(tm.Z,{item:a});return Ta.createElement("div",{className:"flowLayout_head"},Ta.createElement("h1",null,t.getAttr("title")),Ta.createElement("p",null,t.getAttr("description")),n)};var Ap=a(30004),Rp=a(59170),Dp=a(57288),xp=a(85211);const Mp=e=>{let{portfolio:t,onConfirm:a}=e;const[n,r]=(0,Ta.useState)(!1),[l,i]=(0,Ta.useState)(!1),[s,o]=(0,Ta.useState)(!1),[c,d]=(0,Ta.useState)(!1);return Ta.createElement(Ta.Fragment,null,n&&Ta.createElement(xp.Z,{portfolioId:t.get("id"),onClose:e=>{r(!1),e.size>0&&(o(!1),a())}}),s&&Ta.createElement(Hm.Z,{visible:!0,options:[{title:"编辑合集",onClick:()=>{d(!0)}},{title:"移除",danger:!0,onClick:()=>{i(!0)}},{title:"取消",requestClose:!0}],onClose:()=>{o(!1)}}),c&&Ta.createElement(Dp.Z,{defaultValue:t,onConfirm:()=>{d(!1)},onClose:()=>{d(!1)}}),l&&Ta.createElement(Rp.Z,{portfolio:t,visible:!0,onClose:()=>{i(!1)},onSuccess:()=>{Qa.ZP.replace((0,Ir.ZP)("userWorks",{id:t.getRel("user","id")}))}}),Ta.createElement(Zm.Z,null,Ta.createElement("div",{className:"portfolioPage_buttons"},Ta.createElement(Ya.Z,{icon:["gfas","plus"],type:"secondary",onClick:()=>{r(!0)}},"添加"),Ta.createElement(Ya.Z,{type:"secondary",onClick:()=>{o(!0)}},"管理"),Ta.createElement(mn.Z,{type:"secondary",data:t,plain:!1,anchor:!1}))))},Lp=e=>{let{portfolio:t}=e;return Ta.createElement(Zm.Z,null,Ta.createElement("div",{className:"portfolioPage_buttons"},Ta.createElement(Fc.Z,{subscribable:t,block:!0,type:"primary",ellipse:!1,icon:["gfas","plus"]}),Ta.createElement(mn.Z,{type:"secondary",data:t,plain:!1,anchor:!1})))},qp=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["data",Ie.namespace,...e]},Fp=(0,$c.P1)(((e,t)=>{let{portfolioId:a}=t;return a}),sn.LF,((e,t)=>(0,ln.tK)(e,"portfolios",t))),Bp=(0,$c.P1)((e=>e.getIn(qp(["works","ids"]))),sn.LF,((e,t)=>(0,ln.BY)(e,t,{depth:3}).map((e=>e.getRel(e.getAttr("content-key")))).filter((e=>e)))),Op={dispatchGetWork:Ie.actions.getWorks,dispatchRemoveFromPortfolio:Ie.actions.removeFromPortfolio},Up=(0,Ka.connect)(((e,t)=>({works:Bp(e),worksState:e.getIn(qp(["works"])),portfolio:Fp(e,t),currentUser:(0,sn.ib)(e)})),Op)((e=>{let{works:t,worksState:a,portfolioId:n,portfolio:r,currentUser:l,dispatchGetWork:i,dispatchRemoveFromPortfolio:s}=e;const o=r&&r.getRel("user","id"),c=(null==l?void 0:l.get("id"))===o,d=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(a.get("currentPage")??0)+1;t&&await i(e,t,r)}),[n,o,a,i]),m=(0,yr.II)(d),u=(0,Ta.useCallback)((async()=>{n&&o&&await m.current(n,o,1)}),[n,o,m]),p=(0,yr.n5)(u),g=(0,Ta.useCallback)((()=>r?Ta.createElement(Ta.Fragment,null,c?Ta.createElement(Zp.OS,{top:!0},Ta.createElement(Mp,{portfolio:r,onConfirm:u})):Ta.createElement(Zp.OS,{top:!0},Ta.createElement(Lp,{portfolio:r})),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null))):null),[c,r,u]);return r?Ta.createElement(Zp.ZP,{renderSide:g,className:"topicPage"},Ta.createElement(Ip.Z,{backTo:(0,Ir.ZP)("userWorks",{id:o})},Ta.createElement(Tp,{portfolio:r}),Ta.createElement(Cn.Z,{data:t,state:a,onLoad:d,onInit:p,limitForGuest:!0,limitTextForGuest:"登录后查看更多作品"},(0,Gc.rE)({talkProps:{showPortfolioOptions:!0,onRemoveFromPortfolio:e=>{s("talks",e)}},originalProps:{showPortfolioOptions:!0,onRemoveFromPortfolio:(e,t)=>{s(e,t)}}})))):null})),$p={...(0,ii.r3)("portfolio"),async action(e){let{params:{id:t},store:a}=e;const n=await a.dispatch(Ie.actions.getPorfolio(t));return{...(0,Ir.xE)(n,{titleFormat:e=>`${e} | 作品集`}),context:{hideFooter:!0},component:Ta.createElement(Up,{portfolioId:t})}}},Gp=(0,sn.P1)(((e,t)=>t.categoryID),sn.LF,((e,t)=>(0,ln.tK)(e,"categories",t))),zp=(0,sn.P1)((e=>e.getIn(["data","categoryPage","ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Hp=(0,Ka.connect)(((e,t)=>({originals:zp(e,t),category:Gp(e,t),pageState:e.getIn(["data","categoryPage"])})))((e=>{let{page:t,tab:a,category:n,originals:r,pageState:l}=e;return Ta.createElement(dd,{tab:a,page:t,name:n.getAttr("name"),logo:n.getAttr("logo"),desc:n.getAttr("desc"),actions:Ta.createElement("span",null,n.getAttr("subscriptions-count")," 人已订阅",Ta.createElement(Fc.Z,{subscribable:n,className:"ms-3"})),getLink:e=>{let{tab:t,page:a}=e;return(0,Ir.ZP)("category",{id:n.get("id"),page:a,tab:t})},pageState:l,originals:r})})),Vp={...(0,ii.r3)("categories"),children:[{...(0,ii.r3)("category"),async action(e){let{store:t,params:a,query:n,isPathnameChangedNotBrowserFirst:r,isBrowserFirstLoad:i}=e;const s=(0,nn.CO)(n.page),o=n.tab||"originals",c=a.id;let d;r&&(d=await t.dispatch((0,l.n37)(c))),i||await t.dispatch((0,l.fcw)(c,o,s));return{...(0,Ir.xE)(d,{titleKey:"name",imageKey:"background",fromState:{store:t,type:"categories",id:c}}),preloadState:!0,context:{navTransparent:!0},component:Ta.createElement(Hp,{categoryID:c,page:s,tab:o})}}}]},Wp=(e,t)=>{if(!e)return!1;if(e.error)return{type:r.ZQ.ERROR,text:e.payload.message};const{entities:a,result:n}=e.payload,l=n.id,i=a.getIn(["drafts",l,"relationships","user","data","id"]),s=a.getIn(["users",i,"attributes","nickname"]);if(!a.getIn(["drafts",l,"attributes","is-published"])&&t.get("id")!==i){const e=(0,rn.Sy)(a.getIn(["drafts",l,"attributes","updated-at"]));return t.isStaff()?{type:r.ZQ.WARNING,text:`当前文章于${e}被${s?`用户 ${s} `:"其他用户"}修改。`,author:s}:{type:r.ZQ.ERROR,text:`当前文章于${e}被${s?`编辑 ${s} `:"其他编辑"}修改，请稍后再试或联系审稿编辑。`,author:s}}return!1},jp=(e,t)=>{if(!e)return!1;let a=((e,t)=>{if(!e)return!1;if(e.error)return{type:r.ZQ.ERROR,text:e.payload.message};const{entities:a,result:n}=e.payload,l=a.getIn([n.type,n.id]).getIn(["relationships","user","data","id"]);return!t.isStaff()&&t.get("id")!==l&&{type:r.ZQ.ERROR,text:"没有权限编辑此文章"}})(e,t);if(a)return a;const{entities:n,result:l}=e.payload,i=n.getIn([l.type,l.id,"relationships","draft","data","id"]),s=n.getIn(["drafts",i]);return a=Wp(s&&{payload:{result:{type:"drafts",id:i},entities:n}},t),a||!1},Kp=e=>("string"==typeof e?new Date(e):e).getTime()-(new Date).getTime()>=72e5;var Jp=a(21906),Yp=a(86757),Xp=a(19718),Qp=a(89307),eg=a(71395);const tg=e=>Ta.createElement("span",{className:(0,Ma.Z)("story_censor_span")},e.children),ag=e=>e&&Object.keys(e.texts||{}).length>0,ng=e=>{if(!ag(e))return[];const t=[];Object.values(e.texts).forEach((e=>{e.forEach((e=>{let{value:a}=e;t.push(a)}))}));return t.reduce(((e,a)=>(1===a.length&&t.find((e=>{e.length>a.length&&e.includes(a)}))||e.push(a),e)),[])};class rg extends Xa.Z{state={editorState:null,editedBlocks:(0,k.Set)()};constructor(e){super(e),this.initStateData(e)}needChangeEditorState=e=>{const{onTriggerEditorStateChange:t}=this.props;if(!t)return null;const a=t(this.state.editorState,e);return a&&this.handleChange(a),a};render(){const{editorState:e,editedBlocks:t}=this.state,{currentUser:a,...n}=this.props;return Ta.createElement(Qp.ZP,(0,Aa.Z)({},n,{editedBlocks:t.toArray(),editorState:e,onChange:this.handleChange,handleKeyCommand:this.handleKeyCommand}))}initStateData(e){const{rawContent:t,onContentInited:a,censorLabels:n}=e,r=this.createDecorators(n),{editorState:l}=(0,Qp._s)(t,r);this.state={editorState:l,editedBlocks:(0,k.Set)()},a(l.getCurrentContent())}createDecorators=e=>{const t=[eg.e];return ng(e).length>0&&t.unshift({strategy:this.handleCensorStrategy,component:tg}),t};handleCensorStrategy=(e,t)=>{const{censorLabels:a}=this.props;((e,t,a)=>{const n=ng(e);if(!ag(e)||0===n.length||!Object.keys(e.texts).includes(t.getKey()))return;const r="[^.;!?。；！？]",l=`${r}*(${n.join("|")})${r}*`;((e,t,a)=>{const n=t.getText();let r,l;for(;null!==(r=e.exec(n));)l=r.index,a(l,l+r[0].length)})(new RegExp(l,"g"),t,a)})(a,e,t)};removeBlock=()=>{const{onAfterDelBlock:e}=this.props,{editorState:t}=this.state,a=t.getCurrentContent(),n=t.getSelection(),r=n.getStartKey(),l=a.getFirstBlock(),i=l.getKey(),s=a.getBlockForKey(r),o=s.getType(),c=a.getKeyBefore(r),d=c&&a.getBlockForKey(c).getType();let m;return"atomic"===o?m=s:(r===i?m=l:"atomic"===d&&(m=s),m&&0===m.getText().length&&r===n.getEndKey()||(m=null)),m&&this.handleChange((0,Qp.N$)(t,m.getKey()),(()=>{e&&e(t,m)})),m};handleKeyCommand=e=>{const{handleKeyCommand:t}=this.props;let a=t?t(e):null;return"backspace"===e&&(a=this.removeBlock()||a),a?Qp.dX:Qp.FB};handleChange=(e,t,a)=>{const n=e.getCurrentContent(),r=this.state.editorState.getCurrentContent();(a||n!==r)&&this.props.onContentChange(n),this.checkEditedTextBlock(r,n),this.setState({editorState:e},(()=>{t&&"function"==typeof t&&setTimeout(t,0)}))};checkEditedTextBlock=(e,t)=>{const{censorLabels:a}=this.props,n=null==a?void 0:a.texts,r=Object.keys(n||{});if(n&&0!==r.length)for(const a of r){var l,i;(null===(l=e.getBlockForKey(a))||void 0===l?void 0:l.getText())!==(null===(i=t.getBlockForKey(a))||void 0===i?void 0:i.getText())&&this.setState((e=>{let{editedBlocks:t}=e;return{editedBlocks:t.add(a)}}))}}}const lg=(0,Ka.connect)((e=>({currentUser:(0,sn.ib)(e)})),null,null,{forwardRef:!0})(rg);var ig=a(30213);var sg=a(10671);const og=(0,sn.TJ)(["data","editor","medias","ids"]),cg=(0,sn.TJ)(["data","editor","searchedMedias","ids"]),dg=e=>{let{original:t,onChange:a}=e;const[n,r]=(0,Ta.useState)(""),l=n.length>0,i=(0,Ka.useDispatch)(),s=t.getRel("media"),o=(0,Ka.useSelector)(og),c=(0,Ka.useSelector)((e=>e.getIn(["data","editor","medias"]))),d=(0,Ka.useSelector)(cg),m=(0,Ka.useSelector)((e=>e.getIn(["data","editor","searchedMedias"]))),u=l?d:o,p=l?m:c,{props:g,ref:h}=(0,sl.kL)("originalEditor_media_list"),v=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:((null==p?void 0:p.get("currentPage"))??0)+1;e?await i(le.actions.searchMedias({query:e},{page:t})):await i(le.actions.getMedias(t))}),[i,p,n]),E=(0,yr.II)(v),f=(0,Ta.useCallback)((async()=>{var e;null===(e=h.current)||void 0===e||e.scrollToTop(),await E.current(n,1)}),[n,E,h]),y=e=>{const n=e.target.value;a(t.setIn(["relationships","media"],(0,k.fromJS)({data:{type:"medias",id:n}})).setIn(["attributes","reference-id"],n))};return Ta.createElement("div",{className:"originalEditor_media"},Ta.createElement("p",{className:"originalEditor_media_chosen"},s&&`当前选中：${s.getAttr("title")}`||"选择媒体文件"),Ta.createElement(sg.Z,{showCancel:l,onSearch:e=>{r(e)},onCancelClick:()=>{r("")}}),Ta.createElement(Cn.Z,{data:u,state:p,onLoad:v,onInit:f,scrollableProps:{...g,bottomOffset:150}},(e=>Ta.createElement("ul",null,e.map((e=>Ta.createElement("li",{key:e.getKey()},Ta.createElement("input",{id:e.getKey(),type:"radio",name:"medias",value:e.get("id"),onChange:y,className:"me-1",checked:(null==s?void 0:s.get("id"))===e.get("id")}),Ta.createElement("label",{htmlFor:e.getKey()},e.getAttr("title")))))))))};class mg extends Xa.Z{static contextType=Ua.qe;constructor(e){super(e),this.state={isMediasModalVisible:!1,uploaderMsg:null,uploaderDisabled:!1,taptaipUploaderUrl:void 0}}componentDidMount(){const{mode:e}=this.props;window.addEventListener("message",this.handleUpload),"upload"===e&&this.getTaptapUploaderUrl()}componentDidUpdate(e){const{mode:t}=this.props,{taptaipUploaderUrl:a}=this.state;t!==e.mode&&"upload"===t&&void 0===a&&this.getTaptapUploaderUrl()}componentWillUnmount(){window.removeEventListener("message",this.handleUpload)}render(){const{original:e,currentUser:t,mode:a}=this.props,{uploaderDisabled:n}=this.state,r=e.getAttr("hosted-media-key"),l=e.getRel("media"),i=!r&&!l&&"videos"===e.get("type")&&t.isStaff(),s="choose"===a?this.renderMediasChoose():this.renderUploader();return Ta.createElement(Ta.Fragment,null,i&&Ta.createElement("div",{className:"text-center"},Ta.createElement("div",{className:"form-check form-check-inline mb-3"},Ta.createElement("input",{id:"modeChoose",type:"checkbox",className:"form-check-input me-1",checked:"choose"===a,onChange:this.handleSwitchChange}),Ta.createElement("label",{className:"form-check-label",htmlFor:"modeChoose"},"使用媒体选择模式"))),Ta.createElement("div",{className:"originalEditor_mediaContainer"},Ta.createElement("div",{className:(0,Ma.Z)("originalEditor_widget",`originalEditor_widget-${e.get("type")}`,{"originalEditor_widget-uploader":"upload"===a,"originalEditor_widget-uploader-disabled":n})},s)))}changeData(e){const{onChange:t}=this.props;t(e)}getTaptapUploaderUrl(){const{dispatch:e}=this.props;e((0,V.D1)("partner/taptap-uploader?format=json")).then((e=>{var t,a;const n=null==e||null===(t=e.payload)||void 0===t||null===(a=t.origin)||void 0===a?void 0:a.url;this.setState({taptaipUploaderUrl:n||null})}))}handleSwitchChange=e=>{this.props.onModeSwitch(e.target.checked?"choose":"upload")};handleUpload=e=>{const{original:t}=this.props,a=e.data;if(!a.data)return;const{fileName:n}=a.data;switch(a.status){case"process":this.setState({uploaderMsg:`${a.data.process}%`,uploaderDisabled:!0});break;case"fail":this.setState({uploaderMsg:"上传失败",uploaderDisabled:!1}),alert(`上传失败：', ${a.data.msg}`);break;case"success":this.setState({uploaderMsg:null,uploaderDisabled:!1}),this.changeData(t.mergeDeep((0,k.fromJS)({attributes:{"hosted-media-key":a.data.key,"hosted-media-filename":n}}))),a.data.key}};handleOpenMediasModalClick=()=>{this.setState({isMediasModalVisible:!0})};handleMediasModalClose=()=>{this.setState({isMediasModalVisible:!1})};renderMeidaPopbox(){const{original:e,onChange:t}=this.props,{isMediasModalVisible:a}=this.state;return Ta.createElement(_n.Z,{visible:a,title:"选择关联媒体",onCloseClick:this.handleMediasModalClose,onConfirmClick:this.handleMediasModalClose,shouldConfirmOnPressEnter:!1},Ta.createElement(dg,{original:e,onChange:t}))}renderUploader(){if("Safari"===this.context.env.uaParser.getBrowser().name)return"暂不支持 Safari 上传, 建议使用 Chrome 浏览器";const{taptaipUploaderUrl:e}=this.state;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"originalEditor_widget_btn"},void 0===e?"上传组件加载中...":null===e?"上传组件加载失败":"已加载"),e&&Ta.createElement("div",{className:"originalEditor_widget_taptap"},Ta.createElement("iframe",{title:"taptap",width:"100%",height:"100%",src:e})))}renderMediasChoose(){const{original:e}=this.props,t=e.getRel("media");return Ta.createElement(Ta.Fragment,null,Ta.createElement(Ya.Z,{className:"originalEditor_widget_btn",plain:!0,anchor:!0,onClick:this.handleOpenMediasModalClick},t?t.getAttr("title"):"关联媒体"),this.renderMeidaPopbox())}}const ug=mg;var pg=a(39301),gg=a(52803);const hg=e=>Ta.createElement(gg.ZP,e,(t=>Ta.createElement(gg.r0,(0,Aa.Z)({},t,e))));var vg=a(83432),Eg=a(42047),fg=a(74974),yg=a(9198),bg=a.n(yg);a(31307);(0,yg.registerLocale)("zh-CN",fg.Z);const kg=e=>Ta.createElement(bg(),(0,Aa.Z)({popperPlacement:"top-start",preventOverflow:{enabled:!0,boundariesElement:"scrollParent"},locale:"zh-CN",timeFormat:"HH:mm",timeIntervals:30,dateFormat:"yyyy-M-d HH:mm",timeCaption:"时间",placeholderText:"选择时间"},e));var Cg=a(28816),_g=a(27484),wg=a.n(_g);const Ng={include:["role"]},Pg=e=>{const t=e.get("type");return{value:{id:e.get("id"),type:t},label:e.getTitle()}},Sg=(e,t)=>{const{id:a}=t;return Ta.createElement("div",{className:"form-check"},Ta.createElement("input",(0,Aa.Z)({className:"form-check-input",type:"checkbox"},t)),Ta.createElement("label",{className:"form-check-label",htmlFor:a},e))};class Zg extends Ta.PureComponent{getSelectedTEE=()=>{const{original:e}=this.props,t=this.getSelectedTags().normal;return e.getRel("entries",[],(0,k.List)()).concat(e.getRel("entities",[],(0,k.List)())).concat(t).map((e=>Pg(e))).toJS()};getSelectedTags=()=>{const{original:e}=this.props,t=e.getRel("tags",[],(0,k.List)());if(!this.shouldShowRadioCatalogs())return{normal:t,catalog:(0,k.List)()};const a=this.getRadioCatalogTags().map((e=>e.get("id")));let n=(0,k.List)(),r=(0,k.List)();return t.forEach((e=>{a.includes(e.get("id"))?r=r.push(e):n=n.push(e)})),{normal:n,catalog:r}};getRadioCatalogTags=()=>{const{radioCatalogs:e}=this.props;return null==e?void 0:e.map((e=>e.getRel("tag"))).filter((e=>e))};shouldShowRadioCatalogs=()=>{const{original:e,currentUser:t}=this.props;return t.isStaff()&&"radios"===e.get("type")};filterCategories(){const{categories:e,original:t,currentUser:a}=this.props,{normalUserCategoryIds:n,page2077CategoryId:r}=tr.default;return e?e.filter((e=>!(e.get("id")===tr.default.category.NEWS&&["radios","videos"].includes(t.get("type")))&&(a.isStaff()||n.includes(e.get("id"))))).sort(((e,t)=>e.get("id")===r?-1:t.get("id")===r?1:0)):e}changeOriginal(e){const{onChange:t}=this.props;t(e)}handleCategoryChange=(e,t)=>{if(!e)return;const{original:a}=this.props;this.changeOriginal(a.setIn(["relationships","category"],(0,k.fromJS)({data:{type:"categories",id:e.value}})))};handleCheckboxChange(e,t){const{original:a}=this.props,{checked:n}=t.target,r={type:e,id:t.target.value},l=n?a.pushItemToRelList(e,r):a.deleteItemInRelList(e,r);this.changeOriginal(l)}handleSuperTagChange=this.handleCheckboxChange.bind(this,"tags");handleImageChange=(e,t)=>{const{original:a}=this.props;this.changeOriginal(a.setIn(["attributes",e],t))};handleThumbImageChange=this.handleImageChange.bind(this,"thumb");handleCoverImageChange=this.handleImageChange.bind(this,"cover");handleSelectedChange=(()=>{var e=this;return function(t,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,k.Map)();if(!(t instanceof Array))return;const{original:r}=e.props;let l=n;t.forEach((e=>{const t=a(e.value.type);l=l.update(t,(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,k.Map)({data:(0,k.List)()})).update("data",(t=>t.push((0,k.Map)({type:e.value.type,id:e.value.id}))))}))}));const i=r.update("relationships",(e=>e.merge(l)));e.changeOriginal(i)}})();handleDjSelectedChange=e=>{const{original:t}=this.props;this.handleSelectedChange(e,(()=>"djs"),(0,k.fromJS)({djs:{data:[]}})),(null==e?void 0:e.length)>1&&t.isVideo()&&t.getAttr("work-enabled")&&setTimeout((()=>{this.handleWorkPropertiesChange(gg.s0)}),300)};handleTEESelectedChange=e=>{const t=this.getSelectedTags().catalog;this.handleSelectedChange(e,(e=>(0,z.lt)(e)),(0,k.fromJS)({entities:{data:[]},entries:{data:[]},tags:{data:t.map((e=>(0,k.fromJS)(e.toUnique())))}}))};handleCatalogTagsChange=(e,t)=>{const{original:a}=this.props,n=this.getSelectedTags().normal;this.handleSelectedChange(e,(()=>"tags"),(0,k.fromJS)({entities:a.getIn(["relationships","entities"]),entries:a.getIn(["relationships","entries"]),tags:{data:n.map((e=>(0,k.fromJS)(e.toUnique())))}}))};handleAdminOptionChange=(e,t)=>{this.changeOriginal(this.props.original.setIn(["attributes",e],t.target.checked))};handleAdminOptionOfficialChange=this.handleAdminOptionChange.bind(this,"option-is-official");handleAdminOptionFocusShowcasesChange=this.handleAdminOptionChange.bind(this,"option-is-focus-showcase");handlePublishedTimeChange=e=>{this.changeOriginal(this.props.original.setIn(["attributes","published-at"],e.toString()))};handleWorkPropertiesChange=e=>{const{relationships:t,attributes:a}=(0,Cg.Pj)(e);this.changeOriginal(this.props.original.update("attributes",(e=>e.merge(a))).update("relationships",(e=>e.merge((0,k.fromJS)(t)))))};handleDurationInputChange=e=>{const{original:t}=this.props;let a=Number(e.target.value);Number.isNaN(a)&&(a=0),this.changeOriginal(t.setIn(["attributes","hosted-media-duration"],Number(a)))};renderThumb(){const{original:e,censorLabels:t}=this.props,a=null==t?void 0:t.images;let n="封面图上传";"articles"===e.get("type")?e.isNews()?n+="，建议尺寸为 1080 x 734":n+="，建议尺寸为 1080 x 506":"videos"===e.get("type")&&(n+="，建议尺寸为 1080 x 506");const r=e.getAttr("thumb"),l=e.getAttr("cover"),i=Ta.createElement(ym.Z,{labels:null==a?void 0:a.includes(r),withLabel:!0},Ta.createElement(vg.Z,{image:r,onChange:this.handleThumbImageChange,tip:n,className:"originalEditor_thumbUploader"})),s=Ta.createElement(ym.Z,{labels:null==a?void 0:a.includes(l),withLabel:!0},Ta.createElement(vg.Z,{image:l,onChange:this.handleCoverImageChange,tip:"方图上传",className:"originalEditor_coverUploader"})),o="radios"===e.get("type")?Ta.createElement("div",{className:"row"},Ta.createElement("div",{className:"col-7"},i),Ta.createElement("div",{className:"col-5"},s)):i;return Ta.createElement("div",{className:"originalEditor_imageUploaders"},o)}renderSuperTags(){const{original:e}=this.props,t=e.getIn(["relationships","tags","data"],[]).map((e=>e.get("id")));return Ta.createElement("div",{className:"row text-nowrap"},Object.keys(r.qP).map((e=>{const a=r.qP[e];return Ta.createElement("div",{className:"col-3",key:e},Sg(a.name,{onChange:this.handleSuperTagChange,checked:t.includes(a.id),id:`t_superTag_${a.id}`,value:a.id}))})))}renderTEE(){const e=this.getSelectedTEE();return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"mb-2"},this.renderSuperTags()),this.shouldShowRadioCatalogs()&&Ta.createElement("div",{className:"mb-2"},this.renderRadioCatalogTags()),Ta.createElement(Eg.Z,{isMulti:!0,placeholder:"标签（选填）",tagCreatable:!0,searchType:"tee",value:e,onChange:this.handleTEESelectedChange}))}renderRadioCatalogTags(){const e=this.getRadioCatalogTags();if(!(e&&e.size>0))return null;const t=this.getSelectedTags().catalog;return Ta.createElement(on.ZP,{isMulti:!0,loadingMessage:e=>{let{inputValue:t}=e;return`正在搜索"${t}"...`},noOptionsMessage:()=>"输入关键词快速查找",options:e.map((e=>({label:e.getAttr("name"),value:e.toUnique()}))).toJS(),className:"react-select",classNamePrefix:"react-select",getOptionValue:e=>{let{value:{type:t,id:a}}=e;return`${t}${a}`},value:t&&t.size>0?t.map((e=>({label:e.getAttr("name"),value:e.toUnique()}))).toJS():void 0,onChange:this.handleCatalogTagsChange,placeholder:"分类（必填）"})}renderDjs(){const{original:e,currentUser:t}=this.props,a=e.getRel("djs"),n=a?a.map((e=>Pg(e))).toJS():void 0;return Ta.createElement(Eg.Z,{isMulti:!0,placeholder:"参与者",searchType:"users",searchRequestOptions:t.isStaff()?Ng:void 0,value:n,onChange:this.handleDjSelectedChange})}renderCategories(){const{original:e}=this.props,t=this.filterCategories();if(!(t&&t.size>0))return null;const a=e.getRel("category","id");return Ta.createElement(on.ZP,{loadingMessage:e=>{let{inputValue:t}=e;return`正在搜索"${t}"...`},noOptionsMessage:()=>"输入关键词快速查找",options:t.map((e=>({label:e.getAttr("name"),value:e.get("id")}))).toJS(),className:"react-select",classNamePrefix:"react-select",value:a?{label:e.getRelAttr("category","name"),value:a}:void 0,onChange:this.handleCategoryChange,placeholder:"请选择频道"})}renderVideoDuration(){const{original:e}=this.props,t=e.getAttr("hosted-media-duration");return Ta.createElement("input",{placeholder:"视频时长（秒）",className:"form-control",type:"number",onChange:this.handleDurationInputChange,value:t?`${t}`:""})}renderAdminArea(){const{original:e}=this.props;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"overflow-hidden originalEditor_modal_section"},Ta.createElement("div",{className:"row"},Ta.createElement("div",{className:"col-6"},Sg("官方",{checked:e.getAttr("option-is-official"),onChange:this.handleAdminOptionOfficialChange,id:"t_official_checkbox"})),Ta.createElement("div",{className:"col-6"},Sg("焦点",{checked:e.getAttr("option-is-focus-showcase"),onChange:this.handleAdminOptionFocusShowcasesChange,id:"t_focus_checkbox"})))),Ta.createElement("div",{className:"originalEditor_modal_section"},this.renderCustomReco()))}renderPublishedAt(){const{original:e,currentUser:t}=this.props,a=t.isStaff();if(!a&&0!==e.getAttr("is-published"))return null;const n=e.getAttr("published-at");return Ta.createElement(Qn.cw,{label:"定时"},Ta.createElement("div",{className:"originalEditor_modal_datePicker"},Ta.createElement(kg,{className:"form-control",selected:n&&new Date(n),onChange:this.handlePublishedTimeChange,showTimeInput:!0,showTimeSelect:!0,filterDate:e=>{const t=wg()().startOf("day").toDate();return a||e>=t},filterTime:e=>a||Kp(e),placeholderText:"定时发布时间（选填）"})))}renderCustomReco(){var e;const{original:t}=this.props;return Ta.createElement("div",null,Ta.createElement(pg.Z,{isMulti:!0,className:"react-select",classNamePrefix:"react-select",value:null===(e=t.getAttr("reco-override"))||void 0===e?void 0:e.map((e=>({label:String(e),value:String(e)}))).toJS(),onChange:e=>{this.changeOriginal(t.setIn(["attributes","reco-override"],(0,k.List)(e.map((e=>e.value)))))},placeholder:"自定义关联内容id"}),Ta.createElement("div",{className:"text-muted u_fontSize-sm mt-2"},"最多填 3 个，不足的由系统推荐补齐"))}renderWorkProperties(){var e;const{currentUser:t,original:a}=this.props;if(a.isRadio()||(null===(e=a.getRel("djs"))||void 0===e?void 0:e.size)>1)return;const n=a.getRel("user","id");return Ta.createElement(hg,{userId:n||t.get("id"),portfolioEnabled:!n||n===t.get("id"),work:a,onChange:this.handleWorkPropertiesChange,initialValuesOnce:!0})}render(){const{original:e,currentUser:t,uploadMode:a}=this.props,n="upload"===a;return Ta.createElement("div",{className:"originalEditor_modal"},Ta.createElement(Qn.cw,{label:"图片"},this.renderThumb()),Ta.createElement(Qn.cw,{label:"频道"},this.renderCategories()),e.isVolume()&&t.isStaff()&&Ta.createElement(Qn.cw,{label:"参与者"},this.renderDjs()),Ta.createElement(Qn.cw,{label:"标签"},this.renderTEE()),n&&Ta.createElement(Qn.cw,{label:"视频时长"},this.renderVideoDuration()),t.isStaff()&&Ta.createElement(Qn.cw,{label:"管理"}," ",this.renderAdminArea()),this.renderPublishedAt(),this.renderWorkProperties())}}const Ig=Zg,Tg=28e4;class Ag extends Xa.Z{static defaultProps={originalID:null,currentUser:null,isRequesting:!1};static contextType=Ua.qe;static getDerivedStateFromProps(e,t){const{original:a}=t,{original:n}=e;let r=a;!a.get("id")&&n.get("id")&&(r=a.set("id",n.get("id")));const l=["relationships","draft"],i=n.getIn([...l,"data","id"]);return a.getIn([...l,"data","id"])!==i&&(r=r.setIn(l,(0,k.fromJS)({data:{type:"drafts",id:i}}))),r!==a?{original:r}:null}state={original:this.props.original,savedTime:new Date,isNextModalOpen:!1,initEditor:!1,networkStatus:null,mode:this.getInitMode(),editedAttrs:(0,k.Set)()};componentDidMount(){this.setState({initEditor:!0}),this.prevWorkEnabled=this.props.original.getAttr("work-enabled")}componentWillUnmount(){this.lazySave.clear()}render(){const{currentUser:e,censorLabels:t}=this.props,{original:a,initEditor:n}=this.state;return Ta.createElement(Ta.Fragment,null,this.renderNextModal(),this.renderNav(),this.renderFixedTip(),Ta.createElement("div",{className:"originalEditor"},!1,a.isVolume()&&this.renderMediaWidget(),this.renderCoverTitle(),Ta.createElement("div",{className:(0,Ma.Z)("originalEditor_main story_container",{story_enableImagePos:!a.isArticleNews()})},n&&Ta.createElement(lg,{placeholder:"请在此输入，建议内容控制在两万字、图片百张以内",ref:this.refContentEditor,rawContent:a.getAttr("content"),onContentInited:this.handleContentInited,onContentChange:this.handleContentChange,onTriggerEditorStateChange:this.handleTriggerEditorStateChange,adminMode:e&&e.isStaff(),imageAdvancedPosition:!a.isArticleNews(),onAfterDelBlock:this.handleAfterDelBlock,censorLabels:t}))))}rawContent=null;prevWorkEnabled=void 0;refDesc=null;refDescBind=e=>{this.refDesc=e};refContentEditor=Ta.createRef();getInitMode(){const{original:e}=this.props;if(!e.isVolume())return null;if("radios"===e.get("type"))return"choose";const t=e.getAttr("hosted-media-key"),a=e.getRel("media");return!t&&a?"choose":"upload"}jumptoShowPage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.error)return;const{result:a}=e.payload;Qa.ZP.replace((0,Ja.D)(a.type,a.id,t?{preview:"draft"===t?1:2}:void 0))}setOriginal(e,t){this.setState({original:e,networkStatus:null},t),this.lazySave.start()}checkContentMinLength=e=>{const{currentUser:t}=this.props;if(t.isStaff())return!0;const a=(0,tn.tg)(e,2e3),n=(0,tn.N5)(e);return a.length>=1e3||n.length>=10};sendCheckedMsg=e=>{this.context.sendMessage({body:e,type:r.ZQ.WARNING})};checkData=e=>{var t;const{currentUser:a}=this.props,n=a.isStaff()||[tr.ad].includes(a.get("id"));if(e.dataAttributes["work-enabled"]&&0===(null===(t=e.relationships["catalog-tags"])||void 0===t?void 0:t.length))return this.sendCheckedMsg("原创内容必须选择分区"),!1;if(!n){if("true"===_().get(w.default.cookie_keys.writingCooldown))return this.sendCheckedMsg("内容发布过于频繁，请稍后再试"),!1;const t=e.dataAttributes["published-at"];if(t&&!Kp(t))return this.sendCheckedMsg("发布时间定时必须在2小时后"),!1;const a=e.dataAttributes.content;if("articles"===e.type&&e.categoryID!==tr.default.category.NEWS&&!this.checkContentMinLength(a))return this.sendCheckedMsg("内容要求文字超过 1000 字或图片超过 10 张"),!1;if(a.length>Tg)return this.sendCheckedMsg("内容过长，请适当删减文字和图片"),!1}let r=!0;return(0,ig.Hd)(e,((e,t,a)=>!!["id","draftID","dataAttributes.published-at","dataAttributes.cover","dataAttributes.reco-override","relationships.tags"].includes(a)||(null!=e&&""!==e||(this.sendCheckedMsg((e=>{const t=(0,tn.cn)(e);return["title","desc"].includes(e)?`${t}未填写`:"thumb"===e?"封面图未上传":/hosted-media-(key|filename)/.test(e)?"视频未上传":"hosted-media-duration"===e?"视频时长未填写":"mediaID"===e?"请关联音视频文件":"categoryID"===e?"未选择频道":`${t}不能为空`})(t)),r=!1,r)))),r};localSave=()=>{const e="localDrafts-v1";try{const{original:t}=this.state,a=t.get("id")||"new",n=q()(e)||{};let{drafts:r}=n[a]||{drafts:[]};if(r.unshift(this.rawContent),r=r.slice(0,10),n[a]={drafts:r,updatedAt:new Date},Object.keys(n).length>10){const e=Object.keys(n).reduce(((e,t)=>new Date(n[e].updatedAt).getTime()>new Date(n[t].updatedAt).getTime()?t:e));delete n[e]}q()(e,n)}catch(t){0,q().remove(e)}};save=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{original:a}=e.state,{dispatch:n,isRequesting:l,currentUser:i}=e.props;if(l)return Promise.reject();const s=a.get("id");return a.getIn(["relationships","draft","data","id"])?n((0,V.D1)(`originals/${s}/draft`,{include:["user"],meta:{noEntitiesUpdate:!0}})).then((a=>{if(a.error)return e.setNetworkStatus(a.error),Promise.reject();const n=Wp(a,i);return n?n.type===r.ZQ.WARNING?window.confirm(`${n.text} 是否强制覆盖？`)?e.saveRequest(t):Promise.reject():(e.context.sendMessage({showMode:"pop",body:n.text,type:n.type}),Promise.reject()):e.saveRequest(t)})):e.saveRequest(t)}})();lazySave=function(e){let t,{timeout:a=5e3,beforePerform:n=(()=>!0)}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=()=>{t||(t=setTimeout((()=>{t=null;n()?e():r()}),a))};return{start:r,clear:()=>{t&&(clearTimeout(t),t=null)}}}(this.save,{timeout:1e4,beforePerform:()=>{const{isRequesting:e}=this.props;return!e}});saveRequest=e=>{const{original:t,mode:a}=this.state,{dispatch:n,currentUser:r}=this.props,i=!t.get("id"),s=t.get("type"),o=t.getIn(["relationships","user","data","id"]),c=o||r.get("id"),d=t.getIn(["relationships","category","data","id"]);let m=t.getAttr("published-at");r.isStaff()?e&&!m&&(m=(new Date).toString()):0!==t.getAttr("is-published")&&(m=void 0);const u=t.getRel("tags"),p=t.getRel("entities"),g=t.getRel("entries"),h=t.getRel("djs"),v=t.getRel("portfolios"),E=t.getIn(["relationships","catalog-tags","data"]),f={id:t.get("id"),type:s,categoryID:d,...i?{userID:c}:{},...t.isRadio()||t.isVideo&&"choose"===a?{mediaID:t.getIn(["relationships","media","data","id"])}:{},relationships:{...k.List.isList(u)?{tags:u.map((e=>e.toUnique())).toJS()}:{},...t.isVolume()&&(r.isStaff()||i)?{djs:k.List.isList(h)&&h.size>0?h.map((e=>e.toUnique())).toJS():void 0}:{},...k.List.isList(v)&&(i||o===r.get("id"))?{portfolios:v.map((e=>e.toUnique())).toJS()}:{},...k.List.isList(E)?{"catalog-tags":E.toJS()}:{}},dataAttributes:{title:Al()(t.getAttr("title")),desc:Al()(t.getAttr("desc")),content:this.rawContent,thumb:t.getAttr("thumb"),cover:t.getAttr("cover"),"published-at":m,..."videos"===s&&"upload"===a?{"hosted-media-key":t.getAttr("hosted-media-key"),"hosted-media-cover-url":t.getAttr("thumb"),"hosted-media-duration":t.getAttr("hosted-media-duration"),"hosted-media-filename":t.getAttr("hosted-media-filename")}:{},...k.List.isList(p)?{"entities-to-replace-with":p.map((e=>e.toUnique())).toJS()}:{},...k.List.isList(g)?{"entries-to-replace-with":g.map((e=>e.toUnique())).toJS()}:{},...r.isStaff()?{"reco-override":t.getAttr("reco-override"),"option-is-official":t.getAttr("option-is-official"),"option-is-focus-showcase":t.getAttr("option-is-focus-showcase")}:{},...e?{"is-published":1}:{},"work-enabled":t.getAttr("work-enabled")??!1,"work-is-protected":t.getAttr("work-is-protected")??!1,"work-notification-enabled":t.getAttr("work-notification-enabled")??!1}};if(e){if(!this.checkData(f))return Promise.reject()}this.setState({networkStatus:{text:"保存中"}}),this.localSave();return(i?n((0,l.wFx)(f)).then((e=>(this.postCallback(e),e))):n((0,l.WTD)(f))).then((t=>{const{error:a}=t;if(a)throw this.setNetworkStatus(a),new Error("保存失败");const[n,l]=(()=>{var e;const t=(null===(e=f.dataAttributes.content)||void 0===e?void 0:e.length)||0,a=t/Tg,n=(0,Tr.gt)(t/Tg);return a<.5?[!1,"保存成功"]:a<.8?[!1,`已达到内容长度限制的 ${n}`]:a<=1?["warning",`已达到内容长度限制的 ${n}，请控制好字数和图片`]:["warning",`已超出内容长度限制(${n})，请适当删减内容`]})();this.setNetworkStatus(n,l);const i=f.dataAttributes["work-enabled"];var s,o;!this.prevWorkEnabled&&i&&(0,fe.oi)({type:f.type,id:f.id},r.get("id"),"originalEditor",null===(s=f.relationships.portfolios)||void 0===s||null===(o=s[0])||void 0===o?void 0:o.id);if(this.prevWorkEnabled=i,e&&f.categoryID!==tr.default.category.NEWS){const e=(0,rn.VA)(300);_().set(w.default.cookie_keys.writingCooldown,"true",{expires:e})}return t}))};setNetworkStatus=(e,t)=>{this.setState({networkStatus:{error:e,text:t||(!0===e?"保存失败"+(navigator.onLine?"":"，请检查网络"):"内容已保存")}})};postCallback=e=>{const{type:t}=this.props;e.error||Qa.ZP.replace((0,Ir.ZP)("originalEditor",{id:e.payload.result.id,type:t}))};handleTitleChange=e=>{const{original:t}=this.state;this.setOriginal(t.setIn(["attributes","title"],(0,Tr.v3)(e.target.value))),this.setState((e=>{let{editedAttrs:t}=e;return{editedAttrs:t.add("title")}}))};handleDescChange=e=>{const{original:t}=this.state;this.setOriginal(t.setIn(["attributes","desc"],(0,Tr.v3)(e.target.value))),this.setState((e=>{let{editedAttrs:t}=e;return{editedAttrs:t.add("desc")}}))};createHandleHeaderInputKeyUp=e=>t=>{13===t.keyCode&&(t.preventDefault(),t.stopPropagation(),"title"===e?this.refDesc.focus():"desc"===e&&this.refContentEditor.current.needChangeEditorState("insertfirstLine"))};handleTitleInputKeyUp=this.createHandleHeaderInputKeyUp("title");handleDescInputKeyUp=this.createHandleHeaderInputKeyUp("desc");handleTriggerEditorStateChange=(e,t)=>{const a=e.getCurrentContent().getFirstBlock().getKey();return"insertfirstLine"===t?(0,Qp.zE)(e,a,!1):null};handleContentChange=e=>{this.setState({networkStatus:null}),this.lazySave.start(),this.rawContent=(0,Qp.Zy)(e)};handleContentInited=e=>{this.rawContent=(0,Qp.Zy)(e),this.localSave()};handleOpenNextModalBtnClick=()=>{this.setState((e=>({isNextModalOpen:!e.isNextModalOpen})))};handleConfirmNextModalClick=()=>{const{currentUser:e}=this.props;this.lazySave.clear(),this.save(!0).then((t=>{this.jumptoShowPage(t,!e.isStaff()&&"audit")}))};handleSaveClick=()=>{this.save().then((e=>{this.jumptoShowPage(e,"draft")}))};handleNextModalClose=()=>{this.setState({isNextModalOpen:!1})};handleDataInModalChange=e=>{const{entities:t}=this.props;this.setOriginal((0,ln.PT)(e,t,2))};handleCoverChange=e=>{const{original:t}=this.state;this.setOriginal(t.setIn(["attributes","cover"],e))};handleModeSwitch=e=>{this.setState({mode:e})};handleAfterDelBlock=(e,t)=>{t===e.getCurrentContent().getFirstBlock()&&this.refDesc.focus()};renderMediaWidget(){const{dispatch:e,currentUser:t}=this.props,{original:a,mode:n}=this.state;return null===n?null:Ta.createElement(ug,{original:a,dispatch:e,onChange:this.handleDataInModalChange,currentUser:t,mode:n,onModeSwitch:this.handleModeSwitch})}renderNextModal(){const{dispatch:e,currentUser:t,categories:a,radioCatalogs:n,isRequesting:r,censorLabels:l}=this.props,{original:i,isNextModalOpen:s,mode:o}=this.state,c=[Ta.createElement(Ya.Z,{key:"preview",size:"lg",outline:!0,onClick:this.handleSaveClick,loading:r},"存为草稿"),Ta.createElement(Ya.Z,{type:"dark",size:"lg",key:"confirm",onClick:this.handleConfirmNextModalClick,disabled:r},t.isStaff()?"发布":"投稿审核")];return Ta.createElement(_n.Z,{width:400,visible:s,actions:c,title:"发布设置",titleBar:!0,shouldConfirmOnPressEnter:!1,onConfirmClick:this.handleNextModalClose,onCloseClick:this.handleNextModalClose},Ta.createElement(Ig,{original:i,dispatch:e,currentUser:t,categories:a,radioCatalogs:n,onChange:this.handleDataInModalChange,uploadMode:o,censorLabels:l}))}renderTitle(){const{censorLabels:e}=this.props,{original:t,editedAttrs:a}=this.state;return Ta.createElement("div",{className:"articlePage_header_content_inner story_container"},Ta.createElement("div",{className:(0,Ma.Z)("originalPage_titleGroup",{"originalPage_titleGroup-center":["videos","radios"].includes(t.get("type"))})},Ta.createElement(ym.Z,{labels:a.has("title")||null==e?void 0:e.texts.title},Ta.createElement(Xp.Z,{className:"originalPage_title",placeholder:"输入标题",value:t.getAttr("title")||"",onChange:this.handleTitleChange,onKeyDown:this.handleTitleInputKeyUp})),Ta.createElement(ym.Z,{labels:a.has("desc")||null==e?void 0:e.texts.desc},Ta.createElement(Xp.Z,{className:"originalPage_desc",placeholder:"输入摘要",value:t.getAttr("desc")||"",onChange:this.handleDescChange,onKeyDown:this.handleDescInputKeyUp,ref:this.refDescBind}))))}renderCoverTitle(){const{original:e}=this.state,{dispatch:t,censorLabels:a}=this.props;return"articles"!==e.get("type")||e.isNews()?this.renderTitle():Ta.createElement(Cm,{image:e.getImage(),editable:!0,dispatch:t,onImageChange:this.handleCoverChange,censorImages:null==a?void 0:a.images},this.renderTitle())}contentItems=()=>[{key:"next",title:"下一步",props:{type:"dark",outline:!0,ellipse:!0,plain:!1},onClick:this.handleOpenNextModalBtnClick}];renderNav(){const{original:e}=this.state;return Ta.createElement(hl.Z,{miniLogo:!0,twoRow:!1,breadcrumb:[{name:"投稿管理",to:(0,Ir.ZP)("writing")},{name:e.getAttr("title")||(e.get("id")?"编辑文章":"新建文章")}],contentItems:this.contentItems})}renderNetworkStatus(){const{networkStatus:e}=this.state;if(!e)return null;const{error:t,text:a}=e;return Ta.createElement("div",{className:(0,Ma.Z)("originalEditor_networkStatus",{"originalEditor_networkStatus-error":!0===t||t instanceof Error,[`originalEditor_networkStatus-${t}`]:"string"==typeof t})},a)}renderDevBox(){return null}renderFixedTip(){const{initEditor:e}=this.state;return e?(0,za.createPortal)(Ta.createElement("div",{className:"originalEditor_fixedTip"},this.renderNetworkStatus(),this.renderDevBox()),document.body):null}}const Rg=Ag,Dg=(0,sn.P1)(((e,t)=>t),sn.LF,((e,t)=>(0,ln.tK)(e.originalID,"news"===e.type?"articles":e.type,t,{originalPreview:"draft"}))),xg=(0,sn.P1)([Dg,sn.LF,sn.is,(e,t)=>t],((e,t,a,n)=>{const{type:r,initialCategory:l}=n,i=a.get("userID");let s=e||((e,t,a)=>{let n,r,{type:l,initialCategory:i}=a;"news"===l?(r=tr.default.category.NEWS,n="articles"):n=l;const s=(0,Yp.Fl)({type:n,userID:e,dataAttributes:{"is-published":0,"is-verified":0,"is-official":!1,"option-is-official":!1,"option-is-focus-showcase":!1,"entry-is-official":!1},categoryID:r||i,relationships:{..."videos"===n||"radios"===n?{djs:[{type:"users",id:e}]}:{}}}),o=new(0,z.ll[n])(s.data);return(0,ln.PT)(o,t,2)})(i,t,{type:r,initialCategory:l});return s.getAttr("published-at")===s.getAttr("created-at")&&0===s.getAttr("is-published")&&(s=s.setIn(["attributes","published-at"],null)),s})),Mg=(0,sn.P1)((e=>e.getIn(["data","categories","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"categories",t))),Lg=(0,sn.P1)((e=>e.getIn(["data","radioCatalogs","ids"])),sn.LF,((e,t)=>(0,ln.b$)(e,"radio-catalogs",t))),qg=(0,sn.P1)(xg,(e=>{const t=e.getRel("draft");if(!t)return null;const a=t.getAttr("audit-censor-labels");return a?a.toJS():null})),Fg=(0,Ka.connect)(((e,t)=>{const a=e.getIn(["status","originalEditor","popbox"]),n=xg(e,t),r=qg(e,t),l=Mg(e),i=Lg(e);return{isPopBoxOpen:a,original:n,censorLabels:r,mediasState:e.getIn(["data","editor","medias"]),categories:l,radioCatalogs:i,entities:(0,sn.LF)(e),currentUser:(0,sn.ib)(e),isRequesting:e.getIn(["network","postOriginal","isRequesting"])||e.getIn(["network","patchOriginal","isRequesting"])}}))(Rg);Fg.defaultProps={originalID:null,type:"articles",initialCategory:void 0};const Bg=Fg,Og=e=>{let{children:t}=e;return Ta.createElement(Jp.Z,{alignCenter:!0},t)};const Ug={path:"/original_editor",name:"originalEditor",async action(e){let{query:t,getCurrentUser:a,store:n}=e;const i=a(),{id:s,type:o,initialCategory:c}=t,d=n.getState().getIn(["network","getAllCategories","fetched"]),m=n.getState().getIn(["network","getRadioCatalogs","fetched"]);let u;const p=function(e,t,a){let n;return a?["articles","news","videos","radios"].includes(e)||t?a.isStaff()||"radios"!==e||(n="权限不足"):n="参数错误":n="请先登录",n}(o,s,i);if(p)return Ta.createElement(Og,null,p);s&&(u=await n.dispatch((0,l.As2)({type:o,id:s})));const g=jp(u,i);if(g){if(g.type!==r.ZQ.WARNING)return Ta.createElement(Og,null,g.text);n.dispatch((0,l.bG5)({body:g.text,type:g.type}))}return n.dispatch((0,l.J_T)(!0)),d||await n.dispatch((0,l.tGz)()),m||await n.dispatch((0,l.SUC)()),{htmlClassNames:["lightBg"],title:"编辑器",context:{hideNav:!0,hideFooter:!0},component:Ta.createElement(Bg,{originalID:s,type:o,initialCategory:c})}}};var $g=a(2738);const Gg={...(0,ii.r3)("settings"),async action(e){const{getCurrentUser:t,store:n}=e,r=t();if(!r)throw[e,(0,$g.fg)()];await n.dispatch((0,N.cVO)(r.get("id")));const l=(await a.e(75).then(a.bind(a,92075))).default;return Ta.createElement(l,null)}};var zg=a(38854);const Hg={path:"/next",children:[{...(0,ii.r3)("nextHardware"),async action(e){let{store:t,query:n}=e;const{page:r=1}=n,{Hardware:i}=a(40696);return await t.dispatch((0,l.xaK)({source:"hardware",page:Number(r)})),{title:"次世代硬件资讯与文章",component:Ta.createElement(i,{page:Number(r)})}}},{...(0,ii.r3)("nextNews"),async action(e){let{store:t,query:n}=e;const{page:r,tab:i="all"}=n,s=(0,nn.CO)(r),{News:o}=a(40696);return await t.dispatch((0,l.xaK)({source:"news",filter:"all"===i?void 0:i,page:s})),{title:"次世代资讯汇总",component:Ta.createElement(o,{page:s,tab:i})}}},{...(0,ii.r3)("next"),async action(e){let{store:t}=e;const{NextGeneration:n}=a(40696),{payload:{data:r}}=await t.dispatch((0,zg.D1)("/next-generation"));return await t.dispatch((0,l.xaK)({source:"videos"})),await t.dispatch((0,l.xaK)({source:"news"})),{title:"次世代",component:Ta.createElement(n,{json:r})}}}]},Vg={path:"/games",children:[{children:[{path:"",action:()=>({redirect:"/games/hot"})},{...(0,ii.r3)("gamesHot"),async action(e){let{query:t}=e;const{moduleComing:n}=await a.e(275).then(a.bind(a,6275)),{default:r,formatQuery:l}=n,i=l(t);return{component:Ta.createElement(r,(0,Aa.Z)({mode:"hot"},i))}}},{...(0,ii.r3)("gamesComing"),async action(e){let{query:t}=e;const{moduleComing:n}=await a.e(275).then(a.bind(a,6275)),{default:r,formatQuery:l}=n,i=l(t);return{component:Ta.createElement(r,(0,Aa.Z)({mode:"upcoming"},i))}}}],async action(e){let{next:t}=e;const n=await t();if(!n)return;const{Layout:r}=await a.e(275).then(a.bind(a,6275)),[l,i]=n;return[l,{...i,component:Ta.createElement(r,{pageName:l.pageName},i.component)}]}}]};var Wg=a(32826);const jg={...(0,ii.r3)("game"),async action(e){let{params:{0:t,1:n},query:{legacy:r},store:i}=e;if(n&&!Object.values(Wg.Y).includes(n))return{redirect:`/games/${t}`};const[s]=await Promise.all([i.dispatch((0,l.ccU)({type:"games",id:t},{include:["tags","user","game-stores","game-links","involvements.entity.user","active-entry-vote-activities","active-entry-vote-activities.vote-activity-options","active-entry-vote-activity-records","active-entry-vote-activity-records.vote-activity-option"],metaFields:{tags:[],users:[],celebrities:[],organizations:[]},fields:{users:["nickname","thumb"],involvements:["position","title","rank","entity"],celebrities:["user"],organizations:["name"],tags:["name","tag-type"]}})),i.dispatch(Te.Z.actions.getOriginals(t,1))]),o=(0,Ir.xE)(s,{imageKey:"cover"});if("1"===r)return{...o,context:{navTransparent:!0,hideFooter:!0},component:Ta.createElement(id,{type:"games",id:t})};const{default:c}=await Promise.resolve().then(a.bind(a,32826));return{...o,context:{navTransparent:!0,hideFooter:!0,navProps:{fixed:!1},mobileNavProps:{fixed:!1},needShowAppDownloadTip:!1},component:Ta.createElement(c,{id:t,mode:n||"intro"})}}};var Kg=a(61804);const Jg=e=>{let{path:t}=e;const{allowPlay:a,start:n,idCheckModal:r,src:l}=(0,Kg.o)(t);return(0,Ta.useEffect)((()=>{n()}),[]),a?Ta.createElement("iframe",{className:"gamePlayer_iframe",src:l}):Ta.createElement("div",{className:"gamePlayer_ready"},r,Ta.createElement(Ya.Z,{size:"large",type:"primary",onClick:n},"Play"))},Yg={htmlClassNames:["blackBg","forApp"],context:{hideNav:!0,hideFooter:!0,hideGlobalActions:!0,needShowAppDownloadTip:!1}},Xg={...(0,ii.r3)("gamePlayer"),action(e){let{query:{path:t,state:a}}=e;return{...Yg,component:Ta.createElement(Jg,{path:t,state:a})}}},Qg=(0,sn.zU)(),eh={...(0,ii.r3)("talk"),async action(e){let{store:t,params:{id:n}}=e;const{TalkPage:r,topicsHomePageSlice:l}=await Promise.resolve().then(a.bind(a,72835));await t.dispatch(l.actions.getHotTopics());const i=await t.dispatch((0,V.D1)(`talks/${n}`,{include:[...V.Ck,"portfolios"]}));if((0,$e.GN)(i))throw i.payload;const s=Qg(t.getState(),{type:"talks",id:n}),o=s.getRelAttr("topic","title"),c=`来自${s.getRelAttr("user","nickname")}发布于${(0,Tr.oH)(o)}小组的分享`;return{title:`${s.getDesc(!1,50)||c} | 机组`,description:c,component:Ta.createElement(r,{talkId:n})}}};var th=a(72835);const ah=e=>{const t=e.find((e=>"gapi-objects"===e.type)),[,a]=Object.entries((null==t?void 0:t.relationships)||{}).find((e=>{let[t,{data:a}]=e;return!!a}))||[];return null==a?void 0:a.data},nh=e=>(0,V.D1)(`talks/${e}`,{include:[...V.Ck,"portfolios","catalog-tags"]}),rh=async(e,t)=>{let{topic_id:a,talk_id:n,repost_type:r,repost_id:l,draft:i}=e;const s=q()(w.default.storage_keys.talkDraft),o=r&&l?{type:r,id:l}:null;if("true"===i||!n&&!o&&!a)return{mode:"edit",editingDraft:s,fromStorage:!!s};if(s&&"false"!==i)return{mode:"confirm",editingDraft:s,fromStorage:!0};let c=null;return c=n?await(async(e,t)=>{const a=await t(nh(e));if(a.error)throw a.payload;const n=(0,ln.Jg)({type:"talks",id:e},a.payload.entities),r=a.payload.data,l=a.payload.origin.included,i=n.getAttr("content");return{talkId:r.id,content:(0,tn.KO)(i).join("\n"),topicId:r.relationships.topic.data.id,repostUnique:ah(l),images:(0,tn.N5)(i),workProperties:(0,gg.Xn)(n)}})(n,t):{...o?{repostUnique:o}:null,...a?{topicId:a}:null},{mode:"edit",editingDraft:c,fetchedTalk:!!c.talkId,fromStorage:!1}},lh={...(0,ii.r3)("topicEditor"),async action(e){let{store:{dispatch:t},query:n,getCurrentUser:r}=e;const l=r();if(!l)return(0,$g.fg)();if(!l.getMeta("is-phone-number-bound"))return(0,$g.mO)();const{TopicEditor:i}=await Promise.resolve().then(a.bind(a,72835)),{mode:s,fromStorage:o,editingDraft:c,fetchedTalk:d}=await rh(n,t);if(c&&c.topicId){if((await t((0,N.BN1)(c.topicId,{query:{"fields[topics]":"is-pro"}}))).payload.data.attributes["is-pro"]&&!l.getAttr("is-pro")){if(!o)return t((0,N.bG5)({body:"开发者社区目前还在内测阶段，需要先完成入驻申请，才可发帖哦",type:N.ZQC.WARNING})),Qa.ZP.replace((0,Ir.ZP)("devCommunityEntityEdit")),Ta.createElement("div",null);c.topicId=void 0}}const m=[(0,N.BzH)()];if(null!=c&&c.talkId&&!d&&m.push(nh(c.talkId)),null!=c&&c.topicId&&m.push((0,V.D1)(`topics/${c.topicId}`)),null!=c&&c.repostUnique){const{type:e,id:t}=c.repostUnique;m.push((0,V.D1)(`${e}/${t}`,"games"===e?{include:V.wE}:void 0))}if((await Promise.all(m.map((e=>t(e))))).find((e=>e.error)))throw q()(w.default.storage_keys.talkDraft,null),setTimeout((()=>{location.href=(0,Ir.o0)("topicEditor")}),500),new Error("获取数据错误");return{title:"话题编辑器",component:Ta.createElement(i,{key:`${(null==c?void 0:c.talkId)||"new"}${s}`,draft:c,mode:s})}}},ih="机组游戏社区",sh={path:"/topics",children:[lh,{...(0,ii.r3)("topicsHome"),async action(e){let{store:{dispatch:t}}=e;const{TopicsHomePage:n}=await Promise.resolve().then(a.bind(a,72835));return await t(th.topicsHomePageSlice.actions.getBanners()),{title:ih,description:"在这里分享你的兴趣和创作，与同好深入交流",context:{hideFooter:!0},component:Ta.createElement(n,null)}}},{...(0,ii.r3)("topic"),async action(e){let{store:t,isPathnameChanged:n,params:{id:r},query:{tab:l="recommendations"}={}}=e;const{TopicPage:i}=await Promise.resolve().then(a.bind(a,72835));let s;if(n&&(s=await t.dispatch((0,V.D1)(`topics/${r}`,{include:["linked-articles","linked-videos","linked-radios","linked-games","recommended-topics","operational-events","operational-events.giveaways.winners","operational-events.public-candidates"]})),s.error))throw new Error("小组不存在");return{...(0,Ir.xE)(s,{fromState:{store:t,type:"topics",id:r},titleFormat:e=>`${(0,Tr.oH)(e)}小组 | ${ih}`,descFormat:(e,t)=>`关于${(0,Tr.oH)(t)}的讨论：${e}`}),context:{hideFooter:!0},component:Ta.createElement(i,{topicId:r,tab:l})}}}]};var oh=a(31636),ch=a(57853);const dh=e=>Ta.createElement("div",{className:"ajz_talks"},e.map((e=>{var t;let{feed:a,data:n}=e;const r=null===(t=a.getRel("lead-actors"))||void 0===t?void 0:t.first(),l=n.getKey();return"talks"===n.get("type")?Ta.createElement(oh.Z,{key:l,talk:n,actor:r,hideTopicBlockOption:!0}):Ta.createElement(si.Z,{key:l,original:n,feedStyle:!0,actor:r})}))),mh=["data","feedsPage","feeds"],uh=(0,$c.P1)((e=>e.getIn([...mh,"ids"])),sn.LF,((e,t)=>{const a=(0,ln.BY)(e,t,{depth:3});return a.map((e=>{const t=e.getAttr("content-key"),a=e.getRel("feed"),n=t&&e.getRel(t);return a&&n?{feed:a,data:n}:null})).filter((e=>e))})),ph={dispatchFeeds:de.actions.getFeeds,dispatchMarkSeen:de.actions.markSeen},gh=(0,Ka.connect)((e=>({currentUser:(0,sn.ib)(e),feeds:uh(e),feedsState:e.getIn(mh)})),ph)((e=>{let{currentUser:t,feeds:a,feedsState:n,dispatchFeeds:r,dispatchMarkSeen:l}=e;const i=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];await r(e?1:(n.get("currentPage")??0)+1)}),[r,n]),s=(0,yr.II)(t),o=(0,yr.II)(i),c=(0,Ta.useCallback)((()=>Ta.createElement(Ta.Fragment,null,Ta.createElement(Zp.OS,null,Ta.createElement(ch.Z,null)),Ta.createElement(Zp.OS,null,Ta.createElement(Am,{more:!0})),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null)))),[]),d=(0,Ta.useCallback)((async()=>{s.current&&(await o.current(!0),l(s.current.get("id")))}),[o,s,l]),m=(0,yr.n5)(d),u=t?Ta.createElement(Cn.Z,{state:n,data:a,onLoad:i,onInit:m,emptyContent:Ta.createElement("div",{className:"am_card"},Ta.createElement(Dc.Z,{desc:"当关注用户发布内容时，在此显示动态"}))},dh):Ta.createElement("div",{className:"am_card"},Ta.createElement(Dc.Z,{needSignin:!0}));return Ta.createElement(Zp.ZP,{renderSide:c,className:"topicPage"},u)})),hh={path:"",children:[{...(0,ii.r3)("feeds"),action:()=>({context:{hideFooter:!0},component:Ta.createElement(gh,null)})}]};var vh=a(82729),Eh=a.n(vh);const fh=e=>{let{title:t,right:a,backTo:n,headerExtra:r,className:l,children:i}=e;return Ta.createElement(Ip.Z,{className:(0,Ma.Z)("am_card",l),backTo:n,title:t,extra:a},r,Ta.createElement("div",{className:"am_card_inner"},i))},yh=Ta.memo((e=>{let{item:{album:t,availability:a},isActive:n,onClick:r}=e;const l=(0,Ir.ZP)(t);return Ta.createElement("div",{className:(0,Ma.Z)("creditPurchaseItem")},Ta.createElement("div",{className:"form-check creditPurchaseItem_check"},Ta.createElement("input",{className:"form-check-input",type:"checkbox",checked:a||n,disabled:a,onChange:e=>{r(t.get("id"))}})),Ta.createElement(dn.Z,{to:l,className:"creditPurchaseItem_cover"},Ta.createElement(ns,{album:t})),Ta.createElement(dn.Z,{to:l,className:"creditPurchaseItem_text"},Ta.createElement("h3",null,t.getTitle()),Ta.createElement("p",null,"共 ",t.getAttr("chapters-count")," 章 ·"," ",t.getAttr("radios-count")," 期节目")))})),bh=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return["data",Ce.namespace,...e]},kh=(0,$c.P1)((e=>e.getIn(["pay","availabilityHistory"])),(e=>e.getIn(bh(["albums","ids"]))),sn.LF,((e,t,a)=>(0,ln.BY)(t,a).map((t=>({albumId:t.get("id"),album:t,availability:e.getIn([me.Uo.Album,t.get("id"),"currentlyAvailable"])}))).filter((e=>e.album.getOwnSku())).toArray())),Ch=e=>{const[t,a]=(0,Ta.useState)(!1),[n,r]=(0,Ta.useState)([]),l=(0,Ka.useSelector)(sn.hm),i=(0,Ka.useSelector)((e=>e.getIn(bh(["albums"])))),s=(0,Ka.useSelector)(kh),o=(0,Ka.useDispatch)(),{pageName:c}=(0,Ua.EY)(),d=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(null==i?void 0:i.get("currentPage"))+1;await o(Ce.actions.getAlbumsWithAvailability(e))}),[i,o]),m=(0,yr.II)(d),u=(0,Ta.useCallback)((async()=>{await o(Ee.actions.getUserCredit()),await m.current(1)}),[m,o]),p=(0,yr.n5)(u);return Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container creditPurchasePage"},Ta.createElement(fh,{title:"权益兑换",className:"creditPurchasePage_card",backTo:(0,Ir.ZP)("gpassPanel"),right:Ta.createElement(Ya.Z,{anchor:!0,plain:!0,disabled:0===n.length||t,className:0===n.length?"u_color-gray-disabled":"u_color-gpass",onClick:async()=>{a(!0);const e=n.map((e=>{var t;const a=s.find((t=>t.albumId===e)),n=null==a?void 0:a.album;return{skuId:(null==n||null===(t=n.getOwnSku())||void 0===t?void 0:t.get("id"))??null,purchasableId:(null==a?void 0:a.albumId)||null,purchasableType:me.Uo.Album,title:(null==n?void 0:n.getTitle())||""}})),t=await o(Ce.actions.creditPlaceOrder({orders:e,source:c}));a(!1),t&&(p(),r([]))}},t?"兑换中...":"确认兑换")},Ta.createElement("p",{className:"creditPurchasePage_tip"},"当前可兑换 ",l??0," 本，已选 ",n.length," 本"),Ta.createElement(Cn.Z,{data:s,state:i,onLoad:d,onInit:p,scrollableProps:{bottomOffset:1200}},(e=>e.map((e=>Ta.createElement(yh,{key:e.album.getKey(),item:e,isActive:n.includes(e.album.get("id")),onClick:e=>{t||r((t=>{if(t.includes(e)){const a=[...t];return Eh()(a,(t=>t===e)),a}return t.length>=l?(alert("兑换次数不足"),t):[...t,e]}))}}))))))))},_h=e=>{let{children:t}=e;return Ta.createElement("ul",{className:"orderList"},t)},wh=e=>{let{order:t,onClick:a}=e;if(!t.orderId)return null;const{redeemCode:n}=t;let r="";if(t.expiredAt){const e=new Date(t.expiredAt);r=e<new Date?"已过期":`将于 ${(0,rn.ab)(e)} 过期`}return Ta.createElement("li",null,Ta.createElement(Ya.Z,(0,Aa.Z)({className:"orderItem",plain:!0,anchor:!0},n&&a?{onClick:()=>{a(t)}}:t.productLink?{to:t.productLink}:{}),(e=>{if(!e.cover)return null;const t=Ta.createElement("img",{src:(0,tn.cR)(e.cover,{resize:{w:72,h:72}}),alt:e.title});return"albums"===e.itemType||"album-bundles"===e.itemType?Ta.createElement(_i,{golden:!0,thin:!0,className:"orderItem_image"},t):Ta.createElement("div",{className:"orderItem_image"},t)})(t),Ta.createElement("div",null,Ta.createElement("h3",null,t.title),Ta.createElement("p",null,Ta.createElement("span",null,(0,rn.ab)(new Date(t.createdAt))),Ta.createElement("span",null,(0,tn.T4)(t.amount,{showFree:!1})),n&&Ta.createElement("span",null,n.consumerId?"已被领取":"未被领取"),r&&Ta.createElement("span",null,r)))))};var Nh=a(59589);const Ph=(e,t)=>"update"===t.type?{...e,...t.payload}:e,Sh=e=>{const[{currentPage:t,allPage:a,orders:n,isRequesting:r,fetched:l},i]=(0,Ta.useReducer)(Ph,{currentPage:void 0,allPage:void 0,orders:[],isRequesting:!1,fetched:!1}),s=(0,Ka.useDispatch)(),o=e=>{i({type:"update",payload:e})},c=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(t??0)+1;o({isRequesting:!0});const a=await s((0,N.SMG)({page:e,merchant:"GCORES"}));o({isRequesting:!1,fetched:!0}),a&&o({currentPage:e,allPage:a.allPage,orders:[...n,...a.data.filter((e=>{let{sku:t}=e;return"membership"===t.attributes["delivery-type"]}))]})}),[s,t,n]),d=(0,yr.II)(c),m=(0,Ta.useCallback)((async()=>{await d.current(1)}),[d]),u=(0,yr.n5)(m);return Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container gpassOrdersPage"},Ta.createElement(fh,{title:"开通记录",backTo:(0,Ir.ZP)("gpassPanel"),right:Ta.createElement(ur,{plain:!0,anchor:!0},"问题反馈")},Ta.createElement(Nh.Z,{data:n,loading:r,fetched:l,allLoaded:t>=a,scrollableProps:{bottomOffset:1200},onInit:u,onLoad:c},(e=>Ta.createElement(_h,null,e.map((e=>Ta.createElement(wh,{key:e.orderId,order:e})))))))))};var Zh=a(37094);const Ih=e=>/^(\w{4})(-\w{4}){3}$/.test(e),Th=e=>{let{visible:t,onClose:a}=e;const n=(0,Ta.useRef)({}),[r,l]=(0,Ta.useState)(["","","",""]),[i,s]=(0,Ta.useState)(!1),o=(0,Ka.useSelector)(sn.ib),c=(0,Ka.useDispatch)(),d=r.join("-");const m=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];l((n=>{const r=t.trim().toLocaleUpperCase(),l=[...n];if(!a)return l[e]=r.slice(0,4),l;let i=r;for(let t=e;t<=3;t++){const e=4-l[t].length,a=i.slice(0,e);i=i.slice(e,i.length),l[t]+=a}return l}))};return Ta.createElement(_n.Z,{title:"兑换",visible:t,hideActionBtns:!0,onCloseClick:a},Ta.createElement("div",{className:"bookcasePage_codeInputs"},r.map(((e,t)=>Ta.createElement("input",{key:t,type:"text",value:r[t]||"",className:"form-control",ref:e=>{n.current[t]=e},onPaste:e=>{e.preventDefault();const a=(e.clipboardData||window.clipboardData).getData("text").replace(/-/g,"");m(t,a,!0)},onChange:e=>{const a=e.target.value;if(m(t,a),a.length>=4){const e=n.current[`${t+1}`];e&&e.focus()}}})))),Ta.createElement("div",{className:"text-center mt-3"},Ta.createElement(Zh.Z,{wrapperType:Ya.Z,type:"primary",size:"lg",disabled:!Ih(d),loading:i,onReceive:e=>{s(!0),c((0,Wm.XT)(d,e)).then((e=>{let[t,a]=e;s(!1);let n="";if(t)alert("领取成功"),window.location.reload();else{var r,l;n=(null==a||null===(r=a.graphQLErrors)||void 0===r||null===(l=r[0])||void 0===l?void 0:l.message)||(null==a?void 0:a.message);/NotFoundError/.test(n)?alert("该礼物已被领取"):n?alert(`错误: ${n}`):alert("未知错误")}(0,fe.j8)({id:"",type:"",consumerId:o.get("id"),producerId:"",isSuccess:!0===t,message:n})}))}},"确认兑换")))},Ah=e=>{let{title:t,more:a,data:n}=e;return n&&0!==n.size?Ta.createElement(ci.Z,{title:t,moreTo:a,className:"ag_section"},Ta.createElement(vi.Z,{variableWidth:!0,circleArrow:!0,slidesToShow:1,className:"ag_showcaseSlider"},n.map((e=>Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(Si,{item:e,className:"mb-0"})))))):null},Rh=e=>(0,sn.P1)((t=>t.getIn(["data","gpass",e,"ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))),Dh=Rh("privilegeBanners"),xh=Rh("albums"),Mh=(0,sn.P1)(Dh,xh,((e,t)=>t.concat(e))),Lh=Rh("discountProducts"),qh=Rh("privilegeProducts"),Fh=Rh("audiobooks"),Bh=()=>{const e=(0,Ka.useSelector)(Mh),t=(0,Ka.useSelector)(Lh),a=(0,Ka.useSelector)(qh),n=(0,Ka.useSelector)(Fh);return Ta.createElement(Ta.Fragment,null,Ta.createElement(Ah,{title:"会员节目",data:e,more:(0,Ir.ZP)("privilegeAlbums")}),Ta.createElement(Ah,{title:"会员限定商品",data:a}),Ta.createElement(Ah,{title:"有声书季度兑换",data:n,more:(0,Ir.ZP)("audioBooks")}),Ta.createElement(Ah,{title:"会员折扣商品",data:t}))},Oh=a.p+"353e71d7c7aca56338e1.png",Uh=a.p+"1ed4a26a0cf986b02a0e.png",$h=a.p+"b956ddfa85e08796ef35.png",Gh=a.p+"a2fd908091e9cdb2deb7.png",zh=a.p+"6fb451d59e84f6639fe9.png",Hh=a.p+"104c9640f19d27b9b87a.png",Vh=a.p+"604978115e79b22225d5.png",Wh=a.p+"f214695294a9a644ea8b.png",jh=[{title:"GadioSpec",desc:"免费畅听节目",image:Oh},{title:"会员独享节目",desc:"专属播客及专享视频",image:Gh},{title:"吉考斯工业",desc:"独占商品及折扣权益",image:$h},{title:"核市奇谭",desc:"有声书兑换及文创折扣",image:Uh},{title:"BOOOM暴造",desc:"免费开发者分享视频",image:a.p+"451c67d81f8c5045b54a.png"},{title:"个性APP图标",desc:"APP图标支持更换",image:zh},{title:"我的动态置顶",desc:"可置顶两条个人动态",image:Hh},{title:"限定抽奖活动",desc:"发起更多会员限定抽奖",image:Vh},{title:"用户名修改",desc:"修改周期缩短为90天",image:Wh}],Kh=e=>Ta.createElement("div",{className:"gpassPage_privileges"},jh.map((e=>{let{title:t,desc:a,image:n}=e;return Ta.createElement("div",{className:"gpassPage_privilege",key:t},Ta.createElement("div",{className:"gpassPage_privilege_title"},Ta.createElement("h3",null,t),Ta.createElement("p",null,a)),Ta.createElement("img",{src:n}))}))),Jh=e=>{let{isActive:t,item:a,promotion:n,onClick:r}=e;return Ta.createElement(Ya.Z,{plain:!0,key:a.skuId,className:(0,Ma.Z)("gpassPage_sku",`gpassPage_sku-${a.months}`,{is_active:t}),onClick:r},Ta.createElement("div",null,Ta.createElement("img",{src:a.icon})),Ta.createElement("div",null,a.amount&&Ta.createElement("div",null,Ta.createElement("div",{className:"gpassPage_sku_price"},Ta.createElement("strong",null,(0,tn.T4)(a.amount,{withFixed:!1}))," ","/",a.unit),Ta.createElement("div",{className:"gpassPage_sku_meta"},n&&Ta.createElement("span",{className:"gpassPage_sku_label gpassPage_sku_label-promotion"},"特惠已减 ",12===a.months?50:30," 元"),a.tagAmount&&a.tagAmount>a.amount&&Ta.createElement("span",{className:"gpassPage_sku_tagAmount"},(0,tn.T4)(a.tagAmount,{withFixed:!1})),!n&&Ta.createElement("span",{className:"gpassPage_sku_label"},12===a.months?"年度":a.timeText,"会员")))))},Yh=tr.w8.map((e=>({...tr.Zc[e],skuId:e}))),Xh=tr.$N.map((e=>({...tr.Zc[e],title:`${tr.Zc[e].isGift?"赠送":""}${tr.Zc[e].timeText}`,skuId:e}))),Qh=e=>w.default.wechat.payUrl((0,Ir.o0)("gpass",{sku_id:e})),ev=e=>t=>(0,Ir.o0)("gpass",{sku_id:e,order_id:t}),tv=Yh.map((e=>e.skuId)),av=Xh.map((e=>e.skuId)),nv={namespace:"gpassPage",actions:{init:()=>async e=>{await Promise.all([...tv.concat(av).map((t=>e((0,N.TBc)({skuId:t})))),e((0,V.D1)("skus",{filters:{id:tv.concat(av).join(",").toString()}}))])}}},rv=nv,lv=e=>(0,$c.P1)((e=>e.getIn(["pay","skuHistory"])),sn.LF,((t,a)=>e.map((e=>{const{skuId:n}=e,r=(0,ln.tK)(n,"skus",a);if(!r)return null;const l=null==t?void 0:t.get(n),i=(null==l?void 0:l.get("amount"))||(null==r?void 0:r.getAttr("amount")),s=(null==l?void 0:l.get("tagAmount"))||(null==r?void 0:r.getAttr("amount"));return{...e,sku:r,amount:i,tagAmount:s}})).filter((e=>e)))),iv=lv(Yh),sv=lv(Xh),ov=(0,Ka.connect)((e=>({purchaseItems:iv(e),giftItems:sv(e),currentUser:(0,sn.ib)(e)})),{})((e=>{let{giftItems:t,purchaseItems:a,currentUser:n,initialRedeem:r}=e;const l=(0,Ka.useDispatch)(),[i,s]=(0,Ta.useState)(null),[o,c]=(0,Ta.useState)(r),[d,m]=(0,Ta.useState)(0),u=a[d],p=(0,Ym.Od)();return(0,Ta.useEffect)((()=>{l(rv.actions.init())}),[l]),Ta.createElement("div",{className:"pageContainer"},i&&i.sku&&Ta.createElement(wu,{visible:!0,giftSku:i.sku,product:i.sku,wechatPayUrl:Qh(i.skuId),alipayUrl:ev(i.skuId),onClose:()=>{s(null)}}),Ta.createElement(Th,{visible:o,onClose:()=>{c(!1)}}),Ta.createElement("div",{className:"story_container gpassPage"},Ta.createElement(fh,{className:"gpassPage_card",title:"开通GPASS",right:Ta.createElement(Km.Z,{anchor:!0,plain:!0,onClick:()=>{c(!0)}},"兑换")},Ta.createElement("div",{className:"gpassPage_skus"},a.map(((e,t)=>{const a=t===d;return Ta.createElement(Jh,{key:e.skuId,promotion:p,item:e,isActive:a,onClick:()=>{m(t)}})}))),Ta.createElement("p",{className:"ag_tip"},"开通则表示你已阅读并同意",Ta.createElement(dn.Z,{href:w.default.gpass_policy_url},"《会员服务协议》")),p&&Ta.createElement("div",{className:"gpassPage_promotionTip"},"限时特惠：即日起至3月12日0点，加入 GPASS 会员，最多可特惠减价 50 元开通，期待你的加入！"),Ta.createElement(ci.Z,{title:"GPASS 权益",className:"ag_section"},Ta.createElement(Kh,null),Ta.createElement("p",{className:"ag_tip"},"如有任何疑问可至"," ",Ta.createElement(ur,{plain:!0,anchor:!0},"问题反馈")," ","告知我们")),Ta.createElement(Bh,null),(null==u?void 0:u.sku)&&(null==u?void 0:u.amount)&&Ta.createElement("div",{className:"gpassPage_actions"},Ta.createElement(Ya.Z,{type:"gpass-reverse",onClick:()=>{s(t.find((e=>e.months===u.months)))}},"赠送"),Ta.createElement(Jm,{type:"gpass",sku:u.sku,product:u.sku,displayDiscount:!1,wechatPayUrl:Qh(u.skuId),alipayUrl:ev(u.skuId),onCompletePay:e=>{e&&Qa.ZP.push((0,Ir.ZP)("gpassPanel"))}},"立即支付 ",(0,tn.T4)(u.amount,{withFixed:!1})," ",null!=n&&n.getAttr("has-membership")?"续费":"开通")))))})),cv=e=>{const t=(0,Ka.useSelector)(sn.ib);if(!t)return null;const a=(0,tn.cR)(t.getAttr("thumb"),tn.iT.UserThumbSizeArticle),n=t.getAttr("membership-expired-at"),r=n?(0,rn.SI)(n).replace(/-/g,"."):null;return Ta.createElement("div",{className:(0,Ma.Z)("membershipCard",{is_founderMember:t.getAttr("is-founder-member")})},Ta.createElement("div",{className:"membershipCard_btm"},Ta.createElement("div",{className:"membershipCard_user"},Ta.createElement("img",{src:a}),Ta.createElement("div",null,Ta.createElement("p",{className:"membershipCard_en"},"id"),Ta.createElement("p",null,t.getAttr("nickname")))),r&&Ta.createElement("div",{className:"membershipCard_en membershipCard_expired"},Ta.createElement("p",null,"valid thru"),Ta.createElement("p",null,r)),Ta.createElement(Ya.Z,{type:"opacity",ellipse:!0,to:(0,Ir.ZP)("gpass")},"立即续费")))},dv=e=>{const{sendPopMessage:t}=(0,Ua.EY)(),a=(0,sn.xJ)().getAttr("has-membership");return Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container gpassPanelPage"},Ta.createElement(fh,{title:"GPASS",right:Ta.createElement(Ya.Z,{anchor:!0,plain:!0,to:(0,Ir.ZP)("gpassOrders")},"开通记录")},Ta.createElement(cv,null),a&&Ta.createElement("div",{className:"gpassPanelPage_actions"},Ta.createElement(Ya.Z,{icon:["gfas","membership-setting"],size:"lg",type:"gpass-reverse",onClick:()=>{t({body:"目前会员专属功能仅在 APP 端可进行相关设置，我们会逐步上线更多会员专属功能，敬请期待",title:"会员专属功能",modalProps:{confirmBtnText:"下载 APP",confirmBtnProps:{to:(0,Ir.ZP)("app")},onConfirmClick:()=>!0}})}},"专属功能"),Ta.createElement(Ya.Z,{icon:["gfas","membership-exchange"],size:"lg",type:"gpass-reverse",to:(0,Ir.ZP)("creditPurchase")},"权益兑换")),Ta.createElement(Bh,null)),Ta.createElement("div",{className:"gpassPanelPage_btmLinks"},Ta.createElement(dn.Z,{href:w.default.gpass_policy_url},"会员服务协议"),Ta.createElement("span",null,"|"),Ta.createElement(dn.Z,{href:w.default.gpass_qa_url},"会员常见问题"))))},mv={path:"",children:[{...(0,ii.r3)("gpass"),async action(e){let{store:t,query:a}=e;return await t.dispatch(Ke.Z.actions.getGpassRecommendations()),{title:"GPASS 会员",description:"加入机核 GPASS 会员，享受更多元、更稳定的优质内容和服务：畅听会员电台、独享音视频内容、商城折扣、会员专属功能",htmlClassNames:["disableGlobalHidden","hasBtmFixedActions"],component:Ta.createElement(ov,{initialRedeem:"1"===a.redeem})}}},{...(0,ii.r3)("gpass_redeem"),action:()=>({redirect:"/gpass?redeem=1"})}]},uv={path:"/gpass_privilege",children:[{...(0,ii.r3)("gpassPanel"),async action(e){let{store:t,getCurrentUser:a}=e;const n=a();return null!=n&&n.getAttr("has-membership")?(await t.dispatch(Ke.Z.actions.getGpassRecommendations()),Ta.createElement(dv,null)):{redirect:(0,Ir.ZP)("gpass")}}},{...(0,ii.r3)("gpassOrders"),action(e){let{store:t}=e;return Ta.createElement(Sh,null)}},{...(0,ii.r3)("creditPurchase"),action(e){let{store:t}=e;return Ta.createElement(Ch,null)}}],action(e){let{getCurrentUser:t}=e;if(!t())return(0,$g.fg)()}};var pv=a(85564),gv=a.n(pv),hv=a(89734),vv=a.n(hv),Ev=a(77043),fv=a.n(Ev);const yv=(0,sn.TJ)(["data","worksPage","banners","ids"]),bv=()=>{const e=(0,Ka.useSelector)(yv),t=(0,Ka.useDispatch)();return(0,Ta.useEffect)((()=>{t(Ue.actions.getBanners())}),[t]),e&&0!==e.size?Ta.createElement(vi.Z,{circleArrow:!0,dots:!0,infinite:!0,autoplay:!0,slidesToShow:1,className:"topicsHomePage_banners"},e.map((e=>{const t=e.getHref(),a=(0,tn.cR)(e.getAttr("image"),{resize:{w:564,h:155}});return Ta.createElement("div",{className:"slick-item",key:e.getKey()},Ta.createElement(dn.Z,{to:t,className:"topicsHomePage_banner"},Ta.createElement("img",{src:a})))}))):null},kv=e=>{const t=(0,Ta.useRef)();return Ta.createElement(Zm.Z,null,Ta.createElement(xa.Z,{onUpdate:e=>{var a;return{...e,style:{...null==e?void 0:e.style,width:(null===(a=t.current)||void 0===a?void 0:a.offsetWidth)||200}}},body:Ta.createElement("div",{className:"worksPage_publishPopover"},Ta.createElement("ul",null,[["文章",(0,Ir.ZP)("originalEditor",{type:"articles"})],["视频",(0,Ir.ZP)("originalEditor",{type:"videos"})],["动态",(0,Ir.ZP)("topicEditor")]].map((e=>{let[t,a]=e;return Ta.createElement("li",{key:t},Ta.createElement(Km.Z,{plain:!0,anchor:!0,to:a},t))})))),trigger:["click","hover","focus"]},(e=>Ta.createElement(Km.Z,(0,Aa.Z)({icon:["gfas","write"],type:"primary",to:(0,Ir.ZP)("topicEditor"),className:"w-100"},e),"投稿"))),Ta.createElement("p",{ref:t,className:"mt-2 mb-0 text-muted u_fontSize-sm text-center"},"分享你的兴趣和创作，与同好深入交流"))},Cv=(0,sn.TJ)(["data","worksPage","tags","ids"]),_v=e=>{let{currentTagId:t,onChange:a}=e;const n=(0,Ka.useSelector)(Cv),r=(0,Ka.useDispatch)(),{pageName:l}=(0,Ua.EY)();return(0,Ta.useEffect)((()=>{r(Ue.actions.getTags())}),[r]),Ta.createElement(Zm.Z,{title:"显示分类",className:"worksPage_tagsSection"},Ta.createElement("div",{className:"am_card_block am_card_block-noStyle"},Ta.createElement("ul",{className:"worksPage_tagsList"},Ta.createElement("li",null,Ta.createElement(Ya.Z,{plain:!0,anchor:!0,className:(0,Ma.Z)({is_active:null===t}),onClick:()=>{a(null)}},"全部作品")),n.map((e=>Ta.createElement("li",{key:e.getKey()},Ta.createElement(Ya.Z,{plain:!0,anchor:!0,className:(0,Ma.Z)({is_active:t===e.get("id")}),onClick:()=>{(0,fe.lw)("WorkAggregationLabel",e.getAttr("name"),"button",{data_id:e.get("id"),data_type:e.get("type"),source:l}),a(e.get("id"))}},e.getAttr("name"))))))))},wv=(0,$c.P1)((e=>e.getIn(["data","worksPage","mixed","fetchedPagesMap"])),sn.LF,((e,t)=>{if(!e)return null;const a=e.toJS(),n=vv()(Object.keys(a).map((e=>Number(e))));return(0,k.List)(fv()(gv()(n.map((e=>(0,ln.BY)(a[e],t).sort(((e,t)=>(0,rn.u3)(t.getAttr("published-at"))-(0,rn.u3)(e.getAttr("published-at")))).toArray()))),(e=>e.getKey())))})),Nv=e=>{const t=(0,Ka.useDispatch)(),[a,n]=(0,Ta.useState)(null),r=(0,Ka.useSelector)(wv),l=(0,Ka.useSelector)((e=>e.getIn(["data","worksPage","mixed"]))),i=(0,Ta.useCallback)((()=>Ta.createElement(Ta.Fragment,null,Ta.createElement(Zp.OS,null,Ta.createElement(kv,null)),Ta.createElement(Zp.OS,{top:!0},Ta.createElement(_v,{currentTagId:a,onChange:e=>{n(e),window.scrollTo(0,0)}})),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null)))),[a]),s=(0,Ta.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(l.get("currentPage")??0)+1;await t(Ue.actions.getData(e,n))}),[a,l,t]),o=(0,yr.II)(s),c=(0,Ta.useCallback)((async()=>{await o.current(a,1)}),[a,o]),d=(0,yr.n5)(c),m=(0,Gc.By)({blacklistEnable:!0});return Ta.createElement(Zp.ZP,{renderSide:i,className:"worksPage"},Ta.createElement(bv,null),Ta.createElement(Cn.Z,{data:r,state:l,onLoad:s,onInit:d},m))},Pv={...(0,ii.r3)("works"),action:()=>({title:"原创作品",description:"来自机核社区的优质原创内容",htmlClassNames:["disableGlobalHidden"],component:Ta.createElement(Nv,null)})};var Sv=a(32298),Zv=a(19740),Iv=a(14144);const Tv=[{tab:"view",name:"游戏概览",eng:"Overview"},{tab:"edit",name:"资料编辑",eng:"Edit Info"},{tab:"links",name:"下载与试玩",eng:"Download & Demo Management"}],Av=e=>{let{entryId:t,active:a}=e;return Ta.createElement("nav",{className:"devPortal_gamePage_nav"},Tv.map((e=>{let{tab:n,name:r}=e;return Ta.createElement(dn.Z,{to:`/dev_community/entries/${t}/${"view"===n?"":n}`,onClick:e=>{t||e.preventDefault()},key:n,className:n===a?"active":t?"":"disabled"},Ta.createElement("span",null,r),!t&&n!==a&&Ta.createElement("p",{className:"tooltip"},"游戏资料通过审核后可用"))})))},Rv=(0,sn.zU)({depth:3}),Dv=e=>{let{children:t,active:a="edit",entryId:n,onlyInfoEdit:r}=e;const l=Tv.find((e=>{let{tab:t}=e;return t===a})),i=(0,Ka.useSelector)((e=>Rv(e,{type:"games",id:n}))),s=(()=>{if(!n)return Ta.createElement(Ta.Fragment,null,Ta.createElement("img",{className:"devPortal_gamePage_header_newGameIcon",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjNTY1NjU2Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTEgOVY0TDkgNEw5IDlINFYxMUg5TDkgMTZIMTFWMTFIMTZWOUgxMVoiIGZpbGw9IiM5NDk0OTQiLz4KPC9zdmc+Cg=="}),"新建游戏");if(!i)return null;const e=i.getAttr("title"),t=i.getAttr("icon")?(0,tn.cR)(i.getAttr("icon"),{resize:{h:64,w:64,m:"lfit"}}):null;return Ta.createElement(Ta.Fragment,null,t&&Ta.createElement("img",{src:t,alt:e}),e)})();return Ta.createElement("div",{className:"devPortal_gamePage"},Ta.createElement("header",{className:"devPortal_gamePage_header"},s),Ta.createElement(Av,{entryId:r?void 0:n,active:r?"edit":a}),Ta.createElement(Iv.Z,{title:l.name,subTitle:l.eng}),t)};var xv=a(20374),Mv=a(12978);const Lv=e=>{let{gameLink:t,versionTitle:a}=e;const n=(0,Mv.JO)(t),r=Mv.AF[t.getAttr("state")];return Ta.createElement("div",{className:"devPortal_gameOverview_gameLink"},Ta.createElement("span",{className:"devPortal_gameOverview_gameLink_verionTitle"},a),Ta.createElement("div",{className:"devPortal_gameOverview_gameLink_info"},Ta.createElement("p",{className:"devPortal_gameOverview_gameLink_version"},n),Ta.createElement("div",{className:"devPortal_gameOverview_gameLink_reviewState"},Ta.createElement("div",{className:"dot",style:{backgroundColor:r.color}}),r.text)))},qv=e=>{const t=new Date(e);return`${t.getFullYear()} 年 ${t.getMonth()+1} 月 ${t.getDate()} 日 ${t.getHours()}:${t.getMinutes()}`},Fv=(0,sn.zU)({depth:3}),Bv=e=>{let{entryId:t}=e;const a=(0,Ka.useSelector)((e=>Fv(e,{type:"games",id:t}))),n=(null==a?void 0:a.getRel("game-links"))||(0,k.List)(),r=(0,Mv.F1)(n),l=a.getAttr("title"),i=a.getAttr("introduction"),s=(0,tn.cR)(a.getAttr("cover"),{resize:{w:408,h:192}}),o=[{label:"关注人数",value:a.getAttr("subscriptions-count")},{label:"创建时间",value:qv(a.getAttr("created-at"))},{label:"更新时间",value:qv(a.getAttr("updated-at"))},{label:"关联标签",value:a.getRel("tags").map((e=>e.getAttr("name"))).join(", ")},{label:"下载与试玩",value:Ta.createElement(Ta.Fragment,null,r.latest&&r.latest!=r.online&&Ta.createElement(Lv,{gameLink:r.latest,versionTitle:"最新版本"}),r.online&&Ta.createElement(Lv,{gameLink:r.online,versionTitle:"在线版本"}),(!r.online||!r.latest)&&"无")}];return Ta.createElement("div",{className:"devPortal_gameOverview"},Ta.createElement("div",{className:"devPortal_standardGrid"},Ta.createElement("h2",null,Ta.createElement(xv.Z,{icon:"info"}),"游戏信息"),Ta.createElement("div",{className:"devPortal_gameOverview_main"},Ta.createElement("div",{className:"devPortal_gameOverview_top"},Ta.createElement("img",{src:s,alt:"",className:"cover"}),Ta.createElement("section",null,Ta.createElement("h3",null,l),Ta.createElement("p",null,i))),Ta.createElement("div",{className:"devPortal_gameOverview_infoList"},o.map((e=>{let{label:t,value:a}=e;return Ta.createElement("div",{className:"devPortal_gameOverview_infoItem",key:t},Ta.createElement("span",null,t),Ta.createElement("span",null,a))})))),Ta.createElement("div",{className:"devPortal_gameOverview_side"},Ta.createElement("h3",null,"快捷操作"),Ta.createElement("div",{className:"devPortal_gameOverview_links"},Ta.createElement(dn.Z,{to:(0,Ir.ZP)("game",{id:t})},"查看游戏库页面"),Ta.createElement(dn.Z,{to:`/dev_community/entries/${t}/edit`},"编辑游戏资料"),Ta.createElement(dn.Z,{to:`/dev_community/entries/${t}/links`},"管理下载与试玩")))))},Ov={htmlClassNames:["blackBg","forApp"],context:{hideNav:!0,hideFooter:!0,hideGlobalActions:!0,needShowAppDownloadTip:!1}},Uv=e=>{var t;let{id:a,attr:n,res:r}=e;if(void 0===a)return!1;const l=null==r||null===(t=r.payload)||void 0===t?void 0:t.data;if(!l||0===l.length)return!1;for(const e of l){if(!e)continue;const t=(0,Sv.b)(e[n]);if(t)return t.id==a}return!1},$v=async e=>{var t;let{dispatch:a,currentUser:n,entryId:r,entityId:l}=e;const i=await a((0,V.D1)("settlement-applications",{filters:{state:"pending"},limit:Qt.h}));if(((null===(t=i.payload.data)||void 0===t?void 0:t.length)>=Qt.h||Uv({id:r,attr:"pending-entry",res:i})||Uv({id:l,attr:"pending-entity",res:i}))&&!n.isStaff())throw(0,$g.Tr)(void 0,{message:"已有一个待审核或待修改的申请，请前往管理页查看",routePage:Ov,status:403})},Gv=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return await e((0,V.D1)(`settlement-applications/${t}`,{include:["draft","user"],ctrlfields:{drafts:["+audit-censor-labels"]},...a?{query:{console:"1"}}:{}}))},zv={...(0,ii.r3)("devCommunity"),action(e){let{getCurrentUser:t}=e;const a=t();if(!a)throw(0,$g.fg)({routePage:Ov});if(!a.getMeta("is-phone-number-bound"))throw(0,$g.mO)({routePage:Ov})},children:[{...(0,ii.r3)("devCommunityApplication"),async action(e){let{store:t,getCurrentUser:a,query:{application_id:n}}=e;const r=a();if(!n)return{redirect:(0,Ir.ZP)("devCommunityEntityEdit")};const l=(await Gv(t.dispatch,n,r.isStaff())).payload.data.attributes,i=l["pending-entity"],s=l["pending-entry"],o=i&&s;return s?{redirect:(0,Ir.ZP)("devCommunityEntryEdit",{application_id:o?void 0:n})}:i?{redirect:(0,Ir.ZP)("devCommunityEntityEdit",{application_id:n})}:null}},{...(0,ii.r3)("devCommunityManage"),async action(e){let{store:t,getCurrentUser:n}=e;const{DevCommunityManagePage:r,devCommunityManagePageSlice:l,DevCommunityLayout:i}=await Promise.resolve().then(a.bind(a,19740)),s=n();return await t.dispatch(l.actions.getApplications()),await t.dispatch(l.actions.getInvolvements(s.get("id"))),await t.dispatch(l.actions.getEntities(s.get("id"))),{...Ov,component:Ta.createElement(i,{isHomePage:!0},Ta.createElement(r,null))}}},{...(0,ii.r3)("devCommunityEntryEdit"),async action(e){var t,n,r,l;let{store:i,getCurrentUser:s,query:{application_id:o}}=e;const{DevCommunityEntryEditPage:c,DevCommunityLayout:d}=await Promise.resolve().then(a.bind(a,19740));await i.dispatch(Qt.Z.actions.getEventNames());const m=s(),u=o?await Gv(i.dispatch,o,m.isStaff()):null,p=(0,Sv.b)(null==u||null===(t=u.payload)||void 0===t||null===(n=t.data)||void 0===n||null===(r=n.attributes)||void 0===r?void 0:r["pending-entry"]);if(o&&!p)throw(0,$g.vu)({message:"游戏申请修改不存在",routePage:Ov});return await $v({dispatch:i.dispatch,currentUser:m,entryId:(null==p?void 0:p.id)||null}),{...Ov,component:Ta.createElement(d,{isHomePage:!1,breadcrumbItems:[{title:null!=p&&p.id?null!==(l=p.attributes)&&void 0!==l&&l.title?`编辑「${p.attributes.title}」`:"编辑":"新建游戏"}]},Ta.createElement(Dv,{entryId:null==p?void 0:p.id,onlyInfoEdit:!0},Ta.createElement(c,{applicationId:o})))}}},{...(0,ii.r3)("devCommunityEntityEdit"),async action(e){let{store:t,getCurrentUser:n,query:r,query:{application_id:l,entity_id:i}}=e;const{devCommunityManagePageSlice:s,DevCommunityEntityEditPage:o,DevCommunityLayout:c,DevPortalPageHeader:d}=await Promise.resolve().then(a.bind(a,19740)),m=n();await $v({dispatch:t.dispatch,currentUser:m,entityId:i||l?i:null}),await t.dispatch(s.actions.getInvolvements(m.get("id")));let u="";if(i){u=(await t.dispatch((0,V.D1)(`celebrities/${i}`,{include:["involvements","positions","user"]}))).payload.data.attributes.name}return l&&await Gv(t.dispatch,l,m.isStaff()),{...Ov,component:Ta.createElement(c,{isHomePage:!1,breadcrumbItems:[{title:u?`编辑${u}的入驻信息`:"编辑入驻信息"}]},Ta.createElement(d,{title:"编辑入驻信息",subTitle:"Edit Developer Information"}),Ta.createElement(o,{entityId:i,applicationId:l}))}}},{...(0,ii.r3)("devCommunityEntity"),async action(e){let{store:t,params:{id:n}}=e;const{DevCommunityEntityEditPage:r,DevCommunityLayout:l,DevPortalPageHeader:i}=await Promise.resolve().then(a.bind(a,19740));let s="";if(n){s=(await t.dispatch((0,V.D1)(`celebrities/${n}`,{include:["involvements","positions","user"]}))).payload.data.attributes.name}return{...Ov,component:Ta.createElement(l,{isHomePage:!1,breadcrumbItems:[{title:s?`${s}的入驻信息`:"入驻信息"}]},Ta.createElement(i,{title:"入驻信息",subTitle:"Developer Information"}),Ta.createElement(r,{entityId:n,readMode:!0}))}}},{path:"/entries/:id",action:async e=>{let{next:t,store:a,params:{id:n}}=e;if(!n)throw(0,$g.Tr)(void 0,{message:"缺少游戏 ID",routePage:Ov});const r=await t(),[l,i]=r||[];if(!i)return r;const s=(await a.dispatch((0,V.D1)(`games/${n}`,{include:["involvements.entity.user","tags","user","game-links","previous-game-link"]}))).payload.data.attributes.title,o={...i,component:Ta.createElement(Zv.DevCommunityLayout,{isHomePage:!1,breadcrumbItems:[{title:s?`游戏《${s}》`:"游戏项目"}]},i.component)};return l?[l,o]:o},children:[{...(0,ii.r3)("devCommunityGame"),action:e=>{let{params:{id:t}}=e;return{...Ov,component:Ta.createElement(Dv,{entryId:t,active:"view"},Ta.createElement(Bv,{entryId:t}))}}},{...(0,ii.r3)("devCommunityGameEdit"),action:async e=>{let{store:t,getCurrentUser:n,params:{id:r}}=e;const{DevCommunityEntryEditPage:l}=await Promise.resolve().then(a.bind(a,19740));await t.dispatch(Qt.Z.actions.getEventNames());const i=n();return await $v({dispatch:t.dispatch,currentUser:i,entryId:r}),{...Ov,component:Ta.createElement(Dv,{entryId:r,active:"edit"},Ta.createElement(l,{entryId:r}))}}},{...(0,ii.r3)("devCommunityGameLink"),action:async e=>{let{store:t,params:{id:n}}=e;const{DevCommunityEntryLinkEditPage:r}=await Promise.resolve().then(a.bind(a,19740));return await t.dispatch(Qt.Z.actions.getEventNames()),{...Ov,component:Ta.createElement(Dv,{entryId:n,active:"links"},Ta.createElement(r,{entryId:n}))}}}]}]},Hv=e=>{let{option:t,participantsCount:a=0,isSelfSelected:n=!1,isHighlighted:r=!1,showPercent:l=!1,onClick:i}=e;const s=t.getAttr("title"),o=`${Math.floor(t.getAttr("users-count")/a*100)}%`;return Ta.createElement(Ya.Z,{plain:!0,className:(0,Ma.Z)("discussionOption",{is_active:r}),onClick:i,disabled:!i},l?Ta.createElement("span",{className:"discussionOption_filler",style:{width:o}}):null,Ta.createElement("span",{className:"discussionOption_title"},n?`${s}（已选）`:s),l?Ta.createElement("span",{className:"discussionOption_percentage"},o):null)},Vv=e=>{let{discussion:t,onOptionClick:a}=e;const n=t.getRel("poll-options");return Ta.createElement("div",{className:(0,Ma.Z)("discussionOptions")},Ta.createElement("div",null,Ta.createElement("div",{className:"discussionOptions_info"},Ta.createElement("div",{className:"discussionOptions_meta avatar avatar-xs"},Ta.createElement("div",{className:"avatar_img"},t.getAttr("recent-participant-avatars").map(((e,t)=>Ta.createElement("img",{key:t,src:(0,tn.CA)(e,{resize:{w:32,h:32},bright:tn.jh})})))),Ta.createElement("div",{className:"avatar_text"},t.getAttr("participants-count")>0?`${t.getAttr("participants-count")} 人参与`:"暂无用户参与")),Ta.createElement("span",null,(()=>{if(!t.isActive())return"讨论已结束";if((null==n?void 0:n.size)>0&&0===t.getPolledOptions().size)return"请选择后发表观点";const e=t.getRemainingTime();return null!==e&&e>=0?`还有 ${(0,rn.vn)(e)} 天结束`:null})()))),0===n.size?null:Ta.createElement("ul",{className:"discussionOptions_list"},n.map((e=>{var n;const r=t.getPolledOptions().find((t=>t.get("id")===e.get("id"))),l=t.isActive()?r:e.get("id")===(null===(n=t.getMostPolledOption())||void 0===n?void 0:n.get("id")),i=t.getPolledOptions().size>0||!t.isActive();return Ta.createElement("li",{key:e.get("id")},Ta.createElement(Hv,{option:e,isHighlighted:l,showPercent:i,isSelfSelected:r,participantsCount:t.getAttr("participants-count"),onClick:a?()=>{a(e)}:void 0}))}))))},Wv=e=>{let{discussion:t}=e;const a=t.isActive()&&"discuss"===t.getAttr("style");return Ta.createElement("div",{className:(0,Ma.Z)("am_card discussionCard am_card_inner")},Ta.createElement("h3",null,t.getTitle()),Ta.createElement(Vv,{discussion:t}),a&&Ta.createElement("div",null,Ta.createElement(Ya.Z,{plain:!0,className:"discussionCard_button"},"立即参与")),Ta.createElement(dn.Z,{to:(0,Ir.ZP)("discussion",{id:t.get("id")})}))},jv=(0,sn.TJ)(["data",_a.Z.namespace,"hotGames","ids"]),Kv=e=>{const t=(0,Ka.useDispatch)(),a=(0,Ka.useSelector)(jv);return(0,Ta.useEffect)((()=>{0===a.size&&t(_a.Z.actions.getHotGames("all"))}),[a.size,t]),Ta.createElement(Zm.Z,{title:"大家在聊"},Ta.createElement("ul",{className:"sideOriginals"},a.map((e=>{const t=(0,tn.cR)(e.getAttr("cover"),{resize:{w:100,m:"lfit"},bright:tn.jh});return Ta.createElement("li",{key:e.getKey()},Ta.createElement(dn.Z,{to:(0,Ir.ZP)(e),className:"sideOriginal sideOriginal-game"},t?Ta.createElement("img",{src:t,className:"sideOriginal_img"}):Ta.createElement("div",{className:"sideOriginal_img"}),Ta.createElement("div",{className:"sideOriginal_content"},Ta.createElement("h3",null,e.getAttr("title")),Ta.createElement("p",null,e.getAttr("content-count")," 动态"))))}))))},Jv=e=>["data",ra.namespace,...e],Yv=(0,sn.TJ)(Jv(["activeDiscussions","ids"])),Xv=(0,sn.TJ)(Jv(["inactiveDiscussions","ids"])),Qv=(0,sn.P1)(Yv,Xv,((e,t)=>e.concat(t))),eE=e=>e.getIn(Jv(["activeDiscussions"])),tE=e=>e.getIn(Jv(["inactiveDiscussions"])),aE=e=>{const t=(0,Ka.useSelector)(Qv),a=(0,Ka.useSelector)(eE),n=(0,Ka.useSelector)(tE),r=(0,Ka.useDispatch)(),l=(0,Ta.useCallback)((async function(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return r(ra.actions.clearInDiscussionsPage()),void await ra.actions.getActiveDiscussions(1);a.get("noMore")?await r(ra.actions.getInActiveDiscussions((n.get("currentPage")??0)+1)):await r(ra.actions.getActiveDiscussions((a.get("currentPage")??0)+1))}),[a,n,r]),i=(0,yr.II)(l),s=(0,Ta.useCallback)((async()=>{await i.current(!0)}),[i]),o=(0,yr.n5)(s);return Ta.createElement("div",{className:(0,Ma.Z)("pageContainer")},Ta.createElement(Zp.ZP,{renderSide:()=>0===t.size?null:Ta.createElement(Ta.Fragment,null,Ta.createElement(Zp.OS,null,Ta.createElement(Kv,null)),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null)))},Ta.createElement(Nh.Z,{data:t,loading:a.get("isRequesting")||n.get("isRequesting"),fetched:a.get("fetched")||n.get("fetched"),allLoaded:a.get("noMore")&&n.get("noMore"),onLoad:l,onInit:o},(e=>e.map((e=>Ta.createElement(Wv,{key:e.get("id"),discussion:e})))))))},nE=(0,sn.zU)(),rE=e=>{var t;let{discussionId:a}=e;const[n,r]=(0,Ta.useState)(null),[i,s]=(0,Ta.useState)(!1),o=(0,Ka.useSelector)((e=>nE(e,{type:"discussions",id:a}))),c=o.getRel("poll-options"),d=(e=>{let{discussion:t}=e;const{sendPopMessage:a,toggleSigninModal:n}=(0,Ua.EY)(),r=(0,Ka.useSelector)(sn.ib);return function(){let{replyTo:e,optionId:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(r?r.isNeedBindPhone()?a({type:l.ZQC.BIND_PHONE}):Qa.ZP.push((0,Ir.ZP)("discussionPoll",{id:t.get("id"),option_id:i,reply_to:e})):n())}})({discussion:o}),m=0===o.getPolledOptions().size&&o.isActive();return Ta.createElement("div",{className:"pageContainer"},Ta.createElement(Zp.ZP,{className:(0,Ma.Z)("discussionPage"),renderSide:()=>Ta.createElement(Ta.Fragment,null,Ta.createElement(Zp.OS,{top:!0},Ta.createElement(Zm.Z,null,Ta.createElement("div",{className:"discussionPage_sideButtonSection"},Ta.createElement(Ya.Z,{disabled:!o.isActive(),icon:["gfas","write"],type:"primary",onClick:()=>{d()}},o.isActive()?"参与":"已结束"),Ta.createElement(mn.Z,{type:"secondary",data:o,plain:!1,anchor:!1})))),Ta.createElement(Zp.OS,null,Ta.createElement(Kv,null)),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null)))},Ta.createElement(Ip.Z,{className:"discussionPage_card am_card",backTo:(0,Ir.ZP)("discussions"),sticky:!1},Ta.createElement("div",{className:"am_card_inner"},Ta.createElement("h1",null,o.getAttr("title")),o.getAttr("description")&&Ta.createElement("p",null,o.getAttr("description")),(()=>{const e=o.getRel("operational-events");return 0===e.size?null:Ta.createElement(Vd.Z,{event:e.first()})})(),o.getAttr("linkages").size>0&&o.getAttr("linkages").map((e=>Ta.createElement(tm.Z,{item:e,key:e.get("id")}))),Ta.createElement("hr",{className:"discussionPage_card_hr"}),Ta.createElement(Vv,{discussion:o,onOptionClick:m?e=>{d({optionId:e.get("id")})}:void 0}))),Ta.createElement(fh,{title:0===c.size?void 0:(null===(t=c.find((e=>e.get("id")===n)))||void 0===t?void 0:t.getTitle())||"全部选项",right:0===c.size?void 0:Ta.createElement(Ya.Z,{plain:!0,className:"discussionPage_filterButton",onClick:()=>{s(!0)}},"筛选 ",Ta.createElement(Da.Z,{icon:["gfas","filter"]}))},Ta.createElement(Nn.Z,{key:`${n}`,hideInput:!0,onReplyClick:e=>{d({replyTo:e})},commentable:o,subCommentable:o.getRel("poll-options").find((e=>e.get("id")===n)),infinitLoad:{bottomOffset:800},includeSubCommentable:!0}))),Ta.createElement(Hm.Z,{visible:i,onClose:()=>{s(!1)},options:c.map((e=>({title:e.getAttr("title"),onClick:()=>{r(e.get("id")),s(!1)}}))).unshift({title:"全部选项",onClick:()=>{r(null),s(!1)}}).push({title:"取消",requestClose:!0}).toJS()}))};var lE=a(56005),iE=a(10948);const sE=async(e,t,a)=>{let{discussion:n,selectedOptionId:r,currentUserId:l}=a;const i=await e((0,V.D1)("poll-records",{method:"POST",include:["poll-option"],body:{data:{type:"poll-records",relationships:{discussion:{data:n.toUnique()},"poll-option":{data:{id:r,type:"poll-options"}},user:{data:{id:l,type:"users"}}}}}}));if(i.error)return i;const{payload:{data:s}}=i,o=t(),c=(0,ln.tK)(s.id,s.type,o.get("entities")).getRel("poll-option");return null==c||c.toJS(),(0,fe.JP)(c.get("id"),c.getAttr("title"),n.get("id"),n.getAttr("title")),i},oE=async(e,t,a)=>{const n=await e((0,N.waY)(a,{includeQueryPush:["commentable"]}));if(n.error)return;const{payload:{data:r}}=n,l=t(),i=(0,ln.tK)(r.id,r.type,l.get("entities")),s=i.getRel("commentable");(0,fe.xn)({commentId:r.id,commentable:s,replyTo:i.getRel("parent")})},cE=async(e,t,a)=>{let{content:n,discussion:r,topicId:l,currentUserId:i}=a;const s=await e((0,V.D1)("talks",{method:"POST",include:["topic"],body:{data:{type:"talks",attributes:{content:n},relationships:{topic:{data:{type:"topics",id:l}},user:{data:{type:"users",id:i}},discussions:{data:[{id:r.get("id"),type:"discussions"}]}}}}}));if(s.error)return s;const{payload:{data:o}}=s,c=t(),d=(0,ln.tK)(o.id,o.type,c.get("entities"));return(0,fe.X_)({talkId:d.get("id"),topic:d.getRel("topic"),imagesCount:0,repostContentId:null,repostContentType:null,repostContentTitle:null,workEnabled:!1,isOfficial:!1,isUpdate:!1,isRecruitment:!1,isStrategy:!1,isSpoiler:!1,source:"discussionPoll"}),s},dE=(0,sn.zU)(),mE=e=>{let{discussionId:t,initialOptionId:a,replyTo:n}=e;const r=(0,Ka.useDispatch)(),l=(0,Ka.useSelector)(sn.ib),[i,s]=(0,Ta.useState)(!1),[o,c]=(0,Ta.useState)(!1),[d,m]=(0,Ta.useState)(""),u=(0,Ka.useSelector)((e=>dE(e,{type:"discussions",id:t}))),[p,g]=(0,Ta.useState)(u.getRel("topic")),h=u.getRel("poll-options"),v=u.isActive(),E=u.getPolledOptions().size>0,f=v&&h.size>0&&!E,[y,b]=Ta.useState(f&&h.find((e=>e.get("id")===a))?a:void 0),k=h.find((e=>e.get("id")===y)),C=f&&void 0===y,_=(0,yr.pC)((0,Ir.ZP)("discussion",{id:t})),w=async()=>{d.trim().length<2?alert("内容不能过少"):(c(!0),await r((e=>{let{discussion:t,topic:a,selectedOptionId:n,replyTo:r,currentUser:l,body:i}=e;return async(e,s)=>{const o=t.getPolledOptions();if(o.size>0&&n)return void alert("已经投过票了");if(!r&&o.size>0&&!n)return void alert("请选择一个选项");n&&await sE(e,s,{discussion:t,currentUserId:l.get("id"),selectedOptionId:n}),await oE(e,s,{commentable:t.toUnique(),userID:l.get("id"),parentID:r,text:i});const{draftContent:c}=(0,iE.M)(i);return a&&c&&await cE(e,s,{content:c,topicId:a.get("id"),currentUserId:l.get("id"),discussion:t}),!0}})({discussion:u,topic:i?p:null,selectedOptionId:y,replyTo:n,currentUser:l,body:d})),c(!1),Qa.ZP.replace((0,Ir.ZP)("discussion",{id:u.get("id")})))};return Ta.createElement("div",{className:(0,Ma.Z)("topicEditor")},C?Ta.createElement(Ta.Fragment,null,Ta.createElement("h1",null,Ta.createElement(Ya.Z,{plain:!0,onClick:_},"后退"),n?Ta.createElement(Ya.Z,{type:"primary",size:"sm",onClick:()=>{b(null)}},"跳过"):null),Ta.createElement("div",{className:"topicEditor_body"},Ta.createElement("h3",{className:"pollEditor_title"},u.getAttr("title")),u.getRel("poll-options").map((e=>Ta.createElement(Hv,{key:e.get("id"),option:e,onClick:()=>{b(e.get("id"))}}))))):Ta.createElement(Ta.Fragment,null,Ta.createElement("h1",null,Ta.createElement(Ya.Z,{plain:!0,onClick:()=>{f?b(void 0):null==_||_()}},"取消"),Ta.createElement(Ya.Z,{type:"primary",size:"sm",onClick:w,loading:o},n?"发布":"发布讨论")),Ta.createElement("div",{className:"topicEditor_body"},k?Ta.createElement("h3",{className:"pollEditor_title"},"已选：📊 ",k.getAttr("title")):null,Ta.createElement(Xp.Z,{className:"topicEditor_content",minRows:10,placeholder:n?"请写下你的回复...":f?"请说说你做出这个选择的理由...":"请说说你的看法...",value:d,onChange:e=>{m(e.target.value)}}),Ta.createElement(lE.Z,{value:p,onChange:e=>{g(e)},checked:i,checkedLabel:"同步发布动态至",onCheckboxClick:()=>{s((e=>!e))}}))))},uE=e=>(0,V.D1)(`discussions/${e}`,{include:["poll-options","topic","poll-records.poll-option","operational-events.public-candidates","operational-events.giveaways"]}),pE={path:"/discussions",children:[{...(0,ii.r3)("discussions"),action:()=>({title:"热点讨论",description:"发表你对最近热点的看法吧",component:Ta.createElement(aE,null)})},{...(0,ii.r3)("discussion"),async action(e){let{params:{id:t},store:a}=e;const n=await a.dispatch(uE(t));return{...(0,Ir.xE)(n),component:Ta.createElement(rE,{discussionId:t})}}},{...(0,ii.r3)("discussionPoll"),async action(e){let{params:{id:t},query:{reply_to:a,option_id:n},store:r}=e;return await r.dispatch(uE(t)),Ta.createElement(mE,{discussionId:t,initialOptionId:n,replyTo:a})}}]};var gE=a(41729),hE=a(16684);const vE={title:"免运费",icon:"product-free-shipping"},EE={title:"售后保障",icon:"product-sale-protection"},fE={title:"现货商品",icon:"product-prompt-delivery"},yE={title:"会员限定",icon:"product-approved"},bE=(0,sn.zU)(),kE=(0,sn.TJ)(["data",ya.namespace,"recommendedProducts","ids"]),CE=e=>{var t;let{id:a}=e;const n=(0,Ka.useDispatch)(),r=(0,Ka.useSelector)((e=>bE(e,{type:"products",id:a}))),l=(0,Ka.useSelector)((e=>kE(e,{}))),i=r.getRel("user"),s=r.getAttr("external-link"),o=!s&&0===r.getAttr("stocks"),c=null==r?void 0:r.getAttr("shop"),d=null==r?void 0:r.getAttr("is-require-privilege");(0,Ta.useEffect)((()=>{c&&void 0!==d&&n(ya.actions.getRecommendedProducts(c,d))}),[c,n,d]);const m=(()=>{var e;const t=(null===(e=r.getAttr("gallery"))||void 0===e?void 0:e.toArray())||[],a=r.getAttr("cover");return[...a?[a]:[],...t].map((e=>({path:e})))})(),u=(()=>{const e=[];return r.getAttr("is-free-shipping")&&e.push(vE),e.push(EE),e.push(fE),r.getAttr("is-require-privilege")&&e.push(yE),e})();return Ta.createElement(Zp.ZP,{renderSide:()=>Ta.createElement(Ta.Fragment,null,Ta.createElement(Zp.OS,null,Ta.createElement(Zm.Z,{title:"更多商品"},l.map((e=>Ta.createElement(dn.Z,{to:(0,Ir.ZP)(e),className:"productPage_recommendedItem",key:e.getKey()},Ta.createElement("img",{src:(0,tn.cR)(e.getAttr("cover"),{resize:{w:300,m:"lfit"},bright:tn.jh}),alt:""}),Ta.createElement("div",{className:"productPage_recommendedItem_text"},Ta.createElement("h3",null,e.getTitle()),Ta.createElement(gE.Z,{product:e})))))),Ta.createElement(Zp.OS,null,Ta.createElement(Ap.Z,null))))},Ta.createElement(Gd.Z,null),Ta.createElement(Ip.Z,{title:"商品详情",backTo:i?`/users/${i.get("id")}/products`:"/"},Ta.createElement("div",{className:"productPage"},Ta.createElement("div",{className:"productPage_card productPage_info"},Ta.createElement(hE.Z,{images:m}),Ta.createElement("h1",null,r.getAttr("title")),Ta.createElement(gE.Z,{product:r,className:"productPage_infoPrice"}),u.length>0&&Ta.createElement("div",{className:"productPage_meta"},u.map((e=>Ta.createElement("span",{key:e.icon},Ta.createElement(Da.Z,{icon:["gfas",e.icon]}),Ta.createElement("b",null,e.title)))))),i&&Ta.createElement(dn.Z,{to:(0,Ir.ZP)("userProducts",{id:i.get("id")}),className:"productPage_card productPage_user"},Ta.createElement("img",{src:(0,tn.cR)(i.getAttr("thumb"),{resize:{w:150,m:"lfit"}}),alt:i.getAttr("name")}),Ta.createElement("div",{className:"productPage_user_text"},Ta.createElement("h3",null,i.getAttr("nickname"),i.getAttr("is-brand")&&Ta.createElement(Da.Z,{icon:["gfas","product-user-certification"]})),Ta.createElement("p",null,i.getAttr("certified-info")||"查看更多商品"," ·"," ",i.getAttr("products-count")," 商品")),Ta.createElement(Da.Z,{icon:["gfas","angle-right"],className:"productPage_user_arrow"})),Ta.createElement("div",{className:"productPage_card productPage_detail"},r.getAttr("description")&&Ta.createElement("pre",null,r.getAttr("description")),(null===(t=r.getAttr("detail"))||void 0===t?void 0:t.size)>0&&Ta.createElement(Ta.Fragment,null,r.getAttr("detail").map((e=>Ta.createElement("img",{src:(0,tn.cR)(e,{resize:{w:1e3,m:"lfit"}}),key:e,alt:"介绍图片"})))),Ta.createElement("div",{className:"productPage_actions"},Ta.createElement(br.Z,{label:"商品页引导按钮",openUrl:(0,Ir.ZP)(r)},Ta.createElement(Ya.Z,{type:o?"secondary":"danger",block:!0,to:s||"/app"},o?"已售罄":"App内购买")))))))},_E={...(0,ii.r3)("product"),async action(e){let{params:{id:t},store:{dispatch:a}}=e;const n=await a(ya.actions.getProduct(t));return{...(0,Ir.xE)(n),context:{hideFooter:!0},htmlClassNames:["disableGlobalHidden","hasBtmFixedActions"],component:Ta.createElement(CE,{id:t})}}},wE={...(0,ii.r3)("booomGameLib"),async action(){const{BooomGameLibPage:e,BooomCommonLayout:t}=await a.e(660).then(a.bind(a,27502));return{component:Ta.createElement(t,null,Ta.createElement(e,null)),context:{navTransparent:!0,hideFooter:!0,navProps:{fixed:!1},mobileNavProps:{fixed:!1},needShowAppDownloadTip:!1}}}},NE={...(0,ii.r3)("booomGameLibBrowse"),async action(e){let{query:t}=e;const{q:n}=t,{BooomGameLibBrowse:r,BooomCommonLayout:l}=await a.e(660).then(a.bind(a,27502)),i={type:t.type,booomPlatform:t["booom-platform"],platform:t.platform,gameGenre:t["game-genre"],playerCount:t["player-count"],gameStyle:t["game-style"],releaseTime:t["release-time"]};return{component:Ta.createElement(l,null,Ta.createElement(r,{keyword:n,queryData:i})),context:{navTransparent:!0,hideFooter:!0,navProps:{fixed:!1},mobileNavProps:{fixed:!1},needShowAppDownloadTip:!1}}}},PE={path:"/game_lib/collections",children:[{...(0,ii.r3)("booomGameLibCollections"),async action(e){let{query:{page:t=1},store:n}=e;const{BooomGameLibCollectionsPage:r,BooomCommonLayout:l}=await a.e(660).then(a.bind(a,27502));return await n.dispatch(ga.Z.actions.getGameCollectionsPage(t)),{component:Ta.createElement(l,null,Ta.createElement(r,{page:t})),context:{navTransparent:!0,hideFooter:!0,navProps:{fixed:!1},mobileNavProps:{fixed:!1},needShowAppDownloadTip:!1}}}},{...(0,ii.r3)("booomGameLibCollection"),async action(e){let{params:{id:t},store:n}=e;const{BooomGameLibCollectionPage:r,BooomCommonLayout:i}=await a.e(660).then(a.bind(a,27502));return await n.dispatch((0,l.ccU)({type:"entry-collections",id:t})),{component:Ta.createElement(i,null,Ta.createElement(r,{id:t})),context:{navTransparent:!0,hideFooter:!0,navProps:{fixed:!1},mobileNavProps:{fixed:!1},needShowAppDownloadTip:!1}}}}]},SE=PE,ZE={path:"/booom",children:[{...(0,ii.r3)("booomHomepage"),action:()=>({redirect:"/booom/game_lib"})},wE,NE,SE]},IE={131457:{users:["huihu"]},131473:{users:["xuqi"]},131472:{users:["tengye"]},131471:{users:["leilong"]},131469:{users:["chenghao"]},131468:{users:["tengye"]},131467:{users:["kangfu"]},131466:{users:["muming"]},131465:{users:["tengye"]},131464:{users:["baishu"]},131463:{users:["feidao"]},131460:{users:["chihui"]},131458:{users:["chihui"]},131254:{users:["skj"],type:"news"},131255:{users:["skj"],type:"news"},131278:{users:["skj"],type:"news"},131279:{users:["skj"],type:"news"},131280:{users:["skj"],type:"news"},131281:{users:["skj"],type:"news"},131282:{users:["skj"],type:"news"},131283:{users:["skj"],type:"news"},131517:{users:["nadya","42","laobai","longma","ximeng"],type:"radios"},131565:{users:["kaikai","yiheng"],type:"videos"},131499:{users:["shenhe"]}},TE=Object.keys(IE),AE=[{title:"有声书",key:me.WH.Audiobook},{title:"播客",key:me.WH.Gadio},{title:"视频",key:me.WH.Booom}],RE=e=>Ta.createElement("ul",{className:"bookcasePage_list"},e.map((e=>Ta.createElement("li",{key:e.id},Ta.createElement(dn.Z,{to:(0,Ir.ZP)({type:e.type,id:e.id})},Ta.createElement(_i,{golden:!0,thin:!0},Ta.createElement("img",{src:(0,tn.cR)(e.cover,{resize:{w:72,h:72}}),alt:e.title})),Ta.createElement("div",null,Ta.createElement("h3",null,e.title),Ta.createElement("p",null,e.author))))))),DE=e=>e.filter((e=>!e.isExpired)).reduce(((e,t)=>(e.find((e=>e.type===t.type&&e.id===t.id))||e.push(t),e)),[]),xE=(e,t)=>{const{orders:a,...n}=t.payload;return"update"===t.type?{...e,...n,...a?{orders:a(e.orders)}:null}:e},ME={dispatchRedeemCode:Wm.XT,dispatchGetAudioBookHistory:l.$f6},LE=(0,Ka.connect)((e=>({currentUser:(0,sn.ib)(e)})),ME)((e=>{let{currentUser:t,dispatchGetAudioBookHistory:a,dispatchRedeemCode:n}=e;const[r,l]=(0,Ta.useState)(void 0),[{tab:i,page:s,allPage:o,orders:c,isRequesting:d,fetched:m},u]=(0,Ta.useReducer)(xE,{tab:AE[0].key,page:void 0,allPage:void 0,orders:null,isRequesting:!1,fetched:!1}),[p,g]=(0,Ta.useState)(!1),h=s>=o,v=e=>{u({type:"update",payload:e})},E=(0,Ta.useCallback)((async(e,t)=>{v({isRequesting:!0});const n=await a(e,t);if(v({isRequesting:!1,fetched:!0}),!n)return;const{data:r,allPage:l}=n;v({page:t,allPage:l,orders:e=>[...1===t?[]:e||[],...DE(r)]})}),[a]),f=(0,yr.II)(E),y=(0,Ta.useCallback)((async()=>{await f.current(i,1)}),[f,i]),b=(0,Ta.useCallback)((async()=>{s&&await E(i,s+1)}),[E,i,s]);return(0,Ta.useEffect)((()=>{const e=document.querySelector(".footer");l((null==e?void 0:e.offsetHeight)||200)}),[]),Ta.createElement(Ta.Fragment,null,Ta.createElement(Th,{visible:p,onClose:()=>{g(!1)}}),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container bookcasePage"},Ta.createElement(fh,{title:"我的已购",headerExtra:Ta.createElement(Pr.Z,{tabs:AE,active:i,baseClass:"labelFilters",hrefEnabled:!1,onTabChange:e=>{v({tab:e})}}),right:Ta.createElement(Ya.Z,{plain:!0,anchor:!0,onClick:()=>{g(!0)}},"兑换")},void 0!==r&&Ta.createElement(Nh.Z,{data:c,loading:d,fetched:m,allLoaded:h,scrollableProps:{bottomOffset:r},onInit:y,onLoad:b},RE)))))}));var qE=a(23493),FE=a.n(qE);const BE=a.p+"ae6bd39942a3d3c29ce5.png",OE=a.p+"84cca1cb64f0713fc0d0.png",UE=a.p+"5cb3461049391fc9a36a.png",$E=a.p+"a3e01966f9976cfbfc2e.svg",GE=a.p+"cbaf3ec995bcf690cfd5.svg",zE=a.p+"cb8c3dda1c86b7c4b625.svg",HE=a.p+"98062d994d453c7f238a.svg",VE=a.p+"480b5d4d79cbba4eddf9.png",WE=a.p+"e971312c04e1b9862abc.svg",jE=a.p+"db820dbe71c6cb3a6e08.svg",KE=a.p+"b2d1202969af04ac3d58.svg",JE=[{channel:"direct",name:"直接下载",url:w.default.scriptLinks.appAndroid},{channel:"huawei",name:"华为应用商店",url:"https://url.cloud.huawei.com/jhrA9J3JtK"},{channel:"xiaomi",name:"小米软件商店",url:"http://app.xiaomi.com/details?id=me.tangke.gamecores&ref=search"},{channel:"taptap",name:"TapTap商店",url:"https://www.taptap.cn/app/10050"},{channel:"yingyongbao",name:"腾讯应用宝",url:"http://sj.qq.com/myapp/detail.htm?apkName=me.tangke.gamecores"},{channel:"vivo",name:"vivo应用商店",url:"https://h5coml.vivo.com.cn/h5coml/appdetail_h5/browser_v2/index.html?appId=1502694&resource=301&source=7"},{channel:"meizu",name:"魅族应用商店",url:"https://app.flyme.cn/apps/public/detail?package_name=me.tangke.gamecores"},{channel:"wandoujia",name:"阿里应用分发",url:"http://www.wandoujia.com/apps/me.tangke.gamecores"}],{scriptLinks:{appAndroid:YE,appIos:XE,appWeixin:QE}}=w.default,ef=[{key:"ios",title:"AppStore"},{key:"android",title:"Android"}],tf=e=>Ta.createElement("ul",{className:"appPage_versions"},e.map((e=>{return t=e,Ta.createElement("div",{className:"appPage_version",key:t.id},Ta.createElement("div",{className:"appPage_version_date"},Ta.createElement("h3",null,(0,rn.SI)(t.attributes["created-at"]))),Ta.createElement("div",{className:"appPage_version_detail"},Ta.createElement("h3",null,t.attributes.version),Ta.createElement("pre",null,t.attributes.changelog)));var t}))),af=(e,t,a)=>{let[n,r]=a;e&&(e.style.transform=`translate(${n*t}px, ${r*t}px)`)},nf=(e,t)=>{switch(e){case"allow":return!0;case"deny":default:return!1;case"confirm":return confirm(t)}},rf=Ta.memo((e=>{let{dispatchGapi:t,quick:a="confirm"}=e;const n=(0,Ua.EY)(),[r,l]=(0,Ta.useState)(ef[0].key),[i,s]=(0,Ta.useState)(null),{gcoreRef:o,sRef:c,jiheRef:d,descRef:m,oRef:u}=(()=>{const e=(0,Ta.useRef)(),t=(0,Ta.useRef)(),a=(0,Ta.useRef)(),n=(0,Ta.useRef)(),r=(0,Ta.useRef)();return(0,Ta.useEffect)((()=>{const l=FE()((l=>{const i=l.clientX,s=l.clientY,o=window.innerWidth,c=window.innerHeight,d=[(i-o/2)/(o/2),(s-c/2)/(c/2)];af(e.current,10,d),af(t.current,10,d),af(a.current,15,d),af(n.current,20,d),af(r.current,8,d)}),100);return window.document.body.addEventListener("mousemove",l,!0),()=>{window.document.body.removeEventListener("mousemove",l,!0)}}),[]),{gcoreRef:e,sRef:t,jiheRef:a,descRef:n,oRef:r}})();return(0,Ta.useEffect)((()=>{t("/app-versions",{page:1,limit:30,sorts:["-created-at"],filters:{platform:r}}).then((e=>{s(e.payload.data)}))}),[r]),(0,Ta.useEffect)((()=>{const{env:{uaParser:e,isWXBrowser:t}}=n,r=e.getOS().name;let l,i;t?(i=QE,l="wechat"):"Android"===r&&nf(a,"检测到所用设备为安卓系统，是否直接下载安装包？")?(i=YE,l="direct"):"iOS"===r&&nf(a,"检测到所用设备为iOS系统，是否直接跳转到appstore？")&&(i=XE,l="appstore"),l&&((0,fe.Qt)(r.toLowerCase(),l),setTimeout((()=>{window.location.href=i}),500))}),[]),Ta.createElement("div",{className:"gnav_next appPage theme-light"},Ta.createElement("div",{className:"appPage_container"},Ta.createElement("div",{className:"appPage_side"},Ta.createElement(Gd.Z,{top:100},(e=>{let{status:t}=e;return Ta.createElement("div",{className:t===Gd.Z.STATUS_FIXED?"appPage_side_fixed":void 0},Ta.createElement("div",{className:"appPage_devices"},Ta.createElement("div",{className:"appPage_iphone"},Ta.createElement("img",{src:BE})),Ta.createElement("div",{className:"appPage_ipad"},Ta.createElement("img",{src:OE})),Ta.createElement("div",{className:"appPage_android"},Ta.createElement("img",{src:UE}))))}))),Ta.createElement("div",{className:"appPage_body"},Ta.createElement("h1",{className:"appPage_logo"},Ta.createElement("img",{src:jE,alt:"s in gcores",className:"appPage_logo_s",ref:c}),Ta.createElement("img",{src:VE,alt:"o in gcores",className:"appPage_logo_o",ref:u}),Ta.createElement("img",{src:WE,alt:"gcore in gcores",className:"appPage_logo_gcore",ref:o}),Ta.createElement("img",{src:KE,alt:"jihe in gcores",className:"appPage_logo_jihe",ref:d}),Ta.createElement("img",{src:HE,alt:"探索热爱",className:"appPage_logo_desc",ref:m})),Ta.createElement("div",{className:"appPage_buttons"},Ta.createElement("a",{href:XE,className:"appPage_downloadBtn",onClick:e=>{const t=e.currentTarget;(0,fe.Qt)("ios","appstore"),setTimeout((()=>{window.location.href=t.getAttribute("href")}),500),e.preventDefault()}},Ta.createElement("img",{src:GE,alt:"appstore"})),Ta.createElement("div",{className:"appPage_downloadBtn"},Ta.createElement("img",{src:$E,alt:"android"}),Ta.createElement("div",{className:"appPage_downloadBtn_dropdown"},Ta.createElement("ul",{onClick:e=>{const t=e.target,a=t.getAttribute("data-channel");a&&((0,fe.Qt)("android",a),setTimeout((()=>{window.location.href=t.getAttribute("href")}),500),e.preventDefault())}},JE.map((e=>Ta.createElement("li",{key:e.channel},Ta.createElement("a",{href:e.url,"data-channel":e.channel},e.name)))))))),Ta.createElement("div",{className:"appPage_qr"},Ta.createElement("img",{src:zE,alt:"app 下载"})),Ta.createElement("div",{className:"appPage_versions"},Ta.createElement(wn.Z,{className:"gtabs-compact albumDetail_tabs",tabs:ef,active:r,hrefEnabled:!1,onTabChange:e=>{l(e)}}),Ta.createElement("div",{className:"appPage_versions_body"},i&&tf(i))))))})),lf={dispatchGapi:zg.D1},sf=(0,Ka.connect)(void 0,lf)(rf),of=(0,sn.P1)(((e,t)=>{let{articleId:a}=t;return a}),sn.LF,((e,t)=>{const a=(0,ln.tK)(e||void 0,"articles",t);if(!a)return[];const n=(0,tn.Xk)(a.getAttr("content"),"one");return n?n.blocks.map((e=>({title:e.text,id:n.convertToAnchor(e)}))).filter((e=>{let{title:t}=e;return!t.includes("以下是")})):[]})),cf=(0,Ka.connect)(((e,t)=>({titles:of(e,t)})))((e=>{let{articleId:t,titles:a}=e;const n=(0,Ir.ZP)("article",{id:t});return Ta.createElement("div",{className:"jobsPage"},Ta.createElement("div",{className:"jobsPage_header"}),Ta.createElement("div",{className:"container"},Ta.createElement("h1",null,"工作招聘"),Ta.createElement("ul",{className:"jobsPage_list"},a&&a.map((e=>{let{title:t,id:a}=e;return Ta.createElement("li",{key:a},Ta.createElement(dn.Z,{to:`${n}#${a}`},t))})))))}));var df=a(87544),mf=a(98140);const uf={dispatchGetGiveawayRecord:e=>(0,zg.D1)(`giveaway-records/${e}`),dispatchUpdateGiveawayRecord:(e,t)=>(0,zg.D1)(`giveaway-records/${e}`,{method:"PATCH",body:{data:{type:"giveaway-records",id:e,relationships:{"post-address":{data:{type:"post-addresses",id:t}}}}},meta:{successTip:"已选择地址"}})},pf=(0,sn.P1)(((e,t)=>t.id),sn.LF,((e,t)=>(0,ln.tK)(e,"giveaway-records",t))),gf=(0,Ka.connect)(((e,t)=>({giveawayRecord:pf(e,t)})),uf)((e=>{let{id:t,giveawayRecord:a,dispatchUpdateGiveawayRecord:n,dispatchGetGiveawayRecord:r,onComplete:l,...i}=e;const[s,o]=(0,Ta.useState)(null),[c,d]=(0,Ta.useState)(),[m,u]=(0,Ta.useState)(),[p,g]=(0,Ta.useState)("list");(0,Ta.useEffect)((()=>{0===(null==c?void 0:c.size)&&g("new")}),[c]),(0,Ta.useEffect)((()=>{r(t)}),[]);let h=null;return a?"list"===p?h=Ta.createElement(Ta.Fragment,null,Ta.createElement(mf.Z,{onGetData:e=>{d(e)},onEdit:e=>{u(e),g("edit")},onSelect:e=>{o(e)}}),Ta.createElement(Ya.Z,{block:!0,disabled:!s,className:"mt-3",type:s?"gift":"primary",onClick:()=>{"ready_to_delivered"!==a.getAttr("state")?s&&n(t,s.get("id")).then((()=>{null==l||l()})):alert("该奖品已发货或失效，无法提交收件信息")}},"提交收件信息"),Ta.createElement(Ya.Z,{block:!0,type:"link",className:"mt-2",onClick:()=>{g("new")}},"新增收件信息")):["new","edit"].includes(p)&&(h=Ta.createElement(df.Z,{address:"edit"===p?m:void 0,onSubmiteSuccess:()=>{g("list")}})):h=Ta.createElement("p",null,"数据获取中..."),Ta.createElement(_n.Z,i,h)}));var hf=a(16227),vf=a(8575);const Ef=e=>{let{mail:t,isMine:a}=e;const n=(0,Ta.useRef)(null),[r,l]=(0,Ta.useState)(null),[i,s]=(0,Ta.useState)(null);(0,Ta.useEffect)((()=>{const e=n.current,t=e=>{const{target:t}=e;if(!(t instanceof HTMLAnchorElement))return;const a=t.getAttribute("href"),n=((e,t)=>{if(!/app:\/\/gcores\.Feedback/.test(e))return!1;const a=vf.parse(e,!0),{type:n,...r}=a.query;return t({type:n??void 0,appendMsg:Object.keys(r).length>0?JSON.stringify(r):""}),!0})(a,(e=>{s(e)}))||(e=>{const t=/app:\/\/gcores\.Profile\?userId=(\d+)/.exec(e);return!!t&&(Qa.ZP.push((0,Ir.ZP)("user",{id:t[1]})),!0)})(a)||((e,t)=>{var a;const n=null===(a=/giveaway_records\/(\d+)/.exec(e))||void 0===a?void 0:a[1];return!!n&&(t(n),!0)})(a,(e=>{l(e)}))||(e=>{const t=/app:\/\/gcores\.CreateTalk\?talkId=(\d+)/.exec(e);if(!t)return!1;const a=t[1];return Qa.ZP.push((0,Ir.ZP)("topicEditor",{talk_id:a})),!0})(a);n&&(e.stopPropagation(),e.preventDefault())};return null==e||e.addEventListener("click",t,!0),()=>{null==e||e.removeEventListener("click",t)}}),[]);const o=t.getAttr("is-system")&&!a?new hf.Z({attributes:{nickname:"系统",thumb:"system"}}):t.getRel("sender");return Ta.createElement(Ta.Fragment,null,null!==i&&Ta.createElement(mr,{initialType:i.type,appendMsg:i.appendMsg,visible:!0,onClose:()=>{s(null)}}),r&&Ta.createElement(gf,{id:r,visible:!0,hideActionBtns:!0,onCloseClick:()=>{l(null)},onComplete:()=>{l(null)}}),t.showTime&&Ta.createElement("li",{className:"mail_time"},t.showTime),Ta.createElement("li",{className:(0,Ma.Z)("mail",{"mail-mine":a})},Ta.createElement(cn.Z,{users:o,size:"size-notification",onlyImage:!0}),Ta.createElement("div",{className:"mail_body",ref:n},(0,tn.yH)(t.getAttr("body"),tn.eL))))};class ff extends Xa.Z{constructor(e){super(e),this.state={input:"",posting:!1},this.scrollableRef=Ta.createRef()}componentDidMount(){const{dispatch:e,threadID:t}=this.props;this.request(1,!0,(()=>{setTimeout((()=>{e((0,l.YlW)(t)),setTimeout(this.scrollToLatestBottom,300)}),1e3)}))}request(e,t,a){const{opponentID:n,currentUser:r,privateMailsState:i}=this.props;(t||!i.get("isRequesting")&&!i.get("noMore"))&&this.props.dispatch((0,l.fez)(r.get("id"),n,e,t)).then((()=>{a&&a()}))}scrollToLatestBottom=()=>{this.scrollableRef.current&&this.scrollableRef.current.scrollToBottom()};handleScrollToTop=()=>{const{privateMailsState:e}=this.props,t=(e.get("currentPage")||0)+1;this.request(t)};handleInputChange=e=>{this.setState({input:e.target.value})};handleSendClick=()=>{const{input:e,posting:t}=this.state,{currentUser:a,opponent:n}=this.props;t||(this.setState({posting:!0}),this.props.dispatch((0,l.y1f)(a.get("id"),n.get("id"),e)).then((e=>{this.setState({posting:!1}),e.error||(this.setState({input:""}),this.scrollToLatestBottom())})))};renderPrivateMailsList(){const{privateMails:e,privateMailsState:t,currentUser:a}=this.props;return Ta.createElement("ul",{className:"mails"},t.get("isRequesting")&&Ta.createElement("li",{className:"mutedInfo"},"读取中...."),e.map((e=>Ta.createElement(Ef,{key:e.getKey(),mail:e,isMine:a.get("id")===e.getRel("sender","id")}))))}render(){const{opponent:e,opponentID:t}=this.props,{input:a,posting:n}=this.state,r=t===tr.VW,l=tr.cn.includes(t),i=r?"机核":e?e.getAttr("nickname"):`用户 ${t}`;return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"mailsPage_head"},l?Ta.createElement("span",null,i,l&&Ta.createElement("span",{className:"badge ms-2 mb-1"},"官方")):Ta.createElement(dn.Z,{to:(0,Ir.bv)("users",t)},i)),Ta.createElement(Ar.Z,{ref:this.scrollableRef,className:"mailsPage_mails",onScrollToTop:this.handleScrollToTop},this.renderPrivateMailsList()),l?Ta.createElement("div",{className:"mailsPage_bottom mailsPage_bottom-official"},Ta.createElement(Ya.Z,{to:w.default.faq_url,type:"link",size:"lg"},"常见问题解答")):Ta.createElement("div",{className:"mailsPage_bottom mailsPage_bottom-normal"},Ta.createElement("textarea",{placeholder:"在此输入想说的话...",onChange:this.handleInputChange,value:a}),Ta.createElement(Ya.Z,{type:"info",onClick:this.handleSendClick,loading:n,disabled:0===Al()(a).length},"发送")))}}const yf=(0,sn.P1)((e=>e.getIn(["data","privateMails","ids"])),sn.LF,((e,t)=>{let a=(0,ln.BY)(e,t).reverse();if(a.size>0){let e;a=a.map((t=>{const a=t.getAttr("created-at");return(!e||(0,rn.u3)(a)-(0,rn.u3)(e)>120)&&(e=a,t.showTime=(0,rn.Sy)(a,86400,{nowLimit:!0})),t}))}return a})),bf=(0,sn.P1)(((e,t)=>t.opponentID),sn.LF,((e,t)=>(0,ln.Jg)({type:"users",id:e},t)));ff.propTypes={currentUser:Va().record.isRequired,opponent:Va().record,privateMails:Va().list,privateMailsState:Va().map.isRequired,threadID:Ga().string.isRequired,isOfficial:Ga().bool},ff.defaultProps={opponent:void 0,privateMails:void 0,isOfficial:!1};const kf=(0,Ka.connect)(((e,t)=>{const a=yf(e,t),n=e.getIn(["data","privateMails"]),r=(0,sn.ib)(e,t),l=bf(e,t),i=((e,t)=>`${e.getIn(["session","userID"])}|${t.opponentID}`)(e,t);return{privateMails:a,privateMailsState:n,currentUser:r,opponent:l,threadID:i}}))(ff);kf.propTypes={opponentID:Ga().string.isRequired};const Cf=kf;var _f=a(57361);const wf=Ta.memo((e=>{let{opponentID:t,currentUser:a}=e;const[n,r]=(0,Ta.useState)(!1),l=(0,Ta.useCallback)((()=>{r(!1)}),[]),i=(0,Ta.useCallback)((()=>{r(!0)}),[]),s=(0,Ta.useCallback)((e=>{l(),Qa.ZP.push((0,Ir.ZP)("mails",{opponentID:e.get("id")}))}),[l]);return Ta.createElement(Ta.Fragment,null,Ta.createElement(_f.Z,{visible:n,userId:null==a?void 0:a.get("id"),onClose:l,selectText:"发私信",onSelect:s}),Ta.createElement("div",{className:"mailsPage"},Ta.createElement("div",{className:"mailsPage_top mailsPage_head"},Ta.createElement("span",null,"私信"),Ta.createElement(Ya.Z,{plain:!0,onClick:i},Ta.createElement(Da.Z,{icon:["gfas","user-list"]}))),Ta.createElement("div",{className:"mailsPage_main"},Ta.createElement("div",{className:"mailsPage_l"},Ta.createElement(Lr,{editable:!0,opponentID:t})),Ta.createElement("div",{className:"mailsPage_r"},t?Ta.createElement(Cf,{key:t,opponentID:t}):null))))})),Nf=(0,Ka.connect)(((e,t)=>({currentUser:(0,sn.ib)(e)})))(wf),Pf=[{key:"orders",title:"已购"},{key:"codes",title:"赠送"}],Sf=(0,Ka.connect)()((e=>{let{page:t,tab:a,dispatch:n}=e;const[r,i]=(0,Ta.useState)(!1),[s,o]=(0,Ta.useState)(null),[c,d]=(0,Ta.useState)(null),[m,u]=(0,Ta.useState)(!1),[p,g]=(0,Ta.useState)(1);return(0,Ta.useEffect)((()=>{u(!0),n((0,l.SMG)({page:t,scenario:"orders"===a?"BUY":"GIFT"})).then((e=>{if(i(!0),u(!1),!e)return;const{data:t,allPage:a}=e;o(t),g(a)}))}),[t,a]),Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container ordersPage"},c&&c.productType&&c.productId&&Ta.createElement(ku,{visible:!0,redeemCode:c.redeemCode,productLinkVisible:!0,product:{type:c.productType,id:c.productId,cover:c.giftCover,title:c.title},onCloseClick:()=>{d(null)},gpass:"membership"===c.itemType}),Ta.createElement(fh,{title:"我的订单",headerExtra:Ta.createElement(Pr.Z,{baseClass:"labelFilters",active:a,tabs:Pf.map((e=>({...e,to:(0,Ir.ZP)("orders",{page:t,tab:e.key})}))),hrefEnabled:!1})},Ta.createElement(oi.Z,{data:s,page:t,isRequesting:m,allPage:p,fetched:r,linkBuilder:e=>(0,Ir.ZP)("orders",{tab:a,page:e})},(e=>Ta.createElement(_h,null,e.map((e=>Ta.createElement(wh,{key:e.orderId,order:e,onClick:e=>{d(e)}}))))))))))})),Zf=(0,sn.zU)(),If=e=>{let{productId:t}=e;const a=(0,Ka.useSelector)((e=>Zf(e,{type:"products",id:t})));return Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"story_container"},Ta.createElement(fh,{title:"商店",backTo:(0,Ir.ZP)("home")},Ta.createElement(Dc.Z,{image:a?Ta.createElement("img",{src:(0,tn.cR)(a.getAttr("cover"),{resize:{w:120,h:120}})}):Ta.createElement(Da.Z,{icon:["gfas","shop"]}),title:"商品无法显示",desc:"需下载 机核APP 查看与购买商品",needApp:!0}))))},Tf={albums:{image:"gift-cover",title:"title"},"album-bundles":{image:"gift-cover",title:"title"},skus:{image:"image",title:"name"}},Af=e=>{const t=e.get("type");return"albums"===t?"一本有声书":"album-bundles"===t?"一套有声书":"skus"===t&&e.aboutGpass()?"机核会员":"礼物"},Rf=(0,sn.P1)(((e,t)=>t.producerId),sn.LF,((e,t)=>(0,ln.tK)(e||void 0,"users",t))),Df=(0,sn.P1)(((e,t)=>{let{albumId:a,type:n,id:r}=t;return a?{type:"albums",id:a}:{type:n,id:r}}),sn.LF,((e,t)=>{let{type:a,id:n}=e;return a&&n?(0,ln.tK)(n||void 0,a,t):null})),xf={dispatchGetUser:N.PRA,dispatchGetAlbum:e=>(0,V.D1)(`albums/${e}`),dispatchGetProduct:(e,t)=>(0,V.D1)(`${e}/${t}`),dispatchRedeemCode:Wm.XT},Mf=(0,Ka.connect)(((e,t)=>({producer:Rf(e,t),product:Df(e,t),currentUser:(0,sn.ib)(e)})),xf)((e=>{let{currentUser:t,producerId:a,producer:n,product:r,albumId:l,type:i,id:s,code:o,dispatchGetUser:c,dispatchGetAlbum:d,dispatchGetProduct:m,dispatchRedeemCode:u}=e;const[p,g]=(0,Ta.useState)(null),[h,v]=(0,Ta.useState)(!1);if((0,Ta.useEffect)((()=>{c(a)}),[a,c]),(0,Ta.useEffect)((()=>{l?d(l):i&&s&&m(i,s)}),[l,i,s,d,m]),!r||!o)return null;const{image:E,title:f,desc:y,isGpass:b}=(e=>{const t=e.get("type"),a=Tf[t];return a?{image:e.getAttr(a.image),title:e.getAttr(a.title),desc:Af(e),isGpass:"skus"===e.get("type")&&e.aboutGpass()}:{}})(r),k=b?void 0:E&&(0,tn.cR)(E,tn.iT.Blur);let C=E&&Ta.createElement(_i,{golden:!0},Ta.createElement("img",{src:(0,tn.cR)(E,{resize:{w:464,m:"lfit"}})}));return b&&(C=Ta.createElement("img",{src:tr.Zc[r.get("id")].card})),Ta.createElement(Ta.Fragment,null,Ta.createElement(ac,{className:(0,Ma.Z)("redeemCodePage_header",{"redeemCodePage_header-gpass":b}),withNav:!0,background:k},Ta.createElement("div",{className:"redeemCodePage_cover"},C)),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"redeemCodePage_body"},Ta.createElement("h1",null,f),Ta.createElement("p",null,n&&n.getAttr("nickname")," 送你",y,"，请点击领取"),Ta.createElement("div",{className:"mb-4"},Ta.createElement(Zh.Z,{wrapperType:Ya.Z,loading:h,type:b?"gpass":"gift",size:"lg",disabled:null!==p,onReceive:e=>{v(!0),u(o,e).then((e=>{var n,l;let[i,s]=e;"boolean"==typeof i&&g(i);const o=(null==s||null===(n=s.graphQLErrors)||void 0===n||null===(l=n[0])||void 0===l?void 0:l.message)||(null==s?void 0:s.message);/NotFoundError/.test(o)?(alert("该礼物已被领取"),g(!1)):o&&alert(`错误: ${o}`),(0,fe.j8)({type:r.get("type"),id:r.get("id"),consumerId:t.get("id"),producerId:a,isSuccess:!0===i,message:o}),v(!1)}))}},!0===p&&"已成功领取",!1===p&&"该礼物不可被领取",null===p&&"领取")),"skus"!==r.get("type")&&Ta.createElement("div",null,Ta.createElement(dn.Z,{to:(0,Ir.ZP)(r)},"查看礼物详情")))))}));var Lf=a(18909);const qf=[{key:"all",title:"综合"},{key:"talks",title:"机组"},{key:"games",title:"游戏"},{key:"products",title:"商品"},{key:"films",title:"影视"},{key:"articles",title:"文章"},{key:"radios",title:"播客"},{key:"videos",title:"视频"},{key:"users",title:"用户"}],Ff=(()=>{let e=[...qf];return e.splice(qf.findIndex((e=>"films"===e.key)),0,{key:"collections",title:"播单与专题"}),e=e.slice(2),e})(),Bf=[{key:"score",title:"相关度"},{key:"date",title:"时间"}],Of=e=>e&&Ta.createElement("div",{className:"row"},e.map((e=>{return Ta.createElement("div",{className:"col-md-4 col-sm-6",key:e.getKey()},(t=e,Ta.createElement(Lf.Z,{user:t})));var t}))),Uf=e=>e&&Ta.createElement("div",{className:"row"},e.map((e=>Ta.createElement("div",{className:"col-md-3 col-sm-6",key:e.getKey()},"collections"===e.get("type")?Ta.createElement(os,{collection:e,fixedRatio:!0}):Ta.createElement(is,{album:e,small:!0,fixedRatio:!0}))))),$f=e=>e&&Ta.createElement("div",{className:"row"},e.map((e=>Ta.createElement("div",{className:"col-md-3 col-sm-6",key:e.getKey()},Ta.createElement(si.Z,{original:e}))))),Gf=e=>e&&Ta.createElement("div",{className:"row o_equalHeightRow"},e.map((e=>Ta.createElement("div",{className:"col-md-4",key:e.getKey()},Ta.createElement(Bc.Z,{game:e,cardMode:!0}))))),zf=e=>e&&Ta.createElement("div",{className:"row o_equalHeightRow"},e.map((e=>Ta.createElement("div",{className:"col-md-4",key:e.getKey()},Ta.createElement(od,{entry:e}))))),Hf=e=>e&&Ta.createElement("div",{className:"row o_equalHeightRow"},e.map((e=>Ta.createElement("div",{className:"col-lg-3 col-md-4 col-sm-6",key:e.getKey()},Ta.createElement(vo,{title:e.getAttr("title"),thumb:e.getAttr("cover"),url:(0,Ja.Z)(e)})))));class Vf extends Xa.Z{static defaultProps={type:"all",query:""};state={init:!1,page:1,orderBy:Bf[0].key,showExplanation:!1};renderResultsNew=null;from=this.props.initFrom||"direct";componentDidMount(){const{query:e}=this.props;e.length>0&&this.search()}componentDidUpdate(e){let{query:t,type:a}=e;const{type:n,query:r}=this.props;n===a&&r===t||this.search()}render(){const{query:e,type:t}=this.props,{init:a}=this.state;return Ta.createElement(Ta.Fragment,null,Ta.createElement(zl,{visible:!0,onClose:this.handleSearchBarClose,onConfirm:this.handleSearchBarConfirm,initQuery:e,inSearchPage:!0}),this.renderPageHeader(),Ta.createElement("div",{className:"pageContainer"},Ta.createElement("div",{className:"container"},a&&Ta.createElement(Ta.Fragment,null,this.renderTypes(),"all"===t?this.renderAllResults():this.renderPagingResults()))))}search(){this.setState({init:!0}),setTimeout((()=>{const{orderBy:e,page:t}=this.state,{type:a,query:n}=this.props;"all"===a?Promise.all(Ff.map((e=>e.key)).concat(["albums"]).map((a=>this.props.dispatch((0,l.Vlz)({type:a,query:n,orderBy:e},{page:t}))))).then((t=>{if(this.from){let a=0;t.forEach((e=>{var t;e.error||(a+=(null===(t=e.payload.origin.meta)||void 0===t?void 0:t["record-count"])||0)})),(0,fe.U3)(n,"suggestion"===this.from,"hot"===this.from,"history"===this.from,a>0,a,e),this.from=null}})):this.props.dispatch((0,l.Vlz)({type:a,query:n,orderBy:e},{page:t}))}),0)}refresh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{page:1};const{page:a=1}=t;Qa.ZP.push((0,Ja.Z)("search",{keyword:e,...t})),this.setState({page:a})}getDataWithType=e=>{const{getResults:t,getSearchResultsState:a}=this.props;let n=null;return"collections"===e?(n=t("collections"),n&&(n=n.concat(t("albums")).sort(((e,t)=>new Date(t.getAttr("published-at")).getTime()-new Date(e.getAttr("published-at")).getTime())))):"all"!==e&&(n=t(e)),{results:n,searchResultsState:"all"===e?null:a(e)}};handleSearchBarClose=()=>{Qa.ZP.push("/")};handleSearchBarConfirm=(e,t)=>{this.refresh(e,{tab:qf[0].key}),this.from=t||"direct"};handlePageClick=e=>{let{selected:t}=e;this.setState({page:t+1},(()=>{this.search()}))};handleTypeClick=e=>{const{query:t}=this.props;this.refresh(t,{tab:e})};handleOrderClick=e=>{const t={orderBy:e,page:1};this.setState(t,(()=>{this.search()}))};renderTypes(){const{orderBy:e}=this.state,{type:t}=this.props;return Ta.createElement(wn.Z,{tabs:qf,active:t,subTabs:Bf,subTabActive:e,onTabChange:this.handleTypeClick,onSubTabChange:this.handleOrderClick})}renderResults=e=>{const t=e.first().get("type");return"users"===t?Of(e):"games"===t?Gf(e):"films"===t?zf(e):"products"===t?Hf(e):"talks"===t?Ta.createElement("div",{className:"story_container"},(0,Gc.VZ)(e)):$f(e)};renderPagingResults(){const{type:e}=this.props,{page:t}=this.state,{results:a,searchResultsState:n}=this.getDataWithType(e);return Ta.createElement(oi.Z,{data:a,page:t,isRequesting:!n||n.get("isRequesting"),allPage:n?n.get("allPage"):1,fetched:!!n&&n.get("fetched"),onPageChange:this.handlePageClick},this.renderResultsNew||this.renderResults)}renderPageHeader(){const{query:e,type:t}=this.props,{searchResultsState:a}=this.getDataWithType(t);return Ta.createElement(ac,{withBgCircle:!0,white:!0},Ta.createElement("div",{className:"searchPage_header"},Ta.createElement("h1",null,e||"搜索"),Ta.createElement("h2",null,a&&a.get("recordCount")>0?Ta.createElement("span",null,"共搜索出 ",a.get("recordCount")," 条结果"):"")))}renderAllResults(){const{query:e}=this.props;return Ff.map((t=>{const{results:a,searchResultsState:n}=this.getDataWithType(t.key);let r,l,i=a;if(n&&n.get("fetched")&&i&&0===i.size)return null;"users"===t.key?(l=6,r=Of):"games"===t.key?(l=3,r=Gf):"films"===t.key?(l=3,r=zf):"collections"===t.key?r=Uf:"products"===t.key?(r=Hf,l=4):(l=4,r=$f);const s=i.size>l?(0,Ja.Z)("search",{tab:t.key,keyword:e}):void 0;return l&&(i=i.slice(0,l)),Ta.createElement(ci.Z,{title:t.title,key:t.key,moreTo:s},Ta.createElement(Rr.Z,{data:i,loading:!!n&&n.get("isRequesting"),fetched:!!n&&n.get("fetched")},r))}))}}const Wf={},jf=(0,Ka.connect)(((e,t)=>({query:t.query&&decodeURIComponent(t.query),getResults:a=>{const n=Wf[a]||(e=>(0,sn.P1)((t=>t.getIn(["data","search","results",e,"ids"])),sn.LF,((e,t)=>(0,ln.BY)(e,t))))(a);return Wf[a]=n,n(e,t)},getSearchResultsState:t=>e.getIn(["data","search","results",t])})))(Vf),Kf=a.p+"cd9f426a3501e5eaf29d.jpg";var Jf=a(7817);const{phoneFormatTip:Yf,phoneRegexp:Xf}=w.default,Qf=e=>{const{code:t,phoneNumber:a}=e,n={};return t||(n.code="验证码不能为空"),a&&Xf.test(a)||(n.phoneNumber=`手机号格式错误，${Yf}`),n},ey=e=>{let{onSubmit:t}=e;return Ta.createElement(er.l0,{onSubmit:t,validate:Qf},(e=>{let{handleSubmit:t,submitting:a,values:{phoneNumber:n}}=e;return Ta.createElement("form",{onSubmit:t,method:"post"},Ta.createElement(Jf.Z,{phone:n}),Ta.createElement("div",{className:"form-group"},Ta.createElement(Ya.Z,{type:"danger",htmlType:"submit",size:"lg",className:"d-block w-100",disabled:a},a?"领取中...":"领取有声书")))}))},ty=["100","64","71"],ay={100:"1992年成书的科幻小说《雪崩》，是说起“赛博朋克”不得不提的小说。现在大家能记起的通常是这部作品有关“化身”、“超元域”等技术前瞻的元素，但其实这本书还有非常爽快的剧情，和从另一种角度对宗教和文明的洞察。\n\n  在《雪崩》中，未来美国是一个尖端科技与野蛮低俗混杂之地，而现实之外还存在着另一个无比广阔自由的国度：由电脑和网络构成的赛博空间。主人公现实中是名披萨速递员，但在虚拟空间中，他是首屈一指的黑客、擅使双刀的高手，可以毁灭世界，也可以拯救世界……",64:"如果您还不知道什么是《克苏鲁神话》，那么希望这部有声书能成为大家进入它的大门的一把钥匙。霍华德·菲利普斯·洛夫克拉夫特是美国恐怖，科幻与奇幻小说作家。他最著名的作品是后来被称为《克苏鲁神话》（Cthulhu Mythos）的小说集。是20世纪最具影响力的恐怖小说体系之一。 \n\n  洛夫克拉夫特倡导“宇宙主义”，即人类远非世界的主宰者，在尚未探索的未知宇宙中，隐藏着超乎想象、不可名状的恐怖真相。“人类最古老、最强烈的情感是恐惧；而最古老、最强烈的恐惧，是对未知的恐惧”。",71:"推出《超级马力欧》《塞尔达传说》等风靡世界的游戏的日本公司任天堂，最初竟然是一间制作纸牌的小公司？任天堂究竟是如何从众多竞争对手中脱颖而出，称霸全球游戏界的？\n\n  本书是一本酣畅淋漓的商战纪实。以大量第一手访谈资料，围绕山内溥、荒川实、宫本茂、霍华德·林肯等一众日美核心成员的奋斗历程，将任天堂自纸牌厂商切入电子游戏领域，最终借助红白机成长为业界霸主的全过程娓娓道来，深入剖析它的商业成功之道。其中还包括任天堂成为日美贸易摩擦的标靶后，如何突围的精彩历程。"},ny=e=>{let{children:t}=e;return Ta.createElement("div",{className:"trialABPage_block"},Ta.createElement("div",{className:"story_container"},t))},ry=e=>{var t;let{album:a}=e;const n=a.get("id"),r=a.getAttr("title");return Ta.createElement(dn.Z,{key:n,to:(0,Ir.ZP)("album",{id:n}),className:"trialABPage_album"},Ta.createElement("div",{className:"trialABPage_album_head"},Ta.createElement("img",{src:(0,tn.cR)(a.getAttr("cover"),{resize:{w:140,h:140}}),alt:r}),Ta.createElement("div",{className:"trialABPage_album_info"},Ta.createElement("div",null,Ta.createElement("h3",null,r),Ta.createElement("p",null,a.getAttr("author"))),Ta.createElement("div",null,Ta.createElement("p",null,"共 ",a.getAttr("chapters-count")," 章"),Ta.createElement(Ya.Z,{type:"pay",ellipse:!0},(0,tn.T4)(null===(t=a.getOwnSku())||void 0===t?void 0:t.getAttr("amount")))))),Ta.createElement("div",{className:"trialABPage_album_desc"},ay[n]))};var ly=function(e){return e[e.Ready=0]="Ready",e[e.GotToken=1]="GotToken",e[e.PlacingOrder=2]="PlacingOrder",e[e.PlaceFailure=3]="PlaceFailure",e[e.PlaceSuccess=4]="PlaceSuccess",e}(ly||{});const iy=(0,sn.P1)(sn.LF,(e=>(0,ln.BY)(ty.map((e=>({type:"albums",id:e}))),e).filter((e=>{const t=e.getExpirableOwnSku();return t&&0===t.getAttr("amount")})))),sy=(0,sn.P1)(iy,(e=>e.map((e=>e.getExpirableOwnSku().get("id"))).toJS())),oy={dispatchPlaceOrder:Wm.s1,dispatchCheckOrderStatus:Wm.HL,dispatchSignup:(e,t)=>(0,V.D1)("/security/signup",{method:"POST",body:{data:{"phone-number":e,"verification-code":t}}}),dispatchRefreshTokenSuccess:e=>({type:(0,$e.Xk)(N.z6A),payload:e})},cy=(0,Ka.connect)(((e,t)=>{const a=(0,sn.ib)(e);return{products:iy(e),skuIds:sy(e),currentUser:a}}),oy)((e=>{let{currentUser:t,products:a,skuIds:n,dispatchSignup:l,dispatchRefreshTokenSuccess:i,dispatchPlaceOrder:s,dispatchCheckOrderStatus:o}=e;const c=(0,Ua.EY)(),[d,m]=(0,Ta.useState)(t?ly.GotToken:ly.Ready),[u,p]=(0,Ta.useState)(!1),g=(0,Ta.useCallback)((async e=>{p(!0);let a=!1;for(const e of n){const t=await s(e);let n=!1;for(let e=3;e>0&&(n=(await o(t))[0],!n);e--);if(!n)break;a=!0}c.sendMessage({body:a?"领取成功":"领取失败",type:a?r.ZQ.SUCCESS:r.ZQ.ERROR}),m(a?ly.PlaceSuccess:ly.PlaceFailure),p(!1);try{a&&(0,fe.Wf)({ids:ty,userId:e||(null==t?void 0:t.get("id"))})}catch(e){}}),[n,s,o,c,t]),h=(0,Ta.useCallback)((async e=>{var t,a,n;const{phoneNumber:r,code:s}=e,o=await l(r,s);i(o.payload),await g(null===(t=o.payload)||void 0===t||null===(a=t.origin)||void 0===a||null===(n=a.data)||void 0===n?void 0:n["user-id"])}),[g,i,l]),v=(0,Ta.useMemo)((()=>{if(d===ly.Ready)return Ta.createElement(ey,{onSubmit:h});const e={block:!0,className:"mt-3",type:"danger",size:"lg"},t={...e,onClick:()=>{g()},loading:u};return d===ly.GotToken?Ta.createElement("div",null,"您已经登录，请点击免费领取限时体验有声书",Ta.createElement(Ya.Z,t,"领取有声书")):d===ly.PlaceFailure?Ta.createElement("div",null,"领取失败, 请点击重试",Ta.createElement(Ya.Z,t,"领取有声书")):d===ly.PlaceSuccess?Ta.createElement("div",null,"领取成功，请下载机核 App 并使用同样的手机号登录收听。",Ta.createElement(Ya.Z,(0,Aa.Z)({},e,{to:"/app"}),"下载机核APP")):null}),[d,h,g,u]);return Ta.createElement(Ta.Fragment,null,Ta.createElement("div",{className:"trialABPage"},Ta.createElement("div",{className:"trialABPage_header"},Ta.createElement("div",{className:"story_container"},Ta.createElement("img",{src:Kf,alt:"宣传图"}))),Ta.createElement(ny,null,Ta.createElement("div",{className:"trialABPage_intro"},Ta.createElement("h1",{className:"trialABPage_title"},"从游戏出发，听见更多"),Ta.createElement("p",null,"本次 机核网 与 看理想 联合，希望能从游戏文化出发，带您到达一个更广阔的世界。9月27日至10月10日，所有看理想用户可以免费领取以下3本 机核网精品付费有声书14天畅听 福利。输入手机号登录机核即可免费领取。"),v)),Ta.createElement(ny,null,Ta.createElement("h1",{className:"trialABPage_title"},"有声书畅听书目简介"),a.map((e=>Ta.createElement(ry,{key:e.get("id"),album:e})))),Ta.createElement(ny,null,Ta.createElement("h1",{className:"trialABPage_title"},"机核 - 次世代游戏文化生活社区"),Ta.createElement("p",null,"机核一直致力于分享游戏玩家的生活，以及深入探讨游戏相关的文化。一直在不断寻找高质量的内容创作者，并持续制作传播原创的有声节目。"),Ta.createElement("p",null,"机核坚信游戏不止是游戏，游戏中包含的科学，文化，历史等各个层面的知识和故事，它们同时也会辐射到书籍、电影与音乐领域，这些深度内容非常值得分享给热爱游戏的玩家群体，机核一直专注于普及游戏相关文化与制作原创深度内容。"),Ta.createElement("div",{className:"mt-3 pt-3"},Ta.createElement("h1",{className:"trialABPage_title"},"领取须知"),Ta.createElement("div",{className:"trialABPage_content"},"1.按照活动简介所写方式输入并验证手机号码即可领取畅听有声书至对应机核帐号；\n2.打开机核App或网站，使用领取畅听有声书的手机号登录，点击 我的 - 我的已购 即可查看并收听已领取的畅听有声书；\n3.限时畅听有声书福利自领取成功成功之日起14天内有效。领取成功的具体时间以 我的订单 中的领取条目信息为准；\n4.领取机核有声书成功的消息将会以机核官方私信的方式通知至领取用户；\n5.在私信页显示的机核官方私信条目，在名称后会有显示官方字样的黑色标签，请务必确认清楚。我们不会向用户索要银行卡号及密码等个人隐私敏感信息，也不会提供点击跳转至非机核网址的私信链接；\n6.活动结束后将无法领取有声书。每位用户仅可成功领取一次福利；\n7.机核GCORES 的领取畅听有声书活动与苹果公司无关；\n8.由于不可抗力因素、网络故障、漏洞作弊等非官方原因导致的活动异常，机核GCORES 有权对抽奖活动进行调整、暂停、终止等操作。领取畅听有声书活动的最终解释权归 机核GCORES 所有。")))))})),dy=e=>{let{signout:t}=e;const a=(0,Ka.useDispatch)();return(0,Ta.useEffect)((()=>{t&&(a((0,l.zb9)()),setTimeout((()=>{window.location.href=w.default.main_url}),500))}),[t,a]),Ta.createElement("div",{className:(0,Ma.Z)("__")},Ta.createElement("div",{className:"pageContainer"},Ta.createElement(fm.Z,null)))},my=e=>{const t=(0,yr.pC)("/");return Ta.createElement("div",{className:(0,Ma.Z)("container"),style:{height:"80vh"}},Ta.createElement(mr,{visible:!0,onClose:()=>{t()}}))},uy={...(0,ii.r3)("app"),action(e){let{query:{quick:t}}=e;return{title:"App",context:{navTransparent:!0},component:Ta.createElement(sf,{quick:t})}}},py={...(0,ii.r3)("search"),action(e){let{query:t}=e;const{keyword:a,tab:n,from:r}=t;return{title:"搜索",context:{hideNav:!0},component:Ta.createElement(jf,{query:a,type:n,initFrom:r})}}},gy={...(0,ii.r3)("mails"),async action(e){let{store:t,query:a}=e;const{opponentID:n}=a;if(!t.getState().getIn(["session","signined"]))return(0,$g.fg)({disableLog:!0});return!(n===tr.VW)&&n&&await t.dispatch((0,N.PRA)(n)),Ta.createElement(Nf,{opponentID:n})}},hy={...(0,ii.r3)("comment"),async action(e){let{store:t,params:a}=e;const{id:n}=a,r=await t.dispatch((0,N.d7q)(n,{includeQueryPush:["commentable"]}));if(r.error)throw r.payload;const l=r.payload.origin.data.relationships.commentable.data,i={type:l.type,id:l.id};return{redirect:(0,Ir.bv)(i.type,i.id,{comment_id:n})}}},vy={...(0,ii.r3)("original"),async action(e){let{store:t,params:a,query:n}=e;const{id:r}=a,l=(await t.dispatch((0,N.KuO)({type:"originals",id:r}))).payload.origin.data;return{redirect:(0,Ir.bv)(l.type,l.id,n)}}},Ey={path:new RegExp(`(articles|videos|radios)/(${TE.join("|")})(\\?.*)?$`),action(e){let{params:t}=e;return{redirect:`/2077/${t[0]}/${t[1]}`}}},fy={...(0,ii.r3)("waiting"),action(e){let{query:t}=e;return Ta.createElement("div",{className:"pageContainer"},Ta.createElement(dy,{signout:t.signout}))}},yy={...(0,ii.r3)("orders"),action(e){let{query:t,getCurrentUser:a}=e;return a()?{title:"我的订单",component:Ta.createElement(Sf,{page:(0,nn.CO)(t.page),tab:t.tab||"orders"})}:{redirect:"/"}}},by={...(0,ii.r3)("bookcase"),action(e){let{getCurrentUser:t}=e;return t()?{title:"我的已购",component:Ta.createElement(LE,null)}:{redirect:"/"}}},ky={...(0,ii.r3)("redeem_code"),action(e){let{query:t,getCurrentUser:a}=e;const n=a(),{code:r,type:l,id:i,album_id:s,producer_id:o}=t;if(!n){return{redirect:`/account/signin?return=${encodeURIComponent(`/redeem_code?code=${r}&producer_id=${o}${s?`&album_id=${s}`:`&type=${l}&id=${i}`}`)}`}}return{title:"兑换码",component:Ta.createElement(Mf,{producerId:o,albumId:s,code:r,type:l,id:i}),context:{navTransparent:!0}}}},Cy={...(0,ii.r3)("trial_audio_book"),async action(e){let{store:{dispatch:t}}=e;return await t((0,zg.D1)("albums",{include:["sale-options"],filters:{id:ty.join(",")}})),{context:{hideGlobalActions:!0,hideFooter:!0,hideNav:!0,needShowAppDownloadTip:!1},component:Ta.createElement(cy,null)}}},_y="134546",wy={...(0,ii.r3)("jobs"),async action(e){let{store:{dispatch:t}}=e;return await t((0,zg.D1)(`articles/${_y}`)),Ta.createElement(cf,{articleId:_y})}},Ny={path:"",children:[{...(0,ii.r3)("eshop"),action:()=>Ta.createElement(If,null)}]},Py={...(0,ii.r3)("feedback"),action:()=>({component:Ta.createElement(my,null),context:{hideFooter:!0,needShowAppDownloadTip:!1}})};var Sy=a(72753);const Zy=e=>((0,Ta.useEffect)((()=>{var e;e="react native log test",(0,Sy.d1)()&&(0,Sy.pj)("log",e)}),[]),Ta.createElement("div",{className:"playgroundPage"},Ta.createElement(dn.Z,{to:"/news"},"ohohoho"))),Iy=e=>{const t=[{url:"https://www.gcores.com"},{url:"https://www.gcores.com/"},{url:"https://www.gcores.com/radios/179326"},{url:"https://site.gcores.com/dl/test/"},{url:"https://site.gcores.com/dl/test"},{url:"https://site.gcores.com/dl/test_file.html"},{url:"gcores://"},{url:"gcores://open?url=https://www.gcores.com/radios/179326"},{url:`gcores://open?url=${encodeURIComponent("https://www.gcores.com/radios/179326")}`},{url:"gcores://open?url=app://gcores.ProductList?slug=product-promotions-1&listType=product-promotions"},{url:"gcores://wrongAction?a=b"},{url:"gcoreswrong://"},{url:"https://dl.gcores.com"},{url:"https://dl.gcores.com/"},{url:"https://dl.gcores.com/radios/179326"},{url:"https://oia.zhihu.com"},{url:"https://oia.zhihu.com/feed?open=1&utm_medium=homepage&utm_id=0&fallback_url=https%3A%2F%2Foia.zhihu.com%2Ffeed%3Futm_medium%3Dhomepage%26utm_id%3D0"},{url:`https://oia.zhihu.com/feed?open=1&utm_medium=homepage&utm_id=0&fallback_url=${encodeURIComponent("https://www.gcores.com/radios/179326")}`}];return Ta.createElement("div",{className:(0,Ma.Z)("__"),style:{display:"flex",flexDirection:"column",padding:"10vw",fontSize:18,gap:"20px"}},t.map((e=>{let{url:t,title:a=t}=e;return Ta.createElement("div",{key:t},Ta.createElement("p",null,Ta.createElement("a",{href:t},a)),Ta.createElement("p",null,Ta.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},a,"(新窗口)")),Ta.createElement("p",null,Ta.createElement("a",{role:"button",onClick:e=>{location.href=t,e.preventDefault()}},a,"(事件绑定)")))})))},Ty={path:"",children:[Qo,hh,kd,Ey,Ku,Ru,Om,ap,cp,yp,Vp,py,gy,hy,Xg,jg,Vg,ky,Cy,Gu,uy,mv,uv,Pv,zv,$p,Sp,Gg,yy,by,Hg,Ug,vy,sh,eh,wy,Ny,pE,ZE,_E,Py,{...(0,ii.r3)("playground"),action(e){let{getCurrentUser:t,query:a}=e;if("justplay9009"!==a.code)throw(0,$g.vu)()},children:[{...(0,ii.r3)("playgroundForm"),action(e){let{query:{applyId:t}}=e;return{htmlClassNames:["pureLightBg"],component:Ta.createElement(Zy,{applyId:t}),context:{hideNav:!0,hideFooter:!0,hideGlobalActions:!0,needShowAppDownloadTip:!1}}}},{path:"/deeplink",action:()=>({component:Ta.createElement(Iy,null)})}]},fy]},Ay=(0,ii.p7)(Ty),Ry={...Ia.ZP.Main,router:Ay,App:li,createStore:Za,scripts:[w.default.scriptLinks.applejs],linkStyles:["https://g.alicdn.com/de/prismplayer/2.13.2/skins/default/aliplayer-min.css"]},Dy=Za(),{dispatch:xy}=Dy,My=(0,n.Z)(Ry,Dy,{onRouteResolved:e=>{let{currentLocation:t}=e;var a;a=t.pathname,/radios\/\d+\/timelines/.test(a)||Dy.getState().getIn(["player","mode"])===r.R9.FULLSCREEN&&xy((0,l.Lfj)(r.R9.MINI))}});(async()=>{await My(void 0,(e=>{e&&xy(Qt.Z.actions.getInvolvements(e))}))})()},24016:(e,t,a)=>{a.d(t,{oH:()=>s,p7:()=>c,r3:()=>o});var n=a(14988),r=a(65019),l=a(30213);const i="animations|books|films|celebrities|organizations|tags",s=()=>[{path:"",children:[{path:"",name:"home"},{path:"/feeds",name:"feeds"},{path:"/latest",name:"latest"}]},{path:"",children:[{path:"/audio_books",name:"audioBooks"},{path:"/albums",name:"albums"},{path:"/privilege_albums",name:"privilegeAlbums"},{path:"/albums/:id",name:"album"}]},{name:"albumBundle",path:"/album_bundles/:id"},{path:"/collections",children:[{path:"",name:"collections"},{path:"/:id",name:"collection"}]},{path:"/comments/:id",name:"comment"},{path:"/originals/:id",name:"original"},{path:"/articles",children:[{path:"/:id",name:"article"},{path:"",name:"articles"}]},{path:"/news",name:"newsList"},{path:"/videos",children:[{path:"/:id",name:"video"},{path:"",name:"videos"}]},{path:"/radios",children:[{path:"/:id",name:"radio",children:[{path:"/timelines",name:"timelines"}]},{path:"",name:"radios"}]},{path:"/categories",name:"categories",children:[{path:"/:id",name:"category"}]},{path:"/search",name:"search"},{path:"/users",children:[{path:"/:id",name:"user",children:[{path:"/talks",name:"userTalks"},{path:"/products",name:"userProducts"},{path:"/content",name:"userContent"},{path:"/subscriptions",name:"userSubscriptions"},{path:"/bookmarks",name:"userBookmarks"},{path:"/works",name:"userWorks"}]}]},{path:"/settings",name:"settings"},{path:"/orders",name:"orders"},{path:"/bookcase",name:"bookcase"},{path:"/mails",name:"mails"},{path:"/original_editor",name:"originalEditor"},{path:"/topics",children:[{path:"/editor",name:"topicEditor"},{path:"/home",name:"topicsHome"},{path:"/:id",name:"topic"}]},{path:"/talks/:id",name:"talk"},{path:"/games/player",name:"gamePlayer"},{path:new RegExp("games/(\\d+)(?:\\/([a-zA-Z]+))?(\\?.*)?$"),name:"game"},{path:new RegExp(`(${i})/(\\d+)(\\?.*)?$`),name:"term"},{path:new RegExp(`(${i})/(\\d+)/originals`),name:"termOriginals"},{path:"/games",children:[{path:"/hot",name:"gamesHot"},{path:"/coming",name:"gamesComing"}]},{path:"/redeem_code",name:"redeem_code"},{path:"/trial_audio_book",name:"trial_audio_book"},{path:"/portfolios/:id",name:"portfolio"},{path:"/next",children:[{path:"",name:"next"},{path:"/news",name:"nextNews"},{path:"/hardware",name:"nextHardware"}]},{name:"app",path:"/app"},{name:"jobs",path:"/jobs"},{path:"",children:[{name:"gpass_redeem",path:"/gpass_redeem"},{name:"gpass",path:"/gpass"}]},{path:"/gpass_privilege",children:[{name:"gpassPanel",path:""},{name:"gpassOrders",path:"/orders"},{name:"creditPurchase",path:"/credit_purchase"}]},{path:"",children:[{name:"product",path:"/products/:id"},{name:"eshop",path:"/eshop/:merchant"}]},{name:"works",path:"/works"},{name:"playground",path:"/playground",children:[{name:"playgroundForm",path:"/form"}]},{path:"/discussions",children:[{name:"discussions",path:""},{name:"discussion",path:"/:id"},{name:"discussionPoll",path:"/:id/poll"}]},{},{name:"devCommunity",path:"/dev_community",children:[{name:"devCommunityApplication",path:"/application"},{name:"devCommunityManage",path:"/manage"},{name:"devCommunityEntryEdit",path:"/entries/edit"},{name:"devCommunityEntity",path:"/entities/:id"},{name:"devCommunityEntityEdit",path:"/entities/edit"},{path:"/entries/:id",children:[{name:"devCommunityGame",path:""},{name:"devCommunityGameEdit",path:"/edit"},{name:"devCommunityGameLink",path:"/links"}]}]},{path:"/booom",children:[{path:"",name:"booomHomepage"},{path:"/game_lib",name:"booomGameLib"},{path:"/game_lib/browse",name:"booomGameLibBrowse"},{path:"/game_lib/collections",children:[{path:"",name:"booomGameLibCollections"},{path:"/:id",name:"booomGameLibCollection"}]}]},{name:"feedback",path:"/feedback"},{name:"waiting",path:"/waiting"}],o=e=>(0,l.hE)(e,s()),c=e=>(0,n.p)(e,{baseUrl:r.ZP.Main.path});c({path:"",children:s()})},28718:(e,t,a)=>{a.d(t,{D:()=>l,Z:()=>r});var n=a(91433);const r=n.ZP,l=n.bv},1761:(e,t,a)=>{a.d(t,{Kt:()=>s,Me:()=>o,ec:()=>i,ro:()=>r});var n=a(1145);const r=3,l=2;function i(e){const t=e.toJSFlat();return t.rootCommentID=t.id,t.model=e,(t.descendants||t.oldestDescendants)&&(t.structedDescendants=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.depth+l-1;const i={},s=[],o=(0,n.Wz)(e);return o.forEach(((a,n)=>{a.structedDescendants=[],a.showAll=!0,a.rootCommentID=t.id,a.model=e.get(n),i[a.id]=a})),o.sort(((e,t)=>new Date(e.createdAtDate)-new Date(t.createdAtDate))),o.forEach((e=>{const t=function(e,t,a){return function t(n){if(!n.parent)return!1;const r=e[n.parent.id];return void 0===r||r.depth<=a?r:t(r)}(t)}(i,e,a-1);!1!==t&&(void 0!==t?(t.structedDescendants.push(e),t.structedDescendants.length>r&&(t.showAll=!1)):s.push(e))})),s}(e.getRel("descendants")||e.getRel("oldest-descendants"),t),t.showAll=t.structedDescendants.length<=r),t}function s(e){const t=e.map((e=>i(e)));return t.toArray?t.toArray():t}const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const a=t-e.length;let n,r;return a<0?(n=`已超出 ${-a} 个字`,r="danger"):0===a?(n="已达到字数限制",r="warning"):n=a===t?"":`还可以输入 ${a} 个字`,{size:a,tip:n,warningStatus:r}}},4397:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(67294),r=a(45697),l=a.n(r),i=a(5885),s=a(33529);class o extends n.Component{componentDidMount(){this.show(!1,this.props.visible)}componentDidUpdate(e){this.show(e.visible,this.props.visible)}componentWillUnmount(){this.show(!0,!1)}show(e,t){const{context:a}=this.props;e!==t&&(t?a.disableEditor():a.enableEditor())}render(){return n.createElement(s.Z,this.props)}}o.propTypes={context:l().object.isRequired,visible:l().bool.isRequired};const c=(0,i.l)(o)},28326:(e,t,a)=>{a.d(t,{Z:()=>I});var n=a(73126),r=a(45697),l=a.n(r),i=a(67294),s=a(85846),o=a(4397),c=a(33529),d=a(30998),m=a.n(d),u=a(82729),p=a.n(u),g=a(27503),h=a(35018),v=a(6592),E=a(52004),f=a(83432);class y extends i.PureComponent{constructor(e){super(e),this.state={path:e.path,caption:e.caption}}update(e){this.props.onUpdated&&this.props.onUpdated(this.props.id,e)}handleImageChange=(()=>{var e=this;return function(t){let{width:a,height:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:r}=e.props;null===t?e.props.onDelClick(r):(e.update({path:t,width:a,height:n}),e.setState({path:t}))}})();handleCaptionChange=e=>{const t={caption:e.target.value};this.setState(t),this.update(t)};render(){const{file:e,className:t,hideCaption:a}=this.props,{caption:n,path:r}=this.state;return i.createElement("div",{className:(0,E.Z)("story_editor_gallery_item",t)},i.createElement(f.Z,{file:e,image:r,onChange:this.handleImageChange}),!a&&i.createElement("textarea",{type:"text",className:"form-control form-control-sm",placeholder:"图片说明",value:n,onChange:this.handleCaptionChange}))}}y.propTypes={id:l().number.isRequired,file:l().object,path:l().string,caption:l().string,className:l().string,hideCaption:l().bool,onDelClick:l().func.isRequired,onUpdated:l().func.isRequired},y.defaultProps={className:void 0,file:null,path:"",caption:"",hideCaption:!1};const b=y;let k=0;const C=()=>(k+=1,k),_=(0,g.W8)((e=>{let{imageData:t,onClickDel:a,onUpdated:r,hideCaption:l}=e;return i.createElement(b,(0,n.Z)({},t,{key:t.id,onDelClick:a,onUpdated:r,hideCaption:l}))})),w=(0,g.W8)((e=>{let{onChange:t}=e;return i.createElement("div",{className:"story_editor_gallery_new"},i.createElement("div",{className:"form_fileBlock"},i.createElement("input",{type:"file",multiple:!0,onChange:t}),i.createElement(h.Z,{icon:["gfas","plus"]})))})),N=(0,g.JN)((e=>{let{images:t,sortable:a,hideCaption:n,onClickDel:r,onUpdated:l,onChange:s,countLimit:o}=e;const c=t.map(((e,t)=>i.createElement(_,{key:e.id,index:t,imageData:e,onClickDel:r,onUpdated:l,disabled:!a,hideCaption:n})));let d=null;return!a&&t.length<o&&(d=i.createElement(w,{onChange:s,index:t.length,disabled:!0})),i.createElement("div",{className:"story_editor_gallery"},c,d)}));class P extends i.PureComponent{constructor(e){var t;super(e),(t=e.data.images)&&t.forEach((e=>{e.id=C()})),this.state={width:"",height:"",images:[],caption:void 0,...e.data},this.handleWidthDataChange=this.handleDataChange.bind(this,"width"),this.handleHeightDataChange=this.handleDataChange.bind(this,"height"),this.handleCaptionDataChange=this.handleDataChange.bind(this,"caption"),this.handleClickDel=this.handleClickDel.bind(this),this.handleUpdated=this.handleUpdated.bind(this),this.handleAddChange=this.handleAddChange.bind(this),this.handleSortEnd=this.handleSortEnd.bind(this)}getData(){const{images:e,width:t,height:a,caption:n}=this.state,r=Number(t),l=Number(a);return{caption:n,images:e.filter((e=>!!e.path)).map((e=>{const t={...e};return delete t.id,delete t.file,t})),...r>0&&l>0?{width:r,height:l}:null}}handleClickDel(e){this.setState((t=>{const{images:a}=t;return p()(a,(t=>t.id===e)),{images:[...a]}}))}handleAddChange(e){const{images:t}=this.state,{countLimit:a}=this.props,{files:n}=e.target,r=a-t.length;if(r<=0)return void alert("已超过图片数限制");const l=(0,v.ox)(n,{limitFilesNum:r});if(l.errors)return void alert(l.errorsStr);const i=l.files.map((e=>({id:C(),file:e})));this.setState((e=>({images:e.images.concat(i)})))}handleUpdated(e,t){const a=m()(this.state.images,(t=>t.id===e)),n=this.state.images[a];Object.assign(n,t)}handleDataChange(e,t){const{value:a}=t.target;this.setState({[e]:a})}handleSortEnd(e){let{oldIndex:t,newIndex:a}=e;const n=(0,g.Rp)(this.state.images,t,a);this.setState({images:n})}render(){const{sortable:e,onlyImages:t,countLimit:a}=this.props,{images:n,width:r,height:l,caption:s}=this.state;return i.createElement("div",{className:(0,E.Z)({"story_editor_gallery-sortable":e,"story_editor_gallery-onlyImages":t})},!t&&i.createElement("div",{className:"story_editor_gallery_meta"},i.createElement("input",{type:"text",className:"form-control",placeholder:"宽",value:r,onChange:this.handleWidthDataChange}),"x",i.createElement("input",{type:"text",className:"form-control",placeholder:"高",value:l,onChange:this.handleHeightDataChange}),i.createElement("input",{type:"text",className:"form-control story_editor_gallery_caption",placeholder:"说明",value:s||"",onChange:this.handleCaptionDataChange})),i.createElement(N,{images:n,onClickDel:this.handleClickDel,onUpdated:this.handleUpdated,onChange:this.handleAddChange,helperClass:"story_editor_gallery_sorting",axis:"xy",sortable:e,onSortEnd:this.handleSortEnd,hideCaption:t,countLimit:a}))}}P.propTypes={data:l().object,sortable:l().bool,onlyImages:l().bool,countLimit:l().number.isRequired},P.defaultProps={data:{},sortable:!1,onlyImages:!1};const S=P;class Z extends i.PureComponent{constructor(e){super(e),this.handleClose=this.handleClose.bind(this),this.handleConfirm=this.handleConfirm.bind(this),this.state={sortable:!1}}handleConfirm(){const e=this.galleryEditor.getData();this.props.close(),this.props.onConfirmClick(e)}handleClose(){this.props.close()}handleSortClick=()=>{this.setState({sortable:!0})};handleSortConfirmClick=()=>{this.setState({sortable:!1})};renderSubActions(){const{sortable:e}=this.state;return e?i.createElement("span",{className:"u_fontSize-sm"},"拖动图片进行排序"):i.createElement(s.Z,{anchor:!0,plain:!0,onClick:this.handleSortClick},"排序")}renderActions(){const{sortable:e}=this.state;return e?i.createElement(s.Z,{type:"info",size:"lg",onClick:this.handleSortConfirmClick},"完成"):null}render(){const{sortable:e}=this.state,{visible:t,galleryEditorProps:a,data:r,storyEditorContext:l,countLimit:s}=this.props,d=l?o.Z:c.Z;return i.createElement(d,{visible:t,fullscreen:!0,title:"图库编辑",desc:`选择图片并排序，最多不超过${s}张`,contentLabel:"Modal",shouldConfirmOnPressEnter:!1,onCloseClick:this.handleClose,onConfirmClick:this.handleConfirm,subActions:this.renderSubActions(),actions:this.renderActions()},i.createElement(S,(0,n.Z)({sortable:e,data:r,ref:e=>{this.galleryEditor=e},countLimit:s},a)))}}Z.propTypes={visible:l().bool.isRequired,data:l().object,galleryEditorProps:l().object,onConfirmClick:l().func.isRequired,close:l().func.isRequired,storyEditorContext:l().bool,countLimit:l().number},Z.defaultProps={data:void 0,galleryEditorProps:void 0,storyEditorContext:!0,countLimit:9};const I=Z},5885:(e,t,a)=>{a.d(t,{Z:()=>s,l:()=>i});var n=a(73126),r=a(67294);const l=r.createContext();function i(e){return function(t){return r.createElement(l.Consumer,null,(a=>r.createElement(e,(0,n.Z)({},t,{context:a}))))}}const s=l},58802:(e,t,a)=>{a.d(t,{N:()=>se,Z:()=>oe});var n=a(73126),r=a(67294),l=a(45697),i=a.n(l),s=a(23930),o=a.n(s),c=a(8575),d=a(50533),m=a(22222),u=a(92426),p=a(66261),g=a(1761),h=a(2186),v=a(23274),E=a(1145),f=a(52004),y=a(34282),b=a(85846);class k extends r.PureComponent{constructor(e){super(e),this.handleTimeSortClick=this.handleSortClick.bind(this,"time"),this.handleScoreSortClick=this.handleSortClick.bind(this,"score")}handleSortClick(e){const{onSort:t}=this.props;t(e)}render(){const{className:e,defaultStyle:t,sort:a}=this.props,n=e=>t?a===e?"u_color-gray-text":"u_color-gray-icon":a===e?"is_active":void 0;return r.createElement("span",{className:e},r.createElement(b.Z,{className:(0,f.Z)(n("score"),{"me-3":t}),onClick:this.handleScoreSortClick,plain:!0,anchor:!0},"热门"),r.createElement(b.Z,{className:n("time"),onClick:this.handleTimeSortClick,plain:!0,anchor:!0},"最新"))}}k.propTypes={className:i().string,sort:i().string.isRequired,onSort:i().func.isRequired,defaultStyle:i().bool},k.defaultProps={className:"",defaultStyle:!0};const C=k;var _=a(83476),w=a(52949),N=a(76997),P=a(89091);class S extends y.Z{constructor(e){super(e),this.state={isPosting:!1}}postedComment(e){this.setState({isPosting:!1}),e&&this.rcInput.reset()}handleCommentSubmit=(e,t)=>{this.setState({isPosting:!0}),this.props.onCommentSubmit(e,t).then((e=>{this.postedComment(!e.error)}))};handleTabClick=e=>{this.props.onTabClick(e)};renderComments=e=>{const{onRenderComment:t}=this.props;return r.createElement(P.Z,{comments:e,parent:void 0,onRenderComment:t})};render(){const{className:e,commentable:t,comments:a,count:n,sort:l,currentUser:i,reviewMode:s,hideInput:o,myReview:c,onRenderComment:d,infinitLoad:m,commentsState:u,onLoadMore:p}=this.props;return r.createElement("div",{className:(0,f.Z)("commentsMana",e)},o?null:r.createElement("h3",{className:"commentsMana_title"},s?"游戏评价区":"评论区"),s&&c?d(c):o?null:r.createElement(N.Z,{commentable:t,isPosting:this.state.isPosting,currentUser:i,onSubmit:this.handleCommentSubmit,ref:e=>{this.rcInput=e}}),r.createElement("p",{className:"commentsMana_sortTabs"},r.createElement("span",null,"共 ",n," 条",s?"评价":"评论"),r.createElement(C,{className:"u_fontSize-lg",sort:l,onSort:this.handleTabClick})),r.createElement(_.Z,{data:a,state:u,onLoad:p,limitForGuest:!0,limitCountForGuest:3,limitTextForGuest:`登录后查看全部 ${n} 条${s?"评价":"评论"}`,scrollableProps:m||{}},this.renderComments))}}S.propTypes={currentUser:o().record,className:i().string,commentable:i().object,comments:w.ZP.comments.isRequired,count:i().number,reviewMode:i().bool,hideInput:i().bool,myReview:i().object,infinitLoad:i().oneOfType([i().object,i().bool]),commentsState:i().object,onCommentSubmit:i().func.isRequired,onLoadMore:i().func.isRequired,onTabClick:i().func.isRequired,onRenderComment:i().func.isRequired},S.defaultProps={commentable:void 0,currentUser:void 0,className:void 0,count:void 0,reviewMode:!1,myReview:void 0,infinitLoad:!1,hideInput:!1,commentsState:void 0};const Z=S,I=e=>{let{children:t,className:a,onLoadAllComments:n}=e;return r.createElement("div",{className:(0,f.Z)("commentsMana",a)},r.createElement("h3",{className:"commentsMana_title"},"关注的消息"),r.createElement("div",{className:"mt-3"},r.createElement("ul",{className:"list-unstyled comments"},t),r.createElement(b.Z,{className:"loadMoreButton mt-3",onClick:n,plain:!0,anchor:!0},"查看全部评论")))};var T=a(35369),A=a(59310),R=a(20525),D=a(44671),x=a(45648),M=a(85551),L=a(91433),q=a(80239),F=a(6143),B=a(71405),O=a(35218),U=a(26707),$=a(35018),G=a(98658),z=a(87022),H=a(32298);class V extends r.Component{constructor(e){super(e),this.state={isPosting:!1,isReplying:!1},this.handleReply=this.handleReply.bind(this),this.handleCommentSubmit=this.handleCommentSubmit.bind(this),this.handleDel=this.handleDel.bind(this)}postedComment(e){this.setState({isPosting:!1,isReplying:!1}),e&&(this.rcInput&&this.rcInput.reset(),this.rcComments&&this.rcComments.showAll())}handleReply(){const{onReplyClick:e,comment:t}=this.props;e?e(t.id):this.setState({isReplying:!this.state.isReplying},(()=>{this.rcInput&&this.rcInput.focus()}))}handleCommentSubmit(e,t){this.setState({isPosting:!0}),this.props.onCommentSubmit(e,t).then((e=>{this.postedComment(!e.error)}))}handleDel(){this.props.onDelete(this.props.comment)}seekRadioPlayer=e=>{const{commentable:t}=this.props;"radios"===t.get("type")&&this.context&&this.context.seekToTimeline&&this.context.seekToTimeline(t.get("id"),e)};handleSeekToTimeline=()=>{const{comment:e}=this.props;this.seekRadioPlayer(e.subcommentable.at)};renderCommentLineText=(e,t)=>this.renderTxtWithTimeNode(e,t,this.renderAtNode);renderTxtWithTimeNode=(()=>{var e=this;return function(t,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>e;const{commentable:l}=e.props;if("radios"!==l.get("type")||0!==a)return n(t);const i=(0,G.PV)(t);if(!i)return n(t);const[,s,,o]=i;return r.createElement(r.Fragment,null,e.renderTimeNode(s),n(o))}})();renderAtNode=e=>{const t=this.props.comment.tagData;return t?(0,F.Te)(e,(0,H.b)(t)):e};renderTimeNode=e=>{const t=(0,M.CH)(e);return null===t?e:r.createElement(b.Z,{plain:!0,className:"comment_timeNode",onClick:()=>{this.seekRadioPlayer(t)}},e)};render(){const{canDelete:e,comment:t,commentable:a,comment:{user:n},rcVoteMana:l,rcReportMana:i,rcStaffBtns:s,currentUser:o,role:c}=this.props;let d,m,u,p,g,h="";const v=t.parent,E=null==v?void 0:v.user;this.state.isReplying&&(h=r.createElement(N.Z,{commentable:a,currentUser:o,isPosting:this.state.isPosting,onSubmit:this.handleCommentSubmit,ref:e=>{this.rcInput=e}})),e&&(m=r.createElement(r.Fragment,null,"・",r.createElement(b.Z,{onClick:this.handleDel,anchor:!0,plain:!0},"删除"))),v&&(d=r.createElement("small",null,r.createElement($.Z,{icon:["gfas","reply"],className:"fa-w-12 mx-1",key:0}),E?r.createElement(O.Z,{to:(0,L.ZP)("user",{id:E.id}),key:1},E.nickname):r.createElement("span",null,"已删除"))),t.structedDescendants&&t.structedDescendants.length>0&&o&&(g=r.createElement(P.Z,{comments:t.structedDescendants,parent:t,onRenderComment:this.props.onRenderComment,onLoad:this.props.onLoad,ref:e=>{this.rcComments=e}})),u=n?r.createElement(O.Z,{to:(0,L.ZP)("user",{id:n.id})},r.createElement("strong",null,n.nickname," "),c&&r.createElement("small",null," (",c,") ")):r.createElement("strong",null," 未知用户 "),t.subcommentable&&("timelines"===t.subcommentable.type?p=r.createElement(b.Z,{onClick:this.handleSeekToTimeline,anchor:!0,plain:!0},"于 ",(0,B.io)(t.subcommentable.title,8)):"poll-options"===t.subcommentable.type&&(p=r.createElement("div",{className:"polledOption"},r.createElement("span",null,"📊 ",t.subcommentable.title))));const f=r.createElement(r.Fragment,null,r.createElement("div",{className:"comment_avatar d-flex"},r.createElement(U.Z,{onlyImage:!0,size:"md",users:n?new D.n5({type:n.type,id:n.id,attributes:{thumb:n.thumb,nickname:n.nickname}}):void 0,to:n?(0,L.ZP)("user",{id:n.id}):void 0})),r.createElement("div",{className:"comment_main"},r.createElement("p",{className:"comment_name"},u," ",d,r.createElement("small",{suppressHydrationWarning:!0},"・",(0,M.Sy)(t.createdAtDate))),p&&r.createElement("div",null,p),r.createElement("p",{className:"comment_body"},(0,q.yH)(t.body,this.renderCommentLineText)),r.createElement(z.Z,{label:"评论交互区域",openUrl:(0,L.ZP)(a),className:"comment_bottom"},l,r.createElement(b.Z,{onClick:this.handleReply,anchor:!0,plain:!0},"回复"),"・",i,m,s),t.likedByAuthor&&r.createElement("div",{className:"comment_likedLabel"},{articles:"作者",talks:"发布者"}[a.get("type")]||"参与者","喜欢"),h,g));return r.createElement("li",{className:"comment",id:`comment_${t.id}`},f)}}V.propTypes={currentUser:o().record,rcVoteMana:i().node,rcReportMana:i().node,rcStaffBtns:i().node,commentable:o().record.isRequired,comment:w.ZP.comment.isRequired,canDelete:i().bool.isRequired,onCommentSubmit:i().func.isRequired,onDelete:i().func.isRequired,onRenderComment:i().func.isRequired,onLoad:i().func.isRequired,role:i().string},V.defaultProps={currentUser:void 0,rcVoteMana:void 0,rcReportMana:void 0,rcStaffBtns:void 0,role:void 0},V.contextType=x.ET;const W=V;var j=a(7975),K=a(16798);class J extends r.PureComponent{constructor(e){super(e),this.state={modalVisible:!1},this.isInited=!1,this.handleCloseClick=this.handleCloseClick.bind(this),this.handleClick=this.handleClick.bind(this)}handleClick(){this.isInited=!0,this.setState({modalVisible:!0})}handleCloseClick(){this.setState({modalVisible:!1})}render(){const{children:e,reportable:t,...a}=this.props,{modalVisible:l}=this.state,i=this.isInited?r.createElement(K.Z,{visible:l,reportableType:t.get("type"),reportableId:t.get("id"),reportableUserId:t.getRel("user","id"),onConfirmClick:this.handleCloseClick,onCloseClick:this.handleCloseClick}):null;return r.createElement(r.Fragment,null,i,r.createElement(b.Z,(0,n.Z)({},a,{onClick:this.handleClick,plain:!0,anchor:!0}),e))}}J.propTypes={reportable:o().record.isRequired,children:i().oneOfType([i().string,i().element,i().array])},J.defaultProps={children:"举报"};const Y=J;var X=a(14810);const Q="操作后评论列表会被刷新",ee={dispatchArchive:e=>(0,X.D1)(`comments/${e}/archive`,{method:"POST"}),dispatchSuppress:e=>(0,X.D1)(`comments/${e}/suppress`,{method:"POST"})},te=(0,d.connect)(void 0,ee)((e=>{let{comment:t,dispatchArchive:a,dispatchSuppress:n,onRefresh:l}=e;const i=(0,r.useCallback)((async()=>{if(confirm(`确定折叠该评论吗？${Q}`)){(await a(t.id)).error||null==l||l()}}),[t,a,l]),s=(0,r.useCallback)((async()=>{if(confirm(`确定去除该评论的热度吗？${Q}`)){(await n(t.id)).error||null==l||l()}}),[t,n,l]);return r.createElement(r.Fragment,null,"・",r.createElement(b.Z,{plain:!0,anchor:!0,onClick:i},"折叠"),"・",r.createElement(b.Z,{plain:!0,anchor:!0,onClick:s},"去热度"))}));class ae extends r.PureComponent{state={loading:!1};handleDelete=e=>{window.confirm("确认删除该评论？")&&this.props.dispatchDeleteComment(e.id)};handleCommentSubmit=(e,t)=>this.props.onCommentSubmit(e,t,this.props.comment);handleRenderComment=e=>r.createElement(re,(0,n.Z)({key:`${e.type}${e.id}`},this.props,{comment:e}));handleLoad=()=>{const{comment:e,dispatchGetComment:t,includeSubCommentable:a}=this.props;this.setState({loading:!0}),t(e.id,a?{includeQueryPush:["subcommentable","descendants.subcommentable"]}:{}).then((()=>{this.setState({loading:!1})}))};render(){const{currentUser:e,comment:t,commentable:a,authorID:n,djIDs:l,onRefresh:i,onReplyClick:s}=this.props,{loading:o}=this.state,c=r.createElement(j.Z,{votable:t.model.update("rels",(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,T.Map)()).set("commentable",a)})),disableVoteForSelf:!0}),d=r.createElement(Y,{reportable:t.model});let m,u,p=!1;return e&&(p=e.isStaff()||e.get("id")===(t.user&&t.user.id),m=e.isStaff()&&r.createElement(te,{comment:t,onRefresh:i})),t.user&&(l.length>0?l.includes(t.user.id)&&(u="参与者"):t.user.id===n&&(u="作者")),r.createElement(R.Z,{loading:o},r.createElement(W,{commentable:a,comment:t,rcVoteMana:c,rcReportMana:d,rcStaffBtns:m,canDelete:p,currentUser:e,onDelete:this.handleDelete,onReplyClick:s,onCommentSubmit:this.handleCommentSubmit,onRenderComment:this.handleRenderComment,onLoad:this.handleLoad,role:u}))}}ae.propTypes={comment:w.ZP.comment.isRequired,commentable:o().record.isRequired,subCommentable:o().record,authorID:i().string,djIDs:i().arrayOf(i().string),onCommentSubmit:i().func.isRequired,onRefresh:i().func,onReplyClick:i().func,includeSubCommentable:i().bool,currentUser:o().record,dispatchDeleteComment:i().func.isRequired,dispatchGetComment:i().func.isRequired},ae.defaultProps={currentUser:void 0,subCommentable:void 0,includeSubCommentable:void 0,authorID:void 0,djIDs:[],onRefresh:void 0};const ne={dispatchDeleteComment:v.YFy,dispatchGetComment:v.d7q},re=(0,d.connect)((e=>({currentUser:(0,A.ib)(e)})),ne)(ae),le=re,ie="comment_id",se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>null;class a extends y.Z{constructor(e){super(e);const{commentID:t}=e;this.state={focusMode:t>0}}componentDidMount(){const{commentID:e,instantLoad:t}=this.props;e?this.scrollToFocus(e):"#comments"===location.hash?this.scrollToComments():t&&this.refresh()}componentDidUpdate(e){const{commentID:t}=this.props;t&&t!==e.commentID&&this.scrollToFocus(t)}componentWillUnmount(){const{commentable:e}=this.props;this.props.clearComments(e.toUnique())}refresh=()=>{this.requestComments(1,!0)};scrollToFocus(e){this.props.getComment(e),this.scrollToComments()}scrollToComments(){setTimeout((()=>{p.ZP.scroller.scrollTo("comments")}),1e3)}requestComments(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props.requestSort;const{commentable:n,subCommentable:r,commentsState:l,includeSubCommentable:i}=this.props;!t&&l&&(l.get("isRequesting")||l.get("noMore"))||this.props.getComments({commentable:n.toUnique(),subCommentable:null==r?void 0:r.toUnique(),page:e,refresh:t,sort:a,includeSubCommentable:i})}handleLoadMoreComments=()=>{const{commentsState:e}=this.props,t=e?e.get("currentPage")+1:1;this.requestComments(t,1===t)};handleRenderComment=e=>{const{djIDs:t,authorID:a,onReplyClick:n,includeSubCommentable:l}=this.props;return r.createElement(le,{key:e.id,comment:e,commentable:this.props.commentable,subCommentable:this.props.subCommentable,djIDs:t,authorID:a,onCommentSubmit:this.handleCommentSubmit,onReplyClick:n,onRefresh:this.refresh,includeSubCommentable:l})};handleCommentSubmit=(e,t,a)=>{const{session:n,commentable:r,subCommentable:l,currentUser:i}=this.props,s=n.get("signined")?i.get("id"):0;return this.props.postComment({commentable:r.toUnique(),subCommentable:l&&l.toUnique(),parentID:a?a.id:0,userID:s,text:e,tagData:t,rootID:a&&a.rootCommentID}).then((t=>(r&&t.payload&&t.payload.data&&(0,h.xn)({commentId:t.payload.data.id,commentable:r,replyTo:null==a?void 0:a.model,hasTimeStamp:null!==(0,G.PV)(e)}),t)))};handleTabClick=e=>{const{commentsState:t}=this.props;t&&!t.get("isRequesting")&&this.requestComments(1,!0,e)};handleLoadAllComments=()=>{this.setState({focusMode:!1}),this.requestComments(1),(()=>{if("undefined"!=typeof window){const e=c.parse(window.location.href,!0);delete e.query[ie];const t=c.format({query:e.query,pathname:e.pathname});(0,u.lX)().push(t)}})()};renderWrapper(e){const{containerClassName:t}=this.props;return r.createElement(p.W_,{name:"comments",className:(0,f.Z)(t)},e)}render(){const{focusMode:a}=this.state,{containerClassName:l,focusComment:i,comments:s,count:o,commentsState:c,requestSort:d,className:m,currentUser:u,reviewMode:p,myReview:h,commentable:v,...E}=this.props;return a?i?this.renderWrapper(r.createElement(t,{onLoadAllComments:this.handleLoadAllComments,className:m},this.handleRenderComment((0,g.ec)(i)))):this.renderWrapper(r.createElement("p",{className:"mutedInfo"},"未能获取相关评论")):this.renderWrapper(r.createElement(e,(0,n.Z)({commentable:v,reviewMode:p,myReview:h&&(0,g.ec)(h),comments:(0,g.Kt)(s),className:m,count:o||(null==c?void 0:c.getIn(["meta","record-count"])),currentUser:u,sort:d,commentsState:c,onLoadMore:this.handleLoadMoreComments,onCommentSubmit:this.handleCommentSubmit,onRenderComment:this.handleRenderComment,onTabClick:this.handleTabClick},E)))}}const l=e=>e.get("entities"),s=e=>e.commentable,b=(e,t)=>e.getIn(["data","comments",s(t).get("type"),s(t).get("id")]),k=(e,t)=>t.commentID||(()=>{if("undefined"!=typeof window)return c.parse(window.location.href,!0).query[ie]})(),C=(0,m.P1)(l,(e=>e.getIn(["session","userID"])),((e,t)=>t?(0,E.tK)(t,"users",e):null)),_=(0,m.P1)(b,(e=>e)),w=(0,m.P1)(l,((e,t)=>b(e,t)&&b(e,t).get("ids")),((e,t)=>(0,E.b$)(t,"comments",e,{depth:3}))),N=(0,m.P1)(l,k,((e,t)=>(0,E.tK)(t,"comments",e,{depth:3}))),P={getComment:v.d7q,getComments:v.liG,postComment:v.waY,clearComments:v.oer},S=(0,d.connect)(((e,t)=>{const a=e.get("session"),n=k(0,t),r=C(e,t),l=_(e,t),i=N(e,t),s=w(e,t);return{commentID:n,commentsState:l,requestSort:l&&l.getIn(["actionMeta","sort"])||"score",comments:s,focusComment:i,session:a,currentUser:r}}),P)(a),Z=e=>r.createElement(S,(0,n.Z)({key:`${e.commentable.getKey()}${e.commentID}`},e));return Z.propTypes={containerClassName:i().string,className:i().string,count:i().number,commentable:o().record.isRequired,subCommentable:o().record,authorID:i().string,djIDs:i().arrayOf(i().string),includeSubCommentable:i().bool},Z.defaultProps={containerClassName:void 0,className:void 0,count:void 0,subCommentable:void 0,authorID:void 0,djIDs:[]},a.propTypes={...Z.propTypes,getComment:i().func.isRequired,getComments:i().func.isRequired,postComment:i().func.isRequired,commentID:i().string,instantLoad:i().bool,commentable:o().record,comments:o().list,focusComment:o().record,myReview:o().record,commentsState:o().map,requestSort:i().string,currentUser:o().record,session:o().map,reviewMode:i().bool},a.defaultProps={...S.defaultProps,commentID:void 0,instantLoad:!0,comments:void 0,commentable:void 0,focusComment:void 0,myReview:void 0,commentsState:void 0,requestSort:void 0,currentUser:void 0,session:void 0,reviewMode:!1,includeSubCommentable:void 0},Z},oe=se(Z,I)},52949:(e,t,a)=>{a.d(t,{ZP:()=>c});var n=a(45697),r=a.n(n);const l=r().shape({type:r().string.isRequired,id:r().string.isRequired}),i=r().shape({title:r().string.isRequired,key:r().string.isRequired,render:r().func,to:r().string}),s=r().shape({descendants:r().array,structedDescendants:r().array,showAll:r().bool}),o=r().arrayOf(s),c={apiUnique:l,tab:i,tabs:r().arrayOf(i),comment:s,comments:o}},20227:(e,t,a)=>{e.exports=a.p+"ae19c46d54722717ce41.png"}},l={};function i(e){var t=l[e];if(void 0!==t)return t.exports;var a=l[e]={id:e,loaded:!1,exports:{}};return r[e].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=r,i.amdO={},e=[],i.O=(t,a,n,r)=>{if(!a){var l=1/0;for(d=0;d<e.length;d++){for(var[a,n,r]=e[d],s=!0,o=0;o<a.length;o++)(!1&r||l>=r)&&Object.keys(i.O).every((e=>i.O[e](a[o])))?a.splice(o--,1):(s=!1,r<l&&(l=r));if(s){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,n,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,n){if(1&n&&(e=this(e)),8&n)return e;if("object"==typeof e&&e){if(4&n&&e.__esModule)return e;if(16&n&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var l={};t=t||[null,a({}),a([]),a(a)];for(var s=2&n&&e;"object"==typeof s&&!~t.indexOf(s);s=a(s))Object.getOwnPropertyNames(s).forEach((t=>l[t]=()=>e[t]));return l.default=()=>e,i.d(r,l),r},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,a)=>(i.f[a](e,t),t)),[])),i.u=e=>(({11:"reactPlayerFilePlayer",55:"reactPlayerWistia",121:"reactPlayerFacebook",125:"reactPlayerSoundCloud",216:"reactPlayerTwitch",261:"reactPlayerKaltura",439:"reactPlayerYouTube",546:"reactPlayerStreamable",596:"reactPlayerDailyMotion",664:"reactPlayerPreview",667:"reactPlayerMixcloud",743:"reactPlayerVimeo",888:"reactPlayerVidyard"}[e]||e)+"."+{11:"45f5305f",55:"73e43414",75:"12f91c26",95:"aadc34f0",121:"d7351f36",125:"0a0eb1a4",210:"60950a48",216:"8aa37563",261:"7110ad53",275:"02c87910",439:"416def88",542:"404e8f7f",546:"47ae168b",596:"a2ea4ded",660:"09d0fc26",664:"29f17e15",667:"6790ae18",743:"18ff8496",859:"a13e18e2",888:"336a74c5"}[e]+".chunk.js"),i.miniCssF=e=>{},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},i.l=(e,t,a,r)=>{if(n[e])n[e].push(t);else{var l,s;if(void 0!==a)for(var o=document.getElementsByTagName("script"),c=0;c<o.length;c++){var d=o[c];if(d.getAttribute("src")==e){l=d;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,i.nc&&l.setAttribute("nonce",i.nc),l.src=e),n[e]=[t];var m=(t,a)=>{l.onerror=l.onload=null,clearTimeout(u);var r=n[e];if(delete n[e],l.parentNode&&l.parentNode.removeChild(l),r&&r.forEach((e=>e(a))),t)return t(a)},u=setTimeout(m.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=m.bind(null,l.onerror),l.onload=m.bind(null,l.onload),s&&document.head.appendChild(l)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i.p="https://static.gcores.com/assets/",(()=>{var e={12:0,326:0};i.f.j=(t,a)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)a.push(n[2]);else{var r=new Promise(((a,r)=>n=e[t]=[a,r]));a.push(n[2]=r);var l=i.p+i.u(t),s=new Error;i.l(l,(a=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=a&&("load"===a.type?"missing":a.type),l=a&&a.target&&a.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+l+")",s.name="ChunkLoadError",s.type=r,s.request=l,n[1](s)}}),"chunk-"+t,t)}},i.O.j=t=>0===e[t];var t=(t,a)=>{var n,r,[l,s,o]=a,c=0;if(l.some((t=>0!==e[t]))){for(n in s)i.o(s,n)&&(i.m[n]=s[n]);if(o)var d=o(i)}for(t&&t(a);c<l.length;c++)r=l[c],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(d)},a=self.webpackChunk=self.webpackChunk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),i.nc=void 0;var s=i.O(void 0,[358,290,460,413,567],(()=>i(71228)));s=i.O(s)})();
//# sourceMappingURL=Main.f394b4c4.js.map
</script>

</body>
</html>
