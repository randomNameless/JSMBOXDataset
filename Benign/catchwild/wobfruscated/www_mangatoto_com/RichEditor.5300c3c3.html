<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>RichEditor.5300c3c3.html</title>
</head>
<body>
<script>import{R as p}from"./index.8365acb2.js";import{a as w}from"./ReactProviders.242c2151.js";import{W as j}from"./WarnedMask.7e403412.js";import{j as s}from"./jsx-runtime.7d759e48.js";import{f as v}from"./func_attachment_name_to_http.94bdbc5a.js";import{F as _}from"./FontIcon_FontAwesome5.0e0cb40f.js";import{F as y}from"./FontIcon_MaterialIcons.959bf5eb.js";import{c as N}from"./index.6a5a335b.js";import{f as I}from"./func_nodeapi.80362569.js";function E(t,e){let n=window.getSelection(),l=t.textContent,a=Math.min(n.focusOffset,n.anchorOffset),o=Math.max(n.focusOffset,n.anchorOffset),r=l.substring(o);r==""&&(r=`
`),t.textContent=l.substring(0,a)+e+r,n.removeAllRanges();let c=document.createRange();c.setStart(t.childNodes[0],a+e.length),c.setEnd(t.childNodes[0],a+e.length),n.addRange(c)}function C(){if(!(typeof window>"u")&&!(typeof window.navigator>"u"))return window.navigator.userAgent?.toLowerCase()?.indexOf("firefox")>-1}function k(t){const{editAreaDomId:e,innerText:n="",onChange:l,editorInc:a=0}=t,o=p.useMemo(()=>C(),[]);p.useEffect(()=>{document.getElementById(e).innerText=n||""},[e,n,a]);const r=d=>{const i=d?.target?.innerText||"";l(i)},c=d=>{d.preventDefault();const i=(d.originalEvent||d).clipboardData.getData("text/plain");E(d.target,i)};return o?s.jsx("div",{id:e,className:"Editor EditArea",contentEditable:!0,suppressContentEditableWarning:!0,onInput:r,onBlur:r,onKeyUp:r,onKeyDown:r,onPaste:c}):s.jsx("div",{id:e,className:"Editor EditArea",contentEditable:"plaintext-only",suppressContentEditableWarning:!0,onInput:r,onBlur:r,onKeyUp:r,onKeyDown:r})}function D(t){const{files:e}=t;return!e||!Object.keys(e).length?null:(console.log("UploadsDisplay files:",Object.values(e)),s.jsx("div",{className:"p-2 flex justify-start items-start flex-wrap text-base-content bg-base-200 border-t-2 border-solid border-base-300",children:Object.values(e).map(n=>s.jsx(A,{dataKey:n.finc,item:n},n.finc))}))}function A(t){const{item:e,dataKey:n}=t;console.log("FileItem item:",e);const{finc:l,what:a,data:o}=e;if(a==="success"){const r=v(o?.name);return s.jsx("div",{"data-key":n,className:"w-[100px] min-h-[100px] mr-3 text-success",children:s.jsx("a",{href:r,target:"_blank",rel:"noreferrer",children:s.jsx("img",{src:r,alt:l,className:"w-full"})})})}if(a==="failure"){const r={login_required:"Not logged in?",no_file_uploaded:"Not am image?",invalid_file_type:"Not am image?",invalid_file_size:"Image over 5MB?",invalid_file_data:"Not am image?",write_file_failed:"Server error?"}[o.err]||"Network error?";return s.jsxs("div",{"data-key":n,className:"flex flex-col items-center w-[150px] min-h-[100px] mr-3 text-error",children:[s.jsx(y,{name:"error"}),s.jsx("small",{className:"text-center",children:r})]})}return s.jsxs("div",{"data-key":n,className:"flex flex-col items-center w-[150px] min-h-[100px] mr-3 text-info",children:[s.jsx(_,{name:"spinner",className:"animate-spin"}),s.jsx("small",{className:"text-center",children:"Uploading"})]})}function R(t){const{messages:e}=t;return e?.length?s.jsx("div",{className:"p-2 text-base-content bg-base-200 border-t-2 border-solid border-base-300",children:e.map((n,l)=>s.jsx("div",{className:N("messageItem",{"text-info":n.state==="info","text-success":n.state==="success","text-warning":n.state==="warning","text-error":n.state==="error"}),children:n.text},n.ekey||l))}):null}function T(){let t=null;const e=window.getSelection();return e.rangeCount&&(t=e.getRangeAt(0).commonAncestorContainer,t.nodeType!=1&&(t=t.parentNode)),t}function S(t){const e=document.createRange();e.selectNodeContents(t),e.collapse(!1);const n=window.getSelection();n.removeAllRanges(),n.addRange(e)}function O(t,e){const n=document.getElementById(t),l=T();l&&l.getAttribute("id")===t||S(n.firstChild||n);const a=window.getSelection(),o=a.toString()||"";let r=!1,c=!1,d=0,i="",f="";switch(e){case"b":case"i":case"u":case"s":case"spoiler":case"blockquote":{i=`<${e}>`,f=`</${e}>`,r=!0,c=!0;break}case"a":{i='<a href="#">',f="</a>",r=!0,c=!0;break}case"img":{i='<img src="#"/>',f="",r=!0,c=!0;break}case"hr":{i="<hr/>",f="",r=!0,c=!0;break}case"code":{i=o?"```":"```</>",f="```",r=!0,c=!0;break}case"table":{i=`

| 1 | 2 | 3 | 4 |
| - |:- |:-:| -:|
| A | B | C | D |

`,f="";break}case"tasks":{i=`

* [ ] todo
* [x] done

`,f="";break}case"list-ol":{i=`

1. one
2. tow

`,f="";break}case"list-ul":{i=`

* foo
* bar

`,f="";break}default:return}let u="",m=0;r&&(i===""||o.startsWith(i))&&(f===""||o.endsWith(f))?(u=o.substring(i.length,o.length-f.length),m=-(i.length+f.length)):(u=`${i}${o}${f}`,m=i.length+d+f.length);const h=a.getRangeAt(0).startOffset,b=a.getRangeAt(0).endOffset+m;document?.execCommand?.("insertText",!1,u);const g=n.firstChild||n;if(c)try{const x=document.createRange();x.setStart(g,h),x.setEnd(g,b),a.removeAllRanges(),a.addRange(x)}catch{}n.focus()}function B(t){const e=document.getElementById(`EditFile_${t}`);e&&e.click()}const F={val:0};function U(t,e){const n=t?.target?.files||t?.dataTransfer?.files||null;if(!n?.[0])return;const l=n[0],a=++F.val;if(e({finc:a,what:"initial"}),l.size>5*1024*1024){e({finc:a,what:"failure",data:{err:"invalid_file_size"}});return}const o=/(image\/|\.)(jpeg|jpg|gif|png|webp)$/i;if(!(o.test(l.type)||o.test(l.name)||!1)){e({finc:a,what:"failure",data:{err:"invalid_file_type"}});return}const c=new FormData;c.set("content",l),e({finc:a,what:"pending"}),I("upload-attachment",c,{onUploadProgress:d=>{const{loaded:i,total:f}=d;e({finc:a,what:"posting",data:{loaded:i,total:f}})}},{"Content-Type":"multipart/form-data"}).then(d=>d.data).then(d=>{if(d.err){e({finc:a,what:"failure",data:d});return}e({finc:a,what:"success",data:d})}).catch(d=>{e({finc:a,what:"failure",data:{err:"unknown"}})})}function K(t,e){t.stopPropagation(),t.preventDefault(),U(t,e),t.target.value=""}function M(t){const{editAreaDomId:e,enableImgBtn:n=!1,onUploadImageEvent:l=()=>{},onChange:a,submitTitle:o=s.jsx("span",{children:"Submit"}),submitClick:r=()=>{},cancelTitle:c=null,cancelClick:d=()=>{}}=t;function i(u){console.log("uploaderCallback:",u),typeof l=="function"&&l(u);const{finc:m,what:h,data:b}=u;switch(h){case"success":const g=document.getElementById(e);let x=g.innerText?`
`:"";x+=`<img src="${b.name}"/>`,g.innerText=g.innerText+x,g.focus(),a(g.innerText);break}}const f={spoiler:"eye-slash",b:"bold",i:"italic",u:"underline",s:"strikethrough",a:"link",blockquote:"quote-left",hr:"arrows-alt-h",code:"code"};return s.jsxs("div",{className:"flex h-[31px] border-t-2 border-t-base-200 bg-neutral",children:[s.jsx("div",{className:"grow relative",children:s.jsx("div",{className:"flex items-center absolute top-0 right-0 bottom-0 left-0 w-full h-full px-1 overflow-x-auto overflow-y-hidden",children:s.jsxs("div",{className:"flex justify-start items-center",children:[s.jsx(W,{enableImgBtn:n,editAreaDomId:e,uploaderCallback:i}),Object.entries(f).map(([u,m])=>s.jsx("button",{className:"btn btn-xs btn-ghost rounded-none",onClick:()=>O(e,u),children:s.jsx(_,{name:m,size:18})},u))]})})}),!!(c||o)&&s.jsxs("div",{className:"px-1 inline-flex items-center flex-initial space-x-1",children:[!!c&&s.jsx("button",{className:"btn btn-xs btn-ghost normal-case",onClick:d,children:c}),!!o&&s.jsx("button",{className:"btn btn-xs btn-primary normal-case",onClick:r,children:o})]})]})}function W(t){const{enableImgBtn:e,editAreaDomId:n,uploaderCallback:l}=t;if(!e)return null;function a(o){K(o,l)}return s.jsxs("button",{name:"img-btn",className:"btn btn-xs btn-ghost rounded-none",onClick:()=>B(n),children:[s.jsx("input",{type:"file",className:"hidden",id:`EditFile_${n}`,accept:"image/*",onChange:a,onDragEnter:a,onDragOver:a,onDrop:a}),s.jsx(_,{name:"image",size:18})]},"img")}function z(t){const{id:e="",isLoading:n=!1}=t,l=w(),a=p.useId(),o=e||a,r="editor_"+o,c="editor_editarea_"+o,[d,i]=p.useState({});function f(u){console.log("onUploadImageEvent:",u),i(m=>Object.assign({},m,{[u.finc]:u}))}return s.jsxs("div",{id:r,className:"editor appearance-none relative m-0 border-2 border-base-200",children:[s.jsx(k,{...t,editorDomId:r,editAreaDomId:c}),s.jsx(D,{files:d}),s.jsx(R,{messages:t.messages}),s.jsx(M,{...t,editAreaDomId:c,onUploadImageEvent:f}),n&&s.jsx("div",{className:"absolute top-0 right-0 bottom-0 left-0 w-full h-full flex justify-center items-center bg-base-300/50",children:s.jsx("button",{className:"btn btn-circle btn-ghost",children:s.jsx("span",{className:"loading loading-spinner"})})}),s.jsx(j,{sess:l})]})}function X(t){return s.jsx(z,{...t})}export{X as R};</script>
</body>
</html>
