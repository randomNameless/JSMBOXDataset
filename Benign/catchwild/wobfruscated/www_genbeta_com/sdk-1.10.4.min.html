<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>sdk-1.10.4.min.html</title>
</head>
<body>
<script>(()=>{var e,t,i,s={d:(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},r={};s.d(r,{default:()=>function(){return new l}});class o{_message;_code;constructor(e,t){this._message=e,this._code=t}get message(){return this._message}get code(){return this._code}}class n extends o{constructor(e){super(`First-id cookie "${e}" not found`,"FirstIdCookieNotFound")}}class a extends o{constructor(){super('The config "emailGetterCallback" must be a function',"FirstIdEmailGetterCallbackIsNotFunction")}}class c extends o{constructor(e){super(`First-id cookie "${e}" contains an empty value`,"FirstIdEmptyValue")}}class d extends o{constructor(){super("The current user has opted out of tracking","FirstIdUserDoNotTrack")}}let h={API_URL:"https://api-v4.prod.first-id.fr",API_V6_URL:"https://api-v6.prod.first-id.fr",API_DUAL_URL:"https://api-dual.prod.first-id.fr",API_URL_PAGE_VIEW:"https://api-pv.prod.first-id.fr",SDK_VERSION:"1.10.4",COOKIE_NAME:"firstid",VENDOR_ID:1178,FLEX:"false",TCF_ENABLED:!0};(i=e=e||{})[i.StoreAndAccessInformationOnADevice=1]="StoreAndAccessInformationOnADevice",i[i.SelectBasicAds=2]="SelectBasicAds",i[i.CreateAPersonalizedAdsProfile=3]="CreateAPersonalizedAdsProfile",i[i.SelectPersonalizedAds=4]="SelectPersonalizedAds",i[i.CreateAPersonalizedContentProfile=5]="CreateAPersonalizedContentProfile",i[i.SelectPersonalizedContent=6]="SelectPersonalizedContent",i[i.MeasureAdPerformance=7]="MeasureAdPerformance",i[i.MeasureContentPerformance=8]="MeasureContentPerformance",i[i.ApplyMarketResearchToGenerateAudienceInsights=9]="ApplyMarketResearchToGenerateAudienceInsights",i[i.DevelopAndImproveProducts=10]="DevelopAndImproveProducts",(i=t=t||{})[i.UsePreciseGeolocationData=1]="UsePreciseGeolocationData",i[i.ActivelyScanDeviceCharacteristicsForIdentification=2]="ActivelyScanDeviceCharacteristicsForIdentification";class l{_version;_emailHashed;intervalReferenceRequestFirstIdFromParent;logger;vendorId=1178;requiredPurposes=[e.StoreAndAccessInformationOnADevice,e.SelectBasicAds,e.CreateAPersonalizedAdsProfile,e.SelectPersonalizedAds,e.MeasureAdPerformance];_consent;specialFeatures=[t.ActivelyScanDeviceCharacteristicsForIdentification];constructor(){this._version=h.SDK_VERSION,this.intervalReferenceRequestFirstIdFromParent=null,this._firstId=null,this._emailHashed=null,this._config={callbacks:[],cookieName:h.COOKIE_NAME,cookieNameFlexType:h.COOKIE_NAME+"_flex_type",cookieNameTTLInMinute:259200,version:this._version,debug:!1,isIframe:!1,intervalRequestFirstIdFromParentMs:100,callbacksWhenIframeReceiveFirstId:[],iframeAppendFirstIdToLinkCssSelector:[],emailCookieName:"fid_email_hashed",emailHashed:null,emailHashCookieName:"fid_email_hash",emailHashCookieTTL:259200,emailGetterCallback:null,firstIdFlexFeature:"true"===h.FLEX,syncIpUaCookieName:"fidflexlastsync",syncFidEmailCookieName:"fidflexemaillastsync",refreshCookieName:"firstid_refresh",flexLastCheckCookieName:"fidflexlastcheck",firstIdApiBaseUrl:h.API_URL,firstIdApiV6BaseUrl:h.API_V6_URL,firstIdApiDualBaseUrl:h.API_DUAL_URL,firstIdApiPageViewBaseUrl:h.API_URL_PAGE_VIEW,xhrTimeoutInMs:3e3,...window.firstId||{}},this.logger={log:()=>{this.config.debug||window?.firstId?.debug},debug:()=>{this.config.debug||window?.firstId?.debug},error:()=>{this.config.debug||window?.firstId?.debug},warn:()=>{this.config.debug||window?.firstId?.debug}},this.logger.debug("First-id SDK initialized. Current version is : "+this._version);try{var e=this.getId();this._setOutbrainPPID(e),this._addFirstIdToGoogleSecureSignal(e)}catch(e){this.logger.error("Error on set outbrain PPID",e)}}_firstId;_firstIdType;get firstId(){return this.firstIdStruct?.firstId??null}set firstId(e){this.firstIdStruct={firstId:e}}get firstIdStruct(){return this.getFirstIdStruct()}set firstIdStruct(e){if(this._firstId=e?.firstId,this._firstIdType=e?.t,document&&window&&(window.__FIRSTID__=e?.firstId,document.__FIRSTID__=e?.firstId,0),this.consent){this._setFirstIdCookie(e);try{this._setOutbrainPPID(e?.firstId)}catch(e){this.logger.error("Error on set outbrain PPID",e)}try{this._addFirstIdToGoogleSecureSignal(e?.firstId)}catch(e){this.logger.error("Error on set google secure signal",e)}}else this.logger.debug("No consent, skip setting FirstID on storage and APIs")}_config;get config(){return this.getConfig()}set config(e){if(518400<e.cookieNameTTLInMinute)throw new Error("cookieNameTTLInMinute must be less than 12 months");this._config=e}get consent(){var e=e=>{try{return e()}catch(e){return!1}};return e(()=>!!this._consent)||e(()=>!!this.config.firstIdFlexFeature)}set consent(e){this._consent=e}get version(){return this._version}getFirstId(){return this.getFirstIdStruct()?.firstId??null}getFirstIdStruct(){if(this._config.isIframe&&this._firstId)return{firstId:this._firstId,t:this._firstIdType};var e=this.__getCookieValueFromCookieName(this._config.cookieName);if(null===e&&!this.config.firstIdFlexFeature)throw new n(this._config.cookieName);if(""===e)throw new c(this._config.cookieName);if("NO_TRACKING"===e)throw new d;var t=this.__getCookieValueFromCookieName(this._config.cookieNameFlexType);return{firstId:e,t:isNaN(+t)?null:+t}}getEmailHashed(){if(this._emailHashed??this._config.emailHashed)return this._emailHashed??this._config.emailHashed;let e=null;if(this._config.emailCookieName&&this.__getCookieValueFromCookieName(this._config.emailCookieName))e=this.__getCookieValueFromCookieName(this._config.emailCookieName);else if(this._config.emailHashed)e=this._config.emailHashed;else if(this._config.getEmailMethod)try{e=this._config.getEmailMethod()}catch(e){this.logger.error("[FIRSTID] Error on getEmailMethod",e)}return e}getFirstIdEidsObject(){return[{source:"first-id.fr",uids:[{atype:1,ext:{stype:"ppuid"},id:this.getId()}]}]}getCookieName(){return this._config.cookieName}setCookieName(e){this._config.cookieName=e}askFirstIdToParentIframe(){this._config.intervalReferenceRequestFirstIdFromParent=setInterval(()=>{this.logger.debug(`Request FirstID from parent each ${this._config.intervalRequestFirstIdFromParentMs} ms...`),window.top.postMessage("requestFirstID","*")},this._config.intervalRequestFirstIdFromParentMs),window.addEventListener("message",e=>{this.logger.log("message from parent",e),this.logger.debug("[FIRSTID IFRAME] message from parent",e),e.data.firstid&&(clearInterval(this._config.intervalReferenceRequestFirstIdFromParent),this.logger.debug("[FIRSTID IFRAME] iFrame has been receive successfully firstID "+e.data.firstid,e),this._firstId=e.data.firstid,e.data.firstid,e.source.postMessage("firstidACK","*"),this.iframeAppendFirstIdToLink(),this._config.callbacksWhenIframeReceiveFirstId.forEach((t,i)=>{this.logger.debug("[FIRSTID IFRAME] Invoke callback start #"+i,t);try{t(this._firstId),this.logger.debug("[FIRSTID IFRAME] Invoke callback done #"+i,t)}catch(e){this.logger.error(`[FIRSTID IFRAME] Callback #${i} throw an error`,t)}}))},!0)}async setEmailHashed(e){let t;try{t=this.getId()}catch(e){this.logger.error("Error on get FirstID",e),t=null}if(t&&this.__getCookieValueFromCookieName(this._config.emailHashCookieName)===e)this.logger.debug("[FIRSTID] Email hash already processed recently. Skipping API call.");else{if(t){var i=await this._checkMatchCookieWithEmail(e);if(!i)return void this.logger.debug("[FIRSTID] Error on check match cookie with email");i&&!i?.match&&(this._setFirstIdCookie({firstId:i?.firstId,t:i?.t}),this._createRefreshCookie())}else{var i=await this._checkEmailExist(e);i?.exist?this._setFirstIdCookie({firstId:i.firstId,t:i.t}):(i=await this._createFirstIdByEmail(e),this._setFirstIdCookie({firstId:i.firstId})),this._createRefreshCookie()}this._setCookie(this._config.emailHashCookieName,e,this._config.emailHashCookieTTL)}}async killFid(){try{200===(await fetch(this._config.firstIdApiBaseUrl+"/kfid?firstId="+this.firstIdStruct?.firstId,{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)})).status&&(this.logger.debug("[FIRSTID] Delete FirstID"),this._setCookie(this._config.cookieName,"",-100),this.firstIdStruct=null)}catch(e){this.logger.error("[FIRSTID] Error on delete FirstID V4 try in V6 endpoint",e);try{200===(await fetch(this._config.firstIdApiV6BaseUrl+"/kfid?firstId="+this.firstIdStruct?.firstId,{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)})).status&&(this.logger.debug("[FIRSTID] Delete FirstID"),this._setCookie(this._config.cookieName,"",-100),this.firstIdStruct=null)}catch(e){this.logger.error("[FIRSTID] Error on delete FirstID V6",e)}}}async init(){if(this.logger.debug("SDK: init"),null!==this._config.emailGetterCallback&&"function"!=typeof this._config.emailGetterCallback)throw new a;JSON.parse(h.TCF_ENABLED)&&await this._waitForTCFConsent();try{var e=this.getIdStruct();this._firstId=e?.firstId??null,this._firstIdType=e?.t??null,this._emailHashed=this.getEmailHashed()}catch(e){this._firstId=null,this._emailHashed=null}if(this._config.isIframe)this.askFirstIdToParentIframe();else{this._addListerFromIframeMessage();e=window.location.hostname;if(this._firstId&&e&&this.config.killFidDomains.includes(e)&&await this.killFid(),this._firstId)await this._updateIpUa(),this._trackPageView(),!this._emailHashed||this._hashAlreadyCheckFirstIdEmailAssociation()||await this.setEmailHashed(this._emailHashed);else{let e=!1;try{e=!!this.firstIdStruct?.firstId}catch(e){}!this._config.firstIdFlexFeature||null!==this.__getCookieValueFromCookieName(this._config.flexLastCheckCookieName)||e&&"0"!==this.__getCookieValueFromCookieName(this._config.cookieNameFlexType)?e&&this.logger.debug("FirstID found"):(this.logger.debug("FirstID not found, try to get it from IP and User Agent"),this._getFirstIdByIPUA().then(e=>{e&&(this.firstIdStruct=e,this._trackPageView())}))}}}iframeAppendFirstIdToLink(){this.logger.debug("[FIRSTID IFRAME] Try to append firstID to link with the css selector",this._config.iframeAppendFirstIdToLinkCssSelector),this._config.iframeAppendFirstIdToLinkCssSelector.forEach(e=>{var t=document.querySelectorAll(e);this.logger.debug(`[FIRSTID IFRAME] Found ${t.length} links for cssSelector `+e),0!==t.length&&t.forEach(e=>{e.href&&!e.href.includes("firstid")?-1===e.href.indexOf("?")?e.href+="?firstid="+this._firstId:e.href+="&firstid="+this._firstId:e.src&&!e.src.includes("firstid")&&(-1===e.src.indexOf("?")?e.src+="?firstid="+this._firstId:e.src+="&firstid="+this._firstId)})})}getIdStruct(){if(this.config.isIframe&&this.firstIdStruct)return this.firstIdStruct;var e=this.__getCookieValueFromCookieName(this.config.cookieName);if(null===e)throw new n(this.config.cookieName);if(""===e)throw new c(this.config.cookieName);if("NO_TRACKING"===e)throw new d;var t=this.__getCookieValueFromCookieName(this.config.cookieNameFlexType)??void 0;return{firstId:e,t:isNaN(+t)?null:+t}}getId(){return this.getIdStruct()?.firstId??null}getVersion(){return this.version}getConfig(){return this._config}__getCookieValueFromCookieName(t){var i=document.cookie.split(";");for(let e=0;e<i.length;e++){var s=i[e].split("=");if(t===s[0].trim())return decodeURIComponent(s[1])}return null}_addListerFromIframeMessage(){window.addEventListener("message",e=>{if(this.logger.debug("[FIRSTID] message from iframe",e),"firstidACK"===e.data&&this.logger.log("[FIRSTID] iFrame has been receive successfully firstID",e),"requestFirstID"===e.data){this.logger.log("[FIRSTID] iFrame request firstID",e);try{e.source.postMessage({firstid:this.getId()},"*")}catch(e){this.logger.warn("[FIRSTID] Error on send firstID to iframe",e)}}},!0)}_hashAlreadyCheckFirstIdEmailAssociation(){return!!this.__getCookieValueFromCookieName(this._config.syncFidEmailCookieName)}async _getClientInfo(e){e=await fetch(e+"/info",{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)});let i={};return e.headers.forEach((e,t)=>{t.startsWith("x-fid-")&&(i[t]=e)}),i}async _updateIpUa(){if(this.consent)if(this._firstId){let i=[navigator?.userAgent??"",navigator?.language??"",screen?.width??0,screen?.height??0,navigator?.deviceMemory??0,navigator?.hardwareConcurrency??0].join("::");try{var e=await this._getClientInfo(this._config.firstIdApiBaseUrl),t=JSON.stringify({bd:i,...e}),s=await fetch(`${this._config.firstIdApiBaseUrl}/firstId?firstId=${this._firstId}&t=${this._firstIdType}&int=${this.config.firstIdFlexFeature?1:0}&cache=`+btoa(t),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),method:"POST",body:t});s.ok?this.logger.debug("[FIRSTID] Update FirstID print done"):this.logger.error("[FIRSTID] Error on update FirstID print",s.status,s.statusText)}catch(e){this.logger.error("[FIRSTID] Error on update FirstID print",e)}try{await this._getClientInfo(this._config.firstIdApiV6BaseUrl).then(e=>{let t=JSON.stringify({bd:i,...e});fetch(`${this._config.firstIdApiV6BaseUrl}/firstId?firstId=${this._firstId}&t=${this._firstIdType}&int=${this.config.firstIdFlexFeature?1:0}&cache=`+btoa(t),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),method:"POST",body:t}).then(e=>{this.logger.debug("[FIRSTID][V6] Update FirstID print done")}).catch(e=>{this.logger.error("[FIRSTID][V6] Error on update FirstID print",e),fetch(`${this._config.firstIdApiDualBaseUrl}/firstId?firstId=${this._firstId}&t=${this._firstIdType}&int=${this.config.firstIdFlexFeature?1:0}&cache=`+btoa(t),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),method:"POST",body:t}).then(e=>{this.logger.debug("[FIRSTID][DUAL] Update FirstID print done")}).catch(e=>{this.logger.error("[FIRSTID][DUAL] Error on update FirstID print",e)})})}).catch(e=>{this.logger.error("[FIRSTID][V6] Error on get client info",e)})}catch(e){this.logger.error("[FIRSTID][V6] Error on get client info",e)}}else this.logger.debug("[FIRSTID] Can't update ip and ua because firstId is null");else this.logger.debug("[FIRSTID] Can't update ip and ua because consent is not accepted")}async _checkMatchCookieWithEmail(e){if(!this.consent)return this.logger.debug("[FIRSTID] Can't check match cookie with email because consent is not accepted"),null;if(this._firstId){e=await fetch(`${this._config.firstIdApiBaseUrl}/emailAssoc?firstId=${this.firstIdStruct?.firstId}&t=${this.firstIdStruct?.t}&email=${e}&c=`+btoa(JSON.stringify({signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),u:window.location.href,int:this.config.firstIdFlexFeature?"1":"0"})),{});if(e.ok){var t=await e.json();if("firstId"in t&&"match"in t)return this.logger.debug("[FIRSTID] Check match cookie with email done"),t;this.logger.error("[FIRSTID] API response is missing firstId property")}else this.logger.error("[FIRSTID] Error on check match cookie with email",e.status,e.statusText);return null}this.logger.debug("[FIRSTID] Can't check match cookie with email because firstId is null")}_setFirstIdCookie(e){this._setCookie(this._config.cookieName,e?.firstId,this._config.cookieNameTTLInMinute),this._setCookie(this._config.cookieNameFlexType,""+(e?.t??""),this._config.cookieNameTTLInMinute)}_createRefreshCookie(){this._setCookie(this._config.refreshCookieName,"1",this._config.cookieNameTTLInMinute)}async _checkEmailExist(e){if(this.consent){e=await fetch(this._config.firstIdApiBaseUrl+`/emailExist?email=${e}&c=`+btoa(JSON.stringify({signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),u:window.location.href,int:this.config.firstIdFlexFeature?"1":"0"})),{});if(e.ok){var t=await e.json();if("firstId"in t&&"exist"in t)return this.logger.debug("[FIRSTID] Check email exist done"),t;this.logger.error("[FIRSTID] API response is missing firstId property")}else this.logger.error("[FIRSTID] Error on check email exist",e.status,e.statusText)}else this.logger.debug("[FIRSTID] Can't check email exist because consent is not accepted");return null}async _createFirstIdByEmail(e){if(this.consent){e=await fetch(this._config.firstIdApiBaseUrl+"/createFidViaEmail",{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs),method:"POST",body:JSON.stringify({email:e,u:window.location.href,int:this.config.firstIdFlexFeature?"1":"0"})});if(e.ok){var t=await e.json();if("firstId"in t)return this.logger.debug("[FIRSTID] Create first-id by email done"),t;this.logger.error("[FIRSTID] API response is missing firstId property")}else this.logger.error("[FIRSTID] Error on create first-id by email",e.status,e.statusText)}else this.logger.debug("[FIRSTID] Can't create first-id by email because consent is not accepted");return null}async _getFirstIdByIPUA(){if(this.consent){var i=async e=>{e=await e.json();return"firstId"in e?(this._setCookie(this._config.cookieNameFlexType,"number"==typeof e.t?e.t:"",this._config.cookieNameTTLInMinute),e):(this.logger.error("[FIRSTID] API response is missing firstId property"),null)},s=[navigator?.userAgent??"",navigator?.language??"",screen?.width??0,screen?.height??0,navigator?.deviceMemory??0,navigator?.hardwareConcurrency??0].join("::");let t=null;try{if(404===(t=await fetch(`${this._config.firstIdApiV6BaseUrl}/firstId?int=${this.config.firstIdFlexFeature?1:0}&bs=`+encodeURIComponent(s),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)})).status)if(404===(t=await fetch(`${this._config.firstIdApiBaseUrl}/firstId?int=${this.config.firstIdFlexFeature?1:0}&bs=`+encodeURIComponent(s),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)})).status)this.logger.debug("[FIRSTID] Can't get first-id by print"),this._setCookie(this._config.flexLastCheckCookieName,"1",360);else{if(t.ok)return this.logger.debug("[FIRSTID] Get first-id by print done"),i(t);this.logger.error("[FIRSTID] Error on get first-id by print",t.status,t.statusText)}else{if(t.ok)return this.logger.debug("[FIRSTID] Get first-id by print done"),i(t);this.logger.error("[FIRSTID] Error on get first-id by print",t.status,t.statusText)}}catch(e){if(404===(t=await fetch(`${this._config.firstIdApiBaseUrl}/firstId?int=${this.config.firstIdFlexFeature?1:0}&bs=`+encodeURIComponent(s),{signal:AbortSignal.timeout(this._config.xhrTimeoutInMs)})).status)this.logger.debug("[FIRSTID] Can't get first-id by print"),this._setCookie(this._config.flexLastCheckCookieName,"1",360);else{if(t.ok)return this.logger.debug("[FIRSTID] Get first-id by print done"),i(t);this.logger.error("[FIRSTID] Error on get first-id by print",t.status,t.statusText)}}}else this.logger.debug("[FIRSTID] Can't get first-id by print because consent is not accepted")}_setOutbrainPPID(e){window.OB_ppids=window.OB_ppids||[],window.OB_ppids.push({name:"first-id.fr",value:e})}_setCookie(i,s,r){if(this.consent){var o=new Date,r=(o.setTime(o.getTime()+60*r*1e3),"expires="+o.toUTCString());let e,t=(e=this.config.cookieDomain?"."===this.config.cookieDomain.charAt(0)?this.config.cookieDomain:"."+this.config.cookieDomain:window.location.hostname.split(".").slice(-2).join("."),"");"https:"===window.location.protocol&&(t=";Secure"),document.cookie=i+"="+s+"; "+r+"; path=/; domain="+e+t}else this.logger.debug("[FIRSTID] Can't set cookie because consent is not accepted")}_addFirstIdToGoogleSecureSignal(t){window.googletag=window.googletag??{},window.googletag.secureSignalProviders=window.googletag.secureSignalProviders??[],window.googletag.secureSignalProviders.push({id:"first-id.fr",collectorFunction:()=>new Promise(e=>{e(t)})})}_updateConsent(t){var e=t.vendor.consents[this.vendorId],i=this.requiredPurposes.every(e=>t.purpose.consents[e]);e&&i?(this.consent=!0,this.logger.log("[FIRSTID] User has given consent for all required purposes, vendor, and special features.")):(this.logger.log("[FIRSTID] User has not given consent for all required purposes or vendor."),e||this.logger.log("[FIRSTID] Missing vendor consent for vendor ID "+this.vendorId),0<(i=this.requiredPurposes.filter(e=>!t.purpose.consents[e])).length&&this.logger.log("[FIRSTID] Missing purpose consents: "+i.join(", ")),0<(e=this.specialFeatures.filter(e=>!t.specialFeatureOptins[e])).length&&this.logger.log("[FIRSTID] Missing special feature consents: "+e.join(", ")))}_waitForTCFConsent(){if(JSON.parse(h.TCF_ENABLED))return new Promise(i=>{window.__tcfapi?window.__tcfapi("addEventListener",2,(e,t)=>{if(t)switch(e.eventStatus){case"tcloaded":case"useractioncomplete":this._updateConsent(e),this.consent&&i(!0);break;case"cmpuishown":this.logger.log("CMP UI is shown.");break;default:this.logger.log("Unknown eventStatus:",e.eventStatus)}else this.logger.log("Listening for TCF updates failed.")}):i(!1)})}_trackPageView(){this.consent?fetch(`${this._config.firstIdApiPageViewBaseUrl}/pv?p=${encodeURIComponent(window.location.href)}&fid=${this._firstId}&fidt=`+this._firstIdType,{}).then(()=>{this.logger.debug("[FIRSTID] Page view done")}).catch(e=>{this.logger.error("[FIRSTID] Error on page view",e)}):this.logger.debug("No consent, skip setting track page view.")}}window.FirstIdSdk=r.default})();</script>
</body>
</html>
