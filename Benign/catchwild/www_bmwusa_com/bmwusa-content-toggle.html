<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bmwusa-content-toggle.html</title>
</head>
<body>

<script>
/*! BMWUSA Vite Build 1731603678170 */
import{C as h}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/component.js";import{u,r as c,$ as a,h as l,G as f,O as g,v as p}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-measurement-data.js";import{A as d}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/angular-utils.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.esm.js";import{P as C}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-panel-container.js";import{i as b}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/is-author.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/baseDomain.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/getbyourl.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/scroll-to.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/uid.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/zipcode.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-panel-container-tabs.js";const y={config:{centersIds:null,subscribe:"dealerUpdate"},toggleContent(e,t){this.config.centersIds=e,PubSub.subscribe(this.config.subscribe,(n,o)=>{const{CenterID:s}=o.dealer;if(s){const i=s,r=this.config.centersIds.indexOf(i)===-1;t(r)}})}},P={toggle(e,t,n){const o=u.getVersionData(),s=e.filter(i=>Object.values(o).includes(i.variationName));s.length?c.get(s[0].contentPath).then(i=>{i.ok&&(a.html(t,i.text,!0),d.initialize(t),n&&n())}):n&&n()}},I={dealerDataInfo:l,config:{subscribe:"dealerUpdate",contentPath:null,toggleCallback:null},hasDealerData(e){return e&&(e.dealer||e.ZipCode)},toggleContent(e,t,n){this.config.toggleCallback=n,this.config.contentPath=t,this.config.zipCodes=e,e.length?(this.useZipCodeList(l.getDealer()),PubSub.subscribe(this.config.subscribe,(o,s)=>{this.useZipCodeList(s.dealer)})):this.useDealerInfo(n)},useDealerInfo(e){e(!this.hasDealerData(l.getDealer())),PubSub.subscribe(this.config.subscribe,(t,n)=>{e(!this.hasDealerData(n.dealer))})},useZipCodeList(e){const t=this.isZipCodeListed(this.config.zipCodes,e);this.config.contentPath&&t?this.requestContent():this.config.toggleCallback(t)},isZipCodeListed(e,t){var s;let n=!1;const o=((s=BMWdataLayer==null?void 0:BMWdataLayer.user)==null?void 0:s.location)||"";return(e.indexOf(o)!==-1||t&&t.ZipCode&&e.indexOf(t.ZipCode)!==-1)&&(n=!0),n},requestContent(){this.config.contentPath&&c.get(`${this.config.contentPath}.content.html`).then(e=>{e.ok?this.config.toggleCallback(!0,e.text):this.config.toggleCallback(!1)}).catch(e=>{console.warn(`Content toggle error: Error while retrieving content ${this.config.contentPath}: ${e}`)})}},L={config:{topic:"personalization.consolidatedValuesUpdate",path:null,maco:"0000",toggleCallback:null},toggleContent(e,t){this.config.path=e,this.config.toggleCallback=t,this.requestExperienceFragment(this.resolveMaco()),PubSub.subscribe(this.config.topic,(n,{consolidatedMacoId:o})=>{o&&this.requestExperienceFragment(o)})},requestExperienceFragment(e){this.config.maco!==e?(this.config.maco=e,this.makeRequest()):this.config.toggleCallback(null,e)},resolveMaco(){const e=JSON.parse(localStorage.getItem("dealer_info")),t=f();let n="0000";return t.maco?n=t.maco:e?n=e.maco.Code:document.location.pathname.match(/centers/i)&&(n=BMWdataLayer.user.attribution.macoCode),n},makeRequest(){const e=this.config.path+".maco."+this.config.maco+".html",t=n=>{n.ok?(n.header["bmw-national-response"]==="true"&&(this.config.maco="0000"),this.config.toggleCallback(n.text,this.config.maco)):this.config.toggleCallback(null,this.config.maco)};Promise.all([c.get(e),g.getOffersByMacoCode()]).then(n=>{t(n[0]),g.applyTargetOffer(n[1])}).catch(n=>{this.config.toggleCallback(null,this.config.maco),console.warn(`Error while retrieving MACO offers or getting target offers, ${n}`)})}};new h({el:".content-toggle-module > .na-code-condition",name:"Content Toggle - NA Code Condition",subscriptions:{"pdp.ModelUpdate":"toggleContentByNaCode"},init(){this.panelContainer=new C(this.element.parentElement)},toggleContentByNaCode(e,t){const n=t[0];n&&this.panelContainer.navigate(n)}});new h({el:".content-toggle-module",name:"content-toggle Component",toggle:{},init(){const e={displayNoneClass:"display-none"};this.toggle={centersIds:this.useCenterIds.bind(this),queryParams:this.useQueryParameters.bind(this),macoExperienceFragment:this.useMacoExperienceFragment.bind(this),hasZipCode:this.useDealerInfoCheck.bind(this)},e.mode=this.attrs.toggleMode,e.primaryContent=a.qs('[data-content="primary"]',this.element),e.secondaryContent=a.qs('[data-content="secondary"]',this.element),this.setMode(e)},toggleContent(e,t){e?(t.secondaryContent.classList.add(t.displayNoneClass),t.primaryContent.classList.remove(t.displayNoneClass)):(t.secondaryContent.classList.remove(t.displayNoneClass),t.primaryContent.classList.add(t.displayNoneClass))},setMode(e){this.toggle[e.mode]&&this.toggle[e.mode](e)},useQueryParameters(){const e=this.attrs.personalizationConfig;e&&P.toggle(JSON.parse(e),this.element,()=>this.showHiddenElement())},useCenterIds(e){const t=this,n=this.attrs.centersIds;n&&y.toggleContent(n.split(","),o=>t.toggleContent(o,e))},useDealerInfoCheck(e){const t=this,n=this.attrs.zipCodes?this.attrs.zipCodes.split(","):[],o=this.attrs.lazyContent;I.toggleContent(n,o,(s,i=null)=>{i!==null&&(a.html(e.secondaryContent,i,!0),d.initialize(i)),t.toggleContent(!s,e)})},useMacoExperienceFragment(e){if(!b()){const t=this;e.primaryContent.classList.remove(e.displayNoneClass),L.toggleContent(this.element.dataset.path,(n,o)=>{if(t.element.dataset.targetingType="maco",t.element.dataset.targetingValue=o,n!==null){const s=/<script[\s\S]*?bmwusa-pubsub[\s\S]*?>[\s\S]*?<\/script>/gm,i=n.replace(s,""),r=document.createElement("div");r.innerHTML=i,this.waitForImagesToLoad(r).then(()=>{a.html(e.primaryContent,i,!0)}).catch(m=>{console.error("Error during maco image load",m)})}e.primaryContent.classList.remove("hidden"),p.enqueue(t.element)})}},waitForImagesToLoad(e){const t=e.querySelectorAll("picture img"),n=Array.from(t).filter(o=>o.src).map(o=>new Promise((s,i)=>{o.onload=s,o.onerror=s}));return Promise.all(n)},showHiddenElement(){const e=this.element.querySelector(".content-toggle-hidden");e&&(e.style.cssText="")}});

</script>

</body>
</html>
