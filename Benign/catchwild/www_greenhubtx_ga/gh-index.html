<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>gh-index.html</title>
</head>
<body>

<script>
var isMac = navigator.platform.toUpperCase().indexOf("MAC") >= 0;

var currentPlatform = "";

var macFileName = "/GreenHub-2.2.1.dmg";
var winFileName = "/GreenHub%20Setup%202.2.1.exe";
var winFileName2 = "/GreenHub%2520Setup%25202.2.1.exe";

var macDownloadLine1 = "https://d3doq0jj4dgobw.cloudfront.net" + macFileName;
var macDownloadLine2 = "https://d3doq0jj4dgobw.cloudfront.net" + macFileName;
var winDownloadLine1 = "https://kr042001.westmgreen.com" + winFileName2;
var winDownloadLine2 = "https://d3doq0jj4dgobw.cloudfront.net" + winFileName;


var downloadUrls = ["https://kr042001.westmgreen.com", "https://kr042002.westmgreen.com"];

//ext plat
var plat = "";

function getRandomUrl() {
  const random = Math.floor(Math.random() * downloadUrls.length);
  return downloadUrls[random];
}

function showMac() {
  $(".gh-ddd-2").addClass("animate__fadeIn");
  setTimeout(function () {
    $(".gh-ddd-2").removeClass("animate__fadeIn");
  }, 1000);
  $(".gh-download-f-normal-macos").addClass("height-light-color");
  $(".macos-icon").html(
    '<svg t="1666083417894" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4906" width="30" height="30"><path d="M928.768 750.592c-1.536 4.096-21.504 74.24-70.656 145.92-43.008 62.464-87.04 124.928-156.672 125.952-68.608 1.024-90.624-40.96-168.96-40.96s-102.912 39.936-167.936 41.984c-67.072 2.56-118.784-68.096-161.792-130.048C115.2 767.488 47.616 534.528 138.24 378.88c44.544-77.824 124.928-127.488 211.968-129.024 65.536-1.024 128.512 44.544 168.448 44.544 40.96 0 116.736-55.296 196.608-47.104 33.28 1.536 126.976 13.824 186.88 101.376-4.608 3.072-111.616 66.56-110.592 195.072 1.024 155.136 135.68 206.336 137.216 206.848m-266.24-586.24c35.84-44.032 59.904-104.448 53.248-164.352-51.2 2.048-114.176 34.304-151.04 77.824-32.768 37.888-61.952 99.328-53.76 158.72 56.832 3.072 115.712-30.208 151.552-72.192" p-id="4907" fill="#7cb361"></path></svg>'
  );
  $(".mac-title").removeClass("dom-hide");
  // source/images/sample/mac.png
  // $('.gh-download-img').attr('src', '/images/sample/mac.png')
  $(".gh-download-img-mac").show();
  currentPlatform = "mac";
}

function hideMac() {
  $(".gh-download-f-normal-macos").removeClass("height-light-color");
  $(".macos-icon").html(
    '        <svg t="1666075139138" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2779" width="30" height="30"><path d="M928.768 750.592c-1.536 4.096-21.504 74.24-70.656 145.92-43.008 62.464-87.04 124.928-156.672 125.952-68.608 1.024-90.624-40.96-168.96-40.96s-102.912 39.936-167.936 41.984c-67.072 2.56-118.784-68.096-161.792-130.048C115.2 767.488 47.616 534.528 138.24 378.88c44.544-77.824 124.928-127.488 211.968-129.024 65.536-1.024 128.512 44.544 168.448 44.544 40.96 0 116.736-55.296 196.608-47.104 33.28 1.536 126.976 13.824 186.88 101.376-4.608 3.072-111.616 66.56-110.592 195.072 1.024 155.136 135.68 206.336 137.216 206.848m-266.24-586.24c35.84-44.032 59.904-104.448 53.248-164.352-51.2 2.048-114.176 34.304-151.04 77.824-32.768 37.888-61.952 99.328-53.76 158.72 56.832 3.072 115.712-30.208 151.552-72.192" p-id="2780"></path></svg>    '
  );
  $(".mac-title").addClass("dom-hide");
  $(".gh-download-img-mac").hide();
}

function showWin() {
  $(".gh-ddd-2").addClass("animate__fadeIn");
  setTimeout(function () {
    $(".gh-ddd-2").removeClass("animate__fadeIn");
  }, 1000);
  $(".gh-download-f-normal-win").addClass("height-light-color");
  $(".win-icon").html(
    '          <svg t="1666083294290" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4509" width="30" height="30"><path d="M1024 486.4V0C836.8 25.6 651.2 51.2 464 81.6v409.6l560-4.8zM0 150.4v344c137.6 0 278.4-1.6 416-1.6v-400C278.4 112 137.6 129.6 0 150.4zM0 534.4v344c137.6 19.2 278.4 36.8 416 56V536c-137.6 0-278.4-1.6-416-1.6zM467.2 542.4c1.6 134.4 1.6 268.8 1.6 403.2C654.4 971.2 838.4 996.8 1024 1024V542.4H467.2z" p-id="4510" fill="#7cb361"></path></svg>    '
  );
  $(".win-title").removeClass("dom-hide");
  // $('.gh-download-img').attr('src', '/images/sample/Windows.png')
  $(".gh-download-img-windows").show();
  currentPlatform = "win";
}

function hideWin() {
  $(".gh-download-f-normal-win").removeClass("height-light-color");
  $(".win-icon").html(
    '        <svg t="1666075101626" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2526" width="30" height="30"><path d="M527.008 868.992l434.016 71.008V539.008H527.008v330.016z m0-730.976v328.992h434.016V66.016zM68 467.008h367.008V150.016L68 211.008v256z m0 329.984l367.008 60v-318.016H68v258.016z" p-id="2527"></path></svg>    '
  );
  $(".win-title").addClass("dom-hide");
  $(".gh-download-img-windows").hide();
}

//////////////////优惠码功能js//////////////////////

function initCounter() {
  const period = 7 * 24 * 60 * 60 * 1000;
  const curTime = new Date().getTime();
  const startTime = localStorage.getItem("startTime");

  var diffTime = 0;
  if (startTime) {
    diffTime = period - (curTime - startTime);
  } else {
    diffTime = period;
    localStorage.setItem("startTime", curTime);
  }
  var timer = setInterval(function () {
    if (diffTime > 0) {
      diffTime = diffTime - 1000;
    } else {
      diffTime = period;
    }

    const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    const hours = Math.floor(
      (diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
    );
    const minutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diffTime % (1000 * 60)) / 1000);
    document.getElementById("days").innerHTML = padZero(days);
    document.getElementById("hours").innerHTML = padZero(hours);
    document.getElementById("minutes").innerHTML = padZero(minutes);
    document.getElementById("seconds").innerHTML = padZero(seconds);
  }, 1000);
}

function padZero(value) {
  return value.toString().padStart(2, "0");
}

function getUrlParam(name) {
  var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象\
  var r = window.location.search.substr(1).match(reg); //匹配目标参数
  if (r != null) return unescape(r[2]);
  return null; //返回参数值
}

$(document).ready(function () {
  const platP = getUrlParam("origin");
  if (platP) {
    plat = platP;
  }
  gtag("event", "home-page-open", {
    event_category: "index",
    event_label: "",
  });
  doEvent("home-page-open", { plat: plat, os: isMac ? "mac" : "win" });
  if (isMac) {
    showMac();
  } else {
    showWin();
  }

  initCounter();
  $(".code-btn").on("click", function (e) {
    $("html,body").stop(true);
    $("html,body").animate(
      { scrollTop: $("#gh-download-sec").offset().top },
      1000
    );
    gtag("event", "promotion-code-click", {
      event_category: "code",
      event_label: "",
    });
    doEvent("promotion-code-click", { plat: plat, os: isMac ? "mac" : "win" });
  });

  $(".gh-download-btn").on("click", function (e) {
    $("html,body").stop(true);
    $("html,body").animate(
      { scrollTop: $("#gh-download-sec").offset().top },
      1000
    );
    gtag("event", "drop-btn-click", {
      event_category: "download",
      event_label: "",
    });
    doEvent("drop-btn-click", { plat: plat, os: isMac ? "mac" : "win" });
  });

  // download
  $(".gh-download-action").on("click", function (e) {
    console.log("gh-download-action");
    let selectValue = $(".gh-select-container select").val();
    console.log("seleced value:", selectValue);
    if (currentPlatform === "mac") {
      if (selectValue === "line1") {
        const url = getRandomUrl() + macFileName;
        window.open(url, "_blank");
      } else if (selectValue === "line2") {
        window.open(macDownloadLine2, "_blank");
      } else {
        window.open(macDownloadLine1, "_blank");
      }
    } else {
      // win
      if (selectValue === "line1") {
        const url = getRandomUrl() + winFileName2;
        window.open(url, "_blank");
      } else if (selectValue === "line2") {
        window.open(winDownloadLine2, "_blank");
      } else {
        window.open(winDownloadLine1, "_blank");
      }
    }
    gtag("event", "download-file-click", {
      event_category: "index",
      event_label: "",
    });
    doEvent("download-file-click", { plat: plat, os: isMac ? "mac" : "win" });
  });

  $(".gh-win-tab").on("click", function () {
    hideMac();
    showWin();
    gtag("event", "win-tab-click", {
      event_category: "index",
      event_label: "",
    });
    doEvent("win-tab-click", { plat: plat, os: isMac ? "mac" : "win" });
  });

  $(".gh-mac-tab").on("click", function () {
    hideWin();
    showMac();
    gtag("event", "mac-btn-click", {
      event_category: "index",
      event_label: "",
    });
    doEvent("mac-btn-click", { plat: plat, os: isMac ? "mac" : "win" });
  });
});

////////////////tongji//////////////////////
const gif = "https://p.ghhub.tk/p.gif";

async function doEvent(eventName, params = {}) {
  if (!eventName) {
    return;
  }
  let url = await getUrl(eventName, params);
  if (url) {
    let img = new Image();
    img.style.display = "none";
    img.src = url;
    document.body.appendChild(img);
  }
}

async function getUrl(eventName, params) {
  params.event = eventName;
  params.time = (new Date().getTime() / 1000).toFixed(0);
  var uid = localStorage.getItem("uid");
  if (uid === null || uid === undefined || uid === "") {
    uid = getUuid();
    localStorage.setItem("uid", uid);
  }
  params.uid = uid;

  const data = new URLSearchParams(params);
  let url = `${gif}?${data}`;
  return url;
}
function getUuid() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
    var r = (Math.random() * 16) | 0,
      v = c == "x" ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

</script>

</body>
</html>
