<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeechRecognition.K_L3zjXv.html</title>
</head>
<body>

<script>
var i=Object.defineProperty,t=(t,n,s)=>(((t,n,s)=>{n in t?i(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s})(t,"symbol"!=typeof n?n+"":n,s),s);import{w as n,d as s}from"./index.CXi0gp2T.js";import{a4 as e}from"./scheduler.Ce454wGl.js";const r=(...i)=>i.map((i=>i.trim())).join(" ").trim(),o=/\s*\((.*?)\)\s*/g,a=/(\(\?:[^)]+\))\?/g,c=/(\(\?)?:\w+/g,h=/\*/g,g=/[-{}[\]+?.,\\^$|#]/g,l=()=>"undefined"!=typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext),p=()=>/(android)/i.test("undefined"!=typeof navigator?navigator.userAgent:""),u=navigator.brave?null:window.SpeechRecognition||window.webkitSpeechRecognition;class b{constructor(i){t(this,"recognition"),t(this,"pauseAfterDisconnect"),t(this,"interimTranscript"),t(this,"finalTranscript"),t(this,"listening"),t(this,"isMicrophoneAvailable"),t(this,"subscribers"),t(this,"onStopListening"),t(this,"previousResultWasFinalOnly"),this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=n(!1),this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=()=>{},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(i),p()&&(this.updateFinalTranscript=((i,t,n,...s)=>{let e;return()=>{const r=void 0,o=[i,t,n,...s],a=n&&!e;clearTimeout(e),e=setTimeout((function(){e=void 0,n||i.apply(r,o)}),t),a&&i.apply(r,o)}})(this.updateFinalTranscript,250,!0))}setSpeechRecognition(i){const t=!!i&&((i=>i===u)(i)||l());t&&(this.disableRecognition(),this.recognition=new i,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this))}subscribe(i,t){this.subscribers[i]=t}unsubscribe(i){delete this.subscribers[i]}emitListeningChange(i){this.listening.set(i),Object.keys(this.subscribers).forEach((t=>{const{onListeningChange:n}=this.subscribers[t];n(i)}))}emitMicrophoneAvailabilityChange(i){this.isMicrophoneAvailable=i,Object.keys(this.subscribers).forEach((t=>{const{onMicrophoneAvailabilityChange:n}=this.subscribers[t];n(i)}))}emitTranscriptChange(i,t){Object.keys(this.subscribers).forEach((n=>{const{onTranscriptChange:s}=this.subscribers[n];s(i,t)}))}emitClearTranscript(){Object.keys(this.subscribers).forEach((i=>{const{onClearTranscript:t}=this.subscribers[i];t()}))}disconnect(i){if(this.recognition&&e(this.listening))switch(i){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}disableRecognition(){this.recognition&&(this.recognition.onresult=()=>{},this.recognition.onend=()=>{},this.recognition.onerror=()=>{},e(this.listening)&&this.stopListening())}onError(i){i&&i.error&&"not-allowed"===i.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}onRecognitionDisconnect(){this.onStopListening(),this.listening.set(!1),this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}updateTranscript({results:i,resultIndex:t}){const n=void 0===t?i.length-1:t;this.interimTranscript="",this.finalTranscript="";for(let e=n;e<i.length;++e)i[e].isFinal&&(!p()||i[e][0].confidence>0)?this.updateFinalTranscript(i[e][0].transcript):this.interimTranscript=r(this.interimTranscript,i[e][0].transcript);let s=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(s=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,s||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}updateFinalTranscript(i){this.finalTranscript=r(this.finalTranscript,i)}resetTranscript(){this.disconnect("RESET")}async startListening({continuous:i=!1,language:t="en"}={}){if(!this.recognition)return;const n=i!==this.recognition.continuous,s=t&&t!==this.recognition.lang;if((n||s)&&(e(this.listening)&&await this.stopListening(),this.recognition.continuous=n?i:this.recognition.continuous,this.recognition.lang=s?t:this.recognition.lang),!e(this.listening)){this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript());try{await this.start(),this.emitListeningChange(!0)}catch(r){r instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1)}}}async abortListening(){this.disconnect("ABORT"),this.emitListeningChange(!1),await new Promise((i=>{this.onStopListening=i}))}async stopListening(){this.disconnect("STOP"),this.emitListeningChange(!1),await new Promise((i=>{this.onStopListening=i}))}getRecognition(){return this.recognition}async start(){this.recognition&&!e(this.listening)&&(await this.recognition.start(),this.listening.set(!0))}stop(){this.recognition&&e(this.listening)&&(this.recognition.stop(),this.listening.set(!1))}abort(){this.recognition&&e(this.listening)&&(this.recognition.abort(),this.listening.set(!1))}}let m,d=!!u,T=d&&!p();const f=({transcribing:i=!0,clearTranscriptOnListen:t=!0,commands:r=[]}={})=>{const l=w.getRecognitionManager(),p=n(i),u=n({interimTranscript:"",finalTranscript:[]}),b=n(t),m=s(l.listening,(i=>i)),f=s(u,(i=>i.interimTranscript)),y=s(u,(i=>i.finalTranscript)),v=d,R=T;let L=l.isMicrophoneAvailable;const S=()=>{u.set({interimTranscript:"",finalTranscript:[]})},C=()=>{l.resetTranscript(),S()},A=(i,t,n)=>{const s=("object"==typeof i?i.toString():i).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),e=((i,t)=>{if(i=i.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!i.length&&!t.length)return 1;if(!i.length||!t.length)return 0;if(i===t)return 1;if(1===i.length&&1===t.length)return 0;if(i.length<2||t.length<2)return 0;const n=new Map;for(let e=0;e<i.length-1;e++){const t=i.substring(e,e+2),s=n.has(t)?n.get(t)+1:1;n.set(t,s)}let s=0;for(let e=0;e<t.length-1;e++){const i=t.substring(e,e+2),r=n.has(i)?n.get(i):0;r>0&&(n.set(i,r-1),s++)}return 2*s/(i.length+t.length-2)})(s,t);return e>=n?{command:i,commandWithoutSpecials:s,howSimilar:e,isFuzzyMatch:!0}:null},M=(i,t)=>{const n=(i=>i instanceof RegExp?new RegExp(i.source,"i"):(i=i.replace(g,"\\$&").replace(o,"(?:$1)?").replace(c,((i,t)=>t?i:"([^\\s]+)")).replace(h,"(.*?)").replace(a,"\\s*$1?\\s*"),new RegExp("^"+i+"$","i")))(i),s=n.exec(t);return s?{command:i,parameters:s.slice(1)}:null},O=w.counter;w.counter+=1;const E={onListeningChange:i=>l.listening.set(i),onMicrophoneAvailabilityChange:i=>L=i,onTranscriptChange:(i,t)=>{e(p)&&u.update((n=>(n.interimTranscript=i,t&&(n.finalTranscript=[...n.finalTranscript,t]),n))),((i,t)=>{r.forEach((({command:n,callback:s,matchInterim:e=!1,isFuzzyMatch:r=!1,fuzzyMatchingThreshold:o=.8,bestMatchOnly:a=!1})=>{var c,h,g;const l=!t&&e?i.trim():t.trim(),p=(Array.isArray(n)?n:[n]).map((i=>r?A(i,l,o):M(i,l))).filter((i=>i));if(r&&a&&p.length>=2){p.sort(((i,t)=>t.howSimilar-i.howSimilar));const i=null==(c=p[0])?void 0:c.command,t=null==(h=p[0])?void 0:h.commandWithoutSpecials,n=null==(g=p[0])?void 0:g.howSimilar;s(t,l,n,{command:i,resetTranscript:C})}else p.forEach((i=>{if(i.isFuzzyMatch){const{command:t,commandWithoutSpecials:n,howSimilar:e}=i;s(n,l,e,{command:t,resetTranscript:C})}else{const{command:t,parameters:n}=i;s(...n,{command:t,resetTranscript:C})}}))}))})(i,t)},onClearTranscript:()=>{e(b)&&S()}};return l.subscribe(O,E),{transcribing:p,clearTranscriptOnListen:b,listening:m,isMicrophoneAvailable:L,resetTranscript:C,browserSupportsSpeechRecognition:v,browserSupportsContinuousListening:R,transcriptStore:u,interimTranscript:f,finalTranscript:y}},w={counter:0,applyPolyfill:i=>{m?m.setSpeechRecognition(i):m=new b(i);const t=!!i&&l();d=t,T=t},getRecognitionManager:()=>(m||(m=new b(u)),m),getRecognition:()=>w.getRecognitionManager().getRecognition(),startListening:async({continuous:i=!1,language:t="en-US"}={})=>{const n=w.getRecognitionManager();await n.startListening({continuous:i,language:t})},stopListening:async()=>{const i=w.getRecognitionManager();await i.stopListening()},abortListening:async()=>{const i=w.getRecognitionManager();await i.abortListening()},browserSupportsSpeechRecognition:()=>d,browserSupportsContinuousListening:()=>T};export{w as S,f as u};

</script>

</body>
</html>
