<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ePortalMainScript.html</title>
</head>
<body>

<script>


var Globals = window.Globals || {};
var AppLang = 'en';
try { AppLang = $("#AppLangDiv").html() } catch (e) { }
var DeviceWidth = document.documentElement.clientWidth;
var DeviceHeight = document.documentElement.clientHeight;
var GlobalAdditionalCachingKey = ''; // Would be useful for Pre & Post Login Widgets
var WidgetsIDWP = new Array();
var S_height;
var HeightsArr_WP = "";
var AllPageContentHeight = 0;
var PageContentHeight = 0;
var AllPageContentMiniHeight = 0;
var DisplayLogoutConfirmationAlert = true;
var UseActiveSubPageWhenLoadingPageContent = true;
var ShowSpinnerFlag = false;
var InitCallTimer = null;
var ClassInstancesArray = new Array();
var mySwiper;


//var startdate = new Date() - 0;
//var x = new Xorc(6);
//var xe = x.encrypt(localStorage.LSStoringDatesKeys);
//var xd = x.decrypt(xe);
//var enddate = new Date() - 0;


//console.log( x.salt );
//console.log( xe );
//console.log( xd );

//console.log(enddate - startdate);

var encrypter = new Xorc(6);
//var EnableDataSignature = false; // Set True When Need to Send a Data Signature From Client Cached Response Header to Server Side, and Server Side is Checking the old one against the new one and send empty Response When they are the Same
//alert(GlobalAdditionalCachingKey);
//alert(UserID);
var NativeBridgeCallTypes = {
    EncryptedJSON: 0,
    EncryptedXML: 1,
    JSON: 2
};



/*********** HandleLoadedScripts ********/
function HandleLoadedScripts(Element) {
    log('HandleLoadedScripts for ' + Element);

    //    CommonScreenController("Test");
    scripts = Element.getElementsByTagName('script');
    for (var i in scripts) {
        try {
            eval(scripts[i].innerHTML);
        }
        catch (err) {
        }
    }

}

function PageClick_SlideMenuUp() {
    if ($("#DropMenu").css("display") == "block") {
        $("#MennuButton").css("display", "block");
        $("#DropMenu").slideUp(0);
        $("#MenuButtonDiv").fadeIn(0);
        HandleContentPanelTopPadding();
    }

}

function HandleContentPanelTopPadding() {
    try {


        $("#PageContent").css("padding-top", ($('#PageHeader').height() - $('#PageContent').offset().top) + "px");

        try { AfterHandleContentPanelTopPadding(); } catch (e) { }
    } catch (e) {
        alert(e);
    }
}

function HandleContentPanelTopMargin() {
    try {
        //if(!isWindowsPhoneFunction()){
        var pageContentTop = $("#PageHeader").height();
        var pageContentBottom = $("#footer").height();
        $("#PageContent").css("top", pageContentTop + "px");
        if ($('#footer').css('display') == 'none') {
            $("#PageContent").css("bottom", "0px");
        } else {
            $("#PageContent").css("bottom", pageContentBottom + "px");
        }

        try { AfterHandleContentPanelTopMargin(); } catch (e) { }
    } catch (e) {
        alert(e);
    }
}

/**************** Widget Behavior ******************/
//if CollapseWidget = true then Collapse
//if CollapseWidget = false then unCollapse
function Collapse(WidgetIDs, CollapseWidget, ForceAction) {
    log('Collapse: WidgetIDs: ' + WidgetIDs + ', CollapseWidget: ' + CollapseWidget + ', ForceAction: ' + ForceAction);
    if (!ForceAction)
        ForceAction = false;
    var WidgetsArr = WidgetIDs.split(',');

    if (CollapseWidget) {
        for (var i = 0; i < WidgetsArr.length; i++) {
            try {
                var WidgetID = WidgetsArr[i];
                var tmpState = false;
                var DisableWidgetCollapsedAction = window['DisableWidgetCollapsedAction_' + WidgetID];
                if (ForceAction) {
                    window["Collapse_" + WidgetID] = false;
                    window['DisableWidgetCollapsedAction_' + WidgetID] = false;
                }
                eval("if(Collapse_" + WidgetID + "==false){tmpState= true;}");
                if (tmpState) {
                    eval("collapsefnWithReloadWidget_" + WidgetID + "('" + WidgetID + "');");
                }
                window['DisableWidgetCollapsedAction_' + WidgetID] = DisableWidgetCollapsedAction;

            } catch (e) {
                //alert("Widget Collapsed : " + e);
            }
        }
    } else {
        for (var i = 0; i < WidgetsArr.length; i++) {
            try {

                var isWindowsPhone = /windows phone/i.test(navigator.userAgent.toLowerCase());
                if (isWindowsPhone) {
                    try {
                        window.external.notify("noScroll");
                    } catch (e) { }
                    HeightsArr_WP = '';

                }

                var WidgetID = WidgetsArr[i];
                var tmpState = false;

                var DisableWidgetCollapsedAction = window['DisableWidgetCollapsedAction_' + WidgetID];
                if (ForceAction) {
                    window["Collapse_" + WidgetID] = true;
                    window['DisableWidgetCollapsedAction_' + WidgetID] = false;
                }
                eval("if(Collapse_" + WidgetID + "==true){tmpState= true;}");
                if (tmpState) {
                    eval("collapsefnWithReloadWidget_" + WidgetID + "('" + WidgetID + "');");
                }
                window['DisableWidgetCollapsedAction_' + WidgetID] = DisableWidgetCollapsedAction;

            } catch (e) {
                //alert("Widget unCollapsed : " + e);
            }
        }
    }

}


function ClearWidgetContent(WidgetIDs) {
    var WidgetsArr = WidgetIDs.split(',');
    for (var i = 0; i < WidgetsArr.length; i++) {
        try {
            var WidgetID = WidgetsArr[i];
            $("#" + WidgetID + " .widget-content").html("");
            window["Collapse_" + WidgetID] = true;
            window["ContentOf" + WidgetID + "Loaded"] = false;
        } catch (e) {
            alert("Widget Collapsed : " + e);
        }
    }
}
/***************************************************/


/********** Load Content **********/
//BADAWY
//  when we call this function and for which purpose ?
//BADAWY
function LoadContent(ElementID, Path) {

    var ContentElement = document.getElementById(ElementID);
    $.ajax({
        type: "POST",
        url: Path,
        data: "",
        contentType: "application/x-www-form-urlencoded; charset=utf-8",
        dataType: "html",
        crossDomain: true,
        global: false,
        success: function (response) {
            ContentElement.innerHTML = response;
            HandleLoadedScripts(ContentElement);
        },
        error: function (xhr, status, error) {
            ContentElement.innerHTML = "<center>Error Loading</center>";
        }
    });
}

function LogNative(LogStr) {
    if (!Globals)
        return;
    if (!Globals.AllowNativeLog)
        return;
    try {
        var request;
        if (window.XMLHttpRequest) {
            request = new XMLHttpRequest();
        } else {
            request = new ActiveXObject("Microsoft.XMLHTTP");
        }
        request.open('GET', 'http://127.0.0.1:30001/', true);
        var LogPrefix = "[JSLog:] ";
        try {
            if (typeof (LogStr) == "object") {
                request.setRequestHeader("LogStr", LogPrefix + JSON.stringify(LogStr));
            } else {
                request.setRequestHeader("LogStr", LogPrefix + LogStr);
            }
        } catch (e) {
            try {
                request.setRequestHeader("LogStr", LogPrefix + JSON.stringify(LogStr));
            } catch (e2) {
                try {
                    request.setRequestHeader("LogStr", LogPrefix + "" + LogStr);
                } catch (e3) {
                    try {
                        request.setRequestHeader("LogStr", LogPrefix + JSON.stringify("" + LogStr));
                    } catch (e4) {

                    }
                }
            }
        }
        request.send();
    } catch (e) {
        alert(LogStr);
        alert(e + ":::" + e.stack);
        console.log(e);
    }
}




//function logErr() {
//    if (arguments.length > 0) {
//        // Join for graceful degregation
//        var args = (arguments.length > 1) ? Array.prototype.join.call(arguments, " ") : arguments[0];

//        // This is the standard; Firebug and newer WebKit browsers support this.
//        try {
//            //console.error('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx Custom Error xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
//            var LogStrPrefix = '';
//            try { LogStr = '[' + (new Date()).toJSON() + ']: '; } catch (e) { }
//            if (typeof (args) == "object") {
//                console.error(LogStr);
//                console.error(args);
//            } else {
//                console.error(LogStr + args);
//            }
//            //console.error(args);
//            //console.error('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx End Custom Error xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
//            return true;
//        } catch (e) {
//            // Newer Opera browsers support posting erros to their consoles.
//            try {
//                opera.postError(args);
//                return true;
//            }
//            catch (e) {
//            }
//        }

//        // Catch all; a good old alert box.
//        //alert(args);
//        return false;
//    }
//}

//function logWarn() {
//    if (arguments.length > 0) {
//        // Join for graceful degregation
//        var args = (arguments.length > 1) ? Array.prototype.join.call(arguments, " ") : arguments[0];

//        // This is the standard; Firebug and newer WebKit browsers support this.
//        try {
//            console.warn('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Custom Warnning !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
//            console.warn(args);
//            console.warn('!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! End Custom Warnning !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!');
//            return true;
//        } catch (e) {
//            // Newer Opera browsers support posting erros to their consoles.
//            try {
//                opera.postError(args);
//                return true;
//            }
//            catch (e) {
//            }
//        }

//        // Catch all; a good old alert box.
//        //alert(args);
//        return false;
//    }
//}



/*********************************************************************************** Caching Script ***********************************************************************************/


var CacheSettings = {
    AppID: '',
    PageID: '',
    PageTitle: '',
    PageTitle_Ar: '',
    PagePath: '',
    PagePath_AR: '',
    CacheEnabled: false,
    CacheExpiryInterval: '',
    OnCallSuccessAction: '',
    OnCallFailureAction: '',
    ShowDateTimeStamp: '',
    ShowDataMode: '',
    RefreshAnimationMode: '',
    StaticPageID: '',
    AmimationDivId: '',
    DataSourceAndDependents: '',
    PageType: '',
    DataSignatureEnabled: false,
    EmbeddedOnDevice: false,
    CustomCallFlag: false,
    CustomCallFunction: '',
    CodeBehindJSPath: '',
    CodeBehindJSClassName: '',
    PageHasJS: false,
    PageHasHTML: true,
    SubPageID: '',
    WidgetID: ''
}


function replaceAll(txt, replace, with_this) {
    return txt.replace(new RegExp(replace, 'g'), with_this);
}

var CacheSettingsArr = {};
var CacheSettingsArrr = {};
var CacheSettingsArrWithURL = {};
function HandleCacheSettingsXML(CacheSettingsXML) {
    try {
        CacheSettingsXML = replaceAll(CacheSettingsXML, '>NULL<', '><');
        //alert(CacheSettingsXML);
        var xml = $(CacheSettingsXML);
        xml.find("CacheSettings").each(function () {
            var $CacheSettingRow = $(this);

            var CacheSettingsObj = new CacheSettings.constructor();
            CacheSettingsObj.AppID = $CacheSettingRow.find("AppID").first().text();
            CacheSettingsObj.PageID = $CacheSettingRow.find("PageID").first().text();
            CacheSettingsObj.PageTitle = $CacheSettingRow.find("PageTitle").first().text();
            CacheSettingsObj.PageTitle_Ar = $CacheSettingRow.find("PageTitle_Ar").first().text();
            CacheSettingsObj.PagePath = $CacheSettingRow.find("PagePath").first().text();
            CacheSettingsObj.PagePath_AR = $CacheSettingRow.find("PagePath_AR").first().text();
            CacheSettingsObj.CacheEnabled = returnBoolean($CacheSettingRow.find("CacheEnabled").first().text());
            CacheSettingsObj.CacheExpiryInterval = $CacheSettingRow.find("CacheExpiryInterval").first().text();
            CacheSettingsObj.OnCallSuccessAction = $CacheSettingRow.find("OnCallSuccessAction").first().text();
            CacheSettingsObj.OnCallFailureAction = $CacheSettingRow.find("OnCallFailureAction").first().text();
            CacheSettingsObj.ShowDateTimeStamp = $CacheSettingRow.find("ShowDateTimeStamp").first().text();
            CacheSettingsObj.ShowDataMode = $CacheSettingRow.find("ShowDataMode").first().text();
            CacheSettingsObj.RefreshAnimationMode = $CacheSettingRow.find("RefreshAnimationMode").first().text();
            CacheSettingsObj.StaticPageID = $CacheSettingRow.find("StaticPageID").first().text();
            CacheSettingsObj.AmimationDivId = $CacheSettingRow.find("AmimationDivId").first().text();
            CacheSettingsObj.DataSourceAndDependents = $CacheSettingRow.find("DataSourceAndDependents").first().text();
            CacheSettingsObj.PageType = $CacheSettingRow.find("PageType").first().text();
            CacheSettingsObj.DataSignatureEnabled = returnBoolean($CacheSettingRow.find("DataSignatureEnabled").first().text());
            CacheSettingsObj.EmbeddedOnDevice = returnBoolean($CacheSettingRow.find("EmbeddedOnDevice").first().text());
            CacheSettingsObj.CustomCallFlag = returnBoolean($CacheSettingRow.find("CustomCallFlag").first().text());
            CacheSettingsObj.CustomCallFunction = $CacheSettingRow.find("CustomCallFunction").first().text();
            CacheSettingsObj.SubPageID = $CacheSettingRow.find("SubPageID").first().text();
            CacheSettingsObj.WidgetID = $CacheSettingRow.find("WidgetID").first().text();
            try {
                CacheSettingsObj.CodeBehindJSPath = $CacheSettingRow.find("CodeBehindJSPath").first().text();
                CacheSettingsObj.CodeBehindJSClassName = $CacheSettingRow.find("CodeBehindJSClassName").first().text();

                if (CacheSettingsObj.CodeBehindJSPath != null && CacheSettingsObj.CodeBehindJSPath != undefined && (CacheSettingsObj.CodeBehindJSPath + '').trim() != '') {
                    CacheSettingsObj.PageHasJS = true;
                    //                    if (CacheSettingsObj.CodeBehindJSClassName == null || CacheSettingsObj.CodeBehindJSClassName == undefined || (CacheSettingsObj.CodeBehindJSClassName + '').trim() == '')
                    //                        CacheSettingsObj.CodeBehindJSClassName = CacheSettingsObj.PageID;
                }
                else {
                    CacheSettingsObj.PageHasJS = false;
                }
                if ((CacheSettingsObj.PagePath == undefined || CacheSettingsObj.PagePath == null || (CacheSettingsObj.PagePath + '').trim() == '') &&
                    (CacheSettingsObj.PagePath_AR == undefined || CacheSettingsObj.PagePath_AR == null || (CacheSettingsObj.PagePath_AR + '').trim() == '')) {
                    CacheSettingsObj.PageHasHTML = false;
                    if (CacheSettingsObj.PageHasJS) {
                        log(CacheSettingsObj.PageID + ': Overriding CacheSettingsObj.PagePath, CacheSettingsObj.PagePath_AR with CacheSettingsObj.CodeBehindJSPath: ' + CacheSettingsObj.CodeBehindJSPath);
                        CacheSettingsObj.PagePath = CacheSettingsObj.PagePath_AR = CacheSettingsObj.CodeBehindJSPath;
                    }
                } else {
                    CacheSettingsObj.PageHasHTML = true;
                }
            } catch (e) {
                log(e);
            }
            CacheSettingsArr[CacheSettingsObj.PageID] = CacheSettingsObj;
            CacheSettingsArrr[CacheSettingsObj.WidgetID] = CacheSettingsObj;
            try { CacheSettingsArrWithURL[CacheSettingsObj.PagePath] = CacheSettingsObj; } catch (e) { }
            try { CacheSettingsArrWithURL[CacheSettingsObj.PagePath_AR] = CacheSettingsObj; } catch (e) { }
            try { CacheSettingsArrWithURL[CacheSettingsObj.CodeBehindJSPath] = CacheSettingsObj; } catch (e) { }
            //log(CacheSettingsArr[CacheSettingsObj.PageID]);
        });
        var CeepId = GetActiveSubPageID() + "_" + "GetCeepContent";
        CacheSettingsArr[CeepId] = new CacheSettings.constructor();
        CacheSettingsArr[CeepId].CodeBehindJSClassName = "GetCeepContent";
        CacheSettingsArr[CeepId].CodeBehindJSPath = "GetCeepContent/GetCeepContentAction.js";
        CacheSettingsArr[CeepId].PageID = CeepId;
        CacheSettingsArr[CeepId].PageHasHTML = false;
        CacheSettingsArr[CeepId].PageHasJS = true;
        CacheSettingsArr[CeepId].PagePath = "GetCeepContent/GetCeepContentAction.js";
        CacheSettingsArr[CeepId].PagePath_AR = "GetCeepContent/GetCeepContentAction.js";
        CacheSettingsArr[CeepId].CacheEnabled = true;
        CacheSettingsArr[CeepId].CacheExpiryInterval = "525600";
        CacheSettingsArr[CeepId].ShowDataMode = "ShowFromCacheAndRefreshWhenCacheIsExpired";
        CacheSettingsArr[CeepId].ShowDateTimeStamp = "No";
        CacheSettingsArr[CeepId].RefreshAnimationMode = "none";
        CacheSettingsArr[CeepId].OnCallFailureAction = "";
        CacheSettingsArr[CeepId].OnCallSuccessAction = "";
        CacheSettingsArr[CeepId].CustomCallFunction = "";
        CacheSettingsArr[CeepId].CustomCallFlag = false;
        CacheSettingsArr[CeepId].DataSignatureEnabled = false;
        CacheSettingsArr[CeepId].DataSourceAndDependents = "";
        CacheSettingsArr[CeepId].DataSignatureEnabled = false;
        CacheSettingsArr[CeepId].EmbeddedOnDevice = true;
        CacheSettingsArr[CeepId].PageType = "";
        CacheSettingsArr[CeepId].PageTitle = "";
        CacheSettingsArr[CeepId].PageTitle_Ar = "";
        CacheSettingsArr[CeepId].StaticPageID = "";
        CacheSettingsArr[CeepId].AppID = "";
        try { CacheSettingsArrWithURL[CacheSettingsArr[CeepId].PagePath] = CacheSettingsArr[CeepId]; } catch (e) { }
        try { CacheSettingsArrWithURL[CacheSettingsArr[CeepId].PagePath_AR] = CacheSettingsArr[CeepId]; } catch (e) { }
        try { CacheSettingsArrWithURL[CacheSettingsArr[CeepId].CodeBehindJSPath] = CacheSettingsArr[CeepId]; } catch (e) { }
        for (var key in CacheSettingsArr) {
            //GetPageHTML(CacheSettingsArr[key].PageID, '', false, false);
            //GetPageHTMLThenDisplayDialog(PageId, PostData, GetFreshDataFromServer, SkipSettingCache, AdditionalSuccessCallBack, AdditionalFailureCallBack);

            try {
                //GetPageHTMLThenDisplayDialog(CacheSettingsArr[key].PageID, '','90%', false, false, '', '');

            } catch (e) {
                alert(e);
            }
            break;
        }
    } catch (e) {
        //alert(e);
        logErr(e.StackTrace);
    }
}
/********************************************************************************** Header Script *************************************************************************************/
var HeaderDetails = {
    ContentID: '',
    HeaderID: '',
    HeaderTitle: '',
    HeaderTitle_PostLogin: '',
    HeaderTitle_AR: '',
    HeaderTitle_AR_PostLogin: '',
    HeaderTitleStyleClassName: '',
    HeaderTitleStyleClassName_PostLogin: '',
    HeaderButtonsGroupID: '',
    HeaderButtonsGroupID_PostLogin: '',
    AppID: '',
    HeaderContentType: '',
    LeftPartCssClass: '',
    LeftPartCssClass_PostLogin: '',
    RightPartCssClass: '',
    RightPartCssClass_PostLogin: ''
};

var HeaderDetailsArr = new Array();

function HandleHeaderDetails(HeaderDetailsHTMl) {
    try {
        HeaderDetailsHTMl = replaceAll(HeaderDetailsHTMl, '>NULL<', '><');
        var xml = $(HeaderDetailsHTMl);
        xml.find("AppHeaders").each(function () {
            var $HeaderDetailsRow = $(this);
            var HeaderDetailsObj = new HeaderDetails.constructor();
            HeaderDetailsObj.ContentID = $HeaderDetailsRow.find("ContentID").text();
            HeaderDetailsObj.HeaderID = $HeaderDetailsRow.find("HeaderID").text();
            HeaderDetailsObj.HeaderTitle = $HeaderDetailsRow.find("HeaderTitle").text();
            HeaderDetailsObj.HeaderTitle_PostLogin = $HeaderDetailsRow.find("HeaderTitle_PostLogin").text();
            HeaderDetailsObj.HeaderTitle_AR = $HeaderDetailsRow.find("HeaderTitle_AR").text();
            HeaderDetailsObj.HeaderTitle_AR_PostLogin = $HeaderDetailsRow.find("HeaderTitle_AR_PostLogin").text();
            HeaderDetailsObj.HeaderTitleStyleClassName = $HeaderDetailsRow.find("HeaderTitleStyleClassName").text();
            HeaderDetailsObj.HeaderTitleStyleClassName_PostLogin = $HeaderDetailsRow.find("HeaderTitleStyleClassName_PostLogin").text();
            HeaderDetailsObj.HeaderButtonsGroupID = $HeaderDetailsRow.find("HeaderButtonsGroupID").text();
            HeaderDetailsObj.HeaderButtonsGroupID_PostLogin = $HeaderDetailsRow.find("HeaderButtonsGroupID_PostLogin").text();
            HeaderDetailsObj.AppID = $HeaderDetailsRow.find("AppID").text();
            HeaderDetailsObj.HeaderContentType = $HeaderDetailsRow.find("HeaderContentType").text();
            HeaderDetailsObj.LeftPartCssClass = $HeaderDetailsRow.find("LeftPartCssClassName").text();
            HeaderDetailsObj.LeftPartCssClass_PostLogin = $HeaderDetailsRow.find("LeftPartCssClassName_PostLogin").text();
            HeaderDetailsObj.RightPartCssClass = $HeaderDetailsRow.find("RightPartCssClassName").text();
            HeaderDetailsObj.RightPartCssClass_PostLogin = $HeaderDetailsRow.find("RightPartCssClassName_PostLogin").text();
            HeaderDetailsObj.PageID = $HeaderDetailsRow.find("PageID").text();

            HeaderDetailsArr[HeaderDetailsObj.PageID] = HeaderDetailsObj;
        });
    } catch (e) {
        log(e);
    }
}

var HeaderButtonsDetails = {
    ContentID: '',
    ButtonsGroupID: '',
    ButtonsGroupID_PostLogin: '',
    ButtonID: '',
    ButtonPosition: '',
    ButtonSeqOrderNo: '',
    ButtonEnabled: '',
    ButtonActionFunctionName: '',
    ButtonStyleClassName: '',
    ButtonTitle: '',
    ButtonTitle_AR: '',
    AppID: '',
    IconPath: '',
    IconCssClass: ''
};

var HeaderButtonsArr = new Array();
var HeaderButtonsArr_PostLogin = new Array();

function HandleHeaderButtonsDetails_PostLogin(ButtonsDetailsHTML) {
    try {
        if ($.trim(ButtonsDetailsHTML) == "") {
            return;
        }
        var counter = 0;
        ButtonsDetailsHTML = replaceAll(ButtonsDetailsHTML, '>NULL<', '><');
        var xml = $(ButtonsDetailsHTML);
        xml.find("HeaderButtonsDetails_PostLogin").each(function () {
            var $ButtonsDetailsRow = $(this);
            var ButtonsDetailsObj = new HeaderButtonsDetails.constructor();
            ButtonsDetailsObj.ContentID = $ButtonsDetailsRow.find("ContentID").text();
            ButtonsDetailsObj.ButtonID = $ButtonsDetailsRow.find("HeaderButtonID").text();
            ButtonsDetailsObj.ButtonPosition = $ButtonsDetailsRow.find("HeaderButtonPosition").text();
            ButtonsDetailsObj.ButtonSeqOrderNo = $ButtonsDetailsRow.find("ButtonSeqOrderNoFromLeftTORight").text();
            ButtonsDetailsObj.ButtonEnabled = $ButtonsDetailsRow.find("HeaderButtonEnabled").text();
            ButtonsDetailsObj.ButtonActionFunctionName = $ButtonsDetailsRow.find("HeaderButtonActionFunctionName").text();
            ButtonsDetailsObj.ButtonStyleClassName = $ButtonsDetailsRow.find("HeaderButtonStyleClassName").text();
            ButtonsDetailsObj.ButtonTitle = $ButtonsDetailsRow.find("HeaderButtonTitle").text();
            ButtonsDetailsObj.ButtonTitle_AR = $ButtonsDetailsRow.find("HeaderButtonTitle_AR").text();
            ButtonsDetailsObj.AppID = $ButtonsDetailsRow.find("AppID").text();
            ButtonsDetailsObj.IconPath = $ButtonsDetailsRow.find("ButtonIConPath").text();
            ButtonsDetailsObj.IconCssClass = $ButtonsDetailsRow.find("IconCssClass").text();
            ButtonsDetailsObj.ButtonsGroupID_PostLogin = $ButtonsDetailsRow.find("HeaderButtonsGroupID_PostLogin").text();
            ButtonsDetailsObj.ButtonsGroupID = "";

            HeaderButtonsArr_PostLogin[counter] = ButtonsDetailsObj;
            counter++;
        });
    } catch (e) {
    }
}

function HandleHeaderButtonsDetails(ButtonsDetailsHTML) {
    try {
        if ($.trim(ButtonsDetailsHTML) == "") {
            return;
        }
        var counter = 0;
        ButtonsDetailsHTML = replaceAll(ButtonsDetailsHTML, '>NULL<', '><');
        var xml = $(ButtonsDetailsHTML);
        xml.find("HeaderButtonsDetails").each(function () {
            var $ButtonsDetailsRow = $(this);
            var ButtonsDetailsObj = new HeaderButtonsDetails.constructor();
            ButtonsDetailsObj.ContentID = $ButtonsDetailsRow.find("ContentID").text();
            ButtonsDetailsObj.ButtonID = $ButtonsDetailsRow.find("HeaderButtonID").text();
            ButtonsDetailsObj.ButtonPosition = $ButtonsDetailsRow.find("HeaderButtonPosition").text();
            ButtonsDetailsObj.ButtonSeqOrderNo = $ButtonsDetailsRow.find("ButtonSeqOrderNoFromLeftTORight").text();
            ButtonsDetailsObj.ButtonEnabled = $ButtonsDetailsRow.find("HeaderButtonEnabled").text();
            ButtonsDetailsObj.ButtonActionFunctionName = $ButtonsDetailsRow.find("HeaderButtonActionFunctionName").text();
            ButtonsDetailsObj.ButtonStyleClassName = $ButtonsDetailsRow.find("HeaderButtonStyleClassName").text();
            ButtonsDetailsObj.ButtonTitle = $ButtonsDetailsRow.find("HeaderButtonTitle").text();
            ButtonsDetailsObj.ButtonTitle_AR = $ButtonsDetailsRow.find("HeaderButtonTitle_AR").text();
            ButtonsDetailsObj.AppID = $ButtonsDetailsRow.find("AppID").text();
            ButtonsDetailsObj.IconPath = $ButtonsDetailsRow.find("ButtonIConPath").text();
            ButtonsDetailsObj.IconCssClass = $ButtonsDetailsRow.find("IconCssClass").text();
            ButtonsDetailsObj.ButtonsGroupID = $ButtonsDetailsRow.find("HeaderButtonsGroupID").text();
            ButtonsDetailsObj.ButtonsGroupID_PostLogin = "";
            HeaderButtonsArr[counter] = ButtonsDetailsObj;
            counter++;
        });
    } catch (e) {
    }
};

function DrawHeader(WidgetID, PostLoginHeader) {
    try {
        $('.HeaderClass').hide();
        $('.Header').hide();
        var HeaderObj = HeaderDetailsArr[WidgetID];
        var AllBtnsRightHTML = "";
        var AllBtnsLefttHTML = "";
        var HeaderBtnTemplate = "";
        var HeaderTemplate = "";
        if (isTablet) {
            var HeaderTemplate = "<div id='#HeaderID#' class='Header'><div id='LeftBtnsTdID' class='#LeftPartCssClass#'>#LeftBtnsTemplate#</div><div id='TitleTdID' class='#ClassName#'><div class='DisplayInlineBlock'>#Title#</div></div><div id='RightBtnsTdID' class='#RightPartCssClass#'>#RightBtnsTemplate#</div></div>";
        } //<img src='../CA/Images/TabletLogo.png' class='HeaderLogo'/>
        else {
            HeaderTemplate = "<div id='#HeaderID#' class='Header'><div id='LeftBtnsTdID' class='#LeftPartCssClass#'>#LeftBtnsTemplate#</div><div id='TitleTdID' class='#ClassName#'><div class='DisplayInlineBlock'>#Title#</div></div><div id='RightBtnsTdID' class='#RightPartCssClass#'>#RightBtnsTemplate#</div></div>";
        }

        if (HeaderObj == undefined) {
            return "";
        }
        //$('#PageHeader').css('height', $('#HeaderContent').height() + 'px');
        //alert($('#HeaderContent').height());
        HeaderTemplate = HeaderTemplate.replace("#HeaderID#", HeaderObj.HeaderID);

        if (PostLoginHeader) {

            if (AppLang.toUpperCase() == "EN") {
                HeaderTemplate = HeaderTemplate.replace("#Title#", HeaderObj.HeaderTitle_PostLogin);
            }
            else {
                HeaderTemplate = HeaderTemplate.replace("#Title#", HeaderObj.HeaderTitle_AR_PostLogin);
            }

            HeaderTemplate = HeaderTemplate.replace("#ClassName#", HeaderObj.HeaderTitleStyleClassName_PostLogin);
            HeaderTemplate = HeaderTemplate.replace("#LeftPartCssClass#", HeaderObj.LeftPartCssClass_PostLogin);
            HeaderTemplate = HeaderTemplate.replace("#RightPartCssClass#", HeaderObj.RightPartCssClass_PostLogin);

            for (var i = 0; i < HeaderButtonsArr_PostLogin.length; i++) {
                if (HeaderButtonsArr_PostLogin[i].ButtonsGroupID_PostLogin == HeaderObj.HeaderButtonsGroupID_PostLogin && HeaderButtonsArr_PostLogin[i].ButtonEnabled == "true" && HeaderButtonsArr_PostLogin[i].ContentID == WidgetID) {
                    if (HeaderButtonsArr_PostLogin[i].IconPath != "none") {
                        HeaderBtnTemplate = "<div id='#BtnID#'><div onclick=\"#BtnActionFunction#\"><img src='#BtnIconPath#' class='#BtnIconClass#' /><div class='#BtnClassName#' ><div id='#BtnTitleContentDivID#'>#BtnTitle#</div></div></div></div>";
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnIconPath#", HeaderButtonsArr_PostLogin[i].IconPath);
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnIconClass#", HeaderButtonsArr_PostLogin[i].IconCssClass);
                    }
                    else {
                        HeaderBtnTemplate = "<div id='#BtnID#'><div onclick=\"#BtnActionFunction#\"><div class='#BtnClassName#'><div id='#BtnTitleContentDivID#'>#BtnTitle#</div></div></div></div>";
                    }

                    if (AppLang.toUpperCase() == "EN") {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnTitle#", HeaderButtonsArr_PostLogin[i].ButtonTitle);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnTitle#", HeaderButtonsArr_PostLogin[i].ButtonTitle_AR);
                    }

                    if (HeaderButtonsArr_PostLogin[i].ButtonStyleClassName != null) {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnClassName#", HeaderButtonsArr_PostLogin[i].ButtonStyleClassName);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnClassName#", "");
                    }

                    if (HeaderButtonsArr_PostLogin[i].ButtonActionFunctionName != null) {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnActionFunction#", HeaderButtonsArr_PostLogin[i].ButtonActionFunctionName);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnActionFunction#", "");
                    }

                    HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnID#", HeaderButtonsArr_PostLogin[i].ButtonID).replace("#BtnTitleContentDivID#", HeaderButtonsArr_PostLogin[i].ButtonID + "ContentDiv");

                    if (HeaderButtonsArr_PostLogin[i].ButtonPosition.toUpperCase() == "RIGHT") {
                        AllBtnsRightHTML += HeaderBtnTemplate;
                    }
                    else {
                        AllBtnsLefttHTML += HeaderBtnTemplate;
                    }
                }
            }
        }
        else {

            if (AppLang.toUpperCase() == "EN") {
                HeaderTemplate = HeaderTemplate.replace("#Title#", HeaderObj.HeaderTitle);
            }
            else {
                HeaderTemplate = HeaderTemplate.replace("#Title#", HeaderObj.HeaderTitle_AR);
            }

            HeaderTemplate = HeaderTemplate.replace("#ClassName#", HeaderObj.HeaderTitleStyleClassName);
            HeaderTemplate = HeaderTemplate.replace("#LeftPartCssClass#", HeaderObj.LeftPartCssClass);
            HeaderTemplate = HeaderTemplate.replace("#RightPartCssClass#", HeaderObj.RightPartCssClass);

            for (var i = 0; i < HeaderButtonsArr.length; i++) {

                if (HeaderButtonsArr[i].ButtonsGroupID == HeaderObj.HeaderButtonsGroupID && HeaderButtonsArr[i].ButtonEnabled == "true" && HeaderButtonsArr[i].ContentID == HeaderDetailsArr[WidgetID].ContentID && HeaderButtonsArr[i].ZoneID == HeaderDetailsArr[WidgetID].ZoneID) {
                    if (HeaderButtonsArr[i].IconPath != "none") {
                        HeaderBtnTemplate = "<div id='#BtnID#'><center><div onclick=\"#BtnActionFunction#\"><img src='#BtnIconPath#' class='#BtnIconClass#' /><div class='#BtnClassName#' ><div id='#BtnTitleContentDivID#'>#BtnTitle#</div></div></div></center></div>";
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnIconPath#", HeaderButtonsArr[i].IconPath);
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnIconClass#", HeaderButtonsArr[i].IconCssClass);
                    }
                    else {
                        HeaderBtnTemplate = "<div id='#BtnID#'><center><div onclick=\"#BtnActionFunction#\"><img src='#BtnIconPath#' class='#BtnIconClass#' /><div class='#BtnClassName#' ><div id='#BtnTitleContentDivID#'>#BtnTitle#</div></div></div></center></div>";
                    }

                    if (AppLang.toUpperCase() == "EN") {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnTitle#", HeaderButtonsArr[i].ButtonTitle);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnTitle#", HeaderButtonsArr[i].ButtonTitle_AR);
                    }

                    if (HeaderButtonsArr[i].ButtonStyleClassName != null) {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnClassName#", HeaderButtonsArr[i].ButtonStyleClassName);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnClassName#", "");
                    }

                    if (HeaderButtonsArr[i].ButtonActionFunctionName != null) {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnActionFunction#", HeaderButtonsArr[i].ButtonActionFunctionName);
                    }
                    else {
                        HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnActionFunction#", "");
                    }

                    HeaderBtnTemplate = HeaderBtnTemplate.replace("#BtnID#", HeaderButtonsArr[i].ButtonID).replace("#BtnTitleContentDivID#", HeaderButtonsArr[i].ButtonID + "ContentDiv");

                    if (HeaderButtonsArr[i].ButtonPosition.toUpperCase() == "RIGHT") {
                        AllBtnsRightHTML += HeaderBtnTemplate;
                    }
                    else {
                        AllBtnsLefttHTML += HeaderBtnTemplate;
                    }
                }
            }

        }

        HeaderTemplate = HeaderTemplate.replace("#RightBtnsTemplate#", AllBtnsRightHTML);
        HeaderTemplate = HeaderTemplate.replace("#LeftBtnsTemplate#", AllBtnsLefttHTML);
        $('#HeaderContent').html(HeaderTemplate);
        $('#HeaderContent').show();
        $('#ALLPageContent').trigger('click');
    } catch (e) {
        log('+_+_+_+_+_+_+_+_+_+_+_+_+_+_+ Exception in DrawHeader' + e);
    }
    HandleContentPanelTopMargin();
}

/********************************************************************************** Menu Script **************************************************************************************/

var MenusDetails = {
    MenuID: "",
    ContentID: "",
    EnableMenu: '',
    EnableMenu_PostLogin: '',
    AppID: "",
    MenuType: "",
    UsedJStoDrawMenu: "",
    MenuButtonImgPath: "",
    MenuButtonImgPath_AR: '',
    Position: "",
    CssClassName: "",
    MenuItemsGroupID: "",
    MenuItemsGroupID_PostLogin: "",
    MenuType_PostLogin: "",
    UsedJStoDrawMenu_PostLogin: "",
    MenuButtonImgPath_PostLogin: "",
    MenuButtonImgPath_PostLogin_AR: "",
    Position_PostLogin: "",
    CssClassName_PostLogin: "",
    MenuBtnCssClassName: '',
    MenuBtnCssClassName_PostLogin: ''
};

var MenuItemsDetails = {
    MenuID: '',
    MenuItemID: '',
    ContentID: '',
    AppID: '',
    MenuItemClass: '',
    MenuItemSeqNo: '',
    MenuItemTitle: '',
    MenuItemTitle_AR: '',
    MenuItemAdditionalFunction: '',
    ListIDstoBeShown: '',
    ListIDstoBeRefreshed: '',
    PostData: '',
    ListIDstoBeHidden: '',
    MenuItemGroupID: '',
    MenuItemGroupID_PostLogin: '',
    ItemIconPath: '',
    IconCssClass: ''
};

var MenuDetailsArr = new Array();
var MenuItemsDetailsArr = new Array();
var MenuItemsDetailsArr_PostLogin = new Array();

function HandleMenuItemsDetails(MenuItemsDetailsHTML) {
    try {
        if ($.trim(MenuItemsDetailsHTML) == "") {
            return;
        }
        var counter = 0;
        MenuItemsDetailsHTML = replaceAll(MenuItemsDetailsHTML, '>NULL<', '><');
        var xml = $(MenuItemsDetailsHTML);
        xml.find("MenuItemsDetails").each(function () {
            var $ItemsDetailsRow = $(this);
            var ItemsDetailsObj = new MenuItemsDetails.constructor();
            ItemsDetailsObj.MenuID = $ItemsDetailsRow.find("MenuID").text();
            ItemsDetailsObj.MenuItemID = $ItemsDetailsRow.find("MenuItemID").text();
            ItemsDetailsObj.ContentID = $ItemsDetailsRow.find("ContentID").text();
            ItemsDetailsObj.AppID = $ItemsDetailsRow.find("AppID").text();
            ItemsDetailsObj.MenuItemClass = $ItemsDetailsRow.find("MenuItemStyleClassName").text();
            ItemsDetailsObj.MenuItemSeqNo = $ItemsDetailsRow.find("MenuItemSeqOrderNo").text();
            ItemsDetailsObj.MenuItemTitle = $ItemsDetailsRow.find("MenuItemTitle").text();
            ItemsDetailsObj.MenuItemTitle_AR = $ItemsDetailsRow.find("MenuItemTitle_AR").text();
            ItemsDetailsObj.MenuItemAdditionalFunction = $ItemsDetailsRow.find("MenuItemAdditionalActionFunctionName").text();
            ItemsDetailsObj.ListIDstoBeShown = $ItemsDetailsRow.find("ListIDstobeShown").text();
            ItemsDetailsObj.ListIDstoBeRefreshed = $ItemsDetailsRow.find("ListIDstobeRefreshed").text();
            ItemsDetailsObj.PostData = $ItemsDetailsRow.find("PostData").text();
            ItemsDetailsObj.ListIDstoBeHidden = $ItemsDetailsRow.find("ListIDstobeHidden").text();
            ItemsDetailsObj.MenuItemGroupID = $ItemsDetailsRow.find("MenuItemGroupID").text();
            ItemsDetailsObj.ItemIconPath = $ItemsDetailsRow.find("ItemIconPath").text();
            ItemsDetailsObj.IconCssClass = $ItemsDetailsRow.find("IconCssClass").text();
            MenuItemsDetailsArr[counter] = ItemsDetailsObj;
            counter++;
        });
    } catch (e) {
    }
};

function HandleMenuItemsDetails_PostLogin(MenuItemsDetailsHTML) {
    try {
        if ($.trim(MenuItemsDetailsHTML) == "") {
            return;
        }
        var counter = 0;
        MenuItemsDetailsHTML = replaceAll(MenuItemsDetailsHTML, '>NULL<', '><');
        var xml = $(MenuItemsDetailsHTML);
        xml.find("MenuItemsDetails_PostLogin").each(function () {
            var $ItemsDetailsRow = $(this);
            var ItemsDetailsObj = new MenuItemsDetails.constructor();
            ItemsDetailsObj.MenuID = $ItemsDetailsRow.find("MenuID").text();
            ItemsDetailsObj.MenuItemID = $ItemsDetailsRow.find("MenuItemID").text();
            ItemsDetailsObj.ContentID = $ItemsDetailsRow.find("ContentID").text();
            ItemsDetailsObj.AppID = $ItemsDetailsRow.find("AppID").text();
            ItemsDetailsObj.MenuItemClass = $ItemsDetailsRow.find("MenuItemStyleClassName").text();
            ItemsDetailsObj.MenuItemSeqNo = $ItemsDetailsRow.find("MenuItemSeqOrderNo").text();
            ItemsDetailsObj.MenuItemTitle = $ItemsDetailsRow.find("MenuItemTitle").text();
            ItemsDetailsObj.MenuItemTitle_AR = $ItemsDetailsRow.find("MenuItemTitle_AR").text();
            ItemsDetailsObj.MenuItemAdditionalFunction = $ItemsDetailsRow.find("MenuItemAdditionalActionFunctionName").text();
            ItemsDetailsObj.ListIDstoBeShown = $ItemsDetailsRow.find("ListIDstobeShown").text();
            ItemsDetailsObj.ListIDstoBeRefreshed = $ItemsDetailsRow.find("ListIDstobeRefreshed").text();
            ItemsDetailsObj.PostData = $ItemsDetailsRow.find("PostData").text();
            ItemsDetailsObj.ListIDstoBeHidden = $ItemsDetailsRow.find("ListIDstobeHidden").text();
            ItemsDetailsObj.MenuItemGroupID_PostLogin = $ItemsDetailsRow.find("MenuItemGroupID_PostLogin").text();
            ItemsDetailsObj.ItemIconPath = $ItemsDetailsRow.find("ItemIconPath").text();
            ItemsDetailsObj.IconCssClass = $ItemsDetailsRow.find("IconCssClass").text();
            MenuItemsDetailsArr_PostLogin[counter] = ItemsDetailsObj;
            counter++;
        });
    } catch (e) {
    }
};

function HandleMenusDetails(MenusDetailsHTML) {
    try {
        if ($.trim(MenusDetailsHTML) == "") {
            return;
        }
        MenusDetailsHTML = replaceAll(MenusDetailsHTML, '>NULL<', '><');
        var xml = $(MenusDetailsHTML);
        xml.find("AppMenus").each(function () {
            var $MenuDetailsRow = $(this);
            var MenuDetailsObj = new MenusDetails.constructor();
            MenuDetailsObj.ContentID = $MenuDetailsRow.find("ContentID").text();
            MenuDetailsObj.EnableMenu = $MenuDetailsRow.find("EnableMenu").text();
            MenuDetailsObj.EnableMenu_PostLogin = $MenuDetailsRow.find("EnableMenu_PostLogin").text();
            MenuDetailsObj.MenuID = $MenuDetailsRow.find("MenuID").text();
            MenuDetailsObj.AppID = $MenuDetailsRow.find("AppID").text();
            MenuDetailsObj.MenuType = $MenuDetailsRow.find("MenuType").text();
            MenuDetailsObj.UsedJStoDrawMenu = $MenuDetailsRow.find("UsedJStoDrawMenu").text();
            MenuDetailsObj.MenuButtonImgPath = $MenuDetailsRow.find("MenuButtonImgPath").text();
            MenuDetailsObj.MenuButtonImgPath_AR = $MenuDetailsRow.find("MenuButtonImgPath_AR").text();
            MenuDetailsObj.Position = $MenuDetailsRow.find("Position").text();
            MenuDetailsObj.CssClassName = $MenuDetailsRow.find("CssClassName").text();
            MenuDetailsObj.MenuItemsGroupID = $MenuDetailsRow.find("MenuItemsGroupID").text();
            MenuDetailsObj.MenuItemsGroupID_PostLogin = $MenuDetailsRow.find("MenuItemsGroupID_PostLogin").text();
            MenuDetailsObj.MenuType_PostLogin = $MenuDetailsRow.find("MenuType_PostLogin").text();
            MenuDetailsObj.UsedJStoDrawMenu_PostLogin = $MenuDetailsRow.find("UsedJStoDrawMenu_PostLogin").text();
            MenuDetailsObj.MenuButtonImgPath_PostLogin = $MenuDetailsRow.find("MenuButtonImgPath_PostLogin").text();
            MenuDetailsObj.MenuButtonImgPath_PostLogin_AR = $MenuDetailsRow.find("MenuButtonImgPath_PostLogin_AR").text();
            MenuDetailsObj.Position_PostLogin = $MenuDetailsRow.find("Position_PostLogin").text();
            MenuDetailsObj.CssClassName_PostLogin = $MenuDetailsRow.find("CssClassName_PostLogin").text();
            MenuDetailsObj.MenuBtnCssClassName = $MenuDetailsRow.find("MenuBtnCssClassName").text();
            MenuDetailsObj.MenuBtnCssClassName_PostLogin = $MenuDetailsRow.find("MenuBtnCssClassName_PostLogin").text();

            MenuDetailsArr[MenuDetailsObj.ContentID] = MenuDetailsObj;
        });

    } catch (e) {

    }
}

var counter = 0;
var MenuWithBtnPositionTop = true;
var MenuWithBtnType = false;
/*
function DrawMenuItems(ContentID, PostLoginMenu, NoOfItemsAtScreen, withPaddingSpace) {
    try {
        $('#footerPanel').hide();
        var UlHTML = "";
        counter = 0;
        var MenuObj = MenuDetailsArr[ContentID];
        var LiHTML = "";
        var ALLLIHTML = "";
        var TempLi = "";
        var PositionTop = false;
        var ButtonHTML = "";
        MenuWithBtnType = false;

        if (MenuObj == undefined) {
            return;
        }

        if (withPaddingSpace == undefined) {
            withPaddingSpace = true;
        }

        if (PostLoginMenu) {

            if (MenuObj.MenuItemsGroupID_PostLogin == "none" || MenuObj.MenuItemsGroupID_PostLogin == null || MenuObj.EnableMenu_PostLogin.toLowerCase() == "false") {
                return;
            }

            if (MenuObj.Position_PostLogin.toLowerCase() == "top") {
                PositionTop = true;
            }

            for (var i = 0; i < MenuItemsDetailsArr_PostLogin.length; i++) {

                if (MenuObj.MenuItemsGroupID_PostLogin == MenuItemsDetailsArr_PostLogin[i].MenuItemGroupID_PostLogin) {
                    counter++;
                    if (MenuItemsDetailsArr_PostLogin[i].ItemIconPath != "none") {
                        if (counter == 1) {
                            //   localStorage.setItem("ActiveItem", MenuItemsDetailsArr_PostLogin[i].MenuItemID);
                            if (MenuObj.MenuType_PostLogin == "Menu2") {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='MenuItemCssClass'><table style='width:100%; height:100%;'><tr><td class='#TabClassName# iicon'>#TabName#<img src='#imgSRC#' class='#IconClassName#'/> <div class='arrow-down 1'></div></td></tr></table></li>"
                            }
                            else {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='arrow-down 1'></div><img src='#imgSRC#' class='#IconClassName#'/></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                            }
                        }
                        else {
                            if (MenuObj.MenuType_PostLogin == "Menu2") {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='MenuItemCssClass'><table style='width:100%; height:100%;'><tr><td class='#TabClassName# iicon'>#TabName#<img src='#imgSRC#' class='#IconClassName#'/><div class='UnselectedItems " + counter + "'></div></td></tr></table></li>"
                            }
                            else {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='UnselectedItems " + counter + "'></div><img src='#imgSRC#' class='#IconClassName#'/></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                            }
                        }
                        TempLi = TempLi.replace("#imgSRC#", MenuItemsDetailsArr_PostLogin[i].ItemIconPath).replace("#IconClassName#", MenuItemsDetailsArr_PostLogin[i].IconCssClass)
                    } else {
                        if (counter == 1) {
                            //   localStorage.setItem("ActiveItem", MenuItemsDetailsArr_PostLogin[i].MenuItemID);
                            TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='arrow-down 1'></div></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                        }
                        else {
                            TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr_PostLogin[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='UnselectedItems " + counter + "'></div></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                        }
                    }

                    if (AppLang.toLowerCase() == "en") {
                        if (MenuItemsDetailsArr_PostLogin[i].MenuItemTitle != "none") {
                            TempLi = TempLi.replace("#TabName#", MenuItemsDetailsArr_PostLogin[i].MenuItemTitle)
                        }
                        else {
                            TempLi = TempLi.replace("#TabName#", "")
                        }
                    }
                    else {
                        if (MenuItemsDetailsArr_PostLogin[i].MenuItemTitle_AR != "none") {
                            TempLi = TempLi.replace("#TabName#", MenuItemsDetailsArr_PostLogin[i].MenuItemTitle_AR)
                        }
                        else {
                            TempLi = TempLi.replace("#TabName#", "")
                        }
                    }

                    TempLi = TempLi.replace("#ItemID#", MenuItemsDetailsArr_PostLogin[i].MenuItemID).replace("#TabClassName#", MenuItemsDetailsArr_PostLogin[i].MenuItemClass);

                    if ($.trim(MenuItemsDetailsArr_PostLogin[i].ListIDstoBeShown) != "") {
                        TempLi = TempLi.replace("#ShowWidgets#", "ShowWidget('" + MenuItemsDetailsArr_PostLogin[i].ListIDstoBeShown + "','#ItemstobeRefreshed#','#PostData#');");
                    }
                    else {
                        TempLi = TempLi.replace("#ShowWidgets#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr_PostLogin[i].ListIDstoBeRefreshed) != "") {
                        TempLi = TempLi.replace("#ItemstobeRefreshed#", MenuItemsDetailsArr_PostLogin[i].ListIDstoBeRefreshed);
                    }
                    else {
                        TempLi = TempLi.replace("#ItemstobeRefreshed#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr_PostLogin[i].PostData) != "") {
                        TempLi = TempLi.replace("#PostData#", MenuItemsDetailsArr_PostLogin[i].PostData);
                    }
                    else {
                        TempLi = TempLi.replace("#PostData#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr_PostLogin[i].ListIDstoBeHidden) != "") {
                        TempLi = TempLi.replace("#HideWidgets#", " HideWidgets('" + MenuItemsDetailsArr_PostLogin[i].ListIDstoBeHidden + "');");
                    }
                    else {
                        TempLi = TempLi.replace("#HideWidgets#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr_PostLogin[i].MenuItemAdditionalFunction) != "") {
                        TempLi = TempLi.replace("#AdditionalAction#", MenuItemsDetailsArr_PostLogin[i].MenuItemAdditionalFunction);
                    }
                    else {
                        TempLi = TempLi.replace("#AdditionalAction#", "");
                    }
                    ALLLIHTML += TempLi;
                }
            }

            UlHTML = $('#MenuUlTemplate').html();

            UlHTML = UlHTML.replace('#ContentID#', MenuObj.MenuID);

            if (MenuObj.CssClassName_PostLogin != null) {
                UlHTML = UlHTML.replace("#MenuCssClass#", MenuObj.CssClassName_PostLogin);
            }
            else {
                UlHTML = UlHTML.replace("#MenuCssClass#", "");
            }
        }

        else {

            if (MenuObj.MenuItemsGroupID == "none" || MenuObj.MenuItemsGroupID == null || MenuObj.EnableMenu.toLowerCase() == "false") {
                return;
            }

            if (MenuObj.Position.toLowerCase() == "top") {
                PositionTop = true;
            }

            for (var i = 0; i < MenuItemsDetailsArr.length; i++) {

                if (MenuObj.MenuItemsGroupID == MenuItemsDetailsArr[i].MenuItemGroupID) {

                    counter++;

                    if (MenuItemsDetailsArr[i].ItemIconPath != "none") {
                        if (counter == 1) {
                            if (MenuObj.MenuType == "Menu2") {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='MenuItemCssClass'><table style='width:100%; height:100%;'><tr><td class='#TabClassName# iicon'>#TabName#<img src='#imgSRC#' class='#IconClassName#'/> <div class='arrow-down 1'></div></td></tr></table></li>"
                            }
                            else {
                                //       localStorage.setItem("ActiveItem", MenuItemsDetailsArr[i].MenuItemID);
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='arrow-down 1'></div><img src='#imgSRC#' class='#IconClassName#'/></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>";
                            }
                        }
                        else {
                            if (MenuObj.MenuType == "Menu2") {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='MenuItemCssClass'><table style='width:100%; height:100%;'><tr><td class='#TabClassName# iicon'>#TabName#<img src='#imgSRC#' class='#IconClassName#'/><div class='UnselectedItems " + counter + "'></div></td></tr></table></li>"
                            }
                            else {
                                TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='UnselectedItems " + counter + "'></div><img src='#imgSRC#' class='#IconClassName#'/></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                            }
                        }
                        TempLi = TempLi.replace("#imgSRC#", MenuItemsDetailsArr[i].ItemIconPath).replace("#IconClassName#", MenuItemsDetailsArr[i].IconCssClass)
                    } else {
                        if (counter == 1) {
                            //    localStorage.setItem("ActiveItem", MenuItemsDetailsArr[i].MenuItemID);
                            TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='arrow-down 1'></div></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                        }
                        else {
                            TempLi = "<li id='#ItemID#' onclick=\"#ShowWidgets# #HideWidgets# #AdditionalAction# SetActiveItem('" + MenuItemsDetailsArr[i].MenuItemID + "')\" class='#TabClassName# MenuItemCssClass'><table style='width:100%; height:100%; border-right: 1px solid gray;'><tr style='height:50%;'><td><div class='UnselectedItems " + counter + "'></div></td></tr><tr style='height:50%'><td><a class='iicon'>#TabName#</a></td></tr></table></li>"
                        }
                    }

                    if (AppLang.toLowerCase() == "en") {
                        if (MenuItemsDetailsArr[i].MenuItemTitle != "none") {
                            TempLi = TempLi.replace("#TabName#", MenuItemsDetailsArr[i].MenuItemTitle)
                        }
                        else {
                            TempLi = TempLi.replace("#TabName#", "")
                        }
                    }
                    else {
                        if (MenuItemsDetailsArr[i].MenuItemTitle_AR != "none") {
                            TempLi = TempLi.replace("#TabName#", MenuItemsDetailsArr[i].MenuItemTitle_AR)
                        }
                        else {
                            TempLi = TempLi.replace("#TabName#", "")
                        }
                    }

                    TempLi = TempLi.replace("#ItemID#", MenuItemsDetailsArr[i].MenuItemID).replace("#TabClassName#", MenuItemsDetailsArr[i].MenuItemClass);

                    if ($.trim(MenuItemsDetailsArr[i].ListIDstoBeShown) != "") {
                        TempLi = TempLi.replace("#ShowWidgets#", "ShowWidget('" + MenuItemsDetailsArr[i].ListIDstoBeShown + "','#ItemstobeRefreshed#','#PostData#');");
                    }
                    else {
                        TempLi = TempLi.replace("#ShowWidgets#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr[i].ListIDstoBeRefreshed) != "") {
                        TempLi = TempLi.replace("#ItemstobeRefreshed#", MenuItemsDetailsArr[i].ListIDstoBeRefreshed);
                    }
                    else {
                        TempLi = TempLi.replace("#ItemstobeRefreshed#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr[i].PostData) != "") {
                        TempLi = TempLi.replace("#PostData#", MenuItemsDetailsArr[i].PostData);
                    }
                    else {
                        TempLi = TempLi.replace("#PostData#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr[i].ListIDstoBeHidden) != "") {
                        TempLi = TempLi.replace("#HideWidgets#", " HideWidgets('" + MenuItemsDetailsArr[i].ListIDstoBeHidden + "');");
                    }
                    else {
                        TempLi = TempLi.replace("#HideWidgets#", "");
                    }

                    if ($.trim(MenuItemsDetailsArr[i].MenuItemAdditionalFunction) != "") {
                        TempLi = TempLi.replace("#AdditionalAction#", MenuItemsDetailsArr[i].MenuItemAdditionalFunction);
                    }
                    else {
                        TempLi = TempLi.replace("#AdditionalAction#", "");
                    }
                    ALLLIHTML += TempLi;
                }
            }

            UlHTML = $('#MenuUlTemplate').html();

            UlHTML = UlHTML.replace('#ContentID#', MenuObj.MenuID);

            if (MenuObj.CssClassName != null) {
                UlHTML = UlHTML.replace("#MenuCssClass#", MenuObj.CssClassName);
            }
            else {
                UlHTML = UlHTML.replace("#MenuCssClass#", "");
            }
        }

        UlHTML = UlHTML.replace("#ALLItems#", ALLLIHTML);

        if (PositionTop) {
            $('#HeaderTab_Conent_Div').html(UlHTML);
            $('#HeaderTab_Conent_Div').show();
            $('#FooterTab_Conent_Div').hide();
        }
        else {
            $('#FooterTab_Conent_Div').html(UlHTML);
            $('#FooterTab_Conent_Div').show();
            $('#HeaderTab_Conent_Div').hide();
        }

        if (counter > NoOfItemsAtScreen) {
            $('.UlContentDiv').scrollview({
                direction: 'x',
                scrollmethod: 'translate'
            });
        }
        else {
            Plus30Percent = 0;
        }
        var Plus30Percent = (DeviceWidth / NoOfItemsAtScreen) * 0.3;

        if (!withPaddingSpace) {
            Plus30Percent = 0;
        }

        $('.UlContentDiv').css('width', (DeviceWidth + 10) + "px");
        $('.MenuItemCssClass').css('width', (DeviceWidth - Plus30Percent) / NoOfItemsAtScreen + "px");
        $('.tabbar').css('width', ((DeviceWidth - Plus30Percent) / NoOfItemsAtScreen) * counter + "px");
        $('.ui-scrollview-view').css('width', ((DeviceWidth - Plus30Percent) / NoOfItemsAtScreen) * counter + "px");

        ButtonHTML = $('#MenuButtonID').html();

        if (PostLoginMenu) {
            if (MenuObj.MenuType_PostLogin == "Menu1") {
                MenuWithBtnType = true;
                if (AppLang.toLowerCase() == "en") {
                    ButtonHTML = ButtonHTML.replace("#ButtonImg#", MenuObj.MenuButtonImgPath_PostLogin);
                }
                else {
                    ButtonHTML = ButtonHTML.replace("#ButtonImg#", MenuObj.MenuButtonImgPath_PostLogin_AR);
                }
                ButtonHTML = ButtonHTML.replace("#ButtonClass#", MenuObj.MenuBtnCssClassName_PostLogin);

                if (PositionTop) {
                    $('#HeaderTab_Conent_Div').hide();
                    $('#BtnMenuTop').html(ButtonHTML);
                    $('#BtnMenuTop').show();
                    MenuWithBtnPositionTop = true;
                }
                else {
                    $('#FooterTab_Conent_Div').hide();
                    $('#BtnMenuDown').html(ButtonHTML);
                    $('#BtnMenuDown').show();
                    MenuWithBtnPositionTop = false;
                }
            }
        }
        else {
            if (MenuObj.MenuType == "Menu1") {
                MenuWithBtnType = true;
                if (AppLang.toLowerCase() == "en") {
                    ButtonHTML = ButtonHTML.replace("#ButtonImg#", MenuObj.MenuButtonImgPath);
                }
                else {
                    ButtonHTML = ButtonHTML.replace("#ButtonImg#", MenuObj.MenuButtonImgPath_AR);
                }
                ButtonHTML = ButtonHTML.replace("#ButtonClass#", MenuObj.MenuBtnCssClassName);

                if (PositionTop) {
                    $('#HeaderTab_Conent_Div').hide();
                    $('#BtnMenuTop').html(ButtonHTML);
                    $('#BtnMenuTop').show();
                    MenuWithBtnPositionTop = true;
                }
                else {
                    $('#FooterTab_Conent_Div').hide();
                    $('#BtnMenuDown').html(ButtonHTML);
                    $('#BtnMenuDown').show();
                    MenuWithBtnPositionTop = false;
                }
            }
        }
    } catch (e) {
        alert(e);
    }
}
*/

var ActiveTabID = "";
function SetActiveItem(ItemID) {
    ActiveTabID = ItemID;
}

function $$() {
    return "#" + ActiveTabID + " ";
}

function ClearActiveItem() {
    ActiveTabID = "";
}

function PageClick_SlideMenuUp() {
    if (MenuWithBtnType) {
        if (MenuWithBtnPositionTop) {
            $('#HeaderTab_Conent_Div').hide();
        }
        else {
            $('#FooterTab_Conent_Div').hide();
        }
        alert("dd");
        // $('#ALLPageContent').css('margin-top', 0);
        $('#MenuButtonDiv').show();
        HandleContentPanelTopPadding();
    }
}

function ShowMenu() {
    if (MenuWithBtnPositionTop) {
        $('#HeaderTab_Conent_Div').show();
        var MenuHeight = $('.UlContentDiv').height();
        //$('#ALLPageContent').css('margin-top', MenuHeight);
    }
    else {
        $('#FooterTab_Conent_Div').show();
        var MenuHeight = $('.UlContentDiv').height();
        // $('#ALLPageContent').css('margin-top', -MenuHeight);
    }
    $('#MenuButtonDiv').hide();
    HandleContentPanelTopPadding();
}


function MenuBackBtn() {
    if (scrollCounter + 3 <= counter) {
        $(".UlContentDiv").scrollview('scrollTo', +(scrollableAreawidth / 3) * scrollCounter, 0);
        scrollCounter--;
    }
    else if (scrollCounter < 0) {
        scrollCounter = 0;
    }
};

var scrollCounter = 0;
function MenuNextBtn() {
    scrollCounter++;
    if (scrollCounter + 3 <= counter) {
        $(".UlContentDiv").scrollview('scrollTo', -(scrollableAreawidth / 3) * scrollCounter, 0);
    }
};

////////////////////////////////////////////////////////////////////////////////

// ShowDataMode: 
/*
i.	ShowFromCacheAndRefreshWhenCacheIsExpired
ii.	ShowFromCacheAndRefreshAlways
iii.	ShowEmptyPageAndRefresh
iv.	ShowStaticPageAndRefresh
*/
var DialogIDToBeDisplayed = '';
function GetPageHTMLThenDisplayDialog(PageId, PostData, DialogWidth, HideHeaderCloseButton, DialogBlankContent, GetFreshDataFromServer, SkipSettingCache, AdditionalSuccessCallBack, AdditionalFailureCallBack, ShowRefreshIcon, KeepDialogContentIFDisplayed, HideFooter, DataTheme, I_Position, HideHeader, HideBlankContent, Options) {

    DialogIDToBeDisplayed = PageId;

    if (!KeepDialogContentIFDisplayed) // Specifies If The Current Displayed Dialog will be replaced with Loading Blank Content or not
        KeepDialogContentIFDisplayed = false;

    if (!DialogWidth)
        DialogWidth = '50%';

    if (!HideHeaderCloseButton)
        HideHeaderCloseButton = false;

    if (!DialogBlankContent)
        DialogBlankContent = "";

    if (HideBlankContent) {
        DialogBlankContent = "";
    }

    if (!I_Position) {
        I_Position = 'fixed';
    }

    if (!HideHeader) {
        HideFooter = false;
    }

    if (!Options) {
        Options = {};
    }

    var CacheSettingsObj = new CacheSettings.constructor();
    var AjaxCallInfoObj = new AjaxCallInfo.constructor();
    CacheSettingsObj = CacheSettingsArr[PageId];
    var PageURL = ((AppLang == 'en') ? CacheSettingsObj.PagePath : CacheSettingsObj.PagePath_AR);
    var PageTitle = ((AppLang == 'en') ? CacheSettingsObj.PageTitle : CacheSettingsObj.PageTitle_Ar);

    var RefreshIconActionStr = '';

    RefreshIconActionStr = 'GetPageHTMLThenDisplayDialog("' + PageId + '","' + PostData + '","' + DialogWidth + '",' + HideHeaderCloseButton + ',"' +
        DialogBlankContent + '",true,' + SkipSettingCache + ',"' + AdditionalSuccessCallBack + '","' + AdditionalFailureCallBack + '",' + ShowRefreshIcon + ');';
    try {
        DialogRefreshIconAction = RefreshIconActionStr;
    } catch (e) {
        alert(e);
    }
    if (!ShowRefreshIcon)
        ShowRefreshIcon = false;

    RefreshIconActionStr = '';


    try {
        var isWindowsPhone = /windows phone/i.test(navigator.userAgent.toLowerCase());
        if (!$.mobile.sdCurrentDialog) {
            if (isWindowsPhone) {
                DisableWindowScroll();
                //setTimeout("DialogOverLay_Height();BouncsScrollDisable_WP();", 5);
                HeightsArr_WP = ''; BlurFlag = false;
                window.external.notify("noScroll");
                //
                //alert('GetPageHTMLThenDisplayDialog');
                //

                $('<div>').simpledialog2({
                    mode: 'blank',
                    headerText: PageTitle,
                    hideHeader: HideHeader,
                    headerClose: (HideHeaderCloseButton == false),
                    width: DialogWidth,
                    blankContent: DialogBlankContent,
                    ShowRefreshIcon: ShowRefreshIcon,
                    RefreshIconPath: 'Images/refreshpopup.png',
                    RefreshIconAction: RefreshIconActionStr,
                    IsWindowsPhone: true,
                    callbackClose: OnSimpleDialogClose2, //AZMY iOS4.3
                    Position: I_Position
                });
                DialogOverLay_Height();
            }
            else {
                //alert(00);
                $('<div>').simpledialog2({
                    mode: 'blank',
                    headerText: PageTitle,
                    hideHeader: HideHeader,
                    headerClose: (HideHeaderCloseButton == false),
                    width: DialogWidth,
                    blankContent: DialogBlankContent,
                    ShowRefreshIcon: ShowRefreshIcon,
                    RefreshIconPath: 'Images/refreshpopup.png',
                    RefreshIconAction: RefreshIconActionStr,
                    callbackClose: OnSimpleDialogClose2,
                    Position: I_Position
                });
            }
        }
        else {
            //alert($.mobile.sdCurrentDialog.options);
            try {
                if (isWindowsPhone) {
                    DisableWindowScroll();
                    window.external.notify("noScroll");
                    setTimeout('$("#PageContent").css("height","400px");$("#ALLPageContent").css("min-height","400px");$("#ALLPageContent").css("height","400px");', 50);
                    $.mobile.sdCurrentDialog.options.mode = 'blank';
                    $.mobile.sdCurrentDialog.options.headerText = PageTitle;
                    $.mobile.sdCurrentDialog.options.headerClose = (HideHeaderCloseButton == false);
                    $.mobile.sdCurrentDialog.options.width = DialogWidth;
                    $.mobile.sdCurrentDialog.options.blankContent = DialogBlankContent;
                    $.mobile.sdCurrentDialog.options.ShowRefreshIcon = ShowRefreshIcon;
                    $.mobile.sdCurrentDialog.options.IsWindowsPhone = true;
                    $.mobile.sdCurrentDialog.options.RefreshIconPath = 'Images/refreshpopup.png';
                    $.mobile.sdCurrentDialog.options.RefreshIconAction = RefreshIconActionStr;
                    $.mobile.sdCurrentDialog.options.callbackClose = OnSimpleDialogClose2;
                    try { $.mobile.sdCurrentDialog.options.Position = I_Position; } catch (e) { }

                } else {
                    $.mobile.sdCurrentDialog.options.mode = 'blank';
                    $.mobile.sdCurrentDialog.options.headerText = PageTitle;
                    $.mobile.sdCurrentDialog.options.headerClose = (HideHeaderCloseButton == false);
                    $.mobile.sdCurrentDialog.options.width = DialogWidth;
                    $.mobile.sdCurrentDialog.options.blankContent = DialogBlankContent;
                    $.mobile.sdCurrentDialog.options.ShowRefreshIcon = ShowRefreshIcon;
                    $.mobile.sdCurrentDialog.options.RefreshIconPath = 'Images/refreshpopup.png';
                    $.mobile.sdCurrentDialog.options.RefreshIconAction = RefreshIconActionStr;
                    try { $.mobile.sdCurrentDialog.options.Position = I_Position; } catch (e) { }
                    alert(6);
                }

            } catch (e) {
                //alert(e);
            }
            if (KeepDialogContentIFDisplayed == false)
                $.mobile.sdCurrentDialog.updateBlank(DialogBlankContent);
        }
        try {
            $(".ui-simpledialog-container").find(".ui-title").html(PageTitle);
        } catch (e) {
            console.log(e);
        }
    } catch (e) {
        alert('Err when displaying dialog: ' + e);
        logErr('Err when displaying dialog: ' + e);
    }


    if (!AdditionalSuccessCallBack)
        AdditionalSuccessCallBack = '';

    if (!AdditionalFailureCallBack)
        AdditionalFailureCallBack = '';



    AdditionalSuccessCallBack = '' + AdditionalSuccessCallBack;
    AdditionalFailureCallBack = '' + AdditionalFailureCallBack + ';';

    AdditionalSuccessCallBack = ' ;  if (DialogIDToBeDisplayed == \'' + PageId + '\') {DisplayPageHTMLInSimpleDialog("' + PageId + '","' + DialogWidth + '",false,false,false,"' + HideFooter + '","' + DataTheme + '"); } else{log("Will Not Display ' + PageId + ', because DialogIDToBeDisplayed = " + DialogIDToBeDisplayed)}; ' + AdditionalSuccessCallBack + ' ;  if (DialogIDToBeDisplayed == \'' + PageId + '\' ) { DialogRefreshIconAction =  \'RemovePageDataSourcesCache("' + PageId + '"); \' + DialogRefreshIconAction;}';

    GetPageHTML(PageId, PostData, GetFreshDataFromServer, SkipSettingCache, Options.AdditionalSuccessCallBack, Options.AdditionalFailureCallBack, false, false, Options);

}




function RefreshDialog(DialogID, PostData, AdditionalSuccessCallBack, AdditionalFailureCallBack) {
    AdditionalSuccessCallBack = AdditionalSuccessCallBack + '; DisplayPageHTMLInSimpleDialog("' + DialogID + '")';
    try { ShowHideDialogLoadingSpinner(true); } catch (e) { }
    GetPageHTML(DialogID, PostData, true, false);
}

function DisplayPageHTMLInSimpleDialog(DialogId, DialogWidth, HideHeaderCloseButton, DialogBlankContent, RefreshIconActionStr, HideFooter, DataTheme) {
    try {
        if (!DialogWidth)
            DialogWidth = '90%';

        if (!HideHeaderCloseButton)
            HideHeaderCloseButton = false;

        if (!DialogBlankContent)
            DialogBlankContent = "<center><img src='Images/ajax-loader.gif' /></center>";

        if (!RefreshIconActionStr)
            RefreshIconActionStr = '';
        if (!HideFooter)
            HideFooter = false;

        if (!DataTheme)
            DataTheme = 'd';


        var CacheSettingsObj = new CacheSettings.constructor();
        var AjaxCallInfoObj = new AjaxCallInfo.constructor();
        CacheSettingsObj = CacheSettingsArr[DialogId];
        var PageURL = ((AppLang == 'en') ? CacheSettingsObj.PagePath : CacheSettingsObj.PagePath_AR);
        var PageTitle = ((AppLang == 'en') ? CacheSettingsObj.PageTitle : CacheSettingsObj.PageTitle_Ar);
        //alert(PageTitle);
        //alert(PageURL);

        AjaxCallInfoObj = AjaxCallInfoArr[PageURL];

        //newHTML = '<div id = \'SimpleDialogContentContainerDiv\' style=\'width: 100%\'>' + newHTML + '</div>';

        var DialogRespHtml = '<div id = \'SimpleDialogContentContainerDiv\' style=\'width: 100%\'>' + AjaxCallInfoObj.RespHtml + '</div>' + '<div class="ui-header ui-bar-' + DataTheme + ' SimpleDialogFooter" style="display: ' + (returnBoolean(HideFooter + '') ? 'none' : 'block') + '; height: 25px"><label class="WidgetHeaderTimeStampFooterLblcssclass" id="' + DialogId + '_LastUpdateTimeFooterLbl"></label></div>';
        try {
            $.mobile.sdCurrentDialog.updateBlank(DialogRespHtml);
            //$(".ui-simpledialog-container").find(".ui-title").html(PageTitle);
            $(".ui-simpledialog-title").html(PageTitle);
        } catch (e) {

            $('<div>').simpledialog2({
                mode: 'blank',
                headerText: PageTitle,
                headerClose: (HideHeaderCloseButton == false),
                width: DialogWidth,
                blankContent: DialogBlankContent,
                ShowRefreshIcon: true,
                RefreshIconPath: 'Images/refreshpopup.png',
                RefreshIconAction: ''
            });
            $.mobile.sdCurrentDialog.updateBlank(DialogRespHtml);
            //$(".ui-simpledialog-container").find(".ui-title").html(PageTitle);
            $(".ui-simpledialog-title").html(PageTitle);
            //alert(PageTitle);
        }

    } catch (e) {
        alert(e);
    }
}

function BindEventToContext(SelectorStr, EventsStr, Context, HandlerFunction) {
    var _arguments = arguments;
    var _this = Context;
    var myfunc = function () { return HandlerFunction.apply(_this, arguments) };
    myfunc.BindEventToContextArgs = arguments;
    if (Context == null || Context == undefined)
        $(SelectorStr).bind(EventsStr, myfunc);
    else
        $('#' + Context.mPageID + ' ' + SelectorStr).bind(EventsStr, myfunc);
}


/*********************************************************************************/
//////////////////////////////////////////////////////////////////////////////////
// Added By : Amir Ali
// Date : 14-1-2016
// Description : To Handle Forms to be displayed when call many forms in different navigators(Modules)
//////////////////////////////////////////////////////////////////////////////////

var NavIDs = new Array();
var NavParentID = new Array();

function SetFormsNavID(FormsIDs) {

    // Create new inistance of NavParentID
    NavParentID = new Array();

    // Get Called FormsIDs
    var Widgets_IDs = FormsIDs.split(',');
    var Widgets_ID = Widgets_IDs[0];

    // Set ActiveNavID of these Forms as current ActiveNavID And ParentID as FormID
    NavIDs[Widgets_ID] = Globals.ActiveNavID;
    NavParentID[Widgets_ID] = Widgets_ID;

    if (Widgets_IDs.length > 1) {
        for (var i = 1; i < Widgets_IDs.length; i++) {
            var Wid_ID = Widgets_IDs[i];

            NavIDs[Wid_ID] = Globals.ActiveNavID;
            NavParentID[Wid_ID] = Wid_ID;
        }
    }
}

function CheckCurrentNavID(FormID, CallBackContext) {
    try {
        // To get caller class called this form
        var ContextID = CallBackContext.mPageID.split(GetActiveSubPageID() + "_")[1];

        // To get ActiveNavID of parent class
        var CurrNavID = NavIDs[ContextID];

        //To Get Parent of the caller
        var ParentID = NavParentID[ContextID];

        if (ParentID) {
            // To Save Parent of Callee as Parent of Caller
            NavParentID[FormID] = NavParentID[ContextID];

            // To Load the form if ActiveNavID of the parent equel to Current ActiveNavID
            if (NavIDs[NavParentID[ContextID]] == Globals.ActiveNavID) {
                return true;
            } else {
                return false;
            }

        } else {
            return false;
        }

    } catch (e) {
        log(e);

        // to split ActiveSubPageID
        var Form_ID = FormID.indexOf(GetActiveSubPageID() + "_");
        if (Form_ID != -1) {
            FormID = FormID.split(GetActiveSubPageID() + "_")[1];
        }

        // To set this form as parent
        NavParentID[FormID] = FormID;

        // To Set ActiveNavID of this Form as Current ActiveNavID
        NavIDs[FormID] = Globals.ActiveNavID;

        return true;
    }

    return true;

}

/*********************************************************************************/

function RecordMWServicesWidgetsMapping(FormInstance, PageID) {

    try {
        if (FormInstance.MWServiceId) {
            window.Globals = window.Globals || {};
            Globals.MWServicesWidgetsMappingArr = Globals.MWServicesWidgetsMappingArr || {};
            Globals.MWServicesWidgetsMappingArr[FormInstance.MWServiceId] =
                Globals.MWServicesWidgetsMappingArr[FormInstance.MWServiceId] || [];

            Globals.MWServicesWidgetsMappingArr[FormInstance.MWServiceId].push(PageID);
        }
    } catch (e) {
        log(e);
    }
}

function HandleCommunicationError() {
    if ((navigator.onLine == false || Globals.CustomCheckedNavIsOnlie == false) && Globals.CheckAndDisplayBrowserNotOnlineWhenCommErr == true) {
        var a = Globals.WidgetID;
        if (a.indexOf(GetActiveSubPageID()) == 0) {
            var SubPageId = a.replace(GetActiveSubPageID() + '_', "");
        }
        else {
            var SubPageId = Globals.WidgetID;
        }
        var WidgetCached = Globals.CachedWidgets.indexOf(SubPageId);
        if (WidgetCached == undefined || WidgetCached == -1 || SubPageId == -1) {
            AlertFunction(Globals.BrowserNotOnlineCommErrEN, Globals.BrowserNotOnlineCommErrAR, "Sorry", "عفواً", "OK", "موافق", "");
            return true;
        }
        else {
            return false;
        }
        return true;
    }
    else {
        return false;
    }
    return false;
}

function LoadAndRunForm(FormID, FormParametersData, GetCreatedInstanceIFAny, CallBackContext, Options) {
    Globals.WidgetID = FormID;
    if (HandleCommunicationError(FormID)) {
        return;
    }
    try {
        if (isTablet) {
            var ContinueLoading = CheckCurrentNavID(FormID, CallBackContext);
            if (!ContinueLoading) {
                return;
            }
        }
    } catch (e) {
        log(e);
    }
    var FncPramsData = {
        FormID: FormID,
        FormParametersData: FormParametersData,
        GetCreatedInstanceIFAny: GetCreatedInstanceIFAny,
        CallBackContext: CallBackContext,
        Options: Options
    }
    var LogPrefixStr = '*********************** LoadAndRunForm For ' + FormID + '. ';
    Globals = window.Globals || {};
    Globals.LoadAndRunFormCommErrTimeout = Globals.LoadAndRunFormCommErrTimeout || 65000;
    if (InitCallTimer == null) {
        InitCallTimer = setTimeout(function () {
            HideLoadingSpinner();
            DisplayCommunicationError();
        }, Globals.LoadAndRunFormCommErrTimeout);
    }
    log('*********************** Start LoadAndRunForm For ' + FormID + ', arguments: ');
    log(arguments);

    if (!Options) {

        Options = {};
    }

    if (Options.IsDialog == undefined) {
        Options.IsDialog = false;
    }

    if (Options.DisplayPageLoadingSpinner == null || Options.DisplayPageLoadingSpinner == undefined) {
        Options.DisplayPageLoadingSpinner = true;
    }

    if (Options.HidePageLoadingSpinner == null || Options.HidePageLoadingSpinner == undefined) {
        Options.HidePageLoadingSpinner = true;
    }

    if (Options.DisplayPageLoadingSpinner) {
        log(LogPrefixStr + ' Showing spinner .....');
        ShowLoadingSpinner();
        PageSpinnerIsShown = true;
    }

    var ActiveSubPageID = GetActiveSubPageID();
    var PageId = FormID;
    if (UseActiveSubPageWhenLoadingPageContent) {
        //if (PageId.indexOf(ActiveSubPageID) == -1)
        //    PageId = GetActiveSubPageID() + '_' + FormID;
        if (PageId.indexOf(ActiveSubPageID) == -1) {
            var cached = eval('CacheSettingsArrr.' + FormID);
            PageId = cached.SubPageID + '_' + FormID;
        }
    }
    Globals.EnableReportCase = Globals.EnableReportCase || false;
    if (Globals.EnableReportCase) {
        Globals = window.Globals || {}
        Globals.NavigationHistoryStack = Globals.NavigationHistoryStack || {};
        var NavigationHistoryStackItemID = Globals.NavigationHistoryCounter;
        Globals.NavigationHistoryCounter = Globals.NavigationHistoryCounter + 1;
        Globals.NavigationHistoryStack[NavigationHistoryStackItemID] = { "Date": formatDate((new Date()), 'yyyy-MM-ddTHH:mm:ss'), "FormID": FormID, "FormParamsData": FormParametersData, "RetrialNumber": window[PageId + "NoOfRetries"] };
        try {

            if (Globals.MaskedForms[FormID] != undefined) {
                var ClonedParams = clone(FormParametersData);

                var ItemsToBeReplaced = Globals.MaskedForms[FormID].split(',');
                for (var x = 0; x < ItemsToBeReplaced.length; x++) {
                    UpdateObjectValues(ClonedParams, ItemsToBeReplaced[x], "********");
                }
                Globals.NavigationHistoryStack[NavigationHistoryStackItemID] = { "Date": formatDate((new Date()), 'yyyy-MM-ddTHH:mm:ss'), "FormID": FormID, "FormParamsData": ClonedParams, "RetrialNumber": window[PageId + "NoOfRetries"] };
            }





        }
        catch (e) {

            Globals.NavigationHistoryStack[NavigationHistoryStackItemID] = { "Date": formatDate((new Date()), 'yyyy-MM-ddTHH:mm:ss'), "FormID": FormID, "FormParamsData": FormParametersData, "RetrialNumber": window[PageId + "NoOfRetries"] };

        }
    }
    try {
        GetAndAppendWidgetZone(PageId, GetActiveSubPageID());
    } catch (e) { log(e); }
    log(LogPrefixStr + ' GetCreatedInstanceIFAny: ' + GetCreatedInstanceIFAny);
    if (GetCreatedInstanceIFAny) {
        if (window[PageId + "_ClassIns"] != null) {
            log(LogPrefixStr + ' a Previously Created Ins found: ');
            log(window[PageId + "_ClassIns"]);
            window[PageId + "_ClassIns"].mParameters = FormParametersData;
            window[PageId + "_ClassIns"].NavigationHistoryItemID = NavigationHistoryStackItemID;
            window[PageId + "_ClassIns"].RunForm();
            RecordMWServicesWidgetsMapping(window[PageId + "_ClassIns"], PageId);
            try {
                log(LogPrefixStr + ' Executing CallBack');

                Options.OnCallSuccessFunction.apply(CallBackContext, { ClassIns: window[PageId + "_ClassIns"] });

            } catch (e) {

            }

            try {
                if (PageSpinnerIsShown) {
                    clearTimeout(InitCallTimer);
                    InitCallTimer = null;
                    log("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ GetCreatedInstanceIFAny  " + LogPrefixStr + ' Hidding spinner .....');
                    //   if (Options.HidePageLoadingSpinner) {
                    //     setTimeout(function () { HideLoadingSpinner(); }, 1500);
                    // }
                }
            } catch (e) {

            }

            return window[PageId + "_ClassIns"];
        }
    }

    try {
        if (window.HandleBusinessSetTemplatePredefinedCache) {
            HandleBusinessSetTemplatePredefinedCache(PageId);
        }
    } catch (e) {

    }

    if (!Options)
        Options = {};
    var OriginalOnCallSuccessFunction = (Options.OnCallSuccessFunction != undefined) ? Options.OnCallSuccessFunction : function () { }; Options.OnCallSuccessFunction = OnCallSuccessFunction;
    var OriginalOnCallFailureFunction = (Options.OnCallFailureFunction != undefined) ? Options.OnCallFailureFunction : function () { }; Options.OnCallFailureFunction = OnCallFailureFunction;
    var OnCallSuccessFunction = function (Data) {
        try {

            log(LogPrefixStr + ' Executing Success CallBack For PageId: ' + PageId + '  '
                + CacheSettingsArrWithURL[Data.AjaxCallInfoObj.URL].PageID);
            var MyPageCacheSetting = CacheSettingsArrWithURL[Data.AjaxCallInfoObj.URL];
            var RespHtml = Data.AjaxCallInfoObj.RespHtml;
            var RespJS = Data.AjaxCallInfoObj.RespJS;
            if (MyPageCacheSetting.PageHasHTML == false && MyPageCacheSetting.PageHasJS == true) {
                RespJS = Data.AjaxCallInfoObj.RespJS = Data.AjaxCallInfoObj.RespHtml;
            }
            window[MyPageCacheSetting.PageId + "NoOfRetries"] = 0;
            try {
                log(LogPrefixStr + 'eval JS: ');
                eval.call(window, RespJS);
                log(LogPrefixStr + 'eval JS Done');
                //var ClassName = FormID.replace(ActiveSubPageID + '_', '');
                var ClassName = CacheSettingsArr[PageId].CodeBehindJSClassName;

                var temp = "window['" + PageId + "_ClassIns'] = new " + ClassName + "(); ";
                log(LogPrefixStr + ' Creating New Ins, by eval ' + temp);
                eval(temp);
                Data.AjaxCallInfoObj.ClassIns = window[PageId + "_ClassIns"];
                Data.AjaxCallInfoObj.ClassIns.mPageID = PageId;
                Data.AjaxCallInfoObj.ClassIns.MyHTML = RespHtml;
                Data.AjaxCallInfoObj.ClassIns.NavigationHistoryItemID = NavigationHistoryStackItemID;
                Data.AjaxCallInfoObj.ClassIns.mParameters = FormParametersData;
                ClassInstancesArray.push(PageId);
                log(LogPrefixStr + ' Done Creating New Ins, Setting Class Params and Data: ');
                log(Data.AjaxCallInfoObj);
                log(LogPrefixStr + ' Calling RunForm');
                if (Globals.EnableReportCase) {
                    Globals.NavigationHistoryStack[NavigationHistoryStackItemID].LoadFormCompletionTime = formatDate((new Date()), 'yyyy-MM-ddTHH:mm:ss');
                }
                Data.AjaxCallInfoObj.ClassIns.RunForm();
                RecordMWServicesWidgetsMapping(window[PageId + "_ClassIns"], PageId);
            }
            catch (e) {
                log(e);
            }


            try {
                clearTimeout(InitCallTimer);
                InitCallTimer = null;
                log(LogPrefixStr + ' Hidding spinner .....');
                //   if (Options.HidePageLoadingSpinner) {
                //     setTimeout(function () { HideLoadingSpinner(); }, 1500);
                // }
            } catch (e) {

            }

            try {
                log(LogPrefixStr + ' Executing OriginalOnCallSuccessFunction');
                OriginalOnCallSuccessFunction.apply(CallBackContext, Data);
            } catch (e) {
                log(e);
            }

        }
        catch (e) {
            log(e);
        }
    }
    var OnCallFailureFunction = function (Data) {

        try {
            log(LogPrefixStr + ' Hidding spinner .....');
            clearTimeout(InitCallTimer);
            InitCallTimer = null;
            ShowHideSpinner(FormID, false);
            //HideLoadingSpinner();
            var DisplayServerErrorFlag = false;
            var DisplayServerErrorFlagWithoutRetrying = false;
            var DisplayTechnicalErrorFlag = false;
            var StatusCode = -1;
            if (Data.Error != "abort") {
                try {
                    var StatusCode = Data.XHR.status;
                    window.Globals = window.Globals || {};
                    if (Globals.EnableReportCase) {
                        Globals.NavigationHistoryStack[NavigationHistoryStackItemID].LoadFormErrorTime = formatDate((new Date()), 'yyyy-MM-ddTHH:mm:ss');
                        Globals.NavigationHistoryStack[NavigationHistoryStackItemID].LoadFormErrorObject = Data.XHR;
                    }
                    if (Globals.CustomCheckedNavIsOnlie == undefined)
                        Globals.CustomCheckedNavIsOnlie = true;
                    if (parseInt(StatusCode) == StatusCode && StatusCode != 0 && (navigator.onLine == true && Globals.CustomCheckedNavIsOnlie == true) && Globals.StatusCodesToBeNotRepeated.indexOf(parseInt(StatusCode)) != -1) {
                        DisplayServerErrorFlagWithoutRetrying = true;
                    }
                } catch (e) {

                }
                if (DisplayServerErrorFlagWithoutRetrying) {
                    HideLoadingSpinner();
                    DisplayServerError(StatusCode);
                } else {
                    if (Globals.WidgetsRetrialsInfo != undefined && Globals.WidgetsRetrialsInfo != null && JSON.stringify(Globals.WidgetsRetrialsInfo) != "{}") {
                        if (window[Data.CallOptions.PageId + "NoOfRetries"] != parseInt(eval('Globals.WidgetsRetrialsInfo["' + Data.CallOptions.PageId + '"].RetrialsNo')) && parseInt(eval('Globals.WidgetsRetrialsInfo["' + Data.CallOptions.PageId + '"].RetrialsNo')) != 0) {
                            if (window[Data.CallOptions.PageId + "NoOfRetries"] == undefined) {
                                window[Data.CallOptions.PageId + "NoOfRetries"] = 0;
                            }

                            if (Data.CallOptions.JSCallSucceeded != undefined) {
                                if (Data.CallOptions.JSCallSucceeded == false) {
                                    window[Data.CallOptions.PageId + "JSRetryFailed"] = true;
                                    window[Data.CallOptions.PageId + "FullRetryFailed"] = true;
                                    AjaxCallInfoArr[Data.CallOptions.PageURL].AjaxCallingThread.abort();
                                }
								/*window[Data.CallOptions.PageId + "JSRetryFailed"] = true;
								window[Data.CallOptions.PageId + "FullRetryFailed"] = true;*/
                            }
                            if (Data.CallOptions.HTMLCallSucceeded != undefined) {
                                if (Data.CallOptions.HTMLCallSucceeded == false) {
                                    window[Data.CallOptions.PageId + "HTMLRetryFailed"] = true;
                                    window[Data.CallOptions.PageId + "FullRetryFailed"] = true;
                                    AjaxCallInfoArr[Data.CallOptions.PageJSPath].AjaxCallingThread.abort();
                                }
                            }

							/*if(window[Data.CallOptions.PageId + "HTMLRetryFailed"] == true && window[Data.CallOptions.PageId + "JSRetryFailed"] == true){
								window[Data.CallOptions.PageId + "FullRetryFailed"] = true;
								window[Data.CallOptions.PageId + "HTMLRetryFailed"] = false;
								window[Data.CallOptions.PageId + "JSRetryFailed"] = false;
							}*/

                            if (window[Data.CallOptions.PageId + "FullRetryFailed"] == true) {
                                window[Data.CallOptions.PageId + "NoOfRetries"] = window[Data.CallOptions.PageId + "NoOfRetries"] + 1;
                                window[Data.CallOptions.PageId + "FullRetryFailed"] = false;
                                Data.CallOptions.IsRetrialCall = true;
                                LoadAndRunForm(Data.CallOptions.LoadAndRunFormFuncParams.FormID, Data.CallOptions.LoadAndRunFormFuncParams.FormParametersData, Data.CallOptions.LoadAndRunFormFuncParams.GetCreatedInstanceIFAny, Data.CallOptions.LoadAndRunFormFuncParams.CallBackContext, Data.CallOptions.LoadAndRunFormFuncParams.Options);
                            }
                        } else {
                            if (Data.CallOptions.JSCallSucceeded != undefined) {
                                if (Data.CallOptions.JSCallSucceeded == false) {
                                    AjaxCallInfoArr[Data.CallOptions.PageURL].AjaxCallingThread.abort();
                                }
								/*window[Data.CallOptions.PageId + "JSRetryFailed"] = true;
								window[Data.CallOptions.PageId + "FullRetryFailed"] = true;*/
                            }
                            if (Data.CallOptions.HTMLCallSucceeded != undefined) {
                                if (Data.CallOptions.HTMLCallSucceeded == false) {
                                    AjaxCallInfoArr[Data.CallOptions.PageJSPath].AjaxCallingThread.abort();
                                }
                            }
                            if (parseInt(StatusCode) == StatusCode && StatusCode != 0 && (navigator.onLine == true && Globals.CustomCheckedNavIsOnlie == true)) {
                                DisplayServerErrorFlag = true;
                            }
                            else if (Data.XHR.error != "error") {
                                DisplayServerErrorFlag = false;
                                DisplayTechnicalErrorFlag = true;
                            }
                            if (DisplayServerErrorFlag) {
                                if (eval('Globals.WidgetsRetrialsInfo["' + Data.CallOptions.PageId + '"].DisplayCommErrFlag').toString().toLowerCase() == 'true') {
                                    DisplayServerError(StatusCode);
                                }
                            } else if (DisplayTechnicalErrorFlag) {
                                if (eval('Globals.WidgetsRetrialsInfo["' + Data.CallOptions.PageId + '"].DisplayCommErrFlag').toString().toLowerCase() == 'true') {
                                    DisplayMWTechnicalErrors(Data);
                                }
                            }
                            else {
                                if (eval('Globals.WidgetsRetrialsInfo["' + Data.CallOptions.PageId + '"].DisplayCommErrFlag').toString().toLowerCase() == 'true') {
                                    DisplayCommunicationError();
                                }

                            }
                            setTimeout(function () {
                                window[Data.CallOptions.PageId + "FullRetryFailed"] = false;
                                window[Data.CallOptions.PageId + "NoOfRetries"] = 0;
                                HideLoadingSpinner();
                            }
                                , 2000);

                        }
                    } else {
                        DisplayCommunicationError();
                        HideLoadingSpinner();
                    }

                }
            }
        } catch (e) {

        }


        log('Failure For FormID: ' + FormID);
        log(Data);
    }
    Options.OnCallSuccessFunction = OnCallSuccessFunction;
    Options.OnCallFailureFunction = OnCallFailureFunction;
    Options.LoadAndRunFormFuncParams = FncPramsData;
    Options.IsRetrialCall = false;
    if (Options.IsDialog) {
        try {
            $.mobile.sdCurrentDialog.close();
        } catch (e) {

        }
        GetPageHTMLThenDisplayDialog(PageId, !Options.PostData ? '' : Options.PostData, !Options.DialogWidth ? '' : Options.DialogWidth, !Options.HideHeaderCloseButton ? false : Options.HideHeaderCloseButton, !Options.DialogBlankContent ? "" : Options.DialogBlankContent
            , !Options.GetFreshDataFromServer ? false : Options.GetFreshDataFromServer, !Options.SkipSettingCache ? false : Options.SkipSettingCache, '', "", !Options.ShowRefreshIcon ? false : Options.ShowRefreshIcon, !Options.KeepDialogContentIFDisplayed ? false : Options.KeepDialogContentIFDisplayed, !Options.HideFooter ? false : Options.HideFooter, !Options.DataTheme ? 'a' : Options.DataTheme, !Options.I_Position ? "" : Options.I_Position, !Options.hideHeader ? false : Options.HideHeader, !Options.HideBlankContent ? false : Options.HideBlankContent, Options);

    } else {
        GetPageHTML(PageId, !Options.PostData ? '' : Options.PostData, Options.GetFreshDataFromServer,
            Options.SkipSettingCache, Options.AdditionalSuccessCallBack,
            Options.AdditionalFailureCallBack, Options.SkipStaticPageChecking,
            Options.IgnoreSpinner, Options);
    }
}

function DisplayMWTechnicalErrors(data) {

    try {
        var StatusCode = "";
        if (Globals.AjaxErrorDescription != null) {
            for (var m = 0; m < Globals.AjaxErrorDescription.length; m++) {
                if (data.XHR.statusText.toLowerCase().indexOf(Globals.AjaxErrorDescription[m].ErrorDesc.toLowerCase()) != - 1) {
                    StatusCode = Globals.AjaxErrorDescription[m].ErrorCode;
                } /* else if (data.XHR.error.toLowerCase().indexOf(Globals.AjaxErrorDescription[m].ErrorDesc.toLowerCase()) != - 1) {
                    StatusCode = Globals.AjaxErrorDescription[m].ErrorCode;
                    break;
                } */
            }
            window.Globals = window.Globals || {};
            Globals.ServerErrorEN = Globals.ServerErrorEN || "Technical problem has encountered, Please try again later. (#ErrCode#)";
            Globals.ServerErrorAR = Globals.ServerErrorAR || "<div style='direction:rtl'> خطأ فني في الخدمة. الرجاء المحاولة مرة أخرى (#ErrCode#)</div>";
            var ErrorEN = Globals.ServerErrorEN;
            var ErrorAR = Globals.ServerErrorAR;
            if (StatusCode != "") {
                ErrorEN = ErrorEN.replace("#ErrCode#", StatusCode);
                ErrorAR = ErrorAR.replace("#ErrCode#", StatusCode);
                AlertFunction(ErrorEN, ErrorAR, "Sorry", "عفواً", "OK", "موافق", "");
                HandleReportCaseCommonBusiness();

            } else {
                DisplayCommunicationError();
            }
        } else {
            DisplayCommunicationError();
        }
    } catch (e) {
        log(e);
    }
}

function GetPageHTML(PageId, PostData, GetFreshDataFromServer, SkipSettingCache, AdditionalSuccessCallBack, AdditionalFailureCallBack, SkipStaticPageChecking, IgnoreSpinner, Options) {
    try {

        var LogPrefixStr = 'GetPageHTML,PageId: ' + PageId;
        try { eval(PageId + '_BeforeGetPageHTML()'); } catch (e) { }
        if (window[PageId + '_OnGetPageHTMLAddtionalPostData'] != null && window[PageId + '_OnGetPageHTMLAddtionalPostData'] != undefined) {
            PostData = AddToPostData(PostData, window[PageId + '_OnGetPageHTMLAddtionalPostData']);
        }

        log('Start GetPageHTML, PageId: ' + PageId);
        var PageCacheSettings = new CacheSettings.constructor();
        PageCacheSettings = CacheSettingsArr[PageId];

        if (PageCacheSettings == null) {
            log("No CacheSettings Found For PageId: " + PageId);
            return;
        }
        if (!IgnoreSpinner)
            IgnoreSpinner = false;

        if (IgnoreSpinner) {
            ShowHideSpinner(PageId, false);
        } else {
            ShowHideSpinner(PageId, true);
        }
        //log('PageCacheSettings: ' + CacheSettingsArr[PageId]); 

        var CheckCacheFirst = false;
        var MustCallServer = false;

        if (!GetFreshDataFromServer)
            GetFreshDataFromServer = false;

        if (!SkipSettingCache)
            SkipSettingCache = false;

        if (!AdditionalSuccessCallBack)
            AdditionalSuccessCallBack = '';

        if (!AdditionalFailureCallBack)
            AdditionalFailureCallBack = '';

        AdditionalSuccessCallBack = '' + AdditionalSuccessCallBack;
        AdditionalFailureCallBack = '' + AdditionalFailureCallBack;

        if (!SkipStaticPageChecking) {
            SkipStaticPageChecking = false;
        }

        if (Options == undefined)
            Options = {};
        Options.PageId = PageId;
        Options.IgnoreSpinner = IgnoreSpinner;
        Options.Embedded = PageCacheSettings.EmbeddedOnDevice;
        var OnCallSuccessFunction = (Options.OnCallSuccessFunction != undefined) ? Options.OnCallSuccessFunction : function () { }; Options.OnCallSuccessFunction = OnCallSuccessFunction;
        var OnCallFailureFunction = (Options.OnCallFailureFunction != undefined) ? Options.OnCallFailureFunction : function () { }; Options.OnCallFailureFunction = OnCallFailureFunction;
        var DisableAnimation = (Options.DisableAnimation != undefined) ? Options.DisableAnimation : false; Options.DisableAnimation = DisableAnimation;



        var OnCallSuccessAction = '/*DataSignatureCheck*/' + PageCacheSettings.OnCallSuccessAction + '; /*CacheCall*/ ; ' + AdditionalSuccessCallBack + '; SetPageLastUpdateTimeLbl("' + PageId + '","' + PageCacheSettings.ShowDateTimeStamp + '"); ShowHideSpinner("' + PageId + '", false);';
        var OnCallFailureAction = PageCacheSettings.OnCallFailureAction + ';' + AdditionalFailureCallBack + '; ShowHideSpinner("' + PageId + '", false);';
        var PageURL = ((AppLang == 'en') ? PageCacheSettings.PagePath : PageCacheSettings.PagePath_AR);
        var PageJSPath = PageCacheSettings.CodeBehindJSPath;
        if (PageCacheSettings.CacheEnabled == true) {
            //alert(PageId + ': ' + PageURL + ':- Cache enabled');
            log(PageURL + ':- Cache enabled');
            if (GetFreshDataFromServer == true || PageCacheSettings.ShowDataMode.toLowerCase() == 'ShowEmptyPageAndRefresh'.toLowerCase()) {
                MustCallServer = true;
            }
            else {
                //alert(PageCacheSettings.ShowDataMode);
                if (PageCacheSettings.ShowDataMode.toLowerCase() == 'ShowStaticPageAndRefresh'.toLowerCase()) {
                    //Get Static Page Then Get Data From Server Here
                    if (SkipStaticPageChecking == false) {
                        var StaticPageAdditionalCallBack =
                            ";GetPageHTML('" + PageURL + "','" + PostData + "','" + GetFreshDataFromServer + "','" + SkipSettingCache
                            + "','" + AdditionalSuccessCallBack + "','" + AdditionalFailureCallBack + "',true);";
                        GetPageHTML(PageCacheSettings.StaticPageID, '', false, false, OnCallSuccessAction + StaticPageAdditionalCallBack, OnCallFailureAction + StaticPageAdditionalCallBack, true);
                        return;
                    }
                }
                else if (PageCacheSettings.ShowDataMode.toLowerCase() == 'ShowFromCacheAndRefreshWhenCacheIsExpired'.toLowerCase()) {
                    CheckCacheFirst = true;
                }
                else if (PageCacheSettings.ShowDataMode.toLowerCase() == 'ShowFromCacheAndRefreshAlways'.toLowerCase()) {
                    CheckCacheFirst = true;
                    MustCallServer = true;
                }
            }

        }
        else {
            log(PageId + ': ' + PageURL + ':- Cache NOT enabled');
            MustCallServer = true;
        }



        OnCallSuccessAction = 'var CallBackExecutionStartDate = new Date(); ' + OnCallSuccessAction + ' var CallBackExecutionFinishDate = new Date(); log("For ' + PageId + ': CallBack Execution Time Taken " + (CallBackExecutionFinishDate - CallBackExecutionStartDate));';

        var CachedXMLHttpResponseHeaders = new CachedObject.constructor();
        CachedXMLHttpResponseHeaders = GetFromCache(PageId + PageURL + PostData + GlobalAdditionalCachingKey + '_XMLHttpResponseHeaders');

        if (CheckCacheFirst) {
            //alert(PageURL + ':- Checking Cache');
            log(PageURL + ':- Checking Cache');
            var CachedData = new CachedObject.constructor();
            CachedData = GetFromCache(PageId + PageURL + PostData + GlobalAdditionalCachingKey);
            var CachedJSData = null;
            try {
                if (PageCacheSettings.PageHasJS) {
                    CachedJSData = GetFromCache(PageId + PageJSPath + PostData + GlobalAdditionalCachingKey);
                }
            } catch (e) {
            }
            if (!CachedData || CachedXMLHttpResponseHeaders == false) {
                //alert(PageURL + ':- CachedData = false');
                log(PageURL + ':- NO CachedData FOUND');
                MustCallServer = true;
            }
            else {
                //check if cache expired here
                try {


                    var AjaxCallInfoObj = new AjaxCallInfo.constructor();
                    AjaxCallInfoArr[PageURL] = AjaxCallInfoObj;
                    AjaxCallInfoArr[PageURL].URL = PageURL;
                    AjaxCallInfoArr[PageURL].RespHtml = CachedData.CachedStr;
                    try {
                        AjaxCallInfoArr[PageURL].RespJS = CachedJSData.CachedStr;
                        log(LogPrefixStr + ': Code Behind JS Gotten From Cache >> ' + PageJSPath);
                    } catch (e) {
                    }

                    /**********************************************************************************
                    var CachedXMLHttpResponseHeaders = new CachedObject.constructor();
                    CachedXMLHttpResponseHeaders = GetFromCache(PageId + PageURL + PostData + GlobalAdditionalCachingKey + '_XMLHttpResponseHeaders');
                    **********************************************************************************/

                    var CustomXMLHTTPResponseObj = clone(CustomXMLHTTPResponse);

                    CustomXMLHTTPResponseObj.ResponseHeadersArr = GetResponseHeadersArr(CachedXMLHttpResponseHeaders.CachedStr);

                    AjaxCallInfoArr[PageURL].XMLHttpResponse = CustomXMLHTTPResponseObj;

                    try { HandleHttpResponseHeaders(AjaxCallInfoArr[PageURL].XMLHttpResponse); } catch (e) { }

                    log(PageURL + ':- Data Gotten From Cache, CachingTime: ' + CachedData.CachingTime + ', CacheExpiryInterval: ' + PageCacheSettings.CacheExpiryInterval);

                    window[PageId + '_LastUpdateTime'] = CachedData.CachingTime;

                    var CacheIsExpired = false;
                    if (new Date() - new Date(getDateFromFormat(CachedData.CachingTime, 'dd/MM/yyyy hh:mm:ss a')) >= PageCacheSettings.CacheExpiryInterval * 60 * 1000) {
                        CacheIsExpired = true;
                        MustCallServer = true;
                        log(PageURL + ':- CachedData Expired');
                        OnCallSuccessAction = 'RemovePageDataSourcesCache("' + PageId + '"); ' + OnCallSuccessAction;
                    }
                    else {
                        //OnCallSuccessAction = OnCallSuccessAction + '; AnimatePage("' + PageId + '");';
                    }

                    //alert(OnCallSuccessAction);
                    if (CacheIsExpired == false) {
                        try { eval(OnCallSuccessAction); } catch (e) { }
                        try { OnCallSuccessFunction({ AjaxCallInfoObj: AjaxCallInfoObj }) } catch (e) { }
                    }
                } catch (e) {
                    MustCallServer = true;
                    logErr(e);
                }

            }
        }


        if (MustCallServer) {
            if (DisableAnimation == true)
                OnCallSuccessAction = OnCallSuccessAction + '; AnimatePage("' + PageId + '");';
            log(PageURL + ':- Calling Server');
            if (SkipSettingCache == false) {
                //OnCallSuccessAction = '; CachePageHtml("' + PageId + '","' + PageURL + '","' + PostData + '"); log("Done Calling Server And Caching for: ' + PageURL + '"); ' + OnCallSuccessAction;
                OnCallSuccessAction = OnCallSuccessAction.replace('/*CacheCall*/', '; CachePageHtml("' + PageId + '","' + PageURL + '","' + PostData + '");') + ' log("Done Calling Server for: ' + PageURL + '"); ';
            }
            //alert(123);
            if (IgnoreSpinner) {
                ShowHideSpinner(PageId, false);
            } else {
                ShowHideSpinner(PageId, true);
            }

            if (PageCacheSettings.CacheEnabled == true && PageCacheSettings.DataSignatureEnabled == true) {
                try {
                    if (AjaxCallInfoArr[PageURL] != undefined && AjaxCallInfoArr[PageURL].XMLHttpResponse != undefined) {
                        var OldDataSignature = AjaxCallInfoArr[PageURL].XMLHttpResponse.getResponseHeader('DataSignature');
                        if (OldDataSignature != undefined) {
                            log('For Page: ' + PageId + ', OldDataSignature: ') + OldDataSignature;
                            window[PageId + '_CachedDataSignature'] = OldDataSignature;
                            PostData = AddToPostData(PostData, '<NotInCacheKey>&DataSignature=' + window[PageId + '_CachedDataSignature'] + '</NotInCacheKey>');
                            window[PageId + '_CachedRespHtml'] = AjaxCallInfoArr[PageURL].RespHtml;

                            window[PageId + '_CachedXMLHttpResponseHeaders'] = AjaxCallInfoArr[PageURL].XMLHttpResponse;
                            OnCallSuccessAction = OnCallSuccessAction.replace('/*DataSignatureCheck*/', 'CheckDataSignature("' + PageId + '");');
                        }
                    }
                } catch (e) {
                    alert(e);
                }
            }
            log('GetPageHTML for PageId: ' + PageId + ', Checking PageCacheSettings.PageHasHTML: ' + PageCacheSettings.PageHasHTML + ', PageCacheSettings.PageHasJS: ' + PageCacheSettings.PageHasJS);

            if (Globals.ForceGetAllFormsFromDevice == true || (Globals.FormIDsToBeGottenFromDeviceArr != undefined && Globals.FormIDsToBeGottenFromDeviceArr[PageId] != undefined)) {
                Globals.URLsToBeGottenFromDeviceArr = Globals.URLsToBeGottenFromDeviceArr || {};
                Globals.URLsToBeGottenFromDeviceArr[PageURL] = PageId;
                Globals.URLsToBeGottenFromDeviceArr[PageJSPath] = PageId;
            }
            //alert('Globals.FormIDsToBeGottenFromDeviceArr: ' + Globals.FormIDsToBeGottenFromDeviceArr[PageId]);

            if ((PageCacheSettings.PageHasHTML == true && PageCacheSettings.PageHasJS == false) ||
                (PageCacheSettings.PageHasHTML == false && PageCacheSettings.PageHasJS == true)) {
                log('GetPageHTML for PageId: ' + PageId + ', Calling AjaxPostCallURL for: ' + PageURL);
                Options.HTMLCallSucceeded = true;
                Options.JSCallSucceeded = false;
                AjaxPostCallURL(PageURL, PostData, OnCallSuccessAction, OnCallFailureAction, Options);
            } else if (PageCacheSettings.PageHasHTML == true && PageCacheSettings.PageHasJS == true) {
                window['GetPageHTMLFinishedFor_' + PageId] = false;
                window['GetPageJSFinishedFor_' + PageId] = false;


                CheckIfBothHTMLANDJSGottenJSStr = "if(window['GetPageJSFinishedFor_" + PageId + "'] != true || window['GetPageJSFinishedFor_" + PageId + "'] != true){} else{ log('" +
                    LogPrefixStr + " :- Both GetPageJSFinishedFor_" + PageId + ", GetPageJSFinishedFor_" + PageId + " = true'); ";
                var OnCallJSSuccessAction = "window['GetPageJSFinishedFor_" + PageId + "'] = true; " + CheckIfBothHTMLANDJSGottenJSStr + " " + OnCallSuccessAction + " }";
                var OnCallJSFailureAction = "window['GetPageJSFinishedFor_" + PageId + "'] = true; " + CheckIfBothHTMLANDJSGottenJSStr + " " + OnCallFailureAction + " }";
                OnCallSuccessAction = "window['GetPageHTMLFinishedFor_" + PageId + "'] = true; " + CheckIfBothHTMLANDJSGottenJSStr + " " + OnCallSuccessAction + " }";
                OnCallFailureAction = "window['GetPageHTMLFinishedFor_" + PageId + "'] = true; " + CheckIfBothHTMLANDJSGottenJSStr + " " + OnCallFailureAction + " }";

                if (Options == null)
                    Options = {};
                var JSCallOptions = {};
                JSCallOptions.Embedded = true;
                Options.PageId = JSCallOptions.PageId = PageId;
                Options.OrignalGetHTMLSuccessFunction = JSCallOptions.OrignalGetHTMLSuccessFunction = Options.OnCallSuccessFunction;
                //Options.OrignalGetHTMLSuccessFunction = JSCallOptions.OrignalGetHTMLSuccessFunction = Options.GetHTMLSuccessFunction;
                Options.PageURL = JSCallOptions.PageURL = PageURL;
                Options.PageJSPath = JSCallOptions.PageJSPath = PageJSPath;
                Options.PostData = JSCallOptions.PostData = PostData;
                Options.SkipSettingCache = JSCallOptions.SkipSettingCache = SkipSettingCache;

                var OriginalGetJSSuccessFunction = Options.OriginalGetJSSuccessFunction = JSCallOptions.OriginalGetJSSuccessFunction = function (Data) {
                    //GetPageAjaxCallInfo(Data.CallOptions.PageId).RespJS = Data.RespHtml;
                    GetPageAjaxCallInfo(PageId).RespJS = Data.AjaxCallInfoObj.RespHtml;
                    if (!SkipSettingCache)
                        CachePageHtml(PageId, PageJSPath, PostData);
                }

                var GetJSSuccessFunction = Options.GetJSSuccessFunction = JSCallOptions.GetJSSuccessFunction = function (Data) {
                    window['GetPageJSFinishedFor_' + Data.CallOptions.PageId] = true;
                    if (window['GetPageHTMLFinishedFor_' + Data.CallOptions.PageId] == true && window['GetPageJSFinishedFor_' + Data.CallOptions.PageId] == true) {
                        Data.CallOptions.OriginalGetJSSuccessFunction({ AjaxCallInfoObj: AjaxCallInfoArr[Data.CallOptions.PageJSPath] });
                        Data.CallOptions.OrignalGetHTMLSuccessFunction({ AjaxCallInfoObj: GetPageAjaxCallInfo(Data.CallOptions.PageId) });
                    }
                }

                var GetHTMLSuccessFunction = function (Data) {
                    window['GetPageHTMLFinishedFor_' + Data.CallOptions.PageId] = true;
                    if (window['GetPageHTMLFinishedFor_' + Data.CallOptions.PageId] == true && window['GetPageJSFinishedFor_' + Data.CallOptions.PageId] == true) {
                        Data.CallOptions.OriginalGetJSSuccessFunction({ AjaxCallInfoObj: AjaxCallInfoArr[Data.CallOptions.PageJSPath] });
                        Data.CallOptions.OrignalGetHTMLSuccessFunction({ AjaxCallInfoObj: GetPageAjaxCallInfo(Data.CallOptions.PageId) });
                    }
                }

                Options.OnCallSuccessFunction = GetHTMLSuccessFunction;
                //Options.OnCallFailureFunction =
                JSCallOptions.OnCallSuccessFunction = GetJSSuccessFunction;
                JSCallOptions.OnCallFailureFunction = OnCallFailureFunction;
                JSCallOptions.LoadAndRunFormFuncParams = Options.LoadAndRunFormFuncParams;
                //JSCallOptions.OnCallFailureFunction = 
                Options.HTMLCallSucceeded = false;
                AjaxPostCallURL(PageURL, PostData, OnCallSuccessAction, OnCallFailureAction, Options);
                setTimeout(function () {
                    console.log(123);
                    JSCallOptions.JSCallSucceeded = false;
                    AjaxPostCallURL(PageJSPath, PostData, OnCallJSSuccessAction, OnCallJSFailureAction, JSCallOptions);
                }
                    , 100);


            }
        }
    } catch (e) {
        logErr(e);
    }
}

function CheckDataSignature(PageId) {
    try {
        var PageCacheSettings = GetPageCacheSettings(PageId);
        if (PageCacheSettings.CacheEnabled == true && PageCacheSettings.DataSignatureEnabled == true) {
            //alert(6)
            var PageURL = AppLang == 'en' ? PageCacheSettings.PagePath : PageCacheSettings.PagePath_AR;

            var NewDataSignature = AjaxCallInfoArr[PageURL].XMLHttpResponse.getResponseHeader('DataSignature');
            //alert(window[PageId + '_CachedDataSignature'] + "\n\n" + NewDataSignature + "\n\n" + window[PageId + '_CachedDataSignature']);
            if (window[PageId + '_CachedDataSignature'] == NewDataSignature && window[PageId + '_CachedDataSignature'] != undefined) {
                //alert(7);
                log('\n\n\n');
                log('************================================================================================================************');
                log('New Response HTML: \n ' + AjaxCallInfoArr[PageURL].RespHtml + '\n\nOld Cache: \n' + window[PageId + '_CachedRespHtml']);
                log('************================================================================================================************');
                log(AjaxCallInfoArr[PageURL].XMLHttpResponse);
                //alert('New Response HTML: \n ' + AjaxCallInfoArr[PageURL].RespHtml + '\n\nOld Cache: \n' + window[PageId + '_CachedRespHtml']);
                AjaxCallInfoArr[PageURL].RespHtml = window[PageId + '_CachedRespHtml'];
                AjaxCallInfoArr[PageURL].XMLHttpResponse = window[PageId + '_CachedXMLHttpResponseHeaders'];

            }
            //PostData = AddToPostData(PostData,'<NotInCacheKey>;DataSignature=' + window[PageId + '_CachedDataSignature'] + '</NotInCacheKey>';

            //OnCallSuccessAction = OnCallSuccessAction.replace('/*DataSignatureCheck*/','CheckDataSignature("' + PageId + '");');
        }
    } catch (e) {
        alert(e);
    }
}

var CurrentNavPosition = 0;
function PushWidget(WidgetID, RightDivHTML, LeftDivHTML, AnimationType, GetPageHTMLFlag) {
    try {
        $('#' + WidgetID).show();
        var WindowWidth = $(window).width();
        var NewLeftPadding = (CurrentNavPosition + 1) * WindowWidth;
        $('#' + WidgetID).parent().parent().css('position', 'absolute').css('left', NewLeftPadding + 'px');
        $('#' + 'PageContent').animate({ 'left': '-=' + WindowWidth }, 600);
        CurrentNavPosition++;

    } catch (e) {

    }
}


// Clears The PostData Str from tag: <NotInCacheKey></NotInCacheKey> and it's content
function GetCachingKeyFromPostData(PostData) {
    //var PostData = '<NotInCacheKey>CallBE=true</NotInCacheKey>' + '&Language=' + Language
    //var PostData = 'CallBE=true&Language=' + Language
    var PostDataCachingKeyPart, FormattedPostData;
    PostDataCachingKeyPart = FormattedPostData = PostData;
    if (PostData.toLowerCase().indexOf('<notincachekey>') != -1 && PostData.toLowerCase().indexOf('</notincachekey>') != -1) {
        var NotInCacheKeyPartStartIndex = PostData.toLowerCase().indexOf('<notincachekey>');
        var NotInCacheKeyPartEndIndex = PostData.toLowerCase().indexOf('</notincachekey>') + '</notincachekey>'.length;
        var NotInCacheKeyPart = PostData.substring(NotInCacheKeyPartStartIndex, NotInCacheKeyPartEndIndex);
        var PostDataCachingKeyPart = PostData.replace(NotInCacheKeyPart, '');
        var FormattedPostData = PostData.replace(PostData.substring(NotInCacheKeyPartStartIndex, NotInCacheKeyPartStartIndex + '<NotInCacheKey>'.length), '')
            .replace(PostData.substring(NotInCacheKeyPartEndIndex - '</NotInCacheKey>'.length, NotInCacheKeyPartEndIndex), '');
        //alert(NotInCacheKeyPart);
    }
    return PostDataCachingKeyPart;
    //alert(FormattedPostData);
}


// Clears The PostData Str from tag: <NotInCacheKey></NotInCacheKey>
function GetFormattedPostData(PostData) {
    //var PostData = '<NotInCacheKey>CallBE=true</NotInCacheKey>' + '&Language=' + Language
    //var PostData = 'CallBE=true&Language=' + Language
    var PostDataCachingKeyPart, FormattedPostData;
    PostDataCachingKeyPart = FormattedPostData = PostData;
    if (PostData.toLowerCase().indexOf('<notincachekey>') != -1 && PostData.toLowerCase().indexOf('</notincachekey>') != -1) {
        var NotInCacheKeyPartStartIndex = PostData.toLowerCase().indexOf('<notincachekey>');
        var NotInCacheKeyPartEndIndex = PostData.toLowerCase().indexOf('</notincachekey>') + '</notincachekey>'.length;
        var NotInCacheKeyPart = PostData.substring(NotInCacheKeyPartStartIndex, NotInCacheKeyPartEndIndex);
        var PostDataCachingKeyPart = PostData.replace(NotInCacheKeyPart, '');
        var FormattedPostData = PostData.replace(PostData.substring(NotInCacheKeyPartStartIndex, NotInCacheKeyPartStartIndex + '<NotInCacheKey>'.length), '')
            .replace(PostData.substring(NotInCacheKeyPartEndIndex - '</NotInCacheKey>'.length, NotInCacheKeyPartEndIndex), '');
        //alert(NotInCacheKeyPart);
    }
    //return PostDataCachingKeyPart;
    return FormattedPostData;
}

//try {
//    eval('/*CacheCall*/ alert("done");');
//} catch (e) {
//alert(e);
//}

function SetPageLastUpdateTimeLbl(PageId, ShowDateTimeStamp) {
    try {
        if (!ShowDateTimeStamp)
            ShowDateTimeStamp = '';
        if (ShowDateTimeStamp.toLowerCase() == 'Custom'.toLowerCase()) {
            log(PageId + ':- ShowDateTimeStamp is Custom, Will Not Continue In SetPageLastUpdateTimeLbl()');
            return;
        }
        //alert(12);
        if (!window[PageId + '_LastUpdateTime']) {
            logWarn(PageId + '_LastUpdateTime' + ' is EMPTY, WILL Empty Data TimeStamp Labels...')
            if (ShowDateTimeStamp.toLowerCase() == 'ShowInHeader'.toLowerCase()) {
                try { $('#' + PageId + '_LastUpdateTimeHeaderLbl').html(''); } catch (e) { }
                try { $(".DialogHeaderLastUpdateTimeLbl").html(''); } catch (e) { }
            }
            else if (ShowDateTimeStamp.toLowerCase() == 'ShowInFooter'.toLowerCase()) {
                $('#' + PageId + '_LastUpdateTimeFooterLbl').html('');
            }
            return;
        }
        //alert(CachingDate.getFullYear() + '& CS:- ' + window[PageId + '_LastUpdateTime']);

        if (!ShowDateTimeStamp)
            ShowDateTimeStamp = '';
        var CachingDate = new Date(getDateFromFormat(window[PageId + '_LastUpdateTime'], 'dd/MM/yyyy hh:mm:ss a'));
        if (formatDate(new Date(), 'dd/MM/yyyy') != formatDate(CachingDate, 'dd/MM/yyyy'))
            CachingDate = formatDate(CachingDate, 'dd/MM hh:mm a');
        else
            CachingDate = formatDate(CachingDate, 'hh:mm a');
        var LastUpdateStr = '';

        if (AppLang == 'en') {
            LastUpdateStr = 'Since ' + CachingDate;
        }
        else {
            LastUpdateStr = 'منذ ' + CachingDate.replace('AM', 'ص').replace('PM', 'م');
        }



        if (ShowDateTimeStamp.toLowerCase() == 'ShowInHeader'.toLowerCase()) {
            try { $('#' + PageId + '_LastUpdateTimeHeaderLbl').html(LastUpdateStr); } catch (e) { }
            try { $(".DialogHeaderLastUpdateTimeLbl").html(LastUpdateStr); } catch (e) { }
        }
        else if (ShowDateTimeStamp.toLowerCase() == 'ShowInFooter'.toLowerCase()) {
            $('#' + PageId + '_LastUpdateTimeFooterLbl').html(LastUpdateStr);
        }
    } catch (e) {
        logErr(e);
        //alert(e);
    }

}

function CachePageHtml(PageId, PageURL, PostData) {
    try {
        if (window['AppCacheHTMLIsDisabled'] == true) {
            log('AppCacheHTMLIsDisabled = true, WILL NOT CACHE HTML');
            return;
        }
        PostData = GetCachingKeyFromPostData(PostData);
        var ToBeCachedObj = new CachedObject.constructor();
        var AjaxCallInfoObj = new AjaxCallInfo.constructor();
        AjaxCallInfoObj = AjaxCallInfoArr[PageURL];
        var SessionActiveIndicator = AjaxCallInfoObj.XMLHttpResponse.getResponseHeader('SessionActiveIndicator') + '';


        var PageCacheSettings = GetPageCacheSettings(PageId);
        if (SessionActiveIndicator == 'null' && (PageCacheSettings.EmbeddedOnDevice == undefined || PageCacheSettings.EmbeddedOnDevice == false)) {
            log(PageURL + ":- SessionActiveIndicator is empty, Will Not Cache Response for " + PageId);
            //alert("SessionActiveIndicator is empty, Will Not Cache Response for " + PageId);
            return;
        }

        if (returnBoolean(AjaxCallInfoObj.XMLHttpResponse.getResponseHeader('SkipCachingCurrentResponse') + '') == true) {
            log(PageURL + ":- SkipCachingCurrentResponse = true, Will Not Cache Response for " + PageId);
            return;
        }

        var CurrentDate = new Date();
        ToBeCachedObj.CachingTime = formatDate(CurrentDate, 'dd/MM/yyyy hh:mm:ss a');
        window[PageId + '_LastUpdateTime'] = formatDate(CurrentDate, 'dd/MM/yyyy hh:mm:ss a');
        ToBeCachedObj.CachedStr = AjaxCallInfoObj.RespHtml;
        //RemovePageDataSourcesCache(PageId);
        var CacheKey = PageId + PageURL + PostData + GlobalAdditionalCachingKey;
        SetToCache(CacheKey, ToBeCachedObj);
        AddCacheKeyToPageDataSourcesCache(PageId, CacheKey);

        // Caching XMLHttpResponseHeaders
        var XMLHttpResponseHeadersCacheKey = PageId + PageURL + PostData + GlobalAdditionalCachingKey + '_XMLHttpResponseHeaders';
        ToBeCachedObj.CachedStr = AjaxCallInfoObj.XMLHttpResponse.getAllResponseHeaders(); // JSON.stringify(AjaxCallInfoObj.XMLHttpResponse);
        SetToCache(XMLHttpResponseHeadersCacheKey, ToBeCachedObj);
        AddCacheKeyToPageDataSourcesCache(PageId, XMLHttpResponseHeadersCacheKey);

    } catch (e) {
        log(e.StackTrace);
    }

}

function AddCacheKeyToPageDataSourcesCache(PageId, PageCacheKey) {
    log('========================= Start AddCacheKeyToPageDataSourcesCache For: ' + PageId + ' =========================');
    try {
        var PageDataSourcesCommaSeprated = GetPageCacheSettings(PageId).DataSourceAndDependents;
        if (PageDataSourcesCommaSeprated == null || PageDataSourcesCommaSeprated + '' == '') {
            log(PageId + ':- DataSource is Empty, Will Not AddCacheKeyToPageDataSourcesCache');
            return;
        }
        else {
            var PageDataSourcesArr = PageDataSourcesCommaSeprated.split(',');
            log(PageId + ': Adding to DataSources CachingKey: ' + PageCacheKey);
            for (var Key in PageDataSourcesArr) {
                AddCacheKeyToDataSourceCache(PageDataSourcesArr[Key], PageCacheKey);
                log(PageId + ': Cache Key Added To DataSource: ' + PageDataSourcesArr[Key]);
            }
            log(PageId + ': Done AddCacheKeyToPageDataSourcesCache');
        }
    } catch (e) {
        logErr(e.StackTrace);
        alert(e.StackTrace);
    }
    log('========================= Finished AddCacheKeyToPageDataSourcesCache For: ' + PageId + ' =========================');
}

function RemovePageDataSourcesCache(PageId) {
    log('========================= Start RemovePageDataSourcesCache For: ' + PageId + ' =========================');
    try {
        var PageDataSourcesCommaSeprated = GetPageCacheSettings(PageId).DataSourceAndDependents;
        if (PageDataSourcesCommaSeprated == null || PageDataSourcesCommaSeprated + '' == '') {
            log(PageId + ':- DataSource is Empty, Will Not RemovePageDataSourcesCache');
            return;
        }
        else {
            var PageDataSourcesArr = PageDataSourcesCommaSeprated.split(',');
            for (var Key in PageDataSourcesArr) {

                var CachedData = new CachedObject.constructor();
                CachedData = GetFromCache(PageDataSourcesArr[Key]);
                log(PageId + ': Removing From PageDataSourcesArr[Key]: ' + PageDataSourcesArr[Key]);
                var KeysUnderDataSourceArr = new Array()
                if (CachedData != false) {
                    KeysUnderDataSourceArr = JSON.parse(CachedData.CachedStr);
                    for (var itemkey in KeysUnderDataSourceArr) {
                        try {
                            var EncKey = KeysUnderDataSourceArr[itemkey];
                            if (Globals.EncryptCachedFiles) {

                                EncKey = encrypter.encrypt(EncKey);
                            }
                            localStorage.clear(EncKey);
                            log(PageId + ': Removed Cache With Key: ' + KeysUnderDataSourceArr[itemkey]);
                        } catch (e) {
                            logWarn(e);
                        }

                    }
                    var EncKey = PageDataSourcesArr[Key];
                    if (Globals.EncryptCachedFiles)
                        EncKey = encrypter.encrypt(EncKey);
                    localStorage.clear(EncKey);
                    log(PageId + ': Done Removing Cache With Keys under PageDataSourcesArr[Key]: ' + PageDataSourcesArr[Key]);
                }

            }
        }
    } catch (e) {
        logErr(e);
        alert(e);
    }
    log('========================= Finished RemovePageDataSourcesCache For: ' + PageId + ' =========================');
}

function AddCacheKeyToDataSourceCache(DataSourceOrDependentName, CacheKey) {
    try {
        var CachedData = new CachedObject.constructor();
        CachedData = GetFromCache(DataSourceOrDependentName);
        var KeysUnderDataSourceArr = new Array()
        if (CachedData != false) {
            KeysUnderDataSourceArr = JSON.parse(CachedData.CachedStr);
            log('KeysUnderDataSourceArr: ' + KeysUnderDataSourceArr);
        }
        KeysUnderDataSourceArr[CacheKey] = CacheKey;
        var ToBeCachedObj = new CachedObject.constructor();
        var CurrentDate = new Date();
        ToBeCachedObj.CachingTime = formatDate(CurrentDate, 'dd/MM/yyyy hh:mm:ss a');
        ToBeCachedObj.CachedStr = JSON.stringify(KeysUnderDataSourceArr);
        SetToCache(DataSourceOrDependentName, ToBeCachedObj);
    } catch (e) {
        logErr('AddCacheKeyToDataSourceCache Ex: ' + e.StackTrace);
        alert('AddCacheKeyToDataSourceCache Ex: ' + e.StackTrace);
    }
}

var CachedObject = {
    CachingTime: '',
    CachedStr: ''
}
function GetFromCache(Key) {
    //return;
    if (Globals.EncryptCachedFiles) {
        var object;
        var CachedStr = undefined;
        try {
            if (window['AppGetCachedHTMLIsDisabled'] == true) {
                log('AppGetCachedHTMLIsDisabled = true, WILL NOT GET FROM CACHE');
                return;
            }
            var EncryptedLocalStorageKey = encrypter.encrypt(Key);
            Key = EncryptedLocalStorageKey;
            if ('localStorage' in window && window['localStorage'] !== null) {
                var GetFromCacheStartDate = new Date();
                //log('START GetFromCache:- with Key: ' + Key);
                var EncCachedStr = localStorage.getItem(Key);
                //function DecryptStrRJ(Str, desKey, desIV) {

                CachedStr = encrypter.decrypt(EncCachedStr);
                object = JSON.parse(CachedStr);
                log('DONE GetFromCache:- with Key: ' + Key);
                var GetFromCacheFinishDate = new Date();
                log('For: ' + Key + '\n Time Taken: ' + (GetFromCacheFinishDate - GetFromCacheStartDate));

                return ((object != null) ? object : false);
            }
            else {
                return false;
            }
        } catch (e) {
            return CachedStr;
            return object;
        }
    }
    else {
        try {
            if (window['AppGetCachedHTMLIsDisabled'] == true) {
                log('AppGetCachedHTMLIsDisabled = true, WILL NOT GET FROM CACHE');
                return;
            }








            if ('localStorage' in window && window['localStorage'] !== null) {
                var GetFromCacheStartDate = new Date();
                //log('START GetFromCache:- with Key: ' + Key);
                var CachedStr = localStorage.getItem(Key);
                var object = JSON.parse(CachedStr);
                log('DONE GetFromCache:- with Key: ' + Key);
                var GetFromCacheFinishDate = new Date();
                log('For: ' + Key + '\n Time Taken: ' + (GetFromCacheFinishDate - GetFromCacheStartDate));

                return ((object != null) ? object : false);






            }
            else {
                return false;
            }
        } catch (e) {
            logErr(e);
        }
    }
}

function SetToCache(Key, Value) {
    //return;
    if (Globals.EncryptCachedFiles) {
        try {
            if ('localStorage' in window && window['localStorage'] !== null) {
                //log('START SetToCache:- with Key: ' + Key);
                var EncryptedLocalStorageKey = encrypter.encrypt(Key);
                var EncryptedVal = encrypter.encrypt(JSON.stringify(Value));
                Key = EncryptedLocalStorageKey;
                Value = EncryptedVal;
                try {
                    localStorage.setItem(Key, Value);
                    localStorage.setItem('D' + (new Date() - 0) + 'Key', Key);
                    var LSStoringDatesKeys = localStorage.getItem('LSStoringDatesKeys');

                    if (LSStoringDatesKeys == undefined)
                        LSStoringDatesKeys = '';
                    localStorage.setItem('D' + new Date() + 'Key', Key);
                    localStorage.setItem('LSStoringDatesKeys', (LSStoringDatesKeys + ',' + Key).trimStart(','));
                    window[Key + 'CacheTrialNo'] = 0;

                } catch (e) {
                    logErr('SetToCache Error: ' + e);
                    //localStorage.clear()																		  
                    var LSStoringDatesKeys = localStorage.getItem('LSStoringDatesKeys');
                    if (LSStoringDatesKeys == undefined)
                        LSStoringDatesKeys = '';
                    if (LSStoringDatesKeys != '' && window[Key + 'CacheTrialNo'] != 10) {
                        var LSStoringDatesKeysArr = LSStoringDatesKeys.split(',');

                        for (i = 0; i < LSStoringDatesKeysArr.length; i++) {
                            if (i == 2)
                                break;
                            var KeyToBeRemoved = localStorage.getItem(LSStoringDatesKeysArr[i]);
                            log('Clearing Local Storage Old Items.... ' + LSStoringDatesKeysArr[i] + ' : For Caching Key: ' + KeyToBeRemoved + ', localStorage.length: ' + localStorage.length);

                            localStorage.removeItem(KeyToBeRemoved);
                            LSStoringDatesKeys = LSStoringDatesKeys.replace(LSStoringDatesKeysArr[i], '').replace(',,', ',').trimStart(',').trimEnd(',');
                        }
                        localStorage.setItem('LSStoringDatesKeys', LSStoringDatesKeys);
                        if (window[Key + 'CacheTrialNo'] == undefined) {
                            window[Key + 'CacheTrialNo'] = 0;
                        }
                        window[Key + 'CacheTrialNo'] = window[Key + 'CacheTrialNo'] + 1;
                        SetToCache(Key, Value);
                    }
                    else {
                        return false;
                    }
                    log('Done Clearing Local Storage');
                }
                log('DONE SetToCache:- with Key: ' + Key);
                return true;
            }
            else {
                return false;
            }
        } catch (e) {
            logErr(e);
            return false;
        }
    }
    else {
        try {
            if ('localStorage' in window && window['localStorage'] !== null) {
                //log('START SetToCache:- with Key: ' + Key);
                try {
                    localStorage.setItem(Key, JSON.stringify(Value));
                    localStorage.setItem('D' + (new Date() - 0) + 'Key', Key);
                    var LSStoringDatesKeys = localStorage.getItem('LSStoringDatesKeys');
                    if (LSStoringDatesKeys == undefined)
                        LSStoringDatesKeys = '';
                    localStorage.setItem('D' + new Date() + 'Key', Key);
                    localStorage.setItem('LSStoringDatesKeys', (LSStoringDatesKeys + ',' + Key).trimStart(','));
                    window[Key + 'CacheTrialNo'] = 0;


                } catch (e) {
                    logErr('SetToCache Error: ' + e);
                    //localStorage.clear()																	
                    var LSStoringDatesKeys = localStorage.getItem('LSStoringDatesKeys');
                    if (LSStoringDatesKeys == undefined)
                        LSStoringDatesKeys = '';
                    if (LSStoringDatesKeys != '' && window[Key + 'CacheTrialNo'] != 10) {
                        var LSStoringDatesKeysArr = LSStoringDatesKeys.split(',');

                        for (i = 0; i < LSStoringDatesKeysArr.length; i++) {
                            if (i == 2)
                                break;
                            var KeyToBeRemoved = localStorage.getItem(LSStoringDatesKeysArr[i]);
                            log('Clearing Local Storage Old Items.... ' + LSStoringDatesKeysArr[i] + ' : For Caching Key: ' + KeyToBeRemoved + ', localStorage.length: ' + localStorage.length);
                            localStorage.removeItem(KeyToBeRemoved);
                            LSStoringDatesKeys = LSStoringDatesKeys.replace(LSStoringDatesKeysArr[i], '').replace(',,', ',').trimStart(',').trimEnd(',');
                        }
                        localStorage.setItem('LSStoringDatesKeys', LSStoringDatesKeys);
                        if (window[Key + 'CacheTrialNo'] == undefined) {
                            window[Key + 'CacheTrialNo'] = 0;
                        }
                        window[Key + 'CacheTrialNo'] = window[Key + 'CacheTrialNo'] + 1;
                        SetToCache(Key, Value);
                    }
                    else {

                        return false;
                    }
                    log('Done Clearing Local Storage');
                }
                log('DONE SetToCache:- with Key: ' + Key);
                return true;
            }
            else {
                return false;
            }
        } catch (e) {
            logErr(e);
            return false;
        }
    }
}


var AjaxCallInfo = {
    URL: '',
    AjaxCallingThread: null,
    RespHtml: '',
    XMLHttpResponse: null,
    Error: ''
}


// CustomXMLHTTPResponse: An Object to simulate the XMLHTTPResponse returned from Ajax calls
// Created to have a simailer object to XMLHTTPResponse returned from Ajax calls, when getting data from cache
// Needed for widgets using the XMLHTTPResponse to get headers data which set before in VB classes
var CustomXMLHTTPResponse =
    {
        ResponseHeadersArr: new Array(),
        getResponseHeader: function (Key) {
            return this.ResponseHeadersArr[Key];
        },
        getAllResponseHeaders: function () {
            //return Array.prototype.join.call(this.ResponseHeadersArr);
            return GetResponseHeadersStr(this.ResponseHeadersArr);
        }
    }

function GetResponseHeadersArr(ResponseHeadersStr) {
    var LinesArr = ResponseHeadersStr.split('\n');
    var OutArr = new Array();
    for (var i = 0; i < LinesArr.length; i++) {
        var ValIndex = LinesArr[i].indexOf(':');
        OutArr[LinesArr[i].substring(0, ValIndex)] = LinesArr[i].substring(ValIndex + 2);
    }
    return OutArr;
}

function GetResponseHeadersStr(ResponseHeadersArr) {
    var OutStr = '';
    for (var Key in ResponseHeadersArr) {
        OutStr = OutStr + Key + ' : ' + ResponseHeadersArr[Key] + '\n';
    }
    OutStr = OutStr.trimEnd('\n');
    return OutStr;
}

function SetToXMLHttpRespHeader(ResponseHeadersArr) {
    var XMLHttpRequestObj = CreateXMLHttpRequestInstance();
    XMLHttpRequestObj.open('Post', '*', false);
    for (var Key in ResponseHeadersArr) {
        if (Key + '' == '')
            continue;
        var val = ResponseHeadersArr[Key];
        log('Key: ' + Key + '; val: ' + val);
        try {
            XMLHttpRequestObj.setRequestHeader(Key, val);
            XMLHttpRequestObj.setResponseHeader(Key, val);
        } catch (e) {
            log(e);
        }
    }
    alert(XMLHttpRequestObj.getAllResponseHeaders());
    return XMLHttpRequestObj;
}

function CreateXMLHttpRequestInstance() {
    var xmlhttp;
    if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
    }
    else {// code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }
    return xmlhttp;
}

var AjaxCallInfoArr = new Array();

//function NULL() {

//}



var ExtDomainURLPrefix = "";
$.ajaxPrefilter(function (options, originalOptions, jqXHR) {
    try {
        if (Globals && Globals.ExtDomainURLPrefix)
            ExtDomainURLPrefix = Globals.ExtDomainURLPrefix;
        if (options.url.toLowerCase().indexOf('http://') == -1 && options.url.toLowerCase().indexOf('https://') == -1 && options.url.toLowerCase().indexOf('file://') == -1)
            options.url = ExtDomainURLPrefix + options.url;
        options.crossDomain = true;
        if (options.Embedded == true)
            options.crossDomain = false;
        if (!options.data)
            options.data = '';

        try {
            var AdditionalPostData = AddBusinessAdditionalAjaxCallPostData(options, originalOptions, jqXHR);
            if (AdditionalPostData)
                options.data = AdditionalPostData;
        } catch (e) {

        }
        var ReqNewKey = 'StK';//new Date().getTime();
        if (options.data.toString().indexOf('{') != -1 && options.data.toString().indexOf('}') != -1) {
            if (options.data.toString().indexOf(':') == -1) {
                options.data = options.data.replace('}', "&AJAXReqDate=" + ReqNewKey + '}');
                if (options.data.toString().indexOf('{&') != -1) {
                    options.data = options.data.replace('{&', '{');
                }
            }
            else {
                options.data = options.data.replace('}', ",'AJAXReqDate':'" + ReqNewKey + "'}");
                if (options.data.toString().indexOf('{,') != -1) {
                    options.data = options.data.replace('{,', '{');
                }
            }
        }
        else {
            options.data = options.data + "&AJAXReqDate=" + new Date().getTime();
            if (options.data.toString().indexOf('&') == 0) {
                options.data = options.data.substring(1);
            }
        }
        //log(originalOptions.url + ' :: Pdata:- ' + options.data);

    } catch (e) {
        alert(e);
        logErr('ajaxPrefilter:Err: ' + originalOptions.url + ':- ' + e);
    }
});




function CallOverrideJSWithInterval() {
    try {


        // Get Cached Override JS & CSS If Any and Update the DOM with It
        try {
            if (GetFromCache("overJS") != undefined)
                eval(GetFromCache("overJS"));

            if (config.AppLangID.toLowerCase() == "ar") {
                if (localStorage.CssAR != undefined) {
                    $("#ocss").remove();
                    $("head").append(localStorage.CssAR);
                }
            }
            else {
                if (localStorage.CssEN != undefined) {
                    $("#ocss").remove();
                    $("head").append(localStorage.CssEN);
                }
            }

        } catch (ex) {

        }

        //Start Calling Override JS & CSS
        var CallOverrideJSFlag = localStorage.CallOverrideJSFlag;
        var CallOverrideJSIntervalIndays = localStorage.CallOverrideJSIntervalIndays || 1;
        var LastCallOverrideJS = localStorage.LastCallOverrideJS || 0;

        CallOverrideJSIntervalIndays = 0 + CallOverrideJSIntervalIndays;
        LastCallOverrideJS = LastCallOverrideJS - 0;

        if ((new Date() - LastCallOverrideJS) / 1000 / 60 / 60 / 24 >= CallOverrideJSIntervalIndays) {
            CallOverrideJS();
            try {
                //localStorage.LastCallOverrideJS = (new Date() - 0);
                clearInterval(window.CallOverrideJSIntervalVal)
            } catch (e) { }
            window.CallOverrideJSIntervalVal = setInterval(function () { CallOverrideJS() }, CallOverrideJSIntervalIndays * 24 * 60 * 60 * 1000);
        }

    } catch (e) {

    }
}


function CallOverrideJS() {


    try {
        var OverrideJSCallBackSuccess = function (Data) {
            try {
                eval(Data);
                SetToCache("overJS", Data);
            } catch (e) { }
        }
        var OverrideJSCallBackFailure = function (Data) { try { HideLoadingSpinner(); } catch (e) { } }
        var url = Globals.OJSPath;
        var OptionsJs = {
            OnCallFailureFunction: OverrideJSCallBackFailure,
            OnCallSuccessFunction: OverrideJSCallBackSuccess,
            Embedded: true

        };

        AjaxPostCallURL(url, "", "", "", OptionsJs);


        var OverrideCSSCallBackSuccess = function (Data) {
            try {

                $("#ocss").remove(); $("head").append(Data);
                if (config.AppLangID == "ar")
                    localStorage.CssAR = Data;
                else
                    localStorage.CssEN = Data;
            } catch (e) { }
        }
        var OverrideCSSCallBackFailure = function (Data) {
            try {
                HideLoadingSpinner();
            } catch (e) { }
        }
        var url;
        if (Language == "ar")
            url = Globals.OCssARPath;
        else
            url = Globals.OCssENPath;
        var OptionsCss = {
            OnCallFailureFunction: OverrideCSSCallBackFailure,
            OnCallSuccessFunction: OverrideCSSCallBackSuccess,
            Embedded: true
        };

        AjaxPostCallURL(url, "", "", "", OptionsCss);
    }
    catch (e) {
        log(e);
    }
}



function AjaxPostCallURL(URL, PostData, OnCallSuccessAction, OnCallFailureAction, Options) {
    try {

        if (Options == undefined)
            Options = {};
        var OnCallSuccessFunction = (Options.OnCallSuccessFunction != undefined) ? Options.OnCallSuccessFunction : function () { }; Options.OnCallSuccessFunction = OnCallSuccessFunction;
        var OnCallFailureFunction = (Options.OnCallFailureFunction != undefined) ? Options.OnCallFailureFunction : function () { }; Options.OnCallFailureFunction = OnCallFailureFunction;
        var Embedded = (Options.Embedded != undefined) ? Options.Embedded : false;
        Options.Embedded = Embedded;

        log("Start AjaxPostCallURL " + URL + "; PostData: " + PostData);
        var AjaxCallInfoObj = new AjaxCallInfo.constructor();
        AjaxCallInfoArr[URL] = AjaxCallInfoObj;
        AjaxCallInfoArr[URL].URL = URL;
        var PostDataWithTimeStamp = AddTimeStampToPostData(GetFormattedPostData(PostData));
        //alert(PostDataWithTimeStamp);

        if (Globals.URLsToBeGottenFromDeviceArr != undefined && Globals.URLsToBeGottenFromDeviceArr[URL] != undefined) {
            var CallData = {};
            CallData.URL = URL, CallData.PostData = PostData, CallData.OnCallSuccessAction = OnCallSuccessAction, CallData.OnCallFailureAction = OnCallFailureAction, CallData.Options = Options;
            CallNative("GetFileContent", URL, function (CallResultObj, CallData) {
                log("CallResultsStr: " + JSON.stringify(CallResultObj));

                var URL = CallData.URL, PostData = CallData.PostData, OnCallSuccessAction = CallData.OnCallSuccessAction, OnCallFailureAction = CallData.OnCallFailureAction, Options = CallData.Options;
                if (CallResultObj.Succeed == true || CallResultObj.Succeed == "true") {
                    try {
                        log('AjaxPostCallURL:- Call was Success for ' + URL);
                        AjaxCallInfoArr[URL].RespHtml = CallResultObj.Content;
                        AjaxCallInfoArr[URL].XMLHttpResponse = clone(CustomXMLHTTPResponse);
                        try { HandleHttpResponseHeaders(AjaxCallInfoArr[URL].XMLHttpResponse); } catch (e) { }
                        log('OnCallSuccessAction:- ' + OnCallSuccessAction);
                        try { eval(OnCallSuccessAction) } catch (e) { /*alert(e);*/logErr(e); }
                        try { OnCallSuccessFunction({ CallOptions: Options, AjaxCallInfoObj: AjaxCallInfoArr[URL] }) } catch (e) { }
                    } catch (e) {
                        //alert(e);
                        logErr(e);
                    }
                } else {
                    var xhr = {};
                    xhr.responseText = CallResultObj.Error;
                    var textStatus = "";
                    var ex = 'error';
                    var error = CallResultObj.Error;
                    log('AjaxPostCallURL:- Call Failed for ' + URL + ', Error: ' + error);
                    AjaxCallInfoArr[URL].Error = error;
                    try { eval(OnCallFailureAction) } catch (e) { }
                    try { OnCallFailureFunction({ CallOptions: Options, AjaxCallInfoObj: AjaxCallInfoArr[URL], Error: error, XHR: xhr, Status: status }) } catch (e) { }
                }

            }, this, CallData);

        }
        else if (Globals.GetCEEPUpdatesThroughCM && URL.indexOf("GetCeepContent") == -1) {
            var CallData = {};
            CallData.URL = URL, CallData.PostData = PostData, CallData.OnCallSuccessAction = OnCallSuccessAction, CallData.OnCallFailureAction = OnCallFailureAction, CallData.Options = Options;
            var CeepParams = {
                path: URL,
                Options: Options,
                OnCallSuccessAction: OnCallSuccessAction,
                OnCallSuccessFunction: OnCallSuccessFunction,
                OnCallFailureAction: OnCallFailureAction,
                OnCallFailureFunction: OnCallFailureFunction
                //xhr : xhr,
                //status : status
            };

            var GetCeepContentOptions = {};
            //if (URL.indexOf("Overrides") != -1)
            //{
            GetCeepContentOptions = {
                DisplayLoadingSpinner: false,
                HideLoadingSpinnerAfterDataBinding: false,
                HideSpinnerWhenCallSuccess: false,
                DisplaySpinnerWhenMWCall: false,
                DisplayDefaultErrorAlert: true,
                HideSpinnerWhenMWCallError: true,
                HideSpinnerWhenAjaxCallError: true,
                DisplayPageLoadingSpinner: false,
                HidePageLoadingSpinner: false
            };
            //}
            LoadAndRunForm("GetCeepContent", CeepParams, false, this, GetCeepContentOptions);
        }
        else {
            AjaxCallInfoArr[URL].AjaxCallingThread =
                $.ajax({
                    type: (Embedded == false) ? "POST" : "GET",
                    url: URL,
                    data: (Embedded == false) ? PostDataWithTimeStamp : '',
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    dataType: "html",
                    crossDomain: false,
                    global: false,
					timeout: config.Settings.AjaxCallTimeout || 60000,
                    Embedded: Embedded,
                    success: function (response, textStatus, XMLHttpResponse) {
                        try {
                            log('AjaxPostCallURL:- Call was Success for ' + URL);
                            if (URL == undefined) { return; }
                            AjaxCallInfoArr[URL].RespHtml = response;
                            AjaxCallInfoArr[URL].XMLHttpResponse = XMLHttpResponse;
                            //log(XMLHttpResponse);
                            //alert('JSON.stringfy(XMLHttpResponse):- ' + JSON.stringify(XMLHttpResponse));
                            try { HandleHttpResponseHeaders(XMLHttpResponse); } catch (e) { }
                            log('OnCallSuccessAction:- ' + OnCallSuccessAction);
                            if (Options.JSCallSucceeded == undefined) {
                                Options.HTMLCallSucceeded = true
                            }
                            if (Options.HTMLCallSucceeded == undefined) {
                                Options.JSCallSucceeded = true
                            }
                            try { eval(OnCallSuccessAction) } catch (e) { /*alert(e);*/logErr(e); }
                            try { OnCallSuccessFunction({ CallOptions: Options, AjaxCallInfoObj: AjaxCallInfoObj }) } catch (e) { }
                        } catch (e) {
                            //alert(e);
                            logErr(e);
                        }

                    },
                    error: function (xhr, status, error) {
                        log('AjaxPostCallURL:- Call Failed for ' + URL + ', Error: ' + error);
                        AjaxCallInfoArr[URL].Error = error;
                        if (Options.JSCallSucceeded == undefined) {
                            Options.HTMLCallSucceeded = false;
                        }
                        if (Options.HTMLCallSucceeded == undefined) {
                            Options.JSCallSucceeded = false;
                        }
                        try { eval(OnCallFailureAction) } catch (e) { }
                        try { OnCallFailureFunction({ CallOptions: Options, AjaxCallInfoObj: AjaxCallInfoArr[URL], Error: error, XHR: xhr, Status: status }) } catch (e) { }
                    }
                });
        }


    } catch (e) {
        logErr(e);

    }
}

function AddTimeStampToPostData(PostData) {
    try {
        PostData = PostData + '';
        if (PostData.toString().indexOf('{') != -1 && PostData.toString().indexOf('}') != -1) {
            if (PostData.toString().indexOf(':') == -1) {
                PostData = PostData.replace('}', "&AJAXReqDate=" + new Date().getTime() + '}');
                if (PostData.toString().indexOf('{&') != -1) {
                    PostData = PostData.replace('{&', '{');
                }
            }
            else {
                PostData = PostData.replace('}', ",'AJAXReqDate':'" + new Date().getTime() + "'}");
                if (PostData.toString().indexOf('{,') != -1) {
                    PostData = PostData.replace('{,', '{');
                }
            }
        }
        else {
            PostData = PostData + "&AJAXReqDate=" + new Date().getTime();
            if (PostData.toString().indexOf('&') == 0) {
                PostData = PostData.substring(1);
            }
        }
        return PostData;
        log('AddTimeStampToPostData output: ' + PostData);
    } catch (e) {
        logErr(e);
    }

}


function AddToPostData(PostData, AddtionalPostData) {
    try {
        PostData = PostData + '';
        if (PostData.toString().indexOf('{') != -1 && PostData.toString().indexOf('}') != -1) {
            if (PostData.toString().indexOf(':') == -1) {
                PostData = PostData.replace('}', "&" + AddtionalPostData + '}');
                if (PostData.toString().indexOf('{&') != -1) {
                    PostData = PostData.replace('{&', '{');
                }
            }
            else {
                PostData = PostData.replace('}', "," + AddtionalPostData + "}");
                if (PostData.toString().indexOf('{,') != -1) {
                    PostData = PostData.replace('{,', '{');
                }
            }
        }
        else {
            PostData = PostData + "&" + AddtionalPostData;
            if (PostData.toString().indexOf('&') == 0) {
                PostData = PostData.substring(1);
            }
        }
        return PostData;
        log('AddToPostData output: ' + PostData);
    } catch (e) {
        logErr(e);
    }

}



function ForceRefreshWidget(WidgetId, PostData, IgnoreSpinner) {
    try {
        var WidgetsNotRefreshed = Globals.WidgetsNotRefreshed;

        if (WidgetsNotRefreshed.indexOf(WidgetId) == -1) {
            Globals.ForceGetFreshData = true;
        } else {
            Globals.ForceGetFreshData = false;
        }
        //        alert("Refresh <%=me.ClientID%>");
        var ActiveSubPageID = GetActiveSubPageID();

        if (UseActiveSubPageWhenLoadingPageContent) {
            //if (WidgetId.indexOf(ActiveSubPageID) == -1)
            //    WidgetId = GetActiveSubPageID() + '_' + WidgetId;
            var cached = eval('CacheSettingsArrr.' + FormID);
            PageId = cached.SubPageID + '_' + FormID;
        }

        if (window[WidgetId + "_ClassIns"] != null) {
            window[WidgetId + "_ClassIns"] = null;
        }

        window["Collapse_" + WidgetId] = false;
        if (window["Collapse_" + WidgetId]) {
            return 0;
        }
        if (!IgnoreSpinner) {
            ShowSpinnerFlag = true;
            ShowHideSpinner(WidgetId, true);
        }
        //RemovePageDataSourcesCache(WidgetId);
        if (LoadWidgetContent(WidgetId, PostData, true, false, 'RemovePageDataSourcesCache("' + WidgetId + '"); ') == 0) {
            ShowHideSpinner(WidgetId, false);
        }
    } catch (e) {
        //alert(e);
    }
}

function ShowHideSpinner(WidgetClientID, ShowSpinner) {
    //alert(WidgetClientID + ' : ' + ShowSpinner);
    try {
        //alert(WidgetClientID + "Widget_Content_Spinner");
        if (ShowSpinner) {
            try { $("#" + WidgetClientID + "_WidgetHeaderDivbuttoncssclsss").css("display", "Block"); } catch (e) { }

            try {
                //alert(("." + WidgetClientID + "WidgetRefreshIcon"));
                $("." + WidgetClientID + "WidgetRefreshIcon").attr('src', '');
                //alert(("." + WidgetClientID + "WidgetRefreshIcon"));
            } catch (e) { alert(e); }
            try { $("#" + WidgetClientID).find(".WidgetRefreshIcon").attr('src', ''); } catch (e) { }
        }
        else {

            try { $("#" + WidgetClientID).find(".WidgetRefreshIcon").attr('src', ''); } catch (e) { }
            try { $("." + WidgetClientID + "WidgetRefreshIcon").attr('src', ''); } catch (e) { }
            try { $("." + WidgetClientID + "Widget_Content_Spinner").hide(); } catch (e) { }
            try { $("#" + WidgetClientID + "Widget_Content_Spinner").hide(); } catch (e) { }
        }
    } catch (e) {
        logErr(WidgetClientID + ': Ex in ShowHideSpinner: ' + e);
        //alert(e);
    }
    ////alert(WidgetClientID + ' : ' + ShowSpinner);
    //try {
    //    //alert(WidgetClientID + "Widget_Content_Spinner");
    //    if (ShowSpinner) {
    //        try { $("#" + WidgetClientID + "_WidgetHeaderDivbuttoncssclsss").css("display", "Block"); } catch (e) { }
    //        try { $("#" + WidgetClientID + "Widget_Content_Spinner").show(); } catch (e) { }
    //        try { $("." + WidgetClientID + "Widget_Content_Spinner").show(); } catch (e) { }
    //        try {
    //            //alert(("." + WidgetClientID + "WidgetRefreshIcon"));
    //            $("." + WidgetClientID + "WidgetRefreshIcon").hide();
    //            //alert(("." + WidgetClientID + "WidgetRefreshIcon"));
    //        } catch (e) { alert(e); }
    //        try { $("#" + WidgetClientID).find(".WidgetRefreshIcon").hide(); } catch (e) { }
    //    }
    //    else {
    //        try { $("." + WidgetClientID + "Widget_Content_Spinner").hide(); } catch (e) { }
    //        try { $("#" + WidgetClientID + "Widget_Content_Spinner").hide(); } catch (e) { }
    //        try { $("#" + WidgetClientID).find(".WidgetRefreshIcon").show(); } catch (e) { }
    //        try { $("." + WidgetClientID + "WidgetRefreshIcon").show(); } catch (e) { }
    //    }
    //} catch (e) {
    //    logErr(WidgetClientID + ': Ex in ShowHideSpinner: ' + e);
    //    //alert(e);
    //}
}


function LoadWidgetContent(WidgetID, PostData, GetFreshDataFromServer, SkipSettingCache, BeforeAdditionalSuccessCallBack, IgnoreSpinner) {
    try {
        try {
            var PageCacheSettings = GetPageCacheSettings(WidgetID);
            if (PageCacheSettings.CustomCallFlag == true) {
                //eval(PageCacheSettings.CustomCallFunction);
                if (PageCacheSettings.CustomCallFunction != undefined || typeof (window[PageCacheSettings.CustomCallFunction]) == "function" || typeof (eval(PageCacheSettings.CustomCallFunction)) == "function") {
                    var CustomCallFunction = window[PageCacheSettings.CustomCallFunction];

                    if (CustomCallFunction == undefined)
                        CustomCallFunction = eval(PageCacheSettings.CustomCallFunction);

                    if (window[WidgetID + '_LoadCounter'] == undefined)
                        window[WidgetID + '_LoadCounter'] = 0;
                    window[WidgetID + '_LoadCounter'] = window[WidgetID + '_LoadCounter'] + 1;
                    log(WidgetID + '_LoadCounter:- ' + window[WidgetID + '_LoadCounter']);


                    CustomCallFunction({
                        WidgetID: WidgetID, PostData: PostData, GetFreshDataFromServer: GetFreshDataFromServer, SkipSettingCache: SkipSettingCache
                        , BeforeAdditionalSuccessCallBack: BeforeAdditionalSuccessCallBack, IgnoreSpinner: IgnoreSpinner, FreshData: GetFreshDataFromServer
                    });
                    return;
                }
                else {
                    alert('For WidgetID: ' + WidgetID + ', ' + PageCacheSettings.CustomCallFunction + ' is not a function');
                }
                return;
            }
        } catch (e) {
            alert(e);
        }
        try {
            if (!GetFreshDataFromServer)
                GetFreshDataFromServer = false;
            if (!SkipSettingCache)
                SkipSettingCache = false;
            if (!IgnoreSpinner)
                IgnoreSpinner = false;

            if (!BeforeAdditionalSuccessCallBack)
                BeforeAdditionalSuccessCallBack = '';

            if ($("#" + WidgetID).css('visibility').toLowerCase() == "hidden") {

                $("#" + WidgetID).css("display", "none");
                return 0;
            }
        } catch (e) {
            logErr(e);
            return 0;
        }

        var ContentElement = document.getElementById(WidgetID + '_Widget_Content_Data');
        var LoadScroll = window[WidgetID + '_WidgetContentLoadScroll'];

        var seializedContentStr = ($("#" + WidgetID + " *").serialize());
        if (!PostData) //undefined
            PostData = '';
        var AllPostData = (seializedContentStr + "&" + PostData).trimStart("&").trimEnd("&");
        if (!window["ajaxLoading_" + WidgetID]) {
            window["ajaxLoading_" + WidgetID] = true;
            window["LoadWidgetContent_" + WidgetID + "XMLHttpResponse"] = null;
            var AdditionalSuccessCallBack = BeforeAdditionalSuccessCallBack + '; HandleWidgetCallSuccess("' + WidgetID + '","' + LoadScroll + '");';
            var AdditionalFailureCallBack = 'HandleWidgetCallFailure("' + WidgetID + '");';

            //GetPageHTML(WidgetID, PostData, GetFreshDataFromServer, SkipSettingCache, AdditionalSuccessCallBack, AdditionalFailureCallBack, null, IgnoreSpinner);

            var LoadAndRunFormOptions = {
            }

            LoadAndRunFormOptions.PostData = PostData;
            LoadAndRunFormOptions.GetFreshDataFromServer = GetFreshDataFromServer;
            LoadAndRunFormOptions.SkipSettingCache = SkipSettingCache;
            LoadAndRunFormOptions.AdditionalSuccessCallBack = AdditionalSuccessCallBack;
            LoadAndRunFormOptions.AdditionalFailureCallBack = AdditionalFailureCallBack;
            LoadAndRunFormOptions.SkipStaticPageChecking = null;
            LoadAndRunFormOptions.IgnoreSpinner = IgnoreSpinner;
            if (ShowSpinnerFlag) {
                ShowSpinnerFlag = false;
                LoadAndRunFormOptions.DisplayPageLoadingSpinner = false;
            }
            LoadAndRunForm(WidgetID, /*FormParametersData*/null, true, null, LoadAndRunFormOptions);

            var PageCacheSettings = new CacheSettings.constructor();
            PageCacheSettings = CacheSettingsArr[WidgetID];
            var PageURL = ((AppLang == 'en') ? PageCacheSettings.PagePath : PageCacheSettings.PagePath_AR);
            var AjaxCallInfoObj = new AjaxCallInfo.constructor();
            AjaxCallInfoObj = AjaxCallInfoArr[PageURL];
            window["LoadWidgetContent_" + WidgetID + "AjaxCall"] = AjaxCallInfoObj.AjaxCallingThread;
            window["ajaxLoading_" + WidgetID] = false;
        }
    } catch (e) {
        logErr(WidgetID + ' Exception in LoadWidgetContent: ' + e);
    }
}

function HandleWidgetCallSuccess(WidgetID, LoadScroll) {
    try {
        log('Start HandleWidgetCallSuccess: ' + WidgetID);
        var ContentElement = document.getElementById(WidgetID + '_Widget_Content_Data');
        var PageCacheSettings = new CacheSettings.constructor();
        PageCacheSettings = CacheSettingsArr[WidgetID];
        var PageURL = ((AppLang == 'en') ? PageCacheSettings.PagePath : PageCacheSettings.PagePath_AR);
        var AjaxCallInfoObj = new AjaxCallInfo.constructor();
        AjaxCallInfoObj = AjaxCallInfoArr[PageURL];
        //alert(WidgetID);
        //alert(PageCacheSettings.URL);
        window["ajaxLoading_" + WidgetID] = false;
        window['ContentOf' + WidgetID + 'Loaded'] = true;
        try {
            if (AjaxCallInfoObj.RespHtml != undefined) {
                ContentElement.innerHTML = AjaxCallInfoObj.RespHtml;
            } else {
                log("*/*/*/*/*/*************** :::::::::::::::: undefined");
            }
        } catch (e) {
            log("*/*/*/*/*/*************** :::::::::::::::: undefined");
        }
        //                            alert(response);

        window["LoadWidgetContent_" + WidgetID + "XMLHttpResponse"] = AjaxCallInfoObj.XMLHttpResponse;
        try { HandleHttpResponseHeaders(AjaxCallInfoObj.XMLHttpResponse); } catch (e) { }
        ContentElement.style.display = "";
        //SpinnerElement.style.display = "none";
        ShowHideSpinner(WidgetID, false);
        HandleLoadedScripts(ContentElement);
        //alert("LoadWidgetContent_<%=me.ClientID%>SucceedAction :"+ LoadWidgetContent_<%=me.ClientID%>SucceedAction);
        if (LoadScroll == "True") {
            var counter = 0;
            var MenuBarWidth = 0;
            var ClientID = WidgetID;
            counter = $("#" + ClientID + " .ListMenuitem").length;
            var stringWidth = $("#" + ClientID + " .ListMenuitem").css("width");
            stringWidth = stringWidth.replace("px", "");

            MenuBarWidth = parseInt(stringWidth);
            MenuBarWidth = counter * (MenuBarWidth + 30);

            $('#' + ClientID + ' .DataList_marquee_caption_content').scrollview({
                direction: 'x'
            });
            //.DataList_marquee_caption_content >
            // $('#'+ClientID+'  .ui-scrollview-view').width(MenuBarWidth); 
        }

    } catch (e) {
        //alert('Ex in HandleWidgetCallSuccess: ' + WidgetID + ':- ' + e);
        logErr('Ex in HandleWidgetCallSuccess: ' + WidgetID + ':- ' + e);
    }

    $(".ui-page").trigger("create");
    try { eval(window["LoadWidgetContent_" + WidgetID + "SucceedAction"]); window["LoadWidgetContent_" + WidgetID + "SucceedAction"] = ''; } catch (e) { }
    try { ConnectionAvailable = true; HandleConnectionAvailabilityChange(); } catch (e) { }
    try {
        //Rotate3D(WidgetID + '_Widget_Content_Data');
    } catch (e) {
        alert(e);
    }
    return 1;
}


function HandleWidgetCallFailure(WidgetID) {
    var ContentElement = document.getElementById(WidgetID + '_Widget_Content_Data');
    if (error == "abort") {
        window["ajaxLoading_" + WidgetID] = false;
        return 0;
    }
    window["ajaxLoading_" + WidgetID] = false;
    ShowHideSpinner(WidgetID, false);
    ContentElement.innerHTML = "<center>Error Loading</center>";
    ContentElement.style.display = "";
    try { eval(window["LoadWidgetContent_" + WidgetID + "FailedAction"]); window["LoadWidgetContent_" + WidgetID + "FailedAction"] = ''; } catch (e) { }
    try { ConnectionAvailable = false; HandleConnectionAvailabilityChange(); } catch (e) { }
}

function returnBoolean(str) {

    str = str.toString().toLowerCase();

    if (str == 'true' || str == '1' || str == 'yes' || str == 'y' || str == 'on' || str == '+') {
        return (true);
    }
    else if (str == 'false' || str == '0' || str == 'no' || str == 'n' || str == 'off' || str == '-') {
        return (false);
    } else {
        return (undefined);
    }
}

function GetPageCacheSettings(PageId) {
    //var CacheSettingsObj = new CacheSettings.constructor();
    //var AjaxCallInfoObj = new AjaxCallInfo.constructor();
    return CacheSettingsArr[PageId];
}

function GetPageAjaxCallInfo(PageId) {
    var CacheSettingsObj = new CacheSettings.constructor();
    var AjaxCallInfoObj = new AjaxCallInfo.constructor();
    CacheSettingsObj = CacheSettingsArr[PageId];
    if (AppLang == 'en') {
        AjaxCallInfoObj = AjaxCallInfoArr[CacheSettingsObj.PagePath];
    }
    else {
        AjaxCallInfoObj = AjaxCallInfoArr[CacheSettingsObj.PagePath_AR];
    }
    return AjaxCallInfoObj;
}
/***************************************************************************************************************************************************************************/



/*********************************************************************************** Animation Script ***********************************************************************************/


/* 
Animation Modes :-
i. None 
ii. Flip 
iii. Slide-Left
iv. Slide-Right
v. Slide-Down
vi. Slide-Up
vii. Dissolve 
viii. PageTurn
*/
function AnimatePage(PageId) {
    try {
        log('Start AnimatePage For Page: ' + PageId);
        var CacheSettingsObj = new CacheSettings.constructor();
        CacheSettingsObj = GetPageCacheSettings(PageId);
        if (CacheSettingsObj == null) {
            logWarn('CacheSettingsObj = null, will not continue in Animation');
            return;
        }

        var AnimationMode = CacheSettingsObj.RefreshAnimationMode;

        log('AnimationMode:- ' + AnimationMode);
        var DivId = '';
        if (CacheSettingsObj.AmimationDivId + '' == '' || CacheSettingsObj.AmimationDivId == null) {
            if (CacheSettingsObj.PageType.toLowerCase() == 'Widget'.toLowerCase()) {
                DivId = PageId + '_Widget_Content_Data';
            }
            else {
                DivId = 'SimpleDialogContentContainerDiv'; //'SimpleDialogContanerID';
            }
        }
        else {
            DivId = CacheSettingsObj.AmimationDivId;
        }

        log('Animation DivId: ' + DivId);

        if (AnimationMode.toLowerCase() == 'Flip'.toLowerCase()) {
            //            RotateDiv3D(DivId);
            RotateDiv(DivId);
        }
        else if (AnimationMode.toLowerCase() == 'Slide-Left'.toLowerCase()) {
            SlideDivLeft(DivId);
        }
        else if (AnimationMode.toLowerCase() == 'Slide-Right'.toLowerCase()) {
            SlideDivRight(DivId);
        }
        else if (AnimationMode.toLowerCase() == 'Slide-Down'.toLowerCase()) {
            SlideDivDown(DivId);
        }
        else if (AnimationMode.toLowerCase() == 'Slide-Up'.toLowerCase()) {
            SlideDivUp(DivId);
        }
        else if (AnimationMode.toLowerCase() == 'Dissolve'.toLowerCase()) {
            // Not Implemented Yet
        }
        else if (AnimationMode.toLowerCase() == 'PageTurn'.toLowerCase()) {
            // Not Implemented Yet
        }
        log('Finished AnimatePage For Page: ' + PageId);
    } catch (e) {
        logErr(e);
    }

}

function ROTATEDIV(obj) {
    window[obj + 'angle'] = 10;
    window[obj + 'increment'] = 5;
    window[obj + 'interval'] = 2;
    rotate(obj);
}


function rotate(obj) {
    log(obj + ':- angle: ' + window[obj + 'angle']);
    $('#' + obj).css({
        '-moz-transform': 'rotateY(' + window[obj + 'angle'] + 'deg)',
        'msTransform': 'rotateY(' + window[obj + 'angle'] + 'deg)',
        '-webkit-transform': 'rotateY(' + window[obj + 'angle'] + 'deg)',
        '-o-transform': 'rotateY(' + window[obj + 'angle'] + 'deg)'
    });
    window[obj + 'angle'] += window[obj + 'increment'];
    //log('rotate(' + window[obj + 'angle'] + 'deg))
    window[obj + 'timer'] = setTimeout('rotate(\'' + obj + '\')', window[obj + 'interval']);
}


function RotateYDiv(DivId, StartAngle, EndAngle, Duration, CallBack) {
    try {
        try {
            clearTimeout(window[DivId + "RotateYTimer"]);
        } catch (e) {
            log(e);
        }
        var AngleInterval = (EndAngle - StartAngle) / Duration;
        var DurationInterval = 25; //ms
        AngleInterval = DurationInterval * AngleInterval;
        window[DivId + 'RotateYDivDuration'] = Duration;
        window[DivId + 'RotateYDivCurrentDuration'] = 0;
        RotateY(DivId, StartAngle, EndAngle, DurationInterval, AngleInterval, CallBack);
    } catch (e) {
        log(e);
        alert(e);
    }
}

function RotateY(DivId, StartAngle, EndAngle, DurationInterval, AngleInterval, CallBack) {
    //log('>>> RotateY For *** ' + DivId + ' *** ==> ' +'StartAngle:- ' + StartAngle + ', EndAngle:- ' + EndAngle + 'CurrentDuration:- ' + window[DivId + 'RotateYDivCurrentDuration'] + ', Duration:- ' + window[DivId + 'RotateYDivDuration'] + ', DurationInterval:- ' + DurationInterval + ', AngleInterval:- ' + AngleInterval);
    if (window[DivId + 'RotateYDivCurrentDuration'] >= window[DivId + 'RotateYDivDuration']) {
        SetDivRotateYAngle(DivId, EndAngle);
        try {
            //alert(CallBack);
            eval(CallBack);
        } catch (e) {
            log(e);
            //alert(e);
        }
        return;
    }
    else {
        window[DivId + 'RotateYTimer'] = setTimeout(
            'OnRotateYTimer(\'' + DivId + '\',' + StartAngle + ',' + EndAngle + ',' + DurationInterval + ',' + AngleInterval + ',\"' + CallBack + '\"' + ');'
            , DurationInterval);
    }
}

function OnRotateYTimer(DivId, StartAngle, EndAngle, DurationInterval, AngleInterval, CallBack) {
    StartAngle = StartAngle + AngleInterval;
    SetDivRotateYAngle(DivId, StartAngle);
    window[DivId + 'RotateYDivCurrentDuration'] = window[DivId + 'RotateYDivCurrentDuration'] + DurationInterval;
    RotateY(DivId, StartAngle, EndAngle, DurationInterval, AngleInterval, CallBack)
}

function SetDivRotateYAngle(DivId, Angle) {
    $('#' + DivId).css({
        '-moz-transform': 'rotateY(' + Angle + 'deg)',
        'msTransform': 'rotateY(' + Angle + 'deg)',
        '-webkit-transform': 'rotateY(' + Angle + 'deg)',
        '-o-transform': 'rotateY(' + Angle + 'deg)'
    });
}

function RotateDiv(DivId) {
    try {

        RotateYDiv(DivId, 0, 90, 500, 'RotateYDiv(\'' + DivId + '\', -90, 0, 500)');
    } catch (e) {
        alert(e);
    }


    return;


    $('#' + DivId).css('-webkit-transform', '');
    var DivStyle = $('#' + DivId).attr('style');
    //alert(DivStyle);
    $('#' + DivId).stop().transition({
        rotateY: '360deg'
    }, 1750, function () {
        try {
            $('#' + DivId).attr('style', DivStyle);
        } catch (e) {
            //alert('ex :- ' + e);
        }
    });

}


function RotateDiv3D(DivId) {
    var Duration = 2000;
    var Degree = 360;
    if (!Duration)
        Duration = 2000;
    if (!Degree)
        Degree = '360';
    $('#' + DivId).rotate3Di(
        Degree,
        Duration//,
        //        {
        //            sideChange: mySideChange,
        //            complete: myComplete
        //        }

    );
}


function SlideDivLeft(DivId) {
    var DivWidth = $('#' + DivId).width();
    $('#' + DivId).css('left', DivWidth + 'px');
    $('#' + DivId).css('position', 'relative');
    $('#' + DivId).parent().css('overflow', 'hidden');
    $('#' + DivId).animate({ 'left': '-=' + DivWidth }, 600);
}

function SlideDivRight(DivId) {
    var DivWidth = $('#' + DivId).width();
    $('#' + DivId).css('right', DivWidth + 'px');
    $('#' + DivId).css('position', 'relative');
    $('#' + DivId).parent().css('overflow', 'hidden');
    $('#' + DivId).animate({ 'right': '-=' + DivWidth }, 600);
}

function SlideDivUp(DivId) {
    var DivHeight = $('#' + DivId).height();
    $('#' + DivId).css('top', DivHeight + 'px');
    $('#' + DivId).css('position', 'relative');
    $('#' + DivId).parent().css('overflow', 'hidden');
    $('#' + DivId).animate({ 'top': '-=' + DivHeight }, 600);
}


function SlideDivDown(DivId) {
    var DivHeight = $('#' + DivId).height();
    $('#' + DivId).css('bottom', DivHeight + 'px');
    $('#' + DivId).css('position', 'relative');
    //$('#' + DivId).closest('div').css('overflow', 'hidden');
    $('#' + DivId).parent().css('overflow', 'hidden');
    //parent
    $('#' + DivId).animate({ 'bottom': '-=' + DivHeight }, 600);
}

function DissolveDiv(DivId) {
    window.myFlux = $('#' + DivId).flux({
        autoplay: false,
        pagination: true,
        onTransitionEnd: function (data) {
            var img = data.currentImage;
            // Do something with img...
        }
    });

    setTimeout(" window.myFlux.flux('next', 'dissolve');", 1000);
}


function LoadCustomAction(DivName) {
    $("#" + DivName + " .widget").each(function () {
        var id = $(this).attr("id");
        log("ID %%%%%%%%%%%%%%%%%%%=======================%%%%%%%%%%%%%%%%%%% " + id);
        var ContentWidgetID = id + "_Widget_Content_Data";
        if ($("#" + ContentWidgetID).css("display") == "none") {
            eval("collapsefnWithReloadWidget_" + id + "('" + id + "')");
        }
    });
}


/***************************Windows Phone Functions************************************************
**********************Start : Ahmed Abdul Fattah Muhammad******************************************
****************************Date : 12-02-2013******************************************************/

////To check if the running OS is Windows phone or not
function isWindowsPhoneFunction() {
    try {
        var isWindowsPhone = /windows phone/i.test(navigator.userAgent.toLowerCase());
        if (isWindowsPhone)
            //window.external.notify("noScroll");
            return isWindowsPhone;
    } catch (e) { alert(e); }
}

////To Reset the height of "ALLPageContent" to fit the screen due to disable the bounce scroll
BouncsScrollDisable_WP = function () {
    try {

        var ScreenHeight1 = (window.outerHeight);
        document.getElementById("ALLPageContent").style.height = ScreenHeight1 + "px";
        $("#PageContent").css("height", "87%");
        document.getElementById("ALLPageContent").style.minHeight = ScreenHeight1 + "px";;
        $("#PageContent").css("padding-top", $('#PageHeader').height() - $('#PageContent').offset().top + 10 + "px");
        document.getElementById("WheelContentDiv").style.height = "350px";

    } catch (e) {
        //alert(e); 
    }
}

////To Reset the pop up overlay height to fit the screen due to disable the bounce scroll
DialogOverLay_Height = function () {
    try {

        //alert("ALLPageContent.height() = "+$("#ALLPageContent").height()+"      ALLPageContent.css('min-height')= "+$("#ALLPageContent").css("min-height")+"      PageContent.height() = "+$("#PageContent").height());
        AllPageContentHeight = $("#ALLPageContent").height();
        AllPageContentMiniHeight = $("#ALLPageContent").css("min-height");
        PageContentHeight = $("#PageContent").height();
        BouncsScrollDisable_WP();
        setTimeout('$("#PageContent").css("height","400px");$("#ALLPageContent").css("min-height","400px");$("#ALLPageContent").css("height","400px");', 50);
        var MyPageOuterHeight = window.outerHeight;
        var TopOffDatePicker = MyPageOuterHeight / 4;
        try { $(".ui-simpledialog-screen.ui-simpledialog-screen-modal").css("height", MyPageOuterHeight + 'px'); }
        catch (e) { console.log(e); }
        $(".dwo").css("height", MyPageOuterHeight + 'px');
        $(".dw,dwbg,wp-none").css("top", TopOffDatePicker + 'px');
        $(".dw,dwbg,wp-none").css("visibility", "visible");
        $("#SimpleDialogContanerID").css("position", "absolute");
    } catch (e) {
        alert(e);
    }
}

////To Reopen the unCollapsed widgets that is collapsed when the pop up is opened
OnSimpleDialogClose2 = function () {

    //if (WidgetsIDWP[0] != null) {
    //  for (var i = 0; i < WidgetsIDWP.length; i++) {
    //    Collapse(WidgetsIDWP[i], false);
    //  WidgetsIDWP[i] = '';
    //if(WidgetsIDWP.length > 1)
    //{
    //	$("#PageContent").css("height","1028px");
    //}else if(WidgetsIDWP.length == 1){
    //$("#PageContent").css("height","512px");
    //}
    //}
    //}
    if (isWindowsPhoneFunction()) {
        //alert("AllPageContentHeight = "+AllPageContentHeight+"      AllPageContentMiniHeight= "+AllPageContentMiniHeight+"      PageContentHeight = "+PageContentHeight);
        try {

            setTimeout('$("#ALLPageContent").css("height",AllPageContentHeight+ "px");$("#ALLPageContent").css("min-height",AllPageContentMiniHeight);$("#PageContent").css("height",PageContentHeight+ "px");AllPageContentHeight = 0;AllPageContentMiniHeight = 0;PageContentHeight = 0;', 50);

        } catch (e) {
            alert(e);
        }
    }

}


////To Reset the height of "ALLPageContent" to solve the white space issue at the home page
PageHeight_Widget = function () {
    //alert(12);
    var AllPageHeight = document.getElementById('ALLPageContent').offsetHeight;
    //var diff_Height = AllPageHeight - 280;
    //if (AllPageHeight >= 1000) {
    //     document.getElementById('ALLPageContent').style.height = diff_Height + 'px';
    // }
    //  else {
    document.getElementById('ALLPageContent').style.height = DeviceHeight.toString() + 'px';
    //document.getElementById('ALLPageContent').style.minHeight = '900px';
    //}
}

/***************************Windows Phone Functions************************************************
************************End : Ahmed Abdul Fattah Muhammad******************************************
****************************Date : 00-04-2013******************************************************/


/***************************************************************************************************************************************************************************/
function NavigationController() {
    this.NavID = '';
    this.NavFormsStack = new Array();
    this.SubNavs = {
        UpNav: new Array(),
        DownNav: new Array(),
        FullNav: new Array()
    };
}

var NavigationControllersArr = new Array();

function DisplayNav(NavID, FormsIDs) {
    Globals.WidgetID = FormsIDs;
    if (HandleCommunicationError(FormsIDs)) {
        return;
    }

    Globals.ActiveNavID = NavID;
    SetFormsNavID(FormsIDs);
    var LogPrefixStr = 'DisplayNav:- NavID: ' + NavID + '; FormsIDs: ' + FormsIDs + ':- '
    try {
        var NavNewlyCreated = false;
        var NavController = null;
        if (!window['Nav_' + NavID]) {
            NavController = window['Nav_' + NavID] = new NavigationController();
            NavNewlyCreated = true;
            NavController.NavID = NavID;
            PushNavForm(NavID, FormsIDs)
            log(LogPrefixStr + 'New Nav Created: ');
            log(NavController);
            NavigationControllersArr[NavID] = NavController;
        } else {
            log(LogPrefixStr + 'Nav Found: ');
            NavController = window['Nav_' + NavID];
            ShowForm(NavController.NavFormsStack[NavController.NavFormsStack.length - 1]);
            CheckAndDrawFormsHeader(NavID, NavController.NavFormsStack[NavController.NavFormsStack.length - 1]);
            AssignNavHeaderBtnActions(NavID);
        }
    } catch (e) {
        log(LogPrefixStr + e);
    }
}

function PushNavForm(NavID, FormsIDs, Location, SubNavID) {
    Globals.WidgetID = FormsIDs;
    if (HandleCommunicationError(FormsIDs)) {
        return;
    }

    if (Globals.ActiveNavID != NavID) {
        NavController = window['Nav_' + NavID];
        NavController.SubNavs = {
            UpNav: new Array(),
            DownNav: new Array(),
            FullNav: new Array()
        };
        Globals.UseSubNavs = false;
    }
    else {
        Globals.UseSubNavs = true;
    }
    Globals.ActiveNavID = NavID;
    var LogPrefixStr = 'PushNavForm:- NavID: ' + NavID + '; FormsIDs: ' + FormsIDs + ':- '
    if (Location == undefined || Location == null || Location == "") {
        ShowForm(FormsIDs);
        var NavController = null;
        NavController = window['Nav_' + NavID];
        if (FormsIDs != NavController.NavFormsStack[NavController.NavFormsStack.length - 1]) {
            NavController.NavFormsStack[NavController.NavFormsStack.length] = FormsIDs;
            CheckAndDrawFormsHeader(NavID, FormsIDs);
            AssignNavHeaderBtnActions(NavID);
        }
    } else {
        ShowForm(FormsIDs, '', '', false, Location, SubNavID);
        if (SubNavID != undefined && SubNavID != "" && Globals.UseSubNavs)
            HandleWidgetsSubNavs(NavID, FormsIDs, SubNavID, Location);
    }
}

function CheckAndDrawFormsHeader(NavID, FormsIDs) {
    try {
        DrawHeader();
        var FormsIDsArr = FormsIDs.split(',');
        var formTempID = FormsIDs.split('_')[FormsIDs.split('_').length - 1];
        var FormIDWithHeader = '';
        for (var i = 0; i < FormsIDsArr.length; i++) {
            if (HeaderDetailsArr[FormsIDsArr[i]]) {
                DrawHeader(FormsIDsArr[i]);
                FormIDWithHeader = FormsIDsArr[i];
                log('CheckAndDrawFormsHeader: Done For: ' + FormsIDs)
                break;
            }
            else {
                DrawHeader(formTempID);
            }

        }
        var NavController = new NavigationController();
        NavController = window['Nav_' + NavID];
        if (NavController.NavFormsStack.length < 3) {
            $("#HeaderContent .NavHomeBtn img").hide();
            $("#HeaderContent .NavHomeBtn").removeClass('NavHomeBtn');

        }
        HandleContentPanelTopMargin();
    }
    catch (e) {
        log('+_+_+_+_+_+_+_+_+_+_+_+_+_+_+ Exception in CheckAndDrawFormsHeader' + e);
    }
}

function PopNavForm(NavID, PopBackFormParamsObj) {
    var NavController = new NavigationController();
    NavController = window['Nav_' + NavID];
    NavController.NavFormsStack.pop();
    var FormsIDs = NavController.NavFormsStack[NavController.NavFormsStack.length - 1];
    ShowForm(FormsIDs);
    CheckAndDrawFormsHeader(NavID, FormsIDs);
    AssignNavHeaderBtnActions(NavID);
    ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
}

function ExecutePrevNavForm(NavID, FormID, PopBackFormParamsObj) {
    var NavController = new NavigationController();
    NavController = window['Nav_' + NavID];
    var FormsIDs = FormID;
    //HandleDataFromWidgetFunction(FormsIDs, DataFormParamsObj);
    ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);

}
function PopToRootNavForm(NavID, PopBackFormParamsObj) {
    var NavController = new NavigationController();
    NavController = window['Nav_' + NavID];
    while (NavController.NavFormsStack.length > 1)
        NavController.NavFormsStack.pop();
    var FormsIDs = NavController.NavFormsStack[0];
    ShowForm(FormsIDs);
    CheckAndDrawFormsHeader(NavID, FormsIDs);
    AssignNavHeaderBtnActions(NavID);
    ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
}

function PopToNavForm(NavID, FormID, PopBackFormParamsObj) {
    var NavController = new NavigationController();
    NavController = window['Nav_' + NavID];
    while (NavController.NavFormsStack[NavController.NavFormsStack.length - 1] != FormID)
        NavController.NavFormsStack.pop();
    var FormsIDs = NavController.NavFormsStack[NavController.NavFormsStack.length - 1];
    ShowForm(FormsIDs);
    CheckAndDrawFormsHeader(NavID, FormsIDs);
    AssignNavHeaderBtnActions(NavID);
    ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
}

function ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj) {
    try {
        log('Start ExecuteFormPopedBackFunction For ' + FormsIDs)
        var FormsIDsArr = FormsIDs.split(',');
        for (var i = 0; i < FormsIDsArr.length; i++) {
            try {
                log('Executing AfterFormPopedBack For Form: ' + FormsIDsArr[i] + ':: ');
                var FormObj = window[GetActiveSubPageID() + '_' + FormsIDsArr[i] + '_ClassIns'];
                log(FormObj);
                FormObj.AfterFormPopBack(PopBackFormParamsObj);
            } catch (e) {
                log('ExecuteFormPopedBackFunction For Form: ' + FormsIDsArr[i] + ', Err: ' + e);
            }
        }
    } catch (e) {
        log('ExecuteFormPopedBackFunction: ' + e);
    }
}

function AssignNavHeaderBtnActions(NavID, OptinalContainerSelector) {

    var LogStrPrefix = 'AssignNavHeaderBtnActions:- NavID: ' + NavID + ':- ';
    var NavController = new NavigationController();
    NavController = window['Nav_' + NavID];
    var ContainerSelector = '#HeaderContent';
    if (OptinalContainerSelector)
        ContainerSelector = OptinalContainerSelector;
    try {
        $(ContainerSelector + ' .NavBackBtn').bind('click', function () {
            NavController.NavFormsStack.pop();
            var FormsIDs = NavController.NavFormsStack[NavController.NavFormsStack.length - 1];
            ShowForm(FormsIDs);
            CheckAndDrawFormsHeader(NavID, FormsIDs);
            AssignNavHeaderBtnActions(NavID);
            ExecuteFormPopedBackFunction(FormsIDs);
        });
        log(LogStrPrefix + 'Done Assigning NavBackBtn Action');
    } catch (e) {

    }

    try {
        $(ContainerSelector + ' .NavHomeBtn').bind('click', function () {
            while (NavController.NavFormsStack.length > 1)
                NavController.NavFormsStack.pop();
            var FormsIDs = NavController.NavFormsStack[0];
            ShowForm(FormsIDs);
            CheckAndDrawFormsHeader(NavID, FormsIDs);
            AssignNavHeaderBtnActions(NavID);
            ExecuteFormPopedBackFunction(FormsIDs);
        });
        log(LogStrPrefix + 'Done Assigning NavHomeBtn Action');
    } catch (e) {

    }

    try {
        $(ContainerSelector + ' .NavLogoutBtn').bind('click', function () {
            if (DisplayLogoutConfirmationAlert) {
                ConfirmAlertFunction('Are you sure to logout ?', 'هل انت متاكد انك تريد الخروج من البرنامج ؟', 'Confirmation', 'تأكيد', 'Confirm', 'تأكيد', 'Cancel', 'الغاء', ' HandleNavLogoutBtnClicked(); ');
            }
            else {
                HandleNavLogoutBtnClicked();
            }

        });
        log(LogStrPrefix + 'Done Assigning NavLogoutBtn Action');
    } catch (e) {

    }
}

function HandleNavLogoutBtnClicked() {
    // To Be Implemented In Business
    HandleBusinessNavLogoutBtnClicked();
}

function ClearAllNavControllers() {
    try {
        for (var CurrNavID in NavigationControllersArr) {
            while (NavigationControllersArr[CurrNavID].NavFormsStack.length > 0)
                NavigationControllersArr[CurrNavID].NavFormsStack.pop();
            NavigationControllersArr[CurrNavID] = null;
            window['Nav_' + CurrNavID] = null;
        }
        NavigationControllersArr = new Array();
    } catch (e) {
        log(e);
    }
}

function HandleWidgetsToBeShown(ZoneLocation, ShowDetails) {
    ///////////////////////////////////////////////////////////////////////////////
    // Added By: Ahmed Same7
    // Modified By: Amir Ali
    // Desc:  -To hide Widgets in specific Zone If Tablet
    //		  -To Hide all widgets in Zone If One Zone Based application (Mobile)
    ///////////////////////////////////////////////////////////////////////////////
    if (ZoneLocation == "RightUp") {
        $('#Zone001TabletRightUP_Zone .widget').hide();
        $('#Zone001RightFull_Zone').hide();
        $('#Zone001DesktopRightFull_Zone').hide();
        $('#Zone001TabletRightUP_Zone').show();
        $('#ZonePostLoginFullScreen').hide();
        $('#ZoneTabletLeft_Zone').show();
        $('#ZoneDesktopLeft_Zone').show();

    }
    else if (ZoneLocation == "RightDown") {
        $('#Zone002TabletRightDown_Zone .widget').hide();
        $('#Zone001RightFull_Zone').hide();
        $('#Zone001DesktopRightFull_Zone').hide();
        $('#Zone002TabletRightDown_Zone').show();
        $('#ZonePostLoginFullScreen').hide();
        $('#ZoneTabletLeft_Zone').show();
        $('#ZoneDesktopLeft_Zone').show();
    }
    else if (ZoneLocation == "RightFull") {
        $('#Zone001TabletRightUP_Zone').hide();
        $('#Zone002TabletRightDown_Zone').hide();
        $('#Zone001RightFull_Zone .widget').hide();
        $('#Zone001RightFull_Zone').show();
        $('#Zone001DesktopRightFull_Zone .widget').hide();
        $('#Zone001DesktopRightFull_Zone').show();
        $('#ZoneTabletLeft_Zone').show();
        $('#ZoneDesktopLeft_Zone').show();
        $('#ZonePostLoginFullScreen').hide();
    }
    else if (ZoneLocation == "FullScreen") {

        $('#ZoneTabletLeft_Zone').hide();
        $('#ZoneDesktopLeft_Zone').hide();
        $('#Zone001TabletRightUP_Zone').hide();
        $('#Zone002TabletRightDown_Zone').hide();
        $('#Zone001RightFull_Zone .widget').hide();
        $('#Zone001RightFull_Zone').hide();
        $('#Zone001DesktopRightFull_Zone .widget').hide();
        $('#Zone001DesktopRightFull_Zone').hide();
        $('#ZonePostLoginFullScreen .widget').hide();
        $('#Zone00FullZoneTablet .widget').hide();
        $('#Zone00FullZoneTablet').show();
        $('#ZonePostLoginFullScreen').hide();
    }
    else
        $('.widget').hide();
}

function HandleWidgetsSubNavs(NavID, WidgetsID, SubNavID, ZoneLocation) {
    NavController = window['Nav_' + NavID];
    if (ZoneLocation == "RightUp") {
        if (NavController.SubNavs.UpNav.length > 0) {
            if (NavController.SubNavs.UpNav.indexOf(WidgetsID) == -1)
                NavController.SubNavs.UpNav.push(WidgetsID);
            else {
                NavController.SubNavs.UpNav.splice(NavController.SubNavs.UpNav.indexOf(WidgetsID), 1);
                NavController.SubNavs.UpNav.push(WidgetsID);
            }
            var BackBtnDivToBeAppended = '<div onclick="popNavSubForm(' + NavID + ',' + WidgetsID + ',' + ZoneLocation + ');" style="width:40%;display:inline-block;float:right;"><img src="../CA/Images/BackGray.png" class="BackBtnIconCssClass" style="float:right;margin-right:10px;display:inline-block !important;opacity:1;"> </div>'
            //  $('#CATabletMainSubPage_' + WidgetsID + '_WidgetHead .WidgetHeaderTitle').append(BackBtnDivToBeAppended);
        }
        else
            NavController.SubNavs.UpNav.push(WidgetsID);
    }
    else if (ZoneLocation == "RightDown") {
        // NavController.SubNavs.DownNav.push(WidgetsID);
        if (NavController.SubNavs.DownNav.length > 0) {
            if (NavController.SubNavs.DownNav.indexOf(WidgetsID) == -1)
                NavController.SubNavs.DownNav.push(WidgetsID);
            else {
                NavController.SubNavs.DownNav.splice(NavController.SubNavs.DownNav.indexOf(WidgetsID), 1);
                NavController.SubNavs.DownNav.push(WidgetsID);
            }
            var BackBtnDivToBeAppended = '<div onclick="popNavSubForm(' + NavID + ',' + WidgetsID + ',' + ZoneLocation + ');" style="width:40%;display:inline-block;float:right;"><img src="../CA/Images/BackGray.png" class="BackBtnIconCssClass" style="float:right;margin-right:10px;display:inline-block !important;opacity:1;"> </div>'
            //   $('#CATabletMainSubPage_' + WidgetsID + '_WidgetHead .WidgetHeaderTitle').append(BackBtnDivToBeAppended);
        }
        else
            NavController.SubNavs.DownNav.push(WidgetsID);
    }
    else if (ZoneLocation == "RightFull") {
        //NavController.SubNavs.FullNav.push(WidgetsID);
        if (NavController.SubNavs.FullNav.length > 0) {
            if (NavController.SubNavs.FullNav.indexOf(WidgetsID) == -1)
                NavController.SubNavs.FullNav.push(WidgetsID);
            else {
                NavController.SubNavs.FullNav.splice(NavController.SubNavs.FullNav.indexOf(WidgetsID), 1);
                NavController.SubNavs.FullNav.push(WidgetsID);
            }
            var BackBtnDivToBeAppended = '<div onclick="popNavSubForm(' + NavID + ',' + WidgetsID + ',' + ZoneLocation + ');" style="width:40%;display:inline-block;float:right;"><img src="../CA/Images/BackGray.png" class="BackBtnIconCssClass" style="float:right;margin-right:10px;display:inline-block !important;opacity:1;"> </div>'
            //     $('#CATabletMainSubPage_' + WidgetsID + '_WidgetHead .WidgetHeaderTitle').append(BackBtnDivToBeAppended);
        }
        else
            NavController.SubNavs.FullNav.push(WidgetsID);
    }
    else if (ZoneLocation == "FullScreen") {
        return;
    }
    else
        return;
}
function PopNavSubForm(NavID, ZoneLocation, PopBackFormParamsObj) {
    NavController = window['Nav_' + NavID];
    if (ZoneLocation == "RightUp") {
        NavController.SubNavs.UpNav.pop();
        var FormsIDs = NavController.SubNavs.UpNav[NavController.SubNavs.UpNav.length - 1];
        ShowForm(FormsIDs, '', '', false, ZoneLocation);
        //CheckAndDrawFormsHeader(NavID, FormsIDs);
        // AssignNavHeaderBtnActions(NavID);
        ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
    }
    else if (ZoneLocation == "RightDown") {
        // NavController.SubNavs.DownNav.push(WidgetsID);
        NavController.SubNavs.DownNav.pop();
        var FormsIDs = NavController.SubNavs.DownNav[NavController.SubNavs.DownNav.length - 1];
        ShowForm(FormsIDs, '', '', false, ZoneLocation);
        //CheckAndDrawFormsHeader(NavID, FormsIDs);
        // AssignNavHeaderBtnActions(NavID);
        ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
        // var BackBtnDivToBeAppended = '<div onclick="popNavSubForm(' + NavID + ',' + WidgetsID + ',' + ZoneLocation + ');" style="width:40%;display:inline-block;float:right;"><img src="../CA/Images/BackGray.png" class="BackBtnIconCssClass" style="float:right;margin-right:10px;display:inline-block !important;opacity:1;"> </div>'
        // $('#CATabletMainSubPage_' + WidgetsID + '_WidgetHead .WidgetHeaderTitle').append(BackBtnDivToBeAppended);


    }
    else if (ZoneLocation == "RightFull") {
        //NavController.SubNavs.FullNav.push(WidgetsID);
        //  if (NavController.SubNavs.FullNav.length > 0) {
        NavController.SubNavs.FullNav.pop();
        var FormsIDs = NavController.SubNavs.FullNav[NavController.SubNavs.FullNav.length - 1];
        ShowForm(FormsIDs, '', '', false, ZoneLocation);
        //CheckAndDrawFormsHeader(NavID, FormsIDs);
        // AssignNavHeaderBtnActions(NavID);
        ExecuteFormPopedBackFunction(FormsIDs, PopBackFormParamsObj);
    }
}

//function ShowForm(WidgetsID, WidgetsToBeRefreshedIDs, PostData, ShowSpinner, ZoneLocation, SubNavID, ShowDetails) {
//    try {

//        var WidgetsArr;
//        var WidgetID;

//		if (ZoneLocation == null){
//			ZoneLocation = "";
//		}						  
//        if (WidgetsID == null) {
//            WidgetsID = "";
//        }
//        if (ShowDetails == null) {
//            ShowDetails = false;
//        }
//        if (WidgetsToBeRefreshedIDs == null) {
//            WidgetsToBeRefreshedIDs = "";
//        }

//        if (PostData == null) {
//            PostData = "";
//        }

//        if (ShowSpinner == null) {
//            ShowSpinner = false;
//        }

//        if (ShowSpinner) {
//            ShowMyLoginSpinner();
//        }

//        WidgetsArr = WidgetsID.split(',');
//        HandleWidgetsToBeShown(ZoneLocation, ShowDetails);
//		//HandleWidgetsToBeShown(ZoneLocation);
//		var WidgetID = WidgetsArr[0];
//		if (WidgetID.toLowerCase() == "empty"){

//		 }					   
//	else{
//		        for (var i = 0; i < WidgetsArr.length; i++) {
//            try {

//                var WidgetID = WidgetsArr[i];
//                try {
//                    window[GetActiveSubPageID() + '_' + WidgetID + "_ClassIns"].BeforeShowForm();
//                } catch (e) {
//                    log(e);
//                }
//                eval("Collapse_" + GetActiveSubPageID() + "_" + WidgetID + "=true");
//                if ((eval("Collapse_" + GetActiveSubPageID() + "_" + WidgetID))) {
//                    Collapse(GetActiveSubPageID() + "_" + WidgetID, false, true);
//                }
//                $('#' + GetActiveSubPageID() + "_" + WidgetID).show();
//                $('#' + GetActiveSubPageID() + "_" + WidgetID).css({ 'visibility': 'visible' });
//                $('#' + GetActiveSubPageID() + "_" + WidgetID + '_Widget_Content_Data').show();

//                try { eval('OnShowWidget_' + GetActiveSubPageID() + "_" + WidgetID + '();'); } catch (e) { }
//            } catch (e) {
//                log(e);
//            }
//            try {

//                window[GetActiveSubPageID() + '_' + WidgetID + "_ClassIns"].AfterShowForm();
//            } catch (e) {
//                log(e);
//            }
//        }
//	}
//       try {
//            var WidgetsToBeRefreshedArr = WidgetsToBeRefreshedIDs.split(',');
//            var PostDataArr = PostData.split(',');
//            for (var i = 0; i < WidgetsToBeRefreshedArr.length; i++) {
//                var RefreshedWidgetID = WidgetsToBeRefreshedArr[i];
//                if (!(eval("Collapse_" + GetActiveSubPageID() + "_" + RefreshedWidgetID))) {
//                    eval("LoadWidgetContent_" + GetActiveSubPageID() + "_" + RefreshedWidgetID + "(" + PostDataArr[i] + ");");
//                }
//            }
//        } catch (e) {
//        }

//    }
//    catch (e) {
//        log("Exception at ShowWidget ::  " + e);
//    }
//}
function GetActiveSubPageID() {
    try {
        return $('.SubpagesClass').attr("id");
        //return $('.SubpagesClass[style^="display: block"]').attr("id");
    } catch (e) { alert(e); }
}
function ShowForm(WidgetsID, WidgetsToBeRefreshedIDs, PostData, ShowSpinner, ZoneLocation, SubNavID, ShowDetails) {
    try {

        var WidgetsArr;
        var WidgetID;

        if (ZoneLocation == null) {
            ZoneLocation = "";
        }
        if (WidgetsID == null) {
            WidgetsID = "";
        }
        if (ShowDetails == null) {
            ShowDetails = false;
        }
        if (WidgetsToBeRefreshedIDs == null) {
            WidgetsToBeRefreshedIDs = "";
        }

        if (PostData == null) {
            PostData = "";
        }

        if (ShowSpinner == null) {
            ShowSpinner = false;
        }

        if (ShowSpinner) {
            ShowMyLoginSpinner();
        }

        WidgetsArr = WidgetsID.split(',');
        HandleWidgetsToBeShown(ZoneLocation, ShowDetails);
        //HandleWidgetsToBeShown(ZoneLocation);
        var WidgetID = WidgetsArr[0];
        if (WidgetID.toLowerCase() == "empty") {

        }
        else {

            for (var i = 0; i < WidgetsArr.length; i++) {
                try {

                    var WidgetID = WidgetsArr[i];
                    var cached = eval('CacheSettingsArrr.' + WidgetID);
                    //var cached = jQuery.grep(CacheSettingsArrr, function (a) {
                    //    return a.WidgetID == WidgetID;
                    //})[0];
                    var widgetFullName = cached.SubPageID + "_" + cached.WidgetID;
                    try {
                        window[widgetFullName + "_ClassIns"].BeforeShowForm();
                    } catch (e) {
                        log(e);
                    }
                    eval("Collapse_" + widgetFullName + "=true");
                    if ((eval("Collapse_" + widgetFullName))) {
                        Collapse(widgetFullName, false, true);
                    }
                    $('#' + widgetFullName).show();
                    $('#' + widgetFullName).css({ 'visibility': 'visible' });
                    $('#' + widgetFullName + '_Widget_Content_Data').show();
                    $('.SubpagesClass').css('display', 'none');
                    $('#' + widgetFullName).closest('.SubpagesClass').css('display', 'block');
                    try { eval('OnShowWidget_' + widgetFullName + '();'); } catch (e) { }
                } catch (e) {
                    log(e);
                }
                try {

                    window[widgetFullName + "_ClassIns"].AfterShowForm();
                } catch (e) {
                    log(e);
                }
            }
        }
        try {
            var WidgetsToBeRefreshedArr = WidgetsToBeRefreshedIDs.split(',');
            var PostDataArr = PostData.split(',');
            for (var i = 0; i < WidgetsToBeRefreshedArr.length; i++) {
                var RefreshedWidgetID = WidgetsToBeRefreshedArr[i];
                if (!(eval("Collapse_" + GetActiveSubPageID() + "_" + RefreshedWidgetID))) {
                    eval("LoadWidgetContent_" + GetActiveSubPageID() + "_" + RefreshedWidgetID + "(" + PostDataArr[i] + ");");
                }
            }
        } catch (e) {
        }

    }
    catch (e) {
        log("Exception at ShowWidget ::  " + e);
    }
}

AlertFunction = function (textEN, textAR, titelEN, titelAR, OK_Tetx_EN, OK_Text_AR, CallBAckFunction) {
    try {
        //Added to hide spinner
        HideLoadingSpinner();
        //--------------------
        jAlert(config.AppLangID.toLowerCase() == "en" ? textEN : textAR, config.AppLangID.toLowerCase() == "en" ? titelEN : titelAR, "", config.AppLangID.toLowerCase() == "en" ? OK_Tetx_EN : OK_Text_AR, CallBAckFunction);
        $('#popup_overlay').bind('click', function () {
            return;
        });
    } catch (e) {
    }

    // edited to handle alert in Blind Mode
    try {
        HandleBlindAlert(titelEN, titelAR, textEN, textAR);
    }
    catch (e) {
    }
    //end
}



ConfirmAlertFunction = function (textEN, textAR, titelEN, titelAR, OK_Tetx_EN, OK_Text_AR, Cancel_Text_EN, Cancel_Text_AR, CallBAckFunction, CancelCallBackFunction) {
    try {
        if (CancelCallBackFunction == null || CancelCallBackFunction == undefined) {
            jConfirm(config.AppLangID.toLowerCase() == "en" ? textEN : textAR, Language == "en" ? titelEN : titelAR, true, config.AppLangID.toLowerCase() == "en" ? OK_Tetx_EN : OK_Text_AR, config.AppLangID.toLowerCase() == "en" ? Cancel_Text_EN : Cancel_Text_AR, CallBAckFunction);
        }
        else {
            jConfirm(config.AppLangID.toLowerCase() == "en" ? textEN : textAR, Language == "en" ? titelEN : titelAR, true, config.AppLangID.toLowerCase() == "en" ? OK_Tetx_EN : OK_Text_AR, config.AppLangID.toLowerCase() == "en" ? Cancel_Text_EN : Cancel_Text_AR, CallBAckFunction, CancelCallBackFunction);
        }
        $('#popup_overlay').bind('click', function () {

            return;
        });
    } catch (e) {
    }
}





function SetSwiperPagerProperties(MainContanerCSS, paginationContainerCSS, ArrowLeftContanerCSS, ArrowRightContanerCSS, paginationItemID, CreateNewInetiate) {
    if ($("." + MainContanerCSS).is(':hidden')) {
        return false;
    }
    Globals.VoiceOverOn = Globals.VoiceOverOn || false;
    Globals.ArrowsLimit = Globals.ArrowsLimit || 1;
    // added by atman 24/12
    var CreateNewInetiateFlage = true;
    if ($("#" + paginationItemID + "0").css('display') == "inline-block") {
        CreateNewInetiateFlage = false;
    } else {
        CreateNewInetiateFlage = true;
    }
    /* var CreateNewInetiateFlage = true;
     if (CreateNewInetiate == null || CreateNewInetiate == undefined) {
         CreateNewInetiateFlage = true;
     } else {
         CreateNewInetiateFlage = CreateNewInetiate;
     }*/

    var mySwiper = new Swiper('#' + GetActiveSubPageID() + ' .' + MainContanerCSS, {
        pagination: '#' + GetActiveSubPageID() + ' .' + paginationContainerCSS,
        loop: false,
        grabCursor: true,
        noSwiping: true,
        paginationClickable: true,
        ArrowUniqueLeftCss: '' + ArrowLeftContanerCSS + '',
        ArrowUniqueRighCss: '' + ArrowRightContanerCSS + '',
        paginationItemID: '' + paginationItemID + '',
        CreateNew: CreateNewInetiateFlage
    })
    $('.' + ArrowLeftContanerCSS).on('click', function (e) {
        e.preventDefault()
        mySwiper.swipePrev()

    })
    $('.' + ArrowRightContanerCSS).on('click', function (e) {
        e.preventDefault()
        mySwiper.swipeNext()

    })

    if (Globals.VoiceOverOn) {
        if ($('.' + paginationContainerCSS + ' span').length <= Globals.ArrowsLimit) {

            $('.' + ArrowLeftContanerCSS + '').hide();
            $('.' + ArrowRightContanerCSS + '').hide();
        } else {
            $('#' + GetActiveSubPageID() + ' .' + ArrowLeftContanerCSS + '').addClass('ui-disabled');
            $('#' + GetActiveSubPageID() + ' .' + paginationContainerCSS + '').width($('#' + GetActiveSubPageID() + ' .' + paginationContainerCSS + ' span').length * 9 + "%");
        }
    }
    else {
        if ($('.' + paginationContainerCSS + ' span').length <= 9) {

            $('.' + ArrowLeftContanerCSS + '').hide();
            $('.' + ArrowRightContanerCSS + '').hide();
        } else {
            $('#' + GetActiveSubPageID() + ' .' + ArrowLeftContanerCSS + '').addClass('ui-disabled');
            $('#' + GetActiveSubPageID() + ' .' + paginationContainerCSS + '').width($('#' + GetActiveSubPageID() + ' .' + paginationContainerCSS + ' span').length * 8 + "%");
        }
    }
}

function GetBindedEvents(SelectorStr) {
    var elems = $(SelectorStr);
    log('Elements: ');
    log(elems);
    for (var i = 0; i < elems.length; i++) {
        log(i);
        log('Getting Binded Events For: ');
        log(elems[i]);
        var data = jQuery.hasData(elems[i]) && jQuery._data(elems[i]);
        log('JQuery elem _data: '); log(data);
        if (data) {
            log('data.events: '); log(data.events);
            if (data.events) {
                for (var evt in data.events) {
                    for (var j = 0; j < data.events[evt].length; j++) {
                        log('   ' + j + '::::: data.events[evt][' + j.toString() + '] : '); log(data.events[evt][j]);
                        log('   handler: ');
                        log('   ' + data.events[evt][j].handler);
                        for (var elem in data.events[evt][j].handler) {
                            log('   	handler elem::: ' + elem + ': ');
                            log(data.events[evt][j].handler[elem]);
                        }
                        var TempId = 'GottenHandlers_' + data.events[evt][j].handler.guid + '_' + (new Date() - 0);
                        window[TempId] = data.events[evt][j].handler;
                        if (!window['GottenHandlers'])
                            window['GottenHandlers'] = new Array();
                        window['GottenHandlers'].push(data.events[evt][j].handler);
                    }
                }
            }
        }
    }
}


function RefreshWidget() {

}





////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// To Generate Templates Predifined Cache
// The Below Script To be used in Browser of needed Portal App for both Arabic and English Portal App Pages,
//where it calls the Templates, cache it into localStorage and generates functions for setting widgets cache

//localStorage.clear(); //Only once
Globals.TemplatesIDsToBeHavingPredifinedCache = ""; //Array of templates IDs to be having predifined cache 
//["BSFMainSubPage_LoginForm", "BSFMainSubPage_ATMAndBranchesPreLogin", "BSFMainSubPage_ContactUsList", "BSFMainSubPage_HelpList", "BSFMainSubPage_ProductWidget", "BSFMainSubPage_PreLoginCurrencyConverter", "BSFMainSubPage_BannerDescription", "BSFMainSubPage_LoginAction", "BSFMainSubPage_UserGuide", "BSFMainSubPage_FAQs", "BSFMainSubPage_SecurityCenter", "BSFMainSubPage_OTPChoices", "BSFMainSubPage_OTPSMSVerification", "BSFMainSubPage_OTPIVRVerification", "BSFMainSubPage_OTPFransiKey", "BSFMainSubPage_OTPHardToken", "BSFMainSubPage_OTPValidationAction", "BSFMainSubPage_WelcomeWidget", "BSFMainSubPage_AccountWidget", "BSFMainSubPage_PaymentWidget", "BSFMainSubPage_AccountsList", "BSFMainSubPage_CardsWidget", "BSFMainSubPage_CardsList", "BSFMainSubPage_Settings", "BSFMainSubPage_PaymentPayFromWidget", "BSFMainSubPage_PaymentPayToWidget", "BSFMainSubPage_PaymentMaxViewWidget", "BSFMainSubPage_ATMAndBranchesWidget", "BSFMainSubPage_ContactUsListPostLogin"]
var Globals = window.Globals || {};
Globals.TemplatesIDsToBeHavingPredifinedCache = Globals.TemplatesIDsToBeHavingPredifinedCache || {};
//Globals.TemplatesIDsToBeHavingPredifinedCache = CacheSettingsArr; //if All Templates is to be having Predefined Cache
var TempTemplatesIDsToBeHavingPredifinedCacheObj = {};
function EnableTemplateCache() {
    try {
        for (var i = 0; i < Globals.TemplatesIDsToBeHavingPredifinedCache.length; i++) {
            TempTemplatesIDsToBeHavingPredifinedCacheObj[Globals.TemplatesIDsToBeHavingPredifinedCache[i]] = Globals.TemplatesIDsToBeHavingPredifinedCache[i];
        }
    } catch (e) {
        log(e);
    }
    for (var key in TempTemplatesIDsToBeHavingPredifinedCacheObj) {
        log(key + ": " + CacheSettingsArr[key].CacheEnabled + CacheSettingsArr[key].CacheExpiryInterval)
        CacheSettingsArr[key].CacheEnabled = true;
        CacheSettingsArr[key].CacheExpiryInterval = 10800;
    }
}

function DisableCallFunctions() {
    CommonForm.prototype.RunForm = function () { };
    CallMWBridge = function () { }
    CommonForm.prototype.RunForm = function () { };
}

// The Below function to be called in both Arabic & English Pages
function CallTemplateToBeCached() {
    EnableTemplateCache();
    DisableCallFunctions();
    var FormsArr = new Array();
    for (var key in TempTemplatesIDsToBeHavingPredifinedCacheObj) {
        FormsArr.push(key)
    }
    var CurrentCallIndex = 0;
    var intervalofcalls = setInterval(function () {
        if (!FormsArr[CurrentCallIndex] || CurrentCallIndex == 300) { clearInterval(intervalofcalls) };
        try { LoadAndRunForm(FormsArr[CurrentCallIndex], {}, false, null, null); } catch (e) { }
        HideLoadingSpinner();
        log(CurrentCallIndex);
        CurrentCallIndex++;
    }, 100);

}



// the below is to be executed after runing the function 'CallTemplateToBeCached' in both AR, EN; and All generate GetPredifinedCache functions will be stored in variable window.GetWidgetsPredefinedCacheFnsStr
var TemplatesCachePrefix = "BSFMainSubPage_"; //SubPageID of Templates 
function GenerateTemplatesPredifinedCacheFunctions() {
    for (var key in localStorage) {
        if (key.startsWith(TemplatesCachePrefix)) {
            //log(key.);
            var widgetid = key.substring(0, key.indexOf('.'));
            window[widgetid + '_ToBeCachedObj'] = window[widgetid + '_ToBeCachedObj'] || {};
            window[widgetid + '_ToBeCachedObj'][key] = localStorage.getItem(key);
            window["AllWidgetsCache"] = window["AllWidgetsCache"] || {};
            window["AllWidgetsCache"][widgetid] = window[widgetid + '_ToBeCachedObj'];
        }
    }

    window.GetWidgetsPredefinedCacheFnsStr = '';
    for (var widgetid in AllWidgetsCache) {
        var x = 'localStorage.setItem("#key#",JSON.stringify(#objStr#));\n';
        var y = '';
        for (var ck in AllWidgetsCache[widgetid]) {
            y = y + x.replace("#key#", ck).replace("#objStr#", AllWidgetsCache[widgetid][ck]);
        }
        GetWidgetsPredefinedCacheFnsStr = GetWidgetsPredefinedCacheFnsStr +
            '\nfunction ' + widgetid + '_GetPredefinedCache(){\n' + y + '}'

    }
}

function TestPredifinedCache() {
    localStorage.clear();
    for (var widgetid in TempTemplatesIDsToBeHavingPredifinedCacheObj) {
        try {
            window[widgetid + '_GetPredefinedCache']();
        } catch (e) { log(widgetid + ':  ' + e); }
    }
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


</script>

</body>
</html>
