<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>dmp.advertising.09062313dc85d19956c2.html</title>
</head>
<body>
<script>"use strict";(this.dmpJsonp=this.dmpJsonp||[]).push([[124],{1948:(e,t,i)=>{i.r(t),i.d(t,{AdErrorMessages:()=>ne,AdEvents:()=>te,IMASdkHandler:()=>Lo,adEventEmitter:()=>ee,adSdk:()=>bd,initAdStack:()=>Nc,initCookieSync:()=>fo,resetAdStack:()=>Uc});var n={};i.r(n),i.d(n,{AD_DIRECTOR_XHR_CALL_FAILED:()=>se,AD_STACK_INIT_ERROR:()=>oe,IMA_REQUEST_ADS_TIMEOUT:()=>fe,IMA_REQUEST_ERROR:()=>Pe,NO_ADS:()=>ae,PARSING_ERROR:()=>Le,SIMID_ERROR:()=>ke,UNKNOWN_ERROR:()=>de,VPAID_ABORTED:()=>le,VPAID_BUFFER_ERROR:()=>me,VPAID_BUFFER_TIMEOUT:()=>ge,VPAID_FETCH_ERROR:()=>he,VPAID_FETCH_TIMEOUT:()=>Ee,VPAID_INIT_ERROR:()=>pe,VPAID_INIT_TIMEOUT:()=>_e,VPAID_PLAY_ERROR:()=>Te,VPAID_SDK_LOAD_ERROR:()=>ce,VPAID_SDK_LOAD_TIMEOUT:()=>ue,VPAID_SKIP_ERROR:()=>De,VPAID_SKIP_TIMEOUT:()=>Ie,VPAID_START_ERROR:()=>ve,VPAID_START_TIMEOUT:()=>Ae,VPAID_STOP_ERROR:()=>Re,VPAID_STOP_TIMEOUT:()=>Se});var r={};i.r(r),i.d(r,{canUseNativeOmsdk:()=>yn,getExecutableVerificationScripts:()=>bn,getLoadedParameters:()=>Pn,getOmPartner:()=>On,hasOmid:()=>Vn});var s={};i.r(s),i.d(s,{init:()=>Xr});var a={};i.r(a),i.d(a,{init:()=>as});var o={};i.r(o),i.d(o,{init:()=>ds});var d={};i.r(d),i.d(d,{init:()=>cs});var l={};i.r(l),i.d(l,{init:()=>vs});var c={};i.r(c),i.d(c,{init:()=>ms});var u={};i.r(u),i.d(u,{init:()=>Ts});var h={};i.r(h),i.d(h,{init:()=>Ds});var E={};i.r(E),i.d(E,{init:()=>Ps});var p={};i.r(p),i.d(p,{_unitTests:()=>po,callFetchAd:()=>to,callInitAd:()=>io,callSkipAd:()=>ro,callStartAd:()=>no,callStopAd:()=>so,cleanPendingCalls:()=>oo,getMediaFile:()=>Ja,loadMediaFile:()=>Za,subscribe:()=>uo,unload:()=>ao,unsubscribe:()=>ho});let _=null,v=null,A=null,m=null;function g(e){_=e.config,A=e.playerSizeAPI,v=e.playerAPI,m=e.eventBus}function T(){return window.dmp_getLogger(...arguments)}function R(){var e;return null==(e=v)?void 0:e.isParallelAdCallsEnabled()}function S(e){var t;return null==(t=v)?void 0:t.isPlayerFeatureEnabled(e)}function D(){var e;return null==(e=v)?void 0:e.getInfopack()}function I(){var e;return null==(e=v)?void 0:e.getPerformance()}function L(){var e;return null==(e=v)?void 0:e.getAppId()}function k(){var e;return null==(e=v)?void 0:e.getClientType()}function f(){var e;return null==(e=v)?void 0:e.isCookies3rdPartyAvailable()}function P(){var e;return null==(e=v)?void 0:e.getCustomConfig()}function y(){var e;return null==(e=v)?void 0:e.getImaNativeVersion()}function O(){var e;return null==(e=v)?void 0:e.isNativeApp()}function b(){var e;return null==(e=v)?void 0:e.isPes()}function C(){var e;return null==(e=v)?void 0:e.isOnsite()}function N(){return _}function U(){return m}function V(e){var t,i;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!=(t=null==(i=v)?void 0:i.getMetadata()[e])?t:n}function M(){var e;return null==(e=v)?void 0:e.getFullscreenState()}function w(){var e;return null==(e=v)?void 0:e.getPlayerVolume()}function F(){var e;return null==(e=v)?void 0:e.isRealAutoplay()}function B(){var e;return null==(e=v)?void 0:e.getStore().getState()}function x(){var e;return null==(e=v)?void 0:e.getPlayerVideoTag()}function H(e,t){const i=B().settings;if(!R())return i?i[e]:t;if(!i)return t;const n=i[e]||_.settings(e);return void 0===n?t:n}function K(){var e;return null==(e=v)?void 0:e.getVideoSettings()}function Y(){return v.getVideoState()}function G(){var e;return null==(e=v)?void 0:e.getPlaybackState()}function Q(){var e;return null==(e=v)?void 0:e.getSequenceState()}function $(){var e;return null==(e=v)?void 0:e.getNativeSdkCapabilities()}function j(){var e;return null==(e=v)?void 0:e.getChromecastStatus()}function q(e,t){v.dispatchFromPlayer(e,t)}function W(){var e;return null==(e=v)?void 0:e.getCcpaToLeoParam()}function z(){var e;null==(e=v)||e.onFallbackToVideoContent()}function X(){var e;return null==(e=v)?void 0:e.isGdprApplicable()}function Z(e,t){var i,n;const r=null==(i=v)?void 0:i.getPlayerBackendConfig();return null!=(n=null==r?void 0:r[e])?n:t}class J{constructor(){this.handlers=[],this.alreadyDispatchedEvent=null}subscribe(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;this.alreadyDispatchedEvent===t&&R()&&e(),this.handlers.push({event:t,handler:e,context:i})}unsubscribe(e,t){this.handlers.forEach(((i,n,r)=>{i.event===t&&i.handler===e&&r.splice(n,1)}))}publish(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];const s=[];this.handlers.forEach((t=>{t.event!==e&&"*"!==t.event||s.push({isAlwaysExecute:"*"===t.event,handler:t.handler.bind(t.context)})})),(null==(t=n[0])?void 0:t.shouldSubscribeEvent)&&R()&&(this.alreadyDispatchedEvent=e),s.forEach((t=>{let{isAlwaysExecute:i,handler:r}=t;i?r(e,...n):r(...n)}))}unsubscribeAll(){this.handlers=[]}}const ee=new class extends J{dispatchEvent(e,t){this.publish(e,t)}addEventListener(e,t){this.subscribe(t,e)}removeEventListener(e,t){this.unsubscribe(t,e)}removeAllEventListeners(){this.unsubscribeAll()}},te={AD_BREAK_WILL_START:"AD_BREAK_WILL_START",AD_BUFFER_FINISH:"AD_BUFFER_FINISH",AD_BUFFER_START:"AD_BUFFER_START",AD_CLICK:"AD_CLICK",AD_COMPANIONS_RECEIVED:"AD_COMPANIONS_RECEIVED",AD_ERROR:"AD_ERROR",AD_DATA_UPDATED:"AD_DATA_UPDATED",AD_IMPRESSION:"AD_IMPRESSION",AD_LINEAR_SLOT_ENDED:"AD_LINEAR_SLOT_ENDED",AD_LINEAR_SLOT_STARTED:"AD_LINEAR_SLOT_STARTED",AD_LINEAR_STARTED:"AD_LINEAR_STARTED",AD_LINEAR_STOPPED:"AD_LINEAR_STOPPED",AD_LINEAR_WILL_START:"AD_LINEAR_WILL_START",AD_LOADED:"AD_LOADED",AD_LOG:"AD_LOG",AD_NON_LINEAR_DISPLAY_STARTED:"AD_NON_LINEAR_DISPLAY_STARTED",AD_PAUSED:"AD_PAUSED",AD_PLAYING:"AD_PLAYING",AD_POD_ERROR:"AD_POD_ERROR",AD_NON_LINEAR_WILL_START:"AD_NON_LINEAR_WILL_START",AD_NON_LINEAR_WILL_STOP:"AD_NON_LINEAR_WILL_STOP",AD_REGISTER_ADBREAKS:"AD_REGISTER_ADBREAKS",AD_SDK_READY:"AD_SDK_READY",AD_SKIPPED:"AD_SKIPPED",AD_SKIP_REQUESTED:"AD_SKIP_REQUESTED",AD_SLOT_INJECTED:"AD_SLOT_INJECTED",AD_STACK_ERROR:"AD_STACK_ERROR",AD_STARTED:"AD_STARTED",AD_STOPPED:"AD_STOPPED",AD_VIDEO_COMPLETE:"AD_VIDEO_COMPLETE",AD_VIDEO_FIRST_QUARTILE:"AD_VIDEO_FIRST_QUARTILE",AD_VIDEO_MIDPOINT:"AD_VIDEO_MIDPOINT",AD_VIDEO_SKIPPABLE_REMAINING_TIME:"AD_VIDEO_SKIPPABLE_REMAINING_TIME",AD_VIDEO_SKIPPABLE_STATE:"AD_VIDEO_SKIPPABLE_STATE",AD_VIDEO_START:"AD_VIDEO_START",AD_VIDEO_THIRD_QUARTILE:"AD_VIDEO_THIRD_QUARTILE",AD_VIDEO_VOLUME_CHANGED:"AD_VIDEO_VOLUME_CHANGED",AD_VMAP_RECEIVED:"AD_VMAP_RECEIVED",AD_VMAP_REQUESTED:"AD_VMAP_REQUESTED",AD_BREAK_STARTED:"AD_BREAK_STARTED",RESET_CURRENT_AD_BREAK:"RESET_CURRENT_AD_BREAK",SET_AD_FALLBACK:"SET_AD_FALLBACK",START_AD_FALLBACK:"START_AD_FALLBACK",PLAYER_API_CUST_CONFIG_CONSUMED:"PLAYER_API_CUST_CONFIG_CONSUMED",PLAYER_API_SET_CUST_CONFIG:"PLAYER_API_SET_CUST_CONFIG",PLAYER_CHROMECAST_SESSION_AVAILABLE:"PLAYER_CHROMECAST_SESSION_AVAILABLE",PLAYER_CHROMECAST_STATUS_CHANGED:"PLAYER_CHROMECAST_STATUS_CHANGED",PLAYER_CONTENT_SIZE_CHANGED:"PLAYER_CONTENT_SIZE_CHANGED",PLAYER_ERROR:"PLAYER_ERROR",PLAYER_FULLSCREEN_CHANGED:"PLAYER_FULLSCREEN_CHANGED",PLAYER_GDPR_CONSENT_COLLECTION_REQUESTED:"PLAYER_GDPR_CONSENT_COLLECTION_REQUESTED",PLAYER_GDPR_CONSENT_COLLECTION_RESOLVED:"PLAYER_GDPR_CONSENT_COLLECTION_RESOLVED",PLAYER_HEAVYADSINTERVENTION_CHANGED:"PLAYER_HEAVYADSINTERVENTION_CHANGED",PLAYER_IMA_NATIVE_EVENT:"PLAYER_IMA_NATIVE_EVENT",PLAYER_LOAD_VIDEO:"PLAYER_LOAD_VIDEO",PLAYER_PAUSE_REQUESTED:"PLAYER_PAUSE_REQUESTED",PLAYER_PLAY_REQUESTED:"PLAYER_PLAY_REQUESTED",PLAYER_SCHEDULER_END_SEQUENCE:"PLAYER_SCHEDULER_END_SEQUENCE",PLAYER_SEEK_REQUESTED:"PLAYER_SEEK_REQUESTED",PLAYER_SEQUENCE_ENDED:"PLAYER_SEQUENCE_ENDED",PLAYER_TOGGLE_PLAYBACK_REQUESTED:"PLAYER_TOGGLE_PLAYBACK_REQUESTED",PLAYER_VIDEO_DURATION_CHANGE:"PLAYER_VIDEO_DURATION_CHANGE",PLAYER_VIDEO_ENDED:"PLAYER_VIDEO_ENDED",PLAYER_VIDEO_PAUSE:"PLAYER_VIDEO_PAUSE",PLAYER_VIDEO_PLAY:"PLAYER_VIDEO_PLAY",PLAYER_VIDEO_PLAYING:"PLAYER_VIDEO_PLAYING",PLAYER_VIDEO_SELECTED:"PLAYER_VIDEO_SELECTED",PLAYER_VIDEO_TIME_UPDATE:"PLAYER_VIDEO_TIME_UPDATE",PLAYER_VIDEO_VOLUME_CHANGED:"PLAYER_VIDEO_VOLUME_CHANGED",IMA_NATIVE_AD_REQUESTED:"IMA_NATIVE_AD_REQUESTED",IMA_NATIVE_AD_STOPPED:"IMA_NATIVE_AD_STOPPED"},ie={AD_DIRECTOR_REQUEST_TIMEOUT:"Ad Director request timeout",AD_DIRECTOR_REQUEST_FAILED:"Ad Director request failed",AD_UNIT_CANCEL:"Ad unit has been cancelled",BAD_PROTOCOL:"Cannot go from HTTPS to HTTP",EMPTY_VAST_DATA_OR_URI:"Unexpected outcome while trying to parse VAST XML",IMA_SDK_NOT_LOADED:"IMA SDK not loaded",IMA_SDK_INCORRECT_TAG:"Unexpected VMAP/playlist tag. Only VAST tags are supported.",NO_FILL:"No fill",NO_SUPPORTED_CREATIVE:"No supported creative",NON_LINEAR_DIMENSIONS:"Unable to display NonLinear ad because creative dimensions do not align with creative display area",SUPPORTED_CREATIVE_ERROR:"Error while getting a supported creative",STREAM_UNPLAYABLE_SRC:"No playable Mediafile",VAST_WRAPPER_REQUEST_TIMEOUT:"VAST wrapper request timeout",VAST_WRAPPER_REQUEST_FAILED:"VAST wrapper request failed",VPAID_SDK_REQUEST_FAILED:"Unreacheable VPAID url",AD_TIMEOUT_REACHED:"Timeout reached",UNSUPPORTED_ADSOURCE:"No supported VAST adSource provided",INVALID_ERROR:"invalid AdError raised",INVALID_FORMAT_VPAID_ERROR:"Invalid format for VPAID Error",IMA_ADSMANAGER_UNDEFINED:"IMA adsManager undefined",FAILED_TO_PARSE_AD_PARAMS:"Failed to parse JSON ad parameters",CREATIVE_ALREADY_PLAYED_IN_SLOT:"Creative was already played in this ad slot"};Object.entries(ie).forEach((e=>{let[t,i]=e;ie[t]=`DM_${i}`}));const ne=ie;var re=i(4201);const se="AD_DIRECTOR_XHR_CALL_FAILED",ae="NO_ADS",oe="AD_STACK_INIT_ERROR",de="UNKNOWN_ERROR",le="VPAID_ABORTED",ce="VPAID_SDK_LOAD_ERROR",ue="VPAID_SDK_LOAD_TIMEOUT",he="VPAID_FETCH_ERROR",Ee="VPAID_FETCH_TIMEOUT",pe="VPAID_INIT_ERROR",_e="VPAID_INIT_TIMEOUT",ve="VPAID_START_ERROR",Ae="VPAID_START_TIMEOUT",me="VPAID_BUFFER_ERROR",ge="VPAID_BUFFER_TIMEOUT",Te="VPAID_PLAY_ERROR",Re="VPAID_STOP_ERROR",Se="VPAID_STOP_TIMEOUT",De="VPAID_SKIP_ERROR",Ie="VPAID_SKIP_TIMEOUT",Le="PARSING_ERROR",ke="SIMID_ERROR",fe="IMA_REQUEST_ADS_TIMEOUT",Pe="IMA_REQUEST_ERROR",ye=T("AdStackDM");let Oe=null;const be={get value(){return Oe},set value(e){"number"==typeof e?Oe=e:ye.log(`Can only set lastAdHttpStatus value from number : ${e} is ${typeof e}`)},reset:()=>{Oe=null}};class Ce extends Error{constructor(e,t){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Ce),this.constructor=Ce,this.__proto__=Ce.prototype,Object.defineProperty(this,"message",{value:e,enumerable:!0}),this.type=null,this.code=null,this.httpStatus=null,this.position=null,this.timeoutInfo=null,this.adSystem=null,this.adTitle=null,this.adURL=null,this.inventoryId=null,this.provider=null,this.buyerType=null,this.bid=null,this.sid=null,this.adom=null,this.cid=null,this.adid=null,this.crid=null,this.did=null,this.bidid=null,this.pid=null,this.dva=null,this.dva_provider=null,this.dva_vpaid=null,this.dva_vpaid_inner=null,this.dva_wr=null,this.integrator=null,this.fallbackUrl=null,this.lastVastUrl=null,this.internalCode=null,this.vastVersion=null,this.vpaidRuntimeError=null,this.hasRemainingAds=!1,this.updateProperties(t)}updateProperties(e){this.httpStatus=be.value,"object"==typeof e&&("type"in e&&(this.type=n[e.type]?e.type:de),"code"in e&&(this.code=e.code),"httpStatus"in e&&(this.httpStatus=e.httpStatus),"position"in e&&(this.position=e.position),"timeoutInfo"in e&&(this.timeoutInfo=e.timeoutInfo),"adSystem"in e&&(this.adSystem=e.adSystem),"adTitle"in e&&(this.adTitle=e.adTitle),"adURL"in e&&(this.adURL=e.adURL),"inventoryId"in e&&(this.inventoryId=e.inventoryId),"provider"in e&&(this.provider=e.provider),"buyerType"in e&&(this.buyerType=e.buyerType),"bid"in e&&(this.bid=e.bid),"bidid"in e&&(this.bidid=e.bidid),"sid"in e&&(this.sid=e.sid),"adom"in e&&(this.adom=e.adom),"cid"in e&&(this.cid=e.cid),"adid"in e&&(this.adid=e.adid),"crid"in e&&(this.crid=e.crid),"pid"in e&&(this.pid=e.pid),"did"in e&&(this.did=e.did),"dva"in e&&(this.dva=e.dva),"dva_provider"in e&&(this.dva_provider=e.dva_provider),"dva_vpaid"in e&&(this.dva_vpaid=e.dva_vpaid),"dva_vpaid_inner"in e&&(this.dva_vpaid_inner=e.dva_vpaid_inner),"dva_wr"in e&&(this.dva_wr=e.dva_wr),"integrator"in e&&(this.integrator=e.integrator),"fallbackUrl"in e&&(this.fallbackUrl=e.fallbackUrl),"lastVastUrl"in e&&(this.lastVastUrl=e.lastVastUrl),"internalCode"in e&&(this.internalCode=e.internalCode),"vastVersion"in e&&(this.vastVersion=e.vastVersion),"vpaidRuntimeError"in e&&(this.vpaidRuntimeError=e.vpaidRuntimeError),"hasRemainingAds"in e&&(this.hasRemainingAds=e.hasRemainingAds))}isMediationAllowed(){return[ce,ue,he,Ee,pe,_e,ve,Ae,me].indexOf(this.type)>=0}}var Ne=i(3136);let Ue=0;const Ve={get value(){return Ue},increment(){Ue++},reset(){Ue=0}};let Me=0;const we={get value(){return Me},set value(e){e>=0&&(Me=e)},reset(){Me=0}};let Fe=0;const Be={get value(){return Fe},increment(){Fe++},reset(){Fe=0}};let xe=0;const He={get value(){return xe},set value(e){xe||"number"!=typeof e||(Fe=1,xe=e+Fe)},reset(){xe=0}};let Ke=0;const Ye={get value(){return Ke},increment(){Ke++},reset(){Ke=0}};function Ge(){Ve.reset(),we.reset(),He.reset(),Be.reset(),Ye.reset()}let Qe,$e,je,qe=!1,We=null;const ze=()=>{Qe="VMAP",$e={},je=0,We=null};ze();const Xe={get value(){return We||(We=R()?window.DM_VIEW_ID:V("viewId")),We?[We,Qe,$e[Qe]||0,je].join("_"):"NO_VIEW_ID"},get podIndex(){return je},get isConsecutiveAdBreak(){return qe},newAdBreak:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i={[Ne.ev.PREROLL]:"PRE",[Ne.ev.MIDROLL]:"MID",[Ne.ev.POSTROLL]:"POST",[Ne.ev.LIVEADBREAK]:"LIVEADBREAK"};if(!i[e])throw new Error("Invalid ad break type");Qe=i[e],je=1,qe=t,$e[Qe]?$e[Qe]++:$e[Qe]=1},newAd:e=>{e?je=e:je++},reset:ze};let Ze={adBreaks:{prerolls:[],midrolls:[],postrolls:[],liveAdBreaks:[]},isFirstAdBreakForAdSlot:!0,linearSlotStarted:!1,position:null,nextPosition:null,current:null,fetchedViewId:null,vmapData:{}};ee.addEventListener(te.AD_BREAK_WILL_START,(e=>{let{position:t}=e;Ze.nextPosition=t})),[te.AD_STOPPED,te.AD_SKIPPED,te.RESET_CURRENT_AD_BREAK].forEach((e=>ee.addEventListener(e,(()=>{Ze.current&&Ze.current.track("breakEnd"),Ze.current=null,Ze.isFirstAdBreakForAdSlot=!1})))),ee.addEventListener(te.PLAYER_SEQUENCE_ENDED,(()=>{Ze.adBreaks={prerolls:[],midrolls:[],postrolls:[],liveAdBreaks:[]}})),ee.addEventListener(te.PLAYER_VIDEO_SELECTED,(()=>{R()&&(!R()||Ze.fetchedViewId===window.DM_VIEW_ID&&Ze.fetchedViewId)||(Ze={...Ze,adBreaks:{prerolls:[],midrolls:[],postrolls:[],liveAdBreaks:[]},isFirstAdBreakForAdSlot:!0,linearSlotStarted:!1,position:null,nextPosition:null,current:null,fetchedViewId:null,vmapData:{}}),Xe.reset()})),ee.addEventListener(te.AD_LINEAR_SLOT_STARTED,(()=>{Ze.linearSlotStarted=!0,Ze.isFirstAdBreakForAdSlot=!0})),ee.addEventListener(te.AD_LINEAR_SLOT_ENDED,(()=>{Ze={...Ze,adBreaks:{prerolls:[],midrolls:[],postrolls:[],liveAdBreaks:[]},isFirstAdBreakForAdSlot:!0,linearSlotStarted:!1,position:null,nextPosition:null,current:null,fetchedViewId:null,vmapData:{},adBreaks:Ze.adBreaks}}));var Je=i(4155),et=i(9669),tt=i.n(et);function it(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adId:e.adId||null,sequence:e.sequence||null,apiFramework:e.apiFramework||null,universalAdIds:[],creativeExtensions:[]}}const nt=["ADCATEGORIES","ADCOUNT","ADPLAYHEAD","ADSERVINGID","ADTYPE","APIFRAMEWORKS","APPBUNDLE","ASSETURI","BLOCKEDADCATEGORIES","BREAKMAXADLENGTH","BREAKMAXADS","BREAKMAXDURATION","BREAKMINADLENGTH","BREAKMINDURATION","BREAKPOSITION","CLICKPOS","CLICKTYPE","CLIENTUA","CONTENTID","CONTENTPLAYHEAD","CONTENTURI","DEVICEIP","DEVICEUA","DOMAIN","EXTENSIONS","GDPRCONSENT","IFA","IFATYPE","INVENTORYSTATE","LATLONG","LIMITADTRACKING","MEDIAMIME","MEDIAPLAYHEAD","OMIDPARTNER","PAGEURL","PLACEMENTTYPE","PLAYERCAPABILITIES","PLAYERSIZE","PLAYERSTATE","PODSEQUENCE","REGULATIONS","SERVERSIDE","SERVERUA","TRANSACTIONID","UNIVERSALADID","VASTVERSIONS","VERIFICATIONVENDORS"];function rt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=[],r=ot(e);!t.ERRORCODE||i.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=ht(Math.round(1e8*Math.random())),t.TIMESTAMP=(new Date).toISOString(),t.RANDOM=t.random=t.CACHEBUSTING;for(const e in t)t[e]=ut(t[e]);for(const e in r){const i=r[e];"string"==typeof i&&n.push(st(i,t))}return n}function st(e,t){const i=(e=at(e,t)).match(/[^[\]]+(?=])/g);if(!i)return e;let n=i.filter((e=>nt.indexOf(e)>-1));return 0===n.length?e:(n=n.reduce(((e,t)=>(e[t]=-1,e)),{}),at(e,n))}function at(e,t){let i=e;for(const e in t){const n=t[e];i=i.replace(new RegExp("(?:\\[|%%)(".concat(e,")(?:\\]|%%)"),"g"),n)}return i}function ot(e){return Array.isArray(e)?e.map((e=>e&&e.hasOwnProperty("url")?e.url:e)):e}function dt(e){return/^(https?:\/\/|\/\/)/.test(e)}function lt(e,t){for(let i=0;i<t.length;i++)if(ct(t[i],e))return!0;return!1}function ct(e,t){if(e&&t){const i=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);return i.length===n.length&&e.id===t.id&&e.url===t.url}return!1}function ut(e){return encodeURIComponent(e).replace(/[!'()*]/g,(e=>"%".concat(e.charCodeAt(0).toString(16))))}function ht(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return e.toString().padStart(t,"0")}const Et={track:function(e,t,i){rt(e,t,i).forEach((e=>{"undefined"!=typeof window&&null!==window&&((new Image).src=e)}))},resolveURLTemplates:rt,extractURLsFromTemplates:ot,filterUrlTemplates:function(e){return e.reduce(((e,t)=>{const i=t.url||t;return dt(i)?e.validUrls.push(i):e.invalidUrls.push(i),e}),{validUrls:[],invalidUrls:[]})},containsTemplateObject:lt,isTemplateObjectEqual:ct,encodeURIComponentRFC3986:ut,replaceUrlMacros:st,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function e(t){return t.reduce(((t,i)=>t.concat(Array.isArray(i)?e(i):i)),[])},joinArrayOfUniqueTemplateObjs:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[];return i.concat(n).reduce(((e,t)=>(lt(t,e)||e.push(t),e)),[])},isValidTimeValue:function(e){return Number.isFinite(e)&&e>=-2},addLeadingZeros:ht,isValidUrl:dt,isBrowserEnvironment:function(){return"undefined"!=typeof window},formatMacrosValues:function(e){return"object"!=typeof e?e:JSON.stringify(e)}};function pt(e){return["true","TRUE","True","1"].includes(e)}const _t={childByName:function(e,t){return Array.from(e.childNodes).find((e=>e.nodeName===t))},childrenByName:function(e,t){return Array.from(e.childNodes).filter((e=>e.nodeName===t))},resolveVastAdTagURI:function(e,t){if(!t)return e;if(e.startsWith("//")){const{protocol:t}=location;return"".concat(t).concat(e)}if(!e.includes("://")){const i=t.slice(0,t.lastIndexOf("/"));return"".concat(i,"/").concat(e)}return e},parseBoolean:pt,parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,i){const n=t.getAttribute(e);n&&i.setAttribute(e,n)},parseAttributes:function(e){return Array.from(e.attributes).reduce(((e,t)=>(e[t.nodeName]=t.nodeValue,e)),{})},parseDuration:function(e){if(null==e)return-1;if(Et.isNumeric(e))return parseInt(e);const t=e.split(":");if(3!==t.length)return-1;const i=t[2].split(".");let n=parseInt(i[0]);2===i.length&&(n+=parseFloat("0.".concat(i[1])));const r=parseInt(60*t[1]),s=parseInt(60*t[0]*60);return isNaN(s)||isNaN(r)||isNaN(n)||r>3600||n>60?-1:s+r+n},splitVAST:function(e){const t=[];let i=null;return e.forEach(((n,r)=>{if(n.sequence&&(n.sequence=parseInt(n.sequence,10)),n.sequence>1){const t=e[r-1];if(t&&t.sequence===n.sequence-1)return void(i&&i.push(n));delete n.sequence}i=[n],t.push(i)})),t},assignAttributes:function(e,t){e&&Array.from(e).forEach((e=>{let{nodeName:i,nodeValue:n}=e;if(i&&n&&t.hasOwnProperty(i)){let e=n;"boolean"==typeof t[i]&&(e=pt(e)),t[i]=e}}))},mergeWrapperAdData:function(e,t){var i;e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),t.viewableImpression.length>0&&(e.viewableImpression=[...e.viewableImpression,...t.viewableImpression]),e.followAdditionalWrappers=t.followAdditionalWrappers,e.allowMultipleAds=t.allowMultipleAds,e.fallbackOnNoAd=t.fallbackOnNoAd;const n=(t.creatives||[]).filter((e=>e&&"companion"===e.type)),r=n.reduce(((e,t)=>((t.variations||[]).forEach((t=>{(t.companionClickTrackingURLTemplates||[]).forEach((t=>{Et.containsTemplateObject(t,e)||e.push(t)}))})),e)),[]);e.creatives=n.concat(e.creatives);const s=t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length,a=t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length;if(e.creatives.forEach((e=>{if(t.trackingEvents&&t.trackingEvents[e.type])for(const i in t.trackingEvents[e.type]){const n=t.trackingEvents[e.type][i];Array.isArray(e.trackingEvents[i])||(e.trackingEvents[i]=[]),e.trackingEvents[i]=e.trackingEvents[i].concat(n)}"linear"===e.type&&(s&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates)),a&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates)),!t.videoClickThroughURLTemplate||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)),"companion"===e.type&&r.length&&(e.variations||[]).forEach((e=>{e.companionClickTrackingURLTemplates=Et.joinArrayOfUniqueTemplateObjs(e.companionClickTrackingURLTemplates,r)}))})),t.adVerifications&&(e.adVerifications=e.adVerifications.concat(t.adVerifications)),t.blockedAdCategories&&(e.blockedAdCategories=e.blockedAdCategories.concat(t.blockedAdCategories)),null!==(i=t.creatives)&&void 0!==i&&i.length){const i=t.creatives.filter((e=>{var t;return(null===(t=e.icons)||void 0===t?void 0:t.length)&&!e.mediaFiles.length}));i.length&&(e.creatives=e.creatives.concat(i))}}};function vt(e,t){const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:t,adId:i,sequence:n,apiFramework:r}=it(e);return{id:t,adId:i,sequence:n,apiFramework:r,type:"companion",required:null,variations:[]}}(t);return i.required=e.getAttribute("required")||null,i.variations=_t.childrenByName(e,"Companion").map((e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adType:"companionAd",width:e.width||0,height:e.height||0,assetWidth:e.assetWidth||null,assetHeight:e.assetHeight||null,expandedWidth:e.expandedWidth||null,expandedHeight:e.expandedHeight||null,apiFramework:e.apiFramework||null,adSlotId:e.adSlotId||null,pxratio:e.pxratio||"1",renderingMode:e.renderingMode||"default",staticResources:[],htmlResources:[],iframeResources:[],adParameters:null,altText:null,companionClickThroughURLTemplate:null,companionClickTrackingURLTemplates:[],trackingEvents:{}}}(_t.parseAttributes(e));t.htmlResources=_t.childrenByName(e,"HTMLResource").reduce(((e,t)=>{const i=_t.parseNodeText(t);return i?e.concat(i):e}),[]),t.iframeResources=_t.childrenByName(e,"IFrameResource").reduce(((e,t)=>{const i=_t.parseNodeText(t);return i?e.concat(i):e}),[]),t.staticResources=_t.childrenByName(e,"StaticResource").reduce(((e,t)=>{const i=_t.parseNodeText(t);return i?e.concat({url:i,creativeType:t.getAttribute("creativeType")||null}):e}),[]),t.altText=_t.parseNodeText(_t.childByName(e,"AltText"))||null;const i=_t.childByName(e,"TrackingEvents");i&&_t.childrenByName(i,"Tracking").forEach((e=>{const i=e.getAttribute("event"),n=_t.parseNodeText(e);i&&n&&(Array.isArray(t.trackingEvents[i])||(t.trackingEvents[i]=[]),t.trackingEvents[i].push(n))})),t.companionClickTrackingURLTemplates=_t.childrenByName(e,"CompanionClickTracking").map((e=>({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)}))),t.companionClickThroughURLTemplate=_t.parseNodeText(_t.childByName(e,"CompanionClickThrough"))||null;const n=_t.childByName(e,"AdParameters");return n&&(t.adParameters={value:_t.parseNodeText(n),xmlEncoded:n.getAttribute("xmlEncoded")||null}),t})),i}function At(e,t){let i;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:t,adId:i,sequence:n,apiFramework:r}=it(e);return{id:t,adId:i,sequence:n,apiFramework:r,type:"linear",duration:0,skipDelay:null,mediaFiles:[],mezzanine:null,interactiveCreativeFile:null,closedCaptionFiles:[],videoClickThroughURLTemplate:null,videoClickTrackingURLTemplates:[],videoCustomClickURLTemplates:[],adParameters:null,icons:[],trackingEvents:{}}}(t);n.duration=_t.parseDuration(_t.parseNodeText(_t.childByName(e,"Duration")));const r=e.getAttribute("skipoffset");if(null==r)n.skipDelay=null;else if("%"===r.charAt(r.length-1)&&-1!==n.duration){const e=parseInt(r,10);n.skipDelay=n.duration*(e/100)}else n.skipDelay=_t.parseDuration(r);const s=_t.childByName(e,"VideoClicks");if(s){const e=_t.childByName(s,"ClickThrough");n.videoClickThroughURLTemplate=e?{id:e.getAttribute("id")||null,url:_t.parseNodeText(e)}:null,_t.childrenByName(s,"ClickTracking").forEach((e=>{n.videoClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)})})),_t.childrenByName(s,"CustomClick").forEach((e=>{n.videoCustomClickURLTemplates.push({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)})}))}const a=_t.childByName(e,"AdParameters");a&&(n.adParameters={value:_t.parseNodeText(a),xmlEncoded:a.getAttribute("xmlEncoded")||null}),_t.childrenByName(e,"TrackingEvents").forEach((e=>{_t.childrenByName(e,"Tracking").forEach((e=>{let t=e.getAttribute("event");const r=_t.parseNodeText(e);if(t&&r){if("progress"===t){if(i=e.getAttribute("offset"),!i)return;t="%"===i.charAt(i.length-1)?"progress-".concat(i):"progress-".concat(Math.round(_t.parseDuration(i)))}Array.isArray(n.trackingEvents[t])||(n.trackingEvents[t]=[]),n.trackingEvents[t].push(r)}}))})),_t.childrenByName(e,"MediaFiles").forEach((e=>{_t.childrenByName(e,"MediaFile").forEach((e=>{n.mediaFiles.push(function(e){const t={id:null,fileURL:null,fileSize:0,deliveryType:"progressive",mimeType:null,mediaType:null,codec:null,bitrate:0,minBitrate:0,maxBitrate:0,width:0,height:0,apiFramework:null,scalable:null,maintainAspectRatio:null};t.id=e.getAttribute("id"),t.fileURL=_t.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.mediaType=e.getAttribute("mediaType")||"2D",t.apiFramework=e.getAttribute("apiFramework"),t.fileSize=parseInt(e.getAttribute("fileSize")||0),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);const i=e.getAttribute("scalable");i&&"string"==typeof i&&(t.scalable=_t.parseBoolean(i));const n=e.getAttribute("maintainAspectRatio");return n&&"string"==typeof n&&(t.maintainAspectRatio=_t.parseBoolean(n)),t}(e))}));const t=_t.childByName(e,"InteractiveCreativeFile");t&&(n.interactiveCreativeFile=function(e){const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,apiFramework:e.apiFramework||null,variableDuration:_t.parseBoolean(e.variableDuration),fileURL:null}}(_t.parseAttributes(e));return t.fileURL=_t.parseNodeText(e),t}(t));const i=_t.childByName(e,"ClosedCaptionFiles");i&&_t.childrenByName(i,"ClosedCaptionFile").forEach((e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,language:e.language||null,fileURL:null}}(_t.parseAttributes(e));t.fileURL=_t.parseNodeText(e),n.closedCaptionFiles.push(t)}));const r=_t.childByName(e,"Mezzanine"),s=function(e,t){const i={};let n=!1;return["delivery","type","width","height"].forEach((t=>{e&&e.getAttribute(t)?i[t]=e.getAttribute(t):n=!0})),n?null:i}(r);if(s){const e={id:null,fileURL:null,delivery:null,codec:null,type:null,width:0,height:0,fileSize:0,mediaType:"2D"};e.id=r.getAttribute("id"),e.fileURL=_t.parseNodeText(r),e.delivery=s.delivery,e.codec=r.getAttribute("codec"),e.type=s.type,e.width=parseInt(s.width,10),e.height=parseInt(s.height,10),e.fileSize=parseInt(r.getAttribute("fileSize"),10),e.mediaType=r.getAttribute("mediaType")||"2D",n.mezzanine=e}}));const o=_t.childByName(e,"Icons");return o&&_t.childrenByName(o,"Icon").forEach((e=>{n.icons.push(function(e){const t={program:null,height:0,width:0,xPosition:0,yPosition:0,apiFramework:null,offset:null,duration:0,type:null,staticResource:null,htmlResource:null,iframeResource:null,pxratio:"1",iconClickThroughURLTemplate:null,iconClickTrackingURLTemplates:[],iconViewTrackingURLTemplate:null,iconClickFallbackImages:[]};t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=function(e){return-1!==["left","right"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("xPosition")),t.yPosition=function(e){return-1!==["top","bottom"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.pxratio=e.getAttribute("pxratio")||"1",t.offset=_t.parseDuration(e.getAttribute("offset")),t.duration=_t.parseDuration(e.getAttribute("duration")),_t.childrenByName(e,"HTMLResource").forEach((e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=_t.parseNodeText(e)})),_t.childrenByName(e,"IFrameResource").forEach((e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=_t.parseNodeText(e)})),_t.childrenByName(e,"StaticResource").forEach((e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=_t.parseNodeText(e)}));const i=_t.childByName(e,"IconClicks");if(i){t.iconClickThroughURLTemplate=_t.parseNodeText(_t.childByName(i,"IconClickThrough")),_t.childrenByName(i,"IconClickTracking").forEach((e=>{t.iconClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)})}));const e=_t.childByName(i,"IconClickFallbackImages");e&&_t.childrenByName(e,"IconClickFallbackImage").forEach((e=>{t.iconClickFallbackImages.push({url:_t.parseNodeText(e)||null,width:e.getAttribute("width")||null,height:e.getAttribute("height")||null})}))}return t.iconViewTrackingURLTemplate=_t.parseNodeText(_t.childByName(e,"IconViewTracking")),t}(e))})),n}function mt(e,t){const i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{id:t,adId:i,sequence:n,apiFramework:r}=it(e);return{id:t,adId:i,sequence:n,apiFramework:r,type:"nonlinear",variations:[],trackingEvents:{}}}(t);return _t.childrenByName(e,"TrackingEvents").forEach((e=>{let t,n;_t.childrenByName(e,"Tracking").forEach((e=>{t=e.getAttribute("event"),n=_t.parseNodeText(e),t&&n&&(Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(n))}))})),_t.childrenByName(e,"NonLinear").forEach((e=>{const t={id:null,width:0,height:0,expandedWidth:0,expandedHeight:0,scalable:!0,maintainAspectRatio:!0,minSuggestedDuration:0,apiFramework:"static",adType:"nonLinearAd",type:null,staticResource:null,htmlResource:null,iframeResource:null,nonlinearClickThroughURLTemplate:null,nonlinearClickTrackingURLTemplates:[],adParameters:null};t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=_t.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=_t.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=_t.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),_t.childrenByName(e,"HTMLResource").forEach((e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=_t.parseNodeText(e)})),_t.childrenByName(e,"IFrameResource").forEach((e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=_t.parseNodeText(e)})),_t.childrenByName(e,"StaticResource").forEach((e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=_t.parseNodeText(e)}));const n=_t.childByName(e,"AdParameters");n&&(t.adParameters={value:_t.parseNodeText(n),xmlEncoded:n.getAttribute("xmlEncoded")||null}),t.nonlinearClickThroughURLTemplate=_t.parseNodeText(_t.childByName(e,"NonLinearClickThrough")),_t.childrenByName(e,"NonLinearClickTracking").forEach((e=>{t.nonlinearClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)})})),i.variations.push(t)})),i}function gt(e){const t=[];return e.forEach((e=>{const i=Tt(e);i&&t.push(i)})),t}function Tt(e){if("#comment"===e.nodeName)return null;const t={name:null,value:null,attributes:{},children:[]},i=e.attributes,n=e.childNodes;if(t.name=e.nodeName,e.attributes)for(const e in i)if(i.hasOwnProperty(e)){const n=i[e];n.nodeName&&n.nodeValue&&(t.attributes[n.nodeName]=n.nodeValue)}for(const e in n)if(n.hasOwnProperty(e)){const i=Tt(n[e]);i&&t.children.push(i)}if(0===t.children.length||1===t.children.length&&["#cdata-section","#text"].indexOf(t.children[0].name)>=0){const i=_t.parseNodeText(e);""!==i&&(t.value=i),t.children=[]}return null===(r=t).value&&0===Object.keys(r.attributes).length&&0===r.children.length?null:t;var r}function Rt(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}const St={Wrapper:{subElements:["VASTAdTagURI","Impression"]},BlockedAdCategories:{attributes:["authority"]},InLine:{subElements:["AdSystem","AdTitle","Impression","AdServingId","Creatives"]},Category:{attributes:["authority"]},Pricing:{attributes:["model","currency"]},Verification:{oneOfinLineResources:["JavaScriptResource","ExecutableResource"],attributes:["vendor"]},UniversalAdId:{attributes:["idRegistry"]},JavaScriptResource:{attributes:["apiFramework","browserOptional"]},ExecutableResource:{attributes:["apiFramework","type"]},Tracking:{attributes:["event"]},Creatives:{subElements:["Creative"]},Creative:{subElements:["UniversalAdId"]},Linear:{subElements:["MediaFiles","Duration"]},MediaFiles:{subElements:["MediaFile"]},MediaFile:{attributes:["delivery","type","width","height"]},Mezzanine:{attributes:["delivery","type","width","height"]},NonLinear:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},Companion:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},StaticResource:{attributes:["creativeType"]},Icons:{subElements:["Icon"]},Icon:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"]}};function Dt(e,t){if(!St[e.nodeName]||!St[e.nodeName].attributes)return;const i=St[e.nodeName].attributes.filter((t=>!e.getAttribute(t)));i.length>0&&kt({name:e.nodeName,parentName:e.parentNode.nodeName,attributes:i},t)}function It(e,t,i){const n=St[e.nodeName],r=!i&&"Wrapper"!==e.nodeName;if(n&&!r){if(n.subElements){const i=n.subElements.filter((t=>!_t.childByName(e,t)));i.length>0&&kt({name:e.nodeName,parentName:e.parentNode.nodeName,subElements:i},t)}i&&n.oneOfinLineResources&&(n.oneOfinLineResources.some((t=>_t.childByName(e,t)))||kt({name:e.nodeName,parentName:e.parentNode.nodeName,oneOfResources:n.oneOfinLineResources},t))}}function Lt(e){return e.children&&0!==e.children.length}function kt(e,t){let{name:i,parentName:n,attributes:r,subElements:s,oneOfResources:a}=e,o="Element '".concat(i,"'");o+=r?" missing required attribute(s) '".concat(r.join(", "),"' "):s?" missing required sub element(s) '".concat(s.join(", "),"' "):a?" must provide one of the following '".concat(a.join(", "),"' "):" is empty",t("VAST-warning",{message:o,parentElement:n,specVersion:4.1})}const ft={verifyRequiredValues:function e(t,i,n){if(t&&t.nodeName)if("InLine"===t.nodeName&&(n=!0),Dt(t,i),Lt(t)){It(t,i,n);for(let r=0;r<t.children.length;r++)e(t.children[r],i,n)}else 0===_t.parseNodeText(t).length&&kt({name:t.nodeName,parentName:t.parentNode.nodeName},i)},hasSubElements:Lt,emitMissingValueWarning:kt,verifyRequiredAttributes:Dt,verifyRequiredSubElements:It};function Pt(e,t){let{allowMultipleAds:i,followAdditionalWrappers:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=Array.from(e.childNodes).filter((e=>{const t=e.nodeName.toLowerCase();return"inline"===t||!1!==n&&"wrapper"===t}));for(const n of r){if(_t.copyNodeAttribute("id",e,n),_t.copyNodeAttribute("sequence",e,n),_t.copyNodeAttribute("adType",e,n),"Wrapper"===n.nodeName)return{ad:bt(n,t),type:"WRAPPER"};if("InLine"===n.nodeName)return{ad:yt(n,t,{allowMultipleAds:i}),type:"INLINE"};const r=n.nodeName.toLowerCase();t("VAST-warning",{message:"<".concat(n.nodeName,"inline"===r?"> must be written <InLine>":"> must be written <Wrapper>"),wrongNode:n})}}function yt(e,t){let{allowMultipleAds:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!1===i&&e.getAttribute("sequence")?null:Ot(e,t)}function Ot(e,t){let i=[];t&&ft.verifyRequiredValues(e,t);const n=Array.from(e.childNodes),r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,sequence:e.sequence||null,adType:e.adType||null,adServingId:null,categories:[],expires:null,viewableImpression:[],system:null,title:null,description:null,advertiser:null,pricing:null,survey:null,errorURLTemplates:[],impressionURLTemplates:[],creatives:[],extensions:[],adVerifications:[],blockedAdCategories:[],followAdditionalWrappers:!0,allowMultipleAds:!1,fallbackOnNoAd:null}}(_t.parseAttributes(e));return n.forEach((e=>{switch(e.nodeName){case"Error":r.errorURLTemplates.push(_t.parseNodeText(e));break;case"Impression":r.impressionURLTemplates.push({id:e.getAttribute("id")||null,url:_t.parseNodeText(e)});break;case"Creatives":r.creatives=function(e){const t=[];return e.forEach((e=>{const i={id:e.getAttribute("id")||null,adId:Rt(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null},n=[];let r;_t.childrenByName(e,"UniversalAdId").forEach((e=>{const t={idRegistry:e.getAttribute("idRegistry")||"unknown",value:_t.parseNodeText(e)};n.push(t)}));const s=_t.childByName(e,"CreativeExtensions");s&&(r=gt(_t.childrenByName(s,"CreativeExtension")));for(const s in e.childNodes){const a=e.childNodes[s];let o;switch(a.nodeName){case"Linear":o=At(a,i);break;case"NonLinearAds":o=mt(a,i);break;case"CompanionAds":o=vt(a,i)}o&&(n&&(o.universalAdIds=n),r&&(o.creativeExtensions=r),t.push(o))}})),t}(_t.childrenByName(e,"Creative"));break;case"Extensions":{const t=_t.childrenByName(e,"Extension");r.extensions=gt(t),r.adVerifications.length||(i=function(e){let t=null,i=[];return e.some((e=>t=_t.childByName(e,"AdVerifications"))),t&&(i=Ct(_t.childrenByName(t,"Verification"))),i}(t));break}case"AdVerifications":r.adVerifications=Ct(_t.childrenByName(e,"Verification"));break;case"AdSystem":r.system={value:_t.parseNodeText(e),version:e.getAttribute("version")||null};break;case"AdTitle":r.title=_t.parseNodeText(e);break;case"AdServingId":r.adServingId=_t.parseNodeText(e);break;case"Category":r.categories.push({authority:e.getAttribute("authority")||null,value:_t.parseNodeText(e)});break;case"Expires":r.expires=parseInt(_t.parseNodeText(e),10);break;case"ViewableImpression":r.viewableImpression.push(function(e){const t=(e,t)=>{const i=_t.parseNodeText(t);return i&&e.push(i),e};return{id:e.getAttribute("id")||null,viewable:_t.childrenByName(e,"Viewable").reduce(t,[]),notViewable:_t.childrenByName(e,"NotViewable").reduce(t,[]),viewUndetermined:_t.childrenByName(e,"ViewUndetermined").reduce(t,[])}}(e));break;case"Description":r.description=_t.parseNodeText(e);break;case"Advertiser":r.advertiser={id:e.getAttribute("id")||null,value:_t.parseNodeText(e)};break;case"Pricing":r.pricing={value:_t.parseNodeText(e),model:e.getAttribute("model")||null,currency:e.getAttribute("currency")||null};break;case"Survey":r.survey={value:_t.parseNodeText(e),type:e.getAttribute("type")||null};break;case"BlockedAdCategories":r.blockedAdCategories.push({authority:e.getAttribute("authority")||null,value:_t.parseNodeText(e)})}})),i.length&&(r.adVerifications=r.adVerifications.concat(i)),r}function bt(e,t){const i=Ot(e,t),n=e.getAttribute("followAdditionalWrappers"),r=e.getAttribute("allowMultipleAds"),s=e.getAttribute("fallbackOnNoAd");i.followAdditionalWrappers=!n||_t.parseBoolean(n),i.allowMultipleAds=!!r&&_t.parseBoolean(r),i.fallbackOnNoAd=s?_t.parseBoolean(s):null;let a=_t.childByName(e,"VASTAdTagURI");if(a?i.nextWrapperURL=_t.parseNodeText(a):(a=_t.childByName(e,"VASTAdTagURL"),a&&(i.nextWrapperURL=_t.parseNodeText(_t.childByName(a,"URL")))),i.creatives.forEach((e=>{if(["linear","nonlinear"].includes(e.type)){if(e.trackingEvents){i.trackingEvents||(i.trackingEvents={}),i.trackingEvents[e.type]||(i.trackingEvents[e.type]={});for(const t in e.trackingEvents){const n=e.trackingEvents[t];Array.isArray(i.trackingEvents[e.type][t])||(i.trackingEvents[e.type][t]=[]),n.forEach((n=>{i.trackingEvents[e.type][t].push(n)}))}}e.videoClickTrackingURLTemplates&&(Array.isArray(i.videoClickTrackingURLTemplates)||(i.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach((e=>{i.videoClickTrackingURLTemplates.push(e)}))),e.videoClickThroughURLTemplate&&(i.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(i.videoCustomClickURLTemplates)||(i.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach((e=>{i.videoCustomClickURLTemplates.push(e)})))}})),i.nextWrapperURL)return i}function Ct(e){const t=[];return e.forEach((e=>{const i={resource:null,vendor:null,browserOptional:!1,apiFramework:null,type:null,parameters:null,trackingEvents:{}},n=Array.from(e.childNodes);_t.assignAttributes(e.attributes,i),n.forEach((e=>{let{nodeName:t,textContent:n,attributes:r}=e;switch(t){case"JavaScriptResource":case"ExecutableResource":i.resource=n.trim(),_t.assignAttributes(r,i);break;case"VerificationParameters":i.parameters=n.trim()}}));const r=_t.childByName(e,"TrackingEvents");r&&_t.childrenByName(r,"Tracking").forEach((e=>{const t=e.getAttribute("event"),n=_t.parseNodeText(e);t&&n&&(Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(n))})),t.push(i)})),t}class Nt{constructor(){this._handlers=[]}on(e,t){if("function"!=typeof t)throw new TypeError("The handler argument must be of type Function. Received type ".concat(typeof t));if(!e)throw new TypeError("The event argument must be of type String. Received type ".concat(typeof e));return this._handlers.push({event:e,handler:t}),this}once(e,t){return this.on(e,function(e,t,i){const n={fired:!1,wrapFn:void 0};function r(){n.fired||(e.off(t,n.wrapFn),n.fired=!0,i.bind(e)(...arguments))}return n.wrapFn=r,r}(this,e,t))}off(e,t){return this._handlers=this._handlers.filter((i=>i.event!==e||i.handler!==t)),this}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];let r=!1;return this._handlers.forEach((t=>{"*"===t.event&&(r=!0,t.handler(e,...i)),t.event===e&&(r=!0,t.handler(...i))})),r}removeAllListeners(e){return e?(this._handlers=this._handlers.filter((t=>t.event!==e)),this):(this._handlers=[],this)}listenerCount(e){return this._handlers.filter((t=>t.event===e)).length}listeners(e){return this._handlers.reduce(((t,i)=>(i.event===e&&t.push(i.handler),t)),[])}eventNames(){return this._handlers.map((e=>e.event))}}let Ut=0,Vt=0;const Mt=(e,t)=>{!e||!t||e<=0||t<=0||(Vt=(Vt*Ut+8*e/t)/++Ut)},wt={ERRORCODE:900,extensions:[]};class Ft extends Nt{constructor(){let{fetcher:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.maxWrapperDepth=null,this.remainingAds=[],this.fetcher=e||null}trackVastError(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];this.emit("VAST-error",Object.assign({},wt,t,...n)),Et.track(e,t)}getErrorURLTemplates(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}getEstimatedBitrate(){return Vt}initParsingStatus(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.maxWrapperDepth=e.wrapperLimit||10,this.parsingOptions={allowMultipleAds:e.allowMultipleAds},this.rootURL="",this.resetParsingStatus(),Mt(e.byteLength,e.requestDuration)}resetParsingStatus(){this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.vastVersion=null}getRemainingAds(e){if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));const t=e?Et.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.resolveAds(t,{wrapperDepth:0,url:this.rootURL}).then((e=>this.buildVASTResponse(e)))}parseVAST(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(t),t.isRootVAST=!0,this.parse(e,t).then((e=>this.buildVASTResponse(e)))}buildVASTResponse(e){const t=function(e){let{ads:t,errorURLTemplates:i,version:n}=e;return{ads:t||[],errorURLTemplates:i||[],version:n||null}}({ads:e,errorURLTemplates:this.getErrorURLTemplates(),version:this.vastVersion});return this.completeWrapperResolving(t),t}parseVastXml(e,t){let{isRootVAST:i=!1,url:n=null,wrapperDepth:r=0,allowMultipleAds:s,followAdditionalWrappers:a}=t;if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw this.emit("VAST-ad-parsed",{type:"ERROR",url:n,wrapperDepth:r}),new Error("Invalid VAST XMLDocument");const o=[],d=e.documentElement.childNodes,l=e.documentElement.getAttribute("version");i&&l&&(this.vastVersion=l);for(const e in d){const t=d[e];if("Error"===t.nodeName){const e=_t.parseNodeText(t);i?this.rootErrorURLTemplates.push(e):this.errorURLTemplates.push(e)}else if("Ad"===t.nodeName){if(this.vastVersion&&parseFloat(this.vastVersion)<3)s=!0;else if(!1===s&&o.length>1)break;const e=Pt(t,this.emit.bind(this),{allowMultipleAds:s,followAdditionalWrappers:a});e.ad?(o.push(e.ad),this.emit("VAST-ad-parsed",{type:e.type,url:n,wrapperDepth:r,adIndex:o.length-1,vastVersion:l})):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}return o}parse(e){let{url:t=null,resolveAll:i=!0,wrapperSequence:n=null,previousUrl:r=null,wrapperDepth:s=0,isRootVAST:a=!1,followAdditionalWrappers:o,allowMultipleAds:d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=[];this.vastVersion&&parseFloat(this.vastVersion)<3&&a&&(d=!0);try{l=this.parseVastXml(e,{isRootVAST:a,url:t,wrapperDepth:s,allowMultipleAds:d,followAdditionalWrappers:o})}catch(e){return Promise.reject(e)}return 1===l.length&&null!=n&&(l[0].sequence=n),!1===i&&(this.remainingAds=_t.splitVAST(l),l=this.remainingAds.shift()),this.resolveAds(l,{wrapperDepth:s,previousUrl:r,url:t})}resolveAds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{wrapperDepth:t,previousUrl:i,url:n}=arguments.length>1?arguments[1]:void 0;const r=[];return i=n,e.forEach((e=>{const n=this.resolveWrappers(e,t,i);r.push(n)})),Promise.all(r).then((e=>Et.flatten(e)))}resolveWrappers(e,t,i){const n={...e};return new Promise((e=>{var r;if(t++,!n.nextWrapperURL)return delete n.nextWrapperURL,e(n);if(!this.fetcher)return n.VASTAdTagURI=n.nextWrapperURL,delete n.nextWrapperURL,e(n);if(t>=this.maxWrapperDepth)return n.errorCode=302,delete n.nextWrapperURL,e(n);n.nextWrapperURL=_t.resolveVastAdTagURI(n.nextWrapperURL,i);const s=null!==(r=this.parsingOptions.allowMultipleAds)&&void 0!==r?r:n.allowMultipleAds,a=n.sequence;this.fetcher.fetchVAST({url:n.nextWrapperURL,emitter:this.emit.bind(this),maxWrapperDepth:this.maxWrapperDepth}).then((r=>this.parse(r,{url:n.nextWrapperURL,previousUrl:i,wrapperSequence:a,wrapperDepth:t,followAdditionalWrappers:n.followAdditionalWrappers,allowMultipleAds:s}).then((t=>{if(delete n.nextWrapperURL,0===t.length)return n.creatives=[],e(n);t.forEach((e=>{e&&_t.mergeWrapperAdData(e,n)})),e(t)})))).catch((t=>{n.errorCode=301,n.errorMessage=t.message,e(n)}))}))}completeWrapperResolving(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(let t=e.ads.length-1;t>=0;t--){const i=e.ads[t];!i.errorCode&&0!==i.creatives.length||i.VASTAdTagURI||(this.trackVastError(i.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:i.errorCode||303},{ERRORMESSAGE:i.errorMessage||""},{extensions:i.extensions},{system:i.system}),e.ads.splice(t,1))}}}let Bt=null;const xt={data:{},length:0,getItem(e){return this.data[e]},setItem(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem(e){delete this.data[e],this.length=Object.keys(this.data).length},clear(){this.data={},this.length=0}};class Ht{constructor(){this.storage=this.initStorage()}initStorage(){if(Bt)return Bt;try{Bt="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){Bt=null}return Bt&&!this.isStorageDisabled(Bt)||(Bt=xt,Bt.clear()),Bt}isStorageDisabled(e){const t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}getItem(e){return this.storage.getItem(e)}setItem(e,t){return this.storage.setItem(e,t)}removeItem(e){return this.storage.removeItem(e)}clear(){return this.storage.clear()}}const Kt=12e4,Yt={get:async function(e,t){try{const n=new AbortController,r=setTimeout((()=>{throw n.abort(),new Error("URLHandler: Request timed out after ".concat(t.timeout||Kt," ms (408)"))}),t.timeout||Kt),s=await fetch(e,{...t,signal:n.signal,credentials:t.withCredentials?"include":"omit"});clearTimeout(r);const a=function(e){return"https:"===window.location.protocol&&e.url.includes("http://")?"URLHandler: Cannot go from HTTPS to HTTP.":200===e.status&&e.ok?null:"URLHandler: ".concat(e.statusText," (").concat(e.status,")")}(s);return a?{error:new Error(a),statusCode:s.status}:async function(e){const t=await e.text();let n;return n=Et.isBrowserEnvironment()?new DOMParser:new((await i.e(969).then(i.t.bind(i,3969,19))).DOMParser),{xml:n.parseFromString(t,"text/xml"),details:{byteLength:t.length,statusCode:e.status,rawXml:t}}}(s)}catch(e){return{error:e,statusCode:"AbortError"===e.name?408:null}}}};class Gt{constructor(){this.URLTemplateFilters=[]}setOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.urlHandler=e.urlHandler||e.urlhandler||Yt,this.fetchingOptions={timeout:e.timeout||Kt,withCredentials:Boolean(e.withCredentials)}}addURLTemplateFilter(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}removeLastURLTemplateFilter(){this.URLTemplateFilters.pop()}countURLTemplateFilters(){return this.URLTemplateFilters.length}clearURLTemplateFilters(){this.URLTemplateFilters=[]}async fetchVAST(e){var t;let{url:i,maxWrapperDepth:n,emitter:r,wrapperDepth:s=0,previousUrl:a=null,wrapperAd:o=null}=e;const d=Date.now();this.URLTemplateFilters.forEach((e=>{i=e(i)})),r("VAST-resolving",{url:i,previousUrl:a,wrapperDepth:s,maxWrapperDepth:n,timeout:this.fetchingOptions.timeout,wrapperAd:o});const l=await this.urlHandler.get(i,this.fetchingOptions),c=Math.round(Date.now()-d);if(r("VAST-resolved",{url:i,previousUrl:a,wrapperDepth:s,error:(null==l?void 0:l.error)||null,duration:c,statusCode:(null==l?void 0:l.statusCode)||null,...null==l?void 0:l.details}),Mt(null==l||null===(t=l.details)||void 0===t?void 0:t.byteLength,c),l.error)throw new Error(l.error);return l.xml}}class Qt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ht;this.cappingFreeLunch=e,this.cappingMinimumTimeInterval=t,this.fetcher=new Gt,this.vastParser=new Ft({fetcher:this.fetcher}),this.storage=i,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}addURLTemplateFilter(e){this.fetcher.addURLTemplateFilter(e)}removeLastURLTemplateFilter(){this.fetcher.removeLastURLTemplateFilter()}countURLTemplateFilters(){return this.fetcher.countURLTemplateFilters()}clearURLTemplateFilters(){this.fetcher.clearURLTemplateFilters()}getParser(){return this.vastParser}get lastSuccessfulAd(){return this.storage.getItem("vast-client-last-successful-ad")}set lastSuccessfulAd(e){this.storage.setItem("vast-client-last-successful-ad",e)}get totalCalls(){return this.storage.getItem("vast-client-total-calls")}set totalCalls(e){this.storage.setItem("vast-client-total-calls",e)}get totalCallsTimeout(){return this.storage.getItem("vast-client-total-calls-timeout")}set totalCallsTimeout(e){this.storage.setItem("vast-client-total-calls-timeout",e)}hasRemainingAds(){return this.vastParser.remainingAds.length>0}getNextAds(e){return this.vastParser.getRemainingAds(e)}parseVAST(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.fetcher.setOptions(t),this.vastParser.parseVAST(e,t)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Date.now();return t.hasOwnProperty("resolveAll")||(t.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise(((n,r)=>{if(this.cappingFreeLunch>=this.totalCalls)return r(new Error("VAST call canceled  FreeLunch capping not reached yet ".concat(this.totalCalls,"/").concat(this.cappingFreeLunch)));const s=i-this.lastSuccessfulAd;if(s<0)this.lastSuccessfulAd=0;else if(s<this.cappingMinimumTimeInterval)return r(new Error("VAST call canceled  (".concat(this.cappingMinimumTimeInterval,")ms minimum interval reached")));this.vastParser.initParsingStatus(t),this.fetcher.setOptions(t),this.vastParser.rootURL=e,this.fetcher.fetchVAST({url:e,emitter:this.vastParser.emit.bind(this.vastParser),maxWrapperDepth:this.vastParser.maxWrapperDepth}).then((i=>(t.previousUrl=e,t.isRootVAST=!0,t.url=e,this.vastParser.parse(i,t).then((e=>{const t=this.vastParser.buildVASTResponse(e);n(t)}))))).catch((e=>r(e)))}))}}class $t extends Nt{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.ad=t,this.creative=i,this.variation=n,this.muted=r,this.impressed=!1,this.skippable=!1,this.trackingEvents={},this.lastPercentage=0,this._alreadyTriggeredQuartiles={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"];for(const e in this.creative.trackingEvents){const t=this.creative.trackingEvents[e];this.trackingEvents[e]=t.slice(0)}!function(e){return"linear"===e.type}(this.creative)?this._initVariationTracking():this._initLinearTracking(),e&&this.on("start",(()=>{e.lastSuccessfulAd=Date.now()}))}_initLinearTracking(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}_initVariationTracking(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(const e in this.variation.trackingEvents){const t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}"nonLinearAd"===this.variation.adType?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):function(e){return"companionAd"===e.adType}(this.variation)&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}setDuration(e){Et.isValidTimeValue(e)?(this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}):this.emit("TRACKER-error",{message:"the duration provided is not valid. duration: ".concat(e)})}setProgress(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!Et.isValidTimeValue(e)||"object"!=typeof t)return void this.emit("TRACKER-error",{message:"One given setProgress parameter has the wrong type. progress: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))});const n=this.skipDelay||-1;if(-1===n||this.skippable||(n>e?this.emit("skip-countdown",n-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){const n=Math.round(e/this.assetDuration*100),r=[];if(e>0){r.push("start");for(let e=this.lastPercentage;e<n;e++)r.push("progress-".concat(e+1,"%"));r.push("progress-".concat(Math.round(e)));for(const t in this.quartiles)this.isQuartileReached(t,this.quartiles[t],e)&&(r.push(t),this._alreadyTriggeredQuartiles[t]=!0);this.lastPercentage=n}r.forEach((e=>{this.track(e,{macros:t,once:i})})),e<this.progress&&this.track("rewind",{macros:t})}this.progress=e}isQuartileReached(e,t,i){let n=!1;return t<=i&&!this._alreadyTriggeredQuartiles[e]&&(n=!0),n}setMuted(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"==typeof t?(this.muted!==e&&this.track(e?"mute":"unmute",{macros:t}),this.muted=e):this.emit("TRACKER-error",{message:"One given setMuted parameter has the wrong type. muted: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))})}setPaused(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"==typeof t?(this.paused!==e&&this.track(e?"pause":"resume",{macros:t}),this.paused=e):this.emit("TRACKER-error",{message:"One given setPaused parameter has the wrong type. paused: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))})}setFullscreen(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"==typeof t?(this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen",{macros:t}),this.fullscreen=e):this.emit("TRACKER-error",{message:"One given setFullScreen parameter has the wrong type. fullscreen: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))})}setExpand(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"==typeof t?(this.expanded!==e&&(this.track(e?"expand":"collapse",{macros:t}),this.track(e?"playerExpand":"playerCollapse",{macros:t})),this.expanded=e):this.emit("TRACKER-error",{message:"One given setExpand parameter has the wrong type. expanded: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))})}setSkipDelay(e){Et.isValidTimeValue(e)?this.skipDelay=e:this.emit("TRACKER-error",{message:"setSkipDelay parameter does not have a valid value. duration: ".concat(e)})}trackImpression(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates,e),this.track("creativeView",{macros:e})):this.emit("TRACKER-error",{message:"trackImpression parameter has the wrong type. macros: ".concat(e)})}trackViewableImpression(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.ad.viewableImpression.forEach((t=>{this.trackURLs(t.viewable,e)})):this.emit("TRACKER-error",{message:"trackViewableImpression given macros has the wrong type. macros: ".concat(e)})}trackNotViewableImpression(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.ad.viewableImpression.forEach((t=>{this.trackURLs(t.notViewable,e)})):this.emit("TRACKER-error",{message:"trackNotViewableImpression given macros has the wrong type. macros: ".concat(e)})}trackUndeterminedImpression(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.ad.viewableImpression.forEach((t=>{this.trackURLs(t.viewUndetermined,e)})):this.emit("TRACKER-error",{message:"trackUndeterminedImpression given macros has the wrong type. macros: ".concat(e)})}error(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"object"==typeof e&&"boolean"==typeof t?this.trackURLs(this.ad.errorURLTemplates,e,{isCustomCode:t}):this.emit("TRACKER-error",{message:"One given error parameter has the wrong type. macros: ".concat(Et.formatMacrosValues(e),", isCustomCode: ").concat(t)})}errorWithCode(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"string"==typeof e&&"boolean"==typeof t?(this.error({ERRORCODE:e},t),console.log("The method errorWithCode is deprecated, please use vast tracker error method instead")):this.emit("TRACKER-error",{message:"One given errorWithCode parameter has the wrong type. errorCode: ".concat(e,", isCustomCode: ").concat(t)})}complete(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("complete",{macros:e}):this.emit("TRACKER-error",{message:"complete given macros has the wrong type. macros: ".concat(e)})}notUsed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?(this.track("notUsed",{macros:e}),this.trackingEvents=[]):this.emit("TRACKER-error",{message:"notUsed given macros has the wrong type. macros: ".concat(e)})}otherAdInteraction(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("otherAdInteraction",{macros:e}):this.emit("TRACKER-error",{message:"otherAdInteraction given macros has the wrong type. macros: ".concat(e)})}acceptInvitation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("acceptInvitation",{macros:e}):this.emit("TRACKER-error",{message:"acceptInvitation given macros has the wrong type. macros: ".concat(e)})}adExpand(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("adExpand",{macros:e}):this.emit("TRACKER-error",{message:"adExpand given macros has the wrong type. macros: ".concat(e)})}adCollapse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("adCollapse",{macros:e}):this.emit("TRACKER-error",{message:"adCollapse given macros has the wrong type. macros: ".concat(e)})}minimize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("minimize",{macros:e}):this.emit("TRACKER-error",{message:"minimize given macros has the wrong type. macros: ".concat(e)})}verificationNotExecuted(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e||"object"!=typeof t)return void this.emit("TRACKER-error",{message:"One given verificationNotExecuted parameter has to wrong type. vendor: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))});if(!this.ad||!this.ad.adVerifications||!this.ad.adVerifications.length)throw new Error("No adVerifications provided");if(!e)throw new Error("No vendor provided, unable to find associated verificationNotExecuted");const i=this.ad.adVerifications.find((t=>t.vendor===e));if(!i)throw new Error("No associated verification element found for vendor: ".concat(e));const n=i.trackingEvents;if(n&&n.verificationNotExecuted){const e=n.verificationNotExecuted;this.trackURLs(e,t),this.emit("verificationNotExecuted",{trackingURLTemplates:e})}}overlayViewDuration(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof e&&"object"==typeof t?(t.ADPLAYHEAD=e,this.track("overlayViewDuration",{macros:t})):this.emit("TRACKER-error",{message:"One given overlayViewDuration parameters has the wrong type. formattedDuration: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))})}close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track(this.linear?"closeLinear":"close",{macros:e}):this.emit("TRACKER-error",{message:"close given macros has the wrong type. macros: ".concat(e)})}skip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("skip",{macros:e}):this.emit("TRACKER-error",{message:"skip given macros has the wrong type. macros: ".concat(e)})}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"==typeof e?this.track("loaded",{macros:e}):this.emit("TRACKER-error",{message:"load given macros has the wrong type. macros: ".concat(e)})}click(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!==e&&"string"!=typeof e||"object"!=typeof t)return void this.emit("TRACKER-error",{message:"One given click parameter has the wrong type. fallbackClickThroughURL: ".concat(e,", macros: ").concat(Et.formatMacrosValues(t))});this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates,t);const i=this.clickThroughURLTemplate||e,n={...t};if(i){this.progress&&(n.ADPLAYHEAD=this.progressFormatted());const e=Et.resolveURLTemplates([i],n)[0];this.emit("clickthrough",e)}}track(e){let{macros:t={},once:i=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!=typeof t)return void this.emit("TRACKER-error",{message:"track given macros has the wrong type. macros: ".concat(t)});"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");const n=this.trackingEvents[e],r=this.emitAlwaysEvents.indexOf(e)>-1;n?(this.emit(e,{trackingURLTemplates:n}),this.trackURLs(n,t)):r&&this.emit(e,null),i&&(delete this.trackingEvents[e],r&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}trackURLs(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{validUrls:r,invalidUrls:s}=Et.filterUrlTemplates(e);s.length&&this.emit("TRACKER-error",{message:"Provided urls are malformed. url: ".concat(s)});const a={...i};this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(a.ASSETURI=this.creative.mediaFiles[0].fileURL),this.progress&&(a.ADPLAYHEAD=this.progressFormatted())),null!==(t=this.creative)&&void 0!==t&&null!==(t=t.universalAdIds)&&void 0!==t&&t.length&&(a.UNIVERSALADID=this.creative.universalAdIds.map((e=>e.idRegistry.concat(" ",e.value))).join(",")),this.ad&&(this.ad.sequence&&(a.PODSEQUENCE=this.ad.sequence),this.ad.adType&&(a.ADTYPE=this.ad.adType),this.ad.adServingId&&(a.ADSERVINGID=this.ad.adServingId),this.ad.categories&&this.ad.categories.length&&(a.ADCATEGORIES=this.ad.categories.map((e=>e.value)).join(",")),this.ad.blockedAdCategories&&this.ad.blockedAdCategories.length&&(a.BLOCKEDADCATEGORIES=this.ad.blockedAdCategories.map((e=>e.value)).join(","))),Et.track(r,a,n)}convertToTimecode(e){if(!Et.isValidTimeValue(e))return"";const t=1e3*e,i=Math.floor(t/36e5),n=Math.floor(t/6e4%60),r=Math.floor(t/1e3%60),s=Math.floor(t%1e3);return"".concat(Et.addLeadingZeros(i,2),":").concat(Et.addLeadingZeros(n,2),":").concat(Et.addLeadingZeros(r,2),".").concat(Et.addLeadingZeros(s,3))}progressFormatted(){return this.convertToTimecode(this.progress)}}let jt,qt,Wt;const zt=()=>jt,Xt=()=>Wt,Zt=()=>void 0===jt?void 0:zt()-Xt(),Jt=()=>{qt=!0};let ei,ti;const ii=()=>void 0!==ei,ni=()=>ei,ri=()=>{ei=void 0,ti=void 0},si=()=>ti,ai=()=>ii()?ni()-si():void 0,oi="loadAd",di="fetchAd",li="initAd",ci="startAd",ui="bufferAd",hi="stopAd",Ei="skipAd",pi=()=>{const e=Zt(),t=ai();let i="Server";return e>=zt()?i=`Ad Break after ${e} ms`:(t>=ni()||e>=ni())&&(i=`Ad Unit after ${t} ms`),`${ne.AD_TIMEOUT_REACHED} for ${i}`},_i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e instanceof Ce)return e.updateProperties(t),e;const i=e.message?e.message:"string"==typeof e?e:"Unknown error";return new Ce(`${ne.INVALID_ERROR}: ${i}`,{type:de,...t})},vi=408,Ai=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{cancelToken:n,timeout:r}=t,s=performance.now(),a={withCredentials:i,...n&&{cancelToken:n},...r&&{timeout:r}},o=sessionStorage.getItem("X-DM-Inspector");o&&(a.headers={"X-DM-Inspector":o});try{const t=await tt().get(e,a);return{data:t.data,httpStatus:t.status,byteLength:parseInt(t.headers["content-length"],10)||t.data.length||null,duration:Math.round(performance.now()-s)}}catch(n){if(S("PV5_VMAP_REQUEST_NO_RETRY")||!i)throw n.duration=Math.round(performance.now()-s),n.httpStatus=(e=>{var t;return(null==(t=e.response)?void 0:t.status)||("ECONNABORTED"===e.code?vi:400)})(n),function(e){let{errorUrl:t,timeoutErrorCode:i,failedErrorCode:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||!i||!n)return;const r=e===vi?i:n;tt().get(t.replace("[ERRORCODE]",r))}(n.httpStatus,t),n;return Ai(e,t,!1)}},mi=T("Player","Scheduler","AdsScheduling");let gi=[],Ti=null,Ri=0;const Si=e=>{let{xmlData:t}=e,i=t;return t&&t.documentElement&&(i=(new XMLSerializer).serializeToString(t.documentElement)),{ad_call_type:"save",ad_client_inventory_id:Xe.value,ad_vast:i,ad_fallback:Ve.value}},Di=e=>{if(!e.length)return;const t=e.reduce(((e,t)=>{const{dataEndpointUrl:i,...n}=t;return i&&(e[i]=e[i]||[],e[i].push(n)),e}),{});Object.keys(t).forEach((e=>{(function(e){let{url:t,payload:i}=e,n="";try{n=JSON.stringify(i)}catch(e){throw new Error(`Could not encode payload (${e.message})`)}return tt().post(t,n,{timeout:3e4,headers:{"Content-Type":"text/plain; charset=UTF-8"}})})({url:e,payload:t[e]}).then((e=>{const{status:t,error_code:i,error_message:n}=e.data;"nok"===t&&mi.log(`Invalid save vast endpoint response: ${n} (${i})`)})).catch((e=>{mi.log("Unexpected save vast endpoint error:",e.message)}))}))},Ii=()=>{S("PV5_SAVE_VAST_RECORD")&&(window.clearInterval(Ri),gi.length&&Ti&&Di(gi),gi=[],Ti=null,Ri=0)},Li={get values(){return gi},add:e=>{e.xmlData&&S("PV5_SAVE_VAST_RECORD")&&gi.push({...Si(e),dataEndpointUrl:Ti})},clean:Ii,enableLogging:()=>{S("PV5_SAVE_VAST_RECORD")&&(Ri=window.setInterval((()=>{Ti?gi.length&&(Di(gi),gi=[]):Ii()}),5e3))},setEndpointUrl:e=>{Ti=e,gi.length&&!gi[0].dataEndpointUrl&&(gi[0].dataEndpointUrl=Ti)}},ki={},fi=e=>Object.prototype.hasOwnProperty.call(ki,e),Pi=e=>{if(fi(e))return clearTimeout(ki[e].id),delete ki[e]},yi=(e,t,i)=>{if(t<=0)return;fi(e)&&Pi(e);const n=()=>{Pi(e),i()};ki[e]={id:setTimeout(n,t),delay:t,handler:n}},Oi=Pi;let bi={};const Ci=e=>{var t;return null==(t=bi[e])?void 0:t.duration},Ni=e=>{bi[e]={startTime:Date.now(),duration:0}},Ui=()=>{bi={}},Vi=T("Ads","GlobalTimeout"),Mi="GLOBAL_TIMEOUT",wi=()=>{let e=Xt();if(ii()){const t=si();e<t?Vi.log(`AdUnit's timeout ${t} is bigger than AdBreak timeout,`,`using AdBreak's remaining time ${e} for this step`):e=t}return e},Fi=e=>Object.assign({globalAdTimeout:zt(),cumulativeTime:Zt(),localAdTimeout:ni(),localCumulativeTime:ai()},e?{[e]:Ci(e)}:null),Bi=()=>Ze.position===Ne.ev.MIDROLL&&!qt&&!Xe.isConsecutiveAdBreak,xi=e=>{let t,i;switch(e){case oi:case di:case li:case ci:case ui:t=Mi,i=wi();break;case hi:case Ei:t="STOP_TIMEOUT",i=250}return{timeoutId:t,delay:i}},Hi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const{timeoutId:i,delay:n}=xi(e),r=()=>{Vi.warn(`Reached timeout for ${i}...`),t(n)};Vi.log(`Starting timeout for ${e}: ${n}`),n<=0?r():yi(i,n,r)},Ki=e=>{const{timeoutId:t}=xi(e),i=(e=>{if(bi[e])return bi[e].duration=Date.now()-(e=>{var t;return null==(t=bi[e])?void 0:t.startTime})(e),Ci(e)})(e);var n;t!==Mi||Bi()||(Wt-=i,n=i,"number"==typeof ti&&(ti-=n)),Vi.log(`Done with ${e}: [took ${i}ms]`,t===Mi?`- ${wi()} ms remaining before reaching AdUnit Timeout`:""),Oi(t)},Yi=(e,t)=>{Vi.log(`start step ${e}`),Ni(e);const i=[t];if(!Bi()){const t=new Promise(((t,i)=>{Hi(e,(()=>{Ki(e),i(function(e){const t=pi();switch(e){case oi:return new Ce(t,{type:ue,code:2001});case di:return new Ce(t,{type:Ee,code:2002});case li:return new Ce(t,{type:_e,code:2002});case ci:return new Ce(t,{type:Ae,code:2003});case ui:return new Ce(t,{type:ge,code:2004});case hi:return new Ce(t,{type:Se});case Ei:return new Ce(t,{type:Ie})}}(e))}))}));i.push(t)}return Promise.race(i).then((t=>(Ki(e),t)))},Gi=T("AdStackDM","VAST");function Qi(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{const i=t.attributes.source,n=t.attributes.type;if("dailymotion"===i||"dmx"===i||"dailymotion"===n&&"dva"===i)try{const n=JSON.parse(t.value);return{...e,...n,..."dva"===i&&{dva:!0}}}catch(e){Gi.error(`Failed to parse dailymotion extension: ${t.value}`)}return e}),{})}const $i=()=>{if(!O()||!S("PV5_IMA_NATIVE_POC"))return!1;if(N().context("is_geo"))return!!y();const e=$();return!!(null==e?void 0:e.ima)};function ji(e){return"string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):{documentElement:e}}var qi=i(5275);const Wi=e=>{Object.defineProperty(e,"duration",{get(){return this.mediaFileDuration||this.vastDuration}})},zi=e=>{Object.defineProperty(e,"isLinear",{get(){return"linear"===this.creativeType}})},Xi=e=>{Object.defineProperty(e,"isNonLinear",{get(){return"nonlinear"===this.creativeType}})},Zi=e=>{Object.defineProperty(e,"height",{get(){return this.isNonLinear&&this.integrator?this.integrator.getNonLinearHeight():this._height},set(e){this._height=e}})},Ji=e=>{Object.defineProperty(e,"isAudio",{get(){return"audio"===this.mimeType}})},en=e=>{Object.defineProperty(e,"audioAdCompanion",{get(){var e;const t=this.displayedCompanion;return this.isAudio&&this.isAdSlotRunning&&t&&(null==(e=t.resource)?void 0:e.url)&&t.variation&&t.vastTracker?{companionImgUrl:t.resource.url,companionClickThruUrl:t.variation.companionClickThroughURLTemplate,companionSlotWidth:t.variation.width,companionSlotHeight:t.variation.height,companionAssetWidth:t.variation.assetWidth,companionAssetHeight:t.variation.assetHeight,companionVastTracker:t.vastTracker}:null}})},tn=function(){const e={adData:{},adCreativeId:null,adEndedReason:null,adError:null,adPodIndex:0,adPodTotalAds:0,adSlot:null,adSlotImpressions:0,adType:null,adid:null,adom:null,width:0,adPaused:!1,bid:null,bidid:null,cid:null,creativeType:null,currentTime:0,contentShouldResumePaused:!1,companions:null,displayedCompanion:null,mediaFileDuration:0,vastDuration:0,did:null,sid:null,crid:null,pid:null,siteid:null,integrator:null,icons:[],integratorName:null,inventoryId:null,hasIconsCollision:null,hasStarted:!1,hasLoaded:!1,hasSimid:!1,hasOmid:!1,isAdPod:!1,isFallback:!1,isNonLinearDisplayRunning:!1,isAdSlotRunning:!1,isSkippable:!1,fallbackUrl:null,fallbackMethod:null,adVerifications:null,vastTracker:null,provider:null,buyerType:null,adSystem:null,adTitle:null,mimeType:null,vastVersion:null,skipOffset:null,skipType:null,skippableRemainingTime:0,clientFallbackIndex:0,gppString:null,gppSectionId:null,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}};var t;return Wi(e),zi(e),Xi(e),Zi(e),Ji(e),en(e),t=e,Object.defineProperty(t,"clientInventoryId",{get:()=>Xe.value}),(e=>{Object.defineProperty(e,"clientFallbackIndex",{get:()=>Ve.value})})(e),e};ee.addEventListener(te.AD_STARTED,(e=>{nn.hasStarted=!0,nn.vastDuration=e.vastDuration})),ee.addEventListener(te.AD_LOADED,(e=>{const t=Vn(e.adVerifications);nn.integratorName=e.integrator,nn.inventoryId=e.inventoryId,nn.adCreativeId=e.adCreativeId,nn.vastTracker=e.vastTracker,nn.adVerifications=e.adVerifications,nn.adEndedReason=null,nn.adError=null,nn.bid=e.bid,nn.adid=e.adid,nn.adom=e.adom,nn.did=e.did,nn.cid=e.cid,nn.sid=e.sid,nn.crid=e.crid,nn.pid=e.pid,nn.siteid=e.siteid,nn.adType=e.adType,nn.bidid=e.bidid,nn.hasSimid=e.hasSimid,nn.hasOmid=t,nn.isAdPod=e.isAdPod,nn.adPodIndex=e.adPodIndex,nn.adPodTotalAds=e.adPodTotalAds,nn.mediaFileDuration=e.mediaFileDuration,nn.height=e.height,nn.width=e.width,nn.provider=e.provider,nn.buyerType=e.buyerType,nn.adSystem=e.adSystem,nn.adTitle=e.adTitle,nn.mimeType=e.mimeType,nn.vastVersion=e.vastVersion,nn.skipType=e.skipType,nn.skipOffset=e.skipOffset,nn.creativeType=e.creativeType,nn.hasLoaded=!0,nn.gppString=e.gppString,nn.gppSectionId=e.gppSectionId})),ee.addEventListener(te.AD_IMPRESSION,(()=>{nn.adSlotImpressions=nn.adSlotImpressions++})),ee.addEventListener(te.AD_NON_LINEAR_DISPLAY_STARTED,(()=>{nn.isNonLinearDisplayRunning=!0})),ee.addEventListener(te.PLAYER_VIDEO_SELECTED,(()=>{nn=tn()})),ee.addEventListener(te.AD_LINEAR_WILL_START,(()=>{nn.isAdSlotRunning=!0,nn.creativeType="linear"})),ee.addEventListener(te.AD_STARTED,(e=>{let{__type:t,type:i,timeoutInfo:n,integrator:r,...s}=e;nn.adData=s,nn.hasStarted=!0})),ee.addEventListener(te.AD_SLOT_INJECTED,(e=>{let{element:t}=e;nn.adSlot=t})),ee.addEventListener(te.AD_VIDEO_SKIPPABLE_STATE,(e=>{let{adSkippable:t}=e;nn.isSkippable=t})),ee.addEventListener(te.AD_VIDEO_SKIPPABLE_REMAINING_TIME,(e=>{let{time:t}=e;nn.skippableRemainingTime=t})),[(te.AD_SKIPPED,te.AD_STOPPED)].forEach((e=>{ee.addEventListener(e,(()=>{nn=tn({isAdSlotRunning:nn.isAdSlotRunning})}))})),ee.addEventListener(te.AD_ERROR,(e=>{let{adError:t}=e;nn=tn({adPaused:nn.adPaused,isAdSlotRunning:nn.isAdSlotRunning,inventoryId:nn.inventoryId,adError:t})})),ee.addEventListener(Ne.k3.PAUSED,(()=>{nn.adPaused=!0})),ee.addEventListener(Ne.k3.PLAYING,(()=>{nn.adPaused=!1})),ee.addEventListener(te.AD_LINEAR_STOPPED,(e=>{let{reason:t,position:i}=e;"REASON_AD_ERROR"===t&&i===Ne.ev.MIDROLL&&(nn.contentShouldResumePaused=nn.adPaused),nn.adEndedReason=t})),ee.addEventListener(te.PLAYER_VIDEO_TIME_UPDATE,(e=>{let{time:t}=e;nn.isAdSlotRunning&&(nn.currentTime=t)})),ee.addEventListener(te.PLAYER_VIDEO_DURATION_CHANGE,(e=>{let{duration:t}=e;nn.isAdSlotRunning&&(nn.mediaFileDuration=t)})),ee.addEventListener(te.AD_COMPANIONS_RECEIVED,(e=>{let{companionAds:t,displayedCompanion:i}=e;nn.companions=t,nn.displayedCompanion=i})),ee.addEventListener(te.AD_DATA_UPDATED,(e=>{let{adData:t}=e;nn.inventoryId=t.inventoryId,nn.bidid=t.bidid,nn.bid=t.bid,nn.did=t.did,nn.adCreativeId=t.adCreativeId||nn.adCreativeId})),ee.addEventListener(te.SET_AD_FALLBACK,(e=>{let{fallbackMethod:t,fallbackUrl:i}=e;nn=tn({isAdSlotRunning:nn.isAdSlotRunning,inventoryId:nn.inventoryId,isFallback:!0,fallbackMethod:t,fallbackUrl:i})})),ee.addEventListener(te.AD_LINEAR_SLOT_ENDED,(()=>{nn.isAdSlotRunning=!1})),ee.addEventListener(te.AD_BREAK_STARTED,(()=>{nn=tn({isAdSlotRunning:nn.isAdSlotRunning})})),ee.addEventListener(te.RESET_CURRENT_AD_BREAK,(()=>{nn=tn({contentShouldResumePaused:nn.contentShouldResumePaused})}));let nn=tn(),rn=null;const sn=["webapp","website","webtv"],an=["androidapp","iosapp","windowsapp"],on=["DMv31","androidtv","appletv","firetv","lgtv","orangetv","orangetv31","playstation","roku","samsungtv","samsungv3","sonytv"],dn=()=>(null===rn&&(rn=w().muted),rn),ln=()=>{rn=null},cn=function(){let{config:e=N()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{APPBUNDLE:O()?L():0,BREAKMAXADLENGTH:-1,BREAKMAXDURATION:-1,BREAKMAXADS:-1,BREAKMINADLENGTH:-1,BREAKPOSITION:_n(),CLICKTYPE:En(),CLIENTUA:"Dailymotion/5 vast-client/6.0.1",CONTENTID:`dailymotion.com ${V("accessId")}`,CONTENTURI:V("streamUrl"),DEVICEUA:e.window().navigator.userAgent,DOMAIN:e.getTopDomain()||e.getEmbedderHostname(),GDPRCONSENT:window.btoa(Hn()),GPPSTRING:nn.gppString||-1,GPPSECTIONID:nn.gppSectionId||-1,INVENTORYSTATE:An(),LIMITADTRACKING:un(),OMIDPARTNER:On(),PAGEURL:e.getEmbedder(),PLACEMENTTYPE:1,PLAYERCAPABILITIES:mn(),PLAYERSIZE:hn(),REGULATIONS:xn()?"gdpr":"",SERVERSIDE:0,TRANSACTIONID:Xe.value,CREATIVEDURATION:nn.duration||-1,PLAYBACKMETHODS:Ln(),STOREURL:-1,STOREID:-1}},un=()=>ir()["reader.lmt"]?1:0,hn=()=>{const{width:e,height:t}=A;return[e,t]},En=()=>{const e=k();return sn.includes(e)?1:an.includes(e)?2:on.includes(e)?0:-1},pn=(e,t)=>{if(t)return{CLICKPOS:[t.x,t.y]};const i=e.target.getBoundingClientRect();return{CLICKPOS:[e.clientX-i.left,e.clientY-i.top]}},_n=()=>{const e=Ze.position,t=[];return t[Ne.ev.PREROLL]=1,t[Ne.ev.MIDROLL]=2,t[Ne.ev.LIVEADBREAK]=2,t[Ne.ev.POSTROLL]=3,t[e]||0},vn=()=>{const e=(()=>{if(Ze.position===Ne.ev.MIDROLL){const e=G().currentTime;return new Date(1e3*e).toISOString().substr(11,12)}return-1})();return{CONTENTPLAYHEAD:e,MEDIAPLAYHEAD:e}},An=()=>{var e;const t=[];if(K().autoplay||(null==(e=H("autoplay"))?void 0:e.enable)){const e=dn()?"m":"";t.push(`${e}autoplayed`)}return nn.isSkippable&&t.push("skippable"),t.join(",")},mn=()=>{const e=["skip","autoplay"];return H("controls")&&(e.push("mute"),M().isSupported&&e.push("fullscreen")),e.join(",")},gn=()=>{const e=[Ne.nF.LN];return(S("PV5_OMSDK")||yn())&&e.push(Ne.nF.IO),S("PV5_SIMID")&&e.push(Ne.nF.jY,Ne.nF.fn),e},Tn=()=>{const e=[];return w().muted&&e.push("muted"),M().isOpened&&e.push("fullscreen"),e.join(",")},Rn=()=>({...cn(),...vn(),ADCOUNT:Xe.podIndex,PLAYERSTATE:Tn()}),Sn=1,Dn=2,In=3,Ln=()=>{var e;const t=dn();return K().autoplay||(null==(e=H("autoplay"))?void 0:e.enable)?t?Dn:Sn:t?"":In},kn=e=>{const t={...cn(),...vn(),ADCOUNT:-1,APIFRAMEWORKS:gn(),CACHEBUSTING:Math.round(1e10*Math.random()).toString(),EXTENSIONS:"AdVerifications",MEDIAMIME:[...Ne.VS.Kd,...Ne.VS.Aq,...Ne.VS.$U],TIMESTAMP:(new Date).toISOString(),VASTVERSIONS:[1,2,3,4,5,6,7,8,11,12,13,14],VERIFICATIONVENDORS:-1};return Object.entries(t).forEach((t=>{let[i,n]=t;e=e.replace(`[${i}]`,re.h.encodeURIComponentRFC3986(n))})),e},fn=T("Stats","Omsdk"),Pn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{skippable:!!e.skipOffset,skipOffset:e.skipOffset||0,autoplay:e.isRealAutoplay,position:[Ne.ev.PREROLL,Ne.ev.POSTROLL].includes(e.position)?e.position:Ne.ev.MIDROLL}},yn=()=>{var e,t;return O()&&S("PV5_OMSDK_NATIVE")&&(!!(null==(e=$())?void 0:e.omsdk)||null!==(null==(t=v)?void 0:t.getOmsdk()))},On=()=>{const e=null==(t=v)?void 0:t.getOmPartner();var t;const i=null==(n=v)?void 0:n.getOmVersion();var n;const r=N();if(yn()){if(null!==e&&null!==i)return`${e}/${i}`;const t=$();return`${t.ompartner}/${t.omversion}`}return S("PV5_OMSDK")&&(re.N.isDesktop(r)||re.N.isChromeMobile(r)||re.N.isSafariMobile(r))?`${qi.cv}/${qi.Y2}`:""},bn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const[i,n]=Cn(e);return n.length&&n.forEach((e=>Nn(t,e))),Un(i),i},Cn=e=>{const t=[];return[e.filter((e=>!!re.h.isValidUrl(e.resource)||(t.push(e),!1))),t]},Nn=(e,t)=>{fn.log(`Triggered verificationNotExecuted for vendor ${t.vendor} with reason ${qi.QF.LOADING_RESOURCE}`),e.verificationNotExecuted(t.vendor,{...Rn(),REASON:qi.QF.LOADING_RESOURCE}),ee.dispatchEvent(te.AD_LOG,{...Ne.r0.OMID_VERIFICATION_NOT_EXECUTED,name:t.vendor})},Un=e=>{e.filter((e=>"integralads.com-omid"===e.vendor)).forEach((e=>{var t;const i=nn.isAudio?"audio":"video",n=encodeURIComponent((null==(t=nn.adCreativeId)?void 0:t.substring(0,50))||"");e.resource=e.resource.replace("[CUSTOM4]",i),e.resource=e.resource.replace("[PLACEMENTID]",n)}))},Vn=e=>0!==e.length&&e.some((e=>{const t="integralads.com-omid"===e.vendor&&e.resource.includes("custom=leo"),i=e.vendor.includes("moat.com-omsdkdailymotion");return!t&&!i})),Mn=e=>{let{width:t,height:i}=e;return t&&i?{ps:`${t}x${i}`}:{}},wn=e=>e?{ct:e}:{},Fn=e=>e?{td:encodeURI(e)}:{},Bn=()=>{var e;const t=null==(e=N())?void 0:e.getEmbedder();return t?{eb:encodeURI(t)}:{}},xn=()=>X()?"1":"0",Hn=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:D().getTcfConsentString())||""},Kn=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:D().TCF2HasConsentForGoogle())?"opt-in":"opt-out"},Yn=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:D().isEnabledForTcf())?"1":"0"},Gn=()=>({reader_gdpr_flag:xn(),reader_gdpr_consent:Hn(),gdpr_binary_consent:Kn(),gdpr_comes_from_infopack:Yn()}),Qn=()=>{const e=window.infopack.getGppConsentStringFromPublisher(),t=window.infopack.getGppConsentStringFromPlayer(),i=window.infopack.getGppApplicableSectionsFromPublisher(),n=window.infopack.getGppApplicableSectionsFromPlayer(),r={};return e&&(r.gpp_pb=e),t&&(r.gpp_pl=t),(null==i?void 0:i.length)&&i[0]>=1&&(r.gpp_pbs=i),(null==n?void 0:n.length)&&n[0]>=1&&(r.gpp_pls=n),r},$n=()=>{const e=null==(t=v)?void 0:t.getUID();var t;return e?V("isCreatedForKids")||X()&&!D().TCF2HasConsentForDailymotion()?{}:{uid_dm:e}:{}},jn=e=>{const t=0===G().playedVideosCounter;if(R()&&!Ze.position&&t){var i,n;if(void 0===(null==(i=e)?void 0:i.muted)?N().player("enableTapToUnmute")||H("mute"):null==(n=e)?void 0:n.muted)return{vl:-1};try{var r,s,a;const t=JSON.parse(localStorage.getItem("dmp_volume"));return(null==(s=e=(null==(r=e)?void 0:r.volume)?e:null==t?void 0:t.data)?void 0:s.volume)?{vl:Math.round(10*(null==(a=e)?void 0:a.volume))}:{}}catch(e){return{}}}return e?{vl:e.muted?-1:Math.round(10*e.volume)}:{}},qn=()=>({ciid:Xe.value,cidx:Ve.value,sidx:we.value}),Wn=async()=>{var e,t;if(!(null==(e=document)?void 0:e.browsingTopics)||!(null==(t=document.featurePolicy)?void 0:t.allowsFeature("browsing-topics")))return{};try{const e=(e=>(null==e?void 0:e.length)?e.map((e=>{const{topic:t,taxonomyVersion:i,modelVersion:n}=e;if(t&&i&&n)return[t,parseInt(i),parseInt(n)]})).filter((e=>e)):[])(await document.browsingTopics());return e.length?{gt:e}:{}}catch(e){return{}}},zn=async e=>{if(Ze.position||!R()||G().playedVideosCounter>=1)return{rap:e?1:0};if(!(null==(t=v)?void 0:t.isAutoplayEnabled()))return{rap:0};var t;let i;try{var n,r;const e=H("autoplay.enable",!0)&&H("mute",!0);await(s={gotUserAction:"1"===(null==(n=null==(o=v)?void 0:o.getPlayerMainNode())?void 0:n.getAttribute("data-got-user-action")),isMuted:(null==(r=w())?void 0:r.muted)||H("mute"),videoTag:x(),shouldTryMutedAutoplay:e},null==(a=v)?void 0:a.getAutoplayResolution(s)),i=!0}catch(e){i=!1}var s,a,o;return{rap:i?1:0}},Xn=()=>({vidIdx:G().playedVideosCounter}),Zn=()=>{const e=On();return e?{omp:e}:{}},Jn=async()=>{const e=await(async()=>{if("cookieDeprecationLabel"in navigator)try{return await navigator.cookieDeprecationLabel.getValue()}catch(e){return}})();return e?{cdep:e}:{}},er=()=>({omn:yn()?1:0}),tr=()=>{const e=null==(t=v)?void 0:t.getLiverampEnvelope();var t;const{TCF2HasConsentForDailymotion:i,TCF2HasConsentForLiveramp:n}=D();if(!e)return{};if(V("isCreatedForKids"))return{};if(X()){if(!i())return{};if(!n())return{}}return{uidlr:e}},ir=()=>{const e=null==(t=v)?void 0:t.getDeviceId();var t;const i=null==(n=v)?void 0:n.getAtts();var n;const r=null==(s=v)?void 0:s.isTrackingAllowed();var s;const a=null==(o=v)?void 0:o.getLimitAdTracking();var o;if(!O())return{};if(N().context("is_geo"))return{ads_device_id:e,"reader.advertising.id":e,"reader.atts":i,"sdk.tracking.allowed":r,"reader.lmt":a};const d=$();return d?{ads_device_id:d.deviceId,"reader.advertising.id":d.deviceId,"reader.atts":d.atts,"sdk.tracking.allowed":d.trackingAllowed,"reader.lmt":d.limitAdTracking}:{}},nr=()=>{const e=$();return Lo.isLoaded()||(null==e?void 0:e.ima)||y()?{imal:1}:{imal:-1}},rr=()=>{const e=P(),t={},i=N().context("is_geo"),n=null==(r=v)?void 0:r.getCustomConfigKeysForMetadata();var r;const s=null==(a=v)?void 0:a.getLegacyCustomQs();var a;return Object.keys(e).forEach((r=>{if(!R()&&(i&&n.includes(r)||!i&&s.includes(r)))return;const a=r[0].toUpperCase()+r.slice(1);t[`cc${a}`]=e[r]})),ee.dispatchEvent(te.PLAYER_API_CUST_CONFIG_CONSUMED),t},sr=()=>{const e=L();return e?{cap:e}:{}},ar=()=>{const e=null==(t=v)?void 0:t.getPlayerTrafficSegment();var t;return e?{rts:e}:{}},or=()=>{const e=N().context("reader_id");return e?{rid:e}:{}},dr=()=>{const e=(null==(t=v)?void 0:t.getPlayerV1st())?1:0;var t;return e?{rhv:e}:{}},lr=()=>{const e=N().context("env");return e?{cen:e}:{}},cr=()=>{if(!S("PV5_DYNAMIC_AD_PRESSURE_CC")||!C())return{};const e=U(),{action:t}=e.getEventBusPayload();return{...(null==t?void 0:t.gesture)&&{ccUserGesture:null==t?void 0:t.gesture}}},ur=()=>{const e=N().context("publisher_xid");return e?{cpi:e}:{}},hr=()=>{const e=N().context("publisher_type");return e?{cpt:e}:{}},Er=()=>{const e=N().getLanguage();return e?{rla:e}:{}},pr=()=>{var e,t,i;const n=(null==(r=v)?void 0:r.getPlayerPlaylistId())||(null==(e=N().get())||null==(t=e.suggestedContent)||null==(i=t.source)?void 0:i.xid);var r;return n?{cpl:n}:{}},_r=()=>{const e=N().player("id")||H("syndication");return e?{cpr:e}:{}},vr=()=>{const e=null==(t=v)?void 0:t.getPlayerViewId();var t;return e?{cse:e}:{}},Ar=()=>{const e=("dmaid",null==(t=v)?void 0:t.getPlayerCookie("dmaid"));var t;return e?{rdm:e}:{}},mr=e=>{var t;let{rap:i}=e;const n=(null==(t=w())?void 0:t.muted)||H("mute")||N().player("enableTapToUnmute");return i?{pbm:n?2:1}:n?{}:{pbm:3}},gr=e=>R()?{...sr(),...ar(),...dr(),...lr(),...O()?{cin:1}:{},...C()?{cos:1}:{},...ur(),...hr(),...Er(),...pr(),..._r(),...vr(),...Ar(),...or(),...Bn(),...mr(e)}:{};let Tr,Rr;const Sr=(e,t)=>{e&&(Tr=e),t&&(Rr=t);const i=Rr&&!Tr?`playlist/${Rr}`:`video/${Tr}`;return{stage:`https://addir-stage01.dailymotion.com/cdn/manifest/${i}.m3u8`,prod:`https://dmxleo.dailymotion.com/cdn/manifest/${i}.m3u8`}},Dr=e=>{const t=e.context("env")||"";return["prod","preprod"].includes(t)?"prod":"stage"},Ir=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Sr(arguments.length>1?arguments[1]:void 0,arguments.length>2?arguments[2]:void 0),i={stage:`${t.stage}?af=[APIFRAMEWORKS]&vv=[VASTVERSIONS]&mm=[MEDIAMIME]`,prod:`${t.prod}?af=[APIFRAMEWORKS]&vv=[VASTVERSIONS]&mm=[MEDIAMIME]`},n={stage:`${t.stage}?error=[ERRORCODE]`,prod:`${t.prod}?error=[ERRORCODE]`},r=Dr(e);return{adUrl:new URL(document.location.href).searchParams.get("dmDevVmapUrl")||i[r],errorUrl:n[r]}};function Lr(e){const t=re.h.parseUrl(e);if(!t)return!1;const i=R()?Ir(N()).adUrl:V("adUrl"),n=re.h.parseUrl(i);return!!n&&n.host===t.host&&n.pathname===t.pathname}function kr(e,t){return{supported:()=>!0,async get(e){if(be.reset(),"https:"===window.location.protocol&&0===e.indexOf("http://"))return{error:new Error(ne.BAD_PROTOCOL)};let i=ne.VAST_WRAPPER_REQUEST_FAILED,n=e;const r=t.cancelToken||null;if(Lr(e)){const r=await Jn(),s=await Wn(),a=await zn(t.isRealAutoplay);n=re.h.appendEncodedQueryParameters(e,{...jn(t.volume),...qn(),...a,...Xn(),...Zn(),...er(),...ir(),...rr(),...r,...s}),i=ne.AD_DIRECTOR_REQUEST_FAILED}return Ai(n,{cancelToken:r}).then((e=>{let{data:t,httpStatus:i,byteLength:n}=e;be.value=i;const r=ji(t);return[null,r,{byteLength:n,statusCode:i,xmlData:r}]})).catch((e=>(be.value=e.httpStatus,[new Error(i),null,{statusCode:e.httpStatus}]))).then((e=>{let[t,i,n]=e;return{error:t,xml:i,details:n}}))}}}const fr=T("AdStackDM","VAST","SkipHandler");class Pr{constructor(e,t,i){this._publish=t.bind(i),this._vastTracker=e,this._skippableState=e.skippable,this._skippableRemainingTime=e.skipDelay,this._smartSkipUsed=!1,this._smartSkipStart=0,this._smartSkipEnd=0,this._hasSmartSkipStarted=!1}initSkipCountdown(e){this._skippableRemainingTime>e-1||this._vastTracker.on("skip-countdown",this._onSkipCountdown.bind(this))}unbindSkipCountdown(){this._vastTracker.off("skip-countdown",this._onSkipCountdown.bind(this))}getSkippableState(){return this._skippableState}getSkippableRemainingTime(){return this._skippableRemainingTime}setSkipToNow(e){if(this._isSmartSkipEnabled()&&this._hasSmartSkipStarted){this._smartSkipEnd=performance.now();const t=this._smartSkipEnd-this._smartSkipStart;fr.log("Smart skip ended. Took:",t,"ms"),t>=5e3?(fr.log("Smart skip enabled"),this._vastTracker.setSkipDelay(e),this._onSkipCountdown(0),this._smartSkipUsed=!0):(fr.log("Smart skip disabled"),this._smartSkipStart=0,this._smartSkipEnd=0,this._hasSmartSkipStarted=!1)}}initSmartSkip(){this._isSmartSkipEnabled()&&(this._smartSkipStart=performance.now(),fr.log("Smart skip started"),this._hasSmartSkipStarted=!0)}getSkipLogs(e){return{skipDisplayed:Math.round(1e3*this._vastTracker.skipDelay),skipClicked:e?Math.round(1e3*e):null,isSmartSkip:this._smartSkipUsed}}isSkipEnabled(){return this._vastTracker.skipDelay>0}_isSmartSkipEnabled(){return S("PV5_ENABLE_SMART_SKIP")&&this.isSkipEnabled()&&!this._skippableState}_onSkipCountdown(e){this._skippableRemainingTime!==e&&(this._skippableRemainingTime=e,this._publish(Ne.k3.SKIPPABLE_REMAINING_TIME_CHANGE)),this._skippableState!==this._vastTracker.skippable&&(this._skippableState=this._vastTracker.skippable,this._publish(Ne.k3.SKIPPABLE_STATE_CHANGE))}}let yr={};const Or=()=>{const{byteLength:e,duration:t,sent:i}=yr;return!i&&e&&t?(yr.sent=!0,{byteLength:e,requestDuration:t}):{}},br=T("Mediafile","IntegratorProxy");class Cr extends J{constructor(){super(),nn.integrator=null,this._integratorType=null,this._defaultEventBindings={}}_bindDefaultListeners(){var e=this;let{include:t=[],exclude:i=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const r in Ne.k3){const s=Ne.k3[r];if(this._shouldBindEvent(s,t,i,n)){br.log(`Binding default integrator handler for ${s}`);const t=function(){br.log(`Re-publishing ${s}`);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];e.publish(s,...i)};!!this._defaultEventBindings[event]&&nn.integrator.unsubscribe(this._defaultEventBindings[s],s),this._defaultEventBindings[s]=t,nn.integrator.subscribe(this._defaultEventBindings[s],s,this)}}}_shouldBindEvent(e,t,i,n){const r=t.length||i.length,s=t.length,a=!r||s&&-1!==t.indexOf(e)||!s&&-1===i.indexOf(e),o=!!this._defaultEventBindings[e];return a&&(!o||n)}_unbindDefaultListeners(){if(nn.integrator){for(const e in this._defaultEventBindings)nn.integrator.unsubscribe(this._defaultEventBindings[e],e);this._defaultEventBindings={}}}_overrideDefaultListener(e,t,i){!e in Ne.k3||(nn.integrator.unsubscribe(this._defaultEventBindings[e],e),this._defaultEventBindings[e]=t,nn.integrator.subscribe(this._defaultEventBindings[e],e,i))}clicked(){"function"==typeof nn.integrator.clicked&&nn.integrator.clicked()}isCustomImaUi(){if(!nn.integrator||this._integratorType!==Ne.Z4.Hs)return!1;try{const e=nn.integrator.adsManager.getCurrentAd();return e&&e.isUiDisabled()}catch(e){return!1}}getAdDuration(){return nn.integrator?nn.integrator.getAdDuration():-2}getAdRemainingTime(){return nn.integrator.getAdRemainingTime()}getAdSkippableState(){return nn.integrator.getAdSkippableState()}getAdVolume(){return nn.integrator?nn.integrator.getAdVolume():-1}setAdVolume(e,t){nn.integrator.setAdVolume(e,t)}getAdSkippableRemainingTime(){return nn.integrator.getAdSkippableRemainingTime()}}function Nr(e,t){N().canBroadcastAdLog()?q("ad_log",{message:e,args:t}):(null==t?void 0:t.isTriggeredByVpaid)&&e===Ne.L0.sY&&q("ad_log",{message:e,args:null==t?void 0:t.log})}let Ur=!1,Vr={};const Mr=e=>{Ur=e},wr=e=>{var t,i,n;Vr=e?{...Vr,...e}:{ad_type:Ze.position,ad_provider:nn.provider,ad_buyer_type:nn.buyerType,ad_system:nn.adSystem,ad_title:nn.adTitle,ad_inventory_id:nn.inventoryId,ad_integrator:nn.integratorName,ad_mediafile_mimetype:nn.mimeType,ad_ima_loaded:Lo.isLoaded(),ad_adscheduleid:(null==(t=Ze.current)||null==(i=t.extension)?void 0:i.asid)||null,ad_is_a_retake:(null==(n=Ze.current)?void 0:n.isARetake)||null,...nn.integratorName===Ne.Z4.iF&&{ad_mediafile_height:nn.height,ad_mediafile_width:nn.width},...nn.vastVersion&&{ad_vast_version:nn.vastVersion},...null!==nn.bid&&{ad_bid:nn.bid},...null!==nn.sid&&{ad_sid:nn.sid},...null!==nn.adom&&{ad_adom:nn.adom},...null!==nn.cid&&{ad_cid:nn.cid},...null!==nn.adid&&{ad_adid:nn.adid},...null!==nn.crid&&{ad_crid:nn.crid},...null!==nn.did&&{ad_did:nn.did},...null!==nn.bidid&&{ad_bidid:nn.bidid},...null!==nn.pid&&{ad_pid:nn.pid},...nn.isLinear&&null!==nn.vastDuration&&{ad_duration:nn.vastDuration},...nn.isNonLinear&&{is_nonlinear:!0},...null!==nn.hasSimid&&{has_simid:nn.hasSimid},...null!==nn.hasOmid&&{has_omid:nn.hasOmid}}};let Fr=0,Br=0,xr=0,Hr=0;const Kr=()=>Fr=Date.now(),Yr=()=>xr=Date.now(),Gr=()=>Br=Date.now(),Qr=()=>Hr=Date.now(),$r=e=>{let{tableName:t,customData:i={}}=e;const n=U(),r=n.createEventBusEvent({name:`advertising.${t}`,data:{...n.getEventBusPayload(),...(Ur||wr(),Vr),ad_client_inventory_id:Xe.value,ad_client_idx:Ve.value,ad_server_idx:we.value,ad_pod_index:Xe.podIndex,ad_buffet_index:Be.value,ad_buffet_total:He.value,ad_vast_index:Ye.value,...i}});n.sendEventToEventBus(r,{priority:"low"})},jr=e=>(t,i)=>{const n=()=>{e.forEach((e=>{ee.removeEventListener(e,t)})),null==i||i()};ee.addEventListener(te.AD_LINEAR_SLOT_STARTED,(()=>{e.forEach((e=>{ee.addEventListener(e,t)}))})),ee.addEventListener(te.AD_LINEAR_SLOT_ENDED,n),ee.addEventListener(te.PLAYER_LOAD_VIDEO,n)};let qr=!1;const Wr=e=>{const{endedReason:t,skipDisplayed:i,skipClicked:n}=e;$r({tableName:"adEnded",customData:{ad_paused:qr,ad_displayed_time:Hr-Br,ad_ended_reason:t,ad_skip_offset:nn.skipOffset?1e3*nn.skipOffset:null,...(0===i||i)&&{ad_skip_displayed:i},...(0===n||n)&&{ad_skip_clicked:n},...nn.skipType&&{ad_skip_type:nn.skipType}}})},zr=e=>{e.reason&&"nonlinear"===e.creativeType&&$r({tableName:"adEnded",customData:{ad_ended_reason:e.reason}})},Xr=()=>{const e=jr([te.AD_VIDEO_COMPLETE]),t=jr([te.AD_STOPPED]),i=jr([te.PLAYER_VIDEO_PAUSE]);e(Wr),t(zr),i((()=>qr=!0),(()=>qr=!1))};let Zr=null,Jr=null,es=!1,ts=!0,is=null;const ns={get value(){return ts?null:Jr||Math.floor(performance.now()-Zr)},start(){ts||es||(Zr=performance.now(),es=!0,Jr=null)},finish:()=>!(ts||!es||(Jr=Math.floor(performance.now()-Zr),es=!1,0)),reset(){Zr=null,Jr=null,es=!1,ts=!0},disable(){ts=!0},enable(){ts=!1}},rs={get value(){return Math.floor(performance.now()-is)},start(){is=performance.now()}},ss=function(){let{adError:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{message:t,type:i,code:n,httpStatus:r,timeoutInfo:s,adSystem:a,adTitle:o,adURL:d,inventoryId:l,provider:c,buyerType:u,integrator:h,bid:E,sid:p,adom:_,cid:v,adid:A,crid:m,did:g,bidid:T,pid:R,lastVastUrl:S,vastVersion:D,vpaidRuntimeError:I}=e,L=null!=n?n:null,k={...a&&{ad_system:a},...o&&{ad_title:o},...l&&{ad_inventory_id:l},...h&&{ad_integrator:h},...c&&{ad_provider:c},...u&&{ad_buyer_type:u},...D&&{ad_vast_version:D},...null!=E&&{ad_bid:E},...null!=p&&{ad_sid:p},...null!=_&&{ad_adom:_},...null!=v&&{ad_cid:v},...null!=A&&{ad_adid:A},...null!=m&&{ad_crid:m},...null!=g&&{ad_did:g},...null!=T&&{ad_bidid:T},...null!=R&&{ad_pid:R}};Mr(!0),wr(k),$r({tableName:"adError",customData:{error_type:i,message:"string"==typeof t?t:null==t?void 0:t.message,ad_cumulative_time:rs.value,...d&&{ad_url:d},...n&&{code:n},...S&&{last_vast_url:S},...(null==s?void 0:s.globalAdTimeout)&&{ad_global_timeout_time:s.globalAdTimeout},...null!==L&&{ad_vast_error_code:L},...null!==I&&{ad_vpaid_runtime_error:I},...null!==ns.value&&{ad_time_from_first_fetch:ns.value},...null!==r&&{ad_status_code:1e3+r}}})},as=()=>{ee.addEventListener(te.AD_STACK_ERROR,ss),jr([te.AD_ERROR,te.AD_POD_ERROR])(ss)},os=()=>{$r({tableName:"adImpression",customData:{ad_impression_time:xr-Fr,ad_cumulative_time:rs.value,...null!==ns.value&&{ad_time_from_first_fetch:ns.value},...null!==nn.siteid&&{ad_siteid:nn.siteid},...null!==nn.hasIconsCollision&&{has_icons_collision:nn.hasIconsCollision}}})},ds=()=>{jr([te.AD_IMPRESSION])(os)},ls=e=>{$r({tableName:"adLoaded",customData:{ad_loaded_time:e.timeoutInfo.initAd,ad_cumulative_time:rs.value,ad_global_timeout_time:e.timeoutInfo.globalAdTimeout,...null!==ns.value&&{ad_time_from_first_fetch:ns.value}}})},cs=()=>{jr([te.AD_LOADED])(ls)},us=[Ne.r0.AD_RESOLVED_ERROR.id,Ne.r0.AD_RESOLVED_OK.id,Ne.r0.CONSECUTIVE_EXCLUSION.id,Ne.r0.ELEMENT_SHIELD.id,Ne.r0.IAS_LOADED.id,Ne.r0.IMA_RECOVERABLE_AD_ERROR.id,Ne.r0.OMID_NEEDED.id,Ne.r0.OMID_SCRIPT_URL_LOADED.id,Ne.r0.OMID_SESSION_OBSERVER_VENDOR.id,Ne.r0.OMID_VERIFICATION_NOT_EXECUTED.id,Ne.r0.PERMANENT_EXCLUSION.id,Ne.r0.SIMID_REQUEST_CHANGE_AD_DURATION.id,Ne.r0.SIMID_REQUEST_EXIT_FULLSCREEN.id,Ne.r0.SIMID_REQUEST_FULLSCREEN.id,Ne.r0.TEMPORARY_EXCLUSION.id,Ne.r0.TOPICS_API.id,Ne.r0.VAST_URI_MIXED_CONTENT.id,Ne.r0.VPAID_EARLY_START_AD_EVENT.id,Ne.r0.VPAID_SAFE_OBJECT_WRAP_ERROR.id,Ne.r0.VPAID_VERSION_SUPPORT.id];let hs=!1;const Es=e=>{us.includes(e.id)&&$r({tableName:"adLog",customData:{ad_log_id:e.id,ad_log_action:e.action,ad_log_name:e.name,ad_log_value:null==e.value?e.value:String(e.value),ad_log_step:e.step,...null!==ns.value&&{ad_time_from_first_fetch:ns.value}}})},ps=()=>{hs||(uo(Es,Ne.k3.LOG),hs=!0)},_s=()=>{hs&&(ho(Es,Ne.k3.LOG),hs=!1)},vs=()=>{ee.addEventListener(te.AD_LOG,Es),jr([te.AD_SDK_READY])(ps,_s)},As=e=>{rs.start(),$r({tableName:"adSdkReady",customData:{ad_sdk_ready_time:e.timeoutInfo.loadAd,ad_cumulative_time:rs.value,ad_global_timeout_time:e.timeoutInfo.globalAdTimeout,ad_fallback_method:e.fallbackMethod,...null!==ns.value&&{ad_time_from_first_fetch:ns.value}}})},ms=()=>{jr([te.AD_SDK_READY])(As)},gs=e=>{$r({tableName:"adStarted",customData:{ad_started_time:e.timeoutInfo.startAd,ad_cumulative_time:rs.value,ad_global_timeout_time:e.timeoutInfo.globalAdTimeout,ad_skip_offset:nn.skipOffset?1e3*nn.skipOffset:null,...null!==ns.value&&{ad_time_from_first_fetch:ns.value}}})},Ts=()=>{jr([te.AD_LINEAR_STARTED])(gs)},Rs=()=>{if(nn.skipOffset)return nn.duration&&nn.skipOffset>nn.duration?1:A.height<180?2:A.width<240?3:!H("advertising").controls&&A.width<320?4:void 0},Ss=()=>{const e=Rs();$r({tableName:"adVideoStarted",customData:{ad_cumulative_time:rs.value,...null!==ns.value&&{ad_time_from_first_fetch:ns.value},...e&&{ad_skip_ignored:e}}})},Ds=()=>{jr([te.AD_VIDEO_START])(Ss)};let Is=!1;const Ls=()=>{$r({tableName:"userClose"})},ks=()=>{Is||(uo(Ls,Ne.k3.USER_CLOSE),Is=!0)},fs=()=>{Is&&(ho(Ls,Ne.k3.USER_CLOSE),Is=!1)},Ps=()=>{jr([te.AD_SDK_READY])(ks,fs)},ys=[s,a,o,d,l,c,u,h,E],Os=()=>{Fr=0,Br=0,xr=0,Hr=0,Vr={},Mr(!1)},bs="VAST",Cs="VMAP",Ns="SEND",Us="INIT",Vs="RECEIVE",Ms="ERROR",ws="TIMEOUT",Fs=e=>e.component===Cs?{}:{ad_bid_id:nn.bidid,ad_bidder_id:nn.bid,ad_buffet_index:Be.value,ad_buffet_total:He.value,ad_client_index:Ve.value,ad_creative_id:nn.adCreativeId,ad_cumulative_time:rs.value,ad_deal_id:nn.did,ad_inventory_id:nn.inventoryId,ad_time_before_timeout:wi(),ad_time_from_first_fetch:ns.value,ad_timeout_value_origin:ii()&&Xt()>=si()?"ADUNIT":"ADBREAK",ad_vast_index:Ye.value,ad_wrapper_index:e.wrapperDepth},Bs=e=>{const t=U();let i=null;if(e.url)try{i=new URL(e.url).hostname}catch{}const n=t.createEventBusEvent({name:"advertising.adAction",data:{ad_action:e.action,ad_call_latency:e.callLatency,ad_client_inventory_id:Xe.value,ad_component:e.component,ad_response_type:e.responseType,ad_status_code:e.statusCode,ad_url_domain:i,...Fs(e)}});t.sendEventToEventBus(n,{priority:"low",update:!1})},xs=(e,t)=>{const i={};if(t===Ne.Z4.Hs)try{const t=e.getWrapperAdIds(),n=t.length>0?t[t.length-1]:e.getAdId(),r=e.getWrapperCreativeIds(),s=r.length>0?r[r.length-1]:e.getCreativeId();i.adId=n,i.creativeId=s,i.id=e.id,i.vastDuration=e.getDuration(),i.title=e.getTitle(),i.description=e.getDescription(),i.advertiserName=e.getAdvertiserName(),i.uiElements=e.getUiElements(),i.adSystem=e.getAdSystem()}catch(e){}else if(t===Ne.Z4.Vf){var n,r;const t=(null==e||null==(n=e.wrapperAdIds)?void 0:n.length)>0?e.wrapperAdIds[e.wrapperAdIds.length-1]:null==e?void 0:e.adId,s=(null==e||null==(r=e.wrapperCreativeIds)?void 0:r.length)>0?e.wrapperCreativeIds[e.wrapperCreativeIds.length-1]:null==e?void 0:e.creativeId;i.adId=t,i.creativeId=s,i.id=null==e?void 0:e.id,i.vastDuration=null==e?void 0:e.duration,i.title=null==e?void 0:e.title,i.description=null==e?void 0:e.description,i.advertiserName=null==e?void 0:e.advertiserName}else{var s,a;const t=(null==e||null==(s=e.creatives)?void 0:s.length)>0?e.creatives[0]:{},n=(null==t?void 0:t.universalAdId)?`${t.universalAdId.idRegistry}-${t.universalAdId.value}`:null==e?void 0:e.adId;i.vastDuration=null==t?void 0:t.duration,i.advertiserName=null==e||null==(a=e.system)?void 0:a.value,i.description=null==e?void 0:e.description,i.adId=n,i.title=null==e?void 0:e.title,i.creativeId=null==t?void 0:t.id,i.id=null==e?void 0:e.id}return i},Hs=e=>{let{previousViewMode:t,viewMode:i,vastTracker:n}=e;if(t!==i){const e="fullscreen"===i;if("fullscreen"===t||e){const t=Rn();n.setFullscreen(e,t),n.setExpand(e,t)}}},Ks=T("AdStackDM","VAST","IMAIntegrator"),Ys="IMA Playlist timeout";class Gs extends J{constructor(){let{mediaFiles:e,vastTracker:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{mediaFiles:null,vastTracker:null};super(),this.boundedListeners={},this.mediaFiles=e,this.vastTracker=t,this._lastAdEndedReason=null}_bindListeners(){this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.LOADED,this._onLoaded),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.PAUSED,this._onPaused),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.RESUMED,this._onResumed),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.CLICK,this._onClick),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.USER_CLOSE,this._onUserClose),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.DURATION_CHANGE,this._onDurationChange),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.AD_PROGRESS,this._onAdProgress),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.VOLUME_CHANGED,this._onVolumeChange),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.VOLUME_MUTED,this._onVolumeChange),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.STARTED,this._onStarted),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.FIRST_QUARTILE,this._onFirstQuartile),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.MIDPOINT,this._onMidpoint),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.THIRD_QUARTILE,this._onThirdQuartile),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.COMPLETE,this._onVideoCompleted),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.SKIPPED,this._onSkipped),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.ALL_ADS_COMPLETED,this._onAllAdsCompleted),this._addBoundedEventListener(Lo.adUnit.AdEvent.Type.LOG,this._onAdLog)}_unbindListeners(){this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.LOADED),this._removeBoundedEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.PAUSED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.RESUMED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.CLICK),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.DURATION_CHANGE),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.VOLUME_CHANGED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.VOLUME_MUTED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.STARTED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.FIRST_QUARTILE),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.MIDPOINT),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.THIRD_QUARTILE),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.COMPLETE),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.USER_CLOSE),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.SKIPPED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.CONTENT_RESUME_REQUESTED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.ALL_ADS_COMPLETED),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.AD_PROGRESS),this._removeBoundedEventListener(Lo.adUnit.AdEvent.Type.LOG)}_addBoundedEventListener(e,t){this.boundedListeners[e]=t.bind(this),this.adsManager.addEventListener(e,this.boundedListeners[e])}_removeBoundedEventListener(e){const t=this.boundedListeners[e];t&&(this.adsManager.removeEventListener(e,t),delete this.boundedListeners[e])}_clean(){Ks.log("Cleaning Slot"),Lo.cleanAdUnit(),this.inventoryIdValue=null,Lo.notifyContentVideoEnd(),this.adsManager&&this.adsManager.destroy()}_startVideoAd(){this.publish(Ne.k3.DURATION_CHANGE)}_endVideoAd(e){this._removeBoundedEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR),this._isLastAdFromPod(e)||(Xe.newAd(),this.startAdPromise=this.startAdsManagerHelper(),this._startNextAd())}initAdsManagerHelper(){return new Promise(((e,t)=>{this.adsManager||t(new Ce(ne.IMA_ADSMANAGER_UNDEFINED,{type:pe}));const i=()=>{this.adsManager.removeEventListener(Lo.adUnit.AdEvent.Type.CONTENT_PAUSE_REQUESTED,r),this.adsManager.removeEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,s),this.adsManager.removeEventListener(Lo.adUnit.AdErrorEvent.Type.LOADED,n)},n=i=>{this._onAdsManagerLoaded(i,e,t)},r=t=>{i(),e(t)},s=e=>{var n;i();const r=e.getError(),s=new Ce(r.getMessage(),{type:pe,code:r.getErrorCode()});(null==(n=this.adsManager.getCurrentAd())?void 0:n.isLinear())?t(s):(this.vastTracker.error({...Rn(),ERRORCODE:r.getErrorCode()}),this.publish(Ne.k3.ERROR,s))};this.adsManager.addEventListener(Lo.adUnit.AdEvent.Type.LOADED,n),this.adsManager.addEventListener(Lo.adUnit.AdEvent.Type.CONTENT_PAUSE_REQUESTED,r),this.adsManager.addEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,s)}))}startAdsManagerHelper(){return new Promise(((e,t)=>{const i=()=>{this.adsManager.removeEventListener(Lo.adUnit.AdEvent.Type.IMPRESSION,n),this.adsManager.removeEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,r)},n=t=>{const n=t.getAd();n.isLinear()||(this._setNonLinearDurationTimeout(n.getMinSuggestedDuration()),this.overlayViewDurationTimestamp=Date.now()),Xe.newAd(this._getAdPodIndexForAd(n)),this.inventoryIdValue=Xe.value,i(),e()},r=e=>{i();const n=e.getError();t(new Ce(n.getMessage(),{type:ve,code:n.getErrorCode()}))};this.adsManager.addEventListener(Lo.adUnit.AdEvent.Type.IMPRESSION,n),this.adsManager.addEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,r)}))}initAd(e,t,i,n,r,s){if(!Lo.isIMALoaded())throw new Ce(ne.IMA_SDK_NOT_LOADED,{type:pe});Lo.prepareImaContainerSlot(),this.width=e,this.height=t;let a={};try{a=JSON.parse(r.AdParameters)}catch(e){throw Ks.error("AdParameters failed to parse:",r.AdParameters),new Ce(ne.FAILED_TO_PARSE_AD_PARAMS,{type:Le})}const o=new Promise(((e,t)=>{const i=()=>{Lo.adsLoader.removeEventListener(Lo.adUnit.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,n),Lo.adsLoader.removeEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,r)},n=t=>{const n=new Lo.adUnit.AdsRenderingSettings;n.restoreCustomPlaybackStateOnAdBreakComplete=!1,n.loadVideoTimeout=wi(),n.disableUi=!0,n.useStyledNonLinearAds=!0,this.adsManager=t.getAdsManager(Lo.videoSlot,n),this.initAdPromise=this.initAdsManagerHelper(),this.startAdPromise=this.startAdsManagerHelper(),i(),e()},r=e=>{const n=e.getError();i(),t(new Ce(n.getMessage(),{type:pe,code:n.getErrorCode()}))};Lo.adsLoader.addEventListener(Lo.adUnit.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,n),Lo.adsLoader.addEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,r);const s=new Lo.adUnit.AdsRequest;s.vastLoadTimeout=wi(),this._shouldSetPageUrl()&&(s.pageUrl=N().getEmbedder()),S("PV5_DVA_PROXY")&&a.vast?s.adsResponse=a.vast:s.adTagUrl=a.url,s.linearAdSlotWidth=this.width,s.linearAdSlotHeight=this.height,S("PV5_IMA_REQUEST_MUTED")&&s.setAdWillPlayMuted(w().muted),Ze.position===Ne.ev.MIDROLL&&(s.nonLinearAdSlotWidth=this.width,s.nonLinearAdSlotHeight=.2*this.height),Ks.log("Requesting ad to IMA with adsRequest",s),S("PV5_ENABLE_IMA_OMSDK")&&(s.omidAccessModeRules={},s.omidAccessModeRules[Lo.adUnit.OmidVerificationVendor.OTHER]=Lo.adUnit.OmidAccessMode.FULL),Lo.adsLoader.requestAds(s),Bs({action:Us,component:"IMA"})})).then((()=>(Ks.log("adsManager loaded"),this.adsManager.init(this.width,this.height,Lo.adUnit.ViewMode.NORMAL,Lo.videoSlot),this.adsManager.start(),this.initAdPromise)));return Yi(li,o).then((e=>{Jt(),this.publish(Ne.k3.LOADED);const t=null==e?void 0:e.getAd(),i=null==t?void 0:t.getContentType();return this.mediaFile={height:null==t?void 0:t.getVastMediaHeight(),width:null==t?void 0:t.getVastMediaWidth(),mimeType:i},{adType:Ne.VS.Aq.includes(i)?"audio":"video",adSlot:Lo.getImaContainerSlot()}})).catch((e=>{throw this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}startAd(){const e=this.adsManager.getCurrentAd();return this._bindListeners(),e.isLinear()&&this.publish(Ne.k3.DURATION_CHANGE),this._startNextAd()}_startNextAd(){return Yi(ci,this._startAd()).catch((e=>{throw this._unbindListeners(),this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}_startAd(){return this.startAdPromise.then((()=>{const e=this.adsManager.getCurrentAd();this._addBoundedEventListener(Lo.adUnit.AdErrorEvent.Type.AD_ERROR,(t=>{const i=t.getError(),n=new Ce(i.getMessage(),{code:i.getErrorCode(),type:ve});this.publish(Ne.k3.POD_ERROR,n),this._endVideoAd(e)})),this.publish(Ne.k3.STARTED,xs(e,Ne.Z4.Hs)),this.vastTracker.trackURLs(this.vastTracker.ad.impressionURLTemplates,Rn()),this.publish(Ne.k3.IMPRESSION),this._lastMutedState=this.getAdVolume().muted}))}_isLastAdFromPod(e){if(e)return this._getPodTotalAdsForAd(e)===this._getAdPodIndexForAd(e)}_getAdPodIndexForAd(e){if(e)return e.getAdPodInfo().getAdPosition()}_getPodTotalAdsForAd(e){if(e)return e.getAdPodInfo().getTotalAds()}getAdPodInfo(){const e=this.adsManager.getCurrentAd();if(!e)return;const t=this._getAdPodIndexForAd(e),i=this._getPodTotalAdsForAd(e);return{adPodIndex:t,adPodTotalAds:i,isAdPod:i>1}}stopAd(){const e=this.adsManager.getCurrentAd();if(e&&!e.isLinear()){let e=this.overlayViewDurationTimestamp?Date.now()-this.overlayViewDurationTimestamp:0;e=this.vastTracker.convertToTimecode(e/1e3),this.vastTracker.overlayViewDuration(e,Rn())}return this._unbindListeners(),this.adsManager&&this.adsManager.stop(),this._clean(),Promise.resolve()}skipAd(){return this.adsManager.skip(),new Promise((()=>{}))}pauseAd(){this.adsManager.pause()}resumeAd(){this.adsManager.resume()}resizeAd(e,t,i){if(!this.adsManager)return;const n=this.adsManager.getCurrentAd();if(n&&!n.isLinear()&&n.getHeight()>.2*A.height){const e=new Ce(ne.NON_LINEAR_DIMENSIONS,{type:Re,code:Ne.Uk.Bp});this.publish(Ne.k3.ERROR,e),this.stopAd()}this.adsManager.resize(e,t,i),Hs({previousViewMode:this._viewMode,viewMode:i,vastTracker:this.vastTracker}),this._viewMode=i}clicked(){this.adsManager.clicked()}getAdRemainingTime(){return this.adsManager.getRemainingTime()}getAdDuration(){const e=this.adsManager.getCurrentAd();return(null==e?void 0:e.getDuration())||0}getAdVolume(){const e=this.adsManager.getVolume();return{volume:e,muted:0===e}}setAdVolume(e,t){e>=0&&(this.adVolume=e),this.adMuted=t,(this.adMuted||this.adVolume>=0)&&this.adsManager.setVolume(this.adMuted?0:this.adVolume)}getAdSkippableState(){return this.adsManager.getAdSkippableState()}getAdSkippableRemainingTime(){const e=this.adsManager.getCurrentAd();return e.getSkipTimeOffset()-(e.getDuration()-this.adsManager.getRemainingTime())}isSkipEnabled(){return!1}getNonLinearHeight(){var e;const t=null==(e=this.adsManager)?void 0:e.getCurrentAd();return(null==t?void 0:t.getHeight())||0}_onLoaded(){this.setAdVolume(this.adVolume,this.adMuted)}_onPaused(){this.vastTracker.track("pause",{macros:Rn()}),this.publish(Ne.k3.PAUSED),ee.dispatchEvent(te.AD_PAUSED)}_onResumed(){this.vastTracker.track("resume",{macros:Rn()}),this.publish(Ne.k3.PLAYING),ee.dispatchEvent(te.AD_PLAYING)}_onClick(){this.vastTracker.click(null,Rn()),this.publish(Ne.k3.CLICK_THRU)}_onDurationChange(){this.publish(Ne.k3.DURATION_CHANGE)}_onAdProgress(e){var t;this.publish(Ne.k3.REMAINING_TIME_CHANGE),this.vastTracker.setProgress(null==e||null==e.getAdData||null==(t=e.getAdData())?void 0:t.currentTime,Rn())}_onVolumeChange(){const e=this.getAdVolume().muted;e&&!this._lastMutedState&&this.vastTracker.track("mute",{macros:Rn()}),!e&&this._lastMutedState&&this.vastTracker.track("unmute",{macros:Rn()}),this._lastMutedState=e,this.publish(Ne.k3.VOLUME_CHANGE)}_onStarted(e){const t=e.getAd();this._lastAdEndedReason=null,S("PV5_IMA_COMPANION_AD")&&this._handleCompanionAds(t),S("PV5_ADSENSE_DISPLAY_PREROLL")&&this._isAdSenseDisplayPreroll(t)&&ee.dispatchEvent(te.AD_NON_LINEAR_DISPLAY_STARTED),this.vastTracker.track("creativeView",{macros:Rn()}),t.isLinear()&&(this.vastTracker.track("start",{macros:Rn(),once:!0}),this._startVideoAd(),this.publish(Ne.k3.VIDEO_START))}_onFirstQuartile(){this.vastTracker.track("firstQuartile",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_FIRST_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_FIRST_QUARTILE)}_onMidpoint(){this.vastTracker.track("midpoint",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_MIDPOINT),ee.dispatchEvent(te.AD_VIDEO_MIDPOINT)}_onThirdQuartile(){this.vastTracker.track("thirdQuartile",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_THIRD_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_THIRD_QUARTILE)}_onSkipped(e){const t=e.getAd();this.vastTracker.track("skip",{macros:Rn()}),this._lastAdEndedReason=Ne.Bj.SKIPPED,this.publish(Ne.k3.VIDEO_COMPLETE,{endedReason:Ne.Bj.SKIPPED}),this._endVideoAd(t)}_onUserClose(){Ks.log("User has closed the non linear");const e=Rn();this.vastTracker.close(e),this.vastTracker.skip(e),this.publish(Ne.k3.USER_CLOSE),this.publish(Ne.k3.STOPPED,{reason:Ne.Bj.CLOSED}),this.stopAd()}_onVideoCompleted(e){const t=e.getAd();this.vastTracker.track("complete",{macros:Rn()}),this.publish(Ne.k3.VIDEO_COMPLETE,{endedReason:Ne.Bj.COMPLETED}),this._endVideoAd(t)}_onContentResumeRequested(e){const t=e.getAd(),i=S("PV5_ADSENSE_DISPLAY_PREROLL")&&this._isAdSenseDisplayPreroll(t);yi(Ys,500,(()=>{i?this._onAllAdsCompleted():(this._clean(),this.publish(Ne.k3.ERROR,new Ce(ne.IMA_SDK_INCORRECT_TAG,{type:Re})))}))}_onAllAdsCompleted(){Oi(Ys),this._clean(),this.publish(Ne.k3.STOPPED,{...this._lastAdEndedReason&&{reason:this._lastAdEndedReason}})}_onAdLog(e){const t=e.getAdData();(null==t?void 0:t.adError)&&this.publish(Ne.k3.LOG,{...Ne.r0.IMA_RECOVERABLE_AD_ERROR,value:t.adError.getMessage()})}_isAdSenseDisplay(e){const t=e.getAdSystem()===Ne.z0,i=Ne.VS.xU.includes(e.getContentType()),n=e.getDuration()>e.getMinSuggestedDuration();return t&&i&&n}_isAdSenseDisplayPreroll(e){return this._isAdSenseDisplay(e)&&"preroll"===Ze.position}_shouldSetPageUrl(){return!(O()||(!S("PV5_TEMP_IMA_PAGEURL")||!N().isOnsite())&&(!S("PV5_TEMP_IMA_PAGEURL_OFFSITE")||N().isOnsite()))}_onAdsManagerLoaded(e,t,i){const n=e.getAd();this.vastTracker.load(Rn());const r=this._isAdSenseDisplay(n),s=Ze.position===Ne.ev.PREROLL,a=Ze.position===Ne.ev.MIDROLL,o=r&&!s||!S("PV5_ADSENSE_DISPLAY_PREROLL")&&r&&s;if(!n.isLinear()&&!a||!S("PV5_IMA_OVERLAY")&&!n.isLinear()&&a||o)return i(new Ce(ne.NO_SUPPORTED_CREATIVE,{type:pe}));t(e)}_setNonLinearDurationTimeout(e){const t=this._getNonLinearDuration(1e3*e);setTimeout((()=>{this.inventoryIdValue===Xe.value&&(this.publish(Ne.k3.STOPPED,{reason:Ne.Bj.COMPLETED}),this.stopAd())}),t)}_getNonLinearDuration(e){return e<1e4?1e4:e>3e4?3e4:e}_handleCompanionAds(e){const t=Lo.adUnit.CompanionAdSelectionSettings;let i=new t;i.resourceType=t.ResourceType.ALL,i.creativeType=t.CreativeType.ALL,i.sizeCriteria=t.SizeCriteria.IGNORE;let n=e.getCompanionAds(null,null,i);0!==n.length&&(n=[{apiFramework:"IMA",type:"companion",variations:n.map((e=>({adSlotId:e.getAdSlotId(),width:e.getWidth().toString(),height:e.getHeight().toString(),content:e.getContent()})))}],ee.dispatchEvent(te.AD_COMPANIONS_RECEIVED,{companionAds:n}))}}const Qs=T("AdStackDM","VAST","ElementShield");class $s{constructor(){let{element:e,logCallback:t,hasInitProtection:i,initProtectionSuccessCb:n,initProtectionFailCb:r,adPosition:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Qs.log("Creating ElementShield for",e),this.element=e,this.adPosition=s,this.eventHandlers={},this.logCallback=t,this.hasInitProtection=i,this.initProtectionCallback=this._getProxyInitProtectionCallback(n,r),this.loggedActions=[],this.storedAttributes={},this.storedChildNodes=[],this.hasInitProtection||this._storeState()}_getProxyInitProtectionCallback(e,t){let i=!1;return n=>{let{action:r,name:s,value:a}=n;return!(!i&&("setProperty"===r&&("src"===s||"type"===s)||"setAttribute"===r&&("src"===s||"type"===s)||"removeAttribute"===r&&("src"===s||"type"===s)||"appendChild"===r||"insertBefore"===r?(Qs.log("initProtectionCallback: WILL_START",r,s,a),e(),i=!0,0):this.adPosition===Ne.ev.MIDROLL&&"load"===r&&!i&&S("PV5_IGNORE_EARLY_LOAD_MIDROLL")?(Qs.log("initProtectionCallback: ignoring",r,s,a),this.log({action:"silencedMethod",name:"load",value:null}),1):(Qs.log("initProtectionCallback: rejecting",r,s,a),t(`proxy restriction: ${r}(${s}, ${a})`),1)))}}start(){this.hasInitProtection&&this._storeState(),this.hasStarted=!0}checkInitProtection(){let{action:e,name:t="",value:i="",defaultHandler:n,isSilent:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.hasStarted)return n();{if(r)return;const s={[Ne.ev.POSTROLL]:S("PV5_PROXY_LOAD_POSTROLL")?["load"]:[]};if(!this.hasInitProtection||s[this.adPosition]&&~s[this.adPosition].indexOf(e))return n();if(this.initProtectionCallback({action:e,name:t,value:i}))return n()}}saveEventHandler(e,t){this.eventHandlers[e]=t}log(){let{action:e,name:t="",value:i=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Qs.log("shielded",e,t,i);const n=[e,t].join("|");this.loggedActions.indexOf(n)>-1||(this.loggedActions.push(n),this.logCallback({...Ne.r0.ELEMENT_SHIELD,action:e,name:t,value:i,step:this.hasStarted?"startAd":"initAd"}))}_storeState(){for(let e=0;e<this.element.attributes.length;e++)this.storedAttributes[this.element.attributes[e].nodeName]=this.element.attributes[e].nodeValue;this.storedChildNodes=Array.from(this.element.childNodes)}_removeEventHandlers(){for(const e in this.eventHandlers)this.element.removeEventListener(e,this.eventHandlers[e]),delete this.eventHandlers[e]}_restore(){this.element.currentTime&&this.adPosition===Ne.ev.PREROLL&&(this.element.currentTime=0);for(let e=this.element.attributes.length;e--;){const t=this.element.attributes[e].nodeName,i=this.element.attributes[e].nodeValue;Object.prototype.hasOwnProperty.call(this.storedAttributes,t)?this.storedAttributes[t]!==i?(this.element.setAttribute(t,this.storedAttributes[t]),delete this.storedAttributes[t]):delete this.storedAttributes[t]:this.element.removeAttribute(t)}for(const e in this.storedAttributes)this.element.setAttribute(e,this.storedAttributes[e]),delete this.storedAttributes[e];for(let e=this.element.childNodes.length;e--;){const t=this.element.childNodes[e];-1===this.storedChildNodes.indexOf(t)&&this.element.removeChild(t)}this.storedChildNodes.forEach((e=>{this.element.appendChild(e)})),this.storedChildNodes=[]}destroy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};Qs.log("destroy"),this._removeEventHandlers(),!this.hasStarted&&this.hasInitProtection||(e(),this._restore(),t()),this.element=null,this.loggedActions=[]}}const js=e=>new $s(e),qs=T("VAST","AryaProxy"),Ws=["autoplay","class","controls","draggable","id","muted","poster","preload","playsinline","webkit-playsinline"],zs=["id","scrollTop","scrollLeft","outerHTML","draggable","preload","defaultPlaybackRate","autoplay","loop","controls","defaultMuted","poster","className","width","height"],Xs=[{name:"hidden"},{name:"innerHTML"},{name:"src"},{name:"type"},{name:"crossOrigin"},{name:"currentTime"},{name:"playbackRate"},{name:"volume",exception:(e,t)=>0===e&&t.muted},{name:"muted"},{name:"nodeValue"}],Zs=["insertBefore","appendChild","replaceChild","play","pause","addTextTrack","load"],Js=["height","width","style"],ea=["addEventListener","setAttribute","removeAttribute","requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],ta=(e=>{const t=[e];let i=Object.getPrototypeOf(e);for(;i;)t.push(i),i=Object.getPrototypeOf(i);return t})(HTMLVideoElement.prototype);class ia{constructor(){let{videoSlot:e,logCallback:t,hasInitProtection:i,initProtectionSuccessCb:n,initProtectionFailCb:r,adPosition:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._videoSlot=e,this._aryaSlot=document.createElement("div"),this._aryaSlot.id="dmp_Arya",this._aryaSlot.style.width=this._aryaSlot.style.height="100%",this._aryaSlot.style.position="absolute",this._aryaSlot.style.pointerEvents="none",this._videoSlot.parentElement.insertBefore(this._aryaSlot,this._videoSlot.nextSibling),this._mockedStyle=document.createElement("div").style,this._elementShield=js({element:e,logCallback:t,hasInitProtection:i,initProtectionSuccessCb:n,initProtectionFailCb:r,adPosition:s}),ta.forEach((e=>{this.createPropertiesAndMethods(e)}))}createPropertiesAndMethods(e){var t=this;Object.getOwnPropertyNames(e).forEach((i=>{const n=Object.getOwnPropertyDescriptor(e,i);if("constructor"!==i&&n.configurable){if("function"==typeof n.get)if(S("PV5_ENABLE_ARYA_PROXY_STRICT_STYLES")&&"style"===i)n.get=()=>this._customBehaviourForStyle();else{if("classList"===i)return this._customBehaviourForClasslist();n.get=()=>this.proxifyGetter(this._videoSlot,i)}if("function"==typeof n.set)if(zs.indexOf(i)>-1)n.set=e=>{this._elementShield.log({action:"setProperty",name:i,value:e})};else{const e=Xs.filter((e=>e.name===i))[0];n.set=e?t=>{this.initProtectionForSetter(i,t,e.exception)}:e=>{this.proxifySetter(this._videoSlot,i,e)}}"function"==typeof n.value&&(Zs.indexOf(i)>-1?n.value=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.initProtectionForMethod(i,...n)}:ea.indexOf(i)>-1?n.value=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.customBehaviourForMethod(i,...n)}:n.value=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.proxifyMethod(t._videoSlot,i,...n)}),Object.defineProperty(this._aryaSlot,i,n)}}))}proxifyGetter(e,t){return null!==e?e[t]:null}proxifySetter(e,t,i){null!==e&&(e[t]=i)}proxifyMethod(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return null!==e?e[t](...n):null}getNameAndValueForMethod(e){let t,i;for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return"setAttribute"===e||"removeAttribute"===e?[t="",i=""]=r:"appendChild"===e||"insertBefore"===e?[t,i]=r.map((e=>e?e.nodeName.toLowerCase():"")):(t="",i=""),{name:t,value:i}}initProtectionForSetter(e,t,i){const n=this._videoSlot&&this._videoSlot[e]==t,r=this._videoSlot&&i&&i(t,this._videoSlot),s=n||r;this._elementShield.checkInitProtection({action:"setProperty",name:e,defaultHandler:()=>{this._elementShield.log({action:"setProperty",name:e,value:t}),this.proxifySetter(this._videoSlot,e,t)},isSilent:s})}initProtectionForMethod(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];const{name:r,value:s}=this.getNameAndValueForMethod(e,...i);return this._elementShield.checkInitProtection({action:e,name:r,value:s,defaultHandler:()=>(""!==r&&this._elementShield.log({action:e,name:r,value:s}),this.proxifyMethod(this._videoSlot,e,...i))})}_customBehaviourForStyle(){return this._elementShield.hasStarted?this.proxifyGetter(this._videoSlot,"style"):this._mockedStyle}_customBehaviourForClasslist(){var e=this;const t=["add","remove","toggle","replace"],i=DOMTokenList.prototype;Object.getOwnPropertyNames(i).forEach((n=>{const r=Object.getOwnPropertyDescriptor(i,n);"constructor"!==n&&r.configurable&&("function"==typeof r.get&&(r.get=()=>this._videoSlot?this.proxifyGetter(this._videoSlot.classList,n):null),"function"==typeof r.set&&(r.set=e=>{this._elementShield.log({action:"setProperty",name:"classList",value:e})}),"function"==typeof r.value&&(t.includes(n)?r.value=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];e._elementShield.log({action:"silencedMethod",name:`classList.${n}`,value:i.join(",")})}:r.value=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return e._videoSlot?e.proxifyMethod(e._videoSlot.classList,n,...i):null}),Object.defineProperty(this._aryaSlot.classList,n,r))}))}customBehaviourForMethod(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];switch(e){case"setAttribute":case"removeAttribute":return Ws.indexOf(i[0])>-1||Js.indexOf(i[0])>-1&&!this._elementShield.hasStarted?this._elementShield.log({action:e,name:i[0],value:i[1]?i[1]:""}):this.initProtectionForMethod(e,...i);case"addEventListener":if(this._videoSlot)return this._elementShield.saveEventHandler(...i),this._videoSlot.addEventListener(...i);break;case"requestFullscreen":case"webkitRequestFullScreen":case"mozRequestFullScreen":case"msRequestFullscreen":this._elementShield.log({action:"silencedMethod",name:"requestFullscreen",value:e})}}start(){this._elementShield.start()}destroy(){if(this._elementShield&&this._elementShield.destroy((()=>{this._videoSlot.pause()}),(()=>{this._videoSlot.load()})),this._videoSlot&&this._aryaSlot){try{this._videoSlot.parentElement.removeChild(this._aryaSlot)}catch(e){qs.log("Error while removing Arya slot",e)}this._aryaSlot=null,this._videoSlot=null}}}const na=e=>new ia(e),ra=(e,t,i)=>function(){try{for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return e.apply(this,r)}catch(e){"function"==typeof i&&i(e,"execution",t)}},sa=T("AdStackDM","VAST","VPAID");class aa extends J{constructor(){super(),this._handlerStack={},this._bindedVPAIDAdUnitHandlers={},this.vpaidAdUnit=null,this._previousRemainingTime=-2,this._adRemainingTimeChangeLogSent=!1,this._handshakeVersion=null,this.eventMapping={[Ne.L0.e7]:this._onClickThru,[Ne.L0.aH]:this._onDurationChange,[Ne.L0.pn]:this._onError,[Ne.L0.zD]:this._onExpandedChange,[Ne.L0.nt]:this._onImpression,[Ne.L0.b1]:this._onInteraction,[Ne.L0.dU]:this._onLinearChange,[Ne.L0.sY]:this._onLog,[Ne.L0.rf]:this._onPaused,[Ne.L0.Z$]:this._onPlaying,[Ne.L0.gx]:this._onRemainingTimeChange,[Ne.L0.DA]:this._onSizeChange,[Ne.L0.of]:this._onSkippableStateChange,[Ne.L0.kb]:this._onSkipped,[Ne.L0.il]:this._onStopped,[Ne.L0.q2]:this._onUserAcceptInvitation,[Ne.L0.g_]:this._onUserClose,[Ne.L0.LL]:this._onUserMinimize,[Ne.L0.Om]:this._onVideoStart,[Ne.L0.VQ]:this._onVideoFirstQuartile,[Ne.L0.ck]:this._onVideoMidpoint,[Ne.L0.sk]:this._onVideoThirdQuartile,[Ne.L0.rp]:this._onVideoComplete,[Ne.L0.Y7]:this._onVolumeChange}}_subscribeVPAIDAdUnit(e,t){this._handlerStack[t]||(this._handlerStack[t]=[],this._bindedVPAIDAdUnitHandlers[t]=this._onVPAIDAdUnitEvent.bind(this,t),this.vpaidAdUnit.subscribe(this._bindedVPAIDAdUnitHandlers[t],t)),this._handlerStack[t].push(e)}_unsubscribeVPAIDAdUnit(e,t){this._handlerStack[t]&&(this._handlerStack[t]=this._handlerStack[t].filter((t=>t!==e)),this._handlerStack[t].length||(this._handlerStack[t]=null,this.vpaidAdUnit.unsubscribe(this._bindedVPAIDAdUnitHandlers[t],t)))}_onVPAIDAdUnitEvent(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];this._handlerStack[e]&&(Nr(e,{args:i,isVpaid:!0}),this._handlerStack[e].forEach((e=>{e.bind(this)(...i)})))}_jsonStringifyReplacer=(e,t)=>t instanceof HTMLElement?t.id||"":t;_logMethodCallForExternalLogs(e){const t={isMethodCall:!0,isVpaid:!0};for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(n.length){const e=[];n.forEach((t=>{if("object"!=typeof t)e.push(t);else try{e.push(JSON.stringify(t,this._jsonStringifyReplacer))}catch(e){sa.log(e)}})),t.args=e.join(", ")}Nr(e,t)}_bindListeners(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.vpaidAdUnit){sa.log("Binding VPAID listeners");for(const t in this.eventMapping)-1===e.indexOf(t)&&this._subscribeVPAIDAdUnit(this.eventMapping[t],t,this)}}_unbindListeners(){if(this.vpaidAdUnit){sa.log("Unbinding VPAID listeners");for(const e in this.eventMapping)this._unsubscribeVPAIDAdUnit(this.eventMapping[e],e);this._skipHandler.unbindSkipCountdown(),clearInterval(this._remainingTimeHandlerID),this._remainingTimeHandlerID=null}}handshakeVersion(e){return this._logMethodCallForExternalLogs("handshakeVersion",e),this._handshakeVersion=this.vpaidAdUnit.handshakeVersion(e),this.publish(Ne.k3.LOG,{...Ne.r0.VPAID_VERSION_SUPPORT,name:"handshakeVersion",value:this._handshakeVersion}),this._handshakeVersion}initAd(e,t,i,n,r,s){this._logMethodCallForExternalLogs("initAd",e,t,i,n,r,s),this.vpaidAdUnit.initAd(e,t,i,n,r,s)}resizeAd(e,t,i){this._logMethodCallForExternalLogs("resizeAd",e,t,i),this.vpaidAdUnit.resizeAd(e,t,i)}startAd(){this._logMethodCallForExternalLogs("startAd"),this.vpaidAdUnit.startAd()}stopAd(){this._logMethodCallForExternalLogs("stopAd"),this.vpaidAdUnit.stopAd()}pauseAd(){this._logMethodCallForExternalLogs("pauseAd"),this.vpaidAdUnit.pauseAd()}resumeAd(){this._logMethodCallForExternalLogs("resumeAd"),this.vpaidAdUnit.resumeAd()}expandAd(){this._logMethodCallForExternalLogs("expandAd"),this.vpaidAdUnit.expandAd()}collapseAd(){this._logMethodCallForExternalLogs("collapseAd"),this.vpaidAdUnit.collapseAd()}skipAd(){this._logMethodCallForExternalLogs("skipAd"),this.vpaidAdUnit.skipAd()}getAdDuration(){return this.vpaidAdUnit?this.vpaidAdUnit.getAdDuration():-2}getAdExpanded(){return this.vpaidAdUnit.getAdExpanded()}getAdHeight(){return this.vpaidAdUnit.getAdHeight()}getAdLinear(){return this.vpaidAdUnit.getAdLinear()}getAdRemainingTime(){let e=this.vpaidAdUnit.getAdRemainingTime();return-2===this._previousRemainingTime&&e<=0||-2!==this._previousRemainingTime&&this._previousRemainingTime<e?e=this._previousRemainingTime:this._previousRemainingTime=e,e}getAdSkippableState(){return this.vpaidAdUnit.getAdSkippableState()}getAdVolume(){return this.vpaidAdUnit?this.vpaidAdUnit.getAdVolume():-1}setAdVolume(e){this._logMethodCallForExternalLogs("setAdVolume",e);try{this.vpaidAdUnit.setAdVolume(e)}catch(e){sa.log("Silenced error",e)}}getAdWidth(){return this.vpaidAdUnit.getAdWidth()}_onStopped(){this.publish(Ne.k3.STOPPED)}_onSkipped(){this.publish(Ne.k3.SKIPPED)}_onSkippableStateChange(){this.publish(Ne.k3.SKIPPABLE_STATE_CHANGE)}_onSizeChange(){this.publish(Ne.k3.SIZE_CHANGE)}_onLinearChange(){this.publish(Ne.k3.LINEAR_CHANGE)}_onDurationChange(){this.publish(Ne.k3.DURATION_CHANGE)}_onExpandedChange(){this.publish(Ne.k3.EXPANDED_CHANGE)}_onRemainingTimeChange(){this._adRemainingTimeChangeLogSent||(this._adRemainingTimeChangeLogSent=!0,this.publish(Ne.k3.LOG,{...Ne.r0.VPAID_VERSION_SUPPORT,name:"deprecatedEvent",value:"AdRemainingTimeChange"})),this.publish(Ne.k3.REMAINING_TIME_CHANGE)}_onVolumeChange(){this.publish(Ne.k3.VOLUME_CHANGE)}_onImpression(){this.publish(Ne.k3.IMPRESSION)}_onVideoStart(){this.publish(Ne.k3.VIDEO_START)}_onVideoFirstQuartile(){this.publish(Ne.k3.VIDEO_FIRST_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_FIRST_QUARTILE)}_onVideoMidpoint(){this.publish(Ne.k3.VIDEO_MIDPOINT),ee.dispatchEvent(te.AD_VIDEO_MIDPOINT)}_onVideoThirdQuartile(){this.publish(Ne.k3.VIDEO_THIRD_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_THIRD_QUARTILE)}_onVideoComplete(){this.publish(Ne.k3.VIDEO_COMPLETE)}_onClickThru(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.publish(Ne.k3.CLICK_THRU,...t)}_onInteraction(){this.publish(Ne.k3.INTERACTION)}_onUserAcceptInvitation(){this.publish(Ne.k3.USER_ACCEPT)}_onUserMinimize(){this.publish(Ne.k3.USER_MINIMIZE)}_onUserClose(){this.publish(Ne.k3.USER_CLOSE)}_onPaused(){this.publish(Ne.k3.PAUSED),ee.dispatchEvent(te.AD_PAUSED)}_onPlaying(){this.publish(Ne.k3.PLAYING),ee.dispatchEvent(te.AD_PLAYING)}_onLog(e){this.publish(Ne.k3.LOG,{log:e,isTriggeredByVpaid:!0})}_onError(e){this.publish(Ne.k3.ERROR,e)}}const oa=T("VPAIDIntegrator");class da extends aa{constructor(){let{mediaFiles:e,vastTracker:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._hasLoaded=!1,this._hasStarted=!1,this._hasImpressed=!1,this._remainingTimeHandlerID=null,this._adDurationHandlerID=null,this._remainingTimeValue=null,this.vpaidFrame=null,this.videoProxy=null,this.videoWrapper=null,this.slot=null,this.mediaFiles=e,this.vastTracker=t,this._skipHandler=new Pr(t,this.publish,this),this._viewMode=null,this._internalVolume=null,this._lastVpaidVolume=null,this._vpaidError=null}_cleanSlot(){this.slot&&(this.slot.parentNode.removeChild(this.slot),this.slot=null)}_createBufferListener(){this.videoSlot&&(this.videoSlot.addEventListener("waiting",this._onVideoTagWaiting),this.videoSlot.addEventListener("playing",this._onVideoTagPlaying))}_removeBufferListener(){this.videoSlot&&(this.videoSlot.removeEventListener("waiting",this._onVideoTagWaiting),this.videoSlot.removeEventListener("playing",this._onVideoTagPlaying))}_cleanIframe(){this.vpaidFrame&&(this.vpaidFrame.parentNode.removeChild(this.vpaidFrame),this.vpaidFrame=null)}_cleanVideoShield(){null!==this.videoProxy&&(this.videoProxy.destroy(),this.videoProxy=null)}_clean(){oa.log("Cleaning Iframe/VideoShield/Slot"),this._removeBufferListener(),this._cleanSlot(),this._cleanIframe(),this._cleanVideoShield(),clearInterval(this._adDurationHandlerID),clearInterval(this._remainingTimeHandlerID),this._remainingTimeHandlerID=null,this._adDurationHandlerID=null}_validateErrorFormat(e){return"string"!=typeof e?(oa.warn("Invalid format for VPAID Error :",e),e=ne.INVALID_FORMAT_VPAID_ERROR):e=`Error received from VPAID : ${e}`,e}_shouldStopAd(e){return~[pe,_e,ve,Ae,me,ge].indexOf(e)}_resolveStepOnVPAIDEvents(e,t,i){const n=(e=>{switch(e){case di:return he;case li:return pe;case ci:return ve;case hi:return Re;case Ei:return De}})(e);return new Promise(((e,r)=>{const s=()=>{t.forEach((e=>{this._unsubscribeVPAIDAdUnit(a,e)})),this._unsubscribeVPAIDAdUnit(o,Ne.k3.ERROR)},a=()=>{s(),e()},o=e=>{s(),r(new Ce(this._validateErrorFormat(e),{type:n}))};t.forEach((e=>{this._subscribeVPAIDAdUnit(a,e)})),this._subscribeVPAIDAdUnit(o,Ne.L0.pn);try{i(a,o)}catch(e){r(new Ce(e.message,{type:n}))}}))}handleTimeout(e,t){return Yi(e,t).catch((e=>{const t=_i(e,{vpaidRuntimeError:this._vpaidError});if(this._shouldStopAd(t.type))return this.stopAd({silent:!0}).finally((()=>{throw t}));throw t}))}getVpaidAdUnit(){return this.vpaidFrame.contentWindow.getVPAIDAd()}getMediaFileSrc(){return this.mediaFile.fileURL}async loadVpaidScript(e){this.videoSlot=e,oa.log("Loading AdUnit"),this.mediaFile=this.mediaFiles[0];const t={id:"vpaid_frame",siblingNode:this.videoSlot,url:this.getMediaFileSrc()};try{this.vpaidFrame=await Do(t),this.vpaidFrame.className="ad_slot";const e=this.getVpaidAdUnit();this.vpaidAdUnit=this.silenceVpaidErrors(e),this.handshakeVersion("2.0"),this.slot=this.vpaidFrame.contentWindow.document.createElement("div"),this.slot.className="ad_slot",this.slot.style.height="100%",this.vpaidFrame.contentWindow.document.body.appendChild(this.slot)}catch(e){throw oa.error("Load vpaid ad unit failed: ",e),new Ce(ne.VPAID_SDK_REQUEST_FAILED,{type:pe})}}createAryaProxy(e,t){const{videoSlot:i,proxyInitProtection:n,position:r}=e;this.videoProxy=na({logCallback:e=>{this.publish(Ne.k3.LOG,e)},videoSlot:i,hasInitProtection:n,initProtectionSuccessCb:()=>this.publish(Ne.k3.WILL_START),initProtectionFailCb:t,adPosition:r}),e.videoSlot=this.videoProxy._aryaSlot,delete e.proxyInitProtection}initAd(e,t,i,n,r,s){const a=(a,o)=>{s.slot=this.slot,this.createAryaProxy(s,o),this._bindListeners([Ne.L0.of]),oa.log("Initializing AdUnit"),super.initAd(e,t,i,n,r,s),Bs({action:Us,component:"VPAID"}),this.setAdVolume(s.volume.volume,s.volume.muted)};return this.handleTimeout(li,this.loadVpaidScript(s.videoSlot).then((()=>this._resolveStepOnVPAIDEvents(li,[Ne.L0.tE],a)))).then((()=>(this._hasLoaded=!0,this.publish(Ne.k3.LOADED),this.vastTracker.load(Rn()),{adSlot:this.vpaidFrame}))).catch((e=>{throw this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}startAd(){return this.handleTimeout(ci,this._resolveStepOnVPAIDEvents(ci,[Ne.L0.Hw,Ne.L0.nt,Ne.L0.Om],(()=>{this.videoProxy&&this.videoProxy.start(),this._createBufferListener(),oa.log("Starting AdUnit"),super.startAd()}))).then((()=>{this.vastTracker.track("creativeView",{once:!0,macros:Rn()}),this._hasStarted=!0,this.publish(Ne.k3.STARTED,xs(this.vastTracker.ad,"VPAIDIntegrator")),this._handleDurationChange()})).catch((e=>{throw this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}stopAd(){let{silent:e=!1,logs:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._unbindListeners(),this.handleTimeout(hi,this._resolveStepOnVPAIDEvents(hi,[Ne.L0.il],(()=>{oa.log("Stopping AdUnit"),super.stopAd()}))).catch((()=>{})).then((()=>(this._clean(),e||this.publish(Ne.k3.STOPPED),t)))}skipAd(){const e=this.getAdDuration()>0?this._getAdCurrentTime():null,t=this._skipHandler.getSkipLogs(e);return this.vpaidAdUnit.skipAd?this.vpaidAdUnit.getAdSkippableState()?(this._unbindListeners(),this.handleTimeout(Ei,this._resolveStepOnVPAIDEvents(Ei,[Ne.L0.kb],(()=>{oa.log("Skipping AdUnit"),this.vastTracker.track("skip",{once:!0,macros:Rn()}),super.skipAd()}))).then((()=>{this._clean(),this.publish(Ne.k3.SKIPPED)})).catch((e=>{throw this._clean(),this.publish(Ne.k3.ERROR,e),e}))):this._skipHandler.isSkipEnabled()&&this.vastTracker.skippable?this.forceSkipAd(t):new Promise((()=>{})):this.forceSkipAd(t)}isSkipEnabled(){return this._skipHandler.isSkipEnabled()||this.vpaidAdUnit.getAdSkippableState()}silenceVpaidErrors(e){return((e,t)=>{null==e._wrapped&&(e._wrapped=[]);const i=["constructor","startAd","initAd"];for(const n in e)try{const r=e[n];if(i.includes(n))continue;if(null==e._wrapped[n]&&(e._wrapped[n]=[]),"function"!=typeof r||e._wrapped[n].includes("safe"))continue;e[n]=ra(r,n,t),e._wrapped[n].push("safe")}catch(e){t(e,"wrapping",n)}return e})(e,((e,t,i)=>{const n="wrapping"===t?`Vpaid object wrapper: Error while wrapping property ${i}: `:`Silenced vpaid error: Error catched with method ${i}: `;this._vpaidError=e.stack?JSON.stringify(e.stack).slice(0,1e3):e.message,Nr(n,{message:e.message,isVpaid:!0}),oa.error(n,e),this.publish(Ne.k3.LOG,{...Ne.r0.VPAID_SAFE_OBJECT_WRAP_ERROR,name:t,value:n+this._vpaidError})}))}forceSkipAd(e){return this.vastTracker.track("skip",{once:!0,macros:Rn()}),this.stopAd({logs:e})}getAdVolume(){return{volume:this._internalVolume,muted:this.videoSlot.muted}}setAdVolume(e,t){this._internalVolume=null!=e?e:this._internalVolume,this._setMuted(t),super.setAdVolume(t?0:this._internalVolume)}_setMuted(e){this.videoSlot&&this.videoSlot.muted!==e&&(this.videoSlot.muted=e)}resizeAd(e,t,i){this.vpaidFrame.style.height=`${t}px`,this.vpaidFrame.style.width=`${e}px`,super.resizeAd(e,t,i),Hs({previousViewMode:this._viewMode,viewMode:i,vastTracker:this.vastTracker}),this._viewMode=i}getAdSkippableState(){return this._skipHandler.isSkipEnabled()?this._skipHandler.getSkippableState():super.getAdSkippableState()}getAdSkippableRemainingTime(){return this._skipHandler.getSkippableRemainingTime()}_onStopped(){this._unbindListeners(),this._clean(),this._hasImpressed?super._onStopped():this._onError("No fill",!1)}_onSkipped(){super._onSkipped(),this._unbindListeners(),this._clean(),this.vastTracker.track("skip",{once:!0,macros:Rn()})}_onDurationChange(){super._onDurationChange(),this.vastTracker.setDuration(this.getAdDuration()),this._handleRemainingTime(),!this._skipHasBeenInitialized&&this.getAdDuration()>0&&(this._skipHandler.isSkipEnabled()?this._skipHandler.initSkipCountdown(this.getAdDuration()):this._subscribeVPAIDAdUnit(this._onSkippableStateChange,Ne.L0.of,this),this._skipHasBeenInitialized=!0)}_getAdCurrentTime(){const e=this.getAdRemainingTime(),t=this.getAdDuration();return Number.isFinite(e)&&Number.isFinite(t)?e<0?0:Math.round(1e6*(t-e))/1e6:0}_onRemainingTimeChange(){let{emulated:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._remainingTimeValue=this.getAdRemainingTime(),this.vastTracker.setProgress(this._getAdCurrentTime(),Rn()),super._onRemainingTimeChange(),e||clearInterval(this._remainingTimeHandlerID)}_onVideoTagPlaying=()=>{this._isBuffering&&(this._isBuffering=!1,this.publish(Ne.k3.BUFFER_FINISH))};_onVideoTagWaiting=()=>{this._isBuffering=!0,this.publish(Ne.k3.BUFFER_START)};_onVolumeChange(){const e=super.getAdVolume();if(!Number.isFinite(e)||-1===e||e===this._lastVpaidVolume)return;const t=Math.max(0,Math.min(e,1)),i=0===t,n=0===t&&this._lastVpaidVolume>0,r=t>0&&0===this._lastVpaidVolume;this._lastVpaidVolume=t,0!==t&&(this._internalVolume=t),(n||r)&&(this._setMuted(i),this.vastTracker.setMuted(i,Rn())),super._onVolumeChange()}_onImpression(){super._onImpression(),this._hasImpressed||this.vastTracker.trackURLs(this.vastTracker.ad.impressionURLTemplates,Rn()),this._hasImpressed=!0}_onVideoStart(){super._onVideoStart(),this.vastTracker.track("start",{once:!0,macros:Rn()})}_onVideoFirstQuartile(){super._onVideoFirstQuartile(),this.vastTracker.track("firstQuartile",{once:!0,macros:Rn()})}_onVideoMidpoint(){super._onVideoMidpoint(),this.vastTracker.track("midpoint",{once:!0,macros:Rn()})}_onVideoThirdQuartile(){super._onVideoThirdQuartile(),this.vastTracker.track("thirdQuartile",{once:!0,macros:Rn()})}_onVideoComplete(){super._onVideoComplete(),this.vastTracker.track("complete",{once:!0,macros:Rn()})}_onClickThru(e,t,i){var n;super._onClickThru(e||(null==(n=this.vastTracker.clickThroughURLTemplate)?void 0:n.url),t,i),this._skipHandler.initSmartSkip();let r=null;try{r=pn(event)}catch(e){oa.warn("Unable to retrieve mouseEvent for _onClickThru:",e.message)}const s=r?{...Rn(),...r}:Rn();this.vastTracker.click(null,s)}_onUserAcceptInvitation(){super._onUserAcceptInvitation(),this.vastTracker.track("acceptInvitation",{macros:Rn()})}_onUserMinimize(){super._onUserMinimize(),this.vastTracker.track("collapse",{macros:Rn()})}_onUserClose(){super._onUserClose(),this.vastTracker.track("close",{once:!0,macros:Rn()})}_onPaused(){super._onPaused(),this.vastTracker.track("pause",{macros:Rn()})}_onPlaying(){super._onPlaying(),this.vastTracker.track("resume",{macros:Rn()});const e=this._getAdCurrentTime();e>0&&this._skipHandler.setSkipToNow(e)}_onError(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._hasStarted){this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),e=t?this._validateErrorFormat(e):e;const i=new Ce(e,{type:this._hasImpressed?Te:me});super._onError(i)}}_handleRemainingTime(){null===this._remainingTimeHandlerID&&(this._remainingTimeHandlerID=setInterval((()=>{const e=this.getAdRemainingTime();!e&&0!==e||this._remainingTimeValue===e||this._onRemainingTimeChange({emulated:!0})}),300))}_handleDurationChange(){if(!this._adDurationHandlerID){let e=-2;this._adDurationHandlerID=setInterval((()=>{const t=this.getAdDuration();t>0&&e!==t&&(e=t,this._onDurationChange())}),1e3)}}}const la=T("StreamIntegrator"),ca=document.documentElement.hasOwnProperty("ontouchend")?"touchend":"click";class ua extends J{constructor(){let{mediaFiles:e,vastTracker:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.boundedListeners={media:{},tracker:{}},this._paused=!1,this._isSeeking=!1,this._currentTime=0,this._skipHandler=new Pr(t,this.publish,this),this._hasImpressed=!1,this._viewMode=null,this._playAd=null,this.mediaFiles=e,this.vastTracker=t,this.adRemainingTime=-2}destroy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne.k3.STOPPED,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===this.vastTracker)return;var i;this._unbindListeners(),this.videoTag&&(this.videoTag.removeEventListener("canplaythrough",this._playAd),this.videoTag.pause(),this.videoTag.removeAttribute("src"),this.videoTag.removeAttribute("type"),this.videoTag.load(),null==(i=this.clickTarget)||i.removeAttribute("data-cursor-pointer")),this.videoTag=null,this.mediaFiles=null,this.vastTracker=null,this.companionVastTracker=null,this.isAudioOnly=null,this.clickTarget=null;const n=t?[e,t]:[e];this.publish(...n)}_bindListeners(){this._bindTrackerListeners(),this._bindMediaListeners()}_unbindListeners(){this.videoTag&&this._unbindMediaListeners(),this.vastTracker&&this._unbindTrackerListeners(),this.companionVastTracker&&this.companionVastTracker.off("clickthrough",this._onTrackerClickThrough)}_bindMediaListeners(){this._addBoundedMediaEventListener("durationchange",this._onMediaDurationChange),this._addBoundedMediaEventListener("loadeddata",this._onMediaLoadedData),this._addBoundedMediaEventListener("timeupdate",this._onMediaTimeUpdate),this._addBoundedMediaEventListener("seeking",this._onMediaSeeking),this._addBoundedMediaEventListener("ended",this._onMediaEnded),this._addBoundedMediaEventListener("pause",this._onMediaPause),this._addBoundedMediaEventListener("playing",this._onMediaPlaying),this._addBoundedMediaEventListener("volumechange",this._onMediaVolumeChange),this._addBoundedMediaEventListener("error",this._onMediaError),this._addBoundedMediaEventListener("waiting",this._onMediaWaiting)}_unbindMediaListeners(){this._removeBoundedMediaEventListener("durationchange"),this._removeBoundedMediaEventListener("loadeddata"),this._removeBoundedMediaEventListener("timeupdate"),this._removeBoundedMediaEventListener("seeking"),this._removeBoundedMediaEventListener("ended"),this._removeBoundedMediaEventListener("pause"),this._removeBoundedMediaEventListener("playing"),this._removeBoundedMediaEventListener("volumechange"),this._removeBoundedMediaEventListener("error"),this._removeBoundedMediaEventListener("waiting"),this._removeBoundedMediaEventListener(ca,this.clickTarget)}_initClickThrough(){var e,t;this._addBoundedMediaEventListener(ca,this._onMediaClick,this.videoTag),((null==(e=this.vastTracker.clickThroughURLTemplate)?void 0:e.url)||(null==(t=this._getAudioCompanionAd())?void 0:t.companionClickThruUrl))&&this.videoTag.setAttribute("data-cursor-pointer","")}_bindTrackerListeners(){this._addBoundedTrackerEventListener("creativeView",this._onTrackerCreativeView),this._addBoundedTrackerEventListener("start",this._onTrackerStart),this._addBoundedTrackerEventListener("firstQuartile",this._onTrackerFirstQuartile),this._addBoundedTrackerEventListener("midpoint",this._onTrackerMidpoint),this._addBoundedTrackerEventListener("thirdQuartile",this._onTrackerThirdQuartile),this._addBoundedTrackerEventListener("complete",this._onTrackerComplete),this._addBoundedTrackerEventListener("pause",this._onTrackerPause),this._addBoundedTrackerEventListener("resume",this._onTrackerResume),this._addBoundedTrackerEventListener("skip",this._onTrackerSkip),this._addBoundedTrackerEventListener("close",this._onTrackerClose),this._addBoundedTrackerEventListener("closeLinear",this._onTrackerCloseLinear),this._addBoundedTrackerEventListener("clickthrough",this._onTrackerClickThrough),this._addBoundedTrackerEventListener("fullscreen",this._onTrackerFullscreenEntered),this._addBoundedTrackerEventListener("exitFullscreen",this._onTrackerFullscreenExited),this._addBoundedTrackerEventListener("mute",this._onTrackerMuted),this._addBoundedTrackerEventListener("unmute",this._onTrackerUnmuted)}_unbindTrackerListeners(){this._removeBoundedTrackerEventListener("creativeView"),this._removeBoundedTrackerEventListener("start"),this._removeBoundedTrackerEventListener("firstQuartile"),this._removeBoundedTrackerEventListener("midpoint"),this._removeBoundedTrackerEventListener("thirdQuartile"),this._removeBoundedTrackerEventListener("complete"),this._removeBoundedTrackerEventListener("pause"),this._removeBoundedTrackerEventListener("resume"),this._removeBoundedTrackerEventListener("skip"),this._removeBoundedTrackerEventListener("close"),this._removeBoundedTrackerEventListener("closeLinear"),this._removeBoundedTrackerEventListener("clickthrough"),this._skipHandler.unbindSkipCountdown()}_addBoundedMediaEventListener(e,t,i){this._addBoundedEventListener("media",e,t,i)}_removeBoundedMediaEventListener(e,t){this._removeBoundedEventListener("media",e,t)}_addBoundedTrackerEventListener(e,t){this._addBoundedEventListener("tracker",e,t)}_removeBoundedTrackerEventListener(e){this._removeBoundedEventListener("tracker",e)}_addBoundedEventListener(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.videoTag;if(!this.boundedListeners[e])throw new Error("Unexpected type");this.boundedListeners[e][t]=i.bind(this),"media"===e?n.addEventListener(t,this.boundedListeners[e][t]):"tracker"===e&&this.vastTracker.on(t,this.boundedListeners[e][t])}_removeBoundedEventListener(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.videoTag;if(!this.boundedListeners[e])throw new Error("Unexpected type");const n=this.boundedListeners[e][t];n&&("media"===e?i.removeEventListener(t,n):"tracker"===e&&this.vastTracker.off(t,n),delete this.boundedListeners[e][t])}_clean(){}_onMediaDurationChange(){this.adDuration=this.videoTag.duration,this.vastTracker.setDuration(this.adDuration),this.publish(Ne.k3.DURATION_CHANGE)}_onMediaLoadedData(){this._initClickThrough(),this.vastTracker.trackImpression(Rn()),this._skipHandler.initSkipCountdown(this.adDuration)}_onMediaTimeUpdate(){this._isSeeking?this._isSeeking=!1:(this._currentTime=this.videoTag.currentTime,this.vastTracker.setProgress(this._currentTime,Rn()),this.adRemainingTime=this.adDuration-this._currentTime,this.publish(Ne.k3.REMAINING_TIME_CHANGE))}_onMediaSeeking(){this._isSeeking=!0;const e=this.videoTag.currentTime-this._currentTime;Math.abs(e)&&(this.videoTag.currentTime=this._currentTime)}_onMediaEnded(){this.vastTracker.complete(Rn())}_onMediaError(){let e=Te;this._hasImpressed||(this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.pc}),e=me);const t=new Ce(this.videoTag.error.message,{type:e,code:this.videoTag.error.code});this.destroy(Ne.k3.ERROR,t)}_onMediaWaiting(){this._isBuffering=!0,this.publish(Ne.k3.BUFFER_START)}_onMediaPlaying(){this._isBuffering&&(this._isBuffering=!1,this.publish(Ne.k3.BUFFER_FINISH)),this._paused&&(this._paused=!1,this.vastTracker.setPaused(this._paused,Rn()),this._skipHandler.setSkipToNow(this._currentTime))}_onMediaPause(){this.videoTag.ended||this._paused||(this._paused=!0,this.vastTracker.setPaused(this._paused,Rn()))}_onMediaVolumeChange(){this.vastTracker.setMuted(this.videoTag.muted,Rn()),this.adVolume===this.videoTag.volume&&this.adMuted===this.videoTag.muted||(this.adVolume=this.videoTag.volume,this.adMuted=this.videoTag.muted||!1,this.publish(Ne.k3.VOLUME_CHANGE))}_onMediaClick(e){var t;e.preventDefault();const i={...Rn(),...pn(e)},n=this._getAudioCompanionAd();n&&!(null==(t=this.vastTracker.clickThroughURLTemplate)?void 0:t.url)&&(this.companionVastTracker=n.companionVastTracker,this.companionVastTracker.on("clickthrough",this._onTrackerClickThrough.bind(this)),this.companionVastTracker.click(null,i)),this.vastTracker.click(null,i)}_onTrackerCreativeView(){this._hasImpressed=!0,this.publish(Ne.k3.IMPRESSION)}_onTrackerStart(){this.publish(Ne.k3.VIDEO_START)}_onTrackerFirstQuartile(){this.publish(Ne.k3.VIDEO_FIRST_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_FIRST_QUARTILE)}_onTrackerMidpoint(){this.publish(Ne.k3.VIDEO_MIDPOINT),ee.dispatchEvent(te.AD_VIDEO_MIDPOINT)}_onTrackerThirdQuartile(){this.publish(Ne.k3.VIDEO_THIRD_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_THIRD_QUARTILE)}_onTrackerComplete(){this.publish(Ne.k3.VIDEO_COMPLETE),this.stopAd()}_onTrackerPause(){this.publish(Ne.k3.PAUSED),ee.dispatchEvent(te.AD_PAUSED)}_onTrackerResume(){this.publish(Ne.k3.PLAYING),ee.dispatchEvent(te.AD_PLAYING)}_onTrackerSkip(){this.destroy(Ne.k3.SKIPPED)}_onTrackerClose(){this.destroy()}_onTrackerCloseLinear(){this.destroy()}_onTrackerClickThrough(e){this.publish(Ne.k3.CLICK_THRU,e,null,!0),this._skipHandler.initSmartSkip()}_onTrackerFullscreenEntered(){this.publish(Ne.k3.FULLSCREEN_ENTERED)}_onTrackerFullscreenExited(){this.publish(Ne.k3.FULLSCREEN_EXITED)}_onTrackerMuted(){this.publish(Ne.k3.MUTED)}_onTrackerUnmuted(){this.publish(Ne.k3.UNMUTED)}initAd(e,t,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=new Promise((i=>{const n=[];if(this.mediaFiles.forEach((e=>{this._canPlayType(e.mimeType)&&n.push(e)})),!n.length){this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.R4});const e=new Ce(ne.STREAM_UNPLAYABLE_SRC,{type:pe});return this.publish(Ne.k3.ERROR,e),Promise.reject(e)}if(n.sort(((e,t)=>e.height-t.height)),0===n[n.length-1].height){n.sort(((e,t)=>e.bitrate-t.bitrate));const e=Ja().getEstimatedBitrate();n.forEach((t=>{this.mediaFile?this.hasBetterBitrate(t,e)&&(this.mediaFile=t):this.mediaFile=t}))}else n.forEach((i=>{this.mediaFile?i.height>this.mediaFile.height&&t>i.height&&e>i.width&&(this.mediaFile=i):this.mediaFile=i}));this.isAudioOnly=Ne.VS.Aq.includes(this.mediaFile.mimeType),this.videoTag=s.videoSlot,this.adVolume=this.videoTag.volume,this.adMuted=this.videoTag.muted||!1,this.publish(Ne.k3.LOADED),this.vastTracker.load(Rn()),i({adType:this.isAudioOnly?"audio":"video"})}));return Yi(li,a)}startAd(){let{loadBeforePlayback:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._bindListeners(),la.log("Setting video src to",this.mediaFile.fileURL),new Promise((t=>{if(this._playAd=()=>{la.log("Playing the mediafile"),this.videoTag.play(),this.publish(Ne.k3.STARTED,xs(this.vastTracker.ad,Ne.Z4.iF)),this.videoTag.removeEventListener("canplaythrough",this._playAd),t()},this.videoTag.addEventListener("canplaythrough",this._playAd),this.videoTag.setAttribute("type",this.mediaFile.mimeType),this.videoTag.src=this.mediaFile.fileURL,this.videoTag.load(),!e)return this._playAd();la.log("Starting to load stream mediafile")})).catch((e=>{this.videoTag.removeEventListener("canplaythrough",this._playAd),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.pc});const t=new Ce(e.message,{type:ve});throw this.destroy(Ne.k3.ERROR,t),t}))}getAdPodInfo(){}stopAd(){return this.destroy(),Promise.resolve()}pauseAd(){this.videoTag.pause()}resumeAd(){this.videoTag.play()}skipAd(){const e=this._skipHandler.getSkipLogs(this._currentTime);return this.vastTracker.skip(Rn()),Promise.resolve(e)}resizeAd(e,t,i){Hs({previousViewMode:this._viewMode,viewMode:i,vastTracker:this.vastTracker}),this._viewMode=i}getAdRemainingTime(){return this.adRemainingTime}getAdDuration(){return this.adDuration}getAdVolume(){return{volume:this.adVolume,muted:this.adMuted}}setAdVolume(e,t){t&&!this.videoTag.muted?this.videoTag.muted=!0:!t&&this.videoTag.muted&&(this.videoTag.muted=!1),void 0!==e&&(this.videoTag.volume=e)}getAdSkippableState(){return this._skipHandler.getSkippableState()}getAdSkippableRemainingTime(){return this._skipHandler.getSkippableRemainingTime()}isSkipEnabled(){return this._skipHandler.isSkipEnabled()}hasBetterBitrate(e,t){const i=this.convertToKiloBitrate(e.bitrate);return i>this.convertToKiloBitrate(this.mediaFile.bitrate)&&i<t}convertToKiloBitrate(e){return e>1e4?e/1e3:e}_getAudioCompanionAd(){return this.isAudioOnly?nn.audioAdCompanion:null}_canPlayType(e){return!!document.createElement("video").canPlayType(e).replace(/^no$/,"")}}const ha=T("AdStackDM","VAST","IMANativeIntegrator"),Ea="IMA Playlist timeout";class pa extends J{constructor(){let{mediaFiles:e,vastTracker:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._eventListeners={},this.ad=null,this.currentTime=0,this.mediaFiles=e,this.vastTracker=t,this._lastAdEndedReason=null,ha.log("Listening to IMA events from the app"),ee.addEventListener(te.PLAYER_IMA_NATIVE_EVENT,(e=>{const t=this._eventListeners[e.event];t&&t.forEach((t=>{t(e)}))}))}_bindListeners(){this._addBoundedEventListener(Ne.YK.COMPLETE,this._onVideoCompleted),this._addBoundedEventListener(Ne.YK.SKIPPED,this._onSkipped),this._addBoundedEventListener(Ne.YK.ALL_ADS_COMPLETED,this._onAllAdsCompleted),this._addBoundedEventListener(Ne.YK.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),this._addBoundedEventListener(Ne.YK.PAUSED,this._onPaused),this._addBoundedEventListener(Ne.YK.RESUMED,this._onResumed),this._addBoundedEventListener(Ne.YK.CLICK,this._onClick),this._addBoundedEventListener(Ne.YK.VOLUME_CHANGED,this._onVolumeChange),this._addBoundedEventListener(Ne.YK.FIRST_QUARTILE,this._onFirstQuartile),this._addBoundedEventListener(Ne.YK.MIDPOINT,this._onMidpoint),this._addBoundedEventListener(Ne.YK.THIRD_QUARTILE,this._onThirdQuartile),this._addBoundedEventListener(Ne.YK.FULLSCREEN,this._onFullscreen),this._addBoundedEventListener(Ne.YK.INLINE,this._onInline),this._addBoundedEventListener(Ne.YK.DURATION_CHANGED,this._onDurationChange),this._addBoundedEventListener(Ne.YK.AD_PROGRESS,this._onAdProgress)}_unbindListeners(){this._removeBoundedEventListener(Ne.YK.LOADED),this._removeBoundedEventListener(Ne.YK.STARTED),this._removeBoundedEventListener(Ne.YK.IMPRESSION),this._removeBoundedEventListener(Ne.YK.COMPLETE),this._removeBoundedEventListener(Ne.YK.SKIPPED),this._removeBoundedEventListener(Ne.YK.ALL_ADS_COMPLETED),this._removeBoundedEventListener(Ne.YK.CONTENT_RESUME_REQUESTED),this._removeBoundedEventListener(Ne.YK.CONTENT_PAUSE_REQUESTED),this._removeBoundedEventListener(Ne.YK.AD_ERROR),this._removeBoundedEventListener(Ne.YK.PAUSED),this._removeBoundedEventListener(Ne.YK.RESUMED),this._removeBoundedEventListener(Ne.YK.CLICK),this._removeBoundedEventListener(Ne.YK.VOLUME_CHANGED),this._removeBoundedEventListener(Ne.YK.FIRST_QUARTILE),this._removeBoundedEventListener(Ne.YK.MIDPOINT),this._removeBoundedEventListener(Ne.YK.THIRD_QUARTILE),this._removeBoundedEventListener(Ne.YK.FULLSCREEN),this._removeBoundedEventListener(Ne.YK.INLINE),this._removeBoundedEventListener(Ne.YK.DURATION_CHANGED),this._removeBoundedEventListener(Ne.YK.AD_PROGRESS)}_addBoundedEventListener(e,t){this._eventListeners[e]=this._eventListeners[e]||[],this._eventListeners[e].push(t.bind(this))}_removeBoundedEventListener(e){this._eventListeners[e]&&delete this._eventListeners[e]}_clean(){this._unbindListeners(),ha.log("Cleaning Slot")}initAdsManagerHelper(e){return new Promise(((t,i)=>{const n=()=>{this._removeBoundedEventListener(Ne.YK.LOADED),this._removeBoundedEventListener(Ne.YK.CONTENT_PAUSE_REQUESTED)},r=e=>{ha.log("LOADED received from the app"),n(),t(e)};this._addBoundedEventListener(Ne.YK.AD_ERROR,(e=>{ha.log("AD_ERROR received from the app",e),n();const t=new Ce(e.errorMessage,{type:pe,code:e.errorCode});i(t)})),this._addBoundedEventListener(Ne.YK.LOADED,r),this._addBoundedEventListener(Ne.YK.CONTENT_PAUSE_REQUESTED,r),ha.log("Listening to IMA LOADED from the app"),ha.log("Sending IMA_AD_REQUESTED with url ",e),ee.dispatchEvent(te.IMA_NATIVE_AD_REQUESTED,{adTagUrl:e,vastLoadTimeout:wi()}),Bs({action:Us,component:"IMA NATIVE"})}))}startAdsManagerHelper(){return new Promise(((e,t)=>{const i=()=>{this._removeBoundedEventListener(Ne.YK.IMPRESSION),this._removeBoundedEventListener(Ne.YK.AD_ERROR)};this._addBoundedEventListener(Ne.YK.IMPRESSION,(t=>{ha.log("IMPRESSION received from the app with ad",t.ad),this.ad=xs(t.ad,Ne.Z4.Vf),ha.log("AdStart data",this.ad),this.adPosition=t.ad.adPosition,this.totalAds=t.ad.totalAds,Xe.newAd(this.adPosition),this.inventoryIdValue=Xe.value,i(),e()})),this._addBoundedEventListener(Ne.YK.AD_ERROR,(e=>{ha.log("AD_ERROR received from the app",e),i(),t(new Ce(e.errorMessage,{type:ve,code:e.errorCode}))})),ha.log("Listening to IMA IMPRESSION from the app")}))}initAd(e,t,i,n,r,s){let a={};try{a=JSON.parse(r.AdParameters)}catch(e){throw ha.error("AdParameters failed to parse:",r.AdParameters),new Ce(ne.FAILED_TO_PARSE_AD_PARAMS,{type:Le})}return ha.log("adsManager loaded"),this.initAdPromise=this.initAdsManagerHelper(a.url),this.startAdPromise=this.startAdsManagerHelper(),Yi(li,this.initAdPromise).then((()=>{this.publish(Ne.k3.LOADED)})).catch((e=>{throw this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}startAd(){return this._bindListeners(),this._startNextAd()}_startNextAd(){return Yi(ci,this._startAd()).catch((e=>{throw this._unbindListeners(),this._clean(),this.vastTracker.error({...Rn(),ERRORCODE:Ne.Uk.wr}),this.publish(Ne.k3.ERROR,e),e}))}_startAd(){return this.startAdPromise.then((()=>{this._addBoundedEventListener(Ne.YK.AD_ERROR,(e=>{ha.log("AD_ERROR received from the app",e);const t=new Ce(e.errorMessage,{code:e.errorCode,type:ve});this.publish(Ne.k3.POD_ERROR,t),this._endVideoAd()})),this.publish(Ne.k3.STARTED,this.ad),this.vastTracker.trackURLs(this.vastTracker.ad.impressionURLTemplates,Rn()),this.publish(Ne.k3.IMPRESSION)}))}stopAd(){return this._clean(),ee.dispatchEvent(te.IMA_NATIVE_AD_STOPPED),Promise.resolve()}skipAd(){return new Promise((()=>{}))}pauseAd(){}resumeAd(){}resizeAd(){}clicked(){}getAdRemainingTime(){return this.currentTime&&this.getAdDuration()-this.currentTime||-1}getAdDuration(){var e;return(null==(e=this.ad)?void 0:e.vastDuration)||0}getAdVolume(){return{volume:this._lastVolume,muted:0===this._lastVolume}}setAdVolume(){}getAdSkippableState(){return!1}getAdSkippableRemainingTime(){}isSkipEnabled(){return!1}_onPaused(){ha.log("Received PAUSED event from IMA native"),this.vastTracker.track("pause",{macros:Rn()}),this.publish(Ne.k3.PAUSED),ee.dispatchEvent(te.AD_PAUSED)}_onResumed(){ha.log("Received RESUMED event from IMA native"),this.vastTracker.track("resume",{macros:Rn()}),this.publish(Ne.k3.PLAYING),ee.dispatchEvent(te.AD_PLAYING)}_onClick(){ha.log("Received CLICK event from IMA native"),this.vastTracker.click(null,Rn()),this.publish(Ne.k3.CLICK_THRU)}_onVolumeChange(e){ha.log("Received VOLUME_CHANGE event from IMA native with data",e);const t=e.muted?0:e.volume;void 0===this._lastVolume&&(this._lastVolume=t),0===t&&this._lastVolume>0&&this.vastTracker.track("mute",{macros:Rn()}),t>0&&0===this._lastVolume&&this.vastTracker.track("unmute",{macros:Rn()}),this._lastVolume=t,this.publish(Ne.k3.VOLUME_CHANGE)}_onFirstQuartile(){ha.log("Received FIRST_QUARTILE event from IMA native"),this.vastTracker.track("firstQuartile",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_FIRST_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_FIRST_QUARTILE)}_onMidpoint(){ha.log("Received MIDPOINT event from IMA native"),this.vastTracker.track("midpoint",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_MIDPOINT),ee.dispatchEvent(te.AD_VIDEO_MIDPOINT)}_onThirdQuartile(){ha.log("Received THIRD_QUARTILE event from IMA native"),this.vastTracker.track("thirdQuartile",{macros:Rn(),once:!0}),this.publish(Ne.k3.VIDEO_THIRD_QUARTILE),ee.dispatchEvent(te.AD_VIDEO_THIRD_QUARTILE)}_onFullscreen(){ha.log("Received FULLSCREEN event from IMA native");const e=Rn();this.vastTracker.setFullscreen(!0,e),this.vastTracker.setExpand(!0,e),this.publish(Ne.k3.FULLSCREEN_ENTERED)}_onInline(){ha.log("Received INLINE event from IMA native");const e=Rn();this.vastTracker.setFullscreen(!1,e),this.vastTracker.setExpand(!1,e),this.publish(Ne.k3.FULLSCREEN_EXITED)}_onStarted(){ha.log("Received STARTED event from IMA native"),this.vastTracker.track("creativeView",{macros:Rn()}),this.vastTracker.track("start",{macros:Rn()}),this.publish(Ne.k3.VIDEO_START)}_onVideoCompleted(){ha.log("Received VIDEO_COMPLETE event from IMA native"),this.vastTracker.track("complete",{macros:Rn()}),this.publish(Ne.k3.VIDEO_COMPLETE,{endedReason:Ne.Bj.COMPLETED}),this._endVideoAd()}_onSkipped(){ha.log("Received SKIPPED event from IMA native"),this.vastTracker.track("skip",{macros:Rn()}),this._lastAdEndedReason=Ne.Bj.SKIPPED,this.publish(Ne.k3.VIDEO_COMPLETE,{endedReason:Ne.Bj.SKIPPED}),this._endVideoAd()}_endVideoAd(){this._removeBoundedEventListener(Ne.YK.AD_ERROR);const e=this._isLastAdFromPod();this.ad=null,e||(Xe.newAd(),this.startAdPromise=this.startAdsManagerHelper(),this._startNextAd())}_onDurationChange(e){let{duration:t}=e;this.ad&&(this.ad.vastDuration=t),this.vastTracker.setDuration(t),this.publish(Ne.k3.DURATION_CHANGE)}_onAdProgress(e){let{currentTime:t}=e;this.currentTime=t,this.publish(Ne.k3.REMAINING_TIME_CHANGE),this.vastTracker.setProgress(t,Rn())}_onContentResumeRequested(){ha.log("Received CONTENT_RESUME_REQUESTED event from IMA native"),yi(Ea,500,(()=>{this.publish(Ne.k3.ERROR,new Ce(ne.IMA_SDK_INCORRECT_TAG,{type:Re}))}))}_onAllAdsCompleted(){ha.log("Received ALL_ADS_COMPLETED event from IMA native"),Oi(Ea),this.publish(Ne.k3.STOPPED,{...this._lastAdEndedReason&&{reason:this._lastAdEndedReason}}),this._clean()}_isLastAdFromPod(){return!!this.totalAds&&this.totalAds===this.adPosition}publish(e,t){super.publish(e,t),e===Ne.k3.ERROR&&(ha.log("Sending IMA_NATIVE_AD_STOPPED"),ee.dispatchEvent(te.IMA_NATIVE_AD_STOPPED))}}const _a={CREATE_SESSION:"createSession",RESOLVE:"resolve",REJECT:"reject"},va="Media:durationchange",Aa="Media:pause",ma="Media:play",ga="Media:playing",Ta="Media:seeked",Ra="Media:seeking",Sa="Media:stalled",Da="Media:volumechange",Ia="Player:init",La="Player:startCreative",ka="Player:adSkipped",fa="Player:adStopped",Pa="Player:fatalError",ya={CLICK_THRU:"Creative:clickThru",EXPAND_NONLINEAR:"Creative:expandNonlinear",COLLAPSE_NONLINEAR:"Creative:collapseNonlinear",FATAL_ERROR:"Creative:fatalError",GET_MEDIA_STATE:"Creative:getMediaState",LOG:"Creative:log",REQUEST_FULL_SCREEN:"Creative:requestFullScreen",REQUEST_EXIT_FULL_SCREEN:"Creative:requestExitFullScreen",REQUEST_SKIP:"Creative:requestSkip",REQUEST_NAVIGATION:"Creative:requestNavigation",REQUEST_STOP:"Creative:requestStop",REQUEST_PAUSE:"Creative:requestPause",REQUEST_PLAY:"Creative:requestPlay",REQUEST_RESIZE:"Creative:requestResize",REQUEST_VOLUME:"Creative:requestChangeVolume",REQUEST_TRACKING:"Creative:reportTracking",REQUEST_CHANGE_AD_DURATION:"Creative:requestChangeAdDuration"},Oa=[ya.GET_MEDIA_STATE,ya.REQUEST_VIDEO_LOCATION,ya.READY,ya.CLICK_THRU,ya.REQUEST_SKIP,ya.REQUEST_STOP,ya.REQUEST_PAUSE,ya.REQUEST_PLAY,ya.REQUEST_FULL_SCREEN,ya.REQUEST_VOLUME,ya.REQUEST_RESIZE,ya.REQUEST_NAVIGATION,ya.REQUEST_CHANGE_AD_DURATION,ya.REPORT_TRACKING,Ia,La,ka,fa,Pa,_a.CREATE_SESSION],ba={UNSPECIFIED:1100,CANNOT_LOAD_RESOURCE:1101,PLAYBACK_AREA_UNUSABLE:1102,INCORRECT_VERSION:1103,TECHNICAL_ERROR:1104,EXPAND_NOT_POSSIBLE:1105,PAUSE_NOT_HONORED:1106,PLAYMODE_NOT_ADEQUATE:1107,CREATIVE_INTERNAL_ERROR:1108,DEVICE_NOT_SUPPORTED:1109,MESSAGES_NOT_FOLLOWING_SPEC:1110,PLAYER_RESPONSE_TIMEOUT:1111},Ca=1200;class Na{constructor(){this.listeners_={},this.sessionId_="",this.nextMessageId_=1,this.target_=window.parent,this.resolutionListeners_={},window.addEventListener("message",this.receiveMessage.bind(this),!1)}reset(){this.listeners_={},this.sessionId_="",this.nextMessageId_=1,this.resolutionListeners_={}}sendMessage(e,t){const i=this.nextMessageId_++,n=e==_a.CREATE_SESSION?e:`SIMID:${e}`,r={sessionId:this.sessionId_,messageId:i,type:n,timestamp:Date.now(),args:t};return Oa.includes(e)?new Promise(((e,t)=>{this.addResolveRejectListener_(i,e,t),this.target_.postMessage(JSON.stringify(r),"*")})):new Promise((e=>{this.target_.postMessage(JSON.stringify(r),"*"),e()}))}addListener(e,t){this.listeners_[e]?this.listeners_[e].push(t):this.listeners_[e]=[t]}addResolveRejectListener_(e,t,i){this.resolutionListeners_[e]=(e=>{const n=e.type,r=e.args.value;"resolve"==n?t(r):"reject"==n&&i(r)}).bind(this)}receiveMessage(e){if(!e||!e.data)return;let t;try{t=JSON.parse(e.data)}catch(e){}if(!t)return;const i=t.sessionId,n=t.type,r=""==this.sessionId_&&n==_a.CREATE_SESSION,s=this.sessionId_==i;if((r||s)&&null!=n)if(Object.values(_a).includes(n))this.handleProtocolMessage_(t);else if(n.startsWith("SIMID:")){const e=n.substr(6),i=this.listeners_[e];i&&i.forEach((e=>e(t)))}}handleProtocolMessage_(e){const t=e.type;switch(t){case _a.CREATE_SESSION:{this.sessionId_=e.sessionId,this.resolve(e);const i=this.listeners_[t];i&&i.forEach((t=>t(e)));break}case _a.RESOLVE:case _a.REJECT:{const t=e.args.messageId,i=this.resolutionListeners_[t];i&&(i(e),delete this.resolutionListeners_[t]);break}}}resolve(e,t){const i=this.nextMessageId_++,n={messageId:e.messageId,value:t},r={sessionId:this.sessionId_,messageId:i,type:_a.RESOLVE,timestamp:Date.now(),args:n};this.target_.postMessage(JSON.stringify(r),"*")}reject(e,t){const i=this.nextMessageId_++,n={messageId:e.messageId,value:t},r={sessionId:this.sessionId_,messageId:i,type:_a.REJECT,timestamp:Date.now(),args:n};this.target_.postMessage(JSON.stringify(r),"*")}createSession(){this.generateSessionId_(),this.sendMessage(_a.CREATE_SESSION).then((()=>{}),(()=>{}))}generateSessionId_(){const e=new Uint8Array(16);window.crypto.getRandomValues(e);const t=Array.from(Array(32).keys()).map((t=>{const i=t%2==0,n=e[Math.floor(t/2)];return i?n>>4:15&n}));t[12]=4,t[16]=8|3&t[16];const i=t.map((e=>e.toString(16))),n=[i.slice(0,8).join(""),i.slice(8,12).join(""),i.slice(12,16).join(""),i.slice(16,20).join(""),i.slice(20).join("")].join("-");this.sessionId_=n}setMessageTarget(e){this.target_=e}}const Ua=T("StreamSimidIntegrator");class Va extends ua{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._viewMode=null,this.simidProtocol=null,this.simidResolveSessionCreatedPromise_=null,this.sessionCreatedPromise_=new Promise((e=>{this.simidResolveSessionCreatedPromise_=e})),this.simidResolveInitializationPromise_=null,this.simidInitializationPromise_=new Promise(((e,t)=>{this.simidResolveInitializationPromise_=e,this.simidRejectInitializationPromise_=e=>{const i=`Creative rejected ${Ia} ${(null==e?void 0:e.reason)||"CREATIVE_NOT_REPLIED_TO_INIT"}`;return this.triggerError(i,(null==e?void 0:e.errorCode)||1212),t}})),this.resolvedStartCreative=!1,this.playerSize=null}loadSimidScript(e,t){this.simidProtocol=new Na,this.addSimidListeners(),this.simidIframe=document.createElement("iframe"),this.simidIframe.style.display="none",this.simidIframe.className="ad_slot",t.parentNode.insertBefore(this.simidIframe,t.nextSibling),this.simidIframe.src=e,this.simidIframe.setAttribute("data-cy","simid-iframe"),this.simidIframe.setAttribute("allowFullScreen",""),S("PV5_SIMID_IFRAME_ALLOW_ATTRIBUTES")&&(this.simidIframe.allow="accelerometer; ambient-light-sensor; battery; camera; gyroscope; magnetometer; microphone;"),this.simidProtocol.setMessageTarget(this.simidIframe.contentWindow)}initSimidScript(){this.timedPromise(this.sessionCreatedPromise_,(()=>this.sendInitMessage()),(()=>{this.triggerError("Failed to init simid script",1208)}))}cleanSimid(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ua.log("Clean SIMID iframe and protocol"),this.simidIframe&&(this.simidIframe.remove(),this.simidIframe=null),null==(e=this.simidProtocol)||e.reset(),t||this._unbindListeners()}onSessionCreated_(){Ua.log("Session created"),this.simidResolveSessionCreatedPromise_()}addSimidListeners(){this.simidProtocol.addListener(_a.CREATE_SESSION,this.onSessionCreated_.bind(this)),this.simidProtocol.addListener(ya.REQUEST_FULL_SCREEN,this.onSimidRequestFullScreen.bind(this)),this.simidProtocol.addListener(ya.REQUEST_EXIT_FULL_SCREEN,this.onSimidRequestExitFullScreen.bind(this)),this.simidProtocol.addListener(ya.REQUEST_PLAY,this.onSimidRequestPlay.bind(this)),this.simidProtocol.addListener(ya.REQUEST_PAUSE,this.onSimidRequestPause.bind(this)),this.simidProtocol.addListener(ya.FATAL_ERROR,this.onSimidCreativeFatalError.bind(this)),this.simidProtocol.addListener(ya.REQUEST_SKIP,this.onSimidRequestSkip.bind(this)),this.simidProtocol.addListener(ya.REQUEST_STOP,this.onSimidRequestStop.bind(this)),this.simidProtocol.addListener(ya.REQUEST_CHANGE_AD_DURATION,this.onSimidRequestChangeAdDuration.bind(this)),this.simidProtocol.addListener(ya.GET_MEDIA_STATE,this.onSimidGetMediaState.bind(this)),this.simidProtocol.addListener(ya.LOG,this.onSimidReceiveCreativeLog.bind(this)),this.simidProtocol.addListener(ya.REQUEST_TRACKING,this.onSimidRequestTracking.bind(this)),this.simidProtocol.addListener(ya.REQUEST_RESIZE,this.onSimidRequestResize.bind(this)),this.simidProtocol.addListener(ya.CLICK_THRU,this.onSimidRequestClickthru.bind(this)),this.simidProtocol.addListener(ya.REQUEST_NAVIGATION,this.onSimidRequestNavigation.bind(this)),this.simidProtocol.addListener(ya.REQUEST_VOLUME,this.onSimidRequestVolumeChange.bind(this))}onSimidGetMediaState(e){const t={currentSrc:this.videoTag.currentSrc,currentTime:this.videoTag.currentTime,duration:this.videoTag.duration,ended:this.videoTag.ended,muted:this.videoTag.muted,paused:this.videoTag.paused,volume:this.videoTag.volume,fullscreen:"fullscreen"===this._viewMode};Ua.log(`${ya.GET_MEDIA_STATE} received, replying..`,t),this.simidProtocol.resolve(e,t)}onSimidRequestExitFullScreen(e){const t={errorCode:Ca,message:"Player fullscreenAllowed is not allowed"};return Ua.log(`${ya.REQUEST_EXIT_FULL_SCREEN} received, rejecting..`,t),this.publish(Ne.k3.LOG,Ne.r0.SIMID_REQUEST_EXIT_FULLSCREEN),this.simidProtocol.reject(e,t)}onSimidRequestFullScreen(e){const t={errorCode:Ca,message:"Player fullscreenAllowed is not allowed"};Ua.log(`${ya.REQUEST_FULL_SCREEN} received, rejecting..`,t),this.publish(Ne.k3.LOG,Ne.r0.SIMID_REQUEST_FULLSCREEN),this.simidProtocol.reject(e,t)}sendInitMessage(){var e,t,i;const n={environmentData:{videoDimensions:this.playerSize,creativeDimensions:this.playerSize,fullscreen:"fullscreen"===this._viewMode,fullscreenAllowed:!1,variableDurationAllowed:!1,skippableState:"playerHandles",siteUrl:document.location.host,useragent:N().window().navigator.userAgent,muted:this.adMuted,volume:this.adVolume,version:"1.1.1"},creativeData:{adParameters:null==(e=this.creativeData)?void 0:e.AdParameters,clickThroughUrl:null==(t=this.vastTracker)||null==(i=t.clickThroughURLTemplate)?void 0:i.url}};Ua.log("Sending init message",n);const r=this.simidProtocol.sendMessage(Ia,n);this.timedPromise(r,(()=>{this.startCreative()}),this.simidRejectInitializationPromise_)}async timedPromise(e,t,i){const n=new Promise(((e,t)=>{const i=setTimeout((()=>{clearTimeout(i),t("Promise timed out")}),3e3)}));Promise.race([n,e]).then(t,i)}onSimidRequestPause(e){if(this._paused){const t={errorCode:ba.PAUSE_NOT_HONORED,message:"Player is already in pause state"};return Ua.log(`${ya.REQUEST_PAUSE} received, rejecting..`,t),this.simidProtocol.reject(e,t)}Ua.log(`${ya.REQUEST_PAUSE} received`),this.pauseAd(),this.simidProtocol.resolve(e)}onSimidRequestPlay(e){if(!this._paused){const t={errorCode:Ca,message:"Player is already in play state"};return Ua.log(`${ya.REQUEST_PLAY} received, rejecting..`,t),this.simidProtocol.reject(e,t)}Ua.log(`${ya.REQUEST_PLAY} received`),this.resumeAd(),this.simidProtocol.resolve(e)}onSimidCreativeFatalError(e){const{errorCode:t,errorMessage:i}=e.args||{errorCode:ba.MESSAGES_NOT_FOLLOWING_SPEC,errorMessage:"Creative provided no error message or error code"};Ua.log(`${ya.FATAL_ERROR} received`,e),this.vastTracker.error({...Rn(),...t&&{ERRORCODE:t}},!0),this.simidProtocol.resolve(e);const n=new Ce(i,{type:ke,code:t});this.publish(Ne.k3.ERROR,n),this.stopAd(4)}onSimidRequestSkip(e){Ua.log(`${ya.REQUEST_SKIP} received`),this.simidProtocol.resolve(e),this.skipAd(),this.publish(Ne.k3.VIDEO_COMPLETE,{endedReason:Ne.Bj.SKIPPED}),this.publish(Ne.k3.STOPPED,{reason:Ne.Bj.SKIPPED})}onSimidRequestStop(e){Ua.log(`${ya.REQUEST_STOP} received`),this.simidProtocol.resolve(e),this.stopAd(4)}onSimidRequestChangeAdDuration(e){const t={errorCode:1203,message:"variableDurationAllowed is false, player does not allow changeAdDuration"};Ua.log(`${ya.REQUEST_CHANGE_AD_DURATION} received, rejecting..`,t),this.publish(Ne.k3.LOG,Ne.r0.SIMID_REQUEST_CHANGE_AD_DURATION),this.simidProtocol.reject(e,t)}onSimidReceiveCreativeLog(e){Ua.log(`${ya.LOG} received`,e)}onSimidRequestNavigation(e){const t={errorCode:1214,message:"Environment does not support navigation"};Ua.log(`${ya.REQUEST_NAVIGATION} received, rejecting..`,t),this.simidProtocol.reject(e,t)}onSimidRequestVolumeChange(e){if(!this.validateMessageFormat(ya.REQUEST_VOLUME,e))return;const{volume:t,muted:i}=e.args;if("number"!=typeof t||t<0||t>1||"boolean"!=typeof i){const t={errorCode:1211,message:"Wrong values given for volume or muted properties"};return Ua.log(`${ya.REQUEST_VOLUME} received, rejecting..`,t),this.simidProtocol.reject(e,t)}this.setAdVolume(t,i),Ua.log(`${ya.REQUEST_VOLUME} received`),this.simidProtocol.resolve(e)}onSimidRequestTracking(e){if(!this.validateMessageFormat(ya.REQUEST_TRACKING,e))return;const{trackingUrls:t}=e.args;Ua.log(`${ya.REQUEST_TRACKING} received`,e.args),this.vastTracker.trackURLs(t,Rn()),this.simidProtocol.resolve(e)}onSimidRequestClickthru(e){if(!this.validateMessageFormat(ya.CLICK_THRU,e))return;const{playerHandles:t,x:i,y:n,url:r}=e.args;if(!r){const t={errorCode:ba.UNSUPPORTED_NAVIGATION_ON_WEB,reason:"Invalid URI"};return Ua.log(`${ya.CLICK_THRU} received, rejecting`,e.args,t),this.simidProtocol.reject(e,t)}Ua.log(`${ya.CLICK_THRU} received`,e.args),this.simidProtocol.resolve(e),t&&this.vastTracker.click(r,{...Rn(),...pn(null,{x:i,y:n})})}onSimidRequestResize(e){const t={errorCode:ba.EXPAND_NOT_POSSIBLE,message:"Linear resize not yet supported."};Ua.log(`${ya.REQUEST_RESIZE} received, rejecting..`,t),this.simidProtocol.reject(e,t)}setDuration(e){this.adDuration=e,this.vastTracker.setDuration(e),this.publish(Ne.k3.DURATION_CHANGE)}_bindMediaListeners(){this._addBoundedMediaEventListener("play",this._onMediaPlay),this._addBoundedMediaEventListener("seeked",this._onMediaSeeked),this._addBoundedMediaEventListener("stalled",this._onMediaStalled),super._bindMediaListeners()}_unbindMediaListeners(){this._removeBoundedMediaEventListener("play"),this._removeBoundedMediaEventListener("seeked"),this._removeBoundedMediaEventListener("stalled"),this._removeBoundedMediaEventListener("timeupdate"),super._unbindMediaListeners()}_onMediaDurationChange(){this.adDuration=this.videoTag.duration,this.setDuration(this.adDuration);const e={duration:this.videoTag.duration};Ua.log(`Sending ${va}`,e),this.simidProtocol.sendMessage(va,e),super._onMediaDurationChange()}_onMediaSeeking(){super._onMediaSeeking(),Ua.log(`Sending ${Ra}`),this.simidProtocol.sendMessage(Ra)}triggerSimidError(e,t){const i={errorMessage:e,errorCode:t};Ua.log(`Sending ${Pa}`,i),this.simidProtocol.sendMessage(Pa,i).then((()=>{const i=new Ce(e,{type:ke,code:t});this.publish(Ne.k3.ERROR,i),this.cleanSimid()}))}stopSimidCreative(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;if(this.simidIframe){this.simidIframe.style.display="none";const t={code:e};Ua.log(`Sending ${fa}`,t),this.simidProtocol.sendMessage(fa,t).then((()=>this.cleanSimid(!0)))}}_onMediaPlay(){Ua.log(`Sending ${ma}`),this.simidProtocol.sendMessage(ma)}_onMediaSeeked(){Ua.log(`Sending ${Ta}`),this.simidProtocol.sendMessage(Ta)}_onMediaStalled(){Ua.log(`Sending ${Sa}`),this.simidProtocol.sendMessage(Sa)}_onMediaError(){super._onMediaError(),this.simidProtocol.sendMessage("Media:error",{error:this.videoTag.error.code,message:this.videoTag.error.message})}_onMediaPlaying(){Ua.log(`Sending ${ga}`),super._onMediaPlaying(),this.simidProtocol.sendMessage(ga)}_onMediaPause(){Ua.log(`Sending ${Aa}`),super._onMediaPause(),this.simidProtocol.sendMessage(Aa)}_onMediaVolumeChange(){const e={volume:this.videoTag.volume,muted:this.videoTag.muted||!1};Ua.log(`Sending ${Da}`,e),super._onMediaVolumeChange(),this.simidProtocol.sendMessage(Da,e)}_onMediaTimeUpdate(){const e={currentTime:this.videoTag.currentTime};this.simidProtocol.sendMessage("Media:timeupdate",e),super._onMediaTimeUpdate()}initAd(e,t,i,n,r){var s,a;let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.creativeData=r,this.playerSize={x:0,y:0,width:e,height:t},this.videoTag=o.videoSlot,this.adVolume=this.videoTag.volume,this.adMuted=this.videoTag.muted||!1,this._viewMode=i,this.loadSimidScript(null==r||null==(s=r.interactiveCreativeFile)?void 0:s.fileURL,o.videoSlot),this.initSimidScript();const d=null==(a=this.mediaFiles)?void 0:a.filter((e=>this._canPlayType(e.mimeType)));if(!d.length){const e="No playable file found";Ua.log(e),this.triggerSimidError(e,1209)}return super.initAd(e,t,i,n,r,o)}startAd(){let{loadBeforePlayback:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.simidInitializationPromise_.catch((e=>{const t=(null==e?void 0:e.reason)||"Cleaning SIMID due to CREATIVE_NOT_REPLIED_TO_INIT",i=(null==e?void 0:e.errorCode)||1212;this.vastTracker.error({...Rn(),ERRORCODE:i},!0);const n=new Ce(t,{type:ke,code:i});this.publish(Ne.k3.ERROR,n),Ua.log(t),this.cleanSimid(!0)}));try{super.startAd({loadBeforePlayback:e})}catch(e){Ua.log("Cleaning SIMID due to MEDIA_ERR_SRC_NOT_SUPPORTED",e),this.triggerSimidError(e.message,e.code||4)}}stopAd(e){return!e&&this.videoTag.duration-this.videoTag.currentTime<=0&&(e=2),this.stopSimidCreative(e),this.resolvedStartCreative||2!==e||(Ua.log("Creative ended without replying to startCreative"),this.vastTracker.error({...Rn(),ERRORCODE:1213},!0)),super.stopAd()}skipAd(){return this.simidProtocol.sendMessage(ka).then((()=>(Ua.log("Skipping the ad"),this.cleanSimid(),super.skipAd())))}resizeAd(e,t,i){const n={width:e,height:t,x:0,y:0};this.simidProtocol.sendMessage("Player:resize",{videoDimensions:n,creativeDimensions:n,fullscreen:"fullscreen"===i}),super.resizeAd(e,t,i),this._viewMode=i}triggerError(e,t){Ua.log(e),this.vastTracker.error({...Rn(),ERRORCODE:t},!0),this.publish(Ne.k3.ERROR,new Ce(e,{type:ke,code:t})),this.cleanSimid()}startCreative(){try{this.simidResolveInitializationPromise_(),Ua.log(`Sending ${La}`),this.simidProtocol.sendMessage(La).then((()=>{this.simidIframe.style.display="block",this.resolvedStartCreative=!0,Ua.log(`${La} successfull`)})).catch((e=>{const t=(null==e?void 0:e.errorCode)||ba.UNSPECIFIED,i=`Cleaning SIMID due to CREATIVE_NOT_REPLIED_TO_START, ${e.reason}`;this.triggerError(i,t)}))}catch(e){Ua.log(e)}}validateMessageFormat(e,t){if(null==t?void 0:t.args)return!0;const i={errorCode:ba.MESSAGES_NOT_FOLLOWING_SPEC,reason:'Missing required "args" property in the message data structure'};return Ua.log(`${e} received, rejecting`,i),this.simidProtocol.reject(t,i),!1}}const Ma=e=>!isNaN(e.xPosition)&&!isNaN(e.yPosition),wa=e=>{let t=A.width/2,i=A.height/2,{xPosition:n,yPosition:r,height:s}=e;return{xPosition:n>=t?"right":"left",yPosition:r+s<=i?"top":"bottom"}};let Fa=[],Ba=[];const xa="unknown",Ha=T("AdStackDM","VAST");class Ka extends Cr{constructor(){super(),this._hasStarted=!1,this._pendingEvents={},this._vastErrorCode=null,this._dmExtension={},this._mixedContentErrors=[],this._companionAds=null,this._adVerifications=null,this._skipAdLogs=null,this._pendingVastClientData=[],this._resetAdData(),this._pendingRequest=null,this._vastTracker=null,this.vastClient=new Qt(0,0,{getItem:()=>{},setItem:()=>{}}),this.vastParser=this.vastClient.getParser(),this.vastClient.addURLTemplateFilter(kn)}fetchAd(e,t){const{fallbackUrl:i,fallbackMethod:n}=t;this._dmExtension=e&&e.extension||{},this._resetAdData();const r=e&&e.getAdSource(),s=this._onErrorVastClientEvent.bind(this),a=this._onResolvingVastClientEvent.bind(this),o=this._onResolvedVastClientEvent.bind(this),d=this._onAdParsedVastClientEvent.bind(this),l=()=>{this.vastParser.on("VAST-error",s),this.vastParser.on("VAST-resolving",a),this.vastParser.on("VAST-resolved",o),this.vastParser.on("VAST-ad-parsed",d)},c=()=>{this.vastParser.off("VAST-error",s),this.vastParser.off("VAST-resolving",a),this.vastParser.off("VAST-resolved",o),this.vastParser.off("VAST-ad-parsed",d)};this._pendingRequest=null;const u=new Promise(((s,a)=>{var o;if(!e||!e.hasSupportedAdSource()){const t=`${ne.UNSUPPORTED_ADSOURCE} (${e?e.errorMessage:"no adBreak"})`;return a(new Ce(t,{type:he}))}let d=(null==r||null==(o=r.adTagURI)?void 0:o.uri)||"xml";n===Ne.w3.URL&&i&&(e.setAdSource({adTagURI:{uri:i,templateType:"vast3"}}),d=i);const u=(null==r?void 0:r.vastAdData)||null;if(null===d&&null===u)return a(new Ce(ne.EMPTY_VAST_DATA_OR_URI,{type:he}));l(),(n===Ne.w3.ADBUFFET?()=>this.vastClient.getNextAds():()=>(this._pendingRequest=tt().CancelToken.source(),"xml"===d?this.vastClient.parseVAST(ji(u),{urlhandler:kr(0,{...t,cancelToken:this._pendingRequest.token}),resolveAll:!1,allowMultipleAds:!0,...Or()}):this.vastClient.get(d,{urlhandler:kr(0,{...t,cancelToken:this._pendingRequest.token}),resolveAll:!1,allowMultipleAds:!0,...Or()})))().then((e=>{c();const t=(null==e?void 0:e.ads[0])||null;this.processDMExtensionData(t),this._setVastVersion(e),s({currentAd:t,remainingAds:this.vastParser.remainingAds?this.vastParser.remainingAds.length:0})})).catch((e=>{c();const t=new Ce(e&&e.message,{type:he});a(t)}))}));return this.getFetchTimePromise(u)}getFetchTimePromise(e){return Yi(di,e).catch((e=>{const t=_i(e);throw this._pendingRequest&&this._pendingRequest.cancel(),t.type===Ee&&(t.message=Lr(this._lastVastURL)?ne.AD_DIRECTOR_REQUEST_TIMEOUT:ne.VAST_WRAPPER_REQUEST_TIMEOUT),this._publishMixedContentErrors(),this._onError(t),t}))}hasSimid(e){var t;let{creative:i}=e;return"SIMID"===(null==(t=i.interactiveCreativeFile)?void 0:t.apiFramework)&&S("PV5_SIMID")}isSkipEnabled(){return!(!nn||!nn.integrator)&&nn.integrator.isSkipEnabled()}initAd(e,t,i,n){var r,s;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5?arguments[5]:void 0;const d=[Ne.k3.LOG,Ne.k3.WILL_START,Ne.k3.IMPRESSION,Ne.k3.VIDEO_START],{ad:l,creative:c}=o;this._vastTracker=this._getTracker(l,c);let u=(this._dmExtension.skipOffset||0)/1e3;var h,E;h=u,E=this._vastTracker.skipDelay,h&&(h<E||!E||E<0)?this._vastTracker.setSkipDelay(u):u=this._vastTracker.skipDelay,nn.integrator=this._createIntegrator(o,this._vastTracker),this._unbindDefaultListeners(),this._bindDefaultListeners({include:d});let p=(null==(r=c.adParameters)?void 0:r.value)||null;var _;"nonlinear"===c.type&&(p=(null==(_=this._getCreativeVariation(c).adParameters)?void 0:_.value)||null);const v={AdParameters:p,..."SIMID"===(null==(s=c.interactiveCreativeFile)?void 0:s.apiFramework)&&{interactiveCreativeFile:c.interactiveCreativeFile}};return this._hasStarted=!1,this._pendingEvents={},this._adPause=!!a.adPause&&this._dmExtension.adPause,this._integratorType=o.integratorType,this._adVerifications=l.adVerifications,this._logIfOmidNeeded(l.adVerifications),this._logTopicsApi(),this._skipOffset=u,this._companionAds=function(e,t){const i=e&&e.creatives&&!!e.creatives.length&&e.creatives.filter((e=>!("companion"!==e.type||e.sequence!=t.sequence&&t.sequence&&e.sequence)))||[];return i.length&&Gi.log("Got companion creatives",i),i}(l,c),nn.integrator.initAd(e,t,i,n,v,a).then((i=>{var n,r,s,a,c,u,h;return this._publishMixedContentErrors(),this._bindDefaultListeners({exclude:d}),this._overrideDefaultListener(Ne.k3.STOPPED,this._onStopped,this),this._overrideDefaultListener(Ne.k3.SKIPPED,this._onSkipped,this),this._overrideDefaultListener(Ne.k3.ERROR,this._onError,this),this.publish(Ne.k3.LOADED,{adCreativeId:this._adCreativeId,adSystem:this._adSystem,adTitle:this._adTitle,inventoryId:this._inventoryId,provider:this._provider,buyerType:this._buyerType,integrator:this._integratorType,hasClickThru:nn.integrator.vastTracker&&nn.integrator.vastTracker.clickThroughURLTemplate&&nn.integrator.vastTracker.clickThroughURLTemplate.url,mimeType:(null==(n=nn.integrator)||null==(r=n.mediaFile)?void 0:r.mimeType)||null,height:(null==(s=nn.integrator)||null==(a=s.mediaFile)?void 0:a.height)||null,width:(null==(c=nn.integrator)||null==(u=c.mediaFile)?void 0:u.width)||null,companionAds:this._companionAds,displayedCompanion:this._handleDisplayedCompanion(l,null==i?void 0:i.adType),skipOffset:this._skipOffset,adVerifications:this._adVerifications,vastTracker:this._vastTracker,injectedAdSlot:null!=(h=null==i?void 0:i.adSlot)?h:null,vastVersion:this._vastVersion,adType:(null==i?void 0:i.adType)||"video",mediaFileDuration:this.getAdDuration(),hasSimid:this.hasSimid(o),...this.getAdPodInfo(),...this._getDmxInfos(),...this._getDvaExtensionInfos()}),this._checkAdRatio(e,t),nn.integrator})).catch((e=>{this._publishMixedContentErrors(),this._onError(e)}))}_checkAdRatio(e,t){const i=this._getAdSize();i&&e/t!=i.width/i.height&&this.publish(Ne.k3.RATIO_CHANGE,{contentType:"ad",contentWidth:i.width,contentHeight:i.height,details:{adType:this._adType}})}_handleDisplayedCompanion(e,t){if(!this._companionAds||"audio"!==t)return null;const i=function(e){if(!e||!e.length)return null;let t=null,i=null,n=null;return e.some((e=>!(!e.variations||!e.variations.length)&&e.variations.some((r=>!!(r.staticResources&&r.height&&r.width)&&(n=r.staticResources.find((e=>e.url&&Ne.VS.$U.includes(e.creativeType))),!!n&&(t=e,i=r,!0)))))),t?{creative:t,variation:i,resource:n}:null}(this._companionAds);if(!i)return null;const n=new $t(null,e,i.creative,i.variation);return{...i,vastTracker:n}}_logVpaidEarlyEvents(){const e=Object.keys(this._pendingEvents).filter((e=>[Ne.L0.Hw,Ne.L0.nt,Ne.L0.Om].includes(e)));e.length&&this.publish(Ne.k3.LOG,{...Ne.r0.VPAID_EARLY_START_AD_EVENT,value:e.join(",")})}startAd(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._logVpaidEarlyEvents(),nn.integrator.startAd(e).catch((e=>{this._onError(e),nn.integrator=null}))}stopAd(e){return this._clean(),null===nn.integrator?(this.publish(Ne.k3.STOPPED),Promise.resolve()):nn.integrator.stopAd().then((()=>{this.publish(Ne.k3.STOPPED,{reason:e})})).catch((e=>{this.publish(Ne.k3.ERROR,e)})).finally((()=>{nn.integrator=null,ln()}))}skipAd(){return this._clean(),null===nn.integrator?Promise.resolve():nn.integrator.skipAd().then((e=>{this._skipAdLogs=e,this.publish(Ne.k3.SKIPPED)})).catch((e=>{this.publish(Ne.k3.ERROR,e)})).finally((()=>{nn.integrator=null,ln()}))}getSkipAdLogs(){return this._skipAdLogs||{}}resizeAd(e,t,i){nn.integrator.resizeAd(e,t,i),this.publish(Ne.k3.RESIZE_AD_REQUESTED,{width:e,height:t,viewMode:i})}pauseAd(){nn.integrator.pauseAd()}resumeAd(){nn.integrator.resumeAd()}getAdPodInfo(){return null==nn.integrator.getAdPodInfo?void 0:nn.integrator.getAdPodInfo()}publish(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];const r=i&&i.length?i[0]:{};!this._hasStarted&&this._eventCanBeDelayed(e)?(this._logEvent(e,{type:"delaying"},r),this._pendingEvents[e]=i):(this._logEvent(e,{},r),super.publish(e,...i),e===Ne.k3.STARTED&&this._publishPendingEvents(r))}getSupportedCreative(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((t,i)=>{try{var n,r,s,a,o,d,l;const i=function(e,t){var i;let n={integratorType:null,mediaFiles:[],error:void 0};return null==e||null==(i=e.creatives)||i.forEach((i=>{let r={};switch(i.type){case"linear":r=function(e){return e.reduce(((e,t)=>("VPAID"===t.apiFramework&&Ne.VS.xq.includes(t.mimeType)?e.vpaid.push(t):"IMA"===t.apiFramework&&Ne.VS.xq.includes(t.mimeType)?e.ima.push(t):Ne.VS.Kd.includes(t.mimeType)||S("PV5_AUDIO_ADS_POC")&&Ne.VS.Aq.includes(t.mimeType)?e.stream.push(t):e.others.push(t),e)),{vpaid:[],stream:[],ima:[],others:[]})}(i.mediaFiles);break;case"nonlinear":r=function(e){return e.variations.reduce(((e,t)=>("IMA"===t.apiFramework&&Ne.VS.xq.includes(t.type)?e.ima.push(t):Ne.VS.Kd.includes(t.type)?(t.fileURL=t.staticResource,t.mimeType=t.type,e.stream.push(t)):e.others.push(t),e)),{vpaid:[],stream:[],ima:[],others:[]})}(i);break;default:return}r.stream.length?n={integratorType:Ne.Z4.iF,ad:e,creative:i,mediaFiles:r.stream}:r.ima.length?n={integratorType:$i()?Ne.Z4.Vf:Ne.Z4.Hs,ad:e,creative:i,mediaFiles:r.ima}:r.vpaid.length?n={integratorType:Ne.Z4.cV,ad:e,creative:i,mediaFiles:r.vpaid}:r.others.length&&(t.trackVastError(e.errorURLTemplates,{ERRORCODE:403}),n={integratorType:null,ad:e,creative:i,mediaFiles:r.others})})),n}(e,this.vastParser);if(i.ad&&(i.ad.extensions&&(this._dmExtension={...this._dmExtension,...Qi(i.ad.extensions)},this._dmExtension.adSaveDataUrl?Li.enableLogging():Li.clean()),this._dmExtension.timeout&&((e=>{ei=e,ti=e})(u=this._dmExtension.timeout),Vi.log(`setAdUnitTimeout: ${u}`))),this._adCreativeId=(null==i||null==(n=i.creative)?void 0:n.id)||null,this._adSystem=(null==i||null==(r=i.ad)||null==(s=r.system)?void 0:s.value)||null,this._adTitle=(null==i||null==(a=i.ad)?void 0:a.title)||null,this._inventoryId=this._dmExtension.inventoryId||null,this._provider=this._dmExtension.provider||xa,this._buyerType=this._dmExtension.buyertype||xa,this._bid=this._dmExtension.bid||null,this._sid=this._dmExtension.sid||null,this._cid=this._dmExtension.cid||null,this._adid=this._dmExtension.adid||null,this._crid=this._dmExtension.crid||null,this._did=this._dmExtension.did||null,this._bidid=this._dmExtension.bidid||null,this._pid=this._dmExtension.pid||null,this._siteid=this._dmExtension.siteid||null,this._fallbackUrl=this._dmExtension.fallbackUrl||null,this._adType=this._dmExtension.adType||"",this._isDvaEnabled=this._dmExtension.dva||null,this._dvaWr=this._dmExtension.wr||null,this._dvaAccVpaid=this._dmExtension.acc_vpaid||null,this._dvaAccVpaidInner=this._dmExtension.acc_vpaid_inner||null,this._dvaProvider=this._dmExtension.acc_provider||null,this._skipType=this._dmExtension.skipType||null,this._gppString=(null==(o=this._dmExtension.macros)?void 0:o.GPPSTRING)||null,this._gppSectionId=(null==(d=this._dmExtension.macros)?void 0:d.GPPSECTIONID)||null,we.value=this._dmExtension.server_idx,this._dmExtension.adom&&(this._adom=this._dmExtension.adom.length?this._dmExtension.adom.join():null),nn.icons=(null==(l=i.creative)?void 0:l.icons)||[],nn.hasIconsCollision=(c=nn.icons,N().isOnsite()&&c.length?c.some(((e,t)=>c.slice(t+1).some((t=>((e,t)=>{if(isNaN(e.xPosition)||isNaN(e.yPosition)||isNaN(t.xPosition)||isNaN(t.yPosition))return!1;let i=e.xPosition<=t.xPosition+t.width&&e.xPosition+e.width>=t.xPosition,n=e.yPosition<=t.yPosition+t.height&&e.yPosition+e.height>=t.yPosition;return i&&n})(e,t)||((e,t)=>{if(Ma(e)&&Ma(t))return!1;const i=Ma(e)?wa(e):e,n=Ma(t)?wa(t):t;return i.xPosition===n.xPosition&&i.yPosition===n.yPosition})(e,t))))):null),ee.dispatchEvent(te.AD_DATA_UPDATED,{adData:{inventoryId:this._inventoryId,adCreativeId:this._adCreativeId,bidid:this._bidid,bid:this._bid,did:this._did}}),!i.integratorType||i.error){const e=(h=i,(E=this._dmExtension).noAd?new Ce(E.noAd.reason,{type:ae,code:E.noAd.reasonId}):h.error&&h.error.type&&h.error.message?new Ce(h.error.message,{type:h.error.type,adSystem:null!=(p=null==h||null==(_=h.ad)||null==(v=_.system)?void 0:v.value)?p:null,adTitle:null!=(A=null==h||null==(m=h.ad)?void 0:m.title)?A:null,inventoryId:E.inventoryId||null,provider:E.provider||"unknown",buyerType:E.buyertype||"unknown",bid:E.bid||"unknown",sid:E.sid||"unknown",adom:E.adom||"unknown",cid:E.cid||"unknown",adid:E.adid||"unknown",crid:E.crid||"unknown",did:E.did||"unknown",bidid:E.bidid||"unknown",pid:E.pid||"unknown",dva:E.dva||"unknown",dva_provider:E.acc_provider||"unknown",dva_vpaid:E.acc_vpaid||"unknown",dva_vpaid_inner:E.acc_vpaid_inner||"unknown",dva_wr:E.wr||0,integrator:h.integratorType,fallbackUrl:E.fallbackUrl||null}):new Ce(h.mediaFiles.length?ne.NO_SUPPORTED_CREATIVE:ne.NO_FILL,{type:pe}));throw e.updateProperties({hasRemainingAds:this.vastClient.hasRemainingAds()}),e}if(this._isNoRepeatedCreativeFeatureEnabled(i.integratorType)&&(e=>{let{vastCreativeId:t,dmxCreativeId:i}=e;return Ba.some((e=>i===e))||Fa.some((e=>t===e))})({vastCreativeId:this._adCreativeId,dmxCreativeId:this._crid}))throw new Ce(ne.CREATIVE_ALREADY_PLAYED_IN_SLOT,{type:pe,hasRemainingAds:this.vastClient.hasRemainingAds()});t(i)}catch(e){let t=e;e instanceof Ce||(t=new Ce(ne.SUPPORTED_CREATIVE_ERROR,{type:pe})),this._onError(t),i(t)}var c,u,h,E,p,_,v,A,m}))}_isNoRepeatedCreativeFeatureEnabled(e){if(e===Ne.Z4.Hs)return!1;const t=C()&&S("PV5_AD_SLOT_PREVENT_SAME_CREATIVE_ID_ONSITE"),i=!C()&&S("PV5_AD_SLOT_PREVENT_SAME_CREATIVE_ID_OFFSITE");return t||i}getEstimatedBitrate(){return this.vastParser.getEstimatedBitrate()}_publishPendingEvents(e){(0,Je.nextTick)((()=>{this._hasStarted=!0,Object.entries(this._pendingEvents).forEach((t=>{let[i,n]=t;this._logEvent(i,{type:"delayed"},e),super.publish(i,...n)})),this._pendingEvents={}}))}_onStopped(e){this._clean(),this.publish(Ne.k3.STOPPED,e)}_onSkipped(){this._clean(),this.publish(Ne.k3.SKIPPED)}_onError(e){var t;const i=_i(e,{code:this._vastErrorCode||e.code,adSystem:this._adSystem,adTitle:this._adTitle,inventoryId:this._inventoryId,provider:this._provider,buyerType:this._buyerType,integrator:this._integratorType,fallbackUrl:this._fallbackUrl,lastVastUrl:this._lastVastURL||null,internalCode:e.code,vastVersion:this._vastVersion,hasRemainingAds:this.vastClient.hasRemainingAds(),timeoutInfo:Fi(),...this._getDmxInfos(),...this._getDvaExtensionInfos()});this.publish(Ne.k3.ERROR,i),this._vastErrorCode=null,null==(t=nn.integrator)||t._clean()}_createIntegrator(e,t){const{integratorType:i,mediaFiles:n}=e;switch(i){case Ne.Z4.cV:return new da({mediaFiles:n,vastTracker:t});case Ne.Z4.iF:return this.hasSimid(e)?(e=>new Va(e))({mediaFiles:n,vastTracker:t}):(e=>new ua(e))({mediaFiles:n,vastTracker:t});case Ne.Z4.Hs:return(e=>new Gs(e))({mediaFiles:n,vastTracker:t});case Ne.Z4.Vf:return(e=>new pa(e))({mediaFiles:n,vastTracker:t})}}_getCreativeVariation(e){return e.variations&&e.variations.length>0?e.variations[0]:null}_getTracker(e,t){return new $t(this.vastClient,e,t,this._getCreativeVariation(t))}_publishMixedContentErrors(){this._mixedContentErrors.forEach((e=>{this.publish(Ne.k3.LOG,{...Ne.r0.VAST_URI_MIXED_CONTENT,adSystem:e.system.value,inventoryId:this._dmExtension.inventoryId||null,provider:this._dmExtension.provider||xa,buyerType:this._dmExtension.buyertype||xa,...this._getDmxInfos(),...this._getDvaExtensionInfos()})})),this._mixedContentErrors=[]}_getDmxInfos(){const e={bid:this._bid,sid:this._sid,adom:this._adom,cid:this._cid,adid:this._adid,crid:this._crid,did:this._did,bidid:this._bidid,pid:this._pid,siteid:this._siteid,skipType:this._skipType,gppString:this._gppString,gppSectionId:this._gppSectionId};if(this._integratorType===Ne.Z4.Hs)try{var t,i;const n=null==(t=nn.integrator)||null==(i=t.adsManager)?void 0:i.getCurrentAd();n&&(e.adom=n.getAdvertiserName(),e.cid=n.getCreativeId(),e.adid=n.getAdId(),e.crid=null==n.getCreativeAdId?void 0:n.getCreativeAdId())}catch(e){Ha.log("Error retreiving Dmx infos:",e)}return e}_getDvaExtensionInfos(){return{dva:this._isDvaEnabled||!1,dva_provider:this._dvaProvider,dva_vpaid:this._dvaAccVpaid,dva_vpaid_inner:this._dvaAccVpaidInner,dva_wr:this._dvaWr||0}}_onErrorVastClientEvent(e){Ha.warn("Parsing error received",e);const t=this._pendingVastClientData.length;t&&(Bs({...this._pendingVastClientData[t-1],action:Vs,responseType:Ms,component:bs}),this._pendingVastClientData.splice(-1,1)),e.extensions&&(this._dmExtension={...this._dmExtension,...Qi(e.extensions)}),e.ERRORMESSAGE===ne.BAD_PROTOCOL&&this._mixedContentErrors.push(e),this._vastErrorCode=e.ERRORCODE||null}_onResolvingVastClientEvent(e){1===e.wrapperDepth&&this.processDMExtensionData(e.wrapperAd),this._lastVastURL=e.url,Bs({...e,action:Ns,component:bs})}_onResolvedVastClientEvent(e){const t=e.statusCode===vi;t||e.error?Bs({...e,action:Vs,responseType:t?ws:Ms,component:bs}):this._pendingVastClientData.push(e),Li.add(e)}_onAdParsedVastClientEvent(e){const t=this._pendingVastClientData.findIndex((t=>t.url===e.url&&t.wrapperDepth===e.wrapperDepth));-1!==t?(Bs({...this._pendingVastClientData[t],action:Vs,responseType:e.type,vastVersion:e.vastVersion,component:bs}),this._pendingVastClientData.splice(t,1)):Ha.log("Ad call logs: Missing resolved data for",e)}processDMExtensionData(e){if(!e)return;const t={...this._dmExtension,...Qi(e.extensions)};t.adSaveDataUrl&&Li.setEndpointUrl(t.adSaveDataUrl),ee.dispatchEvent(te.AD_DATA_UPDATED,{adData:{inventoryId:t.inventoryId||null,bidid:t.bidid||null,bid:t.bid||null,did:t.did||null}})}_clean(){Ha.log("Removing listeners"),this._unbindDefaultListeners(),this.destroyFocusDetection&&this.destroyFocusDetection()}_logEvent(e){let{type:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;if(e!==Ne.k3.SKIPPABLE_REMAINING_TIME_CHANGE&&e!==Ne.k3.REMAINING_TIME_CHANGE){try{const t="queryString"===H("apimode");"postMessage"===H("api")&&t||Nr(e,i)}catch(e){Ha.log("Error with external output: ",e)}switch(t){case"delaying":Ha.log(`Received ${e}. Delaying until start ad phase.`);break;case"delayed":Ha.log("Publishing delayed",e);break;default:Ha.log("Received",e)}}}_eventCanBeDelayed(e){return-1===[Ne.k3.ERROR,Ne.k3.LOADED,Ne.k3.LOG,Ne.k3.STARTED,Ne.k3.STOPPED,Ne.k3.WILL_START].indexOf(e)}_getAdSize(){var e;const t=null==(e=nn.integrator)?void 0:e.mediaFile;return t&&parseInt(t.height)&&parseInt(t.width)?{width:t.width,height:t.height}:null}_setVastVersion(e){this._vastVersion=e&&e.version?e.version:null}_resetAdData(){this._adCreativeId=null,this._adSystem=null,this._adTitle=null,this._fallbackUrl=null,this._integratorType=null,this._inventoryId=null,this._provider=null,this._buyerType=null,this._bid=null,this._sid=null,this._adom=null,this._cid=null,this._adid=null,this._crid=null,this._did=null,this._bidid=null,this._pid=null,this._siteid=null,this._vastVersion=null,this._isDvaEnabled=null,this._dvaWr=null,this._dvaAccVpaid=null,this._dvaAccVpaidInner=null,this._dvaProvider=null,this._skipType=null}_logIfOmidNeeded(e){if(!e)return;const t=[];e.forEach((e=>{var i;"OMID"===(null==(i=e.apiFramework)?void 0:i.toUpperCase())&&t.push(e.vendor)})),t.length>0&&this.publish(Ne.k3.LOG,{...Ne.r0.OMID_NEEDED,value:t.toString()})}async _logTopicsApi(){var e;if(!(b()&&S("PV5_TOPICS_API")&&(null==(e=document)?void 0:e.browsingTopics)&&document.featurePolicy.allowsFeature("browsing-topics")))return!1;const t=await document.browsingTopics();return Ha.log("Topics API has been observed"),!!(null==t?void 0:t.length)&&(this.publish(Ne.k3.LOG,{...Ne.r0.TOPICS_API,value:JSON.stringify(t)}),!0)}}const Ya=T("Ads");let Ga=null,Qa=null,$a=null,ja=null,qa=null,Wa=null,za=[],Xa=[];const Za=e=>{lo(),null===Qa&&e&&(Wa=new Ka)},Ja=()=>Wa,eo=e=>{let{fallbackMethod:t,fallbackUrl:i,isRealAutoplay:n=!1,adPause:r=!1,proxyInitProtection:s=!1,volume:a=!1,videoSlotCanAutoPlay:o=!0}=e;return{adPause:r,position:Ze.position,isRealAutoplay:n,proxyInitProtection:s,videoSlotCanAutoPlay:o,videoSlot:x(),fallbackMethod:t,fallbackUrl:i,...a&&{volume:a}}},to=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Ga)return Ga;const t=Wa.fetchAd(e.adBreak,eo(e)).then((e=>{let{currentAd:t,remainingAds:i}=e;return He.value=S("PV5_AD_BUFFET")?i:0,t})).catch((e=>{throw e}));return Ga=co(t),Ga},io=function(){let{creative:e,onAdWillStartEarly:t,initAdOptions:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Ya.log("initAd"),Qa)return Qa;const n=new Promise(((n,r)=>{const s=()=>{ho(a,Ne.k3.LOADED),ho(d,Ne.k3.ERROR),ho(o,Ne.k3.WILL_START)},a=e=>{s(),n(e)},o=()=>{"function"==typeof t&&t()},d=e=>{s(),r(e)};uo(a,Ne.k3.LOADED),uo(o,Ne.k3.WILL_START),uo(d,Ne.k3.ERROR);const{width:l,height:c}=A;try{Wa.initAd(l,c,"normal",600,eo(i),e)}catch(e){d(new Ce(e.message,{type:pe}))}}));return Qa=co(n),Qa},no=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if($a)return $a;const t=new Promise(((t,i)=>{const n=()=>{ho(r,Ne.k3.STARTED),ho(s,Ne.k3.ERROR)},r=e=>{n(),Wa.hasBufferStep=!0,Wa.adData=e,t(Wa)},s=e=>{n(),i(e)};uo(r,Ne.k3.STARTED),uo(s,Ne.k3.ERROR);try{Wa.startAd(e)}catch(e){s(new Ce(e.message,{type:ve}))}}));return $a=co(t),$a},ro=()=>qa||(qa=new Promise((e=>{const t=i=>{ho(t,Ne.k3.SKIPPED),ho(t,Ne.k3.ERROR),e(i)};uo(t,Ne.k3.SKIPPED),uo(t,Ne.k3.ERROR);try{Wa.skipAd()}catch(e){t(new Ce(e.message,{type:De}))}})),qa),so=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null===Wa?(Ya.log("callStopAd: nothing to stop"),Promise.resolve()):ja||(Ya.log("callStopAd: creating new promise"),ja=new Promise((t=>{const i=e=>{ho(i,Ne.k3.STOPPED),ho(i,Ne.k3.ERROR),t(e)};uo(i,Ne.k3.STOPPED),uo(i,Ne.k3.ERROR),setTimeout((()=>{try{Wa.stopAd(e)}catch(e){i(new Ce(e.message,{type:Re}))}}),0)})).catch((()=>Ya.error("callStopAd: error!"))).finally((()=>Ya.log("callStopAd: finished"))),ja)},ao=()=>so(),oo=()=>{const e=new Ce(ne.AD_UNIT_CANCEL,{type:le});za.forEach((t=>{t.forceReject(e)})),za=[],Eo(),lo()},lo=()=>{Ga=null,Qa=null,$a=null,ja=null,qa=null},co=e=>{const t=(e=>{let t,i;const n=new Promise(((e,n)=>{t=e,i=n})),r=Promise.race([e,n]);return r.forceResolve=t,r.forceReject=i,r})(e);return za.push(t),t.catch((e=>{throw e&&e.type===le&&Wa&&(Ya.log("VPAID aborted, calling stopAd"),Wa.stopAd()),e}))},uo=(e,t)=>{Xa.push({event:t,handler:e}),Wa&&Wa.subscribe(e,t)},ho=(e,t)=>{Xa.forEach(((i,n,r)=>{i.event===t&&i.handler===e&&(Wa&&Wa.unsubscribe(i.handler,i.event),r.splice(n,1))}))},Eo=()=>{Wa&&Xa.forEach((e=>{Wa.unsubscribe(e.handler,e.event)})),Xa=[]},po={unsubscribeAll:Eo};var _o=i(4784),vo=i(6120);const Ao=T("Ads","HeavyAds"),mo="HeavyAdIntervention",go=e=>{if(!e)return;const t=[];e.forEach((e=>{var i;if((null==(i=e.body)?void 0:i.id)===mo){const i=So(e.body.message);b()?t.push(i):((0,_o.z2)(i),vo.UD._emitEvents(!0),Ao.log("Sent Event Bus event",i))}})),b()&&(Ao.log("Sending reports to PES",e),ee.dispatchEvent(te.PLAYER_HEAVYADSINTERVENTION_CHANGED,{playerHeavyAdsInterventionReports:[...e],playerHeavyAdsEvents:t}))},To=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!("ReportingObserver"in window))return void Ao.log("ReportingObserver not supported",e);Ao.log("Observing",e);const n=new window.ReportingObserver((e=>{Ao.log("Got reports (ReportingObserver)",e),t(e)}),{types:["intervention"],buffered:!0});null!==i&&i>=0&&N().context("is_dm_network")&&(Ao.log(`Emulating Heavy Ads in ${i}ms`),setTimeout((()=>{const e=[{body:{id:mo,message:"Ad was removed (emulation)"}}];Ao.log("Got reports (emulation)",e),t(e)}),i)),n.observe(),e.addEventListener("pagehide",(()=>{const e=n.takeRecords();Ao.log("Got reports (pagehide)",e),t(e)}))},Ro=e=>{if(!e)return;const t=e.find((e=>{var t;return(null==(t=e.body)?void 0:t.id)===mo}));t&&ee.dispatchEvent(te.AD_ERROR,new Ce(t.body.message,{type:le}))},So=e=>{let t=null;try{const e=Ja()||{};t=e.getAdRemainingTime?e.getAdRemainingTime():null}catch(e){}const i={ad_remaining_ms:t,ad_running:nn.isAdSlotRunning,autoplay:K().autoplay||H("autoplay").enable||!1,embedder:N().getEmbedder(),intervention_message:e,playback_is_paused:G().isPaused,playback_is_playing:G().isPlaying,top_domain:N().getTopDomain(),inventory_id:nn.inventoryId,bid_id:nn.bidid,bidder_id:nn.bid,deal_id:nn.did,view_id:V("viewId")};return(0,_o.i5)({name:"advertising.heavyAdsIntervention",data:i})};function Do(e){let{id:t,siblingNode:i,url:n,style:r={}}=e;return new Promise(((e,s)=>{const a=document.createElement("iframe");S("PV5_IFRAME_ALLOW_ATTRIBUTES")&&(a.allow="accelerometer; ambient-light-sensor; battery; camera; gyroscope; magnetometer; microphone;"),a.id=t,a.style.border="none",Object.keys(r).forEach((e=>{a.style[e]=r[e]})),a.scrolling="no",i.parentNode.insertBefore(a,i.nextSibling),a.contentWindow.document.open().write('<body onload="window.onBodyLoaded(document)" style="margin:0"></body>'),a.contentWindow.onBodyLoaded=t=>{const i=t.createElement("script");i.src=n,i.addEventListener("load",(()=>{e(a)})),i.addEventListener("error",(()=>{s(a)})),t.body.appendChild(i)},a.contentWindow.document.close(),To(a.contentWindow,Ro)}))}const Io=T("Ads","IMASdkHandler"),Lo=new class{constructor(){this.videoSlot=null,this.containerSlot=null,this.iFrame=null,this.adUnit=null,this.adsLoader=null,this.adDisplayContainer=null}async load(e){let{locale:t,videoElement:i}=e;this.videoSlot=i;const n={id:"ima_frame_sdk",siblingNode:this.videoSlot,url:"https://imasdk.googleapis.com/js/sdkloader/ima3.js",style:{"pointer-events":"none",width:0,height:0,display:"none"}};try{const e=await Do(n);I().imaIframeCallback.start(),this.iFrame=e,this.setImaContainerSlot(),this.setAdUnit(),this.initAdUnitSettings({locale:t}),this.adDisplayContainer=new this.adUnit.AdDisplayContainer(this.containerSlot,this.videoSlot),this.adsLoader=new this.adUnit.AdsLoader(this.adDisplayContainer),Io.log("IMA sdk loaded"),I().imaIframeCallback.end(),ee.dispatchEvent(te.AD_SLOT_INJECTED,{element:this.containerSlot})}catch(e){I().imaIframeCallback.end(),Io.log("IMA sdk cannot be loaded"),this.unload(),ee.dispatchEvent(te.AD_STACK_ERROR,{adError:new Ce("IMA SDK load failed",{type:oe})})}}setAdUnit(){this.adUnit=this.iFrame.contentWindow.google.ima}setImaContainerSlot(){this.containerSlot=document.createElement("div"),this.containerSlot.className="ad_slot",this.containerSlot.style["pointer-events"]="none",this.containerSlot.style.display="none",this.videoSlot.parentNode.insertBefore(this.containerSlot,this.iFrame.nextSibling)}initAdUnitSettings(e){let{locale:t}=e;this.adUnit.settings.setLocale(t),this.adUnit.settings.setPlayerType("dailymotion/player-html5"),this.adUnit.settings.setPlayerVersion("5.0.0"),S("PV5_ENABLE_IMA_OMSDK")&&this.adUnit.settings.setFeatureFlags({enableOmidBeta:!0}),this.adUnit.settings.setVpaidMode(this.adUnit.ImaSdkSettings.VpaidMode.INSECURE),this.adUnit.settings.setNumRedirects(9)}catchUserAction(){this.adDisplayContainer&&(Io.log("adDisplayContainer initialized (user action)"),this.adDisplayContainer.initialize(),re.N.isIphone(N())&&this.videoSlot.load())}isIMALoaded(){return!!this.adUnit}prepareImaContainerSlot(){if(!this.containerSlot)return;this.containerSlot.style.display="",this.containerSlot.style["pointer-events"]="auto";const e=this.containerSlot.querySelector("video");e&&(e.style.backgroundColor="inherit")}getImaContainerSlot(){return this.containerSlot}cleanAdUnit(){this.containerSlot&&(this.containerSlot.style.display="none",this.containerSlot.style["pointer-events"]="none")}notifyContentVideoEnd(){this.adsLoader&&(Io.log("notifying IMA that the content video is completed"),this.adsLoader.contentComplete())}unload(){this.containerSlot&&(this.containerSlot.parentNode.removeChild(this.containerSlot),this.containerSlot=null),this.iFrame&&(this.iFrame.parentNode.removeChild(this.iFrame),this.iFrame=null),this.videoSlot=null,Io.log("IMA sdk unloaded")}isLoaded(){return!!this.iFrame}},ko=T("Ads","CookieSync"),fo=()=>{let e=0;const t=()=>{if(5===e)return ee.removeEventListener(te.PLAYER_VIDEO_SELECTED,t),void ko.log("CookieSync aborted, 5 cap reached");ko.log("Calling CookieSync after video selected"),i()};ko.log("Trying CookieSync on every new video"),ee.addEventListener(te.PLAYER_VIDEO_SELECTED,t);const i=()=>{const{getTcfConsentString:e,isEnabledForTcf:t}=D();if(t()){ko.log("Infopack available for CookieSync");const t=()=>{ko.log("Calling CookieSync after consent resolved"),ee.removeEventListener(te.PLAYER_GDPR_CONSENT_COLLECTION_RESOLVED,t),n()};if(B().consent.gdprConsentCollectionRequested)return ko.log("Consent already requested, waiting for resolution"),void ee.addEventListener(te.PLAYER_GDPR_CONSENT_COLLECTION_RESOLVED,t);if(""===e())return ko.log("Requesting consent"),ee.addEventListener(te.PLAYER_GDPR_CONSENT_COLLECTION_RESOLVED,t),void ee.dispatchEvent(te.PLAYER_GDPR_CONSENT_COLLECTION_REQUESTED)}ko.log("Calling CookieSync without waiting for Infopack"),n()},n=()=>{const t=R()?(e=>{const t=Sr(),i=e.context("reader_id")||0;return{stage:`${t.stage}?bs=1&rid=${i}`,prod:`${t.prod}?bs=1&rid=${i}`}[Dr(e)]})(N()):V("adSyncScriptUrl");if(!S("PV5_AD_COOKIE_SYNC"))return!1;if(!f())return!1;if(!t)return ko.log("CookieSync URL not available for this video"),!1;e++;const i={cookie_sync_ab_gk:S("PV5_COOKIE_SYNC_AB_TEST")?"1":"0",...Gn(),...tr(),...W(),...Qn(),...Bn()},n=re.h.appendEncodedQueryParameters(t,i),r=document.createElement("script");return r.src=n,r.async=!0,document.body.appendChild(r),ko.log("Doing ad cookie sync, url:",n),!0}},Po=()=>{const e=C(),t=j();if(t.isConnecting||t.isActive)return Ne.dx.CHROMECAST_SESSION;const i=e&&!S("PV5_ADS_ON_REPLAY_ONSITE"),n=!e&&!S("PV5_ADS_ON_REPLAY_OFFSITE");return Q().isReplay&&(i||n)?Ne.dx.VIDEO_REPLAY:void 0},yo=()=>{if(Po())return Po();switch(Ze.position){case Ne.ev.PREROLL:return(()=>{if(Q().isReloadingLiveAfterPause)return Ne.dx.NON_DVR_LIVE_PLAYBACK_TOGGLING})();case Ne.ev.MIDROLL:return Q().isSchedulerEnabled?S("PV5_LIVE_MIDROLL_DISABLED")&&Y().isLive?Ne.dx.LIVE_MIDROLL_DISABLED:Y().mimeType!==Ne.VS.Od?Ne.dx.STREAM_NOT_HLS:void 0:Ne.dx.SCHEDULER_DISABLED;case Ne.ev.LIVEADBREAK:return(()=>{if(!Q().isSchedulerEnabled)return Ne.dx.SCHEDULER_DISABLED;if(G().isPaused)return Ne.dx.LIVE_ADBREAKS_PAUSED_PLAYBACK;const{isVideoSeekable:e,isCurrentTimeDVR:t}=G();return e&&!t?Ne.dx.LIVE_ADBREAKS_DVR_NOT_LIVE:void 0})()}},Oo=T("Player","Scheduler","AdsScheduling");let bo=0,Co=null,No=null;const Uo=()=>{Co=null},Vo=()=>{wo()||(Co=G().currentTime)},Mo=()=>{if(Ze.linearSlotStarted)return;const e=Math.trunc(G().currentTime);bo>0&&No!==e&&(bo--,No=e)},wo=()=>Fo()&&Boolean(bo),Fo=()=>(N().isOnsite()?S("PV5_MIDROLL_RETAKE_ONSITE"):S("PV5_MIDROLL_RETAKE_OFFSITE"))&&Bo(),Bo=()=>V("duration")>=1200,xo=()=>{!bo&&Ze.current.isARetake&&(bo=120)},Ho=()=>Z("waitForCustomConfigDelay",6),Ko=()=>H("waitForCustomConfig"),Yo=e=>{if(!e.some((e=>{let{requested:t,isDelayed:i}=e;return!t&&i})))return e.find((e=>{let{requested:t,isDelayed:i}=e;return!t&&!i}))},Go=()=>{if(Ze.current&&Ze.position&&!nn.isNonLinear&&nn.hasStarted)return Yo(Ld())},Qo=()=>{if(!Ze.adBreaks.midrolls.length||Ze.current||wo())return;const e=G().currentTime,t=Ze.adBreaks.midrolls.filter((t=>{let{requested:i,cuepoint:n}=t;return n-Ho()-vd<=e&&e<=n+vd&&!i}));return Yo(t)},$o=()=>{const{currentTime:e,videoDuration:t}=G();if(!(t-e>Ho()||Ze.current||wo()))return Yo(Ze.adBreaks.postrolls)},jo=(e,t)=>{e.delay(te.PLAYER_API_SET_CUST_CONFIG,Oo),Ze.nextPosition=t,ee.dispatchEvent(te.AD_BREAK_WILL_START,{position:t}),Oo.log(`${t} ad will be played soon :`,e)},qo=class{constructor(e){this.id=e.getAttribute("id"),this.allowMultipleAds=e.getAttribute("allowMultipleAds"),this.followRedirects=e.getAttribute("followRedirects"),this.vastAdData=null,this.adTagURI=null,this.customData=null;for(const t in e.childNodes){const i=e.childNodes[t];switch(i.localName){case"AdTagURI":this.adTagURI={templateType:i.getAttribute("templateType"),uri:(i.textContent||i.text||"").trim()};break;case"VASTAdData":for(this.vastAdData=i.firstChild;this.vastAdData&&1!==this.vastAdData.nodeType;)this.vastAdData=this.vastAdData.nextSibling;break;case"CustomAdData":this.customData=i}}}};function Wo(e,t){const i=[];for(const n in e.childNodes){const r=e.childNodes[n];r.nodeName!==t&&t!==`vmap:${r.nodeName}`&&r.nodeName!==`vmap:${t}`||i.push(r)}return i}function zo(e){const t={attributes:{},children:{},value:{}};t.value=function(e){if(!e||!e.childNodes)return{};const t=e.childNodes,i=[];for(const e in t){const n=t[e];"#cdata-section"===n.nodeName&&i.push(n)}if(i&&i.length>0)try{return JSON.parse(i[0].data)}catch(e){}let n="";for(const e in t){const i=t[e];switch(i.nodeName){case"#text":n+=i.textContent.trim();break;case"#cdata-section":n+=i.data}}return n}(e);const i=e.attributes;if(i)for(const e in i){const n=i[e];n.nodeName&&void 0!==n.nodeValue&&null!==n.nodeValue&&(t.attributes[n.nodeName]=n.nodeValue)}const n=e.childNodes;if(n)for(const e in n){const i=n[e];i.nodeName&&"#"!==i.nodeName.substring(0,1)&&(t.children[i.nodeName]=zo(i))}return t}const Xo=class{constructor(e){this.timeOffset=e.getAttribute("timeOffset"),this.breakType=e.getAttribute("breakType"),this.breakId=e.getAttribute("breakId"),this.repeatAfter=e.getAttribute("repeatAfter"),this.adSource=null,this.trackingEvents=[],this.extensions=[];for(const t in e.childNodes){const i=e.childNodes[t];switch(i.localName){case"AdSource":this.adSource=new qo(i);break;case"TrackingEvents":for(const e in i.childNodes){const t=i.childNodes[e];"Tracking"===t.localName&&this.trackingEvents.push({event:t.getAttribute("event"),uri:(t.textContent||t.text||"").trim()})}break;case"Extensions":this.extensions=Wo(i,"Extension").map((e=>zo(e)))}}}track(e,t){for(const i in this.trackingEvents){const n=this.trackingEvents[i];if(n.event===e){let{uri:e}=n;"error"===n.event&&(e=e.replace("[ERRORCODE]",t)),this.tracker(e)}}}tracker(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)}},Zo=(e,t)=>Jo(e,t)||ed(e),Jo=(e,t)=>{let[,i]=e.match(/^([0-9]{1,3})%$/)||[null,null];return null==i?null:(i=Number(i),i<0||i>100?null:Math.floor(i*t/100))},ed=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[t,i,n,r]=e.match(/^([0-9]{2}):([0-9]{2}):([0-9]{2})(\.[0-9]{3})?$/)||[null,null,null,null];return null==t?null:60*i*60+60*n+Number(r)};function td(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(((e,t)=>{const i=t.attributes.source;return"dailymotion"!==i&&"dmx"!==i||"object"!=typeof t.value?e:{...e,...t.value}}),{})}class id{constructor(e){let{endEvent:t,logger:i}=e;this.resolvePromise=null,this.promise=null,this.delayRequestTimeoutId=null,this.initPromise(t,i),ee.addEventListener(t,this.onEndEvent)}onEndEvent=()=>{this.resolvePromise("holder callback")};waitForCustomConfig(){return this.promise}async initPromise(e,t){this.promise=new Promise((e=>{this.resolvePromise=e,this.delayRequestTimeoutId=setTimeout((()=>e("holder timeout")),1e3*Z("waitForCustomConfigDelay",6))}));const i=await this.promise;t.log(`Resolving the delayed ad request promise from ${i}`),clearTimeout(this.delayRequestTimeoutId),ee.removeEventListener(e,this.onEndEvent)}}class nd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this._vmapAdBreak=e,this._adSource=this._vmapAdBreak.adSource,this.cuepoint=i,this.requested=!1,this.id=n,this.isDelayed=!1,this.requestDelayer=null,this.hasDoneFallback=!1,this.isARetake=!1,this.extension={timeout:4e3,...t,...td(this._vmapAdBreak.extensions)},this.errorMessage=""}track(e,t){this._vmapAdBreak.track(e,t)}hasSupportedAdSource(){if(!this._adSource.vastAdData){const e=/^vast[1-4]?$/;this._adSource.adTagURI?this._adSource.adTagURI.uri?this._adSource.adTagURI.templateType.match(e)||(this.errorMessage=`adTagURI templateType - ${this._adSource.adTagURI.templateType} - invalid`):this.errorMessage="adTagURI.uri undefined":this.errorMessage="No vastAdData nor adTagURI defined"}return!this.errorMessage}setAdSource(e){let{vastAdData:t,adTagURI:i}=e;this._adSource={vastAdData:t,adTagURI:i}}getAdSource(){return this._adSource}setToRequested(){this.requested=!0}delay(e,t){this.requestDelayer=new id({endEvent:e,logger:t}),this.isDelayed=!0}markFallbackDone(){this.hasDoneFallback=!0}markAsRetake(){this.isARetake=!0}}const rd=T("AdStackDM"),sd=(e,t)=>{let{duration:i}=t;return Promise.resolve().then((()=>{const t=new class{constructor(e){if(!e||!e.documentElement||"VMAP"!==e.documentElement.localName)throw new Error("Not a VMAP document");this.version=e.documentElement.getAttribute("version"),this.adBreaks=[],this.extensions=[];for(const t in e.documentElement.childNodes){const i=e.documentElement.childNodes[t];switch(i.localName){case"AdBreak":this.adBreaks.push(new Xo(i));break;case"Extensions":this.extensions=Wo(i,"Extension").map((e=>zo(e)))}}}}((new DOMParser).parseFromString(e,"text/xml"));rd.log("Creating CuePoints from VMAP",t);const n=td(t.extensions),r={prerolls:[],midrolls:[],postrolls:[],liveAdBreaks:[]};return t.adBreaks.forEach((e=>{if(!e.breakType.split(",").includes("display"))switch(e.timeOffset){case"start":r.prerolls.push(new nd(e,n));break;case"end":r.postrolls.push(new nd(e,n));break;default:{if(e.timeOffset.indexOf("#")>-1)return void r.liveAdBreaks.push(new nd(e,n));if(R()){Ze.vmapData=t;break}const s=Zo(e.timeOffset,i);if(s&&(r.midrolls.push(new nd(e,n,s,`midroll_${s}_${r.midrolls.length}`)),e.repeatAfter)){const t=Zo(e.repeatAfter,i),a=i-30;let o=s+t;for(;o<=a;)r.midrolls.push(new nd(e,n,o,`midroll_${s}_${r.midrolls.length}`)),o+=t}}}})),r.midrolls.sort(((e,t)=>e.cuepoint-t.cuepoint)),r.liveAdBreaks.sort(((e,t)=>parseInt(e._vmapAdBreak.timeOffset.replace("#",""),10)-parseInt(t._vmapAdBreak.timeOffset.replace("#",""),10))),r.liveAdBreaks.length>0&&rd.log("Parsed live ad breaks",r.liveAdBreaks),r}))};var ad=i(3102);const od=T("Player","Scheduler","AdsScheduling");let dd=!0;const ld=async(e,t)=>{od.log("Requesting Ads"),ee.dispatchEvent(te.AD_VMAP_REQUESTED);const i={width:A.width,height:A.height},{adUrl:n,errorUrl:r}=((e,t)=>{if(!R())return{adUrl:V("adUrl"),errorUrl:V("adErrorUrl")};const i=Ir(N(),e,t);return{adUrl:i.adUrl,errorUrl:i.errorUrl}})(e,t),s={clientType:k(),duration:V("duration"),volume:w(),errorUrl:r,topDomain:N().getTopDomain(),isRealAutoplay:F(),...i};return(()=>{const e=!N().isOnsite(),t=S("PV5_TEMP_WAIT_CUST_CONF_VMAP");return Ko()&&(e||t)})()&&await(async e=>{ee.dispatchEvent(te.AD_BREAK_WILL_START,{position:ad.e.PREROLL}),e&&Object.keys(P()).length||await(async()=>{const e=new id({endEvent:te.PLAYER_API_SET_CUST_CONFIG,logger:Oo});Oo.log("Delaying VMAP fetching"),await e.waitForCustomConfig()})()})(dd),dd=!1,async function(e){let{clientType:t,duration:i,errorUrl:n,width:r,height:s,volume:a,topDomain:o,isRealAutoplay:d}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.reject();e=kn(e);const l=await Jn(),c=await Wn(),u=await zn(d),h=re.h.appendEncodedQueryParameters(e,{...Mn({width:r,height:s}),...wn(t),...Fn(o),...Gn(),...Qn(),...W(),...tr(),...jn(a),...qn(),...Xn(),...Zn(),...er(),...ir(),...nr(),...$n(),...rr(),"3pcb":f()?"0":"1",...gr(u),...u,...l,...c,...cr(),...S("PV5_LEO_AD_PLACEMENT_QS")?{plcmt:C()?1:2}:{}});return rd.log("Fetching ad_url:",h),Bs({action:Ns,component:Cs,url:h}),I().vmapLoad.start(),Ai(h,{errorUrl:kn(n),timeoutErrorCode:1107,failedErrorCode:1108,timeout:8e3}).then((e=>{let{data:t,httpStatus:n,byteLength:r,duration:s}=e;return I().vmapLoad.end(),((e,t)=>{yr={byteLength:e,duration:t,sent:!1}})(r,s),Bs({action:Vs,callLatency:s,component:Cs,responseType:"VMAP",statusCode:n,url:h}),be.value=n,sd(t,{duration:i})})).catch((e=>{throw I().vmapLoad.end(),Bs({action:Vs,callLatency:e.duration,component:Cs,responseType:e.httpStatus===vi?ws:Ms,statusCode:e.httpStatus,url:h}),be.value=e.httpStatus,new Ce(`Unreacheable Ad Director url (${e})`,{type:se})}))}(n,s).catch((e=>{const t=(i={code:e.type,message:e.message},null==(n=v)?void 0:n.createError(i));var i,n;throw ee.dispatchEvent(te.PLAYER_ERROR,t),e}))},cd=e=>e.map((e=>`${Math.floor(e.cuepoint/3600)}:${Math.floor(e.cuepoint%3600/60)}:${e.cuepoint%60}`));let ud=[],hd=!1;const Ed=()=>{if(Ze.current&&nn.isLinear)return;if(hd)return;const e=ud.shift();if(e)return nn.isNonLinear?void ee.dispatchEvent(te.AD_NON_LINEAR_WILL_STOP,{reason:Ne.Bj.INTERRUPTED}):void pd(e);_d(),nn.isNonLinear||yd()},pd=e=>{var t;Ze.linearSlotStarted||ee.dispatchEvent(te.AD_LINEAR_SLOT_STARTED,{position:Ze.position}),Ko()&&(t=e,Ze.position===Ne.ev.PREROLL&&Ze.isFirstAdBreakForAdSlot||t.isDelayed||jo(t,Ze.position)),e.setToRequested(),Ze.current=e,ee.dispatchEvent(te.AD_BREAK_STARTED)},_d=()=>{ud=[],hd=!0,ee.removeEventListener(te.AD_STOPPED,Ed),ee.removeEventListener(te.AD_SKIPPED,Ed),ee.removeEventListener(te.RESET_CURRENT_AD_BREAK,Ed),ee.removeEventListener(te.PLAYER_LOAD_VIDEO,_d),Fa=[],Ba=[]},vd=2;let Ad=0;const md=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!R()||(e=>R()&&e&&Ze.fetchedViewId!==e)(e)){R()&&Xe.reset();const n=await ld(t,i);ee.dispatchEvent(te.AD_VMAP_RECEIVED,{shouldSubscribeEvent:!0}),Ze.adBreaks=n,Oo.log("AdBreaks cue points",n),R()?Ze.fetchedViewId=e:Oo.log("Registering midroll adBreaks",cd(n.midrolls))}},gd=()=>{Ko()&&(ee.addEventListener(te.PLAYER_VIDEO_TIME_UPDATE,(()=>{(()=>{const e=Qo();if(e)return void jo(e,Ne.ev.MIDROLL);const t=$o();t&&jo(t,Ne.ev.POSTROLL)})()})),ee.addEventListener(te.AD_STARTED,(()=>{(()=>{const e=Go();e&&jo(e,Ze.position)})()}))),ee.addEventListener(te.PLAYER_VIDEO_ENDED,(()=>{Rd(Ne.ev.POSTROLL)})),ee.addEventListener(te.PLAYER_VIDEO_TIME_UPDATE,(()=>{if(!Sd())return;const e=kd();e.length&&Td(Ne.ev.MIDROLL,e)}))},Td=(e,t)=>{if(Ze.position=e,!Pd())return Id(),void yd();(e=>{(null==e?void 0:e.length)&&(hd=!1,ee.addEventListener(te.AD_STOPPED,Ed),ee.addEventListener(te.AD_SKIPPED,Ed),ee.addEventListener(te.RESET_CURRENT_AD_BREAK,Ed),ee.addEventListener(te.PLAYER_LOAD_VIDEO,_d),ud=e,Ed())})(t)},Rd=e=>{Ze.position=e;const t=Ld();t.length?Td(e,t):(Oo.log("Ad slot request failed - no adbreak for",Ze.position),yd())},Sd=()=>Ze.adBreaks.midrolls.length>0&&(!Ze.position||nn.isNonLinear),Dd=()=>{const e=Ze.adBreaks.liveAdBreaks;if(!e.length||!Ze.isFirstAdBreakForAdSlot)return null;const t=Ze.adBreaks.liveAdBreaks[Ad];return Ad=Ad<e.length-1?Ad+1:0,t},Id=()=>{Ld().forEach((e=>e.setToRequested()))},Ld=()=>{switch(Ze.position){case Ne.ev.PREROLL:return Ze.adBreaks.prerolls;case Ne.ev.POSTROLL:return fd();case Ne.ev.LIVEADBREAK:return Ze.adBreaks.liveAdBreaks;case Ne.ev.MIDROLL:return kd();default:return[]}},kd=()=>{if(wo())return[];const e=G().currentTime;let t=Ze.adBreaks.midrolls.filter((i=e,e=>{let{requested:t,cuepoint:n}=e;return Math.abs(i-n)<=vd&&!t}));var i;return t.length||!Fo()||bo||(t=(e=>{if(!Co)return[];let t=[];const i=Ze.adBreaks.midrolls.find((n=Co,r=e,e=>{let{requested:t,cuepoint:i}=e;return n<=i&&i<=r&&!t}));var n,r;return i&&(t=Ze.adBreaks.midrolls.filter((e=>t=>{let{requested:i,cuepoint:n}=t;return e===n&&!i})(i.cuepoint)),t.forEach((e=>{e.markAsRetake()}))),Co=null,t})(e)),t},fd=()=>wo()?[]:Ze.adBreaks.postrolls,Pd=()=>{if(Boolean(yo())){const e=yo();return ee.dispatchEvent(te.AD_LOG,{...Ne.r0.PERMANENT_EXCLUSION,name:e}),Oo.log(`Ad slot request denied - ${e}`),!1}return!0},yd=()=>{Ze.linearSlotStarted?setTimeout((()=>{ee.dispatchEvent(te.AD_LINEAR_SLOT_ENDED,{position:Ze.position})}),0):(Ze.position===Ne.ev.POSTROLL?ee.dispatchEvent(te.PLAYER_SCHEDULER_END_SEQUENCE):Ze.position===Ne.ev.PREROLL&&z(),Ze.position=null)};var Od=i(3952);const bd={getAd:()=>nn,getAdBreak:()=>Ze,start:async()=>{try{await md(),Rd(Ne.ev.PREROLL),R()&&(()=>{var e,t;if(!(null==(e=Ze.vmapData)?void 0:e.adBreaks))return;const i=V("duration"),n=td(null==(t=Ze.vmapData)?void 0:t.extensions);Ze.vmapData.adBreaks.filter((e=>!["start","end"].includes(e.timeOffset)||e.timeOffset.indexOf("#"))).map((e=>{const t=Zo(e.timeOffset,i);if(t&&(Ze.adBreaks.midrolls.push(new nd(e,n,t,`midroll_${t}_${Ze.adBreaks.midrolls.length}`)),e.repeatAfter)){const r=Zo(e.repeatAfter,i),s=i-30;let a=t+r;for(;a<=s;)Ze.adBreaks.midrolls.push(new nd(e,n,a,`midroll_${t}_${Ze.adBreaks.midrolls.length}`)),a+=r}})),Oo.log("Registering, after parallel ads call, midroll adBreaks",cd(Ze.adBreaks.midrolls))})(),bo=0,Co=null,No=null,ee.removeEventListener(te.AD_LINEAR_SLOT_STARTED,Uo),ee.removeEventListener(te.PLAYER_SEEK_REQUESTED,Vo),ee.removeEventListener(te.PLAYER_VIDEO_TIME_UPDATE,Mo),ee.removeEventListener(te.AD_VIDEO_START,xo),Fo()&&(ee.addEventListener(te.PLAYER_VIDEO_TIME_UPDATE,Mo.bind(null,No)),ee.addEventListener(te.AD_VIDEO_START,xo),ee.addEventListener(te.AD_LINEAR_SLOT_STARTED,Uo),ee.addEventListener(te.PLAYER_SEEK_REQUESTED,Vo))}catch(e){Oo.log("Error while getting ads",e),z()}},fetchAds:md,updatePlayerDependencies:e=>{g(e),(0,Od.Cj)(te,ee)},startLiveAdBreak:()=>{Td(Ne.ev.LIVEADBREAK,[Dd()])},stopAd:ao,adEventEmitter:ee,positions:Ne.ev,AdEvents:te,isSkipIgnored:()=>Boolean(Rs()),adsDisabledReason:Po,catchUserAction:()=>{Lo.catchUserAction()},AdSdkHandler:p,IMASdkHandler:Lo,OmSdkUtils:r,getClickTrackingMacro:pn,getTrackingMacros:Rn,subscribe:uo,unsubscribe:ho};var Cd=i(6774),Nd=i.n(Cd);let Ud=[],Vd=[],Md=null;const wd=T("Player","PlayerDataLayer"),Fd=te.AD_LOADED,Bd=[te.AD_SKIPPED,te.AD_STOPPED,te.AD_ERROR],xd={[te.AD_BUFFER_FINISH]:null,[te.AD_BUFFER_START]:null,[te.AD_CLICK]:null,[te.AD_IMPRESSION]:null,[te.AD_PAUSED]:null,[te.AD_PLAYING]:null,[te.AD_VIDEO_COMPLETE]:null,[te.AD_VIDEO_FIRST_QUARTILE]:null,[te.AD_VIDEO_MIDPOINT]:null,[te.AD_VIDEO_START]:null,[te.AD_VIDEO_THIRD_QUARTILE]:null,[te.AD_VIDEO_VOLUME_CHANGED]:null,[te.PLAYER_FULLSCREEN_CHANGED]:null},Hd=e=>{!function(e,t){const{events:i,callback:n}=e;wd.log("dispatching",t,"to",{events:i,callback:n}),t.filter((t=>Yd(e,t))).forEach((e=>{n(e)}))}(e,Ud),Vd.push(e)},Kd=e=>{Vd=Vd.filter((t=>t.id!==e))},Yd=(e,t)=>{let{events:i,inventoryIdValue:n=null,clientFallbackIndex:r=null}=e;const s=i.includes(t.name),a=!(n&&n!==t.data.inventoryIdValue||r&&r!==t.data.clientFallbackIndex);return s&&a};function Gd(e){const{volume:t,muted:i}=w();return{...e,adLinearIsRunning:nn.isAdSlotRunning,duration:nn.duration,volume:t,muted:i,inventoryIdValue:nn.clientInventoryId,clientFallbackIndex:nn.clientFallbackIndex}}const Qd=()=>{wd.log("Reset DataLayer"),Ud=[],Md=null},$d=(e,t)=>{const i={name:e,data:t};if(Nd()(Md,i))return;Md=i;const n={name:e,data:Gd(t)};!function(e,t){wd.log("dispatching",e,"to",t),t.filter((t=>Yd(t,e))).forEach((t=>{let{callback:i}=t;i(e)}))}(n,Vd),Ud.push(n)};var jd=i(8947);const qd="OMSDK_WEB",Wd={name:qi.IA.START,triggeringEvent:[te.AD_LOADED]},zd=[{name:qi.IA.ERROR,triggeringEvent:[te.AD_ERROR]},{name:qi.IA.FINISH,triggeringEvent:[te.AD_SKIPPED,te.AD_STOPPED]}],Xd={impression:[te.AD_IMPRESSION],loaded:[te.AD_LOADED],start:[te.AD_VIDEO_START],firstQuartile:[te.AD_VIDEO_FIRST_QUARTILE],midpoint:[te.AD_VIDEO_MIDPOINT],thirdQuartile:[te.AD_VIDEO_THIRD_QUARTILE],complete:[te.AD_VIDEO_COMPLETE],pause:[te.AD_PAUSED],resume:[te.AD_PLAYING],bufferStart:[te.AD_BUFFER_START],bufferFinish:[te.AD_BUFFER_FINISH],skipped:[te.AD_SKIPPED],volumeChange:[te.AD_VIDEO_VOLUME_CHANGED],playerStateChange:[te.PLAYER_FULLSCREEN_CHANGED],adUserInteraction:[te.AD_CLICK]},Zd=T("Stats","Omsdk"),Jd=[],el=()=>{const e=re.h.parseUrl(N().window().location.href).params("access_mode");return e&&qi.g8.includes(e)?e:qi.VP},tl=(e,t)=>Jd.find((i=>i.inventoryIdValue===e&&i.clientFallbackIndex===t)),il=(e,t)=>{if("impression"===e)return jd.UV.impressionOccurred();const i=nl(e,t),n=Object.values(i);return Zd.log(`Sending event ${e}${n.length?` with params ${JSON.stringify(i)}`:""}`),"loaded"===e?jd.UV.loaded(i):"error"===e?null==(r=jd.UV.adSession)?void 0:r.error(i):jd.G$[e](...n);var r},nl=(e,t)=>{switch(e){case"loaded":return new jd.G3.VastProperties(...Object.values(Pn(t)));case"start":return{duration:t.duration,volume:t.muted?0:t.volume};case"playerStateChange":return{playerState:M().viewMode};case"volumeChange":return{volume:t.muted?0:t.volume};case"adUserInteraction":return{interactionType:"click"};default:return{}}},rl=(e,t)=>{let{inventoryIdValue:i,clientFallbackIndex:n}=t;tl(i,n)&&(Zd.log("AdSession finished for",{inventoryIdValue:i,clientFallbackIndex:n}),e.finish().then((e=>{let{removedIframes:t}=e;t.forEach((e=>{Zd.log("Removed iframe",e,"for AdSession",{inventoryIdValue:i,clientFallbackIndex:n})}))})),sl(i,n))},sl=(e,t)=>{[Wd,...zd].forEach((i=>{Kd(`${qd}_${e}_${t}_${i.name}`)})),qi.I8.forEach((i=>{Kd(`${qd}_${e}_${t}_${i}`)}))},al=()=>({adBreak:Ze.current,adPause:!1,position:Ze.position,proxyInitProtection:Ze.position!==Ne.ev.PREROLL,volume:w(),isRealAutoplay:F(),fallbackUrl:nn.fallbackUrl,fallbackMethod:nn.fallbackMethod}),ol=e=>({position:Ze.position,timeoutInfo:Fi(ci),integrator:nn.integratorName,...e}),dl=()=>({position:Ze.position,settingsControls:H("controls")}),ll=T("Video","Ads"),cl="linear";let ul=null,hl=null,El=null,pl=null;const _l=(e,t)=>{ee.dispatchEvent(G().isPaused?te.PLAYER_PLAY_REQUESTED:te.PLAYER_PAUSE_REQUESTED,t)},vl=()=>{Xl()},Al=()=>{Dl()},ml=e=>{let{volume:t,muted:i,interactionType:n}=e;const r="number"==typeof t?Math.max(0,Math.min(t,1)):null;pl=n,Wl(r,i)},gl=()=>{jl()},Tl=()=>{ql()},Rl=()=>{$l()},Sl=()=>{Ql()},Dl=()=>{El=null,Il(),ee.removeEventListener(te.PLAYER_CHROMECAST_SESSION_AVAILABLE,vl),ee.removeEventListener(te.PLAYER_LOAD_VIDEO,Al),ee.removeEventListener(te.PLAYER_PAUSE_REQUESTED,Sl),ee.removeEventListener(te.PLAYER_PLAY_REQUESTED,Rl),A.off(gl),ee.removeEventListener(te.AD_SKIP_REQUESTED,Tl),ee.removeEventListener(te.PLAYER_TOGGLE_PLAYBACK_REQUESTED,_l),ee.removeEventListener(te.PLAYER_VIDEO_VOLUME_CHANGED,ml)},Il=()=>{El&&(El.unsubscribe(fl,Ne.k3.BUFFER_FINISH),El.unsubscribe(Pl,Ne.k3.BUFFER_START),El.unsubscribe(xl,Ne.k3.CLICK_THRU),El.unsubscribe(Bl,Ne.k3.DURATION_CHANGE),El.unsubscribe(Fl,Ne.k3.ERROR),El.unsubscribe(kl,Ne.k3.IMPRESSION),El.unsubscribe(bl,Ne.k3.PAUSED),El.unsubscribe(Ol,Ne.k3.PLAYING),El.unsubscribe(Gl,Ne.k3.POD_ERROR),El.unsubscribe(Nl,Ne.k3.RATIO_CHANGE),El.unsubscribe(yl,Ne.k3.REMAINING_TIME_CHANGE),El.unsubscribe(Kl,Ne.k3.SKIPPABLE_REMAINING_TIME_CHANGE),El.unsubscribe(Hl,Ne.k3.SKIPPABLE_STATE_CHANGE),El.unsubscribe(Vl,Ne.k3.SKIPPED),El.unsubscribe(Ml,Ne.k3.SKIPPED),El.unsubscribe(wl,Ne.k3.STOPPED),El.unsubscribe(Yl,Ne.k3.STARTED),El.unsubscribe(Ul,Ne.k3.VIDEO_COMPLETE),El.unsubscribe(Ll,Ne.k3.VIDEO_START),El.unsubscribe(Cl,Ne.k3.VOLUME_CHANGE))},Ll=()=>{hl&&hl(),ns.finish()&&ee.dispatchEvent(te.AD_LOG,Ne.r0.AD_RESOLVED_OK),ee.dispatchEvent(te.AD_VIDEO_START,{type:cl,position:Ze.position,timeoutInfo:Fi(ui),breakpointVerticalS:!1,settingsControls:H("controls"),breakpointHorizontalXS:!1}),Ol(),jl()},kl=()=>{hl&&hl(),ee.dispatchEvent(te.AD_IMPRESSION,{type:cl,...dl()})},fl=()=>{ee.dispatchEvent(te.AD_BUFFER_FINISH)},Pl=()=>{ee.dispatchEvent(te.AD_BUFFER_START)},yl=()=>{if(El&&El.getAdDuration()>0&&El.getAdRemainingTime()>0){const e=El.getAdDuration()-El.getAdRemainingTime();ee.dispatchEvent(te.PLAYER_VIDEO_TIME_UPDATE,{time:e})}},Ol=()=>{ee.dispatchEvent(te.PLAYER_VIDEO_PLAY),ee.dispatchEvent(te.PLAYER_VIDEO_PLAYING)},bl=()=>{ee.dispatchEvent(te.PLAYER_VIDEO_PAUSE)},Cl=()=>{if(!El)return;const{volume:e,muted:t}=El.getAdVolume();"number"==typeof e&&"boolean"==typeof t&&(ee.dispatchEvent(te.AD_VIDEO_VOLUME_CHANGED,{volume:e,muted:t,interactionType:pl||"programmatic"}),pl=null)},Nl=e=>{ee.dispatchEvent(te.PLAYER_CONTENT_SIZE_CHANGED,e)},Ul=function(){let{endedReason:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};zl({endedReason:e||Ne.Bj.COMPLETED})},Vl=()=>{var e;const t=(null==(e=El)?void 0:e.getSkipAdLogs())||{};setTimeout((()=>{zl({endedReason:t.isSmartSkip?Ne.Bj.SMART_SKIPPED:Ne.Bj.SKIPPED,skipDisplayed:t.skipDisplayed,skipClicked:t.skipClicked})}),0)},Ml=()=>{Vl(),wl({reason:Ne.Bj.SKIPPED})},wl=function(){let{reason:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:null};ll.log(`Ad stopped ${e?`with reason: ${e}`:""}. Starting teardown`),Il(),ee.dispatchEvent(te.AD_STOPPED,{type:cl,position:Ze.position,reason:e}),Dl()},Fl=e=>{hl&&hl();const t=_i(e,{position:Ze.position});ll.log("AD_ERROR (delaying after stopAd()):",t),Xl(t)},Bl=()=>{El&&ee.dispatchEvent(te.PLAYER_VIDEO_DURATION_CHANGE,{duration:El.getAdDuration()})},xl=(e,t,i)=>{Ql(),ll.log(`clickThru event received (handle: ${i})`,e),i&&/^([\w]+:)?\/\//.test(e)&&window.open(e),ee.dispatchEvent(te.AD_CLICK,{type:cl,position:Ze.position})},Hl=()=>{El&&ee.dispatchEvent(te.AD_VIDEO_SKIPPABLE_STATE,{adSkippable:El.getAdSkippableState()})},Kl=()=>{El&&ee.dispatchEvent(te.AD_VIDEO_SKIPPABLE_REMAINING_TIME,{time:El.getAdSkippableRemainingTime()})},Yl=e=>{ee.dispatchEvent(te.AD_STARTED,{type:cl,...ol(e)})},Gl=e=>{const t=_i(e,{position:Ze.position});ee.dispatchEvent(te.AD_POD_ERROR,{adError:t})},Ql=()=>{El&&(ll.log("pause ad"),El.pauseAd())},$l=()=>{El&&(ll.log("resume ad"),El.resumeAd())},jl=()=>{if(!El)return;const{width:e,height:t}=A,i=M().viewMode;ll.log("resize ad (",e,t,i,")"),El.resizeAd(e,t,i)},ql=()=>{El&&(El.getAdSkippableState()?(Il(),ro().then((()=>{Vl(),ee.dispatchEvent(te.AD_SKIPPED,{type:cl,position:Ze.position}),Dl()}))):ll.warn("Ad is not skippable. Ignoring skipAd()"))},Wl=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];El&&El.setAdVolume(e,t)},zl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ee.dispatchEvent(te.AD_VIDEO_COMPLETE,e)},Xl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Il(),so().then((()=>{e?ee.dispatchEvent(te.AD_ERROR,{adError:e}):ee.dispatchEvent(te.AD_STOPPED,{type:cl,position:Ze.position}),Dl()}))},Zl=T("Player","Scheduler","AdLinearSlot"),Jl="REASON_AD_SKIPPED";let ec=!1;const tc=()=>{nn.isAdSlotRunning||ee.dispatchEvent(te.AD_LINEAR_WILL_START,{position:Ze.position}),ul=null,El=null,pl=null,ee.addEventListener(te.PLAYER_CHROMECAST_SESSION_AVAILABLE,vl),ee.addEventListener(te.PLAYER_LOAD_VIDEO,Al),ee.addEventListener(te.PLAYER_PAUSE_REQUESTED,Sl),ee.addEventListener(te.PLAYER_PLAY_REQUESTED,Rl),A.on(gl),ee.addEventListener(te.AD_SKIP_REQUESTED,Tl),ee.addEventListener(te.PLAYER_TOGGLE_PLAYBACK_REQUESTED,_l),ee.addEventListener(te.PLAYER_VIDEO_VOLUME_CHANGED,ml),ll.log("startAd"),no().then((e=>{El=e,El&&(El.subscribe(fl,Ne.k3.BUFFER_FINISH),El.subscribe(Pl,Ne.k3.BUFFER_START),El.subscribe(xl,Ne.k3.CLICK_THRU),El.subscribe(Bl,Ne.k3.DURATION_CHANGE),El.subscribe(Fl,Ne.k3.ERROR),El.subscribe(kl,Ne.k3.IMPRESSION),El.subscribe(bl,Ne.k3.PAUSED),El.subscribe(Ol,Ne.k3.PLAYING),El.subscribe(Gl,Ne.k3.POD_ERROR),El.subscribe(Nl,Ne.k3.RATIO_CHANGE),El.subscribe(yl,Ne.k3.REMAINING_TIME_CHANGE),El.subscribe(Kl,Ne.k3.SKIPPABLE_REMAINING_TIME_CHANGE),El.subscribe(Hl,Ne.k3.SKIPPABLE_STATE_CHANGE),El.subscribe(Ml,Ne.k3.SKIPPED),El.subscribe(wl,Ne.k3.STOPPED),El.subscribe(Yl,Ne.k3.STARTED),El.subscribe(Ul,Ne.k3.VIDEO_COMPLETE),El.subscribe(Ll,Ne.k3.VIDEO_START),El.subscribe(Cl,Ne.k3.VOLUME_CHANGE)),Yl(El.adData),El.hasBufferStep&&(()=>{const e={type:ge,code:2004},{promise:t,resolve:i}=function(e){let t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Vi.log(`start step ${e}`),Ni(e);const r=new Promise(((r,s)=>{t=r,i=s,n.type&&Hi(e,(()=>{Ki(e),i({code:n.code||null,message:pi(),type:n.type})}))}));return r.then((()=>Ki(e))),{promise:r,resolve:t,reject:i}}(ui,e);ul=t,hl=i,ul.then((()=>{}),(e=>Xl(e)))})()})).catch((e=>{ll.warn("callStartAd failed:",e);const t=_i(e,{position:Ze.position,timeoutInfo:Fi()});ee.dispatchEvent(te.AD_ERROR,{adError:t}),Dl()}))},ic=(e,t)=>{io({initAdOptions:e,onAdWillStartEarly:nc.bind(void 0),creative:t}).then((e=>{const t=yn(),i=t?bn(e.adVerifications,e.vastTracker):e.adVerifications,n={...e,position:Ze.position,isRealAutoplay:F(),timeoutInfo:Fi(li),adVerifications:i,canNativeAppUseOmSdk:t};ee.dispatchEvent(te.AD_LOADED,{omSdkParams:Pn(n),...n}),t||(async e=>{const t=tl(nn.clientInventoryId,nn.clientFallbackIndex);if(!(null==e?void 0:e.length)||t)return;if(!await(0,jd.mB)())return;const i=(e=>{const t=el();return e.map((e=>{const{resource:i,vendor:n,parameters:r}=e;return new jd.G3.VerificationScriptResource(i,n,r,t)}))})(bn(e,nn.integrator.vastTracker)),n=(e=>{try{const t=N().getEmbedder(),i=x();return(0,jd.Xu)(e,t,i)}catch(e){return Zd.log("Unable to initialize AdSession",e),null}})(i);n&&(Jd.push({inventoryIdValue:nn.clientInventoryId,clientFallbackIndex:nn.clientFallbackIndex}),((e,t,i,n)=>{Hd({id:`${qd}_${i}_${n}_${Wd.name}`,events:Wd.triggeringEvent,callback:function(){let{data:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{data:null};return e(Wd,t)},inventoryIdValue:i,clientFallbackIndex:n}),qi.I8.forEach((e=>{Hd({id:`${qd}_${i}_${n}_${e}`,events:Xd[e],callback:i=>{let{data:n}=i;return t(e,n)},inventoryIdValue:i,clientFallbackIndex:n})})),zd.forEach((t=>{Hd({id:`${qd}_${i}_${n}_${t.name}`,events:t.triggeringEvent,callback:i=>{let{data:n}=i;return e(t,n)},inventoryIdValue:i})}))})((e=>(t,i)=>{var n,r;const s=tl(i.inventoryIdValue,i.clientFallbackIndex);switch(t.name){case qi.IA.START:{Zd.log("AdSession started for",{inventoryIdValue:i.inventoryIdValue,clientFallbackIndex:i.clientFallbackIndex});const{sessionIframes:t}=e.start();Zd.log("OMID iframes",t);break}case qi.IA.ERROR:if(!s)return;Zd.log("AdSession error",null==i||null==(n=i.adError)?void 0:n.message),e.error("generic",null==i||null==(r=i.adError)?void 0:r.message),rl(e,i);break;case qi.IA.FINISH:rl(e,i)}})(n),il,nn.clientInventoryId,nn.clientFallbackIndex))})(i),e.companionAds&&e.companionAds.length&&ee.dispatchEvent(te.AD_COMPANIONS_RECEIVED,{companionAds:e.companionAds,displayedCompanion:e.displayedCompanion}),Zl.log("Success - Responded with mediaFile"),e.injectedAdSlot&&ee.dispatchEvent(te.AD_SLOT_INJECTED,{element:e.injectedAdSlot}),tc()})).catch((e=>{Zl.error("Failed -",e);const t=_i(e,{position:Ze.position,timeoutInfo:Fi()});ee.dispatchEvent(te.AD_ERROR,{adError:t})}))},nc=()=>{Zl.log("triggering early AD_LINEAR_WILL_START",Ze.position),ee.dispatchEvent(te.AD_LINEAR_WILL_START,{position:Ze.position})},rc=e=>{ee.dispatchEvent(te.AD_LINEAR_STARTED,e),ec=!0},sc=()=>{lc("REASON_AD_ERROR")},ac=function(){let{reason:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{reason:null};e!==Ne.Bj.SKIPPED?lc("REASON_AD_STOPPED"):lc(Jl)},oc=()=>{lc(Jl)},dc=()=>{lc("REASON_AD_INTERRUPTED")},lc=e=>{ec&&ee.dispatchEvent(te.AD_LINEAR_STOPPED,{type:"linear",position:Ze.position,reason:e}),ee.removeEventListener(te.PLAYER_LOAD_VIDEO,dc),ee.removeEventListener(te.AD_ERROR,sc),ee.removeEventListener(te.AD_STARTED,rc),ee.removeEventListener(te.AD_STOPPED,ac),ee.removeEventListener(te.AD_SKIPPED,oc),Zl.log("Torn down")},cc=T("AdNonLinearSlot"),uc=async()=>{if(nn.integratorName===Ne.Z4.Hs){cc.log("startAd");try{const e=await no();ee.addEventListener(te.PLAYER_VIDEO_ENDED,_c),ee.addEventListener(te.PLAYER_VIDEO_TIME_UPDATE,mc),ee.addEventListener(te.PLAYER_VIDEO_VOLUME_CHANGED,gc),ee.addEventListener(te.PLAYER_VIDEO_PAUSE,Tc),ee.addEventListener(te.PLAYER_VIDEO_PLAY,Rc),ee.addEventListener(te.PLAYER_FULLSCREEN_CHANGED,Dc),A.on(vc),ee.dispatchEvent(te.AD_STARTED,{...ol(e.adData),creativeType:"nonlinear"}),pc(e),vc()}catch(e){cc.log("callStartAd failed:",e),hc({error:e})}}},hc=async function(){let{error:e=null,reason:t=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cc.log("stopAd called"),await so(t),e&&ee.dispatchEvent(te.AD_ERROR,{adError:{...e,creativeType:"nonlinear"}}),Ec()},Ec=()=>{ee.removeEventListener(te.AD_LOADED,uc),ee.removeEventListener(te.AD_NON_LINEAR_WILL_STOP,hc),ee.removeEventListener(te.AD_ERROR,Ec),ee.removeEventListener(te.AD_STOPPED,Ec),ee.removeEventListener(te.PLAYER_VIDEO_SELECTED,Ec),ee.removeEventListener(te.PLAYER_VIDEO_ENDED,_c),ee.removeEventListener(te.PLAYER_VIDEO_TIME_UPDATE,mc),ee.removeEventListener(te.PLAYER_VIDEO_VOLUME_CHANGED,gc),ee.removeEventListener(te.PLAYER_VIDEO_PAUSE,Tc),ee.removeEventListener(te.PLAYER_VIDEO_PLAY,Rc),ee.removeEventListener(te.PLAYER_FULLSCREEN_CHANGED,Dc),A.off(vc),Ic()},pc=e=>{const t=()=>{e.unsubscribe(r,Ne.k3.IMPRESSION),e.unsubscribe(n,Ne.k3.ERROR),e.unsubscribe(i,Ne.k3.STOPPED)},i=e=>{cc.log(`Received ${Ne.k3.STOPPED}, stopping the non linear`),t(),ee.dispatchEvent(te.AD_STOPPED,{...e,creativeType:"nonlinear"})},n=e=>{const i=_i(e);cc.log(`Received ${Ne.k3.ERROR}, stopping the non linear`),t(),ee.dispatchEvent(te.AD_ERROR,{adError:{...i,creativeType:"nonlinear"}}),ee.dispatchEvent(te.AD_STOPPED,{creativeType:"nonlinear"})},r=()=>{ee.dispatchEvent(te.AD_IMPRESSION,dl())};e.subscribe(r,Ne.k3.IMPRESSION),e.subscribe(n,Ne.k3.ERROR),e.subscribe(i,Ne.k3.STOPPED)},_c=()=>{hc({reason:Ne.Bj.INTERRUPTED})},vc=()=>{const e=document.querySelector(".ad_slot");cc.log("Resizing",e.clientHeight,e.clientWidth),Ja().resizeAd(e.clientWidth,e.clientHeight-14,Lo.adUnit.ViewMode.NORMAL)};let Ac=null;const mc=()=>{const e=G().currentTime;Ac>e&&nn.integrator.vastTracker.track("rewind",Rn()),Ac=e},gc=e=>{let{muted:t}=e;nn.integrator.vastTracker.setMuted(t,Rn())},Tc=()=>{nn.integrator.vastTracker.setPaused(!0,Rn())},Rc=()=>{nn.integrator.vastTracker.setPaused(!1,Rn())};let Sc=null;const Dc=()=>{const e=M().isOpened;Sc!==e&&(nn.integrator.vastTracker.setFullscreen(e,Rn()),nn.integrator.vastTracker.setExpand(e,Rn()),Sc=e)},Ic=()=>{Ac=null,Sc=null},Lc=T("Player","Scheduler","AdsFetching"),kc=T("Player","Scheduler","AdLinearSlot"),fc=e=>{const t=e?Ne.w3.URL:Ne.w3.ADBUFFET;Ze.current.markFallbackDone(),ri(),Ui(),Vi.log(`adUnit timeout reset to: ${Xt()}`),Ve.increment(),t===Ne.w3.URL?(Ye.increment(),He.reset(),Be.reset()):Be.increment(),kc.log(`Cannot start ad, using fallback, clientFallbackIndex: ${Ve.value}`),ee.dispatchEvent(te.SET_AD_FALLBACK,{fallbackMethod:t,fallbackUrl:e}),ee.dispatchEvent(te.START_AD_FALLBACK)},Pc=e=>{if(!(e instanceof Ce))return!1;if(nn.isAdPod&&nn.adSlotImpressions>0)return!1;if(!(e.isMediationAllowed()&&Xt()>200))return!1;const t=!!e.fallbackUrl&&(!Ze.current.hasDoneFallback||S("PV5_MULTI_FALLBACK")),i=!e.fallbackUrl&&e.hasRemainingAds&&S("PV5_AD_BUFFET");return t||i},yc=()=>{ee.addEventListener(te.PLAYER_VIDEO_SELECTED,oo),ee.addEventListener(te.AD_BREAK_STARTED,Cc),ee.addEventListener(te.PLAYER_CHROMECAST_STATUS_CHANGED,Oc),ee.addEventListener(te.START_AD_FALLBACK,Cc),ee.addEventListener(te.AD_IMPRESSION,(()=>{var e;nn.adCreativeId&&nn.integratorName!==Ne.Z4.Hs&&((e=nn.adCreativeId)&&Fa.push(e),(e=>{e&&Ba.push(e)})(nn.crid))})),ee.addEventListener(te.AD_ERROR,(e=>{let{adError:t}=e;(e=>{Pc(e)?setTimeout((()=>{fc(e.fallbackUrl)}),0):(ns.finish()&&ee.dispatchEvent(te.AD_LOG,Ne.r0.AD_RESOLVED_ERROR),e.message===ne.AD_DIRECTOR_REQUEST_TIMEOUT&&Ze.current.track("error",1117),setTimeout((()=>{ee.dispatchEvent(te.RESET_CURRENT_AD_BREAK)}),0))})(t)}))},Oc=()=>{bc()&&nn.isAdSlotRunning&&ee.dispatchEvent(te.AD_LINEAR_STOPPED,{reason:"REASON_CHROMECAST_REMOTE",position:Ze.position})},bc=()=>{const{isActive:e,isConnecting:t}=j();return t||e},Cc=async()=>{var e,t;(()=>{if(Ze.position===Ne.ev.PREROLL&&Ze.isFirstAdBreakForAdSlot&&!nn.fallbackMethod||be.reset(),!nn.fallbackMethod){try{Xe.newAdBreak(Ze.position,!Ze.isFirstAdBreakForAdSlot)}catch(e){Oo.error("Inventory ID update failed",e)}Ge(),Li.clean(),Ze.isFirstAdBreakForAdSlot&&(ns.reset(),Ze.current.track("breakStart"))}ns.enable(),ns.start()})();const i=al();var n,r,s;nn.isFallback||((e=>{jt=e,Wt=e,qt=!1})(s=null==(n=Ze.current)||null==(r=n.extension)?void 0:r.timeout),ri(),Ui(),Vi.log(`setAdBreakTimeout: ${s}`));const a=nn.fallbackMethod!==Ne.w3.ADBUFFET;let o;Za(a),ee.dispatchEvent(te.AD_SDK_READY,{position:Ze.position,adScheduleId:(null==(e=Ze.current)||null==(t=e.extension)?void 0:t.asid)||null,timeoutInfo:Fi(oi),fallbackMethod:nn.fallbackMethod});try{Boolean((null==(d=Ze.current)?void 0:d.isDelayed)&&!nn.fallbackMethod)&&(Oo.log("Delaying ad fetching"),await Yi(oi,Ze.current.requestDelayer.waitForCustomConfig())),o=await(e=>{if(!e.adBreak.hasSupportedAdSource()){const t=`${ne.UNSUPPORTED_ADSOURCE}: ${e.adBreak.errorMessage}`;throw new Ce(t,{type:le})}return new Promise(((t,i)=>{Lc.log("Scheduling _fetchAdSync for next tick"),(0,Je.nextTick)((()=>(Lc.log("Tick done, calling _fetchAdSync"),(e=>to(e).catch((t=>{throw Lc.error("Failed -",t),_i(t,{position:e.position,timeoutInfo:Fi()})})))(e).then((e=>t(e))).catch((e=>i(e))))))}))})(i)}catch(e){return ee.dispatchEvent(te.AD_ERROR,{adError:e}),void Oo.log("AdFetching failed",e)}var d;if(bc())return void ee.dispatchEvent(te.AD_ERROR,{adError:new Ce(ne.AD_UNIT_CANCEL,{type:le})});const l=Ja();try{const e=await l.getSupportedCreative(o);if(Oo.log("Got supported creative",e),G().isPaused&&!Xe.isConsecutiveAdBreak&&await new Promise((e=>{const t=()=>{e(),ee.removeEventListener(te.PLAYER_VIDEO_PLAY,t)};ee.addEventListener(te.PLAYER_VIDEO_PLAY,t)})),e.integratorType!==Ne.Z4.Hs&&Jt(),"linear"===e.creative.type)Oo.log("Attaching AdLinearSlot for",Ze.position),(e=>{let{initAdOptions:t,creative:i}=e;ec=!1,ee.addEventListener(te.PLAYER_LOAD_VIDEO,dc),ee.addEventListener(te.AD_ERROR,sc),ee.addEventListener(te.AD_STARTED,rc),ee.addEventListener(te.AD_STOPPED,ac),ee.addEventListener(te.AD_SKIPPED,oc),Zl.log(`Initialized ${Ze.position} ad slot`),ic(t,i)})({initAdOptions:i,creative:e});else if("nonlinear"===e.creative.type){if(Ze.position!==Ne.ev.MIDROLL||!S("PV5_IMA_OVERLAY"))throw Oo.log("Cannot play non linear if not midroll or if gk not enabled"),new Ce(ne.NO_SUPPORTED_CREATIVE,{type:le});c=e,ee.addEventListener(te.AD_LOADED,uc),ee.addEventListener(te.AD_NON_LINEAR_WILL_STOP,hc),ee.addEventListener(te.AD_ERROR,Ec),ee.addEventListener(te.AD_STOPPED,Ec),ee.addEventListener(te.PLAYER_VIDEO_SELECTED,Ec),(async e=>{if(e.integratorType!==Ne.Z4.Hs)return;const t=al();try{const i=await io({initAdOptions:t,creative:e});ee.dispatchEvent(te.AD_LOADED,{...i,position:t.position,isRealAutoplay:t.isRealAutoplay,timeoutInfo:Fi(li),creativeType:"nonlinear"})}catch(e){cc.log("callInitAd failed:",e),hc({error:e})}})(c),Ic()}}catch(e){Oo.error("Failed -",e),ee.dispatchEvent(te.AD_ERROR,{adError:e})}var c},Nc=async e=>{let{injectStyles:t,...i}=e;return g({injectStyles:t,...i}),yc(),gd(),ee.addEventListener(Fd,(e=>{Object.keys(xd).forEach((e=>{xd[e]=t=>$d(e,t),ee.addEventListener(e,xd[e])})),ee.addEventListener(te.PLAYER_VIDEO_SELECTED,Qd),$d(Fd,e)})),Bd.forEach((e=>{ee.addEventListener(e,(t=>{Object.keys(xd).forEach((e=>{ee.removeEventListener(e,xd[e]),xd[e]=null})),$d(e,t)}))})),(async()=>{if(!S("PV5_OMSDK")||(re.N.isTv(N())||O()))return Zd.log("OMSDK for web disabled, sdk not loaded");try{await(0,jd.Bv)(),Zd.log("OMSDK loaded")}catch(e){Zd.log("Unable to load OMSDK lib",e)}})(),To(window,go,H("emulateHeavyAdsAfterMs")),ee.addEventListener(te.AD_STARTED,Kr),ee.addEventListener(te.AD_IMPRESSION,Yr),ee.addEventListener(te.AD_VIDEO_START,Gr),ee.addEventListener(te.AD_VIDEO_COMPLETE,Qr),ys.forEach((e=>e.init())),ee.addEventListener(te.PLAYER_LOAD_VIDEO,Os),ee.addEventListener(te.AD_LINEAR_SLOT_ENDED,Os),ee.addEventListener(te.AD_SDK_READY,Os),fo(),t(".ad_slot{position:absolute;bottom:0;left:0;right:0;top:0}iframe.ad_slot{border:0;height:100%;overflow:hidden;width:100%}.ad_slot iframe[id^=goog]{padding-bottom:4%!important;height:100vh;width:100vw}.video_view[data-with-overlay-ad] iframe[id^=goog_]{padding-bottom:calc(4.5rem - 1.125rem)!important}#video[data-cursor-pointer]{cursor:pointer}@media screen and (min-width:360px){.ad_slot iframe[id^=goog]{padding-bottom:0!important}}@media screen and (min-width:640px){.ad_slot iframe[id^=goog]{padding-bottom:2%!important}}.controls_ad{pointer-events:none}.controls_ad .ad_button,.controls_ad .playback_button,.controls_ad .mute_toggle_button,.controls_ad .fullscreen_toggle_button{pointer-events:auto}","advertising"),await Lo.load({locale:N().getEffectiveLocale(),videoElement:x()}),bd},Uc=()=>{oo(),be.reset(),Ge()}},5275:(e,t,i)=>{i.d(t,{Ez:()=>a,I8:()=>l,IA:()=>u,K7:()=>s,QF:()=>c,VP:()=>o,Y2:()=>r,cv:()=>n,g8:()=>d});const n="Dailymotion",r="1.0",s=window.top,a=3e3,o="full",d=["full","limited","domain","creative"],l=["loaded","start","impression","firstQuartile","midpoint","thirdQuartile","complete","pause","resume","bufferStart","bufferFinish","skipped","volumeChange","playerStateChange","adUserInteraction"],c={LOADING_RESOURCE:3},u={START:"sessionStart",FINISH:"sessionFinish",ERROR:"sessionError"}},8947:(e,t,i)=>{i.d(t,{Xu:()=>_,mB:()=>E,Bv:()=>h,G3:()=>o,UV:()=>l,G$:()=>d});var n=i(5275);const r=i.p+"dmp.omweb-v1.2f8096b04dea540d5bfd.js",s=i.p+"dmp.omid-session-client-v1.582634dfc4708ea0ffca.js";let a=null,o=null,d=null,l=null;const c=new Map,u=new Map,h=async()=>{const e=p(r),t=p(s);if(a=Promise.all([e,t]),await a,o=OmidSessionClient.default,!o)throw"sessionClient is missing"},E=async()=>{if(!a)return!1;try{return await a,!0}catch(e){return!1}},p=e=>new Promise(((t,i)=>{try{const i=document.createElement("script");i.type="text/javascript",i.src=e,i.onload=t,document.body.appendChild(i)}catch(e){i(e)}})),_=(e,t,i)=>{const r=o.Context,s=o.Partner,a=o.AdSession,c=new r(new s(n.cv,n.Y2),e,t);c.setServiceWindow(n.K7),c.underEvaluation=!1,c.setVideoElement(i);const u=new a(c);if(u.setCreativeType("video"),u.setImpressionType("onePixel"),!u.isSupported())throw new Error("AdSession not supported");return d=new o.MediaEvents(u),l=new o.AdEvents(u),v(u)},v=e=>new Proxy(e,{get:(e,t)=>"start"===t?function(){return e[t](),{sessionIframes:A(this)}}:"finish"===t?async function(){return e[t](),{removedIframes:await m(this)}}:e[t]}),A=e=>{const t=e.getAdSessionId(),i=document.querySelectorAll('[id^="omid-verification-script-frame"]'),n=[];return i.forEach((e=>{c.get(e.id)||(c.set(e.id,t),n.push(e))})),u.set(t,n),n},m=e=>new Promise((t=>{const i=e.getAdSessionId(),r=u.get(i)||[];setTimeout((()=>{r.forEach((e=>{e.remove(),c.delete(e.id)})),u.delete(i),t(r)}),n.Ez)}))}}]);</script>
</body>
</html>
