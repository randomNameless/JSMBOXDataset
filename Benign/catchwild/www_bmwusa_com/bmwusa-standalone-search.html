<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bmwusa-standalone-search.html</title>
</head>
<body>

<script>
/*! BMWUSA Vite Build 1731603678170 */
import{C as n}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/component.js";import{m as l}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.js";import{r as h}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-measurement-data.js";import{A as c}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/autocomplete-keyboard.js";import{A as u}from"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/ada-utils.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.esm.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/is-author.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/baseDomain.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/getbyourl.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/scroll-to.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/uid.js";import"/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/zipcode.js";new n({el:".standalone-search",name:"standalone-search Component",events:{"keyup .standalone-search__input":"keyupEvt"},subscriptions:{"window.resizeEnd":"resizeEvt","primary.nav.close":"closeSearch","dealer.open":"closeSearch","my-bmw.open":"closeSearch","fill.clicked":"closeSearch","primary.nav-toggle":"closeSearch","search-results.active-item":"setSearchVal","search-results.close":"closeSearch","search.close":"closeSearch"},count:5,isSearchOpen:!1,isClearSet:!1,searchOpenStr:"standalone-search--active",clearActiveStr:"standalone-search__clear-btn--active",componetBaseStr:"standalone-search",resultStr:"standalone-search-results",currentBreakpoint:window.innerWidth<1280?"mobile":"desktop",endPointBase:"https://search-api.swiftype.com/api/v1/public/engines/suggest.json?q=",key:"ewC-fTzAJvmjkNzgf7xb",activeSearchTerm:!1,init(){var e;this.search=this.element,this.searchBtn=this.search.querySelector(`.${this.componetBaseStr}__search-btn`),this.closeSearchBtn=this.search.querySelector(`.${this.componetBaseStr}__close-search-btn`),this.clearBtn=this.search.querySelector(`.${this.componetBaseStr}__clear-holder`),this.input=this.search.querySelector(`.${this.componetBaseStr}__input`),this.searchHolder=this.search.querySelector(`.${this.componetBaseStr}__search-holder`),this.isButtonOnly=this.element.classList.contains("standalone-search--icon-only"),this.fusionGN=document.querySelector(".cmp-globalnavigation"),this.mobileFusionGN=document.querySelector(".cmp-globalnavigation__primary"),this.navList=(e=this.mobileFusionGN)==null?void 0:e.querySelector(".cmp-globalnavigation__list"),this.navList.style.transition="transform .3s cubic-bezier(.785,.135,.15,.86)",this.openSearch=this.openSearch.bind(this),this.submitSearch=this.submitSearch.bind(this),this.clearInput=this.clearInput.bind(this),this.mobileSearch=this.mobileSearch.bind(this),this.closeSearch=this.closeSearch.bind(this),this.done=this.done.bind(this),this.closeWithKeyboard=this.closeWithKeyboard.bind(this),this.search.addEventListener("submit",this.submitSearch),this.closeSearchBtn.addEventListener("click",this.closeSearch),this.clearBtn.addEventListener("click",this.clearInput),this.currentBreakpoint==="desktop"?this.desktopEvents():this.mobileEvents()},desktopEvents(){this.search.addEventListener("click",this.openSearch),this.search.addEventListener("keydown",this.openSearch),this.element.addEventListener("keydown",this.closeWithKeyboard)},mobileEvents(){this.searchHolder.addEventListener("click",this.mobileSearch)},killMobileEvents(){this.searchHolder.removeEventListener("click",this.mobileSearch)},killDesktopEvents(){this.search.removeEventListener("click",this.openSearch),this.search.removeEventListener("keydown",this.openSearch),this.element.removeEventListener("keydown",this.closeWithKeyboard)},mobileSearch(e){if(!this.isSearchOpen){const t=this.search.getBoundingClientRect(),s=this.fusionGN.getBoundingClientRect();this.mobileFusionGN.addEventListener("touchmove",this.killScroll),this.mobileFusionGN.style.overflow="hidden",this.searchHolder.classList.add(`${this.componetBaseStr}__search-holder--active`),this.search.classList.add(this.searchOpenStr),this.navList.style.transform=`translateY(-${t.top-s.height}px)`,this.isSearchOpen=!0,PubSub.publish("search.mobile.toggle",!0),setTimeout(()=>{window.scrollTo(0,t.offsetTop)},200)}},openSearch(e){this.isButtonOnly&&!this.isSearchOpen&&(e.type==="click"||e.keyCode&&e.keyCode===13)&&(this.isSearchOpen=!0,this.search.classList.add(this.searchOpenStr),this.toggleFill(!1,!0),document.body.classList.add(`${this.componetBaseStr}--kill-scroll`),PubSub.publish("search.open",{open:!0,event:e,currentBreakpoint:this.currentBreakpoint}))},closeWithKeyboard(e){this.isSearchOpen&&e.keyCode&&e.keyCode===27&&this.closeSearch(e)},closeSearch(e){this.isSearchOpen&&(e&&typeof e!="string"&&e.stopPropagation(),this.currentBreakpoint==="mobile"?(this.mobileFusionGN.style.overflow="auto",this.searchHolder.classList.remove(`${this.componetBaseStr}__search-holder--active`),this.search.classList.remove(this.searchOpenStr),this.navList.style.transform="",this.mobileFusionGN.removeEventListener("touchmove",this.killScroll),this.isSearchOpen=!1):(this.search.classList.remove(this.searchOpenStr),this.isSearchOpen=!1,document.body.classList.remove(`${this.componetBaseStr}--kill-scroll`),this.toggleFill(!0,!1),this.searchBtn.focus()),this.isClearSet&&this.clearInput(),PubSub.publish("search.close",!1))},keyupEvt(e){const t=e.target.value;!this.isClearSet&&t.length>0?(this.clearBtn.classList.add(this.clearActiveStr),this.isClearSet=!0):this.isClearSet&&t.length<=0?(this.clearBtn.classList.remove(this.clearActiveStr),this.isClearSet=!1,PubSub.publish("search.empty")):t.length>=3&&e.which!==40&&e.which!==38?(this.getResults(encodeURI(t)),PubSub.publish("search.reset-active-filter")):t.length<3&&e.which!==9&&(this.prevTitles=[],PubSub.publish("search.empty")),e.which===27?PubSub.publish("search.empty"):t.length>=3&&e.which===40?PubSub.publish("search.arrowKey","down"):t.length>=3&&e.which===38&&PubSub.publish("search.arrowKey","up")},getResults(e){h.get(`${this.endPointBase}${e}&per_page=${this.count}&precise_expiration=true&engine_key=${this.key}`).set("Content-Type","application/json").end(this.done)},prevTitles:[],done(e,t){const i=JSON.parse(t.text).records.page,r=[];let o=!0;i&&i.length>0?(i.forEach(a=>{r.indexOf(a.title)<0&&r.push(a.title)}),o=l(r,this.prevTitles)):PubSub.publish("search.empty"),o||(PubSub.publish("search.results",r),this.prevTitles=r)},clearInput(e){this.input.value="",this.clearBtn.classList.remove(this.clearActiveStr),this.isClearSet=!1,this.prevTitles=[],this.input.focus(),PubSub.publish("search.empty")},killScroll(e){e.preventDefault()},sanitizeInput(e){const t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;return e.replace(t,"")},submitSearch(e){var o,a;e.preventDefault();const t=(a=(o=this.search).checkValidity)==null?void 0:a.call(o),s=this.input?this.input.value:null,i=this.search.getAttribute("action"),r=this.activeSearchTerm||s;t&&s&&(this.activeSearchTerm&&this.input&&(this.input.value=this.activeSearchTerm),this.closeSearch(),window.location.href=i+this.sanitizeInput(r))},toggleFill(e=!1,t=!1){const s={className:"standalone-search-fill--active-search",close:e,open:t};PubSub.publish("nav.toggleFill",s)},resizeEvt(e,t){this.currentBreakpoint==="desktop"&&t.width<1280?(this.isSearchOpen&&this.closeSearch(),this.killDesktopEvents(),this.mobileEvents(),this.currentBreakpoint="mobile"):this.currentBreakpoint==="mobile"&&t.width>=1280&&(this.isSearchOpen&&this.closeSearch(),this.desktopEvents(),this.killMobileEvents(),this.currentBreakpoint="desktop")},setSearchVal(e,t){t?this.activeSearchTerm=`&ldquo;${t}&rdquo;`:this.activeSearchTerm=!1}});new n({el:".standalone-search-results",name:"standalone-search-results Component",baseStr:"standalone-search-results",events:{},subscriptions:{"search.open":"toggleDropDown","search.close":"toggleDropDown","search.results":"showResults","search.empty":"clearResults","search.mobile.toggle":"toggleDropDown","search.arrowKey":"activeResults","search.reset-active-filter":"resetActiveResults"},showingPopular:!0,showingSuggestions:!1,suggestionHasRun:!1,desktopWrapperElement:null,currentBreakpoint:window.innerWidth>=1280?"desktop":"mobile",beforeInit(){this.autocompleteKeyboard=new c,this.suggestionsHolder=this.element.querySelector(`${this.el}__suggestions-content`)},init(){this.element.querySelector(`${this.el}__content-holder`).addEventListener("click",this.linksClicked),this.element.addEventListener("keydown",this.closeWithKeyboard),this.desktopWrapperElement=this.element.closest(".standalone-search__show-on-large"),this.isDesktopEl=this.currentBreakpoint==="desktop"&&!!this.desktopWrapperElement,this.trapFocus=null},linksClicked(e){e.target&&e.target.nodeName.toLowerCase()==="a"&&PubSub.publish("search-results.close")},closeWithKeyboard(e){e.key==="Escape"&&PubSub.publish("search-results.close")},toggleDropDown(e,t){if(t&&t.open&&t.currentBreakpoint==="desktop"&&this.isDesktopEl){this.resetTrapFocus(!0),this.element.classList.add(`${this.baseStr}--active`);const s=this.element.querySelector(".standalone-search__input");s&&(s.value="",s.focus()),this.element.querySelector(`${this.el}__content-holder`).focus()}else!t&&this.isDesktopEl&&(this.clearResults(),this.resetTrapFocus(!1))},showResults(e,t){this.isDesktopEl&&(this.showingPopular?(this.showingPopular=!1,this.togglePopular(!1),this.suggestionHasRun?this.displayList(t):(this.suggestionHasRun=!0,this.suggestionsHolder.appendChild(this.resultsTemplateList(t)),this.suggestionsList=this.suggestionsHolder.querySelector("ul").children),this.toggleSuggestions(),this.showingSuggestions=!0):this.showingSuggestions&&this.displayList(t),this.resetTrapFocus(!0))},resetTrapFocus(e){if(e){this.trapFocus&&this.trapFocus.removeTrapEventListener();const t=this,s=document.body.querySelectorAll(".standalone-search__show-on-large .standalone-search-results"),i=document.body.querySelector(".standalone-search__show-on-large .standalone-search__close-search-btn");s[0]&&(t.trapFocus=u.trapFocus(s[0],i),t.trapFocus.addTrapFocus())}else this.trapFocus&&this.trapFocus.removeTrapEventListener()},displayList(e){this.suggestionsHolder.querySelector("ul").innerHTML=this.makeList(e)},resultsTemplateList(e){const t=document.createElement("ul");return t.className="standalone-search-results__list",t.innerHTML=this.makeList(e),t},togglePopular(e=!0){const t=this.element.querySelector(`${this.el}__popular-content`);e?t.classList.remove(`${this.baseStr}__popular-content--inactive`):t.classList.add(`${this.baseStr}__popular-content--inactive`)},toggleSuggestions(e=!0){e?this.suggestionsHolder.classList.remove(`${this.baseStr}__suggestions-content--inactive`):this.suggestionsHolder.classList.add(`${this.baseStr}__suggestions-content--inactive`)},makeList(e){const t=document.querySelector(".standalone-search").getAttribute("action"),s=window.innerWidth>1280?100:45;let i="";return e&&e.length>0&&e.forEach(r=>{let o=r;if(typeof o!="string")return i;r.length>s&&(o=`${r.substring(0,s)}...`),o=o.replace(/\s+\u002D+\s|\s+\u2014+\s/g," – ");const a=o.split(" – ");a.length>2&&(o=a.slice(0,2).join(" – ")),i+=`<li><a href="${t}${encodeURI(r)}">${o.trim()}</a></li>`}),i},activeResults(e,t){const s=this.suggestionsList.length,i="search-auto-active",r=this.suggestionsHolder.querySelector(`.${i}`),a=this.autocompleteKeyboard.runKeyboardHighlights({max:s,activeStr:i,resultItems:this.suggestionsList,activeItem:r},t).querySelector("a").textContent;PubSub.publish("search-results.active-item",a.trim())},checkActiveFilter(){const e=this.suggestionsHolder.querySelector(".search-auto-active");e&&e.classList.remove("search-auto-active")},resetActiveResults(){this.autocompleteKeyboard.reset(),this.checkActiveFilter(),PubSub.publish("search-results.active-item",!1)},clearResults(){this.toggleSuggestions(!1),this.togglePopular(),this.resetActiveResults(),this.suggestionHasRun&&(this.resetTrapFocus(!0),this.suggestionsHolder.querySelector("ul").innerHTML="",this.showingPopular=!0,this.showingSuggestions=!1)}});new n({el:".standalone-search",name:"Standalone Search Component",init(){window.onload=()=>this.setDocumentFocus()},setDocumentFocus(){document.querySelector("body").focus()}});

</script>

</body>
</html>
