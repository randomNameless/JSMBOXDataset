<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review_Loader.d52afeec.html</title>
</head>
<body>

<script>
import{R as p}from"./index.8365acb2.js";import{F as C}from"./FontIcon_FontAwesome5.0e0cb40f.js";import{j as e}from"./jsx-runtime.7d759e48.js";import{F as $}from"./FontIcon_MaterialIcons.959bf5eb.js";import{u as E}from"./useReavar.8d1e1e12.js";import{l as y}from"./reavars.660bacce.js";import{b as M,a as q,l as D}from"./LocalStorage.f84880a8.js";import{m as O,a as K}from"./marking_system.41c8f6bb.js";import{a as T,R as S,g as z}from"./ReviewItem.1a62fc6f.js";import{u as A}from"./useQuery.a4ed7007.js";import{c as Q}from"./index.6a5a335b.js";import{g as w}from"./index.f5993dad.js";import{c as W}from"./client.56225896.js";import{f as H}from"./fgm_account_userData_list.112ecdea.js";import{f as P}from"./fgm_content_comicData_list.733373f3.js";import{f as G}from"./fgm_marking_reviewData_list.7521c959.js";import{L as J}from"./LoadMore.458982d8.js";import{u as U}from"./useInfiniteQuery.da027292.js";import{R as V}from"./ReactProviders.242c2151.js";import"./CreateIcon.643c07e4.js";import"./global_theme.97ef2353.js";import"./marking_emotions.f1bb90d8.js";import"./marking_statuss.9d622f52.js";import"./ScoreStars.e56e12c1.js";import"./UserGender.a1a2b5a6.js";import"./FontIcon_Ionicons.90979cef.js";import"./MarkdownDisplay.25bf213f.js";import"./lodash.e84e4d54.js";import"./func_attachment_name_to_http.94bdbc5a.js";import"./func_base_domain.794ffdc8.js";import"./index.c4d45b2c.js";import"./LimitHeight.62cc5c6f.js";import"./TimeAgo.2237c5b8.js";import"./ComicCard_Stats.659fb23c.js";import"./func_readable_number.28566f22.js";import"./QuickLookButton.a2ca1767.js";import"./FontIcon_Entypo.d5a1bd20.js";import"./MarkingButton_Follow.899435d0.js";import"./FontIcon_FontAwesome.5dcf1038.js";import"./index.4cf809ff.js";import"./store.e7c0cc53.js";import"./ComicCard_Cover.c2be3f6b.js";import"./ComicCard_Image.5663b9d7.js";import"./ComicCard_Title.d462ffd1.js";import"./LangFlag.dc463e30.js";import"./ComicCard_Genres.6f7d84de.js";import"./content_comic_genres.23019868.js";import"./GenreItemText.268a3cfa.js";import"./UserAvatar.6eccc366.js";import"./useMutation.bcca56b6.js";import"./utils.8269c30c.js";import"./system_QueryClient_DefaultOptions.2a38a32d.js";import"./FontIcon_AntDesign.4fef2788.js";import"./FontIcon_Octicons.81468a48.js";import"./RichEditor.5300c3c3.js";import"./WarnedMask.7e403412.js";import"./func_nodeapi.80362569.js";import"./axios.4a70c6fc.js";import"./useBaseQuery.5308c781.js";import"./fgm_content_comic_stat.9db93b58.js";function X(s){const{sess:c,comicId:r=null}=s,[i,o]=p.useState(!1);p.useState("");const n=`my_by_comicid_${r}`,t=["marking_review_node",n],a={with_userNode:!0,with_comicNode:!0},{data:l,isError:d,isSuccess:g,isLoading:_,isFetching:f,refetch:h}=A(t,()=>z({id:n},a)),j=String(l?.data?.content?.code||""),v=[t];l?.data?.id&&v.push(["marking_review_node",l.data.id]);function b(){o(!i)}function x(){o(!i)}return f?e.jsx("div",{children:e.jsx("button",{className:"btn btn-sm btn-block",disabled:!0,children:e.jsx("span",{className:"loading loading-spinner loading-xs"})})}):d?e.jsx("div",{children:e.jsx("button",{className:"btn btn-sm btn-error btn-block",onClick:h,children:"Try again"})}):i?e.jsx(e.Fragment,{children:e.jsx(T,{sess:c,comicId:r,reviewNode:l,innerText:j,onCancel:b,onDone:x})}):g?l?.data?e.jsx("div",{className:"w-full p-3 border border-secondary/30 bg-secondary/5",children:e.jsx(S,{...s,item:l,gqlOpt:a,quickEditBtn:!0})}):e.jsx("div",{children:e.jsx("button",{className:"btn btn-sm btn-primary btn-block",onClick:()=>o(!i),children:"Write My Review"})}):e.jsx("div",{children:e.jsx("button",{className:"btn btn-sm btn-block",disabled:!0,children:e.jsx("span",{className:"loading loading-spinner loading-xs"})})})}function Y(s){const{score:c=null,status:r=null,sortBy:i}=s;function o(t){y(t),M(q.marking_review_list_sortBy,t)}const n=O;return e.jsxs("div",{className:"my-4 flex justify-between items-center opacity-60 text-xs md:text-base",children:[e.jsxs("select",{className:"select select-xs select-bordered border-base-200 bg-base-200 ring-0 py-0",disabled:!0,children:[e.jsx("optgroup",{label:"Filter",children:e.jsx("option",{value:null,children:"Filter (not done)"})}),e.jsxs("optgroup",{label:"score",children:[e.jsx("option",{children:"Rated 10"}),e.jsx("option",{children:"Rated 1"})]}),e.jsx("optgroup",{label:"Status",children:e.jsx("option",{children:"Reading"})}),e.jsx("optgroup",{label:"Emotion",children:e.jsx("option",{children:"Awesome"})})]}),e.jsx("div",{className:"flex flex-wrap justify-end items-center",children:n.map(({file:t,text:a})=>e.jsx("span",{className:Q("ml-2 normal-case cursor-pointer hover:underline",{"text-base-content":i!==t,"text-accent underline":i===t}),onClick:()=>o(t),children:a},t))})]})}function Z(s={},{with_userNode:c=!1,with_comicNode:r=!1}={},i=null){let o=c?w`
  userNode {
    id
    data {
      ${H}
    }
  }
  `:"",n=r?w`
  comicNode {
    id
    data {
      ${P}
    }
  }
  `:"";return async function({pageParam:t={}}={}){const a={select:Object.assign({},s,t)},l=w`
    query get_marking_reviewList($select: ReviewListSelect) {
      get_marking_reviewList(
        select: $select
      ) {
        reqLimit
        newStart
        items {
          id
          data {
            ${G}
            ${o}
            ${n}
          }
          sser_vote_val
        }
      }
    }
    `;return(await W().rawRequest(l,a)).data.get_marking_reviewList}}function ee(s){const{sess:c,where:r,comicId:i=null,userId:o=null,sortBy:n=null,start:t=null,first:a=null,limit:l=null}=s,d={where:r,comicId:i,userId:o,sortBy:n,start:t,limit:a},g=["marking_review_list",d],_={with_userNode:!0,with_comicNode:!i},{data:f,isLoading:h,isFetching:j,isFetchingNextPage:v,isRefetching:b,isSuccess:x,isError:L,fetchNextPage:F,hasNextPage:I}=U(g,Z(d,_),{getNextPageParam:(m,R)=>{if(!(!m||!m.newStart||!m.items.length||m.items.length<m.reqLimit))return{start:m.newStart,limit:l}}}),N=!!f?.pages?.[0]?.items?.length;let u;return h||j||v||b?u="loading":x&&!N?u="no_data":x&&!I?u="no_more":L&&(u="failure"),e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:"grid grid-cols-1 gap-5 post-items",children:f.pages.map((m,R)=>e.jsx(p.Fragment,{children:m.items?.map((k,se)=>e.jsx(S,{sess:c,...s,item:k,sortBy:n,where:r,gqlOpt:_},k.id))},R))}),e.jsx(J,{status:u,onClick:F})]})}function B(s){const{sess:c,comicId:r,userId:i,noSort:o,sortBy:n=null}=s,t=E(y);return p.useEffect(()=>{const a=n||D(q.marking_review_list_sortBy)||K;y(a)},[n]),t?e.jsxs("div",{className:"space-y-5",children:[!!r&&e.jsx(X,{...s}),!o&&e.jsx(Y,{...s,sortBy:t}),e.jsx(ee,{...s,sortBy:t})]}):null}function te(s){const{title:c="Reviews",count_review:r=0,autoLoad:i=!1,noHead:o=!1,noSort:n=!1}=s,[t,a]=p.useState(i);return o?e.jsx(B,{...s}):e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex justify-between items-center select-none",children:[e.jsxs("div",{className:"flex justify-between items-center space-x-1 cursor-pointer",onClick:()=>a(!t),children:[e.jsx($,{name:"rate-review",size:20}),e.jsx("b",{className:"text-xl font-variant-small-caps",children:c}),r>0&&e.jsx(e.Fragment,{children:e.jsxs("span",{className:"text-sm text-base-content opacity-50",children:["(",r,")"]})})]}),e.jsx("span",{className:"cursor-pointer",onClick:()=>a(!t),children:e.jsx(C,{name:t?"minus-square":"plus-square",size:20})})]}),t&&e.jsx(B,{...s})]})}function lt(s){const{sess:c}=s;return e.jsx(V,{sess:c,children:e.jsx(te,{...s})})}export{lt as default};

</script>

</body>
</html>
