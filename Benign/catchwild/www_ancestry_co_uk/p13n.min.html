<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>p13n.min.html</title>
</head>
<body>

<script>
!function(){const s="cdp:expiry",l="cdp:data",a="cdp:userid",i="cdp:dirtyDataTS",o="cdp:userClientState",c=12e4;let d=!1,u;const w=()=>{try{window.sessionStorage}catch(e){return null}return window.sessionStorage},m=(r,e)=>{let t=w();var n,a=(new Date).getTime();let i=!0;return t&&(n=t.getItem(s),i=void 0===n||n<a),r||i?new Promise(function(e,t){((e,t)=>{let r=location.href;var n=r.indexOf("/",8),n=(r=0<n?r.substring(0,n):r)+"/app-api/cdp-p13n/api/v1/users/me?attributes=All";return d?u:(d=!0,u=fetch(n,{method:"GET",headers:{"x-bypass-cache":e,"Ancestry-ClientPath":t}}).then(e=>{if(d=!1,200==e.status)return e.json();throw new Error("Error from CDP service: "+e.status)}))})(r,"p13n-js").then(t=>{t=t.data;if(!p()){{var r=t;const n=(new Date).getTime();let e=w();if(e){e.setItem(l,JSON.stringify(r));e.setItem(s,n+c)}}f(t)}e(t)}).catch(e=>{t(new Error("Error while fetching data from CDP"))})}):t.getItem(l)},p=()=>{let e=w(),t=!1;var r,n;return e&&(r=(new Date).getTime(),n=e.getItem(i),t=null!=n&&r<n),t};async function e(t=!1,e=null){let r;try{(r=(i=t,s=e,await new Promise(function(e,t){let r=w(),n=!1;return(n=i?n:p())||void 0===window.cdp_p13n.data||i||b(window.cdp_p13n.data)?null==(a=r?r.getItem(l):null)||n||b(JSON.parse(a))?(null!=a&&b(JSON.parse(a))&&(n=!0),e(m(i||n,s))):(f(JSON.parse(a)),e(JSON.parse(a)),void m(i,s)):e(window.cdp_p13n.data);var a}))).customer_type=await n(r)}catch(e){t=await n();r={customer_type:t}}var i,s;return r}const f=e=>{window.cdp_p13n.isDataReady=!0,window.cdp_p13n.data=e};const v=e=>{let t;switch(Number(e)){case 10:t="nrvisitor";break;case 20:t="registrant";break;case 30:t="trialer";break;case 35:t="registrant";break;case 40:t="subscriber";break;case 50:t="registrant"}return t};async function n(i){return new Promise(function(e,t){let r=w(),n;var a;r?(n=r.getItem(o),a=_(i),n<a&&(n=a),e(v(n))):e(v(_(i)))})}const _=e=>{if(null==e)return 0;let t=10;return null==e.ucdmid&&null==e.registration_date||(t=20,!0===e.behavior_is_current_trialer&&(t=30),!0===e.behavior_was_ever_trialer&&!1===e.behavior_is_current_trialer&&(t=35),!0===e.behavior_is_current_subscriber&&(t=40),!0===e.behavior_was_ever_subscriber&&!1===e.behavior_is_current_subscriber&&(t=50)),t};const b=e=>null!=e.ucdmid&&!(null!=window.ancestry.userId);window.cdp_p13n={invalidateCache:()=>{delete window.cdp_p13n.data;let e=w();e&&(e.removeItem(s),e.removeItem(l),e.setItem(i,(new Date).getTime()+3e4))},getProfileFromCDP:e},window.addEventListener("unified-library-user-behavior",function(e){if("CommerceUI_OrderPlaced"===e.detail.eventName){let r=e.detail.conversionFlowType;if(null!=r){r=r.toLowerCase();let t=w();if(t){let e=t.getItem(o);r.includes("free trial")?e<30&&(e=30):(r.includes("downgrade")||r.includes("upgrade")||r.includes("hard offer"))&&e<40&&(e=40),t.setItem(o,e)}}}}),e();{let e=w();var r,g=(()=>{let r=w(),n=false;if(r){let e=r.getItem(a);let t=window.ancestry.userId;if(t!==null&&t!==undefined){t=t.toLowerCase();if(e==null||t!=e){r.setItem(a,t);n=true}}else if(e){r.removeItem(a);n=true}}return n})();let t=10;null!==window.ancestry.userId&&(t=20),e&&(r=e.getItem(o),(g||null==r||t>r)&&e.setItem(o,t))}}();
//# sourceMappingURL=p13n.min.js.map
</script>

</body>
</html>
