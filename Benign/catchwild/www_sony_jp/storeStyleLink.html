<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>storeStyleLink.html</title>
</head>
<body>

<script>
;( function ( $ ) {

  $( function () {

    var sonyjp = jsDomain || 'www.sony.jp';

    var APIUrl;
    var TableUrl = 'https://' + sonyjp + '/share5/js/storeStyleLink.json';
    var table;
    var additionalJsonUrl = 'https://' + sonyjp + '/share5/sideinclude/storeStyleLinkAdd.json';
    var additionalJson;
    var callbackIndex = 0;
    var delayTime = 500; // ms
    var delayIndex = 0;
    var loopIndex     = 0;
    var isCarousel    = false;
    // api にリクエストしているURLを格納してhtmlに出力するための配列
    // javascript からは リクエストヘッダー情報にアクセスできなかったので、
    // ajaxで送信されるリクエストURLを擬似的に作ってリストにため、
    // 開発環境にだけhtml出力する。
    var reqUrl = [];

    // SearchResult は 購入導線にqueryを付与する。queryは body に与えられるのでそれを付与する。
    var addPurchaseUrlQuery = $('body').attr('data-search-current');

    // Line の webview で閲覧の際は購入導線にブラウザ起動させる為にパラメータをつける
    var userAgent = window.navigator.userAgent.toLowerCase();
    var isLine = false;
    var lineViewParam = '?openExternalBrowser=1';

    if(userAgent.indexOf('line') != -1) {
      isLine = true;
    }

    var toLocaleString = function ( number ) {

      return String( number ).split( '' ).reverse().join( '' ).match( /\d{1,3}/g).join( ',' ).split( '' ).reverse().join( '' );

    }

    var testHoge = null;

    // 販売終了(endOfSale)が最優先で表示される
    //
    var templates = {
      // supportの付属品の購入ページで利用
      // /support/repair_parts.html
      // support は "購入動線が出ない" ステータスコードの場合に
      // 固定の問い合わせリンクを出したいため、専用に用意

      //'<div data-s5-price-api-status="<%= saleStatus %>"></div>'

      // Search template で利用。
      'searchResult': _.template( [
        '<!-- st:<%= saleStatus %> -->',
        '<% if ( endOfSale ) { %>',
          '<div class="s5-searchResultItem__store">',
            '<span class="s5-searchResultItem__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError && !display ) { %>',
          // SearchResult は 検索ヒットする以上、その日の早朝時点では購入ページが存在したことは確実とのこと。
          // st:99 でも「取り扱いのない商品です」は言い過ぎになってしまう可能性があるとのことなので何も表示しない。
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // searchResult にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-searchResultItem__store">',
            '<% if ( priceDisplay ) { %>',
              '<span class="s5-searchResultItem__storeText">ソニーストアで購入すると</span>',
              '<span class="s5-searchResultItem__storePrice"><%= price %></span>',
              '<span class="s5-searchResultItem__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span class="s5-searchResultItem__storeNote"><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonText != null ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-searchResultItem__storeButtonContainer">',
                '<a class="s5-storeButton" href="<%= buttonUrl %>">',
                  '<%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-searchResultItem__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-searchResultItem__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      // MySony App Search template で利用。
      'msaSearchResult': _.template( [
        '<!-- st:<%= saleStatus %> -->',
        '<% if ( endOfSale ) { %>',
          '<div class="MSASearchResultItem__store">',
            '<span class="MSASearchResultItem__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError && !display ) { %>',
          // SearchResult は 検索ヒットする以上、その日の早朝時点では購入ページが存在したことは確実とのこと。
          // st:99 でも「取り扱いのない商品です」は言い過ぎになってしまう可能性があるとのことなので何も表示しない。
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // searchResult にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="MSASearchResultItem__store">',
            '<% if ( priceDisplay ) { %>',
              '<span class="MSASearchResultItem__storeText">ソニーストア販売価格</span>',
              '<span class="MSASearchResultItem__storePrice"><%= price %></span>',
              '<span class="MSASearchResultItem__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span class="MSASearchResultItem__storeNote"><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonText != null ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="MSASearchResultItem__storeButtonContainer">',
                '<a class="s5-storeButton" href="<%= buttonUrl %>">',
                  '<%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="MSASearchResultItem__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="MSASearchResultItem__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'supportRepairParts': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<a href="/support/repair_parts/inquiry.html" target="_blank" data-s5-support-repair-api-button >',
            '<span class="s5-secondaryButton s5-secondaryButton--icon"><span class="s5-icon-envelope"></span> メールで注文・お問い合わせ</span>',
          '</a>',
        '<% } else if ( statusError ) { %>',
          '<a href="/support/repair_parts/inquiry.html" target="_blank" data-s5-support-repair-api-button>',
            '<span class="s5-secondaryButton s5-secondaryButton--icon"><span class="s5-icon-envelope"></span> メールで注文・お問い合わせ</span>',
          '</a>',
        '<% } else if ( display ) { %>',
          '<div class="s5-supportRepairParts__store">',
            '<% if ( priceDisplay ) { %>',
            '<span class="s5-supportRepairParts__storeText">ソニーストアで購入すると</span>',
                '<span class="s5-supportRepairParts__storePrice" data-s5-support-repair-api-price><%= price %></span>',
                '<span class="s5-supportRepairParts__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-supportRepairParts__storeText"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( !saleOff ) { %>',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
              '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                '<div class="s5-supportRepairParts__storeButtonContainer">',
                  '<a class="s5-storeButton s5-supportRepairParts__storeButton" href="<%= buttonUrl %>"',
                  ' data-s5-support-repair-api-button',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                  '</a>',
                '</div>',
                '<% if ( mailTextView ) { %>',
                  '<span class="s5-supportRepairParts__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                '<% } %>',
                '<% if ( entryTextView ) { %>',
                  '<span class="s5-supportRepairParts__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                '<% } %>',
              '<% } %>',
            '<% } else { %>',
              '<a href="/support/repair_parts/inquiry.html" target="_blank" data-s5-support-repair-api-button>',
                '<span class="s5-secondaryButton s5-secondaryButton--icon"><span class="s5-icon-envelope"></span> メールで注文・お問い合わせ</span>',
              '</a>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      // トップページのみで利用中
      // 必要に応じて`home-`を取り汎用化する
      'home-PriceSimple': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<div class="home-PriceSimple">',
          '<% if ( endOfSale ) { %>',
            '<span class="home-PriceSimple__storeText">',
              '<%= endOfSaleText %>',
            '</span>',
          '<% } else if ( statusError ) { %>',
            '<span class="home-PriceSimple__storeText">',
              '<%= statusErrorText %>',
            '</span>',
          '<% } else if ( display ) { %>',
            '<% if ( priceDisplay ) { %>',
              '<span class="home-PriceSimple__storeText">ソニーストアで購入すると</span>',
              '<span class="home-PriceSimple__price"><%= price %></span>',
              '<span class="home-PriceSimple__unit">',
                '円',
                '<% if ( priceTaxfree ) { %>',
                  '(税込) ',
                '<% } %>',
                '<%= priceSuffix %>',
                // '<% if ( saleEstimatedPrice ) { %>',
                //   '<%= saleEstimatedPriceText %>',
                // '<% } %>',
              '</span>',
            '<% } %>',
          '<% } %>',
        '<div>'
      ].join( '' ) ),


      'sonystoreListBlockFullWide': _.template( [

        '<div class="s5-sonystoreListBlock__item1Col">',
          // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
          // target の st は 99
          '<% if ( statusError ) { %>',
            '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
          '<% } else { %>',
            '<% if ( page.length > 0 ) { %>',
              '<div class="s5-sonystoreListBlock__labelGroup">',
                '<% _.each( page, function ( item ) { %>',
                  '<% if ( item.id === 1 ) { %>',
                    '<span class="s5-label s5-label--1"><%= item.content %></span>',
                  '<% } else if ( item.id === 222 ) { %>',
                    '<span class="s5-label s5-label--2"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
                    '<span class="s5-label s5-label--3"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
                    '<span class="s5-label s5-label--4"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
                    '<span class="s5-label s5-label--5"><%= item.content %></span>',
                  '<% } else { %>',
                    '<span class="s5-label"><%= item.content %></span>',
                  '<% } %>',
                '<% } ) %>',
              '</div>',
            '<% } %>',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-sonystoreListBlock__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-sonystoreListBlock__productName"><%= productName %></div>',
                  '<div class="s5-sonystoreListBlock__productName"><%= modelName %></div>',
                  '<div class="s5-sonystoreListBlock__productNameSub"><%= modelNameNote %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-sonystoreListBlock__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
            '<% } %>',
          '</div><!-- ./s5-sonystoreListBlock__item1Col -->',

          '<div class="s5-sonystoreListBlock__item1Col">',
            '<% if ( manualEndOfSale ) { %>',
              '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
            '<% } else if ( endOfSale ) { %>',
              '<p class="s5-p2"><%= endOfSaleText %></p>',
            // '<% } else if ( statusError ) { %>',
            //   '<p class="s5-p2"><%= statusErrorText %></p>',
            '<% } else if ( display ) { %>',
              '<div class="s5-sonystoreListBlock__storeGroup">',
                '<span class="s5-sonystoreListBlock__storeText">ソニーストアで購入すると</span>',
                '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                  '<p class="s5-sonystoreListBlock__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                '<% } %>',
                '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-sonystoreListBlock__storePrice"><%= price %></span>',
                      '<span class="s5-sonystoreListBlock__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-sonystoreListBlock__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                '<% } %>',
              '</div>',
              '<% if ( !saleOff ) { %>',
                '<div class="s5-sonystoreListBlock__benefitLabel">',
                  '<% _.each( shipment, function ( item ) { %>',
                    '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                  '<% } ) %>',
                  '<% _.each( bennefits, function ( item ) { %>',
                    '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                  '<% } ) %>',
                '</div>',
              '<% } %>',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
              '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                '<div class="s5-sonystoreListBlock__buttonContainer">',
                  '<a class="s5-storeButton s5-sonystoreListBlock__storeButton" href="<%= buttonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                  '</a>',
                '</div>',
                '<% if ( mailTextView ) { %>',
                  '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                '<% } %>',
                '<% if ( entryTextView ) { %>',
                  '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                '<% } %>',
              '<% } %>',
            '<% } %>',

          '<% } %>',
        '</div><!-- ./s5-sonystoreListBlock__item1Col -->'
      ].join( '\n' ) ),


      'sonystoreListBlockFull': _.template( [
        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( page.length > 0 ) { %>',
            '<div class="s5-sonystoreListBlock__labelGroup">',
              '<% _.each( page, function ( item ) { %>',
                '<% if ( item.id === 1 ) { %>',
                  '<span class="s5-label s5-label--1"><%= item.content %></span>',
                '<% } else if ( item.id === 222 ) { %>',
                  '<span class="s5-label s5-label--2"><%= item.content %></span>',
                '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
                  '<span class="s5-label s5-label--3"><%= item.content %></span>',
                '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
                  '<span class="s5-label s5-label--4"><%= item.content %></span>',
                '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
                  '<span class="s5-label s5-label--5"><%= item.content %></span>',
                '<% } else { %>',
                  '<span class="s5-label"><%= item.content %></span>',
                '<% } %>',
              '<% } ) %>',
            '</div>',
          '<% } %>',
          '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
            '<div class="s5-sonystoreListBlock__productNameGroup">',
              '<% if ( productName !== "" ) { %>',
                '<div class="s5-sonystoreListBlock__productName"><%= productName %></div>',
                '<div class="s5-sonystoreListBlock__productName"><%= modelName %></div>',
                '<div class="s5-sonystoreListBlock__productNameSub"><%= modelNameNote %></div>',
              '<% } %>',
              '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                '<div class="s5-sonystoreListBlock__ownerReview">',
                  '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                '</div>',
              '<% } %>',
            '</div>',
          '<% } %>',

          '<% if ( manualEndOfSale ) { %>',
            '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
          '<% } else if ( endOfSale ) { %>',
            '<p class="s5-p2"><%= endOfSaleText %></p>',
          // '<% } else if ( statusError ) { %>',
          //   '<p class="s5-p2"><%= statusErrorText %></p>',
          '<% } else if ( display ) { %>',
            '<div class="s5-sonystoreListBlock__storeGroup">',
              '<span class="s5-sonystoreListBlock__storeText">ソニーストアで購入すると</span>',
              '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                '<p class="s5-sonystoreListBlock__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
              '<% } %>',
              '<% if ( priceDisplay ) { %>',
                  '<div',
                    '<% if ( couponsAvailable ) { %>',
                      ' data-s5-store-discount',
                      ' data-s5-store-discount-type="sonystoreListBlock"',
                      ' data-s5-store-discount-price="<%= price %>"',
                      ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                      ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                      ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                      ' data-s5-store-discount-productCode="<%= productCode %>"',
                    '<% } %>',
                  '>',
                    '<span class="s5-sonystoreListBlock__storePrice"><%= price %></span>',
                    '<span class="s5-sonystoreListBlock__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                    '<% if ( saleEstimatedPrice ) { %>',
                      '<span class="s5-sonystoreListBlock__storeText"><%= saleEstimatedPriceText %></span>',
                    '<% } %>',
                  '</div>',
              '<% } %>',
            '</div>',
            '<% if ( !saleOff ) { %>',
              '<div class="s5-sonystoreListBlock__benefitLabel">',
                '<% _.each( shipment, function ( item ) { %>',
                  '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
                '<% _.each( bennefits, function ( item ) { %>',
                  '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
              '</div>',
            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-sonystoreListBlock__buttonContainer">',
                '<a class="s5-storeButton s5-sonystoreListBlock__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '<% } %>',

        '<% } %>'
      ].join( '\n' ) ),


      'sonystoreListBlock': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<div class="s5-sonystoreListBlock__storeGroup">',
            '<span class="s5-sonystoreListBlock__storeText">ソニーストアで購入すると</span>',
            '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
              '<p class="s5-sonystoreListBlock__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
            '<% } %>',
            '<% if ( priceDisplay ) { %>',
                '<div',
                  '<% if ( couponsAvailable ) { %>',
                    ' data-s5-store-discount',
                    ' data-s5-store-discount-type="sonystoreListBlock"',
                    ' data-s5-store-discount-price="<%= price %>"',
                    ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                    ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                    ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                    ' data-s5-store-discount-productCode="<%= productCode %>"',
                  '<% } %>',
                '>',
                  '<span class="s5-sonystoreListBlock__storePrice"><%= price %></span>',
                  '<span class="s5-sonystoreListBlock__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                  '<% if ( saleEstimatedPrice ) { %>',
                    '<span class="s5-sonystoreListBlock__storeText"><%= saleEstimatedPriceText %></span>',
                  '<% } %>',
                '</div>',
            '<% } %>',
          '</div>',
          '<% if ( !saleOff ) { %>',
            '<div class="s5-sonystoreListBlock__benefitLabel">',
              '<% _.each( shipment, function ( item ) { %>',
                '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
              '<% } ) %>',
              '<% _.each( bennefits, function ( item ) { %>',
                '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
              '<% } ) %>',
            '</div>',
          '<% } %>',
          '<% if ( pageIcon2 ) { %>',
            '<p class="s5-p1"><%= pageIcon2Text %></p>',
          '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div class="s5-sonystoreListBlock__buttonContainer">',
              '<a class="s5-storeButton s5-sonystoreListBlock__storeButton" href="<%= buttonUrl %>"',
              ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
              ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
              ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
              '>',
                '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
              '</a>',
            '</div>',
            '<% if ( mailTextView ) { %>',
              '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
            '<% } %>',
            '<% if ( entryTextView ) { %>',
              '<span class="s5-sonystoreListBlock__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
            '<% } %>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),


      'inStoreProductInfo': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if( ( productName !== "" ) || ( productCode !== "" ) ){ %>',
            '<div class="s5-inStoreProductInfo__productNameGroup">',
              '<% if ( productName !== "" ) { %>',
                '<div class="s5-inStoreProductInfo__modelName"><%= productName %></div>',
                '<div class="s5-inStoreProductInfo__modelName"><%= modelName %></div>',
                '<div class="s5-inStoreProductInfo__modelNameSub"><%= modelNameNote %></div>',
              '<% } %>',
              '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                '<div class="s5-inStoreProductInfo__ownerReview">',
                  '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                '</div>',
              '<% } %>',
            '</div>',
          '<% } %>',
          '<% if ( manualEndOfSale ) { %>',
            '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
          '<% } else if ( endOfSale ) { %>',
            '<p class="s5-p2"><%= endOfSaleText %></p>',
          // '<% } else if ( statusError ) { %>',
          //   '<p class="s5-p2"><%= statusErrorText %></p>',
          '<% } else if ( display ) { %>',
            '<div class="s5-inStoreProductInfo__store">',
              '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
              '<% if ( priceDisplay ) { %>',
                '<div',
                  '<% if ( couponsAvailable ) { %>',
                    ' data-s5-store-discount',
                    ' data-s5-store-discount-type="sonystoreListBlock"',
                    ' data-s5-store-discount-price="<%= price %>"',
                    ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                    ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                    ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                    ' data-s5-store-discount-productCode="<%= productCode %>"',
                  '<% } %>',
                '>',
                  '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                  '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                  '<% if ( saleEstimatedPrice ) { %>',
                    '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                  '<% } %>',
                '</div>',
              '<% } %>',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
              '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                '<div class="s5-inStoreProductInfo__storeButtonContainer">',
                  '<a class="s5-storeButton s5-inStoreProductInfo__storeButton" href="<%= buttonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                    '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                  '</a>',
                '</div>',
                '<% if ( mailTextView ) { %>',
                  '<span class="s5-inStoreProductInfo__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                '<% } %>',
                '<% if ( entryTextView ) { %>',
                  '<span class="s5-inStoreProductInfo__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                '<% } %>',
              '<% } %>',
            '</div>',
          '<% } %>',

        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItem1Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItem1__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItem1__text">',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItem1__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItem1__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItem1__modelName"><%= modelName %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItem1__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
              '<div class="s5-inStoreItem1__line">',
                '<p><%= modelCatchCopy %></p>',
                '<p class="s5-small1"><%= modelNameNote %></p>',
              '</div>',
            '<% } %>',
            '<div class="s5-inStoreProductInfo">',
              '<% if ( manualEndOfSale ) { %>',
                '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
              '<% } else if ( endOfSale ) { %>',
                '<p class="s5-p2"><%= endOfSaleText %></p>',
              // '<% } else if ( statusError ) { %>',
              //   '<p class="s5-p2"><%= statusErrorText %></p>',
              '<% } else if ( display ) { %>',
                '<div class="s5-inStoreProductInfo__store">',
                  '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
                  '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                      '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( pageIcon2 ) { %>',
                    '<p class="s5-p1"><%= pageIcon2Text %></p>',
                  '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                    '<div class="s5-inStoreItem1__buttonContainer s5-general--mt10">',
                      '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                      '</a>',
                    '</div>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '<% } %>',
                  '<% if ( modelAddButtonLink !== "" ) { %>',
                    '<div class="s5-inStoreItem1__buttonContainer s5-general--mt10">',
                      '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                      '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                      ' onclick="<%= modelAddButtonCustomLink %>"',
                      '<% } %>',
                      '<% if ( modelAddButtonLinkBlank ) { %>',
                      ' target="_blank"',
                      '<% } %>',
                      '>',
                        '<%= modelAddButtonName %>',
                        '<% if ( modelAddButtonLinkBlank ) { %>',
                        ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                        '<% } %>',
                      '</a>',
                    '</div>',
                  '<% } %>',
                '</div>',
              '<% } %>',
            '</div><!-- /.s5-inStoreProductInfo -->',
          '</div><!-- /.s5-inStoreItem1__text -->',

        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItem2Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItem2__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItem2__text">',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItem2__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItem2__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItem2__modelName"><%= modelName %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItem2__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
              '<div class="s5-inStoreItem2__line">',
                '<p><%= modelCatchCopy %></p>',
                '<p class="s5-small1"><%= modelNameNote %></p>',
              '</div>',
            '<% } %>',
            '<div class="s5-inStoreProductInfo">',
              '<% if ( manualEndOfSale ) { %>',
                '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
              '<% } else if ( endOfSale ) { %>',
                '<p class="s5-p2"><%= endOfSaleText %></p>',
              // '<% } else if ( statusError ) { %>',
              //   '<p class="s5-p2"><%= statusErrorText %></p>',
              '<% } else if ( display ) { %>',
                '<div class="s5-inStoreProductInfo__store">',
                  '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
                  '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                      '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( pageIcon2 ) { %>',
                    '<p class="s5-p1"><%= pageIcon2Text %></p>',
                  '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                    '<div class="s5-inStoreItem2__buttonContainer s5-general--mt10">',
                      '<a class="s5-storeButton s5-inStoreItem2__storeButton" href="<%= buttonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                      '</a>',
                    '</div>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-inStoreItem2__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-inStoreItem2__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '<% } %>',
                  '<% if ( modelAddButtonLink !== "" ) { %>',
                    '<div class="s5-inStoreItem2__buttonContainer s5-general--mt10">',
                      '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                      '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                      ' onclick="<%= modelAddButtonCustomLink %>"',
                      '<% } %>',
                      '<% if ( modelAddButtonLinkBlank ) { %>',
                      ' target="_blank"',
                      '<% } %>',
                      '>',
                        '<%= modelAddButtonName %>',
                        '<% if ( modelAddButtonLinkBlank ) { %>',
                        ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                        '<% } %>',
                      '</a>',
                    '</div>',
                  '<% } %>',
                '</div>',
              '<% } %>',
            '</div><!-- /.s5-inStoreProductInfo -->',
          '</div><!-- /.s5-inStoreItem2__text -->',

        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItem3Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItem3__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItem3__text">',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItem3__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItem3__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItem3__modelName"><%= modelName %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItem3__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
              '<div class="s5-inStoreItem3__line">',
                '<p><%= modelCatchCopy %></p>',
                '<p class="s5-small1"><%= modelNameNote %></p>',
              '</div>',
            '<% } %>',
            '<div class="s5-inStoreProductInfo">',
              '<% if ( manualEndOfSale ) { %>',
                '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
              '<% } else if ( endOfSale ) { %>',
                '<p class="s5-p2"><%= endOfSaleText %></p>',
              // '<% } else if ( statusError ) { %>',
              //   '<p class="s5-p2"><%= statusErrorText %></p>',
              '<% } else if ( display ) { %>',
                '<div class="s5-inStoreProductInfo__store">',
                  '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
                  '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                      '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( pageIcon2 ) { %>',
                    '<p class="s5-p1"><%= pageIcon2Text %></p>',
                  '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                    '<div class="s5-inStoreItem3__buttonContainer s5-general--mt10">',
                      '<a class="s5-storeButton s5-inStoreItem3__storeButton" href="<%= buttonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                      '</a>',
                    '</div>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-inStoreItem3__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-inStoreItem3__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '<% } %>',
                  '<% if ( modelAddButtonLink !== "" ) { %>',
                    '<div class="s5-inStoreItem3__buttonContainer s5-general--mt10">',
                      '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                      '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                      ' onclick="<%= modelAddButtonCustomLink %>"',
                      '<% } %>',
                      '<% if ( modelAddButtonLinkBlank ) { %>',
                      ' target="_blank"',
                      '<% } %>',
                      '>',
                        '<%= modelAddButtonName %>',
                        '<% if ( modelAddButtonLinkBlank ) { %>',
                        ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                        '<% } %>',
                      '</a>',
                    '</div>',
                  '<% } %>',
                '</div>',
              '<% } %>',
            '</div><!-- /.s5-inStoreProductInfo -->',
          '</div><!-- /.s5-inStoreItem3__text -->',

        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItem4Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItem4__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItem4__text">',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItem4__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItem4__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItem4__modelName"><%= modelName %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItem4__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
              '<div class="s5-inStoreItem4__line">',
                '<p><%= modelCatchCopy %></p>',
                '<p class="s5-small1"><%= modelNameNote %></p>',
              '</div>',
            '<% } %>',
            '<div class="s5-inStoreProductInfo">',
              '<% if ( manualEndOfSale ) { %>',
                '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
              '<% } else if ( endOfSale ) { %>',
                '<p class="s5-p2"><%= endOfSaleText %></p>',
              // '<% } else if ( statusError ) { %>',
              //   '<p class="s5-p2"><%= statusErrorText %></p>',
              '<% } else if ( display ) { %>',
                '<div class="s5-inStoreProductInfo__store">',
                  '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
                  '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                      '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( pageIcon2 ) { %>',
                    '<p class="s5-p1"><%= pageIcon2Text %></p>',
                  '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                    '<div class="s5-inStoreItem4__buttonContainer s5-general--mt10">',
                      '<a class="s5-storeButton s5-inStoreItem4__storeButton" href="<%= buttonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                      '</a>',
                    '</div>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-inStoreItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-inStoreItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '<% } %>',
                  '<% if ( modelAddButtonLink !== "" ) { %>',
                    '<div class="s5-inStoreItem4__buttonContainer s5-general--mt10">',
                      '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                      '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                      ' onclick="<%= modelAddButtonCustomLink %>"',
                      '<% } %>',
                      '<% if ( modelAddButtonLinkBlank ) { %>',
                      ' target="_blank"',
                      '<% } %>',
                      '>',
                        '<%= modelAddButtonName %>',
                        '<% if ( modelAddButtonLinkBlank ) { %>',
                        ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                        '<% } %>',
                      '</a>',
                    '</div>',
                  '<% } %>',
                '</div>',
              '<% } %>',
            '</div><!-- /.s5-inStoreProductInfo -->',
          '</div><!-- /.s5-inStoreItem4__text -->',

        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItem5Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItem5__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItem5__text">',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItem5__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItem5__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItem5__modelName"><%= modelName %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItem5__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
              '<div class="s5-inStoreItem5__line">',
                '<p><%= modelCatchCopy %></p>',
                '<p class="s5-small1"><%= modelNameNote %></p>',
              '</div>',
            '<% } %>',
            '<div class="s5-inStoreProductInfo">',
              '<% if ( manualEndOfSale ) { %>',
                '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
              '<% } else if ( endOfSale ) { %>',
                '<p class="s5-p2"><%= endOfSaleText %></p>',
              // '<% } else if ( statusError ) { %>',
              //   '<p class="s5-p2"><%= statusErrorText %></p>',
              '<% } else if ( display ) { %>',
                '<div class="s5-inStoreProductInfo__store">',
                  '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
                  '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                      '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( pageIcon2 ) { %>',
                    '<p class="s5-p1"><%= pageIcon2Text %></p>',
                  '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                    '<div class="s5-inStoreItem5__buttonContainer s5-general--mt10">',
                      '<a class="s5-storeButton s5-inStoreItem5__storeButton" href="<%= buttonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                      '</a>',
                    '</div>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-inStoreItem5__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-inStoreItem5__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '<% } %>',
                  '<% if ( modelAddButtonLink !== "" ) { %>',
                    '<div class="s5-inStoreItem5__buttonContainer s5-general--mt10">',
                      '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                      '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                      ' onclick="<%= modelAddButtonCustomLink %>"',
                      '<% } %>',
                      '<% if ( modelAddButtonLinkBlank ) { %>',
                      ' target="_blank"',
                      '<% } %>',
                      '>',
                        '<%= modelAddButtonName %>',
                        '<% if ( modelAddButtonLinkBlank ) { %>',
                        ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                        '<% } %>',
                      '</a>',
                    '</div>',
                  '<% } %>',
                '</div>',
              '<% } %>',
            '</div><!-- /.s5-inStoreProductInfo -->',
          '</div><!-- /.s5-inStoreItem5__text -->',

        '<% } %>'
      ].join( '\n' ) ),


      'horizontalItemList': _.template( [

        '<% if ( modelImage !== "" ) { %>',
          '<div class="s5-horizontalItemList__image">',
            '<img src="<%= modelImage %>">',
          '</div>',
        '<% } %>',
        '<% if ( productName !== "" ) { %>',
          '<div class="s5-horizontalItemList__productNameGroup">',
            '<div class="s5-horizontalItemList__productName"><%= productName %></div>',
            '<div class="s5-horizontalItemList__modelName"><%= modelName %></div>',
          '</div>',
          '<div class="s5-horizontalItemList__line">',
            '<p><%= modelCatchCopy %></p>',
            '<p class="s5-small1"><%= modelNameNote %></p>',
          '</div>',
        '<% } %>',
        '<div class="s5-inStoreProductInfo">',
          '<% if ( endOfSale ) { %>',
            '<p class="s5-p2"><%= endOfSaleText %></p>',
          '<% } else if ( statusError ) { %>',
            '<p class="s5-p2"><%= statusErrorText %></p>',
          '<% } else if ( display ) { %>',
            '<div class="s5-inStoreProductInfo__store">',
              '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
              '<% if ( priceDisplay ) { %>',
                '<div',
                  '<% if ( couponsAvailable ) { %>',
                    ' data-s5-store-discount',
                    ' data-s5-store-discount-type="sonystoreListBlock"',
                    ' data-s5-store-discount-price="<%= price %>"',
                    ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                    ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                    ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                    ' data-s5-store-discount-productCode="<%= productCode %>"',
                  '<% } %>',
                '>',
                  '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                  '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                  '<% if ( saleEstimatedPrice ) { %>',
                    '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                  '<% } %>',
                '</div>',
              '<% } %>',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
              '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                '<div class="s5-inStoreItem5__buttonContainer s5-general--mt10">',
                  '<a class="s5-storeButton s5-horizontalItemList__storeButton" href="<%= buttonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                    '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                  '</a>',
                '</div>',
                '<% if ( mailTextView ) { %>',
                  '<span class="s5-horizontalItemList__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                '<% } %>',
                '<% if ( entryTextView ) { %>',
                  '<span class="s5-horizontalItemList__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                '<% } %>',
              '<% } %>',
              '<% if ( modelAddButtonLink !== "" ) { %>',
                '<div class="s5-inStoreItem5__buttonContainer s5-general--mt10">',
                  '<a class="s5-button" href="<%= modelAddButtonLink %>"',
                  '<% if ( modelAddButtonCustomLink !== "" ) { %>',
                  ' onclick="<%= modelAddButtonCustomLink %>"',
                  '<% } %>',
                  '<% if ( modelAddButtonLinkBlank ) { %>',
                  ' target="_blank"',
                  '<% } %>',
                  '>',
                    '<%= modelAddButtonName %>',
                    '<% if ( modelAddButtonLinkBlank ) { %>',
                    ' <span class="s5-icon-window" title="別ウィンドウで開きます"></span>',
                    '<% } %>',
                  '</a>',
                '</div>',
              '<% } %>',
            '</div>',
          '<% } %>',
        '</div><!-- /.s5-inStoreProductInfo -->'

      ].join( '\n' ) ),


      'inStoreAccInfo': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<div class="s5-inStoreProductInfo__store">',
            '<span class="s5-inStoreProductInfo__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="sonystoreListBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-inStoreProductInfo__storePrice"><%= price %></span>',
                '<span class="s5-inStoreProductInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-inStoreProductInfo__storeText"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-inStoreItem1__buttonContainer s5-general--mt10">',
                '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),


      'inStoreItemBuy1Full': _.template( [

        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
        '<% } else { %>',

          '<% if ( modelImage !== "" ) { %>',
            '<div class="s5-inStoreItemBuy1__image">',
              '<img src="<%= modelImage %>">',
            '</div>',
          '<% } %>',
          '<div class="s5-inStoreItemBuy1__text">',
            '<% if ( page.length > 0 ) { %>',
              '<div class="s5-inStoreItemBuy1__labelGroup">',
                '<% _.each( page, function ( item ) { %>',
                  '<% if ( item.id === 1 ) { %>',
                    '<span class="s5-label s5-label--1"><%= item.content %></span>',
                  '<% } else if ( item.id === 222 ) { %>',
                    '<span class="s5-label s5-label--2"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
                    '<span class="s5-label s5-label--3"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
                    '<span class="s5-label s5-label--4"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
                    '<span class="s5-label s5-label--5"><%= item.content %></span>',
                  '<% } else { %>',
                    '<span class="s5-label"><%= item.content %></span>',
                  '<% } %>',
                '<% } ) %>',
              '</div>',
            '<% } %>',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-inStoreItemBuy1__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-inStoreItemBuy1__productName"><%= productName %></div>',
                  '<div class="s5-inStoreItemBuy1__productName"><%= modelName %></div>',
                  '<div class="s5-inStoreItemBuy1__productNameSub"><%= modelNameNote %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-inStoreItemBuy1__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
            '<% } %>',

            '<% if ( manualEndOfSale ) { %>',
              '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
            '<% } else if ( endOfSale ) { %>',
              '<p class="s5-p2"><%= endOfSaleText %></p>',
            // '<% } else if ( statusError ) { %>',
            //   '<p class="s5-p2"><%= statusErrorText %></p>',
            '<% } else if ( display ) { %>',
              '<div class="s5-inStoreItem1__store">',
                '<span class="s5-inStoreItem1__storeText">ソニーストアで購入すると</span>',
                '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                  '<p class="s5-inStoreItem1__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                '<% } %>',
                '<% if ( priceDisplay ) { %>',
                  '<div',
                    '<% if ( couponsAvailable ) { %>',
                      ' data-s5-store-discount',
                      ' data-s5-store-discount-type="sonystoreListBlock"',
                      ' data-s5-store-discount-price="<%= price %>"',
                      ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                      ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                      ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                      ' data-s5-store-discount-productCode="<%= productCode %>"',
                    '<% } %>',
                  '>',
                    '<span class="s5-inStoreItem1__storePrice"><%= price %></span>',
                    '<span class="s5-inStoreItem1__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                    '<% if ( saleEstimatedPrice ) { %>',
                      '<span class="s5-inStoreItem1__storeText"><%= saleEstimatedPriceText %></span>',
                    '<% } %>',
                  '</div>',
                '<% } %>',
                '<% if ( !saleOff ) { %>',
                  '<div class="s5-inStoreItem1__benefitLabelGroup">',
                    '<% _.each( shipment, function ( item ) { %>',
                       '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                    '<% } ) %>',
                    '<% _.each( bennefits, function ( item ) { %>',
                      '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                    '<% } ) %>',
                  '</div>',
                '<% } %>',
                '<% if ( pageIcon2 ) { %>',
                  '<p class="s5-p1"><%= pageIcon2Text %></p>',
                '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                  '<div class="s5-inStoreItem1__storeButtonContainer">',
                    '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                    ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                    ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                    ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                    '>',
                    '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                    '</a>',
                  '</div>',
                  '<% if ( mailTextView ) { %>',
                    '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                  '<% } %>',
                  '<% if ( entryTextView ) { %>',
                    '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                  '<% } %>',
                '<% } %>',
              '</div>',
            '<% } %>',
          '</div>',

        '<% } %>'
      ].join( '\n' ) ),

      'inStoreItemBuy1FullRender': _.template( [

        '<div class="s5-inStoreList">',
          '<div class="s5-inStoreItemBuy1">',
            '<div class="s5-inStoreItemBuy1__inner">',
              // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
              // target の st は 99
              '<% if ( statusError ) { %>',
                '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
              '<% } else { %>',

                '<% if ( modelImage !== "" ) { %>',
                  '<div class="s5-inStoreItemBuy1__image">',
                    '<img src="<%= modelImage %>">',
                  '</div>',
                '<% } %>',
                '<div class="s5-inStoreItemBuy1__text">',
                  '<% if ( page.length > 0 ) { %>',
                    '<div class="s5-inStoreItemBuy1__labelGroup">',
                      '<% _.each( page, function ( item ) { %>',
                        '<% if ( item.id === 1 ) { %>',
                          '<span class="s5-label s5-label--1"><%= item.content %></span>',
                        '<% } else if ( item.id === 222 ) { %>',
                          '<span class="s5-label s5-label--2"><%= item.content %></span>',
                        '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
                          '<span class="s5-label s5-label--3"><%= item.content %></span>',
                        '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
                          '<span class="s5-label s5-label--4"><%= item.content %></span>',
                        '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
                          '<span class="s5-label s5-label--5"><%= item.content %></span>',
                        '<% } else { %>',
                          '<span class="s5-label"><%= item.content %></span>',
                        '<% } %>',
                      '<% } ) %>',
                    '</div>',
                  '<% } %>',
                  '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
                    '<div class="s5-inStoreItemBuy1__productNameGroup">',
                      '<% if ( productName !== "" ) { %>',
                        '<div class="s5-inStoreItemBuy1__productName"><%= productName %></div>',
                        '<div class="s5-inStoreItemBuy1__productName"><%= modelName %></div>',
                        '<div class="s5-inStoreItemBuy1__productNameSub"><%= modelNameNote %></div>',
                      '<% } %>',
                      '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                        '<div class="s5-inStoreItemBuy1__ownerReview">',
                          '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                        '</div>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',

                  '<% if ( manualEndOfSale ) { %>',
                    '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
                  '<% } else if ( endOfSale ) { %>',
                    '<p class="s5-p2"><%= endOfSaleText %></p>',
                  // '<% } else if ( statusError ) { %>',
                  //   '<p class="s5-p2"><%= statusErrorText %></p>',
                  '<% } else if ( display ) { %>',
                    '<div class="s5-inStoreItem1__store">',
                      '<span class="s5-inStoreItem1__storeText">ソニーストアで購入すると</span>',
                      '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                        '<p class="s5-inStoreItem1__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                      '<% } %>',
                      '<% if ( priceDisplay ) { %>',
                        '<div',
                          '<% if ( couponsAvailable ) { %>',
                            ' data-s5-store-discount',
                            '<% if ( couponsAutoapply ) { %>',
                              ' data-s5-store-discount-autoapply',
                            '<% } %>',
                            ' data-s5-store-discount-type="sonystoreListBlock"',
                            ' data-s5-store-discount-price="<%= price %>"',
                            ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                            ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                            ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                            ' data-s5-store-discount-productCode="<%= productCode %>"',
                          '<% } %>',
                        '>',
                          '<span class="s5-inStoreItem1__storePrice"><%= price %></span>',
                          '<span class="s5-inStoreItem1__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                          '<% if ( saleEstimatedPrice ) { %>',
                            '<span class="s5-inStoreItem1__storeText"><%= saleEstimatedPriceText %></span>',
                          '<% } %>',
                        '</div>',
                      '<% } %>',
                      '<% if ( !saleOff ) { %>',
                        '<div class="s5-inStoreItem1__benefitLabelGroup">',
                          '<% _.each( shipment, function ( item ) { %>',
                            '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                          '<% } ) %>',
                          '<% _.each( bennefits, function ( item ) { %>',
                            '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                          '<% } ) %>',
                        '</div>',
                      '<% } %>',
                      '<% if ( pageIcon2 ) { %>',
                        '<p class="s5-p1"><%= pageIcon2Text %></p>',
                      '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                        '<div class="s5-inStoreItem1__storeButtonContainer">',
                          '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                          ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                          ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                          ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                          '>',
                          '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                          '</a>',
                        '</div>',
                        '<% if ( mailTextView ) { %>',
                          '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                        '<% } %>',
                        '<% if ( entryTextView ) { %>',
                          '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                        '<% } %>',
                      '<% } %>',
                    '</div>',
                  '<% } %>',
                '</div>',

              '<% } %>',
            '</div>',
          '</div>',
        '</div>'
      ].join( '\n' ) ),

      'inStoreItem1': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<div class="s5-inStoreItem1__store">',
            '<span class="s5-inStoreItem1__storeText">ソニーストアで購入すると</span>',
            '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
              '<p class="s5-sonystoreListBlock__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
            '<% } %>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="sonystoreListBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-inStoreItem1__storePrice"><%= price %></span>',
                '<span class="s5-inStoreItem1__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-inStoreItem1__storeText"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( !saleOff ) { %>',
              '<div class="s5-inStoreItem1__benefitLabelGroup">',
                '<% _.each( shipment, function ( item ) { %>',
                  '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
                '<% _.each( bennefits, function ( item ) { %>',
                  '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
              '</div>',
            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-inStoreItem1__storeButtonContainer">',
                '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      // 量販店用コラボリスト
      'inStoreItem1--collaboList': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<div class="s5-inStoreItem1__store">',
//            '<span class="s5-inStoreItem1__storeText">ソニーストアで購入すると</span>',
//            '<% if ( priceDisplay ) { %>',
//              '<span class="s5-inStoreItem1__storePrice"><%= price %></span>',
//              '<span class="s5-inStoreItem1__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
//              '<% if ( saleEstimatedPrice ) { %>',
//                '<span class="s5-inStoreItem1__storeText"><%= saleEstimatedPriceText %></span>',
//              '<% } %>',
//            '<% } %>',
//            '<% if ( !saleOff ) { %>',
//              '<div class="s5-inStoreItem1__benefitLabelGroup">',
//                '<% _.each( shipment, function ( item ) { %>',
//                   '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
//                '<% } ) %>',
//                '<% _.each( bennefits, function ( item ) { %>',
//                  '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
//                '<% } ) %>',
//              '</div>',
//            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-inStoreItem1__storeButtonContainer">',
                '<a class="s5-storeButton s5-inStoreItem1__storeButton s5-inStoreItem1__storeButton--small" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      'inCustomPage': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="s5-sonyStoreCustom">',
            '<span class="s5-sonyStoreCustom__text"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-sonyStoreCustom">',
            '<span class="s5-sonyStoreCustom__text"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-sonyStoreCustom">',
            '<span class="s5-sonyStoreCustom__text">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="listItem4"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-sonyStoreCustom__price"><%= price %></span>',
                '<span class="s5-sonyStoreCustom__unit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-sonyStoreCustom__text--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-sonyStoreCustom__buttonContainer">',
                '<a class="s5-storeButton s5-sonyStoreCustom__button" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-sonyStoreCustom__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-sonyStoreCustom__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      // /bravia/store/products/select/ で利用
      'inCustomPageFullInfo': _.template([
        // 購入ページがドロップされ、APIの返却値がなくなった場合（＝エラー99が返却された時、になるかと）は、枠自体は残し、「販売を終了いたしました」だけが表示されるようにする。
        // target の st は 99
        '<% if ( statusError ) { %>',
          '<div class="s5-sonyStoreCustomFullInfo">',
            '<p class="s5-p2 s5--colorRed">※ 販売を終了いたしました</p>',
          '</div>',
        '<% } else { %>',
          '<div class="s5-sonyStoreCustomFullInfo">',
            '<% if ( page.length > 0 ) { %>',
              '<div class="s5-sonyStoreCustomFullInfo__labelGroup">',
                '<% _.each( page, function ( item ) { %>',
                  '<% if ( item.id === 1 ) { %>',
                    '<span class="s5-label s5-label--1"><%= item.content %></span>',
                  '<% } else if ( item.id === 222 ) { %>',
                    '<span class="s5-label s5-label--2"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
                    '<span class="s5-label s5-label--3"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
                    '<span class="s5-label s5-label--4"><%= item.content %></span>',
                  '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
                    '<span class="s5-label s5-label--5"><%= item.content %></span>',
                  '<% } else { %>',
                    '<span class="s5-label"><%= item.content %></span>',
                  '<% } %>',
                '<% } ) %>',
              '</div>',
            '<% } %>',
            '<% if ( ( productName !== "" ) || ( productCode !== "" ) ) { %>',
              '<div class="s5-sonyStoreCustomFullInfo__productNameGroup">',
                '<% if ( productName !== "" ) { %>',
                  '<div class="s5-sonyStoreCustomFullInfo__productName"><%= productName %></div>',
                  '<div class="s5-sonyStoreCustomFullInfo__productName"><%= modelName %></div>',
                  '<div class="s5-sonyStoreCustomFullInfo__productNameSub"><%= modelNameNote %></div>',
                '<% } %>',
                '<% if ( ( ownerReviewProductCode !== "" ) && ( ownerReviewDisable !=="true" )) { %>',
                  '<div class="s5-sonyStoreCustomFullInfo__ownerReview">',
                    '<div class="s5-ownerReview" data-owner-review-type="inline_rating_products" data-owner-review-id="<%= ownerReviewProductCode.replace(/\\|/g, \',\') %>" data-owner-review-model-name="<%= modelName %>"></div>',
                  '</div>',
                '<% } %>',
              '</div>',
            '<% } %>',

            '<% if ( manualEndOfSale ) { %>',
              '<p class="s5-p2 s5--colorRed"><%= manualEndOfSaleText %></p>',
            '<% } else if ( endOfSale ) { %>',
              '<p class="s5-p2"><%= endOfSaleText %></p>',
            // '<% } else if ( statusError ) { %>',
            //   '<p class="s5-p2"><%= statusErrorText %></p>',
            '<% } else if ( display ) { %>',
              '<div class="s5-sonyStoreCustomFullInfo__storeGroup">',
                '<span class="s5-sonyStoreCustomFullInfo__storeText">ソニーストアで購入すると</span>',
                '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                  '<p class="s5-sonyStoreCustomFullInfo__storePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                '<% } %>',
                '<% if ( priceDisplay ) { %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      '<span class="s5-sonyStoreCustomFullInfo__storePrice"><%= price %></span>',
                      '<span class="s5-sonyStoreCustomFullInfo__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% if ( saleEstimatedPrice ) { %>',
                        '<span class="s5-sonyStoreCustomFullInfo__storeText"><%= saleEstimatedPriceText %></span>',
                      '<% } %>',
                    '</div>',
                '<% } %>',
              '</div>',
              '<% if ( !saleOff ) { %>',
                '<div class="s5-sonyStoreCustomFullInfo__benefitLabel">',
                  '<% _.each( shipment, function ( item ) { %>',
                    '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                  '<% } ) %>',
                  '<% _.each( bennefits, function ( item ) { %>',
                    '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                  '<% } ) %>',
                '</div>',
              '<% } %>',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
              '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                '<div class="s5-sonyStoreCustomFullInfo__buttonContainer">',
                  '<a class="s5-storeButton s5-sonyStoreCustomFullInfo__storeButton" href="<%= buttonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><br><% } %><%= buttonText %>',
                  '</a>',
                '</div>',
                '<% if ( mailTextView ) { %>',
                  '<span class="s5-sonyStoreCustomFullInfo__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                '<% } %>',
                '<% if ( entryTextView ) { %>',
                  '<span class="s5-sonyStoreCustomFullInfo__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                '<% } %>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      'labels': _.template([
        '<% if ( !statusError ) { %>',
          '<% _.each( page, function ( item ) { %>',
            '<% if ( item.id === 1 ) { %>',
              '<span class="s5-label s5-label--1"><%= item.content %></span>',
            '<% } else if ( item.id === 222 ) { %>',
              '<span class="s5-label s5-label--2"><%= item.content %></span>',
            '<% } else if ( ( item.id === 2 ) || ( item.id === 9 ) ) { %>',
              '<span class="s5-label s5-label--3"><%= item.content %></span>',
            '<% } else if ( ( item.id === 4 ) || ( item.id === 6 ) ) { %>',
              '<span class="s5-label s5-label--4"><%= item.content %></span>',
            '<% } else if ( ( item.id === 5 ) || ( item.id === 229 ) ) { %>',
              '<span class="s5-label s5-label--5"><%= item.content %></span>',
            '<% } else { %>',
              '<span class="s5-label"><%= item.content %></span>',
            '<% } %>',
          '<% } ) %>',
        '<% } %>'
      ].join( '\n' ) ),

      'listItem4': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="listItem4"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-listItem4__storePrice"><%= price %></span>',
                '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-listItem4__storeButtonContainer">',
                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'listItem4_stNone': _.template( [
        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="listItem4"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-listItem4__storePrice"><%= price %></span>',
                '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-listItem4__storeButtonContainer">',
                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'listItem4_member': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ご優待価格</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="sonystoreListBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-listItem4__storePrice"><%= price %></span>',
                '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-listItem4__storeButtonContainer">',
                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'listItem4_anshin': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="sonystoreListBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-listItem4__storePrice"><%= price %></span>',
                '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% _.each( bennefits, function ( item ) { %>',
                // pr_icが251の時、「長期保証 会員限定特典」のアイコンだけ表示したい
                // '<%= console.log(item.id) %>',
                '<% if ( item.id === 251 ) { %>',
                  '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                '<% } %>',
            '<% } ) %>',
            '<% if ( pageIcon2 ) { %>',
              '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-listItem4__storeButtonContainer">',
                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      // 商品一覧:購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
      'listItem4_double': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="sonystoreListBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="s5-listItem4__storePrice"><%= price %></span>',
                '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<span class="s5-listItem4__storeDoublePurchaseHeading">ご購入はこちら</span>',
              '<span class="s5-listItem4__storeDoublePurchaseText">お支払い方法により購入手続きページが異なります</span>',
              '<div class="s5-listItem4__storeButtonContainer">',
                // メインボタン
                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonTextPrefix %><%= buttonText %>',
                '</a>',
                // サブボタン
                '<% if ( ( subButtonText !== "" ) && ( subButtonUrl !== "" ) ) { %>',
                  '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= subButtonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                    '<%= subButtonTextPrefix %><%= subButtonText %>',
                  '</a>',
                '<% } %>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      // 商品一覧:購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
      'msaSonystoreBlock_double': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<span class="MSAProductsStorePrice__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<span class="MSAProductsStorePrice__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<h3 class="MSAProductsStorePrice__storeText">ソニーストア販売価格</h3>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="msaSonystoreBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="MSAProductsStorePrice__storePrice"><%= price %></span>',
                '<span class="MSAProductsStorePrice__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="MSAProductsStorePrice__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<span class="MSAProductsStorePrice__storeDoublePurchaseHeading">ご購入はこちら</span>',
              '<span class="MSAProductsStorePrice__storeDoublePurchaseText">お支払い方法により購入手続きページが異なります</span>',
              '<div class="MSAProductsStorePrice__storeButtonContainer">',
                // メインボタン
                '<a class="s5-storeButton MSAProductsStorePrice__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonTextPrefix %><%= buttonText %>',
                '</a>',
                // サブボタン
                '<% if ( ( subButtonText !== "" ) && ( subButtonUrl !== "" ) ) { %>',
                  '<a class="s5-storeButton MSAProductsStorePrice__storeButton" href="<%= subButtonUrl %>"',
                  ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                  ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                  ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                  '>',
                    '<%= subButtonTextPrefix %><%= subButtonText %>',
                  '</a>',
                '<% } %>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="MSAProductsStorePrice__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="MSAProductsStorePrice__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'msaSonystoreBlock': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<span class="MSAProductsStorePrice__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<span class="MSAProductsStorePrice__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
          '<div class="MSAProductsStorePrice__store">',
            '<h3 class="MSAProductsStorePrice__storeText">ソニーストア販売価格</h3>',
            '<% if ( priceDisplay ) { %>',
              '<div',
                '<% if ( couponsAvailable ) { %>',
                  ' data-s5-store-discount',
                  ' data-s5-store-discount-type="msaSonystoreBlock"',
                  ' data-s5-store-discount-price="<%= price %>"',
                  ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                  ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                  ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                  ' data-s5-store-discount-productCode="<%= productCode %>"',
                '<% } %>',
              '>',
                '<span class="MSAProductsStorePrice__storePrice"><%= price %></span>',
                '<span class="MSAProductsStorePrice__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="MSAProductsStorePrice__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '</div>',
            '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="MSAProductsStorePrice__storeButtonContainer">',
                '<a class="s5-storeButton MSAProductsStorePrice__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonText %>',
                '</a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="MSAProductsStorePrice__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="MSAProductsStorePrice__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      'sonystoreBlock' : _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable">',
            '<div class="s5-sonystoreBlock__multiColMain">',
              '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                  '<p class="s5-p2"><%= endOfSaleText %></p>',
                '</div>',
              '</div>',
            '</div>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable">',
            '<div class="s5-sonystoreBlock__multiColMain">',
              '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                  '<p class="s5-p2"><%= statusErrorText %></p>',
                '</div>',
              '</div>',
            '</div>',
          '</div>',
        '<% } else if ( display ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable<% if ( priceDisplay === false ) { %> -fit<% } %>">',
            '<% if ( priceDisplay ) { %>',
              '<div class="s5-sonystoreBlock__multiColMain">',
                '<div class="s5-sonystoreBlock__buyAtStoreHeader">',
                  '<div class="s5-sonystoreBlock__buyAtStoreHeading">ソニーストアで購入すると</div>',
                '</div>',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                  '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                    '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                      '<p class="s5-sonystoreBlock__buyAtStorePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                    '<% } %>',
                    '<div',
                      '<% if ( couponsAvailable ) { %>',
                        ' data-s5-store-discount',
                        ' data-s5-store-discount-type="sonystoreListBlock"',
                        ' data-s5-store-discount-price="<%= price %>"',
                        ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                        ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                        ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                        ' data-s5-store-discount-productCode="<%= productCode %>"',
                      '<% } %>',
                    '>',
                      // 価格非表示＆予定価格表示
                      '<% if ( priceDisplay ) { %>',
                        '<span class="s5-sonystoreBlock__buyAtStorePrice"><%= price %></span>',
                        '<span class="s5-sonystoreBlock__buyAtStorePriceUnitCurrency">円</span><% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                      '<% } %>',
                    '</div>',
                    '<% if ( saleEstimatedPrice ) { %>',
                      '<span class="s5-sonystoreBlock__buyAtStoreAnnotationLabel"><%= saleEstimatedPriceText %></span>',
                    '<% } %>',
                  '</div>',
                '</div>',
              '</div>',
            '<% } %>',
            // 購入導線がON
            '<% if ( !saleOff ) { %>',
              '<div class="s5-sonystoreBlock__multiColSub">',
                '<% if ( priceDisplay === false ) { %>',
                  '<div class="s5-sonystoreBlock__buyAtStoreHeader">',
                    '<div class="s5-sonystoreBlock__buyAtStoreHeading">ソニーストアで購入すると</div>',
                  '</div>',
                '<% } %>',
                '<div class="s5-sonystoreBlock__multiColSubBlock">',
                  '<div class="s5-sonystoreBlock__buyAtStoreIcons">',
                    '<% _.each( shipment, function ( item ) { %>',
                      '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
                    '<% } ) %>',
                    '<% _.each( bennefits, function ( item ) { %>',
                      '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
                    '<% } ) %>',
                  '</div>',
                '</div>',
                '<% if ( pageIcon2 ) { %>',
                  '<p class="s5-p1"><%= pageIcon2Text %></p>',
                '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                  '<div class="s5-sonystoreBlock__buyAtStoreButtonContainer">',
                    '<a class="s5-storeButtonV3 s5-sonystoreBlock__buyAtStoreButton" href="<%= buttonUrl %>"',
                    ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                    ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                    ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                    '>',
                      '<% if ( pageIcon222 ) { %><span class="s5-sonystoreBlock__buyAtStoreButtonSubText"><%= pageIcon222Text %></span><% } %> <%= buttonText %>',
                    '</a>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                  '</div>',
                '<% } %>',
              '</div>',
            '<% } %>',
          '</div><!-- /.s5-sonystoreBlock__multiColTable -->',

          // response に "link" がある場合バナーを表示
          '<% if(banners.length) { %>',
            '<div class="s5-sonystoreBlockCarousel">',
              '<div class="s5-sonystoreBlockCarousel__viewport">',
                '<div class="s5-sonystoreBlockCarousel__list">',
                  '<% _.each(banners, function(item) { %>',
                    '<div class="s5-sonystoreBlockCarousel__item">',
                      '<a href="<%= item.url %>" target="_blank">',
                        '<div class="s5-sonystoreBlockCarousel__image">',
                          '<img src="<%= item.image %>" alt="" width="583" height="365">',
                          '<span class="s5-icon-window"></span>',
                        '</div>',
                        '<div class="s5-sonystoreBlockCarousel__descriptionExtra"><%= item.name %></div>',
                      '</a>',
                    '</div><!-- /.s5-sonystoreBlockCarousel__item-->',
                  '<% }) %>',
                '</div><!-- /.s5-sonystoreBlockCarousel__list -->',
              '</div><!-- /.s5-sonystoreBlockCarousel__viewport -->',
            '</div><!-- /.s5-sonystoreBlockCarousel -->',
          '<% } %>',

        '<% } %>'

      ].join( '\n' ) ),

      'sonystoreBlockBanner' : _.template( [

        '<% if ( display ) { %>',

          // response に "link" がある場合バナーを表示
          '<% if(banners.length) { %>',
            '<div class="s5-sonystoreBlockCarousel">',
              '<div class="s5-sonystoreBlockCarousel__viewport">',
                '<div class="s5-sonystoreBlockCarousel__list">',
                  '<% _.each(banners, function(item) { %>',
                    '<div class="s5-sonystoreBlockCarousel__item">',
                      '<a href="<%= item.url %>" target="_blank">',
                        '<div class="s5-sonystoreBlockCarousel__image">',
                          '<img src="<%= item.image %>" alt="" width="583" height="365">',
                          '<span class="s5-icon-window"></span>',
                        '</div>',
                        '<div class="s5-sonystoreBlockCarousel__descriptionExtra"><%= item.name %></div>',
                      '</a>',
                    '</div><!-- /.s5-sonystoreBlockCarousel__item-->',
                  '<% }) %>',
                '</div><!-- /.s5-sonystoreBlockCarousel__list -->',
              '</div><!-- /.s5-sonystoreBlockCarousel__viewport -->',
            '</div><!-- /.s5-sonystoreBlockCarousel -->',
          '<% } %>',

        '<% } %>'

      ].join( '\n' ) ),

      'sonystoreBlock_double' : _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',

        '<% if ( endOfSale ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable">',
            '<div class="s5-sonystoreBlock__multiColMain">',
              '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                  '<p class="s5-p2"><%= endOfSaleText %></p>',
                '</div>',
              '</div>',
            '</div>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable">',
            '<div class="s5-sonystoreBlock__multiColMain">',
              '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                  '<p class="s5-p2"><%= statusErrorText %></p>',
                '</div>',
              '</div>',
            '</div>',
          '</div>',
        '<% } else if ( display ) { %>',
          '<div class="s5-sonystoreBlock__multiColTable<% if ( priceDisplay === false ) { %> -fit<% } %>">',
            '<% if ( priceDisplay ) { %>',
              '<div class="s5-sonystoreBlock__multiColDoublePurchaseMain">',
                '<div class="s5-sonystoreBlock__buyAtStoreHeader">',
                  '<div class="s5-sonystoreBlock__buyAtStoreHeading">ソニーストアで購入すると</div>',
                '</div>',
                '<div class="s5-sonystoreBlock__buyAtStorePriceGroup">',
                  '<div class="s5-sonystoreBlock__buyAtStorePriceGroupInner">',
                    '<% if ( storePriceBenefitEyeblow !== "" ) { %>',
                      '<p class="s5-sonystoreBlock__buyAtStorePriceBenefit"><%= storePriceBenefitEyeblow %></p>',
                    '<% } %>',
                      '<div',
                        '<% if ( couponsAvailable ) { %>',
                          ' data-s5-store-discount',
                          ' data-s5-store-discount-type="sonystoreListBlock"',
                          ' data-s5-store-discount-price="<%= price %>"',
                          ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                          ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                          ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                          ' data-s5-store-discount-productCode="<%= productCode %>"',
                        '<% } %>',
                      '>',
                      // 価格非表示＆予定価格表示
                      '<% if ( priceDisplay ) { %>',
                        '<span class="s5-sonystoreBlock__buyAtStorePrice"><%= price %></span>',
                        '<span class="s5-sonystoreBlock__buyAtStorePriceUnitCurrency">円</span><% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
                        '<% if ( saleEstimatedPrice ) { %>',
                          '<span class="s5-sonystoreBlock__buyAtStoreAnnotationLabel"><%= saleEstimatedPriceText %></span>',
                        '<% } %>',
                      '<% } %>',
                    '</div>',
                  '</div>',
                '</div>',
              '</div>',
            '<% } %>',
            '<div class="s5-sonystoreBlock__multiColDoublePurchaseSub">',
              '<% if ( priceDisplay === false ) { %>',
                '<div class="s5-sonystoreBlock__buyAtStoreHeader">',
                  '<div class="s5-sonystoreBlock__buyAtStoreHeading">ソニーストアで購入すると</div>',
                '</div>',
              '<% } %>',
              // 購入導線がON
              '<% if ( !saleOff ) { %>',
                '<% if ( pageIcon2 ) { %>',
                  '<p class="s5-p1"><%= pageIcon2Text %></p>',
                '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
                  '<div class="s5-sonystoreBlock__buyAtStoreDoublePurchaseHeading">ご購入はこちら</div>',
                  '<div class="s5-sonystoreBlock__buyAtStoreDoublePurchaseText">お支払い方法により購入手続きページが異なります</div>',
                  '<div class="s5-sonystoreBlock__buyAtStoreDoublePurchaseButtonContainer">',
                    // メインボタン
                    '<a class="s5-storeButtonV3 s5-sonystoreBlock__buyAtStoreButton" href="<%= buttonUrl %>"',
                    ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                    ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                    ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                    '>',
                      '<% if ( pageIcon222 ) { %><span class="s5-sonystoreBlock__buyAtStoreButtonSubText"><%= pageIcon222Text %></span><% } %> <%= buttonTextPrefix %><%= buttonText %>',
                    '</a>',
                    '<% if ( mailTextView ) { %>',
                      '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                    '<% } %>',
                    '<% if ( entryTextView ) { %>',
                      '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                    '<% } %>',
                    // サブボタン
                    '<% if ( ( subButtonText !== "" ) && ( subButtonUrl !== "" ) ) { %>',
                      '<a class="s5-storeButtonV3 s5-sonystoreBlock__buyAtStoreButton" href="<%= subButtonUrl %>"',
                      ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                      ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                      ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                      '>',
                        '<% if ( pageIcon222 ) { %><span class="s5-sonystoreBlock__buyAtStoreButtonSubText"><%= pageIcon222Text %></span><% } %> <%= subButtonTextPrefix %><%= subButtonText %>',
                      '</a>',
                      '<% if ( mailTextView ) { %>',
                        '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
                      '<% } %>',
                      '<% if ( entryTextView ) { %>',
                        '<span class="s5-sonystoreBlock__buyAtStoreButtonUnderText"><a class="s5-linkV3" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
                      '<% } %>',
                    '<% } %>',
                  '</div>',
                '<% } %>',
              '<% } %>',
            '</div>',
          '</div><!-- /.s5-sonystoreBlock__multiColTable -->',

          // response に "link" がある場合バナーを表示
          '<% if(banners.length) { %>',
            '<div class="s5-sonystoreBlockCarousel">',
              '<div class="s5-sonystoreBlockCarousel__viewport">',
                '<div class="s5-sonystoreBlockCarousel__list">',
                  '<% _.each(banners, function(item) { %>',
                    '<div class="s5-sonystoreBlockCarousel__item">',
                      '<a href="<%= item.url %>" target="_blank">',
                        '<div class="s5-sonystoreBlockCarousel__image">',
                          '<img src="<%= item.image %>" alt="" width="583" height="365">',
                          '<span class="s5-icon-window"></span>',
                        '</div>',
                        '<div class="s5-sonystoreBlockCarousel__descriptionExtra"><%= item.name %></div>',
                      '</a>',
                    '</div><!-- /.s5-sonystoreBlockCarousel__item-->',
                  '<% }) %>',
                '</div><!-- /.s5-sonystoreBlockCarousel__list -->',
              '</div><!-- /.s5-sonystoreBlockCarousel__viewport -->',
            '</div><!-- /.s5-sonystoreBlockCarousel -->',
          '<% } %>',

        '<% } %>'

      ].join( '\n' ) ),

      // 過去のphp実装のjs版 価格だけを表示
      'type2': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<span><%= endOfSaleText %></span>',
        '<% } else if ( statusError ) { %>',
          '<span><%= statusErrorText %></span>',
        '<% } else if ( display ) { %>',
            '<% if ( priceDisplay ) { %>',
              '<nobr><strong class="prc1"><%= price %></strong>',
              '円<wbr /><% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></nobr>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // 過去のphp実装のjs版 価格だけを表示
      'type2diff': _.template( [
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<span><%= endOfSaleText %></span>',
        '<% } else if ( statusError ) { %>',
          '<span><%= statusErrorText %></span>',
        '<% } else if ( display ) { %>',
            '<% if ( priceDisplay ) { %>',
              '<strong class="fmtPrice"><%= price %></strong>',
              '<span class="fmtDetail"><span class="fmtYen">円</span><span class="fmtTax"><% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span></span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // 購入ボタンだけを表示
      'type2purchase': _.template( [
          '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<div class="s5-inStoreItem1__store">',
              '<% if ( pageIcon2 ) { %>',
                '<p class="s5-p1"><%= pageIcon2Text %></p>',
            '<% } else if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<% if ( target !== "_blank" ) { %>',
                '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<% if ( pageIcon222 ) { %><span class="s5-storeButton__subText"><%= pageIcon222Text %></span><% } %><%= buttonText %>',
                '</a>',
              '<% } %>',
              '<% if ( target == "_blank" ) { %>',
                '<a class="s5-storeButton s5-inStoreItem1__storeButton" href="<%= buttonUrl %>" target="<%= target %>"',
                ' data-s5-storeInfo-related-item-ids="<%= relatedItemIds %>"',
                ' data-s5-storeInfo-related-currenturl="<%= relatedCurrenturl %>"',
                ' data-s5-storeInfo-related-currenttitle="<%= relatedCurrenttitle %>"',
                '>',
                  '<%= buttonText %> <span class="s5-icon-window"></span>',
                '</a>',
              '<% } %>',
              '<% if ( ( mailTextView ) && ( target !== "_blank" ) ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( ( mailTextView ) && ( target == "_blank" ) ){ %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>" target="<%= target %>"><%= mailText %> <span class="s5-icon-window"></span></a></span>',
              '<% } %>',
              '<% if ( ( entryTextView ) && ( target !== "_blank" ) ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
              '<% if ( ( entryTextView ) && ( target == "_blank" ) ) { %>',
                '<span class="s5-inStoreItem1__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio 価格のみ
      'sonystoreSimplePrice': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
            '<strong class="fmtPrice"><%= price %></strong>',
            '<span class="fmtDetail"><span class="fmtYen">円</span><span class="fmtTax"><% if ( priceTaxfree ) { %>(税込)<% } %> </span></span> <%= priceSuffix %>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<span class="s5-p2"><%= saleEstimatedPriceText %></span>',
            '<% } %>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaioトップ　主な商品エリア
      'sonystorePriceButtonMain': _.template( [
        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( display ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
              '<% if ( priceDisplay ) { %>',
                '<span class="s5-listItem4__storePrice"><strong class="fmtPrice"><%= price %></strong><span class="fmtDetail"><span class="fmtYen">円</span><span class="fmtTax"><% if ( priceTaxfree ) { %>(税込)<% } %> </span></span><%= priceSuffix %></span>',
                '<% if ( saleEstimatedPrice ) { %>',
                  '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
                '<% } %>',
              '<% } %>',
              '<% if ( !saleOff ) { %>',
                '<% _.each( shipment, function ( item ) { %>',
                  '<a href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
                '<% _.each( bennefits, function ( item ) { %>',
                  '<a href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
                '<% _.each( page, function ( item ) { %>',
                  '<a href="<%= item.url %>"><%= item.content %></a>',
                '<% } ) %>',
              '<% } %>',
            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<div class="s5-listItem4__storeButtonContainer">',
                '<a data-custom="buy_button5" class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"><%= buttonText %></a>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
              '<% if ( entryTextView ) { %>',
                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= entryTextUrl %>"><%= entryText %></a></span>',
              '<% } %>',
            '<% } %>',
          '</div>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio商品トップ　購入はこちらボタンのみ大
      'sonystoreButtonBuyLarge': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div>',
              '<span class="mod-storeButtonContainer">',
                '<span class="mod-storeButtonContainer-button">',
                  '<a class="mod-storeButton mod-storeButton--large" href="<%= buttonUrl %>" data-custom="buy_bottom">ご購入はこちら</a>',
                '</span>',
              '</span>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio商品トップ　購入はこちらボタンのみ大 「価格を確認/購入へ」
      'sonystoreButtonBuyLarge_buy': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div>',
              '<span class="mod-storeButtonContainer">',
                '<span class="mod-storeButtonContainer-button">',
                  '<a class="mod-storeButton mod-storeButton--large" href="<%= buttonUrl %>" data-custom="buy_bottom">価格を確認/購入へ</a>',
                '</span>',
              '</span>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio商品トップ　おすすめモデルから選ぶ　エリア
      'sonystorePriceButton': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
              '<div class="selectmodel-rec-box-price"> 販売価格：<strong class="fmtPrice"><%= price %></strong>円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></div>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<p class="s5-p2"><%= saleEstimatedPriceText %></p>',
            '<% } %>',
          '<% } %>',
          '<% if ( !saleOff ) { %>',
            '<% _.each( shipment, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( bennefits, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( page, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
          '<% } %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div class="bwbtnwrap">',
              '<div class="selectmodel-rec-box-btn">',
                '<span class="mod-storeButtonContainer">',
                  '<span class="mod-storeButtonContainer-button">',
                    '<a class="mod-storeButton  mod-storeButton--large" href="<%= buttonUrl %>" data-custom="temp">',
                      '<%= buttonText %>',
                    '</a>',
                  '</span>',
                '</span>',
              '</div>',
              '<% if ( mailTextView ) { %>',
                '<span class="blanklink"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
              '<% } %>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // 価格と「詳細ボタン」
      // /vaio-v/store/special/quality-support/index.html
      'sonystoreDetailsButton': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
              '<p class="detail04-buy-txt03"> 販売価格：<strong><%= price %></strong>円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></p>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<p class="s5-p2"><%= saleEstimatedPriceText %></p>',
            '<% } %>',
          '<% } %>',
          '<% if ( !saleOff ) { %>',
            '<% _.each( shipment, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( bennefits, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( page, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
          '<% } %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div class="bwbtnwrap">',
              '<div class="selectmodel-rec-box-btn">',
                '<span class="mod-storeButtonContainer">',
                '<span class="mod-storeButtonContainer-button">',
                  '<a class="mod-storeButton  mod-storeButton--large" href="<%= buttonUrl %>" data-custom="temp">',
                    '詳細をみる',
                  '</a>',
                '</span>',
                '</span>',
              '</div>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio商品トップ　プロセッサーから選ぶ　エリア
      'sonystorePriceCustomizeButton': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
              '<div class="selectmodel-rec-box-price"> 販売価格：<%= price %>円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></div>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<p class="s5-p2"><%= saleEstimatedPriceText %></p>',
            '<% } %>',
          '<% } %>',
          '<% if ( !saleOff ) { %>',
            '<% _.each( shipment, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( bennefits, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( page, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
          '<% } %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div class="selectmodel-rec-box-btn">',
              '<span class="mod-storeButtonContainer">',
                '<span class="mod-storeButtonContainer-button">',
                  '<a class="mod-storeButton btn_pad2" href="<%= buttonUrl %>">カスタマイズする</a>',
                '</span>',
              '</span>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio商品トップ 　Disneyキャラクターデザインモデル　/vaio-v/store/special/fit2_disney/index.html
      'sonystoreListBlock2': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<p class="FDprice">ソニーストアで購入すると</p>',
          '<% if ( priceDisplay ) { %>',
            '<div class="mb-10">',
              '<strong class="fmtPrice"><%= price %></strong>',
              '<span class="fmtDetail">',
                '<span class="fmtYen">円</span>',
                '<span class="fmtTax"><% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
              '</span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span class="s5-p2"><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '</div>',
          '<% } %>',
          '<% if ( !saleOff ) { %>',
            '<% _.each( shipment, function ( item ) { %>',
              '<a class="s5-shippingLabel" href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( bennefits, function ( item ) { %>',
              '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( page, function ( item ) { %>',
              '<a class="s5-benefitLabel" href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
          '<% } %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<a class="FDbtn" href="<%= buttonUrl %>">',
              '<%= buttonText %>',
            '</a>',
            '<% if ( mailTextView ) { %>',
              '<span class="grayArrowList"><a href="<%= mailTextUrl %>"><%= mailText %></a></span>',
            '<% } %>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio-biz 価格（タグなしの数字）のみ
      'sonystoreSimpleTextPrice': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
            '<%= price %>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<p class="s5-p2"><%= saleEstimatedPriceText %></p>',
            '<% } %>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio-biz Webで購入のボタンのみ
      'sonystorePurchaseButton': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<a class="s5-storeButton s5-inStoreItem2__storeButton" href="<%= buttonUrl %>">ご購入はこちら</a>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      // vaio-biz商品トップ　購入はこちらボタンのみ大
      'sonystoreButtonBuyLarge2': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
            '<div>',
              '<span class="mod-storeButtonContainer">',
              '<span class="mod-storeButtonContainer-button">',
              '<a class="mod-storeButton mod-storeButton--large" href="<%= buttonUrl %>" data-custom="buy_bottom">価格を確認/購入へ</a>',
              '</span>',
              '</span>',
            '</div>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      'sonystoreText': _.template( [
        '<% if ( endOfSale ) { %>',
          '<p class="s5-p2"><%= endOfSaleText %></p>',
        '<% } else if ( statusError ) { %>',
          '<p class="s5-p2"><%= statusErrorText %></p>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
            '<%= price %>',
            '円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %>',
            '<% if ( saleEstimatedPrice ) { %>',
              '<span class="s5-p2"><%= saleEstimatedPriceText %></span>',
            '<% } %>',
          '<% } %>',
          '<% if ( !saleOff ) { %>',
            '<% _.each( shipment, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( bennefits, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
            '<% _.each( page, function ( item ) { %>',
              '<a href="<%= item.url %>"><%= item.content %></a>',
            '<% } ) %>',
          '<% } %>',
          '</div>',
          '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
              '<a href="<%= buttonUrl %>"><%= buttonText %></a>',
          '<% } %>',
        '<% } %>'
      ].join( '\n' ) ),

      'listItem4_v': _.template( [
        '<% if ( endOfSale ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= endOfSaleText %></span>',
          '</div>',
        '<% } else if ( statusError ) { %>',
          '<div class="s5-listItem4__store">',
            '<span class="s5-listItem4__storeText"><%= statusErrorText %></span>',
          '</div>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
          // listItem4 にはアイコン出力領域がないため、アイコンがあったとしても
          // 価格とボタン関連の情報がない場合は「!display」と同じ扱いにする
          // つまり、何もしない
        '<% } else if ( display ) { %>',
//        '<div class="s5-listItem4__store">',
//          '<span class="s5-listItem4__storeText">ソニーストアで購入すると</span>',
            '<% if ( priceDisplay ) { %>',
              '<span class="s5-listItem4__storePrice"><%= price %></span>',
              '<span class="s5-listItem4__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span class="s5-listItem4__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '<% } %>',
//            '<% if ( ( buttonText !== "" ) && ( buttonUrl !== "" ) ) { %>',
//              '<div class="s5-listItem4__storeButtonContainer">',
//                '<a class="s5-storeButton s5-listItem4__storeButton" href="<%= buttonUrl %>"><%= buttonText %></a>',
//              '</div>',
//              '<% if ( mailTextView ) { %>',
//                '<span class="s5-listItem4__storeButtonUnderText"><a class="s5-link" href="<%= mailTextUrl %>"><%= mailText %></a></span>',
//              '<% } %>',
//            '<% } %>',
//          '</div>',
        '<% } %>',
      ].join( '\n' ) ),

      // 「クーポン情報」部分だけを表示するパターン
      'couponInfoOnly': _.template([
        '<div class="s5-price-api-status" data-s5-price-api-status="<%= saleStatus %>"></div>',
        '<% if ( endOfSale ) { %>',
        '<% } else if ( statusError ) { %>',
        '<% } else if ( !priceDisplay && buttonText === "" && buttonUrl === "" ) { %>',
        '<% } else if ( display ) { %>',
          '<% if ( priceDisplay ) { %>',
            '<div',
              '<% if ( couponsAvailable ) { %>',
                ' data-s5-store-discount',
                ' data-s5-store-discount-type="couponInfoOnly"',
                ' data-s5-store-discount-price="<%= price %>"',
                ' data-s5-store-discount-priceTaxfree="<%= priceTaxfreeParam %>"',
                ' data-s5-store-discount-priceSuffix="<%= priceSuffix %>"',
                ' data-s5-store-discount-productGroup="<%= productGroup %>"',
                ' data-s5-store-discount-productCode="<%= productCode %>"',
              '<% } %>',
            '>',
              '<span class="couponInfoOnly__storePrice"><%= price %></span>',
              '<span class="couponInfoOnly__storeUnit">円<% if ( priceTaxfree ) { %>(税込)<% } %> <%= priceSuffix %></span>',
              '<% if ( saleEstimatedPrice ) { %>',
                '<span class="couponInfoOnly__storeText--predeterminedPrice"><%= saleEstimatedPriceText %></span>',
              '<% } %>',
            '</div>',
          '<% } %>',
        '<% } %>',
      ].join('\n'))

    }

    var getTable = function () {

      var d = $.Deferred();

      $.ajax( {
        url: TableUrl,
        charset: 'utf-8',
        scriptCharset: 'utf-8',
        dataType: 'jsonp',
        jsonpCallback: 'storeStatusTable'
      } ).done( function ( data ) {

        table = data;
        d.resolve();

      } );

      return d.promise();

    }

    var fetchAdditionalJson = function() {
      var d = $.Deferred();

      $.ajax({
        url: additionalJsonUrl,
        charset: 'utf-8',
        scriptCharset: 'utf-8',
        dataType: 'jsonp',
        jsonpCallback: 'storeAddJsonp'
      }).done(function(data) {
        additionalJson = data;
        d.resolve();
      });

      return d.promise();
    }

    var getIconsData = function ( type, ids ) {

      var list = [];

      _.each( ids, function ( id ) {

        var validElement;
        var validId = _.some( table[ type ], function ( el ) {

          if ( el.id === id ) {

            validElement = el;
            return true;

          }

        } );

        if ( !validId || validElement.content === '' ) {

          return;

        }

        list.push( validElement );

      } );

      return list;

    }

    var getButtonText = function ( productStatus, singleItem ) {

      var status = _.find( table.status, function ( el ) {

        return el.id === productStatus;

      } );

      if ( !status ) {

        return null;

      }

      if ( singleItem && status.singleItem ) {

        return status.singleItem;

      }

      return status.content;

    }

    // function name: fetch
    // returns: function
    // parameters;
    //   $el:   data-s5-storeInfoTemplate などを設定したエレメント
    //          最終的にはAPIのレスポンスとテンプレートを元に作ったDOMと置換される
    var fetch = function( $el ) {

      var isVaio = false;
      var isSetPageInfoChannel = '';
      var isSetPageInfoKind = '';

      if (
        // vaio の必須keyの有無をみてAPIとqueryを変更する
        !!$el.attr('data-s5-storeInfoChannel') &&
        !!$el.attr('data-s5-storeInfoKind')
      ) {
        isVaio = true;
      } else if (
        // Search template の都合で data-s5-storeInfoSetPageInfo でセットされた値によって vaio の必須keyはフロントで与える
        // setPageInfoの第1引数 => channel, kind
        // 1 => 1, 1
        // 2 => 2, 1
        // 3 => 1, 2
        // 4 => 2, 2
        !!$el.attr('data-s5-storeInfoSetPageInfo')
      ) {
        isVaio = true;
        var isSetPageInfo = $el.attr('data-s5-storeInfoSetPageInfo');
        if (isSetPageInfo === '1') {
          isSetPageInfoChannel = '1';
          isSetPageInfoKind = '1';
        } else if (isSetPageInfo === '2') {
          isSetPageInfoChannel = '2';
          isSetPageInfoKind = '1';
        } else if (isSetPageInfo === '3') {
          isSetPageInfoChannel = '1';
          isSetPageInfoKind = '2';
        } else if (isSetPageInfo === '4') {
          isSetPageInfoChannel = '2';
          isSetPageInfoKind = '2';
        }
      }

      var templateName = $el.attr( 'data-s5-storeInfoTemplate' );
      var template = templates[ templateName ];
      var callback = 'ss_callback' + callbackIndex;
      var query = {};

      if (isVaio) {
        APIUrl = jsApiDataList.SonyStyleLinkVaio;
        query = {
          html_name: $el.attr('data-s5-storeInfoProductGroup'),
          rmd: $el.attr('data-s5-storeInfoRmd'),
          channel: isSetPageInfoChannel || $el.attr('data-s5-storeInfoChannel'),
          kind: isSetPageInfoKind || $el.attr('data-s5-storeInfoKind'),
          callback: callback
        };
      } else {
        APIUrl = jsApiDataList.SonyStyleLink;
        query = {
          pg_id: $el.attr('data-s5-storeInfoProductGroup'),
          product_id: $el.attr('data-s5-storeInfoProductCode'),
          add_res: 1,
          callback: callback
        };
      }
      var singleItem = /true/.test($el.attr('data-s5-storeInfoSingleItem'));

      // target="_blank"の有無
      var targetParam = $el.attr( 'data-s5-purchaseButtonTarget' );


      // マニュアル：販売終了フラグを取得
      var manualEndOfSaleParam = /true/.test( $el.attr( 'data-s5-storeInfoManualEndOfSale' ) ) ? true : false;

      // // SearchResult が持ってきたデータを取得
      // var searchGetPrice = $el.attr( 'data-s5-storeInfoSearchGetPrice' ) ? toLocaleString( $el.attr('data-s5-storeInfoSearchGetPrice') ) : '';
      var searchGetPrice = $el.attr( 'data-s5-storeInfoSearchGetPrice' ) ? $el.attr( 'data-s5-storeInfoSearchGetPrice' ) !== '0' ? toLocaleString( $el.attr('data-s5-storeInfoSearchGetPrice') ) : '' : '';
      var searchGetMoreIc = $el.attr( 'data-s5-storeInfoSearchGetMoreIc' ) ? $el.attr( 'data-s5-storeInfoSearchGetMoreIc' ) : '';
      var searchGetPurchaseUrl = $el.attr( 'data-s5-storeInfoSearchGetPurchaseUrl' ) ? $el.attr( 'data-s5-storeInfoSearchGetPurchaseUrl' ) : '';

      // オーナーレビュー上書き用のjancodeを取得
      var originalOwnerReviewId = $el.attr('data-s5-storeInfoOriginalOwnerReviewId');
      // オーナーレビューの非表示フラグ
      var ownerReviewDisable = $el.attr('data-s5-storeInfoOwnerReviewDisable');
      // 購入導線上書き用のURLを取得
      var originalUrl = $el.attr( 'data-s5-storeInfoOriginalUrl' );
      // 購入導線上書き用の文言を取得
      var originalText = $el.attr( 'data-s5-storeInfoOriginalText' );
      // 代表商品名上書き用の文言を取得
      var originalProductName = $el.attr( 'data-s5-storeInfoOriginalProductName' );
      // 代表型名上書き用の文言を取得
      var originalModelName = $el.attr( 'data-s5-storeInfoOriginalModelName' );
      // 商品画像上書き用の文言を取得
      var originalModelImage = $el.attr( 'data-s5-storeInfoOriginalModelImage' );
      // マニュアル：ページアイコンラベルを取得
      var originalProductLabels = $el.attr( 'data-s5-storeInfoOriginalProductLabels' );

      // 購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
      // ボタンテキストの判定用
      var isForConsumer = $el.attr('data-s5-storeInfoIsForConsumer') === 'true';
      // サブボタン購入導線上書き用のURLを取得
      var subButtonOriginalUrl = $el.attr('data-s5-storeInfoOriginalUrlSub');
      // サブボタン購入導線上書き用の文言を取得
      var subButtonOriginalText = $el.attr('data-s5-storeInfoOriginalTextSub');

      /*
        以下はAPIの返却値には存在しないが、手動の文言指定があり、出力時に必要なため取得
      */
      // 型名備考の文言を取得
      var originalModelNameNote = $el.attr( 'data-s5-storeInfoOriginalModelNameNote' );
      // キャッチコピーの文言を取得 (関連商品で利用)
      var originalModelCatchCopy = $el.attr( 'data-s5-storeInfoOriginalModelCatchCopy' );
      // 追加リンクの文言を取得 (関連商品で利用)
      var originalModelAddButtonName = $el.attr( 'data-s5-storeInfoOriginalModelAddButtonName' );
      // 追加リンクのurlを取得 (関連商品で利用)
      var originalModelAddButtonLink = $el.attr( 'data-s5-storeInfoOriginalModelAddButtonLink' );
      // 追加リンクの別窓を取得 (関連商品で利用)
      var originalModelAddButtonLinkBlank = $el.attr( 'data-s5-storeInfoOriginalModelAddButtonLinkBlank' );
      // 追加リンクのカスタムリンクを取得 (関連商品で利用)
      var originalModelAddButtonCustomLink = $el.attr( 'data-s5-storeInfoOriginalModelAddButtonCustomLink' );


      // おすすめ
      var relatedItemIds = $el.attr( 'data-s5-storeInfo-related-item-ids');
      var relatedCurrenturl = $el.attr( 'data-s5-storeInfo-related-currenturl');
      var relatedCurrenttitle = $el.attr( 'data-s5-storeInfo-related-currenttitle');


      callbackIndex ++;

      return function () {

        var d = $.Deferred();

        if (isVaio && query.html_name === '') {
          // isVaio で html_name がnullの時はリクエストしない
          return false;
        } else if (query.pg_id === '' && query.product_id === '') {
          // PGID PID いずれもnullの時はリクエストしない
          return false;
        } else { // 不要
          // requestJsonp を複数同時実行する場合がるためそれらを格納するための Array
          var deferreds = [];

          // メインのリクエスト
          deferreds.push(
            s5.requestJsonp({
              data: query,
              url: APIUrl,
              callback: callback,
              charset: 'utf-8'
            })
          );
          // ajax がリクエストしているURLをhtmlに出力するためためておく
          if (isVaio) {
            // https://pur.store.sony.jp/Function/Vaio/Coalition/?html_name=VJS1411&rmd=&channel=2&kind=1&callback=ss_callback1
            reqUrl.push(APIUrl + '?html_name=' + query.html_name.replace('|', '%7C') + '&rmd=' + query.rmd + '&channel=' + query.channel + '&kind=' + query.kind + '&callback=' + query.callback);
          } else {
            // https://pur.store.sony.jp/Function/Coalition/?pg_id=T0000552206&product_id=&add_res=1&callback=ss_callback0
            reqUrl.push(APIUrl + '?pg_id=' + query.pg_id.replace(/\|/g, '%7C') + '&product_id=' + query.product_id.replace(/\|/g, '%7C') + '&add_res=' + query.add_res + '&callback=' + query.callback);
          }

          // サブのリクエストを追加
          // 購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
          if ((templateName === 'listItem4_double') || (templateName === 'sonystoreBlock_double') || (templateName === 'msaSonystoreBlock_double')) {
            var subCallback = 'ss_callback' + callbackIndex;

            deferreds.push(
              s5.requestJsonp({
                data: {
                  pg_id: $el.attr('data-s5-storeInfoProductGroupSub'),
                  product_id: $el.attr('data-s5-storeInfoProductCodeSub'),
                  add_res: 1,
                  callback: subCallback
                },
                url: APIUrl,
                callback: subCallback,
                charset: 'utf-8'
              })
            );
            // ajax がリクエストしているURLをhtmlに出力するためためておく
            if (isVaio) {
              // https://pur.store.sony.jp/Function/Vaio/Coalition/?html_name=VJS1411&rmd=&channel=2&kind=1&callback=ss_callback1
              reqUrl.push(APIUrl + '?html_name=' + query.html_name.replace('|', '%7C') + '&rmd=' + query.rmd + '&channel=' + query.channel + '&kind=' + query.kind + '&callback=' + query.callback);
            } else {
              // https://pur.store.sony.jp/Function/Coalition/?pg_id=T0000552206&product_id=&add_res=1&callback=ss_callback0
              reqUrl.push(APIUrl + '?pg_id=' + query.pg_id.replace(/\|/g, '%7C') + '&product_id=' + query.product_id.replace(/\|/g, '%7C') + '&add_res=' + query.add_res + '&callback=' + query.callback);
            }

            callbackIndex += 1;
          }

          $.when.apply($, deferreds).then(function(res, subRes) {
            // console.log( res );
            var price = ( res.price !== '' ) ? toLocaleString( res.price ) : 0;
            var priceSuffix  = res.more_ic;
            var productName  = res.product_name;
            var modelName    = res.model;
            var modelImage   = res.image;
            var shipmentIds  = ( /.+/.test( res.st_ic ) ) ? res.st_ic.split( ',' ) : [];
            var bennefitIds  = ( /.+/.test( res.pr_ic ) ) ? res.pr_ic.split( ',' ) : [];
            var pageIds      = ( /.+/.test( res.p_ic ) ) ? res.p_ic.split( ',' ) : [];
            // smarty側でページアイコンの指定があった場合に置き換える
            if ( originalProductLabels ) {
              // 一回配列っぽく入れ直す
              pageIds = '[' + originalProductLabels + ']';
              // smarty から渡ってきたカンマ区切りは文字列なのでオブジェクトに変換する必要がある
              if (typeof pageIds === 'string') {
                pageIds = JSON.parse(pageIds);
              }
            }
            var ownerReviewProductCode = query.product_id; // オーナーレビューのID。手動上書きがなければ価格で利用されているproduct_idを採用

            var storePriceBenefitEyeblow = ''; // 長期保証の認知強化
            var pageIcon222  = false;
            var pageIcon2    = false;
            var buttonUrl    = res.url;
            var buttonText   = getButtonText( +res.st, singleItem );


            /*****
              以下はAPIの返却値には存在しないが、手動の文言指定があり、出力時に必要なため取得
            *****/
            // 型名備考
            var modelNameNote = originalModelNameNote;
            // キャッチコピーの文言を取得 (関連商品で利用)
            var modelCatchCopy = originalModelCatchCopy;
            // 追加リンクの文言 (関連商品で利用)
            var modelAddButtonName = '商品情報';
            // 追加リンクのurlを取得 (関連商品で利用)
            var modelAddButtonLink = originalModelAddButtonLink;
            // 追加リンクの別窓を取得 (関連商品で利用)
            var modelAddButtonLinkBlank = originalModelAddButtonLinkBlank;
            // 追加リンクのカスタムリンクを取得 (関連商品で利用)
            var modelAddButtonCustomLink = originalModelAddButtonCustomLink;

            // tax_free 非課税対象フラグ
            // 「(税込)」の表示非表示に使用するフラグ
            // - 0:(税込)
            // - 1:非表示
            // 非課税対象の場合は1を返却、１つでも課税対象が含まれれば0を返却
            var priceTaxfree = ( +res.tax_free === 0 ) ? true : false;
            var priceTaxfreeParam = res.tax_free;

            // ph (価格表示フラグ)が 0 以外、または 価格がついていない場合は価格を出さない
            // ph (価格表示フラグ) は「1」だと非表示指示
            var priceDisplay = ( ( +res.ph !== 0 ) || ( +price === 0 ) ) ? false : true;

            // 価格非表示フラグ
            // - 1：販売価格非表示
            // -が1であるうえで
            // 販売予定価格フラグ
            // - 0：販売価格表示
            // - 1：販売予定価格あり
            // 0の場合は何もしないが1がかえってきたら
            // 「※ 販売予定価格を含みます」
            // のテキストを追加で表示する
            var saleEstimatedPrice = ( +res.ph !== 0 && +res.yotei === 1 );

            // - 40：販売終了（エラーも含む）
            // - 50：販売終了（販売終了後30日）
            // 40か50の場合にはボタンやアイコンはナシで
            // 「本商品のソニーストアでの販売は終了しております」
            // のテキストのみを表示する
            var endOfSale = ( +res.st === 40 || +res.st === 50 );

            // - 99：エラー
            // 99の場合にはボタンやアイコンはナシで
            // 「現在　ソニーストアでの取り扱いのない商品です」
            // のテキストのみを表示する
            var statusError = ( +res.st === 99 );

            // - 13：購入導線OFF(受注前など)
            // リンクとアイコンは出さない
            var saleOff = ( +res.st === 13 );

            // - 11:メール登録
            // ボタンの近くに「メール登録とは」のリンクを表示
            var mailTextView = ( +res.st === 11 );

            // - 12：エントリー登録
            // ボタンの近くに「エントリー登録とは」のリンクを表示
            var entryTextView = ( +res.st === 12 );

            // data-s5-purchaseButtonTargetの値を変換
            var target = targetParam;

            // マニュアル：販売終了フラグ
            var manualEndOfSale = manualEndOfSaleParam;

            // - クーポン表示可能
            // HTMLにdata-s5-storeInfoDiscount属性が存在する
            // storeCouponDisount.jsでクーポン適用ボタンを表示する
            var couponsAvailable = $el.attr( 'data-s5-storeInfoDiscount' ) !== undefined;
            // couponsAvailable = true; console.log( 'debbuing for couponsAvailable' );

            // 「発売前先行体験・展示」のリンク表示で利用するためにステータスを取得
            // st:商品ステータスが以下のものは出す
            // 11：メール登録
            // 12：エントリー
            // 13：受注前(購入導線OFF)
            // 14：先行予約販売中
            var saleStatus = +res.st;

            // 何かひとつでも表示す場合は true
            // 何も表示しない場合は false
            var display = ( function () {

              // ボタン用のテキストがない場合は非表示
              if ( buttonText === null ) { return false; }

              // ボタンテキストがない、かつ、ph (販売価格表示フラグ) が 1 の時、かつ、1：販売予定価格なしは非表示
              if ( ( buttonText === '' && +res.ph === 1 && +res.yotei !== 1  ) ) { return false; }

              // ボタンテキスト無し、価格非表示、シップメントと特典アイコンが無い 場合には非表示
              if (
                buttonUrl === ''         &&
                !priceDisplay            &&
                shipmentIds.length === 0 &&
                bennefitIds.length === 0 &&
                pageIds.length === 0
              ) { return false; }

              // ph (価格表示フラグ) は「1」だと非表示指示だが1：販売予定価格ありならば表示
              if ( ( +res.ph === 1 && +res.yotei === 1 ) ) { priceDisplay = true; }

              return true;

            } )();

            // ループ処理の最終判別用 カルーセルの再描画に使用
            loopIndex ++;

            // console.log( display, buttonText === '', !priceDisplay, shipmentIds, bennefitIds, pageIds );

            _.each( shipmentIds, function ( el, i ) {

              shipmentIds[ i ] = +el;

            } );
            _.each( bennefitIds, function ( el, i ) {

              bennefitIds[ i ] = +el;

              // 長期保証の認知強化
              // 長期保証対象の商品については訴求を強めるため実施。
              // 特典アイコン[39, 44, 228, 227, 244, 243, 242, 251](251は表示無し) を対象に価格の上に表示
              if ((el === '39') || (el === 39)) {
                // 長期保証サービス（特典アイコン表示用）
                storePriceBenefitEyeblow = 'ソニーストアはメーカー保証内容<em>＜3年＞</em>付き';
              } else if ((el === '44') || (el === 44)) {
                // 長期保証＜3年ワイド＞プレゼント（特典アイコン表示用）
                storePriceBenefitEyeblow = 'ソニーストアはメーカー保証内容＋破損・水ぬれ等<em>＜3年＞</em>付き';
              } else if ((el === '228') || (el === 228)) {
                // 長期保証＜5年ベーシック＞プレゼント（特典アイコン表示用）
                storePriceBenefitEyeblow = 'ソニーストアはメーカ保証内容<em>＜5年＞</em>付き';
              } else if ((el === '227') || (el === 227)) {
                // 長期保証＜5年ワイド＞プレゼント（特典アイコン表示用）
                storePriceBenefitEyeblow = 'ソニーストアはメーカー保証内容＋破損・水ぬれ等<em>＜5年＞</em>付き';
              } else if ((el === '244') || (el === 244)) {
                // 長期保証<3年ワイド>付属 キャンペーン
                storePriceBenefitEyeblow = '今ならメーカー保証内容＋破損・水ぬれ等<em>＜3年＞</em>付き';
              } else if ((el === '243') || (el === 243)) {
                // 長期保証<5年ベーシック>付属　キャンペーン
                storePriceBenefitEyeblow = '今ならメーカ保証内容<em>＜5年＞</em>付き';
              } else if ((el === '242') || (el === 242)) {
                // 長期保証<5年ワイド>付属　キャンペーン
                storePriceBenefitEyeblow = '今ならメーカー保証内容＋破損・水ぬれ等<em>＜5年＞</em>付き';
              // } else if ((el === '251') || (el === 251)) {
                // 長期保証会員限定特典
                // 表示しない
                // ※他のアイコンと重複していた場合は重複しているアイコンに準じた訴求テキストのみを表示する
                // つまり処理をしないに等しい
              //   storePriceBenefitEyeblow = '';
              }

            } );
            _.each( pageIds, function ( el, i ) {

              pageIds[ i ] = +el;

              // 購入ボタン => 返却値[p_ic]の返却値による表示変更
              // ・予約販売中（222）
              // 　「予約販売中　ご購入はこちら」表記に変更
              // ・Coming　soon（2）
              // 　デフォルト：購入ボタンなしで「近日受付開始予定」とする
              // 　⑤の注記インクルードがある場合：インクルードのみ表示

              if ( ( el === '222' ) || ( el === 222 ) ) {

                pageIcon222 = true;

              } else if ( ( el === '2' ) || ( el === 2 ) ) {

                pageIcon2 = true;

              }

            } );

            /*****
              APIのレスポンスからもろもろ上書きを行いたいケースがある
              ここでまとめて手動を取得して上書き
            *****/
            // SearchResult からのリクエストで Product Group ID を使わないと情報が取れない（st:99が返る）ケースがあることが判明。
            // また Product Group ID でAPIを呼び出したとしても、情報が取れないケースがあることも判明。
            // 検索エンジン側で事前に判断することができないことも判明。
            // API呼出でst:99が返った場合、検索エンジンから渡してもらう情報を使って表示を行う。
            // - ph: 販売価格非表示情報に関して => 渡された価格が「0」または「空」の場合は価格非表示(ph:1)扱い
            // - yotei: 販売予定価格 => 予定価格状態で表示されることは基本的には想定なし。 検索エンジンから価格が渡されている場合は、通常の「販売価格」として表示
            // - tax_free: 課税区分 => 渡される価格は「税込価格」。サーチタグでは課税区分の考慮なし。よってすべて「(税込)」表示有り。
            // VAIOに関しては、この対応は不要。st: 99 が返ってきた場合も、これまで通りの対応 / 表示
            if (
              (templateName === 'searchResult') ||
              (templateName === 'msaSearchResult')
            ) {
              if (!isVaio && statusError) {
                if (searchGetPrice !== '') {
                  display = true;
                  priceDisplay = true; // 価格を表示させるようにする
                  price = searchGetPrice; // SearchResult から取得した価格
                  priceSuffix = searchGetMoreIc; // SearchResult から取得した最低価格表示
                  priceTaxfree = true; // SearchResult から取得した価格は「税込価格」と決め打ち。よってすべて「(税込)」表示有り。
                  priceTaxfreeParam = 0; // SearchResult から取得した価格は「税込価格」と決め打ち。よってすべて「(税込)」表示有り。
                }
                if (searchGetPurchaseUrl !== '') {
                  display = true;
                  buttonText = getButtonText(20, singleItem); // 表示は st:20 “販売中” と同じ とのことなのでボタンテキストを st:20 で取得
                  buttonUrl = searchGetPurchaseUrl; // SearchResult から取得したURL
                }
              }
              // SearchResultでは購入導線にqueryを付与する
              if ( !!buttonUrl && addPurchaseUrlQuery ) {
                var paramSymbol = /\?/.test(buttonUrl) ? '&' : '?';
                buttonUrl = buttonUrl + paramSymbol + 's_srch=' + addPurchaseUrlQuery;
              }
            }
            // 購入導線上書き用のURLが設定されていたら差し替える
            if (originalOwnerReviewId) {
              ownerReviewProductCode = originalOwnerReviewId;
            }

            // 代表商品名上書き用のURLが設定されていたら差し替える
            if ( originalProductName ) {
              productName = originalProductName;
            }
            // 代表型名上書き用のURLが設定されていたら差し替える
            if ( originalModelName ) {
              modelName = originalModelName;
            }
            // 商品画像上書き用のURLが設定されていたら差し替える
            if ( originalModelImage ) {
              modelImage = originalModelImage;
            }
            // 購入導線上書き用のURLが設定されていたら差し替える
            if ( originalUrl ) {
              buttonUrl = originalUrl;
            }
            // 購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
            // ボタン文言の置き換え
            if (
              ( templateName === 'listItem4_double' ) ||
              ( templateName === 'sonystoreBlock_double' ) ||
              ( templateName === 'msaSonystoreBlock_double' )
            ) {
              if ( buttonText ) {
                buttonText = buttonText.replace( 'ご購入', 'お支払い');
              }
            }
            // 購入導線上書き用の文言が設定されていたら差し替える
            if ( originalText ) {
              buttonText = originalText;
            }

            // 追加リンクの文言上書き用の文言が設定されていたら差し替える (関連商品で利用)
            if ( originalModelAddButtonName ) {
              modelAddButtonName = originalModelAddButtonName;
            }


            // link: バナー用のobjectsのarray
            //       additionalJsonに一致するpg_id or product_idのデータがあればマージする
            var banners = res.link ? res.link : [];
            var matchedKeys = [];
            if (!isVaio) {
              var queryIds = _.compact(
                query.pg_id.split('|').concat(query.product_id.split('|'))
              );

              _.each(additionalJson.keys, function(value, key) {
                if (_.some(queryIds, function(id) { return key.indexOf(id) >= 0; })) {
                  matchedKeys.push(value);
                }
              });
              _.each(_.uniq(matchedKeys), function(key) {
                banners = banners.concat(additionalJson.values[key].link);
              });
            }

            var data = {
              display                : display,                                            // 全要素の表示非表示
              target                 : target,                                             // 別窓遷移の有無
              priceDisplay           : priceDisplay,                                       // 価格非表示＆予定価格表示
              price                  : price,                                              // 価格
              priceSuffix            : priceSuffix,                                        // 最低価格「から」の表示
              productName            : productName,                                        // 代表商品名
              modelName              : modelName,                                          // 代表型名

              modelNameNote          : modelNameNote,                                      // 型名備考

              modelCatchCopy         : modelCatchCopy,                                     // キャッチコピー (関連商品で利用)
              modelAddButtonName     : modelAddButtonName,                                 // 追加リンク文言 (関連商品で利用)
              modelAddButtonLink     : modelAddButtonLink,                                 // 追加リンクのurl (関連商品で利用)
              modelAddButtonLinkBlank : modelAddButtonLinkBlank,                           // 追加リンクの別窓 (関連商品で利用)
              modelAddButtonCustomLink : modelAddButtonCustomLink,                         // 追加リンクのカスタムリンク (関連商品で利用)

              modelImage             : modelImage,                                         // 商品画像
              priceTaxfree           : priceTaxfree,                                       // 「(税込)」の表示表記
              priceTaxfreeParam      : priceTaxfreeParam,                                  // tax_freeのパラメータ
              saleEstimatedPrice     : saleEstimatedPrice,                                 // 価格表示＆予定価格表示
              shipment               : getIconsData( 'shipment', shipmentIds ),            // 出荷アイコン
              bennefits              : getIconsData( 'benefit', bennefitIds ),             // 特典アイコン
              page                   : getIconsData( 'page', pageIds ),                    // ページアイコン
              storePriceBenefitEyeblow: storePriceBenefitEyeblow,                          // 長期保証の認知強化
              pageIcon222            : pageIcon222,                                        // p_ic:222で購入導線表示変更
              pageIcon222Text        : '予約販売中',                                        // p_ic:222で購入導線表示変更の文言
              pageIcon2              : pageIcon2,                                          // p_ic:2で購入導線表示変更
              pageIcon2Text          : '近日販売開始予定',                                   // p_ic:2で購入導線表示変更の文言
              buttonUrl              : isLine ? buttonUrl + lineViewParam : buttonUrl,    // 購入導線リンク
              buttonText             : buttonText,                                         // 購入導線文言
              saleOff                : saleOff,                                            // 13：購入導線OFF(受注前など)
              mailTextView           : mailTextView,                                       // 11：メール登録
              entryTextView          : entryTextView,                                      // 12：エントリー登録
              statusError            : statusError,                                        // 99：エラー
              endOfSale              : endOfSale,                                          // 40,50：販売終了
              endOfSaleText          : '本商品のソニーストアでの販売は終了しております',         // 40,50：販売終了の文言
              statusErrorText        : '現在　ソニーストアでの取り扱いのない商品です',           // 99：エラーの文言
              manualEndOfSale        : manualEndOfSale,                                   // マニュアル：販売終了フラグ
              manualEndOfSaleText    : '※ 販売を終了いたしました',                            // マニュアル：販売終了の文言
              saleEstimatedPriceText : '※ 販売予定価格を含みます',                        // 価格表示＆予定価格表示の文言
              mailTextUrl            : 'https://www.sony.jp/store/guide/info/mail.html#PAGE-TI-05',           // メール登録とはURL
              mailText               : 'メール登録とは',                                   // メール登録とは文言
              entryTextUrl           : 'https://www.sony.jp/store/guide/shopping/preorder.html#PAGE-TI-03',   // エントリー登録とはURL
              entryText              : 'エントリー登録とは',                               // エントリー登録とは文言

              couponsAvailable       : couponsAvailable, // クーポン適用可能
              productGroup           : query.pg_id,      // クーポン価格適用JS連携で再度使う
              productCode            : query.product_id,  // クーポン価格適用JS連携で再度使う
              ownerReviewProductCode : ownerReviewProductCode,  // オーナーレビューで利用するID
              ownerReviewDisable     : ownerReviewDisable,  // オーナーレビューの非表示フラグ

              relatedItemIds         : relatedItemIds,  // おすすめ id
              relatedCurrenttitle    : relatedCurrenttitle,  // おすすめ テキスト
              relatedCurrenturl      : relatedCurrenturl,  // おすすめ url

              saleStatus             : saleStatus, // st：発売ステータス

              banners                : banners
            }

            // 購入ボタンを二つ持つver. digital-paper / dp カテゴリで利用
            if (subRes) {
              var subButtonUrl = subRes.url;
              // 購入導線上書き用のURLが設定されていたら差し替える
              if ( subButtonOriginalUrl ) {
                subButtonUrl = subButtonOriginalUrl;
              }
              var subButtonText = getButtonText( +subRes.st );
              if ( subButtonText ) {
                subButtonText = subButtonText.replace( 'ご購入', 'お支払い');
              }
              $.extend(
                data,
                {
                  buttonTextPrefix    : isForConsumer ? '個人での' : '法人での',
                  subButtonUrl        : isLine ? subButtonUrl + lineViewParam : subButtonUrl,
                  subButtonText       : subButtonOriginalText ? subButtonOriginalText : subButtonText,
                  subButtonTextPrefix : isForConsumer ? '法人での' : '個人での'
                }
              );
            }

            $el.after( template( data ) );

            //何も表示しない場合には大外枠のクラスに非表示用のクラス名を追加
            if(+res.st === 13 && +res.ph === 1 && +res.yotei !== 1){
              $el.closest(".s5-sonystoreBlock").addClass("s5-sonystoreBlock__hide");
            }

            ( function () {

              var $review = $el.parent().find('[data-owner-review-type]').get(0);

              if (s5.ownerReview) {
                // owner review を実行
                s5.ownerReview.apply($review);
              }

              var $discount = $el.parent().find( '[data-s5-store-discount]' );

              if ( !s5.couponDiscount ) {
                // couponDiscount.jsが読み込まれていない場合
                return;
              }

              $.when(
                window.s5.couponDiscount.ready()
              ).done( function () {

                if (
                  display          &&
                  priceDisplay     &&
                  couponsAvailable // HTMLにdata-s5-storeInfoDiscount属性が存在
                ) {

                  var timer = null;
                  var jW = $(window);

                  $(window).on('load scroll resize', function () {

                    clearTimeout(timer);

                    timer = setTimeout(function () {

                      var $discountTargetPosition = $discount.offset().top;
                      var wHeight = jW.height() * 2;
                      var displayPosition = jW.scrollTop() + wHeight;

                      if (displayPosition > $discountTargetPosition) {
                        s5.couponDiscount.apply($discount);
                      }
                    }, 100);
                  });

                  // var d = new $.Deferred();

                  // setTimeout(function () {
                  //   s5.couponDiscount.apply($discount);
                  //   d.resolve();
                  // }, delayTime * delayIndex);

                  // delayIndex++;
                  // return d;

                }

              } );


            } )();

            // td の場合があり、
            // もともとのプレースホルダーを削除する必要がある
            $el.remove();

            // 描画後に高さ合わせを個別で行いたいケースがある。
            // 都度ここでイベントを発行するので、それぞれの js はこれを on すると実行できる。
            s5.vent.trigger('eachHeightMuch');

            d.resolve();

          }, function() {

            d.reject();

          } );

        }

        return d.promise();

      }

    };

    var printReqUrl = function () {

      if ( /www.sony.jp/.test( location.href ) || /search.sony.jp/.test( location.href ) ) {
        return;
      }

      var APIUrlDomain = APIUrl ? APIUrl.split('/Function/')[0] : 'https://pur.store.sony.jp';

      $('body').append('<div id="developPrintReqUrl"></div>');
      $('<div id="developPrintReqUrlList"></div>').appendTo('#developPrintReqUrl');
      $('<p>本番ドメイン</p>').appendTo('#developPrintReqUrlList');
      $('<ul id="developPrintReqUrlListProduction"></ul>').appendTo('#developPrintReqUrlList');
      $('<p>ステージングドメイン</p>').appendTo('#developPrintReqUrlList');
      $('<ul id="developPrintReqUrlListStaging"></ul>').appendTo('#developPrintReqUrlList');
      $('<button id="developPrintReqUrlButton">価格リクエストURL</button>').appendTo('#developPrintReqUrl');

      $.each( reqUrl,
        function (index, item) {
          $('<li></li>').append(item.replace(APIUrlDomain, 'https://pur.store.sony.jp')).appendTo('#developPrintReqUrlListProduction');
        }
      );

      $.each( reqUrl,
        function (index, item) {
          $('<li></li>').append(item).appendTo('#developPrintReqUrlListStaging');
        }
      );

      $('#developPrintReqUrlList').css({
        'background': 'white',
        'margin': 0,
        'width': '100%',
        'display': 'none'
      });

      $('#developPrintReqUrlButton').on('click', function(){
        $('#developPrintReqUrlList').slideToggle();
      });

    }

    $.when(
      getTable(),
      fetchAdditionalJson()
    ).done( function () {
      $.when.apply($, $('.s5-js-storeInfoTemplate').map(function(item) {
        var $this = $(this);

        if ($this.parents('.s5-horizontalItemList')) { isCarousel = true; }

        return fetch($this)();
      }))
      .then(s5.storeBlockCarusel) // ストアバナーのカルーセルを実行
      .then(printReqUrl()); // API リクエストしている URLを html に出力
    } );


    var updateAPI = function()
    {
      // console.log('[updateAPI]');
      $( '.s5-js-storeInfoTemplate' ).each( function () {

        var $this = $( this );

        if ( $this.parents('.s5-horizontalItemList') ) { isCarousel = true; }

        fetch( $this )();

        // pipeline.add( fetch( $this ) );


      } );
    };




    s5.vent.on( 'priceApiUpdate', updateAPI );


    $( window ).on( 'load' , function () {

      if ( isCarousel ) { window.s5 && s5.vent.trigger('rtoasterready'); }

    } );

  } );

} )( jQuery );

</script>

</body>
</html>
