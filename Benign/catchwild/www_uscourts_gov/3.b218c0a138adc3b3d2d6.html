<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.b218c0a138adc3b3d2d6.html</title>
</head>
<body>

<script>
(window.wpSpeechstreamToolbar=window.wpSpeechstreamToolbar||[]).push([[3],{251:function(e,t,n){"use strict";function r(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var s=e.apply(t,n);function o(e){r(s,i,a,o,l,"next",e)}function l(e){r(s,i,a,o,l,"throw",e)}o(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function l(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return k}));var u=Symbol.for("texthelp.EventBus"),d=window[u];function g(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function c(e,t){return e(t={exports:{}},t.exports),t.exports}d||(d={events:{},unSubscribe:function(e,t,n){if(null!=this.events[e])for(var r=0;r<this.events[e].length;r++)this.events[e][r].context==n&&this.events[e].splice(r,1)},subscribe:function(e,t,n){return null==this.events[e]&&(this.events[e]=[]),this.events[e].push({callback:t,context:n}),this.events.length-1},publish:function(e){var t=this.events[e];if(null!=t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(this,r)}},uninstallEventBus:function(){this.events=null,delete window[u]}},window[u]=d);var m=c((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={voices:{Ava:"en-US"},lang:{all:{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"},"en-US":{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"}}}}));g(m);var p=c((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pronunciations=void 0;var n,r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n=m)&&n.__esModule?n:{default:n};t.Pronunciations=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.prons={voices:{},lang:{}},void 0!==i.default&&null!=i.default&&(this.prons=i.default)}return r(e,[{key:"loadPronFile",value:function(){}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.prons.lang[e],r=this.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var s=0;s<t.length;s++)t[s]=t[s].replace(a,i[a])}}]),e}()}));g(p);var f=p.Pronunciations,S=function(){function e(){a(this,e),this.hexcase=0,this.b64pad="",this.chrsz=8}return o(e,[{key:"hex_md5",value:function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}},{key:"core_md5",value:function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,s=0;s<e.length;s+=16){var o=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[s+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,a,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[s+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[s+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,a,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[s+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[s+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,a,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[s+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,a,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[s+9],5,568446438),a=this.md5_gg(a,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[s+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[s+5],4,-378558),a=this.md5_hh(a,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[s+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[s+13],4,681279174),a=this.md5_hh(a,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,a,e[s+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,a,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[s+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[s+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[s+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[s+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,a,n,e[s+9],21,-343485551),n=this.safe_add(n,o),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return[n,r,i,a]}},{key:"md5_cmn",value:function(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}},{key:"md5_ff",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t&n|~t&r,e,t,i,a,s)}},{key:"md5_gg",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t&r|n&~r,e,t,i,a,s)}},{key:"md5_hh",value:function(e,t,n,r,i,a,s){return this.md5_cmn(t^n^r,e,t,i,a,s)}},{key:"md5_ii",value:function(e,t,n,r,i,a,s){return this.md5_cmn(n^(t|~r),e,t,i,a,s)}},{key:"safe_add",value:function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}},{key:"bit_rol",value:function(e,t){return e<<t|e>>>32-t}},{key:"str2binl",value:function(e){for(var t=[],n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}},{key:"binl2hex",value:function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(15&e[r>>2]>>r%4*8+4)+t.charAt(15&e[r>>2]>>r%4*8);return n}},{key:"$rw_hash",value:function(e){return this.hex_md5(e)}}]),e}(),v=c((function(e,t){t.voices=[{name:"Tarik",Gender:"Male",language:"ar",description:"Arabic Male Tarik",glang:"ar",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Miren",Gender:"Female",language:"eu-es",description:"Basque Female Miren",glang:"eu",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Montserrat",Gender:"Female",language:"ca-es",description:"Catalan Female Montserrat",glang:"ca",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tian-Tian",Gender:"Female",language:"zh-cn",description:"Chinese (Mandarin - Simplified) Female Tian-Tian",glang:"zh_cn",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Mei-Jia",Gender:"Female",language:"zh-tw",description:"Chinese (Mandarin - Traditional - Taiwanese) Female Mei-Jia",glang:"zh_tw",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Zuzana",Gender:"Female",language:"cs-cz",description:"Czech Female Zuzana",glang:"cs",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sara",Gender:"Female",language:"da-dk",description:"Danish Female Sara",glang:"da-dk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Magnus",Gender:"Female",language:"da-dk",description:"Danish Female Magnus",glang:"da-dk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ellen",Gender:"Female",language:"nl-be",description:"Dutch (Belgium and Flemish) Female Ellen",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Claire",Gender:"Female",language:"nl-nl",description:"Dutch (Netherlands) Female Claire",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Xander",Gender:"Male",language:"nl-nl",description:"Dutch (Netherlands) Male Xander",glang:"nl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Karen",Gender:"Female",language:"en-au",description:"English (Australian) Female Karen",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lee",Gender:"Male",language:"en-au",description:"English (Australian) Male Lee",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Veena",Gender:"Female",language:"en-in",description:"English (India) Female Veena",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Moira",Gender:"Female",language:"en-ie",description:"English (Irish) Female Moira",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Fiona",Gender:"Female",language:"en-sc",description:"English (Scottish) Female Fiona",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tessa",Gender:"Female",language:"en-za",description:"English (South African) Female Tessa",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Daniel",Gender:"Male",language:"en-gb",description:"English (UK) Male Daniel",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Serena",Gender:"Female",language:"en-gb",description:"English (UK) Female Serena",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Allison",Gender:"Female",language:"en-us",description:"English (US) Female Allison",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Tom",Gender:"Male",language:"en-us",description:"English (US) Male Tom",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Samantha",Gender:"Female",language:"en-us",description:"English (US) Female Samantha",glang:"en",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Satu",Gender:"Female",language:"fi-fi",description:"Finnish Female Satu",glang:"fi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Amelie",Gender:"Female",language:"fr-ca",description:"French (Canadian) Female Amelie",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Audrey",Gender:"Female",language:"fr",description:"French Female Audrey",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Thomas",Gender:"Male",language:"fr",description:"French Male Thomas",glang:"fr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carmela",Gender:"Female",language:"gl-es",description:"Galician (Spain) Female Carmela",glang:"gl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Anna",Gender:"Female",language:"de-de",description:"German Female Anna",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yannick",Gender:"Male",language:"de-de",description:"German Male Yannick",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Petra",Gender:"Female",language:"de-de",description:"German Female Petra",glang:"de",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Melina",Gender:"Female",language:"el-gr",description:"Greek Female Melina",glang:"el",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Nikos",Gender:"Male",language:"el-gr",description:"Greek Male Nikos",glang:"el",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lekha",Gender:"Female",language:"hi-in",description:"Hindi Female Lekha",glang:"hi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Mariska",Gender:"Female",language:"hu-hu",description:"Hungarian Female Mariska",glang:"hu",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Damayanti",Gender:"Female",language:"id-id",description:"Indonesian (Bahasa) Female Damayanti",glang:"id",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Alice",Gender:"Female",language:"it-it",description:"Italian Female Alice",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Federica",Gender:"Female",language:"it-it",description:"Italian Female Federica",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Luca",Gender:"Male",language:"it-it",description:"Italian Male Luca",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Paola",Gender:"Female",language:"it-it",description:"Italian Female Paola",glang:"it",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ichiro",Gender:"Male",language:"ja-jp",description:"Japanese Male Ichiro",glang:"ja",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sakura",Gender:"Female",language:"ja-jp",description:"Japanese Female Sakura",glang:"ja",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Sora",Gender:"Female",language:"ko-kr",description:"Korean Female Sora",glang:"ko",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Nora",Gender:"Female",language:"no-no",description:"Norwegian Female Nora",glang:"no",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Henrik",Gender:"Male",language:"no-no",description:"Norwegian Male Henrik",glang:"no",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ewa",Gender:"Female",language:"pl-pl",description:"Polish Female Ewa",glang:"pl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Zosia",Gender:"Female",language:"pl-pl",description:"Polish Female Zosia",glang:"pl",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Luciana",Gender:"Female",language:"pt-br",description:"Portuguese (Brazilian) Female Luciana",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Felipe",Gender:"Male",language:"pt-br",description:"Portuguese (Brazilian) Male Felipe",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Joana",Gender:"Female",language:"pt-pt",description:"Portuguese Female Joana",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Catarina",Gender:"Female",language:"pt-pt",description:"Portuguese Female Catarina",glang:"pt",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Ioana",Gender:"Female",language:"ro-ro",description:"Romanian Female Ioana",glang:"ro",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Milena",Gender:"Female",language:"ru-ru",description:"Russian Female Milena",glang:"ru",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yuri",Gender:"Male",language:"ru-ru",description:"Russian Male Yuri",glang:"ru",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Laura",Gender:"Female",language:"sk-sk",description:"Slovakian Female Laura",glang:"sk",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carlos",Gender:"Male",language:"es-co",description:"Spanish (Columbian) Male Carlos",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Soledad",Gender:"Female",language:"es-co",description:"Spanish (Columbian) Female Soledad",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Paulina",Gender:"Female",language:"es-mx",description:"Spanish (Mexican) Female Paulina",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Juan",Gender:"Male",language:"es-mx",description:"Spanish (Mexican) Male Juan",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Jorge",Gender:"Male",language:"es-es",description:"Spanish (Castilian) Male Jorge",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Monica",Gender:"Female",language:"es-es",description:"Spanish (Castilian) Female Monica",glang:"es",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Alva",Gender:"Female",language:"sv-se",description:"Swedish Female Alva",glang:"sv",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Oskar",Gender:"Male",language:"sv-se",description:"Swedish Male Oskar",glang:"sv",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Kanya",Gender:"Female",language:"th-th",description:"Thai Female Kanya",glang:"th",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Cem",Gender:"Male",language:"tr-tr",description:"Turkish Male Cem",glang:"tr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Yelda",Gender:"Female",language:"tr-tr",description:"Turkish Female Yelda",glang:"tr",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Dariush",Gender:"Male",language:"fa-ir",glang:"fa",description:"Farsi Male Dariush",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Carmit",Gender:"Female",language:"he-il",glang:"he",description:"Hebrew Female Carmit",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lesya",Gender:"Female",language:"uk-ua",glang:"uk",description:"Ukrainian Female Lesya",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Jordi",Gender:"Male",language:"ca-es",glang:"ca",description:"Catalan Male Jordi",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Isak_nn",Gender:"Male",language:"nn-no",glang:"no",description:"Norwegian Male Isak_nn",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Isak_nb",Gender:"Male",language:"nb-no",glang:"no",description:"Norwegian Male Isak_nb",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Inger_nn",Gender:"Male",language:"nn-no",glang:"no",description:"Norwegian Female Inger_nn",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Inger_nb",Gender:"Male",language:"nb-no",glang:"no",description:"Norwegian Female Inger_nb",vendor:"Webappella",SupportedEngines:["standard"]},{name:"Vani",Gender:"Female",language:"ta-in",description:"Tamil Indian Female Vani",glang:"ta",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Daria",Gender:"Female",language:"bg-bg",glang:"bg",description:"Bulgarian Female Daria",vendor:"Nuance",SupportedEngines:["standard"]},{name:"Lana",Gender:"Female",language:"hr-hr",glang:"hr",description:"Croatian Female Lana",vendor:"Nuance",SupportedEngines:["standard"]}],t.polly=[{name:"Lotte",Gender:"Female",language:"nl-NL",description:"Dutch Female Lotte",glang:"nl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Maxim",Gender:"Female",language:"ru-RU",description:"Russian Male Maxim",glang:"ru",vendor:"Polly",SupportedEngines:["standard"]},{name:"Salli",Gender:"Female",language:"en-US",description:"US English Female Salli",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Geraint",Gender:"Male",language:"en-GB-WLS",description:"Welsh English Male Geraint",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Miguel",Gender:"Female",language:"es-US",description:"US Spanish Male Miguel",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Marlene",Gender:"Female",language:"de-DE",description:"German Female Marlene",glang:"de",vendor:"Polly",SupportedEngines:["standard"]},{name:"Giorgio",Gender:"Female",language:"it-IT",description:"Italian Male Giorgio",glang:"it",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ines",Gender:"Female",language:"pt-PT",description:"Portuguese Female Inês",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Zeina",Gender:"Female",language:"arb",description:"Arabic Female Zeina",glang:"arb",vendor:"Polly",SupportedEngines:["standard"]},{name:"Zhiyu",Gender:"Female",language:"cmn-CN",description:"Chinese Mandarin Female Zhiyu",glang:"cmn",vendor:"Polly",SupportedEngines:["standard"]},{name:"Gwyneth",Gender:"Female",language:"cy-GB",description:"Welsh Female Gwyneth",glang:"cy",vendor:"Polly",SupportedEngines:["standard"]},{name:"Karl",Gender:"Female",language:"is-IS",description:"Icelandic Male Karl",glang:"is",vendor:"Polly",SupportedEngines:["standard"]},{name:"Joanna",Gender:"Female",language:"en-US",description:"US English Female Joanna",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Lucia",Gender:"Female",language:"es-ES",description:"Castilian Spanish Female Lucia",glang:"es",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Cristiano",Gender:"Female",language:"pt-PT",description:"Portuguese Male Cristiano",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Astrid",Gender:"Female",language:"sv-SE",description:"Swedish Female Astrid",glang:"sv",vendor:"Polly",SupportedEngines:["standard"]},{name:"Vicki",Gender:"Female",language:"de-DE",description:"German Female Vicki",glang:"de",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Mia",Gender:"Female",language:"es-MX",description:"Mexican Spanish Female Mia",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Bianca",Gender:"Female",language:"it-IT",description:"Italian Female Bianca",glang:"it",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Vitoria",Gender:"Female",language:"pt-BR",description:"Brazilian Portuguese Female Vitória",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Raveena",Gender:"Female",language:"en-IN",description:"Indian English Female Raveena",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Chantal",Gender:"Female",language:"fr-CA",description:"Canadian French Female Chantal",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Amy",Gender:"Female",language:"en-GB",description:"British English Female Amy",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Brian",Gender:"Female",language:"en-GB",description:"British English Male Brian",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Russell",Gender:"Female",language:"en-AU",description:"Australian English Male Russell",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Aditi",Gender:"Female",language:"en-IN",description:"Indian English Female Aditi",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Matthew",Gender:"Female",language:"en-US",description:"US English Male Matthew",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Dora",Gender:"Female",language:"is-IS",description:"Icelandic Female Dóra",glang:"is",vendor:"Polly",SupportedEngines:["standard"]},{name:"Enrique",Gender:"Female",language:"es-ES",description:"Castilian Spanish Male Enrique",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Hans",Gender:"Female",language:"de-DE",description:"German Male Hans",glang:"de",vendor:"Polly",SupportedEngines:["standard"]},{name:"Carmen",Gender:"Female",language:"ro-RO",description:"Romanian Female Carmen",glang:"ro",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ivy",Gender:"Female",language:"en-US",description:"US English Female Ivy",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"p-Ewa",Gender:"Female",language:"pl-PL",description:"Polish Female Ewa",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Maja",Gender:"Female",language:"pl-PL",description:"Polish Female Maja",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Nicole",Gender:"Female",language:"en-AU",description:"Australian English Female Nicole",glang:"en",vendor:"Polly",SupportedEngines:["standard"]},{name:"Camila",Gender:"Female",language:"pt-BR",description:"Brazilian Portuguese Female Camila",glang:"pt",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Filiz",Gender:"Female",language:"tr-TR",description:"Turkish Female Filiz",glang:"tr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Jacek",Gender:"Female",language:"pl-PL",description:"Polish Male Jacek",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Justin",Gender:"Female",language:"en-US",description:"US English Male Justin",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Celine",Gender:"Female",language:"fr-FR",description:"French Female Céline",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Kendra",Gender:"Female",language:"en-US",description:"US English Female Kendra",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Ricardo",Gender:"Female",language:"pt-BR",description:"Brazilian Portuguese Male Ricardo",glang:"pt",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mads",Gender:"Female",language:"da-DK",description:"Danish Male Mads",glang:"da",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mathieu",Gender:"Female",language:"fr-FR",description:"French Male Mathieu",glang:"fr",vendor:"Polly",SupportedEngines:["standard"]},{name:"Lea",Gender:"Female",language:"fr-FR",description:"French Female Léa",glang:"fr",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Naja",Gender:"Female",language:"da-DK",description:"Danish Female Naja",glang:"da",vendor:"Polly",SupportedEngines:["standard"]},{name:"Penelope",Gender:"Female",language:"es-US",description:"US Spanish Female Penélope",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Tatyana",Gender:"Female",language:"ru-RU",description:"Russian Female Tatyana",glang:"ru",vendor:"Polly",SupportedEngines:["standard"]},{name:"Ruben",Gender:"Female",language:"nl-NL",description:"Dutch Male Ruben",glang:"nl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Mizuki",Gender:"Female",language:"ja-JP",description:"Japanese Female Mizuki",glang:"ja",vendor:"Polly",SupportedEngines:["standard"]},{name:"Takumi",Gender:"Female",language:"ja-JP",description:"Japanese Male Takumi",glang:"ja",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Conchita",Gender:"Female",language:"es-ES",description:"Castilian Spanish Female Conchita",glang:"es",vendor:"Polly",SupportedEngines:["standard"]},{name:"Carla",Gender:"Female",language:"it-IT",description:"Italian Female Carla",glang:"it",vendor:"Polly",SupportedEngines:["standard"]},{name:"Kimberly",Gender:"Female",language:"en-US",description:"US English Female Kimberly",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Jan",Gender:"Female",language:"pl-PL",description:"Polish Male Jan",glang:"pl",vendor:"Polly",SupportedEngines:["standard"]},{name:"Liv",Gender:"Female",language:"nb-NO",description:"Norwegian Female Liv",glang:"nb",vendor:"Polly",SupportedEngines:["standard"]},{name:"Joey",Gender:"Female",language:"en-US",description:"US English Male Joey",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Lupe",Gender:"Female",language:"es-US",description:"US Spanish Female Lupe",glang:"es",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Seoyeon",Gender:"Female",language:"ko-KR",description:"Korean Female Seoyeon",glang:"ko",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Emma",Gender:"Female",language:"en-GB",description:"British English Female Emma",glang:"en",vendor:"Polly",SupportedEngines:["neural","standard"]},{name:"Kevin",Gender:"Male",language:"en-US",description:"US English Male Kevin",glang:"en",vendor:"Polly",SupportedEngines:["neural"]},{name:"Ayanda",Gender:"Female",language:"en-za",glang:"en",description:"English (South African) Female Ayanda",vendor:"Polly",SupportedEngines:["neural"]},{name:"Aria",Gender:"Female",language:"en-nz",glang:"en",description:"English (New Zealand) Female Aria",vendor:"Polly",SupportedEngines:["neural"]},{name:"Gabrielle",Gender:"Female",language:"fr-ca",glang:"fr",description:"French (Canadian) Female Gabrielle",vendor:"Polly",SupportedEngines:["neural"]},{name:"Olivia",Gender:"Female",language:"en-au",glang:"en",description:"English (Australian) Female Olivia",vendor:"Polly",SupportedEngines:["neural"]}],t.cereproc=[{name:"Ceitidh",Gender:"Female",language:"gd",glang:"gd",description:"Gaelic (Scottish) Female Ceitidh",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Peig",Gender:"Female",language:"ga",glang:"ga",description:"Irish Female Peig",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Egle",Gender:"Female",language:"lt",glang:"lt",description:"Lithuanian Female",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Andrew",Gender:"Male",language:"en-sc",glang:"en",description:"English Male (Scotland)",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Stuart",Gender:"Male",language:"en-sc",glang:"en",description:"English Male (Scotland)",vendor:"Cereproc",SupportedEngines:["standard"]},{name:"Heather",Gender:"Female",language:"en-sc",glang:"en",description:"English Female (Scotland)",vendor:"Cereproc",SupportedEngines:["standard"]}],t.trinity=[{name:"Aine",Gender:"Female",language:"ga",glang:"ga",description:"Irish (Ulster) Female Áine",vendor:"Trinity",SupportedEngines:["standard"]},{name:"t_Anna",Gender:"Female",language:"ga",glang:"ga",description:"Irish (Connemara) Female Anna",vendor:"Trinity",SupportedEngines:["standard"]},{name:"Caitlin",Gender:"Female",language:"ga",glang:"ga",description:"Irish (Munster) Female Caitlin",vendor:"Trinity",SupportedEngines:["standard"]},{name:"Macdara",Gender:"Male",language:"ga",glang:"ga",description:"Irish (Connemara) Male Macdara",vendor:"Trinity",SupportedEngines:["standard"]}],t.google=[{name:"Tagalog",Gender:"Female",language:"tl-ph",glang:"en",description:"Tagalog Female",vendor:"Google",SupportedEngines:["standard"]},{name:"Bengali",Gender:"Female",language:"bn-IN",glang:"en",description:"Bengali",vendor:"Google",SupportedEngines:["standard"]},{name:"Malay",Gender:"Female",language:"ms-MY",glang:"en",description:"Malay",vendor:"Google",SupportedEngines:["standard"]},{name:"Punjabi",Gender:"Female",language:"pa-IN",glang:"en",description:"Punjabi",vendor:"Google",SupportedEngines:["standard"]},{name:"Serbian",Gender:"Female",language:"sr-RS",glang:"en",description:"Serbian",vendor:"Google",SupportedEngines:["standard"]},{name:"Telugu",Gender:"Female",language:"te-IN",glang:"en",description:"Telugu",vendor:"Google",SupportedEngines:["standard"]},{name:"Vietnamese",Gender:"Female",language:"vi-VN",glang:"en",description:"Vietnamese",vendor:"Google",SupportedEngines:["standard"]}]})),w=v.voices,b=v.polly,y=v.cereproc,C=v.trinity,T=v.google,x=function(){function e(t,n,r){a(this,e),this.voiceByName={},this.voicesByGenderLang={Male:{},Female:{}},this.voicesByLang={},this.createVoiceMap(t,n,r)}return o(e,[{key:"createVoiceMap",value:function(e,t,n){var r=[].concat(l(w),l(T));e&&r.push.apply(r,l(b)),t&&r.push.apply(r,l(y)),n&&r.push.apply(r,l(C));for(var i=0;i<r.length;i++)this.voiceByName[r[i].name]=r[i],(null==this.voicesByGenderLang[r[i].Gender]||void 0===this.voicesByGenderLang[r[i].Gender])&&(this.voicesByGenderLang[r[i].Gender]={}),(null==this.voicesByGenderLang[r[i].Gender][r[i].language]||void 0===this.voicesByGenderLang[r[i].Gender][r[i].language])&&(this.voicesByGenderLang[r[i].Gender][r[i].language.toLowerCase()]=[]),this.voicesByGenderLang[r[i].Gender][r[i].language.toLowerCase()].push(r[i]),-1!=r[i].language.indexOf("-")&&((null==this.voicesByGenderLang[r[i].Gender][r[i].glang]||void 0===this.voicesByGenderLang[r[i].Gender][r[i].glang])&&(this.voicesByGenderLang[r[i].Gender][r[i].glang.toLowerCase()]=[]),this.voicesByGenderLang[r[i].Gender][r[i].glang.toLowerCase()].push(r[i]))}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t||"Female",e=e.toLowerCase().replace("_","-");var n=null,r=this.voicesByGenderLang[t],i=r[e];if(null!=i&&void 0!==i||(t="Female"==t?"Male":"Female",null!=(i=(r=this.voicesByGenderLang[t])[e])&&void 0!==i)){for(var a=0;a<i.length;a++)if("Nuance"==i[a].vendor){n=i[a];break}return null==n&&(n=i[0]),n}}},{key:"getVoiceByName",value:function(e){return this.voiceByName[e]}},{key:"getAllVoicesSortedByName",value:function(){return this.voiceByName}},{key:"getVendor",value:function(e){try{return[].concat(l(w),l(b),l(y),l(C)).find((function(t){return t.name===e})).vendor}catch(e){}}}]),e}();String.prototype.trimTH=function(){try{return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}catch(e){return null}},String.prototype.trimStartTH=function(){try{return this.replace(/^[\s\xA0]+/,"")}catch(e){return null}},String.prototype.trimEndTH=function(){try{return this.replace(/[\s\xA0]+$/,"")}catch(e){return null}},String.prototype.equalsTH=function(e){try{if(this.length!=e.length)return!1;for(var t=0;t<this.length;t+=1)if(this.charAt(t)!=e.charAt(t))return!1;return!0}catch(e){return null}},String.prototype.trimSpaceTH=function(){try{return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")}catch(e){return null}},String.prototype.trimSpaceStartTH=function(){try{return this.replace(/^[\t\r\n ]+/,"")}catch(e){return null}},String.prototype.trimSpaceEndTH=function(){try{return this.replace(/[\t\r\n ]+$/,"")}catch(e){return null}};var N=function(){function e(t,n){a(this,e);try{var r,i;this.currentVoices=[],this.speechServer=null,this.speechServerUser=null,this.rootLocation=null,this.audioElem=null,this.audioPlaybackTimerID=null,this.currentHighlightWord=-1,this.playbackTimeArray=null,this.session=0,this.boundAudioPlayBackTimer=null,this.speechStop=!1,this.paused=!1,this.eventBus=d,this.speechSettings=t,this.voicePromise=null,this.voicesAvailable=null,this.timeout=null,this.speechServerVoices=n,this.isiOS154=!!(null!==(r=navigator)&&void 0!==r&&r.maxTouchPoints&&null!==(i=navigator)&&void 0!==i&&i.userAgent.includes("Safari")&&15.4<=parseFloat(navigator.userAgent.split("Version/")[1])&&15.5>parseFloat(navigator.userAgent.split("Version/")[1])),this.charMap={8217:"'",96:"'",8482:" ",8212:" ",38:"&amp;"},this.setVoices()}catch(e){console.log("Request failed: SpeechServer - constructor: ",e)}}return o(e,[{key:"initialise",value:function(){try{return this.speechServer=this.speechSettings.getSpeechServer(),this.speechServerUser=this.speechSettings.getUser(),this.getVoices()}catch(e){console.log("Request failed: SpeechServer - initialise: ",e),Promise.reject(e)}}},{key:"refreshVoices",value:function(){return this.getVoices()}},{key:"status",value:function(e){return 200<=e.status&&300>e.status?Promise.resolve(e):Promise.reject(new Error(e.statusText))}},{key:"json",value:function(e){return e.json()}},{key:"text",value:function(e){return e.text()}},{key:"blob",value:function(e){return e.blob()}},{key:"buffer",value:function(e){return e.arrayBuffer()}},{key:"getVoices",value:function(){return Promise.resolve(this.currentVoices)}},{key:"speakSelection",value:function(){var e=i((function*(e,t,n){var r=this;null==n&&(n=!0),this.speechStop=!1,this.paused=!1,null===this.audioElem&&(this.audioElem=new Audio,this.audioElem.type=this.isiOS154?"audio/wav":"audio/mpeg",this.audioElem.autoplay=!1),this.session=t,this.currentHighlightWord=0;for(var i="https://"+this.speechServer+"/Generator/voice/"+this.speechSettings.currentVoice.name+"?",a=`<?xml version="1.0"?>\n                                <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                                xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                                http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                                xml:lang="${this.speechSettings.currentVoice.language}"> `,s="",o=0,l=0;l<e.length;l++)if(e[l],-1==e[l].search(/[£$]/)||isNaN(parseInt(e[l].replace(/[£$,]/g,"")))||(e[l]=`<say-as interpret-as="currency">${e[l].trim()}</say-as>`),n)if("Serena"==this.speechSettings.currentVoice.name&&-1!=e[l].indexOf("phone")&&(e[l]=e[l].replace(/[()]/g,"")),/(\x3cmark\x20name\x3d\x22(\d)+\x22\x2f\x3e)/.test(e[l])){e[l].match(/(\x3cmark\x20name\x3d\x22(\d)+\x22\x2f\x3e)/g).forEach((function(t){e[l]=e[l].replace(t,`<mark name="${o}"/>`),o++})),s+=e[l]}else s+=`<mark name="${o}"/> ${this.encodeChars(e[l].trim())} `,o++;else s+=this.encodeChars(e[l]);"ja-jp"==this.speechSettings.currentVoice.language&&(s+="。"),s=(s=(s=(s+=`<mark name="${o}"/> </speak>`).replace(/(\x3cbookmark\x20mark\x3d\x22(\d)+\x22\x2f\x3e)/g,"")).replace(/[\s\xA0]+/g," ")).replace(/_/g," ");var h=(new S).hex_md5(s);yield this.getCachedSpeech(h,t).catch((function(){r.eventBus.publish("onthAPIWord",["start"],r.speechSettings.speechType);var e=`text=${a}${encodeURIComponent(s)}&username=${r.speechServerUser}&speed=${r.speechSettings.getUserSettings().speechoptions.speed}&requestType=ssml`;r.speechSettings.isCacheEnabled()&&(e+=`&destFilename=${h}&destFolder=${r.getCacheLocation()}`),r.speechSettings.isNeuralEnabled()&&r.speechSettings.currentVoice.SupportedEngines.includes("neural")&&(e+="&awsPollyEngine=neural");var n=r,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4!=this.readyState||200!=this.status&&206!=this.status){if(4==this.readyState&&400==this.status){i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(this.response)));n.onResponse(i,null,t)}}else{var e=o.getResponseHeader("TH-TIME"),r=this.response.slice(0,e),i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(r))),a=new Blob([new Uint8Array(this.response.slice(e))],{type:n.isiOS154?"audio/wav":"audio/mpeg"});n.onResponse(i,a,t)}},o.open("POST",i,!0),o.responseType="arraybuffer",o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF8"),o.send(e),d.publish("analytics",{event:"Speech",action:"Speech",voice:r.speechSettings.currentVoice.name})}))}));return function(){return e.apply(this,arguments)}}()},{key:"getCacheLocation",value:function(){var e=this.speechServerUser,t=this.speechSettings.currentVoice.name,n=this.speechSettings.getUserSettings().speechoptions.speed,r=this.speechSettings.getCustId(),i=this.speechSettings.getBookId(),a=this.speechSettings.getPageId();return this.speechSettings.isNeuralEnabled()&&this.speechSettings.currentVoice.SupportedEngines.includes("neural")&&(t+="Neural"),`${e}/${r}/${i}/${a}/${t}${n}`}},{key:"getCachedSpeech",value:function(){var e=i((function*(e,t){if(!this.speechSettings.isCacheEnabled())throw new Error("cache disabled");var n=`https://${this.speechSettings.getCacheServer()}/SpeechCache/${this.getCacheLocation()}/${e}.mp3`,r=yield fetch(n),i=yield r.arrayBuffer(),a=r.headers.get("TH-TIME"),s=i.slice(0,a),o=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(s))),l=new Blob([new Uint8Array(i.slice(a))],{type:this.isiOS154?"audio/wav":"audio/mpeg"});d.publish("analytics",{event:"Speech",action:"cachedSpeech",voice:this.speechSettings.currentVoice.name}),this.onResponse(o,l,t)}));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){try{if(clearTimeout(this.timeout),null===this.audioElem||null===this.playbackTimeArray)return;this.speechStop=!0,this.paused=!1,this.playbackTimeArray.length=0;try{this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src=""}catch(e){}}catch(e){console.log("Request failed: SpeechServer - stop: ",e)}}},{key:"pause",value:function(){try{if(null===this.audioElem)return;if(0===this.audioElem.currentTime)return;if(this.paused)return this.audioElem.play(),this.paused=!1,void d.publish("speechPaused",!1,this.speechSettings.speechType);this.audioElem.pause(),this.paused=!0,d.publish("speechPaused",!0,this.speechSettings.speechType)}catch(e){console.log("Request failed: SpeechServer - pause: ",e)}}},{key:"audioPlaybackTimer",value:function(){var e=this;try{if(null===this.playbackTimeArray)return;if(this.audioElem&&this.audioElem.ended)return this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src="",this.length=0,this.eventBus.publish("onthAPIWordonthAPIStop",this.speechSettings.speechType),void this.eventBus.publish("speechCompleted",this.speechSettings.speechType);if(0<this.playbackTimeArray.length){if(this.audioElem&&this.playbackTimeArray[this.currentHighlightWord]<this.audioElem.currentTime){var t=[];t.push(this.currentHighlightWord),this.eventBus.publish("onthAPIWord",t,this.speechSettings.speechType),this.currentHighlightWord++}if(this.currentHighlightWord==this.playbackTimeArray.length-1&&this.playbackTimeArray[this.currentHighlightWord]==this.playbackTimeArray[this.currentHighlightWord-1])return;if(this.audioElem&&this.audioElem.currentTime>this.audioElem.duration&&this.audioElem.currentTime>this.playbackTimeArray[this.playbackTimeArray.length-1]){clearTimeout(this.timeout),this.eventBus.publish("speechCompleted",this.speechSettings.speechType),this.eventBus.publish("onthAPIStop",this.speechSettings.speechType);try{this.audioElem.pause()}catch(e){}return}}this.timeout=setTimeout((function(){e.audioPlaybackTimer()}),50)}catch(e){}}},{key:"setVoices",value:function(){this.currentVoices=this.speechServerVoices.getAllVoicesSortedByName(),null==this.currentVoices[this.speechSettings.get_Voice()]&&(null==this.currentVoices.Ava?this.speechSettings.set_Voice({name:"Ava"}):this.speechSettings.set_Voice(this.currentVoices.Ava))}},{key:"onResponse",value:function(e,t,n){var r=this;if(n==this.session){if(e.error)return console.log(e.error),this.eventBus.publish("speechCompleted",this.speechSettings.speechType,e.error),void this.eventBus.publish("onthAPIStop",this.speechSettings.speechType);this.playbackTimeArray=[];for(var i=0,a=0;a<e.bookmarks.length;a++)this.playbackTimeArray[i]=e.bookmarks[a].time/1e3,0<i&&this.playbackTimeArray[i]<=this.playbackTimeArray[i-1]&&(this.playbackTimeArray[i]=this.playbackTimeArray[i-1]+.01),++i;if(.1>this.playbackTimeArray[this.playbackTimeArray.length-1]&&(this.playbackTimeArray.length=0),!this.speechStop){d.publish("speechRendered",this.speechSettings.speechType),window.URL=window.URL||window.webkitURL,this.audioElem.src=window.URL.createObjectURL(t);var s=this.audioElem.play();void 0!==s&&s.then((function(){r.audioPlaybackTimer()})).catch((function(){})),d.publish("analytics",{event:"Speech",action:"bandwidth",count:t.size/1024})}}}},{key:"encodeChars",value:function(e){try{var t="",n="";if(-1<e.search("<phoneme")||-1<e.search("<sub")||-1<e.search("<say-as")||-1<e.search("<emphasis")||-1<e.search("<break")||-1<e.search("<prosody"))return e;for(var r=0;r<e.length;r++)n=e.charCodeAt(r).toString(),t+=void 0===this.charMap[n]?e.charAt(r):this.charMap[n];return t}catch(e){}}}]),e}(),_=function(){function e(t){a(this,e),this.user=t.user,this.speechType=t.speechType,this.custId=t.custId||null,this.bookId=t.bookId||null,this.pageId=t.pageId||null,this.enableCache=t.enableCache||!1,this.continueOnSelect=t.continueOnSelect||!1,this.enablePollyVoices=t.enablePollyVoices||!1,this.enableNeural=t.enableNeural||!1,this.enableCereprocVoices=t.enableCereprocVoices||!1,this.enableTrinityVoices=t.enableTrinityVoices||!1,this.speechServerDns=t.speechServer||"speech.speechstream.net",this.cacheDns=t.cacheDns||"cache.speechstream.net",this.locale=t.locale||"en-US",this.useElementLangTags=t.useElementLangTags||!1,this.useHTMLLangTag=t.useHTMLLangTag||!1,this.currentVoice={name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",vendor:"Nuance"},this.userSettings={speechoptions:{voice:this.currentVoice,continousreading:!0,speed:50},language:{language:"en_US",services:"en_US"}},this.langVoiceMapping=t.langVoiceMapping}return o(e,[{key:"get_Voice",value:function(){try{return this.currentVoice}catch(e){console.log("SpeechSettings - get_Voice: ",e)}}},{key:"set_Voice",value:function(e){try{this.currentVoice=e,this.userSettings.speechoptions.voice=e}catch(e){console.log("SpeechSettings - set_Voice: ",e)}}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t.toLowerCase().replace("_","-");var n=null;if(null!=this.langVoiceMapping&&this.langVoiceMapping[t])n=this.voices.getVoiceByName(this.langVoiceMapping[t]);else{for(var r=this.voices.getVoiceByGenderAndLang(e,t),i=0;i<r.length;i++)if("Nuance"==r[i].vendor){n=r[i];break}null==n&&(n=r[0])}return n}},{key:"addVoices",value:function(){}},{key:"setVoiceByGenderAndLang",value:function(e,t){var n="Female";e&&(n="Male");var r=this.getVoiceByGenderAndLang(n,t);this.currentVoice=r,this.userSettings.speechoptions.voice=r}},{key:"set_Speed",value:function(e){try{this.userSettings.speechoptions.speed=e}catch(e){console.log("SpeechSettings - set_Speed: ",e)}}},{key:"getVoices",value:function(){try{return""}catch(e){console.log("SpeechSettings - getVoices: ",e)}}},{key:"getLocale",value:function(){return this.locale}},{key:"getUserSettings",value:function(){return this.userSettings}},{key:"getUser",value:function(){return this.user}},{key:"getPageId",value:function(){return this.pageId}},{key:"setPageId",value:function(e){this.pageId=this.filterId(e)}},{key:"getCustId",value:function(){return this.custId}},{key:"setCustId",value:function(e){this.custId=e}},{key:"getBookId",value:function(){return this.bookId}},{key:"setBookId",value:function(e){this.bookId=this.filterId(e)}},{key:"isCacheEnabled",value:function(){return this.enableCache}},{key:"isNeuralEnabled",value:function(){return this.enableNeural}},{key:"enabledNeural",value:function(e){this.enableNeural=e}},{key:"getSpeechServer",value:function(){return this.speechServerDns}},{key:"getCacheServer",value:function(){return this.cacheDns}},{key:"setUseElementLangTags",value:function(e){this.useElementLangTags=e}},{key:"getUseElementLangTags",value:function(){return this.useElementLangTags}},{key:"getUseHTMLLangTag",value:function(){return this.useHTMLLangTag}},{key:"filterId",value:function(e){return 100<e.length?(new S).hex_md5(e):e}}]),e}(),E=function(){function e(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(null!=r.pronunciations)for(var i in r.pronunciations)if(r.pronunciations.hasOwnProperty(i)){var a=n(i,r.pronunciations[i]);null!=a&&(delete r.pronunciations[i],null==r.wildcards&&(r.wildcards=[]),r.wildcards.push(a))}}}function t(e){var t=e.indexOf("&#");return-1<t&&(e=function(e){return e.replace(/&#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),-1<(t=e.indexOf("\\u0026#"))&&(e=function(e){return e.replace(/\\u0026#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),e}function n(e,t){if(2<e.length&&"/"==e.charAt(0)&&"/"==e.charAt(e.length-1)){var n=e.substr(1,e.length-2);try{var r=new RegExp(n);if(null!=r)return{say:r,like:t}}catch(e){}}return null}function r(e,t){if(null==t)return null;var n=e;if(null!=t[n])return t[n];var r=n.toLowerCase();return r!=n&&null!=t[r]?t[r]:(n=(n=(n=e.replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(l,""))==e?null:null==t[n]?(r=n.toLowerCase())!=n&&null!=t[r]?t[r]:null:t[n]}function a(e,t){if(null==t)return null;for(var n=0;n<t.length;n++){var r=t[n],i=e.replace(r.say,r.like);if(i!=e)return i}return null}function s(e,t){var n=e.split(/\s+/);if(n.length==t)return n;if(n.length>t){var r=n.length-(t-1),i=[],a=n.splice(0,r).join(" ");return i.push(a),i=i.concat(n)}if(n.length<t){var s;for(s=n.length;s<t;s++)n.push("");return n}return null}var o=this,l=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,h=null,u=!1,g=!1,c=null,m=null,p=null,f=null,S=null,v=null,w=null,b=null,y=null,C=null,T=null;this.setVoice=function(e){var t;(y=null,C=null,T=null,v=null,w=null,b=null,"string"==typeof e&&(S=e,null!=c))&&(null!=(t=c.items[S])&&(y=t.pronunciations,C=t.multiPronunciations,T=t.wildcards),function(e){if("string"==typeof e)for(var t,n=0;n<x.length;n++)if(t=x[n],-1<e.indexOf(t))return!0;return!1}(S)&&null!=(t=c.items["English Voices"])&&(v=t.pronunciations,w=t.multiPronunciations,b=t.wildcards))},this.getVoice=function(){return S},this.loadData=function(e,t,n){if(h=e,d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file"}),void 0!==h&&void 0!==t&&void 0!==n){var r="https://"+h+"/global/"+t+"/"+n+".json";o.send(r,o.fileLoaded,o.loadFailed)}else thLog("Global pronunciation failed to load as requested with invalid data.")},this.send=function(){var e=i((function*(e,t,n){try{var r=yield fetch(e);t(yield r.text())}catch(e){n(e)}}));return function(){return e.apply(this,arguments)}}(),this.loadFailed=function(){d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file Failed"}),g=!0,u=!1},this.fileLoaded=function(n){g=!0,d.publish("analytics",{event:"Pronunciation",action:"retrieve Global file success"}),n=t(n);var r=JSON.parse(n);if(null!=r&&null!=r.items&&"object"==typeof r.items){e((c=r).items);var i=c.items.all;null!=i&&(m=i.pronunciations,p=i.multiPronunciations,f=i.wildcards),o.setVoice(S),u=!0}else thLog("Global pronunciation failed to load as no valid data returned."),u=!1},this.checkWords=function(e,t){if(!(u&&1<=e.length))return null;var n=null;null!=t&&t!=S&&(n=S,o.setVoice(t));try{var i,l,h=null,d=!1;if(1<e.length&&(l=(l=(l=(i=e[0].trimTH()).replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(/^[,.?!;:\x27\x22\xa3\x24\u20ac]+/,""),(null!=C&&(-1<C.indexOf(i)||-1<C.indexOf(l))||null!=w&&(-1<w.indexOf(i)||-1<w.indexOf(l))||null!=p&&(-1<p.indexOf(i)||-1<p.indexOf(l)))&&(d=!0)),d){if(3<=e.length&&(null!=(h=r(i=e[0].trimTH()+" "+e[1].trimTH()+" "+e[2].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m))))return s(h,3);if(2<=e.length&&(null!=(h=r(i=e[0].trimTH()+" "+e[1].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m))))return s(h,2)}if(1<=e.length){if(null!=(h=r(i=e[0].trimTH(),y))||null!=(h=r(i,v))||null!=(h=r(i,m)))return[h];if(null!=(h=a(i,T))||null!=(h=a(i,b))||null!=(h=a(i,f)))return[h]}}catch(e){thLogE(e)}return null!=n&&o.setVoice(n),null},this.isEnabled=function(){return u},this.isLoaded=function(){return g};var x=["Allison","Ava","Daniel","Emily","Fiona","Jill","Karen","Lee","Moira","Samantha","Sangeeta","Serena","Tessa","Tom"]},A=function(){function e(){a(this,e),this.rw_qouteRegex="\\x82\\x91\\x92",this.rw_dqouteRegex="\\x93\\x94",this.rw_trimRegex=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,this.rw_internalSpaceRegex=/[\n\r\t ]{1,}/g,this.pronsArray=[],this.pronunciations=new f,this.pronunciations.prons.lang.MultiwordPron=[],this.gpData={}}return o(e,[{key:"setGlobalPronunciations",value:function(e){this.gpData=e}},{key:"add",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"delete",value:function(e){delete this.pronunciations.prons.lang.all[e]}},{key:"update",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"checkWords",value:function(e,t,n){var r=n.split(" "),i=!1;"censored"==this.pronunciations.prons.lang.all[n]&&(i=!0);for(var a="",s=t;s<t+r.length&&s<e.length;s++)a+=e[s].trim()+" ";var o={start:-1,end:-1};return a=a.trim(),i&&(a=a.toLowerCase(),n=n.toLowerCase()),a==n?o={start:t,end:t+r.length}:(a=a.replace(this.rw_internalSpaceRegex," "))==n?o={start:t,end:t+r.length}:(a=a.replace(this.rw_trimRegex,""))==n?o={start:t,end:t+r.length}:o}},{key:"fixWord",value:function(e){return e=(e=e.replace(this.rw_qouteRegex,"'")).replace(this.rw_dqouteRegex,'"')}},{key:"checkPronunciation",value:function(e,t){this.pronsArray;var n,r=!1,i=e.length;for(var a in this.pronunciations.prons.lang.all)for(var s=this.fixWord(a),o=0;o<e.length;o++)if(-1!=this.checkWords(e,o,s).start){var l=a.split(" ");r=!0;for(var h=this.fixWord(this.pronunciations.prons.lang.all[a]).split(" "),u=0;u<l.length;u++)if(1==h.length&&1==l.length)e[o+u]=this.pronunciations.prons.lang.all[a];else if(1==h.length&&1<l.length)e[o+u]=0==u?this.pronunciations.prons.lang.all[a]:" ";else if(1==l.length&&1<h.length){e[o+u]="";for(var d=0;d<h.length;d++)e[o+u]+=h[d]+" "}else{var g="";h[u]&&(g=u+1==l.length&&h.length>u+1?h.slice(u).toString():h[u]),e[o+u]=g}}for(n=0;n<i;n++)if(void 0!==this.gpData.isEnabled&&this.gpData.isEnabled()){var c;if(null!=(c=this.gpData.checkWords(e.slice(n,n+3),t))){3==c.length?(e[n+2]=c[2]+" ",e[n+1]=c[1]+" ",e[n]=c[0]+" ",r=!0):2==c.length?(e[n+1]=c[1]+" ",e[n]=c[0]+" ",r=!0):1==c.length&&(e[n]=c[0]+" ",r=!0);continue}}return r}},{key:"rw_checkPronunciationFromString",value:function(e,t){var n="";if(this.checkPronunciation(wordList,t)){var r,i=wordList.length;for(r=0;r<i;r++)n+=wordList[r],r<i-1&&(n+=" ");return n}return e}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.pronunciations.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.pronunciations.prons.lang[e],r=this.pronunciations.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var s=0;s<t.length;s++)t[s]=t[s].replace(a,i[a])}}]),e}(),R=function(){function e(t){a(this,e),this.speechEngines=[],this.initialised=!1,this.voices=[],this.controller=null,this.voiceToEngineMap=[],this.speechSettings=null,this.globalProns=!1,this.Pronunciation=null,this.prons=[],this.speechServerVoices=null,this.pronunciations=new A,this.initialise(t)}return o(e,[{key:"initialise",value:function(e){this.speechSettings=new _(e);try{e.globalPronunciations&&void 0!==e.pronunciationDns&&void 0!==e.user&&void 0!==e.custId&&(this.globalProns=new E(this),this.globalProns.setVoice(this.speechSettings.currentVoice.name),this.globalProns.loadData(e.pronunciationDns,e.user,e.custId),this.pronunciations.setGlobalPronunciations(this.globalProns))}catch(e){this.globalProns=!1}try{return this.initialised?Promise.resolve():(this.speechServerVoices=new x(e.enablePollyVoices,e.enableCereprocVoices,e.enableTrinityVoices),this.speechEngines.speechserver=new N(this.speechSettings,this.speechServerVoices),this.initialised=!0,this.initialiseEnginesVoices())}catch(e){console.log("SpeechManager - intialise: ",e)}}},{key:"initialiseEnginesVoices",value:function(){var e=[];for(var t in this.speechEngines)this.speechEngines.hasOwnProperty(t)&&e.push(this.speechEngines[t].initialise());return Promise.all(e)}},{key:"addPronunciation",value:function(e,t){this.pronunciations.add(e,t)}},{key:"updatePronunciation",value:function(e,t){this.pronunciations.update(e,t)}},{key:"deletePronunciation",value:function(e,t){this.pronunciations.delete(e,t)}},{key:"getVoices",value:function(e){var t=this;try{if(!this.initialised)return Promise.resolve(null);if(null==e&&(e=!1),e&&(this.voices=[],this.voiceToEngineMap=[]),0<Object.keys(this.voices).length)return Promise.resolve(this.voices);var n=[],r=function(e){if(t.speechEngines.hasOwnProperty(e)){var r=t.speechEngines[e].getVoices().then((function(n){for(var r in n)n.hasOwnProperty(r)&&(t.voices[r]=n[r],t.voiceToEngineMap[r]=t.speechEngines[e])}));n.push(r)}};for(var i in this.speechEngines)r(i);return Promise.all(n).then((function(){return t.voices}))}catch(e){return console.log("SpeechManager - getVoices: ",e),Promise.reject(e)}}},{key:"speakSelection",value:function(){var e=i((function*(e,t,n,r,a,s){var o=this;try{d.publish("WordsToSpeak",s,this.speechSettings.speechType);var l=Promise.resolve();0==Object.keys(this.voices).length&&(l=this.getVoices()),(null!=a||void 0!==a)&&(!(a="Female")&&(a="Male")),l.then(i((function*(){var i=o.voiceToEngineMap[o.speechSettings.get_Voice().name];if(null==r||void 0===r||void 0===o.speechServerVoices.getVoiceByGenderAndLang(r,a))null==o.voiceToEngineMap[o.speechSettings.get_Voice().name]?(i=o.voiceToEngineMap.Ava,o.speechSettings.set_Voice("Ava")):i=o.voiceToEngineMap[o.speechSettings.get_Voice().name],o.pronunciations.checkPronunciation(e,o.speechSettings.get_Voice().name),yield i.speakSelection(e,t,n);else{var s=o.speechSettings.get_Voice(),l=s.language.split("-"),h=r.split("-");o.speechSettings.getUseElementLangTags()&&null!=o.speechSettings.langVoiceMapping&&o.speechSettings.langVoiceMapping[r]?(o.speechSettings.set_Voice(o.speechServerVoices.getVoiceByName(o.speechSettings.langVoiceMapping[r])),i=o.voiceToEngineMap[o.speechSettings.langVoiceMapping[r]],o.pronunciations.checkPronunciation(e,o.speechSettings.get_Voice().name)):(o.speechSettings.getUseElementLangTags()||o.speechSettings.getUseHTMLLangTag())&&l[0]&&h[0]&&l[0]!=h[0]?(o.speechSettings.set_Voice(o.speechServerVoices.getVoiceByGenderAndLang(r,a)),i=o.voiceToEngineMap[o.speechServerVoices.getVoiceByGenderAndLang(r,a).name],o.pronunciations.checkPronunciation(e,o.speechSettings.get_Voice().name)):(i=o.voiceToEngineMap[s.name],o.pronunciations.checkPronunciation(e,s.name)),yield i.speakSelection(e,t,n),o.speechSettings.set_Voice(s)}})))}catch(e){console.log("SpeechManager - speakSelection: ",e)}}));return function(){return e.apply(this,arguments)}}()},{key:"speakSelectionWithVoice",value:function(){var e=i((function*(e,t,n,r,a){var s=this;d.publish("WordsToSpeak",a,this.speechSettings.speechType);var o=Promise.resolve();0==Object.keys(this.voices).length&&(o=this.getVoices()),o.then(i((function*(){var i=s.speechSettings.get_Voice(),a=s.voiceToEngineMap[r],o=s.speechServerVoices.getVoiceByName(r);s.speechSettings.set_Voice(o),null!=a&&(s.pronunciations.checkPronunciation(e,r),yield a.speakSelection(e,t,n)),s.speechSettings.set_Voice(i)})))}));return function(){return e.apply(this,arguments)}}()},{key:"setVoiceByName",value:function(e){var t=this.speechServerVoices.getVoiceByName(e);(null!=t||void 0!==t)&&this.speechSettings.set_Voice(t)}},{key:"setVoiceByGenderAndLang",value:function(e,t){(null!=e||void 0!==e)&&(!(e="Female")&&(e="Male"));var n=this.speechServerVoices.getVoiceByGenderAndLang(t,e);(null!=n||void 0!==n)&&this.speechSettings.set_Voice(n)}},{key:"setSpeed",value:function(e){this.speechSettings.set_Speed(e)}},{key:"stop",value:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].speechoptions.voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.stop()}catch(e){console.log("SpeechManager - stop: ",e)}}},{key:"pause",value:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.pause()}catch(t){console.log("SpeechManager - pause: ",t)}}},{key:"setPageId",value:function(e){this.speechSettings.setPageId(e)}},{key:"setBookId",value:function(e){this.speechSettings.setBookId(e)}},{key:"setCustId",value:function(e){this.speechSettings.setCustId(e)}},{key:"enableNeural",value:function(e){this.speechSettings.enabledNeural(e)}},{key:"getVendor",value:function(e){return this.speechServerVoices.getVendor(e)}}]),e}(),k=function(){function e(t,n,r,i){a(this,e),this.HtmlParser=n,this.useElementLangTags=null==typeof t.useElementLangTag||0!=t.useElementLangTag,this.useHTMLLangTag=null==typeof t.usePageLangTag||0!=t.usePageLangTag,this.defaultConfig=t;var s={user:t.username,speechServer:t.dns,cacheDns:t.cacheDns,enableCache:t.enableCache,custId:t.custId,bookId:t.bookId,pageId:t.pageId,enablePollyVoices:t.enablePollyVoices,enableTrinityVoices:t.enableTrinityVoices,enableNeural:t.enableNeural,enableCereprocVoices:t.enableCereprocVoices,globalPronunciations:t.globalPronunciations,pronunciationDns:t.pronunciationDns,langVoiceMapping:r,useElementLangTags:this.useElementLangTags,useHTMLLangTag:this.useHTMLLangTag,continueOnSelect:t.continueOnSelect,speechType:i};this.speechManager=new R(s),this.speechType=i,this.clickToSpeakEnabled=t.clickToSpeakEnabled||!1,this.hoverSpeakEnabled=t.hoverSpeakEnabled||!1,this.continuousSpeechEnabled=t.continuousSpeechEnabled||!1,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.speechEvents(),this.withOutHighlighting=!1,this.ignoreToolbarId=t.ignoreToolbarId,this.voice=null,this.firstHoverSpeak=!1,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.wordCount=0,this.speakFromSelect=!1}return o(e,[{key:"setContinuousSpeechEnabled",value:function(e){this.continuousSpeechEnabled=e,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled}},{key:"speechEvents",value:function(){var e=this;d.subscribe("onthAPIWord",(function(t,n){e.speechType===n&&e.onWord(t)})),d.subscribe("onthAPIStop",(function(t){e.speechType===t&&(e._speechEnded(),e.playNextSentence())})),d.subscribe("onthAPIWordonthAPIStop",(function(t){e.speechType===t&&(e._speechEnded(),e.playNextSentence())})),d.subscribe("setTempVoice",(function(t){e.setTranslateVoice(t)})),d.subscribe("setPageID",(function(t){e.setPageId(t)})),d.subscribe("setBookID",(function(t){e.setBookId(t)})),d.subscribe("resetPageID",(function(){e.resetPageId()})),d.subscribe("resetBookID",(function(){e.resetBookId()}))}},{key:"hoverSpeakOnOff",value:function(){this.stop(),this.hoverSpeakEnabled=!this.hoverSpeakEnabled,this.HtmlParser.hoverSpeakEnabled(this.hoverSpeakEnabled),this.hoverSpeakEnabled&&!this.firstHoverSpeak&&this.isSafari&&(this.speakWithOutHighlight([""]),this.firstHoverSpeak=!0,this.stop()),this.hoverSpeakEnabled&&d.publish("analytics",{event:"Speech",action:"hoverSpeakOn"})}},{key:"clickToSpeakOnOff",value:function(){this.stop(),this.clickToSpeakEnabled=!this.clickToSpeakEnabled,this.HtmlParser.clickToSpeakEnabled(this.clickToSpeakEnabled),this.clickToSpeakEnabled&&d.publish("analytics",{event:"Speech",action:"clickToSpeakOn"})}},{key:"speakWithOutHighlight",value:function(e,t){this.stop(),this.withOutHighlighting=!0,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1;var n=(new S).hex_md5(e.toString())+Math.random();this.speechManager.speakSelection(e,n,!0,t),d.publish("speechStarted",this.speechType)}},{key:"play",value:function(e){this.speakFromSelect=this.HtmlParser.hasSelection()||!1,this.wordCount=0,e&&(this.voice=e),d.publish("speechStarted",this.speechType);var t=this.HtmlParser.hiliteSelection();if(t&&""!=t){var n=t.textToRead,r=t.textToRead;t.isMath&&(r=t.textToDisplay,d.publish("analytics",{event:"SpeechUtils",action:"mathml"}));var i=(new S).hex_md5(n.toString())+Math.random();if(this.wordCount=n.length||0,this.voice)this.speechManager.speakSelectionWithVoice(n,i,!0,this.voice,r);else{var a=null;this.useHTMLLangTag&&(a=this.HtmlParser.getDocumentLanguage()),this.useElementLangTags&&(a=this.HtmlParser.getLanguageForSentence()),this.speechManager.speakSelection(n,i,!0,a,r)}}else d.publish("onthAPIWordonthAPIStop",this.speechType),d.publish("speechCompleted",this.speechType)}},{key:"setTranslateVoice",value:function(e){this.voice=e}},{key:"playNextSentence",value:function(){var e,t=null;(this.wordCount=0,this.speakFromSelect&&!this.speechManager.speechSettings.continueOnSelect&&this.HtmlParser.speechObject.m_contents.length-1===this.HtmlParser.speechObject.sentenceNo)||(t=this.HtmlParser.hiliteNextSentence(this.continuousSpeechEnabled),this.wordCount=(null===(e=t)||void 0===e?void 0:e.length)||0);if(null!=t){var n=null;this.useHTMLLangTag&&(n=this.HtmlParser.getDocumentLanguage()),this.useElementLangTags&&(n=this.HtmlParser.getLanguageForSentence());var r=(new S).hex_md5(t.toString())+Math.random();this.voice?this.speechManager.speakSelectionWithVoice(t,r,!0,this.voice):this.speechManager.speakSelection(t,r,!0,n),d.publish("analytics",{event:"Speech",action:"Continuous Sentence"}),d.publish("speechStarted",this.speechType)}else d.publish("pageCompleted",this.speechType),d.publish("speechStopped",this.speechType),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled,this.speakFromSelect=!1}},{key:"playPreviousSentence",value:function(){this.wordCount=0;var e=this.HtmlParser.hilitePreviousSentence();if(this.wordCount=(null==e?void 0:e.length)||0,null!=e){var t=null;this.useHTMLLangTag&&(t=this.HtmlParser.getDocumentLanguage()),this.useElementLangTags&&(t=this.HtmlParser.getLanguageForSentence());var n=(new S).hex_md5(e.toString())+Math.random();this.voice?this.speechManager.speakSelectionWithVoice(e,n,!0,this.voice):this.speechManager.speakSelection(e,n,!0,t),d.publish("analytics",{event:"Speech",action:"Continuous Sentence"}),d.publish("speechStarted",this.speechType)}else d.publish("pageCompleted",this.speechType),d.publish("speechStopped",this.speechType),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"speakById",value:function(e,t){this.wordCount=0,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1,null!=t&&(this.voice=t);var n=this.HtmlParser.highlightElementById(e);this.wordCount=n.length||0;var r=null;if(this.useHTMLLangTag&&(r=this.HtmlParser.getDocumentLanguage()),this.useElementLangTags&&(r=this.HtmlParser.getLanguageForSentence()),null!=n){var i=(new S).hex_md5(n.toString())+Math.random();t?(this.speechManager.speakSelectionWithVoice(n,i,!0,t),d.publish("speechStarted",this.speechType)):(this.speechManager.speakSelection(n,i,!0,r),d.publish("speechStarted",this.speechType))}}},{key:"speakElement",value:function(e,t,n){this.wordCount=0,t||(this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1),null!=n&&(this.voice=n);var r=this.HtmlParser.highlightElementById(e);this.wordCount=r.length||0;var i=null;if(this.useHTMLLangTag&&(i=this.HtmlParser.getDocumentLanguage()),this.useElementLangTags&&(i=this.HtmlParser.getLanguageForSentence()),null!=r){var a=(new S).hex_md5(r.toString())+Math.random();n?(this.speechManager.speakSelectionWithVoice(r,a,!0,n),d.publish("speechStarted",this.speechType)):(this.speechManager.speakSelection(r,a,!0,i),d.publish("speechStarted",this.speechType))}}},{key:"onWord",value:function(e){this.withOutHighlighting||"start"==e[0]||this.HtmlParser.hiliteWord(e[0])}},{key:"stop",value:function(){this.withOutHighlighting=!1,this.speechManager.stop(),this.HtmlParser.stop(),d.publish("speechStopped",this.speechType),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"_speechEnded",value:function(){this.withOutHighlighting=!1,this.HtmlParser.stop()}},{key:"pause",value:function(){this.speechManager.pause()}},{key:"forward",value:function(){this.stop(),this.speakFromSelect=!1,this.playNextSentence()}},{key:"rewind",value:function(){this.stop(),this.speakFromSelect=!1,this.playPreviousSentence()}},{key:"setVoice",value:function(e){this.speechManager.setVoiceByName(e)}},{key:"getVendor",value:function(e){return this.speechManager.getVendor(e)}},{key:"enableNeural",value:function(e){this.speechManager.enableNeural(e)}},{key:"setCustId",value:function(e){this.speechManager.setCustId(e)}},{key:"setBookId",value:function(e){this.speechManager.setBookId(e)}},{key:"setPageId",value:function(e){this.speechManager.setPageId(e)}},{key:"resetBookId",value:function(){this.speechManager.setBookId(this.defaultConfig.bookId)}},{key:"resetPageId",value:function(){this.speechManager.setPageId(this.defaultConfig.pageId)}},{key:"setVoiceByGenderAndLanguage",value:function(e,t){this.speechManager.setVoiceByGenderAndLang(e,t)}},{key:"setVoiceSpeed",value:function(e){this.speechManager.setSpeed(e)}},{key:"addPronunciations",value:function(e,t){this.speechManager.addPronunciation(e,t)}},{key:"updatePronunciations",value:function(e,t){this.speechManager.updatePronunciation(e,t)}},{key:"deletePronunciations",value:function(e,t){this.speechManager.deletePronunciation(e,t)}},{key:"setLangVoiceMapping",value:function(e){this.speechManager.speechSettings.langVoiceMapping=e}},{key:"getLangVoiceMapping",value:function(){return this.speechManager.speechSettings.langVoiceMapping}},{key:"setUseElementLangTags",value:function(e){this.speechManager.speechSettings.setUseElementLangTags(e),this.useElementLangTags=e}},{key:"getUseElementLangTags",value:function(){return this.speechManager.speechSettings.getUseElementLangTags()}},{key:"unsubscribeEventBus",value:function(e){d.unSubscribe(e)}},{key:"uninstallEventBus",value:function(){d.uninstallEventBus()}}]),e}()},340:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ne}));var r=n(0);class i{constructor(){this._inputTypeEnum=this._makeEnum(["CONTENTEDITABLE","INPUT","TEXTAREA","IFRAME","NONE"])}_makeEnum(e){return Object.freeze(e.reduce((e,t)=>({...e,[t]:Symbol(t)}),{}))}insertText(e,t=null){if(!t){let e=document.activeElement;if("iframe"===e.tagName.toLowerCase()){e=(e.contentDocument||e.contentWindow.document).activeElement,t=this.getInputElement(e)}t||(t=this.getInputElement(document.activeElement)||{element:null,type:this._inputTypeEnum.NONE})}let n=!1,r=document.querySelector("iframe"),i=r.contentWindow,a=r.contentDocument;if(i.getSelection){let t=i.getSelection();if(t.getRangeAt&&t.rangeCount){let r=t.getRangeAt(0);r.deleteContents();let i=a.createTextNode(e);r.insertNode(i),r.setStart(i.parentNode,i.nextSibling?Array.prototype.indexOf.call(i.parentNode.childNodes,i.nextSibling):i.parentNode.childNodes.length),r.setEnd(i.parentNode,i.nextSibling?Array.prototype.indexOf.call(i.parentNode.childNodes,i.nextSibling):i.parentNode.childNodes.length),t.removeAllRanges(),t.addRange(r),n=!0}}if(!n)if(t.type!==this._inputTypeEnum.CONTENTEDITABLE){if(null!=t.element){const n=t.element.selectionStart||0,r=t.element.selectionEnd,i=t.element.value,a=i.substring(0,n)||"",s=i.substring(r,i.length)||"";t.element.value=a+e+s,t.element.selectionStart=t.element.selectionEnd=n+e.length,t.element.focus()}}else this._insertTextContentEditable(e,t.element)}replaceWordAtCursor(e,t=null,n=null){if(null===t&&(t=this.getInputElement(document.activeElement)),null===t.element)return;if(t.type===this._inputTypeEnum.CONTENTEDITABLE){let r=(n?n.contentWindow:window).getSelection(),i=this._getLeftToRightSelection(r),a=document.createTreeWalker(t.element,NodeFilter.SHOW_TEXT),s=0,o=0,l=a.nextNode();for(;l;)i.startNode,i.endNode,o=l.textContent.length+s,s=o,l=a.nextNode();let h=this.getText(t),u=h.textBeforeSelection.split(/(\s+)/).pop().trim(),d=h.textAfterSelection.split(/(\s+)/),g=d.shift().trim();if(0===u.length)return void this.insertText(e+" ",t);let c=0;for(c=0;c<u.length;c++)r.modify("move","backward","character");let m=u.length+g.length;for(c=0;c<m;c++)r.modify("extend","forward","character");let p=d.join("").trim();return 0===p.length&&(e+=" "),this.insertText(e,t),void(p.length>0&&r.modify("move","forward","character"))}const r=t.element.selectionStart,i=t.element.selectionEnd,a=t.element.value,s=a.substring(0,r),o=a.substring(i,a.length);let l=s.split(/(\s+)/).filter(e=>e.length>0);l=l[l.length-1]?l[l.length-1]:"";let h=o.split(/(\s+)/).filter(e=>e.length>0);h=h[0]?h[0]:"";let u=0;0===l.trim().length?(l="",h="",t.element.value=s.substring(0,s.length-l.length)+e+" "+o.substring(h.length),u++):0===h.trim().length?(t.element.value=s.substring(0,s.length-l.length)+e+" "+o.substring(h.length),u++):(t.element.value=s.substring(0,s.length-l.length)+e+o.substring(h.length),u++),t.element.selectionStart=s.substring(0,s.length-l.length).length+e.length+u,t.element.selectionEnd=t.element.selectionStart,t.element.focus()}insertImage(e,t=""){let n=this.getInputElement(document.activeElement);if(null===n)throw"The active input element could not be found.";if(n.type!==this._inputTypeEnum.CONTENTEDITABLE)throw"You can only insert an image into a contenteditable element.";t.length<1?this._pasteHtmlAtCaret(`<img src="${e}"></img>`):this._pasteHtmlAtCaret(`<img src="${e}" alt="${t}"></img>`)}getText(e=null){if(null==e&&(e=this.getInputElement(document.activeElement)),null==e)return{selectedText:"",textBeforeSelection:"",textAfterSelection:"",offsetCaretPosition:""};let t="",n="",r="",i=null,a=/[\uFEFF]/g;if(e.type==this._inputTypeEnum.CONTENTEDITABLE){let a=e.element.ownerDocument||e.document,s=(a.defaultView||a.parentWindow).getSelection();t=s.anchorNode.data.toString(),i=s.anchorOffset;let o=this._getLeftToRightSelection(s);n=o.startNode.textContent.substring(0,o.startOffset),r=o.endNode.textContent.substring(o.endOffset);let l=this._getPrevTextNode(o.startNode,e.element);for(;null!==l&&l.nodeType<4;)n=l.textContent+n,l=this._getPrevTextNode(l,e.element);let h=this._getNextTextNode(o.endNode,e.element);for(;null!==h&&h.nodeType<4;)r+=h.textContent,h=this._getNextTextNode(h,e.element)}else void 0!==e.element.value?(i=e.element.selectionStart,t=e.element.value.substring(e.element.selectionStart,e.element.selectionEnd),n=e.element.value.substring(0,e.element.selectionStart),r=e.element.value.substring(e.element.selectionStart+t.length)):(n="",t=window.getSelection());return{selectedText:t.replace(a,""),textBeforeSelection:function(e){const t=e.lastIndexOf("\n");return t>=0?e.slice(t+1):e}(n),textAfterSelection:r.replace(a,""),offsetCaretPosition:i}}_getLeftToRightSelection(e){let t=e.anchorNode.compareDocumentPosition(e.focusNode),n=!1;if((!t&&e.anchorOffset>e.focusOffset||t===Node.DOCUMENT_POSITION_PRECEDING)&&(n=!0),n)return{startNode:e.focusNode,startOffset:e.focusOffset,endNode:e.anchorNode,endOffset:e.anchorOffset};let r=e.focusOffset;return 1==r&&(r=e.toString().length),{startNode:e.anchorNode,startOffset:e.anchorOffset,endNode:e.focusNode,endOffset:r}}getInputElement(e=null){if(null==e)throw"No source element for getInputElement.";let t=e.closest("[contenteditable=true]");if(null!==t)return{element:t,type:this._inputTypeEnum.CONTENTEDITABLE};if(e.isContentEditable)return{element:e,type:this._inputTypeEnum.CONTENTEDITABLE};if(t=e.closest("input"),null!==t)return{element:t,type:this._inputTypeEnum.INPUT};if(t=e.closest("textarea"),null!==t)return{element:t,type:this._inputTypeEnum.TEXTAREA};let n=window.parent.document.querySelector("iframe");return n&&n.contentDocument.contains(e)?{element:n,type:this._inputTypeEnum.IFRAME}:{element:null,type:this._inputTypeEnum.NONE}}getCaretPosition(e=null){if(null==e)throw"No input element for getCaretPosition.";return e.type==this._inputTypeEnum.CONTENTEDITABLE?this._getContentEditableDivCaretPos(e.element):this._getTextInputCaretPos(e.element)}setCaretPosition(e,t=null){if(null==t)throw"No input element for setCaretPosition.";let n=e;return t.type==this._inputTypeEnum.CONTENTEDITABLE?this._setContentEditableDivCaretPos(n,t.element):this._setTextInputCaretPos(n,t.element)}_getContentEditableDivCaretPos(e){let t,n,r;return"IFRAME"===e.tagName?(t=e.contentDocument||e.contentWindow.document,n=t.defaultView||t.parentWindow):(t=e.ownerDocument||document,n=t.defaultView||t.parentWindow),r=n.getSelection(),r&&r.rangeCount>0?r.getRangeAt(0).getClientRects()[0]:(console.error("No active selection or selection has no ranges."),null)}_setContentEditableDivCaretPos(e,t){let n=document.createRange(),r=window.getSelection();n.setStart(t,e),n.collapse(!0),r.removeAllRanges(),r.addRange(n)}_getTextInputCaretPos(e){let t=e.selectionStart;var n,r,i,a=!(null==window.mozInnerScreenX);(n=document.getElementById(e.nodeName+"--texthelp-mirror-div"))||((n=document.createElement("div")).id=e.nodeName+"--texthelp-mirror-div",document.body.appendChild(n)),i=n.style,r=getComputedStyle(e),i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.overflowWrap="break-word"),i.position="absolute",i.top=e.offsetTop+parseInt(r.borderTopWidth)+"px",i.left="0px",i.visibility="hidden",["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){i[e]=r[e]})),a?(i.width=parseInt(r.width)-2+"px",e.scrollHeight>parseInt(r.height)&&(i.overflowY="scroll")):i.overflow="hidden",n.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var s=document.createElement("span");s.textContent=e.value.substring(t)||".",s.style.backgroundColor="lightgrey",n.appendChild(s);let o=e.getBoundingClientRect(),l=parseInt(r.fontSize),h=e.clientHeight,u=e.scrollHeight,d=e.scrollWidth,g=e.clientWidth,c=0,m=0;const p=l/100*30+l;return s.offsetTop+parseInt(r.borderTopWidth)+o.y>o.bottom&&(c=e.scrollTop===e.scrollHeight-e.clientHeight?u-h:e.scrollTop),s.offsetLeft+parseInt(r.borderLeftWidth)+o.x>o.right&&(m=e.scrollLeft===e.scrollWidth-e.clientWidth?d-g:e.scrollLeft),t={y:s.offsetTop+parseInt(r.borderTopWidth)+o.y-c,x:s.offsetLeft+parseInt(r.borderLeftWidth)+o.x-m,height:p},t.top=t.y,t.left=t.x,t.bottom=t.y+t.height,t}_setTextInputCaretPos(e,t){}_getTextNodesInRange(e){var t,n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,a=[];function s(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}for(t=n.parentNode;t&&(3===t.nodeType&&a.push(t),t!=i);t=t.parentNode);for(a.reverse(),t=n;t&&(3===t.nodeType&&a.push(t),t!=r);t=s(t));return a}_getPrevTextNode(e,t){let n=e.previousSibling;return null!==n?n:null===e.parentNode||null===e.parentNode.previousSibling||3!==e.parentNode.previousSibling.nodeType?null:t.contains(e.parentNode.previousSibling)?e.parentNode.previousSibling:null}_getNextTextNode(e,t){let n=e.nextSibling;return null!==n?n:null===e.parentNode||null===t||null===e.parentNode.nextSibling||3!==e.parentNode.nextSibling.nodeType?null:t.contains(e.parentNode.nextSibling)?e.parentNode.nextSibling:null}getCaretPositionContentEditable(e){e.focus();let t=(e.ownerDocument.defaultView||window).getSelection();return t=t.getRangeAt(0),{start:t.startOffset,end:t.endOffset}}_insertTextContentEditable(e,t){if(!t||!e)return void console.error("Input or text is undefined.");if("iframe"===t.tagName.toLowerCase()){t=(t.contentDocument||t.contentWindow.document).querySelector("[contenteditable]")}if(t.focus(),t.innerText||t.textContent,document.selection){const t=document.selection.createRange();return t.text=e,t.collapse(!1),void t.select()}if(!document.execCommand("insertText",!1,e)){const n=t.selectionStart,r=t.selectionEnd;if("function"==typeof t.setRangeText)t.setRangeText(e);else{const i=document.createRange(),a=document.createTextNode(e);if("undefined"!=typeof canManipulateViaTextNodes&&canManipulateViaTextNodes(t)){let e=t.firstChild;if(e){let t=0,a=null,s=null;for(;e&&(null===a||null===s);){const o=e.nodeValue.length;n>=t&&n<=t+o&&i.setStart(a=e,n-t),r>=t&&r<=t+o&&i.setEnd(s=e,r-t),t+=o,e=e.nextSibling}n!==r&&i.deleteContents()}else t.appendChild(a)}if("undefined"!=typeof canManipulateViaTextNodes&&canManipulateViaTextNodes(t)&&"#text"===i.commonAncestorContainer.nodeName)i.insertNode(a);else{const n=t.innerText,{start:r,end:i}=this.getCaretPositionContentEditable(t)||{start:n.length,end:n.length},a=(n.substring(0,r)||"")+e+(n.substring(i,n.length)||"");t.innerText=a}}const i=document.createEvent("UIEvent");i.initEvent("input",!0,!1),t.dispatchEvent(i);const a=document.createRange();a.selectNodeContents(t),a.collapse(!1);const s=(t.ownerDocument.defaultView||window).getSelection();s.removeAllRanges(),s.addRange(a),t.focus()}}_pasteHtmlAtCaret(e){var t,n;if(window.getSelection){if((t=window.getSelection()).getRangeAt&&t.rangeCount){(n=t.getRangeAt(0)).deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var i,a,s=document.createDocumentFragment();i=r.firstChild;)a=s.appendChild(i);n.insertNode(s),a&&((n=n.cloneRange()).setStartAfter(a),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(e)}_fireEvent(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(9!=e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.dispatchEvent){var r="";switch(t){case"click":case"mousedown":case"mouseup":r="MouseEvents";break;case"keydown":case"focus":case"change":case"blur":case"select":r="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+t+"'."}var i="change"!=t;(a=n.createEvent(r)).initEvent(t,i,!0),a.synthetic=!0,e.dispatchEvent(a,!0)}else if(e.fireEvent){var a;(a=n.createEventObject()).synthetic=!0,e.fireEvent("on"+t,a)}}}class a{constructor(e,t,n){this.node=e,this.offset=t,this.forwardBias=n,this.specialCase=!1}setSpecialCase(e){this.specialCase=e}isSpecialCase(){return this.specialCase}check(){var e=!0;return null==this.node||null==this.node.parentNode?e=!1:3!=this.node.nodeType?1==this.node.nodeType&&this.specialCase||(e=!1):(this.offset<0||this.offset>this.node.nodeValue.length)&&(e=!1),e}toString(){var e="THCaret ";return null!=this.node&&(3==this.node.nodeType?e+=this.node.nodeValue+" "+this.node.parentNode.tagName+" ":1==this.node.nodeType&&(e+=this.node.tagName+" ")),e+=this.offset}equals(e){return null!=e&&(this.node==e.node&&this.offset==e.offset&&this.forwardBias==e.forwardBias)}clone(){return new a(this.node,this.offset,this.forwardBias)}}function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}String.prototype.trimTH=function(){try{return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}catch(e){return}},String.prototype.trimSpaceTH=function(){try{return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")}catch(e){return}},String.prototype.trimSpaceStartTH=function(){try{return this.replace(/^[\t\r\n ]+/,"")}catch(e){return}},String.prototype.trimSpaceEndTH=function(){try{return this.replace(/[\t\r\n ]+$/,"")}catch(e){return}};class o{constructor(){this.extendedLetterPattern=/^[a-zA-Z\u00C6\u00D0\u018E\u018F\u0190\u0194\u0132\u014A\u0152\u1E9E\u00DE\u01F7\u021C\u00E6\u00F0\u01DD\u0259\u025B\u0263\u0133\u014B\u0153\u0138\u017F\u00DF\u00FE\u01BF\u021D\u0104\u0181\u00C7\u0110\u018A\u0118\u0126\u012E\u0198\u0141\u00D8\u01A0\u015E\u0218\u0162\u021A\u0166\u0172\u01AFY\u0328\u01B3\u0105\u0253\u00E7\u0111\u0257\u0119\u0127\u012F\u0199\u0142\u00F8\u01A1\u015F\u0219\u0163\u021B\u0167\u0173\u01B0y\u0328\u01B4\u00C1\u00C0\u00C2\u00C4\u01CD\u0102\u0100\u00C3\u00C5\u01FA\u0104\u00C6\u01FC\u01E2\u0181\u0106\u010A\u0108\u010C\u00C7\u010E\u1E0C\u0110\u018A\u00D0\u00C9\u00C8\u0116\u00CA\u00CB\u011A\u0114\u0112\u0118\u1EB8\u018E\u018F\u0190\u0120\u011C\u01E6\u011E\u0122\u0194\u00E1\u00E0\u00E2\u00E4\u01CE\u0103\u0101\u00E3\u00E5\u01FB\u0105\u00E6\u01FD\u01E3\u0253\u0107\u010B\u0109\u010D\u00E7\u010F\u1E0D\u0111\u0257\u00F0\u00E9\u00E8\u0117\u00EA\u00EB\u011B\u0115\u0113\u0119\u1EB9\u01DD\u0259\u025B\u0121\u011D\u01E7\u011F\u0123\u0263\u0124\u1E24\u0126I\u00CD\u00CC\u0130\u00CE\u00CF\u01CF\u012C\u012A\u0128\u012E\u1ECA\u0132\u0134\u0136\u0198\u0139\u013B\u0141\u013D\u013F\u02BCN\u0143N\u0308\u0147\u00D1\u0145\u014A\u00D3\u00D2\u00D4\u00D6\u01D1\u014E\u014C\u00D5\u0150\u1ECC\u00D8\u01FE\u01A0\u0152\u0125\u1E25\u0127\u0131\u00ED\u00ECi\u00EE\u00EF\u01D0\u012D\u012B\u0129\u012F\u1ECB\u0133\u0135\u0137\u0199\u0138\u013A\u013C\u0142\u013E\u0140\u0149\u0144n\u0308\u0148\u00F1\u0146\u014B\u00F3\u00F2\u00F4\u00F6\u01D2\u014F\u014D\u00F5\u0151\u1ECD\u00F8\u01FF\u01A1\u0153\u0154\u0158\u0156\u015A\u015C\u0160\u015E\u0218\u1E62\u1E9E\u0164\u0162\u1E6C\u0166\u00DE\u00DA\u00D9\u00DB\u00DC\u01D3\u016C\u016A\u0168\u0170\u016E\u0172\u1EE4\u01AF\u1E82\u1E80\u0174\u1E84\u01F7\u00DD\u1EF2\u0176\u0178\u0232\u1EF8\u01B3\u0179\u017B\u017D\u1E92\u0155\u0159\u0157\u017F\u015B\u015D\u0161\u015F\u0219\u1E63\u00DF\u0165\u0163\u1E6D\u0167\u00FE\u00FA\u00F9\u00FB\u00FC\u01D4\u016D\u016B\u0169\u0171\u016F\u0173\u1EE5\u01B0\u1E83\u1E81\u0175\u1E85\u01BF\u00FD\u1EF3\u0177\u00FF\u0233\u1EF9\u01B4\u017A\u017C\u017E\u1E93]+$/}trim(e){return e.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}trimEndTH(e){return e.replace(/[\s\xA0]+$/,"")}rw_filterForHtml(e){var t=e.replace(/\x26/g,"&amp;");return t=(t=t.replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}encodeForXML(e){return e=(e=(e=(e=(e=e.replace(/\x26/g,"&amp;")).replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")).replace(new RegExp('"'),"&quot;")).replace(new RegExp("'"),"&apos;")}isNumber(e){return e.length>1&&(e=e.trimTH()),""!=e&&" "!=e&&!isNaN(e)}isAlpha(e){return this.extendedLetterPattern.test(e)}filterId(e){var t,n,r,i=e.length;if(i>100)return hex_md5(e);for(t=0;t<i;t++)(n=e.charCodeAt(t))>47&&n<58||n>63&&n<92||n>94&&n<124||(n>126||92==n||47==n||58==n||59==n||42==n||63==n||34==n||60==n||62==n||124==n||35==n||37==n||43==n||38==n||94==n)&&(r="^"+d2h(n),i=(e=e.substr(0,t)+r+e.substr(t+1)).length,t+=r.length-1);return e}}class l{constructor(){this.TEXTHELP_PREFIX="texthelp-",this.IGNORE_ATTR="ignore",this.ALLOW_ATTR="allow",this.PRON_ATTR="pron",this.COMMAND_ATTR="texthelpCmd",this.ARIA_ROLE_ATTR="role",this.ARIA_LABEL_ATTR="aria-label",this.ARIA_HIDDEN_ATTR="aria-hidden",this.bTexthelpPrefix=!1,this.strPrefix=""}setUseTexthelpPrefix(e){this.bTexthelpPrefix=!("boolean"!=typeof e)||e,this.bTexthelpPrefix?this.strPrefix=this.TEXTHELP_PREFIX:this.strPrefix=""}getIgnoreAttr(){return this.strPrefix+this.IGNORE_ATTR}getAllowAttr(){return this.strPrefix+this.ALLOW_ATTR}getPronunceAttr(){return this.strPrefix+this.PRON_ATTR}getCommandAttr(){return this.strPrefix+this.COMMAND_ATTR}rw_getAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){var n=null;return 0!=t.indexOf("data-texthelp-")&&(n=e.getAttribute("data-texthelp-"+t)),null==n&&0!=t.indexOf("data-")&&(n=e.getAttribute("data-"+t)),null==n&&(n=e.getAttribute(t)),n}return null}rw_setAttribute(e,t,n){null!=e&&1==e.nodeType&&"string"==typeof t&&"string"==typeof n&&(0!=t.indexOf("data-")&&"style"!=t&&(t="data-"+t),e.setAttribute(t,n))}rw_removeAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){if(0!=t.indexOf("data-")&&null!=e.getAttribute("data-"+t))return void e.removeAttribute("data-"+t);null!=e.getAttribute(t)&&e.removeAttribute(t)}}}const h={ignoreHidden:!0,ignoreFrames:!1,addEventsToFrames:!0,g_bAnnotationGlobalCheck:!1,g_bAnnotationGlobalUnknown:!1,g_nHighlightNotSyncedState:0,g_strStoredHighlightUnprocessedData:null,g_elemStoredHighlightLimitArea:null,bMathsSymbols:!1,mathWithContext:!1,overrideAriaHidden:!0,ariaLabelOnMathRoleEnabled:!0,ariaLabelOnMathJaxClassEnabled:!1,customReadingAttribute:!1,customReadingRules:null,readMathMLAltText:!1,IELoadedFlag:!1,tagPage:!1,styleHacks:!1,no_scroll:!1,mathSymbolMapping:null,useCommands:!1,strAnnounceLinksAsWords:null,inlineImages:!1,voiceFromLangFlag:!0,playStartPoint:null,toolbarID:null,stripSpaces:!1,paths:{strFileLoc:"https://toolbar.speechstream.net/SpeechStream/v217/"},mathSre:{mathSpeakLocation:"toolbar.speechstream.net",mathSpeakVersion:"3.0.0-beta.6",sreSettings:{semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://toolbar.speechstream.net/MathSpeak/3.0.0-beta.6/wgxpath.install.js",locale:"en"},removeList:["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline","normal"],correctList:["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",String.fromCharCode(8722)+"=minus",String.fromCharCode(45)+"=minus",String.fromCharCode(215)+"=times",String.fromCharCode(247)+"=divided by",{regex:/\s-\s/gi,replacement:"minus"},{regex:/\bdot\b/gi,replacement:"times"},"sayminusas=say-as","interpretminusas=interpret-as",{regex:/\s>\s/gi,replacement:"greater than"},{regex:/\s<\s/gi,replacement:"less than"},{regex:/\s<=\s/gi,replacement:"less than or equal to"},{regex:/\s>=\s/gi,replacement:"greater than or equal to"},{regex:/\s\(\s/gi,replacement:"open Parenthesis"},{regex:/\s\)\s/gi,replacement:"close Parenthesis"},{regex:/\s≤\s/gi,replacement:"less than or equal to"},{regex:/\s≥\s/gi,replacement:"greater than or equal to"},{regex:/\s≠\s/gi,replacement:"not equal to"},"squaredroot=square root"]},init(e){({tagPage:this.tagPage,styleHacks:this.styleHacks,no_scroll:this.no_scroll,bMathsSymbols:this.bMathsSymbols,mathSymbolMapping:this.mathSymbolMapping,mathWithContext:this.mathWithContext,useCommands:this.useCommands,inlineImages:this.inlineImages,overrideAriaHidden:this.overrideAriaHidden=!0,playStartPoint:this.playStartPoint,ignoreHidden:this.ignoreHidden=!0,ignoreFrames:this.ignoreFrames=!1,addEventsToFrames:this.addEventsToFrames=!0,toolbarID:this.toolbarID,stripSpaces:this.stripSpaces}=e)}};let u,d;const g=e=>{u=e},c=e=>{d=e};class m{constructor(){h.mathSre.mathSpeakLocation?this.mathSpeakLocation=h.mathSre.mathSpeakLocation:this.mathSpeakLocation="toolbar.speechstream.net",h.mathSre.removeList?this.removeList=h.mathSre.removeList:this.removeList=["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline","normal"],h.mathSre.correctList?this.correctList=h.mathSre.correctList:this.correctList=["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",String.fromCharCode(8722)+"=minus",String.fromCharCode(45)+"=times",String.fromCharCode(215)+"=times",String.fromCharCode(247)+"=divided by",{regex:/\s-\s/gi,replacement:"minus"},{regex:/\bdot\b/gi,replacement:"times"},"sayminusas=say-as","interpretminusas=interpret-as",{regex:/\s>\s/gi,replacement:"greater than"},{regex:/\s<\s/gi,replacement:"less than"},{regex:/\s<=\s/gi,replacement:"less than or equal to"},{regex:/\s>=\s/gi,replacement:"greater than or equal to"},{regex:/\s\(\s/gi,replacement:"open Parenthesis"},{regex:/\s\)\s/gi,replacement:"close Parenthesis"},{regex:/\s≤\s/gi,replacement:"less than or equal to"},{regex:/\s≥\s/gi,replacement:"greater than or equal to"},{regex:/\s≠\s/gi,replacement:"not equal to"},"squaredroot=square root"],h.mathSre.mathSpeakVersion?this.mathSpeakVersion=h.mathSre.mathSpeakVersion:this.mathSpeakVersion="3.0.0-beta.6",h.mathSre.sreSettings?this.sreSettings=h.mathSre.sreSettings:this.sreSettings={semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://"+this.mathSpeakLocation+"/MathSpeak/"+this.mathSpeakVersion+"/wgxpath.install.js",locale:"en"},this.mathObjectArray,u?this.instance=u:(sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance()),d?this.mathJaxInstance=d:MathJax?this.mathJaxInstance=MathJax:console.log("No MathJax in the page")}async loadNewSreInstance(){"undefined"==this.instance&&"undefined"==typeof sre?(await sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance()):await this.instance.setupEngine(this.sreSettings)}getRawTextFromMathJaxForLocale(e,t){let n;return n="",""}getRawTextFromMathJax(e){if(e.isMathJax){for(var t=e;null!=t&&t.isMathJax&&!t.id;)t=t.parentNode;t&&t.id?"math:"+t.id+";":"math:none;"}let n=null;if(null!=this.mathJaxInstance&&(n=this.mathJaxInstance.version.startsWith("3")||this.mathJaxInstance.version.startsWith("4")?this.mathJaxInstance.startup.document.getMathItemsWithin(e):e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e)),null!=n){var r=this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());var i=null,a="";try{var s,o;(null!=(i=(i=null!==(s=this.mathJaxInstance)&&void 0!==s&&s.version.startsWith("3")||null!==(o=this.mathJaxInstance)&&void 0!==o&&o.version.startsWith("4")?this.mathJaxInstance.startup.toMML(n[0].root):n.root.toMathML("")).replace(/&#x394;/g,"&#x3B4;"))||i.length>0)&&(a=(a=(a=(a=(a=(a=(a=this.instance.toSpeech?this.instance.toSpeech(i):this.instance.processExpression(i,!1,!1)).replace(/BOOKMARK MARK/g,"bookmark mark")).replace(/<bookmark mark="0"\/>/g,"")).replace(/a\./g,"a")).replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()}))).replace(new RegExp("\\bbold\\b","gi")," ")).replace(new RegExp("\\s{2,}/g")," "),a=this.filterMathSpeakFixUndesiredMathSpeakOutput(a))}catch(e){console.log(e)}return this.sreSettings.markup!=r&&(this.sreSettings.markup=r,this.loadNewSreInstance()),a}return""}getSpeech(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);return this.mathObjectArray=new Array,n=n.replace(/<\/([^>]+)/g,"</mathml:$1>"),n=n.replace(/<([^>]+)/g,"<mathml:$1>"),this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!1,t.ownerDocument))}}return""}getSpeechWithBookmarks(e){if("string"==typeof e){this.sreSettings.markup;g_bSSMLSpeechEnabled&&"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);this.mathObjectArray=new Array;let i=this.instance.toSpeech?this.instance.toSpeech(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!0,t.ownerDocument)):this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!0,t.ownerDocument));return i=i.replace(/BOOKMARK MARK/g,"bookmark mark"),i=i.replace('<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">','<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\nxmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\nxsi:schemaLocation="http://www.w3.org/2001/10/synthesis\nhttp://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n">'),i=i.replace('<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="en">',""),i=i.replace(new RegExp("<prosody [^>]*>","g"),""),i=i.replaceAll("</prosody>",""),i=i.replace(/a\./g,"a."),i=i.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),i=i.replace(new RegExp("\\bbold\\b","gi")," "),i=i.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(i)}}return""}getSpeechFromElement(e){if(null!=e&&(1==e.isMathJax||e.nodeName.startsWith("MJX"))){this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());let t=this.getMathMLText(e),n=self.instance.toSpeech?self.instance.toSpeech(t):self.instance.processExpression(t);return n=n.replace(new RegExp("silence msec","gi"),""),n=n.replace(new RegExp("\\bbold\\b","gi")," "),n=n.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(n)}return""}getSpeechWithBookmarksFromElement(e){if(null!=e&&(1==e.isMathJax||e.nodeName.startsWith("MJX"))){let t="";try{let n=this.sreSettings.markup;"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let r=this.getMathMLText(e),i=this.getMathMLObject(e);this.mathObjectArray=new Array;let a=e.getAttribute("sre-explorer-id"),s=this.getMathMLWithBookmarks(this.mathObjectArray,i,r,!0,e.ownerDocument,a);""!=s&&(t=this.instance.toSpeech?this.instance.toSpeech(s):this.instance.processExpression(s),t=t.replace(/BOOKMARK MARK/g,"bookmark mark"),t=t.replace('<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">',""),t=t.replace('<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="en">',""),t=t.replace(new RegExp("<prosody [^>]*>","g"),""),t=t.replaceAll("</prosody>",""),t=t.replace("</speak>",""),t=t.replace(new RegExp('interpret-as="character"',"g"),'interpret-as="spell"'),t=t.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),t=t.replace(new RegExp("\\bbold\\b","gi")," "),t=t.replace(new RegExp("\\s{2,}/g")," "),t=this.filterMathSpeakFixUndesiredMathSpeakOutput(t),this.sreSettings.markup!=n&&(this.sreSettings.markup=n,this.loadNewSreInstance()))}catch(e){console.log(e)}return t}return""}getMathMLOriginalText(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e);t.ownerDocument.defaultView.MathJax.Hub.getJaxFor(t).originalText}}return""}getMathMLText(e){if(null!=e&&1==e.isMathJax){let t=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root.toMathML();t=t.replace(/&#x394;/g,"&#x3B4;");let n=(new DOMParser).parseFromString(t,"text/xml");return"parsererror"!=n.documentElement.nodeName&&"parsererror"!=n.documentElement.firstChild.nodeName||(t=""),t}if(null!=e&&e.nodeName.startsWith("MJX")){let t=this.mathJaxInstance.startup.toMML(this.mathJaxInstance.startup.document.getMathItemsWithin(e)[0].root);t=t.replace(/&#x394;/g,"&#x3B4;");let n=(new DOMParser).parseFromString(t,"text/xml");return"parsererror"!=n.documentElement.nodeName&&"parsererror"!=n.documentElement.firstChild.nodeName||(t=""),t}return""}getMathMLObject(e){return null!=e&&1==e.isMathJax?e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root:null!=e&&e.nodeName.startsWith("MJX")?this.mathJaxInstance.startup.document.getMathItemsWithin(e)[0].root:""}isMathML(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax)return!0}return!1}getMathMLWithBookmarks(e,t,n,r,i,a){if(null!=n&&(n=n.replace(/<mathml:math.*>/,'<math xmlns="http://www.w3.org/1998/Math/MathML">')),null!=t.data){for(let a=0;a<t.data.length;a++)if(null!=t.data[a]){let s=t.data[a].spanID?t.data[a].spanID:t.data[a].CHTMLnodeID;if(s=null!=s&&null!=s?s:t.data[a].PHTMLspanID,t.data[a].toMathML&&t.data[a].toMathML()&&null!=s&&null!=t.data[a].data[0]&&null!=t.data[a].data[0].data[0]&&null==t.data[a].data[0].data[0].toMathML){let o,l=new Object;l.data=t.data[a],l.span=t.data[a].toMathML(),l.span=l.span.replace(/&#x394;/g,"&#x3B4;"),l.jaxSpanid=s,l.htmlElem=i.getElementById("MathJax-Span-"+l.jaxSpanid)||i.getElementById("MJXc-Node-"+l.jaxSpanid),-1==n.indexOf(l.span)&&(l.span=l.span.replace(/>.*</,">"+t.data[a].data[0].data[0]+"<")),o=r?l.span.replace(">",' extid="'+s+'">'):l.span.replace(">",' nobookmark ="">'),n=n.replace(l.span,o),e.push(l)}n=this.getMathMLWithBookmarks(e,t.data[a],n,r,i)}}else t.childNodes&&(n=this.createMathWordObjectArray(t,i,r,n,a));return n}createMathWordObjectArray(e,t,n,r,i){let a=i;return e.childNodes.length>0&&e.childNodes.forEach(e=>{if(e.text){let t=new Object;t.data=e,t.span=this.mathJaxInstance.startup.toMML(e.parent),t.span=t.span.replace(/&#x394;/g,"&#x3B4;"),t.jaxSpanid=e.parent.attributes.get("data-semantic-id"),t.htmlElem=document.querySelector("mjx-container[sre-explorer-id='"+a+"']").querySelector("[data-semantic-id='"+t.jaxSpanid+"']"),this.mathObjectArray.push(t)}else this.createMathWordObjectArray(e,t,n,r,a)}),this.mathObjectArray.length>0&&this.mathObjectArray.map(e=>{let t;t=n?e.span.replace(">",' extid="'+e.jaxSpanid+'">'):e.span.replace(">",' nobookmark ="">'),r=r.replace(e.span,t)}),r}getMathMLTextWithBookmarks(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e),n=this.getMathMLText(e),r=this.getMathMLObject(e),i=new Array;return this.getMathMLWithBookmarks(i,r,n,!0,t.ownerDocument)}}return""}filterMathSpeakFixUndesiredMathSpeakOutput(e){var t,n,r,i,a,s=e,o=this.removeList.length;for(t=0;t<o;t++)for(r=this.removeList[t],n=s.indexOf(r);n>-1;)n=(s=s.replace(r,"")).indexOf(r);for(o=this.correctList.length,t=0;t<o;t++){const e=this.correctList[t];if("string"==typeof e)a=this.correctList[t].split("="),r=new RegExp(a[0],"gi"),i=a[1];else{if(!e.regex)continue;r=e.regex,i=e.replacement}s=s.replace(r,i)}return s!=e?s:e}getMathMLAltText(e){return null!=e&&1==e.isMathJax?e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root.alttext:null!=e&&e.nodeName.startsWith("MJX")?this.mathJaxInstance.startup.document.getMathItemsWithin(e)[0].root.alttext||this.mathJaxInstance.startup.document.getMathItemsWithin(e)[0].root.attributes.attributes.alttext:""}}var p="texthelphighlightspan",f="thspan",S="thspan",v=["p","br","head","body","hr","div","h1","h2","h3","h4","h5","h6","blockquote","table","tbody","tr","td","th"],w=["em","strong","b","i","u","tt","font","kbd","dfn","cite","sup","sub","a","embed","span","small","nobr","wbr","acronym","abbr","code","s","chunk","th:pron","img","/th:pron","w","/w","lic/lic","break","silence","thspan","beelinereader","x-marker",p,f,"mjx-container"];function b(e){S=e}function y(e){f=e}function C(e){p=e}function T(e,t){v=t?e:v.concat(e)}function x(e,t){w=t?e:w.concat(e)}const N=/[\n\r\t ]{2,}/g;class _{constructor(e,t){if(this.CMD_LIST="list",this.CMD_STOP="stop",this.CMD_STOPAFTER="stopafter",this.CMD_JUMP="jump",this.CMD_JUMPBACK="jumpback",this.CMD_VOICE="voice",this.CMD_PAGEID="pageid",this.CMD_BOOKID="bookid",this.CMD_EXEC="exec",this.CMD_EXECAFTER="execafter",this.command=null,this.param=null,this.element=t,null!=e){var n=e.indexOf(":");n>-1?(this.command=e.substr(0,n).toLowerCase(),this.param=e.substr(n+1)):this.command=e.toLowerCase()}}}class E{constructor(){}getActualNextNodeIgnoreChildren(e,t){if(null==e||e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getActualNextNode(e,t){if(null==e)return null;if(null!=e.firstChild)return e.firstChild;if(e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getNodeFromPosition(e,t){var n=new l,r=e;if(t.lastIndexOf("*")>-1){var i=t.lastIndexOf("*");t=t.substring(i+1)}var a,s=t.split("~");for(a=s.length-2;a>-1;a--){if(null==(r=r.firstChild))return null;var o;o=0==s[a].length?0:parseInt(s[a],10);for(var h=!1,u=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==p&&null!=n.rw_getAttribute(r,"rwstate");o>0;){if(null==(r=r.nextSibling))return null;(h=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==p&&null!=n.rw_getAttribute(r,"rwstate"))&&u||(--o,u=h)}}return r}getTextFromNode(e){var t=new F,n=new l,r="";if(t.isInvalidNode(e)||t.isIgnored(e)||t.isAriaHidden(e))return r;if(3==e.nodeType)"textarea"!=e.parentNode.tagName.toLowerCase()&&("option"==e.parentNode.tagName.toLowerCase()?null==(r=t.getDropdownSelectedItem(e.parentNode.parentNode))||""==r?r=e.nodeValue:e.parentNode.selected||(r=""):r=e.nodeValue);else if(1==e.nodeType){var i=e.tagName.toLowerCase();if("img"==i||"svg"==i)null==(a=n.rw_getAttribute(e,"msg"))&&(a=n.rw_getAttribute(e,"alt")),null!=a&&a.trimTH().length>0&&(r=" "+a.trimTH()+" ");else if("span"==i||"thspan"==i){if(null!=(a=n.rw_getAttribute(e,"pron"))&&a.trimTH().length>0&&(r=a.trimTH()),null!=(a=n.rw_getAttribute(e,"chunk"))&&"1"==a&&(r=e.innerHTML),(a=e.isMathJax)||e.nodeName.startsWith("MJX"))r=(new m).getRawTextFromMathJax(e)}else if("acronym"==i||"abbr"==i){var a=n.rw_getAttribute(e,"pron"),s=new o;(null!=a&&s.trim(a).length>0||null!=(a=e.getAttribute("title"))&&s.trim(a).length>0)&&(r=s.trim(a))}else if("math"==i)r=this.getTextFromMathMl(e);else if(i.toLowerCase().startsWith("mjx")){r=(new m).getRawTextFromMathJax(e)}else t.hasCustomReadingAttribute(e)&&(r=t.getCustomReadingAttribute(e))}return r}getNextNodeAllowMoveToChild(e,t,n){return this.getNextNodeImpl(e,t,n,!0,!1)}getNextNodeIgnoreChildren(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!0)}getLastChildTextNode(e,t){var n=new l,r=new F;if(null==e||null==e.lastChild||r.isInvalidNode(e))return e;if(r.isSpecialCaseWithIgnoredContent(e))return e;for(var i=e.lastChild;null!=i;){var a=r.isIgnored(e)||r.isAriaHidden(e);if(!a&&3==i.nodeType)return i;if(!a&&1==i.nodeType&&t&&("img"==i.tagName.toLowerCase()||"svg"==i.tagName.toLowerCase())&&(null!=n.rw_getAttribute(i,"msg")&&n.rw_getAttribute(i,"msg").length>0||null!=n.rw_getAttribute(i,"alt")&&n.rw_getAttribute(i,"alt").length>0))return i;if(i.isMathJax||i.nodeName.startsWith("MJX"))return i;if(r.isInvalidNode(i)||null==i.lastChild||r.isSpecialCaseWithIgnoredContent(e))return t?this.getPreviousTextNode(i,!1,e):this.getPreviousTextNodeNoImg(i,!1,e,!0);i=i.lastChild}return e}getPreviousTextNodeNoImg(e,t,n,r,i){for(var a=new F,s=r?this.getPreviousTextNode(e,t,n):this.getPreviousTextNodeNoBlank(e,t,n,i);!(null==s||3==s.nodeType||s==n||null!=s.tagName&&"math"==s.tagName.toLowerCase()||s.isMathJax||s.nodeName.startsWith("MJX")||a.hasCustomReadingAttribute(s));)s=r?this.getPreviousTextNode(s,t,n):this.getPreviousTextNodeNoBlank(s,t,n,i);return s}getPreviousTextNodeNoBlank(e,t,n,r){for(var i=new l,a=new F,s=e;null!=s&&s!=n;)if(null!=(s=this.getPreviousTextNode(s,t,n))){var o;if(3==s.nodeType)o=s.nodeValue.trimTH();else if("img"!=s.tagName.toLowerCase()&&"svg"!=s.tagName.toLowerCase()||null==i.rw_getAttribute(s,"alt")&&null==i.rw_getAttribute(s,"msg"))if(null!=s.tagName&&"math"==s.tagName.toLowerCase())o=this.getTextFromMathMl(s);else if(s.isMathJax||s.nodeName.startsWith("MJX")){o=(new m).getRawTextFromMathJax(s)}else a.hasCustomReadingAttribute(s)&&(o=a.getCustomReadingAttribute(s));else null==(o=i.rw_getAttribute(s,"msg").trimTH())&&(o=i.rw_getAttribute(s,"alt").trimTH());if(a.rw_isWordSpeakable(o,r))return s}return null}getPreviousTextNode(e,t,n){for(var r=new l,i=new F,a=e,s=!1;null!=a&&a!=n;)if(null!=(a=this.getPreviousNode(a,t,n))){if(3==a.nodeType&&"textarea"!=a.parentNode.tagName.toLowerCase()&&a.nodeValue.length>0&&(s=!0),1==a.nodeType&&null!=a.tagName&&"math"==a.tagName.toLowerCase())s=!0;else if(1==a.nodeType&&a.isMathJax||a.nodeName.startsWith("MJX"))s=!0;else if(1!=a.nodeType||"img"!=a.tagName.toLowerCase()&&"svg"!=a.tagName.toLowerCase())i.hasCustomReadingAttribute(a)&&(s=!0);else{var o=r.rw_getAttribute(a,"msg");null==o&&(o=r.rw_getAttribute(a,"alt")),null!=o&&o.length>0&&(s=!0)}if(s)return a}return null}getPreviousNode(e,t,n){var r=new F;if(null==e||e==n)return null;var i=e;if(null!=i.previousSibling){if(i=i.previousSibling,t&&!r.isStyleNode(i))return null;if(null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n)}else{for(;null!=i&&null!=i.lastChild&&!r.isSpecialCaseWithIgnoredContent(i);)if(i=i.lastChild,t&&(r.isStyleNode(i)||(i=null)),null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n);break}if(null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}}}else if(i=i.parentNode,t&&null!=i&&(r.isStyleNode(i)||(i=null)),null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}return i}getFirstChildTextNode(e,t){var n=new F,r=new l;if(null==e||null==e.firstChild||n.isInvalidNode(e))return e;if(n.isSpecialCaseWithIgnoredContent(e))return e;var i=e.firstChild;return 3==i.nodeType||1==i.nodeType&&t&&("img"==i.tagName.toLowerCase()||"svg"==i.tagName.toLowerCase())&&(null!=r.rw_getAttribute(i,"msg")&&r.rw_getAttribute(i,"msg").length>0||null!=r.rw_getAttribute(i,"alt")&&r.rw_getAttribute(i,"alt").length>0)||i.isMathJax||i.nodeName.startsWith("MJX")?i:t?this.getNextTextNode(i,!1,e):this.getNextTextNodeNoImg(i,!1,e,!0)}getNextTextNodeNoImg(e,t,n,r){for(var i=new F,a=r?this.getNextTextNode(e,t,n):this.getNextTextNodeNoBlank(e,t,n);!(null==a||3==a.nodeType||a==n||null!=a.tagName&&"math"==a.tagName.toLowerCase()||a.isMathJax||a.nodeName.startsWith("MJX")||i.hasCustomReadingAttribute(a));)a=r?this.getNextTextNode(a,t,n):this.getNextTextNodeNoBlank(a,t,n);return a}getNextTextNodeNoBlank(e,t,n,r){for(var i=new l,a=new F,s=e;null!=s&&s!=n;)if(null!=(s=this.getNextTextNode(s,t,n))){var o;if(3==s.nodeType)o=s.nodeValue.trimTH();else if("img"!=s.tagName.toLowerCase()&&"svg"!=s.tagName.toLowerCase()||null==i.rw_getAttribute(s,"alt")&&null==i.rw_getAttribute(s,"msg"))if(null!=s.tagName&&"math"==s.tagName.toLowerCase())o=this.getTextFromMathMl(s);else if(s.isMathJax||s.nodeName.startsWith("MJX")){o=(new m).getRawTextFromMathJax(s)}else a.hasCustomReadingAttribute(s)&&(o=a.getCustomReadingAttribute(s));else null==(o=i.rw_getAttribute(s,"msg"))&&(o=i.rw_getAttribute(s,"alt")),null!=o&&o.trimTH();if(a.rw_isWordSpeakable(o,r))return s}return null}getTextFromMathMl(e){var t,n=new F;if(null!=e.previousSibling||null!=e.nextSibling){var r=n.createWrapperElement();e.parentNode.replaceChild(r,e),r.appendChild(e)}return null!=(t=e.parentNode.innerHTML)&&t.length>0?t:""}getNextTextNode(e,t,n){for(var r=new l,i=new F,a=e,s=!1;null!=a&&a!=n;)if(null!=(a=this.getNextNode(a,t,n))){if(3==a.nodeType&&"textarea"!=a.parentNode.tagName.toLowerCase()&&a.nodeValue.length>0&&(s=!0),1==a.nodeType&&null!=a.tagName&&"math"==a.tagName.toLowerCase())s=!0;else if(1==a.nodeType&&(a.isMathJax||a.nodeName.startsWith("MJX")))s=!0;else if(1!=a.nodeType||"img"!=a.tagName.toLowerCase()&&"svg"!=a.tagName.toLowerCase())i.hasCustomReadingAttribute(a)&&(s=!0);else{var o=r.rw_getAttribute(a,"msg");null==o&&(o=r.rw_getAttribute(a,"alt")),null!=o&&o.length>0&&(s=!0)}if(s)return a}return null}getNextNode(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!1)}getNextNodeImpl(e,t,n,r,i){var a=new F;if(null==e||e==n&&(i||!r))return null;var s=a.isInvalidNode(e);a.isSpecialCaseWithIgnoredContent(e)&&(s=!0);var o=null;if(e==n&&r){if(s||null==e.firstChild)return null;o=e.firstChild}else if(null==(o=e).firstChild||s||i){if(null!=o.firstChild&&i&&null!=n&&a.checkIfElementInsideElement(n,o))return null;if(null!=o.nextSibling)o=o.nextSibling;else{for(;null!=o&&null==o.nextSibling&&(o=o.parentNode,t&&(a.isStyleNode(o)||(o=null)),n!=o););null!=o&&n!=o&&(o=o.nextSibling)}}else o=o.firstChild;return null!=o&&t&&(a.isStyleNode(o)||(o=null)),null!=o&&(a.isInvalidNode(o)?o=this.getNextNodeImpl(o,t,n,!1,!0):(a.isIgnored(o)||a.isAriaHidden(o))&&(o=this.getNextNodeImpl(o,t,n,!1,!1)),r&&o==n&&e==n&&(o=null)),o}findCommands(e){var t=[];if(null!=e){let s=e.ownerDocument.body,o=e.getRootNode();o.mode&&"open"==o.mode&&(s=o);var n=e;if(3==n.nodeType&&null!=n.parentNode&&(n=n.parentNode),1!=n.nodeType)return t;for(var r=new l;null!=n&&n!=s;){if(null!=r.rw_getAttribute(n,"texthelpCmd")){var i=r.rw_getAttribute(n,"texthelpCmd").trimTH();if("list"==i||"list:"==i){var a=1;for(i=r.rw_getAttribute(n,"texthelpCmd"+a);null!=i;)t.push(new _(i,n)),++a,i=r.rw_getAttribute(n,"texthelpCmd"+a)}else t.push(new _(i,n));break}n=n.parentNode}}return t}findCommandNode(e){if(null!=e){var t=e.ownerDocument.body,n=e;if(3==n.nodeType&&(n=n.parentNode),1!=n.nodeType)return null;for(var r=new l;null!=n&&n!=t;){if(null!=r.rw_getAttribute(n,"texthelpCmd"))return n;n=n.parentNode}}return null}actOnPageIDCommand(e){if(h.useCommands){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){let t=new o;for(var r=0;r<n.length;r++){var i=n[r];i.command==i.CMD_&&(e.pageId=t.filterId(i.param))}}}}}checkForCommandChange(e,t){var n=this.findCommandNode(e),r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){var i=this.findCommandNode(r);if(null==n)n=i;else if(i!=n){var s=this.getPreviousTextNodeNoBlank(r,!1,e);return null==s&&null==(s=this.getPreviousTextNode(r,!1,e))?null:3==s.nodeType?new a(s,s.nodeValue.length,!1):new a(s,0,!0)}r=this.getNextNode(r,!1,t)}return null}getLangAttr(e){for(var t=e;null!=t;){if(1==t.nodeType){var n=t.getAttribute("lang");if(null!=n&&n.length>0)return n;try{if(null!=(n=t.getAttribute("xml:lang"))&&n.length>0)return n}catch(e){}}t=t.parentNode}return null}checkForVoiceChange(e,t,n){var r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){if(this.getLangAttr(r)!=n){var i=this.getPreviousTextNodeNoBlank(r,!1,e);if(null==i&&null==(i=this.getPreviousTextNode(r,!1,e)))return null;if(3==i.nodeType)return new a(i,i.nodeValue.length,!1);var s=new a(i,0,!0);return s.setSpecialCase(!0),s}r=this.getNextNode(r,!1,t)}return null}}class A{constructor(e,t,n){this.body=e,this.startRef=t,this.endRef=n}equals(e){return this.body==e.body&&this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}toString(){return null!=this.getAsRange()?g_bIEOld?this.getAsRange().text:this.getAsRange().toString():""}getAsRange(){var e=null;void 0!==this.body&&null!=this.body||(this.body=document.body),e=this.body.ownerDocument.createRange();var t=new L(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}clone(){return new A(this.body,this.startRef,this.endRef)}rw_getTHCaretRangeFromTHRange(){var e=new F;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new L;return r.setCaretRange(t,n),r}return null}rw_getTHRangeFromElement(e){if(null==e)return null;var t=new F,n=new E;if(t.isSpecialCaseNested(e)){var r=t.checkForSpecialParent(e);return new A(r.ownerDocument.body,t.rw_getRefPt(r,0),t.rw_getRefPt(r,0))}if(3==e.nodeType)return new A(e.ownerDocument.body,t.rw_getRefPt(e,0),t.rw_getRefPt(e,e.nodeValue.length));var i=n.getFirstChildTextNode(e,!0),a=n.getLastChildTextNode(e,!0),s=3==a.nodeType?a.nodeValue.length:0;return new A(e.ownerDocument.body,t.rw_getRefPt(i,0),t.rw_getRefPt(a,s))}}
//!*
//*! Used by safariReader
class R{constructor(e,t){this.path=e,this.offset=t}toString(){return"THDomRefPt "+this.path+" "+this.offset}getPath(){return this.path}getOffset(){return this.getOffset}}
//!*
class k{constructor(){}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}getSentenceFromPoint(e){if(null==e||null==e.node)return null;if(null!=e.node.tagName&&"img"==e.node.tagName.toLowerCase()){(t=new L).setCaretRange(e,e)}else{var t,n=this.getSentenceBreakToRight(e),r=this.getSentenceBreakToLeft(n);if(null==r||null==n)return null;(t=new L).setCaretRange(r,n)}return t}getNextSentence(e,t){var n=new E,r=new F;if(null==e)return null;void 0===t&&(t=null);var i,s,o=e.rightCaret.node,l=e.rightCaret.offset;if(r.rw_checkForHiddenParent(e.rightCaret.node))return null;for(e.rightCaret.isSpecialCase()&&(o=n.getNextNodeIgnoreChildren(o,!1,t),l=0);null!=o;){if(3==o.nodeType&&l<o.nodeValue.length){if(null==(i=this.getSentenceBreakToRight(new a(o,l,!1),t)))return null;if(i.node==o&&i.offset==l){if(null==(h=n.getNextTextNodeNoBlank(o,!1,t,this.mathSymbolControl)))return null;i=this.getSentenceBreakToRight(new a(h,0,!1),t)}}else{var h;if(null==(h=n.getNextTextNodeNoBlank(o,!1,t,this.mathSymbolControl)))return null;i=this.getSentenceBreakToRight(new a(h,0,!1),t)}if(null==(s=this.getSentenceBreakToLeft(i,null)))return null;if(e.leftCaret.node!=s.node||e.leftCaret.offset!=s.offset)if((g=new L).setCaretRange(s,i),this.checkSentence(g)&&r.rw_caretRangeIsSpeakable(g,this.mathSymbolControl))return g;if(3==(o=i.node).nodeType){var u=o.nodeValue.replace(/[\x21\x3f\x3a]/g,"."),d=u.indexOf(".",i.offset+1);l=-1==d?u.length:d}else if("MJX-CONTAINER"===o.nodeName){var g;if((g=new L).setCaretRange(i,i),this.checkSentence(g)&&r.rw_caretRangeIsSpeakable(g,this.mathSymbolControl))return g}}return null}checkSentence(e){for(var t=new l,n=e.leftCaret.node,r=n.ownerDocument.body;null!=n&&n!=r;){if(1==n.nodeType){if("rwDictDefin"==n.className||"rwPopupContent"==n.className||"rwToolbarBarCollect"==n.className)break;if(null!=t.rw_getAttribute(n,"rwTHcomp"))return!1}n=n.parentNode}var i=e.rightCaret.node;if(i!=n)for(;null!=i&&i!=r&&"rwDictDefin"!=i.className&&"rwPopupContent"!=i.className&&"rwToolbarBarCollect"!=i.className;){if(1==i.nodeType&&null!=t.rw_getAttribute(i,"rwTHcomp"))return!1;i=i.parentNode}return!0}getPreviousSentence(e,t){var n=new E,r=new F;void 0===t&&(t=null);for(var i,s,o=e.leftCaret.node,l=e.leftCaret.offset;null!=o;){if(3==o.nodeType){var h,u=o.nodeValue.replace(/[\x21\x3f\x3a]/g,".");for(h=l>0?u.lastIndexOf(".",l):0==l?-1:u.lastIndexOf(".");h>-1;){if(l=h,null==(s=this.getSentenceBreakToRight(new a(o,l,!0),t)))return null;if(s.node!=e.rightCaret.node||s.offset!=e.rightCaret.offset){if(null==(i=this.getSentenceBreakToLeft(s,t)))return null;if((d=new L).setCaretRange(i,s),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d,this.mathSymbolControl))return d}h=0==h?-1:u.lastIndexOf(".",h-1)}}l=-1;let g=n.getPreviousTextNodeNoImg(o,!0,t,!1,this.mathSymbolControl);if(null!=g)o=g;else if(null!=(o=n.getPreviousTextNodeNoBlank(o,!1,t,this.mathSymbolControl))){if(null==(s=3==o.nodeType?this.getSentenceBreakToRight(new a(o,o.nodeValue.length,!1),t):this.getSentenceBreakToRight(new a(o,0,!1),t)))return null;if(null==(i=this.getSentenceBreakToLeft(s,t)))return null;var d;if(s.node!=e.rightCaret.node||s.offset!=e.rightCaret.offset)if((d=new L).setCaretRange(i,s),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d,this.mathSymbolControl))return d}}return null}getSentenceBreakToLeft(e,t){var n=new E,r=new F,i=new o;if(void 0===t&&(t=null),null==e||null==e.node)return null;var s=e.node,l=e.offset;if(1==e.node.nodeType&&"math"==e.node.tagName.toLowerCase())return e;if(1==e.node.nodeType&&e.node.isMathJax)return e;if(r.hasCustomReadingAttribute(e.node))return new a(r.getCustomReadingElement(e.node),0,!0);if(e.forwardBias)3==s.nodeType&&l==s.nodeValue.length&&(l=0,null==(s=n.getNextTextNode(s,!0,t))&&(s=e.node,l=e.offset));else if(l>0)--l;else{if(null==(s=n.getPreviousTextNode(s,!0,t)))return e;if(3==s.nodeType)l=s.nodeValue.length-1;else{if(l=0,null!=s.tagName&&"math"==s.tagName.toLowerCase())return e;if(s.isMathJax)return e}}if(3==s.nodeType){var h=s.nodeValue.charAt(l);if("."==h||"!"==h||"?"==h||":"==h)if(l>0)--l;else{if(null==(s=n.getPreviousTextNode(s,!0,t)))return e;if(3==s.nodeType)l=s.nodeValue.length-1;else{if(l=0,null!=s.tagName&&"math"==s.tagName.toLowerCase())return e;if(s.isMathJax)return e}}}for(var u=s,d=l,g=s,c=l,m=!1,p=" ";!m;){if(r.isSpecialCaseNested(g)){if(null!=(g=r.checkForSpecialParent(g)).tagName&&"math"==g.tagName.toLowerCase()){m=!0;break}if(g.isMathJax){m=!0;break}if(r.hasCustomReadingAttribute(g)){u=n.getFirstChildTextNode(g,!1)||g,d=0,m=!0;break}u=g,d=0}else if(3==g.nodeType){if((S=g.nodeValue).length>0){-1==c&&(c=S.length);for(var f=(S=S.replace(/[\x21\x3f\x3a]/g,".")).lastIndexOf(".",c);f>-1;){if(r.rw_isFullStop(S,f,g)){if(f<S.length-1){u=g,d=f+1,m=!0;break}if(!r.rw_isTextChar(p)){m=!0;break}}f=0==f?-1:S.lastIndexOf(".",f-1)}if(m)break;i.trim(S).length>0&&(u=g,d=0),p=S.charAt(0)}}if(c=-1,null==(g=n.getPreviousNode(g,!0,t))){m=!0;break}if(3==g.nodeType&&r.isSpecialCaseNested(g)&&null==(g=r.checkForSpecialParent(g))){m=!0;break}}if(3==u.nodeType){var S;if(d<(S=u.nodeValue).length)for(;d<S.length&&r.rw_isWhiteSpace(S.charAt(d));)++d;0==i.trim(S).length&&(u=e.node)}return new a(u,d,!0)}getSentenceBreakToRight(e,t){var n=new E,r=new F,i=new o;if(void 0===t&&(t=null),null==e||null==e.node)return null;for(var s=e.node,l=e.offset,h=s,u=l,d=!1,g=" ";!d;){if(r.isSpecialCaseNested(s)){if(null!=(s=r.checkForSpecialParent(s)).tagName&&"math"==s.tagName.toLowerCase()){d=!0;break}if(s.isMathJax){d=!0;break}if(r.hasCustomReadingAttribute(s)){u=(h=n.getLastChildTextNode(r.getCustomReadingElement(s),!1)||r.getCustomReadingElement(s)).length||0,d=!0;break}h=s,u=0,s=n.getNextNodeIgnoreChildren(s,!0,t)}else if(3==s.nodeType){if((p=s.nodeValue).length>0){if("."==g){var c=p.charAt(l);if(!r.rw_isTextChar(c)){d=!0;break}}for(var m=(p=p.replace(/[\x21\x3f\x3a]/g,".")).indexOf(".",l);m>-1;){if(r.rw_isFullStop(p,m,s)){m<p.length-1&&(h=s,u=m+1,d=!0);break}l=m+1,m=p.indexOf(".",l)}if(d)break;i.trim(p).length>0&&(h=s,u=p.length),"."==(g=p.charAt(p.length-1))&&(r.rw_isFullStop(p,p.length-1,s)||(g=" "))}s=n.getNextNode(s,!0,t)}else s=n.getNextNode(s,!0,t);if(l=0,null==s){d=!0;break}}if(3==h.nodeType){var p=h.nodeValue;if(u>0&&u<=p.length)for(;u>0&&r.rw_isWhiteSpace(p.charAt(u-1));)--u;0==i.trim(p).length&&(h=e.node)}return new a(h,u,!1)}tagSentences(e){if(null!=e){var t=new E,n=new F,r=new l;try{for(var i=t.getNextNodeAllowMoveToChild(e,!1,e);null!=i;)if(3==i.nodeType){if("textarea"==i.parentNode.tagName.toLowerCase()){i=t.getNextNode(i,!1,e);continue}var a,s=i.nodeValue;if(!(s.trimSpaceTH().length>0)){i=t.getNextNode(i,!1,e);continue}a=s.search("[\\x21\\x2E\\x3F\\x3A]");var o=null!=r.rw_getAttribute(i.parentNode,"texthelpSkip");if(a>-1&&a<s.length-1){for(var h=!0;;){if(n.rw_isFullStop(s,a,i))break;var u=s.substring(a+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(u>-1)){h=!1;break}a=a+1+u}if(h){var d=s.substring(0,a+1),g=s.substring(a+1),c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var m=document.createTextNode(d),p=document.createTextNode(g);(f=i.parentNode).insertBefore(p,i),f.insertBefore(c,p),c.appendChild(m),f.removeChild(i),i=p,m}else{if(null!=i.previousSibling||null!=i.nextSibling||o){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");m=document.createTextNode(s);(f=i.parentNode).insertBefore(c,i),c.appendChild(m),f.removeChild(i),i=m}i,i=t.getNextNode(i,!1,e)}}else{if(null!=i.previousSibling||null!=i.nextSibling||o){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var f;m=document.createTextNode(s);(f=i.parentNode).insertBefore(c,i),c.appendChild(m),f.removeChild(i),i=m}i,i=t.getNextNode(i,!1,e)}}else if(1==i.nodeType){var S=r.rw_getAttribute(i,"rwTHcomp"),v=r.rw_getAttribute(i,"rwDontAlter"),w=r.rw_getAttribute(i,"rwstate");"pre"==i.tagName.toLowerCase()||"button"==i.tagName.toLowerCase()||null!=S&&S.length>0||null!=v&&v.length>0||null!=w&&w.length>0?(i=t.getNextNodeIgnoreChildren(i,!1,e),!0):i=t.getNextNode(i,!1,e)}else i=t.getNextNode(i,!1,e)}catch(e){}}}getSentenceBreakPoint(e){const t=new F;let n=-1;if("string"!=typeof e||0===e.length)return n;let r=e;for(-1===r.indexOf(".")&&(r+="."),r=r.replace(/[\x21\x3f\x3a]/g,"."),n=r.indexOf(".");n>-1&&!t.rw_isFullStop(r,n,null);)n=r.indexOf(".",n+1);return n}}const M={isIgnorePageDefault:()=>!1};class P{constructor(){this.hexcase=0,this.b64pad="",this.chrsz=8}hex_md5(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}core_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,s=0;s<e.length;s+=16){var o=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[s+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[s+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[s+2],17,606105819),r=this.md5_ff(r,i,a,n,e[s+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[s+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[s+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[s+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[s+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[s+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[s+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[s+10],17,-42063),r=this.md5_ff(r,i,a,n,e[s+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[s+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[s+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[s+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[s+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[s+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[s+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[s+11],14,643717713),r=this.md5_gg(r,i,a,n,e[s+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[s+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[s+10],9,38016083),i=this.md5_gg(i,a,n,r,e[s+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[s+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[s+9],5,568446438),a=this.md5_gg(a,n,r,i,e[s+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[s+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[s+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[s+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[s+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[s+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[s+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[s+5],4,-378558),a=this.md5_hh(a,n,r,i,e[s+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[s+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[s+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[s+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[s+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[s+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[s+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[s+13],4,681279174),a=this.md5_hh(a,n,r,i,e[s+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[s+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[s+6],23,76029189),n=this.md5_hh(n,r,i,a,e[s+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[s+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[s+15],16,530742520),r=this.md5_hh(r,i,a,n,e[s+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[s+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[s+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[s+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[s+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[s+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[s+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[s+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[s+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[s+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[s+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[s+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[s+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[s+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[s+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[s+2],15,718787259),r=this.md5_ii(r,i,a,n,e[s+9],21,-343485551),n=this.safe_add(n,o),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return Array(n,r,i,a)}md5_cmn(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}md5_ff(e,t,n,r,i,a,s){return this.md5_cmn(t&n|~t&r,e,t,i,a,s)}md5_gg(e,t,n,r,i,a,s){return this.md5_cmn(t&r|n&~r,e,t,i,a,s)}md5_hh(e,t,n,r,i,a,s){return this.md5_cmn(t^n^r,e,t,i,a,s)}md5_ii(e,t,n,r,i,a,s){return this.md5_cmn(n^(t|~r),e,t,i,a,s)}safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}bit_rol(e,t){return e<<t|e>>>32-t}str2binl(e){for(var t=Array(),n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}binl2hex(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}$rw_hash(e){return this.hex_md5(e)}}class I{constructor(e,t,n,r){let i=e.getRootNode();this.body=e.ownerDocument.body,i.mode&&"open"==i.mode&&(this.body=i),this.startCaret=new a(e,t,!0),this.endCaret=new a(n,r,!1),this.startRef=this.rw_getRefPt(e,t),this.endRef=this.rw_getRefPt(n,r)}getPositionInDom(e){var t=new F,n=new l,r="",i=0,a="";if(null!=e&&null!=e.ownerDocument){var s=!1,o=!1,h=e.ownerDocument.body;let l=e;for(;null!=l.parentNode;)l=l.parentNode;for(l.mode&&"open"==l.mode&&(h=l);null!=e&&e!=h;){t.isSpecialCase(e)&&(r=""),s=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==p&&null!=n.rw_getAttribute(e,"rwstate");for(var u=e.previousSibling;null!=u;)o=3==u.nodeType||1==u.nodeType&&u.tagName.toLowerCase()==p&&null!=n.rw_getAttribute(u,"rwstate"),s&&o||++i,u=u.previousSibling,s=o;if(r=r+i+"~",i=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var d=n.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==d)a="#^th*"+n.getPositionInDom(e)+"#^th*"}}}return a+r}rw_getRefPt(e,t){var n=new F,r=new l;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var i,a,s=n.checkForSpecialParent(e);if(null!=s)return new R(this.getPositionInDom(s),t);1==e.nodeType?(i=0,a=e):(i=this.getNodeOffset_(e),a=e.parentNode);for(var o=r.rw_getAttribute(a,"rwstate"),h=r.rw_getAttribute(a,"rwTHgen");null!=o&&o.length>0||null!=h;)i+=this.getNodeOffset_(a),a=a.parentNode,o=r.rw_getAttribute(a,"rwstate"),h=r.rw_getAttribute(a,"rwTHgen");return-1==t&&(i=-1),new R(this.getPositionInDom(a),i+t)}return null}catch(e){return null}}getNodeOffset_(e){var t=new F;if(null==e)return 0;var n=0,r=e.previousSibling;return null!=r&&(n=t.rw_getNodeOffsetImpl(r)),n}refresh(){if(0==this.startCaret.check()||0==this.endCaret.check()){var e=new L(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);this.startCaret=e.leftCaret,this.endCaret=e.rightCaret,null==this.startCaret&&null==this.endCaret?(this.startCaret=new a(document.body,0,!0),this.endCaret=new a(document.body,0,!1)):null!=this.startCaret&&null!=this.endCaret||(null==this.startCaret?this.startCaret=new a(this.endCaret.node,this.endCaret.offset,!0):this.endCaret=new a(this.startCaret.node,this.startCaret.offset,!1))}}toString(){new F;if("INPUT"==this.startCaret.node.nodeName||"TEXTAREA"==this.startCaret.node.nodeName)return this.startCaret.node.value.substring(this.startCaret.node.selectionStart,this.startCaret.node.selectionEnd);this.refresh();let e=new L;return e.setCaretRange(this.startCaret,this.endCaret),e.getTextSpokenOverCaretRange(e)}toSentences(){new F;let e=new Array;if("INPUT"==this.startCaret.node.nodeName||"TEXTAREA"==this.startCaret.node.nodeName)return e.push({text:this.startCaret.node.value.substring(this.startCaret.node.selectionStart,this.startCaret.node.selectionEnd),node:this.startCaret.node}),e;this.refresh();let t=new L;return t.setCaretRange(this.startCaret,this.endCaret),t.getSentenceOverCaretRange(t)}getRangeObject(e){return void 0!==e&&null!=e||(e=document.body),e.ownerDocument.createRange()}getStartAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.startCaret.node,this.startCaret.offset),e.setEnd(this.startCaret.node,this.startCaret.offset),e}getEndAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.endCaret.node,this.endCaret.offset),e.setEnd(this.endCaret.node,this.endCaret.offset),e}equals(e){return this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}compareRange(e){if(this.equals(e))return 0;this.refresh(),e.refresh();var t=this.getStartAsRange(),n=this.getEndAsRange(),r=e.getStartAsRange(),i=e.getEndAsRange();try{var a=t.compareBoundaryPoints("START_TO_START",r),s=t.compareBoundaryPoints("START_TO_START",i),o=n.compareBoundaryPoints("START_TO_START",r),l=n.compareBoundaryPoints("START_TO_START",i)}catch(e){return 1}return s>-1?i.endOffset==i.endContainer.length&&0==t.startOffset&&i.endContainer.parentNode.nextSibling==t.startContainer?5:1:o<1?n.endOffset==n.endContainer.length&&0==r.startOffset&&n.endContainer.nextSibling==r.startContainer?6:2:-1==a?-1==l?6:3:0==a?-1==l?7:0==l?0:3:-1==l?4:0==l?8:5}rw_getTextFromRange(){return this.text?this.text:this.toString()}rw_getTHCaretRangeFromTHDomRange(){var e=new F;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new L;return r.setCaretRange(t,n),r}return null}getAsRange(){var e=null;e=this.getRangeObject(this.body);var t=new L(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}}class F{constructor(){s(this,"hasCustomReadingAttribute",(function(e){if(!h.customReadingAttribute)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;let t=new l,n=e.ownerDocument.body,r=e;for(;null!=r&&1==r.nodeType;){let e=!1,i=h.customReadingRules;for(let n in i)!h.customReadingAttribute||null==t.rw_getAttribute(r,i[n].read)||"*"!==i[n].type&&null==t.rw_getAttribute(r,i[n].type)||"*"!==i[n].value&&-1===t.rw_getAttribute(r,i[n].type).indexOf(i[n].value)||"*"!=i[n].element&&r.tagName.toLowerCase()!=i[n].element.toLowerCase()||(e=!0);if(e)return!0;if(r==n)break;r=r.parentNode}return!1})),s(this,"getCustomReadingAttribute",(function(e){if(!h.customReadingAttribute)return null;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;let t=new l,n=e.ownerDocument.body,r=e;for(;null!=r&&1==r.nodeType;){let e=h.customReadingRules;for(let n in e)if(h.customReadingAttribute&&null!=t.rw_getAttribute(r,e[n].read)&&("*"===e[n].type||null!=t.rw_getAttribute(r,e[n].type))&&("*"===e[n].value||-1!==t.rw_getAttribute(r,e[n].type).indexOf(e[n].value))&&("*"==e[n].element||r.tagName.toLowerCase()==e[n].element.toLowerCase()))return t.rw_getAttribute(r,e[n].read);if(r==n)break;r=r.parentNode}return null})),s(this,"getCustomReadingElement",(function(e){if(!h.customReadingAttribute)return null;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;let t=new l,n=e.ownerDocument.body,r=e;for(;null!=r&&1==r.nodeType;){let e=h.customReadingRules;for(let n in e)if(h.customReadingAttribute&&null!=t.rw_getAttribute(r,e[n].read)&&("*"===e[n].type||null!=t.rw_getAttribute(r,e[n].type))&&("*"===e[n].value||-1!==t.rw_getAttribute(r,e[n].type).indexOf(e[n].value))&&("*"==e[n].element||r.tagName.toLowerCase()==e[n].element.toLowerCase()))return r;if(r==n)break;r=r.parentNode}return null})),s(this,"hasAriaRoleMathWithLabel",(function(e){if(!h.ariaLabelOnMathRoleEnabled&&!h.ariaLabelOnMathJaxClassEnabled)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new l,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var s=t.rw_getAttribute(a,n),o=t.rw_getAttribute(a,r),u=!1;if(h.ariaLabelOnMathJaxClassEnabled&&null!=t.rw_getAttribute(a,"class")&&-1!==t.rw_getAttribute(a,"class").indexOf("mjx-chtml")&&(u=!0),(null!=s&&"math"==s&&h.ariaLabelOnMathRoleEnabled||u)&&null!=o)return!0;if(a==i)break;a=a.parentNode}return!1})),s(this,"getAriaRoleMathWithLabel",(function(e){if(!h.ariaLabelOnMathRoleEnabled&&!h.ariaLabelOnMathJaxClassEnabled)return null;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;for(var t=new l,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var s=t.rw_getAttribute(a,n),o=t.rw_getAttribute(a,r),u=!1;if(h.ariaLabelOnMathJaxClassEnabled&&null!=t.rw_getAttribute(a,"class")&&-1!==t.rw_getAttribute(a,"class").indexOf("mjx-chtml")&&(u=!0),(null!=s&&"math"==s&&h.ariaLabelOnMathRoleEnabled||u)&&null!=o)return o;if(a==i)break;a=a.parentNode}return null})),s(this,"checkRangeForMathElement",(function(e){var t,n,r=e;return null!=r.startCaret.node&&(t=this.getParentMathElementFromNode(r.startCaret.node)),null!=r.endCaret.node&&(n=this.getParentMathElementFromNode(r.endCaret.node)),null!=t?r=new I(t,0,t,0):null!=n&&(r=new I(n,0,n,0)),r})),s(this,"getParentMathElementFromNode",(function(e){if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;for(var t,n=e.ownerDocument.body,r=e;null!=r&&1==r.nodeType;){if(!r.isMathJax&&!r.nodeName.startsWith("MJX"))return t;if(r==n)break;t=r,r=r.parentNode}return null})),s(this,"isAriaHidden",(function(e){if(h.overrideAriaHidden)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new l,n=t.ARIA_HIDDEN_ATTR,r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,n))return!0;if(i==r)break;i=i.parentNode}return!1})),s(this,"isElementContainedByElement",(function(e,t){if(null==t||1!=t.nodeType||null==e||1!=e.nodeType&&3!=e.nodeType)return!1;if(e==t)return!0;for(var n=e,r=n.ownerDocument.body;null!=n&&n!=r;)if((n=n.parentNode)==t)return!0;return!1})),s(this,"getTargetElement",(function(e){return h.g_bIE?e.srcElement:(h.g_bSafari,e.target)})),s(this,"getClickPoint",(function(e){var t,n=null;if(h.g_bIE){if(1==(t=e.srcElement).nodeType&&"textarea"==t.tagName.toLowerCase());else if(null!=(n=this.rw_getTargetNodeAsCaretIE(e,!0))){if(null==n.node||null==n.node.parentNode||n.node.parentNode!=t)return n=null,null;3==n.node.nodeType&&(n.node=this.mergeTextNodes(n.node))}}else if(null!=(t=e.target))if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){t.firstChild.nodeValue.trimTH().length>0&&(t=t.firstChild)}else{if("thstickynote"==t.tagName.toLowerCase())return;if("textarea"!=t.tagName.toLowerCase()){var r=t.firstChild,i=this.getNextTextNodeNoImg(r,!1,t,!1);if(null!=i&&3==i.nodeType)i.nodeValue.trimTH().length>0&&(t=i)}}return null==n&&null!=t&&(n=new a(t,0,!0)),n})),s(this,"getListOfNodes",(function(e,t){let n=new E;var r=new Array;try{var i=e.node,a=t.node;if(i==a)r.push(i);else{r.push(i);for(var s=n.getNextTextNode(i,!1,a,!0);null!=s;)r.push(s),s=n.getNextTextNodeNoImg(s,!1,a,!0)}}catch(e){thLog("getListOfNodes error:"+e.message)}return r})),s(this,"getDropdownSelectedItem",(function(e){for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].selected)return e.childNodes[t].textContent;return null}))}checkForSpecialParent(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return n;n=n.parentNode}return null}getBody(e){if(e.document)return e.document.body;{let t=e.ownerDocument.body,n=e.getRootNode();return n.mode&&"open"==n.mode&&(t=n),t}}isSpecialCase(e){if(null==e)return!1;var t=new l;if(1==e.nodeType){var n=e.tagName.toLowerCase();if(n==p||"span"==n||"thspan"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk")))return!0;if(null!=(r=e.isMathJax)&&r)return!0}else if("acronym"==n||"abbr"==n){if(null!=(r=e.getAttribute("title")))return!0}else{if("chunk"==n)return!0;if("img"==n||"svg"==n){var r;if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else{if("math"==n||n.startsWith("mjx"))return!0;if(this.hasCustomReadingAttribute(e))return!0}}}return!1}isSpecialCaseHighlightable(e){var t=new l;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n||"thspan"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk"))&&"1"==r)return!0;if(null!=(r=e.isMathJax)&&r)if((new m).getMathMLText(e).length>0)return!0}else if("acronym"==n||"abbr"==n){var r;if(null!=(r=e.getAttribute("title")))return!0}else{if("math"==n)return!1;if(n.startsWith("mjx"))return!0;if(this.hasCustomReadingAttribute(e))return!1}}return!1}checkIfElementInsideElement(e,t){if(null==e||null==t)return!1;for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}isSpecialCaseWithIgnoredContent(e){var t=new l;if(null==e)return!1;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){if(null!=(r=e.isMathJax)&&r)return!0}else{if("textarea"==n)return!0;if("img"==n||"svg"==n){var r;if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else{if("math"==n)return!0;if(n.startsWith("mjx"))return!0}}}return!1}rw_isWordSpeakable(e,t){if(null==e||0==e.length)return!1;var n=(new o).trim(e);if(1==n.length){var r=n.charCodeAt(0);if(96==r||180==r||8216==r||8217==r||8220==r||8221==r)return!1}var i,a=n.length,s=0;for(s=0;s<a;s++){if((i=n.charCodeAt(s))>63&&i<91||i>96&&i<123||i>127&&160!=i&&8221!=i&&8220!=i)return!0;if(i>46&&i<58)return!0;if(i>35&&i<39||43==i||61==i)return!0;if(42==i||45==i||92==i||i>93&&i<97)return!0}return!(!h.bMathsSymbols||void 0===t||"function"!=typeof t.mathsSymbolCheck||!t.mathsSymbolCheck(n))}createWrapperElement(){return this.createObject(f,null,null,S)}createObject(e,t,n,r){return this.createObjectForDoc(e,t,n,r,document)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var s=t.length,o=0;o<s;o+=2)a.setAttribute(t[o],t[o+1]);return a}isStyleNode(e){var t=new l;if(null==e)return!1;if(1!=e.nodeType)return 3==e.nodeType||8==e.nodeType;var n=e.tagName.toLowerCase().trimTH();if(n==p){var r=t.rw_getAttribute(e,"started");if(null!=r&&"1"==r)return!1}return this.isInStyleList(n)}isInvalidNode(e){if(null==e)return!0;if(1!=e.nodeType)return 3!=e.nodeType||this.isInvalidNode(e.parentNode);if(h.ignoreHidden){var t=this.getComputedStyle(e);if(null!=t&&("hidden"==t.visibility||"none"==t.display))return!0}var n=e.tagName.toLowerCase();return"link"==n||"area"==n||"script"==n||"noscript"==n||"annotation"==n||"style"==n||"!--"==n||"title"==n||"html:script"==n}getComputedStyle(e){return null==e||3==e.nodeType&&null==(e=e.parentNode)?null:window.getComputedStyle(e,null)}isIgnored(e){var t=new l;if(h.bOverrideIgnore)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var n=t.IGNORE_ATTR,r=t.ALLOW_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){if(null!=t.rw_getAttribute(a,n))return!0;if(null!=t.rw_getAttribute(a,r))return!1;if("button"==a.tagName.toLowerCase())return!1;if(a==i)break;a=a.parentNode}return!1}allTextFromNodeTH(e){var t="";if(3==e.nodeType)t=e.nodeValue;else if(1==e.nodeType)for(var n=e.firstChild;null!=n;)3==n.nodeType?t+=n.nodeValue:1==n.nodeType&&(t+=this.allTextFromNodeTH(n)),n=n.nextSibling;return t}mergeTextNodes(e){if(null==e)return e;var t=e.parentNode;if(null!=t&&3==e.nodeType){for(var n=e.ownerDocument;null!=e.previousSibling&&3==e.previousSibling.nodeType;){var r=e.previousSibling.nodeValue+e.nodeValue,i=n.createTextNode(r);t.removeChild(e.previousSibling),t.replaceChild(i,e),e=i}for(;null!=e.nextSibling&&3==e.nextSibling.nodeType;){r=e.nodeValue+e.nextSibling.nodeValue,i=n.createTextNode(r);t.removeChild(e.nextSibling),t.replaceChild(i,e),e=i}}return e}rw_reduceSelectionForNonSpeechChar(e){var t=new E,n=!1,r=e.rightCaret.node,i=e.rightCaret.offset,s=e.leftCaret.node,o=e.leftCaret.offset;try{var l,h;if(!e.rightCaret.isSpecialCase())for(var u=r.nodeValue;;){if(0==i){if(null==(l=t.getPreviousTextNode(r,!1,s)))break;if(1==l.nodeType){r=l,i=0,n=!0;break}i=(u=(r=l).nodeValue).length,n=!0}if(r==s&&i==o)break;if(!(i>0))break;if(h=u.charAt(i-1),!this.rw_isWhiteSpace(h))break;--i,n=!0}if(!e.leftCaret.isSpecialCase())for(var d=s.nodeValue,g=d.length;;){if(o==g){if(null==(l=t.getNextTextNode(s,!1,r)))break;if(1==l.nodeType){s=l,o=0,g=0,n=!0;break}d=(s=l).nodeValue,o=0,g=d.length,n=!0}if(r==s&&i==o)break;if(!(o<g))break;if(h=d.charAt(o),!this.rw_isWhiteSpace(h))break;++o,n=!0}}catch(e){}return n?new L(new a(s,o,!0),new a(r,i,!1)):e}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}getSentenceFromPointByLang(e){var t=new k,n=t.getSentenceBreakToRight(e),r=t.getSentenceBreakToLeft(n),i=new L;return i.setCaretRange(r,n),i}isSpecialCaseNested(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return!0;n=n.parentNode}return!1}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isFullStop(e,t,n){var r=new E,i=!0;if(e.length>t+1){var a=e.charCodeAt(t+1);this.rw_isTextChar(a)&&(i=!1),h.bMathsSymbols&&61==a&&mathsSymbolCheck("!=")&&null!=n&&"!"==n.nodeValue.charAt(t)&&(i=!1)}if(i&&null!=n&&"."!=n.nodeValue.charAt(t))return!0;if(i)if(t>1){var s=e.substring(t-2,t);if((" "==s.charAt(0)||"\n"==s.charAt(0)||"\r"==s.charAt(0)||"\t"==s.charAt(0))&&s.charCodeAt(1)>63&&s.charCodeAt(1)<91)i=!1;else if("."==s.charAt(0)&&this.rw_isTextChar(s.charCodeAt(1)))i=!1;else if("Dr"==s||"Mr"==s||"Ms"==s||"Av"==s||"St"==s||"eg"==s)i=!1;else if(t>2){var o=e.substring(t-3,t);if("Mrs"==o||"etc"==o||"i.e"==o||"P.O"==o||"PhD"==o)i=!1;else if(t>3){"Ph.D"==e.substring(t-4,t)&&(i=!1)}}}else try{if(null!=n&&0==t){var l=r.getPreviousTextNode(n,!0,null);if(null!=l&&3==l.nodeType&&l!=n)return!!this.rw_isFullStop(l.nodeValue+e,l.nodeValue.length,null)}}catch(e){}return i}rw_caretRangeIsSpeakable(e,t){var n=new E;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return!1;if(e.leftCaret.node.nodeName.startsWith("MJX"))return!0;if(this.rw_checkForHiddenParent(e.leftCaret.node))return!1;let d=this.checkForSpecialParent(e.leftCaret.node);d&&this.hasCustomReadingAttribute(d)&&(e.leftCaret.node=d,e.rightCaret.node=d);for(var r=e.leftCaret,i=e.rightCaret,a=r.node,s=i.node,o=!0,l=!1,h=a;null!=h;){if((l=this.isSpecialCase(h))||3==h.nodeType){var u=n.getTextFromNode(h);if(null!=u&&""!=u&&(l||(h==s&&i.offset>-1&&(u=u.substring(0,i.offset)),h==a&&r.offset>0&&(u=u.substring(r.offset))),this.rw_isWordSpeakable(u,t)))return!0}h=l?n.getNextNodeIgnoreChildren(h,!1,s):o?n.getNextNodeAllowMoveToChild(h,!0,s):n.getNextNode(h,!1,s),o=!1}}catch(e){}return!1}rw_checkForHiddenParent(e){try{var t=this.getComputedStyle(e);if(null!=t&&("none"==t.display||"hidden"==t.visibility))return!0;for(var n=e,r=n.ownerDocument.body;n!=r;)if(n=n.parentNode,"none"==this.getComputedStyle(n).display)return!0}catch(e){}return!1}rw_getRefPt(e,t){var n=new l;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var r,i,a=this.checkForSpecialParent(e);if(null!=a)return new R(this.getPositionInDom(a),t);1==e.nodeType?(r=0,i=e):(r=this.rw_getNodeOffset(e),i=e.parentNode);for(var s=n.rw_getAttribute(i,"rwstate"),o=n.rw_getAttribute(i,"rwTHgen");null!=s&&s.length>0||null!=o;)r+=this.rw_getNodeOffset(i),i=i.parentNode,s=n.rw_getAttribute(i,"rwstate"),o=n.rw_getAttribute(i,"rwTHgen");return-1==t&&(r=-1),new R(this.getPositionInDom(i),r+t)}return null}catch(e){return null}}rw_getNodeOffset(e){if(null==e)return 0;var t=0,n=e.previousSibling;return null!=n&&(t=this.rw_getNodeOffsetImpl(n)),t}getPositionInDom(e){var t=new l,n="",r=0,i="";if(null!=e&&null!=e.ownerDocument){var a=!1,s=!1,o=e.ownerDocument.body;let l=e.getRootNode();for(l.mode&&"open"==l.mode&&(o=l);null!=e&&e!=o;){this.isSpecialCase(e)&&(n=""),a=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==p&&null!=t.rw_getAttribute(e,"rwstate");for(var h=e.previousSibling;null!=h;)s=3==h.nodeType||1==h.nodeType&&h.tagName.toLowerCase()==p&&null!=t.rw_getAttribute(h,"rwstate"),a&&s||++r,h=h.previousSibling,a=s;if(n=n+r+"~",r=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var u=t.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==u)i="#^th*"+this.getPositionInDom(e)+"#^th*"}}}return i+n}rw_getBreakInCurrentWord(e){if(null==e||0==e.length)return-1;let t=new Array;t.push(this.extractProbablePhoneNumbers(e)),t.push(this.extractProbablePostcode(e)),t.push(this.containsTempSymbol(e)),t=t.filter(e=>null!=e);let n=e.search("["+String.fromCharCode(8212)+"\\s]");if(null!=t&&t.length>0){let r=this.checkForFirstInstance(e,t);n>r.index&&n<r.length&&(n=r.length)}return n}rw_isLetter(e){return e>64&&e<91||e>96&&e<123}rw_getNodeOffsetImpl(e){for(var t=0,n=e;null!=n;)3!=n.nodeType||this.isIgnored(n)||this.isAriaHidden(n)?1==n.nodeType&&(this.isInvalidNode(n)||(this.isSpecialCase(n)?t+=1:"textarea"!=n.tagName.toLowerCase()?t+=this.rw_getNodeOffsetImpl(n.lastChild):t+=1)):t+=n.nodeValue.length,n=n.previousSibling;return t}rw_getCaretFromRefPt(e,t){return this.getCaretFromDomPosition(e,t.path,t.offset,!0)}getCaretFromDomPosition(e,t,n,r,i){var s=new E;void 0===i&&(i=!1);try{if(null==e)return null;var o=s.getNodeFromPosition(e,t);if(i){var l=new a(o,0,r);return l.setSpecialCase(!0),l}var h=this.checkForSpecialParent(o);if(null!=h){if(o=h,this.isSpecialCaseHighlightable(h)){if(r){var u=s.getFirstChildTextNode(o,!1);return new a(null!=u?u:o,0,r)}return null!=(c=s.getLastChildTextNode(o,!1))?3==c.nodeType?new a(c,c.length,r):new a(c,0,r):new a(o,0,r)}return new a(h,0,r)}var d=0;if(r||++d,n>-1){if(null==o)return null;for(var g=!1,c=o.parentNode,m=o;!g;){if(3==o.nodeType){if(n<d+o.nodeValue.length){g=!0;break}m=o,d+=o.nodeValue.length,o=s.getNextNode(o,!1,c)}else if(1==o.nodeType)if(null!=(h=this.checkForSpecialParent(o))){if(o=h,!(n-d>0)){g=!0;break}d+=1,o=s.getNextNodeIgnoreChildren(o,!1,c)}else o=s.getNextNode(o,!1,c);if(null==o||o==c){if(null!=m){d=3==(o=m).nodeType?n-o.nodeValue.length:0,r||++d;break}return null}}return new a(o,r?n-d:n-(d-1),r)}return new a(o,n,r)}catch(e){return null}}getNodesOverRange(e,t){var n=new E,r=[];if(null==e||null==t)return r;for(var i=e;i;)this.isInvalidNode(i)?i=n.getActualNextNodeIgnoreChildren(i,t):(this.isIgnored(i)||this.isAriaHidden(i)||r.push(i),i="MJX-CONTAINER"==i.tagName||i.isMathJax?n.getActualNextNodeIgnoreChildren(i,t):n.getActualNextNode(i,t));return r}getWindow(e){try{if(null==e)return window;if(0===top.frames.length)return window;var t=e.ownerDocument.body;if(t===window.document.body)return window;if(!h.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.body;if(i===t)return top.frames[n];if(i.getElementsByTagName("iframe").length>0)for(var a=0;a<i.getElementsByTagName("iframe").length;a++)try{if(i.getElementsByTagName("iframe")[a].contentDocument.body===t)return i.getElementsByTagName("iframe")[a]}catch(e){}}catch(e){}}}catch(e){}return window}rw_getTextRangeAsTHRange(e,t){var n=t.duplicate();n.collapse(!0);var r=rw_getTextRangeAsRefPtIE(e,n);(n=t.duplicate()).collapse(!1);var i=rw_getTextRangeAsRefPtIE(e,n);return new A(e,r,i)}rw_getAsTextRange(e,t,n,r,i){var a=this.getRangeObject(e),s=new L(e,t,-1,r,-1),o=s.leftCaret,l=s.rightCaret;if(null!=o&&null!=o.node&&null!=l&&null!=l.node){var h=o.node;if(3==h.nodeType){var u=this.rw_getNodeOffset(h);h=h.parentNode,n+=u}var d=l.node;if(3==d.nodeType){u=this.rw_getNodeOffset(d);d=d.parentNode,i+=u}a.moveToElementText(h),a.collapse(),rw_moveEnd(a,n),a.collapse(!1),a.select();var g=this.getRangeObject(e);g.moveToElementText(d),g.collapse(),rw_moveEnd(g,i),g.collapse(!1),a.setEndPoint("EndToEnd",g)}else a=null;return a}rw_collapseSelection(){var e=this.getSelectionObject();null!=e&&(e.collapseToStart?e.collapseToStart():e.execCommand&&e.execCommand("UnSelect",!1,null))}getSelectionObject(){var e=null;if(window.getSelection){var t=window.getSelection(),n=null;if(t.isCollapsed?(t=this.getFrameSelectionSFF(window)).foundSel&&(n=t.foundSel):n=t,null==n)return null;e=n}else if(document.selection){var r=document.selection.createRange();if(r.text.length>0)theWindow=window,e=r;else{var i=this.getFrameSelectionOldIE(window);i.theRange&&(e=i.theRange)}}return e}getFrameSelectionOldIE(e){var t,n={};if(!h.ignoreFrames&&e.frames&&e.length>0){var r,i=e.length;for(r=0;r<i;r++)try{var a=e[r];if(null!=(t=a.document.selection.createRange())&&null!=t.text&&t.text.length>0){n.theWindow=a,n.theRange=t;break}if(a.length>0){var s=this.getFrameSelectionOldIE(a);if(s.theRange){n=s;break}}}catch(e){}}return n}getFrameSelectionSFF(e){var t={},n=this.getFrameSelection(e);return null!=n&&(t.theWindow=n,t.foundSel=n.getSelection()),t}getFrameSelection(e){if(!h.ignoreFrames&&e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{var r=e[t].getSelection();if(null!=r&&!r.isCollapsed)return e[t];if(e[t].document.getElementsByTagName("textarea").length>0)for(var i=e[t].document.getElementsByTagName("textarea"),a=0;a<i.length;a++)if(i[a].selectionStart!=i[a].selectionEnd)return e[t];if(e[t].length>0){var s=this.getFrameSelection(e[t]);if(s)return s}}catch(e){}}return null}getFrameSelectionInTextAreas(e){return this.getFrameSelectionInTextarea(e)}getFrameSelectionInTextarea(e){if(!h.ignoreFrames&&e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{if(e[t].document.getElementsByTagName("textarea").length>0)for(var r=e[t].document.getElementsByTagName("textarea"),i=0;i<r.length;i++)if(r[i].selectionStart!=r[i].selectionEnd)return{frame:e[t],textArea:r[i]};if(e[t].document.getElementsByTagName("input").length>0)for(var a=e[t].document.getElementsByTagName("input"),s=0;s<a.length;s++)if(a[s].selectionStart!=a[s].selectionEnd)return{frame:e[t],textArea:a[s]}}catch(e){}}return null}isLineBreakNode(e){if(1!=e.nodeType)return!1;var t=e.tagName.toLowerCase().trimTH();return this.isInBreakList(t)}isInBreakList(e){return v.includes(e)}isInStyleList(e){return w.includes(e)}isAriaHidden(e){let t=new l;if(h.overrideAriaHidden)return!1;var n=M.isIgnorePageDefault();if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,"aria-hidden"))return!0;if(i==r)break;i=i.parentNode}return n}rw_getUniqueIdForTextNode(e,t){if(null!=e&&3==e.nodeType){var n=e.ownerDocument.body,r=e.nodeValue;if(null!=r){r=r.replace(/\s+/g,"");for(var i=e.parentNode;null!=i&&null!=i.parentNode;){if(null!=(i=i.parentNode).id&&i.id.length>0&&"rwTH"!=i.id.substr(0,4)){r=i.id+r;break}if(i==n)break}null!=t&&(r=t+r);var a="rwTH"+(new P).hex_md5(r);if(null!=this.rw_getElementQuerySelector("[data-ss-id="+a+"]")){for(var s=1;null!=this.rw_getElementQuerySelector("[data-ss-id="+a+s+"]");)++s;a+=s}return a}}return null}rw_getElementById(e){var t=document.getElementById(e);if(null==t){if(!h.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.getElementById(e);if(null!=i)return i}catch(e){}}return null}return t}rw_getElementQuerySelector(e){var t=document.querySelector(e);if(null==t){if(!h.ignoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.querySelector(e);if(null!=i)return i}catch(e){}}return null}return t}rw_getSelection(){var e=null,t=null,n=new E;if(h.g_bIEOld){if(null==(l=document.selection.createRange())||null==l.text||0==l.text.length)(o=this.getFrameSelectionOldIE(window)).theRange&&(e=o.theWindow,t=o.theRange);else e=window,t=l;if(null!=t){var r=t.duplicate();r.collapse();var i=r.parentElement();(this.isIgnored(i)||this.isAriaHidden(i))&&(t=null)}null!=t&&null!=t.parentElement()&&"input"==t.parentElement().tagName.toLowerCase()&&(t=new String(t.text))}else{null!=h.g_ipadSelectionRange&&h.g_ipadSelectionWindow.getSelection().addRange(h.g_ipadSelectionRange);var a=window.getSelection(),s=null;if(!a.isCollapsed&&a.toString().trimTH().length>0)e=window,s=a;else{if(h.g_lastInputSelectSFF&&h.g_lastInputSelectSFF.selectionStart!=h.g_lastInputSelectSFF.selectionEnd)return{frame:window,range:new String(h.g_lastInputSelectSFF.value.substring(h.g_lastInputSelectSFF.selectionStart,h.g_lastInputSelectSFF.selectionEnd))};var o;(o=this.getFrameSelectionSFF(window)).foundSel&&(e=o.theWindow,s=o.foundSel)}if(null==s)return null;if(s.anchorNode&&(this.isIgnored(s.anchorNode)||this.isAriaHidden(s.anchorNode)&&!s.anchorNode.parentNode.isMathJax&&!s.anchorNode.parentNode.nodeName.startsWith("MJX")))return null;if(s.focusNode&&s.focusNode.id&&"flashcontent"==s.focusNode.id)return null;if(null!=s.anchorNode&&s.anchorNode==s.focusNode&&s.anchorOffset==s.focusOffset)return null;var l,u=null;if(s.getRangeAt)if(s.rangeCount>1){for(var d=[],g=0;g<s.rangeCount;g++)d[g]=s.getRangeAt(g);(u={}).startContainer=d[0].startContainer,u.startOffset=d[0].startOffset,u.endContainer=d[s.rangeCount-1].endContainer,u.endOffset=d[s.rangeCount-1].endOffset}else u=s.getRangeAt(0);else null!=(l=n.getRangeObject())&&(s.anchorNode==s.focusNode&&s.anchorOffset==s.focusOffset?l=n.getRangeFromSelectionPoint(s):(l.setStart(s.anchorNode,s.anchorOffset),l.setEnd(s.focusNode,s.focusOffset),0==l.toString().length&&(l.setStart(s.focusNode,s.focusOffset),l.setEnd(s.anchorNode,s.anchorOffset))),u=l);if(null==u)return null;var c=u.startContainer,m=u.startOffset,p=u.endContainer,f=u.endOffset;if(3!=c.nodeType){if(1!=c.nodeType)return null;if(m>0&&c.hasChildNodes()&&c.childNodes.length>m)if(3==(c=c.childNodes[m]).nodeType)m=0;else if(m=0,"[object HTMLEmbedElement]"==c.toString())return null}if(3!=p.nodeType){if(1!=p.nodeType)return null;if(p.hasChildNodes()&&(p.childNodes.length>f?p=p.childNodes[f]:3!=(p=p.childNodes[f-1]).nodeType&&null!=(S=n.getLastChildTextNode(p,!0))&&(p=S)),3!=p.nodeType){var S,v=n.getPreviousNode(c,!0,null);null!=(S=n.getPreviousTextNode(p,!1,v))&&(p=S)}f=3==p.nodeType?p.nodeValue.length:0}t=new I(c,m,p,f)}return null!=e&&null!=t?{frame:e,range:t}:null}rw_replaceAll(e,t,n){if("string"==typeof e)for(var r=e.indexOf(t);r>-1;)r=(e=e.substring(0,r)+n+e.substring(r+t.length)).indexOf(t,r+n.length);return e}rw_checkIfCanHaveStickys(e){let t=new l;if(null!=(i=e.previousSibling)&&1==i.nodeType&&("img"==i.tagName.toLowerCase()||"thstickynote"==i.tagName.toLowerCase())&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;var n=e;if(3==n.nodeType&&(n=n.parentNode),null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate"))for(var r=!0;r;){var i;if(null!=(i=n.previousSibling)&&1==i.nodeType&&"img"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;n=n.parentNode,r=null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate")}if(1==e.nodeType){if(null!=t.rw_getAttribute(e,"texthelpnoteid"))return!1;var a=e.tagName.toLowerCase();if("input"==a||"textarea"==a||"img"==a||"label"==a||"button"==a||"nobr"==a);else if("span"==a||"thspan"==a){if(null==(o=t.rw_getAttribute(e,"pron")))return!1}else{if("acronym"!=a&&"abbr"!=a)return!1;if(null==(o=e.getAttribute("title")))return!1}}if(this.isInvalidNode(e)||this.isIgnored(e)||this.isAriaHidden(e))return!1;for(var s=document.body;null!=e&&e!=s;){if(1==e.nodeType){var o;if(null!=(o=t.rw_getAttribute(e,"rwTHcomp"))&&"1"==o)return!1;if(null!=t.rw_getAttribute(e,"ignorenote"))return!1}e=e.parentNode}return!0}addEvent(e,t,n){return e.addEventListener?(h.g_bChromeExtension?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1),!0):!!e.attachEvent&&e.attachEvent("on"+t,n)}createPlainSpan(){return this.createObject("span",null,null,h.g_bOverrideSpan?"thspan":null)}splitText(e,t){let n=new l;if(null==e||3!=e.nodeType||null==e.parentNode)return e;var r=0,i=e.parentNode,a=i.parentNode;if(null==a||"thspan"!=i.tagName.toLowerCase()||"thspan"!=a.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")||null==n.rw_getAttribute(a,"rwTHgen")&&null==n.rw_getAttribute(a,"rwTHpgen")?"thspan"!=i.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")&&null==n.rw_getAttribute(i,"rwTHpgen")||(r=1):(r=2,null==e.nextSibling&&null==e.previousSibling||(r=1)),0==e.nodeValue.length||t<=0||t>=e.nodeValue.length){if(0==r){var s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1");var o=this.createWrapperElement();n.rw_setAttribute(o,"rwTHgen","1"),i.insertBefore(s,e),s.appendChild(o),o.appendChild(e)}else if(1==r){s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1"),i.insertBefore(s,e),s.appendChild(e)}return e}var h=e.nodeValue,u=h.substring(0,t),d=h.substring(t),g=(o=this.createWrapperElement(),this.createWrapperElement()),c=document.createTextNode(u),m=document.createTextNode(d);if(o.appendChild(c),g.appendChild(m),n.rw_setAttribute(o,"rwTHgen","1"),n.rw_setAttribute(g,"rwTHgen","1"),2==r)a.insertBefore(g,i),a.insertBefore(o,g),a.removeChild(i);else if(1==r)i.insertBefore(o,e),i.insertBefore(g,e),i.removeChild(e);else{s=this.createWrapperElement();n.rw_setAttribute(s,"rwTHgen","1"),s.appendChild(o),s.appendChild(g),i.insertBefore(s,e),i.removeChild(e)}return m}rw_isSpan(e){return"span"==e||"thspan"==e}moveCaret(e,t,n){var r,i=e.node,s=e.offset,o=e.forwardBias,l=new E;if(3!=i.nodeType)return null;for(;i;){var h=i.nodeValue.length;if(0==h)if(t>0||0==t&&o){if(null==(r=l.getNextTextNodeNoImg(i,n,null,!0)))return 0==t?new a(i,i.nodeValue.length,o):null;i=r,s=0}else{if(null==(r=l.getPreviousTextNodeNoImg(i,n,null,!0)))return 0==t?new a(i,0,o):null;s=(i=r).nodeValue.length}else if((s+=t)<0||0==s&&!o){if(t=s,null==(r=l.getPreviousTextNodeNoImg(i,n,null,!0)))return 0==t?new a(i,0,o):null;s=(i=r).nodeValue.length}else{if(!(s>h||s==h&&o))return new a(i,s,o);if(t=s-h,null==(r=l.getNextTextNodeNoImg(i,n,null,!0)))return 0==t?new a(i,i.nodeValue.length,o):null;i=r,s=0}}return null}getPhoneNumbersFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePhoneNumbers(e)),t}getPostcodesFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePostcode(e)),t}extractProbablePhoneNumbers(e){const t=new RegExp(/([+(\d][\d ()-]*\d)\b/,"gu"),n=[...e.matchAll(t)].filter(e=>this.isTelFormat(e[0])).map(e=>e[0]);return n.length<=0?null:n}getLastValidTelChar(e){var t,n=-1;for(t=e.length-1;t>-1;t--)if(!isNaN(e[t])){n=t+1;break}return n}cleanTelFormat(e){var t=e.indexOf("("),n=e.indexOf(")");return t>-1&&-1===n?e=e.substring(0,t).trim():-1===t&&n>-1?e=e.substring(n+1).trim():t>n&&(e=e.substring(n+1,t).trim()),e}isTelFormat(e){const t=new RegExp(/^(((\+|00)\d{1,3}\s)?(\(?0?((\d{3}\s\d{2})|\d{1,4})\)?)([\s-]\d{2,6})([\s-]?\d{2,5})([\s-]\d{2})?)\b$/,"u"),n=new RegExp(/[^\d]/,"gu"),r=t.test(e),i=e.replace(n,"").length;return r&&i<=15}isSpacePaddingTelChar(e,t,n){var r=!1;if(t&&n){r=/\s+(\-|\(|\)|\.|\+|\/)\s+/.test(t+e+n)}return r}isStartTelSymbol(e){return(new o).isNumber(e)||40===e||43===e}containsTelSymbol(e){return(new o).isNumber(e)||e>39&&e<42||43===e||e>44&&e<48}containsTempSymbol(e){return e.match(/\u00B0\s?[CF]/gi)}checkForFirstInstance(e,t){let n=new Array;t.forEach(t=>{if(null!=t&&t.length>0){let r={index:e.indexOf(t[0]),length:t[0].length};n.push(r)}});return n.reduce((e,t)=>e.index<t.index?e:t)}extractProbablePostcode(e){return e.match(/(GIR 0AA)|((([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][ABCDEFGHJKSTUW])|([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][ABEHMNPRVWXY])))) [0-9][ABDEFGHJLNPQRSTUWXYZ]{2})/gi)}containsDigitAndSpace(e){return!(!(new o).rw_isWhiteSpace(e)||!/\d/g.test(e))}wrapText(e,t,n,r){let i=e.parentNode;if(3!=e.nodeType&&null!=i)return null;let a,s,o,h=i.ownerDocument,u=this.createWrapperElementForDoc(h),d=e.nodeValue,g=new l;if("span"!=i.tagName.toLowerCase()&&"thspan"!=i.tagName.toLowerCase()||null==g.rw_getAttribute(i,"pron"))a=d.substring(0,t),s=d.substring(t,n),o=d.substring(n);else{if(null!=r&&"pron"==r[0])return null;a="",s=d,o=""}if(null!=r)for(var c=0;c<r.length;c+=2)g.rw_setAttribute(u,r[c],r[c+1]);let m,p=null,f=null;if(a.length>0&&(p=h.createTextNode(a)),m=h.createTextNode(s),o.length>0&&(f=h.createTextNode(o)),u.appendChild(m),i.replaceChild(u,e),null!=p){let e=this.createWrapperElementForDoc(h);e.appendChild(p),i.insertBefore(e,u)}if(null!=f){let e=this.createWrapperElementForDoc(h);e.appendChild(f),null==u.nextSibling?i.insertBefore(e,null):i.insertBefore(e,u.nextSibling)}return u}createWrapperElementForDoc(e){return this.createObjectForDoc("thspan",null,null,null,e)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var s=t.length,o=0;o<s;o+=2)a.setAttribute(t[o],t[o+1]);return a}}class L{constructor(e,t,n,r,i){this.leftCaret=null,this.rightCaret=null,null!=e&&null!=t&&null!=n&&null!=r&&null!=i&&this.getCaretPairFromDomPosition(e,t,n,r,i)}setCaretRange(e,t){this.leftCaret=e,this.rightCaret=t}equals(e){return null!=e&&(this.leftCaret.equals(e.leftCaret)&&this.rightCaret.equals(e.rightCaret))}refresh(e,t,n,r,i){null!=e&&null!=t&&null!=n&&null!=r&&null!=i&&this.getCaretPairFromDomPosition(e,t,n,r,i)}toString(){return this.getTextOverCaretRange()}checkIfImage(){return null!=this.leftCaret&&null!=this.rightCaret&&(!(!this.leftCaret.specialCase||1!=this.leftCaret.node.nodeType||"img"!=this.leftCaret.node.tagName.toLowerCase())||!(!this.rightCaret.specialCase||1!=this.rightCaret.node.nodeType||"img"!=this.rightCaret.node.tagName.toLowerCase()))}getTextOverCaretRange(){var e=new F,t=new l;try{if(null==this.leftCaret||null==this.rightCaret)return"";var n,r=this.leftCaret,i=this.rightCaret,a=r.node,s=i.node,o="",h=e.getNodesOverRange(a,s);if(null!=h&&h.length>0)for(var u=0;u<h.length;u++){var d=h[u];if(3==d.nodeType&&"textarea"!=d.parentNode.tagName.toLowerCase())n=d.nodeValue,s==a?o+=n.substring(r.offset,i.offset):d==a&&r.offset>0?o+=n.substr(r.offset):d==s&&i.offset>-1?o+=n.substring(0,i.offset):o+=n;else if(1==d.nodeType){if("img"==d.tagName.toLowerCase()&&t.rw_getAttribute(d,"msg")){o=t.rw_getAttribute(d,"msg");continue}if(("img"==d.tagName.toLowerCase()||"svg"==d.tagName.toLowerCase())&&t.rw_getAttribute(d,"alt")){o=t.rw_getAttribute(d,"alt");continue}if(d.isMathJax||d.nodeName.startsWith("MJX"))o+=(new m).getRawTextFromMathJax(d);e.hasCustomReadingAttribute(d)&&(o=e.getCustomReadingAttribute(d))}}return o.trimTH()}catch(e){return""}}rw_getTHRangeFromTHCaretRange(){return null==this||null==this.leftCaret||null==this.rightCaret?null:new THRange(this.leftCaret.node.ownerDocument.body,this.rw_getRefPt(this.leftCaret.node,this.leftCaret.offset),this.rw_getRefPt(this.rightCaret.node,this.rightCaret.offset))}getCaretPairFromDomPosition(e,t,n,r,i){var a=new F;this.leftCaret=a.getCaretFromDomPosition(e,t,n,!0),this.rightCaret=t==r&&n>=i?this.leftCaret:a.getCaretFromDomPosition(e,r,i,!1)}getTextSpokenOverCaretRange(e){let t=new E,n=new F;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return"";var r=e.leftCaret,i=e.rightCaret,s=r.node,o=i.node,l=n.isSpecialCaseNested(s);l&&(s=n.checkForSpecialParent(s),r=new a(s,0,!0));for(var h=s,u="";null!=h;){if((l=n.isSpecialCase(h))||3==h.nodeType){var d=t.getTextFromNode(h);null!=d&&""!=d&&(l||(h==o&&i.offset>-1&&(d=d.substring(0,i.offset)),h==s&&r.offset>-1&&(d=d.substring(r.offset))),u+=d)}h=l?t.getNextNodeIgnoreChildren(h,!1,o):t.getNextNode(h,!1,o)}return u.trimTH()}catch(e){return""}}getSentenceOverCaretRange(e){let t=new E,n=new F;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return"";var r=e.leftCaret,i=e.rightCaret,s=r.node,o=i.node,l=n.isSpecialCaseNested(s);l&&(s=n.checkForSpecialParent(s),r=new a(s,0,!0));for(var h=s,u=[];null!=h;){if((l=n.isSpecialCase(h))||3==h.nodeType){var d=t.getTextFromNode(h);if(null!=(d=d.trim())&&""!=d){l||(h==o&&i.offset>-1&&(d=d.substring(0,i.offset)),h==s&&r.offset>-1&&(d=d.substring(r.offset)));let e=[];if(l||(e=this.breakIntoSentences(d)),e.length>0)for(var g=0;g<e.length;g++)null!=e[g]&&""!=e[g]&&u.push({text:e[g],node:h});else u.push({text:d,node:h})}}h=l?t.getNextNodeIgnoreChildren(h,!1,o):t.getNextNode(h,!1,o)}return u}catch(e){return""}}breakIntoSentences(e){const t=new k;let n=[];if("string"!=typeof e)return n;if(""===e)return n;for(;t.getSentenceBreakPoint(e)>-1;){let r=t.getSentenceBreakPoint(e);-1!==r&&(n.push(e.substring(0,r+1).trim()),e=e.substring(r+1))}return n.push(e.trim()),n}}class O{constructor(){}clearSelection_(){this.clearBrowserSelection()}clearBrowserSelection(){if(window.getSelection){for(let e=0;e<window.frames.length;e++)try{window.getSelection().empty?window.frames[e].getSelection().empty():window.getSelection().removeAllRanges&&window.frames[e].getSelection().removeAllRanges()}catch(e){}window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else document.selection&&document.selection.empty()}getSelectionRange(){}hasSelection(){}}class H extends O{constructor(){super(),this.g_ipadSelectionRange=null,this.lastInputSelect=null;for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++){null!=(r=(n=e.item(t)).type)&&"text"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}for(e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var n,r;null!=(r=(n=e.item(t)).type)&&"textarea"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}}inputHandler(e){this.lastInputSelect=e.currentTarget}getSelectionRange(){var e=this.getSelection_();return e?e.range:null}getElementRangeById(e){let t=this.getSelectionById(e);return t?t.range:null}getSelectionObject(){var e=this.getSelection_();return this.clearBrowserSelection(),e}isMathJax(e){if(void 0!==e.startCaret.node.ownerDocument.defaultView.MathJax){if(e.startCaret.node.isMathJax||e.startCaret.node.nodeName.startsWith("MJX"))return!0;if(e.startCaret.node.parentNode.isMathJax||e.startCaret.node.parentNode.nodeName.startsWith("MJX"))return!0}return!1}hasSelection(){var e=this.getSelection_();return null!=e&&null!=e}getSelectionString(){return this.getSelection_().range.toString()}getSelectionSentencesObject(e){let t;if(t=null!=e?this.getSelectionById(e):this.getSelection_(),t&&t.range){return t.range.toSentences()}return null}getSelectionText(e){let t;return t=null!=e?this.getSelectionById(e):this.getSelection_(),t.range.toString()}getSelection_(){var e=new F,t=new E,n=null,r=null;null!=this.g_ipadSelectionRange&&g_ipadSelectionWindow.getSelection().addRange(this.g_ipadSelectionRange);var i=window.getSelection(),a=null,s=new o;if(!i.isCollapsed&&s.trim(i.toString()).length>0)n=window,a=i;else{if(this.lastInputSelect&&this.lastInputSelect.selectionStart!=this.lastInputSelect.selectionEnd)return r=new I(this.lastInputSelect,0,this.lastInputSelect,0),{frame:window,range:r};var l=e.getFrameSelectionSFF(window);l.foundSel&&(n=l.theWindow,a=l.foundSel);var h=e.getFrameSelectionInTextAreas(window);if(null!=h)return r=new I(h.textArea,0,h.textArea,0),{frame:h.frame,range:r}}if(i.anchorNode&&i.anchorNode.children&&i.anchorNode.children[0]&&i.anchorNode.children[0].shadowRoot)try{n=(i=i.anchorNode.children[0].shadowRoot.getSelection()).anchorNode.getRootNode(),a=i}catch(e){}if(null==a)return null;if(a.anchorNode&&(e.isIgnored(a.anchorNode)||e.isAriaHidden(a.anchorNode)&&!a.anchorNode.parentNode.isMathJax&&!a.anchorNode.parentNode.nodeName.startsWith("MJX")))return null;if(a.focusNode&&a.focusNode.id&&"flashcontent"==a.focusNode.id)return null;if(null!=a.anchorNode&&a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset)return null;var u=null;if(a.getRangeAt)if(a.rangeCount>1){for(var d=[],g=0;g<a.rangeCount;g++)d[g]=a.getRangeAt(g);(u={}).startContainer=d[0].startContainer,u.startOffset=d[0].startOffset,u.endContainer=d[a.rangeCount-1].endContainer,u.endOffset=d[a.rangeCount-1].endOffset}else u=a.getRangeAt(0);else{var c=e.getRangeObject();null!=c&&(a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset?c=e.getRangeFromSelectionPoint(a):(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset),0==c.toString().length&&(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset))),u=c)}if(null==u)return null;var m=u.startContainer,p=u.startOffset,f=u.endContainer,S=u.endOffset;if(3!=m.nodeType){if(1!=m.nodeType)return null;if(p>0&&m.hasChildNodes()&&m.childNodes.length>p)if(3==(m=m.childNodes[p]).nodeType)p=0;else if(p=0,"[object HTMLEmbedElement]"==m.toString())return null}if(3!=f.nodeType){if(1!=f.nodeType)return null;if(f.hasChildNodes()&&null!=(v=t.getLastChildTextNode(f,!0))&&(f=v),3!=f.nodeType){var v,w=t.getPreviousNode(m,!0,null);null!=(v=t.getPreviousTextNode(f,!1,w))&&(f=v)}S=3==f.nodeType?f.nodeValue.length:0}return r=new I(m,p,f,S),null!=n&&null!=r?{frame:n,range:r}:null}getSelectionById(e){let t,n=new F,r=new E;if(t="string"==typeof e?document.getElementById(e):e,null!=t){let e=t.getRootNode(),i=window;if(e.mode&&"open"==e.mode&&(i=e),1==t.nodeType&&"img"==t.tagName.toLowerCase()&&null==t.getAttribute("alt")&&null==t.getAttribute("msg"))return{frame:i,range:thRange};if(t.innerHTML.length>0){let e=r.getFirstChildTextNode(t,!0);if(null==e||3!=e.nodeType&&!e.isMathJax&&!e.nodeName.startsWith("MJX")){if(null==e||1!=e.nodeType||"img"!=e.tagName.toLowerCase()&&"svg"!=e.tagName.toLowerCase())return null;{let t=e.getAttribute("msg");if(null==t&&(t=e.getAttribute("alt")),!(null!=t&&t.length>0))return null}}let a=r.getLastChildTextNode(t,!0);if(null==a||3!=a.nodeType&&!a.isMathJax&&!a.nodeName.startsWith("MJX")){if(null==a||1!=a.nodeType||"img"!=a.tagName.toLowerCase()&&"svg"!=a.tagName.toLowerCase())return null;{let e=a.getAttribute("msg");if(null==e&&(e=a.getAttribute("alt")),!(null!=e&&e.length>0))return null}}n.rw_getRefPt(e,0),3==a.nodeType?n.rw_getRefPt(a,a.nodeValue.length):n.rw_getRefPt(a,0);let s;s=null==a.nodeValue||null==a.nodeValue.length||3!==a.nodeType?0:a.nodeValue.length;const o=new I(e,0,a,s);return null!=i&&null!=o?{frame:i,range:o}:null}}return null}}class D{constructor(e){this.no_scroll=e}rw_scrollToObject(e){var t=new F,n=!1;if(!this.no_scroll)try{var r=t.getWindow(e);if(null==r||null==e||null==e.parentNode)return;var i=0,a=0,s=e;3==s.nodeType&&(s=s.parentNode);for(var o,l,h,u,d=null,g=s,c=s.ownerDocument.body,m=null;null!=g&&g!=c;)"div"!=g.tagName.toLowerCase()&&"form"!=g.tagName.toLowerCase()||this.rw_isDivScrollable(g)&&(!0,d=this.rw_scrollToObjectDivCheck(s,g,d),m=g,s=g),g=g.parentNode;for(null!=m&&(s=m);null!=s;)i+=s.offsetLeft,a+=s.offsetTop,s=s.offsetParent;null!=d&&(a+=d.y,i+=d.x);var p,f,S=30;if(3==e.nodeType&&(S=10+5*e.nodeValue.length)>60&&(S=60),o=this.rw_getScreenOffsetLeft(r),l=this.rw_getScreenOffsetTop(r),"number"==typeof r.innerWidth?(h=r.innerWidth,u=r.innerHeight):r.document.documentElement.clientHeight>0&&r.document.documentElement.clientWidth>0?(h=r.document.documentElement.clientWidth,u=r.document.documentElement.clientHeight):(h=r.document.body.clientWidth,u=r.document.body.clientHeight),h-=S,u-=20,f=a<l||a>l+u,(p=i<o||i>o+h)||f&&(0!=i||0!=a)){i>o+h&&(i=(i+o)/2),a>l+u&&(a=(a+l)/2);n&&(n=!1),this.isModal(c)?c.scrollTo(p?i:o,f?a:l):r.scrollTo(p?i:o,f?a:l);!1}}catch(e){}}rw_getScreenOffsetLeft(e){return void 0===e&&(e=window),e.pageXOffset&&e.pageXOffset>0?e.pageXOffset:e.document.body.scrollLeft&&e.document.body.scrollLeft>0?e.document.body.scrollLeft:e.document.documentElement.scrollLeft&&e.document.documentElement.scrollLeft>0?e.document.documentElement.scrollLeft:0}rw_getScreenOffsetTop(e){return void 0===e&&(e=window),e.pageYOffset&&e.pageYOffset>0?e.pageYOffset:e.document.body.scrollTop&&e.document.body.scrollTop>0?e.document.body.scrollTop:e.document.documentElement.scrollTop&&e.document.documentElement.scrollTop>0?e.document.documentElement.scrollTop:0}rw_getScreenOffsetLeftAlt(e){return void 0===e&&(e=window),"CSS1Compat"==e.document.compatMode&&e.document.body.parentNode&&e.document.body.parentNode.scrollLeft?e.document.body.parentNode.scrollLeft:e.pageXOffset?e.pageXOffset:e.scrollX?e.scrollX:e.document.body.scrollLeft?e.document.body.scrollLeft:e.document.documentElement.scrollLeft?e.document.documentElement.scrollLeft:0}rw_scrollToObjectDivCheck(e,t,n){for(var r=t.clientHeight,i=t.clientWidth,a=e.getBoundingClientRect().right-e.getBoundingClientRect().left,s=0,o=0,l=e;l!=t&&null!=l;)s+=l.offsetTop,o+=l.offsetLeft,l=this.rw_safeOffsetParent(l,t);return null==l&&(o-=t.offsetLeft,s-=t.offsetTop),null!=n&&(s+=n.y,o+=n.x),(t.scrollTop>s||t.scrollTop+r<s)&&(r>6*e.offsetHeight?t.scrollTop=s-e.offsetHeight:t.scrollTop=s),a<200&&(t.scrollLeft>o||t.scrollLeft+i<o+e.offsetWidth)&&(t.scrollLeft=o),{x:o-t.scrollLeft,y:s-t.scrollTop}}rw_safeOffsetParent(e,t){var n=e,r=n.offsetParent;if(null==r)return null;if(null==t)return r;for(;null!=n&&n!=r;){if(n==t)return null;n=n.parentNode}return r}rw_isDivScrollable(e){var t=new F,n=e.clientHeight,r=e.clientWidth,i=t.getComputedStyle(e),a=!1;return null!=i&&"visible"!=i.overflow&&"inline"!=i.display&&(e.scrollHeight>n&&"visible"!=i.overflowY&&(a=!0),e.scrollWidth>r&&"visible"!=i.overflowX&&(a=!0)),a}isModal(e){return e.classList.contains("modal-open")}}class B{constructor(){this.node=null,this.offset=0}}class W{constructor(){this.style=null,this.fg=null,this.bg=null,this.lastSpanId=0}}class V{constructor(){this.count=1,this.list=[]}pushToList(e){this.list.push(e)}getList(){return this.list}}class j{constructor(){}isTokenType(e){return"entity"==e||"char"==e||"entities"==e||"chars"==e}looper(e,t,n){if(null!=e){var r=e.spanID?e.spanID:e.CHTMLnodeID;if(null!=(r=null!=r&&null!=r?r:e.PHTMLspanID)&&r==t)return n.pushToList(e),++n.count,!0;if(null!=e.data)for(var i=0;i<e.data.length;i++){var a=this.looper(e.data[i],t,n);if(a)return a}}return!1}getList(e,t){var n=new V;return this.looper(e,t,n),n.getList()}}class J{constructor(e){this.highlightDataStore={},this.highlightJaxRoot=e.root,this.highlightClearLast=!0,this.elementHelper=new j}setClearLastHighlight(e){this.highlightClearLast=e}setHighlightStyle(e,t,n){if("string"!=typeof e)return!1;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)){var r=this.highlightDataStore[e];r&&r.lastSpanId>0&&this.clearHighlightNodesImpl(e,r.style,r.lastSpanId)}return null===t?(delete this.highlightDataStore[e],!0):"string"==typeof t&&(""===(t=t.toLowerCase())||"none"===t?(delete this.highlightDataStore[e],!0):(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)?"highlight"!==(i=this.highlightDataStore[e]).style&&(i.fg=null,i.bg=null):i=new W,"fg"===t?(i.style="highlight",i.fg=n):"bg"===t?(i.style="highlight",i.bg=n):("outline"===t||"underline"===t)&&(i.style=t,i.fg=n,i.bg=null),this.highlightDataStore[e]=i,!0));var i}highlightNodes(e,t){var n;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)&&null!==(n=this.highlightDataStore[e]).style){n.lastSpanId>0&&this.highlightClearLast&&this.clearHighlightNodesImpl(e,n.style,n.lastSpanId),n.lastSpanId=t;var r=this.elementHelper.getList(this.highlightJaxRoot,t);this.highlightImpl(r,e,n.style,n.fg,n.bg)}}clearHighlights(){for(var e in this.highlightDataStore)if(this.highlightDataStore.hasOwnProperty(e)){var t=this.highlightDataStore[e];this.clearHighlightNodesImpl(e,"",t.lastSpanId),t.lastSpanId=0}}clearHighlightNodes(e,t){this.clearHighlightNodesImpl(e,"",t)}parseColor(e){var t;if("string"==typeof e)t=parseInt(e,10);else{if("number"!=typeof e)throw"invalid";t=e}if(t<0||t>255)throw"invalid";return t}clearHighlightNodesImpl(e,t,n){for(var r=this.elementHelper.getList(this.highlightJaxRoot,n),i=0,a=r.length;i<a;i++){var s=r[i];if(""!==t&&"outline"!==t||delete s.mathoutline,""===t||"underline"===t)if(s.previousline){this.removeFromPrevious(s.previousline,e);var o=s.previousline.length;s.mathunderline=o>0?s.previousline[o-1].val:""}else s.mathunderline="";if(""===t||"highlight"===t){if(s.previouscolor){this.removeFromPrevious(s.previouscolor,e);o=s.previouscolor.length;s.mathcolor=o>0?s.previouscolor[o-1].val:""}else s.mathcolor=" ";delete s.mathbackground}var l=null;try{l=s.HTMLspanElement()}catch(e){}if(null==l)try{l=s.CHTMLnodeElement()}catch(e){}if(null==l)return;var h=!0;if(null!=s.HTMLremoveColor&&(h=this.setupPostFix(l,e,!0)),h)try{s.HTMLhandleColor(l)}catch(e){s.PHTMLhandleColor(l)}this.setdownPostFix(l);h=!0;if(null!=s.HTMLremoveColor&&(h=this.setupPostFix(l,e,!1)),h)if(null!=s.HTMLremoveColor)s.HTMLremoveColor();else{try{u=s.HTMLspanElement()}catch(e){u=s.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}if(this.setdownPostFix(l),null!=s.HTMLremoveColor){var u;try{u=s.HTMLspanElement()}catch(e){u=s.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}}}highlightImpl(e,t,n,r,i){for(var a=0,s=e.length;a<s;a++){var o=e[a];if("function"==typeof(o.HTMLhandleColor?o.HTMLhandleColor:o.CHTMLhandleColor)){var l=null;try{l=o.CHTMLnodeElement()}catch(e){}if(null==l)try{l=o.HTMLspanElement()}catch(e){}if(null==l)return;if("highlight"===n){if(null!=i&&(o.mathbackground=i),null!=r){if(o.previouscolor)this.removeFromPrevious(o.previouscolor,t);else if(o.previouscolor=[],o.mathcolor)o.previouscolor.push({key:"",val:o.mathcolor});else(new F).getComputedStyle(l).color;o.previouscolor.push({key:t,val:r}),o.mathcolor=r}}else"outline"===n?o.mathoutline=r+"thin solid":"underline"===n&&(o.previousline?this.removeFromPrevious(o.previousline,t):(o.previousline=[],o.textDecoration&&o.previousline.push({key:"",val:o.textDecoration})),o.previousline.push({key:t,val:"underline"}),o.mathunderline="underline");if(this.setupPostFix(l,t,!0))try{o.HTMLhandleColor(l)}catch(e){o.PHTMLhandleColor(l)}this.setdownPostFix(l)}}}removeFromPrevious(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=document.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}}class G{constructor(e){this.m_range=null,this.m_type=e,this.m_bValid=!0,this.m_contents=null,this.Types={WORD:1,SENTENCE:2,SSML:3,DOCUMENT:4,SILENCE:5,MATHML:6,MATHWORD:7}}getRange(){return this.m_range}setRange(e){e instanceof A&&(this.m_range=e)}getType(){return this.m_type}isValid(){return this.m_bValid}setValid(e){this.m_bValid=e}getContents(){return null==this.m_contents&&(this.m_contents=[]),this.m_contents}setContents(e){this.m_contents=e instanceof Array?e:[e]}addContent(e){null==this.m_contents&&(this.m_contents=[]),this.m_contents.push(e)}isOverridingText(){return!1}getWordCount(){if(this.m_type==this.Types.WORD||this.isOverridingText())return 1;var e=0;if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e+=this.m_contents[t].getWordCount()}return e}getWords(){if(this.m_type==this.Types.WORD||this.isOverridingText())return[this];var e=[];if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e=e.concat(this.m_contents[t].getWords())}return e}getFirstNode(){var e=new F,t=this.getRange();if(null!=t){var n=e.rw_getCaretFromRefPt(t.body,t.startRef);if(null!=n&&null!=n.node)return n.node}return null}getSpokenText(){return""}}class U extends G{constructor(e,t,n,r,i,a,s,o,l){super(7),this.setRange(o),this.mathParentElementId=e,this.mathParentElement=t,this.htmlElem=n,this.spanID=r,this.jaxID=i,this.m_strWord=s,this.mathML=a,this.m_strPronunciation=null,this.jaxItems=l}getMathParentElementId(){return this.mathParentElementId}setMathParentElementId(e){this.mathParentElementId=e}getSpanId(){return this.spanID}setSpanId(e){this.spanID=e}getJaxId(){return this.jaxID}setJaxId(e){this.jaxID=e}getWord(){return this.m_strWord}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}unhighlight(e){if(MathJax.version.startsWith("3")||MathJax.version.startsWith("4"))this.htmlElem.style="";else{if(this.jaxItems.previouscolor){this.removeFromPrevious(this.jaxItems.previouscolor,e);var t=this.jaxItems.previouscolor.length;this.jaxItems.mathcolor=t>0?this.jaxItems.previouscolor[t-1].val:""}else this.jaxItems.mathcolor=" ";delete this.jaxItems.mathbackground;var n=!0;if(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!0)),n)try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem);var r;n=!0;if(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!1)),n)if(null!=this.jaxItems.HTMLremoveColor)this.jaxItems.HTMLremoveColor();else null!=(r=this.htmlElem)&&(r.style.background="",r.style.color="");if(this.setdownPostFix(this.htmlElem),null!=this.jaxItems.HTMLremoveColor)null!=(r=this.htmlElem)&&(r.style.background="",r.style.color="");var i=this.htmlElem.ownerDocument.getElementById("currently-highlighting-speech-"+e);null!=i&&this.htmlElem.ownerDocument.head.removeChild(i)}}highlight(e,t){if(MathJax.version.startsWith("3")||MathJax.version.startsWith("4"))e&&(this.htmlElem.style=e);else{if(e=this.cssToObj(e),"function"==typeof(this.jaxItems.HTMLhandleColor?this.jaxItems.HTMLhandleColor:this.jaxItems.CHTMLhandleColor)){if(null==this.htmlElem)return;if(null!=e.background&&(this.jaxItems.mathbackground=e.background),null!=e.color){if(this.jaxItems.previouscolor)this.removeFromPrevious(this.jaxItems.previouscolor,t);else if(this.jaxItems.previouscolor=[],this.jaxItems.mathcolor)this.jaxItems.previouscolor.push({key:"",val:this.jaxItems.mathcolor});else{(new F).getComputedStyle(this.htmlElem).color}this.jaxItems.previouscolor.push({key:t,val:e.color}),this.jaxItems.mathcolor=e.color}if(this.setupPostFix(this.htmlElem,t,!0))try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem)}}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}}class q extends G{constructor(e,t,n,r,i,a,s,o,l){super(6),this.setRange(e),this.m_strSpanId=i,this.m_strRawText=t,this.m_strMarkedText=n,this.m_strMathML=r,this.m_strPronunciation=s,this.mathArrayObjects=a,this.jaxElem=o,this.htmlElem=l,this.jaxSpanid=this.jaxElem.spanID?this.jaxElem.spanID:this.jaxElem.CHTMLnodeID,this.elementHelper=new j,this.list=this.elementHelper.getList(this.jaxElem,this.jaxSpanid),this.mathWords=null,this.originalStyle=getComputedStyle(l),this.previousStyle,this.splitMathIntoWords()}getSpokenText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getMathML(){return this.m_strMathML}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getMarkedText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getWord(){return this.getSpokenText()}splitMathIntoWords(){if(null!=this.mathArrayObjects){let e=this.mathArrayObjects;for(let t=0;t<e.length;t++)if(this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid+'"',"g")>-1){let n=this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid+'"',"g")+11,r=this.m_strMarkedText.toLowerCase().indexOf("<mark name=",n),i=this.m_strMarkedText.substring(n,r);i=i.replace(e[t].jaxSpanid+'"/>',""),i=i.replace('<say-as interpret-as="spell">',""),i=i.replace("</say-as>",""),i=i.replace('<break time="250ms"/>',"");let a=e[t].htmlElem,s=new F,o=s.rw_getRefPt(a,0),l=s.rw_getRefPt(a,0),h=new U(this.m_strSpanId,this,a,"MathJax-Span-"+e[t].jaxSpanid,e[t].jaxSpanid,e[t].span,i,new A(a.ownerDocument.body,o,l),e[t].data);this.addContent(h)}}}unhighlight(e){if(MathJax.version.startsWith("3")||MathJax.version.startsWith("4"))this.htmlElem.style="word"==e?this.previousStyle:this.originalStyle;else{for(let a=0,s=this.list.length;a<s;a++){let s=this.list[a];if(s.previouscolor){this.removeFromPrevious(s.previouscolor,e);var t=s.previouscolor.length;s.mathcolor=t>0?s.previouscolor[t-1].val:""}else s.mathcolor=" ";delete s.mathbackground;var n=null;try{n=s.HTMLspanElement()}catch(e){}if(null==n)try{n=s.CHTMLnodeElement()}catch(e){}if(null==n)return;var r=!0;if(null!=s.HTMLremoveColor&&(r=this.setupPostFix(n,e,!0)),r)try{s.HTMLhandleColor(n)}catch(e){s.PHTMLhandleColor(n)}this.setdownPostFix(n);r=!0;if(null!=s.HTMLremoveColor&&(r=this.setupPostFix(n,e,!1)),r)if(null!=s.HTMLremoveColor)s.HTMLremoveColor();else{try{i=s.HTMLspanElement()}catch(e){i=s.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}if(this.setdownPostFix(n),null!=s.HTMLremoveColor){var i;try{i=s.HTMLspanElement()}catch(e){i=s.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}}for(let e=0,t=this.getContents().length;e<t;e++)this.getContents()[e].unhighlight("word");var a=this.htmlElem.ownerDocument.getElementById("currently-highlighting-speech-"+e);null!=a&&this.htmlElem.ownerDocument.head.removeChild(a)}}highlight(e,t,n){if(MathJax.version.startsWith("3")||MathJax.version.startsWith("4"))"context"==t&&(this.previousStyle=e),e&&(this.htmlElem.style=e);else{e=this.cssToObj(e);for(let a=0,s=this.list.length;a<s;a++){let s=this.list[a];if("function"==typeof(s.HTMLhandleColor?s.HTMLhandleColor:s.CHTMLhandleColor)){var r=null;try{r=s.CHTMLnodeElement()}catch(e){}if(null==r)try{r=s.HTMLspanElement()}catch(e){}if(null==r)return;if(null!=e.background&&(s.mathbackground=e.background),null!=e.color){if(s.previouscolor)this.removeFromPrevious(s.previouscolor,t);else if(s.previouscolor=[],s.mathcolor)s.previouscolor.push({key:"",val:s.mathcolor});else{(new F).getComputedStyle(r).color}s.previouscolor.push({key:t,val:e.color}),s.mathcolor=e.color}if(this.setupPostFix(r,t,!0))try{s.HTMLhandleColor(r)}catch(e){s.PHTMLhandleColor(r)}if(!n&&r.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]){var i=this.htmlElem.ownerDocument.createElement("style");i.type="text/css",i.id="currently-highlighting-speech-"+t,i.innerHTML="#"+this.htmlElem.id+" * {color: "+e.color+";}",this.htmlElem.ownerDocument.head.appendChild(i)}this.setdownPostFix(r)}}}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return console.logE(e),!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}}class X{constructor(e,t){this.highlightSettings=t,this.m_setupHash={},this.m_defaultContextBg={r:255,g:255,b:0},this.m_defaultContextFg={r:0,g:0,b:0},this.m_defaultWordBg={r:0,g:0,b:255},this.m_defaultWordFg={r:255,g:255,b:255},this.m_contextBg={r:255,g:255,b:0},this.m_contextFg={r:0,g:0,b:0},this.m_wordBg={r:0,g:0,b:255},this.m_wordFg={r:255,g:255,b:255},this.m_strContextStyle="highlight",this.m_strWordStyle="highlight",this.sentence=e,this.lastMathId=null}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}setupHighlighter(e){try{e=e;this.h=new J(e);var t=this.cssToObj(this.highlightSettings.speechRangeColour),n=this.cssToObj(this.highlightSettings.speechWordColour);"highlight"===this.m_strContextStyle?(this.h.setHighlightStyle("context","bg",t.background),this.h.setHighlightStyle("context","fg",t.color)):"outline"===this.m_strContextStyle?this.h.setHighlightStyle("context","outline",t.color):"underline"===this.m_strContextStyle&&this.h.setHighlightStyle("context","underline",t.color),"highlight"===this.m_strWordStyle?(this.h.setHighlightStyle("word","bg",n.background),this.h.setHighlightStyle("word","fg",n.color)):"outline"===this.m_strWordStyle?this.h.setHighlightStyle("word","outline",n.color):"underline"===this.m_strWordStyle&&this.h.setHighlightStyle("word","underline",n.color)}catch(e){console.log(e)}}highlightRange(e,t,n){var r="context";null!=t&&(r=t);try{var i,a;if(i=null!=n?this.sentence.m_contents.find(e=>e.htmlElem==n):this.sentence.getWord(0),a=null!=e?e:i.getSpanId(),this.lastMathId&&this.clearHighlights(),this.lastMathId=a,null!=i&&(7==i.m_type||6==i.m_type)){let e=i;if(6==e.m_type){this.cssToObj(this.highlightSettings.speechRangeColour);e.highlight(this.highlightSettings._speechRangeColour,r,q.range)}}}catch(e){}}unHighlightRange(e,t){null!=e||this.sentence.getSpanId();try{var n;if(null!=(n=null!=t?this.sentence.m_contents.find(e=>e.htmlElem==t):this.sentence.getWord(0))&&(7==n.m_type||6==n.m_type)){let e=n;6==e.m_type&&(e.unhighlight("context"),e.htmlElem.isMathJax&&e.unhighlight("word"),e.m_contents.forEach(e=>e.unhighlight("word")))}}catch(e){console.logE(e)}}highlightWord(e){var t=e.getMathParentElementId(),n=e.getSpanId(),r=e.getJaxId();try{var i=e.m_range.body.ownerDocument.getElementById(n),a=this.getJaxFor(i);this.m_setupHash[t]||(this.setupHighlighter(a),this.m_setupHash[t]=!0),this.h.highlightNodes("word",r,a)}catch(e){console.log(e)}}setHighlightStyle(e,t,n,r){if(this.m_setupHash=[],"string"==typeof e){void 0===t&&(t="word");var i="undefined"==typeof p_rgb;"context"===t?(this.m_strContextStyle=e,"highlight"===e?(this.m_contextBg=i?this.m_defaultContextBg:r,this.m_contextFg=i?this.m_defaultContextFg:n):"outline"!==e&&"underline"!==e||(this.m_contextFg=i?this.m_defaultContextBg:n)):"word"===t&&(this.m_strWordStyle=e,"highlight"===this.m_strWordStyle?(this.m_wordBg=i?this.m_defaultWordBg:r,this.m_wordFg=i?this.m_defaultWordFg:n):"outline"!==e&&"underline"!==e||(this.m_wordFg=i?this.m_defaultWordBg:n))}}getJaxFor(e){return e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e)}checkText(e){for(var t=e.indexOf("<mtext>");t>-1&&(n=e.indexOf("</mtext>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mtext>",t):e.indexOf("<mtext>",n+8);for(t=e.indexOf("<mn>");t>-1&&(n=e.indexOf("</mn>",t))>t;)t=0==e.substring(t+4,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+5)).indexOf("<mn>",t):e.indexOf("<mn>",n+5);var n;for(t=e.indexOf("<mover>");t>-1&&(n=e.indexOf("</mover>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mover>",t):e.indexOf("<mover>",n+8);return e}}class z{constructor(e,t){this.highlightSettings=t,this.sentence=e,this.mathJaxHighlighter=new X(e,t)}highlightRange(){}unHighlightRange(){}rw_setNodeBackground(e,t,n,r,i){var a=new F,s=new l,h=new E,u=new B;if(u.node=e,u.offset=t,3!=e.nodeType){if(1==e.nodeType&&a.isSpecialCaseHighlightable(e)){if(null!=e.tagName&&"math"==e.tagName.toLowerCase()){var d=e.parentNode;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else if(e.isMathJax||e.nodeName.startsWith("MJX")){d=e.parentNode;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else{var g=h.getFirstChildTextNode(e,!1),c=h.getLastChildTextNode(e,!1);null!=g&&3==g.nodeType&&null!=c&&3==c.nodeType&&(this.rw_setSpeechRangeImpl(g,0,c,c.nodeValue.length,r),u.node=g,u.offset=0)}return u}return u}if(3==e.nodeType){var m=e.nodeValue,f=new o;if(0==(m=f.trim(m)).length){var S=e.parentNode;if(null!=S){var v=f.trim(S.tagName).toLowerCase();if("tr"==v||"table"==v)return u}}}var w=null;if((d=e.parentNode).tagName.toLowerCase()==p&&(w=s.rw_getAttribute(d,"rwstate")),"spell"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("hom"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("grammar"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("ss"==r){if(null!=w&&""!=w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,i)}else if("sp"==r){if("csp"==w)return u;if("sp"==w)return u;u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,"")}else if("csp"==r){if("csp"==w)return u;"sp"==w&&(u=this.rw_setNodeBackgroundImpl(d,e,t,n,r,""))}return u}rw_setNodeBackgroundImpl(e,t,n,r,i,a){new F;var s,o=new l,h="sp"===i||"csp"===i,u="sp"===i?"context":"word",d="";if(1==t.nodeType&&(d=t.tagName.toLowerCase()),3==t.nodeType&&(-1==r||r>n)||"math"==d||t.isMathJax||t.nodeName.startsWith("MJX"))if(s="ss"==i?"strikethrough"==a?"text-decoration:line-through":"background:"+a:"sp"==i?this.highlightSettings.speechRangeColour:"csp"==i?this.highlightSettings.speechWordColour:"spell"==i||"hom"==i||"grammar"==i?"":"color:#ff000; background:#00ff00","math"==d||t.isMathJax||t.nodeName.startsWith("MJX")){if(h){new X(this.sentence,this.highlightSettings).highlightRange(t.id,u,t)}}else{var g,c=t.nodeValue.length;if(1==c&&("\n"==t.nodeValue||"\r"==t.nodeValue)||2==c&&"\r\n"==t.nodeValue)return(g=new B).node=t,g.offset=n<0?0:n,g;var m=e.ownerDocument,f=!1;-1==n&&-1==r?f=!0:-1==r&&(r=c),0==n&&r>=c&&(f=!0);var S=m.createElement(p);if("spell"==i&&(o.rw_setAttribute(S,"spellnum",a),S.className="thspell"),"grammar"==i){o.rw_setAttribute(S,"grammarnum",a),S.className="thgrammar"}if(f)S.setAttribute("style",s),o.rw_setAttribute(S,"rwstate",i),h&&o.rw_setAttribute(S,"started","1"),e.replaceChild(S,t),S.appendChild(t);else{var v,w,b,y=t.nodeValue;"span"!=e.tagName.toLowerCase()&&"thspan"!=e.tagName.toLowerCase()||null==o.rw_getAttribute(e,"pron")?(v=y.substring(0,n),w=y.substring(n,r),b=y.substring(r)):(v="",w=y,b=""),S.setAttribute("style",s),o.rw_setAttribute(S,"rwstate",i),h&&o.rw_setAttribute(S,"started","1");var C,T=null,x=null;v.length>0&&(T=m.createTextNode(v)),C=m.createTextNode(w),b.length>0&&(x=m.createTextNode(b)),S.appendChild(C),e.replaceChild(S,t),null!=T&&e.insertBefore(T,S),null!=x&&(null==S.nextSibling?e.insertBefore(x,null):e.insertBefore(x,S.nextSibling)),t=C}}return(g=new B).node=t,g.offset=n<0?0:n,g}rw_highlightMathJaxElement(e,t){new X(this.sentence,this.highlightSettings).highlightRange(e.m_strSpanId,t)}rw_unHHighlightMathJaxElement(e){new X(this.sentence,this.highlightSettings).unHighlightRange(e.getAttribute("sre-explorer-id")?e.getAttribute("sre-explorer-id"):e.id,e)}rw_highlightMathElement(e,t,n,r){new F;var i=new l;if(null!=e)for(var a=e.firstChild;null!=a;)1==a.nodeType&&(r?null!=i.rw_getAttribute(a,"started")?(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t)):null==i.rw_getAttribute(a,"style")&&(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t),i.rw_setAttribute(a,"started","1")):null!=i.rw_getAttribute(a,"started")&&(a.removeAttribute("style"),i.rw_removeAttribute(a,"started"),i.rw_removeAttribute(a,"rwstate"))),a=a.nextSibling}getListOfHighlightableNodes(e,t){new F;var n=new E,r=new Array;try{var i=e.node,a=t.node;if(3!=i.nodeType)if(1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase()){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(1==i.nodeType&&(i.isMathJax||i.nodeName.startsWith("MJX"))){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(null==(i=n.getFirstChildTextNode(i,!1)))return r;if(i==a){if(3==i.nodeType)(o=i.nodeValue).length>0&&e.offset<o.length&&t.offset>0&&t.offset>e.offset&&r.push(i)}else{if(3==i.nodeType)(o=i.nodeValue).length>0&&e.offset<o.length&&r.push(i);else(1==i.nodeType&&null!=i.tagName&&"math"==i.tagName.toLowerCase()||1==i.nodeType&&(i.isMathJax||i.nodeName.startsWith("MJX")))&&r.push(i);for(var s=n.getNextTextNodeNoImg(i,!1,a,!0);null!=s;){if(s==a){var o;if(3==a.nodeType)(o=a.nodeValue).length>0&&t.offset>0&&r.push(a);else(1==s.nodeType&&null!=s.tagName&&"math"==s.tagName.toLowerCase()||1==s.nodeType&&(s.isMathJax||s.nodeName.startsWith("MJX")))&&r.push(s);break}r.push(s),s=n.getNextTextNodeNoImg(s,!1,a,!0)}}}catch(e){console.log("getListOfHighlightableNodes error:"+e.message)}return r}}class $ extends z{constructor(e,t){super(e,t),this.sentence=e,this.highlightSettings=t,this.contextStyleObject=this.cssToObj(this.highlightSettings.speechRangeColour),this.wordStyleObject=this.cssToObj(this.highlightSettings.speechWordColour)}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}highlightRange(){if(this.sentence.highlight){var e=this.sentence.getRange();new F;try{if(null!=e){var t=new L(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_setSpeechRangeImpl(n.node,n.offset,r.node,r.offset,"sp")}}catch(e){}}}unHighlightRange(){if(this.sentence.highlight){var e=this.sentence.getRange();new F;try{if(null!=e){var t=new L(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(n,r),!1)}}catch(e){}}}highlightWord(e){if(this.sentence.highlight&&e<this.sentence.getAllWords().length){var t=this.sentence.getWord(e),n=!1;if(7==t.m_type||6==t.m_type){if(e-1>-1){let t=this.sentence.getWord(e-1);if(7==t.m_type||6==t.m_type)t.unhighlight("word");else if(null!=(s=this.sentence.getWordRange(e-1))){var i=(l=new L(s.body,s.startRef.path,s.startRef.offset,s.endRef.path,s.endRef.offset)).leftCaret,a=l.rightCaret;null!=i&&null!=a&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(i,a),!0)}}6==t.m_type&&null!=t.m_strPronunciation&&r.a.publish("analytics",{event:"SpeechUtils",action:"Aria math role label"}),t.highlight(this.highlightSettings._speechWordColour,"word"),n=!0}else{new F;if(e>0){let t=this.sentence.getWord(e-1);var s;if(7==t.m_type||6==t.m_type)t.unhighlight("word");else if(null!=(s=this.sentence.getWordRange(e-1))){i=(l=new L(s.body,s.startRef.path,s.startRef.offset,s.endRef.path,s.endRef.offset)).leftCaret,a=l.rightCaret;null!=i&&null!=a&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(i,a),!0)}}}var o=this.sentence.getWordRange(e);if(null!=o){var l;i=(l=new L(o.body,o.startRef.path,o.startRef.offset,o.endRef.path,o.endRef.offset)).leftCaret,a=l.rightCaret;if(null!=i&&null!=a){var u=new D(h.no_scroll);if(!n)var d=this.rw_setSpeechRangeImpl(i.node,i.offset,a.node,a.offset,"csp");null!=d&&null!=d.node?u.rw_scrollToObject(d.node):u.rw_scrollToObject(i.node)}}}}rw_removeSpeechHighlight(e,t){var n=new F;try{if(void 0===t&&(t=!1),null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsSpeechText(i,t)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var s=n.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(s)}a.parentNode.replaceChild(i,a),i=n.mergeTextNodes(i),e[r]=i,this.rw_checkNodeIsSpeechText(i,t)&&--r}else{var o="";1==i.nodeType&&(o=i.tagName.toLowerCase()),"math"==o&&this.rw_highlightMathElement(i,null,null,!1),(i.isMathJax||i.nodeName.startsWith("MJX"))&&this.rw_unHHighlightMathJaxElement(i)}}}catch(e){}}rw_checkNodeIsSpeechText(e,t){new F;var n=new l;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return!1;var r=e.parentNode,i=n.rw_getAttribute(r,"rwstate");return r.tagName.toLowerCase()==p&&null!=i&&(!t&&"sp"==i||"csp"==i)}rw_setSpeechRangeImpl(e,t,n,r,i){new F;var a=new E,s=null;try{if(n==e)return s=this.rw_setNodeBackground(e,t,r,i,"");s=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,i,""):this.rw_setNodeBackground(e,-1,-1,i,"");for(var o=a.getNextTextNodeNoImg(s.node,!1,n,!0);null!=o;){if(o==n){if(!o.isMathJax&&!o.nodeName.startsWith("MJX")){o=(s=this.rw_setNodeBackground(o,0,r,i,"")).node;break}var l=o.parentNode;s=this.rw_setNodeBackgroundImpl(l,o,0,r,i,"")}else if(o.isMathJax||o.nodeName.startsWith("MJX")){l=o.parentNode;s=this.rw_setNodeBackgroundImpl(l,o,-1,-1,i,"")}else o=(s=this.rw_setNodeBackground(o,-1,-1,i,"")).node;o=a.getNextTextNodeNoImg(o,!1,n,!0)}}catch(e){console.log("rw_setSpeechRangeImpl error:"+e.message)}return s}}class Y{constructor(e,t){this.highlightController=new $(e,t)}highlightRange(){this.highlightController.highlightRange()}unHighlightRange(){this.highlightController.unHighlightRange()}highlightWord(e){this.highlightController.highlightWord(e)}}class K{constructor(e){var t=e.getCaretRange(),n=new F;this.sentenceObject=e,this.leftNode=t.leftCaret.node,this.rightNode=t.rightCaret.node,this.body=n.getBody(this.leftNode),this.leftOffset=t.leftCaret.offset,this.rightOffset=t.rightCaret.offset,this.currentNode=this.leftNode,this.storedText="",this.startRefPt=null,this.endRefPt=null}}class Q extends G{constructor(e,t){super(1),this.setRange(e),this.m_strWord=t,this.m_strPronunciation=null}getWord(){return this.getSpokenText()}getOriginalWord(){return this.m_strWord}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}highlight(e,t,n){}unhighlight(e,t,n){}}class Z extends G{constructor(){super(3),this.m_strSsmlType=null,this.m_strAttrText=null,this.m_node=null}getSsmlType(){return this.m_strSsmlType}setSsmlType(e){this.m_strSsmlType=e}getAttr(){return this.m_strAttrText}setAttr(e){this.m_strAttrText=e}getSSMLOpeningTag(e){return'<?xml version="1.0"?>\n            <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                             http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                   xml:lang="'+e+'">'}getSSMLClosingTag(){return"</speak>"}getOpeningTag(){return"<"+this.getSsmlType()+" "+this.getAttr()+">"}getClosingTag(){return"</"+this.getSsmlType()+">"}getTextFromContents(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)this.m_contents[e].getType()==this.Types.SSML?t+=this.m_contents[e].getSpokenText():this.m_contents[e].getType()==this.Types.WORD?t+=this.m_contents[e].getOriginalWord():t+=this.m_contents[e].getTextFromContentsNoTags();return t}getTextFromContentsNoTags(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)this.m_contents[e].getType()==this.Types.WORD?t+=this.m_contents[e].getOriginalWord():t+=this.m_contents[e].getTextFromContentsNoTags();return t}setNode(e){this.m_node=e;let t=new A;this.setRange(t.rw_getTHRangeFromElement(e))}getFirstNode(){return this.m_node}getWord(){return this.getSpokenText()}getOriginalWord(){var e=[],t=this.getWords();if(null==t)return"";if(t.length>0){var n,r=t.length;for(n=0;n<r;n++)e=e.concat(t[n].getOriginalWord())}return e.join(" ")}}class ee extends Z{constructor(e,t){super(),this.m_strAlias=t,this.setNode(e),this.setSsmlType("sub"),this.setAttr('alias="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return" "+this.m_strAlias+" "}canContainContent(){return!1}}class te extends Z{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("phoneme"),this.setAttr('alphabet="'+t+'" ph="'+n+'"')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+" "+this.getTextFromContentsNoTags()+" "+this.getClosingTag()}canContainContent(){return!0}}class ne extends Z{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("say-as"),"string"==typeof n?this.setAttr('interpret-as="'+t+'" format="'+n+'" '):this.setAttr('interpret-as="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}class re extends Z{constructor(e,t){super(),this.setNode(e),this.setSsmlType("emphasis"),"string"==typeof t?this.setAttr('level="'+t+'" '):this.setAttr('level="moderate" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+" "+this.getClosingTag()}canContainContent(){return!0}}class ie extends Z{constructor(e,t,n){let r;super(),s(this,"isOverridingText",(function(){return!0})),s(this,"getSpokenText",(function(){return"<break "+this.getAttr()+"/>"})),s(this,"canContainContent",(function(){return!1})),this.setNode(e),this.setSsmlType("break"),"string"==typeof t?(r=t.indexOf("ms")>-1?t.substr(0,t.indexOf("ms")):t.indexOf("s")>-1?t.substr(0,t.indexOf("s")):t,this.setAttr('time="'+t+'" ')):"string"==typeof n?(n=n.toLowerCase(),this.setAttr('strength="'+n+'" ')):this.setAttr('strength="medium" ')}}class ae extends Z{constructor(e,t,n,r){super(),this.setNode(e),this.setSsmlType("prosody"),"string"==typeof t?this.setAttr('pitch="'+t+'" '):"string"==typeof n?this.setAttr('rate="'+n+'" '):"string"==typeof r&&this.setAttr('volume="'+r+'" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}const se={EN_DASH:String.fromCharCode(8211)},oe=8212,le=8230;class he extends G{constructor(e){super(2);new F;this.lang=null,this.SSML_NAMESPACE="ssml",this.SSMS_TYPES={SUB:"sub",PHONEME:"phoneme",SAYAS:"say-as",EMPHASIS:"emphasis",BREAK:"break",PROSODY:"prosody"},this.SSMS_ATTRIBUTES={ALPHABET:"alphabet",PH:"ph",ALIAS:"alias",INTERPRETAS:"interpret-as",FORMAT:"format",LEVEL:"level",STRENGTH:"strength",TIME:"time",PITCH:"pitch",RATE:"rate",VOLUME:"volume"},this.m_range=new I(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset),this.m_caretRange=e,this.m_strRawText=e.getTextOverCaretRange(),this.setLangTagWithRange(e),this.math=!1,this.image=e.checkIfImage(),this.m_strMarkedText,this.jumpId,this.allowContinuous=!0,this.highlight=!0,this.stop=!1,this.resetVoice=!1,this.resetPageID=!1,this.resetBookID=!1}setVoice(e){this.m_strVoice=e}setLangTagWithRange(e){let t=e.rightCaret.node;for(;null!=t;){if(1==t.nodeType){let e=t.lang;if(null!=e&&e.length>0){this.lang=t.lang;break}}t=t.parentNode}}setLangTag(e){this.lang=e}getLangTag(){return this.lang}getVoice(){return this.m_strVoice}getSpanId(){return this.sentenceSpanId}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}setCaretRange(e){this.m_caretRange=e,this.m_range=new I(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset)}getCaretRange(){return this.m_caretRange}getWords(){for(var e=new Array,t=this.getContents(),n=0;n<t.length;n++)e.push(t[n].getWord());return e}getAllWords(){var e=new Array,t=this.getContents();for(let n=0;n<t.length;n++)switch(t[n].m_type){case 6:if(null==t[n].m_strPronunciation){let r=t[n].getContents();for(let t=0;t<r.length;t++)e.push(r[t])}else e.push(t[n]);break;case 1:e.push(t[n]);break;default:e.push(t[n])}return e}getWordRange(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:if(null==t[e].m_strPronunciation){let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e])}else n.push(t[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e].getRange():null}getWord(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:if(null==t[e].m_strPronunciation){let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e])}else n.push(t[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e]:null}isMathML(){return this.math}isImage(){return this.image}getRawText(){return this.m_strRawText}setRawText(e){this.m_strRawText=e}getMarkedText(){return this.m_strMarkedText}setMarkedText(e){this.m_strMarkedText=e}clone(){var e=new he(this.m_caretRange);return e.setContents(this.getContents()),e.setValid(this.isValid()),e.setLangTag(this.lang),e.setRawText(this.m_strRawText),e.setMarkedText(this.m_strMarkedText),e}processTextToSpeakInSentenceObject(e){this.processTextToSpeakInSentenceObjectImpl(e),h.strAnnounceLinksAsWords&&this.handleLinkToAnnounceAsWord(e);for(var t=this.getContents(),n=0;n<t.length;n++){var r=t[n];if(this.mathSymbolControl&&this.mathWithContext&&r.m_strWord){let e,i;null!=t[n-1]&&null!=t[n-1].m_strWord&&(e=t[n-1].m_strWord),null!=t[n+1]&&null!=t[n+1].m_strWord&&(i=t[n+1].m_strWord);let a=this.mathSymbolControl.mathsSymbolReplacementWithContext(r.m_strWord,e,i,this);a!=r.m_strWord&&r.setPronunciation(a)}var i=r.getFirstNode();null!=i&&this.isNestedSsml(i)&&this.insertInWrappingSsml(t,n,i)}}isNestedSsml(e){for(var t=e.ownerDocument.body,n=e;n!=t&&null!=n;){if(null!=this.checkForSsmlAttribute(n))return!0;n=n.parentNode}return!1}insertInWrappingSsml(e,t,n){let r=n.ownerDocument.body,i=n,a=new F;for(;i!=r&&null!=i;)if(i=i.parentNode,null!=this.checkForSsmlAttribute(i)){let n=this.checkForSsmlAttribute(i);if(n.canContainContent()){let r=e[t];e[t]=n,n.setContents([r]);for(let s=t+1;s<e.length;s++){let t=e[s].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;r=e[s],n.addContent(r),e.splice(s,1),s--}}else{e[t]=n;for(let n=t+1;n<e.length;n++){let t=e[n].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;e.splice(n,1),n--}}}return!1}processTextToSpeakInSentenceObjectImpl(e){var t=new F;try{var n=new K(e);for(this.setupCheck(n),n.startRefPt=t.rw_getRefPt(n.leftNode,n.leftOffset),n.endRefPt=null;null!=n.currentNode;){if(this.checkIfTooLong(n))return;var r=n.currentNode;r.isMathJax||r.nodeName.startsWith("MJX")?this.handleMathJax(n):t.isSpecialCase(r)?this.handleSpecialCase(n):1==r.nodeType?this.handleElement(n):3==r.nodeType?this.handleTextNode(n):this.moveToNextNode(n)}}catch(e){this.setValid(!1)}}handleTextNode(e){var t=new F,n=new E,r=e.currentNode,i=n.getTextFromNode(r);null==i&&(i="");var a=0;if(e.rightNode==r&&e.rightOffset>-1&&(i=i.substring(0,e.rightOffset)),e.leftNode==r&&e.leftOffset>0&&(i=i.substring(e.leftOffset),a=e.leftOffset),0==i.length&&0==e.storedText.length)e.startRefPt=null;else{null!=e.startRefPt&&0!=e.storedText.length||(e.startRefPt=t.rw_getRefPt(r,a));for(var s=t.rw_getBreakInCurrentWord(i);s>-1;){var o=e.storedText+i.substring(0,s+1);if(e.storedText=this.filterWordToSpeak(o),null!=e.endRefPt&&0==s||(e.endRefPt=t.rw_getRefPt(r,s+a)),t.extractProbablePostcode(o)?this.moveStoredTextToSSMLPostCodeObject(e):t.extractProbablePhoneNumbers(o)?this.moveStoredTextToSSMLPhoneNumberObject(e):this.moveStoredTextToWordObject(e),this.checkIfTooLong(e))return void(e.currentNode=null);a+=s+1,i=i.substring(s+1),e.startRefPt=t.rw_getRefPt(r,a),e.endRefPt=null,s=t.rw_getBreakInCurrentWord(i)}if(i.length>0&&(e.storedText+=i,e.endRefPt=t.rw_getRefPt(r,i.length+a),null==e.endRefPt&&(e.storedText="")),r==e.rightNode)return this.moveStoredTextToWordObject(e),void(e.currentNode=null)}this.moveToNextNode(e)}filterWordToSpeak(e){new F;var t=new o;return"*"!=t.trim(e)&&"•"!=t.trim(e)||h.bMathsSymbols&&this.mathSymbolControl.mathsSymbolCheck("*")||(e=""),e}handleElement(e){let t=e.currentNode,n=this.checkForSsmlAttribute(t);if(null!=n){this.moveStoredTextToWordObject(e);let o=new E;if(t.childNodes.length>0){var r=new a(t.firstChild,0,!0),i=new a(t.lastChild,3==t.lastChild.nodeType?t.lastChild.nodeValue.length:-1,!1);let o=new L;o.setCaretRange(r,i);var s=new he(o);this.processTextToSpeakInSentenceObjectImpl(s),s.isValid()&&(n.setContents(s.getContents()),e.sentenceObject.addContent(n))}else n instanceof ie&&e.sentenceObject.addContent(n);e.currentNode=o.getNextNodeIgnoreChildren(t,!1,e.rightNode)}else this.moveToNextNode(e)}moveToNextNode(e){new F;var t=new E,n=e.currentNode,r=t.getNextNode(n,!0,e.rightNode);null==r?(e.storedText=this.getTextOverRangeToSpeakAddFullStop(e.storedText),this.moveStoredTextToWordObject(e),e.currentNode=t.getNextNode(n,!1,e.rightNode)):e.currentNode=r}getTextOverRangeToSpeakAddFullStop(e){var t=new F,n=e.length;if(n>1&&". "==e.substr(n-2,2))return e;if(n>0&&"."==e.substr(n-1,1))return e+" ";var r=(new o).trimEndTH(e),i=r.charCodeAt(r.length-1);return t.rw_isLetter(i)||i>127?e+". ":e}handleMathJax(e){var t=new F,n=new E,r=new m;let i=e.currentNode;e.rawText=r.getRawTextFromMathJax(i),e.markedText=r.getSpeechWithBookmarksFromElement(i),e.mathML=r.getMathMLText(i),e.mathArrayObjects=r.mathObjectArray,e.jaxElem=r.getMathMLObject(i);var a=n.getFirstChildTextNode(i,!1),s=n.getLastChildTextNode(i,!1);e.startRefPt=t.rw_getRefPt(a,-1),e.endRefPt=t.rw_getRefPt(s,-1),e.alternativeText=null;var o=t.getAriaRoleMathWithLabel(i);if(null!=o&&(e.alternativeText=o),h.readMathMLAltText){var l=r.getMathMLAltText(i);null==e.alternativeText&&null!=l&&(e.alternativeText=l)}this.moveStoredTextToMathMLObject(e),e.currentNode=n.getNextNodeIgnoreChildren(i,!1,e.rightNode)}handleSpecialCase(e){var t=new F,n=new E;this.moveStoredTextToWordObject(e);var r=e.currentNode;if(e.storedText=n.getTextFromNode(r),t.isSpecialCaseHighlightable(r)){var i=n.getFirstChildTextNode(r,!1),a=n.getLastChildTextNode(r,!1);null!=i&&null!=a?3==i.nodeType&&3==a.nodeType?(e.startRefPt=t.rw_getRefPt(i,0),e.endRefPt=t.rw_getRefPt(a,a.nodeValue.length)):(e.startRefPt=t.rw_getRefPt(i,-1),e.endRefPt=t.rw_getRefPt(a,-1)):(e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt)}else e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt;this.moveStoredTextToWordObject(e),e.currentNode=n.getNextNodeIgnoreChildren(r,!1,e.rightNode)}checkForSymbols(e){let t=this.checkForEnDash(e);return t=this.checkForQuestionMark(t),t}checkForEnDash(e){let t=e;return t.includes(se.EN_DASH)&&this.mathSymbolControl&&this.mathSymbolControl.mathsSymbolCheck(t)&&(t=this.mathSymbolControl.mathsSymbolReplacement(t)),t.replace(se.EN_DASH," ")}checkForQuestionMark(e){if(e.indexOf("?")>-1)for(var t=e.indexOf("?");t>-1;){var n,r;n=(n=t-1)<0?0:n,r=(r=t+2)>e.length?e.length:r;var i=e.substring(n,r);"?"==(i=i.trim())&&(e=e.substr(0,t)+" "+e.substr(t+1)),t=e.indexOf("?",t+1)}return e}checkForPause(e){var t=e.isOverridingText()?e.getPronunciation():e.getWord();if(1==(t=t.trim()).length){var n=t.charCodeAt();if(n===le||n===oe){var r=new ie(e.currentNode,616);r.setRange(e.m_range),e=r}}return e}moveStoredTextToMathMLObject(e){if((new F).rw_isWordSpeakable(e.markedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new q(new A(e.body,e.startRefPt,e.endRefPt),e.rawText,e.markedText,e.mathML,e.currentNode.getAttribute("sre-explorer-id")?e.currentNode.getAttribute("sre-explorer-id"):e.currentNode.id,e.mathArrayObjects,e.alternativeText,e.jaxElem,e.currentNode);if(h.bMathsSymbols&&this.mathSymbolControl.mathsSymbolCheck(e.rawText)){var n=this.mathSymbolControl.mathsSymbolReplacement(e.rawText);n!=e.rawText&&t.setPronunciation(n)}e.sentenceObject.addContent(t)}this.math=!0,this.clearState(e)}moveStoredTextToWordObject(e){if((new F).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t;if(1==e.sentenceObject.m_strRawText.length&&1==e.storedText.length&&(e.storedText.charCodeAt()>=65&&e.storedText.charCodeAt()<=90||e.storedText.charCodeAt()>=97&&e.storedText.charCodeAt()<=122)){t=new ne(e.currentNode,"spell");var n=new Q(new A(e.body,e.startRefPt,e.endRefPt),e.storedText);n.setPronunciation(e.storedText.toLowerCase()),t.addContent(n)}else t=new Q(new A(e.body,e.startRefPt,e.endRefPt),e.storedText);this.mathSymbolControl&&this.mathSymbolControl.mathsSymbolCheck(e.storedText)&&t.setPronunciation(this.mathSymbolControl.mathsSymbolReplacement(e.storedText));var r=this.checkForSymbols(e.storedText);if(r!=e.storedText&&t.setPronunciation(r),t.m_type==t.Types.WORD){var i=this.checkForPause(t);t!=i&&(t=i)}e.sentenceObject.addContent(t)}this.clearState(e)}moveStoredTextToSSMLPostCodeObject(e){if((new F).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new Q(new A(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new ne(e.currentNode,"zip");n.setRange(new A(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}moveStoredTextToSSMLPhoneNumberObject(e){if((new F).rw_isWordSpeakable(e.storedText,this.mathSymbolControl)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new Q(new A(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new ne(e.currentNode,"phone");n.setRange(new A(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}clearState(e){e.startRefPt=null,e.endRefPt=null,e.storedText=""}checkIfTooLong(e){return e.sentenceObject.getWordCount()>500}setupCheck(e){var t=new F,n=new E;1==e.leftNode.nodeType&&(t.isSpecialCase(e.leftNode)||null!=this.checkForSsmlAttribute(e.leftNode)||(e.leftNode=n.getNextNodeAllowMoveToChild(e.currentNode,!1,e.rightNode),e.leftOffset=0))}checkForSsmlAttribute(e){if(1==e.nodeType){let t=this.checkForSsmlNoNamespace(e);if(null!=t)return t;if(t=this.checkForSsmlNamespace(e),null!=t)return t}return null}checkForSsmlNamespace(e){let t=e.ownerDocument.body.parentNode,n=new l;if(n.rw_getAttribute(t,"xmlns:ssml")){let r=n.rw_getAttribute(t,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET);if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH);if(null==t&&(t=r),null!=t&&null!=i)return new te(e,t,i)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS);if(null!=t)return new ee(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.FORMAT);if(null!=t)return new ne(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.EMPHASIS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.LEVEL);if(null!=t)return new re(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.BREAK)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.TIME),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.STRENGTH);if(null!=t)return new ie(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.PROSODY)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PITCH),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.RATE),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.VOLUME);if(null!=strTime)return new ae(e,t,r,i)}}return null}checkForSsmlNoNamespace(e){let t=new l;if(t.rw_getAttribute(e,this.SSML_NAMESPACE)){let n=t.rw_getAttribute(e,this.SSML_NAMESPACE);if(null!=n&&"sub"!=n.toLowerCase()){if(n.indexOf('ph":"')>0){let e=n.substring(n.indexOf('ph":"')+5);e=e.substring(0,e.indexOf('",')),n=n.replace(e,encodeURIComponent(e))}n=JSON.parse(n);let t=new Array;for(let e in n)t.push(e);for(let r=t.length-1;r>=0;r--){let i=t[r];if(i==this.SSMS_TYPES.PHONEME){let t="ipa";null!==n[i][this.SSMS_ATTRIBUTES.ALPHABET]&&(t=n[i][this.SSMS_ATTRIBUTES.ALPHABET]);let r=new o;return new te(e,t,r.encodeForXML(decodeURIComponent(n[i][this.SSMS_ATTRIBUTES.PH])))}if(i==this.SSMS_TYPES.SUB&&n[i][this.SSMS_ATTRIBUTES.ALIAS])return new ee(e,n[i][this.SSMS_ATTRIBUTES.ALIAS]);if(i==this.SSMS_TYPES.SAYAS&&n[i][this.SSMS_ATTRIBUTES.INTERPRETAS])return new ne(e,n[i][this.SSMS_ATTRIBUTES.INTERPRETAS],n[i][this.SSMS_ATTRIBUTES.FORMAT]);if(i==this.SSMS_TYPES.EMPHASIS)return new re(e,n[i][this.SSMS_ATTRIBUTES.LEVEL]);if(i==this.SSMS_TYPES.BREAK)return new ie(e,n[i][this.SSMS_ATTRIBUTES.TIME],n[i][this.SSMS_ATTRIBUTES.STRENGTH]);if(i==this.SSMS_TYPES.PROSODY)return new ae(e,n[i][this.SSMS_ATTRIBUTES.PITCH],n[i][this.SSMS_ATTRIBUTES.RATE],n[i][this.SSMS_ATTRIBUTES.VOLUME])}}else if("sub"==n.toLowerCase()&&t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS))return new ee(e,t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS));return null}}handleLinkToAnnounceAsWord(e){let t=e.getContents(),n=t.length,r=!1;for(let e=0;e<n;e++){let n=t[e];if(n.getType()==n.Types.WORD){let e=n.isOverridingText()?n.getPronunciation():n.getWord();"a"!=n.m_range.getAsRange().startContainer.parentNode.tagName.toLowerCase()||r||(n.setPronunciation(h.strAnnounceLinksAsWords+": "+e),r=!0)}}}}class ue extends G{constructor(){super(3),this.m_bBatch=!1,this.inlineImages=h.inlineImages,this.sentenceNo=0}setSentences(e){this.setContents(e)}setInlineImages(e){this.inlineImages=e}getSentences(){return this.getContents()}setBatch(e){this.m_bBatch=e}isBatch(){return this.m_bBatch}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}getNextSentence(e){this.sentenceNo++;var t=this.getSentences();if(this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length||t[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):t[this.sentenceNo];if(e&&null!=t[t.length-1]){var n=t[t.length-1];let l;if(n.allowContinuous){if(n.resetVoice&&r.a.publish("setTempVoice",null),n.resetBookID&&r.a.publish("resetBookID"),n.resetPageID&&r.a.publish("resetPageID"),n.jumpId){let e=new H;this.processRange(e.getElementRangeById(n.jumpId),!1),l=this.getSentences()}else{var i,a=n.getCaretRange();n.m_range.refresh(),i=new L(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset);var s=new k;this.mathSymbolControl&&s.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);a=s.getSentenceFromPoint(i.leftCaret);if(this.checkRange(a)){var o=s.getNextSentence(a,null,this.mathSymbolControl);l=this.processSentence(o)}}return null==l||void 0===l||0==l.length?null:(this.setSentences(l),this.sentenceNo=0,0==l[this.sentenceNo].getWords().length||l[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):l[0])}}return null}getPreviousSentence(){let e=this.sentenceNo;this.sentenceNo--;var t=this.getSentences();if(this.sentenceNo>-1&&this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length||t[this.sentenceNo].isImage()&&!this.inlineImages?this.getPreviousSentence():t[this.sentenceNo];if(null!=t[e]){var n=t[e];let o;var r,i=n.getCaretRange();n.m_range.refresh(),r=n.math?n.m_caretRange:new L(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset);var a=new k;this.mathSymbolControl&&a.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);i=a.getSentenceFromPoint(r.leftCaret);if(this.checkRange(i)){var s=a.getPreviousSentence(i,null,this.mathSymbolControl);o=this.processSentence(s)}return null==o||void 0===o||0==o.length?null:(this.setSentences(...o),this.sentenceNo=0,0==o[this.sentenceNo].getWords().length||o[this.sentenceNo].isImage()&&!this.inlineImages?this.getPreviousSentence():o[0])}return null}getCurrentSentence(){var e=this.getSentences();return this.sentenceNo<e.length?e[this.sentenceNo]:e[e.length-1]}getFirstSentence(){return this.sentenceNo=0,this.getSentences().length>0?this.getSentences()[0]:null}processRange(e,t){this.setSentences([]),this.sentenceNo=0;var n=new L(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset);if(!e.startCaret.node.tagName||"textarea"!=e.startCaret.node.tagName.toLowerCase()&&"input"!=e.startCaret.node.tagName.toLowerCase()){var r=new k;this.mathSymbolControl&&r.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);var i=r.getSentenceFromPoint(n.leftCaret),a=new Array,s=this.processSentence(i);if(null!=s&&a.push(...s),!t){var o=!0;do{var l,h,u=r.getNextSentence(i,n.rightCaret.node,this.mathSymbolControl);if(null!=u)"MJX-CONTAINER"===i.rightCaret.node.nodeName?o=!1:u.leftCaret.node!=n.rightCaret.node||u.leftCaret.offset<n.rightCaret.offset||1===(null===(l=u.leftCaret.node)||void 0===l?void 0:l.nodeType)&&1===(null===(h=n.rightCaret.node)||void 0===h?void 0:h.nodeType)&&u.leftCaret.offset===n.rightCaret.offset?(null!=(s=this.processSentence(u))&&a.push(...s),i=u):o=!1;else o=!1}while(o);1==a.length&&i.rightCaret.offset>=n.rightCaret.offset&&n.rightCaret.offset!=n.leftCaret.offset&&(a=this.processSentence(n))}this.setSentences(a)}else{let t=new he(n);this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);let r="";r=e.startCaret.node.selectionStart!=e.startCaret.node.selectionEnd?e.startCaret.node.value.substring(e.startCaret.node.selectionStart,e.startCaret.node.selectionEnd):e.startCaret.node.value;var d=new Q(new A(e.body,e.startRef.offset,e.endRef.offset),r);t.setContents(d),t.m_strRawText=r,t.allowContinuous=!1,t.highlight=!1,this.setSentences(t)}this.checkForCommands()}processSentence(e){try{this.checkRange(e)||this.setValid(!1),this.setSentences([]);var t=new he(e);this.checkSentenceForContentNotHighlightable(t),this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);var n=this.splitSentenceByLanguage(t);0==n.length&&this.setValid(!1),this.setSentences(n);for(var r=n.length,i=0;i<r;i++){let e=this.getSentences()[i];e.isMathML()||e.processTextToSpeakInSentenceObject(e)}return n}catch(e){this.setValid(!1)}return null}splitSentenceByLanguage(e){var t=e.getCaretRange(),n=t.leftCaret,r=t.rightCaret,i=!1;if(!h.voiceFromLangFlag)for(var a,s,o=n.node;null!=o;){if(1==o.nodeType){if(a=o.getAttribute("id"),null!=(s=o.getAttribute("class"))&&s.indexOf("contentTranslate")>-1){i=!0;break}if(null!=a&&a.length>0){if("rwpopuptrans"==a){i=!0;break}if(0!=a.indexOf("rwMeaning")&&0!=a.indexOf("rwHeadWord"))break}}o=o.parentNode}if(h.voiceFromLangFlag||i){var l=new E,u=l.getLangAttr(n.node);null!=u&&e.setLangTag(u);var d=l.checkForVoiceChange(n.node,r.node,u);if(null!=d){var g=d.clone();g.forwardBias=!0;var c=new F;g=c.moveCaret(g,0,!1);var m=new L;m.setCaretRange(n,d);var p=new L;p.setCaretRange(g,r);var f=new he(p);e.setCaretRange(m);var S=m.toString();if(0!=S.length&&c.rw_isWordSpeakable(S,this.mathSymbolControl)){var v=[];return v.push(e),v=v.concat(this.splitSentenceByLanguage(f))}return this.splitSentenceByLanguage(f)}}return[e]}checkRange(e){var t=new F;if(null==e||null==e.leftCaret||null==e.rightCaret||null==e.leftCaret.node||null==e.rightCaret.node)return!1;var n=e.leftCaret,r=e.rightCaret,i=t.checkForSpecialParent(n.node);return null!=i&&(n.node=i,n.setSpecialCase(!0),e.leftCaret=n),null!=(i=t.checkForSpecialParent(r.node))&&(r.node=i,r.setSpecialCase(!0),e.rightCaret=r),!0}checkForCommands(){if(h.useCommands){var e,t,n=this.getSentences(),r=new F,i=new E;for(t=0;t<n.length;t++){var a=(e=n[t]).getCaretRange().leftCaret,s=e.getCaretRange().rightCaret,o=i.findCommandNode(a.node),l=i.checkForCommandChange(a.node,s.node,o);if(null!=l){var u=e.clone(),d=e.clone(),g=new L(a,l),c=l.clone();c.forwardBias=!0,c=r.moveCaret(c,0,!1);var m=new L(c,s);u.setCaretRange(g),d.setCaretRange(m),n.splice(t,1,u,d)}}this.setSentences(n)}}findCommandsInRange(e){var t=new F;let n=new E;for(var r=t.getListOfNodes(e.leftCaret,e.rightCaret),i=r.length,a=null,s=0;s<i;s++)if(null!=(a=n.findCommands(r[s]))&&a.length>0){for(var o=0;o<a.length;o++){var l=a[o],h=l.command;let t=l.element;t==r[s]||h!=l.CMD_JUMP&&h!=l.CMD_EXECAFTER&&h!=l.CMD_STOPAFTER?t==r[s]||h!=l.CMD_JUMPBACK&&h!=l.CMD_STOP||0==this.checkIsFirstSentenceInCommandElement(t,e)&&(a.splice(o,1),o--):0==this.checkIsLastSentenceInCommandElement(t,e)&&(a.splice(o,1),o--)}return a}return[]}actOnCommand(e){if(h.useCommands&&e){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){for(var i=!1,a=0;a<n.length;a++){var s=n[a];s.command==s.CMD_STOP?(i=!0,r.a.publish("speechStopped",[])):s.command==s.CMD_STOPAFTER?(e.allowContinuous=!1,r.a.publish("speechStoppedAfter",[])):s.command==s.CMD_JUMP?e.jumpId=s.param:s.command==s.CMD_VOICE?(r.a.publish("setTempVoice",s.param),e.resetVoice=!0):s.command==s.CMD_PAGEID?(r.a.publish("setPageID",s.param),e.resetPageID=!0):s.command==s.CMD_BOOKID&&(r.a.publish("setBookID",s.param),e.resetBookID=!0)}i&&(e.stop=!0)}}}}checkIsFirstSentenceInCommandElement(e,t){let n=new E,r=n.getPreviousTextNodeNoBlank(t.leftCaret.node,!1,e);if(null==r){let e=n.getTextFromNode(t.leftCaret.node);if(e=e.trim(),null!=e&&""!=e){let n=[],a=[];if(n=t.breakIntoSentences(e),n.length>1){let e=0,t=0;for(let r=0;r<n.length;r++){e+=n[r].length;let i={text:n[r],rightOffset:e,leftOffset:t};a.push(i),t=t+n[r].length+1,e+=1}}if(null!=a)for(var i=0;i<a.length;i++)if(a[i].rightOffset==t.rightCaret.offset&&a[i].leftOffset==t.leftCaret.offset){null!=a[i-1]&&""!=a[i-1].text&&(r=a[i-1]);break}}}return null==r}checkIsLastSentenceInCommandElement(e,t){void 0===t&&(t=null);let n=new E,r=n.getNextTextNodeNoBlank(t.leftCaret.node,!1,e);if(null==r){let e=n.getTextFromNode(t.leftCaret.node);if(e=e.trim(),null!=e&&""!=e){let n=[],a=[];if(n=t.breakIntoSentences(e),n.length>1){let e=0,t=0;for(let r=0;r<n.length;r++){e+=n[r].length;let i={text:n[r],rightOffset:e,leftOffset:t};a.push(i),t=t+n[r].length+1,e+=1}}if(null!=a)for(var i=0;i<a.length;i++)if(a[i].rightOffset==t.rightCaret.offset&&a[i].leftOffset==t.leftCaret.offset){null!=a[i+1]&&""!=a[i+1].text&&(r=a[i+1]);break}}}return null==r}checkSentenceForContentNotHighlightable(e){if(null==e)return;let t=e.m_range.startCaret.node.ownerDocument.body,n=e.m_range.startCaret.node;for(;null!=n&&n!==t;){if(null!=n.parentElement&&n.parentElement.contentEditable&&"jet2-contenteditable"===n.parentElement.className){e.highlight=!1;break}if(null!=n.parentElement&&n.parentElement.contentEditable&&"ee-input-panel"===n.parentElement.className){e.highlight=!1;break}n=n.parentNode}}}class de{constructor(){this.strCharacterHash=String.fromCharCode(45),this.strCharacterEnDash=String.fromCharCode(8211),this.strCharacterEmDash=String.fromCharCode(8212),this.strCharacterMinus=String.fromCharCode(8722),this.strCharacterDivide=String.fromCharCode(247),this.strCharacterMultiplication=String.fromCharCode(215),this.strCharacterBullet=String.fromCharCode(8226),this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsData="-:minus;"+this.strCharacterEnDash+":' ';"+this.strCharacterMinus+":minus;"+this.strCharacterHash+":' ';+:plus;"+this.strCharacterDivide+":divided by;<:less than;>:greater than;=:equals;^:raised to the power of;<=:less than or equal to;>=:greater than or equal to;≤:less than or equal to;≥:greater than or equal to;≠:not equal to;"+this.strCharacterMultiplication+":times;/:' ';*:' ';"+this.strCharacterEmDash+":' ';"+this.strCharacterBullet+":' ';",this.mathsMappingSetup(this.mathsData)}setUsingMath(e){h.bMathsSymbols=e}setSymbolText(e){null!=e&&"string"==typeof e&&e.length>0&&(h.bMathsSymbols=!0,this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsMappingSetup(this.mathsData),this.mathsMappingSetup(e))}mathsSymbolCheck(e){return this.mathsSymbolArray.indexOf(e.replace(/[.,]\s*$/,"").trimTH())>-1}mathsMappingSetup(e){let t,n,r,i,a,s;for(n=0,r=e.indexOf(":"),i=e.indexOf(";",r);n>-1&&r>-1&&(a=e.substring(n,r),s=i>-1?e.substring(r+1,i):e.substring(r+1),0==s.length?(t=this.mathsSymbolArray.indexOf(a),t>-1&&(this.mathsSymbolArray.splice(t,1),delete this.mathsMapping[a])):(t=this.mathsSymbolArray.indexOf(a),t>-1||this.mathsSymbolArray.push(a),this.mathsMapping[a]=s),i>-1);)n=i+1,r=e.indexOf(":",n),i=e.indexOf(";",r)}mathsSymbolReplacement(e){var t,n,r,i=e.length,a=e,s=this.trimTextToMathsSymbols(e);if(null==s)return e;for(t=i-1;t>=0;t--)if(32!=(r=s.charCodeAt(t))){for(n=t;32!=r&&t>=0;)--t,r=s.charCodeAt(t);var o=s.substring(t+1,n+1);null!=this.mathsMapping[o]&&(a=a.substring(0,t+1)+" "+this.mathsMapping[o]+" "+a.substr(n+1))}return a}trimTextToMathsSymbols(e){var t,n,r=!1,i=e.length,a="";for(t=0;t<i;t++){n=e.charCodeAt(t);var s=new o;32==n||44==n||46==n||s.rw_isTextChar(n)||s.rw_isWhiteSpace(e.charAt(t))?a+=" ":(a+=e.charAt(t),r=!0)}return r?a:null}mathsSymbolReplacementSentenceCheck(e){var t,n,r=!1,i=e.split(" "),a=i.length;for(n=0;n<a;n++)(t=this.mathsSymbolReplacement(i[n]))!=i[n]&&(i[n]=t,r=!0);if(r){var s="";for(n=0;n<a-1;n++)s+=i[n],s+=" ";return s+=i[a-1]}return e}mathsSymbolReplacementWordList(e){var t=!1;if(h.bMathsSymbols&&null!=e){var n,r=e.length;for(n=0;n<r;n++){var i;(i=this.mathsSymbolReplacement(e[n]))!=e[n]&&(e[n]=i,t=!0)}}return t}mathsSymbolReplacementWithContext(e,t,n,r){let i,a,s,l=e.length,h=e,u=this.trimTextToMathsSymbols(e);if(null==u)return e;var d=new o;for(i=l-1;i>=0;i--)if(s=u.charCodeAt(i),32!=s){a=i;let r=!1;for("(){}[]".indexOf(u.charAt(i))>-1&&(r=!0),--i,s=u.charCodeAt(i);32!=s&&i>=0&&!r;)"(){}[]".indexOf(u.charAt(i))>-1?r=!0:(--i,s=u.charCodeAt(i));let o=u.substring(i+1,a+1);if(o==this.strCharacterHash||o==this.strCharacterEnDash||o==this.strCharacterEmDash){if(o==this.strCharacterEmDash)h=h.substring(0,i+1)+" "+h.substr(a+1);else{var g=e.substring(a-1,a),c=e.substring(a-2,a-1),m=(e.substring(a-3,a-2),e.substring(a+1,a+2)),p=e.substring(a+2,a+3);e.substring(a+3,a+4);if("string"==typeof t){var f=t.length+a;a<1&&f>0&&(g=t.substring(f-1,f)),a<2&&f>1&&(c=t.substring(f-2,f-1)),a<3&&f>2&&t.substring(f-3,f-2)}if("string"==typeof n){let t=e.length-(a+1),r=n.length;t<1&&r>0&&(m=n.substring(0,1)),t<2&&r>1-t&&(p=n.substring(1-t,2-t)),t<3&&r>2-t&&n.substring(2-t,3-t)}h=""!=g&&" "!=g&&g!=String.fromCharCode(160)&&"("!=g||!d.isNumber(m)?d.isNumber(g)&&d.isNumber(m)?h.substring(0,i+1)+" to "+h.substr(a+1):d.isAlpha(g)&&d.isAlpha(m)?o==this.strCharacterEnDash?h.substring(0,i+1)+" to "+h.substr(a+1):h.substring(0,i+1)+" "+h.substr(a+1):" "!=g&&g!=String.fromCharCode(160)||" "!=m&&m!=String.fromCharCode(160)||!d.isNumber(c)||!d.isNumber(p)?(d.isNumber(g)&&" "==m&&d.isNumber(p),h.substring(0,i+1)+" "+h.substr(a+1)):h.substring(0,i+1)+" minus "+h.substr(a+1):h.substring(0,i+1)+" negative "+h.substr(a+1)}o=""}null!=this.mathsMapping[o]&&(h=h.substring(0,i+1)+" "+this.mathsMapping[o]+" "+h.substr(a+1)),r&&++i}return h}}class ge extends O{constructor(){super(),this.event={},this.timerEvent=null,this.callback=null,this.caretRange=null,r.a.subscribe("pauseHover",this.clearTimer.bind(this)),document.addEventListener("mouseout",()=>this.clearTimer()),this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null}mouseMoved(e,t){clearTimeout(this.timerEvent),this.event=e,null!=t&&"function"==typeof t&&(this.callback=t),this.timerEvent=setTimeout(()=>this.startSpeech(),1e3)}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}startSpeech(){var e;if(this.targetElement=this.event.target,null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var t=new F;if(t.isIgnored(this.targetElement)||t.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax&&!this.targetElement.parentNode.nodeName.startsWith("MJX"))return null;if(null==this.targetElement||"img"!=this.targetElement.tagName.toLowerCase()&&"textarea"!=this.targetElement.tagName.toLowerCase()&&"input"!=this.targetElement.tagName.toLowerCase()){let t=this.targetElement.getRootNode();if(t.mode&&"open"==t.mode)e=new I(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var n=this.event.target.ownerDocument.caretRangeFromPoint(this.event.clientX,this.event.clientY);e=new I(n.startContainer,n.startOffset,n.endContainer,n.endOffset)}else if(void 0!==document.caretPositionFromPoint){n=this.event.target.ownerDocument.caretPositionFromPoint(this.event.clientX,this.event.clientY);e=new I(n.offsetNode,n.offset,n.offsetNode,n.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new k).tagSentences(this.targetElement);var r=this.targetElement.ownerDocument.elementFromPoint(this.event.clientX,this.event.clientY);e=new I(r,0,r,0)}}else e=new I(this.targetElement,0,this.targetElement,0);var i=new ue;h.bMathsSymbols&&(this.mathSymbolControl=new de,this.mathWithContext=!1,h.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(h.mathSymbolMapping),h.mathWithContext&&(this.mathWithContext=!0),i.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),i.processRange(e,!0);var a=i.getFirstSentence(),s="",o="";this.sentence&&this.sentence.getRawText()&&(s=this.sentence.getRawText()),a.getRawText()&&(o=a.getRawText()),null!=this.sentence&&-1!=s.indexOf(o)||(this.sentence=a,this.readRange=e,this.callback())}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}setCallback(e){this.callback=e}}class ce extends z{constructor(){super(),this.g_aHighlightObjects=new Array,this.g_aHighlightsToRepaint=new Array,this.g_bStoreHighlightText=!0}fetchWords(){for(var e=new Array,t=new Array,n=this.g_aHighlightObjects.length,r=0;r<n;r++){-1==this.g_aHighlightObjects[r].range.toString().trimTH().indexOf(" ")?t.push(this.g_aHighlightObjects.slice(r,r+1).pop()):this.m_bSentenceSelection=!0}t.sort(this.sortBySFF);for(var i,a=t.length,s=0;s<a;s++){i=(i=t[s].highlighttext.toString()).trim();var o=".,?!";o=o.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&"),i=i.replace(new RegExp("^["+o+"]+|["+o+"]+$","g"),""),e.push(i)}return e}studySkillsCollateForPosition(e){for(var t,n=new Array,r=this.g_aHighlightObjects.sort(this.sortByRange),i=r.length,a=new o,s=0;s<i;s++){var l=r[s].colour;(t=r[s].highlighttext).length>0&&e.includes(l)&&(t=a.rw_filterForHtml(t),n.push({text:t,color:l}))}return n}studySkillsCollateForColour(e){for(var t=new F,n=new Array,r=this.g_aHighlightObjects.length,i=0;i<r;i++){this.g_aHighlightObjects[i].colour==e&&n.push(this.g_aHighlightObjects.slice(i,i+1).pop())}d?n.sort(this.sortBy):n.sort(this.sortBySFF);var a,s=n.length,l=new o,h=new Array;for(i=0;i<s;i++){var u,d=!1;if(d){var g=n.slice(i,i+1).pop();u=t.rw_getTextRangeAsTHRange(g.range.parentElement().ownerDocument.body,g.range).range.rw_getTHCaretRangeFromTHRange()}else u=n[i].range.rw_getTHCaretRangeFromTHDomRange();(a=u.getTextOverCaretRange()).length>0&&(a=l.rw_filterForHtml(a),h.push({color:e,text:a}))}return h}sortBy(e,t){try{return e.compareEndPoints("EndToEnd",t)}catch(e){return 0}}sortBySFF(e,t){try{if(e.equals(t))return 0;e.refresh(),t.refresh();var n=e.getEndAsRange(),r=t.getEndAsRange();return n.compareBoundaryPoints("END_TO_END",r)}catch(e){return 0}}sortByRange(e,t){try{if(e.equals(t))return 0;e.range.refresh(),t.range.refresh();var n=e.range.getEndAsRange(),r=t.range.getEndAsRange();return n.compareBoundaryPoints("END_TO_END",r)}catch(e){return 0}}studySkillsHTMLHighlightRange(e,t){var n=new F;try{if(null==t||null==t.range||t.range instanceof String)return!1;var r=t.range;if(null==(r=this.rw_checkTHRangeForValidHighlight(r)))return!1;n.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e);var i=SpeechStream.analytics;return i.report(i.categories.HIGHLIGHT,e),!0}catch(e){return!1}}rw_convertToPermCaretPosition(e){let t=new F,n=new E;var r,i=e.node.ownerDocument.body,a=e.node,s=e.offset;s+=t.rw_getNodeOffset(a);for(var o=a.parentNode,l=o.getAttribute("data-ss-id");(null==l||0==l.length)&&o!=i;)s+=t.rw_getNodeOffset(o),l=(o=o.parentNode).getAttribute("data-ss-id");if(null!=l&&l.length>0){if(r="idx"+l,null!=o&&null!=o.firstChild){var h=n.getFirstChildTextNode(o,!1);if(3==h.nodeType){for(var u=0,d=h.nodeValue;d.length>u&&32==d.charCodeAt(u);)++u;s-=u}}}else{var g=t.rw_getRefPt(e.node,e.offset);r=g.path,s=g.offset}return{pos:r,offset:s}}rw_getStudySkillsPositionDataFromRange(e,t){let n=new F,r=new E;var i={};i.colour=t;var a,s,o,l=e;l.refresh(),this.g_bStoreHighlightText&&(o=l.toString());var h=l.startCaret.node,u=l.startCaret.offset,d=l.endCaret.node,g=l.endCaret.offset;if(3==h.nodeType&&0==h.nodeValue.trimTH().length){for(h=r.getNextNode(h,!1,d),u=0;null!=h&&3==h.nodeType&&0==h.nodeValue.trimTH().length;)h=r.getNextNode(h,!1,d);null==h&&(h=d)}var c=n.rw_getRefPt(h,u);if(3==d.nodeType&&0==d.nodeValue.trimTH().length){for(g=0;h!=d&&null!=d&&3==d.nodeType&&0==d.nodeValue.trimTH().length;)d=r.getPreviousNode(d,!1,h);null!=d&&3==d.nodeType&&d.nodeValue.trimTH().length>0&&(g=d.nodeValue.length)}if(s=n.rw_getRefPt(d,g),null!=(a=c)&&null!=s){var m=new L;m.getCaretPairFromDomPosition(l.body,a.path,a.offset,s.path,s.offset);var p=m.leftCaret,f=m.rightCaret,S=this.rw_convertToPermCaretPosition(p),v=this.rw_convertToPermCaretPosition(f);i.startRefId=S.pos,i.startRefOffset=S.offset,i.endRefId=v.pos,i.endRefOffest=v.offset,i.range=e,this.g_bStoreHighlightText&&(o=n.rw_replaceAll(o,"|","&#124;"),i.highlighttext=o),i.equals=function(e){return e.colour==this.colour&&e.startRefId==this.startRefId&&e.startRefOffset==this.startRefOffset&&e.endRefId==this.endRefId&&e.endRefOffest==this.endRefOffest&&e.highlighttext==this.highlighttext}}return i}studySkillsHTMLHighlightRangeImpl(e,t){try{var n=new F,r=!0;if(null==e||e instanceof String)return;if(!e.toString)return;if(null==e||null==e.toString()||""==e.toString())return;var i=new Array;this.g_aHighlightObjects.forEach((t,n)=>{if(null!=t&&null!=t.range){let r=e.compareRange(t.range);i.push({obj:t,result:r,index:n})}}),i.sort((function(e,t){return e.result-t.result}));for(var a=0;a<i.length;a++){var s=i[a].obj.range,o=i[a].obj,l=null,h=i[a].obj.renderedInView;try{l=n.rw_getElementQuerySelector("[data-ss-id="+o.startRefId.substr(3)+"]")||null}catch(e){}if(null!=l&&h&&e.body.ownerDocument==s.body.ownerDocument)switch(i[a].result){case-1:window.status="Error occurred when trying to add a highlight.";break;case 0:case 3:s.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(s.startCaret,s.endCaret)),this.g_aHighlightObjects[i[a].index]=null,e.refresh(),!0;break;case 4:case 7:case 8:i[a].obj.colour==t?r=!1:(this.case1SFF(i[a].index,e,i[a].result),!0);break;case 6:i[a].obj.colour==t?(r=!1,this.case4SFF(i[a].index,e)):this.case2SFF(i[a].index,e),!0;break;case 5:i[a].obj.colour==t?(r=!1,this.case5SFF(i[a].index,e)):this.case3SFF(i[a].index,e),!0}}if(r){if(e.execCommand)this.studySkillsClearRangeIE(e),this.rw_ieSpecificCallToSetHighlight(e,t);else{var u=e.startCaret,d=e.endCaret;this.rw_setHighlight(u.node,u.offset,d.node,d.offset,t)}let n=this.rw_getStudySkillsPositionDataFromRange(e,t),r=!0;this.g_aHighlightObjects.forEach(e=>{null!=e&&e.equals(n)&&(r=!1,e.renderedInView=!0)}),r&&(n.renderedInView=!0,this.g_aHighlightObjects.push(n)),e.toString()}return n.rw_collapseSelection(),this.g_aHighlightsToRepaint.forEach(e=>{var t=new L(e.selectionRange.body,e.startRefPt.path,e.startRefPt.offset,e.endRefPt.path,e.endRefPt.offset),n=t.leftCaret,r=t.rightCaret;let i=this.rw_setHighlight(n.node,n.offset,r.node,r.offset,e.strOrigColour);s=new I(i.start,0,i.end,i.end.nodeValue.length);let a=this.rw_getStudySkillsPositionDataFromRange(s,e.strOrigColour),o=!0;this.g_aHighlightObjects.forEach(e=>{null!=e&&e.equals(a)&&(o=!1)}),o&&(a.renderedInView=!0,this.g_aHighlightObjects.push(a))}),this.g_aHighlightsToRepaint.length=0,this.g_aHighlightObjects=this.g_aHighlightObjects.filter(e=>e),!0}catch(e){return!1}}rw_setHighlight(e,t,n,r,i){var a=e,s=n,o=(new F,new E);try{var l=null;if(n==e)a=(l=this.rw_setNodeBackground(e,t,r,"ss",i)).node,s=l.node;else{a=(l=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,"ss",i):this.rw_setNodeBackground(e,-1,-1,"ss",i)).node;for(var h=o.getNextTextNodeNoImg(l.node,!1,n,!0);null!=h;){if(h==n){s=h=(l=this.rw_setNodeBackground(h,0,r,"ss",i)).node;break}s=h=(l=this.rw_setNodeBackground(h,-1,-1,"ss",i)).node,h=o.getNextTextNodeNoImg(h,!1,n,!0)}}}catch(e){}return{start:a,end:s}}rw_ieSpecificCallToSetHighlight(e,t){"strikethrough"==t?e.execCommand("strikethrough",!1,null):e.execCommand("backcolor",!1,t)}studySkillsClearRangeIE(e){e.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&e.execCommand("RemoveFormat",!1,null)}rw_removeHighlight(e){var t=new F,n=new l;try{if(null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsHighlightedText(i)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var s=t.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(s)}a.parentNode.replaceChild(i,a),i=t.mergeTextNodes(i),e[r]=i}else{var o=this.rw_getNestedNodeForHighlightedText(i);null!=o&&(n.rw_removeAttribute(o,"rwstate"),o.removeAttribute("style"))}}}catch(e){}}rw_getNestedNodeForHighlightedText(e){new F;var t=new l;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return null;var n=p,r=e.parentNode,i=t.rw_getAttribute(r,"rwstate");if(r.tagName.toLowerCase()!=n||null==i||"ss"!=i){if(null!=t.rw_getAttribute(r,"rwthgen")){var a=r;for(i="1";null!=i;){if(a=a.parentNode,"ss"==t.rw_getAttribute(a,"rwState")&&a.tagName.toLowerCase()==n)return a;i=t.rw_getAttribute(a,"rwthgen")}}return null}return r}rw_checkNodeIsHighlightedText(e){new F;var t=new l;if(null==e.parentNode||null==e.parentNode.parentNode)return!1;var n=e.parentNode,r=t.rw_getAttribute(n,"rwstate");return n.tagName.toLowerCase()==p&&null!=r&&"csp"!=r&&"sp"!=r||("thspell"==n.className||"thhom"==n.className||"thgrammar"==n.className)}rw_checkTHRangeForValidHighlight(e){var t=new F,n=new E,r=e.startCaret,i=e.endCaret,a=!1;if(t.isInvalidNode(r.node)){if(r.node==i.node)return;if(null==(o=n.getNextTextNodeNoImg(r.node,!1,i.node,!1))||t.isInvalidNode(o))return;r.node=o,r.offset=0,a=!0}var s=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length;if(s){for(a=!0;s;){if(r.node==i.node)return null;if(r.node=n.getNextTextNodeNoBlank(r.node,!1,i.node),null==r.node)return null;s=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length}r.offset=0}if(t.isInvalidNode(i.node)){if(r.node==i.node)return;var o;if(null==(o=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1))||t.isInvalidNode(o))return;i.node=o,i.offset=o.nodeValue.length,a=!0}if(s=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length){for(a=!0;s;){if(r.node==i.node)return null;if(i.node=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1),null==i.node)return null;s=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length}3==i.node.nodeType&&(i.offset=i.node.nodeValue.length)}return null==r.node||null==i.node?null:(a&&(e=new I(r.node,r.offset,i.node,i.offset)),e)}
//*!
studySkillsClearHighlights(e,t){try{var n=null;if(null!=t&&null!=t.range&&(n=t.range,t.frame),null!=n&&n instanceof String){var r=!1;if(null!=r&&(r.selectionStart=0,r.selectionEnd=0),r=null,!e)return;n=null}if(null==n||e){if(!e){return void 0}var i=this.g_aHighlightObjects;this.g_aHighlightObjects=new Array;for(var a=new F,s=0;s<i.length;s++)if(null!=i[s].range){var o=i[s].range;o.refresh();try{null!=a.rw_getElementQuerySelector("[data-ss-id="+i[s].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(o.startCaret,o.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(o.startCaret,o.endCaret))}}}else{n.refresh();let e=new Array;this.g_aHighlightObjects.forEach((t,r)=>{if(null!=t&&null!=t.range){let i=n.compareRange(t.range);e.push({obj:t,result:i,index:r})}}),e.sort((function(e,t){return e.result-t.result}));for(var l=0;l<e.length;l++){var h=e[l].obj.range;if(n.body==h.body){var u=e[l].result;switch(u){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:h.refresh();try{null!=a.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[l].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret))}this.g_aHighlightObjects[e[l].index]=null,n.refresh();break;case 4:case 7:case 8:this.case1SFF(e[l].index,n,u);break;case 6:this.case2SFF(e[l].index,n);break;case 5:this.case3SFF(e[l].index,n)}}}this.g_aHighlightsToRepaint.forEach(e=>{var t=new L(e.selectionRange.body,e.startRefPt.path,e.startRefPt.offset,e.endRefPt.path,e.endRefPt.offset),n=t.leftCaret,r=t.rightCaret;let i=this.rw_setHighlight(n.node,n.offset,r.node,r.offset,e.strOrigColour);h=new I(i.start,0,i.end,i.end.nodeValue.length);let a=this.rw_getStudySkillsPositionDataFromRange(h,e.strOrigColour),s=!0;this.g_aHighlightObjects.forEach(e=>{null!=e&&e.equals(a)&&(s=!1)}),s&&(a.renderedInView=!0,this.g_aHighlightObjects.push(a))}),this.g_aHighlightsToRepaint.length=0,this.g_aHighlightObjects=this.g_aHighlightObjects.filter(e=>e)}a.rw_collapseSelection()}catch(e){}}
//*!
studySkillsHTMLRefreshRanges(){try{var e=null,t=!1,n=0;for(n=0;n<this.g_aHighlightObjects.length;n++){e=this.g_aHighlightObjects[n].range;try{null!=e.text&&""!=e.text||(e=null)}catch(t){e=null}null==e&&(this.g_aHighlightObjects.splice(n,1),t=!0,n--)}return t}catch(e){return!1}}case1SFF(e,t,n){var r=new F,i=this.g_aHighlightObjects[e].colour,a=this.g_aHighlightObjects[e].range;a.refresh();var s=a.startRef,o=t.startRef,l=t.endRef,h=a.endRef;try{null!=r.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(a.startCaret,a.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(a.startCaret,a.endCaret))}this.g_aHighlightObjects[e]=null,7!=n&&this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:s,endRefPt:o,strOrigColour:i}),8!=n&&this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:l,endRefPt:h,strOrigColour:i}),t.refresh()}case2SFF(e,t){var n=new F,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=t.endRef,s=i.endRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects[e]=null,this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:a,endRefPt:s,strOrigColour:r}),t.refresh()}case3SFF(e,t){var n=new F,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=i.startRef,s=t.startRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects[e]=null,this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:a,endRefPt:s,strOrigColour:r}),t.refresh()}case4SFF(e,t){var n=new F,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=t.startRef,s=i.endRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects[e]=null,this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:a,endRefPt:s,strOrigColour:r}),t.refresh()}case5SFF(e,t){var n=new F,r=this.g_aHighlightObjects[e].colour,i=this.g_aHighlightObjects[e].range;i.refresh();var a=i.startRef,s=t.endRef;try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret))}this.g_aHighlightObjects[e]=null,this.g_aHighlightsToRepaint.push({selectionRange:t,startRefPt:a,endRefPt:s,strOrigColour:r}),t.refresh()}}class me{constructor(){this.curser=0,this.controlEdit=null,this.curser=0,this.currentChar=null,this.properties=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"]}setEditControl(e){this.controlEdit=e}isEditable(){return!1}getPositionOfPopup(){return{top:-100,left:-100}}}class pe{constructor(){this.properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],this.isBrowser="undefined"!=typeof window,this.isFirefox=this.isBrowser&&null!=window.mozInnerScreenX}getCaretCoordinates(e,t,n){if(!this.isBrowser)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=n&&n.debug||!1;if(r){var i=document.querySelector("#input-textarea-caret-position-mirror-div");i&&i.parentNode.removeChild(i)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var s=a.style,o=window.getComputedStyle?getComputedStyle(e):e.currentStyle;s.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(s.wordWrap="break-word"),s.position="absolute",r||(s.visibility="hidden"),this.properties.forEach((function(e){s[e]=o[e]})),this.isFirefox?e.scrollHeight>parseInt(o.height)&&(s.overflowY="scroll"):s.overflowY="auto",a.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var l=document.createElement("span");l.textContent=e.value.substring(t)||".",a.appendChild(l);var h={top:l.offsetTop+parseInt(o.borderTopWidth),left:l.offsetLeft+parseInt(o.borderLeftWidth)};return r?l.style.backgroundColor="#aaa":document.body.removeChild(a),h}}class fe extends me{constructor(){super()}setEditControl(e){("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName&&"text"==e.type.toLowerCase())&&(this.controlEdit=e,this.curser=e.selectionEnd,this.startSelection=e.selectionStart,this.currentChar=this.getCurrentCharacter(),e.setSelectionRange(this.startSelection,this.curser))}isEditable(){return void 0!==this.controlEdit&&(("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase())&&this.curser==this.startSelection)}getSentence(){try{this.curser=this.controlEdit.selectionEnd,this.startSelection=this.controlEdit.selectionStart}catch(e){}var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){this.controlEdit.focus(),this.controlEdit.setSelectionRange(this.startSelection,this.startSelection);var n=e.getRangeAt(0);32==this.currentChar.charCodeAt(0)||this.currentChar.charCodeAt(0),e.modify("extend","backward","sentenceboundary"),t=e.toString(),new RegExp("[.?!]").test(t.slice(-1))&&(t=t.slice(0,t.length-1)),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return this.controlEdit.setSelectionRange(this.startSelection,this.curser),t}getPositionOfPopup(){var e=this.controlEdit;if(void 0===e)return{top:-100,left:-100};var t=getComputedStyle(e).getPropertyValue("font-size");if("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase()){let r=(new pe).getCaretCoordinates(e,e.selectionEnd);this.curser=e.selectionEnd;var n={x:0,y:0};return this.GetOffset(e,n),{top:n.y-e.scrollTop+r.top+parseInt(t)+4+"px",left:n.x-e.scrollLeft+r.left+10+"px"}}return{top:-100,left:-100}}GetOffset(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,this.GetOffset(e.offsetParent,t))}setSelectionRange(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}else e.focus()}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this.controlEdit;if("DIV"==t.tagName){t.focus();var n=document.getElementById("rwPredictionPosition");this.setCaretPositionDiv(currentContextControlID),this.setSelectionRange(t,n.value,n.value),this.currentChar=this.getCurrentCharacter(),this.replaceSelectedText(e)}else this.CurrentPosition=t.selectionStart,this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(e),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(t,this.CurrentPosition);return!1}getCurrentCharacter(){var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){var n=e.getRangeAt(0);e.modify("move","backward","character"),e.modify("extend","forward","character"),t=e.toString(),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("word"),t=r.text}return t}replaceSelectedText(e){var t;e+=" ";var n=0;if(window.getSelection){l=window.getSelection();var r=document.activeElement;if("TEXTAREA"==r.nodeName||"INPUT"==r.nodeName&&"text"==r.type.toLowerCase()){if(this.curser>0)switch(this.currentChar.charCodeAt(0)){case 32:case 160:e=e;break;case 46:case 33:case 63:e=e.trim()+this.currentChar+" ",l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","character"));break;case 10:e=e.trim()+" ";var i=l.toString();break;case 38:l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"));break;case 45:l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word");break;default:if(l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word"),"-"==(i=l.toString()).substr(i.length-1,1)&&l.modify("extend","forward","word"),i=l.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==i.substr(i.length-1,1)&&(l.modify("extend","backward","character"),e=e.trim(),n++);(i=l.toString()).substr(i.length-1,1).match(/^[0-9a-zA-Z]+$/)||(l.modify("extend","backward","character"),e=e.trim(),n++)}}var a=r.value,s=r.selectionStart,o=r.selectionEnd;if(-1!=navigator.appVersion.indexOf("Win"));else switch(a.slice(o).substr(0,1)){case" ":e=e.trim(),n++;break;case";":case":":case"!":case".":e=e.trim(),n++,n++}r.value=a.slice(0,s)+e+a.slice(o),this.CurrentPosition=s+e.length+n}else{var l=window.getSelection();if(this.setCaretPositionDiv(r),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0));else l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word");l.rangeCount?((t=l.getRangeAt(0)).deleteContents(),t.insertNode(document.createTextNode(e))):l.deleteFromDocument();a=r.value,s=r.selectionStart,o=r.selectionEnd;r.value=a.slice(0,s)+e+a.slice(o),setCaretPositionDiv(r,s+e.length)}}else document.selection&&document.selection.createRange&&((t=document.selection.createRange()).text=e)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class Se extends me{constructor(){super()}setEditControl(e){this.controlEdit=e,this.sel=window.getSelection(),this.curser=this.getCaretPosition(e),this.currentChar=this.getCurrentCharacter()}getCaretPosition(e){var t,n,r=0;if(window.getSelection)(t=window.getSelection()).rangeCount&&(n=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(r=n.endOffset);else if(document.selection&&document.selection.createRange&&(n=document.selection.createRange()).parentElement()==e){var i=document.createElement("span");e.insertBefore(i,e.firstChild);var a=n.duplicate();a.moveToElementText(i),a.setEndPoint("EndToEnd",n),r=a.text.length}return r}isEditable(){return void 0!==this.controlEdit&&(void 0!==this.controlEdit.contentEditable&&("true"==this.controlEdit.contentEditable||1==this.controlEdit.contentEditable))}getSentence(){return this._getSentence().textBeforeSelection}_getSentence(){if(null==this.controlEdit)return{selectedText:"",textBeforeSelection:"",textAfterSelection:""};var e="",t="",n="",r=window.getSelection();e=r.getRangeAt(0).toString();var i=r.getRangeAt(0),a=this._getTextNodesInRange(i);if(1==a.length)e=a[0].textContent.substring(i.startOffset,i.endOffset);else if(a.length<1)e="";else if(2==a.length)e=a[0].textContent.substring(i.startOffset)+" ",e+=a[1].textContent.substring(0,i.endOffset);else{e=a[0].textContent.substring(i.startOffset)+" ";for(var s=1;s<a.length-1;s++)e+=a[s].textContent+" ";e+=a[a.length-1].textContent.substring(0,i.endOffset)}var o=null,l=0,h=r.anchorNode.compareDocumentPosition(r.focusNode);h&Node.DOCUMENT_POSITION_PRECEDING?(o=r.focusNode,l=r.focusOffset):0==h?(o=r.anchorNode,l=r.focusOffset,r.anchorOffset<r.focusOffset&&(l=r.anchorOffset)):(o=r.anchorNode,l=r.anchorOffset),t=o.textContent.substring(0,l),n=o.textContent.substring(l+e.length);for(var u=this._getPrevTextNode(o);null!==u;)t=u.textContent+t,u=this._getPrevTextNode(u);for(var d=this._getNextTextNode(o);null!==d;)n+=d.textContent,d=this._getNextTextNode(d);return{selectedText:e,textBeforeSelection:t,textAfterSelection:n}}_getNextTextNode(e){var t=e.nextSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.nextSibling||3!==e.parentNode.nextSibling.nodeType?null:e.parentNode.nextSibling}_getPrevTextNode(e){var t=e.previousSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.previousSibling||3!==e.parentNode.previousSibling.nodeType?null:e.parentNode.previousSibling}_getTextNodesInRange(e){var t,n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,a=[];function s(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}for(t=n.parentNode;t&&(3===t.nodeType&&a.push(t),t!=i);t=t.parentNode);for(a.reverse(),t=n;t&&(3===t.nodeType&&a.push(t),t!=r);t=s(t));return a}getPositionOfPopup(){var e=this.controlEdit;return void 0===e?{top:-100,left:-100}:this.getCaretCoordinates(e,this.curser)}getCaretCoordinates(e,t){var n,r,i,a=!(null==window.mozInnerScreenX);(n=document.getElementById(e.nodeName+"--texthelp-mirror-div"))||((n=document.createElement("div")).id=e.nodeName+"--texthelp-mirror-div",document.body.appendChild(n)),i=n.style,r=getComputedStyle(e),i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.wordWrap="break-word"),i.position="absolute",i.top=e.offsetTop+parseInt(r.borderTopWidth)+"px",i.left="400px",i.visibility="hidden",["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){i[e]=r[e]})),a?(i.width=parseInt(r.width)-2+"px",e.scrollHeight>parseInt(r.height)&&(i.overflowY="scroll")):i.overflow="hidden",n.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var s=document.createElement("span");return s.textContent=e.value.substring(t)||".",s.style.backgroundColor="lightgrey",n.appendChild(s),{top:s.offsetTop+parseInt(r.borderTopWidth),left:s.offsetLeft+parseInt(r.borderLeftWidth),height:parseInt(r.fontSize.substr(r.fontSize,r.fontSize.length-2))}}setSelectionRange(e,t,n){"#text"!=e.nodeName&&(e=e.childNodes[0]);var r=document.createRange();r.setStart(e,t),r.setEnd(e,n);var i=window.getSelection();i.removeAllRanges(),i.addRange(r)}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this._getSentence();if(null!=t){if(null==this.controlEdit)return null;var n=t.textBeforeSelection.split(/\W+/);n=n[n.length-1].trim();var r=t.textAfterSelection.split(/\W+/)[0].trim(),i=window.getSelection().getRangeAt(0);n.length>0?(i.setStart(i.startContainer,i.startOffset-n.length),i.setEnd(i.endContainer,i.endOffset+r.length)):e+=" ",document.execCommand("insertText",!1,e)}}getCurrentCharacter(){return this.controlEdit.innerHTML.charAt(this.curser-1)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class ve{constructor(){this.predictionManager=null}getPredictionCoordinates(){return null!=this.predictionManager?this.predictionManager.getPositionOfPopup():{top:-1e3,left:-1e3}}getPredictionSentence(){return null!=this.predictionManager?this.predictionManager.getSentence():null}predictionInsertText(e){null!=this.predictionManager&&this.predictionManager.insertText(e)}setSelectionRange(e,t,n){this.onMouseDown({target:e}),null!=this.predictionManager&&this.predictionManager.setSelectionRange(e,t,n)}isEditable(){return null!=this.predictionManager&&this.predictionManager.isEditable()}onMouseDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}onKeyDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}predictionFactory(e){let t=e.target;"TEXTAREA"==t.nodeName||"INPUT"==t.nodeName&&"text"==t.type.toLowerCase()?this.predictionManager=new fe:void 0===t.contentEditable||"true"!=t.contentEditable&&1!=t.contentEditable||(this.predictionManager=new Se)}}class we{constructor(){this.speechRangeColour="color:#000000; background:#FFFF00",this.speechWordColour="color:#FFFFFF; background:#0000FF; padding: 2px; margin: -2px; border-radius: 4px; text-shadow: 0 3px 8px #2A2A2A; position:relative; text-indent: 0px;"}get speechRangeColour(){return this._speechRangeColour}set speechRangeColour(e){this._speechRangeColour=e}get speechWordColour(){return this._speechWordColour}set speechWordColour(e){this._speechWordColour=e}}class be extends O{constructor(){super(),this.timerEvent=null,this.callback=null,this.caretRange=null,this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null,this.callback}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}mouseClick(e,t){var n;if(this.targetElement=e.target,null!=t&&"function"==typeof t&&(this.callback=t),null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var r=new F;if(r.isIgnored(this.targetElement)||r.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax&&!this.targetElement.parentNode.nodeName.startsWith("MJX"))return null;if(null!=this.targetElement&&("img"==this.targetElement.tagName.toLowerCase()||"textarea"==this.targetElement.tagName.toLowerCase()||"input"==this.targetElement.tagName.toLowerCase()&&"checkbox"!==this.targetElement.type&&"radio"!==this.targetElement.type))n=new I(this.targetElement,0,this.targetElement,0);else{let t=e.target.getRootNode();if(t.mode&&"open"==t.mode)n=new I(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var i=e.target.ownerDocument.caretRangeFromPoint(e.clientX,e.clientY);n=new I(i.startContainer,i.startOffset,i.endContainer,i.endOffset)}else if(void 0!==document.caretPositionFromPoint){i=e.target.ownerDocument.caretPositionFromPoint(e.clientX,e.clientY);n=new I(i.offsetNode,i.offset,i.offsetNode,i.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new k).tagSentences(this.targetElement);var a=this.targetElement.ownerDocument.elementFromPoint(e.clientX,e.clientY);n=new I(a,0,a,0)}}n=r.checkRangeForMathElement(n);var s=new ue;h.bMathsSymbols&&(this.mathSymbolControl=new de,this.mathWithContext=!1,h.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(h.mathSymbolMapping),h.mathWithContext&&(this.mathWithContext=!0),s.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),s.processRange(n,!0);var o=s.getFirstSentence();this.sentence=o,this.readRange=n,this.callback()}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}setCallback(e){this.callback=e}}class ye{constructor(e){this.ignoreFrames=h.ignoreFrames,this.api=e,h.styleHacks=!1,h.g_bPersistAnnotations=!0,this.g_bInlineImg=!1,this.g_bIgnoreButtons=!0}async tagSentencesWithFramesImpl(e,t){void 0===e&&(e=window);try{if(e.document&&e.document.body?this.tagSentencesImpl(e.document.body,t):this.tagSentencesImpl(e,t),!this.ignoreFrames){let a;if(e.frames)a=e.frames;else{a=e.querySelectorAll("iframe");for(let e of a)e.onload=async e=>{await this.tagSentencesImpl(e.target.contentDocument.body),this.api.studySkills.rw_restoreHighlights()}}if(a.length>0){var n,r=a.length;for(n=0;n<r;n++)try{var i=a[n];i.frames.length>0?this.tagSentencesWithFramesImpl(i.frames,t):i.document&&i.document.body&&this.tagSentencesImpl(i.document.body,t)}catch(e){}}}}catch(e){}}async tagSentencesImpl(e,t){let n=new F,r=new l,i=new E,a=t;"undefinded"!=typeof e&&null!=e||(e=document.body);try{for(var s=!1,o=e;null!=o;)if(3==o.nodeType){var u=o.parentNode.tagName.toLowerCase();if("textarea"==u){o=i.getNextNode(o,!1,null);continue}var d=o.nodeValue,g=d.trimSpaceTH(),c=g.length>0;try{(o.nodeValue.includes("\n")||o.nodeValue.includes("\r"))&&(s=!0)}catch(e){}if(h.styleHacks&&"a"==u&&(c=!1),c){if(!h.styleHacks&&h.stripSpaces&&(h.g_bPersistAnnotations||h.g_bSpeechCacheFlag&&h.g_bAlterBrowserForConsistency)){if(g.length<d.length){var m=!1;(g=d.trimSpaceStartTH()).length<d.length&&d.length-g.length>0&&(d=s?" "+g:g,m=!0),g=d.trimSpaceEndTH(),d.length-g.length>1&&(d=g+" ",s=!1,m=!0),m&&(o.nodeValue=d)}(g=d.replace(N," ")).length<d.length&&(d=g,m=!0)}
//*!
var p;p=d.search("[\\x21\\x2E\\x3F\\x3A]");var f=null!=r.rw_getAttribute(o.parentNode,"texthelpSkip"),S=o;if(p>-1&&p<d.length-1){for(var v=!0;;){if(n.rw_isFullStop(d,p,o))break;var w=d.substring(p+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(w>-1)){v=!1;break}p=p+1+w}if(v){var b=d.substring(0,p+1),y=d.substring(p+1),C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");var T=document.createTextNode(b),x=document.createTextNode(y);(_=o.parentNode).insertBefore(x,o),_.insertBefore(C,x),C.appendChild(T),_.removeChild(o),o=x,S=T}else{if(null!=o.previousSibling||null!=o.nextSibling||f){C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");T=document.createTextNode(d);(_=o.parentNode).insertBefore(C,o),C.appendChild(T),_.removeChild(o),o=T}S=o,o=i.getNextNode(o,!1,null)}}else{if(null!=o.previousSibling||null!=o.nextSibling||f){C=n.createWrapperElement();r.rw_setAttribute(C,"rwTHpgen","1");var _;T=document.createTextNode(d);(_=o.parentNode).insertBefore(C,o),C.appendChild(T),_.removeChild(o),o=T}S=o,o=i.getNextNode(o,!1,null)}
//!*
if(h.g_bPersistAnnotations||h.g_bSpeechCacheFlag&&h.g_bAlterBrowserForConsistency){var A=S.nodeValue,R=S.nodeValue.length;s=!(R>0&&32==A.charCodeAt(R-1))}
//*!
}else if(h.g_bPersistAnnotations||h.g_bSpeechCacheFlag&&h.g_bAlterBrowserForConsistency)if(s)!h.styleHacks&&h.stripSpaces&&(o.nodeValue=" "),s=!1,o=i.getNextNode(o,!1,null);else{var k=o;o=i.getNextNode(o,!1,null),!h.styleHacks&&h.stripSpaces&&k.parentNode.removeChild(k)}else o=i.getNextNode(o,!1,null)}else if(1==o.nodeType){if(h.g_bPersistAnnotations&&n.isStyleNode(o)&&"img"==o.tagName.toLowerCase()&&(s=!0),this.g_bInlineImg&&"img"==o.tagName.toLowerCase()){var M=r.rw_getAttribute(o,"msg");null!=M&&M.length>0||(null!=(M=o.getAttribute("title"))&&M.length>0||null!=(M=o.getAttribute("alt"))&&M.length>0)&&r.rw_setAttribute(o,"msg",M)}var P=r.rw_getAttribute(o,"rwTHcomp"),I=r.rw_getAttribute(o,"rwDontAlter");o="pre"==o.tagName.toLowerCase()||"button"==o.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=P&&P.length>0||null!=I&&I.length>0?i.getNextNodeIgnoreChildren(o,!1,null):i.getNextNode(o,!1,null)}else o=i.getNextNode(o,!1,null);
//!*
if(h.g_bPersistAnnotations)for(o=e;null!=o;)if(3==o.nodeType){if(c=o.nodeValue.trimTH().length>0){var L,O=o.parentNode,H=O.getAttribute("id"),D=O.getAttribute("data-ss-id");null!=a&&(H=a+H),null!=(L=n.rw_getUniqueIdForTextNode(o,H))&&null==D&&r.rw_setAttribute(O,"data-ss-id",L)}o=i.getNextNode(o,!1,null)}else if(1==o.nodeType){if(n.rw_checkIfCanHaveStickys(o)){var B=o.getAttribute("id");D=o.getAttribute("data-ss-id");null!=a&&(B=a+B),null==D&&r.rw_setAttribute(o,"data-ss-id",n.rw_getUniqueIdForTextNode(o,B))}P=r.rw_getAttribute(o,"rwTHcomp"),I=r.rw_getAttribute(o,"rwDontAlter");o="pre"==o.tagName.toLowerCase()||"button"==o.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=P&&P.length>0||null!=I&&I.length>0?i.getNextNodeIgnoreChildren(o,!1,null):i.getNextNode(o,!1,null)}else o=i.getNextNode(o,!1,null);
//*!
}catch(e){console.error("Error in $rw_tagSentences: "+e)}h.IELoadedFlag=!0}}class Ce extends ce{constructor(){super()}rw_retrieveHighlightDataForPKTReplyImpl(e,t){var n=h.ignoreHidden;try{var r;h.g_bAnnotationGlobalCheck&&h.g_bAnnotationGlobalUnknown&&rw_setUsingAnnotations(),2==h.g_nHighlightNotSyncedState&&(r=h.g_strStoredHighlightUnprocessedData),h.g_strStoredHighlightUnprocessedData=null,h.g_elemStoredHighlightLimitArea=t,Object.keys(e).forEach((t,n)=>{e[t].equals=function(e){return e.colour==this.colour&&e.startRefId==this.startRefId&&e.startRefOffset==this.startRefOffset&&e.endRefId==this.endRefId&&e.endRefOffest==this.endRefOffest},e[t].range=null,e[t].renderedInView=!1;let r=!0;this.g_aHighlightObjects.forEach(n=>{n.equals(e[t])&&(r=!1)}),r&&this.g_aHighlightObjects.push(e[t])}),this.rw_restoreHighlights(),h.g_strStoredHighlightData=e,2==h.g_nHighlightNotSyncedState&&(r!=h.g_strStoredHighlightUnprocessedData&&rw_storeHighlightData(),null==h.g_strStoredHighlightUnprocessedData?h.g_nHighlightNotSyncedState=0:h.g_nHighlightNotSyncedState=1)}catch(e){console.log(e.message)}"boolean"!=typeof eba_ignore_hidden||eba_ignore_hidden||(h.ignoreHidden=n)}rw_restoreHighlights(e){let t=new F;var n,r,i,a,s,o,l,u;let d=new Array;d=null!=e?e:this.g_aHighlightObjects,d.forEach(e=>{u=!0,n=e.colour,r=e.startRefId,i=e.startRefOffset,s=e.endRefId,o=e.endRefOffest,a=parseInt(i,10),l=parseInt(o,10);var d,g,c=document.body,m=!1;r.length>3&&"idx"==r.substring(0,3)&&(null==(d=t.rw_getElementQuerySelector("[data-ss-id="+r.substr(3)+"]"))?(u=!1,e.renderedInView=!1):null==h.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(d,h.g_elemStoredHighlightLimitArea)?(c=d.ownerDocument.body,null==(g=this.rw_convertFromPermCaretPosition(d,a,!0))?u=!1:(r=g.path,a=g.offset)):m=!0);s.length>3&&"idx"==s.substring(0,3)&&(null==(d=t.rw_getElementQuerySelector("[data-ss-id="+s.substr(3)+"]"))?(u=!1,e.renderedInView=!1):null==h.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(d,h.g_elemStoredHighlightLimitArea)?(c=d.ownerDocument.body,null==(g=this.rw_convertFromPermCaretPosition(d,l,!0))?u=!1:(s=g.path,l=g.offset)):m=!0);if(u&&!m){var p=null;if(h.g_bIEOld)p=rw_getAsTextRange(c,r,a,s,l);else{var f=new L;f.getCaretPairFromDomPosition(c,r,a,s,l);var S=f.leftCaret,v=f.rightCaret;null!=S&&null!=v&&(p=new I(S.node,S.offset,v.node,v.offset))}null!=p?(e.range=p,this.studySkillsHTMLHighlightRangeImpl(p,n)):u=!1}u||(null==h.g_strStoredHighlightUnprocessedData&&(h.g_strStoredHighlightUnprocessedData=""),h.g_strStoredHighlightUnprocessedData+=this.g_aHighlightObjects)})}rw_convertFromPermCaretPosition(e,t,n){let r=new F,i=new E;var a=r.getPositionInDom(e),s=0;if(n&&null!=e.firstChild){var o=i.getFirstChildTextNode(e,!1);if(null==o)return null;if(3==o.nodeType)for(var l=o.nodeValue;l.length>s&&32==l.charCodeAt(s);)++s}return new R(a,t+s)}studySkillsHTMLHighlightRange(e){let t=new F;try{var n=t.rw_getSelection();if(null==n||null==n.range||n.range instanceof String)return!1;var r=n.range;if(h.g_bIEOld){var i=r.parentElement().ownerDocument.body,a=rw_getTextRangeAsTHRange(i,r);if(null==a)return!1;var s=new L;s.getCaretPairFromDomPosition(i,a.startRef.path,a.startRef.offset,a.endRef.path,a.endRef.offset);var o=s.leftCaret,l=s.rightCaret;if(null==o||null==l)return!1;var u=new I(o.node,o.offset,l.node,l.offset);if(null==u)return null;if(null==(u=this.rw_checkTHRangeForValidHighlight(u)))return null;r=t.rw_getAsTextRange(i,u.startRef.path,u.startRef.offset,u.endRef.path,u.endRef.offset)}else r=this.rw_checkTHRangeForValidHighlight(r);return null==r?(rw_alert("Failed to do the highlight, possibly due to selection going into a non textual part of the page."),!1):(t.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e),h.g_bPersistAnnotations&&h.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&this.rw_storeHighlightData(),this.rw_getStudySkillsPositionData())}catch(e){return!1}}rw_storeHighlightData(){h.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var e=this.rw_getStudySkillsPositionData();null!=h.g_strStoredHighlightUnprocessedData?(e[0]=h.g_strStoredHighlightUnprocessedData+e[0],h.g_bStoreHighlightText&&(h.g_nHighlightNotSyncedState=1)):h.g_nHighlightNotSyncedState=0,h.g_strStoredHighlightData=null,h.g_bIE&&!h.g_controllerFactory.doesSupportHtml5()?rw_submitViaFlash(e):h.g_bStoreHighlightText?rw_submitSSDataWithPost(e):rw_submitSSDataWithGet(e)}rw_getStudySkillsPositionData(){var e=this.g_aHighlightObjects.length,t={};try{for(var n=0;n<e;n++)t["highlight"+n]=this.g_aHighlightObjects[n]}catch(e){console.log(e)}return t}studySkillsClearHighlights(e,t="Remove all highlights?"){let n=new F;try{var r=n.rw_getSelection(),i=null;if(null!=r&&null!=r.range&&(i=r.range,r.frame),null!=i&&i instanceof String){if(null!=g_lastInputSelectSFF&&(g_lastInputSelectSFF.selectionStart=0,g_lastInputSelectSFF.selectionEnd=0),g_lastInputSelectSFF=null,!e)return;i=null}if(h.bOverrideIgnore=!0,h.bOverrideAriaHidden=!0,h.g_bIEOld){if(null==i||0==i.length||0==i.text.length||e){if(!e){if(!(!h.g_bAllowPopupAlertsFlag||confirm(t)))return h.bOverrideIgnore=!1,void(h.OverrideAriaHidden=!1)}h.g_bPersistAnnotations&&(h.g_strStoredHighlightData=null,h.g_strStoredHighlightUnprocessedData=null);for(var a=this.g_aHighlightObjects.length,s=0;s<a;s++){var o=this.g_aHighlightObjects[s].range;studySkillsClearRangeIE(o),this.g_aHighlightObjects[s]=null}if(this.g_aHighlightObjects=new Array,!document.compatMode.equalsTH("CSS1Compat"))if(!h.ignoreFrames&&top.frames.length>0){var l=0,u=top.frames.length;for(l=0;l<u;l++)try{var d=top.frames[l];(i=d.document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i)}catch(e){}}else(i=document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i);return h.g_bPersistAnnotations&&h.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData(),h.bOverrideIgnore=!1,void(h.bOverrideAriaHidden=!1)}studySkillsClearRangeIE(i),studySkillsHTMLRefreshRanges();a=this.g_aHighlightObjects.length,s=0;var g=null,c=null;for(s=0;s<a;s++)if(null!=(g=this.g_aHighlightObjects[s].range)){if(i.inRange(g)){g=null,this.g_aHighlightObjects.splice(s,1),s--;continue}if((c=g.duplicate()).collapse(!0),i.inRange(c)){for((p=g.duplicate()).collapse(!1);p.compareEndPoints("StartToEnd",i)>0;)p.moveStart("character",-1);studySkillsClearRangeIE(g_aHighlightObjects[s].range),g_aHighlightObjects[s].range=p,rw_ieSpecificCallToSetHighlight(g_aHighlightObjects[s].range,g_aHighlightObjects[s].colour)}else if((c=g.duplicate()).collapse(!1),i.inRange(c)){for((m=g.duplicate()).collapse(!0);m.compareEndPoints("EndToStart",i)<0;)m.moveEnd("character",1);studySkillsClearRangeIE(g_aTextRange[s]),g_aTextRange[s]=m,rw_ieSpecificCallToSetHighlight(g_aTextRange[s],g_aHighlightColour[s])}if(g.inRange(i)){studySkillsClearRangeIE(g);var m=g.duplicate(),p=g.duplicate();for(m.collapse(!0),p.collapse(!1);m.compareEndPoints("EndToStart",i)<0;)m.moveEnd("character",1);for(;p.compareEndPoints("StartToEnd",i)>0;)p.moveStart("character",-1);studySkillsClearRangeIE(this.g_aHighlightObjects[s].range),this.g_aHighlightObjects[s].range=m;let e=this.rw_getStudySkillsPositionDataFromRange(p,this.g_aHighlightColour[s]),t=!0;this.g_aHighlightObjects.forEach(n=>{n.equals(e)&&(t=!1)}),t&&this.g_aHighlightObjects.push(e),rw_ieSpecificCallToSetHighlight(m,this.g_aHighlightObjects[s].colour),rw_ieSpecificCallToSetHighlight(p,this.g_aHighlightObjects[s].colour)}}i.execCommand("UnSelect",!1,null)}else{if(null==i||e){if(!e){if(!(!h.g_bAllowPopupAlertsFlag||confirm(t)))return h.bOverrideIgnore=!1,void(h.bOverrideAriaHidden=!1)}h.g_bPersistAnnotations&&(h.g_strStoredHighlightData=null,h.g_strStoredHighlightUnprocessedData=null);var f=this.g_aHighlightObjects;this.g_aHighlightObjects=new Array;for(l=0;l<f.length;l++)if(null!=f[l].range){(g=f[l].range).refresh();try{null!=n.rw_getElementQuerySelector("[data-ss-id="+f[l].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(g.startCaret,g.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(g.startCaret,g.endCaret))}}}else{i.refresh();let e=new Array;this.g_aHighlightObjects.forEach((t,n)=>{if(null!=t&&null!=t.range){let r=i.compareRange(t.range);e.push({obj:t,result:r,index:n})}}),e.sort((function(e,t){return e.result-t.result}));for(s=0;s<e.length;s++){var S=e[s].obj.range;if(null==S||null==i||i.body==S.body){var v=e[s].result;switch(v){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:S.refresh();try{null!=n.rw_getElementQuerySelector("[data-ss-id="+this.g_aHighlightObjects[e[s].index].startRefId.substr(3)+"]")&&this.rw_removeHighlight(this.getListOfHighlightableNodes(S.startCaret,S.endCaret))}catch(e){this.rw_removeHighlight(this.getListOfHighlightableNodes(S.startCaret,S.endCaret))}this.g_aHighlightObjects[e[s].index]=null,i.refresh();break;case 4:case 7:case 8:this.case1SFF(e[s].index,i,v);break;case 6:this.case2SFF(e[s].index,i);break;case 5:this.case3SFF(e[s].index,i)}}}}this.g_aHighlightsToRepaint.forEach(e=>{var t=new L(e.selectionRange.body,e.startRefPt.path,e.startRefPt.offset,e.endRefPt.path,e.endRefPt.offset),n=t.leftCaret,r=t.rightCaret;let i=this.rw_setHighlight(n.node,n.offset,r.node,r.offset,e.strOrigColour);S=new I(i.start,0,i.end,i.end.nodeValue.length);let a=this.rw_getStudySkillsPositionDataFromRange(S,e.strOrigColour),s=!0;this.g_aHighlightObjects.forEach(e=>{null!=e&&e.equals(a)&&(s=!1)}),s&&(a.renderedInView=!0,this.g_aHighlightObjects.push(a))}),this.g_aHighlightsToRepaint.length=0,this.g_aHighlightObjects=this.g_aHighlightObjects.filter(e=>e),n.rw_collapseSelection()}h.g_bPersistAnnotations&&h.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData()}catch(e){console.log("Error in method: "+e.name+" "+e.message+" "+e.description+" "+e.toString())}return h.bOverrideIgnore=!1,h.bOverrideAriaHidden=!1,this.rw_getStudySkillsPositionData()}}class Te{constructor(){this.g_nStickyNoteCount=0,this.g_nStickyNoteOpened=-1,this.g_strStickyNoteOrigText,this.openNoteCallback=null,this.closeNoteCallback=null}rw_createStickyNote(e){const t=e.target;if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){var n=(new F).getClickPoint(e);this.rw_createStickyNoteImpl(n,-1,null,!0)}}notesCallbacks(e,t){this.openNoteCallback=e,this.closeNoteCallback=t}loadNotes(e){this.rw_unserialiseStickyNotesInternalImpl(e,null)}rw_unserialiseStickyNotesInternalImpl(e,t){let n=new F;if(null!=e.notes&&e.notes.length>0)for(var r="",i="",a="",s=0;s<e.notes.length;s++){r=e.notes[s].id,i=e.notes[s].position,a=e.notes[s].text;var o=i.lastIndexOf("-");if(o>-1&&o<i.length-1){var l=i.substr(o+1),h=parseInt(l,10),u=null;if((o=(i=i.substring(0,o)).indexOf("^^"))>-1)for(;o>-1;)o=(i=i.substr(0,o)+i.substr(o+1)).indexOf("^^",o+1);if("idx"==i.substr(0,3)){var d=i.substr(3),g=n.rw_getElementQuerySelector("[data-ss-id="+d+"]");null!=g&&(-1==h&&rw_isSpan(g.tagName.toLowerCase())&&null!=g.firstChild&&1==g.firstChild.nodeType&&"img"==g.firstChild.tagName.toLowerCase()&&null==g.firstChild.nextSibling&&(g=g.firstChild),u=n.getCaretFromDomPosition(document.body,n.getPositionInDom(g),h,!0))}else u=n.getCaretFromDomPosition(document.body,i,h,!1);if(null!=u){if((o=a.indexOf("^^"))>-1)for(;o>-1;)o=(a=a.substr(0,o)+a.substr(o+1)).indexOf("^^",o+1);a=this.rw_custUnescape(a),(null==t||n.isElementContainedByElement(u.node,t))&&this.rw_createStickyNoteImpl(u,parseInt(r,10),a,!1)}}}}checkIfInsideHighlight(e){let t=new l;if(null==e||null==e.node)return e;var n=e.node;3==n.nodeType&&(n=n.parentNode);var r=t.rw_getAttribute(n,"rwstate"),i=t.rw_getAttribute(n,"rwTHgen");if(null!=r){for(;null!=r||null!=i;){if(null==(n=n.parentNode))return e;if(n==document.body)break;r=t.rw_getAttribute(n,"rwstate"),i=t.rw_getAttribute(n,"rwTHgen")}e=new a(n,0,!0)}return e}rw_createNoteImg(e,t){var n=null;if(h.g_bIEOld)try{n=document.createElement("<thStickyNote name='texthelpnote'>")}catch(e){n=null}null==n&&((n=document.createElement("thStickyNote")).name="texthelpnote"),n.setAttribute("alt",""),h.g_bIE&&null==e&&n.setAttribute("data-rwths","0"),null!=e&&n.setAttribute("title",e);let r=new l;return r.rw_setAttribute(n,"rwTHcomp","1"),(new F).addEvent(n,"click",this.$rw_clickOnStickyNote.bind(this)),r.rw_setAttribute(n,"texthelpnoteid",""+t),n.id="texthelpnote"+t,n.className="sticky_icon_unselected stickNotesIcon",n}$rw_clickOnStickyNote(e){var t=(new F).getTargetElement(e);this.openNoteCallback(t)}rw_removeNote(e){let t=new l,n=new F;var r="texthelpnote"+e;try{var i=document.getElementById(r);if(null!=i&&null!=i.parentNode){var a=i.parentNode;if(a.removeChild(i),!0,t.rw_getAttribute(a,"rwTHgen")&&n.rw_isSpan(a.tagName.toLowerCase())){var s=a.firstChild;if(null!=s&&null==s.nextSibling&&(3==s.nodeType||null==t.rw_getAttribute(s,"rwTHgen")&&null==t.rw_getAttribute(s,"rwTHcomp"))){var o=a.parentNode;o.insertBefore(s,a),o.removeChild(a)}}}}catch(e){}}rw_createStickyNoteImpl(e,t,n,r){let i=new F,s=new E,o=new l;if(null!=e&&null!=e.node&&null!=e.node.parentNode){var h=this.checkIfInsideHighlight(e),u=e!=h;if(u){var d=s.getNextNodeIgnoreChildren(h.node,!1,h.node.parentNode),g=s.getNextTextNodeNoImg(h.node,!1,d,!1);null!=g&&3==g.nodeType&&(h=new a(g,0,!0))}if(i.rw_checkIfCanHaveStickys(e.node)&&(!u||i.rw_checkIfCanHaveStickys(h.node))){var c;if(document.getElementsByName("texthelpnote").length>20)return;-1==t?(++this.g_nStickyNoteCount,c=this.g_nStickyNoteCount):(c=t,this.g_nStickyNoteCount<c&&(this.g_nStickyNoteCount=c+1));var m=this.rw_createNoteImg(n,c);if(u&&(e=h),1==e.node.nodeType){var p=i.createPlainSpan();o.rw_setAttribute(p,"rwTHgen","1"),(f=e.node).parentNode.insertBefore(p,f),p.appendChild(m),p.appendChild(f)}else if(3==e.node.nodeType){var f,S=e.offset,v=(f=e.node).nodeValue;if("boolean"==typeof eba_old_firefox_sticky_handling&&1==eba_old_firefox_sticky_handling||(S=0),0!=S){for(S>0&&S==v.length&&--S;S>0&&32==v.charCodeAt(S);)--S;for(var w;S>0&&((w=v.charCodeAt(S-1))>63&&w<91||w>94&&w<123||w>44&&w<58||34==w||39==w);)--S}if(0==S&&32==v.charCodeAt(0)){for(var b=1;b<v.length&&32==v.charCodeAt(b);)++b;if(b<v.length)S=b;else{var y=f.parentNode.previousSibling;if(null!=y&&1==y.nodeType&&"img"==y.tagName.toLowerCase()&&null!=o.rw_getAttribute(y,"texthelpnoteid"))return;var C=f.parentNode.nextSibling;if(null!=C&&1==C.nodeType&&"img"==C.tagName.toLowerCase()&&null!=o.rw_getAttribute(C,"texthelpnoteid"))return}}var T=i.splitText(f,S),x=T.parentNode.previousSibling;if(null!=x&&1==x.nodeType&&("img"==x.tagName.toLowerCase()||"thstickynote"==x.tagName.toLowerCase())&&null!=o.rw_getAttribute(x,"texthelpnoteid"))return;T.parentNode.parentNode.insertBefore(m,T.parentNode)}r&&this.openNoteCallback(m,!0)}}}rw_custUnescape(e){var t,n,r,i,a=e.length;for(t=0;t<a;t++)if(91==(r=e.charCodeAt(t))){for(n=t+1,i="",r=e.charCodeAt(n);n<a&&93!=r;)i+=e.charAt(n),++n<a&&(r=e.charCodeAt(n));try{r=h2d(i),a=(e=n<a?e.substr(0,t)+String.fromCharCode(r)+e.substr(n+1):e.substr(0,t)+String.fromCharCode(r)).length}catch(e){}}return e}rw_serialiseStickyNotesImpl(e){let t=new l,n=new F;h.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var r="texthelpnote"+e,i=document.getElementById(r);if(null!=i.parentNode&&i.parentNode.nodeType&&1==i.parentNode.nodeType||(i=null),null!=i&&"thstickynote"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"rwTHcomp")){t.rw_getAttribute(i,"texthelpnoteid");if(null!=r){var a,s;i.title;if(null!=i.nextSibling){var o=i.nextSibling;if(1!=o.nodeType||n.rw_isSpan(o.tagName.toLowerCase())){s=0,s+=n.rw_getNodeOffset(i);for(d=(u=i.parentNode).getAttribute("data-ss-id");(null==d||0==d.length)&&u!=document.body;)s+=n.rw_getNodeOffset(u),d=(u=u.parentNode).getAttribute("data-ss-id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),s=n.rw_getNodeOffset(i))}else{a=null==(d=o.getAttribute("id"))||0==d.length?n.getPositionInDom(i.parentNode):"idx"+d,s=-1}}else{s=0,s+=n.rw_getNodeOffset(i);for(var u,d=(u=i.parentNode).getAttribute("data-ss-id");(null==d||0==d.length)&&u!=document.body;)s+=n.rw_getNodeOffset(u),d=(u=u.parentNode).getAttribute("data-ss-id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),s=n.rw_getNodeOffset(i))}return{position:a+"-"+s}}}}}class xe{constructor(e){s(this,"setIgnorePageDefault",(function(e){this.m_bIgnoreDefault=e})),s(this,"isIgnorePageDefault",(function(){return this.m_bIgnoreDefault})),s(this,"setDocument",(function(e){this.m_doc=e})),s(this,"setIgnoreAll",(function(e){let t=new l,n=t.getIgnoreAttr();e?t.rw_setAttribute(this.m_doc.body,n,"1"):t.rw_removeAttribute(this.m_doc.body,n)})),s(this,"isIgnoreAll",(function(){let e=new l,t=e.getIgnoreAttr();return null!=e.rw_getAttribute(this.m_doc.body,t)})),s(this,"addIgnore",(function(e){let t=(new l).getIgnoreAttr();this.addAttribute(e,t,"1")})),s(this,"addAllow",(function(e){let t=(new l).getAllowAttr();this.addAttribute(e,t,"1")})),s(this,"removeIgnore",(function(e){let t,n=new l,r=n.getIgnoreAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),s(this,"removeAllow",(function(e){let t,n=new l,r=n.getAllowAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),s(this,"addIgnoreList",(function(e){if(null!=e)for(var t=0;t<e.length;t++)this.addIgnore(e[t])})),s(this,"addIgnoreListQuerySelector",(function(e){let t=this.m_doc.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addIgnore(t[e])})),s(this,"addAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.addAllow(e[t])})),s(this,"addAllowListQuerySelector",(function(e){let t=this.m_doc.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addAllow(t[e])})),s(this,"removeIgnoreList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeIgnore(e[t])})),s(this,"removeIgnoreListQuerySelector",(function(e){var t=this.m_doc.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeIgnore(t[e])})),s(this,"removeAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeAllow(e[t])})),s(this,"removeAllowListQuerySelector",(function(e){let t=this.m_doc.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeAllow(t[e])})),s(this,"addPronunciation",(function(e,t){this.addPronunciationImpl(this.m_doc.body,e,t)})),s(this,"removePronunciation",(function(e){this.removePronunciationImpl(this.m_doc.body,e)})),s(this,"addPronunciationById",(function(e,t,n){let r=this.m_doc.getElementById(e);null!=r&&this.addPronunciationImpl(r,t,n)})),s(this,"removePronunciationById",(function(e,t){let n=this.m_doc.getElementById(e);null!=n&&this.removePronunciationImpl(n,t)})),s(this,"replaceTextInElement",(function(e,t){let n=(new l).getPronunceAttr();this.addAttribute(e,n,t)})),s(this,"restoreTextInElement",(function(e){let t=new l,n=t.getPronunceAttr();t.rw_removeAttribute(this.m_doc.getElementById(e),n)})),s(this,"addCommand",(function(e,t){if("string"==typeof t){let n=(new l).getCommandAttr();this.addAttribute(e,n,t)}})),s(this,"removeCommand",(function(e){var t=this.m_doc.getElementById(e);null!=t&&this.removeCommands(t)})),s(this,"addCommandQueue",(function(e,t){if(t instanceof Array){let n=(new l).getCommandAttr();this.addAttribute(e,n,"list");for(let r=0;r<t.length;r++)this.addAttribute(e,n+(r+1),t[r])}})),s(this,"checkCommandsForPageID",(function(){let e=new Array,t=this.m_doc.querySelectorAll('[texthelpcmd^="pageid"]');if(null!=t&&t.length>0)for(let n=0;n<t.length;n++){let r=t[n].attributes.texthelpcmd.value;if(null!=r){let t=r.indexOf(":");t>-1&&e.push(r.substr(t+1))}}return e})),s(this,"setReadingOrder",(function(e){try{if(this.addAllowList(e),e instanceof Array&&e.length>0){for(let t=0;t<e.length-1;t++)this.addCommand(e[t],"jump:"+e[t+1]);this.addCommand(e[e.length-1],"stopafter")}}catch(e){}})),s(this,"setStrictReadingOrder",(function(e){this.clearAllReadingOrders(),this.setIgnoreAll(!0),this.setReadingOrder(e)})),s(this,"clearReadingOrder",(function(e){try{if(this.removeAllowList(e),e instanceof Array&&e.length>0)for(let t=0;t<e.length;t++)this.removeCommand(e[t])}catch(e){}})),s(this,"clearAllReadingOrders",(function(){try{this.clearAllReadingOrderImpl(this.m_doc.body)}catch(e){}})),s(this,"clearAllCommands",(function(){try{this.clearAllCommandsImpl(m_doc.body)}catch(e){}})),this.m_bIgnoreDefault=!1,this.m_doc=e||document}clearAllReadingOrderImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllReadingOrderImpl(t.firstChild),this.removeAllowIgnore(t),this.removeCommands(t),t=t.nextSibling}clearAllCommandsImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllCommandsImpl(t.firstChild),this.removeCommands(t),t=t.nextSibling}addAttribute(e,t,n){let r;if(r="object"==typeof e?e:this.m_doc.getElementById(e),null!=r){(new l).rw_setAttribute(r,t,n)}}addPronunciationImpl(e,t,n){let r=e,i=new E,a=i.getFirstChildTextNode(e,!1);for(;a;){let e=this.checkNodeForPronunciation(a,t,n);null!=e?(a=i.getNextNodeIgnoreChildren(e,!1,r),3!=a.nodeType&&(a=i.getNextTextNodeNoBlank(a,!1,r))):a=i.getNextTextNodeNoBlank(a,!1,r)}}removePronunciationImpl(e,t){let n=e,r=new E,i=r.getFirstChildTextNode(e,!1);for(;i;){let e=r.getNextTextNodeNoBlank(i,!1,n);this.checkNodeForRemovingPronunciation(i,t),i=e}}checkNodeForPronunciation(e,t,n){if(3==e.nodeType){let r=e.nodeValue;if(r.indexOf(t)>-1){let i=(new l).getPronunceAttr(),a=r.indexOf(t);return(new F).wrapText(e,a,a+t.length,[i,n])}}return e}checkNodeForRemovingPronunciation(e,t){if(3==e.nodeType&&e.nodeValue==t){let t=new l,n=t.getPronunceAttr();if(null!=e.parentNode&&null!=t.rw_getAttribute(e.parentElement,n)){let t=e.parentNode,n=t.parentNode;null!=n&&n.replaceChild(e,t)}}}removeAllowIgnore(e){if(null!=e){let t=new l,n=t.getAllowAttr();t.rw_removeAttribute(e,n);let r=t.getIgnoreAttr();t.rw_removeAttribute(e,r)}}removeCommands(e){if(null!=e){let t=new l,n=t.getCommandAttr();t.rw_removeAttribute(e,n);let r=1,i=t.rw_getAttribute(e,"texthelpCmd"+r);for(;null!=i;)t.rw_removeAttribute(e,"texthelpCmd"+r),++r,i=t.rw_getAttribute(e,"texthelpCmd"+r)}}async tagSentences(e,t,n){if(null!=e){let r=new ye(n);await r.tagSentencesWithFramesImpl(e,t)}}}class Ne{constructor(...e){if(1===e.length){h.init(e[0]);const{sre:t,mathJax:n,tagPage:r,tagClass:i,wrapperTag:a,highlightTag:s,url:o}=e[0];if(this.initialise({url:o,sre:t,mathJax:n}),h.tagPage){void 0!==i&&b(i),void 0!==a&&y(a),void 0!==s&&C(wraphighlightTagperTag),new ye(this).tagSentencesWithFramesImpl(window)}}else{const[,t]=e;this.initialise({url:t})}}initialise(e){if(this.mathLoaded=!1,this.mathJaxInstance,this.sreInstance,e.sre&&(g(e.sre),this.sreInstance=e.sre,this.mathLoaded=!0),e.mathJax&&(this.mathJaxInstance=e.mathJax,c(e.mathJax)),this.selectionController=new H,this.highlightSettings=new we,this.speechHighlightManager=null,this.hoverSpeak=new ge,this.clickToSpeak=new be,this.speechObject=new ue,h.tagPage?this.studySkills=new Ce:this.studySkills=new ce,this.notes=new Te,h.bMathsSymbols&&(this.mathSymbolControl=new de,this.mathWithContext=!1,h.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(h.mathSymbolMapping),h.mathWithContext&&(this.mathWithContext=!0),this.speechObject.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),this.hoverSpeakOn=!1,this.url=e.url,null!=e.url&&(void 0===this.mathJaxInstance&&"undefined"!=typeof MathJax&&MathJax.version&&(this.mathJaxInstance=MathJax,c(this.mathJaxInstance)),void 0!==this.mathJaxInstance&&this.mathJaxInstance.version))if(this.mathJaxInstance.version.startsWith("3")||this.mathJaxInstance.version.startsWith("4"))this.mathJaxInstance.loader.load("a11y/semantic-enrich").then(()=>{void 0===this.sreInstance&&(!this.mathJaxInstance.version.startsWith("4")&&this.mathJaxInstance._.a11y.sre?(this.sreInstance=this.mathJaxInstance._.a11y.sre.Sre,g(this.sreInstance)):"undefined"==typeof sre&&(console.log("No SRE included so inject it now. "+e.url+"sre_browser.js"),this.load_script(e.url+"sre_browser.js"))),this.mathLoaded=!0});else if(void 0!==this.mathJaxInstance.Ajax&&"function"==typeof this.mathJaxInstance.Ajax.Load){let n=!1;for(var t in this.mathJaxInstance.Ajax.loaded)if(t.indexOf("toMathML")>-1){n=!0;break}n||this.mathJaxInstance.Ajax.Load(e.url+"toMathML.js"),this.load_script(e.url+"sre_browser.js"),this.mathLoaded=!0}this.predictionOn=!1,this.predictionManager=new ve,this.textareaParser=new i,r.a.subscribe("pauseHover",this.pauseHover.bind(this)),this.isHoverSpeakEnabled=!1,this.addEventsToWindow(window),h.addEventsToFrames&&(this.setUpiframes(),this.setUpIFrameObserver()),this.ignoreToolbarId=h.toolbarID}unload(){this.removeEventsFromWindow(window)}getDocumentLanguage(e){return null!=e?frames.document.documentElement.lang:document.documentElement.lang}clickEvent(e){let t=e.target.shadowRoot;if(t)for(let e=0;e<t.children.length;e++)if(t.children[e].id==this.ignoreToolbarId)return;this.clickToSpeakOn&&this.mouseClickEvent(e)}moveEvent(e){let t=e.target.shadowRoot;if(t)for(let e=0;e<t.children.length;e++)if(t.children[e].id==this.ignoreToolbarId)return;this.isHoverSpeakEnabled&&this.mouseOverEvent(e)}addEventsToWindow(e){const t=this.clickEvent.bind(this);e.addEventListener("click",t,!1);const n=this.moveEvent.bind(this);e.addEventListener("mousemove",n,!1),e.addEventListener("uninstallHTMLParser",()=>{e.removeEventListener("click",t,!1),e.removeEventListener("mousemove",n,!1)},!1)}removeEventsFromWindow(e){let t=new CustomEvent("uninstallHTMLParser");e.dispatchEvent(t)}setUpIFrameObserver(){this.targetElement=document;this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(this.targetElement,{attributes:!1,characterData:!0,childList:!0,subtree:!0})}observerFunction(e){e.forEach(function(e){[].filter.call(e.addedNodes,function(e){return"IFRAME"==e.nodeName||"SCRIPT"==e.nodeName||e.querySelector&&e.querySelector("iframe")}.bind(this)).forEach(function(e){var t;"IFRAME"==e.nodeName?"complete"===(null===(t=e.contentDocument)||void 0===t?void 0:t.readyState)?this.addEventsToFrame(e):e.addEventListener("load",function(t){if(this.addEventsToFrame(e),h.tagPage){new ye(this).tagSentencesWithFramesImpl(e.contentWindow)}}.bind(this)):e.querySelector&&e.querySelector("iframe")?e.querySelectorAll("iframe").forEach(function(e){var t;"complete"===(null===(t=e.contentDocument)||void 0===t?void 0:t.readyState)?this.addEventsToFrame(e):e.addEventListener("load",function(t){if(this.addEventsToFrame(e),h.tagPage){new ye(this).tagSentencesWithFramesImpl(e.contentWindow)}}.bind(this))}.bind(this)):"SCRIPT"==e.nodeName&&e.src.includes("MathJax.js")&&e.addEventListener("load",function(t){this.forceLoadMath(e.ownerDocument.defaultView)}.bind(this))}.bind(this))}.bind(this))}addEventsToFrame(e){try{var t;e.document?t=e:e.contentWindow&&(t=e.contentWindow),null!=t&&(this.addEventsToWindow(t),this.checkForChildFrames(t),this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(t.document.body,{childList:!0,subtree:!0}),void 0!==t.MathJax&&(t.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}catch(e){}}checkForChildFrames(e){var t;if(e.frames.length>0)for(t=0;t<e.frames.length;t++)this.addEventsToFrame(e.frames[t])}setUpiframes(){if(window.frames.length>0)for(let e=0;e<window.frames.length;e++)try{this.addEventsToFrame(window.frames[e])}catch(e){}}iframeCallback(e){this.hoverSpeakOn&&this.speechCallback&&this.hoverSpeak.mouseMoved(e,this.speechCallback),this.clickToSpeakOn&&this.speechCallback&&this.clickToSpeak.mouseClick(e,this.speechCallback)}forceLoadMath(e){void 0===this.mathJaxInstance&&"undefined"!=typeof MathJax&&MathJax.version&&(this.mathJaxInstance=MathJax,c(this.mathJaxInstance)),void 0!==this.mathJaxInstance&&this.mathJaxInstance.version&&(this.mathJaxInstance.version.startsWith("3")||this.mathJaxInstance.version.startsWith("4")?this.mathJaxInstance.loader.load("a11y/semantic-enrich").then(()=>{void 0===this.sreInstance&&(this.mathJaxInstance._.a11y.sre?(this.sreInstance=this.mathJaxInstance._.a11y.sre.Sre,g(this.sreInstance)):"undefined"==typeof sre&&(console.log("No SRE included so inject it now. "+config.url+"sre_browser.js"),this.load_script(config.url+"sre_browser.js"))),this.mathLoaded=!0}):void 0!==this.mathJaxInstance.Ajax&&"function"==typeof this.mathJaxInstance.Ajax.Load&&(e?(e.MathJax.version,"function"==typeof e.MathJax.Ajax.Load&&(MathJax.isReady?this.loadToMathML():setTimeout(this.loadToMathML,5e3),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0))):this.mathLoaded||this.mathJaxInstance.version&&"function"==typeof this.mathJaxInstance.Ajax.Load&&(MathJax.isReady?this.loadToMathML():setTimeout(this.loadToMathML,5e3),this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}loadToMathML(){let e=!1;for(var t in MathJax.Ajax.loaded)if(t.indexOf("toMathML")>-1){e=!0;break}e||MathJax.Ajax.Load(this.url+"toMathML.js")}pauseHover(){this.hoverSpeakOn||this.isHoverSpeakEnabled?(this.hoverSpeakOn=!1,this.isHoverSpeakEnabled=!0,this.pauseHoverTimer=setTimeout(()=>this.unPauseHover(),300)):this.isHoverSpeakEnabled=!1}unPauseHover(){this.isHoverSpeakEnabled&&(this.hoverSpeakOn=!0)}clearHoverSpeak(){this.hoverSpeak.clearHoverSpeak()}load_script(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.className="MyInjectedScript",document.getElementsByTagName("head")[0].appendChild(t)}predictionEnabled(e){this.predictionOn=e}getPredictionCoordinates(){return this.predictionManager.getPredictionCoordinates()}getPredictionSentence(){return this.predictionManager.getPredictionSentence()}predictionInsertText(e,t,n){this.textareaParser.replaceWordAtCursor(e,t,n)}textareaInsertText(e,t){this.textareaParser.insertText(e,t)}textareaGetText(e){return this.textareaParser.getText(e)}textareaGetCaretPosition(e){return this.textareaParser.getCaretPosition(e)}getInputElement(e){return this.textareaParser.getInputElement(e)}getInputElementTypes(){return this.textareaParser._inputTypeEnum}isEditable(){return this.predictionManager.isEditable()}predictionElement(e){let t={target:e};this.predictionManager.onMouseDown(t)}predictionSetSelectionRange(e,t,n){this.predictionManager.setSelectionRange(e,t,n)}hoverSpeakEnabled(e){this.hoverSpeakOn=e,this.isHoverSpeakEnabled=e,e||clearTimeout(this.pauseHoverTimer)}clickToSpeakEnabled(e){this.clickToSpeakOn=e}mouseOverEvent(e,t){this.speechCallback=t,this.isHoverSpeakEnabled?this.hoverSpeak.mouseMoved(e,this.speechCallback):clearTimeout(this.pauseHoverTimer)}mouseClickEvent(e,t){this.clickToSpeakOn&&this.clickToSpeak.mouseClick(e,t)}hasSelection(){return this.selectionController.hasSelection()}getWord(){var e=new Array,t=this.selectionController.getSelectionRange();if(t&&(e=t.toString().split(/\s/)).length>0)return e.length>2||1==e.length?new Array(e[0]):new Array(e[0],e[1]);return null}getSelection(){return this.selectionController.getSelectionRange().toString().split(/\s/)}getSelectionLocal(){return this.getSelection()}clearSelection_(){this.selectionController.clearSelection_()}clearBrowserSelection(){this.selectionController.clearBrowserSelection()}hiliteSelection(){var e=null;if(this.hasSelection()||this.hoverSpeakOn||this.clickToSpeakOn){if(this.sentenceNo=0,this.hoverSpeakOn){var t=this.hoverSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else if(this.clickToSpeakOn){t=this.clickToSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else this.speechObject.processRange(this.selectionController.getSelectionRange(),!1);(e=this.speechObject.getFirstSentence())&&""==e.getRawText()&&(e=this.speechObject.getNextSentence(!0))}else{let n;if(null!=h.playStartPoint&&""!=h.playStartPoint)if("string"==typeof h.playStartPoint)try{n=this.getFirstReadableElement(document.getElementById(h.playStartPoint))}catch{n=this.getFirstReadableElement()}else try{n=this.getFirstReadableElement(h.playStartPoint)}catch{n=this.getFirstReadableElement()}else n=this.getFirstReadableElement();t=new I(n,0,n,0),this.speechObject.processRange(t,!0),e=this.speechObject.getCurrentSentence()}if(null!=e){e.highlight&&this.selectionController.clearBrowserSelection(),this.speechObject.actOnCommand(e);var n={};return n.textToRead=e.getWords(),n.textToDisplay=e.getRawText(),n.isMath=e.isMathML(),0==n.textToRead.length?"":(this.speechHighlightManager=new Y(e,this.highlightSettings),this.speechHighlightManager.highlightRange(),n)}return""}getFirstReadableElement(e){let t=e||document.body.children[0];for(;t;){let e=new I(t,0,t,0),n=new ue;n.processRange(e,!0);let r=n.getCurrentSentence(),i={};if(i.textToRead=r.getWords(),0!=i.textToRead.length)return t;t=n.getNextSentence(!0).m_caretRange.leftCaret.node.parentElement}}highlightElementById(e){let t=null;if(this.speechObject.processRange(this.selectionController.getElementRangeById(e),!1),t=this.speechObject.getFirstSentence(),t&&""==t.getRawText()&&(t=this.speechObject.getNextSentence(!0)),this.selectionController.clearBrowserSelection(),null!=t){let e=t.getWords();return 0==e.length?"":(this.speechHighlightManager=new Y(t,this.highlightSettings),this.speechHighlightManager.highlightRange(),e)}return""}hiliteWord(e){this.speechHighlightManager.highlightWord(e)}stop(){null!=this.speechObject.getCurrentSentence()&&null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),this.hoverSpeak.clearHoverTags(),this.clickToSpeak.clearHoverTags()}hiliteNextSentence(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),null!=this.hoverSpeak&&this.hoverSpeak.clearHoverTags();var t=this.speechObject.getNextSentence(e),n=null;return null!=t&&(t.m_range.refresh(),t.m_caretRange.refresh(t.m_range.body,t.m_range.startRef.path,t.m_range.startRef.offset,t.m_range.endRef.path,t.m_range.endRef.offset),this.speechObject.actOnCommand(t),t.stop||(n=t.getWords(),this.speechHighlightManager=new Y(t,this.highlightSettings),this.speechHighlightManager.highlightRange(t))),n}hilitePreviousSentence(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),null!=this.hoverSpeak&&this.hoverSpeak.clearHoverTags();var t=this.speechObject.getPreviousSentence();this.speechObject.actOnCommand(t);var n=null;return null!=t&&(n=t.getWords(),this.speechHighlightManager=new Y(t,this.highlightSettings),this.speechHighlightManager.highlightRange(t)),n}getLanguageForSentence(){let e=this.speechObject.getCurrentSentence();return(null==e?void 0:e.getLangTag())||null}loadPersistantHighlightToPage(e){null!=e&&this.studySkills.rw_retrieveHighlightDataForPKTReplyImpl(e,null)}restoreHighlights(){this.studySkills.rw_restoreHighlights()}removePersistantHighlight(e){return this.studySkills.studySkillsClearHighlights(e)}addPersistantHighlightToPage(e){return this.studySkills.studySkillsHTMLHighlightRange(e)}highlightSelection(e){var t=this.selectionController.getSelectionObject();this.studySkills.studySkillsHTMLHighlightRange(e,t)}clearHighlights(){var e=null;this.hasSelection()&&(e=this.selectionController.getSelectionObject()),this.studySkills.studySkillsClearHighlights(!1,e)}collectHighlights(e,t){var n=new Array;if(2==e)for(var r=0;r<t.length;r++)n.push(...this.studySkills.studySkillsCollateForColour(t[r]));else n.push(...this.studySkills.studySkillsCollateForPosition(t));return n}collectVocabWords(e){}notesCallbacks(e,t){this.notes.notesCallbacks(e,t)}loadNotes(e){this.notes.loadNotes(e)}removeNote(e){this.notes.rw_removeNote(e)}getNotePostion(e){return this.notes.rw_serialiseStickyNotesImpl(e)}createStickyNote(e){this.notes.rw_createStickyNote(e)}restoreNotes(){this.notes.rw_unserialiseStickyNotesInternalImpl()}addVoiceNote(){}collectVocabs(e,t,n){return this.studySkills.fetchWords()}onMouseUp(e){}onMouseDown(e){this.predictionManager.onMouseDown(e)}onKeyDown(e){this.predictionManager.onKeyDown(e)}setWordHighlightStyle(e){this.highlightSettings.speechWordColour=e}setSentenceHighlightStyle(e){this.highlightSettings.speechRangeColour=e}getNewDomControl(e){return new xe(e)}setAnnounceLinksAsWords(e){h.strAnnounceLinksAsWords=e}getAnnounceLinksAsWords(){return h.strAnnounceLinksAsWords}setBreakList(e,t){T(e,t)}setStyleList(e,t){x(e,t)}setMathSreSettings(e){h.mathSre=e}getMathSreSettings(){return h.mathSre}setNoScroll(e){h.no_scroll=e}getNoScroll(){return h.no_scroll}setPlayStartPoint(e){h.playStartPoint=e}getPlayStartPoint(){return h.playStartPoint}setReadAriaHidden(e){h.overrideAriaHidden=e}getReadAriaHidden(){return h.overrideAriaHidden}setAriaLabelOnMathRoleEnabled(e){h.ariaLabelOnMathRoleEnabled=e}getAriaLabelOnMathRoleEnabled(){return h.ariaLabelOnMathRoleEnabled}setAriaLabelOnMathJaxClassEnabled(e){h.ariaLabelOnMathJaxClassEnabled=e}getAriaLabelOnMathJaxClassEnabled(){return h.ariaLabelOnMathJaxClassEnabled}setCustomReadingAttributeEnabled(e){h.customReadingAttribute=e}getCustomReadingAttributeEnabled(){return h.customReadingAttribute}setCustomReadingRules(e){h.customReadingRules=e}getCustomReadingRules(){return h.customReadingRules}setReadMathMLAltText(e){h.readMathMLAltText=e}getReadMathMLAltText(){return h.readMathMLAltText}setWrapperTagClass(e){b(e)}setWrapperTag(e){y(e)}setHighlightTag(e){C(e)}setBreakList(e,t){T(e,t)}setStyleList(e,t){x(e,t)}setSreInstance(e){g(e)}setMathJaxInst(e){c(e)}getSelectionObjectBySentences(e){return this.selectionController.getSelectionSentencesObject(e)}breakIntoSentences(e){const t=new k;let n=[];if("string"!=typeof e)return n;if(""===e)return n;for(;t.getSentenceBreakPoint(e)>-1;){let r=t.getSentenceBreakPoint(e);-1!==r&&(n.push(e.substring(0,r+1).trim()),e=e.substring(r+1))}return n.push(e.trim()),n}getTranslationFromMath(e,t){let n;return n=(new m).getRawTextFromMathJaxForLocale(e,t),n}}}}]);
</script>

</body>
</html>
