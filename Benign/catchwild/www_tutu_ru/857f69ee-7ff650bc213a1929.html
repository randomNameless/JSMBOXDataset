<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>857f69ee-7ff650bc213a1929.html</title>
</head>
<body>

<script>
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{20749:(e,t,n)=>{n.d(t,{MJ:()=>ec,R0:()=>nG,TT:()=>eb,Yw:()=>eM,jz:()=>nV,n7:()=>eR});var r,o,i,s,c,a,l,u,d,h,_,E,C,g,A,m,T,f=n(96540),S=n(56453),I=n(31635),O=n(56534),p=n(29242),v=n(89309),y=n(83902),N=n(34164),L=n(36019),R=n(49038),k=n(21855),b=n(7483),w=n(28715),H=n(41162),F=n(19435),U=n(16402),P=n(72191),D=n(79775),M=n(66716),G=n(7886),B=n(28146),j=n(87177),W=n(13550),Y=n(73112),x=n(39079),K=n(87695),V=n(25560),z=n(23895),X=n(27545),q=n(79041),$=n(97283),Q=n(7282),J=n(23491),Z=n(68898),ee=n(74033),et=n(40255),en=n(17753),er=n(35436),eo=n(71457),ei=n(2710),es=f.createContext(null),ec=es.Provider,ea="checkCodeScreen",el="loginByContactScreen",eu="securityErrorScreen",ed="addEmailOrPhone",eh={LOGIN:el,CHECK_CODE:ea,SECURITY_ERROR:eu},e_="addPhone",eE={LOGIN:el,CHECK_CODE:ea,SECURITY_ERROR:eu},eC="increaseSecurityLevel",eg={CHECK_CODE:ea,SECURITY_ERROR:eu,SPINNER:"spinnerScreen"},eA="loginByEmailAndPass",em={LOGIN:"loginByEmailAndPassScreen"},eT="loginByEmailOrPhone",ef={LOGIN:el,CHECK_CODE:ea,SECURITY_ERROR:eu},eS="registrationByContactScreen",eI="registrationByEmailAndCode",eO={REGISTER:eS,CHECK_CODE:ea,SECURITY_ERROR:eu},ep="registrationByPhoneAndCode",ev={REGISTER:eS,CHECK_CODE:ea,SECURITY_ERROR:eu},ey="resetScreen",eN="resetPassByEmail",eL={LOGIN:el,CHECK_CODE:ea,RECOVERY:ey,SECURITY_ERROR:eu},eR={REGISTRATION_BY_EMAIL_AND_CODE:eI,REGISTRATION_BY_PHONE_AND_CODE:ep,LOGIN_BY_EMAIL_AND_PASS:eA,LOGIN_BY_EMAIL_OR_PHONE:eT,RESET_PASS_BY_EMAIL:eN,ADD_EMAIL_OR_PHONE:ed,ADD_PHONE_FLOW:e_,INCREASE_SECURITY_LEVEL:eC},ek=eR.LOGIN_BY_EMAIL_OR_PHONE,eb=(0,f.memo)(function(e){var t=e.flow,r=(0,S.OB)(function(e){return n(88436)("./".concat(e,"/index.json"))}),o=(0,S.OB)(function(e){return n(68389)("./".concat(e,"/index.json"))}),i=(0,S.OB)(function(e){return n(16554)("./".concat(e,"/index.json"))}),s=(0,S.OB)(function(e){return n(52308)("./".concat(e,"/index.json"))}),c=(0,S.OB)(function(e){return n(61121)("./".concat(e,"/index.json"))}),a=(0,S.OB)(function(e){return n(38923)("./".concat(e,"/index.json"))}),l=(0,S.OB)(function(e){return n(4237)("./".concat(e,"/index.json"))}),u=function(){switch(t){case eR.RESET_PASS_BY_EMAIL:return r("title");case eR.REGISTRATION_BY_EMAIL_AND_CODE:return o("title");case eR.REGISTRATION_BY_PHONE_AND_CODE:return i("title");case eR.LOGIN_BY_EMAIL_AND_PASS:return s("title");case eR.ADD_EMAIL_OR_PHONE:return c("title");case eR.LOGIN_BY_EMAIL_OR_PHONE:return l("title");case eR.ADD_PHONE_FLOW:return a("title");default:return""}}();return 0===u.length?null:u}),ew={REGISTRATION_BY_EMAIL_AGREEMENT:"https://www.tutu.ru/2read/legal_information/legal_tuturu/",REGISTRATION_BY_PHONE_CHECKBOX_AGREEMENT:"https://www.tutu.ru/2read/legal_information/reg_lc_mobile/",REGISTRATION_BY_EMAIL_POLITICS:"https://www.tutu.ru/2read/legal_information/legal_personal/"},eH=Symbol("Controllers"),eF={packageName:"@tutu-react/authentication-ui",packageVersion:"2.10.1"};(r||(r={})).CHANGE="change";var eU=function(e){var t=(0,f.useRef)();return(0,f.useEffect)(function(){t.current=e}),t.current},eP=function(e){void 0===e&&(e=function(){});var t=(0,f.useRef)(!1);t.current||(e(),t.current=!0)};function eD(){var e=(0,f.useContext)(es);if(null===e)throw Error("useAuthUiController must be used inside AuthControllerProvider");return e}var eM=function(){var e=eD(),t=e[eH].app,n=e[eH].history,o=(0,f.useCallback)(function(){return t.historyGoBack()},[t]),i=(0,I.zs)((0,f.useState)(n.canUndo),2),s=i[0],c=i[1];return(0,f.useEffect)(function(){var e=n.on(r.CHANGE,function(){c(n.canUndo)});return c(n.canUndo),e},[n]),{canUndo:s,undo:o}};(o||(o={})).CHANGE_FLOW="changeFlow";var eG=Symbol("EventEmitter.errorMonitor"),eB=function(){function e(e){this.eventListenerSetMap=new Map,this.on(e)}return e.prototype.getEventListeners=function(e){var t=this.eventListenerSetMap.get(e);return t?(0,I.fX)([],(0,I.zs)(t),!1):[]},e.prototype.off=function(e,t){if(void 0!==e&&t){var n=this.eventListenerSetMap.get(e);n&&n.delete(t)&&0===n.size&&this.eventListenerSetMap.delete(e)}else void 0!==e?this.eventListenerSetMap.delete(e):this.eventListenerSetMap.clear()},e.prototype.on=function(){for(var e,t,n,r,o=this,i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];if(2===i.length){var c=(0,I.zs)(i,2),a=c[0],l=c[1],u=this.eventListenerSetMap.get(a);u||this.eventListenerSetMap.set(a,u=new Set);var d="error"===a||a===eG?l:function(e){return(0,I.sH)(o,void 0,void 0,function(){var t,n,r;return(0,I.YH)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,8]),[4,l(e)];case 1:return o.sent(),[3,8];case 2:if(t=o.sent(),!(null===(n=this.eventListenerSetMap.get(eG))||void 0===n?void 0:n.size))return[3,4];return[4,this.emit(eG,t)];case 3:o.sent(),o.label=4;case 4:if(!(null===(r=this.eventListenerSetMap.get("error"))||void 0===r?void 0:r.size))return[3,6];return[4,this.emit("error",t)];case 5:return o.sent(),[3,7];case 6:throw t;case 7:return[3,8];case 8:return[2]}})})};return u.add(d),this.off.bind(this,a,d)}var h=(0,I.zs)(i,1)[0],_=[];if(null!=h)try{for(var E=(0,I.Ju)((0,I.fX)((0,I.fX)([],(0,I.zs)(Object.getOwnPropertyNames(h)),!1),(0,I.zs)(Object.getOwnPropertySymbols(h)),!1)),C=E.next();!C.done;C=E.next()){var a=C.value,g=h[a];if(null!=g){var A=Array.isArray(g)?g:[g];try{for(var m=(n=void 0,(0,I.Ju)(A)),T=m.next();!T.done;T=m.next()){var f=T.value;null!=f&&_.push(this.on(a,f))}}catch(e){n={error:e}}finally{try{T&&!T.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}}}}catch(t){e={error:t}}finally{try{C&&!C.done&&(t=E.return)&&t.call(E)}finally{if(e)throw e.error}}return _},e.prototype.once=function(e,t){var n=this,r=this.on(e,function(e){return(0,I.sH)(n,void 0,void 0,function(){return(0,I.YH)(this,function(n){switch(n.label){case 0:return r(),[4,t(e)];case 1:return n.sent(),[2]}})})});return r},e.prototype.wait=function(e,t){return(0,I.sH)(this,void 0,void 0,function(){var n=this;return(0,I.YH)(this,function(r){return[2,new Promise(function(r,o){var i,s=null!=t&&t>0?setTimeout(function(){i&&i(),o(Error('Has waited for the "'.concat(String(e),'" event more than ').concat(t,"ms")))},t):null;i=n.once(e,function(e){s&&clearTimeout(s),r(e)})})]})})},e.prototype.getEventNames=function(){return(0,I.fX)([],(0,I.zs)(this.eventListenerSetMap.keys()),!1)},e.prototype.getEventListenerCount=function(e){var t,n;return null!==(n=null===(t=this.eventListenerSetMap.get(e))||void 0===t?void 0:t.size)&&void 0!==n?n:0},e.prototype.emit=function(e,t){return(0,I.sH)(this,void 0,void 0,function(){var n=this;return(0,I.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.all(this.getEventListeners(e).map(function(e){return(0,I.sH)(n,void 0,void 0,function(){return(0,I.YH)(this,function(n){return[2,e(t)]})})}))];case 1:return r.sent(),[2]}})})},e.prototype.emitSerial=function(e,t){return(0,I.sH)(this,void 0,void 0,function(){var n,r,o,i;return(0,I.YH)(this,function(s){switch(s.label){case 0:s.trys.push([0,5,6,7]),r=(n=(0,I.Ju)(this.getEventListeners(e))).next(),s.label=1;case 1:if(r.done)return[3,4];return[4,(0,r.value)(t)];case 2:s.sent(),s.label=3;case 3:return r=n.next(),[3,1];case 4:return[3,7];case 5:return o={error:s.sent()},[3,7];case 6:try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},e}(),ej={UI:function(e){function t(n){var r=e.call(this,n)||this;return r.name=t.errorName,Object.setPrototypeOf(r,t.prototype),r}return(0,I.C6)(t,e),t.errorName="UiError",t}(Error).errorName,WIDGET_API:"WidgetApiError",AUTH_API:"AuthApiError"};!function(e){e.EBADREQUEST="EBADREQUEST",e.EBADCSRFTOKEN="EBADCSRFTOKEN",e.EOAUTH="EOAUTH"}(i||(i={})),function(e){e.LOGIN_PASSWORD_INCORRECT="login_password_incorrect",e.IDENTITY_NOT_FOUND="identity_not_found",e.ACCOUNT_EXISTS="account_exists",e.VALIDATION_ERROR="validation_error",e.ALREADY_AUTHENTICATED="already_authenticated",e.MAX_ATTEMPTS_REACHED="attempts_limit_reached",e.SESSION_NOT_FOUND="session_not_found",e.SESSION_EXPIRED="session_expired",e.SESSION_NOT_VALID="session_not_valid",e.FOREIGN_CONTACT="foreign_contact",e.CODE_NOT_FOUND="code_not_found",e.CODE_INCORRECT="code_incorrect",e.CODE_EXISTS="code_exists",e.SAME_PASSWORD="same_password",e.UNAUTHENTICATED="unauthenticated",e.AUTH_OLD_INTERNAL_ERROR="auth_old_internal_error",e.INTERNAL="internal"}(s||(s={})),(c||(c={})).UI_VALIDATION_ERROR="ui_validation_error",(a||(a={})).IS_STRING="isString",function(e){e.UNKNOWN="unknown",e.NOT_EXIST="notExist",e.REQUIRED="required",e.IDENTITY_NOT_FOUND="identityNotFound",e.ACCOUNT_EXISTS="accountExists",e.ALREADY_AUTHENTICATED="alreadyAuthenticated",e.MAX_ATTEMPTS_REACHED="maxAttemptsReached",e.SESSION="session",e.CODE_INCORRECT="codeIncorrect",e.CODE_NOT_FOUND="codeNotFound",e.LOGIN_PASSWORD_INCORRECT="loginPasswordIncorrect",e.HUMAN_NAME="humanName",e.ONLY_STRING="onlyString",e.ONLY_LETTERS="onlyLetters",e.ONLY_NUMBERS="onlyNumbers",e.LETTERS_OR_NUMBERS="lettersOrNumbers",e.LENGTH="length",e.MIN_NUMBER="minNumber",e.MAX_NUMBER="maxNumber",e.PHONE_NUMBER="phoneNumber",e.FOREIGN_CONTACT="foreignContact",e.MIN_LENGTH="minLength",e.MAX_LENGTH="maxLength",e.NOT_TRUE_VALUE="notTrue",e.EMAIL="email",e.SAME_PASSWORD="samePassword",e.POPUP_WAS_BLOCKED="POPUP_WAS_BLOCKED",e.POPUP_WAS_BLOCKED_IOS_SAFARI="POPUP_WAS_BLOCKED_IOS_SAFARI"}(l||(l={}));var eW=function(e){function t(n){var r=n.type,o=n.retryInSeconds,i=e.call(this)||this;return i.type=r,"number"==typeof o&&(i.canBeRetriedAfterSeconds=o),Object.setPrototypeOf(i,t.prototype),i}return(0,I.C6)(t,e),t}(Error),eY=function(e){function t(n){var r=n.type,o=n.required,i=n.current,s=e.call(this,{type:r})||this;return s.requiredLength=o,s.currentLength=i,Object.setPrototypeOf(s,t.prototype),s}return(0,I.C6)(t,e),t}(eW),ex=function(e){function t(n){var r=n.type,o=n.required,i=n.current,s=e.call(this,{type:r})||this;return s.requiredMinLength=o,s.currentLength=i,Object.setPrototypeOf(s,t.prototype),s}return(0,I.C6)(t,e),t}(eW),eK=function(e){function t(n){var r=n.type,o=n.required,i=n.current,s=e.call(this,{type:r})||this;return s.requiredMaxLength=o,s.currentLength=i,Object.setPrototypeOf(s,t.prototype),s}return(0,I.C6)(t,e),t}(eW);!function(e){(0,I.C6)(function t(n){var r=n.type,o=n.required,i=n.current,s=e.call(this,{type:r})||this;return s.requiredMinValue=o,s.currentValue=i,Object.setPrototypeOf(s,t.prototype),s},e)}(eW),function(e){(0,I.C6)(function t(n){var r=n.type,o=n.required,i=n.current,s=e.call(this,{type:r})||this;return s.requiredMaxValue=o,s.currentValue=i,Object.setPrototypeOf(s,t.prototype),s},e)}(eW);var eV=/^([a-z0-9+_.\-\x60]*[a-z0-9+_\-\x60]+)@((?:(?:[a-z0-9]+[a-z0-9_.-]*[a-z0-9]+)|[a-z0-9])\.[a-z]{2,})$/i,ez=/^\s*\+?\s*([0-9][\s\-()]*){1,}$/,eX=/^\s*\+?\s*([0-9][\s\-()]*){9,}$/,eq=function(e){if(null==e||"string"==typeof e&&!e.trim())return new eW({type:l.REQUIRED})},e$=function(e){return eq(e)instanceof eW||"boolean"!=typeof e?new eW({type:l.NOT_TRUE_VALUE}):!0===e?void 0:new eW({type:l.NOT_TRUE_VALUE})},eQ=function(e){return function(t){var n=(""+t).trim().length;if(n!==e)return new eY({type:l.LENGTH,required:e,current:n})}},eJ=function(e){if(!/^([0-9]+)$/i.test((""+e).split(" ").join("")))return new eW({type:l.ONLY_NUMBERS})},eZ=function(e){if(!eV.test(""+e))return new eW({type:l.EMAIL})},e0=function(e){if(!"".concat(e).match(eX))return new eW({type:l.PHONE_NUMBER})},e2=function(e){return function(t){var n={};return e?(Object.keys(e).forEach(function(r){var o,i,s=(o=e[r],function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o.reduce(function(n,r){return n||r.apply(void 0,(0,I.fX)([e],(0,I.zs)(t),!1))},void 0)})(t[r]);s&&(n=(0,I.Cl)((0,I.Cl)({},n),((i={})[r]=s,i)))}),0!==Object.keys(n).length)?n:void 0:{}}},e1=function(e){return ez.test(e)},e4=function(e){function t(t){var n=e.call(this)||this,r=t.store,o=t.flowControllers,i=t.historyController;return n._store=r,n._storeActions=r.getState().actions,n._historyController=i,n._flowControllers=o,n}return(0,I.C6)(t,e),t.prototype._getState=function(){return this._store.getState()},t.prototype._syncEmailBetweenControllers=function(e){Object.values(this._flowControllers).forEach(function(t){"setEmail"in t&&t.setEmail(e)})},t.prototype._syncSessionIdBetweenControllers=function(e){Object.values(this._flowControllers).forEach(function(t){"setSessionId"in t&&t.setSessionId(e)})},t.prototype._syncContactBetweenControllers=function(e){Object.values(this._flowControllers).forEach(function(t){"setContact"in t&&t.setContact(e)})},t.prototype._syncInfoBetweenControllers=function(){var e=this._flowControllers[this.currentFlow],t=e.getState(),n=t.email,r=t.contact,o=e.contactForSyncInfo,i=e.sessionIdForSyncInfo;if(i){this._syncSessionIdBetweenControllers(i),"string"==typeof o&&o.length>0&&this._syncContactBetweenControllers(o);return}if("string"==typeof r&&r.length>0){eV.test(r)?this._syncEmailBetweenControllers(r):eX.test(r)&&this._syncContactBetweenControllers(r);return}"string"==typeof n&&n.length>0&&eV.test(n)&&this._syncEmailBetweenControllers(n)},Object.defineProperty(t.prototype,"currentFlow",{get:function(){return this._getState().currentFlow},enumerable:!1,configurable:!0}),t.prototype.changeFlow=function(e,t){var n=t||{},r=n.withHistory,i=n.clearHistoryAfter,s=this.currentFlow,c=this._flowControllers[s];s!==e&&((void 0===r||r)&&(i?this._historyController.clearAfter({flow:e},{include:!0}):this._historyController.add({flow:s})),this._syncInfoBetweenControllers(),c.reset(),this._storeActions.changeFlow(e),this.emit(o.CHANGE_FLOW,{from:s,to:e}))},t.prototype.historyGoBack=function(){this._flowControllers[this.currentFlow].trackHistoryGoBackClick();var e=this._historyController.getUndoCommand(),t=e.flow,n=e.screen,r=this._flowControllers[t];this.changeFlow(t,{withHistory:!1}),"string"==typeof n&&r.changeScreen(n,{withHistory:!1}),this._historyController.undo({flow:t,screen:n})},t.prototype.reset=function(){this._storeActions.resetState(),Object.values(this._flowControllers).forEach(function(e){return e.reset()}),this._historyController.clear()},t}(eB),e3=((u={})[p.cd.EMAIL]=O.Pw.RUS_EMAIL,u[p.cd.FOREIGN_PHONE]=O.Pw.FOREIGN_PHONE,u[p.cd.RUSSIAN_PHONE]=O.Pw.RUS_PHONE,u),e5=function(e){return e.filter(function(e){return e!==p.N2.TUTU&&Object.values(p.N2).includes(e)})},e6=function(e){var t,n=e.property,r=e.constraints;if("string"!=typeof n||Object.keys(r).length<=0)return{};var o=Object.keys(r)[0]===a.IS_STRING?l.ONLY_STRING:l.UNKNOWN;return(t={})[n]=new eW({type:o}),t},e8=function(e){switch(e){case s.IDENTITY_NOT_FOUND:return l.IDENTITY_NOT_FOUND;case s.ACCOUNT_EXISTS:return l.ACCOUNT_EXISTS;case s.LOGIN_PASSWORD_INCORRECT:return l.LOGIN_PASSWORD_INCORRECT;case s.MAX_ATTEMPTS_REACHED:return l.MAX_ATTEMPTS_REACHED;case s.VALIDATION_ERROR:return l.UNKNOWN;case s.FOREIGN_CONTACT:return l.FOREIGN_CONTACT;case s.SESSION_EXPIRED:case s.SESSION_NOT_FOUND:case s.SESSION_NOT_VALID:return l.SESSION;case s.CODE_EXISTS:return l.UNKNOWN;case s.SAME_PASSWORD:return l.SAME_PASSWORD;case s.CODE_INCORRECT:return l.CODE_INCORRECT;case s.CODE_NOT_FOUND:return l.CODE_NOT_FOUND;case s.ALREADY_AUTHENTICATED:return l.ALREADY_AUTHENTICATED;default:return l.UNKNOWN}},e9=function(e){var t,n,r=e.property,o=e.code;if("string"!=typeof r||"string"!=typeof o)return{};var i=null===(n=null==e?void 0:e.extraProperties)||void 0===n?void 0:n.retryInSeconds,s=new eW({type:e8(o),retryInSeconds:null!=i&&"number"==typeof i?i:void 0});return(t={})[e.property]=s,t},e7=function(e){if(void 0!==e&&void 0!==e.name&&"Error"!==e.name)switch(e.name){case ej.UI:return{global:new eW({type:l.UNKNOWN})};case ej.WIDGET_API:if(e.code===i.EBADREQUEST){var t,n=!Array.isArray(t=JSON.parse(e.message))||t.length<=0?{}:t.reduce(function(e,t){return(0,I.Cl)((0,I.Cl)({},e),e6(t))},{});return Object.keys(n).length>0?n:void 0}return{global:new eW({type:l.UNKNOWN})};case p.zy.errorName:if(e.code===l.POPUP_WAS_BLOCKED)return{widgetSdk:new eW({type:(0,v.isSafari)()&&(0,v.isIOS)()?l.POPUP_WAS_BLOCKED_IOS_SAFARI:l.POPUP_WAS_BLOCKED})};return{global:new eW({type:l.UNKNOWN})};case ej.AUTH_API:var r,n=!Array.isArray(r=[{property:"authApi",code:e.code,extraProperties:e.extraProps}])||r.length<=0?{}:r.reduce(function(e,t){return(0,I.Cl)((0,I.Cl)({},e),e9(t))},{});return Object.keys(n).length>0?n:void 0;default:return{global:new eW({type:l.UNKNOWN})}}},te=function(e){var t=e.extraProps;return{sessionId:t.emailPhoneAdd.sessionId,phone:t.emailPhoneAdd.phone||null}},tt=function(e){return e.name===ej.AUTH_API&&451===e.status},tn=function(e){return e===p.cd.EMAIL?"email":"phone"},tr=function(e){return e3[e]},to={phone:[eq,e0]},ti={email:[eq,eZ]},ts={code:[eq,eJ,eQ(4)]},tc=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._contactType=null,this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._validateCheckContactScreenForm=e2(ts)}return e.prototype._validateLoginScreenForm=function(e){var t=e.contact;return e1(t)?e2(to)({phone:t}):e2(ti)({email:t})},e.prototype._validateFieldChangeLoginScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({contact:e.contact});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckContactScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,l,u,d,h=this;return(0,I.YH)(this,function(_){switch(_.label){case 0:if("string"!=typeof(n=null===(e=(t=this.getState()).contact)||void 0===e?void 0:e.trim()))throw Error("contact is required");if(this._timers.has(n))return r=this._timers.get(n),this._activeTimerEmail=n,this._storeActions.setTimer(r.time),[2];return[4,this._authSdk.addEmailOrPhoneSendCode({contact:n,sessionId:t.sessionId})];case 1:return i=(o=_.sent()).lockIn,s=o.contactType,this._contactType=s,c=tn(this._contactType),this.changeContactType(c),a=new y.A,l=function(){return n===h._activeTimerEmail},u=function(e){l()&&h._storeActions.setTimer(e)},d=function(){l()&&(h._storeActions.stopTimer(),h._activeTimerEmail=null),a.off("tick",u),a.off("done",d),h._timers.delete(n)},a.start(i),a.on("tick",u),a.on("done",d),this._storeActions.setTimer(i),this._activeTimerEmail=n,this._timers.set(n,a),[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:ed,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;["contact"].includes(t)&&this._validateFieldChangeLoginScreenForm(),["code"].includes(t)&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.changeContactType=function(e){this.setField({name:"contactType",value:e})},e.prototype.setContact=function(e){this.setField({name:"contact",value:e})},e.prototype.setSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r;return(0,I.YH)(this,function(o){switch(o.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),o.label=1;case 1:return o.trys.push([1,4,,5]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return o.sent(),[4,this._sendCode()];case 3:return o.sent(),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL}))),[3,5];case 4:if(n=o.sent(),this._storeActions.setTimer(void 0),void 0===(r=e7(n)))throw this._authSdk.captureException(n,eF),n;if(Object.keys(r).includes("authApi")&&Object.values(r.authApi).includes(l.SESSION))return this.changeScreen(eh.SECURITY_ERROR),[2];return this._storeActions.setErrors(r),[3,5];case 5:return[2]}})})},e.prototype.submitLoginScreenForm=function(){var e,t,n,r;return(0,I.sH)(this,void 0,void 0,function(){var o,i,s,c,a;return(0,I.YH)(this,function(u){switch(u.label){case 0:if(o=this.getState(),this._storeActions.increaseSubmitCount(),i={contact:o.contact.trim()},null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),s=this._validateLoginScreenForm(i))return this._storeActions.setErrors(s),[2];this._storeActions.setErrors(void 0),u.label=1;case 1:return u.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return u.sent(),[4,this._sendCode()];case 3:return u.sent(),this._contactType&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CODE_SENT),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL,login_type:tr(this._contactType)}))),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL}))),this.changeScreen(eh.CHECK_CODE),this._storeActions.setLoading(void 0),[3,5];case 4:if(c=u.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL_ERROR),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL,error_id:c.code})),void 0===(a=e7(c)))throw this._authSdk.captureException(c,eF),c;if(Object.keys(a).includes("authApi")&&Object.values(a.authApi).includes(l.SESSION))return this.changeScreen(eh.SECURITY_ERROR),[2];return this._storeActions.setErrors(a),[3,5];case 5:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o,i,s,c;return(0,I.YH)(this,function(a){switch(a.label){case 0:if(r=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),o={contact:r.contact.trim(),code:r.code.trim()},i=this._validateCheckContactScreenForm(o))return this._storeActions.setErrors(i),[2];this._storeActions.setErrors(void 0),a.label=1;case 1:return a.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return a.sent(),[4,this._authSdk.addEmailOrPhoneConfirm({contact:o.contact,code:o.code,sessionId:r.sessionId})];case 3:return a.sent(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL,login_type:p.Pw.ADD_EMAIL_OR_PHONE})),this._storeActions.setLoading(void 0),this._historyController.clear(),[3,5];case 4:if(s=a.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL_ERROR),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL,error_id:s.code})),void 0===(c=e7(s)))throw this._authSdk.captureException(s,eF),s;if(Object.keys(c).includes("authApi")&&Object.values(c.authApi).includes(l.SESSION))return this.changeScreen(eh.SECURITY_ERROR),[2];return this._storeActions.setErrors(c),[3,5];case 5:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return this._historyController.clear(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),[2]})})},e.prototype.trackRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),[2]})})},e.prototype.trackErrorRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.AUTHENTICATION_FOREIGN_EMAIL})),[2]})})},e}(),ta=function(){var e=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))});return f.createElement(L.N_,{target:"_blank",href:ew.REGISTRATION_BY_EMAIL_POLITICS,hasExtraPaddingTop:!0,size:"paragraph-medium",className:(0,N.A)((0,R.V)("block"),b.A.center,(0,k.S3)(300))},e("personalDataPolitics"))},tl={UI:"authentication-ui",ERROR:"error",ERRORS:"errors",OAUTH_ITEMS:"oauth-items",OAUTH_ITEM:"oauth-item",OAUTH_TYPE:"oauth-type",SCREEN:"screen",AGREEMENT_LINK:"agreement-link",CHECKBOX_AGREEMENT_LINK:"checkbox-agreement-link",REGISTRATION_LINK:"registration-link",CODE_FIELD:"code-field",EMAIL_OR_PHONE_FIELD:"email-or-phone-field",EMAIL_FIELD:"email-field",PHONE_FIELD:"phone-field",PASSWORD_FIELD:"password-field",REMIND_PASSWORD_LINK:"remind-password-link",AGREEMENT_CHECKBOX:"agreement-checkbox",SEND_CODE_TRIGGER:"send-code-trigger",RESET_PASSWORD_TRIGGER:"reset-password-trigger",SUBMIT_TRIGGER:"submit-trigger",LOGIN_BY_PASSWORD_TRIGGER:"login-by-password-trigger",LOGIN_BY_EMAIL_OR_PHONE_TRIGGER:"login-by-email-or-phone-trigger"},tu=f.memo(function(e){var t=e.errors,n=e.submitCount,r=void 0===n?0:n,o=eU(r),i=Object.keys(t).length,s=(0,I.zs)((0,f.useState)(!0),2),c=s[0],a=s[1];(0,f.useEffect)(function(){o===r||c||a(!0)},[r,o,a,c]);var l=(0,f.useCallback)(function(){a(!1)},[a]);return c?f.createElement(G.Z,(0,I.Cl)({backgroundColor:"warning",className:(0,N.A)(B.A.errors,(0,k.S3)(350),(0,k.cV)(350),(0,k.S$)({xs:350,md:0}),(0,k.hz)({xs:350,md:0})),topLeftRound:400,bottomLeftRound:400,topRightRound:400,bottomRightRound:400},(0,w.th)(tl.ERRORS)),f.createElement(D.fh,{addonSize:"small"},f.createElement(M.PM,{emphasized:!0,label:Object.entries(t).map(function(e){var t,n=(0,I.zs)(e,2),r=n[0],o=n[1];return f.createElement(L.P,(0,I.Cl)({size:"paragraph-small",key:r,className:(0,N.A)(((t={})[B.A.errorDot]=i>1,t))},(0,w.th)(tl.ERROR,r)),o)})}),f.createElement(D.$J,null,f.createElement(D.KX,{icon:"cross_outline",onClick:l,className:B.A.pointer})))):null}),td=f.memo(function(e){var t=e.children;return f.createElement("div",{className:(0,N.A)(W.A.container,(0,k.cV)(450))},t)}),th=f.memo(function(){return f.createElement(td,null,f.createElement(j._,{alt:"avatar icon",src:Y}))}),t_=[p.N2.ODNOKLASSNIKI,p.N2.VK_ID,p.N2.VKONTAKTE,p.N2.APPLE,p.N2.GOOGLE],tE=((d={})[p.N2.GOOGLE]={icon:"logo-google",color:"google"},d[p.N2.VKONTAKTE]={icon:"logo-vk",color:"vk"},d[p.N2.VK_ID]={icon:"logo-vk",color:"vk"},d[p.N2.APPLE]={icon:"logo-apple",color:"apple"},d[p.N2.ODNOKLASSNIKI]={color:"odnoklassniki",icon:"logo-ok"},d),tC=f.memo(function(e){var t=e.items,r=void 0===t?[]:t,o=e.hint,i=e.onItemClick,s=(0,I.Tt)(e,["items","hint","onItemClick"]),c=(0,S.OB)(function(e){return n(30272)("./".concat(e,"/index.json"))}),a=(0,f.useCallback)(function(e){return function(){return i(e)}},[i]);return f.createElement("div",(0,I.Cl)({},(0,w.th)(tl.OAUTH_ITEMS),s),f.createElement(L.P,{color:"secondary",className:(0,N.A)((0,R.V)("block"),K.A.center,(0,k.cV)(300)),size:"paragraph-medium",hasExtraPaddingTop:!0},o||c("hint")),f.createElement("div",{className:(0,N.A)(K.A.items,(0,k.cV)(200))},t_.map(function(e){return!r.includes(e)||r.includes(p.N2.VK_ID)&&e===p.N2.VKONTAKTE?null:f.createElement("div",(0,I.Cl)({key:e,onClick:a(e)},(0,w.th)(tl.OAUTH_ITEM),(0,w.th)(tl.OAUTH_TYPE,e)),f.createElement(H.$n,{color:tE[e].color,leftAddon:f.createElement(x.a,{icon:tE[e].icon})}))})))});!function(e){e.Email="email",e.Phone="phone",e.EmailOrPhone="emailOrPhone"}(_||(_={}));var tg=((h={})[_.EmailOrPhone]=tl.EMAIL_OR_PHONE_FIELD,h[_.Phone]=tl.PHONE_FIELD,h[_.Email]=tl.EMAIL_FIELD,h),tA=f.memo(function(e){var t=(0,S.OB)(function(e){return n(66843)("./".concat(e,"/index.json"))}),r=e.submitCount,o=e.contact,i=e.errors,s=e.loading,c=e.oauthItems,a=e.onOauthItemLoginClick,l=e.onRegistrationLinkClick,u=e.onSubmit,d=e.onContactChange,h=e.screenType,E=void 0===h?_.Email:h,C=e.description,g=e.onLoginByPasswordClick,A=(0,I.Tt)(e,["submitCount","contact","errors","loading","oauthItems","onOauthItemLoginClick","onRegistrationLinkClick","onSubmit","onContactChange","screenType","description","onLoginByPasswordClick"]),m=void 0!==(null==i?void 0:i.email)||void 0!==(null==i?void 0:i.phone),T=(0,f.useCallback)(function(e){d(e.target.value)},[d]),O=(0,f.useCallback)(function(e){!0!==s&&"function"==typeof l&&l(e)},[l,s]),p=(0,f.useCallback)(function(e){e.preventDefault(),!0!==s&&u()},[u,s]),v=(0,f.useCallback)(function(){null==g||g()},[g]);return f.createElement("div",(0,I.Cl)({},A),f.createElement(th,null),f.createElement(L.P,{className:(0,N.A)(b.A.center,(0,k.cV)(450)),size:"paragraph-medium"},f.createElement(U.A,{label:null!=C?C:t("description.".concat(E)),tags:{}})),f.createElement("form",{onSubmit:p,noValidate:!0,className:(0,k.cV)(450)},f.createElement(P.gE,{size:500,layout:"vertical"},f.createElement(F.A,(0,I.Cl)({wrapperClassName:(0,P.tG)({xs:["bottom"]}),placeholder:t("fields.placeholder.".concat(E)),onChange:T,value:o,name:E,type:E===_.Email?"email":"text",autoComplete:E===_.Email?"email":"tel",hasError:m,size:500},(0,w.th)(tg[E]),{autoFocus:!0})),void 0!==i&&Object.keys(i).length>0?f.createElement(tu,{submitCount:r,errors:i}):null,f.createElement(H.$n,(0,I.Cl)({className:(0,P.tG)({xs:["bottom"]}),color:"primary",fullWidth:!0,type:"submit",isLoading:s},(0,w.th)(tl.SUBMIT_TRIGGER)),t("fields.submit.text")),"function"==typeof g?f.createElement(H.$n,(0,I.Cl)({color:"secondary",fullWidth:!0,onClick:v},(0,w.th)(tl.LOGIN_BY_PASSWORD_TRIGGER)),t("changeFlowToPasswordLogin.text")):null)),!!l&&f.createElement(L.P,{size:"paragraph-medium",color:"secondary",className:(0,N.A)(b.A.center,(0,k.cV)(450)),hasExtraPaddingTop:!0},f.createElement(U.A,{label:t("changeFlow.text"),tags:{link:f.createElement(H.n6,(0,I.Cl)({onClick:O,key:"registrationLink"},(0,w.th)(tl.REGISTRATION_LINK)))}})),!!(null==c?void 0:c.length)&&a&&f.createElement(tC,{items:c,onItemClick:a}),f.createElement(ta,null))}),tm=f.memo(function(){return f.createElement(td,null,f.createElement(j._,{alt:"email icon",src:V}))}),tT=f.memo(function(){return f.createElement(td,null,f.createElement(j._,{alt:"sms icon",src:z}))}),tf=((E={}).email=function(e,t){return e("checkEmail",{email:t})},E.phone=function(e,t){return e("checkPhone",{phone:t})},E),tS=f.memo(function(e){var t,r=(0,S.OB)(function(e){return n(5748)("./".concat(e,"/index.json"))}),o=e.className,i=e.submitCount,s=e.contact,c=e.code,a=e.description,l=e.timer,u=e.errors,d=e.loading,h=e.submitText,_=e.onSubmit,E=e.onSendCodeClick,C=e.onCodeChange,g=e.slotBottom,A=e.contactType,m=void 0===A?"email":A,T=e.autoSubmit,O=void 0===T||T,p=(0,I.Tt)(e,["className","submitCount","contact","code","description","timer","errors","loading","submitText","onSubmit","onSendCodeClick","onCodeChange","slotBottom","contactType","autoSubmit"]),v=(0,f.useCallback)(function(e){e.preventDefault(),!0!==d&&_()},[_,d]),y=(0,f.useCallback)(function(e){!0!==d&&E(e)},[E,d]),R=(0,f.useCallback)(function(e){var t=e.target.value;C(t),O&&!d&&4===t.length&&_()},[C,_,d]),b=void 0!==(null==u?void 0:u.code),D=(0,f.useMemo)(function(){return void 0===l?f.createElement(L.P,{className:(0,N.A)((0,k.S3)(350),(0,k.cV)(350)),hasExtraPaddingTop:!0,size:"paragraph-medium"},f.createElement(H.n6,(0,I.Cl)({onClick:y},(0,w.th)(tl.SEND_CODE_TRIGGER)),f.createElement(x.a,{icon:"arrow-2-counterclockwise",iconStyle:"brand",size:150}),f.createElement(L.L9,{size:"paragraph-medium"},r("verifyCode.default")))):f.createElement(L.P,{color:"secondary",size:"paragraph-medium",hasExtraPaddingTop:!0,className:(0,N.A)((0,k.S3)(350),(0,k.cV)(350))},0===l?r("verifyCode.wait"):r("verifyCode.waitForTime",{value:Math.round(l/1e3)}))},[l,r,y]);return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},p),"email"===m?f.createElement(tm,null):f.createElement(tT,null),f.createElement(L.P,{size:"paragraph-medium",className:(0,N.A)(X.A.description,"phone"===m&&X.A.descriptionReverseOrder,(0,k.cV)(450))},f.createElement(L.L9,null,f.createElement(U.A,{label:tf[m](r,s),tags:((t={})[m]=f.createElement("strong",{key:"strong",className:X.A.contact}),t)})),"string"==typeof a?a.split(/\r?\n/g).map(function(e,t){return f.createElement(L.L9,{key:t,dangerouslySetInnerHTML:{__html:e}})}):null),f.createElement("form",{className:(0,k.cV)(450),onSubmit:v},f.createElement(P.gE,{size:500,layout:"vertical"},f.createElement(F.A,(0,I.Cl)({placeholder:r("fields.input.placeholder"),onChange:R,value:c,name:"inputCode",autoComplete:"off",type:"text",hasError:b,minLength:4,maxLength:4,size:500,hint:{label:D}},(0,w.th)(tl.CODE_FIELD),{autoFocus:!0})),void 0!==u&&Object.keys(u).length>0?f.createElement(tu,{submitCount:i,errors:u}):null,f.createElement(H.$n,(0,I.Cl)({color:"primary",fullWidth:!0,type:"submit",isLoading:d},(0,w.th)(tl.SUBMIT_TRIGGER)),null!=h?h:r("fields.submit.text")),g)),f.createElement(ta,null))}),tI=f.memo(function(){return f.createElement(td,null,f.createElement(j._,{alt:"lock icon",src:q}))}),tO=f.memo(function(e){var t=(0,S.OB)(function(e){return n(2206)("./".concat(e,"/index.json"))}),r=e.className,o=e.onButtonClick,i=(0,I.Tt)(e,["className","onButtonClick"]);return f.createElement("div",(0,I.Cl)({className:void 0===r?"":r},i),f.createElement(tI,null),f.createElement(L.P,{className:(0,N.A)(b.A.center,(0,k.cV)(450)),size:"paragraph-medium"},t("text")),f.createElement(H.$n,{color:"primary",onClick:o,size:500,fullWidth:!0},t("button")))});function tp(e,t){return null!=t&&t?e("retryInXMinutes",{minutes:Math.ceil(t/60)}):e("retryInAFewMinutes")}var tv=f.memo(function(e){var t=(0,S.OB)(function(e){return n(61121)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.loginScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=(0,I.Tt)(l,["errors"]),h=e.securityErrorScreen,_=e.onErrorRegistrationLinkClick,E=(0,I.Tt)(e,["className","currentScreen","loginScreen","checkCodeScreen","securityErrorScreen","onErrorRegistrationLinkClick"]),C=function(e){return Object.entries(e).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{registrationLink:f.createElement(L.N_,{onClick:_})}}),o))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},E),i===eh.LOGIN?f.createElement(tA,(0,I.Cl)({},a,{errors:c?C(c):void 0},(0,w.th)(tl.SCREEN,"login-email-code"))):null,i===eh.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},d,{description:t("checkCode.".concat(d.contactType,".description")),submitText:t("checkCode.fields.submitText"),errors:u?C(u):void 0},(0,w.th)(tl.SCREEN,"login-email-code-code"))):null,i===eh.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},h)):null)}),ty={submitCount:0,errors:void 0,timer:void 0},tN=function(e){return(0,I.Cl)((0,I.Cl)({},ty),{actions:{increaseSubmitCount:function(){return e(function(e){return{submitCount:e.submitCount+1}})},clearSubmitCount:function(){return e(function(){return{submitCount:0}})},setErrors:function(t){return e(function(){return{errors:t}})},setTimer:function(t){return e(function(){return{timer:t}})},stopTimer:function(){return e(function(){return{timer:void 0}})},setField:function(t){return e(function(){var e;return(e={})[t.name]=t.value,e})}}})},tL=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:eh.LOGIN,submitCount:0,contactType:"email",contact:"",code:"",sessionId:void 0}),tR=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},tL),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return tL})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),tk=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode,n=e.changeFlowToLoginByEmailAndPass,r=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToLoginByEmailAndPass"]),o=eD()[eH].addEmailOrPhone,i=(0,Q.Pj)(tR),s=i.currentScreen,c=i.contact,a=i.errors,l=i.loading,u=i.timer,d=i.submitCount,h=i.code,E=i.contactType,C=(0,f.useCallback)(function(){o.submitLoginScreenForm()},[o]),g=(0,f.useCallback)(function(){t({withHistory:!1})},[t]),A=(0,f.useCallback)(function(e){o.setContact(e)},[o]),m=(0,f.useCallback)(function(e){e.preventDefault(),o.sendCode()},[o]),T=(0,f.useCallback)(function(e){o.setField({name:"code",value:e})},[o]),S=(0,f.useCallback)(function(){o.submitCheckCodeScreenForm()},[o]),O=(0,f.useCallback)(function(){o.submitSecurityErrorScreenForm(),n({withHistory:!1})},[n,o]),p=(0,f.useMemo)(function(){return{contact:c,errors:a,loading:!!l,submitCount:d,onContactChange:A,onSubmit:C,screenType:_.EmailOrPhone}},[c,a,l,d,A,C]),v=(0,f.useMemo)(function(){return{code:h,contact:c,errors:a,timer:u,loading:!!l,submitCount:d,onSubmit:S,onCodeChange:T,onSendCodeClick:m,contactType:E}},[h,c,a,u,l,d,S,T,m,E]),y=(0,f.useMemo)(function(){return{onButtonClick:O}},[O]);return f.createElement(tv,(0,I.Cl)({},r,{currentScreen:s,onErrorRegistrationLinkClick:g,loginScreen:p,checkCodeScreen:v,securityErrorScreen:y}))}),tb={phone:[eq,e0]},tw={code:[eq,eJ,eQ(4)]},tH=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.historyController,o=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._historyController=r,this._userwayLogger=o,this._validateCheckContactScreenForm=e2(tw),this._contactType=null}return e.prototype._validateLoginScreenForm=function(e){var t=e.contact;return e2(tb)({phone:t})},e.prototype._validateFieldChangeLoginScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({contact:e.contact});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckContactScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,l,u,d=this;return(0,I.YH)(this,function(h){switch(h.label){case 0:if("string"!=typeof(n=null===(e=(t=this.getState()).contact)||void 0===e?void 0:e.trim()))throw Error("contact is required");if(this._timers.has(n))return r=this._timers.get(n),this._activeTimerEmail=n,this._storeActions.setTimer(r.time),[2];return[4,this._authSdk.addEmailOrPhoneSendCode({contact:n,sessionId:t.sessionId})];case 1:return i=(o=h.sent()).lockIn,s=o.contactType,this._contactType=s,c=new y.A,a=function(){return n===d._activeTimerEmail},l=function(e){a()&&d._storeActions.setTimer(e)},u=function(){a()&&(d._storeActions.stopTimer(),d._activeTimerEmail=null),c.off("tick",l),c.off("done",u),d._timers.delete(n)},c.start(i),c.on("tick",l),c.on("done",u),this._storeActions.setTimer(i),this._activeTimerEmail=n,this._timers.set(n,c),[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:e_,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;["contact"].includes(t)&&this._validateFieldChangeLoginScreenForm(),["code"].includes(t)&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.setContact=function(e){this.setField({name:"contact",value:e})},e.prototype.setSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r;return(0,I.YH)(this,function(o){switch(o.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),o.label=1;case 1:return o.trys.push([1,3,,4]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._sendCode()];case 2:return o.sent(),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_ADD_PHONE}))),[3,4];case 3:if(n=o.sent(),this._storeActions.setTimer(void 0),void 0===(r=e7(n)))throw this._authSdk.captureException(n,eF),n;if(Object.keys(r).includes("authApi")&&Object.values(r.authApi).includes(l.SESSION))return this.changeScreen(eE.SECURITY_ERROR),[2];return this._storeActions.setErrors(r),[3,4];case 4:return[2]}})})},e.prototype.submitLoginScreenForm=function(){var e,t,n,r;return(0,I.sH)(this,void 0,void 0,function(){var o,i,s,c,a;return(0,I.YH)(this,function(u){switch(u.label){case 0:if(o=this.getState(),this._storeActions.increaseSubmitCount(),i={contact:o.contact.trim()},null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),s=this._validateLoginScreenForm(i))return this._storeActions.setErrors(s),[2];this._storeActions.setErrors(void 0),u.label=1;case 1:return u.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._authSdk.addEmailOrPhoneStart({contact:i.contact})];case 2:return u.sent(),[4,this._sendCode()];case 3:return u.sent(),this._contactType&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CODE_SENT),{block:O.gf.TUTU_WALLET_ADD_PHONE,login_type:tr(this._contactType)}))),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_ADD_PHONE}))),this.changeScreen(eE.CHECK_CODE,{withHistory:!1}),this._storeActions.setLoading(void 0),[3,5];case 4:if(c=u.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_ADD_PHONE,error_id:c.code})),void 0===(a=e7(c)))throw this._authSdk.captureException(c,eF),c;if(Object.keys(a).includes("authApi")&&Object.values(a.authApi).includes(l.SESSION))return this.changeScreen(eE.SECURITY_ERROR),[2];return this._storeActions.setErrors(a),[3,5];case 5:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o,i,s,c;return(0,I.YH)(this,function(a){switch(a.label){case 0:if(r=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),o={contact:r.contact.trim(),code:r.code.trim()},i=this._validateCheckContactScreenForm(o))return this._storeActions.setErrors(i),[2];this._storeActions.setErrors(void 0),a.label=1;case 1:return a.trys.push([1,3,,4]),this._storeActions.setLoading("default"),[4,this._authSdk.addEmailOrPhoneConfirm({contact:o.contact,code:o.code,sessionId:r.sessionId})];case 2:return a.sent(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_SUCCESS),{block:O.gf.TUTU_WALLET_ADD_PHONE})),this._storeActions.setLoading(void 0),this._historyController.clear(),[3,4];case 3:if(s=a.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_ADD_PHONE,error_id:s.code})),void 0===(c=e7(s)))throw this._authSdk.captureException(s,eF),s;if(Object.keys(c).includes("authApi")&&Object.values(c.authApi).includes(l.SESSION))return this.changeScreen(eE.SECURITY_ERROR),[2];return this._storeActions.setErrors(c),[3,4];case 4:return[2]}})})},e.prototype.trackFlowInitialization=function(){var e;null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_ADD_PHONE),{block:O.gf.TUTU_WALLET_ADD_PHONE}))},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return this._historyController.clear(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),[2]})})},e.prototype.trackRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),[2]})})},e.prototype.trackErrorRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.TUTU_WALLET_ADD_PHONE})),[2]})})},e}(),tF=f.memo(function(e){var t=(0,S.OB)(function(e){return n(38923)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.loginScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=(0,I.Tt)(l,["errors"]),h=e.securityErrorScreen,_=e.onErrorRegistrationLinkClick,E=(0,I.Tt)(e,["className","currentScreen","loginScreen","checkCodeScreen","securityErrorScreen","onErrorRegistrationLinkClick"]),C=function(e){return Object.entries(e).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{registrationLink:f.createElement(L.N_,{onClick:_})}}),o))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},E),i===eE.LOGIN?f.createElement(tA,(0,I.Cl)({},a,{description:t("loginByContact.description"),errors:c?C(c):void 0},(0,w.th)(tl.SCREEN,"login-email-code"))):null,i===eE.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},d,{description:t("checkCode.".concat(d.contactType,".description")),submitText:t("checkCode.fields.submitText"),errors:u?C(u):void 0},(0,w.th)(tl.SCREEN,"login-email-code-code"))):null,i===eE.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},h)):null)}),tU=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:eE.LOGIN,contact:"",code:"",sessionId:void 0}),tP=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},tU),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return tU})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),tD=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode,n=e.changeFlowToLoginByEmailAndPass,r=e.initialContact,o=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToLoginByEmailAndPass","initialContact"]),i=eD()[eH].addPhone,s=(0,Q.Pj)(tP),c=s.currentScreen,a=s.contact,l=s.errors,u=s.loading,d=s.timer,h=s.submitCount,E=s.code;(0,f.useEffect)(function(){i.trackFlowInitialization()},[i]),(0,f.useEffect)(function(){r&&i.setContact(r)},[i,r]);var C=(0,f.useCallback)(function(){i.submitLoginScreenForm()},[i]),g=(0,f.useCallback)(function(){t({withHistory:!1})},[t]),A=(0,f.useCallback)(function(e){i.setContact(e)},[i]),m=(0,f.useCallback)(function(e){e.preventDefault(),i.sendCode()},[i]),T=(0,f.useCallback)(function(e){i.setField({name:"code",value:e})},[i]),S=(0,f.useCallback)(function(){i.submitCheckCodeScreenForm()},[i]),O=(0,f.useCallback)(function(){i.submitSecurityErrorScreenForm(),n({withHistory:!1})},[n,i]),p=(0,f.useMemo)(function(){return{contact:a,errors:l,loading:!!u,submitCount:h,onContactChange:A,onSubmit:C,screenType:_.Phone}},[a,l,u,h,A,C]),v=(0,f.useMemo)(function(){return{code:E,contact:a,errors:l,timer:d,loading:!!u,submitCount:h,onSubmit:S,onCodeChange:T,onSendCodeClick:m,contactType:"phone"}},[E,a,l,d,u,h,S,T,m]),y=(0,f.useMemo)(function(){return{onButtonClick:O}},[O]);return f.createElement(tF,(0,I.Cl)({},o,{currentScreen:c,onErrorRegistrationLinkClick:g,loginScreen:p,checkCodeScreen:v,securityErrorScreen:y}))}),tM={code:[eq,eJ,eQ(4)]},tG=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._validateCheckContactScreenForm=e2(tM)}return e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckContactScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,l,u=this;return(0,I.YH)(this,function(d){switch(d.label){case 0:if(t=null===(e=this.getState().contact)||void 0===e?void 0:e.trim(),this._timers.has(t))return n=this._timers.get(t),this._activeTimerEmail=t,this._storeActions.setTimer(n.time),[2];return[4,this._authSdk.identitiesPhoneCheckSendCode()];case 1:return o=(r=d.sent()).lockIn,i=r.contact,this._storeActions.setField({name:"contact",value:i}),s=new y.A,c=function(){return t===u._activeTimerEmail},a=function(e){c()&&u._storeActions.setTimer(e)},l=function(){c()&&(u._storeActions.stopTimer(),u._activeTimerEmail=null),s.off("tick",a),s.off("done",l),u._timers.delete(t)},s.start(o),s.on("tick",a),s.on("done",l),this._storeActions.setTimer(o),this._activeTimerEmail=t,this._timers.set(t,s),[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:eC,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e),"code"===e.name&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.setContact=function(e){this.setField({name:"contact",value:e})},e.prototype.setEmail=function(e){this.setField({name:"contact",value:e})},e.prototype.setSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o;return(0,I.YH)(this,function(i){switch(i.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.TUTU_WALLET_CONFIRMATION})),i.label=1;case 1:return i.trys.push([1,3,,4]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._sendCode()];case 2:return i.sent(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[3,4];case 3:if(r=i.sent(),this._storeActions.setTimer(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_CONFIRMATION,error_id:r.code})),void 0===(o=e7(r)))throw this._authSdk.captureException(r,eF),r;if(Object.keys(o).includes("authApi")&&Object.values(o.authApi).includes(l.SESSION))return this.changeScreen(eg.SECURITY_ERROR),[2];return this._storeActions.setErrors(o),[3,4];case 4:return[2]}})})},e.prototype.startAndSendCode=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o;return(0,I.YH)(this,function(i){switch(i.label){case 0:this._storeActions.setErrors(void 0),i.label=1;case 1:return i.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._authSdk.identitiesPhoneCheckStart()];case 2:return i.sent(),[4,this._sendCode()];case 3:return i.sent(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_CONFIRMATION})),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_CONFIRMATION)),this.changeScreen(eg.CHECK_CODE,{withHistory:!1}),this._storeActions.setLoading(void 0),[3,5];case 4:if(r=i.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_CONFIRMATION,error_id:r.code})),void 0===(o=e7(r)))return this._authSdk.captureException(r,eF),this.changeScreen(eg.SECURITY_ERROR),[2];if(Object.keys(o).includes("authApi")&&o.authApi)return this.changeScreen(eg.SECURITY_ERROR),[2];return this._storeActions.setErrors(o),[3,5];case 5:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o,i,s,c;return(0,I.YH)(this,function(a){switch(a.label){case 0:if(r=this.getState(),this._storeActions.increaseSubmitCount(),o={code:r.code.trim()},i=this._validateCheckContactScreenForm(o))return this._storeActions.setErrors(i),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[2];this._storeActions.setErrors(void 0),a.label=1;case 1:return a.trys.push([1,3,,4]),this._storeActions.setLoading("default"),[4,this._authSdk.identitiesPhoneCheckConfirm({code:o.code})];case 2:return a.sent(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_SUCCESS),{block:O.gf.TUTU_WALLET_CONFIRMATION})),this._storeActions.setLoading(void 0),this._historyController.clear(),[3,4];case 3:if(s=a.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_CONFIRMATION,error_id:s.code})),void 0===(c=e7(s)))throw this._authSdk.captureException(s,eF),s;if(Object.keys(c).includes("authApi")&&Object.values(c.authApi).includes(l.SESSION))return this.changeScreen(eg.SECURITY_ERROR),[2];return this._storeActions.setErrors(c),[3,4];case 4:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return this._historyController.clear(),this.changeScreen(eg.SPINNER),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[2]})})},e.prototype.trackRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[2]})})},e.prototype.trackErrorRegistrationLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.TUTU_WALLET_CONFIRMATION})),[2]})})},e}(),tB=f.memo(function(e){var t=e.className,n=(0,I.Tt)(e,["className"]);return f.createElement("div",(0,I.Cl)({className:(0,N.A)(void 0===t?"":t,Z.A.loader)},n),f.createElement(J.a,{dimension:"80px",color:"brand"}))}),tj=f.memo(function(e){var t=e.callback;return(0,f.useEffect)(function(){return null==t?void 0:t()},[t]),f.createElement(tB,null)}),tW=f.memo(function(e){var t=(0,S.OB)(function(e){return n(43210)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.spinnerScreen,c=e.checkCodeScreen,a=c.errors,l=(0,I.Tt)(c,["errors"]),u=e.securityErrorScreen,d=e.onErrorRegistrationLinkClick;e.loading;var h=(0,I.Tt)(e,["className","currentScreen","spinnerScreen","checkCodeScreen","securityErrorScreen","onErrorRegistrationLinkClick","loading"]);return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},h),i===eg.SPINNER?f.createElement(tj,(0,I.Cl)({},s)):null,i===eg.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},l,{description:t("checkCode.phone.description"),submitText:t("checkCode.fields.submitText"),errors:a?Object.entries(a).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{registrationLink:f.createElement(L.N_,{onClick:d})}}),o))},{}):void 0,contactType:"phone"},(0,w.th)(tl.SCREEN,"login-email-code-code"))):null,i===eg.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},u)):null)}),tY=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:eg.SPINNER,submitCount:0,contact:"",code:""}),tx=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},tY),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return tY})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),tK=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode;e.changeFlowToAddEmailOrPhone;var n=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToAddEmailOrPhone"]),r=eD()[eH].increaseSecurityLevel,o=(0,Q.Pj)(tx),i=o.currentScreen,s=o.contact,c=o.errors,a=o.loading,l=o.timer,u=o.submitCount,d=o.code,h=(0,f.useCallback)(function(){t()},[t]),_=(0,f.useCallback)(function(e){e.preventDefault(),r.sendCode()},[r]),E=(0,f.useCallback)(function(e){r.setField({name:"code",value:e})},[r]),C=(0,f.useCallback)(function(){r.submitCheckCodeScreenForm()},[r]),g=(0,f.useCallback)(function(){r.submitSecurityErrorScreenForm()},[r]),A=(0,f.useCallback)(function(){r.startAndSendCode()},[r]),m=(0,f.useMemo)(function(){return{code:d,contact:s,errors:c,timer:l,loading:!!a,submitCount:u,onSubmit:C,onCodeChange:E,onSendCodeClick:_}},[d,s,c,l,a,u,C,E,_]),T=(0,f.useMemo)(function(){return{callback:A}},[A]),S=(0,f.useMemo)(function(){return{onButtonClick:g}},[g]),O="default"===a;return f.createElement(tW,(0,I.Cl)({},n,{currentScreen:i,onErrorRegistrationLinkClick:h,checkCodeScreen:m,spinnerScreen:T,securityErrorScreen:S,loading:O}))}),tV=[s.LOGIN_PASSWORD_INCORRECT,s.AUTH_OLD_INTERNAL_ERROR,s.INTERNAL,s.UNAUTHENTICATED,s.CODE_INCORRECT,s.ALREADY_AUTHENTICATED,s.IDENTITY_NOT_FOUND,s.VALIDATION_ERROR,s.FOREIGN_CONTACT,s.ACCOUNT_EXISTS,i.EBADCSRFTOKEN,i.EBADREQUEST,i.EOAUTH,c.UI_VALIDATION_ERROR],tz=function(e){var t=e.block,n=e.error_id,r=e.login_type,o=tV.includes(n);return(0,I.Cl)((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_FAILURE),r?{login_type:r}:{}),{block:t,error_id:o?n:""})},tX={email:[eq,eZ],password:[eq]},tq=function(){function e(e){var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._validateLoginScreenForm=e2(tX),this.contactForSyncInfo=null}return Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype._validateFieldChangeLoginScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({email:e.email.trim(),password:e.password});this._storeActions.setErrors(t)}},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:eA,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e),["email","password"].includes(e.name)&&this._validateFieldChangeLoginScreenForm()},e.prototype.setEmail=function(e){this.setField({name:"email",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.submitLoginScreenForm=function(e){var t,n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,a,l,u,d,h,_,E;return(0,I.YH)(this,function(C){switch(C.label){case 0:if(s=this.getState(),this._storeActions.increaseSubmitCount(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),a={email:s.email.trim(),password:s.password},l=this._validateLoginScreenForm(a))return this._storeActions.setErrors(l),null===(n=this._userwayLogger)||void 0===n||n.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,login_type:p.Pw.EMAIL_PASSWORD,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),C.label=1;case 1:return C.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return C.sent(),[4,this._authSdk.loginByEmailAndPassword({email:a.email,password:a.password})];case 3:return C.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,login_type:p.Pw.EMAIL_PASSWORD})),this._historyController.clear(),[3,5];case 4:if(u=C.sent(),this._storeActions.setLoading(void 0),tt(u))return h=(d=te(u)).sessionId,_=d.phone,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),this.contactForSyncInfo=_,this.sessionIdForSyncInfo=h,e(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,login_type:p.Pw.EMAIL_PASSWORD,error_id:u.code})),void 0===(E=e7(u)))throw this._authSdk.captureException(u,eF),u;return this._storeActions.setErrors(E),[3,5];case 5:return[2]}})})},e.prototype.trackForgotLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_FORGOT_PASSWORD_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),[2]})})},e.prototype.trackLoginByEmailOrPhoneClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),[2]})})},e.prototype.trackErrorLoginByEmailCodeLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:"authentication_error"})),[2]})})},e.prototype.trackRegistrationLinkClick=function(e){var t;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(n){return null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},e?O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_PHONE_CLICK:O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),[2]})})},e.prototype.loginByOAuthClick=function(e,t){var n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,c,a,l,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OAUTH_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,oauth_provider:e})),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setErrors(void 0),this._storeActions.setLoading("oauth"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.loginByOauth(e)];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,login_type:e})),this._historyController.clear(),[3,5];case 4:if(s=d.sent(),this._storeActions.setLoading(void 0),tt(s))return a=(c=te(s)).sessionId,l=c.phone,this.contactForSyncInfo=l,this.sessionIdForSyncInfo=a,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.AUTHENTICATION_EMAIL_PASSWORD})),t(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PASSWORD,login_type:e,error_id:s.code})),void 0===(u=e7(s)))throw this._authSdk.captureException(s,eF),s;return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},e}(),t$=function(e){var t=(0,S.OB)(function(e){return n(81096)("./".concat(e,"/index.json"))}),r=e.submitCount,o=e.email,i=e.password,s=e.errors,c=e.loading,a=e.oauthItems,l=e.onLoginByEmailOrPhoneClick,u=e.onRegistrationLinkClick,d=e.onForgotLinkClick,h=e.onOauthItemLoginClick,_=e.onEmailChange,E=e.onPasswordChange,C=e.onSubmit,g=void 0!==(null==s?void 0:s.email),A=void 0!==(null==s?void 0:s.password),m=(0,f.useCallback)(function(e){_(e.target.value)},[_]),T=(0,f.useCallback)(function(e){E(e.target.value)},[E]),O=(0,f.useCallback)(function(e){e.preventDefault(),c||C()},[C,c]),p=(0,f.useCallback)(function(e){c||d(e)},[d,c]),v=(0,f.useCallback)(function(e){c||u(e)},[u,c]),y=(0,f.useCallback)(function(e){c||l(e)},[l,c]);return f.createElement(f.Fragment,null,f.createElement(th,null),f.createElement("form",{onSubmit:O,noValidate:!0,className:(0,k.cV)(450)},f.createElement(P.gE,{size:500,layout:"vertical"},f.createElement(F.A,(0,I.Cl)({wrapperClassName:(0,P.tG)({xs:["bottom"]}),placeholder:t("fields.email.placeholder"),onChange:m,value:o,name:"email",type:"email",autoComplete:"email",hasError:g,size:500},(0,w.th)(tl.EMAIL_FIELD),{autoFocus:!0})),f.createElement(ee.s,(0,I.Cl)({wrapperClassName:(0,k.cV)(300),placeholder:t("fields.password.placeholder"),onChange:T,value:i,name:"password",hasError:A,autoComplete:"current-password",size:500,hint:{label:f.createElement(L.N_,(0,I.Cl)({onClick:p},(0,w.th)(tl.REMIND_PASSWORD_LINK),{tabIndex:0}),t("fields.resetPassword"))}},(0,w.th)(tl.PASSWORD_FIELD))),void 0!==s&&Object.keys(s).length>0?f.createElement(tu,{submitCount:r,errors:s}):null,f.createElement(H.$n,(0,I.Cl)({className:(0,P.tG)({xs:["bottom"]}),color:"primary",fullWidth:!0,type:"submit",isLoading:c},(0,w.th)(tl.SUBMIT_TRIGGER)),t("fields.submit.text")),f.createElement(H.$n,(0,I.Cl)({color:"secondary",fullWidth:!0,onClick:y},(0,w.th)(tl.LOGIN_BY_EMAIL_OR_PHONE_TRIGGER)),t("changeFlow.loginByEmailOrPhone")))),f.createElement(L.P,{color:"secondary",size:"paragraph-medium",className:(0,N.A)(b.A.center,(0,k.cV)(450)),hasExtraPaddingTop:!0},f.createElement(U.A,{label:t("changeFlow.registration"),tags:{link:f.createElement(H.n6,(0,I.Cl)({onClick:v,key:"registrationLink"},(0,w.th)(tl.REGISTRATION_LINK),{tabIndex:0}))}})),!!(null==a?void 0:a.length)&&f.createElement(tC,{items:a,onItemClick:h}),f.createElement(ta,null))},tQ=f.memo(function(e){var t=e.className,n=e.loading,r=e.submitCount,o=e.email,i=e.password,s=e.errors,c=e.oauthItems,a=e.onLoginByEmailOrPhoneClick,l=e.onRegistrationLinkClick,u=e.onForgotLinkClick,d=e.onOauthItemLoginClick,h=e.onEmailChange,_=e.onPasswordChange,E=e.onSubmit,C=(0,I.Tt)(e,["className","loading","submitCount","email","password","errors","oauthItems","onLoginByEmailOrPhoneClick","onRegistrationLinkClick","onForgotLinkClick","onOauthItemLoginClick","onEmailChange","onPasswordChange","onSubmit"]);return f.createElement("div",(0,I.Cl)({className:void 0===t?"":t},C),f.createElement(t$,{oauthItems:c,onOauthItemLoginClick:d,loading:"default"===n,submitCount:r,email:o,password:i,errors:s,onLoginByEmailOrPhoneClick:a,onRegistrationLinkClick:l,onForgotLinkClick:u,onEmailChange:h,onPasswordChange:_,onSubmit:E}))}),tJ=f.memo(function(e){var t=(0,S.OB)(function(e){return n(52308)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.loginScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.onErrorLoginByEmailCodeLinkClick,u=e.onErrorRegistrationLinkClick,d=(0,I.Tt)(e,["className","currentScreen","loginScreen","onErrorLoginByEmailCodeLinkClick","onErrorRegistrationLinkClick"]);return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},d),i===em.LOGIN?f.createElement(tQ,(0,I.Cl)({},a,{errors:c?Object.entries(c).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{loginByEmailOrPhoneLink:f.createElement(L.N_,{onClick:l}),registrationLink:f.createElement(L.N_,{onClick:u})}}),o))},{}):void 0},(0,w.th)(tl.SCREEN,"login-email-pass"))):null)}),tZ=(0,f.createContext)(null),t0=function(e){var t=e.children,n=e.store,r=(0,f.useRef)();return r.current||(r.current=n),f.createElement(tZ.Provider,{value:r.current},t)},t2=function(){var e=(0,f.useContext)(tZ);if(!e)throw Error("Missing AppStoreProvider");return(0,Q.Pj)(e)},t1=(0,I.Cl)({loading:void 0,currentScreen:em.LOGIN,email:"",password:""},ty),t4=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},t1),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return t1})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),t3=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode,n=e.changeFlowToResetPassByEmail,r=e.changeFlowToAddEmailOrPhone,o=e.changeFlowToLoginByEmailOrPhone,i=e.changeFlowToRegistrationByPhone,s=e.isTutuWallet,c=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToResetPassByEmail","changeFlowToAddEmailOrPhone","changeFlowToLoginByEmailOrPhone","changeFlowToRegistrationByPhone","isTutuWallet"]),a=t2(),l=eD()[eH].loginByEmailAndPass,u=(0,Q.Pj)(t4),d=a.availableLoginMethods,h=u.currentScreen,_=u.email,E=u.password,C=u.errors,g=u.loading,A=u.submitCount,m=e5(d),T=(0,f.useCallback)(function(){l.trackForgotLinkClick(),n()},[l,n]),S=(0,f.useCallback)(function(){l.trackLoginByEmailOrPhoneClick(),o()},[l,o]),O=(0,f.useCallback)(function(e){l.loginByOAuthClick(e,r)},[l,r]),p=(0,f.useCallback)(function(){l.trackErrorLoginByEmailCodeLinkClick(),o()},[l,o]),v=(0,f.useCallback)(function(){l.trackRegistrationLinkClick(s),s?i():t()},[l,s,i,t]),y=(0,f.useCallback)(function(){l.submitLoginScreenForm(r)},[l,r]),N=(0,f.useCallback)(function(e){l.setField({name:"email",value:e})},[l]),L=(0,f.useCallback)(function(e){l.setField({name:"password",value:e})},[l]);(0,f.useEffect)(function(){var e=new URLSearchParams(window.location.search).get("email");e&&N(e)},[N]);var R=(0,f.useMemo)(function(){return{oauthItems:m,email:_,password:E,errors:C,loading:g,submitCount:A,onOauthItemLoginClick:O,onEmailChange:N,onPasswordChange:L,onSubmit:y,onRegistrationLinkClick:v,onForgotLinkClick:T,onLoginByEmailOrPhoneClick:S}},[m,_,E,C,g,A,O,N,L,y,v,T,S]);return"oauth"===g?f.createElement(tB,null):f.createElement(tJ,(0,I.Cl)({},c,{currentScreen:h,onErrorRegistrationLinkClick:v,onErrorLoginByEmailCodeLinkClick:p,onOauthItemLoginClick:O,loginScreen:R}))}),t5={phone:[eq,e0]},t6={email:[eq,eZ]},t8={code:[eq,eJ,eQ(4)]},t9=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._validateCheckContactScreenForm=e2(t8),this._contactType=null,this.contactForSyncInfo=null}return e.prototype._validateLoginScreenForm=function(e){var t=e.contact;return e1(t)?e2(t5)({phone:t}):e2(t6)({email:t})},e.prototype._validateFieldChangeLoginScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({contact:e.contact});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckContactScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,l,u,d=this;return(0,I.YH)(this,function(h){switch(h.label){case 0:if("string"!=typeof(t=null===(e=this.getState().contact)||void 0===e?void 0:e.trim()))throw Error("contact is required");if(this._timers.has(t))return n=this._timers.get(t),this._activeTimerEmail=t,this._storeActions.setTimer(n.time),[2];return[4,this._authSdk.loginByEmailOrPhoneSendCode({contact:t})];case 1:return o=(r=h.sent()).lockIn,i=r.contactType,this._contactType=i,s=tn(this._contactType),this.changeContactType(s),c=new y.A,a=function(){return t===d._activeTimerEmail},l=function(e){a()&&d._storeActions.setTimer(e)},u=function(){a()&&(d._storeActions.stopTimer(),d._activeTimerEmail=null),c.off("tick",l),c.off("done",u),d._timers.delete(t)},c.start(o),c.on("tick",l),c.on("done",u),this._storeActions.setTimer(o),this._activeTimerEmail=t,this._timers.set(t,c),[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:eT,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;"contact"===t&&this._validateFieldChangeLoginScreenForm(),"code"===t&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.changeContactType=function(e){this.setField({name:"contactType",value:e})},e.prototype.setContact=function(e){this.setField({name:"contact",value:e})},e.prototype.setEmail=function(e){this.setField({name:"contact",value:e})},e.prototype.setSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o;return(0,I.YH)(this,function(i){switch(i.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),i.label=1;case 1:return i.trys.push([1,4,,5]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return i.sent(),[4,this._sendCode()];case 3:return i.sent(),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE}))),[3,5];case 4:if(r=i.sent(),this._storeActions.setTimer(void 0),null===(n=this._userwayLogger)||void 0===n||n.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE,error_id:r.code})),void 0===(o=e7(r)))throw this._authSdk.captureException(r,eF),r;if(Object.keys(o).includes("authApi")&&Object.values(o.authApi).includes(l.SESSION))return this.changeScreen(ef.SECURITY_ERROR),[2];return this._storeActions.setErrors(o),[3,5];case 5:return[2]}})})},e.prototype.submitLoginScreenForm=function(){var e,t,n,r,o;return(0,I.sH)(this,void 0,void 0,function(){var i,s,a,u,d;return(0,I.YH)(this,function(h){switch(h.label){case 0:if(i=this.getState(),this._storeActions.increaseSubmitCount(),s={contact:i.contact.trim()},null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),a=this._validateLoginScreenForm(s))return this._storeActions.setErrors(a),null===(t=this._userwayLogger)||void 0===t||t.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),h.label=1;case 1:return h.trys.push([1,5,,6]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return h.sent(),[4,this._authSdk.loginByEmailOrPhoneStart({contact:s.contact})];case 3:return h.sent(),[4,this._sendCode()];case 4:return h.sent(),this._contactType&&(null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CODE_SENT),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:tr(this._contactType)}))),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE}))),this.changeScreen(ef.CHECK_CODE),this._storeActions.setLoading(void 0),[3,6];case 5:if(u=h.sent(),this._storeActions.setLoading(void 0),null===(o=this._userwayLogger)||void 0===o||o.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE,error_id:u.code})),void 0===(d=e7(u)))throw this._authSdk.captureException(u,eF),u;if(Object.keys(d).includes("authApi")&&Object.values(d.authApi).includes(l.SESSION))return this.changeScreen(ef.SECURITY_ERROR),[2];return this._storeActions.setErrors(d),[3,6];case 6:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(e){var t,n,r,o;return(0,I.sH)(this,void 0,void 0,function(){var i,s,a,u,d,h,_,E;return(0,I.YH)(this,function(C){switch(C.label){case 0:if(i=this.getState(),this._storeActions.increaseSubmitCount(),s={contact:i.contact.trim(),code:i.code.trim()},a=this._validateCheckContactScreenForm(s))return this._storeActions.setErrors(a),null===(t=this._userwayLogger)||void 0===t||t.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),C.label=1;case 1:return C.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return C.sent(),[4,this._authSdk.loginByEmailOrPhoneConfirm({contact:s.contact,code:s.code})];case 3:return C.sent(),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE})),this._storeActions.setLoading(void 0),this._historyController.clear(),[3,5];case 4:if(u=C.sent(),this._storeActions.setLoading(void 0),tt(u))return h=(d=te(u)).sessionId,_=d.phone,this.contactForSyncInfo=_,this.sessionIdForSyncInfo=h,null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),e(),[2];if(null===(o=this._userwayLogger)||void 0===o||o.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:p.Pw.EMAIL_OR_PHONE,error_id:u.code})),void 0===(E=e7(u)))throw this._authSdk.captureException(u,eF),u;if(Object.keys(E).includes("authApi")&&Object.values(E.authApi).includes(l.SESSION))return this.changeScreen(ef.SECURITY_ERROR),[2];return this._storeActions.setErrors(E),[3,5];case 5:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return this._historyController.clear(),this.changeScreen(ef.LOGIN),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),[2]})})},e.prototype.trackRegistrationLinkClick=function(e){var t;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(n){return null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},e?O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_PHONE_CLICK:O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),[2]})})},e.prototype.trackLoginByPasswordClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_DEFAULT_LOGIN_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),[2]})})},e.prototype.trackErrorRegistrationLinkClick=function(e){var t;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(n){return null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},e?O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_PHONE_CLICK:O.pj.AUTHENTICATION_CHANGE_FLOW_REGISTRATION_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),[2]})})},e.prototype.loginByOAuthClick=function(e,t){var n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,c,a,l,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OAUTH_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,oauth_provider:e})),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setErrors(void 0),this._storeActions.setLoading("oauth"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.loginByOauth(e)];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:e})),this._historyController.clear(),[3,5];case 4:if(s=d.sent(),this._storeActions.setLoading(void 0),tt(s))return a=(c=te(s)).sessionId,l=c.phone,this.contactForSyncInfo=l,this.sessionIdForSyncInfo=a,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE})),t(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:e,error_id:s.code})),void 0===(u=e7(s)))throw this._authSdk.captureException(s,eF),s;return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},e}(),t7=f.memo(function(e){var t=(0,S.OB)(function(e){return n(4237)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.loginScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=(0,I.Tt)(l,["errors"]),h=e.securityErrorScreen,_=e.onErrorRegistrationLinkClick;e.loading;var E=(0,I.Tt)(e,["className","currentScreen","loginScreen","checkCodeScreen","securityErrorScreen","onErrorRegistrationLinkClick","loading"]),C=function(e){return Object.entries(e).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{registrationLink:f.createElement(L.N_,{onClick:_})}}),o))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},E),i===ef.LOGIN?f.createElement(tA,(0,I.Cl)({},a,{errors:c?C(c):void 0,description:t("loginByContactScreen.description")},(0,w.th)(tl.SCREEN,"login-email-code"))):null,i===ef.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},d,{description:t("checkCode.".concat(d.contactType,".description")),submitText:t("checkCode.fields.submitText"),errors:u?C(u):void 0},(0,w.th)(tl.SCREEN,"login-email-code-code"))):null,i===ef.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},h)):null)}),ne=(0,I.Cl)({loading:void 0,currentScreen:ef.LOGIN,contact:"",contactType:"email",code:""},ty),nt=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},ne),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return ne})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),nn=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode,n=e.changeFlowToAddEmailOrPhone,r=e.changeFlowToRegistrationByPhone,o=e.changeFlowToLoginByEmailAndPass,i=e.isTutuWallet,s=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToAddEmailOrPhone","changeFlowToRegistrationByPhone","changeFlowToLoginByEmailAndPass","isTutuWallet"]),c=t2(),a=eD()[eH].loginByEmailOrPhone,l=(0,Q.Pj)(nt),u=l.currentScreen,d=l.contact,h=l.errors,E=l.loading,C=l.timer,g=l.submitCount,A=l.code,m=l.contactType,T=c.availableLoginMethods,S=(0,f.useCallback)(function(){a.submitLoginScreenForm()},[a]),O=(0,f.useCallback)(function(){o(),a.trackLoginByPasswordClick()},[o,a]),p=e5(T),v=(0,f.useCallback)(function(){i?r():t(),a.trackRegistrationLinkClick(i)},[t,r,a,i]),y=(0,f.useCallback)(function(e){a.loginByOAuthClick(e,n)},[a,n]),N=(0,f.useCallback)(function(){i?r():t(),a.trackErrorRegistrationLinkClick(i)},[t,r,a,i]),L=(0,f.useCallback)(function(e){a.setContact(e)},[a]),R=(0,f.useCallback)(function(e){e.preventDefault(),a.sendCode()},[a]),k=(0,f.useCallback)(function(e){a.setField({name:"code",value:e})},[a]),b=(0,f.useCallback)(function(){a.submitCheckCodeScreenForm(n)},[a,n]),w=(0,f.useCallback)(function(){a.submitSecurityErrorScreenForm()},[a]),H=(0,f.useMemo)(function(){return{oauthItems:p,contact:d,errors:h,loading:"default"===E,submitCount:g,onOauthItemLoginClick:y,onContactChange:L,onSubmit:S,onRegistrationLinkClick:v,screenType:_.EmailOrPhone,onLoginByPasswordClick:O}},[p,d,h,E,g,y,L,S,v,O]),F=(0,f.useMemo)(function(){return{code:A,contact:d,errors:h,timer:C,loading:"default"===E,submitCount:g,onSubmit:b,onCodeChange:k,onSendCodeClick:R,contactType:m}},[A,d,h,C,E,g,b,k,R,m]),U=(0,f.useMemo)(function(){return{onButtonClick:w}},[w]),P="default"===E;return"oauth"===E?f.createElement(tB,null):f.createElement(t7,(0,I.Cl)({},s,{currentScreen:u,onErrorRegistrationLinkClick:N,loginScreen:H,checkCodeScreen:F,securityErrorScreen:U,loading:P}))}),nr={email:[eq,eZ],agreement:[eq,e$]},no={code:[eq,eJ,eQ(4)]},ni=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.authSdk,n=e.alreadyAuthenticatedResolver,r=e.historyController,o=e.userwayLogger,i=e.store;this._store=i,this._storeActions=i.getState().actions,this._authSdk=t,this._alreadyAuthenticatedResolver=n,this._historyController=r,this._userwayLogger=o,this._validateRegistrationScreenForm=e2(nr),this._validateCheckCodeScreenForm=e2(no),this.contactForSyncInfo=null}return e.prototype._validateFieldChangeRegistrationScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateRegistrationScreenForm({email:e.email,agreement:e.agreement});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckCodeScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a=this;return(0,I.YH)(this,function(l){switch(l.label){case 0:if("string"!=typeof(t=null===(e=this.getState().email)||void 0===e?void 0:e.trim()))throw Error("email is required");if(this._timers.has(t))return n=this._timers.get(t),this._activeTimerEmail=t,this._storeActions.setTimer(n.time),[2];return[4,this._authSdk.registrationSendCode({email:t,contact:t})];case 1:return r=l.sent().lockIn,o=new y.A,i=function(){return t===a._activeTimerEmail},s=function(e){i()&&a._storeActions.setTimer(e)},c=function(){i()&&(a._storeActions.stopTimer(),a._activeTimerEmail=null),o.off("tick",s),o.off("done",c),a._timers.delete(t)},o.start(r),o.on("tick",s),o.on("done",c),this._storeActions.setTimer(r),this._activeTimerEmail=t,this._timers.set(t,o),[2]}})})},e.prototype.loginByOAuthClick=function(e,t){var n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,c,a,l,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OAUTH_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_CODE,oauth_provider:e})),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setErrors(void 0),this._storeActions.setLoading("oauth"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.loginByOauth(e)];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.REGISTRATION_EMAIL,login_type:e})),this._historyController.clear(),[3,5];case 4:if(s=d.sent(),this._storeActions.setLoading(void 0),tt(s))return a=(c=te(s)).sessionId,l=c.phone,this.contactForSyncInfo=l,this.sessionIdForSyncInfo=a,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.REGISTRATION_EMAIL})),t(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.REGISTRATION_EMAIL,login_type:e,error_id:s.code})),void 0===(u=e7(s)))throw this._authSdk.captureException(s,eF),s;return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:eI,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;["email","agreement"].includes(t)&&this._validateFieldChangeRegistrationScreenForm(),["code"].includes(t)&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeAgreement=function(e){var t;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(n){return null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OFERTA_CHECKBOX_CLICK),{block:O.gf.REGISTRATION_EMAIL,checkbox_alternative:e})),this.setField({name:"agreement",value:e}),[2]})})},e.prototype.setEmail=function(e){this.setField({name:"email",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r;return(0,I.YH)(this,function(o){switch(o.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.REGISTRATION_EMAIL})),o.label=1;case 1:return o.trys.push([1,4,,5]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return o.sent(),[4,this._sendCode()];case 3:return o.sent(),[3,5];case 4:if(n=o.sent(),this._storeActions.setTimer(void 0),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.REGISTRATION_EMAIL,error_id:n.code})),void 0===(r=e7(n)))throw this._authSdk.captureException(n,eF),n;if(Object.keys(r).includes("authApi")&&Object.values(r.authApi).includes(l.SESSION))return this.changeScreen(eO.SECURITY_ERROR),[2];return this._storeActions.setErrors(r),[3,5];case 5:return[2]}})})},e.prototype.submitRegistrationScreenForm=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o,i,s,a;return(0,I.YH)(this,function(u){switch(u.label){case 0:if(r=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTER_CLICK),{block:O.gf.REGISTRATION_EMAIL})),o={email:r.email.trim(),agreement:r.agreement},i=this._validateRegistrationScreenForm(o))return this._storeActions.setErrors(i),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.REGISTRATION_EMAIL,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),u.label=1;case 1:return u.trys.push([1,5,,6]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return u.sent(),[4,this._authSdk.registrationStart({email:o.email,contact:o.email})];case 3:return u.sent(),[4,this._sendCode()];case 4:return u.sent(),this.changeScreen(eO.CHECK_CODE),this._storeActions.setLoading(void 0),[3,6];case 5:if(s=u.sent(),this._storeActions.setLoading(void 0),this._authSdk.captureException(s,eF),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.REGISTRATION_EMAIL,error_id:s.code})),void 0===(a=e7(s)))throw s;if(Object.keys(a).includes("authApi")&&Object.values(a.authApi).includes(l.SESSION))return this.changeScreen(eO.SECURITY_ERROR),[2];return this._storeActions.setErrors(a),[3,6];case 6:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(){var e,t,n,r;return(0,I.sH)(this,void 0,void 0,function(){var o,i,s,a,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:if(o=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_CLICK),{block:O.gf.REGISTRATION_EMAIL})),i={email:o.email.trim(),code:o.code.trim()},s=this._validateCheckCodeScreenForm(i))return this._storeActions.setErrors(s),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.REGISTRATION_EMAIL,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.registrationConfirm({code:i.code,contact:i.email,agreements:["lc_registration","legal_tuturu"]})];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_SUCCESS),{block:O.gf.REGISTRATION_EMAIL})),this._historyController.clear(),[3,5];case 4:if(a=d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.REGISTRATION_EMAIL,error_id:a.code})),void 0===(u=e7(a)))throw this._authSdk.captureException(a,eF),a;if(Object.keys(u).includes("authApi")&&Object.values(u.authApi).includes(l.SESSION))return this.changeScreen(eO.SECURITY_ERROR),[2];return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.REGISTRATION_EMAIL})),this.changeScreen(eO.REGISTER),[2]})})},e.prototype.trackLoginLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:O.gf.REGISTRATION_EMAIL})),[2]})})},e.prototype.trackErrorLoginByEmailOrPhoneLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:"registration_error"})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.REGISTRATION_EMAIL})),[2]})})},e}(),ns=function(e){var t=e.agreementLink;return f.createElement(L.L9,{size:"paragraph-medium",className:(0,N.A)((0,R.V)("block"),b.A.center,(0,k.S3)(350)),color:"secondary"},"Нажимая \xabЗарегистрироваться\xbb, вы соглашаетесь с"," ",f.createElement(L.N_,(0,I.Cl)({href:t,target:"_blank"},(0,w.th)(tl.AGREEMENT_LINK)),"пользовательским соглашением."))};!function(e){e.Email="email",e.Phone="phone",e.EmailOrPhone="emailOrPhone"}(g||(g={}));var nc=((C={})[g.EmailOrPhone]=tl.EMAIL_OR_PHONE_FIELD,C[g.Phone]=tl.PHONE_FIELD,C[g.Email]=tl.EMAIL_FIELD,C),na=f.memo(function(e){var t=(0,S.OB)(function(e){return n(79207)("./".concat(e,"/index.json"))}),r=e.submitCount,o=e.agreementLink,i=void 0===o?ew.REGISTRATION_BY_EMAIL_AGREEMENT:o,s=e.checkboxAgreementLink,c=void 0===s?ew.REGISTRATION_BY_PHONE_CHECKBOX_AGREEMENT:s,a=e.contact,l=e.agreement,u=e.errors,d=e.loading,h=e.oauthItems,_=e.screenType,E=void 0===_?g.Phone:_,C=e.onAgreementChange,A=e.onLoginLinkClick,m=e.onContactChange,T=e.onSubmit,O=e.onOauthItemLoginClick,p=(0,f.useCallback)(function(e){m(e.target.value)},[m]),v=void 0!==(null==u?void 0:u.email)||void 0!==(null==u?void 0:u.phone),y=void 0!==(null==u?void 0:u.agreement),R=!!(null==h?void 0:h.length),G=(0,f.useCallback)(function(e){e.preventDefault(),d||T()},[T,d]),B=(0,f.useCallback)(function(e){!0!==d&&A(e)},[A,d]),j=(0,f.useCallback)(function(e){C(e.target.checked)},[C]),W=(0,f.useCallback)(function(e){d||O(e)},[O,d]);return f.createElement(f.Fragment,null,f.createElement(th,null),f.createElement("form",{onSubmit:G,noValidate:!0,className:(0,k.cV)(450)},f.createElement(P.gE,{size:500,layout:"vertical"},f.createElement(F.A,(0,I.Cl)({placeholder:t("fields.placeholder.".concat(E)),onChange:p,value:a,name:E,autoComplete:E===g.Email?"email":"tel",type:E===g.Email?"email":"text",hasError:v,size:500},(0,w.th)(nc[E]),{autoFocus:!0})),f.createElement(D.AJ,{className:(0,P.tG)({xs:["top"]}),checkboxProps:(0,I.Cl)({disabled:!1,hasError:y,onChange:j,checked:l},(0,w.th)(tl.AGREEMENT_CHECKBOX)),addonSize:"medium"},f.createElement(et.Im,null,f.createElement(M.PM,{label:f.createElement(L.L9,null,"Даю"," ",f.createElement(L.N_,(0,I.Cl)({href:c,target:"_blank"},(0,w.th)(tl.CHECKBOX_AGREEMENT_LINK)),"согласие")," ","на обработку персональных данных"),emphasized:!0}))),void 0!==u&&Object.keys(u).length>0?f.createElement(tu,{submitCount:r,errors:u}):null,f.createElement(H.$n,(0,I.Cl)({color:"primary",fullWidth:!0,type:"submit",isLoading:d},(0,w.th)(tl.SUBMIT_TRIGGER)),t("fields.submit.text")),f.createElement(L.P,{color:"secondary",size:"paragraph-medium",className:(0,N.A)(b.A.center,(0,k.S3)(450)),hasExtraPaddingTop:!0},f.createElement(U.A,{label:t("changeFlow.text"),tags:{link:f.createElement(H.n6,(0,I.Cl)({onClick:B,key:"loginLink"},(0,w.th)(tl.LOGIN_BY_EMAIL_OR_PHONE_TRIGGER)))}})))),R?f.createElement(tC,{hint:t("oauthItems.hint"),items:h,onItemClick:W}):null,f.createElement(ta,null),f.createElement(ns,{agreementLink:i}))}),nl=f.memo(function(e){var t=e.className,n=e.loading,r=e.screenType,o=e.submitCount,i=e.agreementLink,s=e.contact,c=e.agreement,a=e.errors,l=e.oauthItems,u=e.onLoginLinkClick,d=e.onContactChange,h=e.onSubmit,_=e.onAgreementChange,E=e.onOauthItemLoginClick,C=(0,I.Tt)(e,["className","loading","screenType","submitCount","agreementLink","contact","agreement","errors","oauthItems","onLoginLinkClick","onContactChange","onSubmit","onAgreementChange","onOauthItemLoginClick"]);return f.createElement("div",(0,I.Cl)({className:void 0===t?"":t},C),"oauth"===n?f.createElement(tB,null):f.createElement(na,{loading:"default"===n,submitCount:o,agreementLink:i,contact:s,agreement:c,screenType:r,onContactChange:d,errors:a,onLoginLinkClick:u,onSubmit:h,onAgreementChange:_,onOauthItemLoginClick:E,oauthItems:l}))}),nu=f.memo(function(e){var t=(0,S.OB)(function(e){return n(68389)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.registrationScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=(0,I.Tt)(l,["errors"]),h=e.securityErrorScreen,_=e.onErrorLoginByEmailOrPhoneLinkClick,E=(0,I.Tt)(e,["className","currentScreen","registrationScreen","checkCodeScreen","securityErrorScreen","onErrorLoginByEmailOrPhoneLinkClick"]),C=function(e){return Object.entries(e).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{loginLink:f.createElement(L.N_,{onClick:_})}}),o))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},E),i===eO.REGISTER?f.createElement(nl,(0,I.Cl)({},a,{errors:c?C(c):void 0},(0,w.th)(tl.SCREEN,"registration-email-code"))):null,i===eO.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},d,{description:t("checkCode.description"),submitText:t("checkCode.fields.submitText"),errors:u?C(u):void 0},(0,w.th)(tl.SCREEN,"registration-email-code-code"))):null,i===eO.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},h)):null)}),nd=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:eO.REGISTER,email:"",agreement:!1,code:""}),nh=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},nd),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return nd})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),n_=f.memo(function(e){e.changeFlowToLoginByEmailAndPass;var t=e.changeFlowToAddEmailOrPhone,n=e.changeFlowToLoginByEmailOrPhone,r=e.agreementLink,o=(0,I.Tt)(e,["changeFlowToLoginByEmailAndPass","changeFlowToAddEmailOrPhone","changeFlowToLoginByEmailOrPhone","agreementLink"]),i=eD()[eH].registrationByEmailAndCode,s=(0,Q.Pj)(nh),c=s.currentScreen,a=s.email,l=s.agreement,u=s.errors,d=s.loading,h=s.timer,_=s.submitCount,E=s.code,C=[p.N2.VKONTAKTE,p.N2.VK_ID,p.N2.ODNOKLASSNIKI],A=(0,f.useCallback)(function(e){i.loginByOAuthClick(e,t)},[i,t]),m=(0,f.useCallback)(function(){i.submitRegistrationScreenForm()},[i]),T=(0,f.useCallback)(function(){i.trackLoginLinkClick(),n()},[i,n]),S=(0,f.useCallback)(function(){i.trackErrorLoginByEmailOrPhoneLinkClick(),n()},[i,n]),O=(0,f.useCallback)(function(e){i.setField({name:"email",value:e})},[i]),v=(0,f.useCallback)(function(e){i.changeAgreement(e)},[i]),y=(0,f.useCallback)(function(e){e.preventDefault(),i.sendCode()},[i]),N=(0,f.useCallback)(function(e){i.setField({name:"code",value:e})},[i]),L=(0,f.useCallback)(function(){i.submitCheckCodeScreenForm()},[i]),R=(0,f.useCallback)(function(){i.submitSecurityErrorScreenForm()},[i]),k=(0,f.useMemo)(function(){return{agreementLink:r,contact:a,screenType:g.Email,agreement:l,errors:u,oauthItems:C,loading:d,submitCount:_,onContactChange:O,onAgreementChange:v,onSubmit:m,onLoginLinkClick:T,onOauthItemLoginClick:A}},[r,a,l,u,C,d,_,O,v,m,T,A]),b=(0,f.useMemo)(function(){return{code:E,contact:a,errors:u,timer:h,loading:"default"===d,submitCount:_,onSubmit:L,onCodeChange:N,onSendCodeClick:y}},[E,a,u,h,d,_,L,N,y]),w=(0,f.useMemo)(function(){return{onButtonClick:R}},[R]);return f.createElement(nu,(0,I.Cl)({},o,{currentScreen:c,onErrorLoginByEmailOrPhoneLinkClick:S,registrationScreen:k,checkCodeScreen:b,securityErrorScreen:w}))}),nE={phone:[eq,e0],agreement:[eq,e$]},nC={code:[eq,eJ,eQ(4)]},ng=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._contactType=null,this._validateCheckCodeScreenForm=e2(nC),this.contactForSyncInfo=null}return e.prototype._validateLoginScreenForm=function(e){var t=e.contact,n=e.agreement;return e2(nE)({phone:t,agreement:n})},e.prototype._validateFieldChangeRegistrationScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({contact:e.contact,agreement:e.agreement});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckCodeScreenForm({code:e.code});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a,l,u=this;return(0,I.YH)(this,function(d){switch(d.label){case 0:if("string"!=typeof(t=null===(e=this.getState().contact)||void 0===e?void 0:e.trim()))throw Error("contact is required");if(this._timers.has(t))return n=this._timers.get(t),this._activeTimerEmail=t,this._storeActions.setTimer(n.time),[2];return[4,this._authSdk.registrationSendCode({contact:t})];case 1:return o=(r=d.sent()).lockIn,i=r.contactType,this._contactType=i,s=new y.A,c=function(){return t===u._activeTimerEmail},a=function(e){c()&&u._storeActions.setTimer(e)},l=function(){c()&&(u._storeActions.stopTimer(),u._activeTimerEmail=null),s.off("tick",a),s.off("done",l),u._timers.delete(t)},s.start(o),s.on("tick",a),s.on("done",l),this._storeActions.setTimer(o),this._activeTimerEmail=t,this._timers.set(t,s),[2]}})})},e.prototype.loginByOAuthClick=function(e,t){var n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,c,a,l,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OAUTH_CLICK),{block:O.gf.AUTHENTICATION_EMAIL_CODE,oauth_provider:e})),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setErrors(void 0),this._storeActions.setLoading("oauth"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.loginByOauth(e)];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.REGISTRATION_EMAIL,login_type:e})),this._historyController.clear(),[3,5];case 4:if(s=d.sent(),this._storeActions.setLoading(void 0),tt(s))return a=(c=te(s)).sessionId,l=c.phone,this.contactForSyncInfo=l,this.sessionIdForSyncInfo=a,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.REGISTRATION_EMAIL})),t(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.REGISTRATION_EMAIL,login_type:e,error_id:s.code})),void 0===(u=e7(s)))throw this._authSdk.captureException(s,eF),s;return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.setSessionId=function(e){this.setField({name:"sessionId",value:e})},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:ep,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.changeContactType=function(e){this.setField({name:"contactType",value:e})},e.prototype.setContact=function(e){this.setField({name:"contact",value:e})},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;["contact","agreement"].includes(t)&&this._validateFieldChangeRegistrationScreenForm(),["code"].includes(t)&&this._validateFieldChangeCheckCodeScreenForm()},e.prototype.changeAgreement=function(e){var t;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(n){return null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OFERTA_CHECKBOX_CLICK),{block:O.gf.REGISTRATION_EMAIL,checkbox_alternative:e})),this.setField({name:"agreement",value:e}),[2]})})},e.prototype.setEmail=function(e){this.setField({name:"email",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t,n;return(0,I.sH)(this,void 0,void 0,function(){var r,o;return(0,I.YH)(this,function(i){switch(i.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),i.label=1;case 1:return i.trys.push([1,4,,5]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return i.sent(),[4,this._sendCode()];case 3:return i.sent(),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE}))),[3,5];case 4:if(r=i.sent(),this._storeActions.setTimer(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_TUTU_WALLET_FAILURE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,error_id:r.code})),void 0===(o=e7(r)))throw this._authSdk.captureException(r,eF),r;if(Object.keys(o).includes("authApi")&&Object.values(o.authApi).includes(l.SESSION))return this.changeScreen(ev.SECURITY_ERROR),[2];return this._storeActions.setErrors(o),[3,5];case 5:return[2]}})})},e.prototype.submitRegistrationScreenForm=function(){var e,t,n,r,o;return(0,I.sH)(this,void 0,void 0,function(){var i,s,a,u,d;return(0,I.YH)(this,function(h){switch(h.label){case 0:if(i=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTER_CLICK),{block:O.gf.REGISTRATION_EMAIL})),s={contact:i.contact.trim(),agreement:i.agreement},a=this._validateLoginScreenForm(s))return this._storeActions.setErrors(a),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),h.label=1;case 1:return h.trys.push([1,5,,6]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return h.sent(),[4,this._authSdk.registrationStart({contact:s.contact})];case 3:return h.sent(),[4,this._sendCode()];case 4:return h.sent(),this._contactType&&(null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CODE_SENT),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,login_type:tr(this._contactType)}))),("russian_phone"===this._contactType||"foreign_phone"===this._contactType)&&(null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REQUEST_SMS_CODE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE}))),this.changeScreen(ev.CHECK_CODE),this._storeActions.setLoading(void 0),[3,6];case 5:if(u=h.sent(),this._storeActions.setLoading(void 0),this._authSdk.captureException(u,eF),null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,error_id:u.code})),void 0===(d=e7(u)))throw u;if(Object.keys(d).includes("authApi")&&Object.values(d.authApi).includes(l.SESSION))return this.changeScreen(ev.SECURITY_ERROR),[2];return this._storeActions.setErrors(d),[3,6];case 6:return[2]}})})},e.prototype.submitCheckCodeScreenForm=function(){var e,t,n,r;return(0,I.sH)(this,void 0,void 0,function(){var o,i,s,a,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:if(o=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_CLICK),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),i={contact:o.contact.trim(),code:o.code.trim()},s=this._validateCheckCodeScreenForm(i))return this._storeActions.setErrors(s),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.registrationConfirm({code:i.code,contact:i.contact,agreements:["legal_tuturu","reg_lc_mobile"]})];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_SUCCESS),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),this._historyController.clear(),[3,5];case 4:if(a=d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_REGISTRATION_FAILURE),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE,error_id:a.code})),void 0===(u=e7(a)))throw this._authSdk.captureException(a,eF),a;if(Object.keys(u).includes("authApi")&&Object.values(u.authApi).includes(l.SESSION))return this.changeScreen(ev.SECURITY_ERROR),[2];return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),this.changeScreen(ev.REGISTER),[2]})})},e.prototype.trackLoginLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),[2]})})},e.prototype.trackErrorLoginByEmailOrPhoneLinkClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_LOGIN_CODE_CLICK),{block:"registration_error"})),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:O.gf.TUTU_WALLET_REGISTRATION_PHONE})),[2]})})},e}(),nA=f.memo(function(e){var t=(0,S.OB)(function(e){return n(16554)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.registrationScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=(0,I.Tt)(l,["errors"]),h=e.securityErrorScreen,_=e.onErrorLoginByEmailOrPhoneLinkClick,E=(0,I.Tt)(e,["className","currentScreen","registrationScreen","checkCodeScreen","securityErrorScreen","onErrorLoginByEmailOrPhoneLinkClick"]),C=function(e){return Object.entries(e).reduce(function(e,n){var o,i=(0,I.zs)(n,2),s=i[0],c=i[1],a=tp(r,c.canBeRetriedAfterSeconds);return(0,I.Cl)((0,I.Cl)({},e),((o={})[s]="global"===s?f.createElement(U.A,{label:r("errors.".concat(c.type)),tags:{}}):f.createElement(U.A,{label:t("errors.".concat(s,".").concat(c.type),{retryText:a}),tags:{loginLink:f.createElement(L.N_,{onClick:_})}}),o))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},E),i===ev.REGISTER?f.createElement(nl,(0,I.Cl)({},a,{errors:c?C(c):void 0},(0,w.th)(tl.SCREEN,"registration-".concat(a.screenType,"-code")))):null,i===ev.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},d,{description:t("checkCode.".concat(d.contactType,".description")),submitText:t("checkCode.fields.submitText"),errors:u?C(u):void 0},(0,w.th)(tl.SCREEN,"registration-".concat(a.screenType,"-code-code")))):null,i===ev.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},h)):null)}),nm=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:ev.REGISTER,submitCount:0,contact:"",agreement:!1,contactType:"phone",code:""}),nT=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},nm),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return nm})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),nf=f.memo(function(e){var t=e.changeFlowToLoginByEmailOrPhone;e.changeFlowToLoginByEmailAndPass;var n=e.changeFlowToAddEmailOrPhone,r=e.agreementLink,o=(0,I.Tt)(e,["changeFlowToLoginByEmailOrPhone","changeFlowToLoginByEmailAndPass","changeFlowToAddEmailOrPhone","agreementLink"]),i=eD()[eH].registrationByPhoneAndCode,s=(0,Q.Pj)(nT),c=s.currentScreen,a=s.contact,l=s.agreement,u=s.errors,d=s.loading,h=s.timer,_=s.submitCount,E=s.code,C=s.contactType,A=(0,f.useCallback)(function(e){i.loginByOAuthClick(e,n)},[i,n]),m=(0,f.useCallback)(function(){i.submitRegistrationScreenForm()},[i]),T=(0,f.useCallback)(function(){i.trackLoginLinkClick(),t()},[i,t]),S=(0,f.useCallback)(function(){i.trackErrorLoginByEmailOrPhoneLinkClick(),t()},[i,t]),O=(0,f.useCallback)(function(e){i.setContact(e)},[i]),p=(0,f.useCallback)(function(e){i.changeAgreement(e)},[i]),v=(0,f.useCallback)(function(e){i.setField({name:"email",value:e})},[i]),y=(0,f.useCallback)(function(e){e.preventDefault(),i.sendCode()},[i]),N=(0,f.useCallback)(function(e){i.setField({name:"code",value:e})},[i]),L=(0,f.useCallback)(function(){i.submitCheckCodeScreenForm()},[i]),R=(0,f.useCallback)(function(){i.submitSecurityErrorScreenForm()},[i]),k=(0,f.useMemo)(function(){return{agreementLink:r,contact:a,agreement:l,errors:u,loading:d,screenType:g.Phone,submitCount:_,onContactChange:O,onEmailChange:v,onAgreementChange:p,onSubmit:m,onLoginLinkClick:T,onOauthItemLoginClick:A}},[r,a,l,u,d,_,O,v,p,m,T,A]),b=(0,f.useMemo)(function(){return{code:E,contact:a,errors:u,timer:h,loading:"default"===d,screenType:"phone",submitCount:_,onSubmit:L,onCodeChange:N,onSendCodeClick:y,contactType:C}},[E,a,u,h,d,_,L,N,y,C]),w=(0,f.useMemo)(function(){return{onButtonClick:R}},[R]);return f.createElement(nA,(0,I.Cl)({},o,{currentScreen:c,onErrorLoginByEmailOrPhoneLinkClick:S,registrationScreen:k,checkCodeScreen:b,securityErrorScreen:w}))}),nS={email:[eq,eZ]},nI={code:[eq,eJ,eQ(4)]},nO={password:[eq,function(e){var t=(""+e).trim().length;if(t<8)return new ex({type:l.MIN_LENGTH,required:8,current:t})},function(e){var t=(""+e).trim().length;if(t>64)return new eK({type:l.MAX_LENGTH,required:64,current:t})}]},np=function(){function e(e){this._timers=new Map,this._activeTimerEmail=null;var t=e.store,n=e.authSdk,r=e.alreadyAuthenticatedResolver,o=e.historyController,i=e.userwayLogger;this._store=t,this._storeActions=t.getState().actions,this._authSdk=n,this._alreadyAuthenticatedResolver=r,this._historyController=o,this._userwayLogger=i,this._validateLoginScreenForm=e2(nS),this._validateCheckCodeScreenForm=e2(nI),this._validateResetScreenForm=e2(nO),this.contactForSyncInfo=null}return e.prototype._validateFieldChangeLoginScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateLoginScreenForm({email:e.email.trim()});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeCheckCodeScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateCheckCodeScreenForm({code:e.code.trim()});this._storeActions.setErrors(t)}},e.prototype._validateFieldChangeResetScreenForm=function(){var e=this.getState();if(void 0!==e.errors&&0!==Object.keys(e.errors).length){var t=this._validateResetScreenForm({password:e.password.trim()});this._storeActions.setErrors(t)}},e.prototype._sendCode=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a=this;return(0,I.YH)(this,function(l){switch(l.label){case 0:if("string"!=typeof(t=null===(e=this.getState().email)||void 0===e?void 0:e.trim()))throw Error("email is required");if(this._timers.has(t))return n=this._timers.get(t),this._activeTimerEmail=t,this._storeActions.setTimer(n.time),[2];return[4,this._authSdk.resetPasswordByEmailSendCode({email:t})];case 1:return r=l.sent().lockIn,o=new y.A,i=function(){return t===a._activeTimerEmail},s=function(e){i()&&a._storeActions.setTimer(e)},c=function(){i()&&(a._storeActions.stopTimer(),a._activeTimerEmail=null),o.off("tick",s),o.off("done",c),a._timers.delete(t)},o.start(r),o.on("tick",s),o.on("done",c),this._storeActions.setTimer(r),this._activeTimerEmail=t,this._timers.set(t,o),[2]}})})},e.prototype._onError=function(e,t,n){this._storeActions.setLoading(void 0);var r,o=(0,I.Cl)((0,I.Cl)({},t),{block:n,login_type:p.Pw.EMAIL_CODE,error_id:e.code}),i=t===O.pj.AUTHENTICATION_LOGIN_FAILURE?tz(o):o;null===(r=this._userwayLogger)||void 0===r||r.send(i);var s=e7(e);if(void 0===s)throw this._authSdk.captureException(e,eF),e;if(Object.keys(s).includes("authApi")&&Object.values(s.authApi).includes(l.SESSION)){this.changeScreen(eL.SECURITY_ERROR);return}this._storeActions.setErrors(s)},Object.defineProperty(e.prototype,"currentScreen",{get:function(){return this.getState().currentScreen},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return this._store.getState()},e.prototype.changeScreen=function(e,t){var n=(t||{}).withHistory,r=this.currentScreen;r!==e&&((void 0===n||n)&&this._historyController.add({flow:eN,screen:r}),this._storeActions.changeScreen(e),this._storeActions.setErrors(void 0),this._storeActions.clearSubmitCount())},e.prototype.setField=function(e){this._storeActions.setField(e);var t=e.name;["email","agreement"].includes(t)&&this._validateFieldChangeLoginScreenForm(),["code"].includes(t)&&this._validateFieldChangeCheckCodeScreenForm(),["password"].includes(t)&&this._validateFieldChangeResetScreenForm()},e.prototype.setEmail=function(e){this.setField({name:"email",value:e})},e.prototype.reset=function(){this._storeActions.resetState()},e.prototype.sendCode=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r;return(0,I.YH)(this,function(o){switch(o.label){case 0:null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_AGAIN_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),o.label=1;case 1:return o.trys.push([1,4,,5]),this._storeActions.setField({name:"code",value:""}),this._storeActions.setErrors(void 0),this._storeActions.setTimer(0),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return o.sent(),[4,this._sendCode()];case 3:return o.sent(),[3,5];case 4:if(n=o.sent(),this._storeActions.setTimer(void 0),null===(t=this._userwayLogger)||void 0===t||t.send(tz({block:O.gf.FORGOT_PASSWORD_EMAIL,error_id:n.code})),void 0===(r=e7(n)))throw this._authSdk.captureException(n,eF),n;if(Object.keys(r).includes("authApi")&&Object.values(r.authApi).includes(l.SESSION))return this.changeScreen(eL.SECURITY_ERROR),[2];return this._storeActions.setErrors(r),[3,5];case 5:return[2]}})})},e.prototype.submitLoginScreenForm=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r,o,i;return(0,I.YH)(this,function(s){switch(s.label){case 0:if(n=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_SEND_CODE_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),r={email:n.email.trim()},o=this._validateLoginScreenForm(r))return this._storeActions.setErrors(o),null===(t=this._userwayLogger)||void 0===t||t.send(tz({block:O.gf.FORGOT_PASSWORD_EMAIL,login_type:p.Pw.EMAIL_CODE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),s.label=1;case 1:return s.trys.push([1,5,,6]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return s.sent(),[4,this._authSdk.resetPasswordByEmailStart({email:r.email})];case 3:return s.sent(),[4,this._sendCode()];case 4:return s.sent(),this.changeScreen(eL.CHECK_CODE),this._storeActions.setLoading(void 0),[3,6];case 5:return i=s.sent(),this._onError(i,O.pj.AUTHENTICATION_LOGIN_FAILURE,O.gf.FORGOT_PASSWORD_EMAIL),[3,6];case 6:return[2]}})})},e.prototype.submitCheckCodeScreenFormToLogin=function(e){var t,n,r,o;return(0,I.sH)(this,void 0,void 0,function(){var i,s,a,l,u,d,h;return(0,I.YH)(this,function(_){switch(_.label){case 0:if(i=this.getState(),this._storeActions.increaseSubmitCount(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),s={email:i.email.trim(),code:i.code.trim()},a=this._validateCheckCodeScreenForm(s))return this._storeActions.setErrors(a),null===(n=this._userwayLogger)||void 0===n||n.send(tz({block:O.gf.FORGOT_PASSWORD_EMAIL,login_type:p.Pw.EMAIL_CODE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),_.label=1;case 1:return _.trys.push([1,5,,6]),this._storeActions.setLoading("default"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return _.sent(),[4,this._authSdk.resetPasswordByEmailSolveCode({email:s.email,code:s.code})];case 3:return _.sent(),[4,this._authSdk.resetPasswordByEmailConfirm({email:s.email})];case 4:return _.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.FORGOT_PASSWORD_EMAIL,login_type:p.Pw.EMAIL_CODE})),this._historyController.clear(),[3,6];case 5:if(tt(l=_.sent()))return d=(u=te(l)).sessionId,h=u.phone,this.contactForSyncInfo=h,this.sessionIdForSyncInfo=d,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.FORGOT_PASSWORD_EMAIL})),e(),[2];return this._onError(l,O.pj.AUTHENTICATION_LOGIN_FAILURE,O.gf.FORGOT_PASSWORD_EMAIL),[3,6];case 6:return[2]}})})},e.prototype.submitCheckCodeScreenFormToReset=function(){var e,t;return(0,I.sH)(this,void 0,void 0,function(){var n,r,o,i;return(0,I.YH)(this,function(s){switch(s.label){case 0:if(n=this.getState(),this._storeActions.increaseSubmitCount(),null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_RESET_PASSWORD_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),r={email:n.email.trim(),code:n.code.trim()},o=this._validateCheckCodeScreenForm(r))return this._storeActions.setErrors(o),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_RESET_PASSWORD_FAILURE),{block:O.gf.FORGOT_PASSWORD_EMAIL,login_type:p.Pw.EMAIL_CODE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),s.label=1;case 1:return s.trys.push([1,4,,5]),this._storeActions.setLoading("reset"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return s.sent(),[4,this._authSdk.resetPasswordByEmailSolveCode({email:r.email,code:r.code})];case 3:return s.sent(),this.changeScreen(eL.RECOVERY),this._storeActions.setLoading(void 0),[3,5];case 4:return i=s.sent(),this._onError(i,O.pj.AUTHENTICATION_RESET_PASSWORD_FAILURE,O.gf.FORGOT_PASSWORD_EMAIL),[3,5];case 5:return[2]}})})},e.prototype.submitResetScreenForm=function(e){var t,n,r,o;return(0,I.sH)(this,void 0,void 0,function(){var i,s,a,l,u,d,h;return(0,I.YH)(this,function(_){switch(_.label){case 0:if(i=this.getState(),this._storeActions.increaseSubmitCount(),null===(t=this._userwayLogger)||void 0===t||t.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL_RESET})),s={email:i.email.trim(),password:i.password.trim()},a=this._validateResetScreenForm(s))return this._storeActions.setErrors(a),null===(n=this._userwayLogger)||void 0===n||n.send(tz({block:O.gf.FORGOT_PASSWORD_EMAIL_RESET,login_type:p.Pw.EMAIL_CODE,error_id:c.UI_VALIDATION_ERROR})),[2];this._storeActions.setErrors(void 0),_.label=1;case 1:return _.trys.push([1,4,,5]),this._storeActions.setLoading("reset"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return _.sent(),[4,this._authSdk.resetPasswordByEmailConfirm({email:s.email,newPassword:s.password})];case 3:return _.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.FORGOT_PASSWORD_EMAIL_RESET,login_type:p.Pw.EMAIL_CODE})),this._historyController.clear(),[3,5];case 4:if(tt(l=_.sent()))return d=(u=te(l)).sessionId,h=u.phone,this.contactForSyncInfo=h,this.sessionIdForSyncInfo=d,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.FORGOT_PASSWORD_EMAIL_RESET})),e(),[2];return this._onError(l,O.pj.AUTHENTICATION_LOGIN_FAILURE,O.gf.FORGOT_PASSWORD_EMAIL_RESET),[3,5];case 5:return[2]}})})},e.prototype.submitSecurityErrorScreenForm=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_START_OVER_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),this.changeScreen(eL.LOGIN),[2]})})},e.prototype.trackHistoryGoBackClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){var t;return(0,I.YH)(this,function(n){return t=this.currentScreen===ey?O.gf.FORGOT_PASSWORD_EMAIL_RESET:O.gf.FORGOT_PASSWORD_EMAIL,null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_BACK_CLICK),{block:t})),[2]})})},e.prototype.trackLoginByPasswordClick=function(){var e;return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(t){return null===(e=this._userwayLogger)||void 0===e||e.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_CHANGE_FLOW_DEFAULT_LOGIN_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL})),[2]})})},e.prototype.loginByOAuthClick=function(e,t){var n,r,o,i;return(0,I.sH)(this,void 0,void 0,function(){var s,c,a,l,u;return(0,I.YH)(this,function(d){switch(d.label){case 0:null===(n=this._userwayLogger)||void 0===n||n.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_OAUTH_CLICK),{block:O.gf.FORGOT_PASSWORD_EMAIL,oauth_provider:e})),d.label=1;case 1:return d.trys.push([1,4,,5]),this._storeActions.setErrors(void 0),this._storeActions.setLoading("oauth"),[4,this._alreadyAuthenticatedResolver.handle()];case 2:return d.sent(),[4,this._authSdk.loginByOauth(e)];case 3:return d.sent(),this._storeActions.setLoading(void 0),null===(r=this._userwayLogger)||void 0===r||r.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_LOGIN_SUCCESS),{block:O.gf.FORGOT_PASSWORD_EMAIL,login_type:e})),this._historyController.clear(),[3,5];case 4:if(s=d.sent(),this._storeActions.setLoading(void 0),tt(s))return a=(c=te(s)).sessionId,l=c.phone,this.contactForSyncInfo=l,this.sessionIdForSyncInfo=a,null===(o=this._userwayLogger)||void 0===o||o.send((0,I.Cl)((0,I.Cl)({},O.pj.AUTHENTICATION_FOREIGN_EMAIL),{block:O.gf.FORGOT_PASSWORD_EMAIL})),t(),[2];if(null===(i=this._userwayLogger)||void 0===i||i.send(tz({block:O.gf.AUTHENTICATION_EMAIL_PHONE_CODE,login_type:e,error_id:s.code})),void 0===(u=e7(s)))throw this._authSdk.captureException(s,eF),s;return this._storeActions.setErrors(u),[3,5];case 5:return[2]}})})},e}();function nv(e){var t=(0,er.Bi)(e,[{id:A.TooWeak,value:"Too weak",minDiversity:0,minLength:0},{id:A.Weak,value:"Weak",minDiversity:2,minLength:8},{id:A.Medium,value:"Medium",minDiversity:3,minLength:Math.min(12,Math.round(12))},{id:A.Strong,value:"Strong",minDiversity:4,minLength:16}]),n=t.id;t.length>18&&t.contains.length>=3&&(n=A.Strong);var r=e.split("").reduce(function(e,t){var n,r;return(0,I.Cl)((0,I.Cl)({},e),((n={})[t]=(null!==(r=e[t])&&void 0!==r?r:0)+1,n))},{}),o=Object.keys(r).length,i=(Object.values(r).reduce(function(e,t){return e+t},0)/o||0)/e.length;return(i>.15&&(n=Math.min(n,A.Medium)),o<5||i>=.18)?A.TooWeak:n}!function(e){e[e.TooWeak=0]="TooWeak",e[e.Weak=1]="Weak",e[e.Medium=2]="Medium",e[e.Strong=3]="Strong"}(A||(A={}));var ny=((m={})[A.TooWeak]="negative",m[A.Weak]="warning",m[A.Medium]="positive",m[A.Strong]="positive",m),nN=((T={})[A.TooWeak]="fields.password.strength.tooWeak",T[A.Weak]="fields.password.strength.weak",T[A.Medium]="fields.password.strength.medium",T[A.Strong]="fields.password.strength.strong",T),nL=f.memo(function(e){var t=(0,S.OB)(function(e){return n(26785)("./".concat(e,"/index.json"))}),r=e.className,o=e.submitCount,i=e.email,s=e.password,c=e.errors,a=e.loading,l=e.onSubmit,u=e.onPasswordChange,d=(0,I.Tt)(e,["className","submitCount","email","password","errors","loading","onSubmit","onPasswordChange"]),h=(0,I.zs)((0,f.useState)(s?nv(s):void 0),2),_=h[0],E=h[1],C=void 0!==(null==c?void 0:c.password),g=(0,f.useCallback)(function(e){var t=e.target.value,n=t?nv(t):void 0;u(t),E(n)},[u]),A=(0,f.useCallback)(function(e){e.preventDefault(),!0!==a&&l()},[l,a]),m=void 0!==_?ny[_]:void 0,T=(0,f.useMemo)(function(){var e=void 0!==_?t(nN[_]):null;return f.createElement(L.L9,null,e)},[t,_]);return f.createElement("div",(0,I.Cl)({className:void 0===r?"":r},d),f.createElement(th,null),f.createElement(L.L9,{className:(0,N.A)((0,R.V)("block"),(0,k.cV)(350)),size:"paragraph-medium"},f.createElement(U.A,{label:t("description",{value:8}),tags:{}})),f.createElement("form",{onSubmit:A,noValidate:!0},f.createElement(P.gE,{size:500,layout:"vertical"},f.createElement(F.A,{readOnly:!0,tabIndex:-1,className:en.A.visuallyHidden,wrapperClassName:en.A.visuallyHidden,size:500,name:"email",type:"email",autoComplete:"off",value:i}),f.createElement(ee.s,(0,I.Cl)({wrapperClassName:(0,k.cV)(300),placeholder:t("fields.password.placeholder"),onChange:g,value:s,name:"password",autoComplete:"new-password",hasError:C,size:500,hint:{label:T,labelColor:m}},(0,w.th)(tl.PASSWORD_FIELD))),void 0!==c&&Object.keys(c).length>0?f.createElement(tu,{submitCount:o,errors:c}):null,f.createElement(H.$n,(0,I.Cl)({color:"primary",fullWidth:!0,type:"submit",isLoading:a},(0,w.th)(tl.SUBMIT_TRIGGER)),t("fields.submit.text")))),f.createElement(ta,null))}),nR={foo:"bar"},nk=f.memo(function(e){var t=(0,S.OB)(function(e){return n(88436)("./".concat(e,"/index.json"))}),r=(0,S.OB)(function(e){return n(89367)("./".concat(e,"/index.json"))}),o=e.className,i=e.currentScreen,s=e.loginScreen,c=s.errors,a=(0,I.Tt)(s,["errors"]),l=e.checkCodeScreen,u=l.errors,d=l.loadingReset,h=l.onResetClick,_=(0,I.Tt)(l,["errors","loadingReset","onResetClick"]),E=e.resetScreen,C=E.errors,g=(0,I.Tt)(E,["errors"]),A=e.securityErrorScreen,m=e.onErrorRegistrationLinkClick,T=(0,I.Tt)(e,["className","currentScreen","loginScreen","checkCodeScreen","resetScreen","securityErrorScreen","onErrorRegistrationLinkClick"]),O=(0,f.useMemo)(function(){return f.createElement(H.$n,(0,I.Cl)({className:(0,k.S3)(200),fullWidth:!0,color:"secondary",isLoading:d,onClick:h},(0,w.th)(tl.RESET_PASSWORD_TRIGGER)),t("checkCode.fields.resetText"))},[t,d,h]),p=function(e){return Object.entries(e).reduce(function(e,n){var o,i,s=(0,I.zs)(n,2),c=s[0],a=s[1],l=(o=tp(r,a.canBeRetriedAfterSeconds),"global"===c?f.createElement(U.A,{label:r("errors.".concat(a.type)),tags:{}}):a instanceof ex?f.createElement(U.A,{label:t("errors.".concat(c,".").concat(a.type),{value:a.requiredMinLength}),tags:nR}):a instanceof eK?f.createElement(U.A,{label:t("errors.".concat(c,".").concat(a.type),{value:a.requiredMaxLength}),tags:nR}):f.createElement(U.A,{label:t("errors.".concat(c,".").concat(a.type),{retryText:o}),tags:{registrationLink:f.createElement(L.N_,{onClick:m})}}));return(0,I.Cl)((0,I.Cl)({},e),((i={})[c]=l,i))},{})};return f.createElement("div",(0,I.Cl)({className:void 0===o?"":o},T),i===eL.LOGIN?f.createElement(tA,(0,I.Cl)({},a,{errors:c?p(c):void 0},(0,w.th)(tl.SCREEN,"reset-password"))):null,i===eL.CHECK_CODE?f.createElement(tS,(0,I.Cl)({},_,{description:t("checkCode.description"),submitText:t("checkCode.fields.submitText"),slotBottom:O,errors:u?p(u):void 0},(0,w.th)(tl.SCREEN,"reset-password-code"),{autoSubmit:!1})):null,i===eL.RECOVERY?f.createElement(nL,(0,I.Cl)({},g,{errors:C?p(C):void 0},(0,w.th)(tl.SCREEN,"reset-password-reset"))):null,i===eL.SECURITY_ERROR?f.createElement(tO,(0,I.Cl)({},A)):null)}),nb=(0,I.Cl)((0,I.Cl)({},ty),{loading:void 0,currentScreen:eL.LOGIN,submitCount:0,email:"",password:"",code:""}),nw=(0,$.y)()(function(e,t,n){return(0,I.Cl)((0,I.Cl)({},nb),{actions:(0,I.Cl)((0,I.Cl)({},tN(e).actions),{resetState:function(){return e(function(){return nb})},changeScreen:function(t){return e(function(){return{currentScreen:t}})},setLoading:function(t){return e(function(){return{loading:t}})}})})}),nH=f.memo(function(e){var t=e.changeFlowToRegistrationByEmailAndCode,n=e.changeFlowToAddEmailOrPhone,r=e.changeFlowToLoginByEmailAndPass,o=(0,I.Tt)(e,["changeFlowToRegistrationByEmailAndCode","changeFlowToAddEmailOrPhone","changeFlowToLoginByEmailAndPass"]),i=t2(),s=eD()[eH].resetPassByEmail,c=(0,Q.Pj)(nw),a=c.currentScreen,l=c.email,u=c.code,d=c.password,h=c.errors,_=c.loading,E=c.timer,C=c.submitCount,g=e5(i.availableLoginMethods),A=(0,f.useCallback)(function(){s.submitLoginScreenForm()},[s]),m=(0,f.useCallback)(function(e){s.setField({name:"email",value:e})},[s]),T=(0,f.useCallback)(function(e){e.preventDefault(),s.sendCode()},[s]),S=(0,f.useCallback)(function(e){s.setField({name:"code",value:e})},[s]),O=(0,f.useCallback)(function(e){s.loginByOAuthClick(e,n)},[s,n]),p=(0,f.useCallback)(function(){r(),s.trackLoginByPasswordClick()},[r,s]),v=(0,f.useCallback)(function(){s.submitCheckCodeScreenFormToLogin(n)},[s,n]),y=(0,f.useCallback)(function(){s.submitCheckCodeScreenFormToReset()},[s]),N=(0,f.useCallback)(function(){s.submitSecurityErrorScreenForm()},[s]),L=(0,f.useCallback)(function(){s.submitResetScreenForm(n)},[s,n]),R=(0,f.useCallback)(function(e){s.setField({name:"password",value:e})},[s]),k=(0,f.useMemo)(function(){return{oauthItems:g,onOauthItemLoginClick:O,contact:l,errors:h,loading:"default"===_,submitCount:C,onContactChange:m,onSubmit:A,onLoginByPasswordClick:p}},[g,O,l,h,_,C,m,A,p]),b=(0,f.useMemo)(function(){return{contact:l,code:u,errors:h,timer:E,loading:"default"===_,loadingReset:"reset"===_,submitCount:C,onSubmit:v,onCodeChange:S,onSendCodeClick:T,onResetClick:y}},[l,u,h,E,_,C,v,S,T,y]),w=(0,f.useMemo)(function(){return{email:l,password:d,errors:h,loading:"reset"===_,submitCount:C,onSubmit:L,onPasswordChange:R}},[l,d,h,_,C,L,R]),H=(0,f.useMemo)(function(){return{onButtonClick:N}},[N]);return"oauth"===_?f.createElement(tB,null):f.createElement(nk,(0,I.Cl)({},o,{currentScreen:a,onErrorRegistrationLinkClick:t,loginScreen:k,checkCodeScreen:b,resetScreen:w,securityErrorScreen:H}))}),nF=function(){function e(e){this._authSdk=e.authSdk}return e.prototype.handle=function(){return(0,I.sH)(this,void 0,void 0,function(){return(0,I.YH)(this,function(e){switch(e.label){case 0:return[4,this._authSdk.getUser()];case 1:if(e.sent().securityLevel===O.a0.ANONYMOUS)return[2];if(!this._authSdk.isDelegatedDomain)return[3,3];return[4,this._authSdk.logoutByOauth()];case 2:return e.sent(),[3,5];case 3:return[4,this._authSdk.logout()];case 4:e.sent(),e.label=5;case 5:return[2]}})})},e}(),nU=function(e){function t(t){var n=e.call(this)||this,r=t.store;return n._storeActions=r.getState().actions,n._store=r,n}return(0,I.C6)(t,e),t.prototype._getState=function(){return this._store.getState()},t.prototype._createCommand=function(e){var t=e.flow,n=e.screen;return"".concat(t).concat(n?".".concat(n):"")},t.prototype._parseCommand=function(e){var t=e.split(".");return{flow:t[0],screen:t[1]}},Object.defineProperty(t.prototype,"canUndo",{get:function(){return this._getState().past.length>0},enumerable:!1,configurable:!0}),t.prototype.add=function(e){var t=this._createCommand(e);this._storeActions.add(t),this.emit(r.CHANGE)},t.prototype.getUndoCommand=function(){var e=this._getState(),t=e.past[e.past.length-1];return this._parseCommand(t)},t.prototype.undo=function(){this._storeActions.undo(),this.emit(r.CHANGE)},t.prototype.clear=function(){this._storeActions.clear(),this.emit(r.CHANGE)},t.prototype.clearAfter=function(e,t){var n=this._createCommand(e);this._storeActions.clearAfter({command:n,options:t}),this.emit(r.CHANGE)},t}(eB),nP={past:[]};nP.past=[];var nD=(0,$.y)()(function(e){return(0,I.Cl)((0,I.Cl)({},nP),{actions:{clearAfter:function(t){var n=t.command,r=t.options;e(function(e){var t=(r||{}).include,o=e.past.indexOf(n);return{past:e.past.slice(0,void 0!==t&&t?o:o+1)}})},clear:function(){return e((0,I.Cl)({},nP))},add:function(t){return e(function(e){return{past:(0,I.fX)((0,I.fX)([],(0,I.zs)(e.past),!1),[t],!1)}})},undo:function(){return e(function(e){return{past:e.past.slice(0,-1)}})}}})}),nM={currentFlow:ek,availableLoginMethods:[]},nG=function(){function e(e){var t,n=e.authSdk,r=e.userwayLogger;this.authSdk=n,this.userwayLogger=r,this.store=(t={availableLoginMethods:this.authSdk.getLoginAvailableMethods()},(0,$.y)()(function(e){var n;return(0,I.Cl)((0,I.Cl)({},nM),{availableLoginMethods:null!==(n=t.availableLoginMethods)&&void 0!==n?n:[],actions:{resetState:function(){return e(function(e){return(0,I.Cl)((0,I.Cl)({},e),{currentFlow:ek})})},changeFlow:function(t){return e(function(e){return(0,I.Cl)((0,I.Cl)({},e),{currentFlow:t})})}}})}));var o=new nF({authSdk:n}),i=new nU({store:nD}),s=new ni({store:nh,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),c=new ng({store:nT,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),a=new t9({store:nt,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),l=new tq({store:t4,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),u=new tc({store:tR,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),d=new tH({store:tP,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),h=new np({store:nw,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),_=new tG({store:tx,authSdk:this.authSdk,alreadyAuthenticatedResolver:o,historyController:i,userwayLogger:r}),E=new e4({store:this.store,authSdk:this.authSdk,historyController:i,flowControllers:{registrationByEmailAndCode:s,loginByEmailOrPhone:a,loginByEmailAndPass:l,resetPassByEmail:h,addEmailOrPhone:u,registrationByPhoneAndCode:c,addPhone:d,increaseSecurityLevel:_}});this[eH]={app:E,history:i,resetPassByEmail:h,registrationByEmailAndCode:s,loginByEmailOrPhone:a,loginByEmailAndPass:l,addEmailOrPhone:u,registrationByPhoneAndCode:c,addPhone:d,increaseSecurityLevel:_},this.on=this[eH].app.on.bind(this[eH].app),this.once=this[eH].app.once.bind(this[eH].app),this.off=this[eH].app.off.bind(this[eH].app)}return Object.defineProperty(e.prototype,"currentFlow",{get:function(){return this[eH].app.currentFlow},enumerable:!1,configurable:!0}),e.prototype.reset=function(){return this[eH].app.reset()},e.prototype.changeFlow=function(e,t){return this[eH].app.changeFlow(e,t)},e}(),nB={componentStack:null,error:null},nj=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=nB,t.resetErrorBoundary=function(){var e=t.props.onReset,n=t.state,r=n.error,o=n.componentStack;e&&e(r,o),t.setState(nB)},t}return(0,I.C6)(t,e),t.prototype.componentDidMount=function(){var e=this.props.onMount;e&&e()},t.prototype.componentDidCatch=function(e,t){var n=t.componentStack,r=this.props.onError;r&&n&&r(e,n),this.setState({error:e,componentStack:n})},t.prototype.componentWillUnmount=function(){var e=this.state,t=e.error,n=e.componentStack,r=this.props.onUnmount;r&&r(t,n)},t.prototype.render=function(){var e=this.props,t=e.fallback,n=e.children,r=this.state,o=r.error,i=r.componentStack;return o?f.isValidElement(t)?t:"function"==typeof t?t({error:o,componentStack:i,resetError:this.resetErrorBoundary}):null:n},t}(f.Component),nW=f.memo(function(){return f.createElement(td,null,f.createElement(j._,{alt:"cross icon",src:ei}))}),nY=function(e){var t=(0,S.OB)(function(e){return n(58273)("./".concat(e,"/index.json"))}),r=e.className,o=e.onButtonClick,i=e.text,s=(0,I.Tt)(e,["className","onButtonClick","text"]);return f.createElement("div",(0,I.Cl)({className:void 0===r?"":r},s),f.createElement(nW,null),f.createElement(L.P,null,null!=i?i:t("text")),!!o&&f.createElement(H.$n,{fullWidth:!0,color:"primary",onClick:o,autoFocus:!0,className:(0,k.S3)(450)},t("button")))},nx=f.memo(function(e){var t=e.currentFlow,n=e.changeFlowToLoginByEmailAndPass,r=e.changeFlowToRegistrationByEmailAndCode,o=e.changeFlowToResetPassByEmail,i=e.changeFlowToAddEmailOrPhone,s=e.changeFlowToLoginByEmailOrPhone,c=e.changeFlowToRegistrationByPhone,a=e.initialContact,l=e.className,u=e.isTutuWallet,d=void 0!==u&&u,h=(0,I.Tt)(e,["currentFlow","changeFlowToLoginByEmailAndPass","changeFlowToRegistrationByEmailAndCode","changeFlowToResetPassByEmail","changeFlowToAddEmailOrPhone","changeFlowToLoginByEmailOrPhone","changeFlowToRegistrationByPhone","initialContact","className","isTutuWallet"]);return f.createElement("div",(0,I.Cl)({className:void 0===l?"":l},(0,w.Ay)(tl.UI),h),t===eR.LOGIN_BY_EMAIL_AND_PASS?f.createElement(t3,{changeFlowToRegistrationByEmailAndCode:r,changeFlowToRegistrationByPhone:c,changeFlowToResetPassByEmail:o,changeFlowToAddEmailOrPhone:i,changeFlowToLoginByEmailOrPhone:s,isTutuWallet:d}):null,t===eR.REGISTRATION_BY_EMAIL_AND_CODE?f.createElement(n_,{changeFlowToLoginByEmailAndPass:n,changeFlowToAddEmailOrPhone:i,changeFlowToLoginByEmailOrPhone:s}):null,t===eR.REGISTRATION_BY_PHONE_AND_CODE?f.createElement(nf,{changeFlowToLoginByEmailOrPhone:s,changeFlowToLoginByEmailAndPass:n,changeFlowToAddEmailOrPhone:i}):null,t===eR.ADD_PHONE_FLOW?f.createElement(tD,{initialContact:a,changeFlowToLoginByEmailAndPass:n,changeFlowToRegistrationByEmailAndCode:r}):null,t===eR.RESET_PASS_BY_EMAIL?f.createElement(nH,{changeFlowToRegistrationByEmailAndCode:r,changeFlowToAddEmailOrPhone:i,changeFlowToLoginByEmailAndPass:n}):null,t===eR.ADD_EMAIL_OR_PHONE?f.createElement(tk,{changeFlowToLoginByEmailAndPass:n,changeFlowToRegistrationByEmailAndCode:r}):null,t===eR.LOGIN_BY_EMAIL_OR_PHONE?f.createElement(nn,{changeFlowToLoginByEmailAndPass:n,changeFlowToRegistrationByEmailAndCode:r,changeFlowToAddEmailOrPhone:i,isTutuWallet:d,changeFlowToRegistrationByPhone:c}):null,t===eR.INCREASE_SECURITY_LEVEL?f.createElement(tK,{changeFlowToRegistrationByEmailAndCode:r,changeFlowToAddEmailOrPhone:i}):null)}),nK=f.memo(function(e){var t=t2().currentFlow,n=eD()[eH].app,r=(0,f.useCallback)(function(e){n.changeFlow(eR.LOGIN_BY_EMAIL_AND_PASS,e)},[n]),o=(0,f.useCallback)(function(e){n.changeFlow(eR.REGISTRATION_BY_EMAIL_AND_CODE,e)},[n]),i=(0,f.useCallback)(function(){n.changeFlow(eR.RESET_PASS_BY_EMAIL)},[n]),s=(0,f.useCallback)(function(){n.changeFlow(eR.ADD_EMAIL_OR_PHONE,{withHistory:!0})},[n]),c=(0,f.useCallback)(function(){n.changeFlow(eR.LOGIN_BY_EMAIL_OR_PHONE)},[n]),a=(0,f.useCallback)(function(){n.changeFlow(eR.REGISTRATION_BY_PHONE_AND_CODE)},[n]);return f.createElement(nx,(0,I.Cl)({currentFlow:t,changeFlowToLoginByEmailAndPass:r,changeFlowToRegistrationByEmailAndCode:o,changeFlowToResetPassByEmail:i,changeFlowToAddEmailOrPhone:s,changeFlowToLoginByEmailOrPhone:c,changeFlowToRegistrationByPhone:a},e))}),nV=f.memo(function(e){var t=e.startFlow,n=e.userwayLogger,r=e.onChangeFlow,i=void 0===r?function(){}:r,s=(0,I.Tt)(e,["startFlow","userwayLogger","onChangeFlow"]),c=(0,eo.OX)(),a=(0,f.useContext)(es),l=null!=n?n:null==a?void 0:a.userwayLogger,u=(0,f.useCallback)(function(e){c.captureException(e,eF)},[c]),d=(0,f.useMemo)(function(){return f.createElement(nY,{onButtonClick:function(){null==l||l.send(O.pj.AUTHENTICATION_RELOAD_PAGE_CLICK),null==window||window.location.reload()}})},[l]),h=(0,f.useMemo)(function(){return null===a?new nG({authSdk:c,userwayLogger:l}):a},[c,a,l]);return eP(function(){if(void 0===t){h.reset();return}h.changeFlow(t)}),(0,f.useEffect)(function(){if(void 0===t){h.reset();return}h.changeFlow(t)},[t,h]),(0,f.useEffect)(function(){return h.on(o.CHANGE_FLOW,i)},[h,i]),f.createElement(nj,{fallback:d,onError:u},f.createElement(S.Kq,{value:"rus"},f.createElement(ec,{value:h},f.createElement(t0,{store:h.store},f.createElement(nK,(0,I.Cl)({},s))))))})}}]);
</script>

</body>
</html>
