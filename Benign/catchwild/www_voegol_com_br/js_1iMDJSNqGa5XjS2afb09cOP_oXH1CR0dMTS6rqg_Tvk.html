<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>js_1iMDJSNqGa5XjS2afb09cOP_oXH1CR0dMTS6rqg_Tvk.html</title>
</head>
<body>

<script>
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

Drupal.debounce = function (func, wait, immediate) {
  var timeout = void 0;
  var result = void 0;
  return function () {
    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var context = this;
    var later = function later() {
      timeout = null;
      if (!immediate) {
        result = func.apply(context, args);
      }
    };
    var callNow = immediate && !timeout;
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
    if (callNow) {
      result = func.apply(context, args);
    }
    return result;
  };
};;
!function(i,n,s){"use strict";function l(l,t){function e(i){if(g.find(".b-lazy:not(.b-loaded)").length){var s=g.find(i?".slide:not(.slick-cloned) .b-lazy:not(.b-loaded)":".slick-active .b-lazy:not(.b-loaded)");s.length||(s=g.find(".slick-cloned .b-lazy:not(.b-loaded)")),s.length&&n.blazy.init.load(s)}}function a(){b&&r(),y&&e(!1)}function o(n){var s=i(n),l=s.closest(".slide")||s.closest(".unslick");s.parentsUntil(l).removeClass(function(i,n){return(n.match(/(\S+)loading/g)||[]).join(" ")});var t=s.closest(".media--background");t.length&&t.find("> img").length&&(t.css("background-image","url("+s.attr("src")+")"),t.find("> img").remove(),t.removeAttr("data-lazy"))}function d(){g.children().sort(function(){return.5-Math.random()}).each(function(){g.append(this)})}function c(i){var n=i.slideCount<=i.options.slidesToShow,s=n||!1===i.options.arrows;if(g.attr("id")===i.$slider.attr("id")){i.options.centerPadding&&"0"!==i.options.centerPadding||i.$list.css("padding",""),n&&i.$slideTrack.width()<=i.$slider.width()&&i.$slideTrack.css({left:"",transform:""});var l=g.find(".b-loaded ~ .b-loader");l.length&&l.remove(),p[s?"addClass":"removeClass"]("visually-hidden")}}function r(){g.removeClass("is-paused"),g.find(".is-playing").length&&g.find(".is-playing").removeClass("is-playing").find(".media__icon--close").click()}function u(){g.addClass("is-paused").slick("slickPause")}function f(s){return _?{}:{slide:s.slide,lazyLoad:s.lazyLoad,dotsClass:s.dotsClass,rtl:s.rtl,prevArrow:i(".slick-prev",p),nextArrow:i(".slick-next",p),appendArrows:p,customPaging:function(i,l){var t=i.$slides.eq(l).find("[data-thumb]")||null,e='<img alt="'+n.t(t.find("img").attr("alt"))+'" src="'+t.data("thumb")+'">',a=t.length&&s.dotsClass.indexOf("thumbnail")>0?'<div class="slick-dots__thumbnail">'+e+"</div>":"",o=i.defaults.customPaging(i,l);return a?o.add(a):o}}}var k,g=i("> .slick__slider",t).length?i("> .slick__slider",t):i(t),p=i("> .slick__arrow",t),h=g.data("slick")?i.extend({},s.slick,g.data("slick")):i.extend({},s.slick),m=!("array"!==i.type(h.responsive)||!h.responsive.length)&&h.responsive,v=h.appendDots,y="blazy"===h.lazyLoad&&n.blazy,b=g.find(".media--player").length,_=g.hasClass("unslick");if(_||(h.appendDots=".slick__arrow"===v?p:v||i(g)),m)for(k in m)Object.prototype.hasOwnProperty.call(m,k)&&"unslick"!==m[k].settings&&(m[k].settings=i.extend({},s.slick,f(h),m[k].settings));g.data("slick",h),h=g.data("slick"),function(){h.randomize&&!g.hasClass("slick-initiliazed")&&d(),_||g.on("init.sl",function(s,l){".slick__arrow"===v&&i(l.$dots).insertAfter(l.$prevArrow);var t=g.find(".slick-cloned.slick-active .b-lazy:not(.b-loaded)");y&&t.length&&n.blazy.init.load(t)}),y?g.on("beforeChange.sl",function(){e(!0)}):i(".media",g).closest(".slide__content").addClass("is-loading"),g.on("setPosition.sl",function(i,n){c(n)})}(),g.slick(f(h)),function(){g.parent().on("click.sl",".slick-down",function(n){n.preventDefault();var s=i(this);i("html, body").stop().animate({scrollTop:i(s.data("target")).offset().top-(s.data("offset")||0)},800,"easeOutQuad"in i.easing&&h.easing?h.easing:"swing")}),h.mouseWheel&&g.on("mousewheel.sl",function(i,n){return i.preventDefault(),g.slick(n<0?"slickNext":"slickPrev")}),y||g.on("lazyLoaded lazyLoadError",function(i,n,s){o(s)}),g.on("afterChange.sl",a),b&&(g.on("click.sl",".media__icon--close",r),g.on("click.sl",".media__icon--play",u))}(),_&&g.slick("unslick"),i(t).addClass("slick--initialized")}n.behaviors.slick={attach:function(n){i(".slick",n).once("slick").each(l)}}}(jQuery,Drupal,drupalSettings);
;
window.matchMedia||(window.matchMedia=function(){"use strict";var e=window.styleMedia||window.media;if(!e){var t=document.createElement("style"),i=document.getElementsByTagName("script")[0],n=null;t.type="text/css";t.id="matchmediajs-test";i.parentNode.insertBefore(t,i);n="getComputedStyle"in window&&window.getComputedStyle(t,null)||t.currentStyle;e={matchMedium:function(e){var i="@media "+e+"{ #matchmediajs-test { width: 1px; } }";if(t.styleSheet){t.styleSheet.cssText=i}else{t.textContent=i}return n.width==="1px"}}}return function(t){return{matches:e.matchMedium(t||"all"),media:t||"all"}}}());
;
/**
 * @file
 * Carousel.
 *
 */
(function ($, Drupal) {
    'use strict';

    Drupal.behaviors.block_slick_carousel = {
      attach: function (context) {
        $(context).find('.block-content-reference-carrossel').once('custom-select-route').each(
          function() {
            if ($(this).find('.field--name-field-hc-img-desk').length == 0) {
              $(this).find('nav.slick__arrow').addClass('slider-arrow-new');
            }
          }
        );
      }
    }

    $( document ).ready(function() {
      if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
        var textSided = $('.field--name-field-hc-text-half-carousel');
        let filledCar = $('.carousel-filled');

        if(textSided){
          var item = $('.carousel-sided');
          var height = $(item[0]).closest('.slick__slide').height();
          var exchange = ((height - 200) / 2 ) * -1;
          $(item[0]).parents('.slick--field-hc-item').find('.slick-prev').css("margin-top", exchange);
          $(item[0]).parents('.slick--field-hc-item').find('.slick-next').css("margin-top", exchange);
        }
        if(window.matchMedia("(max-width: 767px)").matches){
          if(filledCar){
            $('.slick-prev').addClass('arrow-prev-filled');
            $('.slick-next').addClass('arrow-next-filled');
          }
        }
      }
    });

})(jQuery, Drupal);
;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal) {
  Drupal.theme.progressBar = function (id) {
    return '<div id="' + id + '" class="progress" aria-live="polite">' + '<div class="progress__label">&nbsp;</div>' + '<div class="progress__track"><div class="progress__bar"></div></div>' + '<div class="progress__percentage"></div>' + '<div class="progress__description">&nbsp;</div>' + '</div>';
  };

  Drupal.ProgressBar = function (id, updateCallback, method, errorCallback) {
    this.id = id;
    this.method = method || 'GET';
    this.updateCallback = updateCallback;
    this.errorCallback = errorCallback;

    this.element = $(Drupal.theme('progressBar', id));
  };

  $.extend(Drupal.ProgressBar.prototype, {
    setProgress: function setProgress(percentage, message, label) {
      if (percentage >= 0 && percentage <= 100) {
        $(this.element).find('div.progress__bar').css('width', percentage + '%');
        $(this.element).find('div.progress__percentage').html(percentage + '%');
      }
      $('div.progress__description', this.element).html(message);
      $('div.progress__label', this.element).html(label);
      if (this.updateCallback) {
        this.updateCallback(percentage, message, this);
      }
    },
    startMonitoring: function startMonitoring(uri, delay) {
      this.delay = delay;
      this.uri = uri;
      this.sendPing();
    },
    stopMonitoring: function stopMonitoring() {
      clearTimeout(this.timer);

      this.uri = null;
    },
    sendPing: function sendPing() {
      if (this.timer) {
        clearTimeout(this.timer);
      }
      if (this.uri) {
        var pb = this;

        var uri = this.uri;
        if (uri.indexOf('?') === -1) {
          uri += '?';
        } else {
          uri += '&';
        }
        uri += '_format=json';
        $.ajax({
          type: this.method,
          url: uri,
          data: '',
          dataType: 'json',
          success: function success(progress) {
            if (progress.status === 0) {
              pb.displayError(progress.data);
              return;
            }

            pb.setProgress(progress.percentage, progress.message, progress.label);

            pb.timer = setTimeout(function () {
              pb.sendPing();
            }, pb.delay);
          },
          error: function error(xmlhttp) {
            var e = new Drupal.AjaxError(xmlhttp, pb.uri);
            pb.displayError('<pre>' + e.message + '</pre>');
          }
        });
      }
    },
    displayError: function displayError(string) {
      var error = $('<div class="messages messages--error"></div>').html(string);
      $(this.element).before(error).hide();

      if (this.errorCallback) {
        this.errorCallback(this);
      }
    }
  });
})(jQuery, Drupal);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function (Drupal) {
  Drupal.behaviors.responsiveImageAJAX = {
    attach: function attach() {
      if (window.picturefill) {
        window.picturefill();
      }
    }
  };
})(Drupal);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/
function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

(function ($, window, Drupal, drupalSettings) {
  Drupal.behaviors.AJAX = {
    attach: function attach(context, settings) {
      function loadAjaxBehavior(base) {
        var elementSettings = settings.ajax[base];
        if (typeof elementSettings.selector === 'undefined') {
          elementSettings.selector = '#' + base;
        }
        $(elementSettings.selector).once('drupal-ajax').each(function () {
          elementSettings.element = this;
          elementSettings.base = base;
          Drupal.ajax(elementSettings);
        });
      }

      Object.keys(settings.ajax || {}).forEach(function (base) {
        return loadAjaxBehavior(base);
      });

      Drupal.ajax.bindAjaxLinks(document.body);

      $('.use-ajax-submit').once('ajax').each(function () {
        var elementSettings = {};

        elementSettings.url = $(this.form).attr('action');

        elementSettings.setClick = true;

        elementSettings.event = 'click';

        elementSettings.progress = { type: 'throbber' };
        elementSettings.base = $(this).attr('id');
        elementSettings.element = this;

        Drupal.ajax(elementSettings);
      });
    },
    detach: function detach(context, settings, trigger) {
      if (trigger === 'unload') {
        Drupal.ajax.expired().forEach(function (instance) {
          Drupal.ajax.instances[instance.instanceIndex] = null;
        });
      }
    }
  };

  Drupal.AjaxError = function (xmlhttp, uri, customMessage) {
    var statusCode = void 0;
    var statusText = void 0;
    var responseText = void 0;
    if (xmlhttp.status) {
      statusCode = '\n' + Drupal.t('An AJAX HTTP error occurred.') + '\n' + Drupal.t('HTTP Result Code: !status', {
        '!status': xmlhttp.status
      });
    } else {
      statusCode = '\n' + Drupal.t('An AJAX HTTP request terminated abnormally.');
    }
    statusCode += '\n' + Drupal.t('Debugging information follows.');
    var pathText = '\n' + Drupal.t('Path: !uri', { '!uri': uri });
    statusText = '';

    try {
      statusText = '\n' + Drupal.t('StatusText: !statusText', {
        '!statusText': $.trim(xmlhttp.statusText)
      });
    } catch (e) {}

    responseText = '';

    try {
      responseText = '\n' + Drupal.t('ResponseText: !responseText', {
        '!responseText': $.trim(xmlhttp.responseText)
      });
    } catch (e) {}

    responseText = responseText.replace(/<("[^"]*"|'[^']*'|[^'">])*>/gi, '');
    responseText = responseText.replace(/[\n]+\s+/g, '\n');

    var readyStateText = xmlhttp.status === 0 ? '\n' + Drupal.t('ReadyState: !readyState', {
      '!readyState': xmlhttp.readyState
    }) : '';

    customMessage = customMessage ? '\n' + Drupal.t('CustomMessage: !customMessage', {
      '!customMessage': customMessage
    }) : '';

    this.message = statusCode + pathText + statusText + customMessage + responseText + readyStateText;

    this.name = 'AjaxError';
  };

  Drupal.AjaxError.prototype = new Error();
  Drupal.AjaxError.prototype.constructor = Drupal.AjaxError;

  Drupal.ajax = function (settings) {
    if (arguments.length !== 1) {
      throw new Error('Drupal.ajax() function must be called with one configuration object only');
    }

    var base = settings.base || false;
    var element = settings.element || false;
    delete settings.base;
    delete settings.element;

    if (!settings.progress && !element) {
      settings.progress = false;
    }

    var ajax = new Drupal.Ajax(base, element, settings);
    ajax.instanceIndex = Drupal.ajax.instances.length;
    Drupal.ajax.instances.push(ajax);

    return ajax;
  };

  Drupal.ajax.instances = [];

  Drupal.ajax.expired = function () {
    return Drupal.ajax.instances.filter(function (instance) {
      return instance && instance.element !== false && !document.body.contains(instance.element);
    });
  };

  Drupal.ajax.bindAjaxLinks = function (element) {
    $(element).find('.use-ajax').once('ajax').each(function (i, ajaxLink) {
      var $linkElement = $(ajaxLink);

      var elementSettings = {
        progress: { type: 'throbber' },
        dialogType: $linkElement.data('dialog-type'),
        dialog: $linkElement.data('dialog-options'),
        dialogRenderer: $linkElement.data('dialog-renderer'),
        base: $linkElement.attr('id'),
        element: ajaxLink
      };
      var href = $linkElement.attr('href');

      if (href) {
        elementSettings.url = href;
        elementSettings.event = 'click';
      }
      Drupal.ajax(elementSettings);
    });
  };

  Drupal.Ajax = function (base, element, elementSettings) {
    var defaults = {
      event: element ? 'mousedown' : null,
      keypress: true,
      selector: base ? '#' + base : null,
      effect: 'none',
      speed: 'none',
      method: 'replaceWith',
      progress: {
        type: 'throbber',
        message: Drupal.t('Please wait...')
      },
      submit: {
        js: true
      }
    };

    $.extend(this, defaults, elementSettings);

    this.commands = new Drupal.AjaxCommands();

    this.instanceIndex = false;

    if (this.wrapper) {
      this.wrapper = '#' + this.wrapper;
    }

    this.element = element;

    this.element_settings = elementSettings;

    this.elementSettings = elementSettings;

    if (this.element && this.element.form) {
      this.$form = $(this.element.form);
    }

    if (!this.url) {
      var $element = $(this.element);
      if ($element.is('a')) {
        this.url = $element.attr('href');
      } else if (this.element && element.form) {
        this.url = this.$form.attr('action');
      }
    }

    var originalUrl = this.url;

    this.url = this.url.replace(/\/nojs(\/|$|\?|#)/, '/ajax$1');

    if (drupalSettings.ajaxTrustedUrl[originalUrl]) {
      drupalSettings.ajaxTrustedUrl[this.url] = true;
    }

    var ajax = this;

    ajax.options = {
      url: ajax.url,
      data: ajax.submit,
      beforeSerialize: function beforeSerialize(elementSettings, options) {
        return ajax.beforeSerialize(elementSettings, options);
      },
      beforeSubmit: function beforeSubmit(formValues, elementSettings, options) {
        ajax.ajaxing = true;
        return ajax.beforeSubmit(formValues, elementSettings, options);
      },
      beforeSend: function beforeSend(xmlhttprequest, options) {
        ajax.ajaxing = true;
        return ajax.beforeSend(xmlhttprequest, options);
      },
      success: function success(response, status, xmlhttprequest) {
        if (typeof response === 'string') {
          response = $.parseJSON(response);
        }

        if (response !== null && !drupalSettings.ajaxTrustedUrl[ajax.url]) {
          if (xmlhttprequest.getResponseHeader('X-Drupal-Ajax-Token') !== '1') {
            var customMessage = Drupal.t('The response failed verification so will not be processed.');
            return ajax.error(xmlhttprequest, ajax.url, customMessage);
          }
        }

        return ajax.success(response, status);
      },
      complete: function complete(xmlhttprequest, status) {
        ajax.ajaxing = false;
        if (status === 'error' || status === 'parsererror') {
          return ajax.error(xmlhttprequest, ajax.url);
        }
      },

      dataType: 'json',
      jsonp: false,
      type: 'POST'
    };

    if (elementSettings.dialog) {
      ajax.options.data.dialogOptions = elementSettings.dialog;
    }

    if (ajax.options.url.indexOf('?') === -1) {
      ajax.options.url += '?';
    } else {
      ajax.options.url += '&';
    }

    var wrapper = 'drupal_' + (elementSettings.dialogType || 'ajax');
    if (elementSettings.dialogRenderer) {
      wrapper += '.' + elementSettings.dialogRenderer;
    }
    ajax.options.url += Drupal.ajax.WRAPPER_FORMAT + '=' + wrapper;

    $(ajax.element).on(elementSettings.event, function (event) {
      if (!drupalSettings.ajaxTrustedUrl[ajax.url] && !Drupal.url.isLocal(ajax.url)) {
        throw new Error(Drupal.t('The callback URL is not local and not trusted: !url', {
          '!url': ajax.url
        }));
      }
      return ajax.eventResponse(this, event);
    });

    if (elementSettings.keypress) {
      $(ajax.element).on('keypress', function (event) {
        return ajax.keypressResponse(this, event);
      });
    }

    if (elementSettings.prevent) {
      $(ajax.element).on(elementSettings.prevent, false);
    }
  };

  Drupal.ajax.WRAPPER_FORMAT = '_wrapper_format';

  Drupal.Ajax.AJAX_REQUEST_PARAMETER = '_drupal_ajax';

  Drupal.Ajax.prototype.execute = function () {
    if (this.ajaxing) {
      return;
    }

    try {
      this.beforeSerialize(this.element, this.options);

      return $.ajax(this.options);
    } catch (e) {
      this.ajaxing = false;
      window.alert('An error occurred while attempting to process ' + this.options.url + ': ' + e.message);

      return $.Deferred().reject();
    }
  };

  Drupal.Ajax.prototype.keypressResponse = function (element, event) {
    var ajax = this;

    if (event.which === 13 || event.which === 32 && element.type !== 'text' && element.type !== 'textarea' && element.type !== 'tel' && element.type !== 'number') {
      event.preventDefault();
      event.stopPropagation();
      $(element).trigger(ajax.elementSettings.event);
    }
  };

  Drupal.Ajax.prototype.eventResponse = function (element, event) {
    event.preventDefault();
    event.stopPropagation();

    var ajax = this;

    if (ajax.ajaxing) {
      return;
    }

    try {
      if (ajax.$form) {
        if (ajax.setClick) {
          element.form.clk = element;
        }

        ajax.$form.ajaxSubmit(ajax.options);
      } else {
        ajax.beforeSerialize(ajax.element, ajax.options);
        $.ajax(ajax.options);
      }
    } catch (e) {
      ajax.ajaxing = false;
      window.alert('An error occurred while attempting to process ' + ajax.options.url + ': ' + e.message);
    }
  };

  Drupal.Ajax.prototype.beforeSerialize = function (element, options) {
    if (this.$form && document.body.contains(this.$form.get(0))) {
      var settings = this.settings || drupalSettings;
      Drupal.detachBehaviors(this.$form.get(0), settings, 'serialize');
    }

    options.data[Drupal.Ajax.AJAX_REQUEST_PARAMETER] = 1;

    var pageState = drupalSettings.ajaxPageState;
    options.data['ajax_page_state[theme]'] = pageState.theme;
    options.data['ajax_page_state[theme_token]'] = pageState.theme_token;
    options.data['ajax_page_state[libraries]'] = pageState.libraries;
  };

  Drupal.Ajax.prototype.beforeSubmit = function (formValues, element, options) {};

  Drupal.Ajax.prototype.beforeSend = function (xmlhttprequest, options) {
    if (this.$form) {
      options.extraData = options.extraData || {};

      options.extraData.ajax_iframe_upload = '1';

      var v = $.fieldValue(this.element);
      if (v !== null) {
        options.extraData[this.element.name] = v;
      }
    }

    $(this.element).prop('disabled', true);

    if (!this.progress || !this.progress.type) {
      return;
    }

    var progressIndicatorMethod = 'setProgressIndicator' + this.progress.type.slice(0, 1).toUpperCase() + this.progress.type.slice(1).toLowerCase();
    if (progressIndicatorMethod in this && typeof this[progressIndicatorMethod] === 'function') {
      this[progressIndicatorMethod].call(this);
    }
  };

  Drupal.theme.ajaxProgressThrobber = function (message) {
    var messageMarkup = typeof message === 'string' ? Drupal.theme('ajaxProgressMessage', message) : '';
    var throbber = '<div class="throbber">&nbsp;</div>';

    return '<div class="ajax-progress ajax-progress-throbber">' + throbber + messageMarkup + '</div>';
  };

  Drupal.theme.ajaxProgressIndicatorFullscreen = function () {
    return '<div class="ajax-progress ajax-progress-fullscreen">&nbsp;</div>';
  };

  Drupal.theme.ajaxProgressMessage = function (message) {
    return '<div class="message">' + message + '</div>';
  };

  Drupal.theme.ajaxProgressBar = function ($element) {
    return $('<div class="ajax-progress ajax-progress-bar"></div>').append($element);
  };

  Drupal.Ajax.prototype.setProgressIndicatorBar = function () {
    var progressBar = new Drupal.ProgressBar('ajax-progress-' + this.element.id, $.noop, this.progress.method, $.noop);
    if (this.progress.message) {
      progressBar.setProgress(-1, this.progress.message);
    }
    if (this.progress.url) {
      progressBar.startMonitoring(this.progress.url, this.progress.interval || 1500);
    }
    this.progress.element = $(Drupal.theme('ajaxProgressBar', progressBar.element));
    this.progress.object = progressBar;
    $(this.element).after(this.progress.element);
  };

  Drupal.Ajax.prototype.setProgressIndicatorThrobber = function () {
    this.progress.element = $(Drupal.theme('ajaxProgressThrobber', this.progress.message));
    $(this.element).after(this.progress.element);
  };

  Drupal.Ajax.prototype.setProgressIndicatorFullscreen = function () {
    this.progress.element = $(Drupal.theme('ajaxProgressIndicatorFullscreen'));
    $('body').append(this.progress.element);
  };

  Drupal.Ajax.prototype.success = function (response, status) {
    var _this = this;

    if (this.progress.element) {
      $(this.progress.element).remove();
    }
    if (this.progress.object) {
      this.progress.object.stopMonitoring();
    }
    $(this.element).prop('disabled', false);

    var elementParents = $(this.element).parents('[data-drupal-selector]').addBack().toArray();

    var focusChanged = false;
    Object.keys(response || {}).forEach(function (i) {
      if (response[i].command && _this.commands[response[i].command]) {
        _this.commands[response[i].command](_this, response[i], status);
        if (response[i].command === 'invoke' && response[i].method === 'focus') {
          focusChanged = true;
        }
      }
    });

    if (!focusChanged && this.element && !$(this.element).data('disable-refocus')) {
      var target = false;

      for (var n = elementParents.length - 1; !target && n >= 0; n--) {
        target = document.querySelector('[data-drupal-selector="' + elementParents[n].getAttribute('data-drupal-selector') + '"]');
      }

      if (target) {
        $(target).trigger('focus');
      }
    }

    if (this.$form && document.body.contains(this.$form.get(0))) {
      var settings = this.settings || drupalSettings;
      Drupal.attachBehaviors(this.$form.get(0), settings);
    }

    this.settings = null;
  };

  Drupal.Ajax.prototype.getEffect = function (response) {
    var type = response.effect || this.effect;
    var speed = response.speed || this.speed;

    var effect = {};
    if (type === 'none') {
      effect.showEffect = 'show';
      effect.hideEffect = 'hide';
      effect.showSpeed = '';
    } else if (type === 'fade') {
      effect.showEffect = 'fadeIn';
      effect.hideEffect = 'fadeOut';
      effect.showSpeed = speed;
    } else {
      effect.showEffect = type + 'Toggle';
      effect.hideEffect = type + 'Toggle';
      effect.showSpeed = speed;
    }

    return effect;
  };

  Drupal.Ajax.prototype.error = function (xmlhttprequest, uri, customMessage) {
    if (this.progress.element) {
      $(this.progress.element).remove();
    }
    if (this.progress.object) {
      this.progress.object.stopMonitoring();
    }

    $(this.wrapper).show();

    $(this.element).prop('disabled', false);

    if (this.$form && document.body.contains(this.$form.get(0))) {
      var settings = this.settings || drupalSettings;
      Drupal.attachBehaviors(this.$form.get(0), settings);
    }
    throw new Drupal.AjaxError(xmlhttprequest, uri, customMessage);
  };

  Drupal.theme.ajaxWrapperNewContent = function ($newContent, ajax, response) {
    return (response.effect || ajax.effect) !== 'none' && $newContent.filter(function (i) {
      return !($newContent[i].nodeName === '#comment' || $newContent[i].nodeName === '#text' && /^(\s|\n|\r)*$/.test($newContent[i].textContent));
    }).length > 1 ? Drupal.theme('ajaxWrapperMultipleRootElements', $newContent) : $newContent;
  };

  Drupal.theme.ajaxWrapperMultipleRootElements = function ($elements) {
    return $('<div></div>').append($elements);
  };

  Drupal.AjaxCommands = function () {};
  Drupal.AjaxCommands.prototype = {
    insert: function insert(ajax, response) {
      var $wrapper = response.selector ? $(response.selector) : $(ajax.wrapper);
      var method = response.method || ajax.method;
      var effect = ajax.getEffect(response);

      var settings = response.settings || ajax.settings || drupalSettings;

      var $newContent = $($.parseHTML(response.data, document, true));

      $newContent = Drupal.theme('ajaxWrapperNewContent', $newContent, ajax, response);

      switch (method) {
        case 'html':
        case 'replaceWith':
        case 'replaceAll':
        case 'empty':
        case 'remove':
          Drupal.detachBehaviors($wrapper.get(0), settings);
          break;
        default:
          break;
      }

      $wrapper[method]($newContent);

      if (effect.showEffect !== 'show') {
        $newContent.hide();
      }

      var $ajaxNewContent = $newContent.find('.ajax-new-content');
      if ($ajaxNewContent.length) {
        $ajaxNewContent.hide();
        $newContent.show();
        $ajaxNewContent[effect.showEffect](effect.showSpeed);
      } else if (effect.showEffect !== 'show') {
        $newContent[effect.showEffect](effect.showSpeed);
      }

      if ($newContent.parents('html').length) {
        $newContent.each(function (index, element) {
          if (element.nodeType === Node.ELEMENT_NODE) {
            Drupal.attachBehaviors(element, settings);
          }
        });
      }
    },
    remove: function remove(ajax, response, status) {
      var settings = response.settings || ajax.settings || drupalSettings;
      $(response.selector).each(function () {
        Drupal.detachBehaviors(this, settings);
      }).remove();
    },
    changed: function changed(ajax, response, status) {
      var $element = $(response.selector);
      if (!$element.hasClass('ajax-changed')) {
        $element.addClass('ajax-changed');
        if (response.asterisk) {
          $element.find(response.asterisk).append(' <abbr class="ajax-changed" title="' + Drupal.t('Changed') + '">*</abbr> ');
        }
      }
    },
    alert: function alert(ajax, response, status) {
      window.alert(response.text, response.title);
    },
    announce: function announce(ajax, response) {
      if (response.priority) {
        Drupal.announce(response.text, response.priority);
      } else {
        Drupal.announce(response.text);
      }
    },
    redirect: function redirect(ajax, response, status) {
      window.location = response.url;
    },
    css: function css(ajax, response, status) {
      $(response.selector).css(response.argument);
    },
    settings: function settings(ajax, response, status) {
      var ajaxSettings = drupalSettings.ajax;

      if (ajaxSettings) {
        Drupal.ajax.expired().forEach(function (instance) {

          if (instance.selector) {
            var selector = instance.selector.replace('#', '');
            if (selector in ajaxSettings) {
              delete ajaxSettings[selector];
            }
          }
        });
      }

      if (response.merge) {
        $.extend(true, drupalSettings, response.settings);
      } else {
        ajax.settings = response.settings;
      }
    },
    data: function data(ajax, response, status) {
      $(response.selector).data(response.name, response.value);
    },
    invoke: function invoke(ajax, response, status) {
      var $element = $(response.selector);
      $element[response.method].apply($element, _toConsumableArray(response.args));
    },
    restripe: function restripe(ajax, response, status) {
      $(response.selector).find('> tbody > tr:visible, > tr:visible').removeClass('odd even').filter(':even').addClass('odd').end().filter(':odd').addClass('even');
    },
    update_build_id: function update_build_id(ajax, response, status) {
      $('input[name="form_build_id"][value="' + response.old + '"]').val(response.new);
    },
    add_css: function add_css(ajax, response, status) {
      $('head').prepend(response.data);
    },
    message: function message(ajax, response) {
      var messages = new Drupal.Message(document.querySelector(response.messageWrapperQuerySelector));
      if (response.clearPrevious) {
        messages.clear();
      }
      messages.add(response.message, response.messageOptions);
    }
  };
})(jQuery, window, Drupal, drupalSettings);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, debounce) {
  var offsets = {
    top: 0,
    right: 0,
    bottom: 0,
    left: 0
  };

  function getRawOffset(el, edge) {
    var $el = $(el);
    var documentElement = document.documentElement;
    var displacement = 0;
    var horizontal = edge === 'left' || edge === 'right';

    var placement = $el.offset()[horizontal ? 'left' : 'top'];

    placement -= window['scroll' + (horizontal ? 'X' : 'Y')] || document.documentElement['scroll' + (horizontal ? 'Left' : 'Top')] || 0;

    switch (edge) {
      case 'top':
        displacement = placement + $el.outerHeight();
        break;

      case 'left':
        displacement = placement + $el.outerWidth();
        break;

      case 'bottom':
        displacement = documentElement.clientHeight - placement;
        break;

      case 'right':
        displacement = documentElement.clientWidth - placement;
        break;

      default:
        displacement = 0;
    }
    return displacement;
  }

  function calculateOffset(edge) {
    var edgeOffset = 0;
    var displacingElements = document.querySelectorAll('[data-offset-' + edge + ']');
    var n = displacingElements.length;
    for (var i = 0; i < n; i++) {
      var el = displacingElements[i];

      if (el.style.display === 'none') {
        continue;
      }

      var displacement = parseInt(el.getAttribute('data-offset-' + edge), 10);

      if (isNaN(displacement)) {
        displacement = getRawOffset(el, edge);
      }

      edgeOffset = Math.max(edgeOffset, displacement);
    }

    return edgeOffset;
  }

  function calculateOffsets() {
    return {
      top: calculateOffset('top'),
      right: calculateOffset('right'),
      bottom: calculateOffset('bottom'),
      left: calculateOffset('left')
    };
  }

  function displace(broadcast) {
    offsets = calculateOffsets();
    Drupal.displace.offsets = offsets;
    if (typeof broadcast === 'undefined' || broadcast) {
      $(document).trigger('drupalViewportOffsetChange', offsets);
    }
    return offsets;
  }

  Drupal.behaviors.drupalDisplace = {
    attach: function attach() {
      if (this.displaceProcessed) {
        return;
      }
      this.displaceProcessed = true;

      $(window).on('resize.drupalDisplace', debounce(displace, 200));
    }
  };

  Drupal.displace = displace;
  $.extend(Drupal.displace, {
    offsets: offsets,

    calculateOffset: calculateOffset
  });
})(jQuery, Drupal, Drupal.debounce);;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./form","./version"],a):a(jQuery)}(function(a){return a.ui.formResetMixin={_formResetHandler:function(){var b=a(this);setTimeout(function(){var c=b.data("ui-form-reset-instances");a.each(c,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var a=this.form.data("ui-form-reset-instances")||[];a.length||this.form.on("reset.ui-form-reset",this._formResetHandler),a.push(this),this.form.data("ui-form-reset-instances",a)}},_unbindFormResetHandler:function(){if(this.form.length){var b=this.form.data("ui-form-reset-instances");b.splice(a.inArray(this,b),1),b.length?this.form.data("ui-form-reset-instances",b):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}}});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","../escape-selector","../form-reset-mixin","../labels","../widget"],a):a(jQuery)}(function(a){return a.widget("ui.checkboxradio",[a.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var b,c,d=this,e=this._super()||{};return this._readType(),c=this.element.labels(),this.label=a(c[c.length-1]),this.label.length||a.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){d.originalLabel+=3===this.nodeType?a(this).text():this.outerHTML}),this.originalLabel&&(e.label=this.originalLabel),b=this.element[0].disabled,null!=b&&(e.disabled=b),e},_create:function(){var a=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),a&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var b=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===b&&/radio|checkbox/.test(this.type)||a.error("Can't create checkboxradio on element.nodeName="+b+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var b,c=this.element[0].name,d="input[name='"+a.ui.escapeSelector(c)+"']";return c?(b=this.form.length?a(this.form[0].elements).filter(d):a(d).filter(function(){return 0===a(this).form().length}),b.not(this.element)):a([])},_toggleClasses:function(){var b=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",b),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",b)._toggleClass(this.icon,null,"ui-icon-blank",!b),"radio"===this.type&&this._getRadioGroup().each(function(){var b=a(this).checkboxradio("instance");b&&b._removeClass(b.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(a,b){if("label"!==a||b)return this._super(a,b),"disabled"===a?(this._toggleClass(this.label,null,"ui-state-disabled",b),void(this.element[0].disabled=b)):void this.refresh()},_updateIcon:function(b){var c="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=a("<span>"),this.iconSpace=a("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(c+=b?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,b?"ui-icon-blank":"ui-icon-check")):c+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",c),b||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var a=this.label.contents().not(this.element[0]);this.icon&&(a=a.not(this.icon[0])),this.iconSpace&&(a=a.not(this.iconSpace[0])),a.remove(),this.label.append(this.options.label)},refresh:function(){var a=this.element[0].checked,b=this.element[0].disabled;this._updateIcon(a),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",a),null!==this.options.label&&this._updateLabel(),b!==this.options.disabled&&this._setOptions({disabled:b})}}]),a.ui.checkboxradio});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","../widget"],a):a(jQuery)}(function(a){var b=/ui-corner-([a-z]){2,6}/g;return a.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var b=this,c=[];a.each(this.options.items,function(d,e){var f,g={};if(e)return"controlgroupLabel"===d?(f=b.element.find(e),f.each(function(){var b=a(this);b.children(".ui-controlgroup-label-contents").length||b.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),b._addClass(f,null,"ui-widget ui-widget-content ui-state-default"),void(c=c.concat(f.get()))):void(a.fn[d]&&(g=b["_"+d+"Options"]?b["_"+d+"Options"]("middle"):{classes:{}},b.element.find(e).each(function(){var e=a(this),f=e[d]("instance"),h=a.widget.extend({},g);if("button"!==d||!e.parent(".ui-spinner").length){f||(f=e[d]()[d]("instance")),f&&(h.classes=b._resolveClassesValues(h.classes,f)),e[d](h);var i=e[d]("widget");a.data(i[0],"ui-controlgroup-data",f?f:e[d]("instance")),c.push(i[0])}})))}),this.childWidgets=a(a.unique(c)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(b){this.childWidgets.each(function(){var c=a(this),d=c.data("ui-controlgroup-data");d&&d[b]&&d[b]()})},_updateCornerClass:function(a,b){var c="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",d=this._buildSimpleOptions(b,"label").classes.label;this._removeClass(a,null,c),this._addClass(a,null,d)},_buildSimpleOptions:function(a,b){var c="vertical"===this.options.direction,d={classes:{}};return d.classes[b]={middle:"",first:"ui-corner-"+(c?"top":"left"),last:"ui-corner-"+(c?"bottom":"right"),only:"ui-corner-all"}[a],d},_spinnerOptions:function(a){var b=this._buildSimpleOptions(a,"ui-spinner");return b.classes["ui-spinner-up"]="",b.classes["ui-spinner-down"]="",b},_buttonOptions:function(a){return this._buildSimpleOptions(a,"ui-button")},_checkboxradioOptions:function(a){return this._buildSimpleOptions(a,"ui-checkboxradio-label")},_selectmenuOptions:function(a){var b="vertical"===this.options.direction;return{width:!!b&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(b?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(b?"top":"left")},last:{"ui-selectmenu-button-open":b?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(b?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[a]}},_resolveClassesValues:function(c,d){var e={};return a.each(c,function(f){var g=d.options.classes[f]||"";g=a.trim(g.replace(b,"")),e[f]=(g+" "+c[f]).replace(/\s+/g," ")}),e},_setOption:function(a,b){return"direction"===a&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(a,b),"disabled"===a?void this._callChildMethod(b?"disable":"enable"):void this.refresh()},refresh:function(){var b,c=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),b=this.childWidgets,this.options.onlyVisible&&(b=b.filter(":visible")),b.length&&(a.each(["first","last"],function(a,d){var e=b[d]().data("ui-controlgroup-data");if(e&&c["_"+e.widgetName+"Options"]){var f=c["_"+e.widgetName+"Options"](1===b.length?"only":d);f.classes=c._resolveClassesValues(f.classes,e),e.element[e.widgetName](f)}else c._updateCornerClass(b[d](),d)}),this._callChildMethod("refresh"))}})});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./controlgroup","./checkboxradio","../keycode","../widget"],a):a(jQuery)}(function(a){return a.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var a,b=this._super()||{};return this.isInput=this.element.is("input"),a=this.element[0].disabled,null!=a&&(b.disabled=a),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(b.label=this.originalLabel),b},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(b){b.keyCode===a.ui.keyCode.SPACE&&(b.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(b,c){var d="iconPosition"!==b,e=d?this.options.iconPosition:c,f="top"===e||"bottom"===e;this.icon?d&&this._removeClass(this.icon,null,this.options.icon):(this.icon=a("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),d&&this._addClass(this.icon,null,c),this._attachIcon(e),f?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=a("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(e))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(a){this.icon[/^(?:end|bottom)/.test(a)?"before":"after"](this.iconSpace)},_attachIcon:function(a){this.element[/^(?:end|bottom)/.test(a)?"append":"prepend"](this.icon)},_setOptions:function(a){var b=void 0===a.showLabel?this.options.showLabel:a.showLabel,c=void 0===a.icon?this.options.icon:a.icon;b||c||(a.showLabel=!0),this._super(a)},_setOption:function(a,b){"icon"===a&&(b?this._updateIcon(a,b):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===a&&this._updateIcon(a,b),"showLabel"===a&&(this._toggleClass("ui-button-icon-only",null,!b),this._updateTooltip()),"label"===a&&(this.isInput?this.element.val(b):(this.element.html(b),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(a,b),"disabled"===a&&(this._toggleClass(null,"ui-state-disabled",b),this.element[0].disabled=b,b&&this.element.blur())},refresh:function(){var a=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");a!==this.options.disabled&&this._setOptions({disabled:a}),this._updateTooltip()}}),a.uiBackCompat!==!1&&(a.widget("ui.button",a.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(a,b){return"text"===a?void this._super("showLabel",b):("showLabel"===a&&(this.options.text=b),"icon"===a&&(this.options.icons.primary=b),"icons"===a&&(b.primary?(this._super("icon",b.primary),this._super("iconPosition","beginning")):b.secondary&&(this._super("icon",b.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),a.fn.button=function(b){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?b.apply(this,arguments):(a.ui.checkboxradio||a.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(a.fn.button),a.fn.buttonset=function(){return a.ui.controlgroup||a.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),a.ui.button});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","../ie","../version","../widget"],a):a(jQuery)}(function(a){var b=!1;return a(document).on("mouseup",function(){b=!1}),a.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.on("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).on("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f=!("string"!=typeof this.options.cancel||!c.target.nodeName)&&a(c.target).closest(this.options.cancel).length;return!(e&&!f&&this._mouseCapture(c))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0))}},_mouseMove:function(b){if(this._mouseMoved){if(a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button)return this._mouseUp(b);if(!b.which)if(b.originalEvent.altKey||b.originalEvent.ctrlKey||b.originalEvent.metaKey||b.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(b)}return(b.which||b.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(c){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,c.target===this._mouseDownEvent.target&&a.data(c.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(c)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,b=!1,c.preventDefault()},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./version"],a):a(jQuery)}(function(a){return a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./mouse","../data","../plugin","../safe-active-element","../safe-blur","../scroll-parent","../version","../widget"],a):a(jQuery)}(function(a){return a.widget("ui.draggable",a.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(a,b){this._super(a,b),"handle"===a&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(b){var c=this.options;return!(this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(b),!!this.handle&&(this._blurActiveElement(b),this._blockFrames(c.iframeFix===!0?"iframe":c.iframeFix),!0))},_blockFrames:function(b){this.iframeBlocks=this.document.find(b).map(function(){var b=a(this);return a("<div>").css("position","absolute").appendTo(b.parent()).outerWidth(b.outerWidth()).outerHeight(b.outerHeight()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(b){var c=a.ui.safeActiveElement(this.document[0]),d=a(b.target);d.closest(c).length||a.ui.safeBlur(c)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===a(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(b),this.originalPosition=this.position=this._generatePosition(b,!1),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_refreshOffsets:function(a){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:a.pageX-this.offset.left,top:a.pageY-this.offset.top}},_mouseDrag:function(b,c){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b,!0),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp(new a.Event("mouseup",b)),!1;this.position=d.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1},_mouseUp:function(b){return this._unblockFrames(),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),this.handleElement.is(b.target)&&this.element.trigger("focus"),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new a.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(b){return!this.options.handle||!!a(b.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper),e=d?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return e.parents("body").length||e.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d&&e[0]===this.element[0]&&this._setPositionRelative(),e[0]===this.element[0]||/(fixed|absolute)/.test(e.css("position"))||e.css("position","absolute"),e},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_isRootNode:function(a){return/(html|body)/i.test(a.tagName)||a===this.document[0]},_getParentOffset:function(){var b=this.offsetParent.offset(),c=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==c&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var a=this.element.position(),b=this._isRootNode(this.scrollParent[0]);return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+(b?0:this.scrollParent.scrollTop()),left:a.left-(parseInt(this.helper.css("left"),10)||0)+(b?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options,f=this.document[0];return this.relativeContainer=null,e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(f).width()-this.helperProportions.width-this.margins.left,(a(f).height()||f.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b=/(scroll|auto)/.test(c.css("overflow")),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=c))):void(this.containment=null)},_convertPositionTo:function(a,b){b||(b=this.position);var c="absolute"===a?1:-1,d=this._isRootNode(this.scrollParent[0]);return{top:b.top+this.offset.relative.top*c+this.offset.parent.top*c-("fixed"===this.cssPosition?-this.offset.scroll.top:d?0:this.offset.scroll.top)*c,left:b.left+this.offset.relative.left*c+this.offset.parent.left*c-("fixed"===this.cssPosition?-this.offset.scroll.left:d?0:this.offset.scroll.left)*c}},_generatePosition:function(a,b){var c,d,e,f,g=this.options,h=this._isRootNode(this.scrollParent[0]),i=a.pageX,j=a.pageY;return h&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),b&&(this.containment&&(this.relativeContainer?(d=this.relativeContainer.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,a.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),a.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),a.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),a.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f),"y"===g.axis&&(i=this.originalPageX),"x"===g.axis&&(j=this.originalPageY)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:h?0:this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:h?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d,this],!0),/^(drag|start|stop)/.test(b)&&(this.positionAbs=this._convertPositionTo("absolute"),d.offset=this.positionAbs),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c,d){var e=a.extend({},c,{item:d.element});d.sortables=[],a(d.options.connectToSortable).each(function(){var c=a(this).sortable("instance");c&&!c.options.disabled&&(d.sortables.push(c),c.refreshPositions(),c._trigger("activate",b,e))})},stop:function(b,c,d){var e=a.extend({},c,{item:d.element});d.cancelHelperRemoval=!1,a.each(d.sortables,function(){var a=this;a.isOver?(a.isOver=0,d.cancelHelperRemoval=!0,a.cancelHelperRemoval=!1,a._storedCSS={position:a.placeholder.css("position"),top:a.placeholder.css("top"),left:a.placeholder.css("left")},a._mouseStop(b),a.options.helper=a.options._helper):(a.cancelHelperRemoval=!0,a._trigger("deactivate",b,e))})},drag:function(b,c,d){a.each(d.sortables,function(){var e=!1,f=this;f.positionAbs=d.positionAbs,f.helperProportions=d.helperProportions,f.offset.click=d.offset.click,f._intersectsWith(f.containerCache)&&(e=!0,a.each(d.sortables,function(){return this.positionAbs=d.positionAbs,this.helperProportions=d.helperProportions,this.offset.click=d.offset.click,this!==f&&this._intersectsWith(this.containerCache)&&a.contains(f.element[0],this.element[0])&&(e=!1),e})),e?(f.isOver||(f.isOver=1,d._parent=c.helper.parent(),f.currentItem=c.helper.appendTo(f.element).data("ui-sortable-item",!0),f.options._helper=f.options.helper,f.options.helper=function(){return c.helper[0]},b.target=f.currentItem[0],f._mouseCapture(b,!0),f._mouseStart(b,!0,!0),f.offset.click.top=d.offset.click.top,f.offset.click.left=d.offset.click.left,f.offset.parent.left-=d.offset.parent.left-f.offset.parent.left,f.offset.parent.top-=d.offset.parent.top-f.offset.parent.top,d._trigger("toSortable",b),d.dropped=f.element,a.each(d.sortables,function(){this.refreshPositions()}),d.currentItem=d.element,f.fromOutside=d),f.currentItem&&(f._mouseDrag(b),c.position=f.position)):f.isOver&&(f.isOver=0,f.cancelHelperRemoval=!0,f.options._revert=f.options.revert,f.options.revert=!1,f._trigger("out",b,f._uiHash(f)),f._mouseStop(b,!0),f.options.revert=f.options._revert,f.options.helper=f.options._helper,f.placeholder&&f.placeholder.remove(),c.helper.appendTo(d._parent),d._refreshOffsets(b),c.position=d._generatePosition(b,!0),d._trigger("fromSortable",b),d.dropped=!1,a.each(d.sortables,function(){this.refreshPositions()}))})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c,d){var e=a("body"),f=d.options;e.css("cursor")&&(f._cursor=e.css("cursor")),e.css("cursor",f.cursor)},stop:function(b,c,d){var e=d.options;e._cursor&&a("body").css("cursor",e._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("opacity")&&(f._opacity=e.css("opacity")),e.css("opacity",f.opacity)},stop:function(b,c,d){var e=d.options;e._opacity&&a(c.helper).css("opacity",e._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(a,b,c){c.scrollParentNotHidden||(c.scrollParentNotHidden=c.helper.scrollParent(!1)),c.scrollParentNotHidden[0]!==c.document[0]&&"HTML"!==c.scrollParentNotHidden[0].tagName&&(c.overflowOffset=c.scrollParentNotHidden.offset())},drag:function(b,c,d){var e=d.options,f=!1,g=d.scrollParentNotHidden[0],h=d.document[0];g!==h&&"HTML"!==g.tagName?(e.axis&&"x"===e.axis||(d.overflowOffset.top+g.offsetHeight-b.pageY<e.scrollSensitivity?g.scrollTop=f=g.scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(g.scrollTop=f=g.scrollTop-e.scrollSpeed)),e.axis&&"y"===e.axis||(d.overflowOffset.left+g.offsetWidth-b.pageX<e.scrollSensitivity?g.scrollLeft=f=g.scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(g.scrollLeft=f=g.scrollLeft-e.scrollSpeed))):(e.axis&&"x"===e.axis||(b.pageY-a(h).scrollTop()<e.scrollSensitivity?f=a(h).scrollTop(a(h).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(h).scrollTop())<e.scrollSensitivity&&(f=a(h).scrollTop(a(h).scrollTop()+e.scrollSpeed))),e.axis&&"y"===e.axis||(b.pageX-a(h).scrollLeft()<e.scrollSensitivity?f=a(h).scrollLeft(a(h).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(h).scrollLeft())<e.scrollSensitivity&&(f=a(h).scrollLeft(a(h).scrollLeft()+e.scrollSpeed)))),f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c,d){var e=d.options;d.snapElements=[],a(e.snap.constructor!==String?e.snap.items||":data(ui-draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!==d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o=d.options,p=o.snapTolerance,q=c.offset.left,r=q+d.helperProportions.width,s=c.offset.top,t=s+d.helperProportions.height;for(m=d.snapElements.length-1;m>=0;m--)i=d.snapElements[m].left-d.margins.left,j=i+d.snapElements[m].width,k=d.snapElements[m].top-d.margins.top,l=k+d.snapElements[m].height,r<i-p||q>j+p||t<k-p||s>l+p||!a.contains(d.snapElements[m].item.ownerDocument,d.snapElements[m].item)?(d.snapElements[m].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=!1):("inner"!==o.snapMode&&(e=Math.abs(k-t)<=p,f=Math.abs(l-s)<=p,g=Math.abs(i-r)<=p,h=Math.abs(j-q)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k-d.helperProportions.height,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i-d.helperProportions.width}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j}).left)),n=e||f||g||h,"outer"!==o.snapMode&&(e=Math.abs(k-s)<=p,f=Math.abs(l-t)<=p,g=Math.abs(i-q)<=p,h=Math.abs(j-r)<=p,e&&(c.position.top=d._convertPositionTo("relative",{top:k,left:0}).top),f&&(c.position.top=d._convertPositionTo("relative",{top:l-d.helperProportions.height,left:0}).top),g&&(c.position.left=d._convertPositionTo("relative",{top:0,left:i}).left),h&&(c.position.left=d._convertPositionTo("relative",{top:0,left:j-d.helperProportions.width}).left)),!d.snapElements[m].snapping&&(e||f||g||h||n)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[m].item})),d.snapElements[m].snapping=e||f||g||h||n)}}),a.ui.plugin.add("draggable","stack",{start:function(b,c,d){var e,f=d.options,g=a.makeArray(a(f.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});g.length&&(e=parseInt(a(g[0]).css("zIndex"),10)||0,a(g).each(function(b){a(this).css("zIndex",e+b)}),this.css("zIndex",e+g.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c,d){var e=a(c.helper),f=d.options;e.css("zIndex")&&(f._zIndex=e.css("zIndex")),e.css("zIndex",f.zIndex)},stop:function(b,c,d){var e=d.options;e._zIndex&&a(c.helper).css("zIndex",e._zIndex)}}),a.ui.draggable});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./version"],a):a(jQuery)}(function(a){return function(){function b(a,b,c){return[parseFloat(a[0])*(l.test(a[0])?b/100:1),parseFloat(a[1])*(l.test(a[1])?c/100:1)]}function c(b,c){return parseInt(a.css(b,c),10)||0}function d(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}var e,f=Math.max,g=Math.abs,h=/left|center|right/,i=/top|center|bottom/,j=/[\+\-]\d+(\.[\d]+)?%?/,k=/^\w+/,l=/%$/,m=a.fn.position;a.position={scrollbarWidth:function(){if(void 0!==e)return e;var b,c,d=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),f=d.children()[0];return a("body").append(d),b=f.offsetWidth,d.css("overflow","scroll"),c=f.offsetWidth,b===c&&(c=d[0].clientWidth),d.remove(),e=b-c},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType,f=!d&&!e;return{element:c,isWindow:d,isDocument:e,offset:f?a(b).offset():{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:c.outerWidth(),height:c.outerHeight()}}},a.fn.position=function(e){if(!e||!e.of)return m.apply(this,arguments);e=a.extend({},e);var l,n,o,p,q,r,s=a(e.of),t=a.position.getWithinInfo(e.within),u=a.position.getScrollInfo(t),v=(e.collision||"flip").split(" "),w={};return r=d(s),s[0].preventDefault&&(e.at="left top"),n=r.width,o=r.height,p=r.offset,q=a.extend({},p),a.each(["my","at"],function(){var a,b,c=(e[this]||"").split(" ");1===c.length&&(c=h.test(c[0])?c.concat(["center"]):i.test(c[0])?["center"].concat(c):["center","center"]),c[0]=h.test(c[0])?c[0]:"center",c[1]=i.test(c[1])?c[1]:"center",a=j.exec(c[0]),b=j.exec(c[1]),w[this]=[a?a[0]:0,b?b[0]:0],e[this]=[k.exec(c[0])[0],k.exec(c[1])[0]]}),1===v.length&&(v[1]=v[0]),"right"===e.at[0]?q.left+=n:"center"===e.at[0]&&(q.left+=n/2),"bottom"===e.at[1]?q.top+=o:"center"===e.at[1]&&(q.top+=o/2),l=b(w.at,n,o),q.left+=l[0],q.top+=l[1],this.each(function(){var d,h,i=a(this),j=i.outerWidth(),k=i.outerHeight(),m=c(this,"marginLeft"),r=c(this,"marginTop"),x=j+m+c(this,"marginRight")+u.width,y=k+r+c(this,"marginBottom")+u.height,z=a.extend({},q),A=b(w.my,i.outerWidth(),i.outerHeight());"right"===e.my[0]?z.left-=j:"center"===e.my[0]&&(z.left-=j/2),"bottom"===e.my[1]?z.top-=k:"center"===e.my[1]&&(z.top-=k/2),z.left+=A[0],z.top+=A[1],d={marginLeft:m,marginTop:r},a.each(["left","top"],function(b,c){a.ui.position[v[b]]&&a.ui.position[v[b]][c](z,{targetWidth:n,targetHeight:o,elemWidth:j,elemHeight:k,collisionPosition:d,collisionWidth:x,collisionHeight:y,offset:[l[0]+A[0],l[1]+A[1]],my:e.my,at:e.at,within:t,elem:i})}),e.using&&(h=function(a){var b=p.left-z.left,c=b+n-j,d=p.top-z.top,h=d+o-k,l={target:{element:s,left:p.left,top:p.top,width:n,height:o},element:{element:i,left:z.left,top:z.top,width:j,height:k},horizontal:c<0?"left":b>0?"right":"center",vertical:h<0?"top":d>0?"bottom":"middle"};n<j&&g(b+c)<n&&(l.horizontal="center"),o<k&&g(d+h)<o&&(l.vertical="middle"),f(g(b),g(c))>f(g(d),g(h))?l.important="horizontal":l.important="vertical",e.using.call(this,a,l)}),i.offset(a.extend(z,{using:h}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,g=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-g-e;b.collisionWidth>g?i>0&&j<=0?(c=a.left+i+b.collisionWidth-g-e,a.left+=i-c):j>0&&i<=0?a.left=e:i>j?a.left=e+g-b.collisionWidth:a.left=e:i>0?a.left+=i:j>0?a.left-=j:a.left=f(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,g=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-g-e;b.collisionHeight>g?i>0&&j<=0?(c=a.top+i+b.collisionHeight-g-e,a.top+=i-c):j>0&&i<=0?a.top=e:i>j?a.top=e+g-b.collisionHeight:a.top=e:i>0?a.top+=i:j>0?a.top-=j:a.top=f(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,h=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-h-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];k<0?(c=a.left+m+n+o+b.collisionWidth-h-f,(c<0||c<g(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||g(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,h=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-h-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];k<0?(d=a.top+n+o+p+b.collisionHeight-h-f,(d<0||d<g(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,(c>0||g(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}}}(),a.ui.position});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./mouse","../disable-selection","../plugin","../version","../widget"],a):a(jQuery)}(function(a){return a.widget("ui.resizable",a.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(a){return parseFloat(a)||0},_isNumber:function(a){return!isNaN(parseFloat(a))},_hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0||(b[d]=1,e=b[d]>0,b[d]=0,e)},_create:function(){var b,c=this.options,d=this;this._addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!c.aspectRatio,aspectRatio:c.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:c.helper||c.ghost||c.animate?c.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,b={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(b),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(b),this._proportionallyResize()),this._setupHandles(),c.autoHide&&a(this.element).on("mouseenter",function(){c.disabled||(d._removeClass("ui-resizable-autohide"),d._handles.show())}).on("mouseleave",function(){c.disabled||d.resizing||(d._addClass("ui-resizable-autohide"),d._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_setOption:function(a,b){switch(this._super(a,b),a){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var b,c,d,e,f,g=this.options,h=this;if(this.handles=g.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=a(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),d=this.handles.split(","),this.handles={},c=0;c<d.length;c++)b=a.trim(d[c]),e="ui-resizable-"+b,f=a("<div>"),this._addClass(f,"ui-resizable-handle "+e),f.css({zIndex:g.zIndex}),this.handles[b]=".ui-resizable-"+b,this.element.append(f);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String?this.handles[c]=this.element.children(this.handles[c]).first().show():(this.handles[c].jquery||this.handles[c].nodeType)&&(this.handles[c]=a(this.handles[c]),this._on(this.handles[c],{mousedown:h._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),this._handles=this._handles.add(this.handles[c])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){h.resizing||(this.className&&(f=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),h.axis=f&&f[1]?f[1]:"se")}),g.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(b){var c,d,e,f=this.options,g=this.element;return this.resizing=!0,this._renderProxy(),c=this._num(this.helper.css("left")),d=this._num(this.helper.css("top")),f.containment&&(c+=a(f.containment).scrollLeft()||0,d+=a(f.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:c,top:d},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:g.width(),height:g.height()},this.originalSize=this._helper?{width:g.outerWidth(),height:g.outerHeight()}:{width:g.width(),height:g.height()},this.sizeDiff={width:g.outerWidth()-g.width(),height:g.outerHeight()-g.height()},this.originalPosition={left:c,top:d},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio="number"==typeof f.aspectRatio?f.aspectRatio:this.originalSize.width/this.originalSize.height||1,e=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===e?this.axis+"-resize":e),this._addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c,d,e=this.originalMousePosition,f=this.axis,g=b.pageX-e.left||0,h=b.pageY-e.top||0,i=this._change[f];return this._updatePrevProperties(),!!i&&(c=i.apply(this,[b,g,h]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),d=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(d)||(this._updatePrevProperties(),this._trigger("resize",b,this.ui()),this._applyChanges()),!1)},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&this._hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseFloat(k.element.css("left"))+(k.position.left-k.originalPosition.left)||null,i=parseFloat(k.element.css("top"))+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var a={};return this.position.top!==this.prevPosition.top&&(a.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(a.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(a.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(a.height=this.size.height+"px"),this.helper.css(a),a},_updateVirtualBoundaries:function(a){var b,c,d,e,f,g=this.options;f={minWidth:this._isNumber(g.minWidth)?g.minWidth:0,maxWidth:this._isNumber(g.maxWidth)?g.maxWidth:1/0,minHeight:this._isNumber(g.minHeight)?g.minHeight:0,maxHeight:this._isNumber(g.maxHeight)?g.maxHeight:1/0},(this._aspectRatio||a)&&(b=f.minHeight*this.aspectRatio,d=f.minWidth/this.aspectRatio,c=f.maxHeight*this.aspectRatio,e=f.maxWidth/this.aspectRatio,b>f.minWidth&&(f.minWidth=b),d>f.minHeight&&(f.minHeight=d),c<f.maxWidth&&(f.maxWidth=c),e<f.maxHeight&&(f.maxHeight=e)),this._vBoundaries=f},_updateCache:function(a){this.offset=this.helper.offset(),this._isNumber(a.left)&&(this.position.left=a.left),this._isNumber(a.top)&&(this.position.top=a.top),this._isNumber(a.height)&&(this.size.height=a.height),this._isNumber(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,c=this.size,d=this.axis;return this._isNumber(a.height)?a.width=a.height*this.aspectRatio:this._isNumber(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===d&&(a.left=b.left+(c.width-a.width),a.top=null),"nw"===d&&(a.top=b.top+(c.height-a.height),a.left=b.left+(c.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,c=this.axis,d=this._isNumber(a.width)&&b.maxWidth&&b.maxWidth<a.width,e=this._isNumber(a.height)&&b.maxHeight&&b.maxHeight<a.height,f=this._isNumber(a.width)&&b.minWidth&&b.minWidth>a.width,g=this._isNumber(a.height)&&b.minHeight&&b.minHeight>a.height,h=this.originalPosition.left+this.originalSize.width,i=this.originalPosition.top+this.originalSize.height,j=/sw|nw|w/.test(c),k=/nw|ne|n/.test(c);return f&&(a.width=b.minWidth),g&&(a.height=b.minHeight),d&&(a.width=b.maxWidth),e&&(a.height=b.maxHeight),f&&j&&(a.left=h-b.minWidth),d&&j&&(a.left=h-b.maxWidth),g&&k&&(a.top=i-b.minHeight),e&&k&&(a.top=i-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_getPaddingPlusBorderDimensions:function(a){for(var b=0,c=[],d=[a.css("borderTopWidth"),a.css("borderRightWidth"),a.css("borderBottomWidth"),a.css("borderLeftWidth")],e=[a.css("paddingTop"),a.css("paddingRight"),a.css("paddingBottom"),a.css("paddingLeft")];b<4;b++)c[b]=parseFloat(d[b])||0,c[b]+=parseFloat(e[b])||0;return{height:c[0]+c[2],width:c[1]+c[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a,b=0,c=this.helper||this.element;b<this._proportionallyResizeElements.length;b++)a=this._proportionallyResizeElements[b],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(a)),a.css({height:c.height()-this.outerDimensions.height||0,width:c.width()-this.outerDimensions.width||0})},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).resizable("instance"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&c._hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,k=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseFloat(c.element.css("width")),height:parseFloat(c.element.css("height")),top:parseFloat(c.element.css("top")),left:parseFloat(c.element.css("left"))};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var b,c,d,e,f,g,h,i=a(this).resizable("instance"),j=i.options,k=i.element,l=j.containment,m=l instanceof a?l.get(0):/parent/.test(l)?k.parent().get(0):l;m&&(i.containerElement=a(m),/document/.test(l)||l===document?(i.containerOffset={left:0,top:0},i.containerPosition={left:0,top:0},i.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(b=a(m),c=[],a(["Top","Right","Left","Bottom"]).each(function(a,d){c[a]=i._num(b.css("padding"+d))}),i.containerOffset=b.offset(),i.containerPosition=b.position(),i.containerSize={height:b.innerHeight()-c[3],width:b.innerWidth()-c[1]},d=i.containerOffset,e=i.containerSize.height,f=i.containerSize.width,g=i._hasScroll(m,"left")?m.scrollWidth:f,h=i._hasScroll(m)?m.scrollHeight:e,i.parentData={element:m,left:d.left,top:d.top,width:g,height:h}))},resize:function(b){var c,d,e,f,g=a(this).resizable("instance"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement,n=!0;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio,n=!1),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio,n=!1),g.position.top=g._helper?i.top:0),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f?(g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top):(g.offset.left=g.element.offset().left,g.offset.top=g.element.offset().top),c=Math.abs(g.sizeDiff.width+(g._helper?g.offset.left-l.left:g.offset.left-i.left)),d=Math.abs(g.sizeDiff.height+(g._helper?g.offset.top-l.top:g.offset.top-i.top)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio,n=!1)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio,n=!1)),n||(g.position.left=g.prevPosition.left,g.position.top=g.prevPosition.top,g.size.width=g.prevSize.width,g.size.height=g.prevSize.height)},stop:function(){var b=a(this).resizable("instance"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).resizable("instance"),c=b.options;a(c.alsoResize).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseFloat(b.width()),height:parseFloat(b.height()),left:parseFloat(b.css("left")),top:parseFloat(b.css("top"))})})},resize:function(b,c){var d=a(this).resizable("instance"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0};a(e.alsoResize).each(function(){var b=a(this),d=a(this).data("ui-resizable-alsoresize"),e={},f=b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(f,function(a,b){var c=(d[b]||0)+(h[b]||0);c&&c>=0&&(e[b]=c||null)}),b.css(e)})},stop:function(){a(this).removeData("ui-resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).resizable("instance"),c=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:c.height,width:c.width,margin:0,left:0,top:0}),b._addClass(b.ghost,"ui-resizable-ghost"),a.uiBackCompat!==!1&&"string"==typeof b.options.ghost&&b.ghost.addClass(this.options.ghost),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).resizable("instance");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).resizable("instance");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b,c=a(this).resizable("instance"),d=c.options,e=c.size,f=c.originalSize,g=c.originalPosition,h=c.axis,i="number"==typeof d.grid?[d.grid,d.grid]:d.grid,j=i[0]||1,k=i[1]||1,l=Math.round((e.width-f.width)/j)*j,m=Math.round((e.height-f.height)/k)*k,n=f.width+l,o=f.height+m,p=d.maxWidth&&d.maxWidth<n,q=d.maxHeight&&d.maxHeight<o,r=d.minWidth&&d.minWidth>n,s=d.minHeight&&d.minHeight>o;d.grid=i,r&&(n+=j),s&&(o+=k),p&&(n-=j),q&&(o-=k),/^(se|s|e)$/.test(h)?(c.size.width=n,c.size.height=o):/^(ne)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.top=g.top-m):/^(sw)$/.test(h)?(c.size.width=n,c.size.height=o,c.position.left=g.left-l):((o-k<=0||n-j<=0)&&(b=c._getPaddingPlusBorderDimensions(this)),o-k>0?(c.size.height=o,c.position.top=g.top-m):(o=k-b.height,c.size.height=o,c.position.top=g.top+f.height-o),n-j>0?(c.size.width=n,c.position.left=g.left-l):(n=j-b.width,c.size.width=n,c.position.left=g.left+f.width-n))}}),a.ui.resizable});;
/*! jQuery UI - v1.12.1 - 2017-03-31
* http://jqueryui.com
* Copyright jQuery Foundation and other contributors; Licensed  */
!function(a){"function"==typeof define&&define.amd?define(["jquery","./button","./draggable","./mouse","./resizable","../focusable","../keycode","../position","../safe-active-element","../safe-blur","../tabbable","../unique-id","../version","../widget"],a):a(jQuery)}(function(a){return a.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&a.fn.draggable&&this._makeDraggable(),this.options.resizable&&a.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var b=this.options.appendTo;return b&&(b.jquery||b.nodeType)?a(b):this.document.find(b||"body").eq(0)},_destroy:function(){var a,b=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),a=b.parent.children().eq(b.index),a.length&&a[0]!==this.element[0]?a.before(this.element):b.parent.append(this.element)},widget:function(){return this.uiDialog},disable:a.noop,enable:a.noop,close:function(b){var c=this;this._isOpen&&this._trigger("beforeClose",b)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||a.ui.safeBlur(a.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){c._trigger("close",b)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(b,c){var d=!1,e=this.uiDialog.siblings(".ui-front:visible").map(function(){return+a(this).css("z-index")}).get(),f=Math.max.apply(null,e);return f>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",f+1),d=!0),d&&!c&&this._trigger("focus",b),d},open:function(){var b=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=a(a.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){b._focusTabbable(),b._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var a=this._focusedElement;a||(a=this.element.find("[autofocus]")),a.length||(a=this.element.find(":tabbable")),a.length||(a=this.uiDialogButtonPane.find(":tabbable")),a.length||(a=this.uiDialogTitlebarClose.filter(":tabbable")),a.length||(a=this.uiDialog),a.eq(0).trigger("focus")},_keepFocus:function(b){function c(){var b=a.ui.safeActiveElement(this.document[0]),c=this.uiDialog[0]===b||a.contains(this.uiDialog[0],b);c||this._focusTabbable()}b.preventDefault(),c.call(this),this._delay(c)},_createWrapper:function(){this.uiDialog=a("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(b){if(this.options.closeOnEscape&&!b.isDefaultPrevented()&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE)return b.preventDefault(),void this.close(b);if(b.keyCode===a.ui.keyCode.TAB&&!b.isDefaultPrevented()){var c=this.uiDialog.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==this.uiDialog[0]||b.shiftKey?b.target!==d[0]&&b.target!==this.uiDialog[0]||!b.shiftKey||(this._delay(function(){e.trigger("focus")}),b.preventDefault()):(this._delay(function(){d.trigger("focus")}),b.preventDefault())}},mousedown:function(a){this._moveToTop(a)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var b;this.uiDialogTitlebar=a("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(b){a(b.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=a("<button type='button'></button>").button({label:a("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(a){a.preventDefault(),this.close(a)}}),b=a("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(b,"ui-dialog-title"),this._title(b),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":b.attr("id")})},_title:function(a){this.options.title?a.text(this.options.title):a.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=a("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=a("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var b=this,c=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),a.isEmptyObject(c)||a.isArray(c)&&!c.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(a.each(c,function(c,d){var e,f;d=a.isFunction(d)?{click:d,text:c}:d,d=a.extend({type:"button"},d),e=d.click,f={icon:d.icon,iconPosition:d.iconPosition,showLabel:d.showLabel,icons:d.icons,text:d.text},delete d.click,delete d.icon,delete d.iconPosition,delete d.showLabel,delete d.icons,"boolean"==typeof d.text&&delete d.text,a("<button></button>",d).button(f).appendTo(b.uiButtonSet).on("click",function(){e.apply(b.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function b(a){return{position:a.position,offset:a.offset}}var c=this,d=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,e){c._addClass(a(this),"ui-dialog-dragging"),c._blockFrames(),c._trigger("dragStart",d,b(e))},drag:function(a,d){c._trigger("drag",a,b(d))},stop:function(e,f){var g=f.offset.left-c.document.scrollLeft(),h=f.offset.top-c.document.scrollTop();d.position={my:"left top",at:"left"+(g>=0?"+":"")+g+" top"+(h>=0?"+":"")+h,of:c.window},c._removeClass(a(this),"ui-dialog-dragging"),c._unblockFrames(),c._trigger("dragStop",e,b(f))}})},_makeResizable:function(){function b(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}var c=this,d=this.options,e=d.resizable,f=this.uiDialog.css("position"),g="string"==typeof e?e:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:d.maxWidth,maxHeight:d.maxHeight,minWidth:d.minWidth,minHeight:this._minHeight(),handles:g,start:function(d,e){c._addClass(a(this),"ui-dialog-resizing"),c._blockFrames(),c._trigger("resizeStart",d,b(e))},resize:function(a,d){c._trigger("resize",a,b(d))},stop:function(e,f){var g=c.uiDialog.offset(),h=g.left-c.document.scrollLeft(),i=g.top-c.document.scrollTop();d.height=c.uiDialog.height(),d.width=c.uiDialog.width(),d.position={my:"left top",at:"left"+(h>=0?"+":"")+h+" top"+(i>=0?"+":"")+i,of:c.window},c._removeClass(a(this),"ui-dialog-resizing"),c._unblockFrames(),c._trigger("resizeStop",e,b(f))}}).css("position",f)},_trackFocus:function(){this._on(this.widget(),{focusin:function(b){this._makeFocusTarget(),this._focusedElement=a(b.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var b=this._trackingInstances(),c=a.inArray(this,b);c!==-1&&b.splice(c,1)},_trackingInstances:function(){var a=this.document.data("ui-dialog-instances");return a||(a=[],this.document.data("ui-dialog-instances",a)),a},_minHeight:function(){var a=this.options;return"auto"===a.height?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(){var a=this.uiDialog.is(":visible");a||this.uiDialog.show(),this.uiDialog.position(this.options.position),a||this.uiDialog.hide()},_setOptions:function(b){var c=this,d=!1,e={};a.each(b,function(a,b){c._setOption(a,b),a in c.sizeRelatedOptions&&(d=!0),a in c.resizableRelatedOptions&&(e[a]=b)}),d&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",e)},_setOption:function(b,c){var d,e,f=this.uiDialog;"disabled"!==b&&(this._super(b,c),"appendTo"===b&&this.uiDialog.appendTo(this._appendTo()),"buttons"===b&&this._createButtons(),"closeText"===b&&this.uiDialogTitlebarClose.button({label:a("<a>").text(""+this.options.closeText).html()}),"draggable"===b&&(d=f.is(":data(ui-draggable)"),d&&!c&&f.draggable("destroy"),!d&&c&&this._makeDraggable()),"position"===b&&this._position(),"resizable"===b&&(e=f.is(":data(ui-resizable)"),e&&!c&&f.resizable("destroy"),e&&"string"==typeof c&&f.resizable("option","handles",c),e||c===!1||this._makeResizable()),"title"===b&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var a,b,c,d=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),d.minWidth>d.width&&(d.width=d.minWidth),a=this.uiDialog.css({height:"auto",width:d.width}).outerHeight(),b=Math.max(0,d.minHeight-a),c="number"==typeof d.maxHeight?Math.max(0,d.maxHeight-a):"none","auto"===d.height?this.element.css({minHeight:b,maxHeight:c,height:"auto"}):this.element.height(Math.max(0,d.height-a)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var b=a(this);return a("<div>").css({position:"absolute",width:b.outerWidth(),height:b.outerHeight()}).appendTo(b.parent()).offset(b.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(b){return!!a(b.target).closest(".ui-dialog").length||!!a(b.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var b=!0;this._delay(function(){b=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(a){b||this._allowInteraction(a)||(a.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=a("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var a=this.document.data("ui-dialog-overlays")-1;a?this.document.data("ui-dialog-overlays",a):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),a.uiBackCompat!==!1&&a.widget("ui.dialog",a.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(a,b){"dialogClass"===a&&this.uiDialog.removeClass(this.options.dialogClass).addClass(b),this._superApply(arguments)}}),a.ui.dialog});;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, drupalSettings) {
  drupalSettings.dialog = {
    autoOpen: true,
    dialogClass: '',

    buttonClass: 'button',
    buttonPrimaryClass: 'button--primary',
    close: function close(event) {
      Drupal.dialog(event.target).close();
      Drupal.detachBehaviors(event.target, null, 'unload');
    }
  };

  Drupal.dialog = function (element, options) {
    var undef = void 0;
    var $element = $(element);
    var dialog = {
      open: false,
      returnValue: undef
    };

    function openDialog(settings) {
      settings = $.extend({}, drupalSettings.dialog, options, settings);

      $(window).trigger('dialog:beforecreate', [dialog, $element, settings]);
      $element.dialog(settings);
      dialog.open = true;
      $(window).trigger('dialog:aftercreate', [dialog, $element, settings]);
    }

    function closeDialog(value) {
      $(window).trigger('dialog:beforeclose', [dialog, $element]);
      $element.dialog('close');
      dialog.returnValue = value;
      dialog.open = false;
      $(window).trigger('dialog:afterclose', [dialog, $element]);
    }

    dialog.show = function () {
      openDialog({ modal: false });
    };
    dialog.showModal = function () {
      openDialog({ modal: true });
    };
    dialog.close = closeDialog;

    return dialog;
  };
})(jQuery, Drupal, drupalSettings);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, drupalSettings, debounce, displace) {
  drupalSettings.dialog = $.extend({ autoResize: true, maxHeight: '95%' }, drupalSettings.dialog);

  function resetPosition(options) {
    var offsets = displace.offsets;
    var left = offsets.left - offsets.right;
    var top = offsets.top - offsets.bottom;

    var leftString = (left > 0 ? '+' : '-') + Math.abs(Math.round(left / 2)) + 'px';
    var topString = (top > 0 ? '+' : '-') + Math.abs(Math.round(top / 2)) + 'px';
    options.position = {
      my: 'center' + (left !== 0 ? leftString : '') + ' center' + (top !== 0 ? topString : ''),
      of: window
    };
    return options;
  }

  function resetSize(event) {
    var positionOptions = ['width', 'height', 'minWidth', 'minHeight', 'maxHeight', 'maxWidth', 'position'];
    var adjustedOptions = {};
    var windowHeight = $(window).height();
    var option = void 0;
    var optionValue = void 0;
    var adjustedValue = void 0;
    for (var n = 0; n < positionOptions.length; n++) {
      option = positionOptions[n];
      optionValue = event.data.settings[option];
      if (optionValue) {
        if (typeof optionValue === 'string' && /%$/.test(optionValue) && /height/i.test(option)) {
          windowHeight -= displace.offsets.top + displace.offsets.bottom;
          adjustedValue = parseInt(0.01 * parseInt(optionValue, 10) * windowHeight, 10);

          if (option === 'height' && event.data.$element.parent().outerHeight() < adjustedValue) {
            adjustedValue = 'auto';
          }
          adjustedOptions[option] = adjustedValue;
        }
      }
    }

    if (!event.data.settings.modal) {
      adjustedOptions = resetPosition(adjustedOptions);
    }
    event.data.$element.dialog('option', adjustedOptions).trigger('dialogContentResize');
  }

  $(window).on({
    'dialog:aftercreate': function dialogAftercreate(event, dialog, $element, settings) {
      var autoResize = debounce(resetSize, 20);
      var eventData = { settings: settings, $element: $element };
      if (settings.autoResize === true || settings.autoResize === 'true') {
        $element.dialog('option', { resizable: false, draggable: false }).dialog('widget').css('position', 'fixed');
        $(window).on('resize.dialogResize scroll.dialogResize', eventData, autoResize).trigger('resize.dialogResize');
        $(document).on('drupalViewportOffsetChange.dialogResize', eventData, autoResize);
      }
    },
    'dialog:beforeclose': function dialogBeforeclose(event, dialog, $element) {
      $(window).off('.dialogResize');
      $(document).off('.dialogResize');
    }
  });
})(jQuery, Drupal, drupalSettings, Drupal.debounce, Drupal.displace);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($) {
  $.widget('ui.dialog', $.ui.dialog, {
    options: {
      buttonClass: 'button',
      buttonPrimaryClass: 'button--primary'
    },
    _createButtons: function _createButtons() {
      var opts = this.options;
      var primaryIndex = void 0;
      var index = void 0;
      var il = opts.buttons.length;
      for (index = 0; index < il; index++) {
        if (opts.buttons[index].primary && opts.buttons[index].primary === true) {
          primaryIndex = index;
          delete opts.buttons[index].primary;
          break;
        }
      }
      this._super();
      var $buttons = this.uiButtonSet.children().addClass(opts.buttonClass);
      if (typeof primaryIndex !== 'undefined') {
        $buttons.eq(index).addClass(opts.buttonPrimaryClass);
      }
    }
  });
})(jQuery);;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal) {
  Drupal.behaviors.dialog = {
    attach: function attach(context, settings) {
      var $context = $(context);

      if (!$('#drupal-modal').length) {
        $('<div id="drupal-modal" class="ui-front"></div>').hide().appendTo('body');
      }

      var $dialog = $context.closest('.ui-dialog-content');
      if ($dialog.length) {
        if ($dialog.dialog('option', 'drupalAutoButtons')) {
          $dialog.trigger('dialogButtonsChange');
        }

        $dialog.dialog('widget').trigger('focus');
      }

      var originalClose = settings.dialog.close;

      settings.dialog.close = function (event) {
        for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
          args[_key - 1] = arguments[_key];
        }

        originalClose.apply(settings.dialog, [event].concat(args));
        $(event.target).remove();
      };
    },
    prepareDialogButtons: function prepareDialogButtons($dialog) {
      var buttons = [];
      var $buttons = $dialog.find('.form-actions input[type=submit], .form-actions a.button');
      $buttons.each(function () {
        var $originalButton = $(this).css({ display: 'none' });
        buttons.push({
          text: $originalButton.html() || $originalButton.attr('value'),
          class: $originalButton.attr('class'),
          click: function click(e) {
            if ($originalButton.is('a')) {
              $originalButton[0].click();
            } else {
              $originalButton.trigger('mousedown').trigger('mouseup').trigger('click');
              e.preventDefault();
            }
          }
        });
      });
      return buttons;
    }
  };

  Drupal.AjaxCommands.prototype.openDialog = function (ajax, response, status) {
    if (!response.selector) {
      return false;
    }
    var $dialog = $(response.selector);
    if (!$dialog.length) {
      $dialog = $('<div id="' + response.selector.replace(/^#/, '') + '" class="ui-front"></div>').appendTo('body');
    }

    if (!ajax.wrapper) {
      ajax.wrapper = $dialog.attr('id');
    }

    response.command = 'insert';
    response.method = 'html';
    ajax.commands.insert(ajax, response, status);

    if (!response.dialogOptions.buttons) {
      response.dialogOptions.drupalAutoButtons = true;
      response.dialogOptions.buttons = Drupal.behaviors.dialog.prepareDialogButtons($dialog);
    }

    $dialog.on('dialogButtonsChange', function () {
      var buttons = Drupal.behaviors.dialog.prepareDialogButtons($dialog);
      $dialog.dialog('option', 'buttons', buttons);
    });

    response.dialogOptions = response.dialogOptions || {};
    var dialog = Drupal.dialog($dialog.get(0), response.dialogOptions);
    if (response.dialogOptions.modal) {
      dialog.showModal();
    } else {
      dialog.show();
    }

    $dialog.parent().find('.ui-dialog-buttonset').addClass('form-actions');
  };

  Drupal.AjaxCommands.prototype.closeDialog = function (ajax, response, status) {
    var $dialog = $(response.selector);
    if ($dialog.length) {
      Drupal.dialog($dialog.get(0)).close();
      if (!response.persist) {
        $dialog.remove();
      }
    }

    $dialog.off('dialogButtonsChange');
  };

  Drupal.AjaxCommands.prototype.setDialogOption = function (ajax, response, status) {
    var $dialog = $(response.selector);
    if ($dialog.length) {
      $dialog.dialog('option', response.optionName, response.optionValue);
    }
  };

  $(window).on('dialog:aftercreate', function (e, dialog, $element, settings) {
    $element.on('click.dialog', '.dialog-cancel', function (e) {
      dialog.close('cancel');
      e.preventDefault();
      e.stopPropagation();
    });
  });

  $(window).on('dialog:beforeclose', function (e, dialog, $element) {
    $element.off('.dialog');
  });
})(jQuery, Drupal);;
//:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
//:::                                                                         :::
//:::  This routine calculates the distance between two points (given the     :::
//:::  latitude/longitude of those points). It is being used to calculate     :::
//:::  the distance between two locations using GeoDataSource (TM) prodducts  :::
//:::                                                                         :::
//:::  Definitions:                                                           :::
//:::    South latitudes are negative, east longitudes are positive           :::
//:::                                                                         :::
//:::  Passed to function:                                                    :::
//:::    lat1, lon1 = Latitude and Longitude of point 1 (in decimal degrees)  :::
//:::    lat2, lon2 = Latitude and Longitude of point 2 (in decimal degrees)  :::
//:::    unit = the unit you desire for results                               :::
//:::           where: 'M' is statute miles (default)                         :::
//:::                  'K' is kilometers                                      :::
//:::                  'N' is nautical miles                                  :::
//:::                                                                         :::
//:::  Worldwide cities and other features databases with latitude longitude  :::
//:::  are available at https://www.geodatasource.com                         :::
//:::                                                                         :::
//:::  For enquiries, please contact sales@geodatasource.com                  :::
//:::                                                                         :::
//:::  Official Web site: https://www.geodatasource.com                       :::
//:::                                                                         :::
//:::               GeoDataSource.com (C) All Rights Reserved 2018            :::
//:::                                                                         :::
//:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

(function ($) {
   'use strict';

   $.fn.distance = function (lat1, lon1, lat2, lon2, unit) {
      if ((lat1 == lat2) && (lon1 == lon2)) {
         return 0;
      }
      else {
         var radlat1 = Math.PI * lat1/180;
         var radlat2 = Math.PI * lat2/180;
         var theta = lon1-lon2;
         var radtheta = Math.PI * theta/180;
         var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
         if (dist > 1) {
            dist = 1;
         }
         dist = Math.acos(dist);
         dist = dist * 180/Math.PI;
         dist = dist * 60 * 1.1515;
         if (unit=="K") { dist = dist * 1.609344 }
         if (unit=="N") { dist = dist * 0.8684 }
         return dist;
      }
   };

})(jQuery);
;
(function ($, Drupal, Backbone, drupalSettings, document) {
  /**
   * A select2 adapater combining SingleSelction view
   * and searchbox - replacing the view - when it needs to find and select another option
   */
  $.fn.select2.amd.define(
    "SearchableSingleSelection",
    [
      "select2/utils",
      "select2/selection/single",
      "select2/selection/eventRelay",
      "select2/dropdown/search",
    ],

    function (Utils, SingleSelection, EventRelay, DropdownSearch) {
      var adapter = Utils.Decorate(SingleSelection, DropdownSearch);
      adapter = Utils.Decorate(adapter, EventRelay);

      adapter.prototype.render = function () {
        var $rendered = DropdownSearch.prototype.render.call(
          this,
          SingleSelection.prototype.render
        );

        this.$searchContainer.hide();
        this.$element
          .siblings(".select2")
          .find(".selection")
          .prepend(this.$searchContainer);

        return $rendered;
      };

      var bindOrigin = adapter.prototype.bind;
      adapter.prototype.bind = function (container) {
        var self = this;

        bindOrigin.apply(this, arguments);

        container.on("open", function () {
          self.$selection.hide();
          self.$searchContainer.show();
        });

        container.on("close", function () {
          self.$searchContainer.hide();
          self.$selection.show();
        });
      };

      return adapter;
    }
  );

  /*
   * A select2 adapter to show simple dropdown list without a searchbox inside
   */
  $.fn.select2.amd.define(
    "UnsearchableDropdown",
    [
      "select2/utils",
      "select2/dropdown",
      "select2/dropdown/attachBody",
      "select2/dropdown/closeOnSelect",
    ],
    function (Utils, Dropdown, AttachBody, CloseOnSelect) {
      var adapter = Utils.Decorate(Dropdown, AttachBody);
      adapter = Utils.Decorate(adapter, CloseOnSelect);
      return adapter;
    }
  );

  ("use strict");

  $.extend({
    redirect: function (location, args) {
      if (args.openBookingSearch) {
        var bookingSearchUrl = new URL(drupalSettings.ticketSearch.default_url_booking_search);

        bookingSearchUrl.searchParams.set('iata', args.para);
        bookingSearchUrl.searchParams.set('group_adults', args.adult);
        bookingSearchUrl.searchParams.set('checkin', (args.departureDateYmd) ?? '');
        bookingSearchUrl.searchParams.set('checkout', (args.returnDateYmd) ?? '');

        // Remove parameters not used on B2C website.
        delete args.adult;
        delete args.departureDateYmd;
        delete args.returnDateYmd;
        delete args.openBookingSearch;

        // Open B2C website in new tab.
        $(
          "<a>", {
            'aria-hidden': true,
            class: 'hidden',
            href: location + '?' + new URLSearchParams(args).toString(),
            target: '_blank',
            title: Drupal.t('Flight search'),
          }
        ).appendTo('body')[0].click();

        // Create a form to open booking website on same tab.
        var bookingForm = $("<form>", {
          action: drupalSettings.ticketSearch.default_url_booking_search,
          class: 'hidden',
          method: 'get',
          title: $('label[for=booking_search]').text(),
        });

        bookingSearchUrl.searchParams.forEach((index, value) => {
          $(bookingForm).append(
            $("<input>", { name: value, value: index, type: "hidden"})
          );
        });

        $(bookingForm).appendTo('body').submit();

        return;
      }

      var form = $("<form>", { action: location, method: "get" });
      form.addClass("hidden");
      $.each(args, function (key, value) {
        $(form).append(
          $("<input>", { type: "hidden", name: key, value: value })
        );
      });
      $(form).appendTo("body").submit();
    },
  });

  /**
   * Define namespaces.
   */
  Drupal.ticketSearch = Drupal.ticketSearch || {
    views: {},
    models: {},
  };

  var SPACEBAR_KEY_CODE = [0, 32];
  var TAB_KEY_CODE = 9;
  var ENTER_KEY_CODE = 13;
  var ESC_KEY_CODE = 27;
  var LEFT_ARROW_KEY_CODE = 37;
  var UP_ARROW_KEY_CODE = 38;
  var RIGHT_ARROW_KEY_CODE = 39;
  var DOWN_ARROW_KEY_CODE = 40;
  var PAGE_UP_KEY_CODE = 33
  var PAGE_DOWN_KEY_CODE = 34;

  const BASE_URL = window.location.origin;
  const URL_FLIGHT_CALENDAR = '/api/flights/calendar';
  var initializationComplete = false;

  Drupal.ticketSearch.events = _.extend({}, Backbone.Events);

  Drupal.behaviors.ticketSearch = {
    startLat: null,
    startLon: null,
    views: {},
    attach: function (context) {
      var TicketSearchFormView = Backbone.View.extend({
        events: {
          "click a.airports-modal__anchor": "changeAirport",
          "click airports-modal__tabs-item a": "changeAirportType",
          "click #destiny-change": "changeDestiny",
          "focus #destiny-change": "clearFocus",
          "click #edit-fieldset-qnt-passengers button[name='remove_pass']":
            "removePassengers",
          "click #edit-fieldset-qnt-passengers button[name='add_pass']":
            "addPassengers",
          "click .airports-modal__action": "loadMoreAirports",
          "focus #edit-departure-date": "onFocusDepartureDate",
          "focus #edit-back-date": "onFocusBackDate",
          "click #open-calendar-departure-date, #open-calendar-back-date": "onClickToOpenCalendar",
          "focus #edit-departure-date-mobile": "onClickFieldsetDepartureDateMobile",
          "focus #edit-back-date-mobile": "onClickFieldsetBackDateMobile",
          "click .calendar__close-calendar, .close-calendar":
            "closeFullCalendar",
          "click #route-type-group": "onOpenRouteTypeClick",
          "keydown #route-type-group": "onOpenRouteTypeKeydown",
          "click .route__origin": "enableFieldsStateOne",
          "click .route__destiny": "enableFieldsStateOne",
          "click #edit-fieldset-route-type": "openRouteType",
          "click .form-check-label": "onFormCheckClick",
          "keydown #edit-fieldset-route-type": "openRouteTypeKeyboardEvents",
          "focus #edit-route-type": "openRouteType",
          "click body": "clearFocus",
          "click .airports-modal__bottom-close": "closeModal",
          "click .select2-selection__rendered": "onSearchFieldClick",
          "focus .select2-selection__rendered": "onSearchFieldFocus",
          "click #passengers-group": "onPassengersInputClick",
          "keydown #passengers-group": "onPassengersInputKeydown",
          "focus #passengers-group": "onPassengersInputFocus",
          "keydown .route__origin .select2-search__field":
            "onOriginSearchInputKeydown",
          "keydown .route__destiny .select2-search__field":
            "onDestinySearchInputKeydown",
          "keydown .bt-modal.origin": "onBtnModalOriginKeydown",
          "keydown .bt-modal.destiny": "onBtnModalDestinyKeydown",
          "keydown .switch__container.by-destiny": "onByDestinyKeydown",
          "keydown .switch__container.by-price": "onByPriceKeydown",
          "keydown #passengers-apply": "onPassengersApplyKeydown",
          "keydown #edit-departure-date": "onEditDepartureDateKeydown",
          "keydown #open-calendar-departure-date": "onKeydownOpenCalendarDeparture",
          "keydown #open-calendar-back-date": "onKeydownOpenCalendarBack",
          "keydown #edit-back-date": "onBackEditInputKeydown",
          "keydown #booking_search": "onBookingSearchKeydown",
          "keydown .apply-stopover": "onApplyStopoverKeydown",
          "keydown .show-promo-code-block": "onPromoCodeLinkKeydown",
          "keydown #destiny-change": "onDestinyChangeKeydown",
          "keydown .select2-selection": "onDestinyInputKeydown",
          "keydown #edit-destiny-until": "onDestinyUntilKeydown",
          "keydown .calendar__wrapper": "onDatepickerKeydown",
          "focus #edit-fieldset-until": "onFieldsetUntilFocus",
          "click #edit-fieldset-until": "onFieldsetUntilClick",
          "keydown #promo_code": "onPromoCodeKeydown",
          "click #edit-fieldset-departure-date": "onClickFieldsetDepartureDate",
          "click #edit-fieldset-back-date": "onClickFieldsetBackDate",
          "click #edit-fieldset-departure-date-mobile": "onClickFieldsetDepartureDateMobile",
          "click #edit-fieldset-back-date-mobile": "onClickFieldsetBackDateMobile",
          "keydown .airports-modal__anchor": "onAirportsModalAnchorKeydown",
          "click #add-route": "addRoute",
          "click .today-alert": "todayAlertAutoSubmit",
          "click .form-check-label-multiple-routes": "multipleRoutesClick",
        },

        initialize: function () {
          const geoSuccess = (position) => {
            if (!this.startLat && !this.startLon) {
              this.startLat = position.coords.latitude;
              this.startLon = position.coords.longitude;
              this.setGeolocatedSearch();
            }
          }

          navigator.geolocation.getCurrentPosition(geoSuccess);

          // Search by price is visible only in 'pt-br' language (desktop).
          this.activeSearchByPrice = true;
          if (
            drupalSettings.path.currentLanguage.toLowerCase() != "pt-br" ||
            drupalSettings.ticketSearch.isMobilePage === true
          ) {
            $(".route__actions.search-by-price-wrapper").remove();
            this.activeSearchByPrice = false;
          }

          if (drupalSettings.searchType == "voebiz") {
            $(".stop-over").hide();
            $(".promo-code").hide();
            $(".route__actions.search-by-price-wrapper").remove();
            this.activeSearchByPrice = false;
            $("input[name='passengers[kids]']").parent().remove();
            $("input[name='passengers[babies]']").parent().remove();
            $("#edit-fieldset-qnt-passengers .external-link").remove();
            $(".smiles-money").remove();
          }

          this.modal = null;
          this.currentField = null;
          this.multiTrecho = this.$("#multiple-route");
          this.buttonAddRoute = this.$("#add-route");
          this.form = this.$("form.ticket-search--form");
          this.$helper = Drupal.behaviors.Helpers;
          this.$availableDays = Drupal.behaviors.flightPrices;
          this.$dataLayer = Drupal.behaviors.flightPricesDataLayer;
          this.$scrollCalendar = Drupal.behaviors.general.scrollToAnchor;
          this.mainCalendar = this.$("#main-calendar");
          this.document = this.$el.closest(document);
          this.actionsContainer = this.$('.actions-container');
          this.inputSubmit = this.$("#ticket-search-submit");
          this.airportsGrouper =
            drupalSettings.ticketSearch.airports.grouper || [];
          this.destinyChange = this.$("#destiny-change");
          this.fieldsetRouteTypeOptions = this.$(
            "#edit-fieldset-route-type-options"
          );
          this.fieldsetQntPassengers = this.$("#edit-fieldset-qnt-passengers");
          this.inputEditPassengers = this.$("#edit-qnt-passengers");
          this.fieldsetBackDate = this.$("#edit-fieldset-back-date");
          this.disabledBackDate = this.$("#disabled-back-date");
          this.fieldsetDestiny = this.$("#edit-fieldset-destiny");
          this.fieldsetUntil = this.$("#edit-fieldset-until");
          this.fieldsetOrigin = this.$("#edit-fieldset-origin");
          this.fieldsetDestiny = this.$("#edit-fieldset-destiny");
          this.fieldsetDepartureDate = this.$("#edit-fieldset-departure-date");
          this.inputRouteType = this.$("#edit-route-type");
          this.inputRouteTypeVal = this.$("input[name=route_type_val]");

          // Elements displayed only in mobile version.
          this.mInputRouteType = this.$("#edit-route-type-mobile");
          this.mFieldsetDepartureDate = this.$("#edit-fieldset-departure-date-mobile");
          this.mFieldsetBackDate = this.$("#edit-fieldset-back-date-mobile");
          this.mInputDepartureDate = this.$("#edit-departure-date-mobile");
          this.mInputBackDate = this.$("#edit-back-date-mobile");
          this.modalCalendar = this.$('.modal-calendar');

          // Elements that will be disabled when smiles & money is set to true.
          this.disabledSmilesMoney = this.$(".disabled-while-smiles-money");
          this.inputPassengers = this.$("input[name=passengers]");
          this.inputPassengersAdults = this.$("input[name='passengers[adults]']");
          this.inputPassengersTeens = this.$("input[name='passengers[teens]']");
          this.inputPassengersKids = this.$("input[name='passengers[kids]']");
          this.inputPassengersBabies = this.$("input[name='passengers[babies]']");

          this.inputOrigin = this.$("#edit-origin");
          this.inputDestiny = this.$("#edit-destiny");
          this.inputDestinyUntil = this.$("#edit-destiny-until");
          this.inputSearchByPrice = this.$("#edit-search-by-price--first");
          this.inputSearchByPriceClone = this.$(
            "#edit-search-by-price--second"
          );
          this.inputDepartureDate = this.$("#edit-departure-date");
          this.inputBackDate = this.$("#edit-back-date");
          this.openCalendarDeparture = this.$('#open-calendar-departure-date');
          this.openCalendarBack = this.$('#open-calendar-back-date');
          this.fullCalendar = this.$(".calendar__wrapper");
          this.priceInput = $(".edit-destiny-until");
          this.applyStopover = $(".apply-stopover");
          this.availableDaysInMonth = [];
          this.flightPricesInMonth = [];
          this.minPriceOfMonth = [];
          this.isAvailableDaysSet = false;
          this.isFlightPriceSet = false;
          this.modelDefaults = this.model.defaults();

          this.promoCodeContent = $('.promo-code__content');
          this.fieldPrefix = $('.promo-code__content span.field-prefix');
          this.extraActions = $('.extra-actions');
          this.promoCode = $('input[name$="promo_code"]');
          this.removePromoCode = $('.hide-promo-code-block');

          this.bookingSearch = $('#booking_search');
          this.voebizChoicer = $('#voebizchoice');
          this.bookingSearchLabel = $('label[for=booking_search]');


          this.applyInputMask();
          this.applySelect2();
          this.applyDatepicker();
          this.eventListeners();

          this.fullCalendarState = {
            currentState: "INITIAL-DATE",
            current: {
              inputReference: null,
              date: null,
              month: null,
              year: null,
            },
            previous: {
              inputReference: null,
              date: null,
              month: null,
              year: null,
            },
            visibleYear: null,
            visibleMonth: null,
          };

          this.RouteList = new Drupal.ticketSearch.models.RouteListModel();
          this.listenTo(this.RouteList, "add", this.renderRoute);
          this.listenTo(this.RouteList, "destroy", this.destroyRoute);
          this.listenTo(this.RouteList, "all", this.updateModel);

          this.setDefaultValues();

          this.initializationComplete = true;
        },

        render: function () {},

        setNotAllowed: function (field) {
          field.closest('fieldset').closest('div').addClass('not-allowed');
          field.closest('fieldset').addClass('not-allowed-click');
        },

        setAriaExpandedFalse: function (departureDate = false, backDate = false) {
          this.openCalendarDeparture.attr("aria-expanded", departureDate);
          this.openCalendarBack.attr("aria-expanded", backDate);
        },

        setDefaultValues: function () {
          let drupalPromoCode = drupalSettings.ticketSearch.promocode,
              roundTripeOption = $("input[name='route_type_option'][value='RoundTrip']"),
              oneWayOption = $("input[name='route_type_option'][value='OneWay']"),
              defaultRouteTypeLabel = '',
              blockPassengersGroup = false,
              currentDate = new Date();

          var getDataRouteType = window.localStorage.getItem('route_type');
          var getDataOrigin = window.localStorage.getItem('origin');
          var getDataDestiny = window.localStorage.getItem('destiny');
          var getPassengers = JSON.parse(window.localStorage.getItem('ticketSearch'));

          if (drupalPromoCode.field_enable_promocode) {
            drupalSettings.ticketSearch.enableCalendarRequests = false;
            this.promoCodeContent.removeClass('hidden');
            this.removePromoCode.attr('hidden', 'hidden');
            this.extraActions.find('.promo-code').hide();

            if (drupalPromoCode.field_origin_airport) {
              this.inputOrigin.val(drupalPromoCode.field_origin_airport).change();
              this.setNotAllowed(this.inputOrigin);
              this.inputOrigin.attr('readonly', 'readonly');
              this.inputOrigin.attr("disabled", true);
            }

            if (drupalPromoCode.field_destination_airport) {
              this.inputDestiny.val(drupalPromoCode.field_destination_airport).change();
              this.setNotAllowed(this.inputDestiny);
              this.inputDestiny.attr('readonly', 'readonly');
              this.inputDestiny.attr("disabled", true);
            }

            this.destinyChange.attr('readonly', 'readonly');
            this.destinyChange.attr("disabled", true);

            if (drupalPromoCode.field_route_type) {
              if (drupalPromoCode.field_round_trip) {
                oneWayOption.prop("checked", false);
                roundTripeOption.prop("checked", true);
                this.inputRouteTypeVal.val("RoundTrip").trigger("change");
                defaultRouteTypeLabel = roundTripeOption.next("label");
              } else {
                roundTripeOption.prop("checked", false);
                oneWayOption.prop("checked", true);
                this.inputRouteTypeVal.val("Oneway").trigger("change");
                defaultRouteTypeLabel = oneWayOption.next("label");
              }

              this.setNotAllowed(this.inputRouteTypeVal);
              $("#route-type-group").attr('readonly', 'readonly');
              $("#route-type-group").attr('disabled', true);

              if (drupalPromoCode.field_departure_day) {
                let dataIda = drupalPromoCode.field_departure_day.split('-');
                dataIda[1] = parseInt(dataIda[1]) - 1;
                dataIda = new Date(dataIda[0], dataIda[1], dataIda[2]);
                dataIda = $.datepicker.formatDate("dd/mm/yy", dataIda);

                this.inputDepartureDate.val(dataIda).change();
                this.inputDepartureDate.attr('readonly', 'readonly');
                this.inputDepartureDate.attr("disabled", true);
                this.setNotAllowed(this.inputDepartureDate);
              }

              if (drupalPromoCode.field_date_back) {
                let dataVolta = drupalPromoCode.field_date_back.split('-');
                dataVolta[1] = parseInt(dataVolta[1]) - 1;
                dataVolta = new Date(dataVolta[0], dataVolta[1], dataVolta[2]);
                dataVolta = $.datepicker.formatDate("dd/mm/yy", dataVolta);

                this.inputBackDate.val(dataVolta).change();
                this.inputBackDate.attr('readonly', 'readonly');
                this.inputBackDate.attr("disabled", true);
                this.setNotAllowed(this.inputBackDate);
              }

              this.closeFullCalendar();
              this.clearFocus();
            } else {
              roundTripeOption.prop("checked", true);
              this.inputRouteTypeVal.val("RoundTrip").trigger("change");
              defaultRouteTypeLabel = roundTripeOption.next("label");
            }

            if (drupalPromoCode.field_promo_code) {
              this.promoCode.val(drupalPromoCode.field_promo_code);
              this.promoCode.attr('readonly', 'readonly');
              this.promoCode.attr("disabled", true);
              this.fieldPrefix.addClass('hidden');
              this.setNotAllowed(this.promoCode);
            }

            if (
              drupalPromoCode.field_adult_passanger_number ||
              drupalPromoCode.field_teen_passanger_number ||
              drupalPromoCode.field_infant_passanger_number ||
              drupalPromoCode.field_child_passanger_number
            ) {
              blockPassengersGroup = true;
            }

            if (drupalPromoCode.field_adult_passanger_number) {
              this.inputPassengersAdults.val(drupalPromoCode.field_adult_passanger_number);
              this.inputPassengersAdults.closest('div').find('.add-remove-pass .qnt').text(drupalPromoCode.field_adult_passanger_number);
            }

            if (drupalPromoCode.field_teen_passanger_number) {
              this.inputPassengersTeens.val(drupalPromoCode.field_teen_passanger_number);
              this.inputPassengersTeens.closest('div').find('.add-remove-pass .qnt').text(drupalPromoCode.field_teen_passanger_number);
            }

            if (drupalPromoCode.field_infant_passanger_number) {
              this.inputPassengersBabies.val(drupalPromoCode.field_infant_passanger_number);
              this.inputPassengersBabies.closest('div').find(".add-remove-pass .qnt").text(drupalPromoCode.field_infant_passanger_number);
            }

            if (drupalPromoCode.field_child_passanger_number) {
              this.inputPassengersKids.val(drupalPromoCode.field_child_passanger_number);
              this.inputPassengersKids.closest('div').find(".add-remove-pass .qnt").text(drupalPromoCode.field_child_passanger_number);
            }

            if (blockPassengersGroup) {
              this.setNotAllowed(this.inputPassengers);
              $("#passengers-group").attr('readonly', 'readonly');
              $("#passengers-group").attr('disabled', true);
            } else {
              this.inputPassengersAdults.val(1);
              this.inputPassengersAdults.closest('div').find('.add-remove-pass .qnt').text(1);
            }

          } else {
            roundTripeOption.prop("checked", true);
            this.inputRouteTypeVal.val("RoundTrip").trigger("change");
            defaultRouteTypeLabel = roundTripeOption.next("label");

            this.inputPassengersAdults.val(1);
            this.inputPassengersAdults.closest('div').find('.add-remove-pass .qnt').text(1);
          }

          this.setCalendarVisibleYearAndMonth(
            currentDate.getFullYear(),
            (currentDate.getMonth() + 1)
          );

          if (getDataOrigin) {
            this.inputOrigin.val(getDataOrigin);
            this.inputOrigin.change();
          }

          if (getDataDestiny) {
            this.inputDestiny.val(getDataDestiny);
            this.inputDestiny.change();
          }

          if (getDataRouteType !== null && getDataRouteType === "RoundTrip") {
            this.inputRouteTypeVal.val(getDataRouteType).trigger("change");
            defaultRouteTypeLabel = roundTripeOption.next("label");
            roundTripeOption.prop("checked", true);
            oneWayOption.prop("checked", false);
          }

          if (getDataRouteType !== null && getDataRouteType === "OneWay") {
            this.inputRouteTypeVal.val(getDataRouteType).trigger("change");
            defaultRouteTypeLabel = oneWayOption.next("label");
            roundTripeOption.prop("checked", false);
            oneWayOption.prop("checked", true);
          }

          if (getPassengers) {

            this.inputPassengersAdults.val(getPassengers.adults).change();
            this.inputPassengersAdults.closest('div').find('.add-remove-pass .qnt').text(getPassengers.adults);

            this.inputPassengersTeens.val(getPassengers.teens).change();
            this.inputPassengersTeens.closest('div').find('.add-remove-pass .qnt').text(getPassengers.teens);

            this.inputPassengersKids.val(getPassengers.kids).change();
            this.inputPassengersKids.closest('div').find('.add-remove-pass .qnt').text(getPassengers.kids);

            this.inputPassengersBabies.val(getPassengers.babies).change();
            this.inputPassengersBabies.closest('div').find('.add-remove-pass .qnt').text(getPassengers.babies);

          }

          this.inputRouteType.val(defaultRouteTypeLabel.text().trim());
          this.applyPassengers();
        },

        updateModel: function (e) {
          this.model.set("route_list", this.RouteList);
        },

        renderRoute: function (route) {
          var self = this;
          route.parent = {
            oppenAirportsModal: function (event) {
              self.oppenAirportsModal(event);
            },
            clearFocus: function (skips) {
              self.clearFocus(skips);
            },
            routeList: this.RouteList,
          };

          var view = new Drupal.ticketSearch.views.MultipleRoutes({
            model: route,
          });
          this.multiTrecho
            .find(".multiple-route--wrapper")
            .append(view.render().el);
          Drupal.ticketSearch.events.trigger("onRender", { cid: route.cid });
          if (this.RouteList.length >= 6) {
            this.buttonAddRoute.hide();
          } else {
            this.buttonAddRoute.show();
          }
        },

        addRoute: function (e) {
          e.preventDefault();
          var index = parseInt(this.RouteList.length) + 1;
          this.RouteList.add(
            new Drupal.ticketSearch.models.RouteModel({
              title: Drupal.t("Segment") + " " + index,
            })
          );
        },

        todayAlertAutoSubmit: function (e) {
          e.preventDefault();
          console.log($(".errors--list li").length);
          if ($(".errors--list li").length != 2) return;

          this.inputSubmit.click();
        },

        destroyRoute: function () {
          var self = this;
          this.multiTrecho.find(".multiple-route--wrapper").html("");
          this.RouteList.forEach(function (route, key) {
            var index = key + 1;
            route.set("title", Drupal.t("Segment") + " " + index);
            self.renderRoute(route);
          });
        },

        changeTextBookingSearch: function (iataCode = null) {
          if (!drupalSettings.ticketSearch.enableBookingSearch) {
            return;
          }

          if (
            !iataCode ||
            typeof drupalSettings.ticketSearch.airports.location[iataCode] != 'object'
          ) {
            this.bookingSearchLabel.find('strong').text(
              Drupal.t('Search Hotels Also')
            );

            return;
          }

          this.bookingSearchLabel.find('strong').text(
            Drupal.t('Find hotels in') + ' ' +
            drupalSettings.ticketSearch.airports.location[iataCode].city
          );
        },

        eventListeners: function () {
          var self = this;

          var fields = [
            {
              model_name: "route_type",
              name: "input[name=route_type_val]",
            },
            {
              model_name: "origin",
              name: "select[name=origin]",
            },
            {
              model_name: "destiny",
              name: "select[name=destiny]",
            },
            {
              model_name: "departure_date",
              name: "input[name=departure_date]",
            },
            {
              model_name: "back_date",
              name: "input[name=back_date]",
            },
            {
              model_name: "destiny_until",
              name: "input[name=destiny_until]",
            },
            {
              model_name: "use_smiles",
              name: "input[name='use_smiles']",
            },
            {
              model_name: "promo_code",
              name: "input[name='promo_code']",
            },
          ];

          _.each(fields, function (field) {
            self.model.set(field.model_name, self.$(field.name).val());
            self.$(field.name).on("change", function () {
              self.model.set(field.model_name, $(this).val());
            });
          });

          this.$("input[name=route_type_option]").attr("value", function () {
            if ($(this).val() === self.inputRouteTypeVal.val()) {
              $(this).prop("checked", true);
            }
            if (self.inputRouteTypeVal.val() === "OneWay") {
              self.fieldsetBackDate.fadeOut(160);
            }
          });

          this.$("input[name=route_type_option]").on("click", function (event) {
            self.setRouteType(event);
            self.inputRouteTypeVal.val($(this).val()).trigger("change");
          });

          this.$('input[name$="use_smiles"]').change(function () {
            if ($(this).val() == "true") {
              // CSS disabled state.
              self.disabledSmilesMoney.addClass("disabled");
              self.disabledSmilesMoney
                .next(".add-remove-pass")
                .find("button")
                .attr("disabled", "disabled");

              // Reset value and label.
              self.inputPassengersKids.val(0).trigger("change");
              $(self.inputPassengersKids)
                .closest(".form-item")
                .find(".add-remove-pass .qnt")
                .text(0);

              // Reset value and label.
              self.inputPassengersBabies.val(0).trigger("change");
              $(self.inputPassengersBabies)
                .closest(".form-item")
                .find(".add-remove-pass .qnt")
                .text(0);

              self.applyPassengers();

              return;
            }

            self.disabledSmilesMoney.removeClass("disabled");
            self.disabledSmilesMoney
              .next(".add-remove-pass")
              .find("button")
              .removeAttr("disabled", "disabled");
          });

          this.inputDepartureDate.on("click", function(event) {
            self.onClickToOpenCalendar(event);
          });

          this.inputBackDate.on("click", function(event) {
            self.onClickToOpenCalendar(event);
          });

          this.model.on("invalid", function (model, errors) {
            self.oppenModal({
              title: "",
              content: new Drupal.ticketSearch.views.Errors({
                model: errors
              }).el,
            });
          });

          this.model.on("change:loading_state", function() {
            self.$helper.setLoadingPricesOnCalendarDays(
              self.model.get('route_type'),
              self.model.get('loading_state')
            );

            self.displayLoadingPricesOnCalendarDays();

            self.refreshCalendar();
          });

          this.model.on("change:invalid_route", function() {
            validateRoute = self.model.isRouteInvalid();

            if (validateRoute.length > 0) {
              self.isAvailableDaysSet = false;

              self.oppenModal({
                title: "",
                content: new Drupal.ticketSearch.views.Errors({
                  model: validateRoute
                }).el,
              });

              self.closeFullCalendar();
              self.inputSubmit.attr('disabled', 'disabled');

              return;
            }

            self.inputSubmit.removeAttr('disabled');
          });

          this.model.on("change:available_days", function() {
            self.isAvailableDaysSet = true;

            self.setAvailableDaysInMonth(self.model.get('available_days'));

            self.refreshCalendar();
          });

          this.inputSubmit.on("click", function (e) {
            e.preventDefault();

            if (self.model.isValid()) {
              var form_values = self.$helper.getFormValues(
                self.normalizeModelValues(),
                drupalSettings.ticketSearch.type
              );

              self.submitForm(form_values);
            }
          });

          this.model.on("change:origin", function (model) {
            self.removeAllAvailableDaysInMonth();
            self.removeAllPricesInMonth();
            self.removeSelectedDates();
            self.model.set('invalid_route', self.modelDefaults.invalid_route);

            self.doCalendarRequestByRouteType();
          });

          this.model.on("change:destiny", function (model) {
            self.removeAllAvailableDaysInMonth();
            self.removeAllPricesInMonth();
            self.removeSelectedDates();
            self.model.set('invalid_route', self.modelDefaults.invalid_route);

            self.changeTextBookingSearch(self.model.get('destiny'));

            self.doCalendarRequestByRouteType();
          });

          this.model.on("change:route_type", function (model) {
            self.removeAllAvailableDaysInMonth();
            self.removeAllPricesInMonth();
            self.removeSelectedDates();
            self.inputBackDate.attr('readonly', 'readonly');

            self.form.removeClass("OneWay RoundTrip MultiTrecho");
            let searchByPrice = self.model.get("search_by_price");

            if (model.get("route_type") == "RoundTrip") {
              self.form.addClass("RoundTrip");
              self.disabledBackDate.hide();
              self.multiTrecho.hide();
              self.fieldsetBackDate.show();
              self.mFieldsetBackDate.parent().show();
              self.mInputDepartureDate.removeClass('text-center');
              if (!searchByPrice) self.fieldsetDestiny.show();
              self.fieldsetOrigin.show();
              self.fieldsetDepartureDate.show();

              // Enable calendar on back date innput.
              self.inputBackDate.datepicker("enable");

              self.doCalendarRequestByRouteType();
            } else if (model.get("route_type") == "MultiTrecho") {
              self.form.addClass("MultiTrecho");
              self.fieldsetBackDate.hide();
              self.fieldsetDestiny.hide();
              self.fieldsetUntil.hide();
              self.fieldsetOrigin.hide();
              self.fieldsetDepartureDate.hide();
              self.displayMultiTrecho();
            } else {
              self.form.addClass("OneWay");
              self.fieldsetBackDate.hide();
              self.mFieldsetBackDate.parent().hide();
              self.mInputDepartureDate.addClass('text-center');
              self.mInputBackDate.val('');
              self.inputBackDate.val('');
              self.multiTrecho.hide();

              self.disabledBackDate.show();
              if (!searchByPrice) self.fieldsetDestiny.show();
              self.fieldsetOrigin.show();
              self.fieldsetDepartureDate.show();

              // Reset back date value.
              self.inputBackDate.val("");
              self.inputBackDate.change();

              // Disable calendar on back date innput.
              self.inputBackDate.datepicker("disable");

              // Remove preset interval dates on calendar.
              $(".calendar")
                .find(".is-interval, .is-end-date")
                .removeClass(["is-interval", "is-end-date"]);

              $(".calendar")
                .find(".is-initial-date")
                .removeClass("is-initial-date")
                .addClass("is-oneway-selected-date");

              $(".calendar")
                .find(".ui-datepicker-current-day")
                .not(".ui-datepicker-today")
                .removeClass(["is-end-date", "ui-datepicker-current-day"]);

              // Clear available days set on back date.
              self.setAvailableDaysInMonth([], true);

              self.doCalendarRequestByRouteType();

              self.removeSelectedDates('current');
              self.disableTooltip();

              if (
                $(".calendar:visible").length &&
                self.fullCalendarState.currentState == "END-DATE"
              ) {
                self.fieldsetDepartureDate.trigger("click");
              }
            }
          });

          this.model.on("change:departure_date", function() {
            self.$dataLayer.setDataLayer(self.normalizeModelValues());

            if (self.model.get("departure_date")) {
              // Enable back date field.
              self.inputBackDate.removeAttr('readonly');

              let isRoundTrip = self.model.get("route_type").toLowerCase() != "oneway";

              if (isRoundTrip) {
                self.fullCalendarState.currentState = "END-DATE";

                self.doCalendarRequestByRouteType(
                  {}, {
                    'addOneMonth': false,
                    'forceRequest': ((isRoundTrip) ? true : false),
                  }
                );
              }

              // Calculate the date interval.
              self.countDaysRange();
              self.hideTooltips();
            }
          });

          this.model.on("change:back_date", function() {
            self.$dataLayer.setDataLayer(self.normalizeModelValues());
          });

          this.$("input[name=search_by_price]").on("change", function () {
            self.model.set("search_by_price", $(this).is(":checked"));
          });

          if (this.inputSearchByPrice.is(":checked")) {
            self.model.set("search_by_price", true);
            this.applySearchType();
          }

          this.model.on("change:search_by_price", function () {
            self.applySearchType();
          });

          this.$("#passengers-apply").on("click", function (e) {
            e.preventDefault();
            self.applyPassengers();

            // Hide the options elements.
            self.fieldsetQntPassengers.hide();
            self.inputEditPassengers.attr('aria-expanded', false);
          });

          // Show the options on focus at route type element.
          $(this.inputEditPassengers).on("focus", function (event) {
            // Add the focus classes.
            self.clearFocus();
            self.applyFocusStyle($(this));

            // Show the options elements.
          });

          this.$el.on("onupdateairport", function (event) {
            self.changeAirport(event);
          });

          $("body").on("click", function (event) {
            if ($(event.target).hasClass("form-search")) {
              return;
            }

            var shouldClear = true;

            if (
              $(event.target).parents(".ticket-search--form .container")
                .length > 0 ||
              $(event.target).hasClass("close-calendar") ||
              $(event.target).hasClass("show-promo-code-block")
            ) {
              shouldClear = false;
            }

            if (shouldClear) self.clearFocus(focus);

            if (
              event.target.id == "international-tab" ||
              event.target.id == "national-tab"
            ) {
              self.changeAirportType(event);
            }
          });
        },

        enableFieldsStateOne: function (event) {
          if ($(".state-one").hasClass("state-one__visible")) {
            return;
          }

          $(".state-one").addClass("state-one__visible");
        },

        openRouteType: function (event) {
          // Habilita os campos do "estado 1".
          this.enableFieldsStateOne();

          this.clearFocus({ routeTypeOptions: true });

          // Add the focus classes.
          this.applyFocusStyle(this.inputRouteType);
        },

        onOpenRouteTypeClick: function (event) {
          if (
            $(event.target).attr("id") === "edit-fieldset-route-type" ||
            $(event.target).attr("for") === "edit-route-type" ||
            event.target.id === "edit-route-type"
          ) {
            event.preventDefault();
            this.fieldsetRouteTypeOptions.toggle();
            this.inputRouteType.attr(
              'aria-expanded',
              this.fieldsetRouteTypeOptions.is(':visible')
            );
          }

          var $checkedRadio = this.fieldsetRouteTypeOptions.find(
            "input[type=radio]:checked"
          );

          if ($checkedRadio.length > 0) {
            $checkedRadio.focus();
          } else {
            this.fieldsetRouteTypeOptions
              .find(["input[type=radio"])
              .first()
              .focus();
          }
        },

        multipleRoutesClick: function (event) {
          $('.hidden .fake-radio-label').click()
          this.setDefaultValues();
        },

        onOpenRouteTypeKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              this.clearFocus();
              this.fieldsetRouteTypeOptions.hide();
              break;

            case ENTER_KEY_CODE:
              var $checkedRadio = this.fieldsetRouteTypeOptions.find(
                "input[type=radio]:checked"
              );

              if (
                $(event.target) &&
                this.fieldsetRouteTypeOptions.css("display") === "block"
              ) {
                $("#edit-fieldset-route-type").focus();
              }

              this.fieldsetRouteTypeOptions.toggle();

              if ($checkedRadio.length > 0) {
                $checkedRadio.focus();
              } else {
                this.fieldsetRouteTypeOptions
                  .find("input[type=radio")
                  .first()
                  .focus();
              }

              if (
                this.model.get("route_type").toLowerCase() == "multipleroutes"
              ) {
                this.multipleRoutesClick();
              };

              break;

            case ESC_KEY_CODE:
              this.fieldsetRouteTypeOptions.hide();
              break;

            default:
              break;
          }

          this.inputRouteType.attr(
            'aria-expanded',
            this.fieldsetRouteTypeOptions.is(':visible')
          );
        },

        onFormCheckClick: function (event) {
          this.fieldsetRouteTypeOptions.hide();

          this.inputRouteType.attr(
            'aria-expanded',
            this.fieldsetRouteTypeOptions.is(':visible')
          );
        },

        onPassengersInputClick: function (event) {
          if (
            event.target.id === "edit-fieldset-passengers" ||
            event.target.id === "edit-qnt-passengers" ||
            $(event.target).attr("for") === "edit-qnt-passengers"
          ) {
            this.clearFocus({ passengerInput: true });
            $("#edit-fieldset-qnt-passengers").toggle();
            this.inputEditPassengers.attr(
              'aria-expanded',
              !(this.inputEditPassengers.attr('aria-expanded') === 'true')
            );
            this.applyFocusStyle($(this.inputEditPassengers));
          }
        },

        onPassengersInputKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (event.shiftKey && event.target.id === "edit-qnt-passengers") {
                event.preventDefault();
                this.clearFocus();

                if ($("#edit-fieldset-until").css("display") === "block") {
                  $("#edit-destiny-until").focus();
                } else {
                  $("#edit-fieldset-destiny").trigger("focusin");
                  $(".route__destiny .select2-selection").focus();
                }
              } else {
                if (
                  $("#edit-fieldset-qnt-passengers").css("display") === "none"
                ) {
                  event.preventDefault();
                  $("#edit-departure-date").focus();
                }
              }
              break;

            case ENTER_KEY_CODE:
              if (
                event.target.id === "edit-qnt-passengers" ||
                event.target.id === "passengers-group"
              ) {
                $("#edit-fieldset-qnt-passengers").toggle();
              }
              break;

            case ESC_KEY_CODE:
              $("#edit-fieldset-qnt-passengers").hide();
              $(this.inputEditPassengers).focus();
            default:
              break;
          }
        },

        onBookingSearchKeydown: function (event) {
          if (event.keyCode != TAB_KEY_CODE || !event.shiftKey) {
            return;
          }

          event.preventDefault();
          this.clearFocus();

          if (event.shiftKey) {
            if (
              this.model.get("route_type").toLowerCase() == 'oneway' ||
              this.inputBackDate.attr('readonly')
            ) {
              $(this.openCalendarDeparture).focus();
              return;
            }

            $(this.openCalendarBack).focus();
            return;
          }

          $(this.applyStopover).focus();
        },

        onApplyStopoverKeydown: function (event) {
          if (event.keyCode != TAB_KEY_CODE || !event.shiftKey) {
            return;
          }

          event.preventDefault();
          this.clearFocus();

          if (this.isPromoCodeOpen()) {
            $(".hide-promo-code-block").focus();
            return;
          }

          this.focusBookingSearchIfActiveOrPrevious();
        },

        focusBookingSearchIfActiveOrPrevious: function() {
          if (drupalSettings.ticketSearch.enableBookingSearch) {
            $(this.bookingSearch).focus();

            return;
          }

          if (
            this.model.get("route_type").toLowerCase() == 'oneway' ||
            this.inputBackDate.attr('readonly')
          ) {
            $(this.openCalendarDeparture).focus();
            return;
          }

          $(this.openCalendarBack).focus();
          return;
        },

        focusBookingSearchIfActiveOrNext: function() {
          if (drupalSettings.ticketSearch.enableBookingSearch) {
            $(this.bookingSearch).focus();

            return;
          }

          if (!drupalSettings.ticketSearch.isMobilePage) {
            $(this.applyStopover).focus();

            return;
          }

          $('.show-promo-code-block').focus();
        },

        onPromoCodeLinkKeydown: function(event) {
          if (event.keyCode != TAB_KEY_CODE || !event.shiftKey) {
            return;
          }

          event.preventDefault();
          this.clearFocus();

          if (!event.shiftKey) {
            return;
          }

          if (!drupalSettings.ticketSearch.isMobilePage) {
            this.applyStopover.focus();
            return;
          }

          this.focusBookingSearchIfActiveOrPrevious();
        },

        onDestinyChangeKeydown: function (event) {
          event.preventDefault();

          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (event.shiftKey) {
                $(".route__origin fieldset").trigger("focusin");
                $(".route__origin .select2-selection").focus();
              } else {
                $("#edit-fieldset-destiny").trigger("focusin");
                $(".route__destiny .select2-selection").focus();
              }
              break;

            case ENTER_KEY_CODE:
              $("#destiny-change").trigger("click");
            default:
              break;
          }
        },

        onOriginSearchInputKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (event.shiftKey) {
                this.clearFocus();
                $("#edit-fieldset-route-type").focus();
              } else {
                $(".bt-modal.origin").focus();
              }
              break;
            default:
              break;
          }
        },

        onDestinySearchInputKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (event.shiftKey) {
                $("#destiny-change").focus();
              } else {
                $(".bt-modal.destiny").focus();
              }
              break;
            default:
              break;
          }
        },

        isPromoCodeOpen: function (event) {
          return !$(".promo-code__content").hasClass("hidden");
        },

        onEditDepartureDateKeydown: function (event) {
          if (event.keyCode == ESC_KEY_CODE) {
            this.closeFullCalendar();
            return;
          }

          if (event.keyCode != TAB_KEY_CODE) {
            return;
          }

          event.preventDefault();

          if (event.shiftKey) {
            $(this.inputEditPassengers).focus();
            return;
          }

          this.clearFocus();

          if (
            this.model.get("route_type").toLowerCase() == 'oneway' &&
            this.isPromoCodeOpen()
          ) {
            $("#promo_code").focus();
            return;
          }

          if ($('.calendar').is(':visible')) {
            this.fullCalendar
              .find("[data-handler='selectDay']")
              .find('a')
              .first()
              .focus();

            return;
          }

          this.closeFullCalendar();
          $(this.openCalendarDeparture).focus();
        },

        onKeydownOpenCalendarDeparture: function(event) {
          if (event.keyCode == ESC_KEY_CODE) {
            this.closeFullCalendar();
            return;
          }

          if (event.keyCode != TAB_KEY_CODE) {
            return;
          }

          event.preventDefault();

          if (event.shiftKey) {
            $(this.inputDepartureDate).focus();

            return;
          }

          this.closeFullCalendar();

          if (
            this.model.get("route_type").toLowerCase() !== 'oneway' &&
            !this.inputBackDate.attr('readonly')
          ) {
            $(this.inputBackDate).focus();
            return;
          }

          this.focusBookingSearchIfActiveOrNext();
        },

        onKeydownOpenCalendarBack: function(event) {
          if (event.keyCode == ESC_KEY_CODE) {
            this.closeFullCalendar();
            return;
          }

          if (event.keyCode != TAB_KEY_CODE) {
            return;
          }

          event.preventDefault();

          if (event.shiftKey) {
            $(this.inputBackDate).focus();

            return;
          }

          this.closeFullCalendar();

          this.focusBookingSearchIfActiveOrNext();
        },

        onDatepickerKeydown: function (event) {
          switch (event.keyCode) {
            case ESC_KEY_CODE:
              this.clearFocus();
              this.closeFullCalendar();

              if (this.fullCalendarState.currentState == "INITIAL-DATE") {
                $(this.inputDepartureDate).focus();
              } else {
                $(this.inputBackDate).focus();
              }

              break;
            case PAGE_UP_KEY_CODE:
              this.clearFocus();
              if (event.shiftKey) {
                $('.ui-datepicker-next').click();
                this.fullCalendar.find("[data-handler='selectDay']").find('a').first().focus();
              }
              break;
            case PAGE_DOWN_KEY_CODE:
              this.clearFocus();
              if (event.shiftKey) {
                $('.ui-datepicker-prev').click();
                this.fullCalendar.find("[data-handler='selectDay']").find('a').first().focus();
              }
              break;
            case ENTER_KEY_CODE:
              this.clearFocus();
              if (
                $("#edit-departure-date").val() ||
                $("#edit-fieldset-back-date").css("display") === "none"
              ) {
                this.closeFullCalendar();
              }
              break;
            default:
              break;
          }
        },

        onDestinyInputKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if ($(event.target).parents(".route__destiny").length > 0) {
                if (
                  !$(".route__destiny .select2-container").hasClass(
                    "select2-container--open"
                  )
                ) {
                  if (!event.shiftKey) {
                    event.preventDefault();
                    $(this.inputEditPassengers).focus();
                    $(this.inputEditPassengers).trigger("focus");
                  }
                }
              }

              break;
            default:
              break;
          }
        },

        clearFocus: function (skips) {
          var skips = $.extend({}, skips);
          var $allFocusedElements = $(this.form).find(".focus.focus-outline");
          var $allFocusedInputs = $(this.form).find(".focus");

          $allFocusedInputs.removeClass("focus");
          $allFocusedElements.removeClass("focus").removeClass("focus-outline");
          if (!skips.skipByPriceInput)
            $(".route__destiny .route__actions").hide();

          if (!skips.routeTypeOptions) {
            this.fieldsetRouteTypeOptions.hide();

            this.inputRouteType.attr(
              'aria-expanded',
              this.fieldsetRouteTypeOptions.is(':visible')
            );
          }

          if (!skips.passengerInput) {
            this.fieldsetQntPassengers.hide();
            this.inputEditPassengers.attr('aria-expanded', false);
          }

          //if (!skips.skipFullCalendar) this.closeFullCalendar();

          if (!skips.skipOriginInput) this.inputOrigin.select2("close");
          if (!skips.skipDestinyInput) this.inputDestiny.select2("close");
        },

        onBtnModalOriginKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (event.shiftKey) {
                event.preventDefault();
                $(".route__origin .select2-search__field").focus();
              }
              break;
            default:
              break;
          }
        },

        onBtnModalDestinyKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              event.preventDefault();

              if (
                drupalSettings.path.currentLanguage.toLowerCase() != "pt-br" ||
                drupalSettings.ticketSearch.isMobilePage === true
              ) {
                $(this.inputEditPassengers).focus();
                $(this.inputEditPassengers).trigger("focus");
              } else {
                $(".switch__container").focus();
              }

              if (event.shiftKey) {
                $(".route__destiny .select2-search__field").focus();
              }
              break;
            default:
              break;
          }
        },

        onByPriceKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              event.preventDefault();
              if (event.shiftKey) {
                $("#edit-destiny-until").focus();
              } else {
                $(this.inputEditPassengers).focus();
                $(this.inputEditPassengers).trigger("focus");
              }
              break;

            case ENTER_KEY_CODE:
              $("#edit-search-by-price--second").prop("checked", false);
              $("#edit-search-by-price--second").trigger("change");
              this.applySearchType();
              $("#edit-fieldset-destiny").trigger("focusin");
              $(".route__destiny .select2-search__field").focus();
              break;
          }
        },

        onByDestinyKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              event.preventDefault();
              if (event.shiftKey) {
                $(".bt-modal.destiny").focus();
              } else {
                $(this.inputEditPassengers).focus();
                $(this.inputEditPassengers).trigger("focus");
              }
              break;

            default:
              break;

            case ENTER_KEY_CODE:
              $("#edit-search-by-price--first")
                .prop("checked", true)
                .trigger("checked");
              this.applySearchType();
              setTimeout(function () {
                $("#edit-fieldset-destiny").trigger("focusin");
                $("#edit-destiny-until").focus();
              }, 0);
              break;
          }
        },

        onPassengersApplyKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              if (!event.shiftKey) {
                $("#edit-departure-date").focus();
                $("#edit-departure-date").trigger("focus");
              }
              break;

            case ENTER_KEY_CODE:
              this.applyPassengers();
              this.fieldsetQntPassengers.hide();
              this.inputEditPassengers.attr('aria-expanded', false);
              $("#passengers-group").focus();

            default:
              break;
          }
        },

        onBackEditInputKeydown: function (event) {
          if (event.keyCode == ESC_KEY_CODE) {
            this.closeFullCalendar();
            return;
          }

          if (event.keyCode != TAB_KEY_CODE) {
            return;
          }

          event.preventDefault();

          if (event.shiftKey) {
            this.clearFocus();
            $(this.openCalendarDeparture).focus();
            return;
          }

          if ($('.calendar').is(':visible')) {
            this.fullCalendar
              .find("[data-handler='selectDay']")
              .find('a')
              .first()
              .focus();

            return;
          }

          this.clearFocus();
          this.closeFullCalendar();

          if (this.isPromoCodeOpen()) {
            $("#promo_code").focus();
            $("#promo_code").trigger("focus");

            return;
          }

          $(this.openCalendarBack).focus();
        },

        onClickFieldsetDepartureDate: function (event) {
          this.onClickToOpenCalendar(event)
          $("#edit-departure-date").focus();
        },

        onClickFieldsetBackDate: function (event) {
          this.onClickToOpenCalendar(event)
          $("#edit-back-date").focus();
        },

        onClickFieldsetDepartureDateMobile: function (event) {
          this.removeFocusStyle($(event.target));
        },

        onClickFieldsetBackDateMobile: function (event) {
          this.removeFocusStyle($(event.target));
        },

        onDestinyUntilKeydown: function (event) {
          switch (event.keyCode) {
            case TAB_KEY_CODE:
              event.preventDefault();
              if (event.shiftKey) {
                this.clearFocus();
                $("#edit-fieldset-origin").trigger("focusin");
                $(".route__origin .select2-selection").focus();
              } else {
                $("#edit-fieldset-until .switch__container").focus();
              }
              break;
            default:
              break;
          }
        },

        onFocusFieldsetWrapper: function (event) {
          this.clearFocus();
        },

        onFieldsetUntilFocus: function (event) {
          this.inputOrigin.select2("close");
        },

        onFieldsetUntilClick: function (event) {
          this.fieldsetRouteTypeOptions.hide();
          this.inputRouteType.attr(
            'aria-expanded',
            this.fieldsetRouteTypeOptions.is(':visible')
          );

          this.closeFullCalendar();
          this.fieldsetQntPassengers.hide();
          this.inputEditPassengers.attr('aria-expanded', false);
        },

        onFocusDepartureDate: function (event) {
          this.clearFocus({ skipFullCalendar: true });

          $(event.target).addClass("focus");
          $(event.target)
            .closest(".fieldset-wrapper")
            .addClass("focus focus-outline")
        },

        onFocusBackDate: function (event) {
          if ($(event.target).attr('readonly')) {
            this.oppenModal({
              title: "",
              content: new Drupal.ticketSearch.views.Errors({
                model: [Drupal.t("You must select the departure date first.")]
              }).el,
            });

            this.clearFocus();
            this.closeFullCalendar();
            return;
          }

          this.clearFocus({ skipFullCalendar: true });
          var $closestFieldSetWrapper = $(event.target).closest(
            ".fieldset-wrapper"
          );
          $(event.target).addClass("focus");
          $closestFieldSetWrapper.addClass("focus").addClass("focus-outline");
        },

        onClickToOpenCalendar: function(event) {
          this.fullCalendarState.currentState = "INITIAL-DATE";
          this.setAriaExpandedFalse(true, false);

          // Departure date has min date as current day.
          let minDate = 0;
          // And max date according to back date set, if any.
          let maxDate = (this.model.get("back_date")) ? this.model.get("back_date") : null;

          if (
            [
              this.openCalendarBack.attr('id'),
              this.inputBackDate.attr('id'),
              this.fieldsetBackDate.attr('id')
            ].includes($(event.currentTarget).attr('id'))
          ) {
            this.fullCalendarState.currentState = "END-DATE";
            this.setAriaExpandedFalse(false, true);

            // Back date has min date as departure date otherwise uses current day.
            minDate = (this.model.get("departure_date")) ? this.model.get("departure_date") : 0;
            // And max date has no limit.
            maxDate = null;
          }    

          // Sets the calendar min and maxdate according to date and calendar type open.
          this.fullCalendar.datepicker("option", "minDate", minDate);
          this.fullCalendar.datepicker("option", "maxDate", maxDate);

          this.openFullCalendar();

          this.$scrollCalendar($(".calendar__wrapper"));

          if (drupalSettings.ticketSearch.isMobilePage) {
            let self = this;

            setTimeout(function(){
              self.fullCalendar
                .find("[data-handler='selectDay']")
                .find('a')
                .first()
                .focus();
            }, 1000);

          }
        },

        onPromoCodeKeydown: function (event) {
          if (event.keyCode != TAB_KEY_CODE) {
            return;
          }

          this.clearFocus();

          if (!event.shiftKey) {
            return;
          }

          event.preventDefault();

          $(this.removePromoCode).click();

          $(this.bookingSearch).focus();
        },

        setAriaLabelCalendar: function (event) {
          let self = this;

          setTimeout(function() {

            $('.ui-datepicker-next').attr("aria-label", Drupal.t("Move on to the next month"));
            $('.ui-datepicker-prev').attr("aria-label", Drupal.t("Carry over to the previous month"));

            $('.ui-datepicker-calendar > * td')
              .not('.ui-datepicker-other-month')
              .each(function () {
                let calendar = $(this),
                    first = $(this).closest('div.ui-datepicker-group-first'),
                    last = $(this).closest('div.ui-datepicker-group-last'),
                    month = '',
                    year = self.fullCalendarState.visibleYear;

                calendarValue = (calendar.find('span.ui-state-default').text()) ? calendar.find('span.ui-state-default') : calendar.find('a.ui-state-default');

                if (first.length > 0) {
                  month = first.find('div.ui-datepicker-header > div.ui-datepicker-title > span.ui-datepicker-month').text();
                  calendarValue.attr("aria-label", Drupal.t('@month @day, @year', { '@month': month, '@day': calendarValue.text(), '@year': year }));
                } else if (last.length > 0) {
                  month = last.find('div.ui-datepicker-header > div.ui-datepicker-title > span.ui-datepicker-month').text();
                  calendarValue.attr("aria-label", Drupal.t('@month @day, @year', { '@month': month, '@day': calendarValue.text(), '@year': year }));
                } else {
                  month = calendar.closest('div.ui-datepicker-inline').find('div.ui-datepicker-header').find('div.ui-datepicker-title > span.ui-datepicker-month').text();
                  calendarValue = (calendar.find('span.ui-state-default').text()) ? calendar.find('span.ui-state-default') : calendar.find('a.ui-state-default');
                  calendarValue.attr("aria-label", Drupal.t('@month @day, @year', { '@month': month, '@day': calendarValue.text(), '@year': year }));
                }
              });
          }, 0);

          self.refreshCalendar();
        },

        openFullCalendar: function (event) {
          if (
            this.isFlightPriceSet &&
            !this.$helper.getLoadingState()[this.fullCalendarState.currentState]
          ) {
            this.setPricesOnCalendarDays('> * td', '');
            this.refreshCalendar();
            this.updateDatePickerCellsWithPrice();
          }

          this.displayLoadingPricesOnCalendarDays();

          this.actionsContainer.hide();

          this.setAriaLabelCalendar();
          this.fixCalendarAccessibility();

          $(".calendar").fadeIn(160);
        },

        closeFullCalendar: function (event) {
          if (event) {
            event.preventDefault();
          }

          this.actionsContainer.show();

          $(".calendar").fadeOut(160);
          this.setAriaExpandedFalse();
        },

        loadMoreAirports: function (event) {
          event.preventDefault();

          var $airportsColumns = this.$el.find(
            ".airports-modal__list-container.active .airports-modal__column"
          );
          var $hiddenColumn = $airportsColumns.filter(function () {
            return $(this).css("display") == "none";
          });

          if ($hiddenColumn.length === 1) {
            $(event.currentTarget).hide();
          }

          $hiddenColumn.first().css("display", "block");
        },

        changeAirportType: function (event) {
          var $internationalTab = $("#international-tab");
          var $internationalParent = $internationalTab.parent();
          var $nationalTab = $("#national-tab");
          var $nationalParent = $nationalTab.parent();
          var $internationalContent = $("#international");
          var $nationalContent = $("#national");

          if (event.target.id == "international-tab") {
            $internationalTab.addClass("active");
            $internationalParent.addClass("active");
            $nationalTab.removeClass("active");
            $nationalParent.removeClass("active");
            $nationalContent.removeClass("active").hide();
            $internationalContent.addClass("active").show();
          } else if (event.target.id == "national-tab") {
            $nationalTab.addClass("active");
            $nationalParent.addClass("active");
            $internationalTab.removeClass("active");
            $internationalParent.removeClass("active");
            $internationalContent.removeClass("active").hide();
            $nationalContent.addClass("active").show();
          }
        },

        applySearchType() {
          this.inputSearchByPriceClone.prop(
            "checked",
            this.inputSearchByPrice.prop("checked")
          );

          if (this.inputSearchByPrice.is(":checked")) {
            this.fieldsetUntil.show();
            this.fieldsetDestiny.hide();
            this.destinyChange.hide();
          } else {
            this.fieldsetUntil.hide();
            this.fieldsetDestiny.show();
            this.destinyChange.show();
          }
        },

        applyPassengers: function () {
          var adults = this.inputPassengersAdults.val();
          var teens = this.inputPassengersTeens.val();
          var kids = this.inputPassengersKids.val();
          var babies = this.inputPassengersBabies.val();

          this.model.set("adults", adults);
          this.model.set("teens", teens);
          this.model.set("kids", kids);
          this.model.set("babies", babies);

          var passengers = [];
          if (adults > 0) {
            passengers.push(adults + " " + Drupal.t("adult(s)"));
          }
          if (teens > 0) {
            passengers.push(teens + " " + Drupal.t("teen(s)"));
          }
          if (kids > 0) {
            passengers.push(kids + " " + Drupal.t("children"));
          }
          if (babies > 0) {
            passengers.push(babies + " " + Drupal.t("babies"));
          }

          var label = "";
          _.each(passengers, function (value, index) {
            if (label === "") {
              label += value;
            } else if (index + 1 == passengers.length) {
              label += " " + ', ' + " " + value;
            } else {
              label += ", " + value;
            }
          });

          $(this.inputEditPassengers).removeClass("has-value");

          if (label.length > 0) {
            $(this.inputEditPassengers).addClass("has-value");
          }

          this.inputPassengers.val(label);
        },

        applyFocusStyle: function (element) {
          element
            .addClass("focus")
            .closest(".fieldset-wrapper")
            .addClass("focus focus-outline");
        },

        removeFocusStyle: function (element) {
          element
            .removeClass("focus")
            .closest(".fieldset-wrapper")
            .removeClass("focus focus-outline");
        },

        normalizeModelValues: function () {
          var departureDate = $.datepicker.parseDate(
            "dd/mm/yy",
            this.model.get("departure_date")
          );
          var returnDate = $.datepicker.parseDate(
            "dd/mm/yy",
            this.model.get("back_date")
          );
          var routeType = this.model.get("route_type");

          var route_list = [];

          this.RouteList.forEach(function (route) {
            var departure_date = $.datepicker.parseDate(
              "dd/mm/yy",
              route.get("departure_date")
            );
            route_list.push({
              origin: route.get("origin"),
              destiny: route.get("destiny"),
              departure_date: $.datepicker.formatDate(
                "dd-mm-yy",
                departure_date
              ),
            });
          });

          var values = {};

          if (drupalSettings.ticketSearch.type === "sabre_dx") {
            values = {
              origin: this.model.get("origin"),
              destination: this.model.get("destiny"),
              route: routeType === "RoundTrip" ? "round-trip" : "one-way",
              departureDate: $.datepicker.formatDate("mm/dd/yy", departureDate),
              departureDateYmd: $.datepicker.formatDate("yy-mm-dd", departureDate),
              returnDate: $.datepicker.formatDate("mm/dd/yy", returnDate),
              returnDateYmd: $.datepicker.formatDate("yy-mm-dd", returnDate),
              adult: this.model.get("adults"),
              teen: this.model.get("teens"),
              children: this.model.get("kids"),
              baby: this.model.get("babies"),
            };
            return values;
          }

          values = {
            route: this.model.get("route_type"),
            origin: this.model.get("origin"),
            destination: this.model.get("destiny"),
            adult: this.model.get("adults"),
            teen: this.model.get("teens"),
            children: this.model.get("kids"),
            baby: this.model.get("babies"),
            code: this.model.get("promo_code"),
            price: this.model.get("destiny_until"),
            departureDateYmd: $.datepicker.formatDate("yy-mm-dd", departureDate),
            departureDate: $.datepicker.formatDate("dd-mm-yy", departureDate),
            departureDay: $.datepicker.formatDate("dd", departureDate),
            departureYearMonth: $.datepicker.formatDate("mm-yy", departureDate),
            returnDateYmd: $.datepicker.formatDate("yy-mm-dd", returnDate),
            returnDate: $.datepicker.formatDate("dd-mm-yy", returnDate),
            returnDay: $.datepicker.formatDate("dd", returnDate),
            returnYearMonth: $.datepicker.formatDate("mm-yy", returnDate),
            searchByPrice: this.model.get("search_by_price"),
            smilesAndMoney: this.model.get("use_smiles"),
            route_list: route_list,
          };
          return values;
        },

        submitForm: function (values, event) {
          if (
            $(this.bookingSearch).is(':checked') &&
            drupalSettings.ticketSearch.enableBookingSearch &&
            drupalSettings.path.currentLanguage.toLowerCase() == "pt-br"
          ) {
            let normalizedValues = this.normalizeModelValues();

            if (normalizedValues.route == 'RoundTrip') {
              values.departureDateYmd = normalizedValues.departureDateYmd;
              values.returnDateYmd = normalizedValues.returnDateYmd;
            }

            values.adult = (normalizedValues.adult > 1) ? 2 : 1;
            values.openBookingSearch = true;
          }

          if (drupalSettings.path.currentLanguage.toLowerCase() == "pt-br") {
            if ($(this.voebizChoicer).is(':checked') ) {
              values.voebiz = 1;
            } else {
              values.voebiz = 0;
            } 
          }

          window.localStorage.setItem("origin", this.model.get("origin"));
          window.localStorage.setItem("destiny", this.model.get("destiny"));
          window.localStorage.setItem("route_type", this.model.get("route_type"));
          window.localStorage.setItem("ticketSearch", JSON.stringify({"adults": this.model.get("adults"), "teens": this.model.get("teens"), "kids": this.model.get("kids"), "babies": this.model.get("babies")}));

          this.form[0].reset();
          this.setDefaultValues();

          var currentLanguage = drupalSettings.path["currentLanguage"];
          var url = drupalSettings.ticketSearch.url;
          var type = drupalSettings.ticketSearch.type;

          if (this.model.get("search_by_price")) {
            url =
              "http://buscaporvalor.voegol.com.br/PriceAvailability/GetAvailability?culture=" +
              currentLanguage +
              "&currency=BRL";
            $.redirect(url, values);
          } else if (type === "sabre_dx") {
            url = url + "?" + $.param(values);
            window.location.href = url;
          } else {
            $.redirect(url, values);
          }
        },

        setRouteType: function (e) {
          this.inputRouteType.val($(e.target.labels).text().trim());
          this.mInputRouteType.text($(e.target.labels).text().trim());
        },

        changeAirport: function (e) {
          var value = $(e.currentTarget).data("id");
          this.currentField.val(value).trigger("change");
          this.currentField.select2("close");
          var $fieldset = this.currentField.closest("fieldset");
          $fieldset.find(".select2-selection").focus();
          $fieldset.trigger("focusin");
          this.closeModal();
        },

        changeDestiny: function () {
          this.closeFullCalendar();
          var origin = this.inputOrigin.val();
          var destiny = this.inputDestiny.val();
          this.inputOrigin.val(destiny).trigger("change");
          this.inputDestiny.val(origin).trigger("change");
        },

        removePassengers: function (e) {
          e.preventDefault();
          this.addRemovePassengers(e.target, "remove");
        },

        addPassengers: function (e) {
          e.preventDefault();
          this.addRemovePassengers(e.target, "add");
        },

        addRemovePassengers: function (target, action) {
          const disableButtons = (buttons, condition) => buttons.prop('disabled', condition);
          const formItem = $(target).closest(".form-item");
          const input = formItem.find("input[name^='passengers']");
          const label = formItem.find(".add-remove-pass .qnt");
          const removeButton = formItem.find(".remove-pass");
          const allAddButtons = $(".add-pass");
          const allRemoveButtons = $(".remove-pass");
          const removeExceptTarget = allRemoveButtons.not(removeButton);
          let qtd = parseInt(input.val());
          
          if (action === "remove" && qtd > 0) {
            qtd--;
            allAddButtons.prop('disabled', false);
          } else if (action === "add" && qtd < 10) {
            qtd++;
            if (qtd > 9) {
              disableButtons(allAddButtons, true);
              disableButtons(removeExceptTarget, true);
            }
          }

          input.val(qtd).trigger("change");
          label.text(qtd);
        
          this.applyPassengers();

          let validatePassenger = this.model.validatePassengerQuantity();

          // TODO: refactor validation flow.
          if (validatePassenger.length > 0) {
            this.oppenModal({
              title: "",
              content: new Drupal.ticketSearch.views.Errors({
                model: validatePassenger
              }).el,
            });

            if (action == "add" && qtd > 0) {
              qtd--;
            }

            input.val(qtd).trigger("change");
            label.text(qtd);

            this.applyPassengers();

            return;
          }
        },

        oppenAirportsModal: function (event) {
          event.preventDefault();

          var field_name = $(event.currentTarget).data("field");
          this.currentField = this.$("select[name='" + field_name + "']");

          var excludeAirports = [];
          var modalTitle = "";

          var route_wrapper = this.currentField.closest(".route");
          var inputOrigin = route_wrapper.find(".route__origin select");
          var inputDestiny = route_wrapper.find(".route__destiny select");

          if (!this.$helper.isEmptyOrNull(inputOrigin.val())) {
            excludeAirports.push(inputOrigin.val());
          }

          if (!this.$helper.isEmptyOrNull(inputDestiny.val())) {
            excludeAirports.push(inputDestiny.val());
          }

          if ($(event.target).hasClass("origin")) {
            modalTitle = Drupal.t("All GOL origins");
          } else {
            modalTitle = Drupal.t("All GOL destinations");
          }

          this.oppenModal({
            title: modalTitle,
            content: new Drupal.ticketSearch.views.AllAirports({
              model: { excludeAirports: excludeAirports },
            }).el,
          });

          var $listContainer = $(".airports-modal__list-container");
          var $seeMore = $(".airports-modal__see-more");

          $listContainer.append($seeMore);
        },

        oppenModal: function (options) {
          var modal = this.$("#ticket-search-modal");

          modal.find(".modal-title").text(options.title);
          modal.find(".modal-body").empty().append(options.content);

          this.modal = modal.modal();
        },

        closeModal: function () {
          this.modal.modal("hide");
        },

        applySelect2: function () {
          var self = this;

          var select2DefaultConfig = this.$helper.select2DefaultConfig();

          select2DefaultConfig.templateResult = function (state, item) {
            var selectElement = $(state.element).parents("select");
            if (
              (selectElement.attr("name") === "origin" &&
                state.id === self.inputDestiny.val()) ||
              (selectElement.attr("name") === "destiny" &&
                state.id === self.inputOrigin.val())
            ) {
              return null;
            }
            if (item) {
              $(item).addClass(
                $.inArray(state.id, self.airportsGrouper) !== -1
                  ? "airport-grouper"
                  : "airport"
              );
            }
            return $("<p>" + state.text + "</p>");
          };

          var $inputOrigin = this.inputOrigin.select2(
            $.extend(select2DefaultConfig, {
              placeholder: Drupal.t("Where do you want to leave?"),
              dropdownAutoWidth: true,
              dropdownParent:
                this.$("#edit-origin").closest(".fieldset-wrapper"),
              dropdownAutoWidth: true,
              selectionAdapter: $.fn.select2.amd.require(
                "SearchableSingleSelection"
              ),
              dropdownAdapter: $.fn.select2.amd.require("UnsearchableDropdown"),
            })
          );

          var $inputDestiny = this.inputDestiny.select2(
            $.extend(select2DefaultConfig, {
              placeholder: Drupal.t("Where do you want to go?"),
              dropdownAutoWidth: true,
              dropdownParent:
                this.$("#edit-destiny").closest(".fieldset-wrapper"),
              dropdownAutoWidth: true,
              selectionAdapter: $.fn.select2.amd.require(
                "SearchableSingleSelection"
              ),
              dropdownAdapter: $.fn.select2.amd.require("UnsearchableDropdown"),
            })
          );

          var $fieldsets = $(".route fieldset");
          var $priceInput = $(".edit-destiny-until");

          $fieldsets.on("focusin", function (event) {
            // Habilita os campos do "estado 1".
            self.enableFieldsStateOne();
            self.closeFullCalendar();
          });

          $("#edit-origin").on("keydown", function (event) {
            event.preventDefault();
          });

          $inputDestiny.on("change", function (event) {
            $("#edit-destiny-mobile").val(
              $("#select2-edit-destiny-container").text()
            );
            $("#select2-edit-destiny-container").addClass("has-value");
          });

          $inputOrigin.on("change", function (event) {
            $("#edit-origin-mobile").val(
              $("#select2-edit-origin-container").text()
            );
            $("#select2-edit-origin-container").addClass("has-value");
          });

          $inputOrigin.on("select2:open", function () {
            self.select2Open("origin", this);
          });

          $inputDestiny.on("select2:open", function () {
            self.select2Open("destiny", this);
          });

          $inputOrigin.on("select2:closing", function (event) {
            if (
              event.params.args.originalEvent &&
              event.params.args.originalEvent.handleObj &&
              event.params.args.originalEvent.handleObj.type === "keydown"
            ) {
              event.preventDefault();
            }
          });

          $inputOrigin.on("select2:select", function (event) {
            $(".route__origin .select2-selection").focus();
          });

          $inputDestiny.on("select2:select", function (event) {
            $(".route__destiny .select2-selection").focus();
          });

          $inputDestiny.on("select2:closing", function (event) {
            if (
              event.params.args.originalEvent &&
              event.params.args.originalEvent.handleObj &&
              event.params.args.originalEvent.handleObj.type === "keydown"
            ) {
              event.preventDefault();
            }
          });

          var $byPriceToggle = $(
            "#edit-search-by-price--first, #edit-search-by-price--second"
          );
          $byPriceToggle.on("change", function (event) {
            self.inputSearchByPrice.prop("checked", $(this).prop("checked"));

            if ($(this).is(":checked")) {
              setTimeout(function () {
                $priceInput.focus();
              }, 0);
            } else {
              $inputDestiny.select2("open");
              $("#edit-search-by-price--first").prop("checked", false);
              $("#edit-search-by-price--second").prop("checked", false);
            }

            self.applySearchType();
          });

          $priceInput.on("focus", function (event) {
            var $focusedElements = $(".focus.focus-outline");
            var $closestFieldsetWrapper = $(this).closest(".fieldset-wrapper");
            var $routeActions = $(
              ".route__destiny #edit-fieldset-until .route__actions"
            );

            $focusedElements.removeClass("focus").removeClass("focus-outline");
            $closestFieldsetWrapper.addClass("focus focus-outline");
            $routeActions.css("display", "block");
          });

          $(this.form).find('.select2-selection--single').attr('aria-labelledby', null);

        },

        select2Open: function (field, context) {
          var self = this;
          var $route_wrapper = $(context).closest(".route__" + field);
          var $airport_modal_action = $route_wrapper
            .find(".route__actions.airport-modal")
            .clone();
          var $search_price_action = $route_wrapper
            .find(".route__actions.price")
            .clone();
          var $dropdown = $route_wrapper.find(
            ".select2-dropdown.select2-dropdown--below"
          );
          var $label = $(context).find("select2-selection__rendered");

          if (field === "origin") {
            self.clearFocus({ skipOriginInput: true });
          } else {
            self.clearFocus({ skipDestinyInput: true });
          }

          $route_wrapper
            .find(".fieldset-wrapper.select2")
            .addClass("focus")
            .addClass("focus-outline");

          if ($dropdown.find(".route__actions").length === 0) {
            $airport_modal_action.click(self.oppenAirportsModal.bind(self));
            $dropdown.append($airport_modal_action);

            if (this.activeSearchByPrice) {
              $search_price_action
                .find("#edit-search-by-price--second")
                .on("change", function () {
                  self.inputSearchByPriceClone
                    .prop("checked", $(this).prop("checked"))
                    .change();
                });
              $dropdown.append($search_price_action);
            }
          }
          $dropdown.find(".route__actions").css("display", "block");
          $label.css("color", "white");
        },

        isLastDayOfTheMonth: function (date) {
          var lastDay = new Date(
            date.getFullYear(),
            date.getMonth() + 1,
            date.getDay()
          );
          return date.getTime() === lastDay.getTime();
        },

        doCalendarRequestByRouteType: function (
          availableDaysParms = {},
          flightRequestParams = {}
        ) {

          if (!drupalSettings.ticketSearch.enableCalendarRequests) {
            return;
          }

          if (
            this.model.get("route_type").toLowerCase() != "roundtrip"
            || flightRequestParams.forceRequest === true
          ) {
            this.getFlightsPrices(flightRequestParams.addOneMonth)

            return;
          }

          formValues = availableDaysParms.formValues;

          if (!formValues) {
            formValues = this.$helper.getFormValues(
              this.normalizeModelValues(),
              drupalSettings.ticketSearch.type
            );
          }

          if (!formValues.ida) {
            let currentDate = new Date(),
                day = 16,
                is31thDayOfMonth = false;

            formValues.is31thDayOfMonth = is31thDayOfMonth;

            if (
              this.fullCalendarState.visibleMonth == (currentDate.getMonth() + 1) &&
              currentDate.getDate() >= day
            ) {
              day = currentDate.getDate();
            }
          
            if (currentDate.getDate() === 31 && currentDate.getMonth() !== 11) {
              currentDate.setDate(15);
              currentDate.setMonth(currentDate.getMonth() + 1);
              
              formValues.ida = this.$helper.formatDateObj(currentDate, true);
              
              is31thDayOfMonth = true;
              
            } else {
              formValues.ida = this.$helper.formatDateObj(
                new Date(
                  this.fullCalendarState.visibleYear,
                  (this.fullCalendarState.visibleMonth - 1),
                  day
                ),
                true
              );
            }
            
          }
        
          this.$availableDays.getAvailableDays(
            formValues,
            this.model
          );

          this.displayLoadingPricesOnCalendarDays();

          return;
        },

        getFlightsPrices: function (addOneMonth = false) {
          if (!this.initializationComplete) {
            return;
          }

          // TODO: Validate model before submit.
          let formValues = this.$helper.getFormValues(
            this.normalizeModelValues(),
            drupalSettings.ticketSearch.type
          );

          if (
            (!formValues.de || !formValues.para) ||
            (formValues.de == formValues.para)
          ) {
            return;
          }

          if (this.model.get('invalid_route')) {
            return false;
          }

          formValues.isMobilePage = drupalSettings.ticketSearch.isMobilePage;

          if (
            this.inputDepartureDate.val() &&
            (this.inputRouteTypeVal.val() != 'OneWay')
          ) {
            let auxDate = (this.inputDepartureDate.val()).split('/');
            formValues.ida = auxDate[0] + '-' + auxDate[1] + '-' + auxDate[2];
          } else {
            formValues.ida = this.getVisibleMonthDate(addOneMonth, formValues.isMobilePage, false, false, true);
          }

          if (this.inputRouteTypeVal.val() != 'OneWay') {
            formValues.volta = this.getVisibleMonthDate(addOneMonth, formValues.isMobilePage, true, formValues.ida);
            formValues.volta2 = this.getRangeDays(formValues.volta);
          } else {
            formValues.ida2 = this.getRangeDays(formValues.ida);
          }

          // Loading active.
          this.model.set('loading_state', true);
          this.model.set('available_days', []);
          this.model.set('api_request_error', false);

          let self = this;
          let invalidRoute = this.modelDefaults.invalid_route;
          let urlPrefix = (drupalSettings.ticketSearch.urlLanguagePrefix) ?
            '/' + drupalSettings.ticketSearch.urlLanguagePrefix :
            '';

          $.post({
            'url': BASE_URL + urlPrefix + URL_FLIGHT_CALENDAR,
            'data': JSON.stringify(formValues),
            'timeout': drupalSettings.ticketSearch.requestTimeout ?? 1000,
          })
            .done(function(data) {
              self.inputSubmit.removeAttr('disabled');

              if (!data.success) {
                console.error('Error Flight API');

                return;
              }

              self.isFlightPriceSet = true;

              self.model.set('available_days', data.calendarPrices);

              self.setPricesInMonth(
                data.calendarPrices,
                ((self.model.get("route_type").toLowerCase() == 'oneway') ? false : true),
                data.calendarMinPriceOfMonth
              );
            })
            .fail(function(e) {
              if (e.status != 406) {
                self.model.set('api_request_error', true);
              }

              if (e.status == 406) {
                invalidRoute = true;

                console.error(Drupal.t('Invalid Route'));
              }
            })
            .always(function() {
              self.model.set(
                'invalid_route',
                invalidRoute
              );

              if (invalidRoute) {
                self.removeAllAvailableDaysInMonth();
                self.removeAllPricesInMonth();
              }

              self.updateDatePickerCellsWithPrice();

               // Loading inactive.
              self.model.set('loading_state', false);
            });
        },

        getVisibleMonthDate: function(addOneMonth = false, isMobilePage = false, returnDate = false, dataIda = false, oneway = false) {

          if (dataIda) {
            dataIda = dataIda.split('-');
            dataIda[1] = parseInt(dataIda[1]) - 1;
            newDate = new Date(dataIda[2], dataIda[1], dataIda[0]);
          } else {
            newDate = new Date();
          }

          let currentDate = new Date(),
              newMonth,
              newDayOfMonth,
              validateDay = false;

          if ((newDate.getDate()).toString().padStart(2, '0') <= 16 && !returnDate) {
            newDate.setDate(16);
          } else {
            if (!returnDate) {
              newDate.setDate(newDate.getDate() + 1);
            }
          }

          if (addOneMonth || oneway) {
            // if (this.fullCalendarState.visibleMonth >= (newDate.getMonth() + 1) && !returnDate) {
            //   newDate.setDate(16);
            //   newDate.setMonth(this.fullCalendarState.visibleMonth - 1);
            // } else if (this.fullCalendarState.visibleMonth >= (newDate.getMonth() + 1)) {
              newDate.setDate(16);
              newDate.setMonth(this.fullCalendarState.visibleMonth - 1);
            // }

            /*  else if (returnDate) {
              newDate.setDate(newDate.getDate() + 16);
              // newDate.setMonth(this.fullCalendarState.visibleMonth);
            } */
          } else {
            if (returnDate) {
              if ((newDate.getDate()).toString().padStart(2, '0') <= 16) {
                newDate.setDate(16);
              }/*  else {
                newDate.setDate(newDate.getDate() + 16);
              } */
              // newDate.setMonth(this.fullCalendarState.visibleMonth);
            }
          }

          if (
            isMobilePage &&
            ((newDate.getMonth() + 1) != this.fullCalendarState.visibleMonth) &&
            (!returnDate)
          ) {
            newMonth = this.fullCalendarState.visibleMonth.toString().padStart(2, '0');
            validateDay = (currentDate.getDate() >= newDate.getDate());
          } else {
            newMonth = (newDate.getMonth() + 1).toString().padStart(2, '0');
          }

          if (validateDay) {
            newDayOfMonth = (currentDate.getDate()).toString().padStart(2, '0');
            if (returnDate) {
              newDayOfMonth = (newDate.getDate()).toString().padStart(2, '0');
            }
          } else {
            newDayOfMonth = (newDate.getDate()).toString().padStart(2, '0');
          }

          return newDayOfMonth +
            '-' + newMonth +
            '-' + this.fullCalendarState.visibleYear
        },

        getRangeDays: function(date) {
          let currentDate = new Date();
          date = date.split('-');
          date[1] = parseInt(date[1]) - 1;
          // let day = (date[0] > 16) ? date[0] : 16;

          newDate = new Date(date[2], date[1], date[0]);
          auxMonth = (newDate.getMonth() + 1);

          if (currentDate.getDate() === 31 && this.fullCalendarState.visibleMonth >= auxMonth && newDate.getDate() === 31) {
            newDate.setDate(15);
            newDate.setMonth(newDate.getMonth() + 1);
          } else if (currentDate.getDate() === 31 && auxMonth === 1) {
            newDate.setDate(15);
            newDate.setMonth(newDate.getMonth() + 1);
          } else if (this.fullCalendarState.visibleMonth >= auxMonth) {
            newDate.setDate(16);
            newDate.setMonth(newDate.getMonth() + 1);
          } else if (newDate.getDate() < 16) {
            newDate.setDate(16);
          } else if (newDate.getDate() === 28 || newDate.getDate() === 29 || newDate.getDate() === 30) {
            newDate.setDate(16);
            // newDate.setMonth(newDate.getMonth() + 1);
          }

          date2 = (newDate.getDate()).toString().padStart(2, '0');
          month = (newDate.getMonth() + 1).toString().padStart(2, '0');
          year = newDate.getFullYear();

          return date2 + '-' + month + '-' + year;
        },

        setCalendarVisibleYearAndMonth: function(year, month) {
          this.fullCalendarState.visibleYear = year;
          this.fullCalendarState.visibleMonth = month;
        },

        isDayAvailable: function(dateObj, intervalClasses) {
          let isRouteInvalid = this.model.isRouteInvalid();

          // Initial state.
          if (
            !this.isAvailableDaysSet &&
            !isRouteInvalid.length > 0
          ) {
            return [!this.model.get('loading_state'), intervalClasses];
          }

          // Invalid route.
          if (isRouteInvalid.length > 0) {
            return [false, intervalClasses];
          }

          // Some error happened in API request, enable all days.
          if (this.model.get('api_request_error')) {
            return [true, intervalClasses];
          }

          // Available days from API.
          let isAvailable = this.getAvailableDaysInMonth().hasOwnProperty(
            this.$helper.formatDateObj(dateObj)
          );

          return [
            isAvailable,
            intervalClasses + ((isAvailable) ? ' available-day' : '' ),
          ];
        },

        getAvailableDaysInMonth: function() {
          if (typeof this.fullCalendarState.currentState == undefined) {
            return [];
          }

          return this.availableDaysInMonth[this.fullCalendarState.currentState];
        },

        getPricesInMonth: function() {
          if (typeof this.fullCalendarState.currentState == undefined) {
            return [];
          }

          return this.flightPricesInMonth[this.fullCalendarState.currentState];
        },

        getMinPriceOfMonth: function() {
          if (typeof this.fullCalendarState.currentState == undefined) {
            return [];
          }

          return this.minPriceOfMonth[this.fullCalendarState.currentState];
        },

        setAvailableDaysInMonth: function(
          data,
          forceBackDateData = false,
        ) {
          if (
            forceBackDateData ||
            this.fullCalendarState.currentState == "END-DATE"
          ) {
            this.availableDaysInMonth["END-DATE"] = data;

            return;
          }

          this.availableDaysInMonth["INITIAL-DATE"] = data;
        },

        setPricesInMonth: function(
          data,
          forceBackDateData = false,
          minPrices = []
        ) {
          this.flightPricesInMonth["INITIAL-DATE"] = data;
          this.minPriceOfMonth["INITIAL-DATE"] = minPrices;

          if (!forceBackDateData) {
            return;
          }

          this.flightPricesInMonth["END-DATE"] = data;
          this.minPriceOfMonth["END-DATE"] = minPrices;
        },

        removeAllAvailableDaysInMonth: function() {
          this.availableDaysInMonth['INITIAL-DATE'] = [];

          if (this.inputRouteTypeVal.val() == 'RoundTrip') {
            this.availableDaysInMonth['END-DATE'] = [];
          }
        },

        removeAllPricesInMonth: function() {
          this.flightPricesInMonth['INITIAL-DATE'] = [];
          this.minPriceOfMonth['INITIAL-DATE'] = [];

          if (this.inputRouteTypeVal.val() == 'RoundTrip') {
            this.flightPricesInMonth['END-DATE'] = [];
            this.minPriceOfMonth['END-DATE'] = [];
          }
        },

        removeSelectedDates: function(stateToClear = null) {
          let defaultValues = {
            inputReference: null,
            date: null,
            month: null,
            year: null,
          };

          if (stateToClear) {
            this.fullCalendarState[stateToClear] = defaultValues;

            return;
          }

          $(".calendar")
            .find(".ui-datepicker-calendar > * td")
            .not(".ui-datepicker-today")
            .removeClass([
              "is-initial-date",
              "is-end-date",
              "is-interval",
              "ui-datepicker-current-day"
            ]);

          this.fullCalendarState.previous = defaultValues;
          this.fullCalendarState.current = defaultValues;

          this.mInputDepartureDate.val('').change();
          this.inputDepartureDate.val('').change();
          this.mInputBackDate.val('').change();
          this.inputBackDate.val('').change();

          // resets the minDate to today date.
          this.fullCalendar.datepicker("option", "minDate", 0);
          // moves the visible month to current month.
          this.fullCalendar.datepicker("setDate", null);

          this.disableTooltip();
        },

        updateDatePickerCellsWithPrice: function () {
          if (!this.isFlightPriceSet) {
            return;
          }

          if (
            (this.model.get("route_type").toLowerCase() == 'roundtrip')
            && this.fullCalendarState.currentState == "INITIAL-DATE"
          ) {
            return;
          }

          var self = this;

          setTimeout(function() {
            self.setPricesOnCalendarDays(
              'td.available-day',
              self.getPricesInMonth(),
              self.getMinPriceOfMonth()
            );
          }, 0);
        },

        setPricesOnCalendarDays: function (elementName, value, minPriceList = []) {
          let clearData = (!value) ? true : false,
              price = '',
              isMinPriceOfMonth = '';

          $('.ui-datepicker-calendar ' + elementName).each(function () {
            if (!clearData) {
              let baseKey = $(this).data('year') + '-' +
                (parseInt($(this).data('month') + 1)).toString().padStart(2, '0');

              let calDate =  baseKey + '-' + ($(this).find('a').text()).padStart(2, '0');

              price = value[calDate];

              isMinPriceOfMonth = (
                minPriceList[baseKey] &&
                minPriceList[baseKey]['formatted'] == price
              ) ? true : false;
            }

            $(this).attr('data-flight-min-price', (clearData) ? '' : price);
            $(this).attr('data-is-min-price-of-month', (clearData) ? '' : isMinPriceOfMonth);
          });
        },

        fixCalendarAccessibility: function() {
          var self = this;
          var calendarEl = '.ui-datepicker-calendar';

          setTimeout(function() {
            $(calendarEl)
              .attr('role', 'grid')
              .attr('aria-live', 'polite');

            let caption = `<caption class="visually-hidden calendar-title" id="calendar-title" tabindex="-1"></caption>`;

            if (drupalSettings.ticketSearch.isMobilePage) {
              $(calendarEl).attr('aria-labelledby', 'calendar-title');

              $(caption)
                .html($('#datepicker-calendar').find('.ui-datepicker-title').text())
                .prependTo($(calendarEl));
            }

            if (!drupalSettings.ticketSearch.isMobilePage) {
              $('#datepicker-calendar').find('.ui-datepicker-group').each(function(key, item) {
                $($(calendarEl)[key]).attr('aria-labelledby', 'calendar-group-' + key);

                $(caption)
                  .html($(item).find('.ui-datepicker-title').text())
                  .prependTo($(calendarEl)[key]);

                  $($(calendarEl)[key]).find('.calendar-title').attr('id', `calendar-group-${key}`);
              });
            }

            $(calendarEl)
              .find('thead, tbody')
              .attr('role', 'rowgroup')
              .find('tr')
              .attr('role', 'row');

            $(calendarEl + ' thead th').each(function () {
              let span = $(this).find('span');
              span.attr('aria-label', span.attr('title'));
              span.attr('role', 'columnheader');
            });

            $(calendarEl)
              .find('tbody')
              .find('td')
              .not('.ui-state-disabled')
              .attr('role', 'gridcell')
              .attr('tabindex', '-1');

          }, 0);
        },

        setCalendarAriaBusy: function(state) {
          $('.ui-datepicker-calendar').attr('aria-busy', state);
        },

        appendInputCalendar: function(calendarPrice = false, loading = false) {
          let self = this;

          setTimeout(function() {
            $('.ui-datepicker-calendar > * td')
              .not('.ui-datepicker-other-month')
              .each(function () {
                if (calendarPrice) {
                  if (loading) {
                    $(this).attr('data-flight-min-price', '');
                  }

                  if ($(this).find('.calendar-price-loader').length) {
                    $(this).find('.calendar-price-loader').attr('data-loading-price', loading);
                  } else {
                    $(this).append('<span class="calendar-price-loader" data-loading-price=' + loading + '></span>');
                  }
                }

                let first = $(this).closest('div.ui-datepicker-group-first').find('.ui-datepicker-calendar > * td.ui-datepicker-unselectable.ui-state-disabled'),
                    last = $(this).closest('div.ui-datepicker-group-last').find('.ui-datepicker-calendar > * td.ui-datepicker-unselectable.ui-state-disabled');

                if (first.find('span.ui-state-default').text()) {
                  if (first.find('.date-parameters').length) {
                    first.find('.date-parameters').attr('data-month', (self.fullCalendarState.visibleMonth-1));
                    first.find('.date-parameters').attr('data-year', self.fullCalendarState.visibleYear);
                  } else {
                    first.append('<input type="hidden" class="date-parameters" data-month="' + (self.fullCalendarState.visibleMonth-1) + '" data-year="'+ self.fullCalendarState.visibleYear +'"/>');
                  }
                } else if (last.find('span.ui-state-default').text()) {
                  if (last.find('.date-parameters').length) {
                    last.find('.date-parameters').attr('data-month', self.fullCalendarState.visibleMonth);
                    last.find('.date-parameters').attr('data-year', self.fullCalendarState.visibleYear);
                  } else {
                    last.append('<input type="hidden" class="date-parameters" data-month="' + self.fullCalendarState.visibleMonth + '" data-year="'+ self.fullCalendarState.visibleYear +'"/>');
                  }
                }
              });

            self.fixCalendarAccessibility();
            self.setCalendarAriaBusy(self.model.get('loading_state'));
          }, 0);
        },

        displayLoadingPricesOnCalendarDays: function() {
          loading = this.$helper.getLoadingState()[this.fullCalendarState.currentState];
          let self = this;

          if (typeof loading != "boolean") {
            return;
          }

          self.appendInputCalendar(true, loading);
        },

        refreshCalendar: function() {
          this.fullCalendar.datepicker("refresh");
          this.hideTooltips();
        },

        disableTooltip: function() {
          $('.ui-datepicker-calendar > * td').tooltip('disable');
        },

        hideTooltips: function() {
          $('.tooltip').tooltip('hide');
        },

        countDaysRange: function() {
          let self = this;
          self.appendInputCalendar();

          $('.calendar__wrapper').on(
            'mouseenter',
            'td:not(".ui-datepicker-unselectable")',
            function() {
              if (
                !self.fullCalendarState.previous.fullDate ||
                self.fullCalendarState.currentState == "INITIAL-DATE" ||
                self.model.get("route_type").toLowerCase() == 'oneway'
              ) {
                return;
              }

              let hoverDate = new Date(
                $(this).data('year'),
                ($(this).data('month')),
                $(this).find('a').text()
              );

              let startDate = self.fullCalendarState.previous.fullDate,
                  endDate = self.fullCalendarState.current.fullDate;

              if (
                !endDate &&
                (hoverDate > startDate)
              ) {

                $('.ui-datepicker-calendar tbody td')
                  .not('.ui-datepicker-other-month')
                  .each(function (index, el) {

                    if ($(el).find('span.ui-state-default').text()) {
                      let dateDisabled = new Date( $(el).find('.date-parameters').data('year'), $(el).find('.date-parameters').data('month'), $(el).find('span.ui-state-default').text() );

                      if (Object.prototype.toString.call(dateDisabled) === '[object Date]') {
                        if (
                          dateDisabled > startDate &&
                          dateDisabled < hoverDate
                        ) {
                          $(el).addClass('is-interval');
                        } else {
                          $(el).removeClass('is-interval');
                        }
                      }
                    }
                    else {
                      let date = new Date( $(el).data('year'), $(el).data('month'), $(el).find('a').text() );

                      if (Object.prototype.toString.call(date) === '[object Date]') {
                        if (
                          date > startDate &&
                          date < hoverDate
                        ) {
                          $(el).addClass('is-interval');
                        } else {
                          $(el).removeClass('is-interval');
                        }
                      }
                    }
                });
              }

              let dateDiff = hoverDate.getTime() - self.fullCalendarState.previous.fullDate.getTime();
              let numberOfDays = (dateDiff / (1000 * 3600 * 24));

              if (numberOfDays < 0) {
                return;
              }

              $(this).attr(
                'data-original-title',
                (numberOfDays + 1) + ' ' + ((numberOfDays == 0) ? Drupal.t('Day') : Drupal.t('Days'))
              );

              $(this).tooltip('show');
            }
          );
        },

        applyDatepicker: function () {
          var self = this;

          self.setAriaLabelCalendar();
          self.fixCalendarAccessibility();

          this.fullCalendar.datepicker(
            $.extend(this.$helper.datepickerDefaultConfig(), {
              beforeShowDay: function (date) {
                var intervalClasses = "";

                if (
                  self.fullCalendarState &&
                  self.model.get("route_type").toLowerCase() != "oneway"
                ) {
                  if (
                    self.fullCalendarState.previous.fullDate &&
                    date.getTime() ===
                      self.fullCalendarState.previous.fullDate.getTime()
                  ) {
                    intervalClasses = "is-initial-date";
                  } else if (
                    self.fullCalendarState.current.fullDate &&
                    date.getTime() ===
                      self.fullCalendarState.current.fullDate.getTime()
                  ) {
                    intervalClasses = "is-end-date";
                  } else if (
                    date > self.fullCalendarState.previous.fullDate &&
                    date < self.fullCalendarState.current.fullDate
                  ) {
                    intervalClasses = "is-interval";
                  }

                  if (date.getDay() === 6) {
                    intervalClasses += " saturday";
                  }

                  if (self.isLastDayOfTheMonth(date)) {
                    intervalClasses += " last-day";
                  }
                }

                if (
                  self.model.get("route_type").toLowerCase() == "oneway" &&
                  self.fullCalendarState.previous.fullDate &&
                  date.getTime() === self.fullCalendarState.previous.fullDate.getTime()
                ) {
                  intervalClasses = " is-oneway-selected-date";
                }

                if (
                  self.isFlightPriceSet &&
                  !self.$helper.getLoadingState()[self.fullCalendarState.currentState]
                ) {
                  self.updateDatePickerCellsWithPrice();
                }

                return self.isDayAvailable(date, intervalClasses);
              },
              onChangeMonthYear: function(year, month, inst) {
                self.setCalendarVisibleYearAndMonth(year, month);

                let formValues = self.$helper.getFormValues(
                  self.normalizeModelValues(),
                  drupalSettings.ticketSearch.type
                );

                let currentDate = new Date(),
                    day = 16,
                    selectedInitialDate = formValues.ida,
                    addOneMonth = false,
                    is31thDayOfMonth = false;
                    forcePriceRequest = selectedInitialDate &&
                      self.model.get("route_type").toLowerCase() != "oneway" &&
                      self.fullCalendarState.currentState == "END-DATE"
                    
                      formValues.is31thDayOfMonth = is31thDayOfMonth;

                if (
                  self.model.get("route_type").toLowerCase() == "oneway" ||
                  selectedInitialDate
                ) {
                  addOneMonth = true;
                }

                if (
                  month == (currentDate.getMonth() + 1) &&
                  currentDate.getDate() >= day
                ) {
                  day = currentDate.getDate();
                }

                if (month === (currentDate.getMonth() + 1) && currentDate.getDate() >= day) {
                  day = currentDate.getDate();
                }
              
                if (currentDate.getDate() === 31 && month === (currentDate.getMonth() + 1)) {
                  is31thDayOfMonth = true;
                  formValues.ida = self.$helper.formatDateObj(
                    new Date(year, month, 15),
                    true
                  );
                } else {
                  formValues.ida = self.$helper.formatDateObj(
                    new Date(year, (month-1), day),
                    true
                  );
                }

                self.doCalendarRequestByRouteType(
                  {'formValues': formValues,}, {
                    'addOneMonth': addOneMonth,
                    'forceRequest': ((forcePriceRequest) ? true : false),
                  }
                );

                self.setAriaLabelCalendar();
                self.fixCalendarAccessibility();
              },
              onSelect: function (dateText, instance) {
                var selectedMonth =
                  parseInt(instance.selectedMonth + 1) < 10
                    ? "0" + (instance.selectedMonth + 1)
                    : instance.selectedMonth + 1;
                var selectedDay =
                  parseInt(instance.selectedDay) < 10
                    ? "0" + instance.selectedDay
                    : instance.selectedDay;

                var selectedDate = {
                  month: selectedMonth,
                  year: instance.selectedYear,
                  day: selectedDay,
                  fullStringDate:
                    selectedDay +
                    "/" +
                    selectedMonth +
                    "/" +
                    instance.selectedYear,
                  fullDate: new Date(
                    instance.selectedYear +
                      "-" +
                      selectedMonth +
                      "-" +
                      selectedDay +
                      "T00:00:00"
                  ),
                };

                switch (self.fullCalendarState.currentState) {
                  case "INITIAL-DATE":
                    self.fullCalendarState.previous = selectedDate;
                    self.inputDepartureDate.datepicker(
                      "setDate",
                      selectedDate.fullStringDate
                    );
                    self.inputDepartureDate.val(selectedDate.fullStringDate);
                    self.inputDepartureDate.change();

                    if (self.model.get("route_type").toLowerCase() != "oneway") {
                      // sets the minDate as users selected date.
                      self.fullCalendar.datepicker("option", "minDate", selectedDate.fullStringDate);
                      // moves the visible month to current month.
                      self.fullCalendar.datepicker("setDate", null);
                    }

                    // Mobile input.
                    self.mInputDepartureDate.val(
                      Drupal.t('Outbound') + ' ' +
                      selectedDate.fullStringDate
                    );

                    self.inputDepartureDate.focus();
                    self.closeFullCalendar();

                    break;

                  case "END-DATE":
                    self.fullCalendarState.current = selectedDate;

                    self.inputBackDate.datepicker(
                      "setDate",
                      selectedDate.fullStringDate
                    );
                    self.inputBackDate.val(selectedDate.fullStringDate);
                    self.inputBackDate.change();

                    // Mobile input.
                    self.mInputBackDate.val(
                      Drupal.t('Return') + ' ' +
                      selectedDate.fullStringDate
                    );

                    self.inputBackDate.focus();
                    self.closeFullCalendar();

                    break;

                  case "default":
                    break;
                }

                // Calculate the date interval.
                // self.countDaysRange();
                // self.hideTooltips();
                self.setAriaLabelCalendar();
                self.fixCalendarAccessibility();
              },
            })
          );

          this.inputDepartureDate.keydown(function (event) {
            if ([ENTER_KEY_CODE, TAB_KEY_CODE].includes(event.keyCode)) {
              self.setStateSelectedDate($(this).val(), "INITIAL-DATE");
            }
          });

          this.inputBackDate.keydown(function (event) {
            if ([ENTER_KEY_CODE, TAB_KEY_CODE].includes(event.keyCode)) {
              self.setStateSelectedDate($(this).val(), "END-DATE");
            }
          });
        },

        setStateSelectedDate(date, currentState) {
          var self = this;
          try {
            if (date) {
              var date = $.datepicker.parseDate("dd/mm/yy", date);
              var selectedDay = $.datepicker.formatDate("dd", date);
              var selectedMonth = $.datepicker.formatDate("mm", date);
              var selectedYear = $.datepicker.formatDate("yy", date);

              var selectedDate = {
                month: selectedMonth,
                year: selectedYear,
                day: selectedDay,
                fullStringDate: $.datepicker.formatDate("dd/mm/yy", date),
                fullDate: new Date(
                  selectedYear +
                    "-" +
                    selectedMonth +
                    "-" +
                    selectedDay +
                    "T00:00:00"
                ),
              };

              if (self.fullCalendarState) {
                switch (currentState) {
                  case "INITIAL-DATE":
                    self.fullCalendarState.previous = selectedDate;

                    self.fullCalendar.datepicker(
                      "setDate",
                      selectedDate.fullStringDate
                    );

                    break;
                  case "END-DATE":
                    self.fullCalendarState.current = selectedDate;

                    self.fullCalendar.datepicker(
                      "setDate",
                      self.fullCalendarState.current.fullStringDate
                    );

                    break;
                  default:
                    break;
                }
              }
            }
          } catch (error) {
            console.log(error);
          }

          self.setAriaLabelCalendar();
          self.fixCalendarAccessibility();
        },

        applyInputMask() {
          if (!$.fn.inputmask) {
            return;
          }
          this.inputDestinyUntil.inputmask("currency", {
            autoUnmask: true,
            radixPoint: ",",
            groupSeparator: ".",
            allowMinus: false,
            prefix: "R$ ",
            digits: 2,
            digitsOptional: false,
            rightAlign: false,
            unmaskAsNumber: true,
            onincomplete: function () {
              $(this).val("");
            },
          });

          this.inputDestinyUntil.on("focus", function (event) {
            $(this).addClass("focus");
          });

          this.inputDepartureDate.inputmask();
          this.inputBackDate.inputmask();
        },

        displayMultiTrecho: function () {
          var self = this;
          if (this.RouteList.length === 0) {
            var default_routes = [
              { title: Drupal.t("Segment") + " 1" },
              { title: Drupal.t("Segment") + " 2" },
            ];
            _.each(default_routes, function (route, index) {
              var route = new Drupal.ticketSearch.models.RouteModel(route);
              self.RouteList.add(route);
            });
          }
          this.multiTrecho.show();
        },

        setGeolocatedSearch: function() {
          var airports = drupalSettings.ticketSearch.airports || [];
          var getDataOrigin = window.localStorage.getItem('origin');

          var smaller = null;
          var geolocated_airports = null;

          for (let index in airports.location) {
            var origin = airports.location[index];

            if (origin.lat && origin.lon) {
              var distance = $.fn.distance(origin.lat, origin.lon, this.startLat, this.startLon);

              if (!smaller || distance < smaller) {
                smaller = distance;
                geolocated_airports = index;
              }
            }
          }

          if (geolocated_airports && getDataOrigin === null) {
            $(this.inputOrigin).val(geolocated_airports);
            $(this.inputOrigin).change();
          }
        },
      });

      $("#ticket-search", context)
        .once("ticket-search")
        .each(function () {
          var model = new Drupal.ticketSearch.models.TicketSearchFormModel();

          new TicketSearchFormView({
            el: $(this),
            model: model,
          });
        });
    },
  };
})(jQuery, Drupal, Backbone, drupalSettings, document);
;
(function ($, Drupal, drupalSettings) {
  "use strict";

  var isLoadingActive = [];

  Drupal.behaviors.Helpers = {
    getFormValues: function (data, searchType) {
      var currentLanguage = drupalSettings.path["currentLanguage"];
      var language = currentLanguage.split("-");
      var country = language[0];
      var residentCountry = language[0];

      if (typeof language[1] != "undefined" && language[1] !== null) {
        residentCountry = language[1];
      }

      if (residentCountry === "en") {
        residentCountry = "us";
      }

      if (data.searchByPrice) {
        return {
          DepartureStation: data.origin,
          MaxPrice: data.price,
          DepartureDate: data.departureDate,
          ReturnDate: data.returnDate,
          AdultPaxCount: data.adult,
          ChildrenPaxCount: data.children,
          MarketStructure: data.route,
          "promotional-code": data.code,
        };
      }

      if (searchType === "sabre_dx") {
        var locale = language[1];

        if (language[0] === "en") {
          locale = "us";
        } else if (language[0] === "es") {
          locale = "es";
        }

        var payloadDx = {
          origin: data.origin,
          destination: data.destination,
          date: data.departureDate,
          activeMonth: data.departureDate,
          ADT: data.adult,
          ADL: data.teen,
          CHD: data.children,
          INF: data.baby,
          journeyType: data.route,
          pointOfSale: residentCountry.toUpperCase(),
          locale: country + "-" + locale.toUpperCase(),
        };

        if (data.route === "round-trip") {
          payloadDx.date1 = data.returnDate;
          payloadDx.origin1 = data.destination;
          payloadDx.destination1 = data.origin;
        }

        Object.keys(payloadDx).forEach(
          (index) => payloadDx[index] === "" && delete payloadDx[index]
        );
        return payloadDx;
      }
      
      var payload = {
        pv: residentCountry,
        tipo: "DF",
        de: data.origin,
        para: data.destination,
        ida: data.departureDate,
        volta: data.returnDate,
        ADT: data.adult,
        ADL: data.teen,
        CHD: data.children,
        INF: data.baby,
        promocode: data.code,
      };

      if (language[0] === "pt") {
        $.extend(payload,{
          voebiz: data.voebiz,
        });
      }

      Object.keys(payload).forEach(
        (index) => payload[index] === "" && delete payload[index]
      );
      return payload;
    },

    select2DefaultConfig() {
      var config = {
        allowClear: true,
        dir: "ltr",
        maximumSelectionLength: 0,
        multiple: false,
        placeholder: "",
        selectOnClose: false,
        tags: false,
        theme: "default",
        tokenSeparators: [],
        width: "100%",
        language: {
          noResults: function () {
            return Drupal.t("No results found");
          },
        },
      };
      return config;
    },

    datepickerDefaultConfig() {
      return {
        maxDate: 330,
        minDate: 0,
        dateFormat: "dd/mm/yy",
        dayNames: [
          Drupal.t("Sunday"),
          Drupal.t("Monday"),
          Drupal.t("Tuesday"),
          Drupal.t("Wednesday"),
          Drupal.t("Thursday"),
          Drupal.t("Friday"),
          Drupal.t("Saturday"),
        ],
        dayNamesMin: [
          Drupal.t("Sun"),
          Drupal.t("Mon"),
          Drupal.t("Tue"),
          Drupal.t("Wed"),
          Drupal.t("Thu"),
          Drupal.t("Fri"),
          Drupal.t("Sat"),
        ],
        monthNames: [
          Drupal.t("January"),
          Drupal.t("February"),
          Drupal.t("March"),
          Drupal.t("April"),
          Drupal.t("May"),
          Drupal.t("June"),
          Drupal.t("July"),
          Drupal.t("August"),
          Drupal.t("September"),
          Drupal.t("October"),
          Drupal.t("November"),
          Drupal.t("December"),
        ],
        monthNamesMin: [
          Drupal.t("Jan."),
          Drupal.t("Feb."),
          Drupal.t("Mar."),
          Drupal.t("Apr."),
          Drupal.t("May"),
          Drupal.t("Jun."),
          Drupal.t("Jul."),
          Drupal.t("Aug."),
          Drupal.t("Sep."),
          Drupal.t("Oct."),
          Drupal.t("Nov."),
          Drupal.t("Dec."),
        ],
        numberOfMonths: [1, ((drupalSettings.ticketSearch && !drupalSettings.ticketSearch.isMobilePage) ? 2 : 1)],
        stepMonths: ((drupalSettings.ticketSearch && !drupalSettings.ticketSearch.isMobilePage) ? 2 : 1),
      };
    },

    isEmptyOrNull: function (value) {
      return value === "" || value === null;
    },

    getRangeDays: function(date) {
      return 15;
      /* date = date.split('-');
      date[1] = parseInt(date[1]) - 1;
      date = new Date(date[2], date[1], date[0]);
      // date = new Date(date[1] + '-' + date[0] + '-' + date[2]);

      if (date.getDate() < 16) {
        return 15;
      }

      let range,
          newDate = new Date(date.getFullYear(), date.getMonth() + 1, 0);

      range = (date.getDate() - newDate.getDate());

      return (range < 0) ? range * -1 : range; */
    },

    formatDateObj: function (dateObj, ptbrFormat = false) {
      if (!ptbrFormat) {
        return dateObj.getFullYear() + '-' +
          (parseInt(dateObj.getMonth() + 1)).toString().padStart(2, '0') + '-' +
          (dateObj.getDate()).toString().padStart(2, '0');
      }

      return (dateObj.getDate()).toString().padStart(2, '0') + '-' +
        (parseInt(dateObj.getMonth() + 1)).toString().padStart(2, '0') + '-' +
        dateObj.getFullYear();
    },

    setLoadingPricesOnCalendarDays: function(
      routeType,
      loading = true,
      forceBackDate = false
    ) {
      if (
        routeType == 'RoundTrip' &&
        !forceBackDate
      ) {
        isLoadingActive["INITIAL-DATE"] = loading;
        isLoadingActive["END-DATE"] = loading;
      } else if (!forceBackDate) {
        isLoadingActive["INITIAL-DATE"] = loading;
      } else {
        isLoadingActive["END-DATE"] = loading;
      }
    },

    getLoadingState: function() {
      return isLoadingActive;
    },
  };
})(jQuery, Drupal, drupalSettings);
;
(function (Backbone, Drupal) {
    'use strict';

    Drupal.ticketSearch.models.RouteModel = Backbone.Model.extend({

      defaults: function () {
        return {
          title: '',
          origin: '',
          destiny: '',
          departure_date: ''
        };
      },

      validate: function() {
        var errors = [];
        if(this.isEmptyOrNull(this.get('origin'))) {
          errors.push(Drupal.t('Inform the departure airport.'));
        }

        if(
          this.isEmptyOrNull( this.get('destiny'))
        ) {
          errors.push(Drupal.t('Inform the destination airport.'));
        }

        if(this.isEmptyOrNull(this.get('departure_date'))) {
          errors.push(Drupal.t('Enter the departure date of the trip.'));
        }

        return errors.length ? errors : '';
      },

      isEmptyOrNull: function(value) {
        return value === "" || value === null
      }

    });

    Drupal.ticketSearch.models.RouteListModel = Backbone.Collection.extend({
        model: Drupal.ticketSearch.models.RouteModel,
    });
})(Backbone, Drupal);
;
(function ($, Backbone, Drupal) {
  'use strict';

  let warningToday = true;

  Drupal.ticketSearch.models.TicketSearchFormModel = Backbone.Model.extend({

    defaults: function () {
      return {
        route_type: 'RoundTrip',
        origin: '',
        destiny: '',
        destiny_until: 0,
        search_by_price: false,
        adults: 0,
        kids: 0,
        babies: 0,
        departure_date: '',
        back_date: '',
        route_list: [],
        available_days: [],
        loading_state: false,
        invalid_route: false,
        api_request_error: false,
      };
    },

    validate: function () {
      var errors = [];

      if (this.isEmptyOrNull(this.get('route_type'))) {
        errors.push(Drupal.t('Enter the type of route.'));
      }

      errors = this.validatePassengerQuantity(errors);

      if (
        this.get('route_type') == 'RoundTrip' ||
        this.get('route_type') == 'OneWay'
      ) {

        if (this.isEmptyOrNull(this.get('origin'))) {
          errors.push(Drupal.t('Inform the departure airport.'));
        }

        if (
          !this.get('search_by_price') &&
          this.isEmptyOrNull(this.get('destiny'))
        ) {
          errors.push(Drupal.t('Inform the destination airport.'));
        }

        if (
          this.get('search_by_price') &&
          (!this.get('destiny_until') || this.get('destiny_until') === 0)
        ) {
          errors.push(Drupal.t('Enter the maximum value for the destination.'));
        }

        if (this.isEmptyOrNull(this.get('departure_date'))) {
          errors.push(Drupal.t('Enter the departure date of the trip.'));
        }

        let today = new Date();
        let dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
        let todayFormatted = new Intl.DateTimeFormat('pt-BR', dateOptions).format(today);

        if (warningToday && todayFormatted == this.get('departure_date')) {
          warningToday = false;
          errors.push(
            Drupal.t('Because today date has been selected, only flights departing today at least 1 hour and 30 minutes from the current time will be shown in the next page.'),
            '<br><a data-dismiss="modal" class="btn btn-secondary today-alert" href="#">OK<a>',
          );
        }

        if (this.get('route_type') == 'RoundTrip') {
          if (this.isEmptyOrNull(this.get('back_date'))) {
            errors.push(Drupal.t('Enter the return date of the trip.'));
          }

          if (
            !this.isEmptyOrNull(this.get('departure_date')) &&
            !this.isEmptyOrNull(this.get('back_date')) &&
            this.isBackDateInvalid()
          ) {
            errors.push(Drupal.t('The return date must be equal or greater than departure date.'));
          }
        }

      }
      else if (this.get('route_type') == 'MultiTrecho') {
        this.get('route_list').forEach(function (route, key) {
          var route_errors = $('<ul></ul>');
          route.isValid();
          var is_valid = true;
          _.each(route.validationError, function (error) {
            is_valid = false;
            route_errors.append($('<li></li>').text(error));
          });
          if (!is_valid) {
            var index = key + 1;
            errors.push(
              $('<div class="routes"></div>')
                .append($('<p></p>').text(Drupal.t('Segment ' + index)))
                .append(route_errors).html()
            );
          }
        });
      }

      return errors.length ? errors : '';
    },

    validatePassengerQuantity: function(target, errors = []) {
      let adults = parseInt(this.get('adults')),
      kids = parseInt(this.get('kids')),
      babies = parseInt(this.get('babies')),
      teens = parseInt(this.get('teens')),
      totalPassengers = adults + kids + babies + teens;
    
      let message = Drupal.t('The maximum number of travelers must be 9 people. If you need more people, please access our sale channel for groups: <a href="@url">https://www.voegol.com.br/sua-viagem/viaje-em-grupo#no-back</a>.', {'@url': 'https://www.voegol.com.br/sua-viagem/viaje-em-grupo#no-back'});
      let allAddButtons = $(".add-pass");
      let allRemoveButtons = $(".remove-pass");
      let disableButtons = (buttons, condition) => buttons.prop('disabled', condition);
    
      if (adults === 0 && kids === 0 && teens === 0) {
        errors.push(Drupal.t('An adult, teens or child is required.'));
      }
    
      if (adults < babies) {
        errors.push(Drupal.t('The number of adults must be greater than or equal to that of babies.'));
      }
    
      if (totalPassengers > 9) {
        errors.push(Drupal.formatString(message));
        disableButtons(allAddButtons, true);
    
        allRemoveButtons.each(function() {
          let removeButton = $(this);
          let formItem = removeButton.closest(".form-item");
          let input = formItem.find("input[name^='passengers']");
          let passengerCount = parseInt(input.val());
    
          if (passengerCount > 0) {
            removeButton.prop('disabled', false);
          } else {
            removeButton.prop('disabled', true);
          }
        });
      }
    
      return errors;
    },

    isRouteInvalid: function() {
      let errors = [];

      if (!this.get('invalid_route')) {
        return errors;
      }

      let origin = this.get('origin'),
          destiny = this.get('destiny');

      errors.push(
        Drupal.t('The selected route is invalid ') + ` (${origin} - ${destiny}).` + '<br>' + Drupal.t('Select another airport.')
      );

      return errors;
    },

    isEmptyOrNull: function (value) {
      return value === "" || value === null
    },

    isBackDateInvalid: function () {
      let departureDate = this.formatDateToYmd(this.get('departure_date'));
      let backDate = this.formatDateToYmd(this.get('back_date'));

      if ((new Date(departureDate)).getTime() > (new Date(backDate)).getTime()) {
        return true;
      }

      return false;
    },

    formatDateToYmd: function(dateToFormat) {
      let pieces = dateToFormat.match(/(\d+)/g);

      return `${pieces[2]}-${pieces[1]}-${pieces[0]}`;
    }
  });

})(jQuery, Backbone, Drupal);
;
(function ($, Backbone, Drupal, drupalSettings) {
    'use strict';

  Drupal.ticketSearch.views.MultipleRoutes = Backbone.View.extend({

    events: {
      "click #remove-route": "removeRoute"
    },

    tagName: "div",

    className: 'multiple-routes--route',

    template: _.template($('#route-template').html()),

    initialize: function() {
      this.cid = this.model.cid;

      this.$helper = Drupal.behaviors.Helpers;

      this.routeEl = this.template({
        cid: this.cid,
        title: this.model.get('title'),
        origin_label: Drupal.t('Leaving from'),
        destiny_label: Drupal.t('Going to'),
        origin_options: this.airportOptions('origin'),
        destiny_options: this.airportOptions('destiny')
      });

      this.airportsGrouper = drupalSettings.ticketSearch.airports.grouper || [];

      this.listenTo(this.model, 'destroy', this.remove);
      this.listenTo(Drupal.ticketSearch.events, 'onRender', this.onRender);
    },

    render: function() {
      this.$el.append(this.routeEl);
      return this;
    },

    onRender: function(e) {
      if (e.cid === this.cid) {
        this.inputOrigin = $('#edit-origin-' + this.cid);
        this.inputDestiny = $('#edit-destiny-' + this.cid);
        this.inputDepartureDate = $('#edit-departure-date-' + this.cid);
        this.inputDepartureDate.val(this.model.get('departure_date'));

        this.applySelect2();
        this.applyDatepicker();
        this.eventListeners();
      }
    },

    eventListeners: function() {
      var self = this;
      this.inputOrigin.on('change', function() {
        self.model.set('origin', $(this).val());
      });

      this.inputDestiny.on('change', function() {
        self.model.set('destiny', $(this).val());
      });

      this.inputDepartureDate.on('change', function() {
        self.model.set('departure_date', $(this).val());
      });
    },

    applySelect2: function() {
      var self = this;
      var select2DefaultConfig = this.$helper.select2DefaultConfig();

      select2DefaultConfig.templateResult = function (state, item) {
        var selectElement = $(state.element).parents('select');

        if (
          selectElement.attr('name') === 'origin-' + self.cid &&
          state.id === self.inputDestiny.val() ||
          selectElement.attr('name') === 'destiny-' + self.cid &&
          state.id === self.inputOrigin.val()
        ) {
          return null;
        }
        if (item) {
          $(item).addClass($.inArray(state.id, self.airportsGrouper) !== -1 ? 'airport-grouper' : 'airport');
        }
        return state.text;
      };

      var $inputOrigin = this.inputOrigin.select2($.extend(select2DefaultConfig, {
        placeholder: Drupal.t('Where do you want to leave?'),
        dropdownAutoWidth: true,
        dropdownParent: self.inputOrigin.closest('.fieldset-wrapper'),
        dropdownAutoWidth: true,
        selectionAdapter: $.fn.select2.amd.require("SearchableSingleSelection"),
        dropdownAdapter: $.fn.select2.amd.require("UnsearchableDropdown")
      }));

      var $inputDestiny = this.inputDestiny.select2($.extend(select2DefaultConfig, {
        placeholder: Drupal.t('Where do you want to go?'),
        dropdownAutoWidth: true,
        dropdownParent: this.inputDestiny.closest('.fieldset-wrapper'),
        dropdownAutoWidth: true,
        selectionAdapter: $.fn.select2.amd.require("SearchableSingleSelection"),
        dropdownAdapter: $.fn.select2.amd.require("UnsearchableDropdown")
      }));

      $inputOrigin.on('select2:open', function() {
        self.select2Open('origin', this);
      });

      $inputDestiny.on('select2:open', function() {
        self.select2Open('destiny', this);
      });
    },

    select2Open: function(field, context) {
      var self = this;
      var $route_wrapper = $(context).closest('.route__' + field);
      var $route_actions = $route_wrapper.find(".route__actions").clone();
      var $dropdown = $route_wrapper.find(".select2-dropdown.select2-dropdown--below");
      var $label = $(context).find("select2-selection__rendered");

      self.model.parent.clearFocus();
      $route_wrapper.find(".fieldset-wrapper.select2").addClass("focus").addClass("focus-outline");

      if ($dropdown.find(".route__actions").length === 0) {
        $route_actions.click(function(event) {
          self.model.parent.oppenAirportsModal(event)
        });
        $dropdown.append($route_actions);
      }

      $route_actions.css('display', 'block');
      $label.css("color", "white");
    },

    applyDatepicker: function() {
      var self = this;
      var config = $.extend(this.$helper.datepickerDefaultConfig(), {
        beforeShow: function(textbox, instance) {
          if(!$('.calendar__only-mobile').length){
            $('#ui-datepicker-div').wrap('<span class="calendar__only-mobile"></span>');
          }

          if (instance.id == 'edit-departure-date-' + self.cid) {
            var find = false;
            self.model.parent.routeList.forEach(function(route) {
              if (self.cid == route.cid) {
                find = true;
              }
              if (!find && route.get('departure_date')) {
                instance.settings.minDate = route.get('departure_date');
              }
              if (find && self.cid !== route.cid && !instance.settings.maxDate && route.get('departure_date')) {
                instance.settings.maxDate = route.get('departure_date');
              }
            });
          }
        },
        onSelect: function(dateText, instance) {
          if(dateText !== instance.lastVal){
            $(this).change();
          }
        }
      });

      this.inputDepartureDate.datepicker(config);
    },

    removeRoute: function(e) {
      e.preventDefault();
      this.model.destroy();
    },

    airportOptions: function(field) {
      var self = this;
      var airports = drupalSettings.ticketSearch.airports || {};

      var options = ['<option value="" disabled selected>'+ Drupal.t('Where do you want to leave?') + '</option>'];

      options.push(['<optgroup label="' + Drupal.t("National") + '">']);
      $(Object.keys(airports.national)).each(function (index, value) {
        var selected = '';
        if (self.model.get(field) === value) {
          selected = 'selected';
        }
        options.push('<option value="' + value + '"'+ selected + '>' + airports.national[value] + '</option>');
      });

      options.push(['<optgroup label="' + Drupal.t("International") + '">']);
      $(Object.keys(airports.national)).each(function (index, value) {
        var selected = '';
        if (self.model.get(field) === value) {
          selected = 'selected';
        }
        options.push('<option value="' + value + '"'+ selected + '>' + airports.national[value] + '</option>');
      });

      return options.join('');
    }
});

})(jQuery, Backbone, Drupal, drupalSettings);
;
(function ($, Backbone, Drupal, drupalSettings) {
  'use strict';

  var AirportAnchorElement = Backbone.View.extend({
    tagName: "div",

    className: 'airports-modal__list-item',

    render: function() {
      var self =  this;
      var $anchor = $('<a href="#"></a>').attr('data-id', this.model.id).addClass("airports-modal__anchor");

      $anchor.on("click", function (event) {
        event.preventDefault();
        $anchor.trigger({ type: "onupdateairport", params: { airport: $.extend({}, self.model) }})
      })

      this.$el
        .attr('tabindex', '-1')
        .append($anchor.append($('<span class="airports--list--item--title"></span>').text(this.model.name)));
      return this;
    }

  });

  var AirportsView = Backbone.View.extend({
    tagName: "ul",

    className: 'airports-modal__list-container',

    render: function() {
      var $container = $('<div class="row"></div>')
      var totalAirports = _.size(this.model.airports);
      var maxColumnItems = Math.ceil(totalAirports / 3);
      var airportsBuffer = [];

      this.$el
        .addClass("tab-pane")
        .addClass("row")
        .attr("tabindex", "-1")
        .attr("id", this.model.type)
        .attr("role", "tabpanel")
        .attr("aria-labelledby", this.model.type + "-tab")
        .addClass(this.model.isActive ? "active": "")

      _.each(this.model.airports, function(value, index) {
        if (_.indexOf(this.model.excludeAirports, index) === -1) {
          var airportAnchorElement = new AirportAnchorElement({ model: { name: value, id: index } });
          airportsBuffer.push(airportAnchorElement.render().el)

          if (airportsBuffer.length / maxColumnItems === 1) {
            var $columnContainer = $('<div class="airports-modal__column"></div>').append(airportsBuffer);
            $container.append($columnContainer);
            airportsBuffer = []
          }
        }
      }, this);

      var $columnContainer = $('<div class="airports-modal__column"></div>').append(airportsBuffer);
      $container.append($columnContainer);

      this.$el
      .addClass('airports--'+ this.model.type)
      .append($container);

      return this;
    }
  });

  var AirportTabs = Backbone.View.extend({
    tagName: "div",

    className: "nav nav-tabs airports-modal__tabs-container",

    render: function () {
      var nationalAnchor = $('<a class="nav-link active" id="national-tab" href="#national" role="tab" aria-controls="national" data-toggle="tab" aria-selected="true"></a>').text(Drupal.t("national"));
      var internationlAnchor = $('<a class="nav-link" id="international-tab" href="#international" role="tab" aria-controls="international"  data-toggle="tab" aria-selected="false"></a>').text(Drupal.t("international"));

      this.$el
        .attr("id", "airports-navigation")
        .attr("role", "tablist")
        .append([
          $('<li class="nav-item active airports-modal__tabs-item"></li>').append(nationalAnchor),
          $('<li class="nav-item airports-modal__tabs-item"></li>').append(internationlAnchor)
        ])

      return this;
    }
  });

  var ActionButtons = Backbone.View.extend({
    element: "div",

    className: "modal-footer airports-modal__see-more",

    render: function() {
      this.$el.append($('<div class="airports-modal__bottom-wrapper"><hr class="airports-modal__strike-through" /> <a class="airports-modal__action"><span class="airports-modal__text">' + Drupal.t('See more destinations') + '</span><span class="airports-modal__icon">+<span></a><div class="airports-modal__bg-line"></div></div>'));
      return this;
    }
  })

  Drupal.ticketSearch.views.AllAirports = Backbone.View.extend({

    tagName: "div",

    className: 'airports',

    initialize: function() {
      this.airports = drupalSettings.ticketSearch.airports || {
        national: {},
        international: {},
        grouper: [],
      };
      this.render();
    },

    renderAirports: function(key, label) {
      var airportsView = new AirportsView({
        model: {
          type: key,
          airports: this.airports[key],
          excludeAirports: this.model.excludeAirports
        }
      });
      this.$el.append([
        $('<h3 class="airports--title"></h3>').text(Drupal.t(label)),
        airportsView.render().el
      ]);
    },

    renderTabs: function() {
      var airportTabs = new AirportTabs();

      this.$el.append([
        airportTabs.render().el
      ])
    },

    renderTabsContent: function() {
      var $container = $('<div class="tab-content"></div>');

      var airportNationalContent = new AirportsView({
        model: {
          isActive: true,
          type: "national",
          airports: this.airports.national,
          excludeAirports: this.model.excludeAirports
        }
      });

      var airportInternationalContent = new AirportsView({
        model: {
          isActive: false,
          type: "international",
          airports: this.airports.international,
          excludeAirports: this.model.excludeAirports
        }
      });

      $container.append([
        airportNationalContent.render().el,
        airportInternationalContent.render().el
      ])

      this.$el.append($container);
    },

    render: function() {
      this.renderTabs();
      this.renderTabsContent();
      this.$el.append((new ActionButtons).render().el);
      return this;
    }
  });

})(jQuery, Backbone, Drupal, drupalSettings);
;
(function ($, Backbone, Drupal) {
  'use strict';

  var Error = Backbone.View.extend({
    tagName: "li",
    className: 'errors--list--item',
    render: function() {
      this.$el.append(this.model.error);
      return this;
    }
  });

  var ErrorsList = Backbone.View.extend({
    tagName: "ul",
    className: 'errors--list',
    render: function() {
      _.each(this.model.errors, function(error, index) {
        this.$el
          .append(new Error({ model: { error: error, id: index } }).render().el);
      }, this);
      return this;
    }
  });

  var ErrorsTitle = Backbone.View.extend({
    tagName: "div",
    className: 'errors--title',
    render: function() {
      this.$el
        .append([
          $('<span class="errors--title--text"><span class="errors--title--icon"></span></span>')
            .append($('<h2></h2>').text(Drupal.t('Attention')))
        ]);
      return this;
    }
  });

  Drupal.ticketSearch.views.Errors = Backbone.View.extend({
    tagName: "div",
    className: 'errors',

    initialize: function() {
      this.render();
    },

    render: function() {
      this.$el.append([
        new ErrorsTitle().render().el,
        new ErrorsList({ model: { errors: this.model } }).render().el,
      ]);
      return this;
    }

  });

})(jQuery, Backbone, Drupal);;
(function ($, Drupal, drupalSettings) {
  'use strict';

  Drupal.behaviors.smilesAndMoney = {
    attach: function(context, settings) {
      var routeValue = '';
      var originValue = '';
      var destinationValue = '';

      $(context).find("#ticket-search").once("smiles-money-form").each(function () {
        var smilesData = $.parseJSON(drupalSettings.smilesAndMoney.data);
        var smilesMoneyEnabled = false;

        var route =  $('input[name$="route_type_option"]');
        var origin =  $('select[name$="origin"]');
        var destination =  $('select[name$="destiny"]');

        var notUseSmiles = $('input[name$="use_smiles"][value=false]');
        var promoCode = $('input[name$="promo_code"]');

        var extraActions = $('.extra-actions');

        var smilesContainer = extraActions.find('.smiles-money');
        var smilesContent = $('.smiles-money__content');
        // Exibido quando smiles & money est visvel.
        var stopOverPromoCodeDescription = $('.stop-over-promo-code__description');

        var promoCodeContent = $('.promo-code__content');
        // Exibido quando cdigo promocional est visvel.
        var smilesMoneyDescription = $('.smiles-money__description');

        var showSmilesBlock = $('.show-smiles-money-block');
        var hideSmilesBlock = $('.hide-smiles-money-block');

        var showPromoCodeBlock = $('.show-promo-code-block');
        var hidePromoCodeBlock = $('.hide-promo-code-block');

        verifyRouteValue(route.val());
        notUseSmiles.click();

        route.change(function() {
          verifyRouteValue($(this).val());
          verifySmilesAndMoney();
        });

        origin.change(function() {
          originValue = $(this).val();
          verifySmilesAndMoney();
        });

        destination.change(function() {
          destinationValue = $(this).val();
          verifySmilesAndMoney();
        });

        // Exibe a opo Smiles & Money.
        // btn "+ Smiles Money".
        showSmilesBlock.click(function() {
          // Inputs smiles money.
          smilesContent.show();
          // Promo code/stopover descritivo.
          stopOverPromoCodeDescription.show();
          // Listagem de botes de aes.
          extraActions.hide();
        });

        // Esconde a opo Smiles & Money.
        hideSmilesBlock.click(function() {
          // Inputs smiles money.
          smilesContent.hide();
          // Define smiles money como false.
          notUseSmiles.click();
          // Promo code/stopover descritivo.
          stopOverPromoCodeDescription.hide();
          // Listagem de botes de aes.
          extraActions.show();
        });

        // Exibe a opo Cdigo promocional.
        // btn "+ Inserir um cdigo promocional".
        showPromoCodeBlock.click(function() {
          // Inputs smiles money.
          promoCodeContent.removeClass('hidden');
          
          showPromoCodeBlock.attr('aria-expanded', 'true');
          if (smilesMoneyEnabled) {
            // Smiles & money descritivo.
            smilesMoneyDescription.show();

            // Inputs smiles money.
            smilesContainer.hide();
          }

          // Listagem de botes de aes.
          extraActions.find('.promo-code').css("display", "flex");

          promoCode.focus();
        });

        // Esconde a opo Cdigo promocional.
        hidePromoCodeBlock.click(function() {
          // Inputs smiles money.
          promoCodeContent.addClass('hidden');
          promoCode.val('');
          promoCode.trigger('change');

          showPromoCodeBlock.attr('aria-expanded', 'false');

          if (smilesMoneyEnabled) {
            // Smiles money descritivo.
            smilesMoneyDescription.hide();

            // Inputs smiles money.
            smilesContainer.css("display", "flex");
          }

          // Listagem de botes de aes.
          extraActions.find('.promo-code').show();
          showPromoCodeBlock.focus();
        });

        function verifyRouteValue(value) {
          if (value == 'RoundTrip') {
            routeValue = 'True';
          } else {
            routeValue = 'False';
          }
        }

        function verifySmilesAndMoney() {
          if (routeValue && originValue && destinationValue) {
            var result = $.grep(smilesData, function (d, i) {
              return (
                d.IsRoundTrip == routeValue &&
                d.Origin.StationCode == originValue &&
                d.Destination.StationCode == destinationValue
              );
            }, false);

            if (result && result.length > 0) {
              smilesMoneyEnabled = true;

              if (promoCodeContent.hasClass('hidden')) {
                smilesContainer.css("display", "flex");
              } else {
                smilesMoneyDescription.show();
              }
            } else {
              smilesMoneyEnabled = false;
              notUseSmiles.click();
              smilesContent.hide();
              smilesMoneyDescription.hide();

              if (!promoCodeContent.hasClass('hidden') || smilesMoneyEnabled === false) {
                smilesContainer.hide();
                stopOverPromoCodeDescription.hide();
                // Listagem de botes de aes.
                extraActions.show();
              }

            }
          }
        }

        // Lgica para boto Voebiz
        let voebizChoice = $("#voebizchoice");
        let voebizBanner = $("#voebizbanner");

        voebizChoice.on("change", function(){
          if ($(this).is(':checked')) {
            voebizBanner.slideDown();
          } else {
            voebizBanner.slideUp();
          }
        });

      });
    }
  };
})(jQuery, Drupal, drupalSettings);
;
(function ($, Drupal, drupalSettings) {
  ("use strict");

  const BASE_URL = window.location.origin;
  const URL_AVAILABLE_DAYS = '/api/flights/available-days';

  var $helper = Drupal.behaviors.Helpers;

  Drupal.behaviors.flightPrices = {
    requestCanBeDone: function(formValues, ticketSearchFormModel) {
      if (ticketSearchFormModel.get('invalid_route')) {
        return false;
      }

      if ((!formValues.de || !formValues.para) || (formValues.de == formValues.para)) {
        return false;
      }

      return true;
    },

    getAvailableDays: function(formValues, ticketSearchFormModel) {
      if (!this.requestCanBeDone(formValues, ticketSearchFormModel)) {
        return;
      }

      let invalidRoute = ticketSearchFormModel.defaults().invalid_route;
      let result = [];
      let urlPrefix = (drupalSettings.ticketSearch.urlLanguagePrefix) ?
        '/' + drupalSettings.ticketSearch.urlLanguagePrefix :
        '';

      formValues.isMobilePage = drupalSettings.ticketSearch.isMobilePage;
      formValues.range = $helper.getRangeDays(formValues.ida);

      // Loading active.
      ticketSearchFormModel.set('loading_state', true);

      ticketSearchFormModel.set('available_days', []);
      ticketSearchFormModel.set('api_request_error', false);

      $.post({
        'url': BASE_URL + urlPrefix + URL_AVAILABLE_DAYS,
        'data':JSON.stringify(formValues),
        'timeout': drupalSettings.ticketSearch.requestTimeout ?? 1000,
      })
        .done(function(data) {
          result = data;
        })
        .fail(function(e) {
          console.error(Drupal.t('Error while doing the request'), e);

          if (e.status != 406) {
            ticketSearchFormModel.set('api_request_error', true);
          }

          if (e.status == 406) {
            invalidRoute = true;

            console.error(Drupal.t('Invalid Route'));
          }
        })
        .always(function() {
          ticketSearchFormModel.set(
            'invalid_route',
            invalidRoute
          );

          ticketSearchFormModel.set(
            'available_days',
            (result.success) ? result.availableDays : []
          );

          // Loading inactive.
          ticketSearchFormModel.set('loading_state', false);
        });
    },
  }
})(jQuery, Drupal, drupalSettings);
;
(function ($, Drupal, drupalSettings, window) {
  ("use strict");

  var $dataLayerObj = {
    'event': 'search',
    'dl_infos': {
      search_term: '',
      origin: '',
      destination: '',
      route_type: 'Ida',
      route: '',
      number_of_passengers: 1,
      adult_passengers: 1,
      teen_passengers: 0,
      child_passengers: 0,
      baby_passengers: 0,
      selling_environment: 'Institucional',
      start_date: '',
      end_date: undefined,
      flight_type: 'Nacional',
      advp_range: '',
    }
  };

  var $formValues = undefined;

  var $helper = Drupal.behaviors.Helpers;

  Drupal.behaviors.flightPricesDataLayer = {
    isRequiredValuesAvailable: function() {
      var requiredFields = [
        'origin',
        'destination',
        'route',
        'adult',
        'departureDate',
      ];

      if ($formValues.route.toLowerCase() != "oneway") {
        requiredFields.push('returnDate');
      }

      let isValid = true;

      _.each(requiredFields, function (field) {
        if (!$formValues[field]) {
          isValid = false;
        }
      });

      return isValid;
    },

    getAdpvRange: function() {
      let numberOfDays = 0;
      
      if ($formValues.departureDate) {
        let departure = new Date(this.formatDateToUSFormat($formValues.departureDate));
        let currentDate = new Date();
       
        const dateDiff = Math.abs(currentDate - departure);
        numberOfDays = Math.ceil(dateDiff / (1000 * 60 * 60 * 24));
      }

      if (numberOfDays >= 0 && numberOfDays <= 3) {
        return '0 a 3 dias';
      } else if (numberOfDays >= 4 && numberOfDays <= 6) {
        return '4 a 6 dias';
      } else if (numberOfDays >= 7 && numberOfDays <= 13) {
        return '7 a 13 dias';
      } else if (numberOfDays >= 14 && numberOfDays <= 20) {
        return '14 a 20 dias';
      } else if (numberOfDays >= 21 && numberOfDays <= 27) {
        return '21 a 27 dias';
      } else if (numberOfDays >= 28 && numberOfDays <= 59) {
        return '28 a 59 dias';
      } else if (numberOfDays >= 60 && numberOfDays <= 89) {
        return '60 a 89 dias';
      } else if (numberOfDays >= 90) {
        return 'Acima de 90 dias';
      } else {
        return `No definido: ${numberOfDays} dias`;
      }
    },

    getFlightType: function() {
      if (
        drupalSettings.ticketSearch.airports.national.hasOwnProperty($formValues.origin) &&
        drupalSettings.ticketSearch.airports.national.hasOwnProperty($formValues.destination)
      ) {
        return 'Nacional';
      }

      return 'Internacional';
    },

    sumPassengerNumber: function() {
      return parseInt($formValues.adult) + 
        parseInt($formValues.teen) +
        parseInt($formValues.baby) +
        parseInt($formValues.children);
    },

    formatDateToBrazilianFormat: function(dateToFormat) {
      let pieces = dateToFormat.match(/(\d+)/g);

      return `${pieces[0]}/${pieces[1]}/${pieces[2]}`;
    },

    formatDateToUSFormat: function(dateToFormat) {
      let pieces = dateToFormat.match(/(\d+)/g);

      return `${pieces[1]},${pieces[0]},${pieces[2]}`;
    },

    setDataLayer: function(formValues) {
      $formValues = formValues;

      if (!this.isRequiredValuesAvailable()) {
        return false;
      }

      let selectedRoute = `${formValues.origin}-${formValues.destination}`;

      $dataLayerObj.dl_infos.search_term = selectedRoute;
      $dataLayerObj.dl_infos.origin = formValues.origin;
      $dataLayerObj.dl_infos.destination = formValues.destination;
      $dataLayerObj.dl_infos.route = selectedRoute;
      $dataLayerObj.dl_infos.number_of_passengers = this.sumPassengerNumber();
      $dataLayerObj.dl_infos.adult_passengers = parseInt(formValues.adult);
      $dataLayerObj.dl_infos.teen_passengers = parseInt(formValues.teen);
      $dataLayerObj.dl_infos.child_passengers = parseInt(formValues.children);
      $dataLayerObj.dl_infos.baby_passengers = parseInt(formValues.baby);
      $dataLayerObj.dl_infos.start_date = this.formatDateToBrazilianFormat(formValues.departureDate);
      $dataLayerObj.dl_infos.flight_type = this.getFlightType();
      $dataLayerObj.dl_infos.advp_range = this.getAdpvRange();

      if (formValues.route.toLowerCase() != "oneway") {
        selectedRoute = `${formValues.origin}-${formValues.destination}|${formValues.destination}-${formValues.origin}`;
        
        $dataLayerObj.dl_infos.search_term = selectedRoute;
        $dataLayerObj.dl_infos.route = selectedRoute;
        $dataLayerObj.dl_infos.route_type = "Ida e Volta";
        $dataLayerObj.dl_infos.end_date = this.formatDateToBrazilianFormat(formValues.returnDate);
      }

      if (window.dataLayer.length > 0) {
        // Ensure the dataLayer object exists and has length greater than 0
        $('#ticket-search-submit.btn.btn-primary.float-right').on('click', function() {
          // Push the dataLayer object to the window.dataLayer after click
          window.dataLayer.push($dataLayerObj);
        });
      }
    },
  }
})(jQuery, Drupal, drupalSettings, window);;
/**
 * @file
 * Acessibility.
 *
 */
 (function ($, Drupal, drupalSettings, window) {
  "use strict";

  Drupal.behaviors.acessibility = {
    attach: function (context, settings) {
      var $html = $("html");

      var theme_voegol = $(context)
        .find("html.theme-default")
        .once("theme-processed");
      if (theme_voegol.length) {
        if (drupalSettings.acessibility.theme_highcontrast) {
          $html.addClass("theme-highcontrast").removeClass("theme-default");
        }
        else {
          var localTheme =
          window.localStorage.getItem("theme") || "theme-default";
          if (localTheme !== "theme-default") {
            $html.addClass("theme-highcontrast").removeClass("theme-default");
          }
        }
      }

      $(".acessibility-menu__button", context)
        .once("acessibility-processed")
        .click(function () {
          var current_theme = $html.hasClass("theme-default")
            ? "theme-default"
            : "theme-highcontrast";
          $html.toggleClass("theme-default").toggleClass("theme-highcontrast");
          window.localStorage.setItem(
            "theme",
            current_theme == "theme-default"
              ? "theme-highcontrast"
              : "theme-default"
          );
        });
    },
  };
})(jQuery, Drupal, drupalSettings, window);
;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal, debounce) {
  $.fn.drupalGetSummary = function () {
    var callback = this.data('summaryCallback');
    return this[0] && callback ? $.trim(callback(this[0])) : '';
  };

  $.fn.drupalSetSummary = function (callback) {
    var self = this;

    if (typeof callback !== 'function') {
      var val = callback;
      callback = function callback() {
        return val;
      };
    }

    return this.data('summaryCallback', callback).off('formUpdated.summary').on('formUpdated.summary', function () {
      self.trigger('summaryUpdated');
    }).trigger('summaryUpdated');
  };

  Drupal.behaviors.formSingleSubmit = {
    attach: function attach() {
      function onFormSubmit(e) {
        var $form = $(e.currentTarget);
        var formValues = $form.serialize();
        var previousValues = $form.attr('data-drupal-form-submit-last');
        if (previousValues === formValues) {
          e.preventDefault();
        } else {
          $form.attr('data-drupal-form-submit-last', formValues);
        }
      }

      $('body').once('form-single-submit').on('submit.singleSubmit', 'form:not([method~="GET"])', onFormSubmit);
    }
  };

  function triggerFormUpdated(element) {
    $(element).trigger('formUpdated');
  }

  function fieldsList(form) {
    var $fieldList = $(form).find('[name]').map(function (index, element) {
      return element.getAttribute('id');
    });

    return $.makeArray($fieldList);
  }

  Drupal.behaviors.formUpdated = {
    attach: function attach(context) {
      var $context = $(context);
      var contextIsForm = $context.is('form');
      var $forms = (contextIsForm ? $context : $context.find('form')).once('form-updated');
      var formFields = void 0;

      if ($forms.length) {
        $.makeArray($forms).forEach(function (form) {
          var events = 'change.formUpdated input.formUpdated ';
          var eventHandler = debounce(function (event) {
            triggerFormUpdated(event.target);
          }, 300);
          formFields = fieldsList(form).join(',');

          form.setAttribute('data-drupal-form-fields', formFields);
          $(form).on(events, eventHandler);
        });
      }

      if (contextIsForm) {
        formFields = fieldsList(context).join(',');

        var currentFields = $(context).attr('data-drupal-form-fields');

        if (formFields !== currentFields) {
          triggerFormUpdated(context);
        }
      }
    },
    detach: function detach(context, settings, trigger) {
      var $context = $(context);
      var contextIsForm = $context.is('form');
      if (trigger === 'unload') {
        var $forms = (contextIsForm ? $context : $context.find('form')).removeOnce('form-updated');
        if ($forms.length) {
          $.makeArray($forms).forEach(function (form) {
            form.removeAttribute('data-drupal-form-fields');
            $(form).off('.formUpdated');
          });
        }
      }
    }
  };

  Drupal.behaviors.fillUserInfoFromBrowser = {
    attach: function attach(context, settings) {
      var userInfo = ['name', 'mail', 'homepage'];
      var $forms = $('[data-user-info-from-browser]').once('user-info-from-browser');
      if ($forms.length) {
        userInfo.forEach(function (info) {
          var $element = $forms.find('[name=' + info + ']');
          var browserData = localStorage.getItem('Drupal.visitor.' + info);
          var emptyOrDefault = $element.val() === '' || $element.attr('data-drupal-default-value') === $element.val();
          if ($element.length && emptyOrDefault && browserData) {
            $element.val(browserData);
          }
        });
      }
      $forms.on('submit', function () {
        userInfo.forEach(function (info) {
          var $element = $forms.find('[name=' + info + ']');
          if ($element.length) {
            localStorage.setItem('Drupal.visitor.' + info, $element.val());
          }
        });
      });
    }
  };

  var handleFragmentLinkClickOrHashChange = function handleFragmentLinkClickOrHashChange(e) {
    var url = void 0;
    if (e.type === 'click') {
      url = e.currentTarget.location ? e.currentTarget.location : e.currentTarget;
    } else {
      url = window.location;
    }
    var hash = url.hash.substr(1);
    if (hash) {
      var $target = $('#' + hash);
      $('body').trigger('formFragmentLinkClickOrHashChange', [$target]);

      setTimeout(function () {
        return $target.trigger('focus');
      }, 300);
    }
  };

  var debouncedHandleFragmentLinkClickOrHashChange = debounce(handleFragmentLinkClickOrHashChange, 300, true);

  $(window).on('hashchange.form-fragment', debouncedHandleFragmentLinkClickOrHashChange);

  $(document).on('click.form-fragment', 'a[href*="#"]', debouncedHandleFragmentLinkClickOrHashChange);
})(jQuery, Drupal, Drupal.debounce);;
/**
 * @file
 * Webform behaviors.
 */

(function ($, Drupal) {

  'use strict';

  // Trigger Drupal's attaching of behaviors after the page is
  // completely loaded.
  // @see https://stackoverflow.com/questions/37838430/detect-if-page-is-load-from-back-button
  // @see https://stackoverflow.com/questions/20899274/how-to-refresh-page-on-back-button-click/20899422#20899422
  var isChrome = (/chrom(e|ium)/.test(window.navigator.userAgent.toLowerCase()));
  if (isChrome) {
    // Track back button in navigation.
    // @see https://stackoverflow.com/questions/37838430/detect-if-page-is-load-from-back-button
    var backButton = false;
    if (window.performance) {
      var navEntries = window.performance.getEntriesByType('navigation');
      if (navEntries.length > 0 && navEntries[0].type === 'back_forward') {
        backButton = true;
      }
      else if (window.performance.navigation
        && window.performance.navigation.type === window.performance.navigation.TYPE_BACK_FORWARD) {
        backButton = true;
      }
    }

    // If the back button is pressed, delay Drupal's attaching of behaviors.
    if (backButton) {
      var attachBehaviors = Drupal.attachBehaviors;
      Drupal.attachBehaviors = function (context, settings) {
        setTimeout(function (context, settings) {
          attachBehaviors(context, settings);
        }, 300);
      };
    }
  }

})(jQuery, Drupal);
;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function ($, Drupal) {
  var states = {
    postponed: []
  };

  Drupal.states = states;

  function invert(a, invertState) {
    return invertState && typeof a !== 'undefined' ? !a : a;
  }

  function _compare2(a, b) {
    if (a === b) {
      return typeof a === 'undefined' ? a : true;
    }

    return typeof a === 'undefined' || typeof b === 'undefined';
  }

  function ternary(a, b) {
    if (typeof a === 'undefined') {
      return b;
    }
    if (typeof b === 'undefined') {
      return a;
    }

    return a && b;
  }

  Drupal.behaviors.states = {
    attach: function attach(context, settings) {
      var $states = $(context).find('[data-drupal-states]');
      var il = $states.length;

      var _loop = function _loop(i) {
        var config = JSON.parse($states[i].getAttribute('data-drupal-states'));
        Object.keys(config || {}).forEach(function (state) {
          new states.Dependent({
            element: $($states[i]),
            state: states.State.sanitize(state),
            constraints: config[state]
          });
        });
      };

      for (var i = 0; i < il; i++) {
        _loop(i);
      }

      while (states.postponed.length) {
        states.postponed.shift()();
      }
    }
  };

  states.Dependent = function (args) {
    var _this = this;

    $.extend(this, { values: {}, oldValue: null }, args);

    this.dependees = this.getDependees();
    Object.keys(this.dependees || {}).forEach(function (selector) {
      _this.initializeDependee(selector, _this.dependees[selector]);
    });
  };

  states.Dependent.comparisons = {
    RegExp: function RegExp(reference, value) {
      return reference.test(value);
    },
    Function: function Function(reference, value) {
      return reference(value);
    },
    Number: function Number(reference, value) {
      return typeof value === 'string' ? _compare2(reference.toString(), value) : _compare2(reference, value);
    }
  };

  states.Dependent.prototype = {
    initializeDependee: function initializeDependee(selector, dependeeStates) {
      var _this2 = this;

      this.values[selector] = {};

      Object.keys(dependeeStates).forEach(function (i) {
        var state = dependeeStates[i];

        if ($.inArray(state, dependeeStates) === -1) {
          return;
        }

        state = states.State.sanitize(state);

        _this2.values[selector][state.name] = null;

        $(selector).on('state:' + state, { selector: selector, state: state }, function (e) {
          _this2.update(e.data.selector, e.data.state, e.value);
        });

        new states.Trigger({ selector: selector, state: state });
      });
    },
    compare: function compare(reference, selector, state) {
      var value = this.values[selector][state.name];
      if (reference.constructor.name in states.Dependent.comparisons) {
        return states.Dependent.comparisons[reference.constructor.name](reference, value);
      }

      return _compare2(reference, value);
    },
    update: function update(selector, state, value) {
      if (value !== this.values[selector][state.name]) {
        this.values[selector][state.name] = value;
        this.reevaluate();
      }
    },
    reevaluate: function reevaluate() {
      var value = this.verifyConstraints(this.constraints);

      if (value !== this.oldValue) {
        this.oldValue = value;

        value = invert(value, this.state.invert);

        this.element.trigger({
          type: 'state:' + this.state,
          value: value,
          trigger: true
        });
      }
    },
    verifyConstraints: function verifyConstraints(constraints, selector) {
      var result = void 0;
      if ($.isArray(constraints)) {
        var hasXor = $.inArray('xor', constraints) === -1;
        var len = constraints.length;
        for (var i = 0; i < len; i++) {
          if (constraints[i] !== 'xor') {
            var constraint = this.checkConstraints(constraints[i], selector, i);

            if (constraint && (hasXor || result)) {
              return hasXor;
            }
            result = result || constraint;
          }
        }
      } else if ($.isPlainObject(constraints)) {
          for (var n in constraints) {
            if (constraints.hasOwnProperty(n)) {
              result = ternary(result, this.checkConstraints(constraints[n], selector, n));

              if (result === false) {
                return false;
              }
            }
          }
        }
      return result;
    },
    checkConstraints: function checkConstraints(value, selector, state) {
      if (typeof state !== 'string' || /[0-9]/.test(state[0])) {
        state = null;
      } else if (typeof selector === 'undefined') {
        selector = state;
        state = null;
      }

      if (state !== null) {
        state = states.State.sanitize(state);
        return invert(this.compare(value, selector, state), state.invert);
      }

      return this.verifyConstraints(value, selector);
    },
    getDependees: function getDependees() {
      var cache = {};

      var _compare = this.compare;
      this.compare = function (reference, selector, state) {
        (cache[selector] || (cache[selector] = [])).push(state.name);
      };

      this.verifyConstraints(this.constraints);

      this.compare = _compare;

      return cache;
    }
  };

  states.Trigger = function (args) {
    $.extend(this, args);

    if (this.state in states.Trigger.states) {
      this.element = $(this.selector);

      if (!this.element.data('trigger:' + this.state)) {
        this.initialize();
      }
    }
  };

  states.Trigger.prototype = {
    initialize: function initialize() {
      var _this3 = this;

      var trigger = states.Trigger.states[this.state];

      if (typeof trigger === 'function') {
        trigger.call(window, this.element);
      } else {
        Object.keys(trigger || {}).forEach(function (event) {
          _this3.defaultTrigger(event, trigger[event]);
        });
      }

      this.element.data('trigger:' + this.state, true);
    },
    defaultTrigger: function defaultTrigger(event, valueFn) {
      var oldValue = valueFn.call(this.element);

      this.element.on(event, $.proxy(function (e) {
        var value = valueFn.call(this.element, e);

        if (oldValue !== value) {
          this.element.trigger({
            type: 'state:' + this.state,
            value: value,
            oldValue: oldValue
          });
          oldValue = value;
        }
      }, this));

      states.postponed.push($.proxy(function () {
        this.element.trigger({
          type: 'state:' + this.state,
          value: oldValue,
          oldValue: null
        });
      }, this));
    }
  };

  states.Trigger.states = {
    empty: {
      keyup: function keyup() {
        return this.val() === '';
      }
    },

    checked: {
      change: function change() {
        var checked = false;
        this.each(function () {
          checked = $(this).prop('checked');

          return !checked;
        });
        return checked;
      }
    },

    value: {
      keyup: function keyup() {
        if (this.length > 1) {
          return this.filter(':checked').val() || false;
        }
        return this.val();
      },
      change: function change() {
        if (this.length > 1) {
          return this.filter(':checked').val() || false;
        }
        return this.val();
      }
    },

    collapsed: {
      collapsed: function collapsed(e) {
        return typeof e !== 'undefined' && 'value' in e ? e.value : !this.is('[open]');
      }
    }
  };

  states.State = function (state) {
    this.pristine = state;
    this.name = state;

    var process = true;
    do {
      while (this.name.charAt(0) === '!') {
        this.name = this.name.substring(1);
        this.invert = !this.invert;
      }

      if (this.name in states.State.aliases) {
        this.name = states.State.aliases[this.name];
      } else {
        process = false;
      }
    } while (process);
  };

  states.State.sanitize = function (state) {
    if (state instanceof states.State) {
      return state;
    }

    return new states.State(state);
  };

  states.State.aliases = {
    enabled: '!disabled',
    invisible: '!visible',
    invalid: '!valid',
    untouched: '!touched',
    optional: '!required',
    filled: '!empty',
    unchecked: '!checked',
    irrelevant: '!relevant',
    expanded: '!collapsed',
    open: '!collapsed',
    closed: 'collapsed',
    readwrite: '!readonly'
  };

  states.State.prototype = {
    invert: false,

    toString: function toString() {
      return this.name;
    }
  };

  var $document = $(document);
  $document.on('state:disabled', function (e) {
    if (e.trigger) {
      $(e.target).prop('disabled', e.value).closest('.js-form-item, .js-form-submit, .js-form-wrapper').toggleClass('form-disabled', e.value).find('select, input, textarea').prop('disabled', e.value);
    }
  });

  $document.on('state:required', function (e) {
    if (e.trigger) {
      if (e.value) {
        var label = 'label' + (e.target.id ? '[for=' + e.target.id + ']' : '');
        var $label = $(e.target).attr({ required: 'required', 'aria-required': 'true' }).closest('.js-form-item, .js-form-wrapper').find(label);

        if (!$label.hasClass('js-form-required').length) {
          $label.addClass('js-form-required form-required');
        }
      } else {
        $(e.target).removeAttr('required aria-required').closest('.js-form-item, .js-form-wrapper').find('label.js-form-required').removeClass('js-form-required form-required');
      }
    }
  });

  $document.on('state:visible', function (e) {
    if (e.trigger) {
      $(e.target).closest('.js-form-item, .js-form-submit, .js-form-wrapper').toggle(e.value);
    }
  });

  $document.on('state:checked', function (e) {
    if (e.trigger) {
      $(e.target).prop('checked', e.value);
    }
  });

  $document.on('state:collapsed', function (e) {
    if (e.trigger) {
      if ($(e.target).is('[open]') === e.value) {
        $(e.target).find('> summary').trigger('click');
      }
    }
  });
})(jQuery, Drupal);;
/**
 * @file
 * JavaScript behaviors for custom webform #states.
 */

(function ($, Drupal) {

  'use strict';

  Drupal.webform = Drupal.webform || {};
  Drupal.webform.states = Drupal.webform.states || {};
  Drupal.webform.states.slideDown = Drupal.webform.states.slideDown || {};
  Drupal.webform.states.slideDown.duration = 'slow';
  Drupal.webform.states.slideUp = Drupal.webform.states.slideUp || {};
  Drupal.webform.states.slideUp.duration = 'fast';

  /* ************************************************************************ */
  // jQuery functions.
  /* ************************************************************************ */

  /**
   * Check if an element has a specified data attribute.
   *
   * @param {string} data
   *   The data attribute name.
   *
   * @return {boolean}
   *   TRUE if an element has a specified data attribute.
   */
  $.fn.hasData = function (data) {
    return (typeof this.data(data) !== 'undefined');
  };

  /**
   * Check if element is within the webform or not.
   *
   * @return {boolean}
   *   TRUE if element is within the webform.
   */
  $.fn.isWebform = function () {
    return $(this).closest('form[id^="webform"], form[data-is-webform]').length ? true : false;
  };

  /**
   * Check if element is to be treated as a webform element.
   *
   * @return {boolean}
   *   TRUE if element is to be treated as a webform element.
   */
  $.fn.isWebformElement = function () {
    return ($(this).isWebform() || $(this).closest('[data-is-webform-element]').length) ? true : false;
  };

  /* ************************************************************************ */
  // Trigger.
  /* ************************************************************************ */

  // The change event is triggered by cut-n-paste and select menus.
  // Issue #2445271: #states element empty check not triggered on mouse
  // based paste.
  // @see https://www.drupal.org/node/2445271
  Drupal.states.Trigger.states.empty.change = function change() {
    return this.val() === '';
  };

  /* ************************************************************************ */
  // Dependents.
  /* ************************************************************************ */


  // Apply solution included in #1962800 patch.
  // Issue #1962800: Form #states not working with literal integers as
  // values in IE11.
  // @see https://www.drupal.org/project/drupal/issues/1962800
  // @see https://www.drupal.org/files/issues/core-states-not-working-with-integers-ie11_1962800_46.patch
  //
  // This issue causes pattern, less than, and greater than support to break.
  // @see https://www.drupal.org/project/webform/issues/2981724
  var states = Drupal.states;
  Drupal.states.Dependent.prototype.compare = function compare(reference, selector, state) {
    var value = this.values[selector][state.name];

    var name = reference.constructor.name;
    if (!name) {
      name = $.type(reference);

      name = name.charAt(0).toUpperCase() + name.slice(1);
    }
    if (name in states.Dependent.comparisons) {
      return states.Dependent.comparisons[name](reference, value);
    }

    if (reference.constructor.name in states.Dependent.comparisons) {
      return states.Dependent.comparisons[reference.constructor.name](reference, value);
    }

    return _compare2(reference, value);
  };
  function _compare2(a, b) {
    if (a === b) {
      return typeof a === 'undefined' ? a : true;
    }

    return typeof a === 'undefined' || typeof b === 'undefined';
  }

  // Adds pattern, less than, and greater than support to #state API.
  // @see http://drupalsun.com/julia-evans/2012/03/09/extending-form-api-states-regular-expressions
  Drupal.states.Dependent.comparisons.Object = function (reference, value) {
    if ('pattern' in reference) {
      return (new RegExp(reference['pattern'])).test(value);
    }
    else if ('!pattern' in reference) {
      return !((new RegExp(reference['!pattern'])).test(value));
    }
    else if ('less' in reference) {
      return (value !== '' && parseFloat(reference['less']) > parseFloat(value));
    }
    else if ('less_equal' in reference) {
      return (value !== '' && parseFloat(reference['less_equal']) >= parseFloat(value));
    }
    else if ('greater' in reference) {
      return (value !== '' && parseFloat(reference['greater']) < parseFloat(value));
    }
    else if ('greater_equal' in reference) {
      return (value !== '' && parseFloat(reference['greater_equal']) <= parseFloat(value));
    }
    else if ('between' in reference || '!between' in reference) {
      if (value === '') {
        return false;
      }

      var between = reference['between'] || reference['!between'];
      var betweenParts = between.split(':');
      var greater = betweenParts[0];
      var less = (typeof betweenParts[1] !== 'undefined') ? betweenParts[1] : null;
      var isGreaterThan = (greater === null || greater === '' || parseFloat(value) >= parseFloat(greater));
      var isLessThan = (less === null || less === '' || parseFloat(value) <= parseFloat(less));
      var result = (isGreaterThan && isLessThan);
      return (reference['!between']) ? !result : result;
    }
    else {
      return reference.indexOf(value) !== false;
    }
  };

  /* ************************************************************************ */
  // States events.
  /* ************************************************************************ */

  var $document = $(document);

  $document.on('state:required', function (e) {
    if (e.trigger && $(e.target).isWebformElement()) {
      var $target = $(e.target);
      // Fix #required file upload.
      // @see Issue #2860529: Conditional required File upload field don't work.
      toggleRequired($target.find('input[type="file"]'), e.value);

      // Fix #required for radios.
      // @see Issue #2856795: If radio buttons are required but not filled form is nevertheless submitted.
      if ($target.is('.js-form-type-radios, .js-form-type-webform-radios-other, .js-webform-type-radios, .js-webform-type-webform-radios-other')) {
        toggleRequired($target.find('input[type="radio"]'), e.value);
      }

      // Fix #required for checkboxes.
      // @see Issue #2938414: Checkboxes don't support #states required.
      // @see checkboxRequiredhandler
      if ($target.is('.js-form-type-checkboxes, .js-form-type-webform-checkboxes-other, .js-webform-type-checkboxes, .js-webform-type-webform-checkboxes-other')) {
        var $checkboxes = $target.find('input[type="checkbox"]');
        if (e.value) {
          // Add event handler.
          $checkboxes.on('click', statesCheckboxesRequiredEventHandler);
          // Initialize and add required attribute.
          checkboxesRequired($target);
        }
        else {
          // Remove event handler.
          $checkboxes.off('click', statesCheckboxesRequiredEventHandler);
          // Remove required attribute.
          toggleRequired($checkboxes, false);
        }
      }

      // Fix required label for elements without the for attribute.
      // @see Issue #3145300: Conditional Visible Select Other not working.
      if ($target.is('.js-form-type-webform-select-other, .js-webform-type-webform-select-other')) {
        var $select = $target.find('select');
        toggleRequired($select, e.value);
        copyRequireMessage($target, $select);
      }
      if ($target.find('> label:not([for])').length) {
        $target.find('> label').toggleClass('js-form-required form-required', e.value);
      }

      // Fix required label for checkboxes and radios.
      // @see Issue #2938414: Checkboxes don't support #states required
      // @see Issue #2731991: Setting required on radios marks all options required.
      // @see Issue #2856315: Conditional Logic - Requiring Radios in a Fieldset.
      // Fix #required for fieldsets.
      // @see Issue #2977569: Hidden fieldsets that become visible with conditional logic cannot be made required.
      if ($target.is('.js-webform-type-radios, .js-webform-type-checkboxes, fieldset')) {
        $target.find('legend span.fieldset-legend:not(.visually-hidden)').toggleClass('js-form-required form-required', e.value);
      }

      // Issue #2986017: Fieldsets shouldn't have required attribute.
      if ($target.is('fieldset')) {
        $target.removeAttr('required aria-required');
      }
    }
  });

  $document.on('state:checked', function (e) {
    if (e.trigger) {
      $(e.target).trigger('change');
    }
  });

  $document.on('state:readonly', function (e) {
    if (e.trigger && $(e.target).isWebformElement()) {
      $(e.target).prop('readonly', e.value).closest('.js-form-item, .js-form-wrapper').toggleClass('webform-readonly', e.value).find('input, textarea').prop('readonly', e.value);

      // Trigger webform:readonly.
      $(e.target).trigger('webform:readonly')
        .find('select, input, textarea, button').trigger('webform:readonly');
    }
  });

  $document.on('state:visible state:visible-slide', function (e) {
    if (e.trigger && $(e.target).isWebformElement()) {
      if (e.value) {
        $(':input', e.target).addBack().each(function () {
          restoreValueAndRequired(this);
          triggerEventHandlers(this);
        });
      }
      else {
        // @see https://www.sitepoint.com/jquery-function-clear-form-data/
        $(':input', e.target).addBack().each(function () {
          backupValueAndRequired(this);
          clearValueAndRequired(this);
          triggerEventHandlers(this);
        });
      }
    }
  });

  $document.on('state:visible-slide', function (e) {
    if (e.trigger && $(e.target).isWebformElement()) {
      var effect = e.value ? 'slideDown' : 'slideUp';
      var duration = Drupal.webform.states[effect].duration;
      $(e.target).closest('.js-form-item, .js-form-submit, .js-form-wrapper')[effect](duration);
    }
  });
  Drupal.states.State.aliases['invisible-slide'] = '!visible-slide';

  $document.on('state:disabled', function (e) {
    if (e.trigger && $(e.target).isWebformElement()) {
      // Make sure disabled property is set before triggering webform:disabled.
      // Copied from: core/misc/states.js
      $(e.target)
        .prop('disabled', e.value)
        .closest('.js-form-item, .js-form-submit, .js-form-wrapper').toggleClass('form-disabled', e.value)
        .find('select, input, textarea, button').prop('disabled', e.value);

      // Never disable hidden file[fids] because the existing values will
      // be completely lost when the webform is submitted.
      var fileElements = $(e.target)
        .find(':input[type="hidden"][name$="[fids]"]');
      if (fileElements.length) {
        // Remove 'disabled' attribute from fieldset which will block
        // all disabled elements from being submitted.
        if ($(e.target).is('fieldset')) {
          $(e.target).prop('disabled', false);
        }
        fileElements.removeAttr('disabled');
      }

      // Trigger webform:disabled.
      $(e.target).trigger('webform:disabled')
        .find('select, input, textarea, button').trigger('webform:disabled');
    }
  });

  /* ************************************************************************ */
  // Behaviors.
  /* ************************************************************************ */

  /**
   * Adds HTML5 validation to required checkboxes.
   *
   * @type {Drupal~behavior}
   *
   * @see https://www.drupal.org/project/webform/issues/3068998
   */
  Drupal.behaviors.webformCheckboxesRequired = {
    attach: function (context) {
      $('.js-form-type-checkboxes.required, .js-form-type-webform-checkboxes-other.required, .js-webform-type-checkboxes.required, .js-webform-type-webform-checkboxes-other.required, .js-webform-type-webform-radios-other.checkboxes', context)
        .once('webform-checkboxes-required')
        .each(function () {
          var $element = $(this);
          $element.find('input[type="checkbox"]').on('click', statesCheckboxesRequiredEventHandler);
          setTimeout(function () {checkboxesRequired($element);});
        });
    }
  };

  /**
   * Adds HTML5 validation to required radios.
   *
   * @type {Drupal~behavior}
   *
   * @see https://www.drupal.org/project/webform/issues/2856795
   */
  Drupal.behaviors.webformRadiosRequired = {
    attach: function (context) {
      $('.js-form-type-radios, .js-form-type-webform-radios-other, .js-webform-type-radios, .js-webform-type-webform-radios-other', context)
        .once('webform-radios-required')
        .each(function () {
          var $element = $(this);
          setTimeout(function () {radiosRequired($element);});
        });
    }
  };

  /**
   * Add HTML5 multiple checkboxes required validation.
   *
   * @param {jQuery} $element
   *   An jQuery object containing HTML5 radios.
   *
   * @see https://stackoverflow.com/a/37825072/145846
   */
  function checkboxesRequired($element) {
    var $firstCheckbox = $element.find('input[type="checkbox"]').first();
    var isChecked = $element.find('input[type="checkbox"]').is(':checked');
    toggleRequired($firstCheckbox, !isChecked);
    copyRequireMessage($element, $firstCheckbox);
  }

  /**
   * Add HTML5 radios required validation.
   *
   * @param {jQuery} $element
   *   An jQuery object containing HTML5 radios.
   *
   * @see https://www.drupal.org/project/webform/issues/2856795
   */
  function radiosRequired($element) {
    var $radios = $element.find('input[type="radio"]');
    var isRequired = $element.hasClass('required');
    toggleRequired($radios, isRequired);
    copyRequireMessage($element, $radios);
  }

  /* ************************************************************************ */
  // Event handlers.
  /* ************************************************************************ */

  /**
   * Trigger #states API HTML5 multiple checkboxes required validation.
   *
   * @see https://stackoverflow.com/a/37825072/145846
   */
  function statesCheckboxesRequiredEventHandler() {
    var $element = $(this).closest('.js-webform-type-checkboxes, .js-webform-type-webform-checkboxes-other');
    checkboxesRequired($element);
  }

  /**
   * Trigger an input's event handlers.
   *
   * @param {element} input
   *   An input.
   */
  function triggerEventHandlers(input) {
    var $input = $(input);
    var type = input.type;
    var tag = input.tagName.toLowerCase();
    // Add 'webform.states' as extra parameter to event handlers.
    // @see Drupal.behaviors.webformUnsaved
    var extraParameters = ['webform.states'];
    if (type === 'checkbox' || type === 'radio') {
      $input
        .trigger('change', extraParameters)
        .trigger('blur', extraParameters);
    }
    else if (tag === 'select') {
      // Do not trigger the onchange event for Address element's country code
      // when it is initialized.
      // @see \Drupal\address\Element\Country
      if ($input.closest('.webform-type-address').length) {
        if (!$input.data('webform-states-address-initialized')
          && $input.attr('autocomplete') === 'country'
          && $input.val() === $input.find("option[selected]").attr('value')) {
          return;
        }
        $input.data('webform-states-address-initialized', true);
      }

      $input
        .trigger('change', extraParameters)
        .trigger('blur', extraParameters);
    }
    else if (type !== 'submit' && type !== 'button' && type !== 'file') {
      // Make sure input mask is removed and then reset when value is restored.
      // @see https://www.drupal.org/project/webform/issues/3124155
      // @see https://www.drupal.org/project/webform/issues/3202795
      var hasInputMask = ($.fn.inputmask && $input.hasClass('js-webform-input-mask'));
      hasInputMask && $input.inputmask('remove');

      $input
        .trigger('input', extraParameters)
        .trigger('change', extraParameters)
        .trigger('keydown', extraParameters)
        .trigger('keyup', extraParameters)
        .trigger('blur', extraParameters);

      hasInputMask && $input.inputmask();
    }
  }

  /* ************************************************************************ */
  // Backup and restore value functions.
  /* ************************************************************************ */

  /**
   * Backup an input's current value and required attribute
   *
   * @param {element} input
   *   An input.
   */
  function backupValueAndRequired(input) {
    var $input = $(input);
    var type = input.type;
    var tag = input.tagName.toLowerCase(); // Normalize case.

    // Backup required.
    if ($input.prop('required') && !$input.hasData('webform-required')) {
      $input.data('webform-required', true);
    }

    // Backup value.
    if (!$input.hasData('webform-value')) {
      if (type === 'checkbox' || type === 'radio') {
        $input.data('webform-value', $input.prop('checked'));
      }
      else if (tag === 'select') {
        var values = [];
        $input.find('option:selected').each(function (i, option) {
          values[i] = option.value;
        });
        $input.data('webform-value', values);
      }
      else if (type !== 'submit' && type !== 'button') {
        $input.data('webform-value', input.value);
      }
    }
  }

  /**
   * Restore an input's value and required attribute.
   *
   * @param {element} input
   *   An input.
   */
  function restoreValueAndRequired(input) {
    var $input = $(input);

    // Restore value.
    var value = $input.data('webform-value');
    if (typeof value !== 'undefined') {
      var type = input.type;
      var tag = input.tagName.toLowerCase(); // Normalize case.

      if (type === 'checkbox' || type === 'radio') {
        $input.prop('checked', value);
      }
      else if (tag === 'select') {
        $.each(value, function (i, option_value) {
          // Prevent "Syntax error, unrecognized expression" error by
          // escaping single quotes.
          // @see https://forum.jquery.com/topic/escape-characters-prior-to-using-selector
          option_value = option_value.replace(/'/g, "\\\'");
          $input.find("option[value='" + option_value + "']").prop('selected', true);
        });
      }
      else if (type !== 'submit' && type !== 'button') {
        input.value = value;
      }
      $input.removeData('webform-value');
    }

    // Restore required.
    var required = $input.data('webform-required');
    if (typeof required !== 'undefined') {
      if (required) {
        $input.prop('required', true);
      }
      $input.removeData('webform-required');
    }
  }

  /**
   * Clear an input's value and required attributes.
   *
   * @param {element} input
   *   An input.
   */
  function clearValueAndRequired(input) {
    var $input = $(input);

    // Check for #states no clear attribute.
    // @see https://css-tricks.com/snippets/jquery/make-an-jquery-hasattr/
    if ($input.closest('[data-webform-states-no-clear]').length) {
      return;
    }

    // Clear value.
    var type = input.type;
    var tag = input.tagName.toLowerCase(); // Normalize case.
    if (type === 'checkbox' || type === 'radio') {
      $input.prop('checked', false);
    }
    else if (tag === 'select') {
      if ($input.find('option[value=""]').length) {
        $input.val('');
      }
      else {
        input.selectedIndex = -1;
      }
    }
    else if (type !== 'submit' && type !== 'button') {
      input.value = (type === 'color') ? '#000000' : '';
    }

    // Clear required.
    $input.prop('required', false);
  }

  /* ************************************************************************ */
  // Helper functions.
  /* ************************************************************************ */

  /**
   * Toggle an input's required attributes.
   *
   * @param {element} $input
   *   An input.
   * @param {boolean} required
   *   Is input required.
   */
  function toggleRequired($input, required) {
    if (required) {
      $input.attr({'required': 'required', 'aria-required': 'true'});
    }
    else {
      $input.removeAttr('required aria-required');
    }
  }

  /**
   * Copy the clientside_validation.module's message.
   *
   * @param {jQuery} $source
   *   The source element.
   * @param {jQuery} $destination
   *   The destination element.
   */
  function copyRequireMessage($source, $destination) {
    if ($source.attr('data-msg-required')) {
      $destination.attr('data-msg-required', $source.attr('data-msg-required'));
    }
  }

})(jQuery, Drupal);
;
/**
 * @file
 * JavaScript behaviors for webforms.
 */

(function ($, Drupal) {

  'use strict';

  /**
   * Remove single submit event listener.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior for removing single submit event listener.
   *
   * @see Drupal.behaviors.formSingleSubmit
   */
  Drupal.behaviors.webformRemoveFormSingleSubmit = {
    attach: function attach() {
      function onFormSubmit(e) {
        var $form = $(e.currentTarget);
        $form.removeAttr('data-drupal-form-submit-last');
      }
      $('body')
        .once('webform-single-submit')
        .on('submit.singleSubmit', 'form.webform-remove-single-submit', onFormSubmit);
    }
  };

  /**
   * Prevent webform autosubmit on wizard pages.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior for disabling webform autosubmit.
   *   Wizard pages need to be progressed with the Previous or Next buttons,
   *   not by pressing Enter.
   */
  Drupal.behaviors.webformDisableAutoSubmit = {
    attach: function (context) {
      // Not using context so that inputs loaded via Ajax will have autosubmit
      // disabled.
      // @see http://stackoverflow.com/questions/11235622/jquery-disable-form-submit-on-enter
      $('.js-webform-disable-autosubmit input')
        .not(':button, :submit, :reset, :image, :file')
        .once('webform-disable-autosubmit')
        .on('keyup keypress', function (e) {
          if (e.which === 13) {
            e.preventDefault();
            return false;
          }
        });
    }
  };

  /**
   * Skip client-side validation when submit button is pressed.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior for the skipping client-side validation.
   *
   * @deprecated in Webform 8.x-5.x and will be removed in Webform 8.x-6.x.
   *   Use 'formnovalidate' attribute instead.
   */
  Drupal.behaviors.webformSubmitNoValidate = {
    attach: function (context) {
      $(context).find(':submit.js-webform-novalidate')
        .once('webform-novalidate')
        .attr('formnovalidate', 'formnovalidate');
    }
  };

  /**
   * Custom required and pattern validation error messages.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior for the webform custom required and pattern
   *   validation error messages.
   *
   * @see http://stackoverflow.com/questions/5272433/html5-form-required-attribute-set-custom-validation-message
   **/
  Drupal.behaviors.webformRequiredError = {
    attach: function (context) {
      $(context).find(':input[data-webform-required-error], :input[data-webform-pattern-error]').once('webform-required-error')
        .on('invalid', function () {
          this.setCustomValidity('');
          if (this.valid) {
            return;
          }

          if (this.validity.patternMismatch && $(this).attr('data-webform-pattern-error')) {
            this.setCustomValidity($(this).attr('data-webform-pattern-error'));
          }
          else if (this.validity.valueMissing && $(this).attr('data-webform-required-error')) {
            this.setCustomValidity($(this).attr('data-webform-required-error'));
          }
        })
        .on('input change', function () {
          // Find all related elements by name and reset custom validity.
          // This specifically applies to required radios and checkboxes.
          var name = $(this).attr('name');
          $(this.form).find(':input[name="' + name + '"]').each(function () {
            this.setCustomValidity('');
          });
        });
    }
  };

  // When #state:required is triggered we need to reset the target elements
  // custom validity.
  $(document).on('state:required', function (e) {
    $(e.target).filter('[data-webform-required-error]')
      .each(function () {this.setCustomValidity('');});
  });

})(jQuery, Drupal);
;
/**
 * @file
 * JavaScript behaviors for preventing duplicate webform submissions.
 */

(function ($, Drupal) {

  'use strict';

  /**
   * Submit once.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior for preventing duplicate webform submissions.
   */
  Drupal.behaviors.webformSubmitOnce = {
    clear: function () {
      var $form = $('.js-webform-submit-once');
      $form.removeData('webform-submitted');
      $form.find('.js-webform-wizard-pages-links :submit, .form-actions :submit').removeClass('is-disabled');
      $form.find('.form-actions .ajax-progress.ajax-progress-throbber').remove();
    },
    attach: function (context) {
      $('.js-webform-submit-once', context).once('webform-submit-once').each(function () {
        var $form = $(this);
        // Remove data-webform-submitted.
        $form.removeData('webform-submitted');
        // Remove .js-webform-submit-clicked.
        $form.find('.js-webform-wizard-pages-links :submit, .form-actions :submit').removeClass('js-webform-submit-clicked');

        // Track which submit button was clicked.
        // @see http://stackoverflow.com/questions/5721724/jquery-how-to-get-which-button-was-clicked-upon-form-submission
        $form.find('.js-webform-wizard-pages-links :submit, .form-actions :submit').on('click', function () {
          $form.find('.js-webform-wizard-pages-links :submit, .form-actions :submit')
            .removeClass('js-webform-submit-clicked');
          $(this)
            .addClass('js-webform-submit-clicked');
        });

        $(this).on('submit', function () {
          // Find clicked button
          var $clickedButton = $form.find('.js-webform-wizard-pages-links :submit.js-webform-submit-clicked, .form-actions :submit.js-webform-submit-clicked');

          // Don't submit if client-side validation has failed.
          if (!$clickedButton.attr('formnovalidate') && $.isFunction(jQuery.fn.valid) && !($form.valid())) {
            return false;
          }

          // Track webform submitted.
          if ($form.data('webform-submitted')) {
            return false;
          }
          $form.data('webform-submitted', 'true');

          // Visually disable all submit buttons.
          // Submit buttons can't disabled because their op(eration) must to be posted back to the server.
          $form.find('.js-webform-wizard-pages-links :submit, .form-actions :submit').addClass('is-disabled');

          // Set the throbber progress indicator.
          $clickedButton.after(Drupal.theme.ajaxProgressThrobber());
        });
      });
    }
  };

})(jQuery, Drupal);
;
/**
 * @file
 * JavaScript behaviors for details element.
 */

(function ($, Drupal) {

  'use strict';

  // Determine if local storage exists and is enabled.
  // This approach is copied from Modernizr.
  // @see https://github.com/Modernizr/Modernizr/blob/c56fb8b09515f629806ca44742932902ac145302/modernizr.js#L696-731
  var hasLocalStorage = (function () {
    try {
      localStorage.setItem('webform', 'webform');
      localStorage.removeItem('webform');
      return true;
    }
    catch (e) {
      return false;
    }
  }());

  /**
   * Attach handler to save details open/close state.
   *
   * @type {Drupal~behavior}
   */
  Drupal.behaviors.webformDetailsSave = {
    attach: function (context) {
      if (!hasLocalStorage) {
        return;
      }

      // Summary click event handler.
      $('details > summary', context).once('webform-details-summary-save').on('click', function () {
        var $details = $(this).parent();

        // @see https://css-tricks.com/snippets/jquery/make-an-jquery-hasattr/
        if ($details[0].hasAttribute('data-webform-details-nosave')) {
          return;
        }

        var name = Drupal.webformDetailsSaveGetName($details);
        if (!name) {
          return;
        }

        var open = ($details.attr('open') !== 'open') ? '1' : '0';
        localStorage.setItem(name, open);
      });

      // Initialize details open state via local storage.
      $('details', context).once('webform-details-save').each(function () {
        var $details = $(this);

        var name = Drupal.webformDetailsSaveGetName($details);
        if (!name) {
          return;
        }

        var open = localStorage.getItem(name);
        if (open === null) {
          return;
        }

        if (open === '1') {
          $details.attr('open', 'open');
        }
        else {
          $details.removeAttr('open');
        }
      });
    }

  };

  /**
   * Get the name used to store the state of details element.
   *
   * @param {jQuery} $details
   *   A details element.
   *
   * @return {string}
   *   The name used to store the state of details element.
   */
  Drupal.webformDetailsSaveGetName = function ($details) {
    if (!hasLocalStorage) {
      return '';
    }

    // Ignore details that are vertical tabs pane.
    if ($details.hasClass('vertical-tabs__pane')) {
      return '';
    }

    // Any details element not included a webform must have define its own id.
    var webformId = $details.attr('data-webform-element-id');
    if (webformId) {
      return 'Drupal.webform.' + webformId.replace('--', '.');
    }

    var detailsId = $details.attr('id');
    if (!detailsId) {
      return '';
    }

    var $form = $details.parents('form');
    if (!$form.length || !$form.attr('id')) {
      return '';
    }

    var formId = $form.attr('id');
    if (!formId) {
      return '';
    }

    // ISSUE: When Drupal renders a webform in a modal dialog it appends a unique
    // identifier to webform ids and details ids. (i.e. my-form--FeSFISegTUI)
    // WORKAROUND: Remove the unique id that delimited using double dashes.
    formId = formId.replace(/--.+?$/, '').replace(/-/g, '_');
    detailsId = detailsId.replace(/--.+?$/, '').replace(/-/g, '_');
    return 'Drupal.webform.' + formId + '.' + detailsId;
  };

})(jQuery, Drupal);
;
/**
* DO NOT EDIT THIS FILE.
* See the following change record for more information,
* https://www.drupal.org/node/2815083
* @preserve
**/

(function (Drupal, debounce) {
  var liveElement = void 0;
  var announcements = [];

  Drupal.behaviors.drupalAnnounce = {
    attach: function attach(context) {
      if (!liveElement) {
        liveElement = document.createElement('div');
        liveElement.id = 'drupal-live-announce';
        liveElement.className = 'visually-hidden';
        liveElement.setAttribute('aria-live', 'polite');
        liveElement.setAttribute('aria-busy', 'false');
        document.body.appendChild(liveElement);
      }
    }
  };

  function announce() {
    var text = [];
    var priority = 'polite';
    var announcement = void 0;

    var il = announcements.length;
    for (var i = 0; i < il; i++) {
      announcement = announcements.pop();
      text.unshift(announcement.text);

      if (announcement.priority === 'assertive') {
        priority = 'assertive';
      }
    }

    if (text.length) {
      liveElement.innerHTML = '';

      liveElement.setAttribute('aria-busy', 'true');

      liveElement.setAttribute('aria-live', priority);

      liveElement.innerHTML = text.join('\n');

      liveElement.setAttribute('aria-busy', 'false');
    }
  }

  Drupal.announce = function (text, priority) {
    announcements.push({
      text: text,
      priority: priority
    });

    return debounce(announce, 200)();
  };
})(Drupal, Drupal.debounce);;
/**
 * @file
 * JavaScript behaviors for details element.
 */

(function ($, Drupal) {

  'use strict';

  Drupal.webform = Drupal.webform || {};
  Drupal.webform.detailsToggle = Drupal.webform.detailsToggle || {};
  Drupal.webform.detailsToggle.options = Drupal.webform.detailsToggle.options || {};

  /**
   * Attach handler to toggle details open/close state.
   *
   * @type {Drupal~behavior}
   */
  Drupal.behaviors.webformDetailsToggle = {
    attach: function (context) {
      $('.js-webform-details-toggle', context).once('webform-details-toggle').each(function () {
        var $form = $(this);
        var $tabs = $form.find('.webform-tabs');

        // Get only the main details elements and ignore all nested details.
        var selector = ($tabs.length) ? '.webform-tab' : '.js-webform-details-toggle, .webform-elements';
        var $details = $form.find('details').filter(function () {
          var $parents = $(this).parentsUntil(selector);
          return ($parents.find('details').length === 0);
        });

        // Toggle is only useful when there are two or more details elements.
        if ($details.length < 2) {
          return;
        }

        var options = $.extend({
          button: '<button type="button" class="webform-details-toggle-state"></button>'
        }, Drupal.webform.detailsToggle.options);

        // Create toggle buttons.
        var $toggle = $(options.button)
          .attr('title', Drupal.t('Toggle details widget state.'))
          .on('click', function (e) {
            // Get details that are not vertical tabs pane.
            var $details = $form.find('details:not(.vertical-tabs__pane)');
            var open;
            if (Drupal.webform.detailsToggle.isFormDetailsOpen($form)) {
              $details.removeAttr('open');
              open = 0;
            }
            else {
              $details.attr('open', 'open');
              open = 1;
            }
            Drupal.webform.detailsToggle.setDetailsToggleLabel($form);

            // Set the saved states for all the details elements.
            // @see webform.element.details.save.js
            if (Drupal.webformDetailsSaveGetName) {
              $details.each(function () {
                // Note: Drupal.webformDetailsSaveGetName checks if localStorage
                // exists and is enabled.
                // @see webform.element.details.save.js
                var name = Drupal.webformDetailsSaveGetName($(this));
                if (name) {
                  localStorage.setItem(name, open);
                }
              });
            }
          })
          .wrap('<div class="webform-details-toggle-state-wrapper"></div>')
          .parent();

        if ($tabs.length) {
          // Add toggle state before the tabs.
          $tabs.find('.item-list:first-child').eq(0).before($toggle);
        }
        else {
          // Add toggle state link to first details element.
          $details.eq(0).before($toggle);
        }

        Drupal.webform.detailsToggle.setDetailsToggleLabel($form);
      });
    }
  };

  /**
   * Determine if a webform's details are all opened.
   *
   * @param {jQuery} $form
   *   A webform.
   *
   * @return {boolean}
   *   TRUE if a webform's details are all opened.
   */
  Drupal.webform.detailsToggle.isFormDetailsOpen = function ($form) {
    return ($form.find('details[open]').length === $form.find('details').length);
  };

  /**
   * Set a webform's details toggle state widget label.
   *
   * @param {jQuery} $form
   *   A webform.
   */
  Drupal.webform.detailsToggle.setDetailsToggleLabel = function ($form) {
    var isOpen = Drupal.webform.detailsToggle.isFormDetailsOpen($form);

    var label = (isOpen) ? Drupal.t('Collapse all') : Drupal.t('Expand all');
    $form.find('.webform-details-toggle-state').html(label);

    var text = (isOpen) ? Drupal.t('All details have been expanded.') : Drupal.t('All details have been collapsed.');
    Drupal.announce(text);
  };

})(jQuery, Drupal);
;
/*!
 * jQuery Form Plugin
 * version: 4.2.2
 * Requires jQuery v1.7.2 or later
 * Project repository: https://github.com/jquery-form/form

 * Copyright 2017 Kevin Morris
 * Copyright 2006 M. Alsup

 * Dual licensed under the LGPL-2.1+ or MIT licenses
 * https://github.com/jquery-form/form#license

 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,r){return void 0===r&&(r="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(r),r}:e(jQuery)}(function(e){"use strict";function t(t){var r=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).closest("form").ajaxSubmit(r))}function r(t){var r=t.target,a=e(r);if(!a.is("[type=submit],[type=image]")){var n=a.closest("[type=submit]");if(0===n.length)return;r=n[0]}var i=r.form;if(i.clk=r,"image"===r.type)if(void 0!==t.offsetX)i.clk_x=t.offsetX,i.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=a.offset();i.clk_x=t.pageX-o.left,i.clk_y=t.pageY-o.top}else i.clk_x=t.pageX-r.offsetLeft,i.clk_y=t.pageY-r.offsetTop;setTimeout(function(){i.clk=i.clk_x=i.clk_y=null},100)}function a(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var n=/\r?\n/g,i={};i.fileapi=void 0!==e('<input type="file">').get(0).files,i.formdata=void 0!==window.FormData;var o=!!e.fn.prop;e.fn.attr2=function(){if(!o)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t,r,n,s){function u(r){var a,n,i=e.param(r,t.traditional).split("&"),o=i.length,s=[];for(a=0;a<o;a++)i[a]=i[a].replace(/\+/g," "),n=i[a].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}function c(r){function n(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){a("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(r){a("cannot get iframe.contentDocument: "+r),t=e.document}return t}function i(){function t(){try{var e=n(v).readyState;a("state = "+e),e&&"uninitialized"===e.toLowerCase()&&setTimeout(t,50)}catch(e){a("Server abort: ",e," (",e.name,")"),s(L),j&&clearTimeout(j),j=void 0}}var r=p.attr2("target"),i=p.attr2("action"),o=p.attr("enctype")||p.attr("encoding")||"multipart/form-data";w.setAttribute("target",m),l&&!/post/i.test(l)||w.setAttribute("method","POST"),i!==f.url&&w.setAttribute("action",f.url),f.skipEncodingOverride||l&&!/post/i.test(l)||p.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),f.timeout&&(j=setTimeout(function(){T=!0,s(A)},f.timeout));var u=[];try{if(f.extraData)for(var c in f.extraData)f.extraData.hasOwnProperty(c)&&(e.isPlainObject(f.extraData[c])&&f.extraData[c].hasOwnProperty("name")&&f.extraData[c].hasOwnProperty("value")?u.push(e('<input type="hidden" name="'+f.extraData[c].name+'">',k).val(f.extraData[c].value).appendTo(w)[0]):u.push(e('<input type="hidden" name="'+c+'">',k).val(f.extraData[c]).appendTo(w)[0]));f.iframeTarget||h.appendTo(D),v.attachEvent?v.attachEvent("onload",s):v.addEventListener("load",s,!1),setTimeout(t,15);try{w.submit()}catch(e){document.createElement("form").submit.apply(w)}}finally{w.setAttribute("action",i),w.setAttribute("enctype",o),r?w.setAttribute("target",r):p.removeAttr("target"),e(u).remove()}}function s(t){if(!x.aborted&&!X){if((O=n(v))||(a("cannot access response document"),t=L),t===A&&x)return x.abort("timeout"),void S.reject(x,"timeout");if(t===L&&x)return x.abort("server abort"),void S.reject(x,"error","server abort");if(O&&O.location.href!==f.iframeSrc||T){v.detachEvent?v.detachEvent("onload",s):v.removeEventListener("load",s,!1);var r,i="success";try{if(T)throw"timeout";var o="xml"===f.dataType||O.XMLDocument||e.isXMLDoc(O);if(a("isXml="+o),!o&&window.opera&&(null===O.body||!O.body.innerHTML)&&--C)return a("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var u=O.body?O.body:O.documentElement;x.responseText=u?u.innerHTML:null,x.responseXML=O.XMLDocument?O.XMLDocument:O,o&&(f.dataType="xml"),x.getResponseHeader=function(e){return{"content-type":f.dataType}[e.toLowerCase()]},u&&(x.status=Number(u.getAttribute("status"))||x.status,x.statusText=u.getAttribute("statusText")||x.statusText);var c=(f.dataType||"").toLowerCase(),l=/(json|script|text)/.test(c);if(l||f.textarea){var p=O.getElementsByTagName("textarea")[0];if(p)x.responseText=p.value,x.status=Number(p.getAttribute("status"))||x.status,x.statusText=p.getAttribute("statusText")||x.statusText;else if(l){var m=O.getElementsByTagName("pre")[0],g=O.getElementsByTagName("body")[0];m?x.responseText=m.textContent?m.textContent:m.innerText:g&&(x.responseText=g.textContent?g.textContent:g.innerText)}}else"xml"===c&&!x.responseXML&&x.responseText&&(x.responseXML=q(x.responseText));try{M=N(x,c,f)}catch(e){i="parsererror",x.error=r=e||i}}catch(e){a("error caught: ",e),i="error",x.error=r=e||i}x.aborted&&(a("upload aborted"),i=null),x.status&&(i=x.status>=200&&x.status<300||304===x.status?"success":"error"),"success"===i?(f.success&&f.success.call(f.context,M,"success",x),S.resolve(x.responseText,"success",x),d&&e.event.trigger("ajaxSuccess",[x,f])):i&&(void 0===r&&(r=x.statusText),f.error&&f.error.call(f.context,x,i,r),S.reject(x,"error",r),d&&e.event.trigger("ajaxError",[x,f,r])),d&&e.event.trigger("ajaxComplete",[x,f]),d&&!--e.active&&e.event.trigger("ajaxStop"),f.complete&&f.complete.call(f.context,x,i),X=!0,f.timeout&&clearTimeout(j),setTimeout(function(){f.iframeTarget?h.attr("src",f.iframeSrc):h.remove(),x.responseXML=null},100)}}}var u,c,f,d,m,h,v,x,y,b,T,j,w=p[0],S=e.Deferred();if(S.abort=function(e){x.abort(e)},r)for(c=0;c<g.length;c++)u=e(g[c]),o?u.prop("disabled",!1):u.removeAttr("disabled");(f=e.extend(!0,{},e.ajaxSettings,t)).context=f.context||f,m="jqFormIO"+(new Date).getTime();var k=w.ownerDocument,D=p.closest("body");if(f.iframeTarget?(b=(h=e(f.iframeTarget,k)).attr2("name"))?m=b:h.attr2("name",m):(h=e('<iframe name="'+m+'" src="'+f.iframeSrc+'" />',k)).css({position:"absolute",top:"-1000px",left:"-1000px"}),v=h[0],x={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var r="timeout"===t?"timeout":"aborted";a("aborting upload... "+r),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(e){}h.attr("src",f.iframeSrc),x.error=r,f.error&&f.error.call(f.context,x,r,t),d&&e.event.trigger("ajaxError",[x,f,r]),f.complete&&f.complete.call(f.context,x,r)}},(d=f.global)&&0==e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[x,f]),f.beforeSend&&!1===f.beforeSend.call(f.context,x,f))return f.global&&e.active--,S.reject(),S;if(x.aborted)return S.reject(),S;(y=w.clk)&&(b=y.name)&&!y.disabled&&(f.extraData=f.extraData||{},f.extraData[b]=y.value,"image"===y.type&&(f.extraData[b+".x"]=w.clk_x,f.extraData[b+".y"]=w.clk_y));var A=1,L=2,F=e("meta[name=csrf-token]").attr("content"),E=e("meta[name=csrf-param]").attr("content");E&&F&&(f.extraData=f.extraData||{},f.extraData[E]=F),f.forceSync?i():setTimeout(i,10);var M,O,X,C=50,q=e.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!==t.documentElement.nodeName?t:null},_=e.parseJSON||function(e){return window.eval("("+e+")")},N=function(t,r,a){var n=t.getResponseHeader("content-type")||"",i=("xml"===r||!r)&&n.indexOf("xml")>=0,o=i?t.responseXML:t.responseText;return i&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),a&&a.dataFilter&&(o=a.dataFilter(o,r)),"string"==typeof o&&(("json"===r||!r)&&n.indexOf("json")>=0?o=_(o):("script"===r||!r)&&n.indexOf("javascript")>=0&&e.globalEval(o)),o};return S}if(!this.length)return a("ajaxSubmit: skipping submit process - no element selected"),this;var l,f,d,p=this;"function"==typeof t?t={success:t}:"string"==typeof t||!1===t&&arguments.length>0?(t={url:t,data:r,dataType:n},"function"==typeof s&&(t.success=s)):void 0===t&&(t={}),l=t.method||t.type||this.attr2("method"),(d=(d="string"==typeof(f=t.url||this.attr2("action"))?e.trim(f):"")||window.location.href||"")&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:l||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&!1===t.beforeSerialize(this,t))return a("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var v,g=[],x=this.formToArray(t.semantic,g,t.filtering);if(t.data){var y=e.isFunction(t.data)?t.data(x):t.data;t.extraData=y,v=e.param(y,h)}if(t.beforeSubmit&&!1===t.beforeSubmit(x,this,t))return a("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[x,this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var b=e.param(x,h);v&&(b=b?b+"&"+v:v),"GET"===t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+b,t.data=null):t.data=b;var T=[];if(t.resetForm&&T.push(function(){p.resetForm()}),t.clearForm&&T.push(function(){p.clearForm(t.includeHidden)}),!t.dataType&&t.target){var j=t.success||function(){};T.push(function(r,a,n){var i=arguments,o=t.replaceTarget?"replaceWith":"html";e(t.target)[o](r).each(function(){j.apply(this,i)})})}else t.success&&(e.isArray(t.success)?e.merge(T,t.success):T.push(t.success));if(t.success=function(e,r,a){for(var n=t.context||this,i=0,o=T.length;i<o;i++)T[i].apply(n,[e,r,a||p,p])},t.error){var w=t.error;t.error=function(e,r,a){var n=t.context||this;w.apply(n,[e,r,a,p])}}if(t.complete){var S=t.complete;t.complete=function(e,r){var a=t.context||this;S.apply(a,[e,r,p])}}var k=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}).length>0,D="multipart/form-data",A=p.attr("enctype")===D||p.attr("encoding")===D,L=i.fileapi&&i.formdata;a("fileAPI :"+L);var F,E=(k||A)&&!L;!1!==t.iframe&&(t.iframe||E)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){F=c(x)}):F=c(x):F=(k||A)&&L?function(r){for(var a=new FormData,n=0;n<r.length;n++)a.append(r[n].name,r[n].value);if(t.extraData){var i=u(t.extraData);for(n=0;n<i.length;n++)i[n]&&a.append(i[n][0],i[n][1])}t.data=null;var o=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:l||"POST"});t.uploadProgress&&(o.xhr=function(){var r=e.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(e){var r=0,a=e.loaded||e.position,n=e.total;e.lengthComputable&&(r=Math.ceil(a/n*100)),t.uploadProgress(e,a,n,r)},!1),r}),o.data=null;var s=o.beforeSend;return o.beforeSend=function(e,r){t.formData?r.data=t.formData:r.data=a,s&&s.call(this,e,r)},e.ajax(o)}(x):e.ajax(t),p.removeData("jqxhr").data("jqxhr",F);for(var M=0;M<g.length;M++)g[M]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(n,i,o,s){if(("string"==typeof n||!1===n&&arguments.length>0)&&(n={url:n,data:i,dataType:o},"function"==typeof s&&(n.success=s)),n=n||{},n.delegation=n.delegation&&e.isFunction(e.fn.on),!n.delegation&&0===this.length){var u={s:this.selector,c:this.context};return!e.isReady&&u.s?(a("DOM not ready, queuing ajaxForm"),e(function(){e(u.s,u.c).ajaxForm(n)}),this):(a("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return n.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,n,t).on("click.form-plugin",this.selector,n,r),this):this.ajaxFormUnbind().on("submit.form-plugin",n,t).on("click.form-plugin",n,r)},e.fn.ajaxFormUnbind=function(){return this.off("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,r,a){var n=[];if(0===this.length)return n;var o,s=this[0],u=this.attr("id"),c=t||void 0===s.elements?s.getElementsByTagName("*"):s.elements;if(c&&(c=e.makeArray(c)),u&&(t||/(Edge|Trident)\//.test(navigator.userAgent))&&(o=e(':input[form="'+u+'"]').get()).length&&(c=(c||[]).concat(o)),!c||!c.length)return n;e.isFunction(a)&&(c=e.map(c,a));var l,f,d,p,m,h,v;for(l=0,h=c.length;l<h;l++)if(m=c[l],(d=m.name)&&!m.disabled)if(t&&s.clk&&"image"===m.type)s.clk===m&&(n.push({name:d,value:e(m).val(),type:m.type}),n.push({name:d+".x",value:s.clk_x},{name:d+".y",value:s.clk_y}));else if((p=e.fieldValue(m,!0))&&p.constructor===Array)for(r&&r.push(m),f=0,v=p.length;f<v;f++)n.push({name:d,value:p[f]});else if(i.fileapi&&"file"===m.type){r&&r.push(m);var g=m.files;if(g.length)for(f=0;f<g.length;f++)n.push({name:d,value:g[f],type:m.type});else n.push({name:d,value:"",type:m.type})}else null!==p&&void 0!==p&&(r&&r.push(m),n.push({name:d,value:p,type:m.type,required:m.required}));if(!t&&s.clk){var x=e(s.clk),y=x[0];(d=y.name)&&!y.disabled&&"image"===y.type&&(n.push({name:d,value:x.val()}),n.push({name:d+".x",value:s.clk_x},{name:d+".y",value:s.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var r=[];return this.each(function(){var a=this.name;if(a){var n=e.fieldValue(this,t);if(n&&n.constructor===Array)for(var i=0,o=n.length;i<o;i++)r.push({name:a,value:n[i]});else null!==n&&void 0!==n&&r.push({name:this.name,value:n})}}),e.param(r)},e.fn.fieldValue=function(t){for(var r=[],a=0,n=this.length;a<n;a++){var i=this[a],o=e.fieldValue(i,t);null===o||void 0===o||o.constructor===Array&&!o.length||(o.constructor===Array?e.merge(r,o):r.push(o))}return r},e.fieldValue=function(t,r){var a=t.name,i=t.type,o=t.tagName.toLowerCase();if(void 0===r&&(r=!0),r&&(!a||t.disabled||"reset"===i||"button"===i||("checkbox"===i||"radio"===i)&&!t.checked||("submit"===i||"image"===i)&&t.form&&t.form.clk!==t||"select"===o&&-1===t.selectedIndex))return null;if("select"===o){var s=t.selectedIndex;if(s<0)return null;for(var u=[],c=t.options,l="select-one"===i,f=l?s+1:c.length,d=l?s:0;d<f;d++){var p=c[d];if(p.selected&&!p.disabled){var m=p.value;if(m||(m=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),l)return m;u.push(m)}}return u}return e(t).val().replace(n,"\r\n")},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var r=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var a=this.type,n=this.tagName.toLowerCase();r.test(a)||"textarea"===n?this.value="":"checkbox"===a||"radio"===a?this.checked=!1:"select"===n?this.selectedIndex=-1:"file"===a?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(a)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){var t=e(this),r=this.tagName.toLowerCase();switch(r){case"input":this.checked=this.defaultChecked;case"textarea":return this.value=this.defaultValue,!0;case"option":case"optgroup":var a=t.parents("select");return a.length&&a[0].multiple?"option"===r?this.selected=this.defaultSelected:t.find("option").resetForm():a.resetForm(),!0;case"select":return t.find("option").each(function(e){if(this.selected=this.defaultSelected,this.defaultSelected&&!t[0].multiple)return t[0].selectedIndex=e,!1}),!0;case"label":var n=e(t.attr("for")),i=t.find("input,select,textarea");return n[0]&&i.unshift(n[0]),i.resetForm(),!0;case"form":return("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset(),!0;default:return t.find("form,input,label,select,textarea").resetForm(),!0}})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var r=this.type;if("checkbox"===r||"radio"===r)this.checked=t;else if("option"===this.tagName.toLowerCase()){var a=e(this).parent("select");t&&a[0]&&"select-one"===a[0].type&&a.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});

;
/**
 * @file
 * JavaScript behaviors for webform scroll top.
 */

(function ($, Drupal) {

  'use strict';

  Drupal.webform = Drupal.webform || {};
  // Allow scrollTopOffset to be custom defined or based on whether there is a
  // floating toolbar.
  Drupal.webform.scrollTopOffset = Drupal.webform.scrollTopOffset || ($('#toolbar-administration').length ? 140 : 10);

  /**
   * Scroll to top ajax command.
   *
   * @param {Element} element
   *   The element to scroll to.
   * @param {string} target
   *   Scroll to target. (form or page)
   */
  Drupal.webformScrollTop = function (element, target) {
    if (!target) {
      return;
    }

    var $element = $(element);

    // Scroll to the top of the view. This will allow users
    // to browse newly loaded content after e.g. clicking a pager
    // link.
    var offset = $element.offset();
    // We can't guarantee that the scrollable object should be
    // the body, as the view could be embedded in something
    // more complex such as a modal popup. Recurse up the DOM
    // and scroll the first element that has a non-zero top.
    var $scrollTarget = $element;
    while ($scrollTarget.scrollTop() === 0 && $($scrollTarget).parent()) {
      $scrollTarget = $scrollTarget.parent();
    }

    if (target === 'page' && $scrollTarget.length && $scrollTarget[0].tagName === 'HTML') {
      // Scroll to top when scroll target is the entire page.
      // @see https://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport
      var rect = $($scrollTarget)[0].getBoundingClientRect();
      if (!(rect.top >= 0 && rect.left >= 0 && rect.bottom <= $(window).height() && rect.right <= $(window).width())) {
        $scrollTarget.animate({scrollTop: 0}, 500);
      }
    }
    else {
      // Only scroll upward.
      if (offset.top - Drupal.webform.scrollTopOffset < $scrollTarget.scrollTop()) {
        $scrollTarget.animate({scrollTop: (offset.top - Drupal.webform.scrollTopOffset)}, 500);
      }
    }
  };

  /**
   * Scroll element into view.
   *
   * @param {jQuery} $element
   *   An element.
   */
  Drupal.webformScrolledIntoView = function ($element) {
    if (!Drupal.webformIsScrolledIntoView($element)) {
      $('html, body').animate({scrollTop: $element.offset().top - Drupal.webform.scrollTopOffset}, 500);
    }
  };

  /**
   * Determine if element is visible in the viewport.
   *
   * @param {Element} element
   *   An element.
   *
   * @return {boolean}
   *   TRUE if element is visible in the viewport.
   *
   * @see https://stackoverflow.com/questions/487073/check-if-element-is-visible-after-scrolling
   */
  Drupal.webformIsScrolledIntoView = function (element) {
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();

    var elemTop = $(element).offset().top;
    var elemBottom = elemTop + $(element).height();

    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
  };

})(jQuery, Drupal);
;
/**
 * @file
 * JavaScript behaviors for Ajax.
 */

(function ($, Drupal, drupalSettings) {

  'use strict';

  Drupal.webform = Drupal.webform || {};
  Drupal.webform.ajax = Drupal.webform.ajax || {};
  // Allow scrollTopOffset to be custom defined or based on whether there is a
  // floating toolbar.
  Drupal.webform.ajax.scrollTopOffset = Drupal.webform.ajax.scrollTopOffset || ($('#toolbar-administration').length ? 140 : 10);

  // Set global scroll top offset.
  // @todo Remove in Webform 6.x.
  Drupal.webform.scrollTopOffset = Drupal.webform.ajax.scrollTopOffset;

  /**
   * Provide Webform Ajax link behavior.
   *
   * Display fullscreen progress indicator instead of throbber.
   * Copied from: Drupal.behaviors.AJAX
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior to a.webform-ajax-link.
   */
  Drupal.behaviors.webformAjaxLink = {
    attach: function (context) {
      $('.webform-ajax-link', context).once('webform-ajax-link').each(function () {
        var element_settings = {};
        element_settings.progress = {type: 'fullscreen'};

        // For anchor tags, these will go to the target of the anchor rather
        // than the usual location.
        var href = $(this).attr('href');
        if (href) {
          element_settings.url = href;
          element_settings.event = 'click';
        }
        element_settings.dialogType = $(this).data('dialog-type');
        element_settings.dialogRenderer = $(this).data('dialog-renderer');
        element_settings.dialog = $(this).data('dialog-options');
        element_settings.base = $(this).attr('id');
        element_settings.element = this;
        Drupal.ajax(element_settings);

        // Close all open modal dialogs when opening off-canvas dialog.
        if (element_settings.dialogRenderer === 'off_canvas') {
          $(this).on('click', function () {
            $('.ui-dialog.webform-ui-dialog:visible').find('.ui-dialog-content').dialog('close');
          });
        }
      });
    }
  };

  /**
   * Adds a hash (#) to current pages location for links and buttons
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior to a[data-hash] or :button[data-hash].
   *
   * @see \Drupal\webform_ui\WebformUiEntityElementsForm::getElementRow
   * @see Drupal.behaviors.webformFormTabs
   */
  Drupal.behaviors.webformAjaxHash = {
    attach: function (context) {
      $('[data-hash]', context).once('webform-ajax-hash').each(function () {
        var hash = $(this).data('hash');
        if (hash) {
          $(this).on('click', function () {
            location.hash = $(this).data('hash');
          });
        }
      });
    }
  };

  /**
   * Provide Ajax callback for confirmation back to link.
   *
   * @type {Drupal~behavior}
   *
   * @prop {Drupal~behaviorAttach} attach
   *   Attaches the behavior to confirmation back to link.
   */
  Drupal.behaviors.webformConfirmationBackAjax = {
    attach: function (context) {
      $('.js-webform-confirmation-back-link-ajax', context)
        .once('webform-confirmation-back-ajax')
        .on('click', function (event) {
          var $form = $(this).parents('form');

          // Trigger the Ajax call back for the hidden submit button.
          // @see \Drupal\webform\WebformSubmissionForm::getCustomForm
          $form.find('.js-webform-confirmation-back-submit-ajax').trigger('click');

          // Move the progress indicator from the submit button to after this link.
          // @todo Figure out a better way to set a progress indicator.
          var $progress_indicator = $form.find('.ajax-progress');
          if ($progress_indicator) {
            $(this).after($progress_indicator);
          }

          // Cancel the click event.
          event.preventDefault();
          event.stopPropagation();
        });
    }
  };

  /** ********************************************************************** **/
  // Ajax commands.
  /** ********************************************************************** **/

  /**
   * Track the updated table row key.
   */
  var updateKey;

  /**
   * Track the add element key.
   */
  var addElement;

  /**
   * Command to insert new content into the DOM.
   *
   * @param {Drupal.Ajax} ajax
   *   {@link Drupal.Ajax} object created by {@link Drupal.ajax}.
   * @param {object} response
   *   The response from the Ajax request.
   * @param {string} response.data
   *   The data to use with the jQuery method.
   * @param {string} [response.method]
   *   The jQuery DOM manipulation method to be used.
   * @param {string} [response.selector]
   *   A optional jQuery selector string.
   * @param {object} [response.settings]
   *   An optional array of settings that will be used.
   * @param {number} [status]
   *   The XMLHttpRequest status.
   */
  Drupal.AjaxCommands.prototype.webformInsert = function (ajax, response, status) {
    // Insert the HTML.
    this.insert(ajax, response, status);

    // Add element.
    if (addElement) {
      var addSelector = (addElement === '_root_')
        ? '#webform-ui-add-element'
        : '[data-drupal-selector="edit-webform-ui-elements-' + addElement + '-add"]';
      $(addSelector).trigger('click');
    }

    // If not add element, then scroll to and highlight the updated table row.
    if (!addElement && updateKey) {
      var $element = $('tr[data-webform-key="' + updateKey + '"]');

      // Highlight the updated element's row.
      $element.addClass('color-success');
      setTimeout(function () {$element.removeClass('color-success');}, 3000);

      // Focus first tabbable item for the updated elements and handlers.
      $element.find(':tabbable:not(.tabledrag-handle)').eq(0).trigger('focus');

      // Scroll element into view.
      Drupal.webformScrolledIntoView($element);
    }
    else {
      // Focus main content.
      $('#main-content').trigger('focus');
    }

    // Display main page's status message in a floating container.
    var $wrapper = $(response.selector);
    if ($wrapper.parents('.ui-dialog').length === 0) {
      var $messages = $wrapper.find('.messages');
      // If 'add element' don't show any messages.
      if (addElement) {
        $messages.remove();
      }
      else if ($messages.length) {
        var $floatingMessage = $('#webform-ajax-messages');
        if ($floatingMessage.length === 0) {
          $floatingMessage = $('<div id="webform-ajax-messages" class="webform-ajax-messages"></div>');
          $('body').append($floatingMessage);
        }
        if ($floatingMessage.is(':animated')) {
          $floatingMessage.stop(true, true);
        }
        $floatingMessage.html($messages).show().delay(3000).fadeOut(1000);
      }
    }

    updateKey = null; // Reset element update.
    addElement = null; // Reset add element.
  };

  /**
   * Scroll to top ajax command.
   *
   * @param {Drupal.Ajax} [ajax]
   *   A {@link Drupal.ajax} object.
   * @param {object} response
   *   Ajax response.
   * @param {string} response.selector
   *   Selector to use.
   *
   * @see Drupal.AjaxCommands.prototype.viewScrollTop
   */
  Drupal.AjaxCommands.prototype.webformScrollTop = function (ajax, response) {
    // Scroll top.
    Drupal.webformScrollTop(response.selector, response.target);

    // Focus on the form wrapper content bookmark if
    // .js-webform-autofocus is not enabled.
    // @see \Drupal\webform\Form\WebformAjaxFormTrait::buildAjaxForm
    var $form = $(response.selector + '-content').find('form');
    if (!$form.hasClass('js-webform-autofocus')) {
      $(response.selector + '-content').trigger('focus');
    }
  };

  /**
   * Command to refresh the current webform page.
   *
   * @param {Drupal.Ajax} [ajax]
   *   {@link Drupal.Ajax} object created by {@link Drupal.ajax}.
   * @param {object} response
   *   The response from the Ajax request.
   * @param {string} response.url
   *   The URL to redirect to.
   * @param {number} [status]
   *   The XMLHttpRequest status.
   */
  Drupal.AjaxCommands.prototype.webformRefresh = function (ajax, response, status) {
    // Get URL path name.
    // @see https://stackoverflow.com/questions/6944744/javascript-get-portion-of-url-path
    var a = document.createElement('a');
    a.href = response.url;
    var forceReload = (response.url.match(/\?reload=([^&]+)($|&)/)) ? RegExp.$1 : null;
    if (forceReload) {
      response.url = response.url.replace(/\?reload=([^&]+)($|&)/, '');
      this.redirect(ajax, response, status);
      return;
    }

    if (a.pathname === window.location.pathname && $('.webform-ajax-refresh').length) {
      updateKey = (response.url.match(/[?|&]update=([^&]+)($|&)/)) ? RegExp.$1 : null;
      addElement = (response.url.match(/[?|&]add_element=([^&]+)($|&)/)) ? RegExp.$1 : null;
      $('.webform-ajax-refresh').trigger('click');
    }
    else {
      // Clear unsaved information flag so that the current webform page
      // can be redirected.
      // @see Drupal.behaviors.webformUnsaved.clear
      if (Drupal.behaviors.webformUnsaved) {
        Drupal.behaviors.webformUnsaved.clear();
      }

      // For webform embedded in an iframe, open all redirects in the top
      // of the browser window.
      // @see \Drupal\webform_share\Controller\WebformShareController::page
      if (drupalSettings.webform_share &&
        drupalSettings.webform_share.page) {
        window.top.location = response.url;
      }
      else {
        this.redirect(ajax, response, status);
      }
    }
  };

  /**
   * Command to close a off-canvas and modal dialog.
   *
   * If no selector is given, it defaults to trying to close the modal.
   *
   * @param {Drupal.Ajax} [ajax]
   *   {@link Drupal.Ajax} object created by {@link Drupal.ajax}.
   * @param {object} response
   *   The response from the Ajax request.
   * @param {string} response.selector
   *   Selector to use.
   * @param {bool} response.persist
   *   Whether to persist the dialog element or not.
   * @param {number} [status]
   *   The HTTP status code.
   */
  Drupal.AjaxCommands.prototype.webformCloseDialog = function (ajax, response, status) {
    if ($('#drupal-off-canvas').length) {
      // Close off-canvas system tray which is not triggered by close dialog
      // command.
      // @see Drupal.behaviors.offCanvasEvents
      $('#drupal-off-canvas').remove();
      $('body').removeClass('js-tray-open');
      // Remove all *.off-canvas events
      $(document).off('.off-canvas');
      $(window).off('.off-canvas');
      var edge = document.documentElement.dir === 'rtl' ? 'left' : 'right';
      var $mainCanvasWrapper = $('[data-off-canvas-main-canvas]');
      $mainCanvasWrapper.css('padding-' + edge, 0);

      // Resize tabs when closing off-canvas system tray.
      $(window).trigger('resize.tabs');
    }

    // https://stackoverflow.com/questions/15763909/jquery-ui-dialog-check-if-exists-by-instance-method
    if ($(response.selector).hasClass('ui-dialog-content')) {
      this.closeDialog(ajax, response, status);
    }
  };

  /**
   * Triggers confirm page reload.
   *
   * @param {Drupal.Ajax} [ajax]
   *   A {@link Drupal.ajax} object.
   * @param {object} response
   *   Ajax response.
   * @param {string} response.message
   *   A message to be displayed in the confirm dialog.
   */
  Drupal.AjaxCommands.prototype.webformConfirmReload = function (ajax, response) {
    if (window.confirm(response.message)) {
      window.location.reload(true);
    }
  };

})(jQuery, Drupal, drupalSettings);
;
/**
 * @file
 * JavaScript behaviors for message element integration.
 */

(function ($, Drupal) {

  'use strict';

  // Determine if local storage exists and is enabled.
  // This approach is copied from Modernizr.
  // @see https://github.com/Modernizr/Modernizr/blob/c56fb8b09515f629806ca44742932902ac145302/modernizr.js#L696-731
  var hasLocalStorage = (function () {
    try {
      localStorage.setItem('webform', 'webform');
      localStorage.removeItem('webform');
      return true;
    }
    catch (e) {
      return false;
    }
  }());

  // Determine if session storage exists and is enabled.
  // This approach is copied from Modernizr.
  // @see https://github.com/Modernizr/Modernizr/blob/c56fb8b09515f629806ca44742932902ac145302/modernizr.js#L696-731
  var hasSessionStorage = (function () {
    try {
      sessionStorage.setItem('webform', 'webform');
      sessionStorage.removeItem('webform');
      return true;
    }
    catch (e) {
      return false;
    }
  }());

  /**
   * Behavior for handler message close.
   *
   * @type {Drupal~behavior}
   */
  Drupal.behaviors.webformMessageClose = {
    attach: function (context) {
      $(context).find('.js-webform-message--close').once('webform-message--close').each(function () {
        var $element = $(this);

        var id = $element.attr('data-message-id');
        var storage = $element.attr('data-message-storage');
        var effect = $element.attr('data-message-close-effect') || 'hide';
        switch (effect) {
          case 'slide': effect = 'slideUp'; break;

          case 'fade': effect = 'fadeOut'; break;
        }

        // Check storage status.
        if (isClosed($element, storage, id)) {
          return;
        }

        // Only show element if it's style is not set to 'display: none'.
        if ($element.attr('style') !== 'display: none;') {
          $element.show();
        }

        $element.find('.js-webform-message__link').on('click', function (event) {
          $element[effect]();
          setClosed($element, storage, id);
          $element.trigger('close');
          event.preventDefault();
        });
      });
    }
  };

  function isClosed($element, storage, id) {
    if (!id || !storage) {
      return false;
    }

    switch (storage) {
      case 'local':
        if (hasLocalStorage) {
          return localStorage.getItem('Drupal.webform.message.' + id) || false;
        }
        return false;

      case 'session':
        if (hasSessionStorage) {
          return sessionStorage.getItem('Drupal.webform.message.' + id) || false;
        }
        return false;

      default:
        return false;
    }
  }

  function setClosed($element, storage, id) {
    if (!id || !storage) {
      return;
    }

    switch (storage) {
      case 'local':
        if (hasLocalStorage) {
          localStorage.setItem('Drupal.webform.message.' + id, true);
        }
        break;

      case 'session':
        if (hasSessionStorage) {
          sessionStorage.setItem('Drupal.webform.message.' + id, true);
        }
        break;

      case 'user':
      case 'state':
      case 'custom':
        $.get($element.find('.js-webform-message__link').attr('href'));
        return true;
    }
  }

})(jQuery, Drupal);
;

</script>

</body>
</html>
