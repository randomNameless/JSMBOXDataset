<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>vendor.bmw.efe722d1be939f530a93.html</title>
</head>
<body>
<script>"use strict";(self.webpackChunk_bmw_bmw_web=self.webpackChunk_bmw_bmw_web||[]).push([[8990],{7365:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__}),window.TRON=window.TRON||{},window.TRON.warningCode=[],TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=TRON.dataComponent;a[0].componentInfo.componentID=`${gFFWNV([()=>adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var o="undefined"!=typeof prefix?prefix:TRON.prefix,i={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},n=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},r=void 0!==i[o]?i[o]:(n.category||{}).primaryCategory||"";if(""==r||"shared > "==o||"local > "==o)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(s=location.host).split(".")[1];var s,c=s.split(".")[0],l=(s=location.host).split(".")[1],d=location.pathname.split("/")[1].length;"com"===s.split(".")[2]&&"bmw"===l&&2===d?(r="special website",o="special > "):"bmw"===l||"mini"===l||"bmw-motorrad"===l||"bmwusa"===l||"rolls-roycemotorcars"===l||"bmwgroup"===l&&"customer"===c||"bmwgroup"===l&&"tron"===c?(r="nsc website",o="nsc > "):(r="special website",o="special > ")}else r="special website",o="special > ";"undefined"!=typeof prefix&&(prefix=o),void 0!==TRON.prefix&&(TRON.prefix=o);let m={},u="";void 0!==a&&(a[0].category.primaryCategory=r,u=a[0].componentInfo.componentID,m[u]=a[0]);var p=TRON.version;p=p.split("¦"),e.indexOf("e0")>-1?p[p.length-1]="error_"+p[p.length-1]:e.indexOf("w0")>-1&&(p[p.length-1]="warning_"+p[p.length-1]);var g={component:m,version:p=p.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((TRON||"").currentEventName||""),effect:TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[u]}}},h={},v=[],y=[],f=[];if(f.length>0&&"string"!=typeof f){for(var b in f)if(void 0!==f[b]&&void 0!==f[b].productInfo){var D=f[b].productInfo.productID;void 0===D&&(D="product"+(b+1)),h[D]=f[b],void 0!==f[b].category.primaryCategory&&(f[b].category.primaryCategory.indexOf("car")>-1||f[b].category.primaryCategory.indexOf("bike")>-1)&&y.push(D)}Object.keys(h).forEach((e=>v.push(e))),g.product=h}var w={},N={},O=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(adobeDataLayer.getState("dealer")).map((function(e){return adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(var b in O)void 0!==O[b]&&void 0!==O[b].dealerInfo&&(w[O[b].dealerInfo.dealerOutletBuno]=O[b]);Object.keys(w).forEach((e=>N[e]="")),g.dealer=w}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var I=window.adobeDataLayer.getState("user");void 0!==I&&Object.keys(I).length>0&&(g.user=I)}e.indexOf("w0")>-1?window.TRON.warningCode.push(g):window.adobeDataLayer.push(g)}TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic compare",libraryName:"generic_compare",libraryVersion:"_v1.1.3",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}},__WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="6.0.1";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"compare"},componentInfo:{componentID:`TRON_${e._TronVersion}__${e._componentTrackingVersion}`,componentName:"generic compare"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName"],e.baseOptionalData=["componentType","componentDEVagency","componentPlatform","componentVersion"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["compare","compare belt","compare aem"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure"],e.allowedSearchState=["preselected"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","safety training","bmw m nordschleife pro","bmw m race track","bmw m training","bmw m nordschleife tech workshop","bmw m race track plus","bmw m race track training compact","bmw m gt","bmw tour experience","bmw professional safety experience","bmw sondertraining","bmw m nordschleife","bmw snow & ice experience","bmw m product experience","m race track training","bmw m trackday"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"]},events:function(e){e.events||(e.events={});const t="compare";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.errorMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseMandatoryData.filter((t=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].concat(e.errorMandatoryData).includes(t))).concat(e.baseOptionalData.filter((t=>!["componentDEVagency","formID"].concat(e.errorMandatoryData).includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.errorMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName","pageType"]),optionalData:e.baseMandatoryData.filter((t=>!["pageBrand","pageGeoRegion","pageLanguage","pageName"].concat(e.errorMandatoryData).includes(t))).concat(e.baseOptionalData.filter((t=>!["componentDEVagency","formID","pageType"].concat(e.errorMandatoryData).includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please proivde "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints"]),description:"Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn't add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>'listType'</b> is used to capture the kind of list eg \"wish list\" or \"compare list\". Check allowed value for details.</li>\n    </ul>"},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints"]),description:"Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it's actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>'listType'</b> is used to capture the kind of list eg \"wish list\" or \"compare list\". Check allowed value for details.</li>\n    </ul>"},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters removed all",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["formLeadType","formVariant","linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:'Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it\'s available to you at the moment the error occurred.\n                <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/1FsYrw" target="_blank">Adobe Analytics 2023 - Error Tracking confluence page</a> for further details.'},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.'}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","email","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);var t=Object.keys(this).filter((e=>e.includes("allowed")));for(var a in t)this[t[a]]=this[t[a]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(const m in this.events){var t=JSON.parse(JSON.stringify(this.events[m].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[m].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(var n in i)for(var r in i[n]){var s=i[n][r];(s=s.indexOf("[n].")>-1?s.replace("[n].",""):s).includes("searchsearch")&&(s=s.replace("searchsearch","search"));var c=o.filter((e=>e.includes(s.toLowerCase())));if(("string"==typeof s&&1==c.length||"string"==typeof s&&c.length>1&&c[0].includes(s)||"string"==typeof s&&c.length>1&&c[0].includes(s.toLowerCase()))&&["optionscode"].indexOf(s)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(c[0])]])){var l;if("eventEffect"==s?(l=[],m.toLowerCase().indexOf("viewactions")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[o.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[o.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[o.indexOf(c[0])]])):"stepName"==s?(l=[],m.toLowerCase().indexOf("checkoutprocess")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[o.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[o.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[o.indexOf(c[0])]])):(c=c.filter((e=>!e.includes("generic"))),l=this[Object.keys(this)[o.indexOf(c[0])]]),(l||[]).length>0){var d="Possible Options: "+(l=l.filter((function(e){return""!==e}))).join(", ").toString();i[n][r]='<span style="color: #1000ff;font-weight: bold;" title="'+d+'">'+i[n][r]+"</span>"}"eventEffect"!=s&&"stepName"!=s||m.toLowerCase().indexOf("viewactions")<0&&m.toLowerCase().indexOf("checkoutprocess")<0&&c.length<=1&&c[0].indexOf("generic")>-1&&(i[n][r]=s)}}e[m]={description:this.events[m].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(const e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){const t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(const t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{const i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((e=>!!String(n).toLowerCase().includes(e.toLowerCase())&&(a.push({key:i,match:e}),!0)))}))}scanForPIIKeywords(e){const t=[];this.findPIIMatches(e,null,t);const a=Object.values(t.reduce(((e,t)=>{const{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),TRON.currentEventName=eventName,TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(TRON.componentName=TRON.componentName+" "+mandatoryData.componentDEVagency)),TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>datalayerPath("page.pageInfo.geoRegion"),()=>datalayerPath("page.pageInfo.language").indexOf("-")>-1&&datalayerPath("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>datalayerPath("page.pageInfo.language").slice(0,2)||(datalayerPath("page.pageInfo.language").indexOf("-")>-1?datalayerPath("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${TRON.componentName}`;TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName),void 0!==mandatoryData.componentDEVagency&&(this.message.component[0].attributes.componentDEVagency=gFFWNV([()=>mandatoryData.componentDEVagency])),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let r=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(r)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let s="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",s,this.allowedFilterObjects)}{let c=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",c,this.allowedFilterObjects)}}mandatoryData.filterObject=r}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>(this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(d){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(m){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(u){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(p){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(g){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(h){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let v="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",v,this.allowedPageGeoRegion)}{let y=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",y,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let f="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",f,"","(has to follow ISO standard of 2 letters in uppercase)")}{let b=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",b,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName+" shown"),(void 0!==this.message.custom&&"page view"==this.message.event[0].eventInfo.eventName||"error"==this.message.event[0].eventInfo.eventName)&&void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>mandatoryData.pageVersion,()=>mandatoryData.componentVersion]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let D=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=D.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(w){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+(productIDGenerate+1)]),t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){const N=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(const O of N)if("totalCurrency"==O){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let I="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",I,"","(has to follow ISO 3-letter currency code all upper case)")}{let T=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",T,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[O],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(O)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(O),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(O)>-1)return void variable._throwError("m",O,flagDetermine,"");variable._throwError("o",O,flagDetermine,""),mandatoryData[O]=""}else mandatoryData[O]=convertToNumeric(mandatoryData[O]),mandatoryData[O]=roundToDecimal(mandatoryData[O],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}}));var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let A="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",A,variable.allowedOptionscodeVG)}{let C=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",C,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let S="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",S,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let k=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",k,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let F="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",F,variable.allowedOptionsCategory1,"")}{let x=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",x,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let P="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",P,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let V=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",V,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let W=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=W.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+(optionIdGenerate+1)]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){const _=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(const E of _)if("totalCurrency"==E){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let L="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",L,"","(has to follow ISO 3-letter currency code all upper case)")}{let R=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",R,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[E],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(E)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(E),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(E)>-1)return void variable._throwError("m",E,flagDetermine,"");variable._throwError("o",E,flagDetermine,""),mandatoryData[E]=""}else mandatoryData[E]=convertToNumeric(mandatoryData[E]),mandatoryData[E]=roundToDecimal(mandatoryData[E],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}}));var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||datalayerPath("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(void 0!==mandatoryData&&!hasUserKey)if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState){var users=window.adobeDataLayer.getState();if(void 0!==users.user&&Object.keys(users.user).length>0){var userArray=[];for(var i in users.user)userArray.push(users.user[i]);this.message.user=this.message.user}}else void 0!==getDL("user")&&"string"!=typeof getDL("user")&&(this.message.user=getDL("user"));if("error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if("number"!=typeof mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let j,M,J,B;if(j=M=J=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(B=this.message.cart.item.length-1;B>=0;B--){let U=!1;void 0!==this.message.cart.item[B]&&void 0!==this.message.cart.item[B].price&&(void 0!==this.message.cart.item[B].price.basePrice&&void 0!==this.message.cart.item[B].price.basePrice&&this.message.cart.item[B].price.basePrice>0||void 0!==this.message.cart.item[B].price.priceWithTax&&void 0!==this.message.cart.item[B].price.priceWithTax&&this.message.cart.item[B].price.priceWithTax>0)&&(U=!0);let q=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(q=!0));let H=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,K=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;U||q||U||q||K?K&&this.message.cart.item.splice(B,1):this.message.cart.item.splice(B,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&M.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(B=this.message.transaction.item.length-1;B>=0;B--){let z=!1;void 0!==this.message.transaction.item[B]&&void 0!==this.message.transaction.item[B].price&&(void 0!==this.message.transaction.item[B].price.basePrice&&void 0!==this.message.transaction.item[B].price.basePrice&&this.message.transaction.item[B].price.basePrice>0||void 0!==this.message.transaction.item[B].price.priceWithTax&&void 0!==this.message.transaction.item[B].price.priceWithTax&&this.message.transaction.item[B].price.priceWithTax>0)&&(z=!0);let Q=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(Q=!0));let Y=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,X=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;z||Q?X||this.message.transaction.item.splice(B,1):X&&!z&&Q||!X||z||Q||this.message.transaction.item.splice(B,1),""!=(((this.message.transaction.item[B]||"").productInfo||"").productID||"")&&M.indexOf(this.message.transaction.item[B].productInfo.productID)>-1&&this.message.transaction.item.splice(B,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&J.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(B=this.message.product.length-1;B>=0;B--){let Z=!1;void 0!==this.message.product[B]&&void 0!==this.message.product[B].price&&(void 0!==this.message.product[B].price.basePrice&&void 0!==this.message.product[B].price.basePrice&&this.message.product[B].price.basePrice>0||void 0!==this.message.product[B].price.priceWithTax&&void 0!==this.message.product[B].price.priceWithTax&&this.message.product[B].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ee=!0));let te=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,ae=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;Z&&this.message.product.splice(B,1),!ee||ae||Z||(M.indexOf(this.message.product[B].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[B]),this.message.product.splice(B,1)),ee&&ae&&(J.indexOf(this.message.product[B].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[B]),this.message.product.splice(B,1)),""!=(((this.message.product[B]||"").productInfo||"").productID||"")&&(M.indexOf(this.message.product[B].productInfo.productID)>-1||J.indexOf(this.message.product[B].productInfo.productID)>-1)&&this.message.product.splice(B,1)}function G(e){return-1*Math.abs(Number(e))}function $(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let oe=0;Object.keys(this.message.cart.item).forEach((e=>{oe+=(e.price||0).basePrice||0})),oe=$(oe,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>oe,()=>0])||0),this.message.cart.price.discountAmountAdditional=G(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let ie=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ie+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ie+=e.price.discountAmountOther||0)})),ie=$(ie,2),this.message.cart.price.discountItemAmounts=G($(ie,2)),this.message.cart.price.discountAmountSum=G($(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ne=0;Object.keys(this.message.cart.item).forEach((e=>{ne+=(e.price||0).taxAmount||0})),ne=$(ne,2),this.message.cart.price.taxItemsAmount=$(ne,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=$(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=$(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=$(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.transaction.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=$(re,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.transaction.total.discountAmountAdditional=G(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=$(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let se=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=$(se,2),this.message.transaction.total.discountItemAmounts=G($(se,2)),this.message.transaction.total.discountAmountSum=G($(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.transaction.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=$(ce,2),this.message.transaction.total.taxItemsAmount=$(ce,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=$(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=$(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){var m=["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){if(m=["codeVG"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){if(m=["selectionState"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){if(m=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){const a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));const o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};const r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){const n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ";let r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`}r=n+r,"m"===e?TRON.customConsole.error(r):"o"==e&&TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),TRON.customConsole.info(t),console.groupEnd()):TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():(this._sendCustomEvent(),this._sendGenericEvent()),this.message={}}_sendCustomEvent(){let e=!1;try{e=new CustomEvent(this.customEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("✅ custom event successfully sent",e)}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("✅ generic event successfully sent",e)}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("✅ postmessage successful sent",e)}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getDataLayerFromApi(){const e=window.digitals2&&window.digitals2.tracking&&window.digitals2.tracking.api;if(void 0!==e){const t=e.getCurrentPageIndex();let a;for(let a=t;a>0;a--)if("object"==typeof e.getPageObject(a).page&&"VCO"==e.getPageObject(a).page.category.primaryCategory){t=a;break}if(a=e.getPageObject(t),void 0!==a.pageInstanceId&&""!=a.pageInstanceId&&-1==a.pageInstanceId.indexOf("need-analyzer"))return a;if(void 0!==a.component&&a&&a.component[0]&&a.component[0].category&&"stock locator"==a.component[0].category.subCategory01)return a;if(void 0!==a.component&&a&&a.component[0]&&a.component[0].componentInfo&&"digital checkout solution"==a.component[0].componentInfo.componentName)return a;if(void 0!==a.pageInstanceId&&""!=a.pageInstanceId&&a.product.length>0)return a;if(void 0!==a.pageInstanceId&&""!=a.pageInstanceId)return t&&t>0?(a=e.getPageObject(t),a):(a=e.getPageObject(0),a)}}function getDataLayerFromSources(){return gFFWNV([getDataLayerFromApi,()=>{if("undefined"!=typeof BMWdataLayer)return JSON.parse(JSON.stringify(BMWdataLayer))},()=>{if("undefined"!=typeof mnm&&""!=((((mnm||"").mnmnsc||"").page||"").currentPage||"")&&void 0!==mnm.mnmnsc.page.currentPage.getTrackingService)return mnm.mnmnsc.page.currentPage.getTrackingService().getDigitalData()},()=>{if("undefined"!=typeof datalayer_localForms){const e=(datalayer_localForms||"").event||[];if(e.length>0)return e[e.length-1]}},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.digitalData&&window.dataLayer){const e=digital.tracking.getInstance(window.dataLayer),t=e.getCurrentPageIndex()||0,a=e.getPageObject(t);if("object"==typeof a&&0==Object.keys(a).length&&void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;if(""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0)return window.dataLayer.pages[e]}return JSON.parse(JSON.stringify(a))}},()=>{if(void 0!==window.h5vco&&""!=((window.h5vco||"").digitalData||""))return window.h5vco.digitalData},()=>{if(void 0!==window.dcsDataLayer&&""!=((window.dcsDataLayer||"").pages||"")){const e=window.dcsDataLayer.activePageIndex||0;return window.dcsDataLayer.pages[e]}},()=>{if(void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;return""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0?window.dataLayer.pages[e]:window.dataLayer}},()=>{if(void 0!==window.digitalData)return JSON.parse(JSON.stringify(window.digitalData))},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.dataLayer){const e=digital.tracking.getInstance(),t=e.getCurrentPageIndex()||0,a=e.getPageObject(t);return JSON.parse(JSON.stringify(a))}}],{})}function extractFrmPageDL(){try{return getDataLayerFromSources()||""}catch(e){return""}}function getDL(e,t){try{for(var a=(e=e||"").split("."),o=extractFrmPageDL(),i=0;i<a.length&&null!=o;i++)null!=a[i]&&""!=a[i]&&(o=Array.isArray(o)&&/-[0-9]+/.test(a[i])?o[o.length-Math.abs(parseInt(a[i]))]:o[a[i]]);return"string"==typeof o&&["","na","not set","n/a","not available","not yet available","not selected","unknown"].indexOf(o.toLowerCase())>-1?t:o||t||""}catch(e){return""}}function evaluateDLPath(e){return""!=getDL(e)&&void 0!==getDL(e)?getDL(e):""}function datalayerPath(e){return""!=getDL(e)&&void 0!==getDL(e)?getDL(e):void 0}function getFirstFunctionWithValue(e,t){for(let a of e)try{const e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>datalayerPath("page.attributes.brand"),()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function buildPageObj(){var e=JSON.parse(JSON.stringify(datalayerPath("page.attributes")||""))||{};return e.brand=determineBrand(),e.pageTitle=gFFWNV([()=>datalayerPath("page.title"),()=>datalayerPath("page.pageInfo.pageTitle"),()=>document.title]),e.timeZone=gFFWNV([()=>datalayerPath("page.attributes.timeZone")]),{attributes:JSON.parse(JSON.stringify(e)),category:{pageType:gFFWNV([()=>datalayerPath("page.category.pageType"),()=>datalayerPath("page.category.formType"),()=>datalayerPath("page.category.primaryTags")]),primaryCategory:gFFWNV([()=>"NBC"==datalayerPath("page.attributes.template")&&"configurator",()=>"object"==typeof datalayerPath("page.category.primaryTags")&&datalayerPath("page.category.primaryTags.0"),()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&"all-models"==datalayerPath("pageInstanceId").split("/")[6]&&datalayerPath("pageInstanceId").split("/")[6].length>8&&"showroom",()=>8==datalayerPath("pageInstanceId").split("/")[6].length&&"series overview",()=>datalayerPath("page.pageHier"),()=>datalayerPath("page.category.subCategory01"),()=>datalayerPath("page.category.primaryCategory"),()=>datalayerPath("page.primarySection"),()=>datalayerPath("page.category.primaryTags"),()=>TRON.componentName]),subCategory1:gFFWNV([()=>"object"==typeof datalayerPath("page.category.secondaryTags")&&datalayerPath("page.category.secondaryTags.0"),()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[7]&&datalayerPath("pageInstanceId").split("/")[7],()=>datalayerPath("page.pageLevel2"),()=>datalayerPath("page.category.subCategory01"),()=>datalayerPath("page.category.purchaseReason"),()=>datalayerPath("page.category.subCategory1")]),subCategory2:gFFWNV([()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[8]&&datalayerPath("pageInstanceId").split("/")[8],()=>datalayerPath("page.pageLevel3"),()=>datalayerPath("page.category.subCategory02"),()=>datalayerPath("page.category.subCategory2")]),subCategory3:gFFWNV([()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[9]&&datalayerPath("pageInstanceId").split("/")[9],()=>datalayerPath("page.pageLevel4"),()=>datalayerPath("page.category.subCategory03"),()=>datalayerPath("page.category.subCategory3")])},pageInfo:{author:datalayerPath("page.pageInfo.author"),destinationURL:gFFWNV([()=>datalayerPath("page.url"),()=>datalayerPath("page.pageInfo.destinationUrl"),()=>datalayerPath("page.pageInfo.destinationURL")]),geoRegion:gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>datalayerPath("page.pageInfo.geoRegion"),()=>datalayerPath("page.pageInfo.language").indexOf("-")>-1&&datalayerPath("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":""]),language:gFFWNV([()=>datalayerPath("page.pageInfo.language").slice(0,2)||(datalayerPath("page.pageInfo.language").indexOf("-")>-1?datalayerPath("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":"")]),pageID:gFFWNV([()=>datalayerPath("page.path"),()=>datalayerPath("page.name"),()=>datalayerPath("page.pageInfo.pageInstanceId"),()=>window.dataLayer&&window.dataLayer.pages&&(window.dataLayer.pages[0]||"").pageInstanceId,()=>datalayerPath("page.pageInfo.pageID")]),pageName:gFFWNV([()=>datalayerPath("page.name"),()=>datalayerPath("page.pageInfo.pageName")]),referringURL:gFFWNV([()=>datalayerPath("page.pageInfo.referringUrl"),()=>datalayerPath("page.pageInfo.referringURL"),()=>document.referrer]),sysEnv:gFFWNV([()=>datalayerPath("page.pageInfo.devEnv"),()=>datalayerPath("page.pageInfo.envWork"),()=>datalayerPath("page.pageInfo.sysEnv")]),variant:gFFWNV([()=>datalayerPath("page.pageInfo.variant"),()=>"true"==datalayerPath("page.attributes.virtualPage")?"virtual page":"real page"]),version:"acdl: "+datalayerPath("page.pageInfo.version")}}}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)void 0!==n[r]&&void 0!==n[r].productInfo&&(void 0===(b=n[r].productInfo.productID)&&(b="product"+(+r+1)),a[b]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(b));Object.keys(a).forEach((e=>o.push(e)));var s=a}var c="page view"==e.event[0].eventInfo.eventName,l=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),d=((e.page||"").pageInfo||"").pageName||"";c&&(l?"tbd"!=d&&""!=d&&(c&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):l||("tbd"!=d&&""!=d||void 0!==d)&&(c&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})));let m={},u=e.component[0].componentInfo.componentID;m[u]=e.component[0],t.push({component:m,version:e.version});var p={},g=e.cart;if(g&&g.item.length>0&&"string"!=typeof g){for(var r in g.item)void 0!==g.item[r]&&void 0!==g.item[r].productInfo&&void 0!==(b=g.item[r].productInfo.productID)&&(p[b]=g.item[r]);for(var r in p=Object.assign({},p))for(var h in e.cart.item)r==e.cart.item[h].productInfo.productID&&(p[r].price=Object.assign({},e.cart.item[h].price),p[r].quantity=e.cart.item[h].quantity);var v={item:p,price:e.cart.price,cartID:e.cart.cartID}}var y={},f=e.transaction;if(f&&f.item.length>0&&"string"!=typeof f&&void 0!==f.transactionID){for(var r in f.item){var b;void 0!==f.item[r]&&void 0!==f.item[r].productInfo&&void 0!==(b=f.item[r].productInfo.productID)&&(y[b]=f.item[r])}for(var r in y=Object.assign({},y))for(var h in e.transaction.item)r==e.transaction.item[h].productInfo.productID&&(y[r].price=Object.assign({},e.transaction.item[h].price),y[r].quantity=e.transaction.item[h].quantity);var D={item:y,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(adobeDataLayer.getState("dealer")).map((function(e){return adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(var r in O)if(void 0!==O[r]&&void 0!==O[r].dealerInfo){var I=O[r].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[r])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(adobeDataLayer.getState("user")).map((function(e){return adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(var r in S){var k,F={};if(Array.isArray(S[r].profile)&&S[r].profile.length>0)for(var h in S[r].profile)F[x=null!=S[r].profile[h].profileInfo.profileID?S[r].profile[h].profileInfo.profileID:"profile"+(+h+1)]=JSON.parse(JSON.stringify(S[r].profile[h]));else if(void 0===S[r].profile&&void 0!==S[r].profileInfo&&!Array.isArray(S[r].profileInfo)){var x="profile"+(+r+1);F.profile={},F.profile[x]=JSON.parse(JSON.stringify(S[r].profileInfo))}k=void 0!==x&&(x+"").indexOf("profile")>-1?"user"+(+r+1):x,C[k]=JSON.parse(JSON.stringify(S[r])),C[k].profile=JSON.parse(JSON.stringify(F))}e.user=JSON.parse(JSON.stringify(C)),Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>Object.keys(C[e].profile).forEach((e=>A[e]="")))),A=Object.keys(A),t.push({user:e.user})}var P="page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",V=(e.event[0].eventInfo.eventName,{event:P,eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,reference:{linkedComponent:[u],linkedUser:T,linkedProfile:A}}});if(void 0!==e.paramsPassed){let E,L,R,j=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(E=void 0!==adobeDataLayer.getState("cart")&&Object.keys(adobeDataLayer.getState("product"))||[],L=void 0!==adobeDataLayer.getState("cart")&&void 0!==adobeDataLayer.getState("cart.item")&&Object.keys(adobeDataLayer.getState("cart.item"))||[],R=void 0!==adobeDataLayer.getState("transaction")&&void 0!==adobeDataLayer.getState("transaction.item")&&Object.keys(adobeDataLayer.getState("transaction.item"))||[]):E=L=R=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===v&&(v={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==s&&void 0!==s&&Object.keys(s).length>0)for(var W in s){let J=!1;void 0!==s[W]&&void 0!==s[W].price&&(void 0!==s[W].price.basePrice&&void 0!==s[W].price.basePrice&&s[W].price.basePrice>0||void 0!==s[W].price.priceWithTax&&void 0!==s[W].price.priceWithTax&&s[W].price.priceWithTax>0)&&(J=!0);let B=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(B=!0)),void 0!==j.cartID&&j.cartID;let G=void 0!==j.transactionID&&""!=typeof j.transactionID;J||B?G?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==v&&Object.keys(v.item).length>0)for(var W in v.item){let $=!1;void 0!==v.item[W]&&void 0!==v.item[W].price&&(void 0!==v.item[W].price.basePrice&&void 0!==v.item[W].price.basePrice&&v.item[W].price.basePrice>0||void 0!==v.item[W].price.priceWithTax&&void 0!==v.item[W].price.priceWithTax&&v.item[W].price.priceWithTax>0)&&($=!0);let U=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(U=!0)),void 0!==j.cartID&&j.cartID;let q=void 0!==j.transactionID&&""!=typeof j.transactionID;$||U?q?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==D&&Object.keys(D.item).length>0)for(var W in D.item){let H=!1;void 0!==D.item[W]&&void 0!==D.item[W].price&&(void 0!==D.item[W].price.basePrice&&void 0!==D.item[W].price.basePrice&&D.item[W].price.basePrice>0||void 0!==D.item[W].price.priceWithTax&&void 0!==D.item[W].price.priceWithTax&&D.item[W].price.priceWithTax>0)&&(H=!0);let K=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(K=!0)),void 0!==j.cartID&&j.cartID;let z=void 0!==j.transactionID&&""!=typeof j.transactionID;H||K?z?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}function M(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(W)||(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(W)&&(D.item[W]=JSON.parse(JSON.stringify(s[W]))),void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(W)&&(D.item[W]=JSON.parse(JSON.stringify(v.item[W]))))):(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(s[a]))),void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(v.item[a])))),M(s,a),M(v?.item,a)):"linkedCartItems"===e?(void 0===v||void 0===v.item||Object.keys(v.item).includes(a)||(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(a)&&(v.item[a]=JSON.parse(JSON.stringify(s[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(v.item[a]=JSON.parse(JSON.stringify(D.item[a])))),M(s,a),M(D?.item,a)):"linkedProducts"===e&&(void 0!==s&&Object.keys(s).length>0&&!Object.keys(s).includes(a)&&(void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(a)&&(s[a]=JSON.parse(JSON.stringify(v.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(s[a]=JSON.parse(JSON.stringify(D.item[a])))),M(v?.item,a),M(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{const t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function Q(e){return-1*Math.abs(Number(e))}function Y(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let X=0;Object.keys(D.item).forEach((e=>{X+=(e.price||0).basePrice||0})),X=Y(X,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>X,()=>0])||0),D.total.discountAmountAdditional=Q(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=Y(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let Z=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Z+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Z+=e.price.discountAmountOther||0)})),Z=Y(Z,2),D.total.discountItemAmounts=Q(Y(Z,2)),D.total.discountAmountSum=Q(Y(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let ee=0;Object.keys(D.item).forEach((e=>{ee+=(e.price||0).taxAmount||0})),ee=Y(ee,2),D.total.taxItemsAmount=Y(ee,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=Y(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=Y(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==v&&void 0!==v.price&&1==Object.keys(v.price).length){function te(e){return-1*Math.abs(Number(e))}function ae(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}v.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let oe=0;Object.keys(v.item).forEach((e=>{oe+=(e.price||0).basePrice||0})),oe=ae(oe,2),v.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>oe,()=>0])||0),v.price.discountAmountAdditional=te(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),v.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ie=0;Object.keys(v.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ie+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ie+=e.price.discountAmountOther||0)})),ie=ae(ie,2),v.price.discountItemAmounts=te(ae(ie,2)),v.price.discountAmountSum=te(ae(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>v.price.discountItemAmounts+v.price.discountAmountAdditional,()=>0])||0),2));let ne=0;Object.keys(v.item).forEach((e=>{ne+=(e.price||0).taxAmount||0})),ne=ae(ne,2),v.price.taxItemsAmount=ae(ne,2),v.price.taxAmountSum=+(gFFWNV([()=>v.price.taxItemsAmount+v.price.taxAmountAdditional,()=>0])||0),v.price.priceWithTax=ae(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>v.price.basePrice+v.price.discountAmountSum+v.price.taxAmountSum,()=>0])||0),2),v.price.shipping=ae(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),v.price.cartTotal=ae(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>v.price.priceWithTax+v.price.shipping,()=>0])||0),2)}void 0!==V.eventInfo.reference.linkedTransactionItems&&V.eventInfo.reference.linkedTransactionItems.filter((function(e,t){return V.eventInfo.reference.linkedTransactionItems.indexOf(e)===t})),void 0!==V.eventInfo.reference.linkedCartItems&&V.eventInfo.reference.linkedCartItems.filter((function(e,t){return V.eventInfo.reference.linkedCartItems.indexOf(e)===t})),void 0!==V.eventInfo.reference.linkedProducts&&V.eventInfo.reference.linkedProducts.filter((function(e,t){return V.eventInfo.reference.linkedProducts.indexOf(e)===t}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==s&&void 0!==s&&Object.keys(s).length>0){for(var _ in s)Object.keys(s[_]).indexOf("price")>-1&&delete s[_].price,Object.keys(s[_]).indexOf("quantity")>-1&&delete s[_].quantity;t.push({product:a})}return void 0!==v&&Object.keys(v.item).length>0&&t.push({cart:v}),void 0!==D&&Object.keys(D.item).length>0&&t.push({transaction:D}),t.push(V),t}TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];for(var t=convertToACDL(tronDetailDL),a={},o=0;o<t.length;o++)for(var i=t[o],n=Object.keys(i),r=0;r<n.length;r++){var s=n[r];a[s]=i[s]}if(window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(var o in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[o]);window.TRON.warningCode=[]}})),TRON.isInitialized=!0)},775:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: customer self-service",libraryName:"customer_self_service",libraryVersion:"_v3.1.3",prefix:"shared > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"standalone",primaryCategory:"",subCategory1:"order overview"},componentInfo:{componentName:"customer self service",componentID:"customer self service"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"critical tech works",destinationURL:"",referringURL:"",sysEnv:"",variant:"virtual page",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=[],e.baseMandatoryData=[],e.baseOptionalData=["componentDEVagency","componentPlatform","userProfileID","componentVersion","userLoginStatus","userStateProvince","userLanguage","userSegment","userCountry","transactionID","totalPaymentMethod","totalCurrency","totalShippingCost","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalBasePrice","totalDiscountAmount","totalTaxAmount","totalPriceWithTax","totalFinalPrice","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=["vehicle[n].name","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].manufacturer"],e.productOptionalData=["vehicle[n].status","vehicle[n].category2","vehicle[n].color","vehicle[n].engine","vehicle[n].gearing","vehicle[n].subSeries","vehicle[n].series","vehicle[n].hybridVersion","vehicle[n].bodyType","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].encVIN","vehicle[n].itemBasePrice","vehicle[n].itemVoucherCode","vehicle[n].itemTaxAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemShippingMethod","vehicle[n].salesModel","vehicle[n].fuelType","vehicle[n].category3","vehicle[n].linkedDealerOutletBuno","vehicle[n].linkedDealerCount","vehicle[n].packageID","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemQuantity","options[n].status","options[n].manufacturer","options[n].name","options[n].productID","options[n].primaryCategory","options[n].category1","options[n].category2","options[n].businessDivision","options[n].itemBasePrice","options[n].itemVoucherCode","options[n].itemTaxAmount","options[n].itemPriceWithTax","options[n].itemShippingMethod","options[n].finDownPayment","options[n].finMonthlyPayment","options[n].finTerm","options[n].finMileage","options[n].category3","options[n].color","options[n].size","options[n].codeVG","options[n].linkedDealerOutletBuno","options[n].linkedDealerCount","options[n].packageID","options[n].range","options[n].salesModel","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemQuantity"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="css";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},cssHandover:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user booked "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"guests: "})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["handoverType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["guestAdults","guestChildren","linkLocation","eventSubCat1","eventCause"]),description:'\n 🆕 <i style="color:darkblue"> For now this custom event is kept. This may change in the future.</i>\n<hr>\n<br>Trigger this when the user clicks on save/continue after having selected a handover method and provided information on how many guests s(he) would like to take. \n    <br> <u> some sample values for dynamic parameters: </u>\n    <br> handoverType = "standard handover", "quick check-in"\n    <br> guestAdults -> number of adults that are invited as guests. <i>This will be mapped to solution specific variables</i>\n    <br> guestChildren -> number of children that are invited as guests. <i>This will be mapped to solution specific variables</i>\n    <br> transactionID = This is used for orderID.'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{void 0!==e.primaryCategory&&""!=e.primaryCategory||("new vehicle"==e.businessDivision&&(e.primaryCategory="new car"),"used vehicle"==e.businessDivision&&(e.primaryCategory="used car"))})),void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(r){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(s){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(c){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(d){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(m){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(u){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let p="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",p,this.allowedPageGeoRegion)}{let g=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",g,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let h="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",h,"","(has to follow ISO standard of 2 letters in uppercase)")}{let v=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",v,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let y=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(y)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=y}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let f=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(f)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let b="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",b,this.allowedFilterObjects)}{let D=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",D,this.allowedFilterObjects)}}mandatoryData.filterObject=f}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||""));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let w=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=w.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(N){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let O=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let I of O)if("totalCurrency"==I){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let T="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",T,"","(has to follow ISO 3-letter currency code all upper case)")}{let A=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",A,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[I],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(I)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(I),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(I)>-1)return void variable._throwError("m",I,flagDetermine,"");variable._throwError("o",I,flagDetermine,""),mandatoryData[I]=""}else mandatoryData[I]=convertToNumeric(mandatoryData[I]),mandatoryData[I]=roundToDecimal(mandatoryData[I],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let C="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",C,variable.allowedOptionscodeVG)}{let S=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",S,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let k="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",k,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let F=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",F,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let x="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",x,variable.allowedOptionsCategory1,"")}{let P=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",P,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let V="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",V,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let W=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",W,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let _=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=_.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let E=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let L of E)if("totalCurrency"==L){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let R="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",R,"","(has to follow ISO 3-letter currency code all upper case)")}{let j=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",j,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[L],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(L)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(L),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(L)>-1)return void variable._throwError("m",L,flagDetermine,"");variable._throwError("o",L,flagDetermine,""),mandatoryData[L]=""}else mandatoryData[L]=convertToNumeric(mandatoryData[L]),mandatoryData[L]=roundToDecimal(mandatoryData[L],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let M=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(M)){let J="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",J,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=M}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let B="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",B,"","(has to follow ISO standard of 2 letters in uppercase)")}{let G=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let $="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",$,this.alloweduserCountry)}{let U=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",U,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(q){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==mandatoryData.guestAdults&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1+mandatoryData.guestAdults+" adults"),void 0!==mandatoryData.guestChildren&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1+" and "+mandatoryData.guestChildren+" children"),void 0!==effectString&&effectString.includes("user booked")&&(mandatoryData.handoverType,1)&&void 0!==mandatoryData.handoverType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.handoverType),mandatoryData.guestAdults&&void 0!==mandatoryData.guestAdults&&(this.message.event[0].attributes.solutionSpecific.evar151=mandatoryData.guestAdults),mandatoryData.guestChildren&&void 0!==mandatoryData.guestChildren&&(this.message.event[0].attributes.solutionSpecific.evar152=mandatoryData.guestChildren),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let H,K,z;if(H=K=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(z=this.message.cart.item.length-1;z>=0;z--){let Y=!1;void 0!==this.message.cart.item[z]&&void 0!==this.message.cart.item[z].price&&(void 0!==this.message.cart.item[z].price.basePrice&&void 0!==this.message.cart.item[z].price.basePrice&&this.message.cart.item[z].price.basePrice>0||void 0!==this.message.cart.item[z].price.priceWithTax&&void 0!==this.message.cart.item[z].price.priceWithTax&&this.message.cart.item[z].price.priceWithTax>0)&&(Y=!0);let X=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(X=!0));let Z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;Y||X||Y||X||Z?Z&&this.message.cart.item.splice(z,1):this.message.cart.item.splice(z,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&H.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(z=this.message.transaction.item.length-1;z>=0;z--){let ee=!1;void 0!==this.message.transaction.item[z]&&void 0!==this.message.transaction.item[z].price&&(void 0!==this.message.transaction.item[z].price.basePrice&&void 0!==this.message.transaction.item[z].price.basePrice&&this.message.transaction.item[z].price.basePrice>0||void 0!==this.message.transaction.item[z].price.priceWithTax&&void 0!==this.message.transaction.item[z].price.priceWithTax&&this.message.transaction.item[z].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee||te?ae||this.message.transaction.item.splice(z,1):!ae||ee||te||this.message.transaction.item.splice(z,1),""!=(((this.message.transaction.item[z]||"").productInfo||"").productID||"")&&H.indexOf(this.message.transaction.item[z].productInfo.productID)>-1&&this.message.transaction.item.splice(z,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(z=this.message.product.length-1;z>=0;z--){let oe=!1;void 0!==this.message.product[z]&&void 0!==this.message.product[z].price&&(void 0!==this.message.product[z].price.basePrice&&void 0!==this.message.product[z].price.basePrice&&this.message.product[z].price.basePrice>0||void 0!==this.message.product[z].price.priceWithTax&&void 0!==this.message.product[z].price.priceWithTax&&this.message.product[z].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ie=!0));let ne=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;oe&&this.message.product.splice(z,1),!ie||ne||oe||(H.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[z]),this.message.product.splice(z,1)),ie&&ne&&(K.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[z]),this.message.product.splice(z,1)),""!=(((this.message.product[z]||"").productInfo||"").productID||"")&&(H.indexOf(this.message.product[z].productInfo.productID)>-1||K.indexOf(this.message.product[z].productInfo.productID)>-1)&&this.message.product.splice(z,1)}function Q(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.cart.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=this.roundToDecimal(re,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.cart.price.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let se=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=this.roundToDecimal(se,2),this.message.cart.price.discountItemAmounts=Q(this.roundToDecimal(se,2)),this.message.cart.price.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.cart.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=this.roundToDecimal(ce,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(ce,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let le=0;Object.keys(this.message.transaction.item).forEach((e=>{le+=(e.price||0).basePrice||0})),le=this.roundToDecimal(le,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>le,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let de=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(de+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(de+=e.price.discountAmountOther||0)})),de=this.roundToDecimal(de,2),this.message.transaction.total.discountItemAmounts=Q(this.roundToDecimal(de,2)),this.message.transaction.total.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let me=0;Object.keys(this.message.transaction.item).forEach((e=>{me+=(e.price||0).taxAmount||0})),me=this.roundToDecimal(me,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(me,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},5924:(e,t,a)=>{a.d(t,{ZP:()=>i}),window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return n([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${n([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>r()])||""}/${n([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${n([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,s={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},c=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},l=void 0!==s[i]?s[i]:(c.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(s,mandatoryData.componentPrimaryCat)&&(prefix=i=o(s,mandatoryData.componentPrimaryCat)),""==l||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(d=location.host).split(".")[1];var d,m=d.split(".")[0],u=(d=location.host).split(".")[1],p=location.pathname.split("/")[1].length;"com"===d.split(".")[2]&&"bmw"===u&&2===p?(l="special website",i="special > "):"bmw"===u||"mini"===u||"bmw-motorrad"===u||"bmwusa"===u||"rolls-roycemotorcars"===u||"bmwgroup"===u&&"customer"===m||"bmwgroup"===u&&"tron"===m?(l="nsc website",i="nsc > "):(l="special website",i="special > ")}else l="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let g={},h="";void 0!==a&&(a[0].category.primaryCategory=l,h=a[0].componentInfo.componentID,g[h]=a[0]);var v=window.TRON.version.split("¦");e.indexOf("e0")>-1?v[v.length-1]="error_"+v[v.length-1]:e.indexOf("w0")>-1&&(v[v.length-1]="warning_"+v[v.length-1]);var y={component:g,version:v=v.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[h]}}},f={},b=[],D=[],w=[];if(w.length>0&&"string"!=typeof w){for(var N in w)if(void 0!==w[N]&&void 0!==w[N].productInfo){var O=w[N].productInfo.productID;void 0===O&&(O="product"+(N+1)),f[O]=w[N],void 0!==w[N].category.primaryCategory&&(w[N].category.primaryCategory.indexOf("car")>-1||w[N].category.primaryCategory.indexOf("bike")>-1)&&D.push(O)}Object.keys(f).forEach((e=>b.push(e))),y.product=f}var I={},T={},A=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(A=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),A.length>0&&"string"!=typeof A){for(var N in A)void 0!==A[N]&&void 0!==A[N].dealerInfo&&(I[A[N].dealerInfo.dealerOutletBuno]=A[N]);Object.keys(I).forEach((e=>T[e]="")),y.dealer=I}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var C=window.adobeDataLayer.getState("user");void 0!==C&&Object.keys(C).length>0&&(y.user=C)}e.indexOf("w0")>-1?window.TRON.warningCode.push(y):window.adobeDataLayer.push(y)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const o={customeEventName:"TRON: enhanced activity map",libraryName:"enhanced_activity_map",libraryVersion:"_v3.2.3",prefix:"nsc > ",pageExist:!0},i=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e=function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"navigation"},componentInfo:{componentName:"enhanced activity map",componentID:"enhanced activity map"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=[],e.baseMandatoryData=[],e.baseOptionalData=["componentDEVagency","componentVersion","componentPlatform","vehicle[n].productID","options[n].productID"],e.productMandatoryData=[],e.productOptionalData=[],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"]},t=function(e){e.events||(e.events={}),e.events=Object.assign(e.events,{})},a=function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""};(function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=o.customeEventName,e._componentTrackingVersion=o.libraryName+""+o.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`})(this),e(this),a(this),t(this);let i=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in i)this[i[e]]=this[i[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(e,t){void 0===t&&(t={}),window.TRON.currentEventName=e,window.TRON.prefix=o.prefix,window.TRON.componentName=o.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==t&&(void 0!==t.componentName&&(window.TRON.componentName=t.componentName),void 0!==t.formOrigin&&(window.TRON.componentName=t.formOrigin),void 0!==t.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+t.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e;var a=`${r()}/${n([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==t&&void 0!==t.pageGeoRegion&&t.pageGeoRegion.toLowerCase()])}_${n([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==t&&void 0!==t.pageLanguage?t.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:a},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var i=JSON.parse(JSON.stringify(t));this._debug("💡 event triggered:"+e,i),t=this.transformData(t),t=this._trimWhitespace(t),this.scanForPIIKeywords(t),this._checkParamsPassed(e,i,t),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(t),this.message=this._loadEventData(e,t);try{this._checkmandatoryData(e,t),this.events[e].optionalData&&this._checkOptionalData(e,t)}catch(N){return"object"==typeof N&&void 0!==N.name&&"SyntaxError"==N.name&&void 0!==N.message&&"Missing Mandatory Data"==N.message||window.TRON.customConsole.error(N),!1}var s=o.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,e,t)}catch(O){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,e,t)}catch(I){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,e,t)}catch(T){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,e,t)}catch(A){return!1}function c(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=n([()=>t.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=n([()=>t.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=n([()=>t.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==t.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==t.componentName?(this.message.component[0].componentInfo.componentName=t.componentName,this.message.event[0].category.primaryCategory=t.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==t.componentPlatform&&(this.message.component[0].attributes.platform=n([()=>t.componentPlatform]));var l=void 0!==s?s:TRON.prefix,d={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},m=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},u=void 0!==d[l]?d[l]:(m.category||{}).primaryCategory||"";if(void 0!==t&&void 0!==t.componentPrimaryCat&&void 0===s&&"nsc > "==TRON.prefix&&null!=c(d,t.componentPrimaryCat)&&(s=l=c(d,t.componentPrimaryCat)),""==u||"shared > "==l||"local > "==l)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(p=location.host).split(".")[1];var p,g=p.split(".")[0],h=(p=location.host).split(".")[1],v=location.pathname.split("/")[1].length;"com"===p.split(".")[2]&&"bmw"===h&&2===v?(u="special website",l="special > "):"bmw"===h||"mini"===h||"bmw-motorrad"===h||"bmwusa"===h||"rolls-roycemotorcars"===h||"bmwgroup"===h&&"customer"===g||"bmwgroup"===h&&"tron"===g?(u="nsc website",l="nsc > "):(u="special website",l="special > ")}else u="special website",l="special > ";if(void 0!==s&&(s=l),void 0!==TRON.prefix&&(TRON.prefix=l),this.message.component[0].category.primaryCategory=u,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==t&&t.componentVersion&&(this.message.component[0].attributes.componentVersion=t.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==t&&(this.message.component[0].componentInfo.componentID=r(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.pageGeoRegion?t.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==t.formType?t.formType:"")),window.TRON.componentName=(void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==s&&(s=s.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(s||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var y=[],f=[];for(var b in this.message.product)if(void 0!==this.message.product[b]&&void 0!==this.message.product[b].productInfo){var D=this.message.product[b].productInfo.productID;void 0===D&&(D="product"+(b+1)),y.push(D),void 0!==this.message.product[b].category.primaryCategory&&(this.message.product[b].category.primaryCategory.indexOf("car")>-1||this.message.product[b].category.primaryCategory.indexOf("bike")>-1)&&f.push(D)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(f):this.message.page.pageInfo.reference.defaultProducts=[].concat(y)}if(Object.keys(t).some((e=>e.startsWith("user")))||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==t.errorMessage?(s||"")+t.errorMessage:"",void 0!==t.errorAction&&(this.message.event[0].eventInfo.eventAction=t.errorAction),void 0!==t.errorCause&&(this.message.event[0].eventInfo.cause=t.errorCause),void 0!==t.errorType&&(this.message.event[0].eventInfo.type=t.errorType),this.message.event[0].category.primaryCategory=t.componentName||this.message.component[0].componentInfo.componentName,void 0!==t.errorCode&&(this.message.event[0].category.subCategory1=t.errorCode),void 0!==t.errorOrigin&&(this.message.event[0].category.subCategory2=t.errorOrigin),void 0!==t.errorURL&&(this.message.event[0].attributes.requestedURL=t.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),t.eventCause&&null!=t.eventCause&&(this.message.event[0].eventInfo.cause=t.eventCause),t.requestedURL&&null!=t.requestedURL&&(this.message.event[0].attributes.requestedURL=t.requestedURL),void 0!==t.iframeURL&&(this.message.event[0].attributes.relatedURL=n([()=>t.iframeURL])),void 0!==t.eventPoints||"string"==typeof t.eventPoints&&0==t.eventPoints.trim().length){if(t.eventPoints=+t.eventPoints,"number"!=typeof t.eventPoints||NaN!=t.eventPoints){var w=void 0!==t.eventPoints&&""==t.eventPoints?"empty":"incorrect-numeric";if(this.events[e].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",w,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",w,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(t.eventPoints)?void 0:+t.eventPoints}if(void 0===t.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==t.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof t.eventAction&&t.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=t.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),t.stepAmounts&&void 0!==t.stepAmounts&&(t.step&&void 0!==t.step?this.message.event[0].attributes.stepAmounts="step "+t.step+"/"+t.stepAmounts:this.message.event[0].attributes.stepAmounts=t.stepAmounts),void 0===t.stepAmounts&&t.step&&void 0!==t.step&&(this.message.event[0].attributes.stepAmounts="step "+t.step+"/x"),this.message.component[0].componentInfo.componentID=`${n([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>r()])||""}/${n([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${n([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(t)),void 0!==t){let C,S,k;if(C=S=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(k=this.message.cart.item.length-1;k>=0;k--){let x=!1;void 0!==this.message.cart.item[k]&&void 0!==this.message.cart.item[k].price&&(void 0!==this.message.cart.item[k].price.basePrice&&void 0!==this.message.cart.item[k].price.basePrice&&this.message.cart.item[k].price.basePrice>0||void 0!==this.message.cart.item[k].price.priceWithTax&&void 0!==this.message.cart.item[k].price.priceWithTax&&this.message.cart.item[k].price.priceWithTax>0)&&(x=!0);let P=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(P=!0));let V=void 0!==t.transactionID&&""!=t.transactionID;x||P||x||P||V?V&&this.message.cart.item.splice(k,1):this.message.cart.item.splice(k,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&C.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(k=this.message.transaction.item.length-1;k>=0;k--){let W=!1;void 0!==this.message.transaction.item[k]&&void 0!==this.message.transaction.item[k].price&&(void 0!==this.message.transaction.item[k].price.basePrice&&void 0!==this.message.transaction.item[k].price.basePrice&&this.message.transaction.item[k].price.basePrice>0||void 0!==this.message.transaction.item[k].price.priceWithTax&&void 0!==this.message.transaction.item[k].price.priceWithTax&&this.message.transaction.item[k].price.priceWithTax>0)&&(W=!0);let _=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(_=!0));let E=void 0!==t.transactionID&&""!=t.transactionID;W||_?E||this.message.transaction.item.splice(k,1):!E||W||_||this.message.transaction.item.splice(k,1),""!=(((this.message.transaction.item[k]||"").productInfo||"").productID||"")&&C.indexOf(this.message.transaction.item[k].productInfo.productID)>-1&&this.message.transaction.item.splice(k,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&S.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(k=this.message.product.length-1;k>=0;k--){let L=!1;void 0!==this.message.product[k]&&void 0!==this.message.product[k].price&&(void 0!==this.message.product[k].price.basePrice&&void 0!==this.message.product[k].price.basePrice&&this.message.product[k].price.basePrice>0||void 0!==this.message.product[k].price.priceWithTax&&void 0!==this.message.product[k].price.priceWithTax&&this.message.product[k].price.priceWithTax>0)&&(L=!0);let R=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(R=!0));let j=void 0!==t.transactionID&&""!=t.transactionID;L&&this.message.product.splice(k,1),!R||j||L||(C.indexOf(this.message.product[k].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[k]),this.message.product.splice(k,1)),R&&j&&(S.indexOf(this.message.product[k].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[k]),this.message.product.splice(k,1)),""!=(((this.message.product[k]||"").productInfo||"").productID||"")&&(C.indexOf(this.message.product[k].productInfo.productID)>-1||S.indexOf(this.message.product[k].productInfo.productID)>-1)&&this.message.product.splice(k,1)}function F(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(t.totalCurrency||"").toUpperCase();let M=0;Object.keys(this.message.cart.item).forEach((e=>{M+=(e.price||0).basePrice||0})),M=this.roundToDecimal(M,2),this.message.cart.price.basePrice=+(n([()=>t.totalBasePrice,()=>M,()=>0])||0),this.message.cart.price.discountAmountAdditional=F(+(n([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(n([()=>t.totalTaxAmountAdditional,()=>0])||0);let J=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(J+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(J+=e.price.discountAmountOther||0)})),J=this.roundToDecimal(J,2),this.message.cart.price.discountItemAmounts=F(this.roundToDecimal(J,2)),this.message.cart.price.discountAmountSum=F(this.roundToDecimal(+(n([()=>t.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let B=0;Object.keys(this.message.cart.item).forEach((e=>{B+=(e.price||0).taxAmount||0})),B=this.roundToDecimal(B,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(B,2),this.message.cart.price.taxAmountSum=+(n([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(n([()=>t.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(n([()=>t.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(n([()=>t.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=t.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(t.totalCurrency||"").toUpperCase();let G=0;Object.keys(this.message.transaction.item).forEach((e=>{G+=(e.price||0).basePrice||0})),G=this.roundToDecimal(G,2),this.message.transaction.total.basePrice=+(n([()=>t.totalBasePrice,()=>G,()=>0])||0),this.message.transaction.total.discountAmountAdditional=F(+(n([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(n([()=>t.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(n([()=>t.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=n([()=>t.totalPaymentMethod,()=>""])||"";let $=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&($+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&($+=e.price.discountAmountOther||0)})),$=this.roundToDecimal($,2),this.message.transaction.total.discountItemAmounts=F(this.roundToDecimal($,2)),this.message.transaction.total.discountAmountSum=F(this.roundToDecimal(+(n([()=>t.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let U=0;Object.keys(this.message.transaction.item).forEach((e=>{U+=(e.price||0).taxAmount||0})),U=this.roundToDecimal(U,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(U,2),this.message.transaction.total.taxAmountSum=+(n([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(n([()=>t.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(n([()=>t.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=t.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let i=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),n=JSON.parse(JSON.stringify(this.baseEvent)),r=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[i,n,r].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),o.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),o.projConditionCheck&&o.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let s=JSON.parse(JSON.stringify(this.baseCustom||{})),c=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[s,c].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=s(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=s(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function n(e,t={}){return function(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function r(){return n([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function s(e){var t=[],a={},o=[],i=[],r=e.product;if(r.length>0&&"string"!=typeof r){for(var s in r)if(void 0!==r[s]&&void 0!==r[s].productInfo){var c=r[s].productInfo.productID;void 0===c&&(c="product"+(+s+1)),a[c]=r[s],void 0!==r[s].category.primaryCategory&&(r[s].category.primaryCategory.indexOf("car")>-1||r[s].category.primaryCategory.indexOf("bike")>-1)&&i.push(c)}Object.keys(a).forEach((e=>o.push(e)));var l=a}var d="page view"==e.event[0].eventInfo.eventName,m=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),u=((e.page||"").pageInfo||"").pageName||"";if(d&&(m?"tbd"!=u&&""!=u&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):m||("tbd"!=u&&""!=u||void 0!==u)&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!d&&"tbd"!=u&&""!=u&&void 0!==u){var p=u.split(">");""!=(p=(p=p.length>1?p[1]:p[0]).trim())&&"tbd"!=p&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let g={},h=e.component[0].componentInfo.componentID;g[h]=e.component[0],t.push({component:g});var v={},y=e.cart;if(y&&y.item.length>0&&"string"!=typeof y){for(let E in y.item)if(void 0!==y.item[E]&&void 0!==y.item[E].productInfo){let L=y.item[E].productInfo.productID;void 0!==L&&(v[L]=y.item[E])}v=Object.assign({},v);for(let R in v)for(let j in e.cart.item)R==e.cart.item[j].productInfo.productID&&(v[R].price=Object.assign({},e.cart.item[j].price),v[R].quantity=e.cart.item[j].quantity);var f={item:v,price:e.cart.price,cartID:e.cart.cartID}}var b={},D=e.transaction;if(D&&D.item.length>0&&"string"!=typeof D&&void 0!==D.transactionID){for(let M in D.item)if(void 0!==D.item[M]&&void 0!==D.item[M].productInfo){let J=D.item[M].productInfo.productID;void 0!==J&&(b[J]=D.item[M])}b=Object.assign({},b);for(let B in b)for(let G in e.transaction.item)B==e.transaction.item[G].productInfo.productID&&(b[B].price=Object.assign({},e.transaction.item[G].price),b[B].quantity=e.transaction.item[G].quantity);var w={item:b,total:e.transaction.total,transactionID:e.transaction.transactionID}}var N={},O={},I=e.dealer;if(I.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(let $ in I)if(void 0!==I[$]&&void 0!==I[$].dealerInfo){var T=I[$].dealerInfo.dealerOutletBuno;void 0!==T&&(N[T]=I[$])}Object.keys(N).forEach((e=>O[e]="")),O=Object.keys(O),Object.keys(N).length>0&&t.push({dealer:N})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var A={},C={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var S={},k=e.user;for(let q in k){var F,x={};if(Array.isArray(k[q].profile)&&k[q].profile.length>0)for(let H in k[q].profile){var P=null!=k[q].profile[H].profileInfo.profileID?k[q].profile[H].profileInfo.profileID:"profile"+(+H+1);x[P]=JSON.parse(JSON.stringify(k[q].profile[H]))}else if(void 0===k[q].profile&&void 0!==k[q].profileInfo&&!Array.isArray(k[q].profileInfo)){let K="profile"+(+q+1);x.profile={},x.profile[K]=JSON.parse(JSON.stringify(k[q].profileInfo))}S[F=P]=JSON.parse(JSON.stringify(k[q])),delete S[F].profile,S[F]=Object.assign({},S[F],JSON.parse(JSON.stringify(x[F])))}let U=JSON.parse(JSON.stringify(S));Object.keys(S).forEach((e=>A[e]="")),A=Object.keys(A),Object.keys(S).forEach((e=>C[e]="")),C=Object.keys(C),t.push({user:U})}var V={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[h],linkedUser:A}}};if(V.eventInfo=JSON.parse(JSON.stringify(V.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let z,Q,Y,X=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(z=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],Q=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Y=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):z=Q=Y=[],void 0===w&&(w={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===f&&(f={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==l&&void 0!==l&&Object.keys(l).length>0)for(var W in l){let ee=!1;void 0!==l[W]&&void 0!==l[W].price&&(void 0!==l[W].price.basePrice&&void 0!==l[W].price.basePrice&&l[W].price.basePrice>0||void 0!==l[W].price.priceWithTax&&void 0!==l[W].price.priceWithTax&&l[W].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(te=!0));let ae=void 0!==X.transactionID&&""!=X.transactionID;ee||te?ae?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):Y.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):Q.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(z.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==f&&Object.keys(f.item).length>0)for(let oe in f.item){let ie=!1;void 0!==f.item[oe]&&void 0!==f.item[oe].price&&(void 0!==f.item[oe].price.basePrice&&void 0!==f.item[oe].price.basePrice&&f.item[oe].price.basePrice>0||void 0!==f.item[oe].price.priceWithTax&&void 0!==f.item[oe].price.priceWithTax&&f.item[oe].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ne=!0));let re=void 0!==X.transactionID&&""!=X.transactionID;ie||ne?re?V.eventInfo.reference.linkedTransactionItems.push(oe):V.eventInfo.reference.linkedCartItems.push(oe):Y.includes(oe)?V.eventInfo.reference.linkedTransactionItems.push(oe):Q.includes(oe)?V.eventInfo.reference.linkedCartItems.push(oe):(z.includes(oe),V.eventInfo.reference.linkedProducts.push(oe))}if(void 0!==w&&Object.keys(w.item).length>0)for(let se in w.item){let ce=!1;void 0!==w.item[se]&&void 0!==w.item[se].price&&(void 0!==w.item[se].price.basePrice&&void 0!==w.item[se].price.basePrice&&w.item[se].price.basePrice>0||void 0!==w.item[se].price.priceWithTax&&void 0!==w.item[se].price.priceWithTax&&w.item[se].price.priceWithTax>0)&&(ce=!0);let le=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(le=!0));let de=void 0!==X.transactionID&&""!=X.transactionID;ce||le?de?V.eventInfo.reference.linkedTransactionItems.push(se):V.eventInfo.reference.linkedCartItems.push(se):Y.includes(se)?V.eventInfo.reference.linkedTransactionItems.push(se):Q.includes(se)?V.eventInfo.reference.linkedCartItems.push(se):(z.includes(se),V.eventInfo.reference.linkedProducts.push(se))}function Z(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===w||void 0===w.item||Object.keys(w).includes(a)?void 0===w&&(void 0===w||void 0===w.item||Object.keys(w.item).includes(W)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(l[W]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(f.item[W]))))):(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(f.item[a])))),Z(l,a),Z(f?.item,a)):"linkedCartItems"===e?(void 0===f||void 0===f.item||Object.keys(f.item).includes(a)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(l,a),Z(w?.item,a)):"linkedProducts"===e&&(void 0!==l&&Object.keys(l).length>0&&!Object.keys(l).includes(a)&&(void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(f.item[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(f?.item,a),Z(w?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(w=w||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==w.total&&1==Object.keys(w.total).length){function me(e){return-1*Math.abs(Number(e))}w.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ue=0;Object.keys(w.item).forEach((e=>{ue+=(e.price||0).basePrice||0})),ue=this.roundToDecimal(ue,2),w.total.basePrice=+(n([()=>e.paramsPassed.totalBasePrice,()=>ue,()=>0])||0),w.total.discountAmountAdditional=me(+(n([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),w.total.taxAmountAdditional=+(n([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),w.total.shipping=this.roundToDecimal(+(n([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),w.total.paymentMethod=n([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let pe=0;Object.keys(w.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(pe+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(pe+=e.price.discountAmountOther||0)})),pe=this.roundToDecimal(pe,2),w.total.discountItemAmounts=me(this.roundToDecimal(pe,2)),w.total.discountAmountSum=me(this.roundToDecimal(+(n([()=>e.paramsPassed.totalDiscountAmount,()=>w.total.discountItemAmounts+w.total.discountAmountAdditional,()=>0])||0),2));let ge=0;Object.keys(w.item).forEach((e=>{ge+=(e.price||0).taxAmount||0})),ge=this.roundToDecimal(ge,2),w.total.taxItemsAmount=this.roundToDecimal(ge,2),w.total.taxAmountSum=+(n([()=>w.total.taxItemsAmount+w.total.taxAmountAdditional,()=>0])||0),w.total.priceWithTax=this.roundToDecimal(+(n([()=>e.paramsPassed.totalPriceWithTax,()=>w.total.basePrice+w.total.discountAmountSum+w.total.taxAmountSum,()=>0])||0),2),w.total.transactionTotal=this.roundToDecimal(+(n([()=>e.paramsPassed.totalFinalPrice,()=>w.total.priceWithTax+w.total.shipping,()=>0])||0),2)}if(void 0!==f&&void 0!==f.price&&1==Object.keys(f.price).length){function he(e){return-1*Math.abs(Number(e))}f.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ve=0;Object.keys(f.item).forEach((e=>{ve+=(e.price||0).basePrice||0})),ve=this.roundToDecimal(ve,2),f.price.basePrice=+(n([()=>e.paramsPassed.totalBasePrice,()=>ve,()=>0])||0),f.price.discountAmountAdditional=he(+(n([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),f.price.taxAmountAdditional=+(n([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ye=0;Object.keys(f.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ye+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ye+=e.price.discountAmountOther||0)})),ye=this.roundToDecimal(ye,2),f.price.discountItemAmounts=he(this.roundToDecimal(ye,2)),f.price.discountAmountSum=he(this.roundToDecimal(+(n([()=>e.paramsPassed.totalDiscountAmount,()=>f.price.discountItemAmounts+f.price.discountAmountAdditional,()=>0])||0),2));let fe=0;Object.keys(f.item).forEach((e=>{fe+=(e.price||0).taxAmount||0})),fe=this.roundToDecimal(fe,2),f.price.taxItemsAmount=this.roundToDecimal(fe,2),f.price.taxAmountSum=+(n([()=>f.price.taxItemsAmount+f.price.taxAmountAdditional,()=>0])||0),f.price.priceWithTax=this.roundToDecimal(+(n([()=>e.paramsPassed.totalPriceWithTax,()=>f.price.basePrice+f.price.discountAmountSum+f.price.taxAmountSum,()=>0])||0),2),f.price.shipping=this.roundToDecimal(+(n([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),f.price.cartTotal=this.roundToDecimal(+(n([()=>e.paramsPassed.totalFinalPrice,()=>f.price.priceWithTax+f.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==V.eventInfo.reference[e]&&(V.eventInfo.reference[e]=V.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==l&&void 0!==l&&Object.keys(l).length>0){for(var _ in l)Object.keys(l[_]).indexOf("price")>-1&&delete l[_].price,Object.keys(l[_]).indexOf("quantity")>-1&&delete l[_].quantity;t.push({product:a})}return void 0!==f&&Object.keys(f.item).length>0&&t.push({cart:f}),void 0!==w&&Object.keys(w.item).length>0&&(w.transactionID=(w.transactionID+"").toUpperCase(),t.push({transaction:w})),t.push(V),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=s(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},2421:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: forms",libraryName:"generic_forms",libraryVersion:"_v9.2.2",prefix:"",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"",primaryCategory:"",subCategory1:"forms"},componentInfo:{componentName:"forms",componentID:"forms"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"form",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"real page",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["formOrigin","formType"],e.baseMandatoryData=["componentType","formOrigin","formType"],e.baseOptionalData=["formID","formName","step","stepAmounts","formLeadType","formVariant","userProfileID","userLoginStatus","userStateProvince","userLanguage","userSegment","userCountry","componentDEVagency","componentPlatform","componentVersion","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].finDownPayment","options[n].finMileage","options[n].finMonthlyPayment","options[n].finTerm"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedFormTypes=["campaign","online tda","registration","rfa","rfc","rfd","rfi","rfo","rfs","roi","tda","fs rfo","rfp","rft","sws","vco","evt"],e.allowedFormOrigins=["local form","adobe form","custom central form","custom local form"],e.allowedFormVariants=["dedicated form","combo form"],e.allowedFormLeadTypes=["lead","handraiser","generic","configurator","visualizer","stock locator","showroom","direct","campaign","wish list","shopping cart"],e.allowedMappedVehiclesCount=["value should be numeric"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],void 0!==e.allowedVehicleFuelType&&delete e.allowedVehicleFuelType},events:function(e){e.events||(e.events={});var t="form";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),t="",e.events=Object.assign(e.events,{[(t+"FormStarted").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form started",eventAction:"page load",cause:"automatic"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints"].includes(e)))),description:'Form started should be triggered on every page load of the page where the form is located, independently from the form step. <br />\n        In multi-step forms with multiple real pages, all the pages together are considered as one form. So form started should only be triggered on the first page loaded and not on subsequent page loads when the user changes from one to another form page. Form started must be triggered again, when the user leaves the form pages completely and then loads one of the form pages again.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},[(t+"FormFirstInteraction").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form first interaction",eventAction:"form first interaction"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints"].includes(e)))),description:'First form interaction should be triggered once when the user starts typing (onchange) or selects an option (onchange) after the form started event. The form page load or prefilled fields are not considered as first interaction.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        </ul>'},[(t+"FormInteraction").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",effect:"form interaction",type:"ux"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant","eventEffect"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant","eventEffect"].includes(e)))),optionalData:["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints","eventCause","eventSubCat1","step","stepAmounts","stepName","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints","eventCause","componentType","formLeadType","formOrigin","formType","formVariant","eventEffect","step","stepAmounts","stepName"].includes(e)))),description:'Form interaction may be triggered for any interaction inside the for funnel eg. user clicked login button.\n        <br> If the form finish is happening on an external site - eg. a dealer website - and hence may not be tracked, the last click inside the tracked form funnel should be tracked with this function and the URL of the landing page of the button should be provided the parameter "requestedURL". Furthermore in such cases you must use the form name "routing to external form (finish not trackable\')". \n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'eventAction\'</b> is used to identify the "form first interaction" if the user interacts the first time with the form component", or "form finish intention" if the user interacts the last time before the thank you page ( typically it\'s the submit button) with the form component </li>\n        </ul>'},[(t+"FormStep").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form step"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant","step"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","userSegment","userType","stepAmounts","stepName","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","linkLocation","eventSubCat1"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","userSegment","userType","step","stepAmounts","stepName","formStep","formStepAmounts","formStepName"].includes(e)))),description:'Form step should be triggered every time the user lands on a form step. Make sure to provide the current step number as well as the total amounts of step - not counting the thank you page as step. Everytime the user jumps back or forth the form step may be triggered to understand how the user moves through the form funnel.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},[(t+"FormFinishIntention").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form finish intention",eventAction:"form finish intention"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus"].includes(e)))),description:'Form finish intention may be triggered upon CTA button "submit" the form. Independent if the submission is successful or not.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        </ul>'},[(t+"FormFinished").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form finished",eventAction:"page load",cause:"automatic"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","linkLocation","eventSubCat1"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","step","stepAmounts","stepName"].includes(e)))),description:'Form finished should be triggered once on the page load of the thank you page after a successful response was received from the CRM system. A form is considered finished once it has been sent to the backend system successfully. In case there is no feedback from the backend system form finish triggers on successful form submit without error message. Local forms in iframes usually trigger form finish when showing a “thank you” message to the visitor.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==mandatoryData.formOrigin?this.message.component[0].componentInfo.componentName=mandatoryData.formOrigin||((this.component||"").componentInfo||"").componentName||"":this.message.component[0].componentInfo.componentName=((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData){try{this._validateProperty("formOrigin",this.allowedFormOrigins,eventName,mandatoryData,!0)}catch(r){return!1}try{this._validateProperty("formVariant",this.allowedFormVariants,eventName,mandatoryData,!0)}catch(s){return!1}if(void 0!==mandatoryData&&"string"==typeof mandatoryData.formType){let c=mandatoryData.formType.trim();if(0==c.length){let d=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(d,"formType","l-empty",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===d)mandatoryData.formType="";else if("m"==d)return}let l=c.split("~");var isValid=!0;for(var i in l)if(this.allowedFormTypes.indexOf(l[i].trim())<0){isValid=!1;break}if(!isValid){let m=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(m,"formType","l-incorrect",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"==m)mandatoryData.formType="";else if("m"==m)return}}else if(void 0!==mandatoryData.formType){let u=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o",p=mandatoryData.formType,g="string"==typeof p&&0===p.trim().length?"empty":"l-incorrect";if(this._throwError(u,"formType",g,this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===u)mandatoryData.formType="";else if("m"==u)return}if(void 0!==mandatoryData&&void 0!==mandatoryData.formLeadType&&"string"==typeof mandatoryData.formLeadType){var returnValueFormLeadType=mandatoryData.formLeadType.split("-"),returnFlagFormLeadType=!0;for(var i in returnValueFormLeadType)this.allowedFormLeadTypes.indexOf(returnValueFormLeadType[i].trim())<0&&(returnFlagFormLeadType=!1);if(returnValueFormLeadType.length>1&&["lead","handraiser","generic"].indexOf(returnValueFormLeadType[0].trim())<0&&(returnFlagFormLeadType=!1),0==returnFlagFormLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1)return void this._throwError("m","formLeadType","incorrect",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)");this._throwError("o","formLeadType","incorrect-o",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}else if(void 0!==mandatoryData.formLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1){let h="string"==typeof mandatoryData.formLeadType&&0==mandatoryData.formLeadType.trim().length?"empty":"incorrect";return void this._throwError("m","formLeadType",h,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)")}{let v=("string"==typeof mandatoryData.formLeadType&&mandatoryData.formLeadType.trim().length,"incorrect-o");this._throwError("o","formLeadType",v,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}if(void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}void 0!==mandatoryData.formType&&mandatoryData.formType.indexOf("~")>-1&&(mandatoryData.formType=mandatoryData.formType.split("~").sort().join("~")),void 0!==mandatoryData.formID&&(this.message.event[0].attributes.form.rfxID=gFFWNV([()=>(mandatoryData.formID||"").toUpperCase()])),void 0!==mandatoryData.formComChannel&&(this.message.event[0].attributes.form.preferredComChannel=gFFWNV([()=>mandatoryData.formComChannel])),void 0!==mandatoryData.formVariant&&(this.message.event[0].attributes.form.formVariant=gFFWNV([()=>mandatoryData.formVariant])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.formName&&(this.message.event[0].attributes.form.formName=gFFWNV([()=>mandatoryData.formName])),void 0!==mandatoryData.formType&&(this.message.event[0].attributes.form.formType=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formLeadType&&(this.message.event[0].attributes.form.formLeadType=gFFWNV([()=>mandatoryData.formLeadType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].attributes.form.formOrigin=gFFWNV([()=>mandatoryData.formOrigin])),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1,()=>mandatoryData.errorCode,()=>mandatoryData.formName,()=>this.message.event[0].category.subCategory1]),this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation,()=>mandatoryData.errorOrigin,()=>mandatoryData.formLeadType,()=>this.message.event[0].category.subCategory2]),"formStep"!=eventName&&"tradeInStep"!=eventName||void 0!==mandatoryData.step&&(this.message.event[0].eventInfo.effect="form step "+(mandatoryData.step||"")),("form started"==this.message.event[0].eventInfo.effect||"form first interaction"==this.message.event[0].eventInfo.effect||this.message.event[0].eventInfo.effect.includes("form step")||"form finish intention"==this.message.event[0].eventInfo.effect||"form finished"==this.message.event[0].eventInfo.effect)&&(this.message.event[0].attributes.form.step=gFFWNV([()=>this.message.event[0].eventInfo.effect])),"formInteraction"!=eventName&&"tradeInFormInteraction"!=eventName||void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),"form"==this.message.event[0].eventInfo.eventName&&(void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),void 0!==mandatoryData.formType&&(this.message.event[0].eventInfo.type=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].category.primaryCategory=gFFWNV([()=>mandatoryData.formOrigin])))}if("standalone"!=this.message.component[0].category.componentType&&"standalone iframe"!=this.message.component[0].category.componentType||("formStarted"!=eventName&&"tradeInFormStart"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form started",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formStep"!=eventName&&"tradeInStep"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form step "+mandatoryData.step,this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formFinished"!=eventName&&"tradeInFormFinished"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form finished",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request success",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" success",this.message.page.category.pageType="form")),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(y){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(f){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let b="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",b,this.allowedPageGeoRegion)}{let D=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",D,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let w="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",w,"","(has to follow ISO standard of 2 letters in uppercase)")}{let N=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",N,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let O=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(O)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=O}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let I=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(I)){let T="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",T,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=I}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let A="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",A,"","(has to follow ISO standard of 2 letters in uppercase)")}{let C=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",C,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let S="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",S,this.alloweduserCountry)}{let k=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",k,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(F){return!1}void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let x=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=x.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(P){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let V=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let W of V)if("totalCurrency"==W){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let _="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",_,"","(has to follow ISO 3-letter currency code all upper case)")}{let E=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",E,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[W],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(W)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(W),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(W)>-1)return void variable._throwError("m",W,flagDetermine,"");variable._throwError("o",W,flagDetermine,""),mandatoryData[W]=""}else mandatoryData[W]=convertToNumeric(mandatoryData[W]),mandatoryData[W]=roundToDecimal(mandatoryData[W],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let L="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",L,variable.allowedOptionscodeVG)}{let R=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",R,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let j="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",j,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let M=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",M,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let J="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",J,variable.allowedOptionsCategory1,"")}{let B=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",B,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let G="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",G,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let $=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",$,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let U=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=U.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let q=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let H of q)if("totalCurrency"==H){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let K="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",K,"","(has to follow ISO 3-letter currency code all upper case)")}{let z=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",z,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[H],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(H)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(H),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(H)>-1)return void variable._throwError("m",H,flagDetermine,"");variable._throwError("o",H,flagDetermine,""),mandatoryData[H]=""}else mandatoryData[H]=convertToNumeric(mandatoryData[H]),mandatoryData[H]=roundToDecimal(mandatoryData[H],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let Q,Y,X;if(Q=Y=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(X=this.message.cart.item.length-1;X>=0;X--){let ee=!1;void 0!==this.message.cart.item[X]&&void 0!==this.message.cart.item[X].price&&(void 0!==this.message.cart.item[X].price.basePrice&&void 0!==this.message.cart.item[X].price.basePrice&&this.message.cart.item[X].price.basePrice>0||void 0!==this.message.cart.item[X].price.priceWithTax&&void 0!==this.message.cart.item[X].price.priceWithTax&&this.message.cart.item[X].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee||te||ee||te||ae?ae&&this.message.cart.item.splice(X,1):this.message.cart.item.splice(X,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&Q.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(X=this.message.transaction.item.length-1;X>=0;X--){let oe=!1;void 0!==this.message.transaction.item[X]&&void 0!==this.message.transaction.item[X].price&&(void 0!==this.message.transaction.item[X].price.basePrice&&void 0!==this.message.transaction.item[X].price.basePrice&&this.message.transaction.item[X].price.basePrice>0||void 0!==this.message.transaction.item[X].price.priceWithTax&&void 0!==this.message.transaction.item[X].price.priceWithTax&&this.message.transaction.item[X].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ie=!0));let ne=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;oe||ie?ne||this.message.transaction.item.splice(X,1):!ne||oe||ie||this.message.transaction.item.splice(X,1),""!=(((this.message.transaction.item[X]||"").productInfo||"").productID||"")&&Q.indexOf(this.message.transaction.item[X].productInfo.productID)>-1&&this.message.transaction.item.splice(X,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&Y.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(X=this.message.product.length-1;X>=0;X--){let re=!1;void 0!==this.message.product[X]&&void 0!==this.message.product[X].price&&(void 0!==this.message.product[X].price.basePrice&&void 0!==this.message.product[X].price.basePrice&&this.message.product[X].price.basePrice>0||void 0!==this.message.product[X].price.priceWithTax&&void 0!==this.message.product[X].price.priceWithTax&&this.message.product[X].price.priceWithTax>0)&&(re=!0);let se=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(se=!0));let ce=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;re&&this.message.product.splice(X,1),!se||ce||re||(Q.indexOf(this.message.product[X].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[X]),this.message.product.splice(X,1)),se&&ce&&(Y.indexOf(this.message.product[X].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[X]),this.message.product.splice(X,1)),""!=(((this.message.product[X]||"").productInfo||"").productID||"")&&(Q.indexOf(this.message.product[X].productInfo.productID)>-1||Y.indexOf(this.message.product[X].productInfo.productID)>-1)&&this.message.product.splice(X,1)}function Z(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let le=0;Object.keys(this.message.cart.item).forEach((e=>{le+=(e.price||0).basePrice||0})),le=this.roundToDecimal(le,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>le,()=>0])||0),this.message.cart.price.discountAmountAdditional=Z(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let de=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(de+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(de+=e.price.discountAmountOther||0)})),de=this.roundToDecimal(de,2),this.message.cart.price.discountItemAmounts=Z(this.roundToDecimal(de,2)),this.message.cart.price.discountAmountSum=Z(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let me=0;Object.keys(this.message.cart.item).forEach((e=>{me+=(e.price||0).taxAmount||0})),me=this.roundToDecimal(me,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(me,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let ue=0;Object.keys(this.message.transaction.item).forEach((e=>{ue+=(e.price||0).basePrice||0})),ue=this.roundToDecimal(ue,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>ue,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Z(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let pe=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(pe+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(pe+=e.price.discountAmountOther||0)})),pe=this.roundToDecimal(pe,2),this.message.transaction.total.discountItemAmounts=Z(this.roundToDecimal(pe,2)),this.message.transaction.total.discountAmountSum=Z(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ge=0;Object.keys(this.message.transaction.item).forEach((e=>{ge+=(e.price||0).taxAmount||0})),ge=this.roundToDecimal(ge,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ge,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},645:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic all",libraryName:"generic-all",libraryVersion:"_v1.2.3",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"",primaryCategory:"",subCategory1:""},componentInfo:{componentName:"",componentID:""},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName","componentPrimaryCat"],e.baseMandatoryData=["componentName","componentPrimaryCat"],e.baseOptionalData=["componentPlatform","componentVersion","componentSubCat1","componentType","formVariant","userLoginStatus","userProfileID","userStateProvince","userLanguage","userSegment","userCountry","transactionID","cartID","totalCurrency","totalPaymentMethod","totalShippingCost","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalBasePrice","totalDiscountAmount","totalTaxAmount","totalPriceWithTax","totalFinalPrice","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].finDownPayment","options[n].finMileage","options[n].finMonthlyPayment","options[n].finTerm","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentPrimaryCategory=["nsc website","special website","configurator","stock locator","sales","finance","rental"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedStepNamesGeneric=["personal details","email","phone number","billing address","pick-up location","payment details","voucher configuration","participants","order overview"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedFormTypes=["campaign","online tda","registration","rfa","rfc","rfd","rfi","rfo","rfs","roi","tda","fs rfo","rfp","rft","sws","vco","evt"],e.allowedFormOrigins=["local form","adobe form","custom central form","custom local form"],e.allowedFormVariants=["dedicated form","combo form"],e.allowedFormLeadTypes=["lead","handraiser","generic","configurator","visualizer","stock locator","showroom","direct","campaign","wish list","shopping cart"],e.allowedMappedVehiclesCount=["value should be numeric"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedVideoTotalLength=["value should be numeric"],e.allowedVideoCurrentTime=["value should be numeric"]},events:function(e){e.events||(e.events={});var t="generic";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),t="",e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},[(t+"ChangeConfiguration").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"]),optionalData:e.baseOptionalData.concat(e.productOptionalData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["eventAction","eventCause","eventPoints","linkLocation"]),description:"Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li><b>'pageSubCat1'</b> is used to capture the page section that is in the view port </li>\n        <li><b>'pageSubCat3'</b> is used if you select \"other\" in <b>'pageSubCat1'</b> because none of the pageSubCat1 allowed values matches your value. So you provide the value passed by markets/authors in pageSubCat3 .</li>\n        <li><b>'options[n].category1'</b> is used to capture the category of the the option/product with which the user interacts. It must not necessarily be the same as the page section in the view port.</li>\n        <li><b>'options[n].category3'</b> is used if you select \"other\" in <b>'options[n].category1'</b> because none of the category1 allowed values matches your value. So you provide the value passed by markets/authors in options[n].category3 .</li>\n        </ul>"},[(t+"FormStarted").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form started",eventAction:"page load",cause:"automatic"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints"].includes(e)))),description:'Form started should be triggered on every page load of the page where the form is located, independently from the form step. <br />\n        In multi-step forms with multiple real pages, all the pages together are considered as one form. So form started should only be triggered on the first page loaded and not on subsequent page loads when the user changes from one to another form page. Form started must be triggered again, when the user leaves the form pages completely and then loads one of the form pages again.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},[(t+"FormFirstInteraction").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form first interaction",eventAction:"form first interaction"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints"].includes(e)))),description:'First form interaction should be triggered once when the user starts typing (onchange) or selects an option (onchange) after the form started event. The form page load or prefilled fields are not considered as first interaction.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        </ul>'},[(t+"FormInteraction").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",effect:"form interaction",type:"ux"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant","eventEffect"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant","eventEffect"].includes(e)))),optionalData:["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints","eventCause","eventSubCat1","step","stepAmounts","stepName","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventAction","eventPoints","eventCause","componentType","formLeadType","formOrigin","formType","formVariant","eventEffect","step","stepAmounts","stepName"].includes(e)))),description:'Form interaction may be triggered for any interaction inside the for funnel eg. user clicked login button.\n        <br> If the form finish is happening on an external site - eg. a dealer website - and hence may not be tracked, the last click inside the tracked form funnel should be tracked with this function and the URL of the landing page of the button should be provided the parameter "requestedURL". Furthermore in such cases you must use the form name "routing to external form (finish not trackable\')". \n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'eventAction\'</b> is used to identify the "form first interaction" if the user interacts the first time with the form component", or "form finish intention" if the user interacts the last time before the thank you page ( typically it\'s the submit button) with the form component </li>\n        </ul>'},[(t+"FormStep").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form step"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant","step"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","userSegment","userType","stepAmounts","stepName","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","linkLocation","eventSubCat1"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","userSegment","userType","step","stepAmounts","stepName","formStep","formStepAmounts","formStepName"].includes(e)))),description:'Form step should be triggered every time the user lands on a form step. Make sure to provide the current step number as well as the total amounts of step - not counting the thank you page as step. Everytime the user jumps back or forth the form step may be triggered to understand how the user moves through the form funnel.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},[(t+"FormFinishIntention").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form finish intention",eventAction:"form finish intention"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["stepName","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventSubCat1","linkLocation"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","eventPoints","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus"].includes(e)))),description:'Form finish intention may be triggered upon CTA button "submit" the form. Independent if the submission is successful or not.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        </ul>'},[(t+"FormFinished").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form finished",eventAction:"page load",cause:"automatic"})},mandatoryData:["componentType","formLeadType","formOrigin","formType","formVariant"].concat(e.baseMandatoryData.filter((e=>!["componentName","componentType","formLeadType","formOrigin","formType","formVariant"].includes(e)))),optionalData:["formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion","linkLocation","eventSubCat1"].concat(e.productMandatoryData,e.productOptionalData,e.baseOptionalData.filter((e=>!["componentType","formLeadType","formOrigin","formType","formVariant","formComChannel","formID","formName","iframeURL","requestedURL","userProfileID","userLoginStatus","eventPoints","step","stepAmounts","stepName"].includes(e)))),description:'Form finished should be triggered once on the page load of the thank you page after a successful response was received from the CRM system. A form is considered finished once it has been sent to the backend system successfully. In case there is no feedback from the backend system form finish triggers on successful form submit without error message. Local forms in iframes usually trigger form finish when showing a “thank you” message to the visitor.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"SurveyStarted").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user feedback started",eventAction:"component load",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat([]),optionalData:e.baseOptionalData.filter((e=>!["surveyContent","surveyName","surveyQuestion","surveyScore","surveyType"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["surveyName","surveyType"]),description:'Survey started should be triggered when the survey component is loaded\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'surveyName\'</b> can be used if there are multiple survey of the same type, you can differentiate them by providing a survey name. </li>\n            <li><b>\'surveyType\'</b> is used to capture the type of survey such as eg.  "adhoc", "nps",. </li>\n        </ul>'},[(t+"SurveyQuestion").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user feedback question"})},mandatoryData:e.baseMandatoryData.concat(["step"]),optionalData:e.baseOptionalData.filter((e=>!["surveyContent","surveyName","surveyQuestion","surveyScore","surveyType"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["surveyContent","surveyQuestion","surveyScore","surveyName","surveyType"]),description:"Survey question should be triggered when the user has answered a question and clicked next / back buttons.\n                    <br> If the user answered more than one question in that step, you may trigger this event multiple times with different values in the parameters surveyQuestion and surveyContent\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'surveyContent'</b> is used to capture the answer the user provides (typically a freetext field)</li>\n            <li><b>'surveyQuestion'</b> is used to capture the question the user is asked to answer</li>\n            <li><b>'surveyScore'</b> can be used if the user is asked to rate the satisfaction. The score is to be provided as numberic value</li>\n            <li><b>'surveyName'</b> can be used if there are multiple survey of the same type, you can differentiate them by providing a survey name. </li>\n            <li><b>'surveyType'</b> is used to capture the type of survey such as eg.  \"adhoc\", \"nps\",. </li>\n            <li><b>'step'</b> istates which questions the user is answering. Value must be numeric. If there is just one question provide the value 1</li>\n        </ul>"},[(t+"SurveyFinishIntention").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user feedback finish intention"})},mandatoryData:e.baseMandatoryData.concat([]),optionalData:e.baseOptionalData.filter((e=>!["surveyContent","surveyName","surveyQuestion","surveyScore","surveyType"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["surveyContent","surveyQuestion","surveyScore","surveyName","surveyType"]),description:'Survey finish intention may be triggered upon clicking the CTA button to "submit" the survey. Independent if the submission is successful or not- hence just intention. It could be that an error occurs.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'surveyContent\'</b> is used to capture the answer the user provides (typically a freetext field)</li>\n            <li><b>\'surveyQuestion\'</b> is used to capture the question the user is asked to answer</li>\n            <li><b>\'surveyScore\'</b> can be used if the user is asked to rate the satisfaction. The score is to be provided as numberic value</li>\n            <li><b>\'surveyName\'</b> can be used if there are multiple survey of the same type, you can differentiate them by providing a survey name. </li>\n            <li><b>\'surveyType\'</b> is used to capture the type of survey such as eg.  "adhoc", "nps",. </li>\n        </ul>'},[(t+"SurveyFinished").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user feedback finished",eventAction:"component load",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat([]),optionalData:e.baseOptionalData.filter((e=>!["surveyContent","surveyName","surveyQuestion","surveyScore","surveyType"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["surveyContent","surveyQuestion","surveyScore","surveyName","surveyType"]),description:'Survey finished should be triggered upon component load of the thank you page/message after a successfully submitted survey.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'surveyName\'</b> can be used if there are multiple survey of the same type, you can differentiate them by providing a survey name. </li>\n        <li><b>\'surveyType\'</b> is used to capture the type of survey such as eg.  "adhoc", "nps",. </li>\n    </ul>'},[(t+"VideoStarted").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger everytime the user starts a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n    <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>\'videoName\'</b> is the name of the specific video</li>\n    <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>'},[(t+"VideoStartedAutomatic").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video starts automatically (autoplay). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},[(t+"VideoStopped").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video paused",eventAction:"media paused",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger everytime the user stopps / pauses a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n    <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>'videoName'</b> is the name of the specific video</li>\n    <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>"},[(t+"VideoEnded").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video finished",eventAction:"media stopped",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video is automatically stopped (end of video). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},[(t+"VideoMilestoneReached25").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 25% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 25% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},[(t+"VideoMilestoneReached50").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 50% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 50% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},[(t+"VideoMilestoneReached75").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 75% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 75% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"}}),t="shop",e.events=Object.assign(e.events,{[(t+"CartAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user added product to cart",eventAction:"item added"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on add to cart icon/button and the product has been added successfully to the cart.\n        <br> <i>If the user clicks on the add to cart icon/button, but the product is not immediately added, then track the first click with the xxxClick function and only when the product is actually successfully added, then use this xxxCartAdd function</i>.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are added to the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart additions’.  When a customer adds their first product to a shopping cart, both ‘Carts’ and ‘Cart additions’ are triggered.</i>"},[(t+"CartRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user removed product from cart",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on remove from cart icon/button and the product has been successfully remove from the cart.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are removed from the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart removals’. </i>"},[(t+"CartCheckout").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user started checkout process",eventAction:"checkout"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks the button to start the checkout process.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) for which the checkout process is started. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Checkouts’. </i>"},[(t+"CheckoutProcess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"checkout",effect:"user updated checkout details",eventAction:"internal click"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"checkout interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["stepName","cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","step","stepAmounts","stepName","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID","step","stepAmounts"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this when the user updates information on any of the checkout process steps by clicking a save button/link and staying on the same process step. In case the next (virtual) step page loads, use the pageLoad function only.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'step'</b> is used to capture the number of the checkout step the user currently interacts. This is a numeric value. </li> \n            <li><b>'stepName'</b> is used to capture the name of the checkout process step .  </li> \n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b\n            > can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are being checked out. </li> \n        </ul>"},[(t+"OrderSuccess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user successfully submitted order",eventAction:"page load",cause:"automatic"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully submitted the order for the product(s) from the shopping basket. This generally is the case, when in the user interface a \"thank you for your purchase\" page is loaded.\n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>\n            <br> <i> This functions triggers the standard adobe analytics commerce metric 'Revenue’, 'Orders’ and 'Units’. In order to track the 'Revenue' and 'Orders', the product details must be passed in vehicle[n] and/or options[n] parameters respectively.</i>"},[(t+"OrderCancel").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user cancelled the order",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully cancelled an order. \n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>"}}),e.events=Object.assign(e.events,{visualizerChange:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"visualizer configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["section","vehicle[n].codeAG","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].range","vehicle[n].series"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventAction","eventCause","eventPoints"]).filter((e=>!["vehicle[n].codeAG","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].range","vehicle[n].series"].includes(e))),description:'🆕 <i style="color:red"> <b>Don\'t use this function in new implementations anymore. And if you are updating your tracking at the moment, ideally immediately update to the generic function name</b>. This will be moved into a generic code snippet with function name <b>"changeConfiguration" </b>with next major release.\n    <br><br>\n    Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n    <br><ul>\n    <li style="color:red"><b>\'vehicle[n].status\' /\'options[n].status\'</b> is used to differentiate which product was added and which one removed</li>\n    <li style="color:red"><b>\'options[n].range\'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n    <li style="color:red"><b>\'options[n].codeVG\' / \'options[n].codeAG\'</b> is used to to refer to the model code of the related vehicle.</li>\n    <li style="color:red">For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li style="color:red">For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    </ul>\n    </i>'}}),e.mappings={changeConfiguration:["visualizerChangeConfiguration"],click:["cssClick","compareClick","conClick","shopClick","stockClick","cardClick","visualizerClick"],filterRemoveAll:["compareFilterRemoveAll","shopFilterRemoveAll","stockFilterRemoveAll","visualizerFilterRemoveAll"],filterRemoved:["compareFilterRemoved","shopFilterRemoved","stockFilterRemoved","visualizerFilterRemoved"],filterSelected:["compareFilterSelected","shopFilterSelected","stockFilterSelected","visualizerFilterSelected"],filterSort:["compareFilterSort","shopFilterSort","stockFilterSort","visualizerFilterSort"],genericPageLoad:["cssPageLoad","formPageLoad","compareGenericPageLoad","conGenericPageLoad","shopGenericPageLoad","stockGenericPageLoad","visualizerGenericPageLoad"],genericPageLoadError:["cssPageLoadError","formPageLoadError","comparePageLoadError","conPageLoadError","shopPageLoadError","stockPageLoadError","visualizerPageLoadError"],listAdd:["cssListAdd","conListAdd","shopListAdd","stockListAdd","cardListAdd","visualizerListAdd"],listRemove:["cssListRemove","conListRemove","shopListRemove","stockListRemove","cardListRemove","visualizerListRemove"],shopCartAdd:["conCartAdd","stockCartAdd"],shopCartCheckout:["conCartCheckout","stockCartCheckout"],shopCartRemove:["conCartRemove","stockCartRemove"],shopCheckoutProcess:["conCheckoutProcess","stockCheckoutProcess"],shopOrderCancel:["conOrderCancel","stockOrderCancel"],shopOrderSuccess:["conOrderSuccess","stockOrderSuccess"],videoEnded:["stockVideoEnded"],videoMilestoneReached25:["stockVideoMilestoneReached25"],videoMilestoneReached50:["stockVideoMilestoneReached50"],videoMilestoneReached75:["stockVideoMilestoneReached75"],videoStarted:["stockVideoStarted"],videoStartedAutomatic:["stockVideoStartedAutomatic"],videoStopped:["stockVideoStopped"],viewActions:["cssViewActions","compareViewActions","conViewActions","shopViewActions","cardViewActions","visualizerViewActions"]};for(let t in e.mappings)e.mappings.hasOwnProperty(t)&&e.mappings[t].forEach((a=>{e.events[a]=JSON.parse(JSON.stringify(e.events[t]))}))},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}if(void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(n){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(r){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}if(void 0!==mandatoryData.stepName&&"user updated checkout details"==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>"user updated "+mandatoryData.stepName])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.transactionID&&"user paid successfully"==this.message.event[0].eventInfo.effect&&(this.message.event[0].attributes.purchaseID=gFFWNV([()=>mandatoryData.transactionID])),void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(s){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(c){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(d){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component));var category1Value="";if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0){for(var i in mandatoryData.options)if(void 0!==mandatoryData.options[i].category1&&"configuration change"==this.message.event[0].category.subCategory1){category1Value=gFFWNV([()=>mandatoryData.options[0].category1]);break}""!=category1Value&&(this.message.event[0].eventInfo.effect+=category1Value)}if(void 0!==mandatoryData){try{this._validateProperty("formOrigin",this.allowedFormOrigins,eventName,mandatoryData,!0)}catch(m){return!1}try{this._validateProperty("formVariant",this.allowedFormVariants,eventName,mandatoryData,!0)}catch(u){return!1}if(void 0!==mandatoryData&&"string"==typeof mandatoryData.formType){let p=mandatoryData.formType.trim();if(0==p.length){let h=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(h,"formType","l-empty",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===h)mandatoryData.formType="";else if("m"==h)return}let g=p.split("~");var isValid=!0;for(var i in g)if(this.allowedFormTypes.indexOf(g[i].trim())<0){isValid=!1;break}if(!isValid){let v=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(v,"formType","l-incorrect",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"==v)mandatoryData.formType="";else if("m"==v)return}}else if(void 0!==mandatoryData.formType){let y=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o",f=mandatoryData.formType,b="string"==typeof f&&0===f.trim().length?"empty":"l-incorrect";if(this._throwError(y,"formType",b,this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===y)mandatoryData.formType="";else if("m"==y)return}if(void 0!==mandatoryData&&void 0!==mandatoryData.formLeadType&&"string"==typeof mandatoryData.formLeadType){var returnValueFormLeadType=mandatoryData.formLeadType.split("-"),returnFlagFormLeadType=!0;for(var i in returnValueFormLeadType)this.allowedFormLeadTypes.indexOf(returnValueFormLeadType[i].trim())<0&&(returnFlagFormLeadType=!1);if(returnValueFormLeadType.length>1&&["lead","handraiser","generic"].indexOf(returnValueFormLeadType[0].trim())<0&&(returnFlagFormLeadType=!1),0==returnFlagFormLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1)return void this._throwError("m","formLeadType","incorrect",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)");this._throwError("o","formLeadType","incorrect-o",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}else if(void 0!==mandatoryData.formLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1){let D="string"==typeof mandatoryData.formLeadType&&0==mandatoryData.formLeadType.trim().length?"empty":"incorrect";return void this._throwError("m","formLeadType",D,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)")}{let w=("string"==typeof mandatoryData.formLeadType&&mandatoryData.formLeadType.trim().length,"incorrect-o");this._throwError("o","formLeadType",w,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}if(void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}void 0!==mandatoryData.formType&&mandatoryData.formType.indexOf("~")>-1&&(mandatoryData.formType=mandatoryData.formType.split("~").sort().join("~")),void 0!==mandatoryData.formID&&(this.message.event[0].attributes.form.rfxID=gFFWNV([()=>(mandatoryData.formID||"").toUpperCase()])),void 0!==mandatoryData.formComChannel&&(this.message.event[0].attributes.form.preferredComChannel=gFFWNV([()=>mandatoryData.formComChannel])),void 0!==mandatoryData.formVariant&&(this.message.event[0].attributes.form.formVariant=gFFWNV([()=>mandatoryData.formVariant])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.formName&&(this.message.event[0].attributes.form.formName=gFFWNV([()=>mandatoryData.formName])),void 0!==mandatoryData.formType&&(this.message.event[0].attributes.form.formType=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formLeadType&&(this.message.event[0].attributes.form.formLeadType=gFFWNV([()=>mandatoryData.formLeadType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].attributes.form.formOrigin=gFFWNV([()=>mandatoryData.formOrigin])),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1,()=>mandatoryData.errorCode,()=>mandatoryData.formName,()=>this.message.event[0].category.subCategory1]),this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation,()=>mandatoryData.errorOrigin,()=>mandatoryData.formLeadType,()=>this.message.event[0].category.subCategory2]),"formStep"!=eventName&&"tradeInStep"!=eventName||void 0!==mandatoryData.step&&(this.message.event[0].eventInfo.effect="form step "+(mandatoryData.step||"")),("form started"==this.message.event[0].eventInfo.effect||"form first interaction"==this.message.event[0].eventInfo.effect||this.message.event[0].eventInfo.effect.includes("form step")||"form finish intention"==this.message.event[0].eventInfo.effect||"form finished"==this.message.event[0].eventInfo.effect)&&(this.message.event[0].attributes.form.step=gFFWNV([()=>this.message.event[0].eventInfo.effect])),"formInteraction"!=eventName&&"tradeInFormInteraction"!=eventName||void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),"form"==this.message.event[0].eventInfo.eventName&&(void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),void 0!==mandatoryData.formType&&(this.message.event[0].eventInfo.type=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].category.primaryCategory=gFFWNV([()=>mandatoryData.formOrigin])))}if("standalone"!=this.message.component[0].category.componentType&&"standalone iframe"!=this.message.component[0].category.componentType||("formStarted"!=eventName&&"tradeInFormStart"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form started",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formStep"!=eventName&&"tradeInStep"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form step "+mandatoryData.step,this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formFinished"!=eventName&&"tradeInFormFinished"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form finished",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request success",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" success",this.message.page.category.pageType="form")),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(N){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(O){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let I="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",I,this.allowedPageGeoRegion)}{let T=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",T,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let A="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",A,"","(has to follow ISO standard of 2 letters in uppercase)")}{let C=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",C,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let S=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(S)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=S}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let k=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=k.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(F){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let x=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let P of x)if("totalCurrency"==P){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let V="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",V,"","(has to follow ISO 3-letter currency code all upper case)")}{let W=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",W,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[P],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(P)>-1)return void variable._throwError("m",P,flagDetermine,"");variable._throwError("o",P,flagDetermine,""),mandatoryData[P]=""}else mandatoryData[P]=convertToNumeric(mandatoryData[P]),mandatoryData[P]=roundToDecimal(mandatoryData[P],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let _="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",_,variable.allowedOptionscodeVG)}{let E=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",E,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let L="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",L,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let R=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",R,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let j="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",j,variable.allowedOptionsCategory1,"")}{let M=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",M,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let J="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",J,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let B=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",B,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let G=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=G.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let $=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let U of $)if("totalCurrency"==U){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let q="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",q,"","(has to follow ISO 3-letter currency code all upper case)")}{let H=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",H,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[U],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(U)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(U),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(U)>-1)return void variable._throwError("m",U,flagDetermine,"");variable._throwError("o",U,flagDetermine,""),mandatoryData[U]=""}else mandatoryData[U]=convertToNumeric(mandatoryData[U]),mandatoryData[U]=roundToDecimal(mandatoryData[U],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let K=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(K)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let z="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",z,this.allowedFilterObjects)}{let Q=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",Q,this.allowedFilterObjects)}}mandatoryData.filterObject=K}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||"")),void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),(eventName.includes("survey")||eventName.includes("Survey"))&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>void 0!==mandatoryData.componentName&&void 0!==mandatoryData.step&&void 0!==eventName&&eventName.indexOf("Finish")<0&&mandatoryData.componentName+" "+this.message.event[0].eventInfo.effect+" "+mandatoryData.step,()=>void 0!==mandatoryData.componentName&&mandatoryData.componentName+" "+this.message.event[0].eventInfo.effect,()=>void 0===mandatoryData.componentName&&(this.message.event[0].eventInfo.effect||"")])||"",void 0!==mandatoryData.componentName&&(this.message.event[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentName])),void 0!==mandatoryData.surveyName&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.surveyName])),void 0!==mandatoryData.surveyType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.surveyType])),void 0!==mandatoryData.surveyScore&&(this.message.event[0].attributes.survey.score=gFFWNV([()=>mandatoryData.surveyScore])),void 0!==mandatoryData.surveyQuestion&&(this.message.event[0].attributes.survey.question=gFFWNV([()=>mandatoryData.surveyQuestion])),void 0!==mandatoryData.surveyContent&&(this.message.event[0].attributes.survey.content=gFFWNV([()=>mandatoryData.surveyContent]))),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let Y=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(Y)){let X="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",X,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=Y}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let Z="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",Z,"","(has to follow ISO standard of 2 letters in uppercase)")}{let ee=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",ee,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let te="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",te,this.alloweduserCountry)}{let ae=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",ae,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(oe){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.videoTotalLength&&"number"!=typeof mandatoryData.videoTotalLength){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","videoTotalLength","incorrect-numeric","");this._throwError("o","videoTotalLength","incorrect-numeric",""),mandatoryData.videoTotalLength=""}if(void 0!==mandatoryData.videoCurrentTime&&"number"!=typeof mandatoryData.videoCurrentTime){if(this.events[eventName].mandatoryData.indexOf("videoCurrentTime")>-1)return void this._throwError("m","videoCurrentTime","incorrect-numeric","");this._throwError("o","videoCurrentTime","incorrect-numeric",""),mandatoryData.videoCurrentTime=""}if(void 0!==mandatoryData.videoName&&(this.message.component[0].componentInfo.componentID=gFFWNV([()=>this.message.component[0].componentInfo.componentID+" > "+mandatoryData.videoName]),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.videoName])),void 0!==mandatoryData.videoHosting&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.videoHosting])),void 0!==mandatoryData.videoTotalLength&&(this.message.event[0].attributes.media.totalLength=gFFWNV([()=>mandatoryData.videoTotalLength||0])),void 0!==mandatoryData.videoCurrentTime&&(this.message.event[0].attributes.media.currentTime=gFFWNV([()=>mandatoryData.videoCurrentTime||0])),delete this.message.custom.videoCurrentTime,delete this.message.custom.videoName,delete this.message.custom.videoTotalLength,void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==mandatoryData&&void 0!==mandatoryData.options&&void 0!==mandatoryData.componentPrimaryCat&&"configurator"==mandatoryData.componentPrimaryCat&&mandatoryData.options.length>0&&void 0!==mandatoryData.vehicle&&1==mandatoryData.vehicle.length){let ie=mandatoryData.vehicle[0].range||"",ne=mandatoryData.vehicle[0].rangeVG||mandatoryData.vehicle[0].range||"",re=mandatoryData.vehicle[0].codeVG||mandatoryData.vehicle[0].codeAG||"",se=mandatoryData.vehicle[0].hybridVersion||"";for(var i in this.message.product)void 0===this.message.product[i].attributes.bodyType&&(void 0===this.message.product[i].attributes.mmdr&&(this.message.product[i].attributes.mmdr=ie.toUpperCase()),void 0===this.message.product[i].attributes.mmdrVG&&(this.message.product[i].attributes.mmdrVG=ne.toUpperCase()),void 0===this.message.product[i].attributes.modelCodeVG&&(this.message.product[i].attributes.modelCodeVG=re.toUpperCase()),void 0===this.message.product[i].attributes.hybridVersion&&(this.message.product[i].attributes.hybridVersion=se))}if(mandatoryData.section&&void 0!==mandatoryData.section&&"visualizer configuration change"==this.message.event[0].category.subCategory1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.section),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let ce,le,de;if(ce=le=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(de=this.message.cart.item.length-1;de>=0;de--){let ue=!1;void 0!==this.message.cart.item[de]&&void 0!==this.message.cart.item[de].price&&(void 0!==this.message.cart.item[de].price.basePrice&&void 0!==this.message.cart.item[de].price.basePrice&&this.message.cart.item[de].price.basePrice>0||void 0!==this.message.cart.item[de].price.priceWithTax&&void 0!==this.message.cart.item[de].price.priceWithTax&&this.message.cart.item[de].price.priceWithTax>0)&&(ue=!0);let pe=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(pe=!0));let ge=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ue||pe||ue||pe||ge?ge&&this.message.cart.item.splice(de,1):this.message.cart.item.splice(de,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&ce.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(de=this.message.transaction.item.length-1;de>=0;de--){let he=!1;void 0!==this.message.transaction.item[de]&&void 0!==this.message.transaction.item[de].price&&(void 0!==this.message.transaction.item[de].price.basePrice&&void 0!==this.message.transaction.item[de].price.basePrice&&this.message.transaction.item[de].price.basePrice>0||void 0!==this.message.transaction.item[de].price.priceWithTax&&void 0!==this.message.transaction.item[de].price.priceWithTax&&this.message.transaction.item[de].price.priceWithTax>0)&&(he=!0);let ve=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ve=!0));let ye=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;he||ve?ye||this.message.transaction.item.splice(de,1):!ye||he||ve||this.message.transaction.item.splice(de,1),""!=(((this.message.transaction.item[de]||"").productInfo||"").productID||"")&&ce.indexOf(this.message.transaction.item[de].productInfo.productID)>-1&&this.message.transaction.item.splice(de,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&le.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(de=this.message.product.length-1;de>=0;de--){let fe=!1;void 0!==this.message.product[de]&&void 0!==this.message.product[de].price&&(void 0!==this.message.product[de].price.basePrice&&void 0!==this.message.product[de].price.basePrice&&this.message.product[de].price.basePrice>0||void 0!==this.message.product[de].price.priceWithTax&&void 0!==this.message.product[de].price.priceWithTax&&this.message.product[de].price.priceWithTax>0)&&(fe=!0);let be=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(be=!0));let De=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;fe&&this.message.product.splice(de,1),!be||De||fe||(ce.indexOf(this.message.product[de].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[de]),this.message.product.splice(de,1)),be&&De&&(le.indexOf(this.message.product[de].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[de]),this.message.product.splice(de,1)),""!=(((this.message.product[de]||"").productInfo||"").productID||"")&&(ce.indexOf(this.message.product[de].productInfo.productID)>-1||le.indexOf(this.message.product[de].productInfo.productID)>-1)&&this.message.product.splice(de,1)}function me(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let we=0;Object.keys(this.message.cart.item).forEach((e=>{we+=(e.price||0).basePrice||0})),we=this.roundToDecimal(we,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>we,()=>0])||0),this.message.cart.price.discountAmountAdditional=me(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let Ne=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Ne+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Ne+=e.price.discountAmountOther||0)})),Ne=this.roundToDecimal(Ne,2),this.message.cart.price.discountItemAmounts=me(this.roundToDecimal(Ne,2)),this.message.cart.price.discountAmountSum=me(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let Oe=0;Object.keys(this.message.cart.item).forEach((e=>{Oe+=(e.price||0).taxAmount||0})),Oe=this.roundToDecimal(Oe,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(Oe,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let Ie=0;Object.keys(this.message.transaction.item).forEach((e=>{Ie+=(e.price||0).basePrice||0})),Ie=this.roundToDecimal(Ie,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>Ie,()=>0])||0),this.message.transaction.total.discountAmountAdditional=me(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let Te=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Te+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Te+=e.price.discountAmountOther||0)})),Te=this.roundToDecimal(Te,2),this.message.transaction.total.discountItemAmounts=me(this.roundToDecimal(Te,2)),this.message.transaction.total.discountAmountSum=me(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let Ae=0;Object.keys(this.message.transaction.item).forEach((e=>{Ae+=(e.price||0).taxAmount||0})),Ae=this.roundToDecimal(Ae,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(Ae,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},3257:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic compare",libraryName:"generic_compare",libraryVersion:"_v1.2.3",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"compare"},componentInfo:{componentID:`TRON_${e._TronVersion}__${e._componentTrackingVersion}`,componentName:"generic compare"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName"],e.baseOptionalData=["componentType","componentDEVagency","componentPlatform","componentVersion","userLoginStatus","userProfileID","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["compare","compare belt","compare aem"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="compare";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let r=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(r)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let s="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",s,this.allowedFilterObjects)}{let c=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",c,this.allowedFilterObjects)}}mandatoryData.filterObject=r}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||"")),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(d){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(m){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(u){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(p){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(g){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(h){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let v="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",v,this.allowedPageGeoRegion)}{let y=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",y,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let f="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",f,"","(has to follow ISO standard of 2 letters in uppercase)")}{let b=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",b,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let D=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(D)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=D}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let w=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=w.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(N){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let O=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let I of O)if("totalCurrency"==I){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let T="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",T,"","(has to follow ISO 3-letter currency code all upper case)")}{let A=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",A,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[I],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(I)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(I),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(I)>-1)return void variable._throwError("m",I,flagDetermine,"");variable._throwError("o",I,flagDetermine,""),mandatoryData[I]=""}else mandatoryData[I]=convertToNumeric(mandatoryData[I]),mandatoryData[I]=roundToDecimal(mandatoryData[I],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let C="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",C,variable.allowedOptionscodeVG)}{let S=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",S,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let k="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",k,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let F=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",F,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let x="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",x,variable.allowedOptionsCategory1,"")}{let P=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",P,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let V="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",V,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let W=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",W,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let _=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=_.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let E=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let L of E)if("totalCurrency"==L){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let R="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",R,"","(has to follow ISO 3-letter currency code all upper case)")}{let j=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",j,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[L],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(L)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(L),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(L)>-1)return void variable._throwError("m",L,flagDetermine,"");variable._throwError("o",L,flagDetermine,""),mandatoryData[L]=""}else mandatoryData[L]=convertToNumeric(mandatoryData[L]),mandatoryData[L]=roundToDecimal(mandatoryData[L],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let M=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(M)){let J="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",J,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=M}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let B="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",B,"","(has to follow ISO standard of 2 letters in uppercase)")}{let G=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let $="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",$,this.alloweduserCountry)}{let U=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",U,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(q){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let H,K,z;if(H=K=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(z=this.message.cart.item.length-1;z>=0;z--){let Y=!1;void 0!==this.message.cart.item[z]&&void 0!==this.message.cart.item[z].price&&(void 0!==this.message.cart.item[z].price.basePrice&&void 0!==this.message.cart.item[z].price.basePrice&&this.message.cart.item[z].price.basePrice>0||void 0!==this.message.cart.item[z].price.priceWithTax&&void 0!==this.message.cart.item[z].price.priceWithTax&&this.message.cart.item[z].price.priceWithTax>0)&&(Y=!0);let X=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(X=!0));let Z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;Y||X||Y||X||Z?Z&&this.message.cart.item.splice(z,1):this.message.cart.item.splice(z,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&H.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(z=this.message.transaction.item.length-1;z>=0;z--){let ee=!1;void 0!==this.message.transaction.item[z]&&void 0!==this.message.transaction.item[z].price&&(void 0!==this.message.transaction.item[z].price.basePrice&&void 0!==this.message.transaction.item[z].price.basePrice&&this.message.transaction.item[z].price.basePrice>0||void 0!==this.message.transaction.item[z].price.priceWithTax&&void 0!==this.message.transaction.item[z].price.priceWithTax&&this.message.transaction.item[z].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee||te?ae||this.message.transaction.item.splice(z,1):!ae||ee||te||this.message.transaction.item.splice(z,1),""!=(((this.message.transaction.item[z]||"").productInfo||"").productID||"")&&H.indexOf(this.message.transaction.item[z].productInfo.productID)>-1&&this.message.transaction.item.splice(z,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(z=this.message.product.length-1;z>=0;z--){let oe=!1;void 0!==this.message.product[z]&&void 0!==this.message.product[z].price&&(void 0!==this.message.product[z].price.basePrice&&void 0!==this.message.product[z].price.basePrice&&this.message.product[z].price.basePrice>0||void 0!==this.message.product[z].price.priceWithTax&&void 0!==this.message.product[z].price.priceWithTax&&this.message.product[z].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ie=!0));let ne=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;oe&&this.message.product.splice(z,1),!ie||ne||oe||(H.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[z]),this.message.product.splice(z,1)),ie&&ne&&(K.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[z]),this.message.product.splice(z,1)),""!=(((this.message.product[z]||"").productInfo||"").productID||"")&&(H.indexOf(this.message.product[z].productInfo.productID)>-1||K.indexOf(this.message.product[z].productInfo.productID)>-1)&&this.message.product.splice(z,1)}function Q(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.cart.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=this.roundToDecimal(re,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.cart.price.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let se=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=this.roundToDecimal(se,2),this.message.cart.price.discountItemAmounts=Q(this.roundToDecimal(se,2)),this.message.cart.price.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.cart.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=this.roundToDecimal(ce,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(ce,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let le=0;Object.keys(this.message.transaction.item).forEach((e=>{le+=(e.price||0).basePrice||0})),le=this.roundToDecimal(le,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>le,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let de=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(de+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(de+=e.price.discountAmountOther||0)})),de=this.roundToDecimal(de,2),this.message.transaction.total.discountItemAmounts=Q(this.roundToDecimal(de,2)),this.message.transaction.total.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let me=0;Object.keys(this.message.transaction.item).forEach((e=>{me+=(e.price||0).taxAmount||0})),me=this.roundToDecimal(me,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(me,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},4220:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic configurator",libraryName:"generic_configurator",libraryVersion:"_v4.0.0",prefix:"con > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"standalone",primaryCategory:"configurator",subCategory1:""},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{},attributes:{}},e.page={category:{},pageInfo:{pageID:"",pageName:"tbd"},attributes:{}},e.errorMandatoryData=["componentName","componentSubCat1"],e.baseMandatoryData=["componentName","componentSubCat1","totalCurrency","totalBasePrice","totalTaxAmount","totalPriceWithTax","pageName","pageVariant","pageSubCat1"],e.baseOptionalData=["componentDEVagency","componentVersion","userLoginStatus","userProfileID","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10","totalTaxAmountAdditional","totalFinalPrice"],e.productMandatoryData=["vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].primaryCategory","vehicle[n].manufacturer","vehicle[n].productID","vehicle[n].name","vehicle[n].codeVG","vehicle[n].bodyType","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].hybridVersion","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].itemBasePrice","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","options[n].businessDivision","options[n].manufacturer","options[n].productID","options[n].codeVG","options[n].range"],e.productOptionalData=["vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].color","vehicle[n].gearing","vehicle[n].packageID","vehicle[n].status","vehicle[n].subSeries","vehicle[n].itemTaxAmount","options[n].category1","options[n].category2","options[n].category3","options[n].name","options[n].packageID","options[n].salesModel","options[n].status","options[n].itemBasePrice","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount"],e.allowedPageSubCat1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels"],e.allowedComponentNames=["con","boutique"],e.allowedComponentSubCat1=["new car configurator","new bike configurator","accessory configurator"],e.allowedPageSubCat1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","summary","other","end"],e.allowedPageName=["summary","configure"],e.allowedFinishTypes=["con save","summary","tda","rfo","vehicle finder","other"],e.allowedErrorTypes=["script error","data error","backend response error","backend request error","backend 1st party","backend 3rd party","frontend component","user"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedStepNamesGeneric=["personal details","email","phone number","billing address","pick-up location","payment details","voucher configuration","participants","order overview"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"]},events:function(e){e.events||(e.events={});const t="con";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"ChangeConfiguration").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"]),optionalData:e.baseOptionalData.concat(e.productOptionalData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["eventAction","eventCause","eventPoints","linkLocation"]),description:"Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li><b>'pageSubCat1'</b> is used to capture the page section that is in the view port </li>\n        <li><b>'pageSubCat3'</b> is used if you select \"other\" in <b>'pageSubCat1'</b> because none of the pageSubCat1 allowed values matches your value. So you provide the value passed by markets/authors in pageSubCat3 .</li>\n        <li><b>'options[n].category1'</b> is used to capture the category of the the option/product with which the user interacts. It must not necessarily be the same as the page section in the view port.</li>\n        <li><b>'options[n].category3'</b> is used if you select \"other\" in <b>'options[n].category1'</b> because none of the category1 allowed values matches your value. So you provide the value passed by markets/authors in options[n].category3 .</li>\n        </ul>"},[(t+"CartAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user added product to cart",eventAction:"item added"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on add to cart icon/button and the product has been added successfully to the cart.\n        <br> <i>If the user clicks on the add to cart icon/button, but the product is not immediately added, then track the first click with the xxxClick function and only when the product is actually successfully added, then use this xxxCartAdd function</i>.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are added to the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart additions’.  When a customer adds their first product to a shopping cart, both ‘Carts’ and ‘Cart additions’ are triggered.</i>"},[(t+"CartRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user removed product from cart",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on remove from cart icon/button and the product has been successfully remove from the cart.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are removed from the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart removals’. </i>"},[(t+"CartCheckout").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user started checkout process",eventAction:"checkout"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks the button to start the checkout process.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) for which the checkout process is started. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Checkouts’. </i>"},[(t+"CheckoutProcess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"checkout",effect:"user updated checkout details",eventAction:"internal click"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"checkout interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["stepName","cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","step","stepAmounts","stepName","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID","step","stepAmounts"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this when the user updates information on any of the checkout process steps by clicking a save button/link and staying on the same process step. In case the next (virtual) step page loads, use the pageLoad function only.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'step'</b> is used to capture the number of the checkout step the user currently interacts. This is a numeric value. </li> \n            <li><b>'stepName'</b> is used to capture the name of the checkout process step .  </li> \n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b\n            > can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are being checked out. </li> \n        </ul>"},[(t+"OrderSuccess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user successfully submitted order",eventAction:"page load",cause:"automatic"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully submitted the order for the product(s) from the shopping basket. This generally is the case, when in the user interface a \"thank you for your purchase\" page is loaded.\n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>\n            <br> <i> This functions triggers the standard adobe analytics commerce metric 'Revenue’, 'Orders’ and 'Units’. In order to track the 'Revenue' and 'Orders', the product details must be passed in vehicle[n] and/or options[n] parameters respectively.</i>"},[(t+"OrderCancel").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user cancelled the order",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully cancelled an order. \n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>"},[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},conStartConfiguration:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user started configuration",eventName:"page view",cause:"automatic",eventAction:"page load"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration start"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"vehicle configurator"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["pageBrand","pageGeoRegion","pageLanguage","componentDEVagency","pageSysEnv"]),optionalData:e.baseOptionalData.filter((e=>!["componentDEVagency","formID","stepName","pageVariant","pageName","pageSubCat1"].includes(e))).concat(e.productOptionalData,["pageSubCat2","pageSubCat3","pageVersion","eventPoints"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n        <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n                <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n                <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n                <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n                <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n                <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n                <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n                <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n                <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n                <li><b>'pageType'</b> is used to capture the page template type.</li>\n                <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n                <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n                <li><b>'pageSubCat1'</b> is used to capture the page section that is in the view port </li>\n                <li><b>'pageSubCat3'</b> is used if you select \"other\" in <b>'pageSubCat1'</b> because none of the pageSubCat1 allowed values matches your value. So you provide the value passed by markets/authors in pageSubCat3 .</li>\n            </ul>"},conFinishConfiguration:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration finish"})},mandatoryData:e.baseMandatoryData.concat(["finishType"]).concat(e.productMandatoryData),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventAction"]),description:"Trigger this whenever the user clicks on any con finish cta, except the add to cart button. For add to cart you must trigger the function conCartAdd.\n        <ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'finishType'</b> is used to capture how the user finished the configuration. solutionSpecific10 (eVar160) may be used if finsihType='other' is sent to capture the new/undefined value, the author or market would like to use. Check the allowed values for details.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'requestedURL'</b> can be used to capture the target URL of the CTA</li>\n                <li><b>'pageSubCat1'</b> is used to capture the page section that is in the view port </li>\n                <li><b>'pageSubCat3'</b> is used if you select \"other\" in <b>'pageSubCat1'</b> because none of the pageSubCat1 allowed values matches your value. So you provide the value passed by markets/authors in pageSubCat3 .</li>\n                <li><b>'options[n].category1'</b> is used to capture the category of the the option/product with which the user interacts. It must not necessarily be the same as the page section in the view port.</li>\n                <li><b>'options[n].category3'</b> is used if you select \"other\" in <b>'options[n].category1'</b> because none of the category1 allowed values matches your value. So you provide the value passed by markets/authors in options[n].category3 .</li>\n            </ul>"}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix,oldEffectValue=this.message.event[0].eventInfo.effect;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(r){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(s){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let c="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",c,this.allowedPageGeoRegion)}{let l=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",l,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let d="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",d,"","(has to follow ISO standard of 2 letters in uppercase)")}{let m=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",m,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"},vehicleCodeVG;if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let u=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(u)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=u}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),void 0!==mandatoryData.pageSubCat1&&this.message.page.pageInfo.pageName==prefix+"configure"&&(this.message.page.pageInfo.pageName=this.message.page.pageInfo.pageName+" "+mandatoryData.pageSubCat1),mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle)mandatoryData.vehicle[i].codeVG&&void 0!==mandatoryData.vehicle[i].codeVG&&(vehicleCodeVG=mandatoryData.vehicle[i].codeVG);if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)void 0===mandatoryData.options[i].codeVG&&(mandatoryData.options[i].codeVG=vehicleCodeVG);var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let p=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=p.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(g){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let h=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let v of h)if("totalCurrency"==v){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let y="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",y,"","(has to follow ISO 3-letter currency code all upper case)")}{let f=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",f,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[v],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(v)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(v),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(v)>-1)return void variable._throwError("m",v,flagDetermine,"");variable._throwError("o",v,flagDetermine,""),mandatoryData[v]=""}else mandatoryData[v]=convertToNumeric(mandatoryData[v]),mandatoryData[v]=roundToDecimal(mandatoryData[v],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let b="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",b,variable.allowedOptionscodeVG)}{let D=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",D,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let w="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",w,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let N=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",N,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let O="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",O,variable.allowedOptionsCategory1,"")}{let I=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",I,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let T="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",T,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let A=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",A,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let C=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=C.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let S=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let k of S)if("totalCurrency"==k){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let F="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",F,"","(has to follow ISO 3-letter currency code all upper case)")}{let x=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",x,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[k],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(k)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(k),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(k)>-1)return void variable._throwError("m",k,flagDetermine,"");variable._throwError("o",k,flagDetermine,""),mandatoryData[k]=""}else mandatoryData[k]=convertToNumeric(mandatoryData[k]),mandatoryData[k]=roundToDecimal(mandatoryData[k],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}var category1Value="";if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0){for(var i in mandatoryData.options)if(void 0!==mandatoryData.options[i].category1&&"configuration change"==this.message.event[0].category.subCategory1){category1Value=gFFWNV([()=>mandatoryData.options[0].category1]);break}""!=category1Value&&(this.message.event[0].eventInfo.effect+=category1Value)}if(void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}if(void 0!==mandatoryData.stepName&&"user updated checkout details"==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>"user updated "+mandatoryData.stepName])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.transactionID&&"user paid successfully"==this.message.event[0].eventInfo.effect&&(this.message.event[0].attributes.purchaseID=gFFWNV([()=>mandatoryData.transactionID])),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(P){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(V){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(W){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(_){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(E){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let L=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(L)){let R="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",R,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=L}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let j="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",j,"","(has to follow ISO standard of 2 letters in uppercase)")}{let M=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",M,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let J="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",J,this.alloweduserCountry)}{let B=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",B,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(G){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&void 0!==mandatoryData.vehicle&&1==mandatoryData.vehicle.length){let $=mandatoryData.vehicle[0].range||"",U=mandatoryData.vehicle[0].rangeVG||mandatoryData.vehicle[0].range||"",q=mandatoryData.vehicle[0].codeVG||mandatoryData.vehicle[0].codeAG||"",H=mandatoryData.vehicle[0].hybridVersion||"";for(var i in this.message.product)void 0===this.message.product[i].attributes.bodyType&&(void 0===this.message.product[i].attributes.mmdr&&(this.message.product[i].attributes.mmdr=$.toUpperCase()),void 0===this.message.product[i].attributes.mmdrVG&&(this.message.product[i].attributes.mmdrVG=U.toUpperCase()),void 0===this.message.product[i].attributes.modelCodeVG&&(this.message.product[i].attributes.modelCodeVG=q.toUpperCase()),void 0===this.message.product[i].attributes.hybridVersion&&(this.message.product[i].attributes.hybridVersion=H))}if(void 0!==mandatoryData.finishType&&"configuration finish"==this.message.event[0].category.subCategory1&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.finishType])),void 0!==mandatoryData.finishType&&"configuration finish"==this.message.event[0].category.subCategory1&&(this.message.event[0].attributes.finishType=gFFWNV([()=>mandatoryData.finishType])),"user added product to cart"==this.message.event[0].eventInfo.effect&&"configuration finish"==mandatoryData.eventSubCat1&&(this.message.event[0].attributes.finishType=gFFWNV([()=>"add to cart"])),"user added product to the wish list"==this.message.event[0].eventInfo.effect&&"configuration finish"==mandatoryData.eventSubCat1&&(this.message.event[0].attributes.finishType=gFFWNV([()=>"add to wish list"])),"content visible"==mandatoryData.eventAction&&"configuration finish"==mandatoryData.eventSubCat1&&(this.message.event[0].attributes.finishType=gFFWNV([()=>"finish without cta"])),"interaction"==this.message.event[0].eventInfo.eventName&&void 0!==mandatoryData.pageName&&void 0!==mandatoryData.pageSubCat1&&(this.message.page.pageInfo.pageName=gFFWNV([()=>prefix+mandatoryData.pageName+" "+mandatoryData.pageSubCat1])),"page view"==this.message.event[0].eventInfo.eventName&&eventName.indexOf("StartConfiguration")>-1&&(this.message.event[0].eventInfo.effect=oldEffectValue),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let K,z,Q;if(K=z=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(Q=this.message.cart.item.length-1;Q>=0;Q--){let X=!1;void 0!==this.message.cart.item[Q]&&void 0!==this.message.cart.item[Q].price&&(void 0!==this.message.cart.item[Q].price.basePrice&&void 0!==this.message.cart.item[Q].price.basePrice&&this.message.cart.item[Q].price.basePrice>0||void 0!==this.message.cart.item[Q].price.priceWithTax&&void 0!==this.message.cart.item[Q].price.priceWithTax&&this.message.cart.item[Q].price.priceWithTax>0)&&(X=!0);let Z=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(Z=!0));let ee=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;X||Z||X||Z||ee?ee&&this.message.cart.item.splice(Q,1):this.message.cart.item.splice(Q,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(Q=this.message.transaction.item.length-1;Q>=0;Q--){let te=!1;void 0!==this.message.transaction.item[Q]&&void 0!==this.message.transaction.item[Q].price&&(void 0!==this.message.transaction.item[Q].price.basePrice&&void 0!==this.message.transaction.item[Q].price.basePrice&&this.message.transaction.item[Q].price.basePrice>0||void 0!==this.message.transaction.item[Q].price.priceWithTax&&void 0!==this.message.transaction.item[Q].price.priceWithTax&&this.message.transaction.item[Q].price.priceWithTax>0)&&(te=!0);let ae=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ae=!0));let oe=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;te||ae?oe||this.message.transaction.item.splice(Q,1):!oe||te||ae||this.message.transaction.item.splice(Q,1),""!=(((this.message.transaction.item[Q]||"").productInfo||"").productID||"")&&K.indexOf(this.message.transaction.item[Q].productInfo.productID)>-1&&this.message.transaction.item.splice(Q,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&z.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(Q=this.message.product.length-1;Q>=0;Q--){let ie=!1;void 0!==this.message.product[Q]&&void 0!==this.message.product[Q].price&&(void 0!==this.message.product[Q].price.basePrice&&void 0!==this.message.product[Q].price.basePrice&&this.message.product[Q].price.basePrice>0||void 0!==this.message.product[Q].price.priceWithTax&&void 0!==this.message.product[Q].price.priceWithTax&&this.message.product[Q].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ne=!0));let re=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ie&&this.message.product.splice(Q,1),!ne||re||ie||(K.indexOf(this.message.product[Q].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[Q]),this.message.product.splice(Q,1)),ne&&re&&(z.indexOf(this.message.product[Q].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[Q]),this.message.product.splice(Q,1)),""!=(((this.message.product[Q]||"").productInfo||"").productID||"")&&(K.indexOf(this.message.product[Q].productInfo.productID)>-1||z.indexOf(this.message.product[Q].productInfo.productID)>-1)&&this.message.product.splice(Q,1)}function Y(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let se=0;Object.keys(this.message.cart.item).forEach((e=>{se+=(e.price||0).basePrice||0})),se=this.roundToDecimal(se,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>se,()=>0])||0),this.message.cart.price.discountAmountAdditional=Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let ce=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ce+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ce+=e.price.discountAmountOther||0)})),ce=this.roundToDecimal(ce,2),this.message.cart.price.discountItemAmounts=Y(this.roundToDecimal(ce,2)),this.message.cart.price.discountAmountSum=Y(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let le=0;Object.keys(this.message.cart.item).forEach((e=>{le+=(e.price||0).taxAmount||0})),le=this.roundToDecimal(le,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(le,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let de=0;Object.keys(this.message.transaction.item).forEach((e=>{de+=(e.price||0).basePrice||0})),de=this.roundToDecimal(de,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>de,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let me=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(me+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(me+=e.price.discountAmountOther||0)})),me=this.roundToDecimal(me,2),this.message.transaction.total.discountItemAmounts=Y(this.roundToDecimal(me,2)),this.message.transaction.total.discountAmountSum=Y(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ue=0;Object.keys(this.message.transaction.item).forEach((e=>{ue+=(e.price||0).taxAmount||0})),ue=this.roundToDecimal(ue,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ue,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},6836:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic page",libraryName:"generic_page",libraryVersion:"_v2.2.3",prefix:"local > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"standalone",primaryCategory:"",subCategory1:"content"},componentInfo:{componentName:"",componentID:""},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"automatic",effect:"na",eventAction:"page load",eventName:"page view",eventPoints:0,type:"success"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName"],e.baseOptionalData=["componentPlatform","componentVersion","componentSubCat1","userStateProvince","userLanguage","userSegment","userCountry","userLoginStatus","userProfileID","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].finDownPayment","options[n].finMileage","options[n].finMonthlyPayment","options[n].finTerm","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["my account","bmw excellence club","b2b self service portal"],e.allowedComponentSubCat1=["navigation","forms","showroom","content","profile management","portal","offers","sports","jobs","culture"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="generic";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(r){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(s){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let c="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",c,this.allowedPageGeoRegion)}{let l=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",l,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let d="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",d,"","(has to follow ISO standard of 2 letters in uppercase)")}{let m=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",m,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let u=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(u)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=u}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=mandatoryData.userLoginStatus),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=mandatoryData.userProfileID);var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let p=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=p.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(g){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let h=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let v of h)if("totalCurrency"==v){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let y="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",y,"","(has to follow ISO 3-letter currency code all upper case)")}{let f=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",f,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[v],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(v)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(v),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(v)>-1)return void variable._throwError("m",v,flagDetermine,"");variable._throwError("o",v,flagDetermine,""),mandatoryData[v]=""}else mandatoryData[v]=convertToNumeric(mandatoryData[v]),mandatoryData[v]=roundToDecimal(mandatoryData[v],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let b="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",b,variable.allowedOptionscodeVG)}{let D=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",D,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let w="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",w,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let N=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",N,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let O="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",O,variable.allowedOptionsCategory1,"")}{let I=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",I,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let T="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",T,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let A=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",A,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let C=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=C.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let S=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let k of S)if("totalCurrency"==k){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let F="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",F,"","(has to follow ISO 3-letter currency code all upper case)")}{let x=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",x,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[k],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(k)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(k),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(k)>-1)return void variable._throwError("m",k,flagDetermine,"");variable._throwError("o",k,flagDetermine,""),mandatoryData[k]=""}else mandatoryData[k]=convertToNumeric(mandatoryData[k]),mandatoryData[k]=roundToDecimal(mandatoryData[k],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let P=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(P)){let V="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",V,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=P}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let W="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",W,"","(has to follow ISO standard of 2 letters in uppercase)")}{let _=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",_,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let E="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",E,this.alloweduserCountry)}{let L=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",L,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(R){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(j){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(M){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(J){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(B){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(G){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let $,U,q;if($=U=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(q=this.message.cart.item.length-1;q>=0;q--){let K=!1;void 0!==this.message.cart.item[q]&&void 0!==this.message.cart.item[q].price&&(void 0!==this.message.cart.item[q].price.basePrice&&void 0!==this.message.cart.item[q].price.basePrice&&this.message.cart.item[q].price.basePrice>0||void 0!==this.message.cart.item[q].price.priceWithTax&&void 0!==this.message.cart.item[q].price.priceWithTax&&this.message.cart.item[q].price.priceWithTax>0)&&(K=!0);let z=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(z=!0));let Q=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;K||z||K||z||Q?Q&&this.message.cart.item.splice(q,1):this.message.cart.item.splice(q,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&$.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(q=this.message.transaction.item.length-1;q>=0;q--){let Y=!1;void 0!==this.message.transaction.item[q]&&void 0!==this.message.transaction.item[q].price&&(void 0!==this.message.transaction.item[q].price.basePrice&&void 0!==this.message.transaction.item[q].price.basePrice&&this.message.transaction.item[q].price.basePrice>0||void 0!==this.message.transaction.item[q].price.priceWithTax&&void 0!==this.message.transaction.item[q].price.priceWithTax&&this.message.transaction.item[q].price.priceWithTax>0)&&(Y=!0);let X=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(X=!0));let Z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;Y||X?Z||this.message.transaction.item.splice(q,1):!Z||Y||X||this.message.transaction.item.splice(q,1),""!=(((this.message.transaction.item[q]||"").productInfo||"").productID||"")&&$.indexOf(this.message.transaction.item[q].productInfo.productID)>-1&&this.message.transaction.item.splice(q,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&U.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(q=this.message.product.length-1;q>=0;q--){let ee=!1;void 0!==this.message.product[q]&&void 0!==this.message.product[q].price&&(void 0!==this.message.product[q].price.basePrice&&void 0!==this.message.product[q].price.basePrice&&this.message.product[q].price.basePrice>0||void 0!==this.message.product[q].price.priceWithTax&&void 0!==this.message.product[q].price.priceWithTax&&this.message.product[q].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee&&this.message.product.splice(q,1),!te||ae||ee||($.indexOf(this.message.product[q].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[q]),this.message.product.splice(q,1)),te&&ae&&(U.indexOf(this.message.product[q].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[q]),this.message.product.splice(q,1)),""!=(((this.message.product[q]||"").productInfo||"").productID||"")&&($.indexOf(this.message.product[q].productInfo.productID)>-1||U.indexOf(this.message.product[q].productInfo.productID)>-1)&&this.message.product.splice(q,1)}function H(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let oe=0;Object.keys(this.message.cart.item).forEach((e=>{oe+=(e.price||0).basePrice||0})),oe=this.roundToDecimal(oe,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>oe,()=>0])||0),this.message.cart.price.discountAmountAdditional=H(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let ie=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ie+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ie+=e.price.discountAmountOther||0)})),ie=this.roundToDecimal(ie,2),this.message.cart.price.discountItemAmounts=H(this.roundToDecimal(ie,2)),this.message.cart.price.discountAmountSum=H(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ne=0;Object.keys(this.message.cart.item).forEach((e=>{ne+=(e.price||0).taxAmount||0})),ne=this.roundToDecimal(ne,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(ne,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.transaction.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=this.roundToDecimal(re,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.transaction.total.discountAmountAdditional=H(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let se=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=this.roundToDecimal(se,2),this.message.transaction.total.discountItemAmounts=H(this.roundToDecimal(se,2)),this.message.transaction.total.discountAmountSum=H(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.transaction.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=this.roundToDecimal(ce,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ce,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},4139:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic shop",libraryName:"generic_shop",libraryVersion:"_v1.1.3",prefix:"sales > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"standalone",primaryCategory:"sales",subCategory1:""},componentInfo:{componentName:"",componentID:`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.baseCustom={},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName","componentSubCat1","componentType"],e.baseOptionalData=["componentDEVagency","componentPlatform","userProfileID","componentVersion","stepName","userSegment","userLoginStatus","userStateProvince","userLanguage","userCountry","transactionID","cartID","totalCurrency","totalPaymentMethod","totalShippingCost","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalBasePrice","totalDiscountAmount","totalTaxAmount","totalPriceWithTax","totalFinalPrice","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["oneshop","bmw m dex","digital sales platform","gb online sales master"],e.allowedComponentSubCat1=["vehicle sales platform","accessory sales platform","service sales platform","combined webshop"],e.allowedPageType=["overview","product group","product details","cart","checkout","orders","customer","error","error 404","forms"],e.allowedPageSubCat1=["digital services","physical goods","vehicles","payment"],e.allowedStep=["value should be numeric"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedStepNamesGeneric=["personal details","email","phone number","billing address","pick-up location","payment details","voucher configuration","participants","order overview"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="shop";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"CartAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user added product to cart",eventAction:"item added"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on add to cart icon/button and the product has been added successfully to the cart.\n        <br> <i>If the user clicks on the add to cart icon/button, but the product is not immediately added, then track the first click with the xxxClick function and only when the product is actually successfully added, then use this xxxCartAdd function</i>.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are added to the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart additions’.  When a customer adds their first product to a shopping cart, both ‘Carts’ and ‘Cart additions’ are triggered.</i>"},[(t+"CartRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user removed product from cart",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on remove from cart icon/button and the product has been successfully remove from the cart.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are removed from the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart removals’. </i>"},[(t+"CartCheckout").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user started checkout process",eventAction:"checkout"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks the button to start the checkout process.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) for which the checkout process is started. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Checkouts’. </i>"},[(t+"CheckoutProcess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"checkout",effect:"user updated checkout details",eventAction:"internal click"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"checkout interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["stepName","cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","step","stepAmounts","stepName","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID","step","stepAmounts"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this when the user updates information on any of the checkout process steps by clicking a save button/link and staying on the same process step. In case the next (virtual) step page loads, use the pageLoad function only.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'step'</b> is used to capture the number of the checkout step the user currently interacts. This is a numeric value. </li> \n            <li><b>'stepName'</b> is used to capture the name of the checkout process step .  </li> \n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b\n            > can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are being checked out. </li> \n        </ul>"},[(t+"OrderSuccess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user successfully submitted order",eventAction:"page load",cause:"automatic"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully submitted the order for the product(s) from the shopping basket. This generally is the case, when in the user interface a \"thank you for your purchase\" page is loaded.\n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>\n            <br> <i> This functions triggers the standard adobe analytics commerce metric 'Revenue’, 'Orders’ and 'Units’. In order to track the 'Revenue' and 'Orders', the product details must be passed in vehicle[n] and/or options[n] parameters respectively.</i>"},[(t+"OrderCancel").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user cancelled the order",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully cancelled an order. \n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>"},[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(r){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(s){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let c="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",c,this.allowedPageGeoRegion)}{let l=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",l,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let d="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",d,"","(has to follow ISO standard of 2 letters in uppercase)")}{let m=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",m,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let u=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(u)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=u}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let p=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(p)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let g="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",g,this.allowedFilterObjects)}{let h=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",h,this.allowedFilterObjects)}}mandatoryData.filterObject=p}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||""));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let v=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=v.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(y){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let f=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let b of f)if("totalCurrency"==b){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let D="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",D,"","(has to follow ISO 3-letter currency code all upper case)")}{let w=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",w,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[b],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(b)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(b),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(b)>-1)return void variable._throwError("m",b,flagDetermine,"");variable._throwError("o",b,flagDetermine,""),mandatoryData[b]=""}else mandatoryData[b]=convertToNumeric(mandatoryData[b]),mandatoryData[b]=roundToDecimal(mandatoryData[b],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let N="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",N,variable.allowedOptionscodeVG)}{let O=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",O,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let I="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",I,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let T=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",T,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let A="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",A,variable.allowedOptionsCategory1,"")}{let C=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",C,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let S="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",S,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let k=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",k,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let F=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=F.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let x=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let P of x)if("totalCurrency"==P){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let V="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",V,"","(has to follow ISO 3-letter currency code all upper case)")}{let W=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",W,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[P],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(P)>-1)return void variable._throwError("m",P,flagDetermine,"");variable._throwError("o",P,flagDetermine,""),mandatoryData[P]=""}else mandatoryData[P]=convertToNumeric(mandatoryData[P]),mandatoryData[P]=roundToDecimal(mandatoryData[P],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData.videoTotalLength&&"number"!=typeof mandatoryData.videoTotalLength){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","videoTotalLength","incorrect-numeric","");this._throwError("o","videoTotalLength","incorrect-numeric",""),mandatoryData.videoTotalLength=""}if(void 0!==mandatoryData.videoCurrentTime&&"number"!=typeof mandatoryData.videoCurrentTime){if(this.events[eventName].mandatoryData.indexOf("videoCurrentTime")>-1)return void this._throwError("m","videoCurrentTime","incorrect-numeric","");this._throwError("o","videoCurrentTime","incorrect-numeric",""),mandatoryData.videoCurrentTime=""}if(void 0!==mandatoryData.videoName&&(this.message.component[0].componentInfo.componentID=gFFWNV([()=>this.message.component[0].componentInfo.componentID+" > "+mandatoryData.videoName]),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.videoName])),void 0!==mandatoryData.videoHosting&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.videoHosting])),void 0!==mandatoryData.videoTotalLength&&(this.message.event[0].attributes.media.totalLength=gFFWNV([()=>mandatoryData.videoTotalLength||0])),void 0!==mandatoryData.videoCurrentTime&&(this.message.event[0].attributes.media.currentTime=gFFWNV([()=>mandatoryData.videoCurrentTime||0])),delete this.message.custom.videoCurrentTime,delete this.message.custom.videoName,delete this.message.custom.videoTotalLength,void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(_){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(E){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(L){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(R){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(j){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let M=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(M)){let J="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",J,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=M}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let B="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",B,"","(has to follow ISO standard of 2 letters in uppercase)")}{let G=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let $="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",$,this.alloweduserCountry)}{let U=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",U,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(q){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}if(void 0!==mandatoryData.stepName&&"user updated checkout details"==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>"user updated "+mandatoryData.stepName])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.transactionID&&"user paid successfully"==this.message.event[0].eventInfo.effect&&(this.message.event[0].attributes.purchaseID=gFFWNV([()=>mandatoryData.transactionID])),void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}if(void 0!==mandatoryData.stepName&&"user updated checkout details"==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>"user updated "+mandatoryData.stepName])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.transactionID&&"user paid successfully"==this.message.event[0].eventInfo.effect&&(this.message.event[0].attributes.purchaseID=gFFWNV([()=>mandatoryData.transactionID])),this.message.page.pageInfo.pageName==prefix+"checkout"&&void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName])),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let H,K,z;if(H=K=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(z=this.message.cart.item.length-1;z>=0;z--){let Y=!1;void 0!==this.message.cart.item[z]&&void 0!==this.message.cart.item[z].price&&(void 0!==this.message.cart.item[z].price.basePrice&&void 0!==this.message.cart.item[z].price.basePrice&&this.message.cart.item[z].price.basePrice>0||void 0!==this.message.cart.item[z].price.priceWithTax&&void 0!==this.message.cart.item[z].price.priceWithTax&&this.message.cart.item[z].price.priceWithTax>0)&&(Y=!0);let X=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(X=!0));let Z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;Y||X||Y||X||Z?Z&&this.message.cart.item.splice(z,1):this.message.cart.item.splice(z,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&H.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(z=this.message.transaction.item.length-1;z>=0;z--){let ee=!1;void 0!==this.message.transaction.item[z]&&void 0!==this.message.transaction.item[z].price&&(void 0!==this.message.transaction.item[z].price.basePrice&&void 0!==this.message.transaction.item[z].price.basePrice&&this.message.transaction.item[z].price.basePrice>0||void 0!==this.message.transaction.item[z].price.priceWithTax&&void 0!==this.message.transaction.item[z].price.priceWithTax&&this.message.transaction.item[z].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee||te?ae||this.message.transaction.item.splice(z,1):!ae||ee||te||this.message.transaction.item.splice(z,1),""!=(((this.message.transaction.item[z]||"").productInfo||"").productID||"")&&H.indexOf(this.message.transaction.item[z].productInfo.productID)>-1&&this.message.transaction.item.splice(z,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(z=this.message.product.length-1;z>=0;z--){let oe=!1;void 0!==this.message.product[z]&&void 0!==this.message.product[z].price&&(void 0!==this.message.product[z].price.basePrice&&void 0!==this.message.product[z].price.basePrice&&this.message.product[z].price.basePrice>0||void 0!==this.message.product[z].price.priceWithTax&&void 0!==this.message.product[z].price.priceWithTax&&this.message.product[z].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ie=!0));let ne=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;oe&&this.message.product.splice(z,1),!ie||ne||oe||(H.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[z]),this.message.product.splice(z,1)),ie&&ne&&(K.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[z]),this.message.product.splice(z,1)),""!=(((this.message.product[z]||"").productInfo||"").productID||"")&&(H.indexOf(this.message.product[z].productInfo.productID)>-1||K.indexOf(this.message.product[z].productInfo.productID)>-1)&&this.message.product.splice(z,1)}function Q(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.cart.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=this.roundToDecimal(re,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.cart.price.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let se=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=this.roundToDecimal(se,2),this.message.cart.price.discountItemAmounts=Q(this.roundToDecimal(se,2)),this.message.cart.price.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.cart.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=this.roundToDecimal(ce,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(ce,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let le=0;Object.keys(this.message.transaction.item).forEach((e=>{le+=(e.price||0).basePrice||0})),le=this.roundToDecimal(le,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>le,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let de=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(de+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(de+=e.price.discountAmountOther||0)})),de=this.roundToDecimal(de,2),this.message.transaction.total.discountItemAmounts=Q(this.roundToDecimal(de,2)),this.message.transaction.total.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let me=0;Object.keys(this.message.transaction.item).forEach((e=>{me+=(e.price||0).taxAmount||0})),me=this.roundToDecimal(me,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(me,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},940:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: generic stock locator",libraryName:"generic_stock_locator",libraryVersion:"_v11.2.3",prefix:"stock > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){var t;e.component={category:{componentType:"standalone",primaryCategory:"stock locator",subCategory1:""},componentInfo:{componentName:"central car stock locator",componentID:`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.baseCustom={},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName","componentSubCat1","componentType","componentVersion"],e.baseOptionalData=["componentDEVagency","componentPlatform","userProfileID","searchResults","positionClicked","totalCurrency","userLoginStatus","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=["vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].primaryCategory","vehicle[n].range","vehicle[n].productID"],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].packageID","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["central car stock locator","central new car stock locator","central used car stock locator","uk used car stock locator","uk new car stock locator"],e.allowedComponentSubCat1=["new car stock locator","used car stock locator","car stock locator","new bike stock locator","used bike stock locator","bike stock locator"],e.allowedPageName=["dealer search","favorites","home","search results","similarity search results","vehicle details","maintenance error","error","page not found error"],e.allowedPageType=["search","profile","overview","product details","error"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],(t=void 0!==e?e:this).allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],(t=void 0!==e?e:this).allowedVehicleItemBasePrice=["value should be numeric"],t.allowedVehicleItemDiscountAmount=["value should be numeric"],t.allowedVehicleItemPriceWithTax=["value should be numeric"],t.allowedVehicleItemQuantity=["value should be numeric"],t.allowedVehicleItemTaxAmount=["value should be numeric"],t.allowedVehicleItemDiscountOtherAmount=["value should be numeric"],t.allowedVehicleItemDiscountSalesAmount=["value should be numeric"],t.allowedOptionsItemBasePrice=["value should be numeric"],t.allowedOptionsItemDiscountAmount=["value should be numeric"],t.allowedOptionsItemPriceWithTax=["value should be numeric"],t.allowedOptionsItemQuantity=["value should be numeric"],t.allowedOptionsItemTaxAmount=["value should be numeric"],t.allowedOptionsItemDiscountOtherAmount=["value should be numeric"],t.allowedOptionsItemDiscountSalesAmount=["value should be numeric"],t.allowedTotalBasePrice=["value should be numeric"],t.allowedTotalDiscountAmount=["value should be numeric"],t.allowedTotalFinalPrice=["value should be numeric"],t.allowedTotalPriceWithTax=["value should be numeric"],t.allowedTotalShippingCost=["value should be numeric"],t.allowedTotalTaxAmount=["value should be numeric"],t.allowedTotalCurrency=["value shoud be ISO 3-letter currency code all upper case"],t.allowedTotalTaxAmountAdditional=["value should be numeric"],t.allowedTotalDiscountAmountAdditional=["value should be numeric"],t.allowedTransactionID=["value may only contain max. 20 characters"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedVideoTotalLength=["value should be numeric"],e.allowedVideoCurrentTime=["value should be numeric"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedStepNamesGeneric=["personal details","email","phone number","billing address","pick-up location","payment details","voucher configuration","participants","order overview"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="stock";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"VideoStarted").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger everytime the user starts a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n    <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>\'videoName\'</b> is the name of the specific video</li>\n    <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>'},[(t+"VideoStartedAutomatic").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video starts automatically (autoplay). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},[(t+"VideoStopped").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video paused",eventAction:"media paused",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger everytime the user stopps / pauses a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n    <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>'videoName'</b> is the name of the specific video</li>\n    <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>"},[(t+"VideoEnded").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video finished",eventAction:"media stopped",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video is automatically stopped (end of video). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},[(t+"VideoMilestoneReached25").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 25% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 25% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},[(t+"VideoMilestoneReached50").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 50% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 50% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},[(t+"VideoMilestoneReached75").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 75% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 75% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"CartAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user added product to cart",eventAction:"item added"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on add to cart icon/button and the product has been added successfully to the cart.\n        <br> <i>If the user clicks on the add to cart icon/button, but the product is not immediately added, then track the first click with the xxxClick function and only when the product is actually successfully added, then use this xxxCartAdd function</i>.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are added to the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart additions’.  When a customer adds their first product to a shopping cart, both ‘Carts’ and ‘Cart additions’ are triggered.</i>"},[(t+"CartRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user removed product from cart",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID","step","stepName"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","eventSubCat1","linkLocation","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks on remove from cart icon/button and the product has been successfully remove from the cart.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are removed from the cart. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Cart removals’. </i>"},[(t+"CartCheckout").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"cart",effect:"user started checkout process",eventAction:"checkout"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"cart interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this whenever the user clicks the button to start the checkout process.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) for which the checkout process is started. </li> \n        </ul>\n        <br> <i> This functions triggers the standard adobe analytics commerce metric 'Checkouts’. </i>"},[(t+"CheckoutProcess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"checkout",effect:"user updated checkout details",eventAction:"internal click"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"checkout interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["stepName","cartID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","step","stepAmounts","stepName","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID","step","stepAmounts"]).filter((t=>!e.productMandatoryData.includes(t))),description:"Trigger this when the user updates information on any of the checkout process steps by clicking a save button/link and staying on the same process step. In case the next (virtual) step page loads, use the pageLoad function only.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'step'</b> is used to capture the number of the checkout step the user currently interacts. This is a numeric value. </li> \n            <li><b>'stepName'</b> is used to capture the name of the checkout process step .  </li> \n            <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n            <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>'linkLocation'</b\n            > can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that is/are being checked out. </li> \n        </ul>"},[(t+"OrderSuccess").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user successfully submitted order",eventAction:"page load",cause:"automatic"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully submitted the order for the product(s) from the shopping basket. This generally is the case, when in the user interface a \"thank you for your purchase\" page is loaded.\n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>\n            <br> <i> This functions triggers the standard adobe analytics commerce metric 'Revenue’, 'Orders’ and 'Units’. In order to track the 'Revenue' and 'Orders', the product details must be passed in vehicle[n] and/or options[n] parameters respectively.</i>"},[(t+"OrderCancel").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"commerce",type:"order",effect:"user cancelled the order",eventAction:"item removed"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"order interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["transactionID"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults","positionClicked","cartID","transactionID"].includes(e))).concat(e.productOptionalData.filter((e=>!["options[n].productID","vehicle[n].productID"].includes(e))),["cartID","linkLocation","eventSubCat1","options[n].productID","vehicle[n].productID"]).filter((t=>!e.productMandatoryData.includes(t))),description:"<br>Trigger this when the user successfully cancelled an order. \n            <br><ul>\n                <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n                <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n                <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n                <li><b>'cartID'</b> is used to capture the unique ID of a visitor's shopping basket. </li> \n                <li><b>'transactionID'</b> is used to capture the unique ID of a visitor's successful order. It's often referred to as order number. </li> \n                <li><b>'eventSubCat1'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n                <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n                <li><b>'vehicle[n]'</b> for cars and motorcycles or <b>'options[n]'</b> for services and after sales products should be provided to give more details about the product(s) that were ordered. </li> \n            </ul>"},stockStarted:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{cause:"automatic",effect:"stock locator started",eventAction:"page load",type:"success"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"stock locator start"})},mandatoryData:e.baseMandatoryData.concat([]),optionalData:["searchResults","search[n].searchLabel","search[n].searchTerm","search[n].searchUnit","search[n].searchState","dealer[n].outletBuno","dealer[n].groupID","dealer[n].groupName","dealer[n].outletID","dealer[n].outletName","dealer[n].selectionState","vehicle[n].name","vehicle[n].productID","vehicle[n].businessDivision","vehicle[n].primaryCategory","vehicle[n].category1","vehicle[n].category2","vehicle[n].manufacturer","vehicle[n].status","vehicle[n].bodyType","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].range","vehicle[n].series","vehicle[n].subSeries","vehicle[n].salesModel","vehicle[n].category3"],description:"Trigger this event once per visit when the visitor lands on any page within the stock locator<br>"}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(r){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(s){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let c="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",c,this.allowedPageGeoRegion)}{let l=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",l,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let d="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",d,"","(has to follow ISO standard of 2 letters in uppercase)")}{let m=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",m,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let u=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(u)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=u}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let p=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(p)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let g="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",g,this.allowedFilterObjects)}{let h=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",h,this.allowedFilterObjects)}}mandatoryData.filterObject=p}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||""));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let v=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=v.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(y){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let f=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let b of f)if("totalCurrency"==b){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let D="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",D,"","(has to follow ISO 3-letter currency code all upper case)")}{let w=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",w,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[b],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(b)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(b),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(b)>-1)return void variable._throwError("m",b,flagDetermine,"");variable._throwError("o",b,flagDetermine,""),mandatoryData[b]=""}else mandatoryData[b]=convertToNumeric(mandatoryData[b]),mandatoryData[b]=roundToDecimal(mandatoryData[b],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let N="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",N,variable.allowedOptionscodeVG)}{let O=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",O,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let I="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",I,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let T=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",T,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let A="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",A,variable.allowedOptionsCategory1,"")}{let C=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",C,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let S="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",S,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let k=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",k,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let F=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=F.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let x=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let P of x)if("totalCurrency"==P){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let V="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",V,"","(has to follow ISO 3-letter currency code all upper case)")}{let W=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",W,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[P],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(P),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(P)>-1)return void variable._throwError("m",P,flagDetermine,"");variable._throwError("o",P,flagDetermine,""),mandatoryData[P]=""}else mandatoryData[P]=convertToNumeric(mandatoryData[P]),mandatoryData[P]=roundToDecimal(mandatoryData[P],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData.videoTotalLength&&"number"!=typeof mandatoryData.videoTotalLength){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","videoTotalLength","incorrect-numeric","");this._throwError("o","videoTotalLength","incorrect-numeric",""),mandatoryData.videoTotalLength=""}if(void 0!==mandatoryData.videoCurrentTime&&"number"!=typeof mandatoryData.videoCurrentTime){if(this.events[eventName].mandatoryData.indexOf("videoCurrentTime")>-1)return void this._throwError("m","videoCurrentTime","incorrect-numeric","");this._throwError("o","videoCurrentTime","incorrect-numeric",""),mandatoryData.videoCurrentTime=""}if(void 0!==mandatoryData.videoName&&(this.message.component[0].componentInfo.componentID=gFFWNV([()=>this.message.component[0].componentInfo.componentID+" > "+mandatoryData.videoName]),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.videoName])),void 0!==mandatoryData.videoHosting&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.videoHosting])),void 0!==mandatoryData.videoTotalLength&&(this.message.event[0].attributes.media.totalLength=gFFWNV([()=>mandatoryData.videoTotalLength||0])),void 0!==mandatoryData.videoCurrentTime&&(this.message.event[0].attributes.media.currentTime=gFFWNV([()=>mandatoryData.videoCurrentTime||0])),delete this.message.custom.videoCurrentTime,delete this.message.custom.videoName,delete this.message.custom.videoTotalLength,void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(_){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(E){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(L){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(R){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(j){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let M=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(M)){let J="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",J,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=M}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let B="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",B,"","(has to follow ISO standard of 2 letters in uppercase)")}{let G=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let $="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",$,this.alloweduserCountry)}{let U=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",U,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(q){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}if(void 0!==mandatoryData.stepName&&"user updated checkout details"==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>"user updated "+mandatoryData.stepName])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.transactionID&&"user paid successfully"==this.message.event[0].eventInfo.effect&&(this.message.event[0].attributes.purchaseID=gFFWNV([()=>mandatoryData.transactionID])),void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),void 0!==mandatoryData.pageSubCat1&&this.message.page.pageInfo.pageName==prefix+"favorites"&&(this.message.page.category.subCategory1=mandatoryData.pageSubCat1+" vehicles saved in favorites"),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let H,K,z;if(H=K=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(z=this.message.cart.item.length-1;z>=0;z--){let Y=!1;void 0!==this.message.cart.item[z]&&void 0!==this.message.cart.item[z].price&&(void 0!==this.message.cart.item[z].price.basePrice&&void 0!==this.message.cart.item[z].price.basePrice&&this.message.cart.item[z].price.basePrice>0||void 0!==this.message.cart.item[z].price.priceWithTax&&void 0!==this.message.cart.item[z].price.priceWithTax&&this.message.cart.item[z].price.priceWithTax>0)&&(Y=!0);let X=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(X=!0));let Z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;Y||X||Y||X||Z?Z&&this.message.cart.item.splice(z,1):this.message.cart.item.splice(z,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&H.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(z=this.message.transaction.item.length-1;z>=0;z--){let ee=!1;void 0!==this.message.transaction.item[z]&&void 0!==this.message.transaction.item[z].price&&(void 0!==this.message.transaction.item[z].price.basePrice&&void 0!==this.message.transaction.item[z].price.basePrice&&this.message.transaction.item[z].price.basePrice>0||void 0!==this.message.transaction.item[z].price.priceWithTax&&void 0!==this.message.transaction.item[z].price.priceWithTax&&this.message.transaction.item[z].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(te=!0));let ae=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ee||te?ae||this.message.transaction.item.splice(z,1):!ae||ee||te||this.message.transaction.item.splice(z,1),""!=(((this.message.transaction.item[z]||"").productInfo||"").productID||"")&&H.indexOf(this.message.transaction.item[z].productInfo.productID)>-1&&this.message.transaction.item.splice(z,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(z=this.message.product.length-1;z>=0;z--){let oe=!1;void 0!==this.message.product[z]&&void 0!==this.message.product[z].price&&(void 0!==this.message.product[z].price.basePrice&&void 0!==this.message.product[z].price.basePrice&&this.message.product[z].price.basePrice>0||void 0!==this.message.product[z].price.priceWithTax&&void 0!==this.message.product[z].price.priceWithTax&&this.message.product[z].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ie=!0));let ne=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;oe&&this.message.product.splice(z,1),!ie||ne||oe||(H.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[z]),this.message.product.splice(z,1)),ie&&ne&&(K.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[z]),this.message.product.splice(z,1)),""!=(((this.message.product[z]||"").productInfo||"").productID||"")&&(H.indexOf(this.message.product[z].productInfo.productID)>-1||K.indexOf(this.message.product[z].productInfo.productID)>-1)&&this.message.product.splice(z,1)}function Q(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let re=0;Object.keys(this.message.cart.item).forEach((e=>{re+=(e.price||0).basePrice||0})),re=this.roundToDecimal(re,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>re,()=>0])||0),this.message.cart.price.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let se=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(se+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(se+=e.price.discountAmountOther||0)})),se=this.roundToDecimal(se,2),this.message.cart.price.discountItemAmounts=Q(this.roundToDecimal(se,2)),this.message.cart.price.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ce=0;Object.keys(this.message.cart.item).forEach((e=>{ce+=(e.price||0).taxAmount||0})),ce=this.roundToDecimal(ce,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(ce,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let le=0;Object.keys(this.message.transaction.item).forEach((e=>{le+=(e.price||0).basePrice||0})),le=this.roundToDecimal(le,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>le,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let de=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(de+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(de+=e.price.discountAmountOther||0)})),de=this.roundToDecimal(de,2),this.message.transaction.total.discountItemAmounts=Q(this.roundToDecimal(de,2)),this.message.transaction.total.discountAmountSum=Q(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let me=0;Object.keys(this.message.transaction.item).forEach((e=>{me+=(e.price||0).taxAmount||0})),me=this.roundToDecimal(me,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(me,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},7438:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__}),window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: vehicle card",libraryName:"generic_vehicle_cards",libraryVersion:"_v4.1.3",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}},__WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"vehicle card"},componentInfo:{componentName:"model card"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName","vehicle[n].name","vehicle[n].productID","vehicle[n].businessDivision","vehicle[n].primaryCategory","vehicle[n].category1","vehicle[n].manufacturer","vehicle[n].codeVG","vehicle[n].range","vehicle[n].series"],e.baseOptionalData=["componentDEVagency","componentPlatform","componentVersion","positionClicked","searchResults","userLoginStatus","userProfileID","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].codeAG","vehicle[n].fuelType","vehicle[n].hybridVersion","vehicle[n].category2","vehicle[n].category3","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].gearing","vehicle[n].packageID","vehicle[n].salesModel","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedComponentNames=["sed card","model card","cluster card"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="card";e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(r){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(s){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(c){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(d){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let m=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=m.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(u){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let p=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let g of p)if("totalCurrency"==g){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let h="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",h,"","(has to follow ISO 3-letter currency code all upper case)")}{let v=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",v,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[g],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(g)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(g),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(g)>-1)return void variable._throwError("m",g,flagDetermine,"");variable._throwError("o",g,flagDetermine,""),mandatoryData[g]=""}else mandatoryData[g]=convertToNumeric(mandatoryData[g]),mandatoryData[g]=roundToDecimal(mandatoryData[g],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let y="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",y,variable.allowedOptionscodeVG)}{let f=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",f,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let b="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",b,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let D=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",D,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let w="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",w,variable.allowedOptionsCategory1,"")}{let N=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",N,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let O="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",O,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let I=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",I,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let T=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=T.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let A=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let C of A)if("totalCurrency"==C){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let S="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",S,"","(has to follow ISO 3-letter currency code all upper case)")}{let k=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",k,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[C],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(C)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(C),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(C)>-1)return void variable._throwError("m",C,flagDetermine,"");variable._throwError("o",C,flagDetermine,""),mandatoryData[C]=""}else mandatoryData[C]=convertToNumeric(mandatoryData[C]),mandatoryData[C]=roundToDecimal(mandatoryData[C],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let F=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(F)){let x="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",x,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=F}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let P="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",P,"","(has to follow ISO standard of 2 letters in uppercase)")}{let V=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",V,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let W="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",W,this.alloweduserCountry)}{let _=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",_,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(E){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.componentName&&(this.message.event[0].category.subCategory1=mandatoryData.componentName+" "+this.message.event[0].category.subCategory1),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let L,R,j;if(L=R=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(j=this.message.cart.item.length-1;j>=0;j--){let J=!1;void 0!==this.message.cart.item[j]&&void 0!==this.message.cart.item[j].price&&(void 0!==this.message.cart.item[j].price.basePrice&&void 0!==this.message.cart.item[j].price.basePrice&&this.message.cart.item[j].price.basePrice>0||void 0!==this.message.cart.item[j].price.priceWithTax&&void 0!==this.message.cart.item[j].price.priceWithTax&&this.message.cart.item[j].price.priceWithTax>0)&&(J=!0);let B=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(B=!0));let G=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;J||B||J||B||G?G&&this.message.cart.item.splice(j,1):this.message.cart.item.splice(j,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&L.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(j=this.message.transaction.item.length-1;j>=0;j--){let $=!1;void 0!==this.message.transaction.item[j]&&void 0!==this.message.transaction.item[j].price&&(void 0!==this.message.transaction.item[j].price.basePrice&&void 0!==this.message.transaction.item[j].price.basePrice&&this.message.transaction.item[j].price.basePrice>0||void 0!==this.message.transaction.item[j].price.priceWithTax&&void 0!==this.message.transaction.item[j].price.priceWithTax&&this.message.transaction.item[j].price.priceWithTax>0)&&($=!0);let U=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(U=!0));let q=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;$||U?q||this.message.transaction.item.splice(j,1):!q||$||U||this.message.transaction.item.splice(j,1),""!=(((this.message.transaction.item[j]||"").productInfo||"").productID||"")&&L.indexOf(this.message.transaction.item[j].productInfo.productID)>-1&&this.message.transaction.item.splice(j,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&R.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(j=this.message.product.length-1;j>=0;j--){let H=!1;void 0!==this.message.product[j]&&void 0!==this.message.product[j].price&&(void 0!==this.message.product[j].price.basePrice&&void 0!==this.message.product[j].price.basePrice&&this.message.product[j].price.basePrice>0||void 0!==this.message.product[j].price.priceWithTax&&void 0!==this.message.product[j].price.priceWithTax&&this.message.product[j].price.priceWithTax>0)&&(H=!0);let K=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(K=!0));let z=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;H&&this.message.product.splice(j,1),!K||z||H||(L.indexOf(this.message.product[j].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[j]),this.message.product.splice(j,1)),K&&z&&(R.indexOf(this.message.product[j].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[j]),this.message.product.splice(j,1)),""!=(((this.message.product[j]||"").productInfo||"").productID||"")&&(L.indexOf(this.message.product[j].productInfo.productID)>-1||R.indexOf(this.message.product[j].productInfo.productID)>-1)&&this.message.product.splice(j,1)}function M(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let Q=0;Object.keys(this.message.cart.item).forEach((e=>{Q+=(e.price||0).basePrice||0})),Q=this.roundToDecimal(Q,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>Q,()=>0])||0),this.message.cart.price.discountAmountAdditional=M(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let Y=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Y+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Y+=e.price.discountAmountOther||0)})),Y=this.roundToDecimal(Y,2),this.message.cart.price.discountItemAmounts=M(this.roundToDecimal(Y,2)),this.message.cart.price.discountAmountSum=M(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let X=0;Object.keys(this.message.cart.item).forEach((e=>{X+=(e.price||0).taxAmount||0})),X=this.roundToDecimal(X,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(X,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let Z=0;Object.keys(this.message.transaction.item).forEach((e=>{Z+=(e.price||0).basePrice||0})),Z=this.roundToDecimal(Z,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>Z,()=>0])||0),this.message.transaction.total.discountAmountAdditional=M(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let ee=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ee+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ee+=e.price.discountAmountOther||0)})),ee=this.roundToDecimal(ee,2),this.message.transaction.total.discountItemAmounts=M(this.roundToDecimal(ee,2)),this.message.transaction.total.discountAmountSum=M(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let te=0;Object.keys(this.message.transaction.item).forEach((e=>{te+=(e.price||0).taxAmount||0})),te=this.roundToDecimal(te,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(te,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},8787:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON:Trade-in",libraryName:"trade-in",libraryVersion:"_v10.0.0",prefix:"shared > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion="Trade-in"+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"",subCategory1:"forms"},componentInfo:{componentName:"custom central form",componentID:"custom central form > trade-in"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"form",eventPoints:0,type:"rft"},category:{subCategory1:"",subCategory2:"lead"},attributes:{requestedURL:"",form:{}}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"real page",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=[],e.baseMandatoryData=[],e.baseOptionalData=["componentVersion","componentDEVagency","componentPlatform","componentType","tradeInType","tradeInDealerType","formLeadType","formID","step","stepAmounts","formName","stepName","vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeAG","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].manufacturer","vehicle[n].name","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].range","vehicle[n].salesModel","vehicle[n].series","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].productID","iframeURL","userProfileID","userLoginStatus","userStateProvince","userLanguage","userSegment","userCountry"],e.productMandatoryData=[],e.productOptionalData=[],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedTradeInType=["with dropdown","without dropdown"],e.allowedEventEffects=["cancel","delete","skip","discard vehicle and skip","discard vehicle and re-enter","continue with this vehicle","enter new vehicle","continue to dealer locator","continue with another vehicle","continue with valid vehicle","continue with expired vehicle"],e.allowedCtaTarget=["cancel","login and evaluation via license plate","login and evaluation via vehicle identification number","login and evaluation via mybmw","evaluation via model tree and login later","evaluation via vehicle identification number","evaluation via model tree","evaluation via mybmw","evaluation via license plate","evaluation via free text","evaluation via garage","skip","stock locator","start trade-in","discard vehicle and skip","continue with this vehicle","enter new vehicle","show more"],e.allowedLinkLocation=["tradein_general_all_optionselect","tradein_dcs_all_reentry","tradein_dcs_all_start","tradein_general_all_result","tradein_general_garage_result","tradein_general_all_result_dlo","tradein_general_garage_result_dlo","tradein_garage_all_vehicledetails","tradein_garage_all_overview"],e.allowedEstimateTypes=["trade-in price estimate available","trade-in price estimate not available"],e.allowedPageSubCat1=e.allowedFormNames=["evaluation via free text","evaluation via garage","evaluation via license plate","evaluation via model tree","evaluation via mybmw","evaluation via vehicle identification number"],e.allowedTradeInDealerTypes=["not selected","user selected (piloted)","user selected (non-piloted)"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedFormTypes=["campaign","online tda","registration","rfa","rfc","rfd","rfi","rfo","rfs","roi","tda","fs rfo","rfp","rft","sws","vco","evt"],e.allowedFormOrigins=["local form","adobe form","custom central form","custom local form"],e.allowedFormVariants=["dedicated form","combo form"],e.allowedFormLeadTypes=["lead","handraiser","generic","configurator","visualizer","stock locator","showroom","direct","campaign","wish list","shopping cart"],e.allowedMappedVehiclesCount=["value should be numeric"],e.allowedStep=["value should be numeric"],e.allowedStepAmounts=["value should be numeric"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedStep=[1,2,3,4,5,6,7,8,9,10,"results"]},events:function(e){e.events||(e.events={});const t="tradeIn";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{tradeInFormStart:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"form started",eventAction:"page load",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["stepName","formName","componentType"]),optionalData:e.baseOptionalData.filter((e=>!["formName","stepName","componentType"].includes(e))).concat(["mappedVehiclesCount","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion"]),description:'Form started should be triggered on every page load of the page where the form is located, independently from the form step. <br />\n        In multi-step forms with multiple real pages, all the pages together are considered as one form. So form started should only be triggered on the first page loaded and not on subsequent page loads when the user changes from one to another form page. Form started must be triggered again, when the user leaves the form pages completely and then loads one of the form pages again.\n        <br><br>\n        For trade-in the form funnel starts after the evaluation method has been selected - after the screenID: tradein_general_all_optionselect. \n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom or digital checkout solutions) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},tradeInFormFirstInteraction:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"form first interaction"})},mandatoryData:e.baseMandatoryData.concat(["stepName","formName","componentType"]),optionalData:e.baseOptionalData.filter((e=>!["formName","stepName","componentType"].includes(e))).concat(["eventAction","mappedVehiclesCount","eventPoints"]),description:"First form interaction should be triggered once when the user starts typing (onchange) or selects an option (onchange) after the form started event. The form page load or prefilled fields are not considered as first interaction."},tradeInFormInteraction:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on ",eventName:"interaction",type:"ux",eventAction:"internal click"})},mandatoryData:e.baseMandatoryData.concat(["eventEffect","stepName","formName","componentType"]),optionalData:e.baseOptionalData.filter((e=>!["formName","stepName","componentType"].includes(e))).concat(["eventAction","requestedURL","mappedVehiclesCount","estimateType","eventPoints","eventSubCat1"]),description:'Trigger this whenever the user has started the trade-in form funnel and then clicks on button.\n        <br> eventEffect could be eg. "cancel", "skip", "discard vehicle and skip", "discard vehicle and re-enter", "continue with this vehicle", "enter new vehicle" '},tradeInStep:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"form step"})},mandatoryData:e.baseMandatoryData.concat(["step","stepName","formName","componentType"]),optionalData:e.baseOptionalData.filter((e=>!["formName","componentType"].includes(e))).concat(["mappedVehiclesCount","estimateType","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion"]).filter((e=>!["step","stepName"].includes(e))),description:'Form step should be triggered every time the user lands on a form step. Make sure to provide the current step number as well as the total amounts of step - not counting the thank you page as step. Everytime the user jumps back or forth the form step may be triggered to understand how the user moves through the form funnel.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom or digital checkout solutions) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},tradeInFormFinishIntention:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"form finish intention"})},mandatoryData:e.baseMandatoryData.concat(["estimateType","stepName","formName","componentType"]),optionalData:e.baseOptionalData.filter((e=>!["formName","stepName","componentType"].includes(e))).concat(["formComChannel","eventPoints"]),description:'Trigger this when the user successfully went through all steps unti (s)he reaches the trade-in value results screen and then clicks on "save and continue" button'},tradeInFormFinished:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"form",effect:"form finished",eventAction:"page load",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["estimateType","formName","stepName","componentType"]),optionalData:e.baseOptionalData.concat(["formComChannel","eventPoints","pageBrand","pageGeoRegion","pageLanguage","pageSubCat2","pageSubCat3","pageVariant","pageVersion"]).filter((e=>!["componentType","formName","step","stepAmounts","stepName"].includes(e))),description:'Form finished should be triggered once on the page/screen load of the thank you page after a successful response was received from the CRM system. A form is considered finished once it has been sent to the backend system successfully. In case there is no feedback from the backend system form finish triggers on successful form submit without error message. Local forms in iframes usually trigger form finish when showing a “thank you” message to the visitor. If the user returns to or reloads the page/screen do not trigger form finished again, but trigger form step instead.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'formID\'</b> is used to capture an ID that is unique to the specific form and user and model. </li>\n        <li><b>\'formName\'</b> is used to differentiate forms of the same type. Some sample values are "tda with map", "keep me informed", "download" etc.</li>\n        <li><b>\'step\'</b> is used to capture the number of the step you are currently in </li>\n        <li><b>\'stepName\'</b> is used- to capture the step name in a multi-step form funnel </li>\n        <li><b>\'stepAmounts\'</b> is used to capture the total number of steps available in this specific form funnel (not counting the thank you page) </li>\n        <li><b>\'componentType\'</b> is used to differentiate if the formStarted, formStep and formFinished functions should be treated as page view server call or as event server call, meaning page information must be provided upfront by the parent page. If the form component is the only component on the page (besides the header and footer) then choose "standalone" or "standalone iframe" respectively. In case the form component is just one of many components on the same page (eg. embedded in showroom or digital checkout solutions) then choose "native in-page" or "in-page iframe" respectively.</li> \n        <p>In case you choose "standalone" or "standalone iframe" as componentType, please provide the below page parameters as well: </p>\n            <ul> \n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global" </li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase; </li>\n            <li><b>\'pageVariant\'</b> is used to differentiate "real page" from "virtual page"  </li>\n            </ul>\n        </ul>'},tradeInFormStartIntention:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on ",eventName:"interaction",eventAction:"form start intention",type:"ux"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget","linkLocation"]),optionalData:e.baseOptionalData.concat([,"eventPoints"]).filter((e=>!["formName","tradeInType","formLeadType","formID","step","stepAmounts","stepName"].includes(e))),description:'Trigger this event whenever the user is outside the trade-in form funnel on select screen and clicks on evaluation method to enter the form funnel.\n        <br> ctaTarget could be eg. "evaluation via vehicle identification number", "evaluation via model tree", "evaluation via myBMW", "evaluation via license plate", "evaluation via free text", "evaluation via garage" and linkLocation is the screenID (eg. "tradein_general_all_optionselect")'},tradeInCTAinternal:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on ",eventName:"interaction",eventAction:"internal click",type:"ux"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget","linkLocation"]),optionalData:e.baseOptionalData.concat([,"eventPoints"]).filter((e=>!["formName","tradeInType","formLeadType","formID","step","stepAmounts","stepName"].includes(e))),description:'Trigger this event whenever the user is outside the trade-in form funnel (eg. on select screen) and clicks any link that navigates the user to a different screen inside the trade-in (eg. on re-entry screen.)\n        <br> ctaTarget could be eg. "enter new vehicle" and linkLocation is the screenID eg ""tradein_dcs_all_reentry"'},tradeInCTAoutbound:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on ",eventName:"interaction",eventAction:"outbound click",type:"ux"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget","requestedURL","linkLocation"]),optionalData:e.baseOptionalData.concat([,"eventPoints"]).filter((e=>!["formName","tradeInType","formLeadType","formID","step","stepAmounts","stepName"].includes(e))),description:'Trigger this event whenever the user is outside the trade-in form funnel (eg. on select screen) and clicks any link that directs the user to another component outside the trade-in (eg. digital checkout solution, stock locator, etc.)\n        <br> ctaTarget could be eg. "skip" and linkLocation is the screenID'},tradeInScreenLoad:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user saw the screen ",eventName:"interaction",eventAction:"component load",cause:"automatic",type:"ux"})},mandatoryData:e.baseMandatoryData.concat(["linkLocation"]),optionalData:e.baseOptionalData.concat(["estimateType","eventPoints"]).filter((e=>!["formName","tradeInType","formLeadType","formID","step","stepAmounts","stepName"].includes(e))),description:"Trigger this event after the user decided to start a trade-In, and the select screen with all offered valuation methods is displayed"}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(window.location.href.indexOf("/dcs/")>-1&&(prefix="sales >"),"undefined"==mandatoryData.componentType&&(mandatoryData.componentType="native in-page"),void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let r=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(r))return void this._throwError("m","UserLoginStatus","incorrect",this.allowedUserLoginStatus);mandatoryData.userLoginStatus=r}if(mandatoryData&&mandatoryData.formName&&void 0!==mandatoryData.formName){let s=mandatoryData.formName;if(!this.allowedFormNames.includes(s))return void this._throwError("m","formName","incorrect",this.allowedFormNames);mandatoryData.formName=s}if(mandatoryData&&mandatoryData.tradeInType&&void 0!==mandatoryData.tradeInType){let c=mandatoryData.tradeInType;if(!this.allowedTradeInType.includes(c))return void this._throwError("m","tradeInType","incorrect",this.allowedTradeInType);mandatoryData.tradeInType=c}if(mandatoryData&&mandatoryData.mappedVehiclesCount&&void 0!==mandatoryData.mappedVehiclesCount){let l=mandatoryData.mappedVehiclesCount;if("number"==(parseInt(l,10),!1))return void this._throwError("m","mappedVehiclesCount","incorrect",this.allowedMappedVehiclesCount);mandatoryData.mappedVehiclesCount=l}if(mandatoryData&&mandatoryData.ctaTarget&&void 0!==mandatoryData.ctaTarget){let d=mandatoryData.ctaTarget;if(!this.allowedCtaTarget.includes(d))return void this._throwError("m","ctaTarget","incorrect",this.allowedCtaTarget);mandatoryData.ctaTarget=d}if(mandatoryData&&mandatoryData.linkLocation&&void 0!==mandatoryData.linkLocation){let m=mandatoryData.linkLocation;if(!this.allowedLinkLocation.includes(m))return void this._throwError("m","linkLocation","incorrect",this.allowedLinkLocation);mandatoryData.linkLocation=m}if(mandatoryData&&mandatoryData.estimateType&&void 0!==mandatoryData.estimateType){let u=mandatoryData.estimateType;if(!this.allowedEstimateTypes.includes(u))return void this._throwError("m","estimateType","incorrect",this.allowedEstimateTypes);mandatoryData.estimateType=u}if(mandatoryData&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect){let p=mandatoryData.eventEffect;if(!this.allowedEventEffects.includes(p))return void this._throwError("m","eventEffect","incorrect",this.allowedEventEffects);mandatoryData.eventEffect=p}if(void 0!==mandatoryData.step&&(mandatoryData.step=isNaN(mandatoryData.step)?mandatoryData.step.toLowerCase():+mandatoryData.step),void 0!==mandatoryData.step){let g=mandatoryData.step;if(!this.allowedStep.includes(g)){if(this.events[eventName].mandatoryData.indexOf("step")>-1){let h="string"==typeof g&&0==g.trim().length?"empty":"incorrect";return void this._throwError("m","step",h,this.allowedStep)}{let v=("string"==typeof g&&g.trim().length,"incorrect-o");this._throwError("o","step",v,this.allowedStep),mandatoryData.step=""}}}"interaction"==this.message.event[0].eventInfo.eventName&&void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=mandatoryData.linkLocation);let effectString=this.message.event[0].eventInfo.effect;if(void 0!==effectString&&effectString.includes("user saw the screen")&&(mandatoryData.linkLocation,1)&&void 0!==mandatoryData.linkLocation&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.linkLocation),"interaction"==this.message.event[0].eventInfo.eventName&&void 0!==mandatoryData.ctaTarget&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget),void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=mandatoryData.userLoginStatus),"tradeInFormStart"!=eventName&&"tradeInFormFirstInteraction"!=eventName&&"tradeInStep"!=eventName&&"tradeInFormInteraction"!=eventName&&"tradeInFormFinishIntention"!=eventName&&"tradeInFormFinished"!=eventName&&"error"!=eventName||(void 0===mandatoryData.formType&&(mandatoryData.formType="rft"),void 0===mandatoryData.formLeadType&&(mandatoryData.formLeadType="lead"),void 0===mandatoryData.formVariant&&(mandatoryData.formVariant="dedicated form"),void 0===mandatoryData.formOrigin&&(mandatoryData.formOrigin="custom central form")),"tradeInFormStartIntention"!=eventName&&"tradeInCTAinternal"!=eventName&&"tradeInCTAoutbound"!=eventName&&"tradeInScreenLoad"!=eventName&&"tradeInPageLoad"!=eventName&&"tradeInPageLoadError"!=eventName||void 0===mandatoryData.eventSubCat1&&(mandatoryData.eventSubCat1="rft"),void 0!==mandatoryData){try{this._validateProperty("formOrigin",this.allowedFormOrigins,eventName,mandatoryData,!0)}catch(y){return!1}try{this._validateProperty("formVariant",this.allowedFormVariants,eventName,mandatoryData,!0)}catch(f){return!1}if(void 0!==mandatoryData&&"string"==typeof mandatoryData.formType){let b=mandatoryData.formType.trim();if(0==b.length){let w=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(w,"formType","l-empty",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===w)mandatoryData.formType="";else if("m"==w)return}let D=b.split("~");var isValid=!0;for(var i in D)if(this.allowedFormTypes.indexOf(D[i].trim())<0){isValid=!1;break}if(!isValid){let N=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o";if(this._throwError(N,"formType","l-incorrect",this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"==N)mandatoryData.formType="";else if("m"==N)return}}else if(void 0!==mandatoryData.formType){let O=this.events[eventName].mandatoryData.indexOf("formType")>-1?"m":"o",I=mandatoryData.formType,T="string"==typeof I&&0===I.trim().length?"empty":"l-incorrect";if(this._throwError(O,"formType",T,this.allowedFormTypes,"or provide a combination of the values separated by '~'  e.g. 'tda~online tda'"),"o"===O)mandatoryData.formType="";else if("m"==O)return}if(void 0!==mandatoryData&&void 0!==mandatoryData.formLeadType&&"string"==typeof mandatoryData.formLeadType){var returnValueFormLeadType=mandatoryData.formLeadType.split("-"),returnFlagFormLeadType=!0;for(var i in returnValueFormLeadType)this.allowedFormLeadTypes.indexOf(returnValueFormLeadType[i].trim())<0&&(returnFlagFormLeadType=!1);if(returnValueFormLeadType.length>1&&["lead","handraiser","generic"].indexOf(returnValueFormLeadType[0].trim())<0&&(returnFlagFormLeadType=!1),0==returnFlagFormLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1)return void this._throwError("m","formLeadType","incorrect",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)");this._throwError("o","formLeadType","incorrect-o",this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}else if(void 0!==mandatoryData.formLeadType){if(this.events[eventName].mandatoryData.indexOf("formLeadType")>-1){let A="string"==typeof mandatoryData.formLeadType&&0==mandatoryData.formLeadType.trim().length?"empty":"incorrect";return void this._throwError("m","formLeadType",A,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)")}{let C=("string"==typeof mandatoryData.formLeadType&&mandatoryData.formLeadType.trim().length,"incorrect-o");this._throwError("o","formLeadType",C,this.allowedFormLeadTypes,"(for lead type  = 'lead', 'handraiser' or 'generic'.  Or  provide a  combination of lead type with lead origin separated by '-' eg. 'lead - configurator'. Following values are allowed)"),mandatoryData.formLeadType=""}}if(void 0!==mandatoryData.step&&1==this.allowedStep.length&&"value should be numeric"==this.allowedStep[0]&&void 0!==mandatoryData.step&&"number"!=typeof mandatoryData.step){if(this.events[eventName].mandatoryData.indexOf("step")>-1)return void this._throwError("m","step","incorrect-numeric","");this._throwError("o","step","incorrect-numeric",""),mandatoryData.step=""}if(void 0!==mandatoryData.stepAmounts&&"number"!=typeof mandatoryData.stepAmounts){if(this.events[eventName].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","stepAmounts","incorrect-numeric","");this._throwError("o","stepAmounts","incorrect-numeric",""),mandatoryData.stepAmounts=""}void 0!==mandatoryData.formType&&mandatoryData.formType.indexOf("~")>-1&&(mandatoryData.formType=mandatoryData.formType.split("~").sort().join("~")),void 0!==mandatoryData.formID&&(this.message.event[0].attributes.form.rfxID=gFFWNV([()=>(mandatoryData.formID||"").toUpperCase()])),void 0!==mandatoryData.formComChannel&&(this.message.event[0].attributes.form.preferredComChannel=gFFWNV([()=>mandatoryData.formComChannel])),void 0!==mandatoryData.formVariant&&(this.message.event[0].attributes.form.formVariant=gFFWNV([()=>mandatoryData.formVariant])),void 0!==mandatoryData.stepName&&(this.message.event[0].attributes.stepName=gFFWNV([()=>mandatoryData.stepName])),void 0!==mandatoryData.formName&&(this.message.event[0].attributes.form.formName=gFFWNV([()=>mandatoryData.formName])),void 0!==mandatoryData.formType&&(this.message.event[0].attributes.form.formType=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formLeadType&&(this.message.event[0].attributes.form.formLeadType=gFFWNV([()=>mandatoryData.formLeadType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].attributes.form.formOrigin=gFFWNV([()=>mandatoryData.formOrigin])),this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1,()=>mandatoryData.errorCode,()=>mandatoryData.formName,()=>this.message.event[0].category.subCategory1]),this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation,()=>mandatoryData.errorOrigin,()=>mandatoryData.formLeadType,()=>this.message.event[0].category.subCategory2]),"formStep"!=eventName&&"tradeInStep"!=eventName||void 0!==mandatoryData.step&&(this.message.event[0].eventInfo.effect="form step "+(mandatoryData.step||"")),("form started"==this.message.event[0].eventInfo.effect||"form first interaction"==this.message.event[0].eventInfo.effect||this.message.event[0].eventInfo.effect.includes("form step")||"form finish intention"==this.message.event[0].eventInfo.effect||"form finished"==this.message.event[0].eventInfo.effect)&&(this.message.event[0].attributes.form.step=gFFWNV([()=>this.message.event[0].eventInfo.effect])),"formInteraction"!=eventName&&"tradeInFormInteraction"!=eventName||void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),"form"==this.message.event[0].eventInfo.eventName&&(void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>mandatoryData.eventEffect])),void 0!==mandatoryData.formType&&(this.message.event[0].eventInfo.type=gFFWNV([()=>mandatoryData.formType])),void 0!==mandatoryData.formOrigin&&(this.message.event[0].category.primaryCategory=gFFWNV([()=>mandatoryData.formOrigin])))}"standalone"!=this.message.component[0].category.componentType&&"standalone iframe"!=this.message.component[0].category.componentType||("formStarted"!=eventName&&"tradeInFormStart"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form started",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formStep"!=eventName&&"tradeInStep"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form step "+mandatoryData.step,this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request details",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" details",this.message.page.category.pageType="form",void 0!==mandatoryData.stepName&&(this.message.page.pageInfo.pageName=gFFWNV([()=>this.message.page.pageInfo.pageName+": "+mandatoryData.stepName]))),"formFinished"!=eventName&&"tradeInFormFinished"!=eventName||(this.message.event[0].eventInfo.eventName="page view",this.message.event[0].eventInfo.effect="form finished",this.message.event[0].eventInfo.type="success",this.message.page.category.primaryCategory=mandatoryData.formOrigin,this.message.page.category.subCategory1="request success",this.message.page.pageInfo.pageName="rfx > "+mandatoryData.formType+" success",this.message.page.category.pageType="form"));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let S=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=S.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(k){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let F=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let x of F)if("totalCurrency"==x){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let P="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",P,"","(has to follow ISO 3-letter currency code all upper case)")}{let V=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",V,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[x],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(x)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(x),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(x)>-1)return void variable._throwError("m",x,flagDetermine,"");variable._throwError("o",x,flagDetermine,""),mandatoryData[x]=""}else mandatoryData[x]=convertToNumeric(mandatoryData[x]),mandatoryData[x]=roundToDecimal(mandatoryData[x],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(W){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(_){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let E="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",E,this.allowedPageGeoRegion)}{let L=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",L,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let R="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",R,"","(has to follow ISO standard of 2 letters in uppercase)")}{let j=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",j,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let M=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(M)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=M}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}if(void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion])),"tradeInFormInteraction"==eventName&&(this.message.event[0].eventInfo.effect="user clicked on "+mandatoryData.eventEffect),void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.estimateType&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.estimateType])),void 0!==mandatoryData.mappedVehiclesCount&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.mappedVehiclesCount])),void 0!==mandatoryData.tradeInType&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.tradeInType])),void 0!==mandatoryData.tradeInDealerType&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.tradeInDealerType])),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let J=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(J)){let B="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",B,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=J}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let G="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)")}{let $=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",$,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let U="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",U,this.alloweduserCountry)}{let q=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",q,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(H){return!1}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let K,z,Q;if(K=z=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(Q=this.message.cart.item.length-1;Q>=0;Q--){let X=!1;void 0!==this.message.cart.item[Q]&&void 0!==this.message.cart.item[Q].price&&(void 0!==this.message.cart.item[Q].price.basePrice&&void 0!==this.message.cart.item[Q].price.basePrice&&this.message.cart.item[Q].price.basePrice>0||void 0!==this.message.cart.item[Q].price.priceWithTax&&void 0!==this.message.cart.item[Q].price.priceWithTax&&this.message.cart.item[Q].price.priceWithTax>0)&&(X=!0);let Z=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(Z=!0));let ee=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;X||Z||X||Z||ee?ee&&this.message.cart.item.splice(Q,1):this.message.cart.item.splice(Q,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(Q=this.message.transaction.item.length-1;Q>=0;Q--){let te=!1;void 0!==this.message.transaction.item[Q]&&void 0!==this.message.transaction.item[Q].price&&(void 0!==this.message.transaction.item[Q].price.basePrice&&void 0!==this.message.transaction.item[Q].price.basePrice&&this.message.transaction.item[Q].price.basePrice>0||void 0!==this.message.transaction.item[Q].price.priceWithTax&&void 0!==this.message.transaction.item[Q].price.priceWithTax&&this.message.transaction.item[Q].price.priceWithTax>0)&&(te=!0);let ae=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ae=!0));let oe=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;te||ae?oe||this.message.transaction.item.splice(Q,1):!oe||te||ae||this.message.transaction.item.splice(Q,1),""!=(((this.message.transaction.item[Q]||"").productInfo||"").productID||"")&&K.indexOf(this.message.transaction.item[Q].productInfo.productID)>-1&&this.message.transaction.item.splice(Q,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&z.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(Q=this.message.product.length-1;Q>=0;Q--){let ie=!1;void 0!==this.message.product[Q]&&void 0!==this.message.product[Q].price&&(void 0!==this.message.product[Q].price.basePrice&&void 0!==this.message.product[Q].price.basePrice&&this.message.product[Q].price.basePrice>0||void 0!==this.message.product[Q].price.priceWithTax&&void 0!==this.message.product[Q].price.priceWithTax&&this.message.product[Q].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(ne=!0));let re=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ie&&this.message.product.splice(Q,1),!ne||re||ie||(K.indexOf(this.message.product[Q].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[Q]),this.message.product.splice(Q,1)),ne&&re&&(z.indexOf(this.message.product[Q].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[Q]),this.message.product.splice(Q,1)),""!=(((this.message.product[Q]||"").productInfo||"").productID||"")&&(K.indexOf(this.message.product[Q].productInfo.productID)>-1||z.indexOf(this.message.product[Q].productInfo.productID)>-1)&&this.message.product.splice(Q,1)}function Y(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let se=0;Object.keys(this.message.cart.item).forEach((e=>{se+=(e.price||0).basePrice||0})),se=this.roundToDecimal(se,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>se,()=>0])||0),this.message.cart.price.discountAmountAdditional=Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let ce=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ce+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ce+=e.price.discountAmountOther||0)})),ce=this.roundToDecimal(ce,2),this.message.cart.price.discountItemAmounts=Y(this.roundToDecimal(ce,2)),this.message.cart.price.discountAmountSum=Y(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let le=0;Object.keys(this.message.cart.item).forEach((e=>{le+=(e.price||0).taxAmount||0})),le=this.roundToDecimal(le,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(le,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let de=0;Object.keys(this.message.transaction.item).forEach((e=>{de+=(e.price||0).basePrice||0})),de=this.roundToDecimal(de,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>de,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let me=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(me+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(me+=e.price.discountAmountOther||0)})),me=this.roundToDecimal(me,2),this.message.transaction.total.discountItemAmounts=Y(this.roundToDecimal(me,2)),this.message.transaction.total.discountAmountSum=Y(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ue=0;Object.keys(this.message.transaction.item).forEach((e=>{ue+=(e.price||0).taxAmount||0})),ue=this.roundToDecimal(ue,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ue,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},3683:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=window.TRON.version.split("¦");e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: visualizer",libraryName:"visualizer",libraryVersion:"_v9.2.3",prefix:"con > ",pageExist:!0,vehicle:{productType:"new vehicle",primaryCategory:"new car",subCategory1:"build to order"},options:{productType:"new vehicle"}};var __WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"configurator",subCategory1:"new car configurator"},componentInfo:{componentName:"visualizer",componentID:"visualizer"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName","componentVersion"],e.baseOptionalData=["componentDEVagency","componentPlatform","userProfileID","userLoginStatus","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=["vehicle[n].range","vehicle[n].name","vehicle[n].codeAG","vehicle[n].series","vehicle[n].manufacturer"],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].salesModel","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedPageSubCat1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels"],e.allowedComponentNames=["rolls-royce visualizer","visualizer","bmw individual visualizer","mini uk visualiser","visualizer trim"],e.allowedSections=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","exterior highlights","interior highlights","packages","roof and mirror caps","upholstery","wheels","winter wheels","series"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration","generic new vehicle"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer","other"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},events:function(e){e.events||(e.events={});const t="visualizer";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.baseMandatoryData.filter((e=>!["pageBrand","pageGeoRegion","pageLanguage","pageName","pageSubCat1","pageVariant"].includes(e))).concat(["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseOptionalData.filter((t=>(e.baseMandatoryData,!["stepName","pageType","pageBrand","pageGeoRegion","pageLanguage","pageName","componentDEVagency"].includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>\n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn\'t add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints","eventSubCat1"]),description:'Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it\'s actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>\'listType\'</b> is used to capture the kind of list eg "wish list" or "compare list". Check allowed value for details.</li>\n    </ul>'},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"OpenContent").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:" shown",eventAction:"content opened",type:"ux",cause:"default",eventName:"interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["eventEffect"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventSubCat1","linkLocation","eventCause","eventAction"]),description:'Trigger this event whenever a small window (eg. pop-up) or banner appears in the foreground while browsing a website.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li> \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'eventEffect\'</b> describes the small window (eg. pop-up) or banner that appeared. The vallue will be shown in the eVar34 as "[prefix] > \'eventEffect\' shown"</li>\n    <li><b>\'eventSubCat1\'</b> may be used to group certain event effects.</li>\n    <li><b>\'linkLocation\'</b> may be used to capture additional information about the event.</li>\n    <li><b>\'eventCause\'</b> = "automatic" in case the content opened automatically. <i>If the user clicked on something to open the content do not set this parameter. In that case the default value "default" is set by the TRON code.</i></li>\n    <li><b>\'eventAction\'</b> is used to capture events such as "content opened" and "content visible". <br/><i>"content opened"</i> is used for open accordions, pop-ups etc. <br /> <i>"content visible"</i> is used for impression tracking. </li>\n    </ul>'},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},[(t+"ChangeConfiguration").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"]),optionalData:e.baseOptionalData.concat(e.productOptionalData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["eventAction","eventCause","eventPoints","linkLocation"]),description:"Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li> \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li><b>'pageSubCat1'</b> is used to capture the page section that is in the view port </li>\n        <li><b>'pageSubCat3'</b> is used if you select \"other\" in <b>'pageSubCat1'</b> because none of the pageSubCat1 allowed values matches your value. So you provide the value passed by markets/authors in pageSubCat3 .</li>\n        <li><b>'options[n].category1'</b> is used to capture the category of the the option/product with which the user interacts. It must not necessarily be the same as the page section in the view port.</li>\n        <li><b>'options[n].category3'</b> is used if you select \"other\" in <b>'options[n].category1'</b> because none of the category1 allowed values matches your value. So you provide the value passed by markets/authors in options[n].category3 .</li>\n        </ul>"},visualizerTab:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"visualizer tab bar navigation"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["section"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventPoints"]),description:'🆕 <i style="color:darkblue"> <b>Don\'t use this function in new implementations anymore. And if you are updating your tracking at the moment, ideally immediately update to the generic function name</b>. This will be moved into a generic code snippet with function name <b>"visualizerClick" </b>with next major release. You would then pass the string value you currently pass in \'section\' in the parameter \'ctaTarget\' to state on what the user clicked. and you could then use the parameter \'eventSubCat1\' with value "visualizer tab bar navigation" so you can still group all those tab clicks.</i>\n        <br><br>\n        Trigger when the user clicks on a tab within the visualizer. Please provide the respective tab in the parameter "section" dynamically. \n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        </ul>'},visualizerChange:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"visualizer configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["section"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventAction","eventCause","eventPoints"]),description:"🆕 <i style=\"color:darkblue\"> <b>Don't use this function in new implementations anymore. And if you are updating your tracking at the moment, ideally immediately update to the generic function name</b>. This will be moved into a generic code snippet with function name <b>\"visualizerChangeConfiguration\" </b>with next major release.</i>\n        <br><br>\n        Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        </ul>"}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);let t=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in t)this[t[e]]=this[t[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),window.TRON.currentEventName=eventName,window.TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,window.TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(window.TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(window.TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+mandatoryData.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||window.TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),mandatoryData&&mandatoryData.section&&void 0!==mandatoryData.section){let r=mandatoryData.section;if(!this.allowedSections.includes(r))return void this._throwError("m","section","incorrect",this.allowedSections);mandatoryData.section=r}if(void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(s){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(c){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(d){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(m){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes(" shown")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=mandatoryData.eventEffect+this.message.event[0].eventInfo.effect),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(u){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(p){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let g="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",g,this.allowedPageGeoRegion)}{let h=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",h,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let v="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",v,"","(has to follow ISO standard of 2 letters in uppercase)")}{let y=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",y,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&(void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1)){let f=mandatoryData.pageSubCat1;if(void 0!==this.allowedPageSubCat1&&this.allowedPageSubCat1.length>0&&!this.allowedPageSubCat1.includes(f)){if(this.events[eventName].mandatoryData.indexOf("pageSubCat1")>-1)return void this._throwError("m","pageSubCat1","incorrect",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)");this._throwError("o","pageSubCat1","incorrect-o",this.allowedPageSubCat1,"(or a comma separated combination of any of those values)"),mandatoryData.pageSubCat1=""}else mandatoryData.pageSubCat1=f}function checkParamExist(e,t){return e.events[eventName].mandatoryData.indexOf(t)>-1||e.events[eventName].optionalData.indexOf(t)>-1}void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,"page view"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName,void 0!==mandatoryData.pageSubCat1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+mandatoryData.pageSubCat1),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" shown")),void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&checkParamExist(this,"pageBrand")&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&checkParamExist(this,"pageSubCat1")&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&checkParamExist(this,"pageSubCat2")&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&checkParamExist(this,"pageSubCat3")&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&checkParamExist(this,"pageType")&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&checkParamExist(this,"componentDEVagency")&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&checkParamExist(this,"pageGeoRegion")&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&checkParamExist(this,"pageLanguage")&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),void 0===mandatoryData.pageName&&(checkParamExist(this,"pageName")||void 0!==this.message.page.pageInfo.pageName&&"tbd"!=this.message.page.pageInfo.pageName)&&(this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName),this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&checkParamExist(this,"pageSysEnv")&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVariant")&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>void 0!==mandatoryData.pageVariant&&checkParamExist(this,"pageVersion")&&mandatoryData.pageVersion,()=>mandatoryData.componentVersion]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let b=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=b.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(D){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+ ++productIDGenerate]),e.builtId=t.productInfo.productID,t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let w=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let N of w)if("totalCurrency"==N){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let O="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",O,"","(has to follow ISO 3-letter currency code all upper case)")}{let I=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",I,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[N],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(N)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(N),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(N)>-1)return void variable._throwError("m",N,flagDetermine,"");variable._throwError("o",N,flagDetermine,""),mandatoryData[N]=""}else mandatoryData[N]=convertToNumeric(mandatoryData[N]),mandatoryData[N]=roundToDecimal(mandatoryData[N],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let T="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",T,variable.allowedOptionscodeVG)}{let A=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",A,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let C="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",C,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let S=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",S,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let k="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",k,variable.allowedOptionsCategory1,"")}{let F=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",F,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let x="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",x,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let P=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",P,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let V=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=V.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+ ++optionIdGenerate]),e.builtId=t.productInfo.productID,t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){let W=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(let _ of W)if("totalCurrency"==_){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let E="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",E,"","(has to follow ISO 3-letter currency code all upper case)")}{let L=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",L,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[_],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(_)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(_),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(_)>-1)return void variable._throwError("m",_,flagDetermine,"");variable._throwError("o",_,flagDetermine,""),mandatoryData[_]=""}else mandatoryData[_]=convertToNumeric(mandatoryData[_]),mandatoryData[_]=roundToDecimal(mandatoryData[_],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID||e.builtId]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>mandatoryData.totalTaxAmount,()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let R=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(R)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let j="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",j,this.allowedFilterObjects)}{let M=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",M,this.allowedFilterObjects)}}mandatoryData.filterObject=R}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1).trim()])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==mandatoryData.eventSubCat2&&(this.message.event[0].category.subCategory2=mandatoryData.eventSubCat2),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=eventName&&"stockFilterSelected"!=eventName&&"shopFilterSelected"!=eventName&&"compareFilterSelected"!=eventName&&"visualizerFilterSelected"!=eventName||void 0!==mandatoryData.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(mandatoryData.searchFilterSelectionState||"")),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let J=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(J)){let B="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",B,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=J}if(void 0!==mandatoryData&&void 0!==mandatoryData.userLanguage)if(2!=mandatoryData.userLanguage.length){if(this.events[eventName].mandatoryData.indexOf("userLanguage")>-1){let G="string"==typeof mandatoryData.userLanguage&&0==mandatoryData.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",G,"","(has to follow ISO standard of 2 letters in uppercase)")}{let $=("string"==typeof mandatoryData.userLanguage&&mandatoryData.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",$,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.userLanguage=""}}else mandatoryData.userLanguage=(mandatoryData.userLanguage||"").toLowerCase();if(void 0!==mandatoryData&&void 0!==mandatoryData.userCountry)if(2==mandatoryData.userCountry.length)mandatoryData.userCountry=(mandatoryData.userCountry||"").toUpperCase();else if(mandatoryData.userCountry=(mandatoryData.userCountry||"").toLowerCase(),!["global"].includes(mandatoryData.userCountry)){if(this.events[eventName].mandatoryData.indexOf("userCountry")>-1){let U="string"==typeof mandatoryData.userCountry&&0==mandatoryData.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",U,this.alloweduserCountry)}{let q=("string"==typeof mandatoryData.userCountry&&mandatoryData.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",q,this.alloweduserCountry),mandatoryData.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,eventName,mandatoryData)}catch(H){return!1}void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),void 0!==mandatoryData.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=gFFWNV([()=>mandatoryData.userStateProvince])),void 0!==mandatoryData.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=gFFWNV([()=>mandatoryData.userCountry])),void 0!==mandatoryData.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=gFFWNV([()=>mandatoryData.userLanguage])),void 0!==mandatoryData.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=gFFWNV([()=>mandatoryData.solutionSpecific1])),void 0!==mandatoryData.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=gFFWNV([()=>mandatoryData.solutionSpecific2])),void 0!==mandatoryData.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=gFFWNV([()=>mandatoryData.solutionSpecific3])),void 0!==mandatoryData.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=gFFWNV([()=>mandatoryData.solutionSpecific4])),void 0!==mandatoryData.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=gFFWNV([()=>mandatoryData.solutionSpecific5])),void 0!==mandatoryData.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=gFFWNV([()=>mandatoryData.solutionSpecific6])),void 0!==mandatoryData.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=gFFWNV([()=>mandatoryData.solutionSpecific7])),void 0!==mandatoryData.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=gFFWNV([()=>mandatoryData.solutionSpecific8])),void 0!==mandatoryData.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=gFFWNV([()=>mandatoryData.solutionSpecific9])),void 0!==mandatoryData.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=gFFWNV([()=>mandatoryData.solutionSpecific10]));var category1Value="";if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0){for(var i in mandatoryData.options)if(void 0!==mandatoryData.options[i].category1&&"configuration change"==this.message.event[0].category.subCategory1){category1Value=gFFWNV([()=>mandatoryData.options[0].category1]);break}""!=category1Value&&(this.message.event[0].eventInfo.effect+=category1Value)}if(mandatoryData.section&&void 0!==mandatoryData.section&&("visualizer tab bar navigation"==this.message.event[0].category.subCategory1?this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.section+" tab":"visualizer configuration change"==this.message.event[0].category.subCategory1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.section)),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&void 0!==mandatoryData.vehicle&&1==mandatoryData.vehicle.length){let K=mandatoryData.vehicle[0].range||"",z=mandatoryData.vehicle[0].rangeVG||mandatoryData.vehicle[0].range||"",Q=mandatoryData.vehicle[0].codeVG||mandatoryData.vehicle[0].codeAG||"",Y=mandatoryData.vehicle[0].hybridVersion||"";for(var i in this.message.product)void 0===this.message.product[i].attributes.bodyType&&(void 0===this.message.product[i].attributes.mmdr&&(this.message.product[i].attributes.mmdr=K.toUpperCase()),void 0===this.message.product[i].attributes.mmdrVG&&(this.message.product[i].attributes.mmdrVG=z.toUpperCase()),void 0===this.message.product[i].attributes.modelCodeVG&&(this.message.product[i].attributes.modelCodeVG=Q.toUpperCase()),void 0===this.message.product[i].attributes.hybridVersion&&(this.message.product[i].attributes.hybridVersion=Y))}if(void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),window.TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(hasUserKey||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),mandatoryData.requestedURL&&null!=mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.requestedURL),void 0!==mandatoryData.iframeURL&&(this.message.event[0].attributes.relatedURL=gFFWNV([()=>mandatoryData.iframeURL])),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if(mandatoryData.eventPoints=+mandatoryData.eventPoints,"number"!=typeof mandatoryData.eventPoints||NaN!=mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(mandatoryData.eventPoints)?void 0:+mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),void 0===mandatoryData.stepAmounts&&mandatoryData.step&&void 0!==mandatoryData.step&&(this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/x"),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let X,Z,ee;if(X=Z=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(ee=this.message.cart.item.length-1;ee>=0;ee--){let ae=!1;void 0!==this.message.cart.item[ee]&&void 0!==this.message.cart.item[ee].price&&(void 0!==this.message.cart.item[ee].price.basePrice&&void 0!==this.message.cart.item[ee].price.basePrice&&this.message.cart.item[ee].price.basePrice>0||void 0!==this.message.cart.item[ee].price.priceWithTax&&void 0!==this.message.cart.item[ee].price.priceWithTax&&this.message.cart.item[ee].price.priceWithTax>0)&&(ae=!0);let oe=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(oe=!0));let ie=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ae||oe||ae||oe||ie?ie&&this.message.cart.item.splice(ee,1):this.message.cart.item.splice(ee,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&X.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(ee=this.message.transaction.item.length-1;ee>=0;ee--){let ne=!1;void 0!==this.message.transaction.item[ee]&&void 0!==this.message.transaction.item[ee].price&&(void 0!==this.message.transaction.item[ee].price.basePrice&&void 0!==this.message.transaction.item[ee].price.basePrice&&this.message.transaction.item[ee].price.basePrice>0||void 0!==this.message.transaction.item[ee].price.priceWithTax&&void 0!==this.message.transaction.item[ee].price.priceWithTax&&this.message.transaction.item[ee].price.priceWithTax>0)&&(ne=!0);let re=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(re=!0));let se=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ne||re?se||this.message.transaction.item.splice(ee,1):!se||ne||re||this.message.transaction.item.splice(ee,1),""!=(((this.message.transaction.item[ee]||"").productInfo||"").productID||"")&&X.indexOf(this.message.transaction.item[ee].productInfo.productID)>-1&&this.message.transaction.item.splice(ee,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&Z.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(ee=this.message.product.length-1;ee>=0;ee--){let ce=!1;void 0!==this.message.product[ee]&&void 0!==this.message.product[ee].price&&(void 0!==this.message.product[ee].price.basePrice&&void 0!==this.message.product[ee].price.basePrice&&this.message.product[ee].price.basePrice>0||void 0!==this.message.product[ee].price.priceWithTax&&void 0!==this.message.product[ee].price.priceWithTax&&this.message.product[ee].price.priceWithTax>0)&&(ce=!0);let le=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(le=!0));let de=void 0!==mandatoryData.transactionID&&""!=mandatoryData.transactionID;ce&&this.message.product.splice(ee,1),!le||de||ce||(X.indexOf(this.message.product[ee].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[ee]),this.message.product.splice(ee,1)),le&&de&&(Z.indexOf(this.message.product[ee].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[ee]),this.message.product.splice(ee,1)),""!=(((this.message.product[ee]||"").productInfo||"").productID||"")&&(X.indexOf(this.message.product[ee].productInfo.productID)>-1||Z.indexOf(this.message.product[ee].productInfo.productID)>-1)&&this.message.product.splice(ee,1)}function te(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let me=0;Object.keys(this.message.cart.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>me,()=>0])||0),this.message.cart.price.discountAmountAdditional=te(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let ue=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),this.message.cart.price.discountItemAmounts=te(this.roundToDecimal(ue,2)),this.message.cart.price.discountAmountSum=te(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(this.message.cart.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(pe,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let ge=0;Object.keys(this.message.transaction.item).forEach((e=>{ge+=(e.price||0).basePrice||0})),ge=this.roundToDecimal(ge,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>ge,()=>0])||0),this.message.transaction.total.discountAmountAdditional=te(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let he=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(he+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(he+=e.price.discountAmountOther||0)})),he=this.roundToDecimal(he,2),this.message.transaction.total.discountItemAmounts=te(this.roundToDecimal(he,2)),this.message.transaction.total.discountAmountSum=te(this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ve=0;Object.keys(this.message.transaction.item).forEach((e=>{ve+=(e.price||0).taxAmount||0})),ve=this.roundToDecimal(ve,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ve,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=convertToACDL(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getFirstFunctionWithValue(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var u=m.split(">");""!=(u=(u=u.length>1?u[1]:u[0]).trim())&&"tbd"!=u&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let p={},g=e.component[0].componentInfo.componentID;p[g]=e.component[0],t.push({component:p});var h={},v=e.cart;if(v&&v.item.length>0&&"string"!=typeof v){for(let _ in v.item)if(void 0!==v.item[_]&&void 0!==v.item[_].productInfo){let E=v.item[_].productInfo.productID;void 0!==E&&(h[E]=v.item[_])}h=Object.assign({},h);for(let L in h)for(let R in e.cart.item)L==e.cart.item[R].productInfo.productID&&(h[L].price=Object.assign({},e.cart.item[R].price),h[L].quantity=e.cart.item[R].quantity);var y={item:h,price:e.cart.price,cartID:e.cart.cartID}}var f={},b=e.transaction;if(b&&b.item.length>0&&"string"!=typeof b&&void 0!==b.transactionID){for(let j in b.item)if(void 0!==b.item[j]&&void 0!==b.item[j].productInfo){let M=b.item[j].productInfo.productID;void 0!==M&&(f[M]=b.item[j])}f=Object.assign({},f);for(let J in f)for(let B in e.transaction.item)J==e.transaction.item[B].productInfo.productID&&(f[J].price=Object.assign({},e.transaction.item[B].price),f[J].quantity=e.transaction.item[B].quantity);var D={item:f,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(let G in O)if(void 0!==O[G]&&void 0!==O[G].dealerInfo){var I=O[G].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[G])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(let U in S){var k,F={};if(Array.isArray(S[U].profile)&&S[U].profile.length>0)for(let q in S[U].profile){var x=null!=S[U].profile[q].profileInfo.profileID?S[U].profile[q].profileInfo.profileID:"profile"+(+q+1);F[x]=JSON.parse(JSON.stringify(S[U].profile[q]))}else if(void 0===S[U].profile&&void 0!==S[U].profileInfo&&!Array.isArray(S[U].profileInfo)){let H="profile"+(+U+1);F.profile={},F.profile[H]=JSON.parse(JSON.stringify(S[U].profileInfo))}C[k=x]=JSON.parse(JSON.stringify(S[U])),delete C[k].profile,C[k]=Object.assign({},C[k],JSON.parse(JSON.stringify(F[k])))}let $=JSON.parse(JSON.stringify(C));Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>A[e]="")),A=Object.keys(A),t.push({user:$})}var P={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[g],linkedUser:T}}};if(P.eventInfo=JSON.parse(JSON.stringify(P.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let K,z,Q,Y=e.paramsPassed;if(P.eventInfo.reference.linkedTransactionItems=[],P.eventInfo.reference.linkedCartItems=[],P.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(K=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],z=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Q=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):K=z=Q=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===y&&(y={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var V in c){let Z=!1;void 0!==c[V]&&void 0!==c[V].price&&(void 0!==c[V].price.basePrice&&void 0!==c[V].price.basePrice&&c[V].price.basePrice>0||void 0!==c[V].price.priceWithTax&&void 0!==c[V].price.priceWithTax&&c[V].price.priceWithTax>0)&&(Z=!0);let ee=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ee=!0));let te=void 0!==Y.transactionID&&""!=Y.transactionID;Z||ee?te?P.eventInfo.reference.linkedTransactionItems.push(V):P.eventInfo.reference.linkedCartItems.push(V):Q.includes(V)?P.eventInfo.reference.linkedTransactionItems.push(V):z.includes(V)?P.eventInfo.reference.linkedCartItems.push(V):(K.includes(V),P.eventInfo.reference.linkedProducts.push(V))}if(void 0!==y&&Object.keys(y.item).length>0)for(let ae in y.item){let oe=!1;void 0!==y.item[ae]&&void 0!==y.item[ae].price&&(void 0!==y.item[ae].price.basePrice&&void 0!==y.item[ae].price.basePrice&&y.item[ae].price.basePrice>0||void 0!==y.item[ae].price.priceWithTax&&void 0!==y.item[ae].price.priceWithTax&&y.item[ae].price.priceWithTax>0)&&(oe=!0);let ie=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ie=!0));let ne=void 0!==Y.transactionID&&""!=Y.transactionID;oe||ie?ne?P.eventInfo.reference.linkedTransactionItems.push(ae):P.eventInfo.reference.linkedCartItems.push(ae):Q.includes(ae)?P.eventInfo.reference.linkedTransactionItems.push(ae):z.includes(ae)?P.eventInfo.reference.linkedCartItems.push(ae):(K.includes(ae),P.eventInfo.reference.linkedProducts.push(ae))}if(void 0!==D&&Object.keys(D.item).length>0)for(let re in D.item){let se=!1;void 0!==D.item[re]&&void 0!==D.item[re].price&&(void 0!==D.item[re].price.basePrice&&void 0!==D.item[re].price.basePrice&&D.item[re].price.basePrice>0||void 0!==D.item[re].price.priceWithTax&&void 0!==D.item[re].price.priceWithTax&&D.item[re].price.priceWithTax>0)&&(se=!0);let ce=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ce=!0));let le=void 0!==Y.transactionID&&""!=Y.transactionID;se||ce?le?P.eventInfo.reference.linkedTransactionItems.push(re):P.eventInfo.reference.linkedCartItems.push(re):Q.includes(re)?P.eventInfo.reference.linkedTransactionItems.push(re):z.includes(re)?P.eventInfo.reference.linkedCartItems.push(re):(K.includes(re),P.eventInfo.reference.linkedProducts.push(re))}function X(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in P.eventInfo.reference[e]){let a=P.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(V)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(c[V]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(V)&&(D.item[V]=JSON.parse(JSON.stringify(y.item[V]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(y.item[a])))),X(c,a),X(y?.item,a)):"linkedCartItems"===e?(void 0===y||void 0===y.item||Object.keys(y.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(y.item[a]=JSON.parse(JSON.stringify(D.item[a])))),X(c,a),X(D?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==y&&Object.keys(y.item).length>0&&Object.keys(y.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(y.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(D.item[a])))),X(y?.item,a),X(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=P.eventInfo.reference[e];t&&0!==t.length||delete P.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function de(e){return-1*Math.abs(Number(e))}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let me=0;Object.keys(D.item).forEach((e=>{me+=(e.price||0).basePrice||0})),me=this.roundToDecimal(me,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>me,()=>0])||0),D.total.discountAmountAdditional=de(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let ue=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ue+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ue+=e.price.discountAmountOther||0)})),ue=this.roundToDecimal(ue,2),D.total.discountItemAmounts=de(this.roundToDecimal(ue,2)),D.total.discountAmountSum=de(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let pe=0;Object.keys(D.item).forEach((e=>{pe+=(e.price||0).taxAmount||0})),pe=this.roundToDecimal(pe,2),D.total.taxItemsAmount=this.roundToDecimal(pe,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==y&&void 0!==y.price&&1==Object.keys(y.price).length){function ge(e){return-1*Math.abs(Number(e))}y.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let he=0;Object.keys(y.item).forEach((e=>{he+=(e.price||0).basePrice||0})),he=this.roundToDecimal(he,2),y.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>he,()=>0])||0),y.price.discountAmountAdditional=ge(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),y.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ve=0;Object.keys(y.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ve+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ve+=e.price.discountAmountOther||0)})),ve=this.roundToDecimal(ve,2),y.price.discountItemAmounts=ge(this.roundToDecimal(ve,2)),y.price.discountAmountSum=ge(this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>y.price.discountItemAmounts+y.price.discountAmountAdditional,()=>0])||0),2));let ye=0;Object.keys(y.item).forEach((e=>{ye+=(e.price||0).taxAmount||0})),ye=this.roundToDecimal(ye,2),y.price.taxItemsAmount=this.roundToDecimal(ye,2),y.price.taxAmountSum=+(gFFWNV([()=>y.price.taxItemsAmount+y.price.taxAmountAdditional,()=>0])||0),y.price.priceWithTax=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>y.price.basePrice+y.price.discountAmountSum+y.price.taxAmountSum,()=>0])||0),2),y.price.shipping=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),y.price.cartTotal=this.roundToDecimal(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>y.price.priceWithTax+y.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==P.eventInfo.reference[e]&&(P.eventInfo.reference[e]=P.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else P.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var W in c)Object.keys(c[W]).indexOf("price")>-1&&delete c[W].price,Object.keys(c[W]).indexOf("quantity")>-1&&delete c[W].quantity;t.push({product:a})}return void 0!==y&&Object.keys(y.item).length>0&&t.push({cart:y}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(P),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=convertToACDL(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0)},2208:(e,t,a)=>{a.d(t,{Fg:()=>i,Q:()=>l.ZP,eP:()=>m}),a(775),a(5924),a(2421),a(645),a(3257),a(4220),a(6836),window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return n([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${n([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>r()])||""}/${n([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${n([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,s={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},c=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},l=void 0!==s[i]?s[i]:(c.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(s,mandatoryData.componentPrimaryCat)&&(prefix=i=o(s,mandatoryData.componentPrimaryCat)),""==l||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(d=location.host).split(".")[1];var d,m=d.split(".")[0],u=(d=location.host).split(".")[1],p=location.pathname.split("/")[1].length;"com"===d.split(".")[2]&&"bmw"===u&&2===p?(l="special website",i="special > "):"bmw"===u||"mini"===u||"bmw-motorrad"===u||"bmwusa"===u||"rolls-roycemotorcars"===u||"bmwgroup"===u&&"customer"===m||"bmwgroup"===u&&"tron"===m?(l="nsc website",i="nsc > "):(l="special website",i="special > ")}else l="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let g={},h="";void 0!==a&&(a[0].category.primaryCategory=l,h=a[0].componentInfo.componentID,g[h]=a[0]);var v=window.TRON.version.split("¦");e.indexOf("e0")>-1?v[v.length-1]="error_"+v[v.length-1]:e.indexOf("w0")>-1&&(v[v.length-1]="warning_"+v[v.length-1]);var y={component:g,version:v=v.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[h]}}},f={},b=[],D=[],w=[];if(w.length>0&&"string"!=typeof w){for(var N in w)if(void 0!==w[N]&&void 0!==w[N].productInfo){var O=w[N].productInfo.productID;void 0===O&&(O="product"+(N+1)),f[O]=w[N],void 0!==w[N].category.primaryCategory&&(w[N].category.primaryCategory.indexOf("car")>-1||w[N].category.primaryCategory.indexOf("bike")>-1)&&D.push(O)}Object.keys(f).forEach((e=>b.push(e))),y.product=f}var I={},T={},A=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(A=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),A.length>0&&"string"!=typeof A){for(var N in A)void 0!==A[N]&&void 0!==A[N].dealerInfo&&(I[A[N].dealerInfo.dealerOutletBuno]=A[N]);Object.keys(I).forEach((e=>T[e]="")),y.dealer=I}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var C=window.adobeDataLayer.getState("user");void 0!==C&&Object.keys(C).length>0&&(y.user=C)}e.indexOf("w0")>-1?window.TRON.warningCode.push(y):window.adobeDataLayer.push(y)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const o={customeEventName:"TRON: generic search filter",libraryName:"generic_search_filter",libraryVersion:"_v1.1.36",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}},i=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e=function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"filter"},componentInfo:{componentID:`TRON_${e._TronVersion}__${e._componentTrackingVersion}`,componentName:"generic search filter"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"search",eventPoints:0,type:""},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName","filterObject"],e.baseMandatoryData=["componentName"],e.baseOptionalData=["componentDEVagency","componentPlatform","componentVersion","userLoginStatus","userProfileID","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=[],e.allowedComponentNames=["model context filter","boutique","fs widget","cost and time calculator","charging time and cost calculator","charging time and range calculator","co2 and cost saving calculator"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected","user selected","available filter"],e.allowedSearchFilterSelectionState=["by default","by the user","on cta click"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},t=function(e){e.events||(e.events={}),e.events=Object.assign(e.events,{}),e.events=Object.assign(e.events,{["FilterSort".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventSubCat2","eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},["FilterRemoveAll".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters all removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},["FilterRemoved".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed by the user",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventSubCat2"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'},["FilterSelected".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause","eventSubCat2","searchFilterSelectionState"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n            <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture on each filter whether it was part of the default settings ("preselected") or the filters were selected by the user ("user selected") or the filters were simply available but not necessarily selected ("available filter"). </li>\n            <li><b>\'searchFilterSelectionState\'</b> is used to capture whether the event was triggered right after a page load to capture the filters selected "by default" in the page settings, or if it was triggered because filter(s) were selected "by the user". This parameters value if provided is appended to the event effect. </li>\n            <li><b>\'eventSubCat2\'</b> may be used by the product owner in case (s)he wants to track additional information along with the event.</li>\n        </ul>'}})},a=function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""};(function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=o.customeEventName,e._componentTrackingVersion=o.libraryName+""+o.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`})(this),e(this),a(this),t(this);let i=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in i)this[i[e]]=this[i[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(e,t){void 0===t&&(t={}),window.TRON.currentEventName=e,window.TRON.prefix=o.prefix,window.TRON.componentName=o.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==t&&(void 0!==t.componentName&&(window.TRON.componentName=t.componentName),void 0!==t.formOrigin&&(window.TRON.componentName=t.formOrigin),void 0!==t.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+t.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e;var a=`${r()}/${n([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==t&&void 0!==t.pageGeoRegion&&t.pageGeoRegion.toLowerCase()])}_${n([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==t&&void 0!==t.pageLanguage?t.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:a},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var i=JSON.parse(JSON.stringify(t));this._debug("💡 event triggered:"+e,i),t=this.transformData(t),t=this._trimWhitespace(t),this.scanForPIIKeywords(t),this._checkParamsPassed(e,i,t),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(t),this.message=this._loadEventData(e,t);try{this._checkmandatoryData(e,t),this.events[e].optionalData&&this._checkOptionalData(e,t)}catch(O){return"object"==typeof O&&void 0!==O.name&&"SyntaxError"==O.name&&void 0!==O.message&&"Missing Mandatory Data"==O.message||window.TRON.customConsole.error(O),!1}var s=o.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,e,t)}catch(I){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,e,t)}catch(T){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,e,t)}catch(A){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,e,t)}catch(C){return!1}function c(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=n([()=>t.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=n([()=>t.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=n([()=>t.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==t.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==t.componentName?(this.message.component[0].componentInfo.componentName=t.componentName,this.message.event[0].category.primaryCategory=t.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==t.componentPlatform&&(this.message.component[0].attributes.platform=n([()=>t.componentPlatform]));var l=void 0!==s?s:TRON.prefix,d={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},m=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},u=void 0!==d[l]?d[l]:(m.category||{}).primaryCategory||"";if(void 0!==t&&void 0!==t.componentPrimaryCat&&void 0===s&&"nsc > "==TRON.prefix&&null!=c(d,t.componentPrimaryCat)&&(s=l=c(d,t.componentPrimaryCat)),""==u||"shared > "==l||"local > "==l)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(p=location.host).split(".")[1];var p,g=p.split(".")[0],h=(p=location.host).split(".")[1],v=location.pathname.split("/")[1].length;"com"===p.split(".")[2]&&"bmw"===h&&2===v?(u="special website",l="special > "):"bmw"===h||"mini"===h||"bmw-motorrad"===h||"bmwusa"===h||"rolls-roycemotorcars"===h||"bmwgroup"===h&&"customer"===g||"bmwgroup"===h&&"tron"===g?(u="nsc website",l="nsc > "):(u="special website",l="special > ")}else u="special website",l="special > ";if(void 0!==s&&(s=l),void 0!==TRON.prefix&&(TRON.prefix=l),this.message.component[0].category.primaryCategory=u,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==t&&void 0!==t.filterObject){let S=t.filterObject;if(!this.allowedFilterObjects.includes(S)){if(this.events[e].mandatoryData.indexOf("filterObject")>-1){let k="string"==typeof t.filterObject&&0==t.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",k,this.allowedFilterObjects)}{let F=("string"==typeof t.filterObject&&t.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",F,this.allowedFilterObjects)}}t.filterObject=S}if(void 0!==t&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==t.filterObject&&(this.message.component[0].category.subCategory1=n([()=>((this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+t.filterObject||this.component.category.subCategory1).trim()])),void 0!==t&&void 0!==t.search&&t.search.length>0){var y=!1;for(var f in t.search)void 0!==t.search[f].searchState&&(this.allowedSearchState.includes(t.search[f].searchState)||(y=!0,t.search[f].searchState=""));if(y){if(this.events[e].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==t.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=n([()=>this.message.event[0].eventInfo.effect+" "+t.sortType])),void 0!==t.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==t.searchResults&&(this.message.event[0].category.subCategory1=n([()=>t.searchResults])),void 0!==t.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=t.filterObject,this.message.event[0].eventInfo.effect=t.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==t.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=t.searchResults),void 0!==t.positionClicked&&(this.message.event[0].attributes.positionClicked=n([()=>t.positionClicked])),void 0!==t.searchResults&&void 0!==t.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+t.searchResults),"search"!=this.message.event[0].eventInfo.eventName&&"sort"!=this.message.event[0].eventInfo.eventAction||void 0!==t.eventSubCat2&&(this.message.event[0].category.subCategory2=t.eventSubCat2),this.message.event[0].attributes.search=[],t.search&&void 0!==t.search&&t.search.forEach((e=>{let t={};t.label=n([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=n([()=>e.searchTerm]),t.state=n([()=>e.searchState,()=>"user selected"]),t.unit=n([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),"filterSelected"!=e&&"stockFilterSelected"!=e&&"shopFilterSelected"!=e&&"compareFilterSelected"!=e&&"visualizerFilterSelected"!=e||void 0!==t.searchFilterSelectionState&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+" "+(t.searchFilterSelectionState||"")),void 0!==t.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=n([()=>t.solutionSpecific1])),void 0!==t.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=n([()=>t.solutionSpecific2])),void 0!==t.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=n([()=>t.solutionSpecific3])),void 0!==t.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=n([()=>t.solutionSpecific4])),void 0!==t.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=n([()=>t.solutionSpecific5])),void 0!==t.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=n([()=>t.solutionSpecific6])),void 0!==t.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=n([()=>t.solutionSpecific7])),void 0!==t.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=n([()=>t.solutionSpecific8])),void 0!==t.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=n([()=>t.solutionSpecific9])),void 0!==t.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=n([()=>t.solutionSpecific10])),t&&t.userLoginStatus&&void 0!==t.userLoginStatus){let x=t.userLoginStatus;if(!this.allowedUserLoginStatus.includes(x)){let P="string"==typeof t.userLoginStatus&&0==t.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",P,this.allowedUserLoginStatus)}t.userLoginStatus=x}if(void 0!==t&&void 0!==t.userLanguage)if(2!=t.userLanguage.length){if(this.events[e].mandatoryData.indexOf("userLanguage")>-1){let V="string"==typeof t.userLanguage&&0==t.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",V,"","(has to follow ISO standard of 2 letters in uppercase)")}{let W=("string"==typeof t.userLanguage&&t.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",W,"","(has to follow ISO standard of 2 letters in uppercase)"),t.userLanguage=""}}else t.userLanguage=(t.userLanguage||"").toLowerCase();if(void 0!==t&&void 0!==t.userCountry)if(2==t.userCountry.length)t.userCountry=(t.userCountry||"").toUpperCase();else if(t.userCountry=(t.userCountry||"").toLowerCase(),!["global"].includes(t.userCountry)){if(this.events[e].mandatoryData.indexOf("userCountry")>-1){let _="string"==typeof t.userCountry&&0==t.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",_,this.alloweduserCountry)}{let E=("string"==typeof t.userCountry&&t.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",E,this.alloweduserCountry),t.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,e,t)}catch(L){return!1}if(void 0!==t.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=n([()=>t.userLoginStatus])),void 0!==t.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=n([()=>t.userProfileID])),void 0!==t.userSegment&&(this.message.user[0].segment=n([()=>t.userSegment])),void 0!==t.userType&&(this.message.user[0].profile[0].profileInfo.type=n([()=>t.userType])),void 0!==t.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=n([()=>t.userStateProvince])),void 0!==t.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=n([()=>t.userCountry])),void 0!==t.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=n([()=>t.userLanguage])),void 0!==t&&t.componentVersion&&(this.message.component[0].attributes.componentVersion=t.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==t&&(this.message.component[0].componentInfo.componentID=r(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.pageGeoRegion?t.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==t.formType?t.formType:"")),window.TRON.componentName=(void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==s&&(s=s.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(s||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var b=[],D=[];for(var f in this.message.product)if(void 0!==this.message.product[f]&&void 0!==this.message.product[f].productInfo){var w=this.message.product[f].productInfo.productID;void 0===w&&(w="product"+(f+1)),b.push(w),void 0!==this.message.product[f].category.primaryCategory&&(this.message.product[f].category.primaryCategory.indexOf("car")>-1||this.message.product[f].category.primaryCategory.indexOf("bike")>-1)&&D.push(w)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(D):this.message.page.pageInfo.reference.defaultProducts=[].concat(b)}if(Object.keys(t).some((e=>e.startsWith("user")))||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==t.errorMessage?(s||"")+t.errorMessage:"",void 0!==t.errorAction&&(this.message.event[0].eventInfo.eventAction=t.errorAction),void 0!==t.errorCause&&(this.message.event[0].eventInfo.cause=t.errorCause),void 0!==t.errorType&&(this.message.event[0].eventInfo.type=t.errorType),this.message.event[0].category.primaryCategory=t.componentName||this.message.component[0].componentInfo.componentName,void 0!==t.errorCode&&(this.message.event[0].category.subCategory1=t.errorCode),void 0!==t.errorOrigin&&(this.message.event[0].category.subCategory2=t.errorOrigin),void 0!==t.errorURL&&(this.message.event[0].attributes.requestedURL=t.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),t.eventCause&&null!=t.eventCause&&(this.message.event[0].eventInfo.cause=t.eventCause),t.requestedURL&&null!=t.requestedURL&&(this.message.event[0].attributes.requestedURL=t.requestedURL),void 0!==t.iframeURL&&(this.message.event[0].attributes.relatedURL=n([()=>t.iframeURL])),void 0!==t.eventPoints||"string"==typeof t.eventPoints&&0==t.eventPoints.trim().length){if(t.eventPoints=+t.eventPoints,"number"!=typeof t.eventPoints||NaN!=t.eventPoints){var N=void 0!==t.eventPoints&&""==t.eventPoints?"empty":"incorrect-numeric";if(this.events[e].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",N,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",N,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(t.eventPoints)?void 0:+t.eventPoints}if(void 0===t.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==t.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof t.eventAction&&t.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=t.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),t.stepAmounts&&void 0!==t.stepAmounts&&(t.step&&void 0!==t.step?this.message.event[0].attributes.stepAmounts="step "+t.step+"/"+t.stepAmounts:this.message.event[0].attributes.stepAmounts=t.stepAmounts),void 0===t.stepAmounts&&t.step&&void 0!==t.step&&(this.message.event[0].attributes.stepAmounts="step "+t.step+"/x"),this.message.component[0].componentInfo.componentID=`${n([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>r()])||""}/${n([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${n([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(t)),void 0!==t){let R,j,M;if(R=j=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(M=this.message.cart.item.length-1;M>=0;M--){let B=!1;void 0!==this.message.cart.item[M]&&void 0!==this.message.cart.item[M].price&&(void 0!==this.message.cart.item[M].price.basePrice&&void 0!==this.message.cart.item[M].price.basePrice&&this.message.cart.item[M].price.basePrice>0||void 0!==this.message.cart.item[M].price.priceWithTax&&void 0!==this.message.cart.item[M].price.priceWithTax&&this.message.cart.item[M].price.priceWithTax>0)&&(B=!0);let G=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(G=!0));let $=void 0!==t.transactionID&&""!=t.transactionID;B||G||B||G||$?$&&this.message.cart.item.splice(M,1):this.message.cart.item.splice(M,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&R.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(M=this.message.transaction.item.length-1;M>=0;M--){let U=!1;void 0!==this.message.transaction.item[M]&&void 0!==this.message.transaction.item[M].price&&(void 0!==this.message.transaction.item[M].price.basePrice&&void 0!==this.message.transaction.item[M].price.basePrice&&this.message.transaction.item[M].price.basePrice>0||void 0!==this.message.transaction.item[M].price.priceWithTax&&void 0!==this.message.transaction.item[M].price.priceWithTax&&this.message.transaction.item[M].price.priceWithTax>0)&&(U=!0);let q=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(q=!0));let H=void 0!==t.transactionID&&""!=t.transactionID;U||q?H||this.message.transaction.item.splice(M,1):!H||U||q||this.message.transaction.item.splice(M,1),""!=(((this.message.transaction.item[M]||"").productInfo||"").productID||"")&&R.indexOf(this.message.transaction.item[M].productInfo.productID)>-1&&this.message.transaction.item.splice(M,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&j.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(M=this.message.product.length-1;M>=0;M--){let K=!1;void 0!==this.message.product[M]&&void 0!==this.message.product[M].price&&(void 0!==this.message.product[M].price.basePrice&&void 0!==this.message.product[M].price.basePrice&&this.message.product[M].price.basePrice>0||void 0!==this.message.product[M].price.priceWithTax&&void 0!==this.message.product[M].price.priceWithTax&&this.message.product[M].price.priceWithTax>0)&&(K=!0);let z=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(z=!0));let Q=void 0!==t.transactionID&&""!=t.transactionID;K&&this.message.product.splice(M,1),!z||Q||K||(R.indexOf(this.message.product[M].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[M]),this.message.product.splice(M,1)),z&&Q&&(j.indexOf(this.message.product[M].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[M]),this.message.product.splice(M,1)),""!=(((this.message.product[M]||"").productInfo||"").productID||"")&&(R.indexOf(this.message.product[M].productInfo.productID)>-1||j.indexOf(this.message.product[M].productInfo.productID)>-1)&&this.message.product.splice(M,1)}function J(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(t.totalCurrency||"").toUpperCase();let Y=0;Object.keys(this.message.cart.item).forEach((e=>{Y+=(e.price||0).basePrice||0})),Y=this.roundToDecimal(Y,2),this.message.cart.price.basePrice=+(n([()=>t.totalBasePrice,()=>Y,()=>0])||0),this.message.cart.price.discountAmountAdditional=J(+(n([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(n([()=>t.totalTaxAmountAdditional,()=>0])||0);let X=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(X+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(X+=e.price.discountAmountOther||0)})),X=this.roundToDecimal(X,2),this.message.cart.price.discountItemAmounts=J(this.roundToDecimal(X,2)),this.message.cart.price.discountAmountSum=J(this.roundToDecimal(+(n([()=>t.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let Z=0;Object.keys(this.message.cart.item).forEach((e=>{Z+=(e.price||0).taxAmount||0})),Z=this.roundToDecimal(Z,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(Z,2),this.message.cart.price.taxAmountSum=+(n([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(n([()=>t.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(n([()=>t.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(n([()=>t.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=t.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(t.totalCurrency||"").toUpperCase();let ee=0;Object.keys(this.message.transaction.item).forEach((e=>{ee+=(e.price||0).basePrice||0})),ee=this.roundToDecimal(ee,2),this.message.transaction.total.basePrice=+(n([()=>t.totalBasePrice,()=>ee,()=>0])||0),this.message.transaction.total.discountAmountAdditional=J(+(n([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(n([()=>t.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(n([()=>t.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=n([()=>t.totalPaymentMethod,()=>""])||"";let te=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(te+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(te+=e.price.discountAmountOther||0)})),te=this.roundToDecimal(te,2),this.message.transaction.total.discountItemAmounts=J(this.roundToDecimal(te,2)),this.message.transaction.total.discountAmountSum=J(this.roundToDecimal(+(n([()=>t.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let ae=0;Object.keys(this.message.transaction.item).forEach((e=>{ae+=(e.price||0).taxAmount||0})),ae=this.roundToDecimal(ae,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(ae,2),this.message.transaction.total.taxAmountSum=+(n([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(n([()=>t.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(n([()=>t.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=t.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let i=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),n=JSON.parse(JSON.stringify(this.baseEvent)),r=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[i,n,r].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),o.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),o.projConditionCheck&&o.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let s=JSON.parse(JSON.stringify(this.baseCustom||{})),c=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[s,c].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=s(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=s(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function n(e,t={}){return function(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function r(){return n([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function s(e){var t=[],a={},o=[],i=[],r=e.product;if(r.length>0&&"string"!=typeof r){for(var s in r)if(void 0!==r[s]&&void 0!==r[s].productInfo){var c=r[s].productInfo.productID;void 0===c&&(c="product"+(+s+1)),a[c]=r[s],void 0!==r[s].category.primaryCategory&&(r[s].category.primaryCategory.indexOf("car")>-1||r[s].category.primaryCategory.indexOf("bike")>-1)&&i.push(c)}Object.keys(a).forEach((e=>o.push(e)));var l=a}var d="page view"==e.event[0].eventInfo.eventName,m=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),u=((e.page||"").pageInfo||"").pageName||"";if(d&&(m?"tbd"!=u&&""!=u&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):m||("tbd"!=u&&""!=u||void 0!==u)&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!d&&"tbd"!=u&&""!=u&&void 0!==u){var p=u.split(">");""!=(p=(p=p.length>1?p[1]:p[0]).trim())&&"tbd"!=p&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let g={},h=e.component[0].componentInfo.componentID;g[h]=e.component[0],t.push({component:g});var v={},y=e.cart;if(y&&y.item.length>0&&"string"!=typeof y){for(let E in y.item)if(void 0!==y.item[E]&&void 0!==y.item[E].productInfo){let L=y.item[E].productInfo.productID;void 0!==L&&(v[L]=y.item[E])}v=Object.assign({},v);for(let R in v)for(let j in e.cart.item)R==e.cart.item[j].productInfo.productID&&(v[R].price=Object.assign({},e.cart.item[j].price),v[R].quantity=e.cart.item[j].quantity);var f={item:v,price:e.cart.price,cartID:e.cart.cartID}}var b={},D=e.transaction;if(D&&D.item.length>0&&"string"!=typeof D&&void 0!==D.transactionID){for(let M in D.item)if(void 0!==D.item[M]&&void 0!==D.item[M].productInfo){let J=D.item[M].productInfo.productID;void 0!==J&&(b[J]=D.item[M])}b=Object.assign({},b);for(let B in b)for(let G in e.transaction.item)B==e.transaction.item[G].productInfo.productID&&(b[B].price=Object.assign({},e.transaction.item[G].price),b[B].quantity=e.transaction.item[G].quantity);var w={item:b,total:e.transaction.total,transactionID:e.transaction.transactionID}}var N={},O={},I=e.dealer;if(I.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(let $ in I)if(void 0!==I[$]&&void 0!==I[$].dealerInfo){var T=I[$].dealerInfo.dealerOutletBuno;void 0!==T&&(N[T]=I[$])}Object.keys(N).forEach((e=>O[e]="")),O=Object.keys(O),Object.keys(N).length>0&&t.push({dealer:N})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var A={},C={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var S={},k=e.user;for(let q in k){var F,x={};if(Array.isArray(k[q].profile)&&k[q].profile.length>0)for(let H in k[q].profile){var P=null!=k[q].profile[H].profileInfo.profileID?k[q].profile[H].profileInfo.profileID:"profile"+(+H+1);x[P]=JSON.parse(JSON.stringify(k[q].profile[H]))}else if(void 0===k[q].profile&&void 0!==k[q].profileInfo&&!Array.isArray(k[q].profileInfo)){let K="profile"+(+q+1);x.profile={},x.profile[K]=JSON.parse(JSON.stringify(k[q].profileInfo))}S[F=P]=JSON.parse(JSON.stringify(k[q])),delete S[F].profile,S[F]=Object.assign({},S[F],JSON.parse(JSON.stringify(x[F])))}let U=JSON.parse(JSON.stringify(S));Object.keys(S).forEach((e=>A[e]="")),A=Object.keys(A),Object.keys(S).forEach((e=>C[e]="")),C=Object.keys(C),t.push({user:U})}var V={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[h],linkedUser:A}}};if(V.eventInfo=JSON.parse(JSON.stringify(V.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let z,Q,Y,X=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(z=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],Q=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Y=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):z=Q=Y=[],void 0===w&&(w={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===f&&(f={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==l&&void 0!==l&&Object.keys(l).length>0)for(var W in l){let ee=!1;void 0!==l[W]&&void 0!==l[W].price&&(void 0!==l[W].price.basePrice&&void 0!==l[W].price.basePrice&&l[W].price.basePrice>0||void 0!==l[W].price.priceWithTax&&void 0!==l[W].price.priceWithTax&&l[W].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(te=!0));let ae=void 0!==X.transactionID&&""!=X.transactionID;ee||te?ae?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):Y.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):Q.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(z.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==f&&Object.keys(f.item).length>0)for(let oe in f.item){let ie=!1;void 0!==f.item[oe]&&void 0!==f.item[oe].price&&(void 0!==f.item[oe].price.basePrice&&void 0!==f.item[oe].price.basePrice&&f.item[oe].price.basePrice>0||void 0!==f.item[oe].price.priceWithTax&&void 0!==f.item[oe].price.priceWithTax&&f.item[oe].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ne=!0));let re=void 0!==X.transactionID&&""!=X.transactionID;ie||ne?re?V.eventInfo.reference.linkedTransactionItems.push(oe):V.eventInfo.reference.linkedCartItems.push(oe):Y.includes(oe)?V.eventInfo.reference.linkedTransactionItems.push(oe):Q.includes(oe)?V.eventInfo.reference.linkedCartItems.push(oe):(z.includes(oe),V.eventInfo.reference.linkedProducts.push(oe))}if(void 0!==w&&Object.keys(w.item).length>0)for(let se in w.item){let ce=!1;void 0!==w.item[se]&&void 0!==w.item[se].price&&(void 0!==w.item[se].price.basePrice&&void 0!==w.item[se].price.basePrice&&w.item[se].price.basePrice>0||void 0!==w.item[se].price.priceWithTax&&void 0!==w.item[se].price.priceWithTax&&w.item[se].price.priceWithTax>0)&&(ce=!0);let le=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(le=!0));let de=void 0!==X.transactionID&&""!=X.transactionID;ce||le?de?V.eventInfo.reference.linkedTransactionItems.push(se):V.eventInfo.reference.linkedCartItems.push(se):Y.includes(se)?V.eventInfo.reference.linkedTransactionItems.push(se):Q.includes(se)?V.eventInfo.reference.linkedCartItems.push(se):(z.includes(se),V.eventInfo.reference.linkedProducts.push(se))}function Z(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===w||void 0===w.item||Object.keys(w).includes(a)?void 0===w&&(void 0===w||void 0===w.item||Object.keys(w.item).includes(W)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(l[W]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(f.item[W]))))):(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(f.item[a])))),Z(l,a),Z(f?.item,a)):"linkedCartItems"===e?(void 0===f||void 0===f.item||Object.keys(f.item).includes(a)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(l,a),Z(w?.item,a)):"linkedProducts"===e&&(void 0!==l&&Object.keys(l).length>0&&!Object.keys(l).includes(a)&&(void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(f.item[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(f?.item,a),Z(w?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(w=w||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==w.total&&1==Object.keys(w.total).length){function me(e){return-1*Math.abs(Number(e))}w.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ue=0;Object.keys(w.item).forEach((e=>{ue+=(e.price||0).basePrice||0})),ue=this.roundToDecimal(ue,2),w.total.basePrice=+(n([()=>e.paramsPassed.totalBasePrice,()=>ue,()=>0])||0),w.total.discountAmountAdditional=me(+(n([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),w.total.taxAmountAdditional=+(n([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),w.total.shipping=this.roundToDecimal(+(n([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),w.total.paymentMethod=n([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let pe=0;Object.keys(w.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(pe+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(pe+=e.price.discountAmountOther||0)})),pe=this.roundToDecimal(pe,2),w.total.discountItemAmounts=me(this.roundToDecimal(pe,2)),w.total.discountAmountSum=me(this.roundToDecimal(+(n([()=>e.paramsPassed.totalDiscountAmount,()=>w.total.discountItemAmounts+w.total.discountAmountAdditional,()=>0])||0),2));let ge=0;Object.keys(w.item).forEach((e=>{ge+=(e.price||0).taxAmount||0})),ge=this.roundToDecimal(ge,2),w.total.taxItemsAmount=this.roundToDecimal(ge,2),w.total.taxAmountSum=+(n([()=>w.total.taxItemsAmount+w.total.taxAmountAdditional,()=>0])||0),w.total.priceWithTax=this.roundToDecimal(+(n([()=>e.paramsPassed.totalPriceWithTax,()=>w.total.basePrice+w.total.discountAmountSum+w.total.taxAmountSum,()=>0])||0),2),w.total.transactionTotal=this.roundToDecimal(+(n([()=>e.paramsPassed.totalFinalPrice,()=>w.total.priceWithTax+w.total.shipping,()=>0])||0),2)}if(void 0!==f&&void 0!==f.price&&1==Object.keys(f.price).length){function he(e){return-1*Math.abs(Number(e))}f.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ve=0;Object.keys(f.item).forEach((e=>{ve+=(e.price||0).basePrice||0})),ve=this.roundToDecimal(ve,2),f.price.basePrice=+(n([()=>e.paramsPassed.totalBasePrice,()=>ve,()=>0])||0),f.price.discountAmountAdditional=he(+(n([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),f.price.taxAmountAdditional=+(n([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ye=0;Object.keys(f.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ye+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ye+=e.price.discountAmountOther||0)})),ye=this.roundToDecimal(ye,2),f.price.discountItemAmounts=he(this.roundToDecimal(ye,2)),f.price.discountAmountSum=he(this.roundToDecimal(+(n([()=>e.paramsPassed.totalDiscountAmount,()=>f.price.discountItemAmounts+f.price.discountAmountAdditional,()=>0])||0),2));let fe=0;Object.keys(f.item).forEach((e=>{fe+=(e.price||0).taxAmount||0})),fe=this.roundToDecimal(fe,2),f.price.taxItemsAmount=this.roundToDecimal(fe,2),f.price.taxAmountSum=+(n([()=>f.price.taxItemsAmount+f.price.taxAmountAdditional,()=>0])||0),f.price.priceWithTax=this.roundToDecimal(+(n([()=>e.paramsPassed.totalPriceWithTax,()=>f.price.basePrice+f.price.discountAmountSum+f.price.taxAmountSum,()=>0])||0),2),f.price.shipping=this.roundToDecimal(+(n([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),f.price.cartTotal=this.roundToDecimal(+(n([()=>e.paramsPassed.totalFinalPrice,()=>f.price.priceWithTax+f.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==V.eventInfo.reference[e]&&(V.eventInfo.reference[e]=V.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==l&&void 0!==l&&Object.keys(l).length>0){for(var _ in l)Object.keys(l[_]).indexOf("price")>-1&&delete l[_].price,Object.keys(l[_]).indexOf("quantity")>-1&&delete l[_].quantity;t.push({product:a})}return void 0!==f&&Object.keys(f.item).length>0&&t.push({cart:f}),void 0!==w&&Object.keys(w.item).length>0&&(w.transactionID=(w.transactionID+"").toUpperCase(),t.push({transaction:w})),t.push(V),t}function c(e,t={}){return function(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=s(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0),a(4139),a(940),window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return c([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${c([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>c([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""])||""}/${c([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${c([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(l=location.host).split(".")[1];var l,d=l.split(".")[0],m=(l=location.host).split(".")[1],u=location.pathname.split("/")[1].length;"com"===l.split(".")[2]&&"bmw"===m&&2===u?(s="special website",i="special > "):"bmw"===m||"mini"===m||"bmw-motorrad"===m||"bmwusa"===m||"rolls-roycemotorcars"===m||"bmwgroup"===m&&"customer"===d||"bmwgroup"===m&&"tron"===d?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let p={},g="";void 0!==a&&(a[0].category.primaryCategory=s,g=a[0].componentInfo.componentID,p[g]=a[0]);var h=window.TRON.version.split("¦");e.indexOf("e0")>-1?h[h.length-1]="error_"+h[h.length-1]:e.indexOf("w0")>-1&&(h[h.length-1]="warning_"+h[h.length-1]);var v={component:p,version:h=h.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[g]}}},y={},f=[],b=[],D=[];if(D.length>0&&"string"!=typeof D){for(var w in D)if(void 0!==D[w]&&void 0!==D[w].productInfo){var N=D[w].productInfo.productID;void 0===N&&(N="product"+(w+1)),y[N]=D[w],void 0!==D[w].category.primaryCategory&&(D[w].category.primaryCategory.indexOf("car")>-1||D[w].category.primaryCategory.indexOf("bike")>-1)&&b.push(N)}Object.keys(y).forEach((e=>f.push(e))),v.product=y}var O={},I={},T=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(T=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),T.length>0&&"string"!=typeof T){for(var w in T)void 0!==T[w]&&void 0!==T[w].dealerInfo&&(O[T[w].dealerInfo.dealerOutletBuno]=T[w]);Object.keys(O).forEach((e=>I[e]="")),v.dealer=O}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var A=window.adobeDataLayer.getState("user");void 0!==A&&Object.keys(A).length>0&&(v.user=A)}e.indexOf("w0")>-1?window.TRON.warningCode.push(v):window.adobeDataLayer.push(v)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}()),window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=function(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var l=a}var d="page view"==e.event[0].eventInfo.eventName,m=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),u=((e.page||"").pageInfo||"").pageName||"";if(d&&(m?"tbd"!=u&&""!=u&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):m||("tbd"!=u&&""!=u||void 0!==u)&&(d&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!d&&"tbd"!=u&&""!=u&&void 0!==u){var p=u.split(">");""!=(p=(p=p.length>1?p[1]:p[0]).trim())&&"tbd"!=p&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let g={},h=e.component[0].componentInfo.componentID;g[h]=e.component[0],t.push({component:g});var v={},y=e.cart;if(y&&y.item.length>0&&"string"!=typeof y){for(let E in y.item)if(void 0!==y.item[E]&&void 0!==y.item[E].productInfo){let L=y.item[E].productInfo.productID;void 0!==L&&(v[L]=y.item[E])}v=Object.assign({},v);for(let R in v)for(let j in e.cart.item)R==e.cart.item[j].productInfo.productID&&(v[R].price=Object.assign({},e.cart.item[j].price),v[R].quantity=e.cart.item[j].quantity);var f={item:v,price:e.cart.price,cartID:e.cart.cartID}}var b={},D=e.transaction;if(D&&D.item.length>0&&"string"!=typeof D&&void 0!==D.transactionID){for(let M in D.item)if(void 0!==D.item[M]&&void 0!==D.item[M].productInfo){let J=D.item[M].productInfo.productID;void 0!==J&&(b[J]=D.item[M])}b=Object.assign({},b);for(let B in b)for(let G in e.transaction.item)B==e.transaction.item[G].productInfo.productID&&(b[B].price=Object.assign({},e.transaction.item[G].price),b[B].quantity=e.transaction.item[G].quantity);var w={item:b,total:e.transaction.total,transactionID:e.transaction.transactionID}}var N={},O={},I=e.dealer;if(I.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(let $ in I)if(void 0!==I[$]&&void 0!==I[$].dealerInfo){var T=I[$].dealerInfo.dealerOutletBuno;void 0!==T&&(N[T]=I[$])}Object.keys(N).forEach((e=>O[e]="")),O=Object.keys(O),Object.keys(N).length>0&&t.push({dealer:N})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var A={},C={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var S={},k=e.user;for(let q in k){var F,x={};if(Array.isArray(k[q].profile)&&k[q].profile.length>0)for(let H in k[q].profile){var P=null!=k[q].profile[H].profileInfo.profileID?k[q].profile[H].profileInfo.profileID:"profile"+(+H+1);x[P]=JSON.parse(JSON.stringify(k[q].profile[H]))}else if(void 0===k[q].profile&&void 0!==k[q].profileInfo&&!Array.isArray(k[q].profileInfo)){let K="profile"+(+q+1);x.profile={},x.profile[K]=JSON.parse(JSON.stringify(k[q].profileInfo))}S[F=P]=JSON.parse(JSON.stringify(k[q])),delete S[F].profile,S[F]=Object.assign({},S[F],JSON.parse(JSON.stringify(x[F])))}let U=JSON.parse(JSON.stringify(S));Object.keys(S).forEach((e=>A[e]="")),A=Object.keys(A),Object.keys(S).forEach((e=>C[e]="")),C=Object.keys(C),t.push({user:U})}var V={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[h],linkedUser:A}}};if(V.eventInfo=JSON.parse(JSON.stringify(V.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let z,Q,Y,X=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(z=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],Q=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Y=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):z=Q=Y=[],void 0===w&&(w={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===f&&(f={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==l&&void 0!==l&&Object.keys(l).length>0)for(var W in l){let ee=!1;void 0!==l[W]&&void 0!==l[W].price&&(void 0!==l[W].price.basePrice&&void 0!==l[W].price.basePrice&&l[W].price.basePrice>0||void 0!==l[W].price.priceWithTax&&void 0!==l[W].price.priceWithTax&&l[W].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(te=!0));let ae=void 0!==X.transactionID&&""!=X.transactionID;ee||te?ae?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):Y.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):Q.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(z.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==f&&Object.keys(f.item).length>0)for(let oe in f.item){let ie=!1;void 0!==f.item[oe]&&void 0!==f.item[oe].price&&(void 0!==f.item[oe].price.basePrice&&void 0!==f.item[oe].price.basePrice&&f.item[oe].price.basePrice>0||void 0!==f.item[oe].price.priceWithTax&&void 0!==f.item[oe].price.priceWithTax&&f.item[oe].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ne=!0));let re=void 0!==X.transactionID&&""!=X.transactionID;ie||ne?re?V.eventInfo.reference.linkedTransactionItems.push(oe):V.eventInfo.reference.linkedCartItems.push(oe):Y.includes(oe)?V.eventInfo.reference.linkedTransactionItems.push(oe):Q.includes(oe)?V.eventInfo.reference.linkedCartItems.push(oe):(z.includes(oe),V.eventInfo.reference.linkedProducts.push(oe))}if(void 0!==w&&Object.keys(w.item).length>0)for(let se in w.item){let ce=!1;void 0!==w.item[se]&&void 0!==w.item[se].price&&(void 0!==w.item[se].price.basePrice&&void 0!==w.item[se].price.basePrice&&w.item[se].price.basePrice>0||void 0!==w.item[se].price.priceWithTax&&void 0!==w.item[se].price.priceWithTax&&w.item[se].price.priceWithTax>0)&&(ce=!0);let le=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(le=!0));let de=void 0!==X.transactionID&&""!=X.transactionID;ce||le?de?V.eventInfo.reference.linkedTransactionItems.push(se):V.eventInfo.reference.linkedCartItems.push(se):Y.includes(se)?V.eventInfo.reference.linkedTransactionItems.push(se):Q.includes(se)?V.eventInfo.reference.linkedCartItems.push(se):(z.includes(se),V.eventInfo.reference.linkedProducts.push(se))}function Z(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===w||void 0===w.item||Object.keys(w).includes(a)?void 0===w&&(void 0===w||void 0===w.item||Object.keys(w.item).includes(W)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(l[W]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(f.item[W]))))):(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(f.item[a])))),Z(l,a),Z(f?.item,a)):"linkedCartItems"===e?(void 0===f||void 0===f.item||Object.keys(f.item).includes(a)||(void 0!==l&&Object.keys(l).length>0&&Object.keys(l).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(l[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(l,a),Z(w?.item,a)):"linkedProducts"===e&&(void 0!==l&&Object.keys(l).length>0&&!Object.keys(l).includes(a)&&(void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(f.item[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(l[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(f?.item,a),Z(w?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(w=w||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==w.total&&1==Object.keys(w.total).length){function me(e){return-1*Math.abs(Number(e))}w.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ue=0;Object.keys(w.item).forEach((e=>{ue+=(e.price||0).basePrice||0})),ue=this.roundToDecimal(ue,2),w.total.basePrice=+(c([()=>e.paramsPassed.totalBasePrice,()=>ue,()=>0])||0),w.total.discountAmountAdditional=me(+(c([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),w.total.taxAmountAdditional=+(c([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),w.total.shipping=this.roundToDecimal(+(c([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),w.total.paymentMethod=c([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let pe=0;Object.keys(w.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(pe+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(pe+=e.price.discountAmountOther||0)})),pe=this.roundToDecimal(pe,2),w.total.discountItemAmounts=me(this.roundToDecimal(pe,2)),w.total.discountAmountSum=me(this.roundToDecimal(+(c([()=>e.paramsPassed.totalDiscountAmount,()=>w.total.discountItemAmounts+w.total.discountAmountAdditional,()=>0])||0),2));let ge=0;Object.keys(w.item).forEach((e=>{ge+=(e.price||0).taxAmount||0})),ge=this.roundToDecimal(ge,2),w.total.taxItemsAmount=this.roundToDecimal(ge,2),w.total.taxAmountSum=+(c([()=>w.total.taxItemsAmount+w.total.taxAmountAdditional,()=>0])||0),w.total.priceWithTax=this.roundToDecimal(+(c([()=>e.paramsPassed.totalPriceWithTax,()=>w.total.basePrice+w.total.discountAmountSum+w.total.taxAmountSum,()=>0])||0),2),w.total.transactionTotal=this.roundToDecimal(+(c([()=>e.paramsPassed.totalFinalPrice,()=>w.total.priceWithTax+w.total.shipping,()=>0])||0),2)}if(void 0!==f&&void 0!==f.price&&1==Object.keys(f.price).length){function he(e){return-1*Math.abs(Number(e))}f.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ve=0;Object.keys(f.item).forEach((e=>{ve+=(e.price||0).basePrice||0})),ve=this.roundToDecimal(ve,2),f.price.basePrice=+(c([()=>e.paramsPassed.totalBasePrice,()=>ve,()=>0])||0),f.price.discountAmountAdditional=he(+(c([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),f.price.taxAmountAdditional=+(c([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ye=0;Object.keys(f.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ye+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ye+=e.price.discountAmountOther||0)})),ye=this.roundToDecimal(ye,2),f.price.discountItemAmounts=he(this.roundToDecimal(ye,2)),f.price.discountAmountSum=he(this.roundToDecimal(+(c([()=>e.paramsPassed.totalDiscountAmount,()=>f.price.discountItemAmounts+f.price.discountAmountAdditional,()=>0])||0),2));let fe=0;Object.keys(f.item).forEach((e=>{fe+=(e.price||0).taxAmount||0})),fe=this.roundToDecimal(fe,2),f.price.taxItemsAmount=this.roundToDecimal(fe,2),f.price.taxAmountSum=+(c([()=>f.price.taxItemsAmount+f.price.taxAmountAdditional,()=>0])||0),f.price.priceWithTax=this.roundToDecimal(+(c([()=>e.paramsPassed.totalPriceWithTax,()=>f.price.basePrice+f.price.discountAmountSum+f.price.taxAmountSum,()=>0])||0),2),f.price.shipping=this.roundToDecimal(+(c([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),f.price.cartTotal=this.roundToDecimal(+(c([()=>e.paramsPassed.totalFinalPrice,()=>f.price.priceWithTax+f.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==V.eventInfo.reference[e]&&(V.eventInfo.reference[e]=V.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==l&&void 0!==l&&Object.keys(l).length>0){for(var _ in l)Object.keys(l[_]).indexOf("price")>-1&&delete l[_].price,Object.keys(l[_]).indexOf("quantity")>-1&&delete l[_].quantity;t.push({product:a})}return void 0!==f&&Object.keys(f.item).length>0&&t.push({cart:f}),void 0!==w&&Object.keys(w.item).length>0&&(w.transactionID=(w.transactionID+"").toUpperCase(),t.push({transaction:w})),t.push(V),t}(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0);var l=a(7438);window.TRON=window.TRON||{},window.TRON.warningCode=[],window.TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return u([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=window.TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${u([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>p()])||""}/${u([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${u([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let g={},h="";void 0!==a&&(a[0].category.primaryCategory=s,h=a[0].componentInfo.componentID,g[h]=a[0]);var v=window.TRON.version.split("¦");e.indexOf("e0")>-1?v[v.length-1]="error_"+v[v.length-1]:e.indexOf("w0")>-1&&(v[v.length-1]="warning_"+v[v.length-1]);var y={component:g,version:v=v.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((window.TRON||"").currentEventName||""),effect:window.TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(window.TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[h]}}},f={},b=[],D=[],w=[];if(w.length>0&&"string"!=typeof w){for(var N in w)if(void 0!==w[N]&&void 0!==w[N].productInfo){var O=w[N].productInfo.productID;void 0===O&&(O="product"+(N+1)),f[O]=w[N],void 0!==w[N].category.primaryCategory&&(w[N].category.primaryCategory.indexOf("car")>-1||w[N].category.primaryCategory.indexOf("bike")>-1)&&D.push(O)}Object.keys(f).forEach((e=>b.push(e))),y.product=f}var I={},T={},A=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(A=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),A.length>0&&"string"!=typeof A){for(var N in A)void 0!==A[N]&&void 0!==A[N].dealerInfo&&(I[A[N].dealerInfo.dealerOutletBuno]=A[N]);Object.keys(I).forEach((e=>T[e]="")),y.dealer=I}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var C=window.adobeDataLayer.getState("user");void 0!==C&&Object.keys(C).length>0&&(y.user=C)}e.indexOf("w0")>-1?window.TRON.warningCode.push(y):window.adobeDataLayer.push(y)}window.TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const d={customeEventName:"TRON:generic video player",libraryName:"generic_video_player",libraryVersion:"_v6.1.36",prefix:"nsc > ",pageExist:!0,vehicle:{productType:"",primaryCategory:"",subCategory1:""},options:{productType:"",primaryCategory:""}},m=class{constructor(){this.detectDebugMode(),this._TronVersion="10.0.0";const e=function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"media"},componentInfo:{componentName:"video player",componentID:"video player"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"automatic",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentDEVagency"],e.baseMandatoryData=[],e.baseOptionalData=["componentPlatform","componentType","componentVersion","userLoginStatus","userProfileID","userStateProvince","userLanguage","userSegment","userCountry","solutionSpecific1","solutionSpecific2","solutionSpecific3","solutionSpecific4","solutionSpecific5","solutionSpecific6","solutionSpecific7","solutionSpecific8","solutionSpecific9","solutionSpecific10"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].productID","options[n].productID"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"],e.allowedVideoTotalLength=["value should be numeric"],e.allowedVideoCurrentTime=["value should be numeric"],e.allowedUserLoginStatus=["logged in","not logged in"],e.alloweduserLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.alloweduserSegment=["business customer","private customer"],e.alloweduserCountry=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"]},t=function(e){e.events||(e.events={}),e.events=Object.assign(e.events,{["VideoStarted".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger everytime the user starts a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n    <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n    <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n    <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>\'videoName\'</b> is the name of the specific video</li>\n    <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>'},["VideoStartedAutomatic".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video started",eventAction:"media played",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video starts automatically (autoplay). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},["VideoStopped".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video paused",eventAction:"media paused",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger everytime the user stopps / pauses a video. \n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n    <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n    <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n    <li><b>'videoName'</b> is the name of the specific video</li>\n    <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n    <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n    </ul>"},["VideoEnded".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video finished",eventAction:"media stopped",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:'Trigger when a video is automatically stopped (end of video). \n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop.\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class="tablinks" onclick="openAcc(event,\'allowed-values\')", style= "color: rgb(3, 104, 172),">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class="tablinks" onclick="openAcc(event,\'project-values\')", style= "color: rgb(3, 104, 172)">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href="https://atc.bmwgroup.net/confluence/x/CTBiL"target="_blank">glossary</a>.</li>\n        <li><b>\'componentDEVagency\'</b> this is the name of the agency who created the video / implemented it\'s tracking</li>\n        <li><b>\'videoHosting\'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>\'videoName\'</b> is the name of the specific video</li>\n        <li><b>\'videoTotalLength\'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>\'videoCurrentTime\'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>'},["VideoMilestoneReached25".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 25% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 25% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},["VideoMilestoneReached50".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 50% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 50% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"},["VideoMilestoneReached75".replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"video",effect:"video 75% viewed",eventAction:"media milestone reached",cause:"automatic"})},mandatoryData:e.baseMandatoryData.concat(["componentDEVagency"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["videoHosting","videoName","videoTotalLength","videoCurrentTime","eventPoints"]).filter((e=>!["componentDEVagency"].includes(e))),description:"Trigger when a playing video reaches 75% of its total length.\n    <br> This must only be triggered once per visit and not everytime in case of non-stop automatic loop and only if the 'videoTotalLength' is more than 10 seconds.\n    <br> If the 'videoTotalLength' is less than 10 seconds, this function must not be triggered at all.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'allowed-values')\", style= \"color: rgb(3, 104, 172),\">allowed values</a> tab on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <a class=\"tablinks\" onclick=\"openAcc(event,'project-values')\", style= \"color: rgb(3, 104, 172)\">library specific values w/o check</a> tab on top to see samples.</li>     \n        <li>Explanations of all predefined values and schemas can be found in the <a href=\"https://atc.bmwgroup.net/confluence/x/CTBiL\"target=\"_blank\">glossary</a>.</li>\n        <li><b>'componentDEVagency'</b> this is the name of the agency who created the video / implemented it's tracking</li>\n        <li><b>'videoHosting'</b> is used to track where the video is stored eg on youtube, vimeo, etc.</li>\n        <li><b>'videoName'</b> is the name of the specific video</li>\n        <li><b>'videoTotalLength'</b> captures the total amount of seconds the whole video lasts as numeric value in seconds</li>\n        <li><b>'videoCurrentTime'</b> captures the amount of seconds already watched as numeric value in seconds</li>\n        </ul>"}})},a=function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:"Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it's available to you at the moment the error occurred.\n                <br>Please consult the <a href=\"https://atc.bmwgroup.net/confluence/x/wayJ0w\" target=\"_blank\">Adobe Analytics Events Tracking Standards & Guidelines confluence page</a> for further details.\n                <br>\n                <ul>\n                <li><b>'errorAction'</b> is used to capture the action that lead to the error. Please check the allowed values.</li>\n                <li><b>'errorCause'</b> describes what technically lead to the error. </li>\n                <li><b>'errorCode'</b> is the code in the respective error log system so developers can easily identify the error in their system. </li>\n                <li><b>'errorMessage'</b> is the error message displayed to the user in the frontend</li>\n                <li><b>'errorOrigin'</b> is used to capture the system that caused the error eg. gcdm, pdh, etc.</li>\n                <li><b>'errorType'</b> captures the type of error.</li>\n                <li><b>'errorURL'</b> is the target URL of the button/link that was clicked before the error.</li>\n                </ul>"},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints","requestedURL"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.\n      <br>\n      <ul>\n      <li><b>\'requestedURL\'</b> if the link ID ends with "download" or "outbound click" you must provide the target URL / pdf (document) URL in this parameter.</li>\n      </ul>\n      '}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention","toggle","form first interaction"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""};(function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=d.customeEventName,e._componentTrackingVersion=d.libraryName+""+d.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`})(this),e(this),a(this),t(this);let o=Object.keys(this).filter((e=>e.includes("allowed")));for(let e in o)this[o[e]]=this[o[e]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(let l in this.events){var t=JSON.parse(JSON.stringify(this.events[l].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[l].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(let e in i)for(let t in i[e]){var n=i[e][t];(n=n.indexOf("[n].")>-1?n.replace("[n].",""):n).includes("searchsearch")&&(n=n.replace("searchsearch","search"));var r=o.filter((e=>e.includes(n.toLowerCase())));if(("string"==typeof n&&1==r.length||"string"==typeof n&&r.length>1&&r[0].includes(n)||"string"==typeof n&&r.length>1&&r[0].includes(n.toLowerCase()))&&["optionscode"].indexOf(n)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(r[0])]])){var s;if("eventEffect"==n?(s=[],l.toLowerCase().indexOf("viewactions")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):"stepName"==n?(s=[],l.toLowerCase().indexOf("checkoutprocess")>-1?r[0].indexOf("generic")>-1&&(s=this[Object.keys(this)[o.indexOf(r[0])]]):r.length>1?s=this[Object.keys(this)[o.indexOf(r[1])]]:1==r.length&&r[0].indexOf("generic")<0&&(s=this[Object.keys(this)[o.indexOf(r[0])]])):(r=r.filter((e=>!e.includes("generic"))),s=this[Object.keys(this)[o.indexOf(r[0])]]),(s||[]).length>0){var c="Possible Options: "+(s=s.filter((function(e){return""!==e}))).join(", ").toString();i[e][t]='<span style="color: #1000ff;font-weight: bold;" title="'+c+'">'+i[e][t]+"</span>"}"eventEffect"!=n&&"stepName"!=n||l.toLowerCase().indexOf("viewactions")<0&&l.toLowerCase().indexOf("checkoutprocess")<0&&r.length<=1&&r[0].indexOf("generic")>-1&&(i[e][t]=n)}}e[l]={description:this.events[l].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}supportedTRONfunctions(){let e={},t=this.getSupportedEvents();for(var a in t)t[a].description=t[a].description.replace(/<(.|\n)*?>/g,""),t[a]["mandatory parameters"]=this.cleanParameters(t[a]["mandatory parameters"]),t[a]["optional parameters"]=this.cleanParameters(t[a]["optional parameters"]);if(void 0!==this.mappings){for(let a in this.mappings)e[a]=t[a],delete t[a],e[a]["other names for same function"]={},this.mappings[a].forEach((o=>{e[a]["other names for same function"][o]={},e[a]["other names for same function"][o]=t[o],delete t[o]}));for(let a in t)e[a]=t[a],delete t[a]}else e=JSON.parse(JSON.stringify(t));console.log(e)}cleanParameters(e){return(e=(e=(e=e.replace(/<span[^>]*title="Possible Options:[^"]*"[^>]*>(.*?)<\/span>/gi,((e,t)=>t.trim()))).replace(/<[^>]+>/g,"")).split(",").map((e=>e.trim())).filter((e=>""!==e))).join(", ")}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(let e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){let t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(let t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}roundToDecimal(e,t){let a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o+""||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{let i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){let t=[];this.findPIIMatches(e,null,t);let a=Object.values(t.reduce(((e,t)=>{let{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(e,t){void 0===t&&(t={}),window.TRON.currentEventName=e,window.TRON.prefix=d.prefix,window.TRON.componentName=d.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==t&&(void 0!==t.componentName&&(window.TRON.componentName=t.componentName),void 0!==t.formOrigin&&(window.TRON.componentName=t.formOrigin),void 0!==t.componentDEVagency&&(window.TRON.componentName=window.TRON.componentName+" "+t.componentDEVagency)),window.TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e;var a=`${p()}/${u([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==t&&void 0!==t.pageGeoRegion&&t.pageGeoRegion.toLowerCase()])}_${u([()=>void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")||(window.adobeDataLayer.getState("page.pageInfo.language").indexOf("-")>-1?(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.language")).split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==t&&void 0!==t.pageLanguage?t.pageLanguage.toLowerCase():"")])}/${window.TRON.componentName}`;window.TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:window.TRON.componentName,componentID:a},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var o=JSON.parse(JSON.stringify(t));this._debug("💡 event triggered:"+e,o),t=this.transformData(t),t=this._trimWhitespace(t),this.scanForPIIKeywords(t),this._checkParamsPassed(e,o,t),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(t),this.message=this._loadEventData(e,t);try{this._checkmandatoryData(e,t),this.events[e].optionalData&&this._checkOptionalData(e,t)}catch(N){return"object"==typeof N&&void 0!==N.name&&"SyntaxError"==N.name&&void 0!==N.message&&"Missing Mandatory Data"==N.message||window.TRON.customConsole.error(N),!1}var i=d.prefix;if(void 0!==t.componentDEVagency&&(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName+" "+t.componentDEVagency),void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,e,t)}catch(O){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,e,t)}catch(I){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,e,t)}catch(T){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,e,t)}catch(A){return!1}function n(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=u([()=>t.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=u([()=>t.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=u([()=>t.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==t.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==t.componentName?(this.message.component[0].componentInfo.componentName=t.componentName,this.message.event[0].category.primaryCategory=t.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName||TRON.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==t.componentPlatform&&(this.message.component[0].attributes.platform=u([()=>t.componentPlatform]));var r=void 0!==i?i:TRON.prefix,s={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},c=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},l=void 0!==s[r]?s[r]:(c.category||{}).primaryCategory||"";if(void 0!==t&&void 0!==t.componentPrimaryCat&&void 0===i&&"nsc > "==TRON.prefix&&null!=n(s,t.componentPrimaryCat)&&(i=r=n(s,t.componentPrimaryCat)),""==l||"shared > "==r||"local > "==r)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(m=location.host).split(".")[1];var m,g=m.split(".")[0],h=(m=location.host).split(".")[1],v=location.pathname.split("/")[1].length;"com"===m.split(".")[2]&&"bmw"===h&&2===v?(l="special website",r="special > "):"bmw"===h||"mini"===h||"bmw-motorrad"===h||"bmwusa"===h||"rolls-roycemotorcars"===h||"bmwgroup"===h&&"customer"===g||"bmwgroup"===h&&"tron"===g?(l="nsc website",r="nsc > "):(l="special website",r="special > ")}else l="special website",r="special > ";if(void 0!==i&&(i=r),void 0!==TRON.prefix&&(TRON.prefix=r),this.message.component[0].category.primaryCategory=l,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),void 0!==t.videoTotalLength&&"number"!=typeof t.videoTotalLength){if(this.events[e].mandatoryData.indexOf("videoTotalLength")>-1)return void this._throwError("m","videoTotalLength","incorrect-numeric","");this._throwError("o","videoTotalLength","incorrect-numeric",""),t.videoTotalLength=""}if(void 0!==t.videoCurrentTime&&"number"!=typeof t.videoCurrentTime){if(this.events[e].mandatoryData.indexOf("videoCurrentTime")>-1)return void this._throwError("m","videoCurrentTime","incorrect-numeric","");this._throwError("o","videoCurrentTime","incorrect-numeric",""),t.videoCurrentTime=""}if(void 0!==t.videoName&&(this.message.component[0].componentInfo.componentID=u([()=>this.message.component[0].componentInfo.componentID+" > "+t.videoName]),this.message.event[0].category.subCategory1=u([()=>t.videoName])),void 0!==t.videoHosting&&(this.message.event[0].category.subCategory2=u([()=>t.videoHosting])),void 0!==t.videoTotalLength&&(this.message.event[0].attributes.media.totalLength=u([()=>t.videoTotalLength||0])),void 0!==t.videoCurrentTime&&(this.message.event[0].attributes.media.currentTime=u([()=>t.videoCurrentTime||0])),delete this.message.custom.videoCurrentTime,delete this.message.custom.videoName,delete this.message.custom.videoTotalLength,void 0!==t.solutionSpecific1&&(this.message.event[0].attributes.solutionSpecific.evar151=u([()=>t.solutionSpecific1])),void 0!==t.solutionSpecific2&&(this.message.event[0].attributes.solutionSpecific.evar152=u([()=>t.solutionSpecific2])),void 0!==t.solutionSpecific3&&(this.message.event[0].attributes.solutionSpecific.evar153=u([()=>t.solutionSpecific3])),void 0!==t.solutionSpecific4&&(this.message.event[0].attributes.solutionSpecific.evar154=u([()=>t.solutionSpecific4])),void 0!==t.solutionSpecific5&&(this.message.event[0].attributes.solutionSpecific.evar155=u([()=>t.solutionSpecific5])),void 0!==t.solutionSpecific6&&(this.message.event[0].attributes.solutionSpecific.evar156=u([()=>t.solutionSpecific6])),void 0!==t.solutionSpecific7&&(this.message.event[0].attributes.solutionSpecific.evar157=u([()=>t.solutionSpecific7])),void 0!==t.solutionSpecific8&&(this.message.event[0].attributes.solutionSpecific.evar158=u([()=>t.solutionSpecific8])),void 0!==t.solutionSpecific9&&(this.message.event[0].attributes.solutionSpecific.evar159=u([()=>t.solutionSpecific9])),void 0!==t.solutionSpecific10&&(this.message.event[0].attributes.solutionSpecific.evar160=u([()=>t.solutionSpecific10])),t&&t.userLoginStatus&&void 0!==t.userLoginStatus){let C=t.userLoginStatus;if(!this.allowedUserLoginStatus.includes(C)){let S="string"==typeof t.userLoginStatus&&0==t.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",S,this.allowedUserLoginStatus)}t.userLoginStatus=C}if(void 0!==t&&void 0!==t.userLanguage)if(2!=t.userLanguage.length){if(this.events[e].mandatoryData.indexOf("userLanguage")>-1){let k="string"==typeof t.userLanguage&&0==t.userLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","userLanguage",k,"","(has to follow ISO standard of 2 letters in uppercase)")}{let F=("string"==typeof t.userLanguage&&t.userLanguage.trim().length,"incorrect-o");this._throwError("o","userLanguage",F,"","(has to follow ISO standard of 2 letters in uppercase)"),t.userLanguage=""}}else t.userLanguage=(t.userLanguage||"").toLowerCase();if(void 0!==t&&void 0!==t.userCountry)if(2==t.userCountry.length)t.userCountry=(t.userCountry||"").toUpperCase();else if(t.userCountry=(t.userCountry||"").toLowerCase(),!["global"].includes(t.userCountry)){if(this.events[e].mandatoryData.indexOf("userCountry")>-1){let x="string"==typeof t.userCountry&&0==t.userCountry.trim().length?"empty":"incorrect";return void this._throwError("m","userCountry",x,this.alloweduserCountry)}{let P=("string"==typeof t.userCountry&&t.userCountry.trim().length,"incorrect-o");this._throwError("o","userCountry",P,this.alloweduserCountry),t.userCountry=""}}try{this._validateProperty("userSegment",this.alloweduserSegment,e,t)}catch(V){return!1}if(void 0!==t.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=u([()=>t.userLoginStatus])),void 0!==t.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=u([()=>t.userProfileID])),void 0!==t.userSegment&&(this.message.user[0].segment=u([()=>t.userSegment])),void 0!==t.userType&&(this.message.user[0].profile[0].profileInfo.type=u([()=>t.userType])),void 0!==t.userStateProvince&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.stateProvince=u([()=>t.userStateProvince])),void 0!==t.userCountry&&(void 0===this.message.user[0].profile[0].profileInfo.address&&(this.message.user[0].profile[0].profileInfo.address={}),this.message.user[0].profile[0].profileInfo.address.country=u([()=>t.userCountry])),void 0!==t.userLanguage&&(this.message.user[0].profile[0].profileInfo.language=u([()=>t.userLanguage])),void 0!==t&&t.componentVersion&&(this.message.component[0].attributes.componentVersion=t.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==t&&(this.message.component[0].componentInfo.componentID=p(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.pageGeoRegion?t.pageGeoRegion:"")||void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&window.adobeDataLayer.getState("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==t.formType?t.formType:"")),window.TRON.componentName=(void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName||window.TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==i&&(i=i.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(i||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var y=[],f=[];for(var b in this.message.product)if(void 0!==this.message.product[b]&&void 0!==this.message.product[b].productInfo){var D=this.message.product[b].productInfo.productID;void 0===D&&(D="product"+(b+1)),y.push(D),void 0!==this.message.product[b].category.primaryCategory&&(this.message.product[b].category.primaryCategory.indexOf("car")>-1||this.message.product[b].category.primaryCategory.indexOf("bike")>-1)&&f.push(D)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(f):this.message.page.pageInfo.reference.defaultProducts=[].concat(y)}if(Object.keys(t).some((e=>e.startsWith("user")))||delete this.message.user,"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==t.errorMessage?(i||"")+t.errorMessage:"",void 0!==t.errorAction&&(this.message.event[0].eventInfo.eventAction=t.errorAction),void 0!==t.errorCause&&(this.message.event[0].eventInfo.cause=t.errorCause),void 0!==t.errorType&&(this.message.event[0].eventInfo.type=t.errorType),this.message.event[0].category.primaryCategory=t.componentName||this.message.component[0].componentInfo.componentName,void 0!==t.errorCode&&(this.message.event[0].category.subCategory1=t.errorCode),void 0!==t.errorOrigin&&(this.message.event[0].category.subCategory2=t.errorOrigin),void 0!==t.errorURL&&(this.message.event[0].attributes.requestedURL=t.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),t.eventCause&&null!=t.eventCause&&(this.message.event[0].eventInfo.cause=t.eventCause),t.requestedURL&&null!=t.requestedURL&&(this.message.event[0].attributes.requestedURL=t.requestedURL),void 0!==t.iframeURL&&(this.message.event[0].attributes.relatedURL=u([()=>t.iframeURL])),void 0!==t.eventPoints||"string"==typeof t.eventPoints&&0==t.eventPoints.trim().length){if(t.eventPoints=+t.eventPoints,"number"!=typeof t.eventPoints||NaN!=t.eventPoints){var w=void 0!==t.eventPoints&&""==t.eventPoints?"empty":"incorrect-numeric";if(this.events[e].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",w,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",w,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=isNaN(t.eventPoints)?void 0:+t.eventPoints}if(void 0===t.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==t.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof t.eventAction&&t.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=t.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),t.stepAmounts&&void 0!==t.stepAmounts&&(t.step&&void 0!==t.step?this.message.event[0].attributes.stepAmounts="step "+t.step+"/"+t.stepAmounts:this.message.event[0].attributes.stepAmounts=t.stepAmounts),void 0===t.stepAmounts&&t.step&&void 0!==t.step&&(this.message.event[0].attributes.stepAmounts="step "+t.step+"/x"),this.message.component[0].componentInfo.componentID=`${u([()=>window.adobeDataLayer.getState("page.attributes.brand"),()=>p()])||""}/${u([()=>window.adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${u([()=>window.adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(t)),void 0!==t){let W,_,E;if(W=_=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(E=this.message.cart.item.length-1;E>=0;E--){let R=!1;void 0!==this.message.cart.item[E]&&void 0!==this.message.cart.item[E].price&&(void 0!==this.message.cart.item[E].price.basePrice&&void 0!==this.message.cart.item[E].price.basePrice&&this.message.cart.item[E].price.basePrice>0||void 0!==this.message.cart.item[E].price.priceWithTax&&void 0!==this.message.cart.item[E].price.priceWithTax&&this.message.cart.item[E].price.priceWithTax>0)&&(R=!0);let j=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(j=!0));let M=void 0!==t.transactionID&&""!=t.transactionID;R||j||R||j||M?M&&this.message.cart.item.splice(E,1):this.message.cart.item.splice(E,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&W.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(E=this.message.transaction.item.length-1;E>=0;E--){let J=!1;void 0!==this.message.transaction.item[E]&&void 0!==this.message.transaction.item[E].price&&(void 0!==this.message.transaction.item[E].price.basePrice&&void 0!==this.message.transaction.item[E].price.basePrice&&this.message.transaction.item[E].price.basePrice>0||void 0!==this.message.transaction.item[E].price.priceWithTax&&void 0!==this.message.transaction.item[E].price.priceWithTax&&this.message.transaction.item[E].price.priceWithTax>0)&&(J=!0);let B=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(B=!0));let G=void 0!==t.transactionID&&""!=t.transactionID;J||B?G||this.message.transaction.item.splice(E,1):!G||J||B||this.message.transaction.item.splice(E,1),""!=(((this.message.transaction.item[E]||"").productInfo||"").productID||"")&&W.indexOf(this.message.transaction.item[E].productInfo.productID)>-1&&this.message.transaction.item.splice(E,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&_.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(E=this.message.product.length-1;E>=0;E--){let $=!1;void 0!==this.message.product[E]&&void 0!==this.message.product[E].price&&(void 0!==this.message.product[E].price.basePrice&&void 0!==this.message.product[E].price.basePrice&&this.message.product[E].price.basePrice>0||void 0!==this.message.product[E].price.priceWithTax&&void 0!==this.message.product[E].price.priceWithTax&&this.message.product[E].price.priceWithTax>0)&&($=!0);let U=!1;void 0!==t&&(void 0===t.totalBasePrice&&void 0===t.totalPriceWithTax||(U=!0));let q=void 0!==t.transactionID&&""!=t.transactionID;$&&this.message.product.splice(E,1),!U||q||$||(W.indexOf(this.message.product[E].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[E]),this.message.product.splice(E,1)),U&&q&&(_.indexOf(this.message.product[E].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[E]),this.message.product.splice(E,1)),""!=(((this.message.product[E]||"").productInfo||"").productID||"")&&(W.indexOf(this.message.product[E].productInfo.productID)>-1||_.indexOf(this.message.product[E].productInfo.productID)>-1)&&this.message.product.splice(E,1)}function L(e){return-1*Math.abs(Number(e))}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(t.totalCurrency||"").toUpperCase();let H=0;Object.keys(this.message.cart.item).forEach((e=>{H+=(e.price||0).basePrice||0})),H=this.roundToDecimal(H,2),this.message.cart.price.basePrice=+(u([()=>t.totalBasePrice,()=>H,()=>0])||0),this.message.cart.price.discountAmountAdditional=L(+(u([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(u([()=>t.totalTaxAmountAdditional,()=>0])||0);let K=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(K+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(K+=e.price.discountAmountOther||0)})),K=this.roundToDecimal(K,2),this.message.cart.price.discountItemAmounts=L(this.roundToDecimal(K,2)),this.message.cart.price.discountAmountSum=L(this.roundToDecimal(+(u([()=>t.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let z=0;Object.keys(this.message.cart.item).forEach((e=>{z+=(e.price||0).taxAmount||0})),z=this.roundToDecimal(z,2),this.message.cart.price.taxItemsAmount=this.roundToDecimal(z,2),this.message.cart.price.taxAmountSum=+(u([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=this.roundToDecimal(+(u([()=>t.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=this.roundToDecimal(+(u([()=>t.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=this.roundToDecimal(+(u([()=>t.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=t.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(t.totalCurrency||"").toUpperCase();let Q=0;Object.keys(this.message.transaction.item).forEach((e=>{Q+=(e.price||0).basePrice||0})),Q=this.roundToDecimal(Q,2),this.message.transaction.total.basePrice=+(u([()=>t.totalBasePrice,()=>Q,()=>0])||0),this.message.transaction.total.discountAmountAdditional=L(+(u([()=>t.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(u([()=>t.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=this.roundToDecimal(+(u([()=>t.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=u([()=>t.totalPaymentMethod,()=>""])||"";let Y=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Y+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Y+=e.price.discountAmountOther||0)})),Y=this.roundToDecimal(Y,2),this.message.transaction.total.discountItemAmounts=L(this.roundToDecimal(Y,2)),this.message.transaction.total.discountAmountSum=L(this.roundToDecimal(+(u([()=>t.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let X=0;Object.keys(this.message.transaction.item).forEach((e=>{X+=(e.price||0).taxAmount||0})),X=this.roundToDecimal(X,2),this.message.transaction.total.taxItemsAmount=this.roundToDecimal(X,2),this.message.transaction.total.taxAmountSum=+(u([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=this.roundToDecimal(+(u([()=>t.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=this.roundToDecimal(+(u([()=>t.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=t.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c.length>0&&c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID","userLanguage","userSegment","userCountry","formType"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){if(t=t.split(".")[1],["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"].indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){let e=["codeVG"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){let e=["selectionState"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){let e=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],e.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){let a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));let o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),d.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),d.projConditionCheck&&d.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};let r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){let n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ",r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"l-incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value: ${o} ${i||""}`;break;case"l-incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value: ${o} ${i||""}`;break;case"l-empty":r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t}: ${o} ${i||""}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?window.TRON.customConsole.error(r):"o"==e&&window.TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),window.TRON.customConsole.info(t),console.groupEnd()):window.TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){var e=g(this.message),t={};e.forEach((e=>{Object.keys(e).forEach((a=>{t[a]=e[a]}))})),this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=g(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function u(e,t={}){return function(e,t){for(let a of e)try{let e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function p(){return u([()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function g(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)if(void 0!==n[r]&&void 0!==n[r].productInfo){var s=n[r].productInfo.productID;void 0===s&&(s="product"+(+r+1)),a[s]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(s)}Object.keys(a).forEach((e=>o.push(e)));var c=a}var l="page view"==e.event[0].eventInfo.eventName,d=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),m=((e.page||"").pageInfo||"").pageName||"";if(l&&(d?"tbd"!=m&&""!=m&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):d||("tbd"!=m&&""!=m||void 0!==m)&&(l&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page}))),!l&&"tbd"!=m&&""!=m&&void 0!==m){var p=m.split(">");""!=(p=(p=p.length>1?p[1]:p[0]).trim())&&"tbd"!=p&&t.push({page:JSON.parse(JSON.stringify(e.page,((e,t)=>""==t?void 0:t)))})}let g={},h=e.component[0].componentInfo.componentID;g[h]=e.component[0],t.push({component:g});var v={},y=e.cart;if(y&&y.item.length>0&&"string"!=typeof y){for(let E in y.item)if(void 0!==y.item[E]&&void 0!==y.item[E].productInfo){let L=y.item[E].productInfo.productID;void 0!==L&&(v[L]=y.item[E])}v=Object.assign({},v);for(let R in v)for(let j in e.cart.item)R==e.cart.item[j].productInfo.productID&&(v[R].price=Object.assign({},e.cart.item[j].price),v[R].quantity=e.cart.item[j].quantity);var f={item:v,price:e.cart.price,cartID:e.cart.cartID}}var b={},D=e.transaction;if(D&&D.item.length>0&&"string"!=typeof D&&void 0!==D.transactionID){for(let M in D.item)if(void 0!==D.item[M]&&void 0!==D.item[M].productInfo){let J=D.item[M].productInfo.productID;void 0!==J&&(b[J]=D.item[M])}b=Object.assign({},b);for(let B in b)for(let G in e.transaction.item)B==e.transaction.item[G].productInfo.productID&&(b[B].price=Object.assign({},e.transaction.item[G].price),b[B].quantity=e.transaction.item[G].quantity);var w={item:b,total:e.transaction.total,transactionID:e.transaction.transactionID}}var N={},O={},I=e.dealer;if(I.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(window.adobeDataLayer.getState("dealer")).map((function(e){return window.adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(let $ in I)if(void 0!==I[$]&&void 0!==I[$].dealerInfo){var T=I[$].dealerInfo.dealerOutletBuno;void 0!==T&&(N[T]=I[$])}Object.keys(N).forEach((e=>O[e]="")),O=Object.keys(O),Object.keys(N).length>0&&t.push({dealer:N})}e.user&&e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(window.adobeDataLayer.getState("user")).map((function(e){return window.adobeDataLayer.getState("user")[e]})));var A={},C={};if(e.user&&e.user.length>0&&"string"!=typeof e.user){var S={},k=e.user;for(let q in k){var F,x={};if(Array.isArray(k[q].profile)&&k[q].profile.length>0)for(let H in k[q].profile){var P=null!=k[q].profile[H].profileInfo.profileID?k[q].profile[H].profileInfo.profileID:"profile"+(+H+1);x[P]=JSON.parse(JSON.stringify(k[q].profile[H]))}else if(void 0===k[q].profile&&void 0!==k[q].profileInfo&&!Array.isArray(k[q].profileInfo)){let K="profile"+(+q+1);x.profile={},x.profile[K]=JSON.parse(JSON.stringify(k[q].profileInfo))}S[F=P]=JSON.parse(JSON.stringify(k[q])),delete S[F].profile,S[F]=Object.assign({},S[F],JSON.parse(JSON.stringify(x[F])))}let U=JSON.parse(JSON.stringify(S));Object.keys(S).forEach((e=>A[e]="")),A=Object.keys(A),Object.keys(S).forEach((e=>C[e]="")),C=Object.keys(C),t.push({user:U})}var V={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,version:e.version,reference:{linkedComponent:[h],linkedUser:A}}};if(V.eventInfo=JSON.parse(JSON.stringify(V.eventInfo,((e,t)=>{if("object"!=typeof t||0!==Object.keys(t).length)return t}))),void 0!==e.paramsPassed){let z,Q,Y,X=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(z=void 0!==window.adobeDataLayer.getState("cart")&&Object.keys(window.adobeDataLayer.getState("product"))||[],Q=void 0!==window.adobeDataLayer.getState("cart")&&void 0!==window.adobeDataLayer.getState("cart.item")&&Object.keys(window.adobeDataLayer.getState("cart.item"))||[],Y=void 0!==window.adobeDataLayer.getState("transaction")&&void 0!==window.adobeDataLayer.getState("transaction.item")&&Object.keys(window.adobeDataLayer.getState("transaction.item"))||[]):z=Q=Y=[],void 0===w&&(w={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===f&&(f={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==c&&void 0!==c&&Object.keys(c).length>0)for(var W in c){let ee=!1;void 0!==c[W]&&void 0!==c[W].price&&(void 0!==c[W].price.basePrice&&void 0!==c[W].price.basePrice&&c[W].price.basePrice>0||void 0!==c[W].price.priceWithTax&&void 0!==c[W].price.priceWithTax&&c[W].price.priceWithTax>0)&&(ee=!0);let te=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(te=!0));let ae=void 0!==X.transactionID&&""!=X.transactionID;ee||te?ae?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):Y.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):Q.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(z.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==f&&Object.keys(f.item).length>0)for(let oe in f.item){let ie=!1;void 0!==f.item[oe]&&void 0!==f.item[oe].price&&(void 0!==f.item[oe].price.basePrice&&void 0!==f.item[oe].price.basePrice&&f.item[oe].price.basePrice>0||void 0!==f.item[oe].price.priceWithTax&&void 0!==f.item[oe].price.priceWithTax&&f.item[oe].price.priceWithTax>0)&&(ie=!0);let ne=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(ne=!0));let re=void 0!==X.transactionID&&""!=X.transactionID;ie||ne?re?V.eventInfo.reference.linkedTransactionItems.push(oe):V.eventInfo.reference.linkedCartItems.push(oe):Y.includes(oe)?V.eventInfo.reference.linkedTransactionItems.push(oe):Q.includes(oe)?V.eventInfo.reference.linkedCartItems.push(oe):(z.includes(oe),V.eventInfo.reference.linkedProducts.push(oe))}if(void 0!==w&&Object.keys(w.item).length>0)for(let se in w.item){let ce=!1;void 0!==w.item[se]&&void 0!==w.item[se].price&&(void 0!==w.item[se].price.basePrice&&void 0!==w.item[se].price.basePrice&&w.item[se].price.basePrice>0||void 0!==w.item[se].price.priceWithTax&&void 0!==w.item[se].price.priceWithTax&&w.item[se].price.priceWithTax>0)&&(ce=!0);let le=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(le=!0));let de=void 0!==X.transactionID&&""!=X.transactionID;ce||le?de?V.eventInfo.reference.linkedTransactionItems.push(se):V.eventInfo.reference.linkedCartItems.push(se):Y.includes(se)?V.eventInfo.reference.linkedTransactionItems.push(se):Q.includes(se)?V.eventInfo.reference.linkedCartItems.push(se):(z.includes(se),V.eventInfo.reference.linkedProducts.push(se))}function Z(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===w||void 0===w.item||Object.keys(w).includes(a)?void 0===w&&(void 0===w||void 0===w.item||Object.keys(w.item).includes(W)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(c[W]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(W)&&(w.item[W]=JSON.parse(JSON.stringify(f.item[W]))))):(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(w.item[a]=JSON.parse(JSON.stringify(f.item[a])))),Z(c,a),Z(f?.item,a)):"linkedCartItems"===e?(void 0===f||void 0===f.item||Object.keys(f.item).includes(a)||(void 0!==c&&Object.keys(c).length>0&&Object.keys(c).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(c[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(f.item[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(c,a),Z(w?.item,a)):"linkedProducts"===e&&(void 0!==c&&Object.keys(c).length>0&&!Object.keys(c).includes(a)&&(void 0!==f&&Object.keys(f.item).length>0&&Object.keys(f.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(f.item[a]))),void 0!==w&&void 0!==w.item&&Object.keys(w.item).includes(a)&&(c[a]=JSON.parse(JSON.stringify(w.item[a])))),Z(f?.item,a),Z(w?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{let t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(w=w||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==w.total&&1==Object.keys(w.total).length){function me(e){return-1*Math.abs(Number(e))}w.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ue=0;Object.keys(w.item).forEach((e=>{ue+=(e.price||0).basePrice||0})),ue=this.roundToDecimal(ue,2),w.total.basePrice=+(u([()=>e.paramsPassed.totalBasePrice,()=>ue,()=>0])||0),w.total.discountAmountAdditional=me(+(u([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),w.total.taxAmountAdditional=+(u([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),w.total.shipping=this.roundToDecimal(+(u([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),w.total.paymentMethod=u([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let pe=0;Object.keys(w.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(pe+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(pe+=e.price.discountAmountOther||0)})),pe=this.roundToDecimal(pe,2),w.total.discountItemAmounts=me(this.roundToDecimal(pe,2)),w.total.discountAmountSum=me(this.roundToDecimal(+(u([()=>e.paramsPassed.totalDiscountAmount,()=>w.total.discountItemAmounts+w.total.discountAmountAdditional,()=>0])||0),2));let ge=0;Object.keys(w.item).forEach((e=>{ge+=(e.price||0).taxAmount||0})),ge=this.roundToDecimal(ge,2),w.total.taxItemsAmount=this.roundToDecimal(ge,2),w.total.taxAmountSum=+(u([()=>w.total.taxItemsAmount+w.total.taxAmountAdditional,()=>0])||0),w.total.priceWithTax=this.roundToDecimal(+(u([()=>e.paramsPassed.totalPriceWithTax,()=>w.total.basePrice+w.total.discountAmountSum+w.total.taxAmountSum,()=>0])||0),2),w.total.transactionTotal=this.roundToDecimal(+(u([()=>e.paramsPassed.totalFinalPrice,()=>w.total.priceWithTax+w.total.shipping,()=>0])||0),2)}if(void 0!==f&&void 0!==f.price&&1==Object.keys(f.price).length){function he(e){return-1*Math.abs(Number(e))}f.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let ve=0;Object.keys(f.item).forEach((e=>{ve+=(e.price||0).basePrice||0})),ve=this.roundToDecimal(ve,2),f.price.basePrice=+(u([()=>e.paramsPassed.totalBasePrice,()=>ve,()=>0])||0),f.price.discountAmountAdditional=he(+(u([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),f.price.taxAmountAdditional=+(u([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ye=0;Object.keys(f.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ye+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ye+=e.price.discountAmountOther||0)})),ye=this.roundToDecimal(ye,2),f.price.discountItemAmounts=he(this.roundToDecimal(ye,2)),f.price.discountAmountSum=he(this.roundToDecimal(+(u([()=>e.paramsPassed.totalDiscountAmount,()=>f.price.discountItemAmounts+f.price.discountAmountAdditional,()=>0])||0),2));let fe=0;Object.keys(f.item).forEach((e=>{fe+=(e.price||0).taxAmount||0})),fe=this.roundToDecimal(fe,2),f.price.taxItemsAmount=this.roundToDecimal(fe,2),f.price.taxAmountSum=+(u([()=>f.price.taxItemsAmount+f.price.taxAmountAdditional,()=>0])||0),f.price.priceWithTax=this.roundToDecimal(+(u([()=>e.paramsPassed.totalPriceWithTax,()=>f.price.basePrice+f.price.discountAmountSum+f.price.taxAmountSum,()=>0])||0),2),f.price.shipping=this.roundToDecimal(+(u([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),f.price.cartTotal=this.roundToDecimal(+(u([()=>e.paramsPassed.totalFinalPrice,()=>f.price.priceWithTax+f.price.shipping,()=>0])||0),2)}["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{void 0!==V.eventInfo.reference[e]&&(V.eventInfo.reference[e]=V.eventInfo.reference[e].filter(((e,t,a)=>a.indexOf(e)===t)))}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==c&&void 0!==c&&Object.keys(c).length>0){for(var _ in c)Object.keys(c[_]).indexOf("price")>-1&&delete c[_].price,Object.keys(c[_]).indexOf("quantity")>-1&&delete c[_].quantity;t.push({product:a})}return void 0!==f&&Object.keys(f.item).length>0&&t.push({cart:f}),void 0!==w&&Object.keys(w.item).length>0&&(w.transactionID=(w.transactionID+"").toUpperCase(),t.push({transaction:w})),t.push(V),t}window.TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];let t=g(window.tronDetailDL),a={};if(t.forEach((e=>{Object.keys(e).forEach((t=>{a[t]=e[t]}))})),window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(let e in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[e]);window.TRON.warningCode=[]}})),window.TRON.isInitialized=!0),a(8787),a(3683)},7935:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>__WEBPACK_DEFAULT_EXPORT__}),window.TRON=window.TRON||{},window.TRON.warningCode=[],TRON.isInitialized||(window.TRON.customConsole,function(){function e(){return gFFWNV([()=>-1!=document.location.search.indexOf("trondebug=true"),()=>null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")])}function t(e,t){window.adobeDataLayer=window.adobeDataLayer||[];let a=TRON.dataComponent;function o(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}a[0].componentInfo.componentID=`${gFFWNV([()=>adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":""])||""}_${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.language"),()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${a[0].componentInfo.componentName}`;var i="undefined"!=typeof prefix?prefix:TRON.prefix,n={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},r=((void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{})||[])[0]||{},s=void 0!==n[i]?n[i]:(r.category||{}).primaryCategory||"";if("undefined"!=typeof mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&"undefined"==typeof prefix&&"nsc > "==TRON.prefix&&null!=o(n,mandatoryData.componentPrimaryCat)&&(prefix=i=o(n,mandatoryData.componentPrimaryCat)),""==s||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"].some((e=>window.location.href.includes(e)))){(c=location.host).split(".")[1];var c,l=c.split(".")[0],d=(c=location.host).split(".")[1],m=location.pathname.split("/")[1].length;"com"===c.split(".")[2]&&"bmw"===d&&2===m?(s="special website",i="special > "):"bmw"===d||"mini"===d||"bmw-motorrad"===d||"bmwusa"===d||"rolls-roycemotorcars"===d||"bmwgroup"===d&&"customer"===l||"bmwgroup"===d&&"tron"===l?(s="nsc website",i="nsc > "):(s="special website",i="special > ")}else s="special website",i="special > ";"undefined"!=typeof prefix&&(prefix=i),void 0!==TRON.prefix&&(TRON.prefix=i);let u={},p="";void 0!==a&&(a[0].category.primaryCategory=s,p=a[0].componentInfo.componentID,u[p]=a[0]);var g=TRON.version;g=g.split("¦"),e.indexOf("e0")>-1?g[g.length-1]="error_"+g[g.length-1]:e.indexOf("w0")>-1&&(g[g.length-1]="warning_"+g[g.length-1]);var h={component:u,version:g=g.join("¦"),event:"tron event",eventInfo:{cause:"TRON implementation > "+((TRON||"").currentEventName||""),effect:TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(TRON||"").componentName||"",subCategory1:e,subCategory2:"TRON library"},reference:{linkedComponent:[p]}}},v={},y=[],f=[],b=[];if(b.length>0&&"string"!=typeof b){for(var D in b)if(void 0!==b[D]&&void 0!==b[D].productInfo){var w=b[D].productInfo.productID;void 0===w&&(w="product"+(D+1)),v[w]=b[D],void 0!==b[D].category.primaryCategory&&(b[D].category.primaryCategory.indexOf("car")>-1||b[D].category.primaryCategory.indexOf("bike")>-1)&&f.push(w)}Object.keys(v).forEach((e=>y.push(e))),h.product=v}var N={},O={},I=[];if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(I=Object.keys(adobeDataLayer.getState("dealer")).map((function(e){return adobeDataLayer.getState("dealer")[e]}))),I.length>0&&"string"!=typeof I){for(var D in I)void 0!==I[D]&&void 0!==I[D].dealerInfo&&(N[I[D].dealerInfo.dealerOutletBuno]=I[D]);Object.keys(N).forEach((e=>O[e]="")),h.dealer=N}if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")){var T=window.adobeDataLayer.getState("user");void 0!==T&&Object.keys(T).length>0&&(h.user=T)}e.indexOf("w0")>-1?window.TRON.warningCode.push(h):window.adobeDataLayer.push(h)}TRON.customConsole={error:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⛔ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⛔ ")[1],r=Object.entries({e001:"parameter is missing",e002:"value is incorrect",e003:"value is empty"}).find((([e,t])=>n.includes(t)));t(r=r?r[0]:"Unknown error",n)}o?e()&&console.error.apply(console,arguments):console.error.apply(console,arguments)},info:function(){for(var t="",a=!1,o=0;o<arguments.length;o++)t+="number"==typeof arguments[o]||"string"==typeof arguments[o]?arguments[o]+" ":JSON.stringify(arguments[o])+" ";((t=t.split(" ").filter((e=>e)).join(" ")).indexOf("TEST check available events")>-1||t.indexOf("Incorrect TRON implementation: ⚠️")>-1)&&(a=!0),a?e()&&console.info.apply(console,arguments):console.info.apply(console,arguments)},warn:function(){for(var a="",o=!1,i=0;i<arguments.length;i++)a+="number"==typeof arguments[i]||"string"==typeof arguments[i]?arguments[i]+" ":JSON.stringify(arguments[i])+" ";if((a=a.split(" ").filter((e=>e)).join(" ")).indexOf("Incorrect TRON implementation: ⚠️ ")>-1){o=!0;var n=a.split("Incorrect TRON implementation: ⚠️ ")[1],r=Object.entries({w002:"value is incorrect"}).find((([e,t])=>n.includes(t)));"Unknown error"!=(r=r?r[0]:"Unknown error")&&t(r,n)}o?e()&&console.warn.apply(console,arguments):console.warn.apply(console,arguments)}}}());const PROJECT_SPECIFIC_DATA={customeEventName:"TRON: visualizer",libraryName:"visualizer",libraryVersion:"_v9.1.2",prefix:"con > ",pageExist:!0,vehicle:{productType:"new vehicle",primaryCategory:"new car",subCategory1:"build to order"},options:{productType:"new vehicle"}},__WEBPACK_DEFAULT_EXPORT__=class{constructor(){this.detectDebugMode(),this._TronVersion="6.0.2";const e={library:function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=PROJECT_SPECIFIC_DATA.customeEventName,e._componentTrackingVersion=PROJECT_SPECIFIC_DATA.libraryName+""+PROJECT_SPECIFIC_DATA.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`},defaults:function(e){e.component={category:{componentType:"native in-page",primaryCategory:"configurator",subCategory1:"new car configurator"},componentInfo:{componentName:"visualizer",componentID:"visualizer"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:""},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=["componentName"],e.baseMandatoryData=["componentName","componentVersion","vehicle[n].range","vehicle[n].name","vehicle[n].codeAG","vehicle[n].series","vehicle[n].manufacturer"],e.baseOptionalData=["componentDEVagency","componentPlatform","userProfileID"],e.productMandatoryData=[],e.productOptionalData=["vehicle[n].bodyType","vehicle[n].businessDivision","vehicle[n].category1","vehicle[n].category2","vehicle[n].category3","vehicle[n].codeVG","vehicle[n].color","vehicle[n].encVIN","vehicle[n].engine","vehicle[n].fuelType","vehicle[n].gearing","vehicle[n].hybridVersion","vehicle[n].packageID","vehicle[n].primaryCategory","vehicle[n].productID","vehicle[n].salesModel","vehicle[n].status","vehicle[n].subSeries","vehicle[n].linkedDealerCount","vehicle[n].linkedDealerOutletBuno","vehicle[n].itemBasePrice","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemShippingMethod","vehicle[n].itemTaxAmount","vehicle[n].itemVoucherCode","options[n].businessDivision","options[n].category1","options[n].category2","options[n].category3","options[n].codeVG","options[n].color","options[n].manufacturer","options[n].name","options[n].packageID","options[n].primaryCategory","options[n].productID","options[n].range","options[n].salesModel","options[n].size","options[n].status","options[n].linkedDealerCount","options[n].linkedDealerOutletBuno","options[n].itemBasePrice","options[n].itemDiscountOtherAmount","options[n].itemDiscountSalesAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemShippingMethod","options[n].itemTaxAmount","options[n].itemVoucherCode"],e.allowedPageSubCat1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels"],e.allowedComponentNames=["rolls-royce visualizer","visualizer","bmw individual visualizer","mini uk visualiser","visualizer trim"],e.allowedSections=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","exterior highlights","interior highlights","packages","roof and mirror caps","upholstery","wheels","winter wheels","series"],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"];var t=void 0!==e?e:this;t.allowedVehicleBodyType=["ca","hb","ko","co","cp","li","mp","ro","sc","st","gf","hc","sh","to","gs","ga","x","xr","gt","gl","r","rs","rr","rt","9p","9s","9u","b","s","9t","rrmc"],t.allowedVehicleBusinessDivision=["new vehicle","used vehicle","after sales","other"],t.allowedVehicleCategory1=["build to order","pre-order","build to stock","young used car","demonstration car","young used bike","demonstration bike","used car (excl. yuc)","used bike (excl. yub)","used (excl. yub)","young used","demonstration"],t.allowedVehicleFuelType=["b","o","d","e","g","h","m","t","x","y","z","rrmc"],t.allowedVehicleHybridVersion=["beve","erex","hybr","phev","nohy","rrmc"],t.allowedVehiclePrimaryCategory=["new car","used car","used bike","new bike","rental bike","rental car","owned bike","owned car"],t.allowedVehicleSeries=["1","2","3","4","5","6","7","8","x","i","m","z","clubman","5-doors","3-doors","cabrio","countryman","ad","gs","he","lt","ms","na","sp","mini","rrmc"],t.allowedVehicleStatus=["available for sale","sold out","order confirmed","pre-order confirmed","contract concluded","vehicle delivered","vehicle mapped","added item","removed item","automatically added item","automatically removed item","canceled","reservation confirmed","received","in production","ready","for delivery","delivered"],t.allowedVehiclecodeAG=["value should contain only 4 characters"],t.allowedVehiclecodeVG=["value should contain only 4 characters"],t.allowedVehicleSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],t.allowedVehiclelinkedDealerCount=["value should be numeric"],e.allowedOptionsBusinessDivision=["new vehicle","used vehicle","after sales","other"],e.allowedOptionsPrimaryCategory=["finance"],e.allowedOptionsCategory1=["accessories","car hood graphics","charging","colors","engine","interior trims","interior worlds","lines / trims","options","packages","roof and mirror caps","upholstery","wheels","winter wheels","standard equipment","loan","lease","physical goods","digital services","experience","authority","jochenschweitzer","bif internal","bif external","bif external partner","bif internal motorbike","bif external motorbike","voucher","employee private","bif seminar motorbike","experience offer"],e.allowedOptionsFinDownPayment=["value should be numeric"],e.allowedOptionsFinMileage=["value should be numeric"],e.allowedOptionsFinMonthlyPayment=["value should be numeric"],e.allowedOptionsFinTerm=["value should be numeric"],e.allowedOptionsStatus=["added item","removed item","automatically added item","automatically removed item","product available","service already booked","service renewable","service available","service expiring","service booked unlimited","product sold out"],e.allowedOptionscodeVG=["value should contain only 4 characters"],e.allowedOptionslinkedDealerCount=["value should be numeric"],e.allowedOptionsSalesModel=["indirect sales","direct sales b2b","direct sales b2c","direct sales"],e.allowedPageBrand=["bmw","mini","motorrad","bmw group","alphera","rolls-royce","alphabet"],e.allowedPageVariant=["real page","virtual page"],e.allowedUserLoginStatus=["logged in","not logged in"],e.allowedPageGeoRegion=["country code should be two letters ISO 3166 Alpha-2 country code or 'global'"],e.allowedPageLanguage=["language code should follow ISO standard of 2 letters in lowercase"],e.allowedPageSysEnv=["dev","int","prod","test","staging","preprod","e2e"],e.allowedFilterObjects=["accessory","content","dealer","finance","vehicle","service","brochure","event"],e.allowedSearchState=["preselected"],e.allowedListTypes=["wish list","compare list"],e.allowedViewModes=["360","3d"],e.allowedViewTypes=["exterior","interior"],e.allowedViewDayTimes=["day","night"],e.allowedViewScreens=["full screen","default screen"],e.allowedViewPerspectives=["rear","roof","side","front"],e.allowedEventEffectGeneric=["360","3d","exterior","interior","day","night","full screen","default screen","rear","roof","side","front","rotate","close doors","lights off","lights on","open doors","open roof","close roof","image background","close view"]},events:function(e){e.events||(e.events={});const t="visualizer";e.events=Object.assign(e.events,{[(t+"PageLoad").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{category:Object.assign({},JSON.parse(JSON.stringify(e.page.category)),{pageType:"overview"}),pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.errorMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName"]),optionalData:e.baseMandatoryData.filter((t=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].concat(e.errorMandatoryData).includes(t))).concat(e.baseOptionalData.filter((t=>!["componentDEVagency","formID"].concat(e.errorMandatoryData).includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","pageType","stepName"]),description:"Only trigger this event if the page is on a standalone page that doesn't have Adobe Analytics page view tracking implemented yet.Don't trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the \"page load\" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It's like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li><b>'componentDEVagency'</b> is used to capture the name of the agency that developed the page and implemented the analytics tracking of it</li>\n            <li><b>'pageBrand'</b> is used to capture the brand eg. \"bmw\", \"mini\", etc. If the page is showing content that's valid for multiple bmw group brands pass the value \"bmw group\" </li>\n            <li><b>'pageGeoRegion'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass \"global\"</li>\n            <li><b>'pageLanguage'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n            <li><b>'pageName'</b> is used to capture the page name, which is the most granular page value.</li>\n            <li><b>'pageSubCat1'</b> can be set to group the page names. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName' </li>\n            <li><b>'pageSubCat2'</b> can be set to group the page sub categories 1. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSubCat3'</b> can be set to group the page sub categories 2. Hierarchy is componentName ( =page primary category) > 'pageSubCat3' > 'pageSubCat2' > 'pageSubCat1' > 'pageName'</li>\n            <li><b>'pageSysEnv'</b> is used to capture the environment eg. \"dev\", \"prod\" etc. </li>\n            <li><b>'pageType'</b> is used to capture the page template type.</li>\n            <li><b>'pageVariant'</b> is used to capture the  if the page is a \"virtual page\". If it's a real page you don't have to set this parameter</li>\n            <li><b>'pageVersion'</b> is used to capture the page code changes. Any semantic is welcome. Could also be the time stamp of last build. </li>\n        </ul>"},[(t+"PageLoadError").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"page shown ",eventName:"page view",cause:"automatic",eventAction:"page load"})},page:{pageInfo:Object.assign({},JSON.parse(JSON.stringify(e.page.pageInfo)),{pageName:"tbd",variant:"real page"})},mandatoryData:e.errorMandatoryData.filter((e=>!["pageType","pageBrand","pageGeoRegion","pageLanguage","pageName"].includes(e))).concat(["pageBrand","pageGeoRegion","pageLanguage","pageName","pageType"]),optionalData:e.baseMandatoryData.filter((t=>!["pageBrand","pageGeoRegion","pageLanguage","pageName"].concat(e.errorMandatoryData).includes(t))).concat(e.baseOptionalData.filter((t=>!["componentDEVagency","formID","pageType"].concat(e.errorMandatoryData).includes(t)))).concat(e.productMandatoryData,e.productOptionalData,["pageSubCat1","pageSubCat2","pageSubCat3","pageVariant","pageSysEnv","pageVersion","componentDEVagency","stepName"]),description:'Only trigger this event if the page is on a standalone page that doesn\'t have Adobe Analytics page view tracking implemented yet.Don\'t trigger this event if the page is integrated on a website of the AEM or any website that already has Adobe Analytics page view tracking included.\n    <br> If you trigger this function, make sure to always trigger the "page load" function first before any other TRON functions on the page. This way, we can get the right information and calculate things correctly. It\'s like setting the groundwork for everything else. It should be triggered automatically upon page load before DOM ready.\n        <br><ul>\n            <li><b>\'pageName\'</b> the page name should contain the string value "error".\n            <li><b>\'pageType\'</b> please provide "error" for any error pages except of the "page not found" error page. For 404 page not found error pages the page type must be "error 404".\n            <li><b>\'pageBrand\'</b> is used to capture the brand eg. "bmw", "mini", etc. If the page is showing content that\'s valid for multiple bmw group brands pass the value "bmw group" </li>\n            <li><b>\'pageGeoRegion\'</b> is used to capture the country code as two letters iso 3166 alpha-2 country code all upper case. In case the page is used by more than one market pass "global"</li>\n            <li><b>\'pageLanguage\'</b> is used to capture the language code in iso standard of 2 letters and lowercase;</li>\n        </ul>'}}),e.events=Object.assign(e.events,{[(t+"Click").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"clicks"})},mandatoryData:e.baseMandatoryData.concat(["ctaTarget"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["linkLocation","eventSubCat1","eventAction","requestedURL","eventPoints"]),description:'Trigger this whenever the user clicks on any clickable element that should be tracked with contextual (product, dealer,etc,) data. The eVar34 event effect will be "user clicked on " + [\'ctaTarget\'].\n    <br> Whenever the user clicks on a CTA, that leads the user to another component (eg. from central new car stock locator to digital checkout solution, etc.) then make sure [\'eventSubCat1\'] contains "finish", so your component (eg. central new car stock locator, adobe form, con,visualizer, etc.) finish metric can be tracked.\n    <br> Whenever the user clicks on a CTA, that leads the user outside the current component and to a form component (eg. from central new car stock locator to adobe form, etc.) use [\'eventAction\'] = "form start intention", so this metric can be tracked.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'ctaTarget\'</b> is used to capture on what the user clicked. Some generic samples could be "tda", "product details page", "digital checkout solution", "electric vehicle tab", "price information", "image arrow right", etc. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'eventAction\'</b> can be used in case the user interaction wasn\'t a "internal click" but eg. a "content opened", "share", "swipe", "outbound click", etc.</li>\n            <li><b>\'eventSubCat1\'</b> can be used in case you want to group certain clicks together. For project specific recommended values check the values without check tab above.</li>\n            <li><b>\'linkLocation\'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n            <li><b>\'requestedURL\'</b> can be used to capture the target URL of the CTA</li>\n        </ul>'},[(t+"ListAdd").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user added product to the ",eventAction:"item added",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints"]),description:"Trigger this event whenever the user adds a product to a list (eg. wish list, compare list, etc.) successfully, meaning the product is actually added to the list. Note: for some components this requires the user to login first. For such components the click on eg. the wish list heart (which then doesn't add the product to the list but opens another window where the user needs to login first) should be tracked with the Click function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>'listType'</b> is used to capture the kind of list eg \"wish list\" or \"compare list\". Check allowed value for details.</li>\n    </ul>"},[(t+"ListRemove").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",type:"ux",effect:"user removed product from the ",eventAction:"item removed",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:" interaction"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["listType"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["linkLocation","eventPoints"]),description:"Trigger this event whenever the user removes a product from a list (eg. wishlist, compare list, etc.) successfully, meaning the product is actually removed from the list. Note: If this is a multi-step approach for your component, and when clicking on remove product a window opens to ask the user if he really wants to remove it and only after confirmation it's actually removed, then the first click on remove product should only be tracked with the Click function, and only the last click, after which the product really is removed from the list, should be tracked with this function.\n    <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        <li><b>'linkLocation'</b> can be used to describe where the clickable element was located in case the same element exists multiple times on the same page.</li>\n        <li><b>'listType'</b> is used to capture the kind of list eg \"wish list\" or \"compare list\". Check allowed value for details.</li>\n    </ul>"},[(t+"ViewActions").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{eventName:"interaction",eventAction:"internal click",type:"ux",effect:"user clicked on ",cause:"default"}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"view"})},mandatoryData:e.baseMandatoryData.concat(["viewMode","eventEffect"]),optionalData:e.baseOptionalData.concat(e.productMandatoryData,e.productOptionalData,["imageBackground","viewDayTime","viewPerspective","viewScreen","viewType","eventPoints","eventAction"]),description:"Trigger this event whenever the user plays with the view eg opens it, closes it, rotates the car, opens doors, checks out interior view etc.\n    <br><ul>\n    <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n    <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n    <li><b>'eventEffect'</b> describes on what the user clicked</li>\n    <li><b>'imageBackground'</b> describes the background of the product eg. in the studio or in the desert etc.</li>\n    <li><b>'viewDayTime'</b> describes whether it's day or night</li>\n    <li><b>'viewMode'</b> describes is either 360 or 3d</li>\n    <li><b>'viewPerspective'</b> describes from which angle the user views the product</li>\n    <li><b>'viewScreen'</b> describes whether it's full screen or default screen</li>\n    <li><b>'viewType'</b> describes whether the user sees a product exterior or interior view</li>\n    </ul>"},[(t+"FilterSort").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"search results sorted by",eventAction:"sort",eventName:"interaction",type:"ux",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["sortType"]).filter((e=>!["search[n].searchLabel","search[n].searchTerm","searchResults","eventSubCat1"].includes(e))),optionalData:e.baseOptionalData.filter((e=>!["searchResults","eventSubCat1"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["eventCause","search[n].searchLabel","search[n].searchTerm","searchResults","filterObject","search[n].searchUnit","search[n].searchState","eventPoints"]),description:'Trigger this whenever the user sorts the search results.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the default sort type. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n            <li><b>\'sortType\'</b> is used to capture the sort criteria.Samples: "lowest price", "highest price", "a-z", "z-a", "distance (nearest\')"</li>\n        </ul>'},[(t+"FilterRemoveAll").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filters removed all",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints"]),description:'Trigger this event every time the user removes all selected search filters at once.\n    <br> Please provide all search labels and search terms that are removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'},[(t+"FilterRemoved").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter removed",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints"]),description:'Trigger this event every time the user removes a single search filter.\n    <br> Please provide the search label and search term that is removed dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'},[(t+"FilterSelected").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"filter selected",eventName:"search",eventAction:"internal click",cause:"default"})},mandatoryData:e.baseMandatoryData.concat(["filterObject","search[n].searchLabel","search[n].searchTerm"]),optionalData:e.baseOptionalData.filter((e=>!["searchResults"].includes(e))).concat(e.productMandatoryData,e.productOptionalData,["searchResults","eventAction","search[n].searchState","search[n].searchUnit","eventPoints","eventCause"]),description:'Trigger this event every time filters are selected.\n    <br> Please provide the search labels and search terms that are selected dynamically in the respective parameters inside the search array.\n        <br><ul>\n            <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n            <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n            <li><b>\'eventAction\'</b> is used to capture the way the user removed the search term eg. as "checkbox", "radio button", etc.</li>\n            <li><b>\'eventCause\'</b> = "automatic" if you want to trigger this event not only upon user interaction but also upon page load to capture the preselected filters. For user interactions you don\'t have to set it at all.</li>\n            <li><b>\'filterObject\'</b> describes what the user is filtering eg."content", "dealer", "vehicle", etc. </li>\n            <li><b>\'searchResults\'</b> shows how many results were found for the combination of selected filters</li>\n            <li><b>\'search[n].searchLabel\'</b> is used to capture the headline that generally groups multiple search term options eg. "series", "fuel type", "location" etc. </li>\n            <li><b>\'search[n].searchTerm\'</b> is used to capture the value selected eg. "1 series", "electric", "munich", etc.</li>\n            <li><b>\'search[n].searchUnit\'</b> is used to capture the unit of a numeric search term eg. "km", "mi", "€", "$", etc.</li>\n            <li><b>\'search[n].searchState\'</b> is used to capture the default settings ("preselected") vs. the filters selected by the user ("user selected").</li>\n        </ul>'},[(t+"ChangeConfiguration").replace(/^(.)(.*)$/,((e,t,a)=>t.toLowerCase()+a))]:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"].includes(e))),["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status"]),optionalData:e.baseOptionalData.concat(e.productOptionalData.filter((e=>!["options[n].businessDivision","options[n].category1","options[n].productID","options[n].codeVG","options[n].status","options[n].range"].includes(e))),["eventAction","eventCause","eventPoints","options[n].range"]),description:"Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        </ul>"},visualizerTab:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"visualizer tab bar navigation"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["section"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventPoints"]),description:'🆕 <i style="color:darkblue"> <b>Don\'t use this function in new implementations anymore. And if you are updating your tracking at the moment, ideally immediately update to the generic function name</b>. This will be moved into a generic code snippet with function name <b>"visualizerClick" </b>with next major release. You would then pass the string value you currently pass in \'section\' in the parameter \'ctaTarget\' to state on what the user clicked. and you could then use the parameter \'eventSubCat1\' with value "visualizer tab bar navigation" so you can still group all those tab clicks.</i>\n        <br><br>\n        Trigger when the user clicks on a tab within the visualizer. Please provide the respective tab in the parameter "section" dynamically. \n        <br><ul>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        </ul>'},visualizerChange:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user changed the "}),category:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.category)),{subCategory1:"visualizer configuration change"})},mandatoryData:e.baseMandatoryData.concat(e.productMandatoryData,["section"]),optionalData:e.baseOptionalData.concat(e.productOptionalData,["eventAction","eventCause","eventPoints"]),description:"🆕 <i style=\"color:darkblue\"> <b>Don't use this function in new implementations anymore. And if you are updating your tracking at the moment, ideally immediately update to the generic function name</b>. This will be moved into a generic code snippet with function name <b>\"visualizerChangeConfiguration\" </b>with next major release.</i>\n        <br><br>\n        Trigger this function when the user changes a selection within a configuration. Provide the details of the item(s) that were added or removed in the options[n] parameters. Use the options[n].status parameter to state for each item whether it has been added item, automatically added item, automatically removed item, removed item. In case you are not sure whether or not the action was initated by the user or happened automatically, use the value without automatically as default - that is added item or removed item respectively.\n        <br><ul>\n        <li><b>'vehicle[n].status' /'options[n].status'</b> is used to differentiate which product was added and which one removed</li>\n        <li><b>'options[n].range'</b> is used to to refer to the marketing model range of the related vehicle.</li>\n        <li><b>'options[n].codeVG' / 'options[n].codeAG'</b> is used to to refer to the model code of the related vehicle.</li>\n        <li>For parameters with value check (bold and blue) please go with the mouse over the value or refer to the <b>allowed values tab</b> on top to see acceptable values.</li>\n        <li>For parameters without value check, please refer to the <b>values without check tab</b> on top to see samples.</li>\n        </ul>"}})},globalDefaults:function(e){e.productSchema={category:{},productInfo:{},attributes:{}},e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[],cart:{item:[{category:{},productInfo:{},price:{},attributes:{}}],price:{}},transaction:{total:{},item:[{category:{},productInfo:{},price:{},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(e.baseOptionalData,e.productOptionalData,e.productMandatoryData).concat(["errorURL","eventPoints"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["formLeadType","formVariant","linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:'Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it\'s available to you at the moment the error occurred.\n                <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/1FsYrw" target="_blank">Adobe Analytics 2023 - Error Tracking confluence page</a> for further details.'},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:e.errorMandatoryData.concat(["componentVersion","eventPoints"]),description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br> If on the page product data is already set, you can link your event to it by providing the respective productID.\n      <br> If on the page dealer information is already pushed to ACDL, you can link your event to the selected dealer by providing the respective buno.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.'}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","first component interaction","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","eml","swipe","form start intention","chat","print","swipe left","swipe right","form finish intention"],e._validEventCauses=["automatic"],e._validEventPoints=["time between two events in miliseconds provided as numeric value"],e.defaultValue=""}};e.library(this),e.defaults(this),e.globalDefaults(this),e.events(this);var t=Object.keys(this).filter((e=>e.includes("allowed")));for(var a in t)this[t[a]]=this[t[a]].map((e=>"string"==typeof e?e.toLowerCase():e));this._createPublicMethods(),this.findPIIMatches=this.findPIIMatches.bind(this),this.scanForPIIKeywords=this.scanForPIIKeywords.bind(this),this.ignoreParamsNotApplicable=[],this.piiKeywords=["firstname","lastname","vin","username","enname","name","loginid","registrationpassword","confirmationpassword","confirmregistrationpassword","registrationid","passwordconfirmation","password","token","telephone","email"],this.message={}}getSupportedEvents(){var e={};for(const m in this.events){var t=JSON.parse(JSON.stringify(this.events[m].mandatoryData)),a=JSON.parse(JSON.stringify(this.events[m].optionalData)),o=Object.keys(this).map((e=>e.toLowerCase())),i=[t.sort(),a.sort()];for(var n in i)for(var r in i[n]){var s=i[n][r];(s=s.indexOf("[n].")>-1?s.replace("[n].",""):s).includes("searchsearch")&&(s=s.replace("searchsearch","search"));var c=o.filter((e=>e.includes(s.toLowerCase())));if(("string"==typeof s&&1==c.length||"string"==typeof s&&c.length>1&&c[0].includes(s)||"string"==typeof s&&c.length>1&&c[0].includes(s.toLowerCase()))&&["optionscode"].indexOf(s)<0&&Array.isArray(this[Object.keys(this)[o.indexOf(c[0])]])){var l;if("eventEffect"==s?(l=[],m.toLowerCase().indexOf("viewactions")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[o.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[o.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[o.indexOf(c[0])]])):"stepName"==s?(l=[],m.toLowerCase().indexOf("checkoutprocess")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[o.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[o.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[o.indexOf(c[0])]])):(c=c.filter((e=>!e.includes("generic"))),l=this[Object.keys(this)[o.indexOf(c[0])]]),(l||[]).length>0){var d="Possible Options: "+(l=l.filter((function(e){return""!==e}))).join(", ").toString();i[n][r]='<span style="color: #1000ff;font-weight: bold;" title="'+d+'">'+i[n][r]+"</span>"}"eventEffect"!=s&&"stepName"!=s||m.toLowerCase().indexOf("viewactions")<0&&m.toLowerCase().indexOf("checkoutprocess")<0&&c.length<=1&&c[0].indexOf("generic")>-1&&(i[n][r]=s)}}e[m]={description:this.events[m].description,"mandatory parameters":i[0].join(", <br>").toString(),"optional parameters":i[1].join(", <br>").toString()}}return e}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(const e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var a in e)if(e.hasOwnProperty(a))if("object"==typeof e[a]&&null!==e[a]){var o=this.flattenObject(e[a]);for(var i in o)o.hasOwnProperty(i)&&(t[a+"."+i]=o[i])}else t[a]=e[a];return t}_trimWhitespace(e){if("string"==typeof e){const t=/^\s+|\s+$/g;return e.replace(t,"")}if("object"==typeof e&&null!==e)for(const t in e)e.hasOwnProperty(t)&&(e[t]=this._trimWhitespace(e[t]));return e}_removeUndefinedValues(e){for(let t in e)"<not defined>"===e[t]?delete e[t]:"object"==typeof e[t]&&this._removeUndefinedValues(e[t])}_checkParamsPassed(e,t,a){this.ignoreParamsNotApplicable=[],t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var o={};Object.keys(this.flattenObject(a)).forEach((function(e){var t=/(.)(\d+)(.)/;if(e.match(t)){var a=e.replace(t,"[n].");o.hasOwnProperty(a)?o[a]+=e+",":o[a]=e+","}else o[e]=e}));var i=[];for(var n in i.push.apply(i,this.events[e].mandatoryData),i.push.apply(i,this.events[e].optionalData),i=i.filter(((e,t,a)=>a.indexOf(e)===t)),t)if(i.indexOf(t[n])<0){var r=o[t[n]];if(r.indexOf(",")>-1){for(var s in r=r.split(","))if(""!=r[s]&&r[s].indexOf(".")>-1)for(var c=r[s].split("."),l=a,d=0;d<c.length;d++){var m=c[d];d===c.length-1?(l[m]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")):l=l[m]=l[m]||{}}}else a[t[n]]="<not defined>",this.ignoreParamsNotApplicable.push(t[n]),this._throwError("o",t[n],"not-defined","")}}transformData(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map((e=>this.transformData(e)));var t={};for(var a in e)if(e.hasOwnProperty(a)){var o=e[a];"pageGeoRegion"===a&&void 0!==o?o=(o||"").toUpperCase():["pageSubCat1","category1","totalCurrency"].indexOf(a)>-1||(o="string"==typeof o?(o||"").toLowerCase():this.transformData(o)),t[a]=o}return t}findPIIMatches(e,t,a){Object.keys(e).forEach((o=>{const i=t?t+"."+o:o;var n=e[o];"object"==typeof n&&null!==n?this.findPIIMatches(n,i,a):this.piiKeywords.forEach((t=>{if(String(n).toLowerCase().includes(t.toLowerCase())){if(a.push({key:i,match:t}),"email"==t&&-1!==String(n).toLowerCase().indexOf(t.toLowerCase())){var o=String(n).replace(new RegExp(t,"gi"),"eml");e[i]=o,n=o}return!0}return!1}))}))}scanForPIIKeywords(e){const t=[];this.findPIIMatches(e,null,t);const a=Object.values(t.reduce(((e,t)=>{const{key:a,match:o}=t;return e[a]||(e[a]={key:a,match:o}),e}),{}));Object.keys(a).length>0&&a.forEach((e=>{this._throwError("o",e.key,"pii-keyword",this.piiKeywords,e.match)}))}_processEvent(eventName,mandatoryData){void 0===mandatoryData&&(mandatoryData={}),TRON.currentEventName=eventName,TRON.prefix=PROJECT_SPECIFIC_DATA.prefix,TRON.componentName=PROJECT_SPECIFIC_DATA.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==mandatoryData&&(void 0!==mandatoryData.componentName&&(TRON.componentName=mandatoryData.componentName),void 0!==mandatoryData.formOrigin&&(TRON.componentName=mandatoryData.formOrigin),void 0!==mandatoryData.componentDEVagency&&(TRON.componentName=TRON.componentName+" "+mandatoryData.componentDEVagency)),TRON.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+eventName;var componentIDBuild=`${determineBrand()}/${gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>datalayerPath("page.pageInfo.geoRegion"),()=>datalayerPath("page.pageInfo.language").indexOf("-")>-1&&datalayerPath("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.toLowerCase()])}_${gFFWNV([()=>datalayerPath("page.pageInfo.language").slice(0,2)||(datalayerPath("page.pageInfo.language").indexOf("-")>-1?datalayerPath("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage?mandatoryData.pageLanguage.toLowerCase():"")])}/${TRON.componentName}`;TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:TRON.componentName,componentID:componentIDBuild},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var paramsPassed=JSON.parse(JSON.stringify(mandatoryData));this._debug("💡 event triggered:"+eventName,paramsPassed),mandatoryData=this.transformData(mandatoryData),mandatoryData=this._trimWhitespace(mandatoryData),this.scanForPIIKeywords(mandatoryData),this._checkParamsPassed(eventName,paramsPassed,mandatoryData),void 0!==window.TRON.warningCode&&(window.TRON.warningCode=[]),window.TRON.priceCalculation=!1,this._removeUndefinedValues(mandatoryData),this.message=this._loadEventData(eventName,mandatoryData);try{this._checkmandatoryData(eventName,mandatoryData),this.events[eventName].optionalData&&this._checkOptionalData(eventName,mandatoryData)}catch(e){return"object"==typeof e&&void 0!==e.name&&"SyntaxError"==e.name&&void 0!==e.message&&"Missing Mandatory Data"==e.message||TRON.customConsole.error(e),!1}var prefix=PROJECT_SPECIFIC_DATA.prefix;if(void 0!==this.allowedComponentTypes)try{this._validateProperty("componentType",this.allowedComponentTypes,eventName,mandatoryData)}catch(t){return!1}if(void 0!==this.allowedComponentNames)try{this._validateProperty("componentName",this.allowedComponentNames,eventName,mandatoryData)}catch(a){return!1}if(void 0!==this.allowedComponentSubCat1)try{this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,eventName,mandatoryData)}catch(o){return!1}if(void 0!==this.allowedComponentPlatform)try{this._validateProperty("componentPlatform",this.allowedComponentPlatform,eventName,mandatoryData)}catch(n){return!1}function findKeyByValue(e,t){for(var a in e)if(e.hasOwnProperty(a)&&e[a]===t)return a;return null}this.message.component[0].category.componentType=gFFWNV([()=>mandatoryData.componentType,()=>((this.component||"").category||"").componentType||""]),this.message.component[0].category.primaryCategory=gFFWNV([()=>mandatoryData.componentPrimaryCat,()=>((this.component||"").category||"").primaryCategory||""]),this.message.component[0].category.subCategory1=gFFWNV([()=>mandatoryData.componentSubCat1,()=>((this.component||"").category||"").subCategory1||""]),void 0!==mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==mandatoryData.componentName?(this.message.component[0].componentInfo.componentName=mandatoryData.componentName,this.message.event[0].category.primaryCategory=mandatoryData.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName),void 0!==mandatoryData.componentDEVagency&&(this.message.component[0].attributes.componentDEVagency=gFFWNV([()=>mandatoryData.componentDEVagency])),void 0!==mandatoryData.componentPlatform&&(this.message.component[0].attributes.platform=gFFWNV([()=>mandatoryData.componentPlatform]));var prefixVariable=void 0!==prefix?prefix:TRON.prefix,determinPrimaryCategory={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},obj=void 0!==this&&this.message&&this.message.component?this.message.component:TRON.dataComponent||{},compVar=(obj||[])[0]||{},primaryCategory=void 0!==determinPrimaryCategory[prefixVariable]?determinPrimaryCategory[prefixVariable]:(compVar.category||{}).primaryCategory||"";if(void 0!==mandatoryData&&void 0!==mandatoryData.componentPrimaryCat&&void 0===prefix&&"nsc > "==TRON.prefix&&null!=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)&&(prefix=prefixVariable=findKeyByValue(determinPrimaryCategory,mandatoryData.componentPrimaryCat)),""==primaryCategory||"shared > "==prefixVariable||"local > "==prefixVariable){var domains=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com","rolls-roycemotorcars.com","tron.bmwgroup.com"],match=domains.some((e=>window.location.href.includes(e)));if(match){var host=location.host,componentSubCategory1=host.split(".")[1],subdomain=host.split(".")[0],host=location.host,domainName=host.split(".")[1],path=location.pathname,languageMarket=path.split("/")[1],languageMarketLength=languageMarket.length;"com"===host.split(".")[2]&&"bmw"===domainName&&2===languageMarketLength?(primaryCategory="special website",prefixVariable="special > "):"bmw"===domainName||"mini"===domainName||"bmw-motorrad"===domainName||"bmwusa"===domainName||"rolls-roycemotorcars"===domainName||"bmwgroup"===domainName&&"customer"===subdomain||"bmwgroup"===domainName&&"tron"===subdomain?(primaryCategory="nsc website",prefixVariable="nsc > "):(primaryCategory="special website",prefixVariable="special > ")}else primaryCategory="special website",prefixVariable="special > "}if(void 0!==prefix&&(prefix=prefixVariable),void 0!==TRON.prefix&&(TRON.prefix=prefixVariable),this.message.component[0].category.primaryCategory=primaryCategory,void 0!==TRON.dataComponent&&(TRON.dataComponent=Object.assign(TRON.dataComponent,this.message.component)),mandatoryData&&mandatoryData.section&&void 0!==mandatoryData.section){let r=mandatoryData.section;if(!this.allowedSections.includes(r))return void this._throwError("m","section","incorrect",this.allowedSections);mandatoryData.section=r}if(void 0!==this.allowedViewModes)try{this._validateProperty("viewMode",this.allowedViewModes,eventName,mandatoryData)}catch(s){return!1}if(void 0!==this.allowedViewTypes)try{this._validateProperty("viewType",this.allowedViewTypes,eventName,mandatoryData)}catch(c){return!1}if(void 0!==this.allowedViewDayTimes)try{this._validateProperty("viewDayTime",this.allowedViewDayTimes,eventName,mandatoryData)}catch(l){return!1}if(void 0!==this.allowedViewScreens)try{this._validateProperty("viewScreen",this.allowedViewScreens,eventName,mandatoryData)}catch(d){return!1}if(void 0!==this.allowedViewPerspectives)try{this._validateProperty("viewPerspective",this.allowedViewPerspectives,eventName,mandatoryData)}catch(m){return!1}void 0!==mandatoryData.requestedURL&&(this.message.event[0].attributes.requestedURL=gFFWNV([()=>mandatoryData.requestedURL])),void 0!==mandatoryData.ctaTarget&&"interaction"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+mandatoryData.ctaTarget]));let effectString=this.message.event[0].eventInfo.effect;if(void 0===mandatoryData.ctaTarget&&void 0!==effectString&&effectString.includes("user clicked on")&&mandatoryData.eventEffect&&void 0!==mandatoryData.eventEffect&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.eventEffect),void 0!==mandatoryData.eventSubCat1&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.eventSubCat1])),mandatoryData.listType&&void 0!==mandatoryData.listType&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.listType,this.message.event[0].category.subCategory1=mandatoryData.listType+" "+this.message.event[0].category.subCategory1,"string"==typeof this.message.event[0].category.subCategory1&&this.message.event[0].category.subCategory1.length>0&&(this.message.event[0].category.subCategory1=this.message.event[0].category.subCategory1.replace("  "," "))),"view"==this.message.event[0].category.subCategory1&&mandatoryData.viewMode&&void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory1=this.message.component[0].componentInfo.componentName+" "+mandatoryData.viewMode+" view"),void 0!==mandatoryData.linkLocation&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.linkLocation])),void 0!==mandatoryData.viewMode&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewMode])),void 0!==mandatoryData.viewType&&(this.message.event[0].category.subCategory2=gFFWNV([()=>mandatoryData.viewType])),void 0!==mandatoryData.viewDayTime&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewDayTime+" mode"])),void 0!==mandatoryData.viewScreen&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" on "+mandatoryData.viewScreen])),void 0!==mandatoryData.viewPerspective&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.viewPerspective+" view"])),void 0!==mandatoryData.imageBackground&&(this.message.event[0].category.subCategory2=gFFWNV([()=>this.message.event[0].category.subCategory2+" "+mandatoryData.imageBackground])),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),void 0!==mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=gFFWNV([()=>mandatoryData.eventCause])),void 0===prefix)var prefix;prefix=void 0!==prefix?prefix:TRON.prefix;try{this._validateProperty("pageBrand",this.allowedPageBrand,eventName,mandatoryData)}catch(u){return!1}try{this._validateProperty("pageVariant",this.allowedPageVariant,eventName,mandatoryData)}catch(p){return!1}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageGeoRegion)if(2==mandatoryData.pageGeoRegion.length)mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toUpperCase();else if(mandatoryData.pageGeoRegion=(mandatoryData.pageGeoRegion||"").toLowerCase(),!["global"].includes(mandatoryData.pageGeoRegion)){if(this.events[eventName].mandatoryData.indexOf("pageGeoRegion")>-1){let g="string"==typeof mandatoryData.pageGeoRegion&&0==mandatoryData.pageGeoRegion.trim().length?"empty":"incorrect";return void this._throwError("m","pageGeoRegion",g,this.allowedPageGeoRegion)}{let h=("string"==typeof mandatoryData.pageGeoRegion&&mandatoryData.pageGeoRegion.trim().length,"incorrect-o");this._throwError("o","pageGeoRegion",h,this.allowedPageGeoRegion),mandatoryData.pageGeoRegion=""}}if(void 0!==mandatoryData&&void 0!==mandatoryData.pageLanguage)if(2!=mandatoryData.pageLanguage.length){if(this.events[eventName].mandatoryData.indexOf("pageLanguage")>-1){let v="string"==typeof mandatoryData.pageLanguage&&0==mandatoryData.pageLanguage.trim().length?"empty":"incorrect";return void this._throwError("m","pageLanguage",v,"","(has to follow ISO standard of 2 letters in uppercase)")}{let y=("string"==typeof mandatoryData.pageLanguage&&mandatoryData.pageLanguage.trim().length,"incorrect-o");this._throwError("o","pageLanguage",y,"","(has to follow ISO standard of 2 letters in uppercase)"),mandatoryData.pageLanguage=""}}else mandatoryData.pageLanguage=(mandatoryData.pageLanguage||"").toLowerCase();void 0!==mandatoryData.pageName&&(this.message.page.pageInfo.pageName=mandatoryData.pageName,this.message.event[0].eventInfo.effect="page: "+mandatoryData.pageName+" shown"),(void 0!==this.message.custom&&"page view"==this.message.event[0].eventInfo.eventName||"error"==this.message.event[0].eventInfo.eventName)&&void 0!==this.message.page&&(void 0!==mandatoryData.pageBrand&&(this.message.page.attributes.brand=gFFWNV([()=>mandatoryData.pageBrand])),this.message.page.attributes.timeZone=(new Date).getTimezoneOffset()/60+":00",this.message.page.category.primaryCategory=gFFWNV([()=>mandatoryData.componentName,()=>this.message.component[0].componentInfo.componentName]),void 0!==mandatoryData.pageSubCat1&&(this.message.page.category.subCategory1=gFFWNV([()=>mandatoryData.pageSubCat1])),void 0!==mandatoryData.pageSubCat2&&(this.message.page.category.subCategory2=gFFWNV([()=>mandatoryData.pageSubCat2])),void 0!==mandatoryData.pageSubCat3&&(this.message.page.category.subCategory3=gFFWNV([()=>mandatoryData.pageSubCat3])),void 0!==mandatoryData.pageType&&(this.message.page.category.pageType=gFFWNV([()=>mandatoryData.pageType])),void 0!==mandatoryData.componentDEVagency&&(this.message.page.pageInfo.author=gFFWNV([()=>mandatoryData.componentDEVagency])),this.message.page.pageInfo.destinationURL=document.location.href,void 0!==mandatoryData.pageGeoRegion&&(this.message.page.pageInfo.geoRegion=gFFWNV([()=>mandatoryData.pageGeoRegion])),void 0!==mandatoryData.pageLanguage&&(this.message.page.pageInfo.language=gFFWNV([()=>mandatoryData.pageLanguage])),this.message.page.pageInfo.pageName=prefix+this.message.page.pageInfo.pageName,this.message.page.pageInfo.referringURL=document.referrer,void 0!==mandatoryData.pageSysEnv&&(this.message.page.pageInfo.sysEnv=gFFWNV([()=>mandatoryData.pageSysEnv])),void 0!==mandatoryData.pageVariant&&(this.message.page.pageInfo.variant=gFFWNV([()=>mandatoryData.pageVariant])),this.message.page.pageInfo.version=gFFWNV([()=>mandatoryData.pageVersion,()=>mandatoryData.componentVersion]));var variable=void 0!==this&&this,includePriceCalculationVehicle=!1;if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1){var flagVariable=!1;for(var i in mandatoryData.vehicle)void 0===mandatoryData.vehicle[i].range&&void 0!==mandatoryData.vehicle[i].rangeVG?mandatoryData.vehicle[i].range=mandatoryData.vehicle[i].rangeVG:void 0===mandatoryData.vehicle[i].range&&void 0===mandatoryData.vehicle[i].rangeVG&&(flagVariable=!0);if(flagVariable&&this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1)return void this._throwError("m","vehicle[n].range","missing","")}else if(this.events[eventName].mandatoryData.indexOf("vehicle[n].range")>-1&&void 0===mandatoryData.vehicle)return void this._throwError("m","vehicle[n].range","missing","");if(this.events[eventName].optionalData.indexOf("vehicle[n].range")>-1)for(var i in mandatoryData.vehicle)""==mandatoryData.vehicle[i].range&&this._throwError("o","vehicle[n].range","empty","");for(var i in mandatoryData.vehicle){if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerOutletBuno")>-1){let f=/^[0-9]+$/;for(mandatoryData.vehicle[i].linkedDealerOutletBuno=f.test(mandatoryData.vehicle[i].linkedDealerOutletBuno)?parseInt(mandatoryData.vehicle[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.vehicle[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.vehicle[i].linkedDealerOutletBuno)?void 0!==mandatoryData.vehicle[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)&&(mandatoryData.vehicle[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.vehicle[i].linkedDealerOutletBuno)):(variable._throwError("o","vehicle[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""),mandatoryData.vehicle[i].linkedDealerOutletBuno=""+mandatoryData.vehicle[i].linkedDealerOutletBuno;mandatoryData.vehicle[i].linkedDealerOutletBuno.length>1&&mandatoryData.vehicle[i].linkedDealerOutletBuno.length<5;)mandatoryData.vehicle[i].linkedDealerOutletBuno="0"+mandatoryData.vehicle[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.vehicle[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"!=typeof mandatoryData.vehicle[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("vehicle[n].linkedDealerCount")>-1)return void variable._throwError("m","vehicle[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","vehicle[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.vehicle[i].linkedDealerCount=""}else void 0!==mandatoryData.vehicle[i].linkedDealerCount&&"number"==typeof mandatoryData.vehicle[i].linkedDealerCount&&(mandatoryData.vehicle[i].linkedDealerCount=convertToNumeric(mandatoryData.vehicle[i].linkedDealerCount))}var productIDGenerate=0;function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function convertToLowerCase(e){let t=["codeAG","codeVG","rangeAG","rangeVG","name","productID","range","modelCode","modelCodeAG","mmdr","mmdrVG"];if(e&&null!=e.vehicle)for(var a=0;a<=e.vehicle.length;a++)for(var o in e.vehicle[a])t.indexOf(o)<0&&(e.vehicle[a][o]="string"==typeof e.vehicle[a][o]?e.vehicle[a][o].toLowerCase():e.vehicle[a][o])}function validateVehicleData(e,t){["codeAG","codeVG","rangeAG","rangeVG"].indexOf(e)<0&&(t="String"==typeof t?(t||"").toLowerCase():t);let a,o={bodyType:{values:variable.allowedVehicleBodyType},businessDivision:{values:variable.allowedVehicleBusinessDivision},category1:{values:variable.allowedVehicleCategory1},codeAG:{condition:"only 4 characters"},codeVG:{condition:"only 4 characters"},fuelType:{values:void 0!==variable.allowedVehicleFuelType?variable.allowedVehicleFuelType:[]},hybridVersion:{values:variable.allowedVehicleHybridVersion},primaryCategory:{values:variable.allowedVehiclePrimaryCategory},series:{values:variable.allowedVehicleSeries},salesModel:{values:variable.allowedVehicleSalesModel},status:{values:variable.allowedVehicleStatus}};if(o[e]){let i=o[e];i.condition?"only 4 characters"==i.condition?a=4==t.length:"only 3 characters"==i.condition?a=3==t.length:"only 3 characters OR 4 if the last is 'E'"==i.condition&&(a=4==t.length&&"E"==t[t.length-1]||3==t.length):a=0==o[e].values.length||o[e].values.indexOf(t)>-1}else a=!0;return a}function _requiredParams(e,t,a,o){let i,n=a,r=[],s=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<n.length;e++){let a=n[e];if(a.indexOf("[n]")>-1){let e=a.split("[n]");if("vehicle"==e[0]){let n;void 0!==t[a.split("[n]")[0]]?(i=t[a.split("[n]")[0]][0][a.split("[n]")[1].replace(".","")],n=validateVehicleData(e[1].replace(".",""),i)):n=!1;let c=s.filter((e=>e.includes("vehicle"+a.split("[n]")[1].replace(".","").toLowerCase())));c=c.length>0?c[0]:"";let l=o[Object.keys(o)[s.indexOf(c||"")]]||[];0==n&&("string"==typeof i&&0==i.trim().length?(r.push(a),variable._throwError("m",a,"empty",l)):(r.push(a),variable._throwError("m",a,"incorrect",l))),void 0===i&&variable._throwError("m",a,"missing")}}}if(r.length>0)throw"";return!0}function _optionalParams(e,t,a,o){let i=a,n=[],r=Object.keys(o).map((e=>e.toLowerCase()));for(let e=0;e<i.length;e++){let a,c=i[e];if(c.indexOf("[n]")>-1){let e=c.split("[n]");if("vehicle"==c.split("[n]")[0]&&t.vehicle&&t.vehicle.length>0)for(var s=0;s<=t.vehicle.length-1;s++)if(a=t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")],void 0!==a&&0==validateVehicleData(e[1].replace(".",""),a)){let e=r.filter((e=>e.includes("vehicle"+c.split("[n]")[1].replace(".","").toLowerCase())));e=e.length>0?e[0]:"";let i=o[Object.keys(o)[r.indexOf(e)]]||[];t[c.split("[n]")[0]][s][c.split("[n]")[1].replace(".","")]="",n.push(c);let l=("string"==typeof a&&a.trim().length,"incorrect-o");variable._throwError("o",c,l,i)}}}return!0}try{convertToLowerCase(mandatoryData),_requiredParams(eventName,mandatoryData,this.events[eventName].mandatoryData,this),this.events[eventName].optionalData&&_optionalParams(eventName,mandatoryData,this.events[eventName].optionalData,this)}catch(b){return!1}if(this.message.product=[],void 0!==mandatoryData&&mandatoryData.vehicle&&mandatoryData.vehicle.forEach((e=>{let t=JSON.parse(JSON.stringify(this.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.vehicle;t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.codeVG,()=>e.codeAG,()=>e.range,()=>"product"+(productIDGenerate+1)]),t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>e.primaryCategory]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.attributes.bodyType=gFFWNV([()=>a.bodyType,()=>e.bodyType]),t.attributes.modelCodeAG=gFFWNV([()=>a.modelCodeAG,()=>e.codeAG]),t.attributes.modelCodeAG=(t.attributes.modelCodeAG||"").toUpperCase(),t.attributes.modelCode=gFFWNV([()=>a.modelCode,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.motorization=gFFWNV([()=>a.motorization,()=>e.engine]),t.attributes.fuelType=gFFWNV([()=>a.fuelType,()=>e.fuelType]),t.attributes.gearing=gFFWNV([()=>a.gearing,()=>e.gearing]),t.attributes.hybridVersion=gFFWNV([()=>a.hybridVersion,()=>e.hybridVersion]),t.attributes.mmdr=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.mmdr,()=>e.rangeVG,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.attributes.modelName=gFFWNV([()=>a.modelName,()=>e.subSeries]),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.productionYear=gFFWNV([()=>a.productionYear,()=>e.yearOfProduction]),t.attributes.yearOfRegistration=gFFWNV([()=>a.yearOfRegistration,()=>e.yearOfRegistration]),t.attributes.encVIN=gFFWNV([()=>a.encVIN,()=>e.encVIN]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),this.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationVehicle=!0)})),includePriceCalculationVehicle){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){const D=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(const w of D)if("totalCurrency"==w){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let N="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",N,"","(has to follow ISO 3-letter currency code all upper case)")}{let O=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",O,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[w],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(w)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(w),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(w)>-1)return void variable._throwError("m",w,flagDetermine,"");variable._throwError("o",w,flagDetermine,""),mandatoryData[w]=""}else mandatoryData[w]=convertToNumeric(mandatoryData[w]),mandatoryData[w]=roundToDecimal(mandatoryData[w],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}void 0===variable&&(variable=this);var includePriceCalculationOptions=!1,optionIdGenerate=void 0===productIDGenerate?0:productIDGenerate;function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function checkNumericValue(e,t){if(mandatoryData.options[e][t]&&"number"!=typeof convertToNumeric(mandatoryData.options[e][t])){if(variable.events[eventName].mandatoryData.indexOf(`options[n].${t}`)>-1)return void variable._throwError("m",`options[n].${t}`,"incorrect-numeric","");variable._throwError("o",`options[n].${t}`,"incorrect-numeric",""),mandatoryData.options[e][t]=""}else mandatoryData.options[e][t]&&"number"==typeof convertToNumeric(mandatoryData.options[e][t])&&(mandatoryData.options[e][t]=convertToNumeric(mandatoryData.options[e][t]))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options){if(void 0!==mandatoryData.options[i].codeVG&&"value should contain only 4 characters"==variable.allowedOptionscodeVG[0]&&((mandatoryData.options[i].codeVG||"").length<4||(mandatoryData.options[i].codeVG||"").length>4)){if(variable.events[eventName].mandatoryData.indexOf("codeVG")>-1){let I="string"==typeof mandatoryData.options[i].codeVG&&0==mandatoryData.options[i].codeVG.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].codeVG",I,variable.allowedOptionscodeVG)}{let T=("string"==typeof mandatoryData.options[i].codeVG&&mandatoryData.options[i].codeVG.trim().length,"incorrect-o");variable._throwError("o","options[n].codeVG",T,variable.allowedOptionscodeVG),mandatoryData.options[i].codeVG=""}}if(void 0!==mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision&&!variable.allowedVehicleBusinessDivision.includes(mandatoryData.options[i].businessDivision)){if(variable.events[eventName].mandatoryData.indexOf("businessDivision")>-1){let A="string"==typeof mandatoryData.options[i].businessDivision&&0==mandatoryData.options[i].businessDivision.trim().length?"empty":"incorrect";return void variable._throwError("m","businessDivision",A,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)")}{let C=("string"==typeof mandatoryData.options[i].businessDivision&&mandatoryData.options[i].businessDivision.trim().length,"incorrect-o");variable._throwError("o","businessDivision",C,variable.allowedVehicleBusinessDivision,"(or a comma separated combination of any of those values)"),mandatoryData.options[i].businessDivision=""}}checkNumericValue(i,"finDownPayment"),checkNumericValue(i,"finMileage"),checkNumericValue(i,"finMonthlyPayment"),checkNumericValue(i,"finTerm")}var valueMappingCategory={accessories_zub:"accessories",graphics:"car hood graphics",accessories_lad:"charging",BODY_COLOURS:"colors",colours:"colors",ENGINES:"engine",model:"engine",TRIMS:"interior trims",interior_trims:"interior trims",INTERIOR_WORLDS:"interior worlds",lines:"lines / trims",trimlevel:"lines / trims",OPTIONS:"options",EXTERIOR_HIGHLIGHTS:"options",INTERIOR_HIGHLIGHTS:"options",PACKAGES:"packages",PACKAGES_AND_OPTIONS:"packages",TOP_COLOURS:"roof and mirror caps",roof_and_mirror_caps:"roof and mirror caps",UPHOLSTERY:"upholstery",fabrics:"upholstery",RIMS:"wheels",wheels:"wheels","accessories:pwr":"winter wheels",ACCESSORIES_PWR:"winter wheels"};if(void 0!==mandatoryData&&mandatoryData.pageSubCat1&&void 0!==mandatoryData.pageSubCat1&&(valueMappingCategory.hasOwnProperty(mandatoryData.pageSubCat1)&&(mandatoryData.pageSubCat1=valueMappingCategory[mandatoryData.pageSubCat1]),mandatoryData.pageSubCat1.startsWith("option_group")?mandatoryData.pageSubCat1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1?(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.pageSubCat1&&(mandatoryData.pageSubCat1="options",mandatoryData.pageSubCat2="interior highlights")),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0)for(var i in mandatoryData.options)if(mandatoryData.options[i].category1&&void 0!==mandatoryData.options[i].category1&&"string"==typeof mandatoryData.options[i].category1){if(valueMappingCategory.hasOwnProperty(mandatoryData.options[i].category1)&&(mandatoryData.options[i].category1=valueMappingCategory[mandatoryData.options[i].category1]),mandatoryData.options[i].category1.startsWith("option_group")?mandatoryData.options[i].category1="options":"EXTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1?(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="exterior highlights"):"INTERIOR_HIGHLIGHTS"===mandatoryData.options[i].category1&&(mandatoryData.options[i].category1="options",mandatoryData.options[i].category2="interior highlights"),!variable.allowedOptionsCategory1.includes(mandatoryData.options[i].category1)){if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1){let S="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",S,variable.allowedOptionsCategory1,"")}{let k=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",k,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}}else{if(variable.events[eventName].mandatoryData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let F="string"==typeof mandatoryData.options[i].category1&&0==mandatoryData.options[i].category1.trim().length?"empty":"incorrect";return void variable._throwError("m","options[n].category1",F,variable.allowedOptionsCategory1,"")}if(variable.events[eventName].optionalData.indexOf("options[n].category1")>-1&&void 0!==mandatoryData.options[i].category1){let x=("string"==typeof mandatoryData.options[i].category1&&mandatoryData.options[i].category1.trim().length,"incorrect-o");variable._throwError("o","options[n].category1",x,variable.allowedOptionsCategory1,""),mandatoryData.options[i].category1=""}}for(var i in mandatoryData.options){if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerOutletBuno")>-1){let P=/^[0-9]+$/;for(mandatoryData.options[i].linkedDealerOutletBuno=P.test(mandatoryData.options[i].linkedDealerOutletBuno)?parseInt(mandatoryData.options[i].linkedDealerOutletBuno,10):NaN,void 0===mandatoryData.options[i].linkedDealerOutletBuno||"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&!isNaN(mandatoryData.options[i].linkedDealerOutletBuno)?void 0!==mandatoryData.options[i].linkedDealerOutletBuno&&"number"==typeof convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)&&(mandatoryData.options[i].linkedDealerOutletBuno=convertToNumeric(mandatoryData.options[i].linkedDealerOutletBuno)):(variable._throwError("o","options[n].linkedDealerOutletBuno","incorrect-numeric",""),mandatoryData.options[i].linkedDealerOutletBuno=""),mandatoryData.options[i].linkedDealerOutletBuno=""+mandatoryData.options[i].linkedDealerOutletBuno;mandatoryData.options[i].linkedDealerOutletBuno.length>1&&mandatoryData.options[i].linkedDealerOutletBuno.length<5;)mandatoryData.options[i].linkedDealerOutletBuno="0"+mandatoryData.options[i].linkedDealerOutletBuno}if(Object.keys(mandatoryData.options[i]).indexOf("linkedDealerCount")>-1)if(void 0!==mandatoryData.options[i].linkedDealerCount&&"number"!=typeof mandatoryData.options[i].linkedDealerCount){if(variable.events[eventName].mandatoryData.indexOf("options[n].linkedDealerCount")>-1)return void variable._throwError("m","options[n].linkedDealerCount","incorrect-numeric","");variable._throwError("o","options[n].linkedDealerCount","incorrect-numeric",""),mandatoryData.options[i].linkedDealerCount=""}else void 0!==mandatoryData.options[i].linkedDealerCount&&"number"==typeof mandatoryData.options[i].linkedDealerCount&&(mandatoryData.options[i].linkedDealerCount=convertToNumeric(mandatoryData.options[i].linkedDealerCount))}if(void 0!==mandatoryData&&void 0!==mandatoryData.options&&(0==variable.message.product.length&&(variable.message.product=[]),mandatoryData.options.forEach((e=>{let t=JSON.parse(JSON.stringify(variable.productSchema)),a=PROJECT_SPECIFIC_DATA&&PROJECT_SPECIFIC_DATA.options,o=variable.message.component[0].componentInfo;t.productInfo.productName=gFFWNV([()=>a.productName,()=>e.name]),t.productInfo.productID=gFFWNV([()=>a.productID,()=>e.productID,()=>e.code,()=>"product"+(optionIdGenerate+1)]),t.productInfo.manufacturer=gFFWNV([()=>a.manufacturer,()=>e.manufacturer]),t.category.productType=gFFWNV([()=>a.productType,()=>e.businessDivision]),t.category.primaryCategory=gFFWNV([()=>a.primaryCategory,()=>"finance"==e.primaryCategory&&"finance",()=>o.componentName&&o.componentName+" options",()=>variable.message.component[0].componentInfo.componentName+" options"]),t.category.subCategory1=gFFWNV([()=>a.subCategory1,()=>e.category1]),t.category.subCategory2=gFFWNV([()=>a.subCategory2,()=>e.category2]),t.category.subCategory3=gFFWNV([()=>a.subCategory3,()=>e.category3]),t.attributes.modelCode=gFFWNV([()=>a.codeVG,()=>e.codeVG]),t.attributes.modelCode=(t.attributes.modelCode||"").toUpperCase(),t.attributes.status=gFFWNV([()=>a.status,()=>e.status]),t.attributes.mmdr=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdr=(t.attributes.mmdr||"").toUpperCase(),t.attributes.mmdrVG=gFFWNV([()=>a.range,()=>e.range]),t.attributes.mmdrVG=(t.attributes.mmdrVG||"").toUpperCase(),t.attributes.linkedOutletBuno=gFFWNV([()=>a.linkedOutletBuno,()=>e.linkedOutletBuno]),t.attributes.linkedDealerCount=gFFWNV([()=>a.linkedDealerCount,()=>e.linkedDealerCount]),t.attributes.salesModel=gFFWNV([()=>a.salesModel,()=>e.salesModel]),t.attributes.series=gFFWNV([()=>a.series,()=>e.series]),t.productInfo.color=gFFWNV([()=>a.color,()=>e.color]),t.attributes.fin={},t.attributes.fin.downPayment=gFFWNV([()=>a.downPayment,()=>e.downPayment]),t.attributes.fin.finMileage=gFFWNV([()=>a.finMileage,()=>e.finMileage]),t.attributes.fin.finMonthlyPayment=gFFWNV([()=>a.finMonthlyPayment,()=>e.finMonthlyPayment]),t.attributes.fin.finTerm=gFFWNV([()=>a.finTerm,()=>e.finTerm]),t.attributes.packageID=gFFWNV([()=>a.packageID,()=>e.packageID]),t.productInfo.size=gFFWNV([()=>a.size,()=>e.size]),t.attributes.linkedDealerOutletBuno=gFFWNV([()=>a.linkedDealerOutletBuno,()=>e.linkedDealerOutletBuno]),t=JSON.parse(JSON.stringify(t,((e,t)=>""==t?void 0:t))),variable.message.product.push(t),null==e.itemBasePrice&&null==e.itemDiscountSalesAmount&&null==e.itemDiscountOtherAmount&&null==e.itemTaxAmount&&null==e.itemPriceWithTax||(includePriceCalculationOptions=!0)}))),includePriceCalculationOptions){function isValidNumericFormat(e){return/^\d{1,3}(,\d{3})*(\.\d+)?$/.test(e)}function convertToNumeric(e){return"number"==typeof e?e:isValidNumericFormat(e)?Number(e.replace(/,/g,"")):null}function roundToDecimal(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}this.message.cart.item=[],void 0===variable&&(variable=this);var total_basePrice=0,total_priceWithTax=0,total_shipping=0,total_taxAmount=0,total_voucherDiscount=0,total_DiscountAmount=0,total_DiscountPercent=0,total_quantity=0,total_itemOtherDiscountAmount=0,total_itemSalesDiscountAmount=0,total_DiscountAmountSum=0;function calculateValues(e){if(e&&e.length>0)for(var t in e)e[t].itemPriceWithTax=+(e[t].itemBasePrice||0)+(+(e[t].itemDiscountSalesAmount||0)+ +(e[t].itemDiscountOtherAmount||0))+ +(e[t].itemTaxAmount||0),e[t].itemPriceWithTax=roundToDecimal(e[t].itemPriceWithTax,2)}function validateNumericValue(e){return"number"==typeof e&&!isNaN(e)}function toNegativeNumber(e){return-1*Math.abs(Number(e))}function handleNumericValue(e,t,a,o){var i;if("negative"==o?(t[e]=toNegativeNumber(t[e]),i=!("number"==typeof t[e]&&t[e]<0)):i="number"!=typeof convertToNumeric(t[e]),t[e])if(i){if(i="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(a)>-1)return void variable._throwError("m",a,i,"");variable._throwError("o",a,i,""),t[e]=""}else"number"==typeof convertToNumeric(t[e])&&["itemBasePrice","itemPriceWithTax","itemQuantity","itemShippingCost","itemTaxAmount","itemTaxRate"].indexOf(e)>-1&&(t[e]=convertToNumeric(t[e]),t[e]=roundToDecimal(t[e],2))}function handleNumericData(e,t){for(var a=0;a<e.length;a++){var o=e[a];handleNumericValue("itemBasePrice",o,t+"[n].itemBasePrice"),handleNumericValue("itemDiscountSalesAmount",o,t+"[n].itemDiscountSalesAmount","negative"),handleNumericValue("itemDiscountOtherAmount",o,t+"[n].itemDiscountOtherAmount","negative"),handleNumericValue("itemPriceWithTax",o,t+"[n].itemPriceWithTax",t+"[n].itemPriceWithTax"),handleNumericValue("itemQuantity",o,t+"[n].itemQuantity"),handleNumericValue("itemTaxAmount",o,t+"[n].itemTaxAmount")}}if(!window.TRON.priceCalculation){const V=["totalBasePrice","totalDiscountAmount","totalDiscountPercent","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","totalCurrency"];for(const W of V)if("totalCurrency"==W){if(void 0!==mandatoryData&&void 0!==mandatoryData.totalCurrency&&(3!=mandatoryData.totalCurrency.length||mandatoryData.totalCurrency!==mandatoryData.totalCurrency.toUpperCase())){if(this.events[eventName].mandatoryData.indexOf("totalCurrency")>-1){let _="string"==typeof mandatoryData.totalCurrency&&0==mandatoryData.totalCurrency.trim().length?"empty":"incorrect";return void this._throwError("m","totalCurrency",_,"","(has to follow ISO 3-letter currency code all upper case)")}{let E=("string"==typeof mandatoryData.totalCurrency&&mandatoryData.totalCurrency.trim().length,"incorrect-o");this._throwError("o","totalCurrency",E,"","(has to follow ISO 3-letter currency code all upper case)"),mandatoryData.totalCurrency=""}}}else{var value=mandatoryData&&mandatoryData[W],flagDetermine;if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(W)>-1?(value=toNegativeNumber(value),flagDetermine=!("number"==typeof value&&value<0)):flagDetermine="number"!=typeof convertToNumeric(value),value)if(flagDetermine){if(["totalDiscountAmount","totalDiscountAmountAdditional"].indexOf(W),flagDetermine="incorrect-numeric",variable.events[eventName].mandatoryData.indexOf(W)>-1)return void variable._throwError("m",W,flagDetermine,"");variable._throwError("o",W,flagDetermine,""),mandatoryData[W]=""}else mandatoryData[W]=convertToNumeric(mandatoryData[W]),mandatoryData[W]=roundToDecimal(mandatoryData[W],3)}window.TRON.priceCalculation=!0}void 0!==mandatoryData&&void 0!==mandatoryData.vehicle&&mandatoryData.vehicle.length>0&&handleNumericData(mandatoryData.vehicle,"vehicle"),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&handleNumericData(mandatoryData.options,"options");var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processCartItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>e.itemSalesVoucherType,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemSalesDiscountAmount,()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_DiscountAmount+=a.price.discountAmount,total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemOtherDiscountAmount,()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_DiscountAmount+=a.price.discountAmountOther,total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=+(a.price.discountAmount+a.price.discountAmountOther),a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a.price.shippingMethod=a.price.shippingMethod.toLowerCase(),a}if(void 0!==mandatoryData&&mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var cartProcessedElement=processCartItem(mandatoryData.vehicle[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==mandatoryData&&mandatoryData.options)for(var i in mandatoryData.options){var cartProcessedElement=processCartItem(mandatoryData.options[i],this.defaultDatalayer.cart.item[0]);this.message.cart.item.push(cartProcessedElement)}if(void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.cart.price={},this.message.cart.price.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.cart.price.currency=this.message.cart.price.currency.toUpperCase(),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.cart.price.basePrice=roundToDecimal(this.message.cart.price.basePrice,2),this.message.cart.price.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.cart.price.discountItemAmounts=toNegativeNumber(this.message.cart.price.discountItemAmounts),this.message.cart.price.discountItemAmounts=roundToDecimal(this.message.cart.price.discountItemAmounts,2),this.message.cart.price.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountAdditional=toNegativeNumber(this.message.cart.price.discountAmountAdditional),this.message.cart.price.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),this.message.cart.price.discountAmountSum=toNegativeNumber(this.message.cart.price.discountAmountSum),this.message.cart.price.discountAmountSum=roundToDecimal(this.message.cart.price.discountAmountSum,2),this.message.cart.price.taxItemsAmount=gFFWNV([()=>total_taxAmount,()=>0])||0,this.message.cart.price.taxItemsAmount=roundToDecimal(this.message.cart.price.taxItemsAmount,2),this.message.cart.price.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.cart.price.shipping=roundToDecimal(this.message.cart.price.shipping,2),total_shipping=this.message.cart.price.shipping,this.message.cart.cartID=gFFWNV([()=>mandatoryData.cartID,()=>""])||"",this.message.cart.cartID=((this.message.cart.cartID||"")+"").toUpperCase(),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0,this.message.cart.price.priceWithTax=roundToDecimal(this.message.cart.price.priceWithTax,2),this.message.cart.price.cartTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),this.message.cart.price.cartTotal=roundToDecimal(this.message.cart.price.cartTotal,2)),void 0!==mandatoryData.transactionID){if(this.message.transaction.item=[],["total_basePrice","total_priceWithTax","total_shipping","total_taxAmount","total_voucherDiscount","total_DiscountAmount","total_DiscountPercent","total_quantity","total_itemOtherDiscountAmount","total_itemSalesDiscountAmount","total_DiscountAmountSum"].forEach((function(variableName){try{void 0!==eval(variableName)?eval(variableName+" = 0;"):eval("var "+variableName+" = 0;")}catch(e){}})),void 0!==mandatoryData&&void 0!==mandatoryData.transactionID&&mandatoryData.transactionID.length>=20){var messageToUpdate="The transactionID is limited to 20 characters due to adobe analytics limitations. Everything afterwards will be truncated. If this truncated value matches subsequent truncated values in any order event, the order and revenue metrics are de-duplicated, what will cause data loss. Please provide an ID, which has max. 20 characters and is unique per transaction/order.";this._throwError("o","","","",messageToUpdate),mandatoryData.transactionID=mandatoryData.transactionID.substring(0,20)}var productsProcessed={};for(var i in this.message.product)productsProcessed[this.message.product[i].productInfo.productID]=this.message.product[i];function processTransactionItem(e,t){let a=JSON.parse(JSON.stringify(t));return a=Object.assign({},a,productsProcessed[e.productID]),a.quantity=gFFWNV([()=>e.itemQuantity,()=>1]),total_quantity+=a.quantity,a.price.basePrice=+(gFFWNV([()=>e.itemBasePrice,()=>0])||0),a.price.basePrice=roundToDecimal(a.price.basePrice,2),total_basePrice+=a.price.basePrice,a.price.voucherCode=gFFWNV([()=>e.itemVoucherCode,()=>""])||"",a.price.discountAmount=+(gFFWNV([()=>e.itemDiscountSalesAmount,()=>0])||0),a.price.discountAmount=roundToDecimal(a.price.discountAmount,2),total_itemSalesDiscountAmount+=a.price.discountAmount,a.price.discountAmountOther=+(gFFWNV([()=>e.itemDiscountOtherAmount,()=>0])||0),a.price.discountAmountOther=roundToDecimal(a.price.discountAmountOther,2),total_itemOtherDiscountAmount+=a.price.discountAmountOther,a.price.discountAmountSum=gFFWNV([()=>a.price.discountAmount+a.price.discountAmountOther,()=>0])||0,a.price.discountAmountSum=toNegativeNumber(a.price.discountAmountSum),a.price.discountAmountSum=roundToDecimal(a.price.discountAmountSum,2),total_DiscountAmountSum+=a.price.discountAmountSum,a.price.taxAmount=+(gFFWNV([()=>e.itemTaxAmount,()=>0])||0),a.price.taxAmount=roundToDecimal(a.price.taxAmount,2),total_taxAmount+=a.price.taxAmount,a.price.priceWithTax=+(gFFWNV([()=>e.itemPriceWithTax,()=>a.price.basePrice+a.price.discountAmountSum+a.price.taxAmount,()=>0])||0),a.price.priceWithTax=roundToDecimal(a.price.priceWithTax,2),total_priceWithTax+=a.price.priceWithTax,a.price.shippingMethod=gFFWNV([()=>e.itemShippingMethod,()=>""])||"",a}if(void 0!==mandatoryData&&void 0!==mandatoryData.vehicle)for(var i in mandatoryData.vehicle){var transactionProcessedElement=processTransactionItem(mandatoryData.vehicle[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}if(void 0!==mandatoryData&&void 0!==mandatoryData.options)for(var i in mandatoryData.options){var transactionProcessedElement=processTransactionItem(mandatoryData.options[i],this.defaultDatalayer.transaction.item[0]);this.message.transaction.item.push(transactionProcessedElement)}void 0!==this.message.custom&&(mandatoryData.vehicle||mandatoryData.options)&&(this.message.transaction.total={},this.message.transaction.transactionID=gFFWNV([()=>mandatoryData.transactionID,()=>""])||"",this.message.transaction.transactionID=(this.message.transaction.transactionID+"").toUpperCase(),eventName.indexOf("OrderSuccess")>-1&&(this.message.event[0].attributes.purchaseID=this.message.transaction.transactionID),this.message.transaction.total.currency=gFFWNV([()=>mandatoryData.totalCurrency,()=>""])||"",this.message.transaction.total.currency=(this.message.transaction.total.currency||"").toUpperCase(),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>total_basePrice,()=>0])||0),this.message.transaction.total.basePrice=roundToDecimal(this.message.transaction.total.basePrice,2),this.message.transaction.total.discountItemAmounts=gFFWNV([()=>total_DiscountAmountSum,()=>0])||0,this.message.transaction.total.discountItemAmounts=toNegativeNumber(this.message.transaction.total.discountItemAmounts),this.message.transaction.total.discountItemAmounts=roundToDecimal(this.message.transaction.total.discountItemAmounts,2),this.message.transaction.total.discountAmountAdditional=+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountAdditional=toNegativeNumber(this.message.transaction.total.discountAmountAdditional),this.message.transaction.total.discountAmountSum=+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),this.message.transaction.total.discountAmountSum=toNegativeNumber(this.message.transaction.total.discountAmountSum),this.message.transaction.total.discountAmountSum=roundToDecimal(this.message.transaction.total.discountAmountSum,2),this.message.transaction.total.taxItemsAmount=+(gFFWNV([()=>total_taxAmount,()=>0])||0),this.message.transaction.total.taxItemsAmount=roundToDecimal(this.message.transaction.total.taxItemsAmount,2),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>total_taxAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),this.message.transaction.total.shipping=roundToDecimal(this.message.transaction.total.shipping,2),this.message.transaction.total.priceWithTax=+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),this.message.transaction.total.priceWithTax=roundToDecimal(this.message.transaction.total.priceWithTax,2),this.message.transaction.total.transactionTotal=+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),this.message.transaction.total.transactionTotal=roundToDecimal(this.message.transaction.total.transactionTotal,2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"")}}if(void 0!==mandatoryData&&void 0!==mandatoryData.filterObject){let L=mandatoryData.filterObject;if(!this.allowedFilterObjects.includes(L)){if(this.events[eventName].mandatoryData.indexOf("filterObject")>-1){let R="string"==typeof mandatoryData.filterObject&&0==mandatoryData.filterObject.trim().length?"empty":"incorrect";return void this._throwError("m","filterObject",R,this.allowedFilterObjects)}{let j=("string"==typeof mandatoryData.filterObject&&mandatoryData.filterObject.trim().length,"incorrect-o");this._throwError("o","filterObject",j,this.allowedFilterObjects)}}mandatoryData.filterObject=L}if(void 0!==mandatoryData&&"compare"!=this.message.component[0].category.subCategory1&&"stock locator"!=this.message.component[0].category.primaryCategory&&void 0!==mandatoryData.filterObject&&(this.message.component[0].category.subCategory1=gFFWNV([()=>(this.message.component[0].category.subCategory1||this.component.category.subCategory1)+" "+mandatoryData.filterObject||this.component.category.subCategory1])),void 0!==mandatoryData&&void 0!==mandatoryData.search&&mandatoryData.search.length>0){var flagVariable=!1;for(var i in mandatoryData.search)void 0!==mandatoryData.search[i].searchState&&(this.allowedSearchState.includes(mandatoryData.search[i].searchState)||(flagVariable=!0,mandatoryData.search[i].searchState=""));if(flagVariable){if(this.events[eventName].mandatoryData.indexOf("search[n].searchState")>-1)return void this._throwError("m","search[n].searchState","incorrect",this.allowedSearchState);this._throwError("o","search[n].searchState","incorrect-o",this.allowedSearchState)}}if(void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.effect=gFFWNV([()=>this.message.event[0].eventInfo.effect+" "+mandatoryData.sortType])),void 0!==mandatoryData.sortType&&"sort"==this.message.event[0].eventInfo.eventAction&&void 0!==mandatoryData.searchResults&&(this.message.event[0].category.subCategory1=gFFWNV([()=>mandatoryData.searchResults])),void 0!==mandatoryData.filterObject&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.type=mandatoryData.filterObject,this.message.event[0].eventInfo.effect=mandatoryData.filterObject+" "+this.message.event[0].eventInfo.effect),void 0!==mandatoryData.searchResults&&"search"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].category.subCategory1=mandatoryData.searchResults),void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=gFFWNV([()=>mandatoryData.positionClicked])),void 0!==mandatoryData.searchResults&&void 0!==mandatoryData.positionClicked&&(this.message.event[0].attributes.positionClicked=this.message.event[0].attributes.positionClicked+"/"+mandatoryData.searchResults),this.message.event[0].attributes.search=[],mandatoryData.search&&void 0!==mandatoryData.search&&mandatoryData.search.forEach((e=>{let t={};t.label=gFFWNV([()=>e.searchLabel]),void 0!==e.searchTerm&&(t.term=e.searchTerm),t.term=gFFWNV([()=>e.searchTerm]),t.state=gFFWNV([()=>e.searchState,()=>"user selected"]),t.unit=gFFWNV([()=>e.searchUnit]),this.message.event[0].attributes.search.push(t)})),mandatoryData&&mandatoryData.userLoginStatus&&void 0!==mandatoryData.userLoginStatus){let M=mandatoryData.userLoginStatus;if(!this.allowedUserLoginStatus.includes(M)){let J="string"==typeof mandatoryData.userLoginStatus&&0==mandatoryData.userLoginStatus.trim().length?"empty":"incorrect";return void this._throwError("m","UserLoginStatus",J,this.allowedUserLoginStatus)}mandatoryData.userLoginStatus=M}if(void 0!==mandatoryData.userLoginStatus&&(this.message.user[0].profile[0].attributes.loggedInStatus=gFFWNV([()=>mandatoryData.userLoginStatus])),void 0!==mandatoryData.userProfileID&&(this.message.user[0].profile[0].profileInfo.profileID=gFFWNV([()=>mandatoryData.userProfileID])),void 0!==mandatoryData.userSegment&&(this.message.user[0].segment=gFFWNV([()=>mandatoryData.userSegment])),void 0!==mandatoryData.userType&&(this.message.user[0].profile[0].profileInfo.type=gFFWNV([()=>mandatoryData.userType])),mandatoryData.section&&void 0!==mandatoryData.section&&("visualizer tab bar navigation"==this.message.event[0].category.subCategory1?this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.section+" tab":"visualizer configuration change"==this.message.event[0].category.subCategory1&&(this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect+mandatoryData.section)),void 0!==mandatoryData&&void 0!==mandatoryData.options&&mandatoryData.options.length>0&&void 0!==mandatoryData.vehicle&&1==mandatoryData.vehicle.length){let B=mandatoryData.vehicle[0].range||"",G=mandatoryData.vehicle[0].rangeVG||mandatoryData.vehicle[0].range||"",$=mandatoryData.vehicle[0].codeVG||mandatoryData.vehicle[0].codeAG||"",U=mandatoryData.vehicle[0].hybridVersion||"";for(var i in this.message.product)void 0===this.message.product[i].attributes.bodyType&&(void 0===this.message.product[i].attributes.mmdr&&(this.message.product[i].attributes.mmdr=B.toUpperCase()),void 0===this.message.product[i].attributes.mmdrVG&&(this.message.product[i].attributes.mmdrVG=G.toUpperCase()),void 0===this.message.product[i].attributes.modelCodeVG&&(this.message.product[i].attributes.modelCodeVG=$.toUpperCase()),void 0===this.message.product[i].attributes.hybridVersion&&(this.message.product[i].attributes.hybridVersion=U))}if(void 0!==mandatoryData&&mandatoryData.componentVersion&&(this.message.component[0].attributes.componentVersion=mandatoryData.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==mandatoryData&&(this.message.component[0].componentInfo.componentID=determineBrand(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.pageGeoRegion?mandatoryData.pageGeoRegion:"")||datalayerPath("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==mandatoryData.formType?mandatoryData.formType:"")),TRON.componentName=(void 0!==mandatoryData.componentName?mandatoryData.componentName:"")||this.message.component[0].componentInfo.componentName||TRON.componentName),void 0!==this.message.event[0].eventInfo.effect&&(void 0!==prefix&&(prefix=prefix.split(">").map((e=>e.trim())).join(" > ")),this.message.event[0].eventInfo.effect=(prefix||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),this.message.product.length>0){var prodRef=[],prodRef2=[];for(var i in this.message.product)if(void 0!==this.message.product[i]&&void 0!==this.message.product[i].productInfo){var productKey=this.message.product[i].productInfo.productID;void 0===productKey&&(productKey="product"+(i+1)),prodRef.push(productKey),void 0!==this.message.product[i].category.primaryCategory&&(this.message.product[i].category.primaryCategory.indexOf("car")>-1||this.message.product[i].category.primaryCategory.indexOf("bike")>-1)&&prodRef2.push(productKey)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],"page view"==this.message.event[0].eventInfo.eventName?this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef2):this.message.page.pageInfo.reference.defaultProducts=[].concat(prodRef)}var hasUserKey=Object.keys(mandatoryData).some((e=>e.startsWith("user")));if(void 0!==mandatoryData&&!hasUserKey)if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState){var users=window.adobeDataLayer.getState();if(void 0!==users.user&&Object.keys(users.user).length>0){var userArray=[];for(var i in users.user)userArray.push(users.user[i]);this.message.user=this.message.user}}else void 0!==getDL("user")&&"string"!=typeof getDL("user")&&(this.message.user=getDL("user"));if("error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==mandatoryData.errorMessage?(prefix||"")+mandatoryData.errorMessage:"",void 0!==mandatoryData.errorAction&&(this.message.event[0].eventInfo.eventAction=mandatoryData.errorAction),void 0!==mandatoryData.errorCause&&(this.message.event[0].eventInfo.cause=mandatoryData.errorCause),void 0!==mandatoryData.errorType&&(this.message.event[0].eventInfo.type=mandatoryData.errorType),this.message.event[0].category.primaryCategory=mandatoryData.componentName||this.message.component[0].componentInfo.componentName,void 0!==mandatoryData.errorCode&&(this.message.event[0].category.subCategory1=mandatoryData.errorCode),void 0!==mandatoryData.errorOrigin&&(this.message.event[0].category.subCategory2=mandatoryData.errorOrigin),void 0!==mandatoryData.errorURL&&(this.message.event[0].attributes.requestedURL=mandatoryData.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),mandatoryData.eventCause&&null!=mandatoryData.eventCause&&(this.message.event[0].eventInfo.cause=mandatoryData.eventCause),void 0!==mandatoryData.eventPoints||"string"==typeof mandatoryData.eventPoints&&0==mandatoryData.eventPoints.trim().length){if("number"!=typeof mandatoryData.eventPoints){var determineError=void 0!==mandatoryData.eventPoints&&""==mandatoryData.eventPoints?"empty":"incorrect-numeric";if(this.events[eventName].mandatoryData.indexOf("eventPoints")>-1)return void this._throwError("m","eventPoints",determineError,"","(time between two events in miliseconds)");this._throwError("o","eventPoints",determineError,"","(time between two events in miliseconds)")}this.message.event[0].eventInfo.eventPoints=mandatoryData.eventPoints}if(void 0===mandatoryData.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==mandatoryData.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&"string"==typeof mandatoryData.eventAction&&mandatoryData.eventAction.trim().length>0&&(this.message.event[0].eventInfo.eventAction=mandatoryData.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=(this.message.event[0].eventInfo.effect||"").toLowerCase(),mandatoryData.stepAmounts&&void 0!==mandatoryData.stepAmounts&&(mandatoryData.step&&void 0!==mandatoryData.step?this.message.event[0].attributes.stepAmounts="step "+mandatoryData.step+"/"+mandatoryData.stepAmounts:this.message.event[0].attributes.stepAmounts=mandatoryData.stepAmounts),this.message.component[0].componentInfo.componentID=`${gFFWNV([()=>adobeDataLayer.getState("page.attributes.brand"),()=>determineBrand()])||""}/${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.geoRegion"),()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>((this.message.page||"").pageInfo||"").geoRegion||""])||""}_${gFFWNV([()=>adobeDataLayer.getState("page.pageInfo.language"),()=>((this.message.page||"").pageInfo||"").language||"",()=>window.location.host.indexOf("bmwusa")>-1?"en":""])||""}/${this.message.component[0].componentInfo.componentName}`,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this.message.paramsPassed={},this.message.paramsPassed=JSON.parse(JSON.stringify(mandatoryData)),void 0!==mandatoryData){let q,H,K,z;if(q=H=K=[],void 0!==this.message.cart&&void 0!==this.message.cart.item&&this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID){for(z=this.message.cart.item.length-1;z>=0;z--){let X=!1;void 0!==this.message.cart.item[z]&&void 0!==this.message.cart.item[z].price&&(void 0!==this.message.cart.item[z].price.basePrice&&void 0!==this.message.cart.item[z].price.basePrice&&this.message.cart.item[z].price.basePrice>0||void 0!==this.message.cart.item[z].price.priceWithTax&&void 0!==this.message.cart.item[z].price.priceWithTax&&this.message.cart.item[z].price.priceWithTax>0)&&(X=!0);let Z=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(Z=!0));let ee=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,te=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;X||Z||X||Z||te?te&&this.message.cart.item.splice(z,1):this.message.cart.item.splice(z,1)}this.message.cart.item.forEach((e=>{void 0!==e.productInfo.productID&&H.push(e.productInfo.productID)}))}if(void 0!==this.message.transaction&&void 0!==this.message.transaction.item&&this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID){for(z=this.message.transaction.item.length-1;z>=0;z--){let ae=!1;void 0!==this.message.transaction.item[z]&&void 0!==this.message.transaction.item[z].price&&(void 0!==this.message.transaction.item[z].price.basePrice&&void 0!==this.message.transaction.item[z].price.basePrice&&this.message.transaction.item[z].price.basePrice>0||void 0!==this.message.transaction.item[z].price.priceWithTax&&void 0!==this.message.transaction.item[z].price.priceWithTax&&this.message.transaction.item[z].price.priceWithTax>0)&&(ae=!0);let oe=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(oe=!0));let ie=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,ne=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;ae||oe?ne||this.message.transaction.item.splice(z,1):ne&&!ae&&oe||!ne||ae||oe||this.message.transaction.item.splice(z,1),""!=(((this.message.transaction.item[z]||"").productInfo||"").productID||"")&&H.indexOf(this.message.transaction.item[z].productInfo.productID)>-1&&this.message.transaction.item.splice(z,1)}this.message.transaction.item.forEach((e=>{void 0!==e.productInfo.productID&&K.push(e.productInfo.productID)}))}if(void 0!==this.message.product&&void 0!==this.message.product&&this.message.product.length>0&&void 0!==this.message.product[0].productInfo.productID)for(z=this.message.product.length-1;z>=0;z--){let re=!1;void 0!==this.message.product[z]&&void 0!==this.message.product[z].price&&(void 0!==this.message.product[z].price.basePrice&&void 0!==this.message.product[z].price.basePrice&&this.message.product[z].price.basePrice>0||void 0!==this.message.product[z].price.priceWithTax&&void 0!==this.message.product[z].price.priceWithTax&&this.message.product[z].price.priceWithTax>0)&&(re=!0);let se=!1;void 0!==mandatoryData&&(void 0===mandatoryData.totalBasePrice&&void 0===mandatoryData.totalPriceWithTax||(se=!0));let ce=void 0!==mandatoryData.cartID&&""!=typeof mandatoryData.cartID,le=void 0!==mandatoryData.transactionID&&""!=typeof mandatoryData.transactionID;re&&this.message.product.splice(z,1),!se||le||re||(H.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.cart.item.push(this.message.product[z]),this.message.product.splice(z,1)),se&&le&&(K.indexOf(this.message.product[z].productInfo.productID)<0&&this.message.transaction.item.push(this.message.product[z]),this.message.product.splice(z,1)),""!=(((this.message.product[z]||"").productInfo||"").productID||"")&&(H.indexOf(this.message.product[z].productInfo.productID)>-1||K.indexOf(this.message.product[z].productInfo.productID)>-1)&&this.message.product.splice(z,1)}function Q(e){return-1*Math.abs(Number(e))}function Y(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}if(this.message.cart.item.length>0&&0==Object.keys(this.message.cart.item[0].price).length&&0==Object.keys(this.message.cart.item[0].productInfo).length&&this.message.cart.item.splice(0,1),this.message.cart.item.length>0&&void 0!==this.message.cart.item[0].productInfo.productID&&void 0===this.message.cart.price.cartTotal){this.message.cart.price.currency=(mandatoryData.totalCurrency||"").toUpperCase();let de=0;Object.keys(this.message.cart.item).forEach((e=>{de+=(e.price||0).basePrice||0})),de=Y(de,2),this.message.cart.price.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>de,()=>0])||0),this.message.cart.price.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.cart.price.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0);let me=0;Object.keys(this.message.cart.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(me+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(me+=e.price.discountAmountOther||0)})),me=Y(me,2),this.message.cart.price.discountItemAmounts=Q(Y(me,2)),this.message.cart.price.discountAmountSum=Q(Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.cart.price.discountItemAmounts+this.message.cart.price.discountAmountAdditional,()=>0])||0),2));let ue=0;Object.keys(this.message.cart.item).forEach((e=>{ue+=(e.price||0).taxAmount||0})),ue=Y(ue,2),this.message.cart.price.taxItemsAmount=Y(ue,2),this.message.cart.price.taxAmountSum=+(gFFWNV([()=>this.message.cart.price.taxItemsAmount+this.message.cart.price.taxAmountAdditional,()=>0])||0),this.message.cart.price.priceWithTax=Y(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.cart.price.basePrice+this.message.cart.price.discountAmountSum+this.message.cart.price.taxAmountSum,()=>0])||0),2),this.message.cart.price.shipping=Y(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.cart.price.cartTotal=Y(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.cart.price.priceWithTax+this.message.cart.price.shipping,()=>0])||0),2)}else 0==this.message.cart.item.length&&(this.message.cart.price={});if(this.message.cart.cartID=mandatoryData.cartID||"",this.message.transaction.item.length>0&&0==Object.keys(this.message.transaction.item[0].price).length&&0==Object.keys(this.message.transaction.item[0].productInfo).length&&this.message.transaction.item.splice(0,1),this.message.transaction.item.length>0&&void 0!==this.message.transaction.item[0].productInfo.productID&&void 0===this.message.transaction.total.transactionTotal){this.message.transaction.total.currency=(mandatoryData.totalCurrency||"").toUpperCase();let pe=0;Object.keys(this.message.transaction.item).forEach((e=>{pe+=(e.price||0).basePrice||0})),pe=Y(pe,2),this.message.transaction.total.basePrice=+(gFFWNV([()=>mandatoryData.totalBasePrice,()=>pe,()=>0])||0),this.message.transaction.total.discountAmountAdditional=Q(+(gFFWNV([()=>mandatoryData.totalDiscountAmountAdditional,()=>0])||0)),this.message.transaction.total.taxAmountAdditional=+(gFFWNV([()=>mandatoryData.totalTaxAmountAdditional,()=>0])||0),this.message.transaction.total.shipping=Y(+(gFFWNV([()=>mandatoryData.totalShippingCost,()=>0])||0),2),this.message.transaction.total.paymentMethod=gFFWNV([()=>mandatoryData.totalPaymentMethod,()=>""])||"";let ge=0;Object.keys(this.message.transaction.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ge+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ge+=e.price.discountAmountOther||0)})),ge=Y(ge,2),this.message.transaction.total.discountItemAmounts=Q(Y(ge,2)),this.message.transaction.total.discountAmountSum=Q(Y(+(gFFWNV([()=>mandatoryData.totalDiscountAmount,()=>this.message.transaction.total.discountItemAmounts+this.message.transaction.total.discountAmountAdditional,()=>0])||0),2));let he=0;Object.keys(this.message.transaction.item).forEach((e=>{he+=(e.price||0).taxAmount||0})),he=Y(he,2),this.message.transaction.total.taxItemsAmount=Y(he,2),this.message.transaction.total.taxAmountSum=+(gFFWNV([()=>this.message.transaction.total.taxItemsAmount+this.message.transaction.total.taxAmountAdditional,()=>0])||0),this.message.transaction.total.priceWithTax=Y(+(gFFWNV([()=>mandatoryData.totalPriceWithTax,()=>this.message.transaction.total.basePrice+this.message.transaction.total.discountAmountSum+this.message.transaction.total.taxAmountSum,()=>0])||0),2),this.message.transaction.total.transactionTotal=Y(+(gFFWNV([()=>mandatoryData.totalFinalPrice,()=>this.message.transaction.total.priceWithTax+this.message.transaction.total.shipping,()=>0])||0),2)}else 0==this.message.transaction.item.length&&(this.message.transaction.total={});this.message.transaction.transactionID=mandatoryData.transactionID||""}this._sendMessage()}_checkmandatoryData(e,t){let a,o=this.events[e].mandatoryData,i=!0,n="";for(let r=0;r<o.length;r++){let s,c=o[r];if(c.indexOf("[n]")>-1){let e=c.split("[n]");n=e[1].replace(".",""),s=t[e[0]]&&t[e[0]][0][n]}else s=t[c];if(void 0===s)switch(c){case"componentType":s=((this.component||"").category||"").componentType||"";break;case"componentName":s=((this.component||"").componentInfo||"").componentName||"";break;case"componentSubCat1":s=((this.component||"").category||"").subCategory01||""}a=this._checkValidValue("mandatory",c,n,s,e,t),0==a&&(i=!1)}if(0==i)throw new SyntaxError("Missing Mandatory Data");return!0}_checkOptionalData(e,t){let a,o=this.events[e].optionalData,i=!0,n="",r=[];for(let s=0;s<o.length;s++){let c,l=o[s];if(l.indexOf("[n]")>-1){let e=l.split("[n]");t[e[0]]&&t[e[0]].length>0&&(n=e[1].replace(".",""),c=t[e[0]][0][n],c&&""==c&&r.push(l))}else c=t[l];void 0===c&&void 0===t[l]||(a=this._checkValidValue("optional",l,n,c,e,t),0==a&&(l.indexOf("[n]")>-1?t[l.split("[n]")[0]][0][l.split("[n]")[1].replace(".","")]="":t[l]="",i=!1))}return!0}_checkValidValue(e,t,a,o,i,n){let r=!0,s=Object.keys(this).map((e=>e.toLowerCase()));a=""!=a&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let c=s.filter((e=>e.includes(a.toLowerCase()))),l="object"==typeof this[Object.keys(this)[s.indexOf(c[0])]]?this[Object.keys(this)[s.indexOf(c[0])]]:[];"eventEffect"==a?(l=[],i.toLowerCase().indexOf("viewactions")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]])):"stepName"==a&&(l=[],i.toLowerCase().indexOf("checkoutprocess")>-1?c[0].indexOf("generic")>-1&&(l=this[Object.keys(this)[s.indexOf(c[0])]]):c.length>1?l=this[Object.keys(this)[s.indexOf(c[1])]]:1==c.length&&c[0].indexOf("generic")<0&&(l=this[Object.keys(this)[s.indexOf(c[0])]]));var d=["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1","eventPoints","viewMode","viewType","viewDayTime","viewScreen","viewPerspective","filterObject","search[n].searchState","componentPlatform","pageVariant","videoCurrentTime","videoTotalLength","formVariant","componentSubCat1","componentType","step","stepAmounts","totalCurrency","vehicle[n].itemBasePrice","vehicle[n].itemDiscountSalesAmount","vehicle[n].itemDiscountOtherAmount","vehicle[n].itemPriceWithTax","vehicle[n].itemQuantity","vehicle[n].itemTaxAmount","options[n].itemBasePrice","options[n].itemDiscountSalesAmount","options[n].itemDiscountOtherAmount","options[n].itemPriceWithTax","options[n].itemQuantity","options[n].itemTaxAmount","totalBasePrice","totalDiscountAmount","totalFinalPrice","totalPriceWithTax","totalShippingCost","totalTaxAmount","totalTaxAmountAdditional","totalDiscountAmountAdditional","options[n].linkedDealerCount","vehicle[n].linkedDealerCount","transactionID"];if(this.ignoreParamsNotApplicable.length>0&&(d=d.concat(this.ignoreParamsNotApplicable)),(l||[]).length>0&&(l=l.filter((function(e){return""!==e}))),(void 0===(o="string"==typeof o?(o||"").toLowerCase():o)||null==o)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),r=!1}if("string"==typeof o&&0==o.trim().length){if(d.indexOf(t)>-1)return!0;if(t.indexOf("vehicle")>-1){var m=["codeAG","codeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"];if(t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(t.indexOf("options")>-1){if(m=["codeVG"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="options[n]."+t}if(t.indexOf("dealer")>-1){if(m=["selectionState"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="dealer[n]."+t}"mandatory"==e?(this._throwError("m",t,"empty",l),r=!1):"optional"==e&&(l.length>0||this._throwError("o",t,"empty",l),1==l.length&&"value should be numeric"==l[0]&&this._throwError("o",t,"incorrect-o",l),r=!0)}if(Array.isArray(l)&&l.length>0&&!l.includes(o)&&1==r){if(t.indexOf("vehicle")>-1){if(m=["codeAG","codeVG","rangeAG","rangeVG","bodyType","businessDivision","category1","fuelType","hybridVersion","primaryCategory","series","salesModel","status"],t=t.split(".")[1],m.indexOf(t)>-1)return!0;t="vehicle[n]."+t}if(d.indexOf(t)>-1&&void 0!==o)return!0;if(1==l.length&&"value should be numeric"==l[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",l),r=!1):"optional"==e&&(this._throwError("o",t,"incorrect-o",l),r=!1)}return r}_loadEventData(e,t){const a=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));a.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));const o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),i=JSON.parse(JSON.stringify(this.baseEvent)),n=JSON.parse(JSON.stringify(this.events[e].event));a.event[0]=[o,i,n].reduce(this._deepMerge.bind(this),{}),a.event[0].timeStamp=(new Date).getTime(),PROJECT_SPECIFIC_DATA.pageExist&&void 0!==a.page&&(this.events[e].page?a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):a.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),PROJECT_SPECIFIC_DATA.projConditionCheck&&PROJECT_SPECIFIC_DATA.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};const r=JSON.parse(JSON.stringify(this.baseCustom||{})),s=JSON.parse(JSON.stringify(this.events[e].custom));return a.custom=[r,s].reduce(this._deepMerge.bind(this),{}),a.version="tron_v"+this._TronVersion+"¦"+this._componentTrackingVersion+"¦"+e,a}_throwError(e,t,a,o,i){const n="m"===e?"Incorrect TRON implementation: ⛔ ":"Incorrect TRON implementation: ⚠️ ";let r="",s="m"==e?"event":"value";switch(o=""!=o?o.reduce(((e,t)=>`${e},${t}`)):o,a){case"not-defined":r+=`the parameter ${t} is not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${i||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(r+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${i||""}`);break;case"missing":"string"!=typeof o&&o.length>0?r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t} with one of the following valid values: ${o}`:r+=`${t} parameter is missing, hence this ${s||""} cannot be tracked. Please provide the parameter ${i||""}: ${t}`;break;case"empty":"string"!=typeof o&&0==o.length?r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value ${t} ${i||""}`:r+=`${t} value is empty, hence this ${s||""} cannot be tracked. Please provide a valid value for ${t} ${i||""}: ${o}`;break;case"incorrect":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please pick a standard value ${i||""}: ${o}`;break;case"incorrect-o":r+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${i||""}: ${o}`;break;case"incorrect-numeric":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a numeric value. ${i||""}`;break;case"incorrect-numeric-negative":r+=`${t} value is incorrect, hence this ${s||""} cannot be tracked. Please send a negative numeric value. ${i||""}`;break;case"eventMessage":r+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${i||""}:`;break;case"nonValidFunction":r+=`function ${t}  is not defined in the library, hence this event cannot be tracked. Please make sure to use a correct reference name. ${i||""};`;break;case"pii-keyword":r+=`Parameter ${t} value includes the PII keyword ${i}, hence this value will be truncated from the start of the PII keyword. Don't use any of the following PII keywords: ${o}`;break;default:r+=i}r=n+r,"m"===e?TRON.customConsole.error(r):"o"==e&&TRON.customConsole.warn(r)}_validateProperty(e,t,a,o,i=!1){if(void 0!==o[e]){let i=o[e];if(!t.includes(i)){if(this.events[a].mandatoryData.indexOf(e)>-1){let a="string"==typeof i&&0==i.trim().length?"empty":"incorrect";throw this._throwError("m",e,a,t),new Error("")}{let a=("string"==typeof i&&i.trim().length,"incorrect-o");this._throwError("o",e,a,t),o[e]=""}}}}_debug(e,t){this.debug&&(e.indexOf("generic event successfully sent")>-1?(console.groupCollapsed("✅ generic event successfully sent"),TRON.customConsole.info(t),console.groupEnd()):TRON.customConsole.info(this.version,"\r\n",e,"\r\n",t))}_sendMessage(){for(var e=convertToACDL(this.message),t={},a=0;a<e.length;a++)for(var o=e[a],i=Object.keys(o),n=0;n<i.length;n++){var r=i[n];t[r]=o[r]}this._debug("✅ ACDL pushed event details: ",t),(this.message.component[0].category.componentType||"").indexOf("iframe")>-1?this._sendPostMessage():this._sendGenericEvent(),this.message={}}_sendCustomEvent(){let e=!1;try{e=new CustomEvent(this.customEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("✅ custom event successfully sent",e)}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_sendPostMessage(){let e=!1;try{var t=convertToACDL(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}}_deepMerge(e,t){return Object.entries(t).forEach((([t,a])=>{a&&"object"==typeof a?this._deepMerge(e[t]=e[t]||{},a):e[t]=a})),e}};function getDataLayerFromApi(){const e=window.digitals2&&window.digitals2.tracking&&window.digitals2.tracking.api;if(void 0!==e){const t=e.getCurrentPageIndex();let a;for(let a=t;a>0;a--)if("object"==typeof e.getPageObject(a).page&&"VCO"==e.getPageObject(a).page.category.primaryCategory){t=a;break}if(a=e.getPageObject(t),void 0!==a.pageInstanceId&&""!=a.pageInstanceId&&-1==a.pageInstanceId.indexOf("need-analyzer"))return a;if(void 0!==a.component&&a&&a.component[0]&&a.component[0].category&&"stock locator"==a.component[0].category.subCategory01)return a;if(void 0!==a.component&&a&&a.component[0]&&a.component[0].componentInfo&&"digital checkout solution"==a.component[0].componentInfo.componentName)return a;if(void 0!==a.pageInstanceId&&""!=a.pageInstanceId&&a.product.length>0)return a;if(void 0!==a.pageInstanceId&&""!=a.pageInstanceId)return t&&t>0?(a=e.getPageObject(t),a):(a=e.getPageObject(0),a)}}function getDataLayerFromSources(){return gFFWNV([getDataLayerFromApi,()=>{if("undefined"!=typeof BMWdataLayer)return JSON.parse(JSON.stringify(BMWdataLayer))},()=>{if("undefined"!=typeof mnm&&""!=((((mnm||"").mnmnsc||"").page||"").currentPage||"")&&void 0!==mnm.mnmnsc.page.currentPage.getTrackingService)return mnm.mnmnsc.page.currentPage.getTrackingService().getDigitalData()},()=>{if("undefined"!=typeof datalayer_localForms){const e=(datalayer_localForms||"").event||[];if(e.length>0)return e[e.length-1]}},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.digitalData&&window.dataLayer){const e=digital.tracking.getInstance(window.dataLayer),t=e.getCurrentPageIndex()||0,a=e.getPageObject(t);if("object"==typeof a&&0==Object.keys(a).length&&void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;if(""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0)return window.dataLayer.pages[e]}return JSON.parse(JSON.stringify(a))}},()=>{if(void 0!==window.h5vco&&""!=((window.h5vco||"").digitalData||""))return window.h5vco.digitalData},()=>{if(void 0!==window.dcsDataLayer&&""!=((window.dcsDataLayer||"").pages||"")){const e=window.dcsDataLayer.activePageIndex||0;return window.dcsDataLayer.pages[e]}},()=>{if(void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;return""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0?window.dataLayer.pages[e]:window.dataLayer}},()=>{if(void 0!==window.digitalData)return JSON.parse(JSON.stringify(window.digitalData))},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.dataLayer){const e=digital.tracking.getInstance(),t=e.getCurrentPageIndex()||0,a=e.getPageObject(t);return JSON.parse(JSON.stringify(a))}}],{})}function extractFrmPageDL(){try{return getDataLayerFromSources()||""}catch(e){return""}}function getDL(e,t){try{for(var a=(e=e||"").split("."),o=extractFrmPageDL(),i=0;i<a.length&&null!=o;i++)null!=a[i]&&""!=a[i]&&(o=Array.isArray(o)&&/-[0-9]+/.test(a[i])?o[o.length-Math.abs(parseInt(a[i]))]:o[a[i]]);return"string"==typeof o&&["","na","not set","n/a","not available","not yet available","not selected","unknown"].indexOf(o.toLowerCase())>-1?t:o||t||""}catch(e){return""}}function evaluateDLPath(e){return""!=getDL(e)&&void 0!==getDL(e)?getDL(e):""}function datalayerPath(e){return""!=getDL(e)&&void 0!==getDL(e)?getDL(e):void 0}function getFirstFunctionWithValue(e,t){for(let a of e)try{const e=a.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function gFFWNV(e,t={}){return getFirstFunctionWithValue(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function determineBrand(){return gFFWNV([()=>datalayerPath("page.attributes.brand"),()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function buildPageObj(){var e=JSON.parse(JSON.stringify(datalayerPath("page.attributes")||""))||{};return e.brand=determineBrand(),e.pageTitle=gFFWNV([()=>datalayerPath("page.title"),()=>datalayerPath("page.pageInfo.pageTitle"),()=>document.title]),e.timeZone=gFFWNV([()=>datalayerPath("page.attributes.timeZone")]),{attributes:JSON.parse(JSON.stringify(e)),category:{pageType:gFFWNV([()=>datalayerPath("page.category.pageType"),()=>datalayerPath("page.category.formType"),()=>datalayerPath("page.category.primaryTags")]),primaryCategory:gFFWNV([()=>"NBC"==datalayerPath("page.attributes.template")&&"configurator",()=>"object"==typeof datalayerPath("page.category.primaryTags")&&datalayerPath("page.category.primaryTags.0"),()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&"all-models"==datalayerPath("pageInstanceId").split("/")[6]&&datalayerPath("pageInstanceId").split("/")[6].length>8&&"showroom",()=>8==datalayerPath("pageInstanceId").split("/")[6].length&&"series overview",()=>datalayerPath("page.pageHier"),()=>datalayerPath("page.category.subCategory01"),()=>datalayerPath("page.category.primaryCategory"),()=>datalayerPath("page.primarySection"),()=>datalayerPath("page.category.primaryTags"),()=>TRON.componentName]),subCategory1:gFFWNV([()=>"object"==typeof datalayerPath("page.category.secondaryTags")&&datalayerPath("page.category.secondaryTags.0"),()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[7]&&datalayerPath("pageInstanceId").split("/")[7],()=>datalayerPath("page.pageLevel2"),()=>datalayerPath("page.category.subCategory01"),()=>datalayerPath("page.category.purchaseReason"),()=>datalayerPath("page.category.subCategory1")]),subCategory2:gFFWNV([()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[8]&&datalayerPath("pageInstanceId").split("/")[8],()=>datalayerPath("page.pageLevel3"),()=>datalayerPath("page.category.subCategory02"),()=>datalayerPath("page.category.subCategory2")]),subCategory3:gFFWNV([()=>void 0!==datalayerPath("pageInstanceId")&&datalayerPath("pageInstanceId").split("/")&&datalayerPath("pageInstanceId").split("/").length>1&&void 0!==datalayerPath("pageInstanceId").split("/")[9]&&datalayerPath("pageInstanceId").split("/")[9],()=>datalayerPath("page.pageLevel4"),()=>datalayerPath("page.category.subCategory03"),()=>datalayerPath("page.category.subCategory3")])},pageInfo:{author:datalayerPath("page.pageInfo.author"),destinationURL:gFFWNV([()=>datalayerPath("page.url"),()=>datalayerPath("page.pageInfo.destinationUrl"),()=>datalayerPath("page.pageInfo.destinationURL")]),geoRegion:gFFWNV([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>datalayerPath("page.pageInfo.geoRegion"),()=>datalayerPath("page.pageInfo.language").indexOf("-")>-1&&datalayerPath("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":""]),language:gFFWNV([()=>datalayerPath("page.pageInfo.language").slice(0,2)||(datalayerPath("page.pageInfo.language").indexOf("-")>-1?datalayerPath("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":"")]),pageID:gFFWNV([()=>datalayerPath("page.path"),()=>datalayerPath("page.name"),()=>datalayerPath("page.pageInfo.pageInstanceId"),()=>window.dataLayer&&window.dataLayer.pages&&(window.dataLayer.pages[0]||"").pageInstanceId,()=>datalayerPath("page.pageInfo.pageID")]),pageName:gFFWNV([()=>datalayerPath("page.name"),()=>datalayerPath("page.pageInfo.pageName")]),referringURL:gFFWNV([()=>datalayerPath("page.pageInfo.referringUrl"),()=>datalayerPath("page.pageInfo.referringURL"),()=>document.referrer]),sysEnv:gFFWNV([()=>datalayerPath("page.pageInfo.devEnv"),()=>datalayerPath("page.pageInfo.envWork"),()=>datalayerPath("page.pageInfo.sysEnv")]),variant:gFFWNV([()=>datalayerPath("page.pageInfo.variant"),()=>"true"==datalayerPath("page.attributes.virtualPage")?"virtual page":"real page"]),version:"acdl: "+datalayerPath("page.pageInfo.version")}}}function convertToACDL(e){var t=[],a={},o=[],i=[],n=e.product;if(n.length>0&&"string"!=typeof n){for(var r in n)void 0!==n[r]&&void 0!==n[r].productInfo&&(void 0===(b=n[r].productInfo.productID)&&(b="product"+(+r+1)),a[b]=n[r],void 0!==n[r].category.primaryCategory&&(n[r].category.primaryCategory.indexOf("car")>-1||n[r].category.primaryCategory.indexOf("bike")>-1)&&i.push(b));Object.keys(a).forEach((e=>o.push(e)));var s=a}var c="page view"==e.event[0].eventInfo.eventName,l=void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page"),d=((e.page||"").pageInfo||"").pageName||"";c&&(l?"tbd"!=d&&""!=d&&(c&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})):l||("tbd"!=d&&""!=d||void 0!==d)&&(c&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(i)),t.push({page:e.page})));let m={},u=e.component[0].componentInfo.componentID;m[u]=e.component[0],t.push({component:m,version:e.version});var p={},g=e.cart;if(g&&g.item.length>0&&"string"!=typeof g){for(var r in g.item)void 0!==g.item[r]&&void 0!==g.item[r].productInfo&&void 0!==(b=g.item[r].productInfo.productID)&&(p[b]=g.item[r]);for(var r in p=Object.assign({},p))for(var h in e.cart.item)r==e.cart.item[h].productInfo.productID&&(p[r].price=Object.assign({},e.cart.item[h].price),p[r].quantity=e.cart.item[h].quantity);var v={item:p,price:e.cart.price,cartID:e.cart.cartID}}var y={},f=e.transaction;if(f&&f.item.length>0&&"string"!=typeof f&&void 0!==f.transactionID){for(var r in f.item){var b;void 0!==f.item[r]&&void 0!==f.item[r].productInfo&&void 0!==(b=f.item[r].productInfo.productID)&&(y[b]=f.item[r])}for(var r in y=Object.assign({},y))for(var h in e.transaction.item)r==e.transaction.item[h].productInfo.productID&&(y[r].price=Object.assign({},e.transaction.item[h].price),y[r].quantity=e.transaction.item[h].quantity);var D={item:y,total:e.transaction.total,transactionID:e.transaction.transactionID}}var w={},N={},O=e.dealer;if(O.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("dealer")&&(O=Object.keys(adobeDataLayer.getState("dealer")).map((function(e){return adobeDataLayer.getState("dealer")[e]}))),O.length>0&&"string"!=typeof O){for(var r in O)if(void 0!==O[r]&&void 0!==O[r].dealerInfo){var I=O[r].dealerInfo.dealerOutletBuno;void 0!==I&&(w[I]=O[r])}Object.keys(w).forEach((e=>N[e]="")),N=Object.keys(N),Object.keys(w).length>0&&t.push({dealer:w})}e.user.length<=0&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState("user")&&(e.user=Object.keys(adobeDataLayer.getState("user")).map((function(e){return adobeDataLayer.getState("user")[e]})));var T={},A={};if(e.user.length>0&&"string"!=typeof e.user){var C={},S=e.user;for(var r in S){var k,F={};if(Array.isArray(S[r].profile)&&S[r].profile.length>0)for(var h in S[r].profile)F[x=null!=S[r].profile[h].profileInfo.profileID?S[r].profile[h].profileInfo.profileID:"profile"+(+h+1)]=JSON.parse(JSON.stringify(S[r].profile[h]));else if(void 0===S[r].profile&&void 0!==S[r].profileInfo&&!Array.isArray(S[r].profileInfo)){var x="profile"+(+r+1);F.profile={},F.profile[x]=JSON.parse(JSON.stringify(S[r].profileInfo))}k=void 0!==x&&(x+"").indexOf("profile")>-1?"user"+(+r+1):x,C[k]=JSON.parse(JSON.stringify(S[r])),C[k].profile=JSON.parse(JSON.stringify(F))}e.user=JSON.parse(JSON.stringify(C)),Object.keys(C).forEach((e=>T[e]="")),T=Object.keys(T),Object.keys(C).forEach((e=>Object.keys(C[e].profile).forEach((e=>A[e]="")))),A=Object.keys(A),t.push({user:e.user})}var P="page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",V=(e.event[0].eventInfo.eventName,{event:P,eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,reference:{linkedComponent:[u],linkedUser:T,linkedProfile:A}}});if(void 0!==e.paramsPassed){let E,L,R,j=e.paramsPassed;if(V.eventInfo.reference.linkedTransactionItems=[],V.eventInfo.reference.linkedCartItems=[],V.eventInfo.reference.linkedProducts=[],void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0!==window.adobeDataLayer.getState()?(E=void 0!==adobeDataLayer.getState("cart")&&Object.keys(adobeDataLayer.getState("product"))||[],L=void 0!==adobeDataLayer.getState("cart")&&void 0!==adobeDataLayer.getState("cart.item")&&Object.keys(adobeDataLayer.getState("cart.item"))||[],R=void 0!==adobeDataLayer.getState("transaction")&&void 0!==adobeDataLayer.getState("transaction.item")&&Object.keys(adobeDataLayer.getState("transaction.item"))||[]):E=L=R=[],void 0===D&&(D={item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||e.paramsPassed.transactionID}),void 0===v&&(v={item:{},price:e.cart.price||{},cartID:e.cart.cartID||e.paramsPassed.cartID}),void 0!==s&&void 0!==s&&Object.keys(s).length>0)for(var W in s){let J=!1;void 0!==s[W]&&void 0!==s[W].price&&(void 0!==s[W].price.basePrice&&void 0!==s[W].price.basePrice&&s[W].price.basePrice>0||void 0!==s[W].price.priceWithTax&&void 0!==s[W].price.priceWithTax&&s[W].price.priceWithTax>0)&&(J=!0);let B=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(B=!0)),void 0!==j.cartID&&j.cartID;let G=void 0!==j.transactionID&&""!=typeof j.transactionID;J||B?G?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==v&&Object.keys(v.item).length>0)for(var W in v.item){let $=!1;void 0!==v.item[W]&&void 0!==v.item[W].price&&(void 0!==v.item[W].price.basePrice&&void 0!==v.item[W].price.basePrice&&v.item[W].price.basePrice>0||void 0!==v.item[W].price.priceWithTax&&void 0!==v.item[W].price.priceWithTax&&v.item[W].price.priceWithTax>0)&&($=!0);let U=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(U=!0)),void 0!==j.cartID&&j.cartID;let q=void 0!==j.transactionID&&""!=typeof j.transactionID;$||U?q?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}if(void 0!==D&&Object.keys(D.item).length>0)for(var W in D.item){let H=!1;void 0!==D.item[W]&&void 0!==D.item[W].price&&(void 0!==D.item[W].price.basePrice&&void 0!==D.item[W].price.basePrice&&D.item[W].price.basePrice>0||void 0!==D.item[W].price.priceWithTax&&void 0!==D.item[W].price.priceWithTax&&D.item[W].price.priceWithTax>0)&&(H=!0);let K=!1;void 0!==e.paramsPassed&&(void 0===e.paramsPassed.totalBasePrice&&void 0===e.paramsPassed.totalPriceWithTax||(K=!0)),void 0!==j.cartID&&j.cartID;let z=void 0!==j.transactionID&&""!=typeof j.transactionID;H||K?z?V.eventInfo.reference.linkedTransactionItems.push(W):V.eventInfo.reference.linkedCartItems.push(W):R.includes(W)?V.eventInfo.reference.linkedTransactionItems.push(W):L.includes(W)?V.eventInfo.reference.linkedCartItems.push(W):(E.includes(W),V.eventInfo.reference.linkedProducts.push(W))}function M(e,t){void 0!==e&&Object.keys(e).length>0&&Object.keys(e).includes(t)&&delete e[t]}if(["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{for(let t in V.eventInfo.reference[e]){let a=V.eventInfo.reference[e][t];"linkedTransactionItems"===e?(void 0===D||void 0===D.item||Object.keys(D).includes(a)?void 0===D&&(void 0===D||void 0===D.item||Object.keys(D.item).includes(W)||(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(W)&&(D.item[W]=JSON.parse(JSON.stringify(s[W]))),void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(W)&&(D.item[W]=JSON.parse(JSON.stringify(v.item[W]))))):(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(s[a]))),void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(a)&&(D.item[a]=JSON.parse(JSON.stringify(v.item[a])))),M(s,a),M(v?.item,a)):"linkedCartItems"===e?(void 0===v||void 0===v.item||Object.keys(v.item).includes(a)||(void 0!==s&&Object.keys(s).length>0&&Object.keys(s).includes(a)&&(v.item[a]=JSON.parse(JSON.stringify(s[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(v.item[a]=JSON.parse(JSON.stringify(D.item[a])))),M(s,a),M(D?.item,a)):"linkedProducts"===e&&(void 0!==s&&Object.keys(s).length>0&&!Object.keys(s).includes(a)&&(void 0!==v&&Object.keys(v.item).length>0&&Object.keys(v.item).includes(a)&&(s[a]=JSON.parse(JSON.stringify(v.item[a]))),void 0!==D&&void 0!==D.item&&Object.keys(D.item).includes(a)&&(s[a]=JSON.parse(JSON.stringify(D.item[a])))),M(v?.item,a),M(D?.item,a))}})),["linkedTransactionItems","linkedCartItems","linkedProducts"].forEach((e=>{const t=V.eventInfo.reference[e];t&&0!==t.length||delete V.eventInfo.reference[e]})),void 0!==(D=D||{item:{},total:e.transaction.total,transactionID:e.transaction.transactionID||((e||"").paramsPassed||"").transactionID||""})&&void 0!==D.total&&1==Object.keys(D.total).length){function Q(e){return-1*Math.abs(Number(e))}function Y(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}D.total.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let X=0;Object.keys(D.item).forEach((e=>{X+=(e.price||0).basePrice||0})),X=Y(X,2),D.total.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>X,()=>0])||0),D.total.discountAmountAdditional=Q(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),D.total.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0),D.total.shipping=Y(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),D.total.paymentMethod=gFFWNV([()=>e.paramsPassed.totalPaymentMethod,()=>""])||"";let Z=0;Object.keys(D.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(Z+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(Z+=e.price.discountAmountOther||0)})),Z=Y(Z,2),D.total.discountItemAmounts=Q(Y(Z,2)),D.total.discountAmountSum=Q(Y(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>D.total.discountItemAmounts+D.total.discountAmountAdditional,()=>0])||0),2));let ee=0;Object.keys(D.item).forEach((e=>{ee+=(e.price||0).taxAmount||0})),ee=Y(ee,2),D.total.taxItemsAmount=Y(ee,2),D.total.taxAmountSum=+(gFFWNV([()=>D.total.taxItemsAmount+D.total.taxAmountAdditional,()=>0])||0),D.total.priceWithTax=Y(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>D.total.basePrice+D.total.discountAmountSum+D.total.taxAmountSum,()=>0])||0),2),D.total.transactionTotal=Y(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>D.total.priceWithTax+D.total.shipping,()=>0])||0),2)}if(void 0!==v&&void 0!==v.price&&1==Object.keys(v.price).length){function te(e){return-1*Math.abs(Number(e))}function ae(e,t){const a=10**(t=t||2);return+(Math.round(e*a)/a).toFixed(t)}v.price.currency=(e.paramsPassed.totalCurrency||"").toUpperCase();let oe=0;Object.keys(v.item).forEach((e=>{oe+=(e.price||0).basePrice||0})),oe=ae(oe,2),v.price.basePrice=+(gFFWNV([()=>e.paramsPassed.totalBasePrice,()=>oe,()=>0])||0),v.price.discountAmountAdditional=te(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmountAdditional,()=>0])||0)),v.price.taxAmountAdditional=+(gFFWNV([()=>e.paramsPassed.totalTaxAmountAdditional,()=>0])||0);let ie=0;Object.keys(v.item).forEach((e=>{void 0!==e.price&&void 0!==e.price.discountAmount&&(ie+=e.price.discountAmount||0),void 0!==e.price&&void 0!==e.price.discountAmountOther&&(ie+=e.price.discountAmountOther||0)})),ie=ae(ie,2),v.price.discountItemAmounts=te(ae(ie,2)),v.price.discountAmountSum=te(ae(+(gFFWNV([()=>e.paramsPassed.totalDiscountAmount,()=>v.price.discountItemAmounts+v.price.discountAmountAdditional,()=>0])||0),2));let ne=0;Object.keys(v.item).forEach((e=>{ne+=(e.price||0).taxAmount||0})),ne=ae(ne,2),v.price.taxItemsAmount=ae(ne,2),v.price.taxAmountSum=+(gFFWNV([()=>v.price.taxItemsAmount+v.price.taxAmountAdditional,()=>0])||0),v.price.priceWithTax=ae(+(gFFWNV([()=>e.paramsPassed.totalPriceWithTax,()=>v.price.basePrice+v.price.discountAmountSum+v.price.taxAmountSum,()=>0])||0),2),v.price.shipping=ae(+(gFFWNV([()=>e.paramsPassed.totalShippingCost,()=>0])||0),2),v.price.cartTotal=ae(+(gFFWNV([()=>e.paramsPassed.totalFinalPrice,()=>v.price.priceWithTax+v.price.shipping,()=>0])||0),2)}void 0!==V.eventInfo.reference.linkedTransactionItems&&V.eventInfo.reference.linkedTransactionItems.filter((function(e,t){return V.eventInfo.reference.linkedTransactionItems.indexOf(e)===t})),void 0!==V.eventInfo.reference.linkedCartItems&&V.eventInfo.reference.linkedCartItems.filter((function(e,t){return V.eventInfo.reference.linkedCartItems.indexOf(e)===t})),void 0!==V.eventInfo.reference.linkedProducts&&V.eventInfo.reference.linkedProducts.filter((function(e,t){return V.eventInfo.reference.linkedProducts.indexOf(e)===t}))}else V.eventInfo.reference.linkedProducts="page view"==e.event[0].eventInfo.eventName?i:o;if(void 0!==s&&void 0!==s&&Object.keys(s).length>0){for(var _ in s)Object.keys(s[_]).indexOf("price")>-1&&delete s[_].price,Object.keys(s[_]).indexOf("quantity")>-1&&delete s[_].quantity;t.push({product:a})}return void 0!==v&&Object.keys(v.item).length>0&&t.push({cart:v}),void 0!==D&&Object.keys(D.item).length>0&&(D.transactionID=(D.transactionID+"").toUpperCase(),t.push({transaction:D})),t.push(V),t}TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];for(var t=convertToACDL(tronDetailDL),a={},o=0;o<t.length;o++)for(var i=t[o],n=Object.keys(i),r=0;r<n.length;r++){var s=n[r];a[s]=i[s]}if(window.adobeDataLayer.push(a),window.TRON.warningCode.length>0){for(var o in window.TRON.warningCode)window.adobeDataLayer.push(window.TRON.warningCode[o]);window.TRON.warningCode=[]}})),TRON.isInitialized=!0)}}]);</script>
</body>
</html>
