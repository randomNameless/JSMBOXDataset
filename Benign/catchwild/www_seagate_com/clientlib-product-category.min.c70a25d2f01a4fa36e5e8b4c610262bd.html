<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clientlib-product-category.min.c70a25d2f01a4fa36e5e8b4c610262bd.html</title>
</head>
<body>

<script>
var productCategoryNodeList = document.querySelectorAll(".ProductCategory");
if (productCategoryNodeList && productCategoryNodeList.length > 0) {
    var ProductCategory = (function () {
        var host = "";
        if (document.location.hostname == "localhost") {
            host = "https://wwwdevaem.seagate.com";
        }
        const solrURL = host + "/ww/solrQueryResponseRetrieval";

        var productCategory = function (productCategoryNode, productCategoryData) {
            var t = this;
            console.log("----------Product Category----------");

            t.settings = productCategoryData;

            t.solrFields = {
                cardTitle: "ecomm_productname"
            };

            t.isSkuMode = false;
            if (t.settings.type == "marketing-sku") {
                t.isSkuMode = true;
                t.solrFields = {
                    cardTitle: "skuName_" + t.settings.lang
                };
            }

            t.state = {
                page: 1
            };

            window.addEventListener("popstate", function (event) {
                t.state = event.state;
                t.onPopstate();
            });

            t.initElements(productCategoryNode);
            t.getPromoCards();
            t.initSolrData();
            t.parseURLParams(false);
            t.buildPage();

            t.filter.addEventListener("change", function (event) {
                if (event.target.className == "checkbox-custom") {
                    t.onFilterChange();
                }
            });

            t.selectedFilters.addEventListener("click", function (event) {
                if (event.target.className == "filter-remove") {
                    t.removeTag(event.target);
                }
            });

            t.pagination.addEventListener("click", function (event) {
                event.preventDefault();
                t.onPageChange(event.target);
            });

            t.filter.querySelector("a.btn-clear").addEventListener("click", function (event) {
                event.preventDefault();
                t.clearAllFilters();
            });

            t.sortDropdown.addEventListener("click", function (event) {
                if (event.target.className.indexOf("MFDropdown-link") != -1) {
                    t.onSortChange(event.target.dataset.value);
                }
            });

            t.filter.querySelectorAll("input[name=sort-radio]").forEach(function (radio) {
                radio.addEventListener("change", function (e) {
                    t.onSortChange(e.target.value);
                });
            });

            t.filter.querySelector("a.Button-black").addEventListener("click", function (event) {
                event.preventDefault();
                t.filter.classList.remove("opened");
                document.body.classList.remove('no-scroll');
            });
        };
        
        productCategory.prototype.pushState = function () {
            var t = this;
            if (t.state.page == 1) {
                delete t.state.page;
            }
            var url = t.state ? new URLSearchParams(t.state).toString() : "";
            if (url != "") {
                url = "?" + url;
            } else {
                url = document.location.pathname;
            }
            history.pushState(t.state, "", url);
            var popStateEvent = new PopStateEvent('popstate', { state: t.state });
            dispatchEvent(popStateEvent);
        };

        productCategory.prototype.getSolrData = function (solrData, callback) {
            var t = this;
            if (!t.filter.classList.contains("opened")) {
                t.loading(true);
            }
            console.log(solrData.toString());
            fetch(solrURL, {
                method: 'POST',
                body: solrData
            }).then(function (response) {
                return response.json();
            }).then(function (data) {
                callback(data);
                if (!t.filter.classList.contains("opened")) {
                    t.loading(false);
                }
            }).catch(function (error) {
                console.error(error);
            });
        };

        productCategory.prototype.initElements = function (productCategoryNode) {
            var t = this;
            t.mobileView = false;
            if (window.innerWidth <= 767) {
                t.mobileView = true;
            }
            t.productCategoryNode = productCategoryNode;
            t.loadingModal = productCategoryNode.querySelector(".loading-modal");
            t.content = productCategoryNode.querySelector(".ProductCategory-content");
            t.filter = productCategoryNode.querySelector(".ProductCategory-filters");
            t.results = productCategoryNode.querySelector(".ProductCategory-results");
            t.selectedFilters = productCategoryNode.querySelector(".selectedFilters");

            t.sortDropdown = t.content.querySelector(".sortDropdown");
            t.sortMobile = t.filter.querySelector("#collapse_Sort");
            
            t.cards = t.results.querySelector(".ProductCategory-results-cards");
            t.cardTemp = t.getTemplate(t.cards.querySelector(".ProductCategory-card.card--product"));
            
            t.accordionFilters = t.filter.querySelector(".ProductCategory-accordion.accordion-filters");
            t.accordionFilterTemp = t.getTemplate(t.accordionFilters.querySelector(".filters-group.accordion-item"));
            
            t.tagTemp = t.getTemplate(t.selectedFilters.querySelector("li"));
            
            t.countProductOriginal = t.filter.querySelector(".countProduct").innerHTML;
            
            t.pagination = productCategoryNode.querySelector(".pagination");
            t.pagePreviousTemp = t.getTemplate(productCategoryNode.querySelector(".page-item.previous"));
            t.pageItemTemp = t.getTemplate(productCategoryNode.querySelector(".page-item.page-num"));
            t.pageNextTemp = t.getTemplate(productCategoryNode.querySelector(".page-item.next"));

            t.filtersOpen = t.filter.querySelector(".filters-open");
            t.filtersOpenButtonTemp = t.getTemplate(t.filtersOpen.querySelector(".filters-open-button:nth-child(2)"));
        };

        productCategory.prototype.getPromoCards = function () {
            var t = this;
            t.promoCards = t.cards.querySelectorAll(".ProductCategory-card.card--promo");
            t.promoCardsPagination = {};
            if (t.promoCards.length == 0) {
                t.promoCardsPerPage = 0;
            } else {
                t.promoCardsPerPage = Math.floor(t.settings.resultsPerPage / 6);
                t.promoCards.forEach(function (element, i) {
                    var p = Math.floor(i / t.promoCardsPerPage) + 1;
                    if (t.promoCardsPagination[p] == undefined) {
                        t.promoCardsPagination[p] = [];
                    }
                    t.promoCardsPagination[p].push(element);
                });
            }
        };

        productCategory.prototype.onPopstate = function () {
            var t = this;
            console.log("----onPopstate----");
            if (!t.state) {
                t.parseURLParams(true);
            } 
            if (!t.state.page) {
                t.state.page = 1;
            }
            console.log(t.state);
            t.changeSortSelector(t.state.sort);
            t.updateSolrData();
            t.buildPage();
        };

        productCategory.prototype.onFilterChange = function () {
            var t = this;
            var checkboxes = t.accordionFilters.querySelectorAll("input[type=checkbox]");
            var fq = {};
            for (var i=0; i<checkboxes.length; i++) {
                var checkbox = checkboxes[i];
                if (checkbox.checked) {
                    console.log(checkbox.name + " - " + checkbox.value);
                    var fqValue = fq[checkbox.name];
                    if (fqValue == undefined) {
                        fqValue = [];
                    }
                    fqValue.push(checkbox.value);
                    fq[checkbox.name] = fqValue;
                }
            }
            for (var field in t.state) {
                if (t.state.hasOwnProperty(field)) {
                    if (field.startsWith("fq-")) {
                        delete t.state[field];
                    }
                }
            }
            for (var k in fq) {
                if (fq.hasOwnProperty(k)) {
                    for (var a of fq[k]) {
                        a = t.queryToParam(a);
                        if (t.state["fq-" + k] == undefined) {
                            t.state["fq-" + k] = a;
                        } else {
                            t.state["fq-" + k] += "|" + a;
                        }
                    }
                }
            }
            t.state.page = 1;
            t.pushState();
        };

        productCategory.prototype.removeTag = function (eventTarget) {
            var t = this;
            var field = eventTarget.parentNode.dataset.field;
            var value = eventTarget.parentNode.dataset.value;
            eventTarget.parentNode.remove();
            t.filter.querySelector("input[name='" + field + "'][value='" + value + "']").click();
        };

        productCategory.prototype.onPageChange = function (eventTarget) {
            var t = this;
            var li;
            if (eventTarget.nodeName == "A") {
                li = eventTarget.parentNode;
            } else if (eventTarget.nodeName == "SPAN" || eventTarget.nodeName == "I") {
                li = eventTarget.parentNode.parentNode;
            }
            if (li != undefined) {
                var page;
                if (!li.classList.contains("disbaled") && !li.classList.contains("active") && !li.classList.contains("ellipsis")) {
                    if (li.classList.contains("page-num")) {
                        page = Number(li.querySelector("span").innerHTML);
                    } else if (li.classList.contains("previous")) {
                        page = t.state.page - 1;
                    } else if (li.classList.contains("next")) {
                        page = t.state.page + 1;
                    }
                }
                if (page != undefined) {
                    t.state.page = page;
                    t.pushState();
                    t.productCategoryNode.scrollIntoView();
                }
            }
        };

        productCategory.prototype.onSortChange = function (v) {
            var t = this;
            t.state.sort = v;
            if (t.state.page && t.state.page > 1) {
                delete t.state.page;
            }
            t.pushState();
            t.productCategoryNode.scrollIntoView();
        };

        productCategory.prototype.initSolrData = function () {
            var t = this;
            t.topSort = "";
            if (t.settings.productCards && t.settings.productCards.length > 0) {
                var n = 999;
                for (var i=0; i<t.settings.productCards.length; i++) {
                    var productCard = t.settings.productCards[i];
                    t.topSort += 'if(termfreq(ecomm_product_cf,"' + productCard + '"),' + (n-i) + ','
                    if (i+1 == t.settings.productCards.length) {
                        t.topSort += "1";
                    }
                }
                for (var i=0; i<t.settings.productCards.length; i++) {
                    t.topSort += ")";
                }
                t.topSort += " desc, ";
            }
            var collection = "pricing";
            if (!t.settings.publish) {
                collection = "products";
            }
            if (t.isSkuMode) {
                collection = "product";
                if (!t.settings.publish) {
                    collection = "do_more";
                }
            }
            t.solrParams = {
                brand: "(seagate or lacie)",
                locale: t.settings.locale,
                q: "*",
                collection: collection,
                wt: "json",
                start: 0,
                rows: t.getSolrRows(),
                sort: t.topSort + t.getSolrSort(t.settings.sorting),
                fl: ["url", "pdpURL", "ecomm_tags", "ecomm_gallery", "ecomm_gallery_alt", t.solrFields.cardTitle, "ecomm_stock_status", "sku_cf", 
                "ecomm_low_price", "ecomm_max_price", "ecomm_currency", "ecomm_discount", "ecomm_final_price", "ecomm_regular_price", "ecomm_currency_code", 
                "capacity", "capacityRaw", "capacityRawUom", "capacityTransUom", "ecomm_product_cf", "ecomm_enabled", "ecomm_low_price_sku", 
                "ecomm_rating_sku", "enableProductReview", "ecomm_rating_summary", "ecomm_rating_count",
                "promo_title", "promo_color", "promo_description", "promo_short_description", "promo_start_date", "promo_end_date"].join(","),
                facet: true,
                "facet.field": [],
                "facet.query": []
            };

            t.initSolrFQ();
            
            t.filters = t.settings.filters;
            if (t.filters) {
                for (var i=0; i<t.filters.length; i++) {
                    var filter = t.filters[i];
                    var field = filter.field;
                    var queries = t.getDefaultQueries(field, filter.queries);
                    if (queries) {
                        for (var j=0; j<queries.length; j++) {
                            var query = queries[j];
                            t.solrParams["facet.query"].push("{!ex=" + field + "_tag}" + field + ":" + query.query);
                        }
                    } else {
                        t.solrParams["facet.field"].push("{!ex=" + field + "_tag key=" + field + "}" + field);
                    }
                }
            }
            t.solrData = this.toURLSearchParams(t.solrParams);
        };

        productCategory.prototype.initSolrFQ = function () {
            var t = this;
            t.fq = "showOnProductFinder:true";
            if (t.settings.type == "support") {
                t.fq = "showOnProductFinder:false";
            }
            var checkTags = true;
            if (t.isSkuMode) {
                t.fq += " AND ecomm_enabled:true";
                if (t.settings.hideOutOfStock) {
                    t.fq += " AND ecomm_stock_status:IN_STOCK";
                }
                if (t.settings.skuList && t.settings.skuList.length > 0) {
                    checkTags = false;
                    t.fq += " AND sku_cf:";
                    if (t.settings.skuList.length > 1) {
                        t.fq += "(";
                    }
                    t.fq += '"' + t.settings.skuList.join('" OR "') + '"';
                    if (t.settings.skuList.length > 1) {
                        t.fq += ")";
                    }
                }
            }
            if (!t.isSkuMode && t.settings.type != "support" && t.settings.onlyD2C) {
                t.fq += " AND ecomm_enabled:true";
                checkTags = false;
            }
            var recertifiedProductsFQ = " AND !seagate_recertified_product:true";
            if (t.settings.recertifiedProducts) {
                recertifiedProductsFQ = "";
            }
            t.fq += recertifiedProductsFQ;
            t.productsTagsGroup = t.settings.productsTagsGroup;
            if (checkTags && t.productsTagsGroup) {
                if (t.productsTagsGroup.length > 0) {
                    t.fq += " AND ecomm_tags:";
                }
                if (t.productsTagsGroup.length > 1) {
                    t.fq += "(";
                }
                for (var i=0; i<t.productsTagsGroup.length; i++) {
                    var productsTags = t.productsTagsGroup[i];
                    if (i != 0) {
                        t.fq += " AND ";
                    }
                    if (productsTags.length > 1) {
                        t.fq += "(";
                    }
                    for (var j=0; j<productsTags.length; j++) {
                        var productsTag = productsTags[j];
                        if (j != 0) {
                            t.fq += " OR ";
                        }
                        t.fq += '"' + productsTag + '*"';
                    }
                    if (productsTags.length > 1) {
                        t.fq += ")";
                    }
                }
                if (t.productsTagsGroup.length > 1) {
                    t.fq += ")";
                }
            }
            if (!t.isSkuMode && t.settings.productCards && t.settings.productCards.length > 0) {
                if (t.fq) {
                    t.fq += " OR ecomm_product_cf:";
                } else {
                    t.fq = "id:[* TO *] OR ecomm_product_cf:";
                }
                if (t.settings.productCards.length > 1) {
                    t.fq += "(";
                }
                t.fq += '"' + t.settings.productCards.join('" OR "') + '"';
                if (t.settings.productCards.length > 1) {
                    t.fq += ")";
                }
            }
            if (t.fq) {
                t.solrParams.fq = t.fq;
            }
        };

        productCategory.prototype.updateSolrData = function () {
            var t = this;
            t.solrData.delete("fq");
            if (t.fq) {
                t.solrData.append("fq", t.fq);
            }

            for (var field in t.state) {
                if (t.state.hasOwnProperty(field)) {
                    if (field.startsWith("fq-")) {
                        var solrField = field.replace(/^fq\-/, "");
                        var s = '{!tag=' + solrField + '_tag}' + solrField + ':';
                        var values = t.state[field].split("|");
                        if (values.length > 1) {
                            s += "(";
                        }
                        for (var j=0; j<values.length; j++) {
                            var v = t.paramToQuery(values[j]);
                            if (j != 0) {
                                s += ' OR ';
                            }
                            if (v.indexOf("[") != 0) {
                                s += '"';
                            }
                            s += v;
                            if (v.indexOf("[") != 0) {
                                s += '"';
                            }
                        }
                        if (values.length > 1) {
                            s += ')';
                        }
                        t.solrData.append("fq", s);
                    }
                }
            }

            var start = (t.state.page - 1) * t.settings.resultsPerPage;
            var promoCardsAllPage = 0;
            for (var p in t.promoCardsPagination) {
                if (t.promoCardsPagination.hasOwnProperty(p)) {
                    if (p < t.state.page) {
                        promoCardsAllPage += t.promoCardsPagination[p].length;
                    }
                }
            }
            if (t.promoCards && start >= promoCardsAllPage) {
                start = start - promoCardsAllPage;
            }
            t.solrData.set("start", start);
            t.solrData.set("rows", t.getSolrRows());

            if (t.state.sort) {
                t.solrData.set("sort", t.getSolrSort(t.state.sort));
            } else {
                t.solrData.set("sort", t.topSort + t.getSolrSort(t.settings.sorting));
            }
        };

        productCategory.prototype.getSolrSort = function (v) {
            var sort = "releaseDate desc";
            if (v == "priceLowToHigh") {
                sort = "ecomm_low_price asc, releaseDate desc";
            } else if (v == "priceHighToLow") {
                sort = "ecomm_low_price desc, releaseDate desc";
            } else if (v == "starRating") {
                sort = "ecomm_rating_summary desc, releaseDate desc";
            }
            return sort;
        };

        productCategory.prototype.getSolrRows = function () {
            var t = this;
            var rows = t.settings.resultsPerPage;
            if (t.promoCards) {
                var promoCardsNum = t.getPromoCardsNum();
                var promoCardsCurrentPage = 0;
                if (t.promoCardsPagination[t.state.page]) {
                    promoCardsCurrentPage = t.promoCardsPagination[t.state.page].length;
                }
                if (promoCardsNum > promoCardsCurrentPage) {
                    rows -= promoCardsCurrentPage;
                } else {
                    rows -= promoCardsNum;
                }
            }
            return rows;
        };

        productCategory.prototype.changeSortSelector = function (sort) {
            var t = this;
            if (!sort) {
                sort = t.settings.sorting;
            }
            try {
                var sortInput = t.sortDropdown.querySelector("input#sortDropdown");
                if (sortInput && sortInput.value != sort) {
                    sortInput.value = sort;
                    t.sortDropdown.querySelector(".MFDropdown-item.selected").classList.remove("selected");
                    t.sortDropdown.querySelector("a.MFDropdown-link[data-value='" + sort + "']").parentNode.classList.add("selected");
                    t.sortDropdown.querySelector(".MFDropdown-btn.Form-input").value = t.sortDropdown.querySelector("a.MFDropdown-link[data-value='" + sort + "']").innerHTML;
                }
                try {
                    t.sortDropdown.querySelector("select#sortDropdown option[selected=selected]").removeAttribute("selected");
                } catch (e) { }
                t.sortDropdown.querySelector("select#sortDropdown option[value=" + sort + "]").setAttribute("selected", "selected");
            } catch (e) { }
            try {
                t.sortMobile.querySelector("input.radio-custom[checked=checked]").removeAttribute("checked");
                t.sortMobile.querySelector("input.radio-custom[value=" + sort + "]").setAttribute("checked", "checked");
            } catch (e) { }
        };

        productCategory.prototype.parseURLParams = function (updateStateOnly) {
            var t = this;
            var locationSearch = document.location.search;
            if (locationSearch != "") {
                const params = new URLSearchParams(locationSearch);
                const page = Number(params.get("page")) || 1;
                if (page > 1) {
                    t.productCategoryNode.scrollIntoView();
                }
                const sort = params.get("sort");
                t.state = {
                    page: page
                }
                params.forEach(function (v, k) {
                    if (k.startsWith("fq-")) {
                        t.state[k] = v;
                    }
                });
                if (sort != undefined && sort != "") {
                    t.state.sort = sort;
                    if (!updateStateOnly) {
                        t.changeSortSelector(sort);
                    }
                }
                if (!updateStateOnly) {
                    t.updateSolrData();
                }
            } else {
                if (updateStateOnly) {
                    t.state = {};
                }
            }
        };

        productCategory.prototype.toURLSearchParams = function (obj) {
            var t = this;
            var usps = new URLSearchParams();
            for (const prop in obj) {
                if (Object.hasOwn(obj, prop)) {
                    var v = obj[prop];
                    if (typeof(v) == "object" && Array.isArray(v)) {
                        for (var i=0; i<v.length; i++) {
                            usps.append(prop, v[i].replace(/\{lang\}/g, t.settings.lang));
                        }
                    } else {
                        if (typeof(v) == "string") {
                            v = v.replace(/\{lang\}/g, t.settings.lang);
                        }
                        usps.append(prop, v);
                    }
                }
            }
            return usps;
        };

        productCategory.prototype.buildPage = function () {
            var t = this;
            t.getSolrData(t.solrData, function (data) {
                console.log(data);
                t.buildCards(data);
                t.insertPromoCards();
                t.buildFilters(data);
                t.buildPagination();
                if (t.numFound < t.settings.resultsPerPage || t.pages == t.state.page) {
                    t.insertRestPromoCards(t.state.page+1);
                }
            });
        };

        productCategory.prototype.buildCards = function (data) {
            var t = this;
            t.cards.innerHTML = "";
            var docs = data.response.docs;
            t.numFound = data.response.numFound;
            t.filter.querySelector(".countProduct").innerHTML = t.countProductOriginal.replace("{0}", t.numFound);
            t.filter.querySelector(".countProduct").classList.remove("hidden");
            t.results.querySelector(".countProduct").innerHTML = t.countProductOriginal.replace("{0}", t.numFound);
            t.results.querySelector(".countProduct").classList.remove("hidden");
            t.filter.querySelector(".filters--buttongroup .Button-black span i").innerHTML = "(" + t.numFound + ")";
            for (var i=0; i<docs.length; i++) {
                var doc = docs[i];
                if (doc.ecomm_currency && !t.ecomm_currency) {
                    t.ecomm_currency = doc.ecomm_currency;
                }
                if (doc.ecomm_currency_code && !t.ecomm_currency_code) {
                    t.ecomm_currency_code = doc.ecomm_currency_code;
                    t.formattedPriceFacets = {
                        "< $199": "< " + t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 199, true),
                        "$200 - $499": t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 200, true) + " - " + t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 499, true),
                        "$500 - $999": t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 500, true) + " - " + t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 999, true),
                        "$1000 - $4999": t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 1000, true) + " - " + t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 4999, true),
                        "$5000 +": t.getFormattedPrice(t.settings.lang, t.ecomm_currency_code, 199, true) + " +"
                    };
                }
                var cardNode = t.cardTemp.cloneNode(true);
                var pdpURL = doc.pdpURL;
                if (t.isSkuMode) {
                    pdpURL = doc.url;
                    if (t.settings.buyToggle) {
                        if (pdpURL.indexOf("?") == -1) {
                            pdpURL += "?";
                        } else {
                            pdpURL += "&";
                        }
                        pdpURL += "store=1";
                    }
                } else {
                    if (doc.ecomm_low_price_sku && doc.ecomm_low_price_sku != "") {
                        pdpURL += "?sku=" + doc.ecomm_low_price_sku;
                    }
                }
                cardNode.querySelector("a.card-link-pdp").setAttribute("href", pdpURL);
                // image
                if (doc.ecomm_gallery && doc.ecomm_gallery.length > 0) {
                    cardNode.querySelector(".card-img img.card-img-default").setAttribute("src", host + doc.ecomm_gallery[0]);
                    cardNode.querySelector(".card-img img.card-img-hover").setAttribute("src", host + doc.ecomm_gallery[doc.ecomm_gallery.length-1]);
                    if (doc.ecomm_gallery_alt && Array.isArray(doc.ecomm_gallery_alt) && doc.ecomm_gallery_alt.length > 0) {
                        cardNode.querySelector(".card-img img.card-img-default").setAttribute("alt", doc.ecomm_gallery_alt[0]);
                        cardNode.querySelector(".card-img img.card-img-hover").setAttribute("alt", doc.ecomm_gallery_alt[doc.ecomm_gallery_alt.length-1]);
                    } else {
                        cardNode.querySelector(".card-img img.card-img-default").setAttribute("alt", "");
                        cardNode.querySelector(".card-img img.card-img-hover").setAttribute("alt", "");
                    }
                } else {
                    cardNode.querySelector(".card-img img.card-img-default").remove();
                    cardNode.querySelector(".card-img img.card-img-hover").remove();
                }
                // title
                cardNode.querySelector(".card-name").innerHTML = doc[t.solrFields.cardTitle];
                // capacity
                if (doc.capacityTransUom) {
                    if (t.isSkuMode) {
                        if (doc.capacityRaw) {
                            cardNode.querySelector(".card-capacity .value").innerHTML = doc.capacityRaw + doc.capacityTransUom;
                        } else {
                            cardNode.querySelector(".card-capacity").remove();
                        }
                    } else {
                        cardNode.querySelector(".card-capacity .value").innerHTML = doc.capacityTransUom;
                    }
                } else {
                    cardNode.querySelector(".card-capacity").remove();
                }
                if (t.settings.type != "support") {
                    // review
                    if (doc.enableProductReview == "1") {
                        cardNode.querySelector(".card-rating [data-bv-show=inline_rating]").setAttribute("data-bv-product-id", doc.ecomm_rating_sku);
                        cardNode.querySelector(".card-rating [data-bv-show=inline_rating]").setAttribute("data-bv-redirect-url", pdpURL + "#pdpReviews");
                    } else {
                        cardNode.querySelector(".card-rating").remove();
                    }
                    // price
                    if (doc.ecomm_enabled && doc.ecomm_low_price) {
                        var displayPrice = "";
                        if (Array.isArray(doc.ecomm_low_price)) {
                            if (doc.ecomm_low_price.length > 0) {
                                displayPrice = doc.ecomm_low_price[0];
                            }
                        } else {
                            displayPrice = doc.ecomm_low_price;
                        }
                        if (displayPrice != "") {
                            cardNode.querySelector(".card-price .value").innerHTML = t.getFormattedPrice(t.settings.lang, doc.ecomm_currency_code, displayPrice);
                        } else {
                            cardNode.querySelector(".card-price .label").remove();
                        }
                        if (t.isSkuMode || (doc.ecomm_final_price && doc.ecomm_final_price.length <= 1)) {
                            cardNode.querySelector(".card-price .label").remove();
                        }
                    } else {
                        cardNode.querySelector(".card-price .label").remove();
                    }
                    // discount
                    if (doc.ecomm_enabled && doc.ecomm_discount && doc.ecomm_max_price) {
                        var displayMaxPrice = "";
                        if (Array.isArray(doc.ecomm_max_price)) {
                            if (doc.ecomm_max_price.length > 0) {
                                displayMaxPrice = doc.ecomm_max_price[0];
                            }
                        } else {
                            displayMaxPrice = doc.ecomm_max_price;
                        }
                        if (displayMaxPrice != "") {
                            cardNode.querySelector(".card-discount .value").innerHTML = t.getFormattedPrice(t.settings.lang, doc.ecomm_currency_code, displayMaxPrice, false);;
                        } else {
                            cardNode.querySelector(".card-discount").remove();
                        }
                        if (t.isSkuMode || (doc.ecomm_final_price && doc.ecomm_final_price.length <= 1)) {
                            cardNode.querySelector(".card-discount .label").remove();
                        }
                        var displayDiscount = "";
                        if (Array.isArray(doc.ecomm_discount)) {
                            if (doc.ecomm_discount.length > 0) {
                                displayDiscount = doc.ecomm_discount[0];
                            }
                        } else {
                            displayDiscount = doc.ecomm_discount;
                        }
                        if (displayDiscount != "") {
                            cardNode.querySelector(".card-discount .percent").innerHTML = cardNode.querySelector(".card-discount .percent").innerHTML.replace("{0}", displayDiscount, false);
                        }
                    } else {
                        cardNode.querySelector(".card-discount").remove();
                    }
                    // stock
                    if (t.isSkuMode) {
                        if (doc.ecomm_stock_status == "IN_STOCK") {
                            cardNode.querySelector(".card-stock").classList.add("in");
                            cardNode.querySelector(".card-stock").innerHTML = t.settings.i18n.IN_STOCK;
                        } else if (doc.ecomm_stock_status == "OUT_OF_STOCK") {
                            cardNode.querySelector(".card-stock").classList.add("out");
                            cardNode.querySelector(".card-stock").innerHTML = t.settings.i18n.OUT_OF_STOCK;
                        }
                    }
                    // promo
                    var promoArray = [];
                    if (doc.promo_start_date && Array.isArray(doc.promo_start_date)) {
                        for (var j=0; j<doc.promo_start_date.length; j++) {
                            var promo = {
                                startDate: doc.promo_start_date[j]
                            };
                            if (Array.isArray(doc.promo_end_date) && typeof(doc.promo_end_date[j]) != "undefined") {
                                promo.endDate = doc.promo_end_date[j];
                            }
                            if (Array.isArray(doc.promo_title) && typeof(doc.promo_title[j]) != "undefined") {
                                promo.title = doc.promo_title[j];
                            }
                            if (Array.isArray(doc.promo_description) && typeof(doc.promo_description[j]) != "undefined") {
                                promo.description = doc.promo_description[j];
                            }
                            if (Array.isArray(doc.promo_color) && typeof(doc.promo_color[j]) != "undefined") {
                                promo.color = doc.promo_color[j];
                            }
                            promoArray.push(promo);
                        }
                    }
                    for (var promo of promoArray) {
                        if (t.inPromoPeriod(promo.startDate, promo.endDate)) {
                            if (promo.title) {
                                var promoColorCss = "";
                                if (promo.color) {
                                    promoColorCss = " tag--" + promo.color.toLowerCase();
                                }
                                cardNode.querySelector(".card-tagNames").innerHTML += '<div class="card-tagName' + promoColorCss + ' ">' + promo.title + '</div>';
                            }
                            if (promo.description) {
                                var promoColorCss = "";
                                if (promo.color) {
                                    promoColorCss = " tag--" + promo.color.toLowerCase();
                                }
                                cardNode.querySelector(".card-tagDescriptions").innerHTML += '<div class="card-tagDes' + promoColorCss + ' ">' + promo.description + '</div>';
                            }
                        }
                    }
                }
                t.cards.append(cardNode);
            }
        };

        productCategory.prototype.insertPromoCards = function () {
            var t = this;
            var promoCards = t.promoCardsPagination[t.state.page];
            if (promoCards) {
                for (var i=0; i<promoCards.length; i++) {
                    var element = promoCards[i];
                    var n = t.settings.promoCardsPattern + i * 5 + i;
                    if (n < t.settings.resultsPerPage) {
                        element.classList.remove("hidden");
                        if (t.cards.querySelector(".ProductCategory-card.card--product:nth-of-type(" + n + ")")) {
                            t.cards.insertBefore(element, t.cards.querySelector(".ProductCategory-card.card--product:nth-of-type(" + n + ")"));
                        } else {
                            t.cards.append(element);
                        }
                    }
                }
            }
        };

        productCategory.prototype.insertRestPromoCards = function (nextPage) {
            var t = this;
            var promoCards = t.promoCardsPagination[nextPage];
            if (promoCards != undefined) {
                for (var i=0; i<promoCards.length; i++) {
                    var element = promoCards[i];
                    element.classList.remove("hidden");
                    t.cards.append(element);
                }
                t.insertRestPromoCards(nextPage+1);
            }
        };
        
        productCategory.prototype.getPromoCardsNum = function () {
            var t = this;
            var num = 0;
            var promoCards = t.promoCardsPagination[t.state.page];
            if (promoCards) {
                num = promoCards.length;
            }
            return num;
        };

        productCategory.prototype.buildFilters = function (data) {
            var t = this;
            t.isMobileView = false;
            t.collapsedFilters = [];
            if (t.filter.classList.contains("opened")) {
                t.isMobileView = true;
                t.filter.querySelectorAll("[aria-expanded=false]").forEach(function (element) {
                    t.collapsedFilters.push(element.getAttribute("aria-controls"));
                });
            }
            t.accordionFilters.innerHTML = "";
            t.selectedFilters.innerHTML = "";
            t.filtersOpen.querySelectorAll(".filters-open-button:not([data-accordion-open=none])").forEach(function (element) {
                element.remove();
            });
            var facets = data.facet_counts;
            if (facets) {
                var facetFields = facets.facet_fields;
                var facetQueries = facets.facet_queries;
                if (t.filters) {
                    for (var i=0; i<t.filters.length; i++) {
                        var filter = t.filters[i];
                        var field = filter.field;
                        var title = t.settings.i18n[filter.title] || filter.title;
                        var queries = t.getDefaultQueries(field, filter.queries);
                        if (queries) {
                            t.buildFilter(field, title, facetQueries, queries);
                        } else {
                            t.buildFilter(field, title, facetFields[field], null);
                        }
                    }
                }
            }
            for (var field in t.state) {
                if (t.state.hasOwnProperty(field)) {
                    if (field.startsWith("fq-")) {
                        var solrField = field.replace(/^fq\-/, "");
                        var values = t.state[field].split("|");
                        for (var j=0; j<values.length; j++) {
                            var v = t.paramToQuery(values[j]);
                            var checked = t.accordionFilters.querySelector("input[name='" + solrField + "'][value='" + v + "']");
                            if (checked) {
                                checked.checked = "checked";
                                var tagNode = t.tagTemp.cloneNode(true);
                                tagNode.setAttribute("data-field", solrField);
                                tagNode.setAttribute("data-value", v);
                                tagNode.querySelector("span:not(.filter-remove)").innerHTML = checked.parentNode.querySelector("span span").innerHTML;
                                t.selectedFilters.append(tagNode);
                            }
                        }
                    }
                }
            }
        };

        productCategory.prototype.buildFilter = function (id, title, facets, queries) {
            var t = this;
            if (facets == undefined) {
                return;
            }
            var filterNode = t.accordionFilterTemp.cloneNode(true);
            var collapseId = "collapse_" + id;
            var accordionButton = filterNode.querySelector(".accordion-button");
            accordionButton.setAttribute("data-target", "#" + collapseId);
            accordionButton.setAttribute("aria-controls", collapseId);
            filterNode.querySelector(".accordion-collapse").setAttribute("id", collapseId);
            filterNode.querySelector(".accordion-button-title").innerHTML = title;
            if (t.collapsedFilters.indexOf(collapseId) != -1) {
                accordionButton.classList.add("collapsed");
                accordionButton.setAttribute("aria-expanded", "false");
                filterNode.querySelector(".accordion-collapse").classList.remove("show");
            }
            var labelTemp = t.getTemplate(filterNode.querySelector(".filters-group-list label"));
            for (const facet in facets) {
                if (Object.hasOwn(facets, facet)) {
                    if (queries && facet.indexOf(id) == -1) {
                        continue;
                    }
                    var num = facets[facet];
                    if (num && num > 0) {
                        var label = labelTemp.cloneNode(true);
                        var labelTitle = facet;
                        if (labelTitle == "") {
                            continue;
                        }
                        var color = "";
                        if (labelTitle.indexOf("###") > 0) {
                            color = labelTitle.split("###")[0];
                            labelTitle = labelTitle.split("###")[1];
                        }
                        var facetValue = facet.replace(/^\{.*\:/, "");
                        if (queries) {
                            labelTitle = t.getQueryDisplay(queries, facetValue);
                        }
                        label.querySelector("input").name = id;
                        label.querySelector("input").value = facetValue;
                        var displayLabelTitle = t.settings.i18n[labelTitle] || labelTitle;
                        // if (t.ecomm_currency) {
                        //     displayLabelTitle = displayLabelTitle.replace("$", t.ecomm_currency);
                        // }
                        if (t.formattedPriceFacets && typeof(t.formattedPriceFacets[displayLabelTitle]) != "undefined") {
                            displayLabelTitle = t.formattedPriceFacets[displayLabelTitle];
                        }
                        label.querySelector("span b span").innerHTML = displayLabelTitle;
                        if (color != "") {
                            label.querySelector("span").innerHTML = "<em style='color: " + color + "'></em>" + label.querySelector("span").innerHTML;
                        }
                        label.querySelector("span b i").innerHTML = "(" + num + ")";
                        filterNode.querySelector(".filters-group-list").append(label);
                    }
                }
            }
            if (filterNode.querySelector("input")) {
                t.accordionFilters.append(filterNode);

                var filtersOpenButton = t.filtersOpenButtonTemp.cloneNode(true);
                filtersOpenButton.querySelector("span").innerHTML = title;
                filtersOpenButton.setAttribute("data-accordion-open", collapseId);
                t.filtersOpen.append(filtersOpenButton);
            }
        };

        productCategory.prototype.clearAllFilters = function () {
            var t = this;
            t.state = {};
            t.pushState();
        };

        productCategory.prototype.buildPagination = function () {
            var t = this;
            t.pagination.innerHTML = "";
            if (t.promoCards) {
                t.numFound += t.promoCards.length;
            }
            if (t.numFound < t.settings.resultsPerPage) {
                return;
            }
            var pagePrevious = t.pagePreviousTemp.cloneNode(true);
            pagePrevious.classList.remove("hidden");
            if (t.state.page == 1) {
                pagePrevious.classList.add("disabled");
            }
            t.pagination.append(pagePrevious);
            t.pages = Math.ceil(t.numFound / t.settings.resultsPerPage);
            var mp = 10;
            var np = 2;
            if (t.mobileView) {
                mp = 4;
                np = 1;
            }
            for (var i=0; i<t.pages; i++) {
                var pageItem = t.pageItemTemp.cloneNode(true);
                pageItem.classList.remove("hidden");
                if (t.pages <= mp || i == 0 || i == (t.pages - 1) || Math.abs(t.state.page - (i + 1)) <= np) {
                    var pageNum = i + 1;
                    pageItem.querySelector("span").innerHTML = pageNum;
                    if (pageNum == t.state.page) {
                        pageItem.classList.add("active");
                    }
                    t.pagination.append(pageItem);
                } else {
                    // if (!t.mobileView) {
                        if (t.pagination.querySelector(".ellipsis") == null || !t.pagination.querySelector("li:last-of-type").classList.contains("ellipsis")) {
                            pageItem.querySelector("span").innerHTML = "...";
                            pageItem.classList.add("ellipsis");
                            pageItem.classList.remove("page-num");
                            t.pagination.append(pageItem);
                        }
                    // }
                }
            }
            var pageNext = t.pageNextTemp.cloneNode(true);
            pageNext.classList.remove("hidden");
            if (t.state.page == t.pages) {
                pageNext.classList.add("disabled");
            }
            t.pagination.append(pageNext);
        };

        productCategory.prototype.getTemplate = function (node) {
            var temp = node.cloneNode(true);
            temp.classList.remove("hidden");
            node.remove();
            return temp;
        };

        productCategory.prototype.getQueryDisplay = function (queries, q) {
            for (var i=0; i<queries.length; i++) {
                var query = queries[i];
                if (query.query == q) {
                    return query.display;
                }
            }
            return "";
        };

        productCategory.prototype.getDefaultQueries = function (field, queries) {
            var t = this;
            var defaultQueries = t.settings.defaultFacetQueries[field];
            if (defaultQueries != undefined && queries == undefined) {
                queries = defaultQueries;
            }
            return queries;
        };

        productCategory.prototype.loading = function (b) {
            var t = this;
            if (b) {
                t.loadingModal.classList.remove("hidden");
                t.content.classList.add("hidden");
            } else {
                t.loadingModal.classList.add("hidden");
                t.content.classList.remove("hidden");
            }
        };

        productCategory.prototype.queryToParam = function (query) {
            var param = query;
            if (param.startsWith("[") && param.endsWith("]")) {
                param = param.toLowerCase();
                param = param.replace(" to ", "_to_");
                param = param.replace(/^\[/, "");
                param = param.replace(/\]$/, "");
            } else if (param.indexOf("###") != -1) {
                param = param.replace(/#/g, "_");
            }
            return param;
        };

        productCategory.prototype.paramToQuery = function (param) {
            var t = this;
            var query = param;
            if (query.indexOf("_to_") != -1) {
                query = query.toUpperCase();
                query = query.replace("_TO_", " TO ");
                query = "[" + query + "]";
            } else if (query.indexOf("___") != -1) {
                query = query.replace(/_/g, "#");
            }
            return query;
        };

        productCategory.prototype.getFormattedPrice = function (lang, currencyCode, price, isInt) {
            var formatter = new Intl.NumberFormat(lang, {
                style: 'currency',
                currency: currencyCode,
            });
            var formattedPrice = formatter.format(price);
            if ('fr' == lang && 'CAD' == currencyCode) {
                formattedPrice = formattedPrice.replace('$CA','CA$');
            }
            var decimalStr = ".00";
            if (currencyCode == "CAD" || currencyCode == "EUR") {
                decimalStr = ",00";
            }
            if (isInt) {
                formattedPrice = formattedPrice.replace(decimalStr,'');
            }
            return formattedPrice;
        };

        productCategory.prototype.inPromoPeriod = function (promoStartDate, promoEndDate) {
            var t = this;
            if (!t.settings.publish) {
                return true;
            }
            if (promoStartDate && promoEndDate) {
                var sd = Date.parse(promoStartDate);
                var ed = Date.parse(promoEndDate);
                var date = new Date();
                var nd = Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());
                if (sd <= nd && nd <= ed) {
                    return true;
                }
            }
            return false;
        };

        return productCategory;
    })();
        
    for (var i=0; i<productCategoryNodeList.length; i++) {
        var productCategory = new ProductCategory(productCategoryNodeList[i], productCategoryData);
    }
}
</script>

</body>
</html>
