<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>bmwusa-content-toggle.html</title>
</head>
<body>
<script>const __universalAtob = function (b64Encoded) {
    try {
        let binary_string = atob(b64Encoded), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(b64Encoded, 'base64'));
    }
};
const __ifWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAF/AAKfgICAAAIDZW52CGltcEZ1bmMxAAADZW52CGltcEZ1bmMyAAADgoCAgAABAQSEgICAAAFwAAAFg4CAgAABAAEHkYCAgAACBm1lbW9yeQIABGRhdGEAAgqSgICAAAGMgICAAAAgAARAEAAFEAELCw==';
const __ifWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__ifWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__ifWasmBuffer, 'base64'));
    }
})());
const __callWasmBuffer = 'AGFzbQEAAAABhICAgAABYAAAAo+AgIAAAQNlbnYHaW1wRnVuYwAAA4KAgIAAAQAEhICAgAABcAAABYOAgIAAAQABB5GAgIAAAgZtZW1vcnkCAARkYXRhAAEKioCAgAABhICAgAAAEAAL';
const __callWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__callWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__callWasmBuffer, 'base64'));
    }
})());
const __wasmStringModules = ['AGFzbQEAAAAFg4CAgAABAAEG84CAgAAUfwBBAQt/AEEEC38AQRILfwBBGAt/AEEgC38AQSgLfwBBwAALfwBBxgALfwBBzAALfwBB8AALfwBBlgELfwBBnAELfwBBogELfwBBqAELfwBBqgELfwBBsAELfwBB1gELfwBB3gELfwBB7gELfwBBhgILB7SBgIAAFQZtZW1vcnkCAAVkYXRhMAMABWRhdGExAwEFZGF0YTIDAgVkYXRhMwMDBWRhdGE0AwQFZGF0YTUDBQVkYXRhNgMGBWRhdGE3AwcFZGF0YTgDCAVkYXRhOQMJBmRhdGExMAMKBmRhdGExMQMLBmRhdGExMgMMBmRhdGExMwMNBmRhdGExNAMOBmRhdGExNQMPBmRhdGExNgMQBmRhdGExNwMRBmRhdGExOAMSBmRhdGExOQMTC96CgIAAFABBAQsBAABBBAsMZGVhbGVyX2luZm8AAEESCwUwMDAwAABBGAsHLm1hY28uAABBIAsGLmh0bWwAAEEoCxZibXctbmF0aW9uYWwtcmVzcG9uc2UAAEHAAAsFdHJ1ZQAAQcYACwUwMDAwAABBzAALIyU1QmRhdGEtY29udGVudCUzRCUyMnByaW1hcnklMjIlNUQAAEHwAAslJTVCZGF0YS1jb250ZW50JTNEJTIyc2Vjb25kYXJ5JTIyJTVEAABBlgELBCUyQwAAQZwBCwQlMkMAAEGiAQsFbWFjbwAAQagBCwEAAEGqAQsEZGl2AABBsAELJUVycm9yJTIwZHVyaW5nJTIwbWFjbyUyMGltYWdlJTIwbG9hZAAAQdYBCwdoaWRkZW4AAEHeAQsOcGljdHVyZSUyMGltZwAAQe4BCxcuY29udGVudC10b2dnbGUtaGlkZGVuAABBhgILAQA='].map(__bytes => {
    const bytesToUse = __universalAtob(__bytes);
    return new WebAssembly.Instance(new WebAssembly.Module(bytesToUse));
});
const lS = (wI, pos, iWC) => {
    let __str = '';
    if (!Array.isArray(wI)) {
        let __targetModule = __wasmStringModules[wI];
        let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
        const __stringKey = `data${ pos }`;
        let __start = __targetModule.exports[__stringKey] - 1;
        let __str = '';
        let i = __start;
        let __c = __mem[i++];
        while (!(parseInt(__c) & 128) && __mem[i]) {
            __str += __c;
            __c = String.fromCharCode(__mem[i++]);
        }
        __str += __c;
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    } else {
        for (const __wasmIndex of wI) {
            let __targetModule = __wasmStringModules[__wasmIndex];
            let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
            const __stringKey = `data${ pos }`;
            let __start = __targetModule.exports[__stringKey] - 1;
            let i = __start;
            let __c = __mem[i++];
            while (!(parseInt(__c) & 128) && __mem[i]) {
                __str += __c;
                __c = String.fromCharCode(__mem[i++]);
            }
            __str += __c;
        }
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    }
};
import { C as h } from '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/component.js';
import {
    u,
    r as c,
    $ as a,
    h as l,
    G as f,
    O as g,
    v as p
} from '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-measurement-data.js';
import { A as d } from '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/angular-utils.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.esm.js';
import { P as C } from '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-panel-container.js';
import { i as b } from '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/is-author.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/index.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/baseDomain.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/getbyourl.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/scroll-to.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/uid.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-chunks/resources/zipcode.js';
import '/etc.clientlibs/bmwusa/clientlibs/clientlib-site/bmwusa-clientlibs/bmwusa-panel-container-tabs.js';
const y = {
        config: {
            centersIds: null,
            subscribe: 'dealerUpdate'
        },
        toggleContent(e, t) {
            this.config.centersIds = e, PubSub.subscribe(this.config.subscribe, (n, o) => {
                const {CenterID: s} = o.dealer;
                (() => {
                    const __ifInstance0 = new WebAssembly.Instance(__ifWasmModule, {
                        env: {
                            impFunc1: () => {
                                {
                                    const i = s, r = this.config.centersIds.indexOf(i) === -1;
                                    (() => {
                                        const __callInstance7 = new WebAssembly.Instance(__callWasmModule, {
                                            env: {
                                                impFunc: () => {
                                                    t(r);
                                                }
                                            }
                                        });
                                        const __exports = __callInstance7.exports;
                                        return __exports.data();
                                    })();
                                }
                            },
                            impFunc2: () => {
                            }
                        }
                    });
                    const __exports = __ifInstance0.exports;
                    return __exports.data(s ? 1 : 0);
                })();
            });
        }
    }, P = {
        toggle(e, t, n) {
            const o = u.getVersionData(), s = e.filter(i => Object.values(o).includes(i.variationName));
            s.length ? c.get(s[0].contentPath).then(i => {
                i.ok && (a.html(t, i.text, !0), d.initialize(t), n && n());
            }) : n && n();
        }
    }, I = {
        dealerDataInfo: l,
        config: {
            subscribe: 'dealerUpdate',
            contentPath: null,
            toggleCallback: null
        },
        hasDealerData(e) {
            return e && (e.dealer || e.ZipCode);
        },
        toggleContent(e, t, n) {
            this.config.toggleCallback = n, this.config.contentPath = t, this.config.zipCodes = e, e.length ? (this.useZipCodeList(l.getDealer()), PubSub.subscribe(this.config.subscribe, (o, s) => {
                (() => {
                    const __callInstance6 = new WebAssembly.Instance(__callWasmModule, {
                        env: {
                            impFunc: () => {
                                this.useZipCodeList(s.dealer);
                            }
                        }
                    });
                    const __exports = __callInstance6.exports;
                    return __exports.data();
                })();
            })) : this.useDealerInfo(n);
        },
        useDealerInfo(e) {
            e(!this.hasDealerData(l.getDealer())), PubSub.subscribe(this.config.subscribe, (t, n) => {
                (() => {
                    const __callInstance5 = new WebAssembly.Instance(__callWasmModule, {
                        env: {
                            impFunc: () => {
                                e(!this.hasDealerData(n.dealer));
                            }
                        }
                    });
                    const __exports = __callInstance5.exports;
                    return __exports.data();
                })();
            });
        },
        useZipCodeList(e) {
            const t = this.isZipCodeListed(this.config.zipCodes, e);
            this.config.contentPath && t ? this.requestContent() : this.config.toggleCallback(t);
        },
        isZipCodeListed(e, t) {
            var s;
            let n = !1;
            const o = ((s = BMWdataLayer == null ? void 0 : BMWdataLayer.user) == null ? void 0 : s.location) || lS(0, 0);
            return (e.indexOf(o) !== -1 || t && t.ZipCode && e.indexOf(t.ZipCode) !== -1) && (n = !0), n;
        },
        requestContent() {
            this.config.contentPath && c.get(`${ this.config.contentPath }.content.html`).then(e => {
                e.ok ? this.config.toggleCallback(!0, e.text) : this.config.toggleCallback(!1);
            }).catch(e => {
                (() => {
                    const __callInstance4 = new WebAssembly.Instance(__callWasmModule, {
                        env: {
                            impFunc: () => {
                                console.warn(`Content toggle error: Error while retrieving content ${ this.config.contentPath }: ${ e }`);
                            }
                        }
                    });
                    const __exports = __callInstance4.exports;
                    return __exports.data();
                })();
            });
        }
    }, L = {
        config: {
            topic: 'personalization.consolidatedValuesUpdate',
            path: null,
            maco: '0000',
            toggleCallback: null
        },
        toggleContent(e, t) {
            this.config.path = e, this.config.toggleCallback = t, this.requestExperienceFragment(this.resolveMaco()), PubSub.subscribe(this.config.topic, (n, {consolidatedMacoId: o}) => {
                o && this.requestExperienceFragment(o);
            });
        },
        requestExperienceFragment(e) {
            this.config.maco !== e ? (this.config.maco = e, this.makeRequest()) : this.config.toggleCallback(null, e);
        },
        resolveMaco() {
            const e = JSON.parse(localStorage.getItem(lS(0, 1))), t = f();
            let n = lS(0, 2);
            return t.maco ? n = t.maco : e ? n = e.maco.Code : document.location.pathname.match(/centers/i) && (n = BMWdataLayer.user.attribution.macoCode), n;
        },
        makeRequest() {
            const e = this.config.path + lS(0, 3) + this.config.maco + lS(0, 4), t = n => {
                    n.ok ? (n.header[lS(0, 5)] === lS(0, 6) && (this.config.maco = lS(0, 7)), this.config.toggleCallback(n.text, this.config.maco)) : this.config.toggleCallback(null, this.config.maco);
                };
            (() => {
                const __callInstance3 = new WebAssembly.Instance(__callWasmModule, {
                    env: {
                        impFunc: () => {
                            Promise.all([
                                c.get(e),
                                g.getOffersByMacoCode()
                            ]).then(n => {
                                t(n[0]), g.applyTargetOffer(n[1]);
                            }).catch(n => {
                                this.config.toggleCallback(null, this.config.maco), console.warn(`Error while retrieving MACO offers or getting target offers, ${ n }`);
                            });
                        }
                    }
                });
                const __exports = __callInstance3.exports;
                return __exports.data();
            })();
        }
    };
new h({
    el: '.content-toggle-module > .na-code-condition',
    name: 'Content Toggle - NA Code Condition',
    subscriptions: { 'pdp.ModelUpdate': 'toggleContentByNaCode' },
    init() {
        this.panelContainer = new C(this.element.parentElement);
    },
    toggleContentByNaCode(e, t) {
        const n = t[0];
        n && this.panelContainer.navigate(n);
    }
});
new h({
    el: '.content-toggle-module',
    name: 'content-toggle Component',
    toggle: {},
    init() {
        const e = { displayNoneClass: 'display-none' };
        this.toggle = {
            centersIds: this.useCenterIds.bind(this),
            queryParams: this.useQueryParameters.bind(this),
            macoExperienceFragment: this.useMacoExperienceFragment.bind(this),
            hasZipCode: this.useDealerInfoCheck.bind(this)
        }, e.mode = this.attrs.toggleMode, e.primaryContent = a.qs(lS(0, 8), this.element), e.secondaryContent = a.qs(lS(0, 9), this.element), this.setMode(e);
    },
    toggleContent(e, t) {
        e ? (t.secondaryContent.classList.add(t.displayNoneClass), t.primaryContent.classList.remove(t.displayNoneClass)) : (t.secondaryContent.classList.remove(t.displayNoneClass), t.primaryContent.classList.add(t.displayNoneClass));
    },
    setMode(e) {
        this.toggle[e.mode] && this.toggle[e.mode](e);
    },
    useQueryParameters() {
        const e = this.attrs.personalizationConfig;
        e && P.toggle(JSON.parse(e), this.element, () => this.showHiddenElement());
    },
    useCenterIds(e) {
        const t = this, n = this.attrs.centersIds;
        n && y.toggleContent(n.split(lS(0, 10)), o => t.toggleContent(o, e));
    },
    useDealerInfoCheck(e) {
        const t = this, n = this.attrs.zipCodes ? this.attrs.zipCodes.split(lS(0, 11)) : [], o = this.attrs.lazyContent;
        (() => {
            const __callInstance2 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        I.toggleContent(n, o, (s, i = null) => {
                            i !== null && (a.html(e.secondaryContent, i, !0), d.initialize(i)), t.toggleContent(!s, e);
                        });
                    }
                }
            });
            const __exports = __callInstance2.exports;
            return __exports.data();
        })();
    },
    useMacoExperienceFragment(e) {
        (() => {
            const __ifInstance1 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            const t = this;
                            e.primaryContent.classList.remove(e.displayNoneClass), L.toggleContent(this.element.dataset.path, (n, o) => {
                                (() => {
                                    const __ifInstance2 = new WebAssembly.Instance(__ifWasmModule, {
                                        env: {
                                            impFunc1: () => {
                                                {
                                                    const s = /<script[\s\S]*?bmwusa-pubsub[\s\S]*?>[\s\S]*?<\/script>/gm, i = n.replace(s, lS(0, 13)), r = document.createElement(lS(0, 14));
                                                    r.innerHTML = i, this.waitForImagesToLoad(r).then(() => {
                                                        (() => {
                                                            const __callInstance1 = new WebAssembly.Instance(__callWasmModule, {
                                                                env: {
                                                                    impFunc: () => {
                                                                        a.html(e.primaryContent, i, !0);
                                                                    }
                                                                }
                                                            });
                                                            const __exports = __callInstance1.exports;
                                                            return __exports.data();
                                                        })();
                                                    }).catch(m => {
                                                        (() => {
                                                            const __callInstance0 = new WebAssembly.Instance(__callWasmModule, {
                                                                env: {
                                                                    impFunc: () => {
                                                                        console.error(lS(0, 15), m);
                                                                    }
                                                                }
                                                            });
                                                            const __exports = __callInstance0.exports;
                                                            return __exports.data();
                                                        })();
                                                    });
                                                }
                                            },
                                            impFunc2: () => {
                                            }
                                        }
                                    });
                                    const __exports = __ifInstance2.exports;
                                    return __exports.data((t.element.dataset.targetingType = lS(0, 12), t.element.dataset.targetingValue = o, n !== null) ? 1 : 0);
                                })();
                                e.primaryContent.classList.remove(lS(0, 16)), p.enqueue(t.element);
                            });
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance1.exports;
            return __exports.data(!b() ? 1 : 0);
        })();
    },
    waitForImagesToLoad(e) {
        const t = e.querySelectorAll(lS(0, 17)), n = Array.from(t).filter(o => o.src).map(o => new Promise((s, i) => {
                o.onload = s, o.onerror = s;
            }));
        return Promise.all(n);
    },
    showHiddenElement() {
        const e = this.element.querySelector(lS(0, 18));
        e && (e.style.cssText = lS(0, 19));
    }
});</script>
</body>
</html>
