<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clientlib-base.min.html</title>
</head>
<body>

<script>
(function() {
    "use strict";

    var EMPTY_PIXEL = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
    var SRC_URI_TEMPLATE_WIDTH_VAR = "{.width}";

    var selectors = {
        self: '[data-slc-image="image"]'
    };

    var properties = {
        "widths": {
            "default": [],
            "transform": function(value) {
                var widths = [];
                value.split(",").forEach(function(item) {
                    item = parseFloat(item);
                    if (!isNaN(item)) {
                        widths.push(item);
                    }
                });
                return widths;
            }
        },
        "src": {
        }
    };

    var devicePixelRatio = window.devicePixelRatio || 1;

    function readData(element) {
        var data = element.dataset;
        var options = [];

        for (var key in data) {
            if (data.hasOwnProperty(key)) {
                options[key] = data[key];
            }
        }
        return options;
    }

    function Renditionimage(config) {
        var that = this;

        function init(config) {
            setupProperties(config.options);
            that._elements = {};
            that._elements.self = config.element;

            window.addEventListener("resize", onWindowResize);
            window.addEventListener("update", that.update);
            that.update();
        }

        function loadImage() {
            var hasWidths = that._properties.widths && that._properties.widths.length > 0;
            var replacement = hasWidths ? "." + getOptimalWidth() : "";
	            
            if(that._properties.src !== undefined){
            	var url = that._properties.src.replace(SRC_URI_TEMPLATE_WIDTH_VAR, replacement);
	
	            if (that._elements.self.getAttribute("link-image") !== null && that._elements.self.getAttribute("link-image") !== url) {
	                that._elements.self.setAttribute("link-image", url);
	            }else {
	                if (that._elements.self.getAttribute("background-image") !== null && that._elements.self.getAttribute("background-image") !== url) {
	                    that._elements.self.setAttribute("background-image", url);
	                }else {
	                    if (that._elements.self.getAttribute("icon") !== null && that._elements.self.getAttribute("icon") !== url) {
	                        that._elements.self.setAttribute("icon", url);
	                    }else {
	                        if (that._elements.self.getAttribute("img-src") !== null && that._elements.self.getAttribute("img-src") !== url) {
	                            that._elements.self.setAttribute("img-src", url);
	                        }else {
	                            if (that._elements.self.getAttribute("image-src") !== null && that._elements.self.getAttribute("image-src") !== url) {
	                                that._elements.self.setAttribute("image-src", url);
	                            } else {
	                                if (that._elements.self.getAttribute("img-link") !== null && that._elements.self.getAttribute("img-link") !== url) {
	                                    that._elements.self.setAttribute("img-link", url);
	                                }
	                            }
	                        }
	                    }
	                }
	            }
            }
        }

        function getOptimalWidth() {
            var container = that._elements.self;
            var containerWidth = window.screen.width;
            var len = that._properties.widths.length;
            var key = 0;

            while ((key < len - 1) && (that._properties.widths[key] < containerWidth)) {
                key++;
            }

            return that._properties.widths[key].toString();
        }

        function setupProperties(options) {
            that._properties = {};

            for (var key in properties) {
                if (properties.hasOwnProperty(key)) {
                    var property = properties[key];
                    if (options && options[key] != null) {
                        if (property && typeof property.transform === "function") {
                            that._properties[key] = property.transform(options[key]);
                        } else {
                            that._properties[key] = options[key];
                        }
                    } else {
                        that._properties[key] = properties[key]["default"];
                    }
                }
            }
        }

        function onWindowResize() {
            that.update();
        }

        that.update = function() {
            loadImage();
        };

        if (config && config.element) {
            init(config);
        }
    }

    function onDocumentReady() {
        var elements = document.querySelectorAll(selectors.self);
        for (var i = 0; i < elements.length; i++) {
            new Renditionimage({ element: elements[i], options: readData(elements[i]) });
        }

        var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
        var body             = document.querySelector("body");
        var observer         = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                // needed for IE
                var nodesArray = [].slice.call(mutation.addedNodes);
                if (nodesArray.length > 0) {
                    nodesArray.forEach(function(addedNode) {
                        if (addedNode.querySelectorAll) {
                            var elementsArray = [].slice.call(addedNode.querySelectorAll(selectors.self));
                            elementsArray.forEach(function(element) {
                                new Renditionimage({ element: element, options: readData(element) });
                            });
                        }
                    });
                }
            });
        });

        observer.observe(body, {
            subtree: true,
            childList: true,
            characterData: true
        });
    }

    if (document.readyState !== "loading") {
        onDocumentReady();
    } else {
        document.addEventListener("DOMContentLoaded", onDocumentReady);
    }
})();

window.addEventListener('load', (event) => {
	if (digitalData != null) {
		var pageName = document.querySelector("#contentPage").getAttribute("data-pagename");
		var pagenameArray = pageName ? pageName.split(":") : [];
		var seccion1 = pagenameArray[1] != null ? pagenameArray[1]: "";
		var seccion2 = pagenameArray[2] != null ? pagenameArray[2]: "";
		var seccion3 = pagenameArray[3] != null ? pagenameArray[3]: "";
		var seccion4 = pagenameArray[4] != null ? pagenameArray[4]: "";
		var seccion5 = pagenameArray[5] != null ? pagenameArray[5]: "";
		var seccion6 = pagenameArray[6] != null ? pagenameArray[6]: "";
		var loginType = "no logado";
		if (document.querySelector(".rf-header__username") != null) {
			loginType = "logado";
		}
		var days = ["domingo", "lunes", "martes", "miércoles", "jueves", "viernes", "sábado"];
		var today = new Date();
		var hour = formatHourAMPM(today);
		var day = days[today.getDay()];
		var dayNumber = today.getDay();
		var dateHour = day + "-" + today.toLocaleString("es-ES").replace(" ", "-");
		var dayType = "laborable";
		if (dayNumber == 0 || dayNumber == 6) {
			dayType = "no laborable";
		}
		var pageType = "";
		if (pageName.indexOf("error:404") >= 0) {
			pageType ="errorPage";
		}
		
		digitalData = {
			"pageName": pageName,
			"pageURL": document.URL,
			"seccion1": seccion1,
			"seccion2": seccion2,
			"seccion3": seccion3,
			"seccion4": seccion4,
			"seccion5": seccion5,
			"seccion6": seccion6,
			"loginType": loginType,
			"language": document.documentElement.lang.toLocaleUpperCase(),
			"hour": hour,
			"day": day,
			"dateHour": dateHour,
			"dayType": dayType,
			"pageType": pageType
		};
		_satellite.track('view');
	}
});

function formatHourAMPM(date) {
	var hours = date.getHours();
	var minutes = date.getMinutes();
	var hourAmPm = hours >= 12 ? "pm" : "am";
	var hour = hours % 12;
	hour = hour ? hour : 12;
	minutes = minutes < 30 ? "00" : "30";
	var formatHour = hour + ":" + minutes + hourAmPm;
	return formatHour;
}

</script>

</body>
</html>
