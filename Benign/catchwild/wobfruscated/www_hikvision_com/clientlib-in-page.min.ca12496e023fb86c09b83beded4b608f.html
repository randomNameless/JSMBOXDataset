<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>clientlib-in-page.min.ca12496e023fb86c09b83beded4b608f.html</title>
</head>
<body>
<script>;$(function () {
  var $headerComponent = $("#header");
  var isGlobalNewHeader = $('#header').hasClass('global-header')
  var $navLeft = $headerComponent.find('.header-navbar').find('.nav-left-item');
  $('.search.new-search').on('click', function(e){
      e.stopPropagation()
      $(".nav-box").parent().removeClass('active')
      $('.header-all').hide().siblings('.search-div').show().find('input').focus()
  })
  $('.mobile-search-icon').on('click', function(){
    $('.header-all').hide().siblings('.search-div').show().find('input').focus()
  })
  var clearDiv =  $('.search-wrap').find('.clear')
  clearDiv.on('click', function(){
    $('body .layout').remove();
    if($(document).width()<1024){
      $('.search-div').hide()
      $(this).siblings('#headerSerachInput').val('')
    }else{
      $('.search-div').hide().siblings('.header-all').show()
    }
  })
  $('.search-div').on('click', function(e){
     e.stopPropagation()
  })
  // $(document).on('click', function(){
  //     if($(document).width()>1024) {
  //       $('.search-div').hide().siblings('.header-all').show()
  //     }
  // })
  // var $expandArrow = $('#header .mobile-bottom-nav .title:not(.no-expand)');
  var $expandArrow = $('.mobile-nav-li').find('p.title');
  $expandArrow.off("click").on('click', function(e){
    e.stopPropagation()
    var _this=$(this)
    var hasDownClass = $(this).find('svg').hasClass('down-expand')
    var hasLangClass = $(this).parent().hasClass('lang')
    if(hasDownClass){
      $(this).parent().parent().find('ul').show()
      $(this).find('svg').removeClass('down-expand')
      if($(this).parent().parent().find('.second-nav-box').length){
        $(this).parent().parent().find('.second-nav-box').hide()
      } else {
        $(this).parent().parent().find('.second-nav').hide()
        $(this).parent().parent().find('.second-nav .mobile-nav-li svg.down-expand').removeClass('down-expand')
      }
    } else {
      $(this).parent().parent().find('ul').hide()
      $(this).find('svg').addClass('down-expand');
      if($(this).parent().parent().find('.second-nav-box').length){
        $(this).parent().siblings('.second-nav-box').show().parent().css({height: 'auto'})
      } else {
        $(this).parent().siblings('.second-nav').show().parent().css({height: 'auto'})
      }

    }
  })
// 产品三级菜单展开收缩
function toggleProduvctNavgation(){
  var $productToggleNav = $(".product-sub_scroll").find(".mobile-nav-li").find("p.title")
  $productToggleNav.on("click", function(){
    var hasDownClass = $(this).find('svg').hasClass('down-expand')
    if(hasDownClass){
      $(this).find('svg').removeClass('down-expand')
      $(this).parent().parent().find('ul').show()
    }else{
      $(this).find('svg').addClass('down-expand')
      $(this).parent().parent().find('ul').not('.software-ul').hide()
    }
  })
}
//软件硬件切换
var $productTab = $(".product-tab").find("span")
$productTab.on("click",function(e){
  var productTab = $(this).attr("data-tab")
  $(this).addClass("active").siblings().removeClass("active")
  $(".product-menu").hide()
  $(".product-menu." + productTab).show()
  if(productTab == "product-software"){
     $(".product-software").find("ul>li").find(".mobile-nav-li").find(".main-title.active").click();
  }
})  
// 点击产品
  var $expandProudctArrow = $('.mobile-nav-li').find('div.main-title');
  $expandProudctArrow.on('click', function(e){
    $(this).addClass("active").parent().parent().siblings("li").find(".mobile-nav-li").find(".main-title").removeClass("active")
    $(this).parent().parent().addClass("active").siblings("li").removeClass("active")
    var searchPath = $(this).data("search-path").replaceAll(".html", "")
    var subCategoryUl = $(this).parent().next().find('.second-nav');
    var templateType = $(this).data("type") == "hardware"?"tmpl-mob-product-sub-category":"tmpl-mob-software-product-category"
    var  _text = $(this).text().trim();
    var _titleHref = $(this).data("type") == "hardware" ? $(this).data("search-path") : $(this).data("search-link") 
    requestSubProductRequest(searchPath, function(data){
      var datas =  {
        title: _text,
        href: _titleHref,
        openNewTab: $("#header.cn-header").attr("data-newTab-open"),
        result: data
      }
      subCategoryUl.html(tmpl(templateType, datas));
      toggleProduvctNavgation();
   }, templateType == "tmpl-mob-software-product-category"? "cn": null)
  })
  var backTopTo = $('#header').hasClass('global-header') ? $('.mobile-nav-box').find('ul').find('li .top-back') : $('.mobile-nav-box').find('ul').find('li.top');
  backTopTo.on('click', function(e){
    e.stopPropagation()
    $(this).closest('.mobile-nav-box').hide()
  })
  $('#header.global-header .mobile-nav-box .back-icon').on('click', function() {
    $('#header.global-header .back-and-login-container .back-icon').click();
  })
  var mobileLi = $('.mobile-nav').find('ul').find('li')
  var lanLi = $('.lang-box').find('.lang-span')
  mobileLi.on('click', function(e){
    e.stopPropagation()
    $(".header-mobile_back").addClass('second-back');
    $(this).find('.mobile-nav-box').show()
  })
  lanLi.on('click', function(e){
    e.stopPropagation()
    $(this).parent().find('.mobile-nav-box').show()
  })
  $('.navigation').off('click').on('click', function(e){
    var isHideClass = $(this).find('.nav-cha').is(":hidden")
    $('.mobile-nav-box').hide()
    $('.mobile-bottom-nav').find('li').removeClass('active')
    $('.image-text-div').removeClass('active')
   // $('.bottom-product-box').hide()
    if(isHideClass){
      $(this).find('.nav-cha').show()
      $(this).find('.navigation-span-warp').hide()
      if($(this).closest('#header').hasClass('global-header')) {
        $(this).closest('.header-nav').find('.mobile-nav').show();
      } else {
        $(this).siblings('.mobile-nav').show()
      }
      $('#header.cn-header .mobile-right-mini-menu').removeClass('show-close')
      $('#header.cn-header .mobile-nav-right-menu').hide()
      $('#header').css({'z-index': '3333333'})
      getCurrentBreakpoint() == 'DESKTOP' ? $('html').addClass('overflow-prevent') : $('html, body').addClass('overflow-prevent');
      $(".header-logo,.mobile-search-icon").addClass('hide_sign')
      $(".header-mobile_back").show() 
    } else {
      $(this).find('.nav-cha').hide()
      $(this).find('.navigation-span-warp').show()
      if($(this).closest('#header').hasClass('global-header')) {
        $(this).closest('.header-nav').find('.mobile-nav').hide();
      } else {
        $(this).siblings('.mobile-nav').hide();
      }
      $('#header').css({'z-index': '3'})
      getCurrentBreakpoint() == 'DESKTOP' ? $('html').removeClass('overflow-prevent') : $('html, body').removeClass('overflow-prevent');
      $(".header-logo,.mobile-search-icon").removeClass('hide_sign')
      $(".header-mobile_back").hide() 
    }
  })
  var mobLi = $('#header .mobile-bottom-nav').find('li').find('.image-text-div');
  var cha = $('#header .mobile-bottom-nav').find('li').find('.bottom-product-box').find('.cha');
  var mask = $('#header .mobile-bottom-nav').find('li').find('.bottom-product-box').find('.mask');
  var chaMask = $('#header .mobile-bottom-nav').find('li').find('.bottom-product-box').find('.cha-mask');
  var maskProduct= $('#header .mobile-bottom-nav').find('li').find('.bottom-product-box').find('.mask').find('.product');
  mobLi.on('click', function(){
    $(this).addClass('active')
    $(this).parent().addClass('active')
    $(this).parent().siblings().removeClass('active')
    $(this).parent().siblings().find('.image-text-div').removeClass('active')
    $("body").css({
      overflow:'hidden'
    })
    var isHideClass = $('.nav-cha').is(":hidden")
    $('#header').css({'z-index': '3333333'})
    if(!isHideClass){
      $('.nav-cha').parent().find('.nav-cha').hide()
      $('.nav-cha').parent().find('.navigation-span-warp').show()
      $('.nav-cha').parent().siblings('.mobile-nav').hide()
    }
  })
 cha.on('click', function(){
   $(this).parent().parent().parent().parent().removeClass('active')
   $(this).parent().parent().parent().siblings().removeClass('active')
   $('#header').css({'z-index': '3'})
   $('body').css({
     overflow:'auto'
   })
 })
 maskProduct.each(function () {
    $(this).on('click', function(e){
     stopPropagation(e);
   })
 });
 chaMask.each(function () {
    $(this).on('click', function(e){
     stopPropagation(e);
    })
 });
 mask.each(function(index){
    var _this = $(this);
    $(this).on('click', function(e){
      closeTab(_this);
      stopPropagation(e);
    })
 })
 var closeTab = function(_this){
   _this.parent().parent().removeClass('active')
   _this.parent().siblings().removeClass('active')
   $('#header').css({'z-index': '3'})
   $('body').css({
     overflow:'auto'
   })
 }
 var stopPropagation = function(e) {
   if ( e && e.stopPropagation )
    e.stopPropagation();
 else
    window.event.cancelBubble = true;
 }

  var $hardwareBox = $('#header .mobile-bottom-nav .product-hardware');
  var $softwareBox = $('#header .mobile-bottom-nav .product-software');
  var $hardwareTab = $('#header .mobile-bottom-nav .tab-hardware');
  var $softwareTab = $('#header .mobile-bottom-nav .tab-software');
  $hardwareTab.on('click', function(e){
     $softwareTab.removeClass('active');
     $hardwareTab.addClass('active');
     $hardwareBox.show();
     $softwareBox.hide();
  });

  $softwareTab.on('click', function(e){
     $softwareTab.addClass('active');
     $hardwareTab.removeClass('active');
     $hardwareBox.hide();
     $softwareBox.show();
  });
 // mobile顶部返回的逻辑
 $(".header-mobile_back").on("click", function(){
  if($(this).hasClass('second-back')){
    $(".navigation").click().click();
    $(this).removeClass('second-back');
  } else {
    $(".navigation").click();
  }
 })
 $('.clear-mask').on('click', function(e){
    e.stopPropagation()
     $(this).parent().parent().parent().parent().removeClass('active')
     $('.nav-left-item').removeClass('active')
 })
 $('.lang-clear-mask').on('click', function(e){
  e.stopPropagation()
   $(this).parent().parent().parent().parent().removeClass('active')
  // $(this).parent().parent().parent().hide()
   $('.nav-left-item').removeClass('active')
   $('.nav-left-item').removeClass('activeLan')
})
$('#header .nav-box .mask').on('click', function(e){
   e.stopPropagation();
})
  $('.nav-box').on('click', function (e) {
    e.stopPropagation()
    $(this).parent().removeClass('active')
    if ($(this).parent().hasClass('lang')) {
      $(this).hide()
    }
  })
  $('.nav-box').on('mousemove', function () {
    var $this = $(this);
    if($this.closest('#header').hasClass('global-header')) {
      setTimeout(function () {
        $this.parent().removeClass('active')
        if ($this.parent().hasClass('lang')) {
          $this.hide()
        }
      }, 300)
    } else {
      $this.parent().removeClass('active')
      if ($this.parent().hasClass('lang')) {
        $this.hide()
      }
    }
  })
  $('.nav-box .mask').on('mousemove', function (e) {
    e.stopPropagation()
  })

 $('.product-dd-box .product-dd-title').on('click', function(e){
   e.stopPropagation()
   $(this).parent('.product-dd-box').hide()
 })
 var tid = null;
  $navLeft.hover(function(e){
     e.stopPropagation()
     var self = this
      tid = setTimeout( function() {
      $(self).addClass('active', function(){
        if($(self).find(".product-software-hardware-tab")){
          $(self).find(".product-software-hardware-tab").find(".item").removeClass("active")
          $(self).find(".product-software-hardware-tab").find(".item").first().addClass("active")
          $(".product-software-container").removeClass("active")
          $(".product-hardware-container").addClass("active")
        }
       if(!isGlobalNewHeader) $(self).find(".box-ul").find(".box-fis-li").first().addClass("active")
        if($(this).find('.support-mask').length) {
         // $(self).find('.box-fis-li.active').trigger('mouseover')
          var mHeight =  $(this).find('.support-mask').height()<634 ? $(this).find('.support-mask').height() : 700
        //  $(this).find('.support-mask').find('.support-line-box').css({height: mHeight + 'px'})
        }
        // find('.mask').find('.support-line-box').css({height: '700px'})
      })
      $(self).siblings().removeClass('active')
      $(self).find(".nav-box").css({
        height: $("body").height()
      })
      if(isGlobalNewHeader){
            // $('.nav-left-item.lang').find('.nav-box').hide()
        var divSecond = $(self).find('.box-fis-li.active')
        var dWidth = $(document).width()
        var solutionMask = $(divSecond).parent().parent().parent().hasClass('solution-mask')
        var productMask = $(divSecond).parent().parent().parent().hasClass('product-mask')
        var supportMask = $(divSecond).parent().parent().parent().hasClass('support-mask')
        var maskDdLength = $(divSecond).find('.second-dl dl dd')
        var maskHeight = (solutionMask? maskDdLength.length>=7?7:isOdd(maskDdLength.length):maskDdLength.length)*(solutionMask ? dWidth>=1440?65:50 : (dWidth>=1440?36:28))
        var parentHeight = $(divSecond).parent().height()-55
        if(parentHeight <220){
          parentHeight = 220
        }
        if(maskHeight < 220){
          maskHeight = 220
        }
        if(maskDdLength){
          if(maskHeight>=parentHeight) {
            if($(divSecond).parent().parent().parent().hasClass('product-mask')){
              $(divSecond).parent().parent().css({
                height: maskHeight + (dWidth<=1440?-50:22) +'px'
              })
            } else if($(divSecond).parent().parent().parent().hasClass('solution-mask')){
              $(divSecond).parent().parent().css({
                height: maskHeight + (maskDdLength.length>6 ? 160 : 100) +'px'
              })
            } else if($(divSecond).parent().parent().parent().hasClass('about-mask')){
              var img = new Image();
              img.src = $(divSecond).find('.nav-detail-box .lazy-image').attr('src');
              var imgHeight = img.height >=400 ? 400 :img.height
              $(divSecond).parent().parent().css({
                  height: (maskHeight>imgHeight?maskHeight:imgHeight-80) + (dWidth<=1440?80:120) +'px'
              })
            } else if($(divSecond).parent().parent().parent().hasClass('support-mask')){
              var activeProductDdliLen = $(divSecond).find('.nav-detail-box li').length
              $(divSecond).parent().parent().css({
                height: maskHeight + (activeProductDdliLen ? 162: 62) +'px'
              })
            } else {
              $(divSecond).parent().parent().css({
                height: maskHeight + (dWidth<=1440?90:140) +'px'
              })
            }
          } else {
            var rHeight = $(divSecond).parent().find('.box-fis-li').length>=15 ? 100 : (dWidth >= 1440? solutionMask ? 160: 80:80)
            $(divSecond).parent().parent().css({
                    height: parentHeight + (productMask ? rHeight-15: supportMask ? rHeight-20 : rHeight) +'px'
                  })
          }
        }
      } else {
        var liLength = $(self).find(".mask").find(".box-ul").find(".box-fis-li").length
        var $boxulH =  (liLength?liLength:1) * 40
        var $secondDlH = $(self).find(".mask").find(".box-ul").find(".second-dl").height();
        if($(self).find(".mask").hasClass("solution-mask")){
          $(self).find(".mask").find(".wrap1310.clearfix").css({
             height: $secondDlH>$boxulH?$secondDlH + 104 + 'px':$boxulH + 88 + 'px'
          })
         $.each($(self).find('.mask').find('.box-ul').find("li.active").find('dd'), function(){
           var imgSrc = $(this).find('.img-div img').attr('data-src')
           if(!$(this).find('.img-div img').attr('src')){
            $(this).find('.img-div img').attr('src', imgSrc)
           }
         })
        }else{
          $(self).find(".mask").not(".product-mask").find(".wrap1310.clearfix").css({
            height: $secondDlH>$boxulH?$secondDlH + 96 + 'px':$boxulH + 96 + 'px'
          })
        }
      }

    //  defaultOpenMenu()
      if(!$(self).hasClass('product-nav-item')){
        $(self).find('.nav-box').find('.box-ul>li').removeClass('active')
        $(self).find('.nav-box').find('.box-ul>li').eq(1).addClass('active')
      }
      var liLens = $(self).find('.nav-box').find('.box-ul>li').length
      if(liLens>=14){
          $(self).find('.nav-box').find('.fmore').show()
      }
      if(liLens>=16){
        $(self).find('.nav-box').find('.global-product-more').show()
      }
       }, 200 );
     },
     function(e){
       e.stopPropagation();
       clearTimeout( tid );
       if(!isGlobalNewHeader){
        $(this).find(".box-ul").find(".box-fis-li").removeClass("active")
       }
      }
     )
 var tidlan = null
 var countBoolean = false
  $('.navbar-nav-list.right').find('.nav-left-item').hover(function(e){
    e.stopPropagation()
     var self = this
     if($(self).hasClass('lang')){
      countBoolean = true
     }
     tidlan = setTimeout(function(){
       if($(self).hasClass('lang')){
        var liLength = $(self).find(".mask").find(".box-ul").find(".box-fis-li").length
        var $boxulH =  (liLength?liLength:1) * 40
        var $secondDlH = $(self).find(".mask").find(".box-ul").find(".second-dl").height();
        var thirdH = $(self).find(".nav-detail-box").find("img").height();
        $(self).addClass('activeLan').addClass('active')
        $(self).siblings().removeClass('activeLan').removeClass('active')
        var maxHeight = Math.max($boxulH,$secondDlH,$(self).find(".nav-detail-box").find("img").height())
        $(self).find(".mask").not(".product-mask").find(".wrap1310.clearfix").css({
          height: maxHeight + 96 + 'px'
        })
       } else {
      //  $(self).siblings('.lang').addClass('activeLan')
      //  $(self).siblings().removeClass('activeLan')
       }
      }, 300)
    }, function(e){
      e.stopPropagation()
      var self =  this
      countBoolean = false
      clearTimeout(tidlan)
      // if($(self).hasClass('lang')){
      //   $(self).removeClass('activeLan').removeClass('active')
      //  }
      setTimeout(function(){
        if($(self).hasClass('lang') &&  !countBoolean){
            $(self).removeClass('activeLan').removeClass('active')
        }
        //$(self).siblings('.lang').removeClass('activeLan').removeClass('active')
       // $('.new-banner-full').show()
      }, 300)
    }
  )
  $('.navbar-nav-list.right').find('.nav-left-item').on('mouseover', function(e){
     e.stopPropagation();
  })

   $('.nav-left-item').on('mousemove', function(e){
     e.stopPropagation()
   })

    $('#header').hover(function(){
      $('.nav-left-item').removeClass('has-active')
      }, function(){
        $('.nav-left-item').removeClass('has-active')
    })

  var timend= null
  $('.boxli').hover(function(e){
    e.stopPropagation()
    var self = this
    timend = setTimeout(function(){
      $(self).siblings().removeClass('active')
      $(self).parent().siblings().removeClass('active')
      $(self).parent().parent().parent().parent().siblings().removeClass('active')
      $(self).parent().siblings().find('li').removeClass('active')
      $(self).addClass('active')
    }, 150)
  }, function(e){
    e.stopPropagation()
    clearTimeout(timend)
  })
  function isOdd(length){
    if(length%2 === 0){
      return length
    } else {
      return length + 1
    }
  }
  var time3 = null;
  $('#header .box-fis-li .second-dl').hover(function (e) {
    e.stopPropagation()
  })
  $('#header .box-fis-li').hover(function (e) {
    e.stopPropagation()
    var self = this
    var dWidth = $(document).width()
    var solutionMask = $(self).parent().parent().parent().hasClass('solution-mask')
    var productMask = $(self).parent().parent().parent().hasClass('product-mask')
    var supportMask = $(self).parent().parent().parent().hasClass('support-mask')
    var partnerMask = $(self).parent().parent().parent().hasClass('about-mask')
    var supportMMask = $(self).parent().parent().parent().hasClass('supportM-mask')
    time3 = setTimeout(function () {
      $(self).siblings().removeClass('active')
      $(self).find('.second-dl').find('dd').removeClass('active')
      $(self).find('.second-dl').find('dd').find('li').removeClass('active')
      $(self).find('.second-dl').find('dl').find('dd:nth-of-type(1)').addClass('active')
      $(self).find('.second-dl').find('dd:nth-of-type(1)').find('li:nth-of-type(1)').addClass('active')
      $(self).addClass('active')
      if (productMask) {
        var $div = $(self).find('.second-dl');
        var $mask = $('#header.global-header .product-mask');
        initHeight($div, $mask);
      }
      if (supportMask) {
        var $div = $(self).find('.second-dl');
        var $mask = $('#header.global-header .support-mask');
        initHeight($div, $mask);
      }
      if(solutionMask){
        $.each($(self).find('dd'), function(){
          var imgSrc = $(this).find('.img-div img').attr('data-src')
          if(!$(this).find('.img-div img').attr('src')){
           $(this).find('.img-div img').attr('src', imgSrc)
          }
        }) 
      }
      if (partnerMask) {
        var $div = $(self).find('.second-dl');
        var $mask = $('#header.global-header .about-mask');
        initPartner($div, $mask);
      }
      if (!$(self).parent().parent().hasClass("product-software-container")) {
        initCategoryHover($(self));
        cnAltLink('.product-software-container .sections-detail .sub-item.alt-link-lazy ', true)
      } else {
        var subCategoryUl = $(self).find('.sections-detail');
        var resourcePath = $(self).attr("data-resource");
        if (resourcePath) {
          requestSubProductRequest(resourcePath, function (data) {
            data.categoryName = $(self).data('category')
            subCategoryUl.html(tmpl('tmpl-software-product-category', data));
            //中文站软件产品pc端埋点
            cnAltLink('.product-software-container .sections-detail .sub-item.alt-link-lazy ', true)
          }, "cn");
        }
      }
      var liLength = $(self).parent().parent().parent().find(".box-ul").find(".box-fis-li").length
      var $boxulH =  (liLength?liLength:1) * 40
      var ddLength = solutionMask && !supportMMask ? Math.min($(self).find('.second-dl').find('dd').length, 5): $(self).find('.second-dl').find('dd').length
      var $secondDlH = (ddLength?ddLength:1) * 40;
      if($(self).parent().parent().parent(".mask").hasClass("solution-mask")){
        $(self).parent().parent().css({
          height: (ddLength?ddLength:1)*100>$boxulH?(ddLength?ddLength:1)*102 + 104 + 'px':$boxulH + 88 + 'px'
        })
      }else{
        if($(self).hasClass("product-li")){
          if($(self).find(".sections-detail").length){
            $(self).parent().parent().css({
              height: $(self).find(".sections-detail").height()>$(self).siblings("li.product-li").length*40?($(self).find(".sections-detail").height() + -20 + 'px'):($(self).siblings("li.product-li").length*40 + 16 + 'px')
            })
          }else{
            $(self).parent().parent().parent(".mask").not(".product-mask").find(".wrap1310.clearfix").css({
              height: $secondDlH>$(self).siblings("li.product-li").length*40?($secondDlH + 86 + 'px'):($(self).siblings("li.product-li").length*40 + 86 + 'px')
            })
          }
        } else {
          $(self).parent().parent().css({
            height: $secondDlH>$boxulH?($secondDlH + 96 + 'px'):($boxulH + 96 + 'px')
          })
        }
      }
    }, 201)
  }, function (e) {
    e.stopPropagation()
    clearTimeout(time3)
  })
  $('.lanli').on('click', function(e){
      e.stopPropagation()
      var aHref = $(this).attr('data-href')
      window.open(aHref, '_self')
  })
  var headTimer, delayTime = 30;
   /*
   计算最外层mask的高度
  */
 var countMaskHeight = function(self){
  var countCurrent = $(self).find('.second-dl')
  if(countCurrent) {
   var ddLens = countCurrent.find('dl').find('dd')
   if(!$(self).parent().parent().parent().parent().parent().hasClass('lang')){
    $(self).parent().parent().parent().removeClass('lang-active')
    if(ddLens.length>4){
      $(self).find('.more:not(".global-slution-more")').show()
      $(self).parent().parent().parent().addClass('max-height')
    } else {
      $(self).parent().parent().parent().removeClass('max-height')
      $(self).find('.more:not(".global-slution-more")').hide()
    }
   } else {
    if(ddLens.length>10){
      $(self).parent().parent().parent().addClass('lang-active')
    } else {
      $(self).parent().parent().parent().removeClass('lang-active')
    }
   }
  }
 }
 
$(".nav-left-item.lang").on('click', function (e) {
  e.stopPropagation()
  $(this).addClass('active')
  $(this).find('.nav-box').show()
});
   var $productPCTab = $('#header .nav-left-item .product-software-hardware-tab .item');
    var SUPPORTTOUCH = 'ontouchstart' in window || navigator.msMaxTouchPoints;
    if(SUPPORTTOUCH) {
        $productPCTab.on('click', function(e) {
            switchTab(e, $(this));
        });
    } else {
        $productPCTab.on('click', function(e) {
            var aHref = $(this).attr('data-href')
            window.open(aHref, '_self')
        });
        var time = null;
        $productPCTab.hover(function(e) {
            var _this = $(this);
            time = setTimeout(function() {
                switchTab(e, _this);
            },150)
        }, function(e){
                e.stopPropagation();
                clearTimeout(time);
          }
        );
    }
    var switchTab = function(e, _this) {
        var $outerContainer = _this.closest('.product-nav-item');
        var $hardwareContainer = $outerContainer.find('.product-hardware-container');
        var $softwareContainer = $outerContainer.find('.product-software-container');

        e.stopPropagation();
        _this.addClass('active');
        _this.siblings().removeClass('active');
        if (_this.hasClass('hardware-tab')) {
            $hardwareContainer.addClass('active');
            $softwareContainer.removeClass('active');
        } else {
            $hardwareContainer.removeClass('active');
            $softwareContainer.addClass('active');
            $(".product-software-container").find(".box-ul").find(".box-fis-li").removeClass("active")
            var $firstLi = $(".product-software-container").find(".box-ul").find(".box-fis-li").first()
            $firstLi .addClass("active")
            if($firstLi .find(".sections-detail").length){
              $(".product-software-container").css({
                height: $firstLi.find(".sections-detail").height()>$firstLi.siblings("li.product-li").length*40?($firstLi.find(".sections-detail").height() + -20 + 'px'):($firstLi.siblings("li.product-li").length*40 + 16 + 'px')
              })
            }
        }
    }
    /**
     * lazy load product data
     * @param container
     */
    var time4 = null
    var initProductSubCategoryHover = function (container) {
        if (container) {
            container.find('.product-nav-dd').hover(function (e) {
                e.stopPropagation();
                var $this = $(this);
                time4 = setTimeout(function(){
                  $this.siblings().removeClass('active');
                  $this.siblings().find('li').removeClass('active');
                  $this.addClass('active');
                  $this.find('li').removeClass('active');
                  $this.find('li:nth-of-type(1)').addClass('active');
                }, 150)
            }, function(e){
                e.stopPropagation();
                clearTimeout(time4)
            });
        }
    };
    /**
     * lazy load product data
     */
    var initCategoryHover = function (categoryItem) {
        var navProduct = categoryItem.find('.nav-product');
        var $this = $(this);
        if (navProduct.length > 0) {
            var subCategoryContainer = categoryItem.find('.second-dl');
            var productNavDd = subCategoryContainer.find(".product-nav-dd");
            if (!productNavDd || productNavDd.length === 0) {
                clearTimeout(headTimer);
                headTimer = setTimeout(function () {
                    var link = navProduct.find(".at-navigation");
                    if (link.length === 0) {
                        link = navProduct.find(".at-lazy");
                    }

                    var path = link.attr("href");
                    if (path && path.indexOf("products") > 0) {
                        var subCategoryUl = subCategoryContainer.find(".product-config");
                        if(subCategoryUl.length == 0){
                            //中文站
                            subCategoryUl = subCategoryContainer.find("dl");
                        }
                        var category = subCategoryUl.data("category");
                        var template = "tmpl-product-sub-category";
                        getChildNavInfo(path.replaceAll(".html", ""), category, subCategoryUl, template, function () {
                            categoryItem.find(".product-nav-dd[data-index=0]").addClass("active");
                            categoryItem.find(".product-dd-li[data-index=0]").addClass("active");
                            initProductSubCategoryHover(subCategoryContainer);
                            var $mask = $('#header.global-header .product-mask');
                            initHeight($(subCategoryContainer), $mask);
                            var time5 = null;
                            // pc端products二级导航埋点
                            cnAltLink('.product-nav-dd .fis-a.alt-link-lazy',true) //二级导航埋点
                            $.each($('.navbar-nav-list.clearfix .nav-left-item .box-ul .box-fis-li.clearfix.product-li .second-dl.clearfix .product-config .product-config-column .new-subcategory .new-title'), function (index, item) {
                              var href = $(this).attr('href')
                              var preModule = 'main_menu::products_sub_category::'
                              var lastHrefIndex = lastNode(href);
                              $(this).attr('data-at-module', preModule + lastHrefIndex);
                            })
                            // pc端products三级导航埋点
                              $.each($('.navbar-nav-list.clearfix .nav-left-item .box-ul .box-fis-li.clearfix.product-li .second-dl.clearfix .product-config .product-config-column .new-subcategory .new-content-wrap .new-content a'), function (index, item) {
                              var href = $(this).attr('href')
                              var preModule = 'main_menu::series::'
                              var lastHrefIndex = lastNode(href);
                              $(this).attr('data-at-module', preModule + lastHrefIndex);
                            })
                            lazyLink();
                            $('.boxli').hover(function(e){
                              e.stopPropagation()
                              var $this = $(this)
                              time5 = setTimeout(function(){
                                $this.siblings().removeClass('active')
                                $this.parent().siblings().removeClass('active')
                                $this.parent().parent().parent().parent().siblings().removeClass('active')
                                $this.parent().siblings().find('li').removeClass('active')
                                $this.addClass('active')
                              }, 150)


                            }, function(e) {
                              e.stopPropagation();
                              clearTimeout(time5);
                            });
                        });
                    }
                }, delayTime);
            }
        }
    };

    /**
     * ajax request child navigation
     */
    var getChildNavInfo = function (path, categoryName, ul, tmplName, callback,subCategoryName) {
        if (path && path.indexOf("products") > 0 && $.trim(ul.html()).length <= 0) {
            requestSubProductRequest(path, function (data) {
                if (data && data.result && data.result.length > 0) {
                    data.categoryName = categoryName;
                    data.path = path + ".html";
                    data.isIe = isIe();
                    data.subCategoryName = subCategoryName;
                    data.columns = ["1","2","3"];
                    data.openNewTab = $("#header.cn-header").attr("data-newTab-open")
                    ul.html(tmpl(tmplName, data));
                    if (callback) {
                        callback();
                    }
                } else {
                    if (callback) {
                        callback();
                    }
                }
                // for at sub category/tertiary category async at event
                var atTarge = ul.find("a.at-lazy");
                atModel.initAtNavigation(true, atTarge);
            });
        }
    };
    String.prototype.endsWith = String.prototype.endsWith || function (str) {
        var reg = new RegExp(str + "$");
        return reg.test(this);
    }
    /**
     * ajax request sub product
     */
    var requestSubProductRequest = function (path, callback, type) {
        var getCurrentPath = $("body").attr("data-page-path").replace(".html", "") || window.location.pathname.replace(".html", "");
        if (getCurrentPath.indexOf("/content/hikvision") < 0) {
            getCurrentPath = "/content/hikvision" + getCurrentPath;
        }
        if (getCurrentPath.endsWith("/")) {
            getCurrentPath = getCurrentPath.substring(0, getCurrentPath.length - 1);
        }
        $.ajax({
            type: "GET",
            url: getCurrentPath + ".getHeaderProduct.json",
            data: {
                "path": path,
                "type": type
            },
            dataType: "json",
            success: function (resp) {
                if (callback) {
                    callback(resp);
                }
            },
            error: function () {
                console.log("get SubProductInfo by path failed");
            }
        });
    };
    function defaultOpenMenu(){
      $('.nav-left-item').find('dd').removeClass('active')
      $('.nav-left-item').find('li').removeClass('active')
      $.each($('.nav-left-item'), function(index, item){
          var currentBoxUlLis = $(this).find('.box-ul').find('.box-fis-li')
          var firstLi = currentBoxUlLis[0]
          if(firstLi){
              $(firstLi).addClass('active')
              var firstDd = $(firstLi).find('.second-dl').find('dl').find('dd')[0]
              if(firstDd){
                  $(firstDd).addClass('active')
                  $(firstDd).find('li').removeClass('active')
                  $(firstDd).find('li:nth-of-type(1)').addClass('active')
              }
              if($(firstLi).parent().parent().parent().hasClass('.support-mask')) {
                var mHeight =  $(firstLi).parent().parent().parent('.support-mask').height()<484 ?  $(firstLi).parent().parent().parent('.support-mask').height() : 700
               //  $(firstLi).parent().parent('.support-line-box').css({height: mHeight+ 'px'})
              }
          }

          if($(this).hasClass('product-nav-item')) {
              $(this).find('.product-software-container .box-fis-li:first-child').addClass('active');
          }
      })
  }
  function isIe(){
    return window.ActiveXObject || "ActiveXObject" in window
  }
  function lazyLink(){
    $('.cn-header-a').on('click', function(e){
      var noClick = $(this).hasClass('not-click') 
      if(noClick) return;
      e.preventDefault()
      var ahref = $(this).data('href') || $(this).attr('href')
      // e.preventDefault有时不生效，为了防止a标签的跳转行为，这里手动去掉href属性。
      if ($(this).attr('href')) {
        $(this).removeAttr('href')
      }
   
      // 判断是否为本站地址是的话当前页打开，不是的话就新页面打开
      if((ahref.indexOf('http://') === -1 || ahref.indexOf('https://') === -1) && $(this).attr('target') != '_blank'){
        setTimeout(function() {
          window.open(ahref, '_self')
        }, 1000)
      } else {
        window.open(ahref, '_blank')
      }
    })
    $('.highlight-a').on('click', function(e){
      e.stopPropagation();
      var _href = $(this).attr('data-href')
      var _target = $("#header").attr('data-newtab-open')
      window.open(_href, _target)
    })
  }
  function ieTextOverllow(_self){
    if(isIe()){
        $.each($('.content-div .content-wrap'), function(index, element){
          if($(element).text().length>300){
            $(element).addClass('ie-content')
          }
        })
    }
  }

  //中文站导航埋点
  function cnAltLink(itemClass,lazy) {
    $(itemClass).unbind('click').on('click',function(e){
      e.preventDefault()
      var ahref = $(this).data('href') || $(this).attr('href')
      var dataTarget = $(this).attr('data-target') || $("#header").attr('data-newtab-open')
      if(ahref && (ahref.indexOf('http://') === -1 || ahref.indexOf('https://') === -1) && $(this).attr('target') != '_blank'){
        setTimeout(function() {
          window.open(ahref, dataTarget?dataTarget:'_self')
        }, 1000)
      } else if(ahref) {
        setTimeout(function() {
          window.open(ahref, dataTarget?dataTarget:'_blank')
        }, 1000)
      }
      var pageTitle=$("#header").attr('data-page-title')
      var analyticsStr=$(this).attr('data-analytics')
      HiAnalyticsCn.clickDown( lazy ? analyticsStr+pageTitle : analyticsStr)
    })
    
  }

    function displayCnLogin(isShow, userName) {
        if (isShow) {
            $(".cn-header .login-username-dropdown.ul-dropdown.login").show();
            $(".cn-header .login-username-dropdown.ul-dropdown.no-login").hide();
            $('.cn-header .nav-left-item.login-username').addClass('logined');
            $('.cn-header .header-nav .mobile-right-mini-menu').addClass('logined');
            $(".cn-header .mobile-nav-right-menu").find(".login-li.login").show();
            $(".cn-header .mobile-nav-right-menu").find(".login-li.no-login").hide();

            // $(".login-username-dropdown.ul-dropdown.login .user-profile").find("a").text(userName);
            // $(".login-username-dropdown.ul-dropdown.login .user-profile").find("a").attr("title", userName);
            // $(".mobile-nav-right-menu").find(".hik-username").text(userName);
        } else {
            $(".cn-header .login-username-dropdown.ul-dropdown.login").hide();
            $(".cn-header .login-username-dropdown.ul-dropdown.no-login").show();
            $('.cn-header .nav-left-item.login-username').removeClass('logined');
            $('.cn-header .header-nav .mobile-right-mini-menu').removeClass('logined');
            $(".cn-header .mobile-nav-right-menu").find(".login-li.login").hide();
            $(".cn-header .mobile-nav-right-menu").find(".login-li.no-login").show();
        }
    }

    function changeContactUsPopLink(isLogin, id) {
        var $changeItem = $(".customer-service .item-need-login");
        if (isLogin) {
            var path = $changeItem.attr("href");
            path = path + "&sessionId=" + id;
            $changeItem.attr("href", path)
        } else {
            $changeItem.attr("href", $(".new-header-login").attr("data-path"))
        }
    }

    $('.new-header-login').unbind("click").click(function (e) {
        e.stopPropagation();
        setLoginCookie("redirectUrl", window.location.href);
        window.open($(this).attr('data-path'), '_self')
    });

  $(document).ready(function () {
      initProductSubCategoryHover($(".product-nav-item"));
      defaultOpenMenu();
      ieTextOverllow();
      lazyLink();
      cnAltLink('.alt-link',false); 

      // cn站session认证
      var site = parseSiteFromUrl();
      if (site === "cn") {
          $('.cn-header .login-username.login').unbind("hover").hover(function (e) {
              e.stopPropagation();
              var loginClass = $(this).hasClass("logined") ? '.login' : '.no-login';
              $('.cn-header .login-username-dropdown.ul-dropdown' + loginClass).css({
                  'z-index': 999999,
                  'opacity': 1,
                  'top': '58px',
                  'display': 'block'
              })
          }, function (e) {
              e.stopPropagation();
              $('.cn-header .login-username-dropdown.ul-dropdown').css({
                  'z-index': -1,
                  'opacity': 1,
                  'top': '-600px',
                  'display': 'none'
              })
          });
          var hiknowId = storeManager.cookie.get("hiknow-id");
          if (!isNull(hiknowId)) {
              // sendCnLogin();
          } else {
              // displayCnLogin(false);
              changeContactUsPopLink(false);
          }
      }
  });

    function sendCnLogin() {
        var url = $("#header.cn-header").attr("data-path");
        $.ajax({
            type: "GET",
            url: url + ".ticket." + hiknowId + ".json",
            dataType: "json",
            contentType: "application/json",
            success: function (resultData) {
                if (resultData.data && resultData.data.hikId) {
                    if (window.location.search.indexOf("ticket=") > -1 && window.history) {
                        // 支持History API
                        window.history.replaceState(null, "", window.location.href.split("?")[0])
                    }
                    displayCnLogin(true);
                    changeContactUsPopLink(true, resultData.data.hikId);
                } else {
                    displayCnLogin(false);
                    changeContactUsPopLink(false);
                }
            }
        });
    }

  $('#header.global-header .product-nav-item').hover(function (e) {
    var $this = $(this);
    var liItem = $this.find(".box-fis-li.product-li.active");
    
    var $div = liItem.find('.second-dl');
    var $mask = $('#header.global-header .product-mask');
    initHeight($div, $mask);
  });
  $('#header.global-header .header-navbar').hover(function (e) {
    var $this = $(this);
    var productLiItem = $this.find(".nav-left-item.product-nav-item.active .box-fis-li.product-li.active");
    if(productLiItem) {
      var $div = productLiItem.find('.second-dl');
      var $mask = $('#header.global-header .product-mask');
      initHeight($div, $mask);
    }
    var supportLiItem = $this.find(".nav-left-item.support-nav-item.active .box-fis-li.active");
    if(supportLiItem) {
      var $div = supportLiItem.find('.second-dl');
      var $mask = $('#header.global-header .support-mask');
      initHeight($div, $mask);
    }
    var partnerLiItem = $this.find(".nav-left-item.partner-nav-item.active .box-fis-li.active");
    if(partnerLiItem) {
      var $div = partnerLiItem.find('.second-dl');
      var $mask = $('#header.global-header .about-mask');
      initPartner($div, $mask);
    }
  });
  var cl = 3;
  function initWaterfall($this,time) {
    if(!time)
      time = 300;
    setTimeout(function () {
      var items = $this.find(".waterfall-item");
      var heights = [];
      for (var i = 0; i < items.length; i++) {
        if (i < cl) {
          heights[i] = 0;
        } else {
          heights[i] = 0;
          var row = parseInt(i / cl);
          var column = i % cl;
          for (var temprow = 0; temprow < row; temprow++) {
            heights[i] += items[parseInt(temprow * cl + column)].offsetHeight;
          }
        }
      }
      var mxh = getMaxOfArray(heights);
      var mnh = $('#header.global-header .mask.product-mask .box-ul').height();
      var highlight = $this.find('.new-header-product-highlight-wrap');
      highlight ? highlight = highlight[0] : highlight = null;
      var $secondDL = $this.find('.second-dl');
      var top = parseInt($secondDL.css('top') ? $secondDL.css('top').split('px') : 0);
      var paddingTop = parseInt($this.closest('.mask').css('padding-top') ? $this.closest('.mask').css('padding-top').split('px') : 0);
      var definiteSpace = 6; //20(固定底部间距) - 14（二级间距/三级间间距/三四级间间距，目前均为14）
      var hhh = highlight ? highlight.offsetHeight : 0;
      
      if (mxh && !isNaN(mxh) && heights.indexOf(mxh) != -1) {
        mxh += items[heights.indexOf(mxh)].offsetHeight;

        if(mxh > mnh) {
          hhh += mxh + definiteSpace + top - paddingTop;
          $('#header.global-header .mask.product-mask').height(hhh);
          highlight ? highlight.style.top = mxh + definiteSpace + 'px' : '';
        } else {
          if(mnh - mxh >= 20) {
            hhh += mnh + definiteSpace - paddingTop;
            $('#header.global-header .mask.product-mask').height(hhh);
            highlight ? highlight.style.top = hhh - highlight.offsetHeight + 'px' : '';
          } else {
            hhh += mxh + definiteSpace + top - paddingTop;
            $('#header.global-header .mask.product-mask').height(hhh);
            highlight ? highlight.style.top = mxh + definiteSpace + 'px' : '';
          }
        }
      } else {
        hhh += mnh + definiteSpace - paddingTop;
        $('#header.global-header .mask.product-mask').height(hhh);
        highlight ? highlight.style.top = hhh - highlight.offsetHeight + 'px' : '';
        highlight ? highlight.style.visibility = 'visible' : '';
      }

      if ((items[0] && items[0].style.visibility != 'visible') ||
        (items[3] && (parseInt(items[3].style.top) < 50 || items[3].style.top == ''))) {
        for (var i = 0; i < items.length; i++) {
          var left = 0;
          if (i % cl == 0) {
            left = '0%';
          }
          if (i % cl == 1) {
            left = '33%';
          }
          if (i % cl == 2) {
            left = '66%';
          }
          items[i].style.top = heights[i] + 'px';
          items[i].style.visibility = 'visible';
          items[i].style.left = left;
        }
      }
      highlight ? highlight.style.visibility = 'visible' : '';
    }, time)
  }

  var dltime = 150;
  $('#header.global-header .support-nav-item').hover(function () {
    var $div = $(this).find('.box-fis-li.active .second-dl');
    var $mask = $('#header.global-header .support-mask');
    initHeight($div, $mask);
  });
function initHeight($div, $mask) {
    setTimeout(function () {
      var height = $div.height();
      var mnh = $mask.find('.box-ul').height();
      var highlight = $div.find('.new-header-product-highlight-wrap');
      var top = parseInt($div.css('top') ? $div.css('top').split('px') : 0);
      var paddingTop = parseInt($div.closest('.mask').css('padding-top') ? $div.closest('.mask').css('padding-top').split('px') : 0);
      var definiteSpace = 6; //20(固定底部间距) - 14（二级间距/三级间间距/三四级间间距，目前均为14）

      if(highlight.length > 0) {
        highlight = highlight[0];
        highlight.style.visibility = 'visible';
        if (height != null && height > mnh) {
          highlight.style.top = height + definiteSpace + 'px';
          height = height + highlight.offsetHeight + definiteSpace + top - paddingTop;
        } else {
          if (mnh - height - highlight.offsetHeight >= 20) {
            //height + 20(固定间距) - 30（上边距）
            height = mnh + definiteSpace - paddingTop;
            highlight.style.top = height + paddingTop - top - highlight.offsetHeight + 'px';
          } else {
            highlight.style.top = height + definiteSpace + 'px';
            height = height + highlight.offsetHeight + definiteSpace + top - paddingTop;
          }
        }
      } else {
        if (height != null && height > mnh) {
          //height + 20(固定间距) + top - 30（上边距）
          height = height + definiteSpace + top - paddingTop;
        } else {
          //height + 20(固定间距) - 30（上边距）
          height = mnh + definiteSpace - paddingTop;
        }
      }
      $mask.height(height);
    }, dltime)
  }
  function getMaxOfArray(numArray) {
    return Math.max.apply(null, numArray);
  }
  function getMaxOfArray(numArray) {
    return Math.max.apply(null, numArray);
  }
  $('#header.global-header .partner-nav-item').hover(function () {
    var $div = $(this).find('.box-fis-li.active .second-dl');
    var $mask = $('#header.global-header .about-mask');
    initPartner($div, $mask);
  })
  function initPartner($div, $mask){
    setTimeout(function () {
      var height = $div.height();
      var mnh = $mask.find('.box-ul').height();
      var top = parseInt($div.css('top') ? $div.css('top').split('px') : 0);
      var paddingTop = parseInt($div.closest('.mask').css('padding-top') ? $div.closest('.mask').css('padding-top').split('px') : 0);
      var definiteSpace = 6; //20(固定底部间距) - 14（二级间距/三级间间距/三四级间间距，目前均为14）

      if (height != null && height > mnh) {
        //height + 20(固定底部间距) + top - padding-top
        height = height + definiteSpace + top - paddingTop;
      } else {
        //height + 20(固定间距) - padding-top
        height = mnh + definiteSpace - paddingTop;
      }
      $mask.height(height);
    }, dltime - 100)
  }
});
/*
 * Summary.
 *  This code is responsible for driving header functionality
 *
 * Description.
 *  Header Js is responsible for :
 *  AutoSuggestions result
 *  Secondary Navigation functionality
 *  Hamburger click of header Navigations
 *  Hover effect on header
 *  Search button functionality on header
 *
 * Version.
 *  1.0
 */
;
var header = (function ($) {
  var header = {};
  header.checkLoginStatusForDownload = function (targetLink, target, child, type) {
    var _actionTarget = child ? $(child) : $(target);
    var checkLogin = isCN ? $(target).data('download-checklogin-cn') : $(target).data('download-checklogin');
    var hasForm = $(target).data('has-form');
    if (checkLogin) { 
      var loginId = isCN ? storeManager.cookie.get("hiknow-id") : getLoginCookie("ticket");
      if(!(loginId && loginId != "123")) {
          _actionTarget.attr("target", "_self");      
          if(type){
            loginUtil.popupLoginConfirmModal();
          } else {
            _actionTarget.unbind().on("click", function (e) {
              loginUtil.popupLoginConfirmModal();
            });
          }
          return "javascript:;";
      } else {
          _actionTarget.on("click", function (e) {
            if (_actionTarget.attr("target") == "_self") {
              window.location.href = targetLink;
            } else {
              window.open(targetLink);
            }
          });
          return targetLink;
      }
    } else {
      if (hasForm || targetLink == "#download-agreement") {
        return targetLink;
      } else {
        _actionTarget.on("click", function (e) {
          if (_actionTarget.attr("target") == "_self") {
            window.location.href = targetLink;
          } else {
            window.open(targetLink);
          }
        });
        return "javascript:;";
      }
    }
  };
  return header;
})($);
;
(function (document, $) {
  var initSecondaryNavClick = function () {
      if(!$('.global-header').length) return false
      $('.global-header .nav-left-item.lang').on('click', function(e){
          e.preventDefault();
          var $secondaryNavPosition = $(".navbar-nav-list.right li:first-child").offset().left;
          var hasNav = $(".global-header .header-rightBar").hasClass('on-secondary-nav')
         if(!hasNav){
          $("html,body").addClass("preventScroll");
          $(".secondary-nav-wrapper").css({
            "left": $secondaryNavPosition - 60 <=1188.81 ?$secondaryNavPosition -60: 1188.81,
            "display": 'block'
         });
         $('.global-header .header-rightBar').addClass("on-secondary-nav")
         } else {
          $("html,body").removeClass("preventScroll");
          $('.global-header .header-rightBar').removeClass("on-secondary-nav")
          $(".secondary-nav-wrapper").hide()
         }
      })
      $(document).on('click', function(){
          $('.global-header .header-rightBar').removeClass("on-secondary-nav")
          $(".secondary-nav-wrapper").hide()
      })
      $('.secondary-nav-wrapper').on('click', function(e){
          e.stopPropagation();
      })
     };
  var initSearchBtn = function(){
    $('.search-box, .search-icon').on('click',function(e){
      $('.header-rightBar').removeClass("on-secondary-nav");
      $(".secondary-nav-wrapper").hide();
    })
    $('#headerSerachInput').on('keydown', function(e){
      var searchWebsite = $(this).closest('form.search-form').attr('action');
      if(e.keyCode === 13){
        $(".loading-wrap").show()
        window.open(searchWebsite + '?q='  +  e.target.value, '_self')
      }
    })
    $('#headerSerachInput').on('click focus', function(e){
      e.stopPropagation();
      var $list = $(this).closest('.search-wrap').find('.search-categories-container');
      var val = $(this).val();
      
      if($('.global-header').length > 0 || $('.cn-header').length > 0) {
        $('body .layout').remove();
        $('body').append('<div class="layout"></div>');
        if(!val) {
          $list.addClass('active');
        }
      }
    })

    $('#headerSerachInput').on('input', debounce(function(e){
        e.stopPropagation();
            var $this = $(this);
            var value = e.target.value;
            showAssociate($this, value)
     }, 300));


    function showAssociate($this, value) {
      var $parent = $this.closest('.search-wrap');
      var $list = $parent.find('.search-categories-container');
      var $associateList = $parent.find('.associative-search-container');
      
      if(!value) {
        $list.addClass('active');
        $associateList.removeClass('active');
      } else {
        $list.removeClass('active');
      //  $associateList.empty();
        searchProvider.doSuggest({
          keyword: value,
          pageSize: 6,
          tags : parseSiteFromUrl(),
          highlight: "true",
          callback: function(data){
            $associateList.removeClass('active');
            if(data.length > 0) {
              $associateList.addClass('active');
              var html = '';
              data.forEach(function(item) {
                  html += '<div class="associative-search-item" data-value="' + item.value + '">' + (item.label ?? item.value) + '</div>';
              })
              $associateList.html(html)
             // $associateList.append(html);
              boundAssociateListClick();
            }
          }
        })
      }
    }
    $('.search-wrap img').on('touchstart', function(e){
      e.stopPropagation()
      var searchWebsite = $(this).parent().parent().parent().attr('action')
      $(".loading-wrap").show()
      window.open(searchWebsite+'?q='  +  $('#headerSerachInput').val(), '_self')
    })
  }
  var boundSearchListClick = function(){
    var $searchContainer = $('.search-categories-container');
    var $input = $('#headerSerachInput');
    $searchContainer.find('.search-category-item').on('click', function() {
      var value = $(this).html();
      $input.val(value);
      var searchWebsite = $input.closest('form.search-form').attr('action');
      $(".loading-wrap").show()
      window.open(searchWebsite + '?q='  +  value, '_self')
    })
  }

  var boundAssociateListClick = function(){
    var $searchContainer = $('.associative-search-container');
    var $input = $('#headerSerachInput');
    $searchContainer.find('.associative-search-item').on('click', function(e) {
      var value = $(this).data('value');
      $input.val(value);
      var searchWebsite = $input.closest('form.search-form').attr('action');
      atModel.doAtEvent('search::header_recommend::' + value, 'action', e);
      $(".loading-wrap").show();
      window.open(searchWebsite + '?q='  +  value, '_self');
    })
  }
  
  var initMobileMenu = function(){
    var $mobileTarget = $('.mobile-nav-right-menu li p')
    $mobileTarget.on('click', function(){
      console.log('dddlang')
      var hasDownClass = $(this).find('svg').hasClass('down-expand')
      if(hasDownClass){
        $(this).find('svg').removeClass('down-expand')
        $(this).parent().css({height: '56px'}).find('.right-menu-ul').hide()
      } else {
        $(this).find('svg').addClass('down-expand')
        if($(this).parent().find('.right-menu-ul').length){
          $(this).parent().css({height: 'auto'}).find('.right-menu-ul').show()
        } else {
          $(this).parent().find('.right-menu-ul').hide()
        }
      }
    })
    var $moblieMenu = $('.mobile-right-mini-menu')
    $moblieMenu.on('click', function(){
     var isHidden =  $('.mobile-nav-right-menu').is(":hidden")
     if(isHidden){
      $('.mobile-nav-right-menu').show()
      $('html').addClass('overflow-prevent')
      $(this).addClass('show-close');
      $('#header.cn-header .header-wrap').find('.nav-cha').hide()
      $('#header.cn-header .header-wrap').find('.mobile-nav-left-menu.mobile-nav').hide()
      $('#header.cn-header .header-wrap').find('.navigation-span-warp').show()
     } else {
      $('.mobile-nav-right-menu').hide()
      $(this).removeClass('show-close')
      $('html').removeClass('overflow-prevent')
     }
    })
    $('#header.cn-header .mobile-nav-right-menu .user-info ,#header.cn-header .login-username-dropdown .user-info').on('click',function(){
      var ssoUrl=$(this).data('ssourl')
      var href=$(this).data('href')
      if(ssoUrl){
        ssoUrl=ssoUrl.split('/');
        $(this).attr('data-href','http://'+ssoUrl[2]+href);
        window.open($(this).attr('data-href'),'_blank')
      }
    })
    $("#header.cn-header .mobile-nav-right-menu.mobile-nav").on("touchmove",function(event){
      event.preventDefault();
      });
  }
 function removeLoginCookie (name) {
    var oDate = new Date();
    oDate.setDate(new Date().getDate() - 1);
     var domain = storeManager.hikvision_domain;
     if (window.location.hostname.indexOf(storeManager.hikvision_domain) < 0) {
         domain =  window.location.hostname;
     }
     document.cookie = name + "=;expires=" + oDate + ";path=/;domain=" + domain;
}
  function removeAllLoginCookie (){
    removeLoginCookie("ticket");
    removeLoginCookie("redirectUrl");
    removeLoginCookie("HIKID");
    removeLoginCookie("HIKUSERID");
    removeLoginCookie("HIKUSERNAME");
    removeLoginCookie("HIKEMAIL");
    removeLoginCookie("HIKROLE");
    removeLoginCookie("SourceSystem");
    removeLoginCookie("hik-login-user");
}
//--new solution menu start--//
    function defaultGlobalSolutionMenu() {
        if(!$('.global-header').length) return false;
        var $topicList =  $('.global-header .nav-left-item .solution-topic-list .item');
        var $subList =  $('.global-header .nav-left-item .solution-sub-list .item');
        $topicList.removeClass('activated');
        $subList.removeClass('activated');
        $topicList.eq(0).addClass('activated');
        $subList.eq(0).addClass('activated');
    }

    function searchOptionListScroll($list, $option) {
        var lt = $list.offset().top;
        var lh = $list.height();
        var ot = $option.offset().top;
        var oh = $option.outerHeight();
        var bt = $list.get(0).scrollTop;

        if(ot < lt ) {
            $list.get(0).scrollTop = bt - oh;
        } else if ((ot + oh)  > (lt + lh)) {
            $list.get(0).scrollTop = bt + oh;
        }
    }

    function updateSearchOptionStatus(type, $list, $activeOption, $searchInput) {
        $activeOption.removeClass('activated');
        var $options = $list.find('.option');
        if (type === 'prev' && $activeOption.index() !== 0) {
            $activeOption.prev().addClass('activated');
            searchOptionListScroll($list, $activeOption.prev());
        } else if (type === 'next' && $activeOption.index() !== $options.length) {
            $activeOption.next().addClass('activated');
            searchOptionListScroll($list, $activeOption.next());
        }

        $searchInput.val($list.find('.option.activated').text());
    }

    function renderSolutionSuggest(keyword) {
        var $list = $('.global-header .solution-nav-item .search-options');
        $list.empty();
        $list.removeClass('activated');
        searchProvider.doSearch({
            keyword: keyword,
            subcategory: 'Solutions',
            callback: function (data) {
                if (data.result && data.result.length) {
                    data.result.forEach(function(value) {
                        var textHtml = value["title"].replace(keyword,'<span class="key-word">'+ keyword + '</span>') ;
                        var html =  '<li class="option" ><a class="link" data-at-module="main_menu::solution_search::'+ value["title"] +'" href="' + value["url"] + '" target="blank">'+ textHtml + '<span class="a-action-btn"></span></a></li>';
                        $('.global-header .solution-nav-item .search-options').append(html);
                    });
                    $list.addClass('activated');
                }else {
                    $list.removeClass('activated');
                }
            },
            error: function() {
                $list.removeClass('activated');
            }
        });
    }

    function bindSolutionRelatedEvent() {
        if(!$('.global-header').length) return false;
        $('.global-header .nav-left-item.solution-nav-item').on('mouseenter', function() {
            defaultGlobalSolutionMenu();
        });

        var timer0;
        $('.global-header .nav-left-item .solution-topic-list .item').hover(function(){
            var $this = $(this);
            timer0 = setTimeout(function() {
                var index = $this.index();
                var $subItem = $this.closest('.list-box').find('.detail-list .item').eq(index);
                $this.addClass('activated');
                $this.siblings().removeClass('activated');
                $subItem.addClass('activated');
                $subItem.siblings().removeClass('activated');
                $this.closest('.list-box');
                // $('.global-header .solution-nav-item .solution-search').trigger('blur');
            },150);
        }, function(){
            clearTimeout(timer0);
        });

        $('.global-header .mobile-bottom-nav .solution-items .second-nav-title').on('click', function() {
            var $outerBox = $(this).closest('.clearfix');
            $outerBox.find('img').toggleClass('down-expand');
            $outerBox.find('.third-nav-box').toggleClass('expand');
        });

        // $('.global-header .solution-nav-item .solution-search').on('blur', function() {
        //     $(this).val('');
        //     $('.global-header .solution-nav-item .search-options').removeClass('activated');
        // });

        // $('.global-header .solution-nav-item .solution-search').on('keyup', function(e) {
        //     var $list = $('.global-header .solution-nav-item .search-options');
        //     var $options = $list.find('.option');
        //     var $activeOption = $list.find('.option.activated');
        //     var $searchInput = $(this);
        //     if (!$list.hasClass('activated')) return;
        //     if (e.keyCode === 13 && $activeOption.length) { //enter
        //           $activeOption.find('.link .a-action-btn').trigger('click');
        //     }

        //     if (e.keyCode === 38 ) { //top arrow
        //         if (!$activeOption.length || $activeOption.index() === 0) return;
        //         updateSearchOptionStatus("prev", $list, $activeOption, $searchInput);
        //     }

        //     if (e.keyCode === 40 ) { //down arrow
        //         if ($activeOption.length) {
        //              if($activeOption.index() === $options.length - 1) return;
        //              updateSearchOptionStatus("next", $list, $activeOption, $searchInput);
        //         } else {
        //              $options.eq(0).addClass('activated');
        //              $searchInput.val($list.find('.option.activated').text());
        //         }
        //     }
        // });


        // $('.global-header .solution-nav-item .search-options').on('click', '.option .link', function(e) {
        //      var module = $(this).attr('data-at-module') + atModel.atSpliter + window.location.href;
        //      atModel.doAtEvent(module, 'navigation', e);
        // });

        // var inputTimer;
        // $('.global-header .solution-nav-item .solution-search').on('input propertychange', function() {
        //     if (inputTimer) {
        //         clearTimeout(inputTimer);
        //     }
        //     var keyword = $(this).val();
        //     inputTimer = setTimeout(function() {
        //         renderSolutionSuggest(keyword);
        //     }, 300);
        // });

        $('.global-header .solution-nav-item').on('mousedown','.option .link', function() {
            $(this).find('.a-action-btn').trigger('click');
        });
    }

    function initSolutionMenu() {
        bindSolutionRelatedEvent();
    }
//--new solution menu end--//
//--old solution menu end--//
var initDefaultSolutionMore = function(){
  $('.solution-nav-item.old-solution').hover(function(){
    var childDDLens = $($(this).find('.box-ul').find('li.solution-li')[0]).find('dl dd').length
    if(childDDLens>=8){
      $($(this).find('.box-ul').find('li.solution-li')[0]).find('.more').show()
      $($(this).find('.box-ul').find('li.solution-li')[0]).find('.solution-top-more').show()
    }
  })
  $('.old-solution .solution-li').hover(function(){
     var ddLens = $(this).find('.second-dl').find('dd').length
     if(ddLens>8){
      $(this).find('.more').show()
     } else {
      $(this).find('.more').hide()
     }
  })
}
//--old solution menu end--//
function checkLoginStatus () {
  var userId = $.cookie("HIKUSERNAME");
  var userName = "";
  try {
    // userName = atob(userId);
    userName = decodeURIComponent(escape(window.atob(userId)))
  } catch (error) {
    console.log("Login Error:" + error);
  }
  var ticket = $.cookie("ticket")
  if (ticket&&userName&&ticket!='123') {
    $(".global-header .login-username-dropdown.ul-dropdown.login").show();
    $(".global-header .login-username-dropdown.ul-dropdown.no-login").hide();
    $(".global-header .login-username-dropdown.ul-dropdown.login .user-profile").find("a").text(userName);
    $(".global-header .login-username-dropdown.ul-dropdown.login .user-profile").find("a").attr("title", userName);
    $('.global-header .nav-left-item.login-username').addClass('logined')
    $('svg.icon.svg-icon.login-svg use').attr('xlink:href','#icon-dengluchenggong1')
    $(".global-header .mobile-nav-right-menu").find(".login-li.no-login").hide()
    $(".global-header .mobile-nav-right-menu").find(".hik-username").text(userName)
  } else {
    $(".global-header .login-username-dropdown.ul-dropdown.login").hide();
    $(".global-header .login-username-dropdown.ul-dropdown.no-login").show();
    $(".global-header .mobile-nav-right-menu").find(".login-li.login").hide()
    $(".global-header .mobile-nav-right-menu").find(".login-li.no-login").show()
    $('.global-header .nav-left-item.login-username').removeClass('logined')
    $('svg.icon.svg-icon.login-svg use').attr('xlink:href', '#icon-denglu')
  }
};

function stopAPropagation() {
  $('#header.global-header .mobile-nav .title .first-nav-a').on('click', function(e) {
    e.stopPropagation();
  })
}

    $(document).ready(function () {
        initSecondaryNavClick()
        initSearchBtn()
        boundSearchListClick();
        initMobileMenu();
        initSolutionMenu();
        initDefaultSolutionMore();
        checkLoginStatus();
        $('.link-logout').on('click', function(){
          removeAllLoginCookie();
          window.open($(this).data('href'), '_self')
        })
        $('.secondary-nav-content-wrapper').hover(function(e){
          var $ulDropdown = $('.login-username-dropdown.ul-dropdown')
          $ulDropdown.css({
            'top': '-600px'
          })
        }, function(){
          var $ulDropdown = $('.login-username-dropdown.ul-dropdown')
          $ulDropdown.css({
            'top': '58px',
           // 'z-index': '9999'
          })
        })
        $('.global-header .login-username.login .login-btn').click(function () {
          var hasHikId = $.cookie("HIKID")
          if(!hasHikId) {
            window.location.href = $('.global-header .login-btn.new-login').attr('data-login-url');
          }
        })
        $('.global-header .login-username.login').hover(function () {
          var hasHikId = $.cookie("HIKID")
          var loginClass = hasHikId ? '.login' : '.no-login'
          if (hasHikId) {
            $('.global-header .login-username-dropdown.ul-dropdown' + loginClass).css({
              'z-index': 999,
              'opacity': 1,
              'top': '58px',
              'display': 'block'
            })
          } else {
            var tipPd = 30;
            if($(document).width() < 1066) {
              tipPd = 20;
            }
            $('.global-header .login-tip').css({
              'display': 'block',
              'left': tipPd - $('.global-header .login-tip').width()/2 + 'px'
            })
          }
        }, function () {
          $('.global-header .login-tip').css({
            'display': 'none'
          })
          $('.global-header .login-username-dropdown.ul-dropdown').css({
            'z-index': -1,
            'opacity': 1,
            'top': '-600px',
            'display': 'none'
          })
        })
        // Mobile
        initMobileLogin();
        initMobileLan();
        initMobileSearch();
        function initMobileLogin(){
          $('#header.global-header .navigation .navigation-span-warp').off('click').on('click', function(){
            var mld = $("#header.global-header .mobile-new-login-dropdown");
              if(mld.css('display') == "block") {
                $("#header.global-header .mobile-new-login-icon .logined").click();
              }
          });
          var $this = $("#header.global-header .mobile-new-login-icon");
          var hasHikId = $.cookie("HIKID")
          if(hasHikId) {
            $this.find(".not-login").toggle();
            $this.find(".logined").toggle();
            $this.find(".logined").click(function(){
              $('#header.global-header .header-wrap .header-nav .mobile-nav').addClass('overflow');
              $(".mobile-new-login-dropdown").toggle();
              $("#header.global-header .header-wrap .mobile-new-login-mask").toggle();
            })
            $('#header.global-header .mobile-new-login-dropdown ul li.back-to-first').on('click', function() {
              $(".mobile-new-login-dropdown").toggle();
              $("#header.global-header .header-wrap .mobile-new-login-mask").toggle();
              $('#header.global-header .header-wrap .header-nav .mobile-nav').removeClass('overflow');
            })
          }
        }
        function initMobileLan() {
          var $this = $("#header.global-header .mobile-new-country");
          $this.find(".country-wrap, .country-back-content").click(function(){
            $this.find(".select-country").toggle();
            $this.find(".country-wrap").toggle();
          })
          $this.find(".country-title").click(function(){
            $(this).siblings(".country-details").toggle();
            $(this).find("svg").toggleClass('flip-icon');
          })
          var $self = $this;
          $("#header.global-header .navigation .nav-cha").off('click').click(function(){
            $self.find(".select-country").hide();
            $self.find(".country-wrap").show();
            $('html').addClass('overflow-prevent')
          })
          $('#header.global-header .back-and-login-container .back-icon').click(function() {
            $self.find(".select-country").hide();
            $self.find(".country-wrap").show();
            $(".mobile-nav").hide()
            $(this).parent().parent().hide();
            $('.header-nav-right-container').find('.navigation').find('.navigation-span-warp').show();
            $('.header-nav-right-container').find('.navigation').find('.nav-cha').hide();
           // $('.navigation').click();
           $("html").removeClass("overflow-prevent")
           $("body").removeClass("overflow-prevent")
          })
          $this.find('.country-back .back-icon').on('click', function() {
            $self.find(".select-country").hide();
            $self.find(".country-wrap").show();
            $('.navigation').click();
          })
        }
        function initMobileSearch(){
          var $this = $("#header.global-header .mobile-new-search");
          $('#header.global-header .header-mobile-icon').click(function() {
            $('html, body').addClass('overflow-prevent');
            $this.addClass('active');
          })
          $this.find('.search-category-item').click(function() {
            var value = $(this).html();
            $('#headerSerachInputMobile').val(value);
            var searchWebsite = $(this).attr('action');
            $(".loading-wrap").show()
            window.open(searchWebsite + '?q='  +  e.target.value, '_self');
          })
          $this.find(".close-search").click(function(){
            $this.find("#headerSerachInputMobile").val("");
            $this.removeClass('active');
            $('html, body').removeClass('overflow-prevent');
          })
        }
        $('#header.global-header .mobile-four-view-all').click(function(){
          var $this = $(this);
          $this.toggleClass("flip-icon");
          if($.trim($this.find('.expand-text').text()) == Granite.I18n.get('Expand')) {
            $this.find('.expand-text').text(Granite.I18n.get('Collapse'));
          } else if($.trim($this.find('.expand-text').text()) == Granite.I18n.get('Collapse')) {
            $this.find('.expand-text').text(Granite.I18n.get('Expand'));
          }
          $this.parent().find('.mobile-four-item.hide').toggle();
        }) 
        $('#header.global-header #headerSerachInputMobile').on('keydown', function(e){
          var searchWebsite = $(this).attr('action')
          if(e.keyCode === 13){
            $(".loading-wrap").show()
            window.open(searchWebsite + '?q='  +  e.target.value, '_self')
          }
        })
        $('#header.global-header #headerSerachInputMobile').on('input', function(e){
          var $this = $(this);
          var value = e.target.value;
          debounce(showMobileAssociate($this, value), 300)
        });

        function showMobileAssociate($this, value) {
          var $parent = $this.closest('.search-categories-container');
          var $list = $parent.find('.search-categories-wrapper');
          var $associateList = $parent.find('.associative-search-container');
          
          if(!value) {
            $list.removeClass('inactive');
            $associateList.removeClass('active');
          } else {
            $list.addClass('inactive');
          //  $associateList.empty();
            searchProvider.doSuggest({
              keyword: value,
              pageSize: 6,
              tags : parseSiteFromUrl(),
              highlight: "true",
              callback: function(data){
                if(data.length > 0) {
                  $associateList.addClass('active');
                  var html = '';
                  data.forEach(function(item) {
                      html += '<div class="associative-search-item" data-value="' + item.value + '">' + (item.label ?? item.value) + '</div>';
                  })
                  $associateList.html(html)
                  boundMobileAssociateListClick();
                }
              }
            })
          }
        }

        var boundMobileAssociateListClick = function(){
          var $searchContainer = $('.associative-search-container');
          var $input = $('#headerSerachInputMobile');
          $searchContainer.find('.associative-search-item').on('click', function(e) {
            var value = $(this).data('value');
            $input.val(value);
            var searchWebsite = $input.attr('action');
            atModel.doAtEvent('search::header_recommend::' + value, 'action', e);
            $(".loading-wrap").show();
            window.open(searchWebsite + '?q='  +  value, '_self');
          })
        }

        stopAPropagation();
        var winHeight = $(window).height();
        $(window).resize(function () {
          var thisHeight = $(this).height();
          if (winHeight - thisHeight > 140) {
            $('#header.global-header .mobile-new-country').hide();
          } else {
            $('#header.global-header .mobile-new-country').show();
          }
        })
    });
})(document, $);
$(document).ready(function () {
  if(window.localStorage.getItem("manageButton")){
    $(".gdpr-wrapper").css("display", "none");
  }
  $(".gdpr-wrapper .gdpr-button-manage").on('click', function () {
    var link = $(this).data('href');
    window.localStorage.setItem("manageButton", "true")
    $(".gdpr-wrapper").css("display", "none");
    window.location.href = link;
  });
  $(".gdpr-wrapper .gdpr-button-accept").on('click', function () {
    storeManager.cookie.set({
      name: storeManager.STORE_NAMES.cookieDisclaimer,
      value: 0,
      path: '/',
      expirationDays: 180
    }, true);
    $(".gdpr-wrapper").css("display", "none");

      // when click accept then set all cookie category to check
      var categories = cookieEvents.getCategories();
      if (categories) {
        categories.forEach(function (value, index) {
          if (value.necessary.toString().toLowerCase() === "false") {
            value.alwaysOn = "true";
          }
        });
      }
      storeManager.cookieDisclaimerUtil.setCategories(categories);
  });
  $(".gdpr-wrapper .gdpr-button-reject").on('click', function () {
      storeManager.cookie.set({
        name: storeManager.STORE_NAMES.cookieDisclaimer,
        value: 1,
        path: '/',
        expirationDays: 180
      }, true);
      $(".gdpr-wrapper").css("display", "none");

      var categories = cookieEvents.getCategories();
      if (categories) {
        categories.forEach(function (value, index) {
          if (value.necessary.toString().toLowerCase() === "false") {
            value.alwaysOn = false;
            storeManager.cookieDisclaimerUtil.cleanCookies(value.cookieId);
          }
        });
      }
      storeManager.cookieDisclaimerUtil.setCategories(categories);
    });
});

(function (document, $) {

  $(document).ready(function () {
    function hideNotice() {
      $(".notice-wrapper").modal('hide');
    }

    function autoOpen() {
      var interval = $(".notice-wrapper").data('interval');
      if (interval) {
        setTimeout(function () {
          $('.notice-wrapper .notice-container .notice-info-wrapper .lazy').lazyload();
          $(".notice-wrapper.modal").modal('show');
          $(".modal-backdrop").css('z-index', '11001');
        }, interval * 1000);
      } else {
        $('.notice-wrapper .notice-container .notice-info-wrapper .lazy').lazyload();
        $(".notice-wrapper.modal").modal('show');
        $(".modal-backdrop").css('z-index', '11001');
      }
    }

    function checkCookie(cname) {
      var noticeDisclaimer = storeManager.cookie.get(cname);
      if (noticeDisclaimer) {
        $(".notice-wrapper").modal('hide');
      } else {
        autoOpen();
      }
    }

    $('.notice-wrapper').off('hidden.bs.modal').on('hidden.bs.modal', function () {
      var isSession = true;
      var config = {
        name: storeManager.STORE_NAMES.noticeDisclaimer,
        value: new Date().getTime(),
        path: '/'
      };

      if ($('.notice-wrapper .notice-container .notice-footer-wrapper .notice-cancel').is(':checked')) {
        config.expirationDays = 365;
        isSession = false;
      }
      storeManager.cookie.set(config, true, isSession);
    });

    $('.notice-wrapper .notice-container .notice-footer-wrapper .notice-cancel').on('click', function () {
      hideNotice();
    });
    $('.notice-wrapper .notice-container .notice-footer-wrapper .checkbox-info').on('click', function () {
      hideNotice();
    });

    checkCookie(storeManager.STORE_NAMES.noticeDisclaimer);
  });

})(document, $);

;
(function (document, $) {
    $(document).ready(function () {
        var $expandElement = $(".footer-navigation-block:not(.contact-group)");
        $expandElement.on("click", function () {
            //$('.footer-navigation-block').removeClass('active')
            $(this).siblings().removeClass("active");
            $(this).toggleClass("active");
        });
        var $headQuarterDropdown = $(
            ".footer-body.global-footer .contact-group__items--dropdown-styled-select"
        );
        $headQuarterDropdown.on("click", function (e) {
            e.stopPropagation();
            $(this).toggleClass("active");
        });
        $.each($(".footer-body-content .icon-contact-us a"), function () {
            var socailIcon = lastNode($(this).attr("data-socail-icon"));
            $(this).attr("data-at-module", "footer::social::" + socailIcon);
        });
        $expandElement.find("a").on("click", function (e) {
            var title =
                "footer::" +
                lastNode($(this).attr("href")) +
                "::" +
                window.location.href;
            atModel.doAtEvent(title, "navigation", e);
        });
        $(".footer-navigation-block.contact-group")
            .find("a")
            .on("click", function (e) {
                var title =
                    "footer::button::" +
                    lastNode($(this).attr("href")) +
                    "::" +
                    window.location.href;
                atModel.doAtEvent(title, "navigation", e);
            });
        $.each(
            $(".footer-navigation-block a , .icon-contact-us a"),
            function () {
                var href = $(this).attr("href");
                if (href && startsWith(href, "http")) {
                    $(this).attr("target", "_blank");
                } else {
                    $(this).attr("target", "_self");
                }
            }
        );
    });
    var startsWith = function (text, prefix) {
        if (!!text && !!prefix) {
            return false;
        }
        return text.slice(0, prefix.length) == prefix;
    };
    if($('body').hasClass('hilook-page')){
        $('.hilook-footer-icon').show()
    }else {
        $('.default-footer-icon').show()
    }
})(document, $);

var subHeader = (function ($) {
  var subHeader = {};
  var sticky;
  var isHilookSite = $('body').hasClass('hilook-page');
  var isEnPdp= $('body').hasClass('product-detail-page') && !isCN;
  subHeader.initDropdownClick = function () {
    var $subHeaderContainer = $('.cmp-subheader-container');
    // $(".header2-container-wrapper .header-nav-wrapper .triangle-indicator").click(function (e) {
    //   if ($(this).siblings(".dropdown-1").length > 0) {
    //     $(this).siblings(".dropdown-1").toggle();
    //     $(this).siblings(".fa-caret-right").toggleClass("dropdown-open-caret");
    //     $(this).siblings('.link-drp').toggleClass("dropdown-open");
    //     if ($(this).siblings('.link-drp').hasClass('dropdown-open')) {
    //       $('.header-nav-dw').removeClass('header-nav-dw-after').find(".link-drp").not(
    //         $(this).siblings('.link-drp')).siblings(".dropdown-1").hide();
    //       $('.header-nav-dw').find(".link-drp").not($(this).siblings('.link-drp')).removeClass(
    //         'dropdown-open');
    //       $(this).closest('.header-nav-dw').addClass('header-nav-dw-after');
    //     } else {
    //       $(this).closest('.header-nav-dw').removeClass('header-nav-dw-after');
    //     }
    //   }
    //   e.stopPropagation();
    // });
   $(".header-nav-dw:not(':nth-of-type(1)')").hover(function(){
      var w1310Left = $(".cmp-subheader-wrap").find(".wrap1310").offset().left
      if($(this).hasClass("subheader-footer-dw")){
        if($("body").hasClass("rtl")){
          $(this).find(".dropdown-1").show().css({
            right:  0 + 'px'
          });
        } else {
          $(this).find(".dropdown-1").show().css({
            left:(parseInt($(this).offset().left) - w1310Left) - 60 + 'px'
          });
        }
      } else {
        $(this).find(".dropdown-1").show()
      }
      $(this).find(".fa-caret-right").addClass("dropdown-open-caret");
      $(this).find('.link-drp').addClass("dropdown-open");
      $(this).addClass('header-nav-dw-after');
   }, function(){
    var _this = this
    $(_this).find(".dropdown-1").hide();
    $(_this).find(".fa-caret-right").removeClass("dropdown-open-caret");
    $(_this).find('.link-drp').removeClass("dropdown-open");
    $(_this).removeClass('header-nav-dw-after');
   })
   $.each($(".dropdown-1"), function(){
    var _this = this
    var newArr = newMapLiArr($(this).find(".dropdown-list"))
    var maxWidth = getMaxValue(newArr, 'width')
    if(maxWidth>=140){
      $(this).find(".dropdow-box").css({
        width:maxWidth + 30 >= 268?228:maxWidth + 20
      })
    }
   })
  };
  function newMapLiArr(dropdowList){
    return Array.prototype.slice.call(dropdowList).map(function(item){
      var textWidth = getwidth($(item).find("a").text(), 12,0)
      item.width = textWidth
      return item
    })
  }
  function getMaxValue(arr, item) {
    if(arr.length){
      var maxValue =arr[0][item] // 初始化为数组的第一个对象的对应项的值
  
      for (var i = 1; i < arr.length; i++) { // 从数组的第二个对象开始比较
        var currentValue = arr[i][item]; 
        if (currentValue > maxValue) {
          maxValue = currentValue;
        }
      }
    
      return maxValue;
    } else {
      return 0
    }
  }
  function getwidth(text,font_size,letter_space){
    var cn = text.match(/[\u2E80-\uFE4F\u3002\uff1b\uff0c\uff1a\u201c\u201d\uff08\uff09\u3001\uff1f\u300a\u300b]/ig);
    var cn_count = cn?cn.length:0
    var other_count = text.length - cn_count;
    return (cn_count + other_count / 2)*font_size + (letter_space||0)*text.length
  }

  var stickyHeader = function () {

    var header = document.getElementById("cmp-subheader-selector");
    if (header) {
      var $burgerMenu = $(".burgur-menu-icon");
      var headerHeight = $('.header-wrapper').outerHeight();
      $burgerMenu.click(function (e) {
        $('body').toggleClass('topPadding');
      });

      sticky = header.offsetTop;
      window.onscroll = function () {
        if ($(".cmp-subheader-container").hasClass("cmp-subheader-container-new")) {
          $(".product-spotlight-header-wrapper")
            .each(
              function (key, val) {
                if (val.attributes["data-anchortext"]) {
                  var text = val.attributes["data-anchortext"].value;
                  var elementOffset = $(
                    ".product-spotlight-header-wrapper[data-anchortext='" + text.replace("'", "\\'") + "']")
                    .offset().top - 100;
                  var subHeaderOffset = $(".cmp-subheader-container .cmp-subheader-wrap")
                    .offset().top;
                  $('.subnav-bar .menu-item span').each(
                    function (key, val) {
                      if (text == val.innerText) {
                        if (subHeaderOffset >= elementOffset) {
                          $('.subnav-bar .menu-item').css('border-bottom',
                            '4px solid transparent');
                          if (!key == 0) {
                            $('.subnav-bar .menu-item:first-child').removeClass(
                              'bottomLine');
                          }
                          val.parentElement.style.borderBottom = isHilookSite ? "4px solid #00A7E2" : "4px solid #D7000F";
                        }
                      }
                    })
                }
              });
        } else {
          $('.subnav-bar .menu-item').css('border-bottom', '4px solid transparent');
        }
        setMargin(header);
      };

    } else {
      // remove paddingTop 20191022, bitter
      // var headerHeight = $('.header-wrapper').outerHeight();
      // $('body').css({
      //     'paddingTop' : headerHeight
      // });
      $('#header-wrapper-selector').addClass('header-wrapper-new');
    }

  }

  function setMargin(header) {
    var headerHeight = $('.header-wrapper').outerHeight();
    if (window.pageYOffset > sticky && !hideForProductSelector() && !$('.cmp-subheader-footer').length) {
       header.classList.add("cmp-subheader-container-new");
      $('#cmp-subheader-selector').siblings().css('margin-top', headerHeight);
    } else {
      header.classList.remove("cmp-subheader-container-new");
      $('#cmp-subheader-selector').siblings().css('margin-top', 0);
    }
  } 
  
  
  function hideForProductSelector() {
    if ($(document).width() < 992) {
      return false
    }
    var $prodSelector = $('.search-list-comp');
    if (!$prodSelector.length) { return false; }

    var $header = $('.cmp-subheader-container.header-container2');
    var headerHeight = $header.outerHeight();

    var selectorTop = $prodSelector[0].getBoundingClientRect().top;
    if (selectorTop < headerHeight && Math.abs(selectorTop) < $prodSelector.height()) {
      return true;
    }
    return false;
  }
  function mobileNav () {
    var navList = $('.cmp-subheader-wrap .logo-title-search-wrap .header2-container-wrapper .header-nav-dw')
    var navMobile = $('.cmp-subheader-wrap .back-button')
    if(navList.eq('-2').length){
      navMobile.attr('href',navList.eq('-2').find('.link-drp').attr('href'))
    }else{
      navMobile.hide()
    }
  }

  function headerHeight(){
    if( $('[data-isAnchor="true"]').length==0 && !isEnPdp){
      if(getCurrentBreakPoint() == 'DESKTOP') {
        $('.cmp-subheader-container.header-container2').css('height','56px')
      } else {
      //  $('.cmp-subheader-container.header-container2').css('height','46px')
      }
    }else{
      $('.cmp-subheader-container.header-container2').css('height','auto')
    }
    if($(".cmp-subheader-footer").length && getCurrentBreakPoint() == 'DESKTOP'){
      var footerHeight = $("footer.footer-body").height() - 7
      $("footer.footer-body").css({
        paddingTop: '50px'
      })
      $(".cmp-subheader-footer").css({
        bottom: footerHeight + 'px'
      })
    }
  }
    function onlyTitle(){
      var menuNum=$('.subnav-bar .menu-item').length
      if(menuNum==0 ){
        if(getCurrentBreakPoint() == 'DESKTOP') {
          $('.logo-title-wrap .title').css('padding-top','10px')
        }
        $('.logo-title-wrap').addClass('mob-onlytitle')
        $('.header-2-container .header-nav-ul').css('padding-top','3px')
        $('.header2-container-wrapper').css('z-index','5')
      }else{
        $('.header2-container-wrapper').css('z-index','0')

      }
    }
    function generateLinks () {
      var $subHeaderContainer = $('.cmp-subheader-container');
      var $anchorElements = $('[data-isAnchor="true"]');
      var $anchorLinksContainer = $subHeaderContainer.find(".subnav-bar");
      $anchorLinksContainer.empty();
      $anchorElements.each(function () {
        var value = $(this).attr("data-anchorText");
        var li = $('<li class="menu-item at-action" data-at-module="header2::' + value + '" />');
        var span = $('<span/>');
        span.text(value);
       span.appendTo(li);
       li.appendTo($anchorLinksContainer);
      });
    };
    function initLinkClick () {
      var $subHeaderContainer = $('.cmp-subheader-container');
      if (!$subHeaderContainer || $subHeaderContainer.length == 0) {
        return;
      }
      $subHeaderContainer.find('.menu-item').on('click', function (e) {
        if ($(this)[0].innerText == $('.subnav-bar .menu-item:first-child span').text()) {
          $('.subnav-bar .menu-item:first-child').addClass('bottomLine');
        } else {
          $('.subnav-bar .menu-item:first-child').removeClass('bottomLine');
        }
        var linkText = $(this).find('span').text();
        var $selectedAnchorElement = $('[data-anchorText="' + linkText + '"]');
        var headerHeight = $('.header-wrapper').outerHeight();
        var subHeaderHeight = $('.cmp-subheader-container').outerHeight();
        // $subHeaderContainer.addClass('cmp-subheader-container-new');
        setTimeout(function () {
          $('html,body').animate({
            scrollTop: $selectedAnchorElement.parent().offset().top - (subHeaderHeight)
          }, 400);
        }, 100);
        e.stopPropagation();
        return false;
  
      });
    }
  subHeader.init = function () {
    $(document).ready(function () {
      headerHeight()
      subHeader.initDropdownClick();
      if(isEnPdp){
        $('#cmp-subheader-selector').addClass('product-detail-header');
      }else{
        mobileNav()
        stickyHeader();
        onlyTitle()
        generateLinks();
        initLinkClick();
      }
      $(window).on('resize',function(){
        headerHeight()
      });
    });

  };
  return subHeader;

})($);
subHeader.init();

;
var newFooter = (function ($) {
    var footer = {};

    footer.init = function () {
        $(document).ready(function () {
            var $headQuarterDropdown = $(".footer-body .contact-group__items--dropdown-styled-select");
            var $headQuarterDropdownOptions = $(".footer-body .contact-group__items--dropdown-styled-select li");

            var selectedOption = $headQuarterDropdown.find('.selected-option').text().trim();
            var $addressWrapper = $('.contact-group__items--dropdown .address-wrapper');
            $addressWrapper.find('.address').hide();
            $addressWrapper.find(".address[data-locationName='" + selectedOption + "']").show();
            $headQuarterDropdown.find('.dropdown').hide();

            $headQuarterDropdown.on('click', function (e) {
                $(this).find('.dropdown').toggle();
                if (!$(this).find('.dropdown').is(':visible')) {
                    $headQuarterDropdown.find('.dropdown-arrow').removeClass('rotate-up');
                    $headQuarterDropdown.removeClass('bottom-rounded-border');
                } else {
                    $headQuarterDropdown.addClass('bottom-rounded-border');
                    $headQuarterDropdown.find('.dropdown-arrow').addClass('rotate-up');
                }
            });

            $headQuarterDropdownOptions.on('click', function (e) {
                var selectedOption = $(this).attr('data-locationName');
                var $addressWrapper = $('.contact-group__items--dropdown .address-wrapper')
                $headQuarterDropdown.find('.selected-option').text(selectedOption);
                $addressWrapper.find('.address').hide();
                $addressWrapper.find(".address[data-locationName='" + selectedOption + "']").show();
            });

            let num = document.body.clientWidth;
            if (num > 500) {
                $(".socail-item").hover(function () {
                    $(this).find(".socail-qr-code").css("display", "block");
                }, function () {
                    $(this).find(".socail-qr-code").css("display", "none");
                });
            } else {
                $(".socail-item").click(function () {
                    var $this = $(this);
                    var qaCode = $this.find(".socail-qr-code");
                    if (qaCode.length > 0) {
                        var popUp = $(".add-pop-up-windows");
                        popUp.css("display", "flex");
                        popUp.find(".mobile-qr-img").css("background-image", qaCode.css("background-image"))
                    }
                });
                $(".add-pop-up-windows").click(function () {
                    $(".add-pop-up-windows").css("display", "none");
                });
            }
            // 根据是否设置hilook站点显示对应的icon
            if($('body').hasClass('hilook-page')){
                $('.hilook-footer-icon').show()
            }else {
                $('.default-footer-icon').show()
            }
            $('body').on('click', function (e) {
                if ($headQuarterDropdown.has(e.target).length == 0) {
                    $headQuarterDropdown.find('.dropdown').hide();
                    $headQuarterDropdown.removeClass('bottom-rounded-border');
                    $headQuarterDropdown.find('.dropdown-arrow').removeClass('rotate-up');
                }
            });
            HiAnalyticsCn.clickDownLazy('.footer-navigation-body a',isCnAnalytics);
        });
    };

    return footer;
}($));
//contact-group__items--dropdown-styled-select
newFooter.init();

var footer = (function($) {
    var footer = {};

    footer.init = function() {
        $(document).ready(function() {
            var $headQuarterDropdown = $(".hiknow-footer .contact-group__items--dropdown-styled-select");
            var $headQuarterDropdownOptions = $(".hiknow-footer .contact-group__items--dropdown-styled-select li");
            var selectedOption = $headQuarterDropdown.find('.selected-option').text();
            var $addressWrapper = $('.contact-group__items--dropdown .address-wrapper');
             $addressWrapper.find('.address').hide();
            setTimeout(function(){
                $addressWrapper.find(".address[data-locationName='" + selectedOption + "']").show();
            }, 100)
            $headQuarterDropdown.find('.dropdown').hide();
            $headQuarterDropdown.on('click', function(e) {
                $(this).find('.dropdown').toggle();
                if (!$(this).find('.dropdown').is(':visible')) {
                    $headQuarterDropdown.find('.dropdown-arrow').removeClass('rotate-up');
                    $headQuarterDropdown.removeClass('bottom-rounded-border');
                } else {
                    $headQuarterDropdown.addClass('bottom-rounded-border');
                    $headQuarterDropdown.find('.dropdown-arrow').addClass('rotate-up');
                }
            });

            $headQuarterDropdownOptions.on('click', function(e) {
                var selectedOption = $(this).attr('data-locationName');
                var $addressWrapper = $('.contact-group__items--dropdown .address-wrapper')
                $headQuarterDropdown.find('.selected-option').text(selectedOption);
                $addressWrapper.find('.address').hide();
                $addressWrapper.find(".address[data-locationName='" + selectedOption + "']").show();
            });

            $('body').on('click', function(e) {
                if ($headQuarterDropdown.has(e.target).length == 0) {
                    $headQuarterDropdown.find('.dropdown').hide();
                    $headQuarterDropdown.removeClass('bottom-rounded-border');
                    $headQuarterDropdown.find('.dropdown-arrow').removeClass('rotate-up');
                }
            });

            $(".qrcode-out").hide();
            $(".wechat-in").hover(function() {
                $(".qrcode-out").show();
            }, function() {
                $(".qrcode-out").hide();
            });
        });
    };

    return footer;
}($));

footer.init();
var downloadAgreementModule = (function ($) {
  var downloadAgreement = {};
  var targetBoolean = 'x';
  downloadAgreement.init = function () {
    $(document).ready(function () {
      var pageTitle=$('#header').attr('data-page-title')
      var link = $('.header-wrapper').attr('data-download-agreement');
      // $('.download-agreement-wrapper .modal-content .agreement-wrapper .generalt-teams-link').attr('href', link);

      $('.download-agreement-wrapper .modal-content footer .agree').on('click', function (e) {
        e.stopPropagation()
        targetBoolean = 'agree'
        // var hrefTarget =  $(event.target).data('href')
        // window.open(hrefTarget, '_blank')
        // button组件 同意下载事件埋点
        if(isCnAnalytics && $(this).data('contact') == 'download-button'){
          var href=$(this).attr('href')  
          var analyticsAgreeData='同意::download agreement::下载::[file-link]'+href+"::"+pageTitle
          HiAnalyticsCn.clickDown(analyticsAgreeData)
        } else {
          var atButton = $('.download-agreement-link, .assets, .firmware-series,.main-category-link,.download-link, .addon-version-download').parent().parent().attr('class').split('-')
          var compnentName =  window.compnentName? window.compnentName: atButton[0] === 'offering'? atButton[0] : atButton[0] + '-' + atButton[1]
          var atHref = $(this).attr('href')
          var arrSplit = atHref.split('/')
          var string = arrSplit.length ? $(this).text().trim() + '_'+ lastNode(atHref).replace('&', '') :$(this).text().trim()
          //  atModel.doAtEvent('agrement_button::'+ compnentName + '::' + $(this).text().trim() + atModel.atSpliter + window.location.href.replace('#download-agreement',''), 'action', e);
          atModel.doAtEvent('agrement_button::'+ compnentName + '::' +string+ atModel.atSpliter + window.location.href.replace('#download-agreement',''), 'action', e);
        //  atModel.doAtEvent('agrement_button:222:333', 'action', e);
        }
      //   $('.modal-backdrop.fade').removeClass("modal-open").hide()
       //  $('.modal.fade').removeClass("show").hide()
       $('.download-agreement-wrapper .modal-content header .close').click();
      });
      $('.download-agreement-wrapper .modal-content footer .disagree').on('click', function (e) {
       // e.stopPropagation();
        var atButton = $('.download-agreement-link, .assets, .firmware-series,.main-category-link,.download-link').parent().parent().attr('class').split('-')
        var compnentName =  window.compnentName? window.compnentName: atButton[0] === 'offering'? atButton[0] : atButton[0] + '-' + atButton[1]
        var atHref =  $(this).parent().find('a').attr('href')
        var arrSplit = atHref.split('/')
        var string = arrSplit.length ? $(this).text().trim() + '_'+ lastNode(atHref).replace('&', '') :$(this).text().trim()
        atModel.doAtEvent('agrement_button::'+ compnentName + '::'+string+ atModel.atSpliter + window.location.href.replace('#download-agreement',''), 'action', e);
        $('.modal-backdrop.fade').removeClass("modal-open").hide()
        $('.modal.fade').removeClass("show").hide()
      })
      $('.download-agreement-wrapper .modal-content header .close').on('click', function (e) {
       // e.stopPropagation();
       if(targetBoolean!= "agree" ){
        var atButton = $('.download-agreement-link, .assets, .firmware-series,.main-category-link,.download-link').parent().parent().attr('class').split('-')
        var compnentName =  window.compnentName? window.compnentName: atButton[0] === 'offering'? atButton[0] : atButton[0] + '-' + atButton[1]
         var atHref = $(this).parent().parent().find('footer .a-download-href').attr('href')
         var arrSplit = atHref.split('/')
         var string = arrSplit.length ? $(this).text().trim() + '_'+ lastNode(atHref).replace('&', '') :$(this).text().trim()
         atModel.doAtEvent('agrement_button::'+ compnentName + '::'+string+ atModel.atSpliter + window.location.href.replace('#download-agreement',''), 'action', e);
       }
         setTimeout(function(){
          targetBoolean = "x"
         }, 500)
         //  $('.modal-backdrop.fade').removeClass("modal-open").hide()
      //   $('.modal.fade').removeClass("show").hide()
      })
      $('.download-agreement-wrapper .modal-content .agreement-wrapper a').on('click',function(e){
        e.preventDefault()
        var ahref = $(this).attr('href')
        if(isCnAnalytics && $(this).attr('data-contact')== 'download-button' ){
          var analyticsLinkData='《海康威视软件许可协议》::download agreement::跳转页面::'+'[complete-link]https://www.hikvision.com/cn/support/Downloads/_/'+'::'+pageTitle
          HiAnalyticsCn.clickDown(analyticsLinkData)
        }
        setTimeout(function() {
          window.open(ahref, '_self')
        }, 500)
      })

      $('#download-agreement').on('show.bs.modal', function (e) {
        e.stopPropagation();
     //   $('.download-agreement-wrapper .modal-content footer .agree').attr('data-href', $(event.target).data('link'));
        //如果组件用于cn站 download-agreement-link 为点击事件添加埋点
        if(isCnAnalytics && $(event.target).hasClass('download-agreement-link')){
          $('.download-agreement-wrapper .modal-content footer .agree').attr('data-contact','download-button')
          $('.download-agreement-wrapper .modal-content a').attr('data-contact','download-button')
        }
        // 如果点击字需要单独处理===因为多包裹了一层h3
         var targetDiv = $(event.target)
        if($(event.target).hasClass('h3-seo') || $(event.target).hasClass('h4-seo') || $(event.target).attr('src')){
          targetDiv = $(event.target).parent()
        } else {
          targetDiv = $(event.target)
        }
        $('.download-agreement-wrapper .modal-content footer .agree').attr('href', $(targetDiv).data('link'));
      })

    });
  };

  return downloadAgreement;
})($);

downloadAgreementModule.init();
$(document).ready(function() {
    var timer1 , timer2 ,timer3
    function PCHover(){
        if($(window).width()<= $(".contact-us-btn-options").width()) {
            $(".contact-us-btn-options").width("90%");
        }
        timer2 = function(){
            timer3 = setTimeout(function(){
                $('.contact-us-btn-content .contact-us-btn-content-text').removeClass('contact-us-btn-content-text-move')
            }, 10000)
        }
        timer1 = setTimeout(function(){
                $('.contact-us-btn-content .contact-us-btn-content-text').addClass('contact-us-btn-content-text-move')
                    timer2()
            }, 0)
        $('.btn-content').hover(function(){
            clearTimeout(timer1)
            clearTimeout(timer3)
            timer2 = null
            if($(window).width() > 1024){
                $('.contact-us-btn-content .contact-us-btn-content-text').addClass('contact-us-btn-content-text-move') 
            }
        },function(){
            if($('.contact-us-btn-options').is(':hidden')){
                $('.contact-us-btn-content .contact-us-btn-content-text').removeClass('contact-us-btn-content-text-move')
            }
        })
        
        $(document).bind("click",function(e){
            var target = $(e.target);
            if(!$('.contact-us-btn-options').is(':hidden') && target.closest(".contact-us-btn-options").length == 0 && target.closest(".btn-content").length == 0 ){
                $(".contact-us-btn-options").hide();
                // $(".contact-us-btn-bg").hide();
                $('.contact-us-btn-content .contact-us-btn-content-text').removeClass('contact-us-btn-content-text-move')
            }
        })
    }

    $(window).resize(function() {
        if($(window).width() > 1024){
            PCHover()
        }
    });
    if($(window).width() > 1024){
        PCHover()
    }

    $(".contact-us-btn-content").on("click",function(){
        clearTimeout(timer1)
        clearTimeout(timer3)
        timer2 = null
        $(".contact-us-btn-options").toggle();
        // if ($(window).width() <= 1024) {
        //     $(".contact-us-btn-bg").show();
        // }
    });

    $(".contact-us-btn-options-header-close,.contact-us-btn-bg").on("click",function(){
        $(".contact-us-btn-options").hide();
        // $(".contact-us-btn-bg").hide();
        if($(window).width() <= 1024){
            $('.contact-us-btn-content .contact-us-btn-content-text').removeClass('contact-us-btn-content-text-move')
        }
    });

    $("a[href].contact-us-btn-options-item").on("click",function(){
        //跳转到contact us表单时，保存当前页面路径至cookie
        setSubmittedPageUrlCookie("contactUsUrl");
    });
});
;;
(function (document, $) {
    function initGoTopEvent ($comp) {
        $comp.find('.customer-service-top').each(function () {
            $(this).on('click', function () {
                window.scrollTo(0 ,0)
            })
        })
    }

    function initCustomIcon () {
        $('.customer-service-item.custom-item').on('mouseenter', function () {
            var $icon = $(this).find('.icon.icon-custom')
            $icon.attr('src', $icon.data('icon-active'))
        })
        $('.customer-service-item.custom-item').on('mouseleave', function () {
            var $icon = $(this).find('.icon.icon-custom')
            $icon.attr('src', $icon.data('icon'))
        })
        $('.wechat-box').on('mouseenter', function(){
           var visImage = $(this).find('img.wechat-img').attr('data-original')
           $(this).find('img.wechat-img').attr('src', visImage)
        })
    }

    $(document).ready(function () {
        var modal = $(".customer-service-modal-back");
        var box = $(".customer-service");
        var $mobileBtn = $('.customer-service-btn-mobile')
        var $closeIcon = $('.customer-service-modal .close-icon')
        $mobileBtn.on('click', function () {
            modal.show()
        })
        $closeIcon.on('click', function () {
            modal.hide()
        })
        initGoTopEvent(box)
        initCustomIcon()
           var $goTop = $('.customer-service .customer-service-top')
            $(window).scroll(function () {
                if ($(this).scrollTop() > 0) {
                    $goTop.css('display', 'flex')
                } else {
                    $goTop.hide()
                }
            })
        HiAnalyticsCn.clickDownLazy('.customer-service-item , .service-modal-content .nav-line',isCnAnalytics);
        // HiAnalyticsCn.clickDownLazy('.service-modal-content .nav-line',isCnAnalytics);

        

        // $('body').click(function(e) {
        //     var classNameArr = ['icon','font','customer-service active']
        //     if( classNameArr.indexOf(e.target.className) == -1 ){
        //         box.removeClass("active");
        //         modal.hide();
        //     }
        // })

    });
})(document, $);
$(document).ready(function () {
    $('.back-to-top-comp').each(function() {
        var $comp = $(this);
        $comp.hide();
        var scrollTopVal = 0;
        var resizeTimer;

        $comp.on('click', function() {
            $('html, body').animate({scrollTop: 0}, 300, function() {
                clearTimeout(resizeTimer);
                scrollTopVal = 0;
                $comp.fadeOut(200);
            });
        });

        $(window).on('scroll', function() {
            var newVal = $(window).scrollTop();
            if (resizeTimer) {
                clearTimeout(resizeTimer);
            }

            if (newVal > window.innerHeight) {
                $comp.show();
                resizeTimer = setTimeout(function() {
                    $comp.fadeOut(200);
                }, 6000);
            } else {
                $comp.fadeOut(200);
            }

            scrollTopVal = newVal;
        })
    });
});

;
(function ($) {
    'use strict'
    var monthsArray = {
        '0': Granite.I18n.get('January'),
        '1': Granite.I18n.get('February'),
        '2': Granite.I18n.get('March'),
        '3': Granite.I18n.get('April'),
        '4': Granite.I18n.get('May'),
        '5': Granite.I18n.get('June'),
        '6': Granite.I18n.get('July'),
        '7': Granite.I18n.get('August'),
        '8': Granite.I18n.get('September'),
        '9': Granite.I18n.get('October'),
        '10': Granite.I18n.get('November'),
        '11': Granite.I18n.get('December'),
    }   
    var cnMonthsArray = {
        '0': '1月',
        '1': '2月',
        '2': '3月',
        '3': '4月',
        '4': '5月',
        '5': '6月',
        '6': '7月',
        '7': '8月',
        '8': '9月',
        '9': '10月',
        '10': '11月',
        '11': '12月',
    }   
    var tmpl = function (str, data) {
        var f = !/[^\w\-.:]/.test(str) ? (tmpl.cache[str] = tmpl.cache[str] || tmpl(tmpl.load(str))) : new Function( // eslint-disable-line
            // no-new-func
            tmpl.arg + ',tmpl', 'var _e=tmpl.encode' + tmpl.helper + ",_s='" + str.replace(tmpl.regexp, tmpl.func)
        + "';return _s;")
      //  中文站日期格式修改
        if (data && data.dataArray && (window.location.href.indexOf('/cn')>-1)) {
            for (var index = 0; index <  data.dataArray.length; index++) {
                if(data.dataArray[index].newsDate){
                    var currentDateText = new Date(data.dataArray[index].newsDate)
                    var currentDate = currentDateText.getDate()
                    var currentMonth = cnMonthsArray[currentDateText.getMonth()]
                    var currentYear = currentDateText.getFullYear()
                    data.dataArray[index].newsDate = currentYear+"年"+currentMonth+currentDate+"日"
                }
            }

        }
        return data ? f(data, tmpl) : function (data) {
            return f(data, tmpl)
        }
    }
    tmpl.cache = {}
    tmpl.load = function (id) {
        return document.getElementById(id).innerHTML
    }
    tmpl.regexp = /([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g
    tmpl.func = function (s, p1, p2, p3, p4, p5) {
        if (p1) {
            // whitespace, quote and backspace in HTML context
            return ({
                '\n': '\\n',
                '\r': '\\r',
                '\t': '\\t',
                ' ': ' '
            }[p1] || '\\' + p1)
        }
        if (p2) {
            // interpolation: {%=prop%}, or unescaped: {%#prop%}
            if (p2 === '=') {
                return "'+_e(" + p3 + ")+'"
            }
            return "'+(" + p3 + "==null?'':" + p3 + ")+'"
        }
        if (p4) {
            // evaluation start tag: {%
            return "';"
        }
        if (p5) {
            // evaluation end tag: %}
            return "_s+='"
        }
    }
    tmpl.encReg = /[<>&"'\x00]/g // eslint-disable-line no-control-regex
    tmpl.encMap = {
        '<': '&lt;',
        '>': '&gt;',
        '&': '&amp;',
        '"': '&quot;',
        "'": '&#39;'
    }
    tmpl.encode = function (s) {
        // eslint-disable-next-line eqeqeq
        return (s == null ? '' : '' + s).replace(tmpl.encReg, function (c) {
            return tmpl.encMap[c] || ''
        })
    }
    tmpl.arg = 'o'
    tmpl.helper = ",print=function(s,e){_s+=e?(s==null?'':s):_e(s);}" + ',include=function(s,d){_s+=tmpl(s,d);}'
    if (typeof define === 'function' && define.amd) {
        define(function () {
            return tmpl
        })
    } else if (typeof module === 'object' && module.exports) {
        module.exports = tmpl
    } else {
        $.tmpl = tmpl
    }
})(this)

;
(function (document, $) {
    var $filter = $("#filter-attribute");
    var filterName = $filter.attr("data-filter-type");
    var isJobOpportunitiesFilter = filterName === 'jobOpportunities';
    var originalJSON;
    var currentFilters = {};
    var resultFunction;
    var i18n_next = Granite.I18n.get("next");
    var i18n_back = Granite.I18n.get("back");
    var monthsArray = {
        '0': Granite.I18n.get('January'),
        '1': Granite.I18n.get('February'),
        '2': Granite.I18n.get('March'),
        '3': Granite.I18n.get('April'),
        '4': Granite.I18n.get('May'),
        '5': Granite.I18n.get('June'),
        '6': Granite.I18n.get('July'),
        '7': Granite.I18n.get('August'),
        '8': Granite.I18n.get('September'),
        '9': Granite.I18n.get('October'),
        '10': Granite.I18n.get('November'),
        '11': Granite.I18n.get('December'),
    }

    function JudgeWebLanguage(name) {
        var reg = eval("/" + name + "/g");
        var r = window.location.pathname.substr(1);
        var flag = reg.test(r);
        return flag ? true : false;
    }

    function jsonSort(jsonObj) {
        var arr = [];
        for (var key in jsonObj) {
            arr.push(key)
        }
        arr.sort();
        var result = {};

        arr.forEach(function (value, index) {
            result[value] = jsonObj[value];
        });
        return result;
    }

    function destroyPagination($comp) {
        var $pagination = $comp.find('.pagination-section');
        if ($pagination.hasClass('pagination-initialized')) {
            $pagination.jPages('destroy');
            $pagination.removeClass('pagination-initialized');
        }
    }

    function updateMobileList($comp) {
        destroyPagination($comp);
        $comp.find('#article-press-pagination-mob .result-item:lt(10)').addClass('mobile-active')
        $('.view-more-mob').on('click', function () {
            var $itemNoActive = $comp.find('#article-press-pagination-mob .result-item:not(.mobile-active):lt(10)');
            $itemNoActive.addClass('mobile-active');
            $comp.find('#article-press-pagination-mob .result-item:not(.mobile-active)').length == '0' ? $comp.find('.view-more-mob').hide() : $comp.find('.view-more-mob').show();
        })
        $comp.find('#article-press-pagination-mob .result-item').length <= 10 ? $comp.find('.view-more-mob').hide() : $comp.find('.view-more-mob').show();
    }

    function updateDesktopPagination($comp) {
        if (!$(".pagination-container").hasClass('article-new-style')) {
            return
        }
        var containerID = $comp.find('.accordion').attr('id');
        var $pagination = $comp.find('.pagination-section');
        var perPage = parseInt($pagination.attr('data-num'));
        destroyPagination($comp);
        $pagination.jPages({
            containerID: containerID,
            perPage: perPage,
            previous: "",
            next: "",
            keyBrowse: true,
            animation: "slideInRight",
        });
        $pagination.addClass('pagination-initialized');
        paginationBindEvent($comp);
        $comp.find('.job-opportunities .result-item').length <= 10 ? $comp.find('.job-opportunities-pagination').hide() : $comp.find('.job-opportunities-pagination').show();
    }

    function paginationBindEvent($comp) {
        $comp.find('.item-num-for-page select.number-select').selectpicker({});
        $comp.find('.item-num-for-page select.number-select').on('changed.bs.select', function () {
            var numberVal = $(this).val();
            $comp.find('.pagination-section').attr('data-num', numberVal);
            updateDesktopPagination($comp);
        });
    }

    function downloadCheckLogin() {
        var downloadLinks = $('#article-press-pagination .layout3-content-wrapper .links-source a');
        if ($('.articleList').data('show-agreement')) {
            downloadLinks = $('#article-press-pagination .layout3-content-wrapper .links-source a.download-agreement-link');
        }
        $.each(downloadLinks, function (key, val) {
            var btnUrlOrg = $(val).attr('href');
            var btnUrl = btnUrlOrg;
            btnUrl = header.checkLoginStatusForDownload(btnUrl, $('.articleList'), val);
            $(val).attr('href', btnUrl);
            if (btnUrl !== '#download-agreement') {
                $(val).removeAttr('data-toggle');
                $(val).removeClass('at-action');
                if (btnUrl == btnUrlOrg) {
                    $(val).removeClass('at-exit');
                    $(val).addClass('at-download');
                } else if (btnUrl.toLowerCase().indexOf("javascript") >= 0) {
                    $(val).removeClass('at-exit');
                    $(val).addClass('at-download');
                } else {
                    $(val).removeClass('at-download');
                    $(val).addClass('at-exit');
                }
            } else {
                $(val).removeClass('at-exit');
                $(val).addClass('at-download');
            }
        });
    }

    function numberofItemsPerPage(count) {
        var $paginationContainer = $(".pagination-container");
        if ($paginationContainer.hasClass('.article-new-style')) {
            return
        }
        $paginationContainer.find(".holder").jPages({
            containerID: "article-press-pagination",
            perPage: count,
            previous: i18n_back,
            next: i18n_next,
            keyBrowse: true,
            animation: "slideInRight"
        });
        $('#article-press-pagination').find('.lazy').lazyload();
    }

    function appendFilteredTag(filteredTagArray, filterItem, filterKey, filterVal) {
        var filteredTag = $('<button data-value ="'
            + filterVal
            + '" data-key="'
            + filterKey
            + '" class="btn-products btn">'
            + filterVal
            + '<img class="close-btn close-btn-filter" src="/etc/clientlibs/it/resources/icons/baseline-close-24px.svg" alt="Close"></button>');
        filteredTagArray.push(filteredTag);
        // when an item in the filtered tag cloud is
        // clicked, that particular filter will be
        // removed
        filteredTag.on('click', function () {
            filteredTag.remove();
            $('.sub-category', filterItem).removeClass('selectedFilter');
            // remove filter from
            // currentFilters Object
            var filterCopy = currentFilters;
            for (var i = 0; i < filterCopy[filterKey].length; i++) {
                if (currentFilters[filterKey][i] === filterVal) {
                    currentFilters[filterKey].splice(i, 1);
                }
            }
            filterCopy = null;
            // refresh the UI
            refreshSearchResults();
        });
        $(".filterTagContainer").append(filteredTag);
    };

    function filterSelector(data) {
        var currentBreakPoint = getCurrentBreakPoint();
        // var obj = data.content.data.filter;
        var mainData = data.content.data.filter
        if (data.content.data.filter.hasOwnProperty('year') && data.content.data.filter.year.length) {
            mainData.year.sort().reverse()
        }
        var obj = mainData;
        var keyLength = 0;
        var filterHTML = $(".filterContainer");
        if (!isJobOpportunitiesFilter) {
            filterHTML
                .append('<nav class="navbar navbar-expand-lg navbar-light bg-light rounded filter-dropdown-nav"><div class= "filterIconCont"><img class="filter-icon" src="/etc/clientlibs/it/resources/icons/icon-filter-white.svg" alt="filter-icon" /><a class="navbar-brand" href="#">' + Granite.I18n.get("Filter by") + '</a></div><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbars" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="resetAll resetAllMob">' + Granite.I18n.get("Reset") + '</div><div class="collapse navbar-collapse" id="navbar"><ul class="navbar-nav mr-auto"></ul></div><div class="resetAll resetAllWeb">' + Granite.I18n.get("Reset") + '</div></nav><div class ="filterTagContainer" ></div>');
        } else {
            filterHTML.html(tmpl("tmpl-job-opportunities-nav", obj));
        }

        $('.resetAll', filterHTML).on('click', function () {
            $(".filterTagContainer").empty();
            $.each(currentFilters, function (key, val) {
                currentFilters[key] = [];
            })
            $('.selectedFilter', filterHTML).removeClass('selectedFilter');
            if (isJobOpportunitiesFilter) {
                $('.search-form-input').val('');
            }
            refreshSearchResults();
        });

        if (filterName === 'support-assets') {
            $.each(obj, function (key, value) {
                // if filter have no items we do not add this filter
                if (value) {
                    var str = value.filterTopic;
                    if (str) {
                        str = str.replace(/_/g, " ");
                    }
                    var filteredTagArray = [];
                    var navItem = $('<li class="nav-item dropdown megamenu-li"><a class="nav-link dropdown-toggle at-topic" data-at-module="'
                        + filterName + atModel.atSpliter + Granite.I18n.get(str)
                        + '" id="dropdown01" href="javaScript:void(0);" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'
                        + Granite.I18n.get(str)
                        + '</a><div class="dropdown-menu megamenu" id="'
                        + str.replace(/ /g, '-').replace("/", '-')
                        + '" aria-labelledby="dropdown01"><div class="sub-category allBtn at-topic" data-at-module="' + filterName + '::all">' + Granite.I18n.get('all') + '</div><ul></ul></div></li>');

                    filterHTML.find("#navbar>ul").append(navItem);

                    navItem.find('.allBtn').on('click', function (e) {
                        currentFilters[str] = [];
                        filteredTagArray.forEach(function (fTag) {
                            fTag.remove();
                        });
                        navItem.find('.selectedFilter').removeClass('selectedFilter');
                        refreshSearchResults();
                    });

                    keyLength = value.filterItem.length;
                    for (var i = 0; i < keyLength; i++) {
                        (function () {
                            var filterKey = value.filterTopic, filterVal = value.filterItem[i].filterTopic;
                            var filterItem = $('<li><div class="sub-category at-topic" data-at-module="' + filterName + atModel.atSpliter + Granite.I18n.get(str) + atModel.atSpliter + filterVal + '">' + filterVal
                                + "</div></li>");
                            currentFilters[filterKey] = [];
                            filterItem.on('click', function (e) {
                                if (!$('.sub-category', this).hasClass('selectedFilter')) {
                                    if (isJobOpportunitiesFilter) {
                                        // clear all filter items in this filter
                                        filterItem.parents(".dropdown-menu.megamenu.show").find('.sub-category').removeClass("selectedFilter");
                                        $('.sub-category', this).addClass('selectedFilter');
                                        // single selection
                                        currentFilters[filterKey] = [filterVal];
                                        refreshSearchResults();
                                        // remove the previously selected filter item
                                        $('.filterContainer').find("button[data-key ='" + filterKey + "']").remove();
                                        appendFilteredTag(filteredTagArray, filterItem, filterKey, filterVal);
                                        return;
                                    }

                                    $('.sub-category', this).addClass('selectedFilter');
                                    currentFilters[filterKey].push(filterVal);
                                    refreshSearchResults();
                                    appendFilteredTag(filteredTagArray, filterItem, filterKey, filterVal);
                                } else {
                                    $('.filterContainer').find("button[data-value ='" + filterVal + "']").remove();
                                    $(".sub-category", filterItem).removeClass("selectedFilter");
                                    // remove filter from
                                    // currentFilters Object
                                    var filterCopy = currentFilters;
                                    for (var i = 0; i < filterCopy[filterKey].length; i++) {
                                        if (currentFilters[filterKey][i] === filterVal) {
                                            currentFilters[filterKey].splice(i, 1);
                                        }
                                    }
                                    filterCopy = null;

                                    $(".sub-category", this).removeClass("selectedFilter");
                                    var index = currentFilters[filterKey].indexOf(filterVal);
                                    if (index >= 0) {
                                        currentFilters[filterKey].splice(index, 1);
                                    }
                                    refreshSearchResults();
                                }
                            });
                            filterHTML.find("#" + filterKey.replace(/ /g, '-').replace("/", '-') + ">ul").append(
                                filterItem);
                        })();
                    }
                    keyLength = 0;
                }
            });
        } else if (filterName === 'jobOpportunities') {
            $.each($('.navbar .nav-item'), function (index, item) {
                var filterKey = $(this).attr('data-key');
                if (index == 0) {
                    $(this).removeClass('collapsed');
                }
                $(this).find('.sub-category').on('click', function () {
                    $(this).addClass('selectedFilter').siblings().removeClass('selectedFilter')
                    var filterVal = $(this).attr('data-value')
                    currentFilters[filterKey] = [filterVal];
                    if (currentBreakPoint === 'DESKTOP') {
                        refreshSearchResults();
                    }
                })

                $(this).find('.allBtn').on('click', function (e) {
                    delete currentFilters[filterKey];
                    $(this).addClass('selectedFilter').siblings().removeClass('selectedFilter')
                    if (currentBreakPoint === 'DESKTOP') {
                        refreshSearchResults();
                    }
                });
            });

            if (currentBreakPoint === 'MOBILE') {
                var $navbarMob = filterHTML.find('.navbar')
                $navbarMob.find('.filter-bar-mob').on('click', function () {
                    $navbarMob.find('.nav-wrap').show()
                })
                $navbarMob.find('.submit').on('click', function () {
                    $navbarMob.find('.nav-wrap').hide();
                    !$.isEmptyObject(currentFilters) ? $navbarMob.find('.filter-bar-mob').addClass('active') : $navbarMob.find('.filter-bar-mob').removeClass('active');
                    refreshSearchResults();
                })
                $navbarMob.find('.close-btn').on('click', function () {
                    $navbarMob.find('.nav-wrap').hide();
                })
                $navbarMob.find('.reste').on('click', function () {
                    currentFilters = {};
                    $navbarMob.find('.allBtn').click();
                    $navbarMob.find('.nav-item:first-child').removeClass('collapsed').siblings().addClass('collapsed')
                })
                $navbarMob.find('.nav-title').on('click', function () {
                    $(this).parent().toggleClass('collapsed')
                })
            }

        } else {
            if (filterName === 'download-pages') {
                obj = jsonSort(obj);
            }
            $.each(obj, function (key, value) {
                // if filter have no items we do not add this filter
                if (value.length > 0) {
                    var str = key;
                    str = str.replace(/_/g, " ");
                    var filteredTagArray = [];
                    var navItem = $('<li class="nav-item dropdown megamenu-li"><a class="nav-link dropdown-toggle at-topic" data-at-module="'
                        + filterName + atModel.atSpliter + Granite.I18n.get(str)
                        + '" id="dropdown01" href="javaScript:void(0);" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'
                        + Granite.I18n.get(str)
                        + '</a><div class="dropdown-menu megamenu" id="'
                        + key.replace(/ /g, '-').replace("/", '-')
                        + '" aria-labelledby="dropdown01"><div class="sub-category allBtn at-topic" data-at-module="' + filterName + '::all">' + Granite.I18n.get('all') + '</div><ul></ul></div></li>');

                    filterHTML.find("#navbar>ul").append(navItem);

                    navItem.find('.allBtn').on('click', function (e) {
                        currentFilters[key] = [];
                        filteredTagArray.forEach(function (fTag) {
                            fTag.remove();
                        });
                        navItem.find('.selectedFilter').removeClass('selectedFilter');
                        refreshSearchResults();
                    });

                    keyLength = value.length;
                    for (var i = 0; i < keyLength; i++) {
                        (function () {
                            var filterKey = key, filterVal = value[i];
                            var filterItem = $('<li><div class="sub-category at-topic" data-at-module="' + filterName + atModel.atSpliter + Granite.I18n.get(str) + atModel.atSpliter + value[i] + '">' + value[i]
                                + "</div></li>");
                            currentFilters[filterKey] = [];
                            filterItem.on('click', function (e) {
                                if (!$('.sub-category', this).hasClass('selectedFilter')) {
                                    if (isJobOpportunitiesFilter) {
                                        // clear all filter items in this filter
                                        filterItem.parents(".dropdown-menu.megamenu.show").find('.sub-category').removeClass("selectedFilter");
                                        $('.sub-category', this).addClass('selectedFilter');
                                        // single selection
                                        currentFilters[filterKey] = [filterVal];
                                        refreshSearchResults();
                                        // remove the previously selected filter item
                                        $('.filterContainer').find("button[data-key ='" + filterKey + "']").remove();
                                        appendFilteredTag(filteredTagArray, filterItem, filterKey, filterVal);
                                        return;
                                    }

                                    $('.sub-category', this).addClass('selectedFilter');
                                    currentFilters[filterKey].push(filterVal);
                                    refreshSearchResults();
                                    appendFilteredTag(filteredTagArray, filterItem, filterKey, filterVal);
                                } else {
                                    $('.filterContainer').find("button[data-value ='" + filterVal + "']").remove();
                                    $(".sub-category", filterItem).removeClass("selectedFilter");
                                    // remove filter from
                                    // currentFilters Object
                                    var filterCopy = currentFilters;
                                    for (var i = 0; i < filterCopy[filterKey].length; i++) {
                                        if (currentFilters[filterKey][i] === filterVal) {
                                            currentFilters[filterKey].splice(i, 1);
                                        }
                                    }
                                    filterCopy = null;

                                    $(".sub-category", this).removeClass("selectedFilter");
                                    var index = currentFilters[filterKey].indexOf(filterVal);
                                    if (index >= 0) {
                                        currentFilters[filterKey].splice(index, 1);
                                    }
                                    refreshSearchResults();
                                }
                            });
                            filterHTML.find("#" + key.replace(/ /g, '-').replace("/", '-') + ">ul").append(
                                filterItem);
                        })();

                    }
                    keyLength = 0;
                }
            });
        }
        if (isJobOpportunitiesFilter) {
            var searchItem = $('.search-form-container')
            searchItem.find('.search-form-submit').on('click', function (e) {
                e.preventDefault();
                refreshSearchResults();
            });
        }
    };

    // add all the filter names here
    function htmlFunc(d) {
        var assetsTmplId = ($('.articleList').data('show-agreement') ? "tmpl-assets-download-agreement" : "tmpl-assets");
        if (filterName === "event") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-events",
                d.content.data);
            $('.layout1-content-wrapper .link-learn-header.event-link-btn').on('click', function () {
                var url = $(this).data('url');
                if (url) {
                    window.location = url;
                }
            });
            $('.layout1-content-wrapper .link-learn-header.event-link-btn .buttons-wrapper').on('click', function (e) {
                e.stopPropagation()
            });
        } else if (filterName === "success-story") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-success-story",
                d.content.data);
            // 埋点处理
            $('.image-container-link').on('click', function (e) {
                var atModule = 'article-listing::' + $(this).data('title') + "::" + lastNode($(this).attr('data-href')) + atModel.atSpliter + window.location.href.replace('#download-agreement', '')
                atModel.doAtEvent(atModule, 'download', e);
            })
        } else if (filterName === "blog") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-blog-press",
                d.content.data);
        } else if (filterName === "news") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-news",
                d.content.data);
            $.each($('.tile-lists .item .details'), function (index, item) {
                var date = $(this).attr('data-date')
                // 判断是否返回中文字符
                var testCn = /[\u4e00-\u9fa5]/
                if (date && !testCn.test(date)) {
                    var currentDateText = new Date(date)
                    var currentDate = currentDateText.getDate()
                    var currentMonth = monthsArray[currentDateText.getMonth()]
                    var currentYear = currentDateText.getFullYear()
                    if (JudgeWebLanguage('gongyi')) { //判断是否为海康公益网站
                        $(this).text(currentYear + '年' + ' ' + currentMonth + ' ' + currentDate + '日')
                    } else {
                        // $(this).text(currentYear+'年'+ ' ' + currentMonth + ' ' + currentDate + '日')
                        $(this).text(currentMonth + ' ' + currentDate + ", " + currentYear)
                    }
                }
                // if(date&&date.indexOf('T') !==-1){
                //   $(this).text(date.slice(0, date.indexOf('T')))
                // }
            })
        } else if (filterName === "solutions") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-solutions",
                d.content.data);
        } else if (filterName === "introduction") {
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-introduction",
                d.content.data);
        } else if (filterName === "press-mentions") {
            var dataArray = d.content.data.dataArray;
            dataArray.forEach(function (value, i) {
                var lang = $("[lang]").attr("lang");
                if (lang == "ar") {
                    lang = "en";
                }
                var date = new Date(value.pressDate);
                dataArray[i].pressDate = date.toLocaleDateString(lang);
            });
            d.content.data.dataArray = dataArray;
            document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-press-mentions",
                d.content.data);
        } else if (filterName === 'download-pages') {
            document.getElementById("article-press-pagination").innerHTML = tmpl(assetsTmplId,
                d.content.data);

            downloadCheckLogin();
        } else if (filterName === 'support-assets') {
            document.getElementById("article-press-pagination").innerHTML = tmpl(assetsTmplId,
                d.content.data);
            downloadCheckLogin();
        } else if (isJobOpportunitiesFilter) {
            if (currentBreakPoint === 'DESKTOP') {
                document.getElementById("article-press-pagination").innerHTML = tmpl("tmpl-job-opportunities", d.content.data);
                updateDesktopPagination($('.pagination-container.article-new-style'));
            } else {
                document.getElementById("article-press-pagination-mob").innerHTML = tmpl("tmpl-job-opportunities-mob", d.content.data);
                updateMobileList($('.pagination-container.article-new-style'));
            }
            $('tbody#article-press-pagination tr , #article-press-pagination-mob .result-item').on('click', function () {
                var url = $(this).data('url');
                if (url) {
                    window.location = url;
                }
            });
        }
        $.each($('.layout1-content-wrapper .link-learn-header .buttons-wrapper'), function (index, item) {
            $(this).find('.i18n-text').text(Granite.I18n.get($(this).find('.i18n-text').text().trim()))
        })
    };

    function getFilteredData() {

        var copiedJSON = JSON.parse(JSON.stringify(originalJSON));

        var filteredData = copiedJSON.content.data.dataArray.filter(function (dataItem) {
            var dataItemFiltered = true;
            $.each(currentFilters, function (seletedFilterName, seletedFilterTags) {
                if (seletedFilterTags.length > 0) {
                    if (dataItem['tags'][seletedFilterName]) {
                        var dataItemFilters = dataItem['tags'][seletedFilterName];
                        var filterTagPass = false;
                        seletedFilterTags.forEach(function (selectedFilter) {
                            if (dataItemFilters.includes(selectedFilter)) {
                                filterTagPass = true;
                            }
                        });
                        if (dataItemFiltered) {
                            dataItemFiltered = filterTagPass;
                        }
                    } else {
                        dataItemFiltered = false;
                    }
                }
            });
            return dataItemFiltered;
        });

        var $searchFormInput = $('.search-form-input');
        var searchValue = $searchFormInput.val();
        if (isJobOpportunitiesFilter && searchValue) {
            var formattedSearchValue = searchValue.trim().toUpperCase();
            filteredData = filteredData.filter(function (item) {
                var positions = item.positions.toUpperCase();
                var functionVal = item['function'].toUpperCase();
                var regionCountry = item.regionCountry.toUpperCase();
                var applicationDeadline = item.applicationDeadline.toUpperCase();
                return positions.indexOf(formattedSearchValue) > -1
                    || functionVal.indexOf(formattedSearchValue) > -1
                    || regionCountry.indexOf(formattedSearchValue) > -1
                    || applicationDeadline.indexOf(formattedSearchValue) > -1;
            });
        }
        copiedJSON.content.data.dataArray = filteredData;
        return copiedJSON;
    }

    function refreshSearchResults() {
        var filteredData = getFilteredData();
        // console.log(filteredData, currentFilters, 'UI data');
        htmlFunc(filteredData);
        numberofItemsPerPage(filteredData.content.resultsPerPage);
        updateDesktopPagination($('.pagination-container.article-new-style'));
    }

    $(document).ready(function () {
        $filter = $("#filter-attribute");
        filterName = $filter.attr("data-filter-type");
        isJobOpportunitiesFilter = filterName === 'jobOpportunities';
        if (filterName) {
            var baseUrl = $filter.attr("data-baseUrl");
            resultFunction = function (baseUrl, filterName) {
                if (baseUrl && filterName) {
                    $.ajax({
                        type: "GET",
                        url: baseUrl + "." + filterName + ".json",
                        success: function (data) {
                            if (data && data.content) {
                                originalJSON = data;
                                filterSelector(data);
                                // JSON.parse(JSON.stringify(data))
                                htmlFunc(JSON.parse(JSON.stringify(data)));
                                numberofItemsPerPage(data.content.resultsPerPage);
                            }
                        },
                    });
                }
            }
            resultFunction(baseUrl, filterName);
        }
    });
})(document, $);

;
(function (document, $) {
    $(document).ready(function () {
        $(".floating-pop-btn").on("click", function () {
            $(this).toggleClass("hover");
            $(this).parent().find(".floating-pop-content").toggle();
            $('.contact-us-btn-options').hide()
        });

        $(document).bind("click", function (e) {
            var target = $(e.target);
            if (target.closest(".floating-pop-content").length === 0
                && target.closest(".floating-pop-btn").length === 0) {
                $(".floating-pop-content").hide();
                $(".floating-pop-btn").removeClass("hover");
            }
        });

        $(".floating-pop-content-close").on("click",function(){
            $(".floating-pop-content").hide();
            $(".floating-pop-btn").removeClass("hover");
        });

        $('.floating-pop-wrapper a').on('click',function(e){
            e.preventDefault()
            var aHref =$(this).attr('href')
            if(aHref){
                var target = aHref.indexOf('http') === -1 ? '_self' : '_blank';
                var title = $(this).attr('data-at-module') + atModel.atSpliter + window.location.href;
                atModel.doAtEvent(title, 'navigation', e);
                window.open(aHref, target)
            }
        })
    });
})(document, $); 
$(document).ready(function () {
    var idHeader = $("#interactive-navigator-header");
    var detailPageValue = '/conf/hiknow/settings/wcm/templates/product-detail-page'
    var htmlElement = document.getElementsByTagName('html')[0]
    var isTransparentNav = $('body').hasClass('transparent-nav')
    var searchShow = false
    var langShow = false
    var $dom = {
        $headerLogo: idHeader.find(".header-logo"),
        $navList: idHeader.find(".navbar-nav-list"),
        $rightBar: idHeader.find(".header-rightBar"),
        $searchForm: idHeader.find(".search-form"),
        $langMask: idHeader.find(".hik-lang .lang-mask"),
        $backContainer: idHeader.find(".back-container")
    }

    if(isTransparentNav){
        idHeader.addClass('transparent-background');
    }

    function addClassTransparent() {
        if (isTransparentNav) {
            idHeader.addClass('transparent-background');
            idHeader.css('position', 'fixed');
        } else {
            idHeader.css('position', 'relative');
        }
    }

    function removeClassTransparent() {
        if (isTransparentNav) {
            idHeader.removeClass('transparent-background');
        }
    }

    function isScrollTop() {
        if (befortop == 0 && !searchShow && !langShow) {
            addClassTransparent();
        } else {
            removeClassTransparent()
        }
    }

    $(".interactive-navigator-header-mask").on("click", function () {
        if (!$dom.$langMask.is(":hidden")) {
            $dom.$langMask.hide();
            $('.interactive-navigator-header-mask').removeClass('active');
            searchShow = false;
            langShow = false;
            addClassTransparent();
            isScrollTop();
            enableScroll(htmlElement)
        }
    })

    idHeader.find(".hik-search").on("click", function (e) {
        e.stopPropagation();
        idHeader.css('transition', 'none');
        $dom.$navList.hide();
        $dom.$rightBar.hide();
        $dom.$searchForm.show();       
        idHeader.find('#headerSerachInputInteractiveNavigator').focus();
        $('.interactive-navigator-header-mask').addClass('active');
        removeClassTransparent();
        disableScroll(htmlElement)
        searchShow = true;
    })

    idHeader.find(".interactive-mobile-search-icon").on("click", function () {
        $('html').addClass('overflow-prevent');
        removeClassTransparent();
        $dom.$headerLogo.hide();
        $(this).closest('.header-mob-right').hide();
        $dom.$searchForm.show();
    })

    idHeader.find(".header-search-wrapper .close").on("click", function () {
        if (getCurrentBreakPoint() == 'MOBILE') {
            $dom.$searchForm.hide();
            $dom.$navList.hide();
            $dom.$rightBar.hide();
            idHeader.find(".header-mob-right").show();
            $dom.$headerLogo.show();
            $('html').removeClass('overflow-prevent');
        } else {
            if ($dom.$langMask.css('display') === 'block') {
                $dom.$langMask.hide();
                langShow = false;
            }
            $dom.$navList.show();
            $dom.$rightBar.show();
            $dom.$searchForm.hide();
            $('.interactive-navigator-header-mask').removeClass('active');
            enableScroll(htmlElement)
            searchShow = false;
        }
        isScrollTop();
    })

    idHeader.find(".header-mob-right .interactive-navigation").on("click", function () {
        removeClassTransparent();
        $('html').addClass('overflow-prevent');
        $(this).closest('.header-mob-right').addClass('active');
    })

    idHeader.find(".mob-close").on("click", function () {
        $('html').removeClass('overflow-prevent');
        idHeader.css('transition', 'none');
        isScrollTop();
        $(this).closest('.header-mob-right').removeClass('active');
        $(this).closest('.header-mob-right').find('.header-mob-wrapper .detail-wrapper').hide();
        $dom.$backContainer.hide();
        $dom.$headerLogo.show();
    })

    idHeader.find(".header-mob-wrapper .item-box").on("click", function () {
        $(this).closest('.nav-item').find(".detail-wrapper").show();
        $dom.$backContainer.css('display', 'flex');
        $dom.$headerLogo.hide();
    })

    idHeader.find(".hik-lang").on("click", function (e) {
        e.stopPropagation();
        idHeader.css('transition', 'none');
        if (!$dom.$langMask.is(":hidden")) {
            $dom.$langMask.hide();
            $('.interactive-navigator-header-mask').removeClass('active');
            langShow = false;
            isScrollTop();
            enableScroll(htmlElement);            
        } else {
            $dom.$langMask.show();
            $('.interactive-navigator-header-mask').addClass('active');
            removeClassTransparent();
            disableScroll(htmlElement);
            langShow = true;
        }
    })
    if (getCurrentBreakPoint() !== 'MOBILE') {
        idHeader.find('.nav-item').hover(function () {
            var index = $(this).index();
            var selectedNav = idHeader.find('.item-content-box .box-item').eq(index);
            $(this).addClass('active');
            $(this).siblings().removeClass('active');
            idHeader.find('.item-content-box .box-item').removeClass('active');
            selectedNav.addClass('active');

            if(($(window).width() < 1280 && selectedNav.find('.img-item:first .content-item').length > 4) || selectedNav.find('.img-item:first .content-item').length > 5){
                selectedNav.find('.img-item:first .content-list-box').addClass('active');
            }

            if(selectedNav.find('.icon-list .icon-item').length > 6){
                selectedNav.find('.icon-list').addClass('active');
            }
            var selectHeight;
            idHeader.css('transition', 'none');
            disableScroll(htmlElement)
            if (!$dom.$langMask.is(":hidden")) {
                $dom.$langMask.hide();
                langShow = false;
            }
            if (idHeader.find('.item-content-box .product-mask .product-img').hasClass('active')) {
                selectHeight = idHeader.find('.item-content-box .content-list.active').height() + idHeader.find('.item-content-box  .product-img').height();
            } else {
                selectHeight = idHeader.find('.item-content-box .product-mask').height();
            }
            idHeader.find('.item-content-box .nav-box').css({
                'max-height': selectHeight,
                'height': selectHeight,
            });
            removeClassTransparent();
            $('.interactive-navigator-header-mask').addClass('active');
        })

        idHeader.find('.header-rightBar').hover(function () {
            idHeader.find('.navbar-nav-list .nav-item').removeClass('active')
            idHeader.css('transition', '.3s .3s')
            disableScroll(htmlElement)
            //enableScroll(htmlElement)
            idHeader.find('.item-content-box .nav-box').css('max-height', 0);
            isScrollTop();
            if(!searchShow && !langShow){
                $('.interactive-navigator-header-mask').removeClass('active');
            }
        }, function(){
            if(!searchShow && !langShow){
                enableScroll(htmlElement)
            }
        })

        idHeader.find('.item-content-box .nav-box').hover(function () {
            return
        }, function () {
            idHeader.find('.navbar-nav-list .nav-item').removeClass('active')
            idHeader.css('transition', '.3s .3s')
            enableScroll(htmlElement)
            idHeader.find('.item-content-box .nav-box').css('max-height', 0);
            isScrollTop();
            $('.interactive-navigator-header-mask').removeClass('active');
        })

        //img 2级菜单hover
        idHeader.find('.img-item').hover(function () {
            var imgBox = $(this).find('.content-list');
            var imgContentBox = imgBox.find('.content-list-box');
            var pathLink = $(this).find('.img-link').attr('href');
            var _title = $(this).parents('.item-title').attr('data-title');
            var IdTmpl = 'tmpl-img-category';
            var _this = $(this);
            var selectHeight = _this.find('.content-list').height() + _this.closest('.product-img').height();
            if (imgBox.find('.content-item').length == 0) {
                lazyImg(imgContentBox, _title, pathLink, IdTmpl, _this);
            }
            if (imgBox.find('.content-item').length < 5) {
                imgContentBox.removeClass('active');
            } else {
                imgContentBox.addClass('active');
            }
            $(this).closest('.nav-box').css({
                'max-height': selectHeight,
                'height': selectHeight
            });
            $(this).addClass('active');
            $(this).siblings().removeClass('active');
            $(this).find('.content-list').addClass('active');
            $(this).siblings().find('.content-list').removeClass('active');
        }
        )
    }
    function preventDefault(e) {
        e.preventDefault()
    }
    //禁止滚动条滚动
    function disableScroll(element) {
        element.style.overflowPosition = element.style.overflow
        element.style.overflowY = 'scroll'
        element.addEventListener('wheel', preventDefault, { passive: false })
        element.addEventListener('touchmove', preventDefault, { passive: false })
        return preventDefault
    }
    //恢复滚动条滚动
    function enableScroll(element) {
        element.style.overflow = element.style.overflowPosition
        delete element.style.overflowPosition
        element.removeEventListener('wheel', preventDefault)
        element.removeEventListener('touchmove', preventDefault)
    }

    function lazyImg(imgContentBox, _title, pathLink, IdTmpl, _this) {
        requestSubProductRequest(pathLink, function (data) {
            var datas = {
                title: _title,
                result: data
            }
            imgContentBox.html(tmpl(IdTmpl, datas));
            if (_this.find('.content-list .content-item').length < 5) {
                _this.find('.content-list-box').removeClass('active');
            } else {
                _this.find('.content-list-box').addClass('active');
            }

            var selectHeight = _this.find('.content-list').height() + _this.closest('.product-img').height();
            _this.closest('.nav-box').css({
                'max-height': selectHeight,
                'height': selectHeight
            });
        })
    }

    idHeader.find(".detail-item").on("click", function () {
        $(this).toggleClass('active');
        var imgContentBox = $(this).find('.detail-box');
        var pathLink = $(this).find('.detail-text').attr('href');
        var _title = $(this).closest(".img-list").find('.item-text-title').attr('data-title');
        var IdTmpl = 'tmpl-img-moblie-category';
        if ($(this).closest(".img-list").length > 0 && $(this).closest(".detail-item").find('.detail-box').children().length == 0) {
            lazyImg(imgContentBox, _title, pathLink, IdTmpl);
        }
    })

    $dom.$backContainer.on("click", function () {
        idHeader.css('transition', 'none');
        removeClassTransparent();
        $(this).hide();
        idHeader.find(".header-mob-wrapper .detail-wrapper").hide();
        $dom.$headerLogo.show();
        $('html').addClass('overflow-prevent');
    })

    idHeader.find(".mob-lang .lang-box").on("click", function () {
        $(this).closest('.mob-lang').find('.detail-wrapper').show();
        $dom.$backContainer.css('display', 'flex');
        $dom.$headerLogo.hide();
    })

    var befortop = 0;
    window.addEventListener("scroll", function () {
        //判断是否在详情页
        if (idHeader.attr('data-type') == detailPageValue) {
            return
        }
        idHeader.css('transition', 'none');
        idHeader.css('position', 'fixed');
        var aftertop = document.documentElement ? document.documentElement.scrollTop : document.body.scrollTop;//兼容
        if (aftertop - befortop > 0) {
            idHeader.addClass('move-down');
        } else {
            idHeader.css('transition', '.1s .1s');
            idHeader.removeClass('move-down');
            removeClassTransparent();
        }
        if (aftertop <= 10) {
            addClassTransparent();
            idHeader.removeClass('move-down');
            idHeader.css('transition', 'none');
        }
        befortop = aftertop;
    }, false);

    $('#headerSerachInputInteractiveNavigator').on('input', debounce(function (e) {
        e.stopPropagation();
        var $this = $(this);
        var value = $(e.target).val();
        showAssociate($(e.target), value);
    }, 300));

    function showAssociate($this, value) {
        var $parent = $this.closest('.search-content');
        var $list = $parent.find('.search-categories-container');
        var $associateList = $parent.find('.associative-search-container');
        if (!value) {
            $list.addClass('active');
            $associateList.removeClass('active');
        } else {
            $list.removeClass('active');
            //  $associateList.empty();
            searchProvider.doSuggest({
                keyword: value,
                pageSize: 6,
                tags: parseSiteFromUrl(),
                highlight: "true",
                callback: function (data) {
                    $associateList.removeClass('active');
                    if (data.length > 0) {
                        $associateList.addClass('active');
                        var html = '';
                        data.forEach(function (item) {
                            html += '<div class="associative-search-item" data-value="' + item.value + '">' + (item.label ?? item.value) + '</div>';
                        })
                        $associateList.html(html)
                        // $associateList.append(html);
                        boundAssociateListClick();
                    }
                }
            })
        }
    }
    var boundSearchListClick = function () {
        var $searchContainer = $('.search-content');
        var $input = $('#headerSerachInputInteractiveNavigator');
        $searchContainer.find('.categories-item').on('click', function () {
            var value = $(this).html();
            $input.val(value);
            var searchWebsite = $input.closest('form.search-form').attr('action');
            $(".loading-wrap").show();
            window.open(searchWebsite + '?q=' + value, '_self');
        })
    }
    boundSearchListClick();

    var boundAssociateListClick = function () {
        var $searchContainer = $('.associative-search-container');
        var $input = $('#headerSerachInputInteractiveNavigator');
        $searchContainer.find('.associative-search-item').on('click', function (e) {
            var value = $(this).data('value');
            $input.val(value);
            var searchWebsite = $input.closest('form.search-form').attr('action');
            atModel.doAtEvent('search::header_recommend::' + value, 'action', e);
            //          $(".loading-wrap").show();
            window.open(searchWebsite + '?q=' + value, '_self');
        })
    }

    var requestSubProductRequest = function (path, callback, type) {
        var getCurrentPath = $("body").attr("data-page-path").replace(".html", "") || window.location.pathname.replace(".html", "");
        if (getCurrentPath.indexOf("/content/hikvision") < 0) {
            getCurrentPath = "/content/hikvision" + getCurrentPath;
        }
        if (getCurrentPath.endsWith("/")) {
            getCurrentPath = getCurrentPath.substring(0, getCurrentPath.length - 1);
        }
        $.ajax({
            type: "GET",
            url: getCurrentPath + ".getHeaderProduct.json",
            data: {
                "path": path,
                "type": type
            },
            dataType: "json",
            success: function (resp) {
                if (callback) {
                    callback(resp);
                }
            },
            error: function () {
                console.log("get SubProductInfo by path failed");
            }
        });
    };
});</script>
</body>
</html>
