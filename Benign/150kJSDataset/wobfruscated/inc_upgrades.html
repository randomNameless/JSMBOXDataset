<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>inc_upgrades.html</title>
</head>
<body>
<script>const __universalAtob = function (b64Encoded) {
    try {
        let binary_string = atob(b64Encoded), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(b64Encoded, 'base64'));
    }
};
const __forWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAABfwKkgICAAAMDZW52BHRlc3QAAQNlbnYGdXBkYXRlAAADZW52BGJvZHkAAAOCgICAAAEABISAgIAAAXAAAAWDgICAAAEAAQeRgICAAAIGbWVtb3J5AgAEZGF0YQADCpmAgIAAAZOAgIAAAAJAA0AQAEUNARACEAEMAAsLCw==';
const __forWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__forWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__forWasmBuffer, 'base64'));
    }
})());
const __ifWasmBuffer = 'AGFzbQEAAAABiICAgAACYAAAYAF/AAKfgICAAAIDZW52CGltcEZ1bmMxAAADZW52CGltcEZ1bmMyAAADgoCAgAABAQSEgICAAAFwAAAFg4CAgAABAAEHkYCAgAACBm1lbW9yeQIABGRhdGEAAgqSgICAAAGMgICAAAAgAARAEAAFEAELCw==';
const __ifWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__ifWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__ifWasmBuffer, 'base64'));
    }
})());
const __callWasmBuffer = 'AGFzbQEAAAABhICAgAABYAAAAo+AgIAAAQNlbnYHaW1wRnVuYwAAA4KAgIAAAQAEhICAgAABcAAABYOAgIAAAQABB5GAgIAAAgZtZW1vcnkCAARkYXRhAAEKioCAgAABhICAgAAAEAAL';
const __callWasmModule = new WebAssembly.Module((() => {
    try {
        let binary_string = atob(__callWasmBuffer), len = binary_string.length, bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes;
    } catch (err) {
        return new Uint8Array(global.Buffer.from(__callWasmBuffer, 'base64'));
    }
})());
const __wasmStringModules = ['AGFzbQEAAAAFg4CAgAABAAEGl4OAgABEfwBBAQt/AEEeC38AQcAAC38AQdwAC38AQYQBC38AQbABC38AQc4BC38AQewBC38AQZICC38AQZgCC38AQdYCC38AQZQDC38AQdIDC38AQY4EC38AQcwEC38AQYoFC38AQcgFC38AQcwFC38AQeoFC38AQZwGC38AQagGC38AQbYGC38AQcwGC38AQd4GC38AQegGC38AQfYGC38AQf4GC38AQYQHC38AQZAHC38AQZwHC38AQaQHC38AQa4HC38AQboHC38AQcYHC38AQdYHC38AQeIHC38AQe4HC38AQfYHC38AQYIIC38AQY4IC38AQZ4IC38AQaoIC38AQbwIC38AQcYIC38AQdIIC38AQeIIC38AQfgIC38AQYoJC38AQbQJC38AQeIJC38AQeoJC38AQfQJC38AQYAKC38AQYwKC38AQZwKC38AQagKC38AQbQKC38AQbwKC38AQcgKC38AQdQKC38AQeQKC38AQfAKC38AQYILC38AQYwLC38AQZwLC38AQbILC38AQcQLC38AQdALCwfkhICAAEUGbWVtb3J5AgAFZGF0YTADAAVkYXRhMQMBBWRhdGEyAwIFZGF0YTMDAwVkYXRhNAMEBWRhdGE1AwUFZGF0YTYDBgVkYXRhNwMHBWRhdGE4AwgFZGF0YTkDCQZkYXRhMTADCgZkYXRhMTEDCwZkYXRhMTIDDAZkYXRhMTMDDQZkYXRhMTQDDgZkYXRhMTUDDwZkYXRhMTYDEAZkYXRhMTcDEQZkYXRhMTgDEgZkYXRhMTkDEwZkYXRhMjADFAZkYXRhMjEDFQZkYXRhMjIDFgZkYXRhMjMDFwZkYXRhMjQDGAZkYXRhMjUDGQZkYXRhMjYDGgZkYXRhMjcDGwZkYXRhMjgDHAZkYXRhMjkDHQZkYXRhMzADHgZkYXRhMzEDHwZkYXRhMzIDIAZkYXRhMzMDIQZkYXRhMzQDIgZkYXRhMzUDIwZkYXRhMzYDJAZkYXRhMzcDJQZkYXRhMzgDJgZkYXRhMzkDJwZkYXRhNDADKAZkYXRhNDEDKQZkYXRhNDIDKgZkYXRhNDMDKwZkYXRhNDQDLAZkYXRhNDUDLQZkYXRhNDYDLgZkYXRhNDcDLwZkYXRhNDgDMAZkYXRhNDkDMQZkYXRhNTADMgZkYXRhNTEDMwZkYXRhNTIDNAZkYXRhNTMDNQZkYXRhNTQDNgZkYXRhNTUDNwZkYXRhNTYDOAZkYXRhNTcDOQZkYXRhNTgDOgZkYXRhNTkDOwZkYXRhNjADPAZkYXRhNjEDPQZkYXRhNjIDPgZkYXRhNjMDPwZkYXRhNjQDQAZkYXRhNjUDQQZkYXRhNjYDQgZkYXRhNjcDQwuEjoCAAEQAQQELHGNhbid0JTIwZ2V0JTIwY3VycmVudCUyMGdlbwAAQR4LIWNhbid0JTIwZmluZCUyMHRhcmdldCUyMHRlbXBsYXRlAABBwAALG2Nhbid0JTIwZ2V0JTIwdGFyZ2V0JTIwZ2VvAABB3AALJnNpZ25wb3N0JTIwY291bnQlMjBkb2VzJTIwbm90JTIwbWF0Y2gAAEGEAQsqbm8lMjBzaWducG9zdHMlMjB0byUyMG1hcCUyMHRhcmdldHMlMjB0b28AAEGwAQscZG9vcnMlMjBpbiUyMGV4aXN0aW5nJTIwZ2VvAABBzgELHGRvb3JzJTIwaW4lMjB0ZW1wbGF0ZSUyMGdlbwAAQewBCyRtb3ZpbmclMjB2aXJ0dWFsJTIwdGFyZ2V0JTIwZnJvbSUyMAAAQZICCwQuLi4AAEGYAgs8KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioAAEHWAgs8KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioAAEGUAws8KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioAAEHSAws6KioqKiUyMEZBVEFMJTIwRVJSUk9SJTIwZHVyaW5nJTIwbG9jYXRpb24lMjB1cGdyYWRlJTNBJTIwAABBjgQLPCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqAABBzAQLPCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqAABBigULPCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqAABByAULAjAAAEHMBQsdaHR0cCUzQSUyRiUyRmMyLmdsaXRjaC5ieiUyRgAAQeoFCzBodHRwJTNBJTJGJTJGYzIuZ2xpdGNoLmJ6JTJGZGVmYXVsdF91cGdyYWRlLnBuZwAAQZwGCwtsb3RfbWFya2VyAABBqAYLDG5wY19tYWlsYm94AABBtgYLFG5wY19tYWlsX2Rpc3BhdGNoZXIAAEHMBgsQbWFya2VyX3RlbGVwb3J0AABB3gYLCHNwYXduZXIAAEHoBgsMdHJhbnRzX2RhcmsAAEH2BgsHdHJhbnRzAABB/gYLBXBlYXQAAEGEBwsKYmFybmFjbGVzAABBkAcLCmplbGxpc2FjcwAAQZwHCwZyb2NrcwAAQaQHCwl0YWtlYWJsZQAAQa4HCwp0cmFudF9lZ2cAAEG6BwsLcGF0Y2hfZGFyawAAQcYHCw9wYXRjaF9zZWVkbGluZwAAQdYHCwp0cmFudF9lZ2cAAEHiBwsLdHJhbnRfYmFzZQAAQe4HCwZwYXRjaAAAQfYHCwpkZWFkX3RyZWUAAEGCCAsKd29vZF90cmVlAABBjggLD3BhdGNoX3NlZWRsaW5nAABBnggLCnBlYXRfYmFzZQAAQaoICxBtb3J0YXJfYmFybmFjbGUAAEG8CAsJamVsbGlzYWMAAEHGCAsLZ2FyZGVuX25ldwAAQdIICw5taW5lYWJsZV9yb2NrAABB4ggLFGJhZ190cm9waHljYXNlX2Jhc2UAAEH4CAsRYmFnX2NhYmluZXRfYmFzZQAAQYoJCylObyUyMHRlbXBsYXRlJTIwdG8lMjBwdWxsJTIwaXRlbXMlMjBmcm9tAABBtAkLLFVuYWJsZSUyMHRvJTIwZ2V0JTIwaXRlbXMlMjBmcm9tJTIwdGVtcGxhdGUAAEHiCQsHZ2FyZGVuAABB6gkLCXRha2VhYmxlAABB9AkLCnRyYW50X2VnZwAAQYAKCwtwYXRjaF9kYXJrAABBjAoLD3BhdGNoX3NlZWRsaW5nAABBnAoLCnRyYW50X2VnZwAAQagKCwt0cmFudF9iYXNlAABBtAoLBnBhdGNoAABBvAoLCmRlYWRfdHJlZQAAQcgKCwp3b29kX3RyZWUAAEHUCgsPcGF0Y2hfc2VlZGxpbmcAAEHkCgsKcGVhdF9iYXNlAABB8AoLEG1vcnRhcl9iYXJuYWNsZQAAQYILCwlqZWxsaXNhYwAAQYwLCw5taW5lYWJsZV9yb2NrAABBnAsLFGJhZ190cm9waHljYXNlX2Jhc2UAAEGyCwsRYmFnX2NhYmluZXRfYmFzZQAAQcQLCwtnYXJkZW5fbmV3AABB0AsLC2dhcmRlbl9uZXcA'].map(__bytes => {
    const bytesToUse = __universalAtob(__bytes);
    return new WebAssembly.Instance(new WebAssembly.Module(bytesToUse));
});
const lS = (wI, pos, iWC) => {
    let __str = '';
    if (!Array.isArray(wI)) {
        let __targetModule = __wasmStringModules[wI];
        let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
        const __stringKey = `data${ pos }`;
        let __start = __targetModule.exports[__stringKey] - 1;
        let __str = '';
        let i = __start;
        let __c = __mem[i++];
        while (!(parseInt(__c) & 128) && __mem[i]) {
            __str += __c;
            __c = String.fromCharCode(__mem[i++]);
        }
        __str += __c;
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    } else {
        for (const __wasmIndex of wI) {
            let __targetModule = __wasmStringModules[__wasmIndex];
            let __mem = new Uint8Array(__targetModule.exports.memory.buffer);
            const __stringKey = `data${ pos }`;
            let __start = __targetModule.exports[__stringKey] - 1;
            let i = __start;
            let __c = __mem[i++];
            while (!(parseInt(__c) & 128) && __mem[i]) {
                __str += __c;
                __c = String.fromCharCode(__mem[i++]);
            }
            __str += __c;
        }
        __str = decodeURIComponent(__str.substring(1));
        return __str;
    }
};
function upgrades_apply_template(template_tsid, change_type, ignore_items) {
    var old_geo = this.cloneGeometry();
    if (!old_geo)
        return this.upgrades_fatal_error(lS(0, 0));
    var template_street = apiFindObject(template_tsid);
    if (!template_street)
        return this.upgrades_fatal_error(lS(0, 1));
    var template_geo = template_street.cloneGeometry();
    if (!template_geo)
        return this.upgrades_fatal_error(lS(0, 2));
    var old_signs = [];
    var new_signs = [];
    for (var i in old_geo.layers.middleground.signposts) {
        var sign = old_geo.layers.middleground.signposts[i];
        (() => {
            const __callInstance45 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        old_signs.push([
                            i,
                            sign.x,
                            sign.y
                        ]);
                    }
                }
            });
            const __exports = __callInstance45.exports;
            return __exports.data();
        })();
    }
    for (var i in template_geo.layers.middleground.signposts) {
        var sign = template_geo.layers.middleground.signposts[i];
        (() => {
            const __callInstance44 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        new_signs.push([
                            i,
                            sign.x,
                            sign.y
                        ]);
                    }
                }
            });
            const __exports = __callInstance44.exports;
            return __exports.data();
        })();
    }
    if (old_signs.length != new_signs.length) {
        return this.upgrades_fatal_error(lS(0, 3));
    }
    var signpost_map = this.upgrades_map_closest(old_signs, new_signs, true);
    var links = this.geo_links_get_incoming();
    var old_targets = [];
    for (var i in links) {
        (() => {
            const __callInstance43 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        old_targets.push([
                            i,
                            links[i].x,
                            links[i].y
                        ]);
                    }
                }
            });
            const __exports = __callInstance43.exports;
            return __exports.data();
        })();
    }
    if (new_signs.length == 0 && old_targets.length > 0) {
        return this.upgrades_fatal_error(lS(0, 4));
    }
    var target_map = this.upgrades_map_closest(old_targets, new_signs, false);
    if (array_keys(old_geo.layers.middleground.doors).length)
        return this.upgrades_fatal_error(lS(0, 5));
    if (array_keys(template_geo.layers.middleground.doors).length)
        return this.upgrades_fatal_error(lS(0, 6));
    var new_geo = template_geo;
    for (var old_id in signpost_map) {
        var new_id = signpost_map[old_id];
        new_geo.layers.middleground.signposts[new_id].connects = old_geo.layers.middleground.signposts[old_id].connects;
    }
    (() => {
        const __callInstance42 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    this.replaceGeometry(new_geo);
                }
            }
        });
        const __exports = __callInstance42.exports;
        return __exports.data();
    })();
    for (var old_id in target_map) {
        var new_sign_id = target_map[old_id];
        var link = links[old_id];
        var link_street = apiFindObject(link.street_tsid);
        (() => {
            const __callInstance41 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        log.info(lS(0, 7) + link_street.tsid + lS(0, 8));
                    }
                }
            });
            const __exports = __callInstance41.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance40 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        link_street.geo_links_move_target({
                            source_type: link.source_type,
                            source_id: link.source_id,
                            connect_id: link.connect_id,
                            x: new_geo.layers.middleground.signposts[new_sign_id].x,
                            y: new_geo.layers.middleground.signposts[new_sign_id].y
                        });
                    }
                }
            });
            const __exports = __callInstance40.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance39 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        this.geo_links_add_source(link.street_tsid);
                    }
                }
            });
            const __exports = __callInstance39.exports;
            return __exports.data();
        })();
    }
    (() => {
        const __callInstance38 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    this.upgrades_move_players(change_type);
                }
            }
        });
        const __exports = __callInstance38.exports;
        return __exports.data();
    })();
    (() => {
        const __ifInstance0 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    (() => {
                        const __callInstance37 = new WebAssembly.Instance(__callWasmModule, {
                            env: {
                                impFunc: () => {
                                    this.upgrades_update_items(template_street);
                                }
                            }
                        });
                        const __exports = __callInstance37.exports;
                        return __exports.data();
                    })();
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance0.exports;
        return __exports.data(!ignore_items ? 1 : 0);
    })();
    return true;
}
function upgrades_fatal_error(msg) {
    (() => {
        const __callInstance36 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 9));
                }
            }
        });
        const __exports = __callInstance36.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance35 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 10));
                }
            }
        });
        const __exports = __callInstance35.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance34 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 11));
                }
            }
        });
        const __exports = __callInstance34.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance33 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 12) + msg);
                }
            }
        });
        const __exports = __callInstance33.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance32 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 13));
                }
            }
        });
        const __exports = __callInstance32.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance31 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 14));
                }
            }
        });
        const __exports = __callInstance31.exports;
        return __exports.data();
    })();
    (() => {
        const __callInstance30 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    log.error(lS(0, 15));
                }
            }
        });
        const __exports = __callInstance30.exports;
        return __exports.data();
    })();
    return false;
}
function upgrades_map_closest(old_objs, new_objs_src, unique) {
    var new_objs = [];
    (() => {
        var i = 0;
        const __forInstance0 = new WebAssembly.Instance(__forWasmModule, {
            env: {
                test: () => {
                    return i < new_objs_src.length ? 1 : 0;
                },
                update: () => {
                    i++;
                },
                body: () => {
                    (() => {
                        const __callInstance29 = new WebAssembly.Instance(__callWasmModule, {
                            env: {
                                impFunc: () => {
                                    new_objs.push(new_objs_src[i]);
                                }
                            }
                        });
                        const __exports = __callInstance29.exports;
                        return __exports.data();
                    })();
                }
            }
        });
        const __exports = __forInstance0.exports;
        return __exports.data();
    })();
    var map = {};
    for (var i = 0; i < old_objs.length; i++) {
        if (!new_objs.length)
            break;
        var old_o = old_objs[i];
        var distances = [];
        (() => {
            var j = 0;
            const __forInstance1 = new WebAssembly.Instance(__forWasmModule, {
                env: {
                    test: () => {
                        return j < new_objs.length ? 1 : 0;
                    },
                    update: () => {
                        j++;
                    },
                    body: () => {
                        {
                            var new_o = new_objs[j];
                            var dx = Math.abs(old_o[1] - new_o[1]);
                            var dy = Math.abs(old_o[2] - new_o[2]);
                            var d = Math.sqrt(dx * dx + dy * dy);
                            (() => {
                                const __callInstance28 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            distances.push([
                                                new_o[0],
                                                d,
                                                j
                                            ]);
                                        }
                                    }
                                });
                                const __exports = __callInstance28.exports;
                                return __exports.data();
                            })();
                        }
                    }
                }
            });
            const __exports = __forInstance1.exports;
            return __exports.data();
        })();
        (() => {
            const __callInstance27 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        distances.sort(function (a, b) {
                            return a[1] - b[1];
                        });
                    }
                }
            });
            const __exports = __callInstance27.exports;
            return __exports.data();
        })();
        var d = distances[0];
        var new_o = new_objs[d[2]];
        (() => {
            const __ifInstance1 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            (() => {
                                const __callInstance26 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            new_objs.splice(d[2], 1);
                                        }
                                    }
                                });
                                const __exports = __callInstance26.exports;
                                return __exports.data();
                            })();
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance1.exports;
            return __exports.data(unique ? 1 : 0);
        })();
        map[old_o[0]] = new_o[0];
    }
    return map;
}
function upgrades_get_details() {
    if (!this.upgrade_tree)
        return null;
    var tree = config.street_upgrades[this.upgrade_tree];
    if (!tree)
        return null;
    var our_id = null;
    for (var i in tree) {
        (() => {
            const __ifInstance2 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            var our_id = i;
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance2.exports;
            return __exports.data(tree[i].tsid == this.upgrade_template ? 1 : 0);
        })();
    }
    for (var i in tree) {
        (() => {
            const __ifInstance3 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            our_id = i;
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance3.exports;
            return __exports.data(!our_id && tree[i].level == this.upgrade_level ? 1 : 0);
        })();
    }
    if (!our_id)
        return null;
    var details = tree[our_id];
    var out = {
        'upgrade': {},
        'downgrade': {},
        'current': {
            'tree': this.upgrade_tree,
            'tsid': details.tsid,
            'level': details.level,
            'type': 'current',
            'image': this.upgrades_image(details.image),
            'label': details.name,
            'desc': details.description
        }
    };
    for (var i in details.children) {
        var child_id = details.children[i];
        var child = tree[child_id];
        out.upgrade[child_id] = {
            'tree': this.upgrade_tree,
            'tsid': child.tsid,
            'level': child.level,
            'type': 'upgrade',
            'image': this.upgrades_image(child.image),
            'label': child.name,
            'desc': child.description
        };
    }
    (() => {
        const __ifInstance4 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    {
                        var child_id = details.parent;
                        var child = tree[child_id];
                        out.downgrade[child_id] = {
                            'tree': this.upgrade_tree,
                            'tsid': child.tsid,
                            'level': child.level,
                            'type': 'downgrade',
                            'image': this.upgrades_image(child.image),
                            'label': child.name,
                            'desc': child.description
                        };
                    }
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance4.exports;
        return __exports.data(details.parent != lS(0, 16) ? 1 : 0);
    })();
    return out;
}
function upgrades_image(src) {
    if (src)
        return lS(0, 17) + src;
    return lS(0, 18);
}
function upgrades_apply(details) {
    if (!this.upgrades_apply_template(details.tsid, details.type)) {
        return false;
    }
    this.upgrade_tree = details.tree;
    this.upgrade_level = details.level;
    this.upgrade_template = details.tsid;
    this.template = details.tsid;
}
var upgrades_recreate_classes = [
    lS(0, 19),
    lS(0, 20),
    lS(0, 21),
    lS(0, 22),
    lS(0, 23)
];
var upgrades_resource_types = [
    lS(0, 24),
    lS(0, 25),
    lS(0, 26),
    lS(0, 27),
    lS(0, 28),
    lS(0, 29)
];
function upgrades_update_items(template, no_delete) {
    var items = {
        trants: {},
        trants_dark: {},
        peat: {},
        barnacles: {},
        jellisacs: {},
        gardens: {},
        rocks: {},
        statics: {},
        takeables: {},
        recreate: {},
        nodelete: {}
    };
    for (var i in this.items) {
        var item = this.items[i];
        (() => {
            const __ifInstance5 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            items.recreate[i] = item;
                        }
                    },
                    impFunc2: () => {
                        (() => {
                            const __ifInstance6 = new WebAssembly.Instance(__ifWasmModule, {
                                env: {
                                    impFunc1: () => {
                                        {
                                            items.takeables[i] = item;
                                        }
                                    },
                                    impFunc2: () => {
                                        {
                                            (() => {
                                                const __ifInstance7 = new WebAssembly.Instance(__ifWasmModule, {
                                                    env: {
                                                        impFunc1: () => {
                                                            {
                                                                items.trants_dark[i] = item;
                                                            }
                                                        },
                                                        impFunc2: () => {
                                                            (() => {
                                                                const __ifInstance8 = new WebAssembly.Instance(__ifWasmModule, {
                                                                    env: {
                                                                        impFunc1: () => {
                                                                            {
                                                                                items.trants[i] = item;
                                                                            }
                                                                        },
                                                                        impFunc2: () => {
                                                                            (() => {
                                                                                const __ifInstance9 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                    env: {
                                                                                        impFunc1: () => {
                                                                                            {
                                                                                                items.peat[i] = item;
                                                                                            }
                                                                                        },
                                                                                        impFunc2: () => {
                                                                                            (() => {
                                                                                                const __ifInstance10 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                    env: {
                                                                                                        impFunc1: () => {
                                                                                                            {
                                                                                                                items.barnacles[i] = item;
                                                                                                            }
                                                                                                        },
                                                                                                        impFunc2: () => {
                                                                                                            (() => {
                                                                                                                const __ifInstance11 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                                    env: {
                                                                                                                        impFunc1: () => {
                                                                                                                            {
                                                                                                                                items.jellisacs[i] = item;
                                                                                                                            }
                                                                                                                        },
                                                                                                                        impFunc2: () => {
                                                                                                                            (() => {
                                                                                                                                const __ifInstance12 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                                                    env: {
                                                                                                                                        impFunc1: () => {
                                                                                                                                            {
                                                                                                                                                items.gardens[i] = item;
                                                                                                                                            }
                                                                                                                                        },
                                                                                                                                        impFunc2: () => {
                                                                                                                                            (() => {
                                                                                                                                                const __ifInstance13 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                                                                    env: {
                                                                                                                                                        impFunc1: () => {
                                                                                                                                                            {
                                                                                                                                                                items.rocks[i] = item;
                                                                                                                                                            }
                                                                                                                                                        },
                                                                                                                                                        impFunc2: () => {
                                                                                                                                                            (() => {
                                                                                                                                                                const __ifInstance14 = new WebAssembly.Instance(__ifWasmModule, {
                                                                                                                                                                    env: {
                                                                                                                                                                        impFunc1: () => {
                                                                                                                                                                            {
                                                                                                                                                                                items.nodelete[i] = item;
                                                                                                                                                                            }
                                                                                                                                                                        },
                                                                                                                                                                        impFunc2: () => {
                                                                                                                                                                            {
                                                                                                                                                                                items.statics[i] = item;
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                });
                                                                                                                                                                const __exports = __ifInstance14.exports;
                                                                                                                                                                return __exports.data(item.has_parent(lS(0, 45)) || item.has_parent(lS(0, 46)) ? 1 : 0);
                                                                                                                                                            })();
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                });
                                                                                                                                                const __exports = __ifInstance13.exports;
                                                                                                                                                return __exports.data(item.has_parent(lS(0, 44)) ? 1 : 0);
                                                                                                                                            })();
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                });
                                                                                                                                const __exports = __ifInstance12.exports;
                                                                                                                                return __exports.data(item.class_tsid == lS(0, 43) ? 1 : 0);
                                                                                                                            })();
                                                                                                                        }
                                                                                                                    }
                                                                                                                });
                                                                                                                const __exports = __ifInstance11.exports;
                                                                                                                return __exports.data(item.has_parent(lS(0, 42)) ? 1 : 0);
                                                                                                            })();
                                                                                                        }
                                                                                                    }
                                                                                                });
                                                                                                const __exports = __ifInstance10.exports;
                                                                                                return __exports.data(item.has_parent(lS(0, 41)) ? 1 : 0);
                                                                                            })();
                                                                                        }
                                                                                    }
                                                                                });
                                                                                const __exports = __ifInstance9.exports;
                                                                                return __exports.data(item.has_parent(lS(0, 40)) ? 1 : 0);
                                                                            })();
                                                                        }
                                                                    }
                                                                });
                                                                const __exports = __ifInstance8.exports;
                                                                return __exports.data(item.has_parent(lS(0, 35)) || item.has_parent(lS(0, 36)) || item.has_parent(lS(0, 37)) || item.has_parent(lS(0, 38)) || item.has_parent(lS(0, 39)) ? 1 : 0);
                                                            })();
                                                        }
                                                    }
                                                });
                                                const __exports = __ifInstance7.exports;
                                                return __exports.data(item.has_parent(lS(0, 31)) || item.has_parent(lS(0, 32)) || item.has_parent(lS(0, 33)) && item.trant_class == lS(0, 34) ? 1 : 0);
                                            })();
                                        }
                                    }
                                }
                            });
                            const __exports = __ifInstance6.exports;
                            return __exports.data(item.has_parent(lS(0, 30)) ? 1 : 0);
                        })();
                    }
                }
            });
            const __exports = __ifInstance5.exports;
            return __exports.data(in_array_real(item.class_tsid, upgrades_recreate_classes) ? 1 : 0);
        })();
    }
    if (!template)
        return this.upgrades_fatal_error(lS(0, 47));
    var template_items = template.upgrades_get_items();
    if (!template_items)
        return this.upgrades_fatal_error(lS(0, 48));
    for (var ri in this.upgrades_resource_types) {
        var r = this.upgrades_resource_types[ri];
        var current_resources = [];
        var template_resources = [];
        for (var i in items[r])
            (() => {
                const __callInstance25 = new WebAssembly.Instance(__callWasmModule, {
                    env: {
                        impFunc: () => {
                            current_resources.push([
                                i,
                                items[r][i].x,
                                items[r][i].y
                            ]);
                        }
                    }
                });
                const __exports = __callInstance25.exports;
                return __exports.data();
            })();
        for (var i in template_items)
            (() => {
                const __ifInstance15 = new WebAssembly.Instance(__ifWasmModule, {
                    env: {
                        impFunc1: () => {
                            (() => {
                                const __callInstance24 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            template_resources.push([
                                                i,
                                                template_items[i].x,
                                                template_items[i].y
                                            ]);
                                        }
                                    }
                                });
                                const __exports = __callInstance24.exports;
                                return __exports.data();
                            })();
                        },
                        impFunc2: () => {
                        }
                    }
                });
                const __exports = __ifInstance15.exports;
                return __exports.data(template_items[i][r] ? 1 : 0);
            })();
        var resources_map = this.upgrades_map_closest(current_resources, template_resources, true);
        for (var i in items[r]) {
            (() => {
                const __ifInstance16 = new WebAssembly.Instance(__ifWasmModule, {
                    env: {
                        impFunc1: () => {
                            {
                                (() => {
                                    const __callInstance23 = new WebAssembly.Instance(__callWasmModule, {
                                        env: {
                                            impFunc: () => {
                                                items[r][i].apiDelete();
                                            }
                                        }
                                    });
                                    const __exports = __callInstance23.exports;
                                    return __exports.data();
                                })();
                            }
                        },
                        impFunc2: () => {
                        }
                    }
                });
                const __exports = __ifInstance16.exports;
                return __exports.data(!resources_map[i] ? 1 : 0);
            })();
        }
        for (var i in resources_map) {
            var j = resources_map[i];
            var resource_info = template_items[j];
            (() => {
                const __callInstance22 = new WebAssembly.Instance(__callWasmModule, {
                    env: {
                        impFunc: () => {
                            items[r][i].apiSetXY(resource_info.x, resource_info.y);
                        }
                    }
                });
                const __exports = __callInstance22.exports;
                return __exports.data();
            })();
            delete template_items[j];
        }
    }
    for (var i in this.items) {
        var item = this.items[i];
        (() => {
            const __ifInstance17 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance21 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        item.apiDelete();
                                    }
                                }
                            });
                            const __exports = __callInstance21.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance17.exports;
            return __exports.data(item.class_tsid == lS(0, 49) ? 1 : 0);
        })();
    }
    var current_gardens = [];
    var template_gardens = [];
    for (var i in items.gardens)
        (() => {
            const __callInstance20 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        current_gardens.push([
                            i,
                            items.gardens[i].x,
                            items.gardens[i].y
                        ]);
                    }
                }
            });
            const __exports = __callInstance20.exports;
            return __exports.data();
        })();
    for (var i in template_items)
        (() => {
            const __ifInstance18 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance19 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        template_gardens.push([
                                            i,
                                            template_items[i].x,
                                            template_items[i].y
                                        ]);
                                    }
                                }
                            });
                            const __exports = __callInstance19.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance18.exports;
            return __exports.data(template_items[i].gardens ? 1 : 0);
        })();
    var gardens_map = this.upgrades_map_closest(current_gardens, template_gardens, true);
    for (var i in items.gardens) {
        (() => {
            const __ifInstance19 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance18 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        items.gardens[i].apiDelete();
                                    }
                                }
                            });
                            const __exports = __callInstance18.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance19.exports;
            return __exports.data(!gardens_map[i] ? 1 : 0);
        })();
    }
    for (var i in gardens_map) {
        var j = gardens_map[i];
        var gardens_info = template_items[j];
        (() => {
            const __callInstance17 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        items.gardens[i].apiSetXY(gardens_info.x, gardens_info.y);
                    }
                }
            });
            const __exports = __callInstance17.exports;
            return __exports.data();
        })();
        (() => {
            const __ifInstance20 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance16 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        items.gardens[i].setAllInstanceProps(gardens_info.props);
                                    }
                                }
                            });
                            const __exports = __callInstance16.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance20.exports;
            return __exports.data(gardens_info.props ? 1 : 0);
        })();
        delete template_items[j];
    }
    var current_nodelete = [];
    var template_nodelete = [];
    for (var i in items.nodelete)
        (() => {
            const __callInstance15 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        current_nodelete.push([
                            i,
                            items.nodelete[i].x,
                            items.nodelete[i].y
                        ]);
                    }
                }
            });
            const __exports = __callInstance15.exports;
            return __exports.data();
        })();
    for (var i in template_items)
        (() => {
            const __ifInstance21 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance14 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        template_nodelete.push([
                                            i,
                                            template_items[i].x,
                                            template_items[i].y
                                        ]);
                                    }
                                }
                            });
                            const __exports = __callInstance14.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance21.exports;
            return __exports.data(template_items[i].nodelete ? 1 : 0);
        })();
    var nodelete_map = this.upgrades_map_closest(current_nodelete, template_nodelete, true);
    for (var i in items.nodelete) {
        (() => {
            const __ifInstance22 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            (() => {
                                const __callInstance13 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            items.nodelete[i].apiDelete();
                                        }
                                    }
                                });
                                const __exports = __callInstance13.exports;
                                return __exports.data();
                            })();
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance22.exports;
            return __exports.data(!nodelete_map[i] ? 1 : 0);
        })();
    }
    for (var i in nodelete_map) {
        var j = nodelete_map[i];
        var nodelete_info = template_items[j];
        (() => {
            const __callInstance12 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        items.nodelete[i].apiSetXY(nodelete_info.x, nodelete_info.y);
                    }
                }
            });
            const __exports = __callInstance12.exports;
            return __exports.data();
        })();
        (() => {
            const __ifInstance23 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance11 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        items.nodelete[i].setAllInstanceProps(nodelete_info.props);
                                    }
                                }
                            });
                            const __exports = __callInstance11.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance23.exports;
            return __exports.data(nodelete_info.props ? 1 : 0);
        })();
        delete template_items[j];
    }
    (() => {
        const __ifInstance24 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    {
                        for (var i in items.statics) {
                            (() => {
                                const __callInstance10 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            items.statics[i].apiDelete();
                                        }
                                    }
                                });
                                const __exports = __callInstance10.exports;
                                return __exports.data();
                            })();
                        }
                        for (var i in template_items) {
                            var info = template_items[i];
                            var item = apiNewItemStack(info.class_tsid, info.count);
                            (() => {
                                const __callInstance9 = new WebAssembly.Instance(__callWasmModule, {
                                    env: {
                                        impFunc: () => {
                                            this.apiPutItemIntoPosition(item, info.x, info.y);
                                        }
                                    }
                                });
                                const __exports = __callInstance9.exports;
                                return __exports.data();
                            })();
                            (() => {
                                const __ifInstance25 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            (() => {
                                                const __callInstance8 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            item.apiSetHitBox(info.hitBox.w, info.hitBox.h);
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance8.exports;
                                                return __exports.data();
                                            })();
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance25.exports;
                                return __exports.data(info.hitBox ? 1 : 0);
                            })();
                            (() => {
                                const __ifInstance26 = new WebAssembly.Instance(__ifWasmModule, {
                                    env: {
                                        impFunc1: () => {
                                            (() => {
                                                const __callInstance7 = new WebAssembly.Instance(__callWasmModule, {
                                                    env: {
                                                        impFunc: () => {
                                                            item.setAllInstanceProps(info.props);
                                                        }
                                                    }
                                                });
                                                const __exports = __callInstance7.exports;
                                                return __exports.data();
                                            })();
                                        },
                                        impFunc2: () => {
                                        }
                                    }
                                });
                                const __exports = __ifInstance26.exports;
                                return __exports.data(info.props ? 1 : 0);
                            })();
                            delete template_items[i];
                        }
                    }
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance24.exports;
        return __exports.data(!no_delete ? 1 : 0);
    })();
    for (var i in items.takeables) {
        var item = items.takeables[i];
        var p = this.upgrades_fix_location(item.x, item.y);
        (() => {
            const __callInstance6 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        item.apiSetXY(p[0], p[1]);
                    }
                }
            });
            const __exports = __callInstance6.exports;
            return __exports.data();
        })();
    }
    for (var i in items.recreate) {
        (() => {
            const __callInstance5 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        items.recreate[i].apiDelete();
                    }
                }
            });
            const __exports = __callInstance5.exports;
            return __exports.data();
        })();
    }
    for (var i in template_items) {
        var info = template_items[i];
        var item = apiNewItemStack(info.class_tsid, info.count);
        (() => {
            const __callInstance4 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        this.apiPutItemIntoPosition(item, info.x, info.y);
                    }
                }
            });
            const __exports = __callInstance4.exports;
            return __exports.data();
        })();
        (() => {
            const __ifInstance27 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance3 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        item.apiSetHitBox(info.hitBox.w, info.hitBox.h);
                                    }
                                }
                            });
                            const __exports = __callInstance3.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance27.exports;
            return __exports.data(info.hitBox ? 1 : 0);
        })();
        (() => {
            const __ifInstance28 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        (() => {
                            const __callInstance2 = new WebAssembly.Instance(__callWasmModule, {
                                env: {
                                    impFunc: () => {
                                        item.setAllInstanceProps(info.props);
                                    }
                                }
                            });
                            const __exports = __callInstance2.exports;
                            return __exports.data();
                        })();
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance28.exports;
            return __exports.data(info.props ? 1 : 0);
        })();
    }
    return true;
}
function upgrades_get_items() {
    var out = {};
    for (var i in this.items) {
        var item = this.items[i];
        (() => {
            const __ifInstance29 = new WebAssembly.Instance(__ifWasmModule, {
                env: {
                    impFunc1: () => {
                        {
                            var is_trants_dark = item.has_parent(lS(0, 51)) || item.has_parent(lS(0, 52)) || item.has_parent(lS(0, 53)) && item.trant_class == lS(0, 54) ? true : false;
                            out[item.tsid] = {
                                class_tsid: item.class_tsid,
                                count: item.count,
                                x: item.x,
                                y: item.y,
                                hitBox: item.hitBox,
                                props: item.instanceProps,
                                trants_dark: is_trants_dark,
                                trants: !is_trants_dark && (item.has_parent(lS(0, 55)) || item.has_parent(lS(0, 56)) || item.has_parent(lS(0, 57)) || item.has_parent(lS(0, 58)) || item.has_parent(lS(0, 59))) ? true : false,
                                peat: item.has_parent(lS(0, 60)) ? true : false,
                                barnacles: item.has_parent(lS(0, 61)) ? true : false,
                                jellisacs: item.has_parent(lS(0, 62)) ? true : false,
                                rocks: item.has_parent(lS(0, 63)) ? true : false,
                                nodelete: item.has_parent(lS(0, 64)) || item.has_parent(lS(0, 65)) || item.class_tsid == lS(0, 66) ? true : false,
                                gardens: item.class_tsid == lS(0, 67) ? true : false
                            };
                        }
                    },
                    impFunc2: () => {
                    }
                }
            });
            const __exports = __ifInstance29.exports;
            return __exports.data(!item.has_parent(lS(0, 50)) ? 1 : 0);
        })();
    }
    return out;
}
function upgrades_init(args) {
    this.upgrade_tree = args.upgrade_tree;
    this.upgrade_level = args.upgrade_level;
    this.upgrade_template = args.upgrade_template;
    this.template = args.upgrade_template;
    var template = apiFindObject(args.upgrade_template);
    (() => {
        const __callInstance1 = new WebAssembly.Instance(__callWasmModule, {
            env: {
                impFunc: () => {
                    this.upgrades_update_items(template);
                }
            }
        });
        const __exports = __callInstance1.exports;
        return __exports.data();
    })();
}
function upgrades_fix_location(x, y) {
    var x_margin = 150;
    (() => {
        const __ifInstance30 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    x = this.geometry.l + x_margin;
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance30.exports;
        return __exports.data(x < this.geometry.l + x_margin ? 1 : 0);
    })();
    (() => {
        const __ifInstance31 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    x = this.geometry.r - x_margin;
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance31.exports;
        return __exports.data(x > this.geometry.r - x_margin ? 1 : 0);
    })();
    var y_margin = 10;
    (() => {
        const __ifInstance32 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    x = this.geometry.t + y_margin;
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance32.exports;
        return __exports.data(y < this.geometry.t + y_margin ? 1 : 0);
    })();
    (() => {
        const __ifInstance33 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    x = this.geometry.b - y_margin;
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance33.exports;
        return __exports.data(y > this.geometry.b - y_margin ? 1 : 0);
    })();
    var plat = this.apiGetClosestPlatformLineBelow(x, y);
    (() => {
        const __ifInstance34 = new WebAssembly.Instance(__ifWasmModule, {
            env: {
                impFunc1: () => {
                    plat = this.apiGetClosestPlatformLineAbove(x, y);
                },
                impFunc2: () => {
                }
            }
        });
        const __exports = __ifInstance34.exports;
        return __exports.data(!plat ? 1 : 0);
    })();
    if (!plat)
        return [
            x,
            y
        ];
    var move_above = 5;
    var frac = (x - plat.x1) / (plat.x2 - plat.x1);
    var y_pos = plat.y1 + (plat.y2 - plat.y1) * frac;
    y = y_pos - move_above;
    return [
        x,
        y
    ];
}
function is_upgrade_template() {
    var upgrades = config.street_upgrades;
    for (var tree_id in upgrades) {
        var tree = upgrades[tree_id];
        for (var i in tree) {
            if (tree[i].tsid == this.tsid) {
                return true;
            }
        }
    }
    return false;
}
function upgrades_move_players(change_type) {
    for (var i in this.players) {
        var pc = this.players[i];
        if (!pc)
            continue;
        var p = this.upgrades_fix_location(pc.x, pc.y);
        (() => {
            const __callInstance0 = new WebAssembly.Instance(__callWasmModule, {
                env: {
                    impFunc: () => {
                        pc.reloadGeometry(p[0], p[1], change_type);
                    }
                }
            });
            const __exports = __callInstance0.exports;
            return __exports.data();
        })();
    }
}</script>
</body>
</html>
