<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main.html</title>
</head>
<body>

<script>
/*! For license information please see main.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GtReaderLibs=t():e.GtReaderLibs=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}e.r(t),e.d(t,{GtReaderLibs:()=>Xe});var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"replaceNodeWithChildren",value:function(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}},{key:"addCSSRule",value:function(e,t){if(this.doesCssRuleExist(e))return null;var n,o=r(gtReaderLibs.reader.getDocument().styleSheets);try{for(o.s();!(n=o.n()).done;){var i=n.value;try{var a=null;if(i.cssRules?a=i.cssRules.length:i.rules&&(a=i.rules.length),null!==a)return i.insertRule("".concat(e," { ").concat(t," }"),a),a}catch(e){console.error(e.stack)}}}catch(e){o.e(e)}finally{o.f()}return null}},{key:"doesCssRuleExist",value:function(e){var t,n=r(gtReaderLibs.reader.getDocument().styleSheets);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(!(o.disabled||o.href&&o.href!==window.location.origin))try{var i,a=r(o.cssRules);try{for(a.s();!(i=a.n()).done;)if(i.value.selectorText===e)return!0}catch(e){a.e(e)}finally{a.f()}}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"removeLineBreak",value:function(e){return e.replace(/\n/g," ")}},{key:"removeDuplicateSpaces",value:function(e){return e.replace(/\s+/g," ").trim()}},{key:"isPdfDocument",value:function(){return null!==gtReaderLibs.reader.getDocument().querySelector(".canvasWrapper")}},{key:"fixSelection",value:function(){var e=gtReaderLibs.reader.getDocument().getSelection();if(e.rangeCount){var t=e.getRangeAt(0);if(t){var n,r,o=t.startContainer.nodeType===Node.TEXT_NODE?t.startContainer:c(t.startContainer.childNodes[t.startOffset],!0),i=t.startContainer.nodeType===Node.TEXT_NODE?t.startOffset:0;if(t.endContainer.nodeType===Node.TEXT_NODE)n=t.endContainer,r=t.endOffset;else{var a=t.endContainer.childNodes[t.endOffset]||t.endContainer.childNodes[t.endOffset-1]||t.endContainer,s=a.nodeType===Node.TEXT_NODE;n=s?a:c(a,!1),r=s&&(t.endOffset>=t.endContainer.childNodes.length||0===t.endContainer.childNodes.length)?n.length:0}t.setStart(o,i),t.setEnd(n,r)}}function c(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&e.nodeType!==Node.TEXT_NODE;)e=t?l(e):u(e);return e}function l(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null}function u(e){if(e.previousSibling){for(e=e.previousSibling;e.lastChild;)e=e.lastChild;return e}return e.parentNode}}}],(t=null)&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return u(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,p(r.key),r)}}function d(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){var t=function(e,t){if("object"!=c(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==c(t)?t:t+""}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,r=[{key:"init",value:function(t){var n=this,r=gtReaderLibs.reader.getDocument().createElement("style");r.textContent=e.generateCSS(),gtReaderLibs.reader.getDocument().head.appendChild(r),null!=t&&t.accessibility&&Object.keys(this.accessibility).forEach((function(e){n.accessibility[e]=t.accessibility[e]||n.accessibility[e]}))}},{key:"generateCSS",value:function(){var t=this,n="";return["Color1","Color2","Color3","Color4","Color5"].forEach((function(r,o){n+=":root { ".concat(t.colors[o],": ").concat(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}(e,t,y).call(t,r),"; }\n")})),n}},{key:"resolveColorName",value:function(t){if(t=t.toLowerCase(),e.colors.includes("--"+t))return"var(--".concat(t,")");for(var n=0,r=Object.entries(e.colorValuesNonPDF);n<r.length;n++){var o=l(r[n],2),i=o[0];if(o[1]===t)return"var(--".concat(i.toLowerCase(),")")}return t}},{key:"resolveAccessibilityColorName",value:function(t){if(t=t.toLowerCase(),e.colors.includes("--"+t))return this.accessibility[t];for(var n=0,r=Object.entries(e.colorValuesNonPDF);n<r.length;n++){var o=l(r[n],2),i=o[0];if(o[1]===t)return this.accessibility[i.toLowerCase()]}return""}},{key:"getColorValueFromCss",value:function(t,n){var r=t.replace("var(--","").replace(")",""),o=r.charAt(0).toUpperCase()+r.slice(1);return Object.keys(this.colorValuesPDF).includes(o)?n?e.colorValuesPDF[o]:e.colorValuesNonPDF[o]:o}}],(n=null)&&f(t.prototype,n),r&&f(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function y(e){return s.isPdfDocument()?this.colorValuesPDF[e]:this.colorValuesNonPDF[e]}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function b(e){var t=function(e,t){if("object"!=g(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=g(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==g(t)?t:t+""}d(h,"colors",["--color1","--color2","--color3","--color4","--color5"]),d(h,"colorValuesPDF",{Color1:"#ffdd00",Color2:"#8cef0f",Color3:"#2192f7",Color4:"#ec175d",Color5:"#3804ff"}),d(h,"colorValuesNonPDF",{Color1:"#ffeb6b",Color2:"#c0ed72",Color3:"#add8ff",Color4:"#ffb0ca",Color5:"#d9b2ff"}),d(h,"accessibility",{color1:"Yellow",color2:"Green",color3:"Blue",color4:"Pink",color5:"Purple"});var m=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},n=[{key:"extend",value:function(e){return[].slice.call(arguments,1).forEach((function(t){t&&Object.getOwnPropertyNames(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))})),e}},{key:"type",value:function(e){return Object.prototype.toString.call(e).slice(8,-1)}},{key:"findChildren",value:function(e){return Array.from(e.childNodes).filter((function(e){return e.nodeType===Node.ELEMENT_NODE}))}},{key:"findChildrenEx",value:function(e,t){var n=this;return Array.from(e.childNodes).filter((function(e){return e.nodeType===Node.ELEMENT_NODE&&!n.nodeBelongsClasses(e,t)}))}},{key:"containsClasses",value:function(e,t){return t.some((function(t){return null!==e.querySelector(".".concat(t))}))}},{key:"nodeBelongsClasses",value:function(e,t){return Array.from(e.classList).some((function(e){return t.includes(e)}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}}],(t=null)&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,E(r.key),r)}}function E(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var O=function(){function e(t,n,r){var o;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof e))return new e(t,n,r);if(null==n&&(n=document.documentElement),"string"==typeof n?this.base=this.parseComponent(n):"object"===S(n)&&n.steps&&(this.base=n),"string"===(o=this.checkType(t)))return this.str=t,m.extend(this,this.parse(t));if("range"===o)return m.extend(this,this.fromRange(t,this.base,r));if("node"===o)return m.extend(this,this.fromNode(t,this.base,r));if("EpubCFI"===o&&t.path)return t;if(t)throw new TypeError("not a valid argument for EpubCFI");return this}return t=e,r=[{key:"compare",value:function(t,n){var r,o,i,a;if("string"==typeof t&&(t=new e(t)),"string"==typeof n&&(n=new e(n)),t.spinePos>n.spinePos)return 1;if(t.spinePos<n.spinePos)return-1;t.range?(r=t.path.steps.concat(t.start.steps),i=t.start.terminal):(r=t.path.steps,i=t.path.terminal),n.range?(o=n.path.steps.concat(n.start.steps),a=n.start.terminal):(o=n.path.steps,a=n.path.terminal);for(var s=0;s<r.length;s++){if(!r[s])return-1;if(!o[s])return 1;if(r[s].index>o[s].index)return 1;if(r[s].index<o[s].index)return-1}return r.length<o.length?-1:i.offset>a.offset?1:i.offset<a.offset?-1:0}}],(n=[{key:"checkType",value:function(t){return this.isCfiString(t)?"string":!t||"object"!==S(t)||"Range"!==m.type(t)&&void 0===t.startContainer?t&&"object"===S(t)&&void 0!==t.nodeType?"node":!!(t&&"object"===S(t)&&t instanceof e)&&"EpubCFI":"range"}},{key:"parse",value:function(e){var t,n,r,o={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return"string"!=typeof e?{spinePos:-1}:(0===e.indexOf("epubcfi(")&&")"===e[e.length-1]&&(e=e.slice(8,e.length-1)),(t=this.getChapterComponent(e))?(o.base=this.parseComponent(t),n=this.getPathComponent(e),o.path=this.parseComponent(n),(r=this.getRange(e))&&(o.range=!0,o.start=this.parseComponent(r[0]),o.end=this.parseComponent(r[1])),o):{spinePos:-1})}},{key:"parseComponent",value:function(e){var t,n={steps:[],terminal:{offset:null,assertion:null}},r=e.split(":"),o=r[0].split("/");return r.length>1&&(t=r[1],n.terminal=this.parseTerminal(t)),""===o[0]&&o.shift(),o.length>0&&""===o[0]&&o.shift(),n.steps=o.map(function(e){return this.parseStep(e)}.bind(this)),n}},{key:"parseStep",value:function(e){var t,n,r,o,i;if((o=e.match(/\[(.*)\]/))&&o[1]&&(i=o[1]),n=parseInt(e),!isNaN(n))return n%2==0?(t="element",r=n/2-1):(t="text",r=(n-1)/2),{type:t,index:r,id:i||null}}},{key:"parseTerminal",value:function(e){var t,n,r=e.match(/\[(.*)\]/);return r&&r[1]?(t=parseInt(e.split("[")[0]),n=r[1]):t=parseInt(e),m.isNumber(t)||(t=null),{offset:t,assertion:n}}},{key:"getChapterComponent",value:function(e){return e.split("!")[0]}},{key:"getPathComponent",value:function(e){var t=e.split("!");if(t[1])return t[1].split(",")[0]}},{key:"getRange",value:function(e){var t=e.match(/(?:[^,\[\]]|(\[[^\]]*\]))+/g);return 3===t.length&&[t[1],t[2]]}},{key:"getCharacterOffsetComponent",value:function(e){return e.split(":")[1]||""}},{key:"joinSteps",value:function(e){return e?e.map((function(e){var t="";return"element"===e.type&&(t+=2*(e.index+1)),"text"===e.type&&(t+=1+2*e.index),e.id&&(t+="["+e.id+"]"),t})).join("/"):""}},{key:"segmentString",value:function(e){var t="/";return t+=this.joinSteps(e.steps),e.terminal&&null!=e.terminal.offset&&(t+=":"+e.terminal.offset),e.terminal&&null!=e.terminal.assertion&&(t+="["+e.terminal.assertion+"]"),t}},{key:"toString",value:function(){var e="epubcfi(";return e+=this.segmentString(this.base),e+="!",e+=this.segmentString(this.path),this.range&&this.start&&(e+=",",e+=this.segmentString(this.start)),this.range&&this.end&&(e+=",",e+=this.segmentString(this.end)),e+=")"}},{key:"step",value:function(e){var t=e.nodeType===Node.TEXT_NODE?"text":"element";return{id:e.id,tagName:e.tagName,type:t,index:this.position(e)}}},{key:"filteredStep",value:function(e,t){var n,r=this.filter(e,t);if(r)return n=r.nodeType===Node.TEXT_NODE?"text":"element",{id:r.id,tagName:r.tagName,type:n,index:this.filteredPosition(r,t)}}},{key:"pathTo",value:function(e,t,n){for(var r,o={steps:[],terminal:{offset:null,assertion:null}},i=e;i&&i.parentNode&&i.parentNode.nodeType!=Node.DOCUMENT_NODE;)(r=n?this.filteredStep(i,n):this.step(i))&&o.steps.unshift(r),i=i.parentNode;return null!=t&&t>=0&&(o.terminal.offset=t,"text"!=o.steps[o.steps.length-1].type&&o.steps.push({type:"text",index:0})),o}},{key:"equalStep",value:function(e,t){return!(!e||!t)&&e.index===t.index&&e.id===t.id&&e.type===t.type}},{key:"characterEscaping",value:function(e){return e.replace(/[\^;,=\[\]\(\)]/g,"^$&")}},{key:"extractStartAssertion",value:function(e){if(!e||void 0===e.startOffset||void 0===e.endOffset)return"";var t=e.startContainer.textContent,n=e.startContainer==e.endContainer?e.endOffset:t.length-1,r=t.substring(e.startOffset,n),o=this.characterEscaping(s.removeDuplicateSpaces(s.removeLineBreak(t.substring(Math.max(0,e.startOffset-3),e.startOffset)))),i=this.characterEscaping(s.removeDuplicateSpaces(s.removeLineBreak(r.substring(0,Math.min(3,n+1-e.startOffset)))));return"".concat(o,",").concat(i)}},{key:"extractEndAssertion",value:function(e){if(!e||void 0===e.startOffset||void 0===e.endOffset)return"";var t=e.endContainer.textContent,n=e.startContainer==e.endContainer?e.startOffset:0,r=t.substring(n,e.endOffset),o=this.characterEscaping(s.removeDuplicateSpaces(s.removeLineBreak(r.substring(Math.max(0,r.length-3))))),i=this.characterEscaping(s.removeDuplicateSpaces(s.removeLineBreak(t.substring(e.endOffset,Math.min(e.endOffset+3,t.length)))));return"".concat(o,",").concat(i)}},{key:"fromRange",value:function(e,t,n){var r={range:!1,base:{},path:{},start:null,end:null},o=e.startContainer,i=e.endContainer,a=e.startOffset,s=e.endOffset,c=!1;if(n&&(c=m.containsClasses(o.ownerDocument,n)),"string"==typeof t?(r.base=this.parseComponent(t),r.spinePos=r.base.steps[1].index):"object"===S(t)&&(r.base=t),e.collapsed)c&&(a=this.patchOffset(o,a,n)),r.path=this.pathTo(o,a,n);else{r.range=!0,c&&(a=this.patchOffset(o,a,n)),r.start=this.pathTo(o,a,n),r.start.terminal.assertion=this.extractStartAssertion(e),c&&(s=this.patchOffset(i,s,n)),r.end=this.pathTo(i,s,n),r.end.terminal.assertion=this.extractEndAssertion(e),r.path={steps:[],terminal:null};var l,u=r.start.steps.length;for(l=0;l<u&&this.equalStep(r.start.steps[l],r.end.steps[l]);l++)l===u-1?r.start.terminal===r.end.terminal&&(r.path.steps.push(r.start.steps[l]),r.range=!1):r.path.steps.push(r.start.steps[l]);r.start.steps=r.start.steps.slice(r.path.steps.length),r.end.steps=r.end.steps.slice(r.path.steps.length)}return r}},{key:"fromNode",value:function(e,t,n){var r={range:!1,base:{},path:{},start:null,end:null};return"string"==typeof t?(r.base=this.parseComponent(t),r.spinePos=r.base.steps[1].index):"object"===S(t)&&(r.base=t),r.path=this.pathTo(e,null,n),r}},{key:"filter",value:function(e,t){var n,r,o,i,a,s=!1;return e.nodeType===Node.TEXT_NODE?(s=!0,o=e.parentNode,n=m.nodeBelongsClasses(e.parentNode,t)):(s=!1,n=m.nodeBelongsClasses(e,t)),n&&s?(i=o.previousSibling,a=o.nextSibling,i&&i.nodeType===Node.TEXT_NODE?r=i:a&&a.nodeType===Node.TEXT_NODE&&(r=a),r||e):!(n&&!s)&&e}},{key:"patchOffset",value:function(e,t,n){if(e.nodeType!=Node.TEXT_NODE)throw new Error("Anchor must be a text node");var r=e,o=t;for(m.nodeBelongsClasses(e.parentNode,n)&&(r=e.parentNode);r.previousSibling;){if(r.previousSibling.nodeType===Node.ELEMENT_NODE){if(!m.nodeBelongsClasses(r.previousSibling,n))break;o+=r.previousSibling.textContent.length}else o+=r.previousSibling.textContent.length;r=r.previousSibling}return o}},{key:"normalizedMap",value:function(e,t,n){var r,o,i,a={},s=-1,c=e.length;for(r=0;r<c;r++)(o=e[r].nodeType)===Node.ELEMENT_NODE&&m.nodeBelongsClasses(e[r],n)&&(o=Node.TEXT_NODE),r>0&&o===Node.TEXT_NODE&&i===Node.TEXT_NODE?a[r]=s:t===o&&(s+=1,a[r]=s),i=o;return a}},{key:"position",value:function(e){var t,n;return e.nodeType===Node.ELEMENT_NODE?((t=e.parentNode.children)||(t=m.findChildren(e.parentNode)),n=Array.prototype.indexOf.call(t,e)):n=(t=this.textNodes(e.parentNode)).indexOf(e),n}},{key:"filteredPosition",value:function(e,t){var n,r;return e.nodeType===Node.ELEMENT_NODE?(n=e.parentNode.children,r=this.normalizedMap(n,Node.ELEMENT_NODE,t)):(n=e.parentNode.childNodes,m.nodeBelongsClasses(e.parentNode,t)&&(n=(e=e.parentNode).parentNode.childNodes),r=this.normalizedMap(n,Node.TEXT_NODE,t)),r[Array.prototype.indexOf.call(n,e)]}},{key:"stepsToXpath",value:function(e){var t=[".","*"];return e.forEach((function(e){var n=e.index+1;e.id?t.push("*[position()="+n+" and @id='"+e.id+"']"):"text"===e.type?t.push("text()["+n+"]"):t.push("*["+n+"]")})),t.join("/")}},{key:"stepsToQuerySelector",value:function(e){var t=["html"];return e.forEach((function(e){var n=e.index+1;e.id?t.push("#"+e.id):"text"===e.type||t.push("*:nth-child("+n+")")})),t.join(">")}},{key:"textNodes",value:function(e,t){var n=[],r=!1;return e.childNodes.forEach((function(e){e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE&&m.nodeBelongsClasses(e,t)?r||(n.push(e),r=!0):r=!1})),n}},{key:"walkToNode",value:function(e,t,n){var r,o,i=t||document,a=i.documentElement,s=e.length;for(o=0;o<s&&("element"===(r=e[o]).type?a=r.id?i.getElementById(r.id):m.findChildrenEx(a,n)[r.index]:"text"===r.type&&(a=this.textNodes(a,n)[r.index]),a);o++);return a}},{key:"findNode",value:function(e,t,n){var r,o,i=t||document;return n||void 0===i.evaluate?r=n?this.walkToNode(e,i,n):this.walkToNode(e,i):(o=this.stepsToXpath(e),r=i.evaluate(o,i,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),r}},{key:"fixMiss",value:function(e,t,n,r){var o,i,a=this.findNode(e.slice(0,-1),n,r),s=a.childNodes,c=this.normalizedMap(s,Node.TEXT_NODE,r),l=e[e.length-1].index;for(var u in c){if(!c.hasOwnProperty(u))return;if(c[u]===l){if(!(t>(i=(o=s[u]).textContent.length))){a=o.nodeType===Node.ELEMENT_NODE?o.childNodes[0]:o;break}t-=i}}return{container:a,offset:t}}},{key:"toRange",value:function(e,t){var n,r,o,i,a,s,c,l,u=e||document,f=this,d=m.containsClasses(u,t);if(n=u.createRange(),f.range?(r=f.start,s=f.path.steps.concat(r.steps),i=this.findNode(s,u,d?t:null),o=f.end,c=f.path.steps.concat(o.steps),a=this.findNode(c,u,d?t:null)):(r=f.path,s=f.path.steps,i=this.findNode(f.path.steps,u,d?t:null)),!i)return console.log("No startContainer found for",this.toString()),null;try{null!=r.terminal.offset?n.setStart(i,r.terminal.offset):n.setStart(i,0)}catch(e){l=this.fixMiss(s,r.terminal.offset,u,d?t:null),n.setStart(l.container,l.offset)}if(!a)return console.log("No endContainer found for",this.toString()),null;try{null!=o.terminal.offset?n.setEnd(a,o.terminal.offset):n.setEnd(a,0)}catch(e){l=this.fixMiss(c,f.end.terminal.offset,u,d?t:null),n.setEnd(l.container,l.offset)}return n}},{key:"isCfiString",value:function(e){return"string"==typeof e&&0===e.indexOf("epubcfi(")&&")"===e[e.length-1]}},{key:"generateChapterComponent",value:function(e,t,n){var r="/"+2*(e+1)+"/";return r+=2*(parseInt(t)+1),n&&(r+="["+n+"]"),r}},{key:"collapse",value:function(e){this.range&&(this.range=!1,e?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}])&&w(t.prototype,n),r&&w(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();new RegExp(",(?![^\\[^\\]]*(\\]|\\^\\[))","g");function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_(r.key),r)}}function T(e,t,n){return(t=_(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e){var t=function(e,t){if("object"!=C(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==C(t)?t:t+""}var L,x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,r=[{key:"_addNoteIconSide",value:function(t,n){var r=this,o=gtReaderLibs.reader.getDocument(),i=h.getColorValueFromCss(n,!1),a=o.getElementById("note-icon-container");a?a.style.height="".concat(o.body.scrollHeight,"px"):((a=o.createElement("div")).id="note-icon-container",a.style.position="absolute",a.style.left="2px",a.style.top="0px",a.style.width="24px",a.style.height="".concat(o.body.scrollHeight,"px"),a.style.pointerEvents="none",o.body.appendChild(a));var s=o.createElement("div");function c(t){var n=t.getBoundingClientRect(),r=e.isPdf?o.documentElement:o.body,i=r?r.scrollTop:0;return n.top+i}return s.className="".concat(D.HIGHLIGHT_NOTE_ICON_CLASS,"-side"),s.style.cssText="\n        position: absolute;\n        width: 24px;\n        height: 18px;\n        background-color: ".concat(i,";\n        border-radius: 2px;\n        box-shadow: 0 1px 2px rgba(0,0,0,0.4);\n        opacity: 1;\n        z-index: 1000;\n        cursor: pointer;\n        pointer-events: auto;\n    "),t.classList.remove(D.HIGHLIGHT_NOTE_ICON_CLASS),t.style.removeProperty("position"),requestAnimationFrame((function(){var e=c(t);Array.from(a.querySelectorAll(".".concat(D.HIGHLIGHT_NOTE_ICON_CLASS,"-side"))).forEach((function(t){var n=c(t);Math.abs(n-e)<18&&(e=n+7)})),s.style.top="".concat(e,"px"),a.appendChild(s),s.addEventListener("click",(function(e){gtReaderLibs.reader.sendEvent("highlightIsTouched",{target:t,event:e},{id:t.id,isNote:!0})})),t.dataset.sideIconId="side-icon-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),s.id=t.dataset.sideIconId;var n=o.createElement("div");n.style.cssText="\n            position: absolute;\n            bottom: -8px;\n            left: 50%;\n            transform: translateX(-50%);\n            height: 0;\n            border-right: 8px solid ".concat(i,";\n            border-bottom: 8px solid transparent;\n            border-top: 8px solid transparent;\n            opacity: 1;\n            background: transparent;\n        "),n.setAttribute("id","tail-"+s.id),s.appendChild(n),r._cleanupFunctions=r._cleanupFunctions||new Map,r._cleanupFunctions.set(t.dataset.sideIconId,(function(){s.parentNode&&s.parentNode.removeChild(s),r._cleanupFunctions.delete(t.dataset.sideIconId)}))})),s}},{key:"onAddNote",value:function(e,t){e.classList.add(D.HIGHLIGHT_NOTE_CLASS),t&&(this.showIconInSide?this._addNoteIconSide(e,e.style.backgroundColor):e.classList.add(D.HIGHLIGHT_NOTE_ICON_CLASS))}},{key:"onRemoveHighlight",value:function(e){if(e.dataset.sideIconId){var t=this._cleanupFunctions.get(e.dataset.sideIconId);t&&t()}}},{key:"onSetHighlightColor",value:function(e){if(e.dataset.sideIconId){var t=gtReaderLibs.reader.getDocument().getElementById(e.dataset.sideIconId);if(t){var n=h.getColorValueFromCss(e.style.backgroundColor,!1);t.style.backgroundColor=n;var r=t.querySelector("#tail-"+e.dataset.sideIconId);r&&(r.style.borderRight="8px solid ".concat(n))}}}},{key:"onConvertHighlightToNote",value:function(e){if(this.showIconInSide){if(!e[0].dataset.sideIconId){var t=this._addNoteIconSide(e[0],e[0].style.backgroundColor);t&&gtReaderLibs.reader.addTouchListener(t,(function(t){gtReaderLibs.reader.sendEvent("highlightIsTouched",{target:e[0],event:t},{id:e[0].id,isNote:!0})}))}}else e[0].classList.add(D.HIGHLIGHT_NOTE_ICON_CLASS)}}],(n=null)&&N(t.prototype,n),r&&N(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function j(){j=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),s=new P(r||[]);return o(a,"_invoke",{value:T(e,n,s)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",g={};function v(){}function b(){}function m(){}var S={};l(S,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(I([])));E&&E!==n&&r.call(E,a)&&(S=E);var O=m.prototype=v.prototype=Object.create(S);function C(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function n(o,i,a,s){var c=f(e[o],e,i);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==k(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return i=i?i.then(o,o):o()}})}function T(t,n,r){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var c=_(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var l=f(t,n,r);if("normal"===l.type){if(o=r.done?y:p,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=y,r.method="throw",r.arg=l.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=f(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,g;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return i.next=i}}throw new TypeError(k(t)+" is not iterable")}return b.prototype=m,o(O,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:b,configurable:!0}),b.displayName=l(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},C(N.prototype),l(N.prototype,s,(function(){return this})),t.AsyncIterator=N,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new N(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(O),l(O,c,"Generator"),l(O,a,(function(){return this})),l(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(x),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:I(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function P(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,R(r.key),r)}}function H(e,t,n){return(t=R(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e){var t=function(e,t){if("object"!=k(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==k(t)?t:t+""}function A(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}T(x,"_cleanupFunctions",new Map),T(x,"showIconInSide",!1),T(x,"isPdf",!1);var D=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,n=null,r=[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;s.addCSSRule("span.".concat(this.HIGHLIGHT_CLASS,".").concat(this.HIGHLIGHT_NOTE_CLASS),"position:relative;"),s.addCSSRule("span.".concat(this.HIGHLIGHT_CLASS,".").concat(this.HIGHLIGHT_NOTE_CLASS,".").concat(this.HIGHLIGHT_NOTE_ICON_CLASS,":after"),"content:'';\ndisplay:inline-block;\nposition:absolute;\nwidth:24px; height:14px;\nbackground-color:inherit;\ntop:-20px; left:1px;\nmargin-bottom:10px;\nbox-shadow:1px 1px 2px rgba(0,0,0,0.8);\nborder-radius:3px; opacity:0.7;"),s.addCSSRule("span.".concat(this.HIGHLIGHT_CLASS,".").concat(this.HIGHLIGHT_NOTE_CLASS,".").concat(this.HIGHLIGHT_NOTE_ICON_CLASS,":before"),"content:'';\ndisplay:block;\nposition:absolute;\nwidth:5px;\nheight:5px;\nbackground-color:inherit;\ntop:-8px;\nleft:11px;\nmargin-bottom:10px;\nz-index:3;\ntransform:rotate(45deg);\nopacity:0.7;\nbox-shadow:1px 1px 2px rgba(0,0,0,0.8);"),null!=t&&t.accessibility&&Object.keys(this.accessibility).forEach((function(n){e.accessibility[n]=t.accessibility[n]||e.accessibility[n]}))}},{key:"createHighlightFromSelection",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s.fixSelection();var o=gtReaderLibs.reader.getDocument().getSelection().getRangeAt(0),i=s.removeDuplicateSpaces(s.removeLineBreak(o.toString())),a=new O(o,gtReaderLibs.reader.getDocument(),[this.HIGHLIGHT_CLASS,this.GT_RANGY_SEARCH_CLASS]);return A(e,this,X).call(this,o,t,n,r),gtReaderLibs.reader.getDocument().getSelection().removeAllRanges(),{cfi:a.toString(),color:t,id:n,isNote:r,text:i}}},{key:"applyHighlights",value:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.removeAllHighlights(),e.forEach((function(e){t.applyHighLight(e)}))}},{key:"applyHighLight",value:function(t){var n=new O(s.isPdfDocument()?gtReaderLibs.reader.cfiPdfFix(t.cfi):t.cfi),r=gtReaderLibs.reader.getDocument();try{A(e,this,X).call(this,n.toRange(r,[this.HIGHLIGHT_CLASS,this.GT_RANGY_SEARCH_CLASS]),t.color,t.id,t.isNote)}catch(e){console.error("Error applying highlight:",e)}return t.id}},{key:"removeAllHighlights",value:function(){A(e,this,M).call(this).forEach((function(e){x.onRemoveHighlight(e),s.replaceNodeWithChildren(e).normalize()}))}},{key:"removeHighlight",value:function(t){A(e,this,F).call(this,t).forEach((function(e){x.onRemoveHighlight(e),s.replaceNodeWithChildren(e).normalize()}))}},{key:"setColor",value:function(t,n){var r=this;A(e,this,F).call(this,t).forEach((function(o){if(o.style.backgroundColor=h.resolveColorName(n),o.hasAttribute("aria-label")){var i=Array.from(gtReaderLibs.reader.getDocument().querySelectorAll("span#".concat(t,".").concat(r.HIGHLIGHT_CLASS))).map((function(e){return e.textContent})).join("");A(e,r,q).call(r,o,n,i,o.classList.contains(r.HIGHLIGHT_NOTE_CLASS))}x.onSetHighlightColor(o)}))}},{key:"convertHighlightToNote",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=A(e,this,F).call(this,t),o=r.length;if(0!==o){x.onConvertHighlightToNote(r);for(var i=0;i<o;i++)r[i].classList.add(this.HIGHLIGHT_NOTE_CLASS);n&&function(e,t){gtReaderLibs.reader.getDocument().querySelectorAll('[id="'.concat(e,'"]')).forEach((function(e){return e.id=t}))}(t,n)}}},{key:"sort",value:function(e){return e.sort((function(e,t){return O.compare(e.cfi,t.cfi)})),e}},{key:"getHighlightPosition",value:function(t){var n,r,o;gtReaderLibs.isWeb?(n=(o=gtReaderLibs.reader.getDocument().getBoundingClientRect()).top,r=o.left):(n=window.pageYOffset,r=window.pageXOffset);var i=A(e,this,F).call(this,t);return i.length>0&&(n+=(o=i[0].getBoundingClientRect()).top,r+=o.left),{top:n,left:r}}},{key:"test_getHighlightsAndRanges",value:function(){return A(e,this,G).call(this)}},{key:"convertHighlightsFromRangy",value:function(e){var t=[];e.forEach((function(e){e._color=e.color,e.color="transparent",t.push(JSON.stringify(e))})),GtRangy.highlight(t);var n=function(){var e=document.querySelectorAll("span[data-gt-highlight-id]"),t=new Map;e.forEach((function(e){var n=e.getAttribute("data-gt-highlight-id");t.has(n)||t.set(n,[]),t.get(n).push(e)}));var n={};return t.forEach((function(e,t){var r=e[e.length-1].childNodes[0],o=r.textContent.length,i=document.createRange();if(""!==e[0].childNodes[0].nodeValue.trim())i.setStart(e[0].childNodes[0],0);else for(var a=1;a<e.length;a++)if(""!==e[a].childNodes[0].nodeValue.trim()){i.setStart(e[a].childNodes[0],0);break}i.startContainer===gtReaderLibs.reader.getDocument()&&i.setStart(e[0].childNodes[0],0),i.setEnd(r,o);var s=new O(i,gtReaderLibs.reader.getDocument(),"gt-highlight");n[t]=s.toString()})),n}();GtRangy.unlightAll();var r=[];return e.forEach((function(e){var t={cfi:n[e.id],id:e.id,color:e._color,isNote:e.isNote,text:e.text,characterRange:e.characterRange};r.push(t)})),r}},{key:"asyncConvertHighlightsFromRangy",value:(o=j().mark((function t(n){var r,o;return j().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.map((function(e){return JSON.stringify(Object.assign({},e,{color:"transparent"}))})),t.next=3,Promise.all(r.map((function(e){return gtReaderLibs.reader.getGtRangy().highlight(e)})));case 3:return o=A(e,this,G).call(this),gtReaderLibs.reader.getGtRangy().unlightAll(),t.abrupt("return",n.map((function(e){return Object.assign({cfi:o[e.id]},e)})));case 6:case"end":return t.stop()}}),t,this)})),i=function(){var e=this,t=arguments;return new Promise((function(n,r){var i=o.apply(e,t);function a(e){P(i,n,r,a,s,"next",e)}function s(e){P(i,n,r,a,s,"throw",e)}a(void 0)}))},function(e){return i.apply(this,arguments)})},{key:"selectHighlight",value:function(t){var n=A(e,this,F).call(this,t);if(0!==n.length){window.getSelection().removeAllRanges();var r=document.createRange();r.setStart(n[0],0),r.setEndAfter(n[n.length-1]),window.getSelection().addRange(r)}}},{key:"focusHighlight",value:function(t){var n=A(e,this,B).call(this,t);null!==n&&n.focus()}}],n&&I(t.prototype,n),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,o,i}();function G(){var e=this,t=gtReaderLibs.reader.getDocument().querySelectorAll("span[data-gt-highlight-id]"),n=new Map;t.forEach((function(e){var t=e.getAttribute("data-gt-highlight-id");n.has(t)||n.set(t,[]),n.get(t).push(e)}));var r={};return n.forEach((function(t,n){var o=t[t.length-1].childNodes[0],i=o.textContent.length,a=document.createRange();if(""!==t[0].childNodes[0].nodeValue.trim())a.setStart(t[0].childNodes[0],0);else for(var s=1;s<t.length;s++)if(""!==t[s].childNodes[0].nodeValue.trim()){a.setStart(t[s].childNodes[0],0);break}a.startContainer===gtReaderLibs.reader.getDocument()&&a.setStart(t[0].childNodes[0],0),a.setEnd(o,i);var c=new O(a,gtReaderLibs.reader.getDocument(),["gt-highlight",e.GT_RANGY_SEARCH_CLASS]);r[n]=c.toString()})),r}function M(){return gtReaderLibs.reader.getDocument().querySelectorAll("span.".concat(this.HIGHLIGHT_CLASS))}function F(e){return gtReaderLibs.reader.getDocument().querySelectorAll("span.".concat(this.HIGHLIGHT_CLASS,"[id='").concat(e,"']"))}function B(e){return gtReaderLibs.reader.getDocument().querySelector("span.".concat(this.HIGHLIGHT_CLASS,"[id='").concat(e,"']"))}function X(e,t,n,r){if(e){var o=gtReaderLibs.reader.getDocument().createElement("span");o.classList.add(this.HIGHLIGHT_CLASS),o.style.backgroundColor=h.resolveColorName(t),o.id=n,o.setAttribute("role","button");var i=0,a=!0,c=null,l="";!function t(n){if(2!==i&&n.isConnected){if(n.nodeType===Node.TEXT_NODE){if(n===e.startContainer){var r;if(n===e.endContainer){i=2;var o=e.endOffset-e.startOffset;(r=n.splitText(e.startOffset)).length>o&&r.splitText(o)}else i=1,r=n.splitText(e.startOffset);return u(r)}return n===e.endContainer?(i=2,n.splitText(e.endOffset),u(n)):1===i?u(n):null}if(n.childNodes.length>0)if(n===e.endContainer)i=2;else{n===e.startContainer&&(i=1);for(var a=n.firstChild;a&&2!==i;){var s=a.nextSibling,c=t(a);a=c?c.nextSibling:s}}}}(e.commonAncestorContainer),c&&A(L,this,q).call(this,c,t,l,r)}else console.warn("The range is null or undefined. Unable to apply highlight.");function u(e){var t=o.cloneNode(!0);return gtReaderLibs.reader.addTouchListener(t,(function(e){gtReaderLibs.reader.sendEvent("highlightIsTouched",{target:t,event:e},{id:n,isNote:r})})),""===s.removeDuplicateSpaces(s.removeLineBreak(e.textContent))?e:(a?(c=t,t.setAttribute("tabindex","0")):t.setAttribute("tabindex","-1"),r&&x.onAddNote(t,a),a=!1,t.appendChild(e.cloneNode(!0)),e.parentNode.replaceChild(t,e),l+=t.textContent+" ",t)}}function q(e,t,n,r){var o,i,a=h.resolveAccessibilityColorName(t);r?(o=a?this.accessibility.note_start_with_color:this.accessibility.note_start,i=this.accessibility.note_end):(o=a?this.accessibility.highlight_start_with_color:this.accessibility.highlight_start,i=this.accessibility.highlight_end);var c="."+o.replace("[color]",a)+s.removeDuplicateSpaces(s.removeLineBreak(n))+"."+i.replace("[color]",a)+".";e.setAttribute("aria-label",c)}function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Y(r.key),r)}}function z(e,t,n){return(t=Y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){var t=function(e,t){if("object"!=V(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=V(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==V(t)?t:t+""}function U(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}L=D,H(D,"HIGHLIGHT_CLASS","gt-highlight2"),H(D,"HIGHLIGHT_NOTE_CLASS","gt-note-highlight2"),H(D,"HIGHLIGHT_NOTE_ICON_CLASS","gt-note-icon"),H(D,"GT_RANGY_SEARCH_CLASS","gt-search-highlight"),H(D,"accessibility",{highlight_start_with_color:"Start highlighted passage in [color]: ",highlight_start:"Start highlighted passage: ",highlight_end:"End of highlighted passage",note_start_with_color:"Start annotated passage in [color]: ",note_start:"Start annotated passage: ",note_end:"End of annotated passage"});var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,r=[{key:"init",value:function(){s.addCSSRule("span.".concat(this.SEARCH_HIGHLIGHT_CLASS),"background-color: yellow !important; padding: 2px 0px; outline: 2px solid blue;")}},{key:"searchText",value:function(t){var n,r=this,o=[];(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.removeAllSearches();for(var i=document.createTreeWalker(gtReaderLibs.reader.getDocument(),NodeFilter.SHOW_TEXT,(function(e){return e.nodeType===Node.TEXT_NODE&&e.isConnected&&e.textContent.indexOf(t)>-1?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),!1);i.nextNode();){var a=i.currentNode,s=a.textContent.indexOf(t);for(console.log(a," ",s),n=a.textContent.length;s>-1&&(o.push({node:a,start:s}),s+t.length<n);)s=a.textContent.indexOf(t,s+t.length)}o.reverse();var c=o.length;o.forEach((function(n){var o=document.createRange();o.setStart(n.node,n.start),o.setEnd(n.node,n.start+t.length),U(e,r,$).call(r,o,c),c--}))}},{key:"removeAllSearches",value:function(){U(e,this,K).call(this).forEach((function(e){s.replaceNodeWithChildren(e).normalize()}))}},{key:"scrollToSearch",value:function(e){var t=gtReaderLibs.reader.getDocument().querySelector("span[id=".concat(this.SEARCH_HIGHLIGHT_ID).concat(e));t&&t.scrollIntoView()}}],(n=null)&&W(t.prototype,n),r&&W(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function $(e,t){var n=gtReaderLibs.reader.getDocument().createElement("span");n.classList.add(this.SEARCH_HIGHLIGHT_CLASS),n.id=this.SEARCH_HIGHLIGHT_ID+t,e.surroundContents(n)}function K(){return gtReaderLibs.reader.getDocument().querySelectorAll("span.".concat(this.SEARCH_HIGHLIGHT_CLASS))}function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ee(r.key),r)}}function ee(e){var t=function(e,t){if("object"!=Q(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Q(t)?t:t+""}z(J,"SEARCH_HIGHLIGHT_CLASS","gt-search-highlight2"),z(J,"SEARCH_HIGHLIGHT_ID","search-text-");var te=function(){return e=function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(this instanceof e?this.constructor:void 0)===e)throw new TypeError("Cannot instantiate abstract class");window.HighlightManager=D,window.SearchManager=J,window.NoteIconManager=x},t=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;h.init(e),D.init(e),J.init(),console.debug("Reader initialized")}},{key:"getDocument",value:function(){throw new Error("Method 'getDocument' must be implemented")}},{key:"getGtRangy",value:function(){throw new Error("Method 'getGtRangy' must be implemented")}},{key:"sendEvent",value:function(e,t,n){throw new Error("Method 'sendEvent' must be implemented")}},{key:"addListener",value:function(e,t){throw new Error("Method 'addListener' must be implemented")}},{key:"cfiPdfFix",value:function(e){throw new Error("Method 'cfiPdfFix' must be implemented")}}],t&&Z(e.prototype,t),n&&Z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();function ne(e){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,oe(r.key),r)}}function oe(e){var t=function(e,t){if("object"!=ne(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ne(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ne(t)?t:t+""}function ie(e,t,n){return t=se(t),function(e,t){if(t&&("object"==ne(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ae()?Reflect.construct(t,n||[],se(e).constructor):t.apply(e,n))}function ae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ae=function(){return!!e})()}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}var le=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=ie(this,t),document.addEventListener("DOMContentLoaded",(function(){window.gtReaderLibs.init()})),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}(t,e),n=t,(r=[{key:"getDocument",value:function(){return document}},{key:"addTouchListener",value:function(e,t){e.addEventListener("touchend",t)}},{key:"buildMessage",value:function(e,t){return"native://="+encodeURIComponent(JSON.stringify({method:e,params:t}))}},{key:"getGtRangy",value:function(){return GtRangy}},{key:"cfiPdfFix",value:function(e){return-1!==e.indexOf("2[viewer]/2/4")?e.replace("2[viewer]/2/4","2[viewer]/2/6"):e}}])&&re(n.prototype,r),o&&re(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(te);function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,de(r.key),r)}}function de(e){var t=function(e,t){if("object"!=ue(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ue(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ue(t)?t:t+""}function pe(e,t,n){return t=ge(t),function(e,t){if(t&&("object"==ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,he()?Reflect.construct(t,n||[],ge(e).constructor):t.apply(e,n))}function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}function ye(){return ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=ge(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ye.apply(null,arguments)}function ge(e){return ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ge(e)}function ve(e,t){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ve(e,t)}var be=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),pe(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(t,e),n=t,(r=[{key:"sendEvent",value:function(e,n,r){var o=n.target.getBoundingClientRect();r.rectX=o.x,r.rectY=o.y,r.rectWidth=o.width,r.rectHeight=o.height;var i=ye(ge(t.prototype),"buildMessage",this).call(this,e,r);window.webkit.messageHandlers.gtScriptMessageHandler.postMessage(i)}}])&&fe(n.prototype,r),o&&fe(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(le);function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,we(r.key),r)}}function we(e){var t=function(e,t){if("object"!=me(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==me(t)?t:t+""}function Ee(e,t,n){return t=Ne(t),function(e,t){if(t&&("object"==me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Oe()?Reflect.construct(t,n||[],Ne(e).constructor):t.apply(e,n))}function Oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Oe=function(){return!!e})()}function Ce(){return Ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Ne(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Ce.apply(null,arguments)}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}function Te(e,t){return Te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Te(e,t)}var _e=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Ee(this,t,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Te(e,t)}(t,e),n=t,(r=[{key:"sendEvent",value:function(e,n,r){var o=Ce(Ne(t.prototype),"buildMessage",this).call(this,e,r);console.log("AndroidReader.sendEvent: "+o),Android.callNative(o)}}])&&Se(n.prototype,r),o&&Se(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(le);function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function je(e,t,n){return(t=Ie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ie(r.key),r)}}function Ie(e){var t=function(e,t){if("object"!=Le(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Le(t)?t:t+""}function He(e,t,n){return t=Ae(t),function(e,t){if(t&&("object"==Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Re()?Reflect.construct(t,n||[],Ae(e).constructor):t.apply(e,n))}function Re(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Re=function(){return!!e})()}function Ae(e){return Ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ae(e)}function De(e,t){return De=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},De(e,t)}var Ge=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),He(this,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&De(e,t)}(t,e),n=t,r=[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;h.init(e),D.init(e),J.init()}},{key:"getDocument",value:function(){var e=document.querySelector("iframe[id='iframe-page']");return e?e.contentDocument||e.contentWindow.document:document}},{key:"getGtRangy",value:function(){var e=document.querySelector("iframe[id='iframe-page']");return e?e.contentWindow.GtRangy:window.GtRangy}},{key:"addTouchListener",value:function(e,t){e.addEventListener("click",t),e.addEventListener("keypress",(function(e){"Enter"===e.key&&t(e)}))}},{key:"sendEvent",value:function(e,t,n){if("highlightIsTouched"===e){var r=new CustomEvent("highlightIsTouched",{detail:ke(ke({},n),t)});window.dispatchEvent(r)}}},{key:"cfiPdfFix",value:function(e){return-1!==e.indexOf("2[viewer]/2/6")?e.replace("2[viewer]/2/6","2[viewer]/2/4"):e}}],r&&Pe(n.prototype,r),o&&Pe(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(te);function Me(e){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Me(e)}function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Be(r.key),r)}}function Be(e){var t=function(e,t){if("object"!=Me(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Me(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Me(t)?t:t+""}var Xe=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isIOS=/iPhone|iPad|iPod/i.test(navigator.userAgent),this.isAndroid=/Android/i.test(navigator.userAgent),this.isMobile=this.isIOS||this.isAndroid,this.isWeb=!this.isMobile,this.isIOS?this.reader=new be:this.isAndroid?this.reader=new _e:this.reader=new Ge},(t=[{key:"init",value:function(){this.reader.init()}}])&&Fe(e.prototype,t),n&&Fe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();return window.gtReaderLibs=new Xe,t})()));
</script>

</body>
</html>
