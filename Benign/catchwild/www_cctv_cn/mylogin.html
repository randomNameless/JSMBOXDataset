<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mylogin.html</title>
</head>
<body>

<script>


var timestamp = Date.parse(new Date()) / 1000; // 获取时间
var Url_domainname = location.href;
var Url_domainname1 = '';
var shorturl = (Url_domainname.substr(0, Url_domainname.indexOf("/", 7))); // 域名
var zhuceurl = "//reg.cctv.cn/regist.html?from=" + shorturl + "&backurl=" + encodeURI(Url_domainname); //encodeURI() 函数可把字符串作为 URI 进行编码
var IDPassword = ''
$("#comment_regist").click(function () {
	window.open(zhuceurl);
})
if (Url_domainname.indexOf("?") === -1) {
	Url_domainname1 = Url_domainname;
} else {
	Url_domainname1 = Url_domainname.substr(0, Url_domainname.indexOf("?"));
}

if(typeof itemid1 !="undefined"){
	if(itemid1.substr(0,4)=="PHOA"&&Url_domainname.indexOf("#") >-1){
		Url_domainname=Url_domainname.split("#")[0]
	}
}
function getQueryVariable(variable) {
	var query = window.location.search.substring(1);
	var vars = query.split("&");
	for (var i = 0; i < vars.length; i++) {
		if (vars[i].indexOf(variable) > -1) {
			return vars[i].split('=')[1]
		}
	}
}

/* 判断是否是移动,是返回true,否返回false*/
function judgeisMobile(){
	if(/AppleWebKit.*mobile/i.test(navigator.userAgent) || /Android/i.test(navigator.userAgent)|| (/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent))){
		return true;
	}else{
		return false;
	}
}

// 图形验证码
var thisid
var load
var imgswitch = true
setInterval(function () {
	var ishide = $('#loginFloat').is(':hidden')

	if (!ishide && imgswitch) {

		imgswitch = false
		thisid = 'codemobilef'

	}
}, 100)


function getCookiedl(name) {
	var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
	if (arr = document.cookie.match(reg)) return unescape(arr[2]);
	else return null
}
function setCookiedl(name, value) {
	var Days = 14;
	var exp = new Date();
	exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
	document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString()
}
function delCookiedl(name) {
	var exp = new Date();
	exp.setTime(exp.getTime() - 1);
	var cval = getCookiedl(name);
	if (cval != null) document.cookie = name + "=" + cval + ";expires=" + exp.toGMTString()
}

/*---------------------第三方登录----------------------*/

var weixin_url = "//reg.cctv.cn/openapi/v2/user/oauth/weChat?timestamp=" + timestamp + "&appid=dgtGyfXwN9Gcr7ow&methodl=login&backurl=" + encodeURIComponent(encodeURIComponent(decodeURIComponent(Url_domainname)));
var xl_url = "//reg.cctv.cn/openapi/v2/user/oauth/sina?timestamp=" + timestamp + "&appid=dgtGyfXwN9Gcr7ow&methodl=login&backurl=" + encodeURIComponent(encodeURIComponent(decodeURIComponent(Url_domainname)));
var qq_loginurl = "//reg.cctv.cn/openapi/v2/user/oauth/qq?timestamp=" + timestamp + "&appid=dgtGyfXwN9Gcr7ow&methodl=login&backurl=" + encodeURIComponent(encodeURIComponent(decodeURIComponent(Url_domainname)));
var zf_url = "//reg.cctv.cn/openapi/v2/user/oauth/alipay?timestamp=" + timestamp + "&appid=dgtGyfXwN9Gcr7ow&methodl=login&backurl=" + encodeURIComponent(encodeURIComponent(decodeURIComponent(Url_domainname)));

var oheight = window.screen.height
var owidth = window.screen.width

$("#2019QQ").click(function () {
    var msgagreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	var idagreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (msgagreementTypes || idagreementTypes) {
		if(getQueryVariable('tag') === 'MicroLiveType' || location.host=="webapp.cctv.com" ) {
			window.open(qq_loginurl, "newwindow1", "top=" + (oheight - 720) / 2 + ",left=" + (owidth - 1100) / 2 + ",height=720,width=1100")
		} else {
			window.open(qq_loginurl, "newwindow1", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
		}
	} else {
		if (thisid === 'codemobilef') {
			$('.loginDuanxin .hint_y').css('visibility', 'visible');
		} else {
			$('.loginZhanghao .hint_y').css('visibility', 'visible');
		}
	}
})
$("#2019WX").click(function () {
	var msgagreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	var idagreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (msgagreementTypes || idagreementTypes) {
		if(getQueryVariable('tag') === 'MicroLiveType' || location.host=="webapp.cctv.com" ) {
			window.open(weixin_url, "newwindow2", "top=" + (oheight - 720) / 2 + ",left=" + (owidth - 1100) / 2 + ",height=720,width=1100")
		} else {
			window.open(weixin_url, "newwindow2", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
		}
		// window.open(weixin_url, "newwindow2", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
	} else {
		if (thisid === 'codemobilef') {
			$('.loginDuanxin .hint_y').css('visibility', 'visible');
		} else {
			$('.loginZhanghao .hint_y').css('visibility', 'visible');
		}
	}
})
$("#2019WB").click(function () {
	var msgagreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	var idagreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (msgagreementTypes || idagreementTypes) {
		if(getQueryVariable('tag') === 'MicroLiveType' || location.host=="webapp.cctv.com") {
			window.open(xl_url, "newwindow3", "top=" + (oheight - 720) / 2 + ",left=" + (owidth - 1100) / 2 + ",height=720,width=1100")
		} else {
			window.open(xl_url, "newwindow3", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
		}
		// window.open(xl_url, "newwindow3", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
	} else {
		if (thisid === 'codemobilef') {
			$('.loginDuanxin .hint_y').css('visibility', 'visible');
		} else {
			$('.loginZhanghao .hint_y').css('visibility', 'visible');
		}
	}
})
$("#2019ZF").click(function () {
	var msgagreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	var idagreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (msgagreementTypes || idagreementTypes) {
		if(getQueryVariable('tag') === 'MicroLiveType' || location.host=="webapp.cctv.com") {
			window.open(zf_url, "newwindow4", "top=" + (oheight - 720) / 2 + ",left=" + (owidth - 1100) / 2 + ",height=720,width=1100")
		} else {
			window.open(zf_url, "newwindow4", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
		}
		// window.open(zf_url, "newwindow4", "top=" + (oheight - 620) / 2 + ",left=" + (owidth - 760) / 2 + ",height=620,width=760")
	} else {
		if (thisid === 'codemobilef') {
			$('.loginDuanxin .hint_y').css('visibility', 'visible');
		} else {
			$('.loginZhanghao .hint_y').css('visibility', 'visible');
		}
	}
})


var thirdPartyTicketInfo = getQueryVariable("ticket")
if (!thirdPartyTicketInfo) {

} else {
	setCookiedl('CurrentPage','1')
	try{
		window.opener.location.reload()
		window.close()
	}catch(e){
		//TODO handle the exception
	}
	

}

$('.yangbo20214_navVspace.fixednav .yangbo20214_nav .swiper-container')

var verifycode = getCookiedl("verifycode")
var CurrentPageType = getCookiedl('CurrentPage')
if (verifycode === null || CurrentPageType === null) {

} else {
	if (!thirdPartyTicketInfo) {
		delCookiedl("CurrentPage")
        CurrentPageType = getCookiedl('CurrentPage')
		realName1()
	} 
		
}
function realName1() {
	if (verifycode === "" && verifycode === null && verifycode === undefined) {
		return;
	} else {
		$.ajax({
			type: "post",
			url: "//reg.cctv.cn/openapi/v2/user/isAuth",
			dataType: "json",
			data: {
				"timestamp": timestamp,      //当前时间戳
				"appid": "dgtGyfXwN9Gcr7ow"  //管理员分配给业务线应用的唯一标识
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,            //添加跨域参数是为了将登录标识（token）带过去验证
			success: function (data) {
				// console.log(data)
				if (data.data === '0') {
					if (judgeisMobile()) {

					} else {
						
						$('.loginMain .Maincont').hide();
						$(".loginMain .codeLoginBtn").hide();
						var rstemailmsgSwitch = true
						var rstgetemailmsgBtn = $('.bindPhoneBox .login_msg .daojishi')
						rstgetemailmsgBtn.on('click', function () {
							if (bindIphoneipt.val().replace(/\s+/g, '') === '') {
								$(".bindPhoneBox .login_iphone .tishi_error").html('请输入手机号').show()
								return false;
							}
							if (!checkMobile(bindIphoneipt.val().replace(/\s+/g, ''))) {
								$(".bindPhoneBox .login_iphone .tishi_error").html('手机号格式错误').show()
								return false;
							}
							
							
							if (($('.bindPhoneBox .conw .login_msg em.daojishi').text() === '获取验证码' || $('.bindPhoneBox .conw .login_msg em.daojishi').text() === '重新获取')) {
								thisid = "codemobilebd"
								getPicture()
								
							} else {
								bindmsgipt.parents('.login_msg').find('.tishi_msg').show()
							}
						});
						thirdPartybindIphoneNumFn()
						$('.codeLoginBtn').hide()
						$('.loginFloat').show()
						$('.loginMain .bindPhoneBox').show()
					}
					// console.log('realName1','20230324xxxx')
				} else {
					return;
				}
			}
		});
	}
}

// 绑定手机
function thirdPartybindIphoneNumFn() {
	var bindmobile
	var bindmsgcode
	$('.bindPhoneBox .login_btn').click(function (e) {
		e.preventDefault();
		if (bindIphoneipt.val().replace(/\s+/g, '') === '') {
			$(".bindPhoneBox .login_iphone .tishi_error").html('请输入手机号').show()
		} else if (bindmsgipt.val().replace(/\s+/g, '') === '') {
			$(".bindPhoneBox .login_msg .tishi_msg").hide()
			$(".bindPhoneBox .login_msg .tishi_error").html('请输入短信验证码').show()
		} else {

		}
		var bindmobileType = $('.bindPhoneBox .login_iphone .tishi_error').is(':hidden')
		var bindmsgcodeType = $('.bindPhoneBox .login_msg .tishi_error').is(':hidden')
		if (bindmobileType && bindmsgcodeType) {
			bindmobile = bindIphoneipt.val().replace(/\s+/g, '')
			bindmsgcode = bindmsgipt.val().replace(/\s+/g, '')
			var verifycode = getCookiedl('verifycode')
			var url = '//reg.cctv.cn/openapi/v2/user/verification/mobile/binding'
			$.ajax({
				type: "post",
				url: url,
				data: {
					"timestamp": timestamp,
					"appid": "dgtGyfXwN9Gcr7ow",
					"mobile": bindmobile,
					"sms_code": bindmsgcode
				},
				headers: {
					"verifycode": verifycode,
				},
				dataType: "json",
				success: function (data) {
					// console.log(data)
					var errNum = data.code;
					if (errNum !== '0') {
						if (errNum === '-21021') {
							$(".bindPhoneBox .login_iphone .tishi_error").html('该手机号已有绑定账号,无法绑定').show()
						} else if (data.code === '-99999' || data.code === '-88888') {
							$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
							$(".systemErrorBox").show()
						} else {
							$(".bindPhoneBox .login_msg .tishi_msg").hide()
							$(".bindPhoneBox .login_msg .tishi_error").html(data.message).show()
						}
					} else {
						$('.loginMain .bindPhoneBox').hide()
						$('.loginMain .loginSuccessBox').find(".conw .txt01").text('绑定成功')
						$('.loginMain .loginSuccessBox').show()
						bindIphoneClearForm()
						var timer = setInterval(function () {
							$('.loginMain .loginSuccessBox').find(".conw .txt01").text('登录成功')
							clearInterval(timer)
						}, 2000)
						var floattimer = setInterval(function () {
							if($('.CurrentPageBox').length > 0) {
								window.location.reload()
							}
							$('.loginMain .loginSuccessBox').hide()
							$('.loginFloat').hide()
							$('.codeLoginBtn').show()
							$('.Maincont .loginBox').show()
							gologinpageFn('iphonerst')
							clearInterval(floattimer)
						}, 4000)
					}
				}
			});
		}

	});
}


/*---------------------- 公共方法 -----------------------*/
//图形验证码
function loadNewCodeMobile(id){
	_resetVerify()
}
function imgVerificationCB(id) {
	clearInterval(load)
	loadNewCodeMobile(id)//图形验证码	
	thisid = id
	load = setInterval(function () {
		loadNewCodeMobile(thisid);
	}, 180000)
}

// 图形验证码
function imgVerification(id) {
	loadNewCodeMobile(id)
	$('#' + id + '').unbind().click(function (e) {
		e.preventDefault();
		loadNewCodeMobile(id)
		clearInterval(load)
		thisid = id
		load = setInterval(function () {
			loadNewCodeMobile(thisid);
		}, 180000)
	});
}

// gitiphonemessageCode 方法为获取手机短信验证码
// 手机注册短信验证码
var msgTimer //时间函数
function gitiphonemessageCode(iphoneEl, imgCodeNum, msgEl, sendType, msgSwitch, imgcodeID) {
	// iphoneEl 手机号码输入框元素
	// imgcodeEl 图形验证码输入框元素
	// magEl 短信验证码输入框元素
	// sendType 发送类型 1表示注册，2表示重置密码（忘记密码，3绑定手机，4短信验证码登录
	// msgSwitch 发送短信按钮
	// imgcodeID 图形验证码ID 
	var iPhoneNum = iphoneEl.val().replace(/\s+/g, '') // 手机号（去除所有空格）
	if (iPhoneNum === '') {
		iphoneEl.parents('.login_iphone').find(".tishi_error").text("请输入手机号码").show()
		return false
	} else {
		// imgcodeEl.parents('.login_cord').find(".tishi_error").hide()
		$.ajax({
			type: "post",
			url: "//reg.cctv.cn/openapi/v2/user/verification/sms/code",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			data: {
				"timestamp": timestamp,
				"appid": "dgtGyfXwN9Gcr7ow",
				"mobile": iPhoneNum,
				"captcha_type": "1",
				"captcha_pass_code": imgCodeNum,
				"dynamic_captcha_type":"PUZZLE",
				"send_type": sendType
			},
			dataType: "json",
			success: function (data) {
				var msgdaojishiNum = 180
				// var msgSwitch = true
				if (data.code !== '0') {
					msgEl.parents('.login_msg').find('.tishi_msg').hide()
					if (data.code == "-21014") {
						imgcodeEl.parents('.login_cord').find('.tishi_error').text('z').show()
					} else if (data.code === "-21010") {
						iphoneEl.parents('.login_iphone').find('.tishi_error').text("手机号码格式不正确").show();
					} else if (data.code == "-21017") {
						msgEl.parents('.login_msg').find('.tishi_error').text("三分钟内频繁发送短信验证码").show();
					} else if (data.code == "-21015" || data.code == "-21016") {
						msgEl.parents('.login_msg').find('.tishi_error').text("短信验证码发送次数已达上限，请24小时后再试").show();
					} else {
						msgEl.parents('.login_msg').find('.tishi_error').text("" + data.errmsg + "").show();
					}
				} else {

			
					msgSwitch = false;
					msgEl.parents('.login_msg').find('.tishi_msg').show()
					msgEl.parents('.login_msg').find('.tishi_error').hide()
					msgEl.parents('.login_msg').find('.daojishi').html(msgdaojishiNum + "s后重发");
					msgEl.parents('.login_msg').find('.daojishi').addClass('texthover') // 此类名取消倒计时时文本高亮
					msgEl.parents('.login_msg').find('.daojishi').css('cursor', 'auto')
					msgTimer = setInterval(function () {
						msgdaojishiNum--;
						msgEl.parents('.login_msg').find('.daojishi').addClass('texthover') // 此类名取消倒计时时文本高亮
						msgEl.parents('.login_msg').find('.daojishi').html(msgdaojishiNum + "s后重发");
						if (msgdaojishiNum === 0) {
							clearInterval(msgTimer);
							msgEl.parents('.login_msg').find('.daojishi').html("重新获取");
							msgEl.parents('.login_msg').find('.daojishi').removeClass('texthover') // 此类名取消倒计时时文本高亮
							msgEl.parents('.login_msg').find('.daojishi').css('cursor', 'pointer')
							msgSwitch = true;
							msgEl.parents('.login_msg').find('.tishi_msg').hide();
						}
					}, 1000)
				}
			}
		});
	}
}

// 手机号 3 4 4
function iphoneFormat(iphoneiptEl, iphonespanEl, iphoneiptID) {
	iphoneiptEl.on("input", function () {
		var _this = $(this);
		iphonespanEl.show();
		if (_this.val() === "") {
			iphonespanEl.hide();
		}
		if ($(this)[0].id === iphoneiptID) {
			if ($(this).val().length == 3 || $(this).val().length == 8) {
				$(this).val($(this).val() + " ")
			}
			$(document).on("keydown", function (e) {
				if ((e.keyCode == 8 && _this.val().length == 9) || (e.keyCode == 8 && _this.val().length == 4)) {
					var n = _this.val().length - 1;
					var m = _this.val().slice(0, n);
					_this.val(m)
				}
			})
		}
	})
}

//验证手机号
function checkMobile(mobile) {
	var mreg = /^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/;
	if (mobile.length > 0 && mobile.length === 11) {
		if (!mreg.test(mobile)) {
			return false;
		}
		return true;
	}
}
// 验证邮箱
function checkLinkEmail(LinkEmail) {
	var reg = /^\w+@[a-zA-Z0-9]{2,10}(?:\.[a-zA-Z]{2,4}){1,3}$/;
	if (LinkEmail.length > 0) {
		if (!reg.test(LinkEmail)) {
			return false;
		}
		return true;
	}
}
// 验证密码
function checkPassword(password) {
	var reg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[~`!@#$%^&*.?:;,"'<>_(-)/[{}|]).{6,}$/
	if (password.length > 0) {
		if (!reg.test(password)) {
			return false;
		}
		return true;
	}
}

// 验证密码是否有特殊字符
function checkCNPassword(pass) {
	var regsss = /[^\x20-\x7e]/
	if (regsss.test(pass) || pass.replace(/\s+/g, '').length < pass.length) {
		return false;
	} else {
		return true;
	}
}


// 输入区
function pass(Idp, ipt, Idspan, gongneng) {
	var timer = null;
	Idp.on("click", function () {
		var _this = $(this);
		_this.siblings("input").show().focus();
		_this.hide();
	})
	ipt.on("blur", function () {
		var _this = $(this);
		_this.parents(".con").siblings(".tishi_error").hide()
		if (_this.val() === "") {
			_this.hide();
			_this.siblings("p").show();
		}
		if (gongneng == "duanxin" && _this.val() != "") { //验证短信验证码
			_this.parents(".login_msg").find(".tishi_error").hide();
		} else if (gongneng == "zhanghao1" && _this.val() != "") { //验证手机号或者邮箱
			if (!checkMobile(_this.val()) && !checkLinkEmail(_this.val())) {
				_this.parents(".login_iphone").find(".tishi_error").html('手机号格式错误/邮箱格式不正确').show();
			} else {
				_this.parents(".login_iphone").find(".tishi_error").html('手机号格式错误/邮箱格式不正确').hide();
			}
		} else if (gongneng == "phone" && _this.val() != "") { //验证手机号
			var _phone1 = $.trim(ipt.val());
			var reg = new RegExp(" ", "g");
			var _phone1 = _phone1.replace(reg, "");
			if (checkMobile(_phone1)) {
				_this.parents(".login_iphone").find(".tishi_error").html('手机号格式错误').hide();
			} else {
				_this.parents(".login_iphone").find(".tishi_error").html('手机号格式错误').show();
			}
		} else if (gongneng == "email" && _this.val() != "") { //验证邮箱
			if (checkLinkEmail(_this.val())) {
				_this.parents(".login_email").find(".tishi_error").html('邮箱格式错误').hide();
			} else {
				_this.parents(".login_email").find(".tishi_error").html('邮箱格式错误').show();
			}
		} else {
			_this.parents(".con").siblings(".tishi_error").hide();
		}
		timer = setTimeout(function () {
			Idspan.hide();
		}, 200)
	})
	ipt.on("focus", function () {
		var _this = $(this);
		if (_this.val() != "") {
			Idspan.show();
		}
	})
	ipt.on("input propertychange", function () {
		var _this = $(this);
		if (_this.val() != "") {
			Idspan.show();
		}
	})
	Idspan.on("click", function () { //清除按钮
		clearTimeout(timer)
		ipt.val("")
		ipt.focus();
		$(this).parents(".con").siblings(".tishi_error").hide();
		Idspan.hide()
	})
}

// 密码区
function passwordHiding(passobj, passObjShow, passobjHide, mrvalue) {
	var passobj = $(passobj)
	var showpsd = passObjShow; //type = text
	var password = passobjHide; //type = password
	var passclear = passobj.find(".clear_txt");
	var passlook = passobj.find(".look");
	var mrvalue = mrvalue
	var timer1 = null;
	var timer2 = null;
	var timer3 = null;
	//显示层聚焦时显示控制按钮
	showpsd.on("focus", function () {
		if (passlook.hasClass("cur")) {
			showpsd.show();
			password.hide();
			if (showpsd.val() == mrvalue) {
				showpsd.css({
					"color": "#7a7a7a"
				});
			} else {
				showpsd.css({
					"color": "#202020"
				});
				// if(showpsd.val() === '') passclear.hide(0)
				passclear.show(0)
			}

		} else {
			timer2 = setTimeout(function () {
				passclear.show(0);
				showpsd.hide();
				passclear.css({
					"color": "#202020"
				});
				password.show();
				password.focus();
				passlook.show();
			}, 250)
		}

	});
	showpsd.on("blur", function () {
		dlclick = false;
		clearTimeout(timer2)
		//显示层失去焦点是隐藏显示按钮
		timer3 = setTimeout(function () {
			passclear.hide(0);
			//passlook.hide();
		}, 250)
		//显示层输入了密码 就让密码等于 password的密码
		if (showpsd.val() !== mrvalue) {
			password.val(showpsd.val())
			showpsd.parents('.login_password').find('.tishi_error').hide()
			password.css({
				"color": "#202020"
			});
		}

		// if (showpsd.attr('id') !== 'showpsd' && showpsd.val().replace(/\s+/g, '') !== '' && !checkPassword(showpsd.val().replace(/\s+/g, ''))) {
		// 	showpsd.parents('.login_password').find('.tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show();
		// }
		//显示层如果没有输入密码 就让显示层的val值变成"请输入密码"
		if (showpsd.val() === "") {
			showpsd.val(mrvalue);
			showpsd.css({
				"color": "#7a7a7a"
			});
		}

		$('body').click(function (e) {
			var target = $(e.target);
			if (!target.is('.loginMain .loginBox .btn')) {
				if (showpsd.val() !== "" && showpsd.val() !== mrvalue && password.val() !== "") {
					if (showpsd.val().length > 16 || showpsd.val().length < 6) {
						if (!dlclick) {
							showpsd.parents('.con').siblings(".tishi_error").text('密码仅限8-16位,必须包含大小写字母、数字、符号').show();
						}
					} else if(!checkCNPassword(showpsd.val())){
                        if (!dlclick) {
							showpsd.parents('.con').siblings(".tishi_error").text('密码包含无效字符').show();
						}
                    } else {
						showpsd.parents('.con').siblings(".tishi_error").hide();
					}
				} else {
					// showpsd.parents('.con').siblings(".tishi_error").hide();
				}
			}
		});

	})
	//点击显示层时隐藏显示层并且显示密码层并且聚焦
	showpsd.on("click", function () {
		if ($(this).val() == mrvalue) {

			if (passlook.hasClass("cur")) {
				showpsd.show().val("");
				password.hide();
				showpsd.css({
					"color": "#202020"
				});
			} else {
				showpsd.hide();
				password.show().focus();
				password.css({
					"color": "#202020"
				});
			}
		}
	})

	passlook.on("click", function () {
		clearTimeout(timer1);
		//判断是否显示密码模式
		if (!$(this).hasClass("cur")) { //闭眼
			//如果是显示密码 就让显示层隐藏 让密码层显示聚焦
			clearTimeout(timer3);
			clearTimeout(timer2);
			if (showpsd.val() == mrvalue && password.val() == "") {

			} else {
				showpsd.val(password.val());
				showpsd.css({
					"color": "#202020"
				});
			}
			$(this).addClass("cur");
			showpsd.show();
			password.hide();
			passclear.hide();
		} else {
			// 如果是密码层就让显示层的value值等于密码 并且显示显示层并聚焦
			clearTimeout(timer2)
			clearTimeout(timer1)
			$(this).removeClass("cur");
			if (showpsd.val() == mrvalue) {
				showpsd.show();
			} else {
				showpsd.hide();
				password.val(showpsd.val())
				password.show();
				passclear.hide();
			}
		}
	})
	// 显示层输入时如果输入了显示控制层
	showpsd.on("input", function () {
		var _this = $(this);
		passclear.show();
		passlook.show();
		// 如果value值是空的 就让控制层隐藏
		if (_this.val() === "" || _this.val() === mrvalue) {
			passclear.hide();
			_this.parent().find(".tishi_error").hide();
		}

	})

	// 密码层失去焦点
	password.on("blur", function () {
		dlclick = false;
		var _this = $(this);
		// 如果value值为空 显示层显示 值为"请输入密码"
		if (_this.val() === "") {
			_this.hide()
			password.parents('.login_password').find('.tishi_error').hide()
			showpsd.show().val(mrvalue);
			showpsd.css({
				"color": "#7a7a7a"
			});
		}
		// if (password.attr('id') !== 'passwordFU' && password.val().replace(/\s+/g, '') !== '' && !checkPassword(password.val().replace(/\s+/g, ''))) {
		// 	password.parents('.login_password').find('.tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show();
		// }
		// 200毫秒以后控制层隐藏
		timer1 = setTimeout(function () {
			passclear.hide();
			//passlook.hide();
		}, 250)

		$('body').click(function (e) {
			var target = $(e.target);
			if (!target.is('.loginMain .loginBox .btn')) {
				if (password.val() !== "") {
					if (password.val().length > 16 || password.val().length < 6) {
						if (!dlclick) {
							password.parents('.login_password').find('.tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show();
						}
					} else if(!checkCNPassword(password.val())){
                        if (!dlclick) {
							password.parents('.login_password').find('.tishi_error').text('密码包含无效字符').show();
						}
                    }  else {
						password.parents('.con').siblings(".tishi_error").hide();
					}
				} else {
					// password.parents('.con').siblings(".tishi_error").hide();
				}
			}
		});
	})
	// 密码层聚焦
	password.on("focus", function () {
		var _this = $(this);
		if (_this.val() !== "") {
			passclear.show();
			passlook.show();
		}
	})
	//密码层输入时
	password.on("input", function () {
		var _this = $(this);
		passclear.show();
		passlook.show();
		if (_this.val() === "") {
			passclear.hide();
			_this.parent().find(".tishi_error").hide();
		}
	})

	//点击清除内容
	passclear.on("click", function () {
		clearTimeout(timer1);
		clearTimeout(timer3);
		var _this = $(this);
		if (passlook.hasClass("cur")) {
			showpsd.val("");
			passclear.hide();
			showpsd.focus();
			_this.siblings(".tishi_error").hide();
		} else {
			password.val("");
			passclear.hide();
			password.focus();
			_this.siblings(".tishi_error").hide();
		}
	})
}

// 注册成功跳转登录界面
function gologinpageFn(rstinfo) {
	// rstinfo 注册信息参数 手机注册 iphonerst 邮箱注册 emailrst
	var rstinfoIndec = rstinfo === 'iphonerst' ? 0 : 1
	var imgcodeId = rstinfo === 'iphonerst' ? 'codemobilef' : 'codemobiles'
	var loginpageBox = $(".loginMain .loginBox")
	loginpageBox.find('.login_title span').eq(rstinfoIndec).addClass("cur").siblings().removeClass("cur")
	loginpageBox.find('.login_con').eq(rstinfoIndec).addClass("cur").siblings(".login_con").removeClass("cur")
	// $('.activationSucceedBox').hide()
var ishide = $('#loginFloat').is(':hidden')
	if (!ishide) {

		thisid = imgcodeId

	}
	//$(".loginMain .loginBox").show()
	
	$('.loginMain .Maincont').show()
}

// 异常浮层
$('.systemErrorBox').on('click', function () {
	$(this).hide()
});
$(document).click(function (e) {
	// e.preventDefault()
	$(".systemErrorBox").hide()
});

//功能：根据用户输入的Email跳转到相应的电子邮箱首页
function gotoEmail($mail) {
	$t = $mail.split('@')[1];
	$t = $t.toLowerCase();
	if ($t === '163.com') {
		return 'https://mail.163.com';
	} else if ($t === 'vip.163.com') {
		return 'https://vip.163.com';
	} else if ($t === '126.com') {
		return 'https://mail.126.com';
	} else if ($t === 'qq.com' || $t === 'vip.qq.com' || $t === 'foxmail.com') {
		return 'https://wx.mail.qq.com/';
	} else if ($t === 'gmail.com') {
		return 'http://mail.google.com';
	} else if ($t === 'sohu.com') {
		return 'https://mail.sohu.com';
	} else if ($t === 'tom.com') {
		return 'https://mail.tom.com';
	} else if ($t === 'vip.sina.com') {
		return 'https://vip.sina.com.cn';
	} else if ($t === 'sina.com.cn' || $t === 'sina.com') {
		return 'https://mail.sina.com.cn';
	} else if ($t === 'yahoo.com.cn' || $t === 'yahoo.cn') {
		return 'https://www.yahoo.com';
	} else if ($t === 'yeah.net') {
		return 'https://www.yeah.net';
	} else if ($t === '21cn.com') {
		return 'https://mail.21cn.com/w2';
	} else if ($t === 'hotmail.com') {
		return 'https://outlook.live.com/owa/';
	} else if ($t === '188.com') {
		return 'https://www.188.com/';
	} else if ($t === '139.com') {
		return 'https://mail.10086.cn/';
	} else if ($t === '189.cn') {
		return 'https://webmail30.189.cn/w2/index.html';
	} else if ($t === 'wo.cn') {
		return 'https://mail.wo.cn/';
	} else if($t === 'staff.cntv.cn'){
		return 'https://staff.cntv.cn/';
	}else{
		return ''
	}
}


// 接口需要
function msisdn0() { }
function msisdn1() { }
function msisdn2() { }
function msisdn3() { }
function msisdn4() { }
function msisdn5() { }
function msisdned() {
	setTimeout(function () {
		var verifycode = getCookiedl("verifycode")
		muurl = '//reg.cctv.cn/openapi/v2/user/getNickNameAndFace';
		$.ajax({
			url: muurl,
			type: 'GET',
			dataType: 'json',
			data: {
				"timestamp": timestamp,
				"appid": "dgtGyfXwN9Gcr7ow",
				"verifycode": verifycode,
				"type": "ALL"
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			cache: true,
			success: function (data) {
				// console.log(data)
				callbackfun1(data)
			}

		})
	}, 100)
}
function msisdnedcopy() {
	setTimeout(function () {
		var verifycode = getCookiedl("verifycode")
		muurl = '//reg.cctv.cn/openapi/v2/user/getNickNameAndFace';
		$.ajax({
			url: muurl,
			type: 'GET',
			dataType: 'json',
			data: {
				"timestamp": timestamp,
				"appid": "dgtGyfXwN9Gcr7ow",
				"verifycode": verifycode,
				"type": "ALL"
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			cache: true,
			success: function (data) {
				if (data.code === '0') {
					var logindata = data
					var nickname = data.data.nickname;
					var userface = data.data.userface
					if (nickname.length > 21) {
						nickname = nickname.substr(0, 20) + "...";
					} else {
						nickname = nickname;
					}
					if (nickname.length >= 7) {
						nickname01 = nickname.substr(0, 6) + "...";
					} else {
						nickname01 = nickname;
					}
					// if ($('.yonghuzhongxin19940_ind01 .text').length !== 0) {
					// 	$('.yonghuzhongxin19940_ind01').addClass('islogin');
					// 	$('.yonghuzhongxin19940_ind01 .text .name a').text(nickname)
					// 	$('.yonghuzhongxin19940_ind01 .touxiang .img a img').attr('src', userface);
					// 	$('.yonghuzhongxin19940_ind01 .text .weidenglu').hide()
					// 	$('.yonghuzhongxin19940_ind01 .text .name').show()
					// }
					$(".user_icon").attr("title", data.data.nickname);
					$(".user_icon").find("a").attr("href", "//user.cctv.com");
					$(".user_icon").find("a").attr("target", "_blank")
					$(".user_icon").find(".btn_icon").css("background-position","-20px -20px")
					$(".user_icon").addClass("cur")
					$("#loginForm").hide();
					// $("#loginFloat").hide();
					try {
						islogin = true;
						jianchaStatus(logindata);
					} catch (e) {

					}

					var html_name = '<a id="welcome">欢迎您，</a><a id="cookie_user_name2" class="tn-tab" href="//user.cctv.com" target="_blank" title="' + data.data.nickname + '">' + nickname01 + '</a>';
					$("#SI_Top_Login_title").html(html_name);
					$(".retrieve .search .optionBox .tn-title").css("cursor", "default");
					$("#SI_Top_Login_title").unbind();
					$("#SI_Top_LoginLayer").remove();
					$("#SI_Top_Login").parents("#loginForm").show();

					clearInterval(load);
					setTimeout(function () {
						if ($("iframe#comment_iframe1").length > 0) {
							document.getElementById('comment_iframe1').contentWindow.location.reload();
						}
						if ($("iframe#comment_iframe").length > 0) {
							document.getElementById('comment_iframe').contentWindow.location.reload();
						}
					}, 500)
				} else {
					return
				}
			}

		})
	}, 500)
}

function msisdnedloginout() {
	setTimeout(function () {
		$(".user_icon").html('<a href="javascript:void(0);"><span class="btn_icon"></span></a>')
		$(".user_icon").removeClass("cur")
		$("#loginForm").show()
		// $("#loginFloat").hide();
		
		try{
			document.getElementById('SI_Top_Login_title').innerHTML = '<a id="ccc" class="tn-tab">登录</a>';
	        document.getElementById('logout').innerHTML = '<a id="register_1" href="' + zhuceurl + '" target="_blank">注册</a>';
		}catch (e) { }
		try {
			islogin = false;
			jianchaStatus();
		} catch (e) { }
		if($('.CurrentPageBox').length > 0) {
			$('.CurrentPageBox').hide()
			var AvatarUrl = '//p5.img.cntv.cn/photoAlbum/templet/common/DEPA1658908558759922/icon_touxiang.png'
			$(".yonghuzhongxin19940_ind01 .touxiang .img a img").attr('src', AvatarUrl)
			$(".yonghuzhongxin19940_ind01").removeClass('islogin')
			$(".yonghuzhongxin19940_ind01 .text .name").hide()
			$(".yonghuzhongxin19940_ind01 .text .weidenglu").show() 
			$(".header.vip19981_topnav").find('.li8').removeClass('cur')
			$(".header.vip19981_topnav").find('.li8 img').attr('src',AvatarUrl)
			$(".header.vip19981_topnav").find('.li8 a').attr('title','')
			pciuserbasicinfo = {} //用户信息 在左侧导航中定义
			$('.yonghuzhongxin19940_ind10.notLoginBox').show() 
			$('.yonghuzhongxin19940_ind10.noRecordtBox').hide()
		}
		// if(verifycodec !== "" && verifycodec !== null && verifycodec !== undefined) {
		// 	if($('.CurrentPageBox').length > 0) {
		// 		$('.CurrentPageBox').show()
		// 		$('.yonghuzhongxin19940_ind10.notLoginBox').hide()
		// 	}	
		// }
		clearInterval(load);
		setTimeout(function () {
			if ($("iframe#comment_iframe1").length > 0) {
				document.getElementById('comment_iframe1').contentWindow.location.reload();
			}
			if ($("iframe#comment_iframe").length > 0) {
				document.getElementById('comment_iframe').contentWindow.location.reload();
			}
		}, 500)
		if($('#abc').is(":checked")) {
			$('.CurrentPageBox').hide()
        	$('.yonghuzhongxin19940_ind10.notLoginBox').show()
        	window.location.replace('https://www.cctv.cn/')
		}
	}, 500)
}

function callbackfun1(data) {
	if (data.code === '0') {
		var logindata = data
		var nickname = data.data.nickname;
		var userface = data.data.userface
		if (nickname.length > 21) {
			nickname = nickname.substr(0, 20) + "...";
		} else {
			nickname = nickname;
		}
		if (nickname.length >= 7) {
			nickname01 = nickname.substr(0, 6) + "...";
		} else {
			nickname01 = nickname;
		}
		if($('.yonghuzhongxin19940_ind05').length !== 0) {
			$(".header ul .li8").addClass("cur")
            $(".header ul .li8").html('<a href="JavaScript:;"  title="' + nickname + '"><img src="' + userface + '" alt=""><i></i></a>')
            $(".header ul .li10 .dengluhou").html('<img src="' + userface + '" alt="">')
            $(".header ul .li10 .dengluhou").attr("href", "http://qrcode.cntv.cn/LZnXlD1Z")
            $(".header ul .li10 .name p").html('<a href="http://qrcode.cntv.cn/LZnXlD1Z">' + nickname + '</a>')
		}
		// if ($('.yonghuzhongxin19940_ind01 .text').length !== 0) {
		// 	$('.yonghuzhongxin19940_ind01').addClass('islogin');
		// 	$('.yonghuzhongxin19940_ind01 .text .name a').text(nickname)
		// 	$('.yonghuzhongxin19940_ind01 .touxiang .img a img').attr('src', userface);
		// 	$('.yonghuzhongxin19940_ind01 .text .weidenglu').hide()
		// 	$('.yonghuzhongxin19940_ind01 .text .name').show()
		// }
		$(".user_icon").attr("title", data.data.nickname);
		$(".user_icon").find("a").attr("href", "//user.cctv.com");
		$(".user_icon").find("a").attr("target", "_blank")
		$(".user_icon").find(".btn_icon").css("background-position","-20px -20px")
		$(".user_icon").addClass("cur")
		$("#loginForm").hide()
		$.ajax({
			type: "post",
			url: "//reg.cctv.cn/openapi/v2/user/isAuth",
			dataType: "json",
			data: {
				"timestamp": timestamp,      //当前时间戳
				"appid": "dgtGyfXwN9Gcr7ow"  //管理员分配给业务线应用的唯一标识
			},
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,            //添加跨域参数是为了将登录标识（token）带过去验证
			success: function (data) {
				// console.log(data)
				// console.log('callbackfun1','20230324qqqqq')
				if (data.data === '0') {
					$('.loginMain .Maincont').hide();
					$(".loginMain .codeLoginBtn").hide();

					thisid = 'codemobilebd'

					var rstemailmsgSwitch = true
					var rstgetemailmsgBtn = $('.bindPhoneBox .login_msg .daojishi')
					rstgetemailmsgBtn.on('click', function () {
						if (bindIphoneipt.val().replace(/\s+/g, '') === '') {
							$(".bindPhoneBox .login_iphone .tishi_error").html('请输入手机号').show();
							return false;
						}
						if (!checkMobile(bindIphoneipt.val().replace(/\s+/g, ''))) {
							$(".bindPhoneBox .login_iphone .tishi_error").html('手机号格式错误').show()
							return false;
						}
						if (($('.bindPhoneBox .conw .login_msg em.daojishi').text() === '获取验证码' || $('.bindPhoneBox .conw .login_msg em.daojishi').text() === '重新获取')) {
							getPicture()
							
						} else {
							bindmsgipt.parents('.login_msg').find('.tishi_msg').show()
						}
					});
					thirdPartybindIphoneNumFn()
					$('.codeLoginBtn').hide()
					$('.loginFloat').show()
					$('.loginMain .bindPhoneBox').show()
				} else {
					$('.codeLoginBtn').hide()
					$('.loginMain .loginSuccessBox').show()
					$('.loginMain .loginSuccessBox').find(".conw .txt01").text('登录成功')
					$('.loginDuanxin .login_msg .daojishi').css('color','#bf0614')
					iphmsgnum = false
					if (thisid === 'codemobiles' && IDPassword.length < 7 || thisid === 'codemobiles' && !checkPassword(IDPassword)) {
						var timer = setInterval(function () {
							clearInterval(timer)
							$('.loginMain .loginSuccessBox').hide()
							
							$('.loginMain .passwordRisk').show()
						}, 2000)
					} else {
						var timer = setInterval(function () {
							clearInterval(timer)
							$('.loginMain .loginSuccessBox').hide()
							$('#loginFloat').hide()
							$('.codeLoginBtn').show()
							$(".loginMain .loginBox").show()
							$('.loginBox').show()
							gologinpageFn('iphonerst')
							if($('.CurrentPageBox').length > 0) {
								window.location.reload()
							}
						}, 2000)
					}
				}
			}
		});

		// $("#loginFloat").hide();
		try {
			islogin = true;
			jianchaStatus(logindata);
		} catch (e) {

		}

		var html_name = '<a id="welcome">欢迎您，</a><a id="cookie_user_name2" class="tn-tab" href="//user.cctv.com" target="_blank" title="' + data.data.nickname + '">' + nickname01 + '</a>';
		$("#SI_Top_Login_title").html(html_name);
		$("#logout").html('<a href="javascript:void(0);" onclick="logout()">退出</a>');
		$(".retrieve .search .optionBox .tn-title").css("cursor", "default");
		$("#SI_Top_Login_title").unbind();
		$("#SI_Top_LoginLayer").remove();
		$("#SI_Top_Login").parents("#loginForm").show();

		clearInterval(load);
		setTimeout(function () {
			if ($("iframe#comment_iframe1").length > 0) {
				document.getElementById('comment_iframe1').contentWindow.location.reload();
			}
			if ($("iframe#comment_iframe").length > 0) {
				document.getElementById('comment_iframe').contentWindow.location.reload();
			}
		}, 500)
	} else {
		return
	}
}


function Base64() {
	// private property  
	_keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

	// public method for encoding  
	this.encode = function (input) {
		var output = "";
		var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
		var i = 0;
		input = _utf8_encode(input);
		while (i < input.length) {
			chr1 = input.charCodeAt(i++);
			chr2 = input.charCodeAt(i++);
			chr3 = input.charCodeAt(i++);
			enc1 = chr1 >> 2;
			enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
			enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
			enc4 = chr3 & 63;
			if (isNaN(chr2)) {
				enc3 = enc4 = 64;
			} else if (isNaN(chr3)) {
				enc4 = 64;
			}
			output = output +
				_keyStr.charAt(enc1) + _keyStr.charAt(enc2) +
				_keyStr.charAt(enc3) + _keyStr.charAt(enc4);
		}
		return output;
	}

	// public method for decoding  
	this.decode = function (input) {
		var output = "";
		var chr1, chr2, chr3;
		var enc1, enc2, enc3, enc4;
		var i = 0;
		input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");
		while (i < input.length) {
			enc1 = _keyStr.indexOf(input.charAt(i++));
			enc2 = _keyStr.indexOf(input.charAt(i++));
			enc3 = _keyStr.indexOf(input.charAt(i++));
			enc4 = _keyStr.indexOf(input.charAt(i++));
			chr1 = (enc1 << 2) | (enc2 >> 4);
			chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
			chr3 = ((enc3 & 3) << 6) | enc4;
			output = output + String.fromCharCode(chr1);
			if (enc3 != 64) {
				output = output + String.fromCharCode(chr2);
			}
			if (enc4 != 64) {
				output = output + String.fromCharCode(chr3);
			}
		}
		output = _utf8_decode(output);
		return output;
	}

	// private method for UTF-8 encoding  
	_utf8_encode = function (string) {
		string = string.replace(/\r\n/g, "\n");
		var utftext = "";
		for (var n = 0; n < string.length; n++) {
			var c = string.charCodeAt(n);
			if (c < 128) {
				utftext += String.fromCharCode(c);
			} else if ((c > 127) && (c < 2048)) {
				utftext += String.fromCharCode((c >> 6) | 192);
				utftext += String.fromCharCode((c & 63) | 128);
			} else {
				utftext += String.fromCharCode((c >> 12) | 224);
				utftext += String.fromCharCode(((c >> 6) & 63) | 128);
				utftext += String.fromCharCode((c & 63) | 128);
			}

		}
		return utftext;
	}

	// private method for UTF-8 decoding  
	_utf8_decode = function (utftext) {
		var string = "";
		var i = 0;
		var c = c1 = c2 = 0;
		while (i < utftext.length) {
			c = utftext.charCodeAt(i);
			if (c < 128) {
				string += String.fromCharCode(c);
				i++;
			} else if ((c > 191) && (c < 224)) {
				c2 = utftext.charCodeAt(i + 1);
				string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));
				i += 2;
			} else {
				c2 = utftext.charCodeAt(i + 1);
				c3 = utftext.charCodeAt(i + 2);
				string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));
				i += 3;
			}
		}
		return string;
	}
}
var base64 = new Base64()

/*---------------------- 账号、手机号登录方式切换区 -----------------------*/
$(".loginMain .loginBox").find(".login_title span").click(function () {
	var loginIndex = $(this).index();
	if (loginIndex === 0) {
		if (!$(this).hasClass('cur')) {
			if(Idipt1.val().replace(/\s+/g, '') !== '') Idp1.hide()
			thisid = 'codemobilef'
			// $('.tishi_error').hide()
			// idloginClear()
			// if(Idipt1.val().replace(/\s+/g, '') !== '') {
			// 	iphoneloginClearTab()
			// } else {
			// 	iphoneloginClear()
			// }
			// clearInterval(load)
			// imgVerification('codemobilef');//图形验证码
			// 
			// load = setInterval(function () {
			// 	loadNewCodeMobile(thisid);
			// }, 180000)
		} else {
			return
		}
	} else {
		if (!$(this).hasClass('cur')) {
			// $('.tishi_error').hide()
			// idloginClear()
			// if(Idipt1.val().replace(/\s+/g, '') !== '') {
			// 	iphoneloginClearTab()
			// } else {
			// 	iphoneloginClear()
			// }
			getCookieUserInfo()
			// clearInterval(load)
			// imgVerification('codemobiles');//图形验证码
			 thisid = 'codemobiles'
			// load = setInterval(function () {
			// 	loadNewCodeMobile(thisid);
			// }, 180000)
		} else {
			return
		}
	}
	$(this).addClass("cur").siblings().removeClass("cur")
	$(".loginMain .loginBox").find(".login_con").eq(loginIndex).addClass("cur").siblings(".login_con").removeClass("cur");
})

/*---------------------- 登录 -----------------------*/
//账号登录  
var Idp = $(".loginMain .loginBox .loginZhanghao .login_iphone p");
var Idipt = $("#Id");
var Idspan = $(".loginMain .loginBox .login_iphone .clear_txt");

//账号登录图形验证码
var Idp4 = $(".loginMain .loginBox .loginZhanghao .login_cord .con p");
var Idipt4 = $("#cord02");
var Idspan4 = $(".loginMain .loginBox .loginZhanghao .login_cord .con .clear_txt");

//手机登录
var Idp1 = $(".loginMain .loginBox .loginDuanxin .login_iphone .con p");
var Idipt1 = $("#phone");
var Idspan1 = $(".loginMain .loginBox .login_iphone .con .clear_txt");

//短信登录图形验证码
var Idp2 = $(".loginMain .loginBox .loginDuanxin .login_cord .con p");
var Idipt2 = $("#cord");
var Idspan2 = $(".loginMain .loginBox .loginDuanxin .login_cord .con .clear_txt");

//短信验证码
var Idp3 = $(".loginMain .loginBox .loginDuanxin .login_msg .con p");
var Idem3 = $(".loginMain .loginBox .login_msg .con em.daojishi");
var Idipt3 = $("#msg");
var Idspan3 = $(".loginMain .loginBox .loginDuanxin .login_msg .con .clear_txt");

// 手机号 3 4 4 
iphoneFormat(Idipt1, Idspan1, 'phone')

/*---------------------- 短信登录 -----------------------*/
var iphmsgnum = false //必须获取短信验证码
var statem = true;
var emtimer = null;
var loginduanxinBtn = $(".loginMain .loginDuanxin .login_msg .daojishi")
var login_btn = $(".loginMain .loginBox .loginDuanxin .login_btn");
pass(Idp1, Idipt1, Idspan1, "phone"); //手机号
pass(Idp2, Idipt2, Idspan2); //短信登录图形验证码
//imgVerification('codemobilef');//图形验证码
pass(Idp3, Idipt3, Idspan3, "duanxin"); //短信验证码
$('.loginDuanxin .login_msg .tishi_msg').hide()
var duanxinLoginBtn = $('.loginDuanxin .login_btn') // 登录

// Tab 键聚焦
$(".loginDuanxin input").keydown(function (e) {
	if (9 === e.keyCode) {
		if ($("#phone").css("display") !== "none") {
			setTimeout(function () {
				$("#phone").parents(".login_iphone").siblings(".login_cord").find(".con p").hide();
				$("#phone").parents(".login_iphone").siblings(".login_cord").find(".con #cord").show().focus();
			})
		}
		if ($("#cord").css("display") !== "none") {
			setTimeout(function () {
				$("#cord").parents(".login_cord").siblings(".login_msg").find(".con p").hide();
				$("#cord").parents(".login_cord").siblings(".login_msg").find(".con #msg").show().focus();
			})
		}
	}
});
// 同意协议
var dxagreementBtn = $('.loginDuanxin .reading_register .remeber em')
dxagreementBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	if (agreementTypes) {
		$('.loginDuanxin .reading_register .remeber').removeClass('cur');
	} else {
		$('.loginDuanxin .hint_y').css('visibility', 'hidden')
		$('.loginDuanxin .reading_register .remeber').addClass('cur')
	}
});
// 获取短信验证码
loginduanxinBtn.on("click", function () {
	if (statem) {
		var msisdn = $.trim(Idipt1.val()); //手机号
		var reg = new RegExp(" ", "g");
		var msisdn = msisdn.replace(reg, "");
	
		if (msisdn !== "") {
			if (checkMobile(msisdn)) {
				Idipt1.parents(".login_iphone").find(".tishi_error").html("手机号格式不正确").hide();
			} else {
				return false;
			}
		} else {
			Idipt1.parents(".login_iphone").find(".tishi_error").html("请输入手机号码").show();
			return false;
		}
		getPicture();
		$()
	} else {
		$(".loginMain .loginDuanxin .login_msg .tishi_msg").text("验证码已发送，可能会有延后请耐心等待").show()
	}
})

var _service = window.location.href;
// var _service = 'http://www.cctv.cn'

var passwordkey = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o",
	"p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "A", "B", "C", "D",
	"E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S",
	"T", "U", "V", "W", "X", "Y", "Z", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"
];
function passkey(length) {
	var Str = "";
	for (var i = 0; i < length; i++) {
		Str += passwordkey[Math.floor(Math.random() * passwordkey.length)];
	}
	return Str;
}
var nonce = passkey(16);
var PUBLIC_KEY = "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCfZ2v+re+b8CUFkL5InZvpwe1BEOhzpSqWNiKTGnDnohYXSpVQbIQGnoIiL4mmqdyog+WwnK99Yc8fCUmXf5D/nFXtmCyLyDhOgLJ5Ha7H0JJWNaVKTRHCT+aFjSr08/K/NLPFV2/4q7C1S5cOf6do76PJ+GdxU7V0GpFmAgsIPQIDAQAB"
var encryptd = new JSEncrypt();
encryptd.setPublicKey('-----BEGIN PUBLIC KEY-----' + PUBLIC_KEY + '-----END PUBLIC KEY-----');
function encryptras(messages, nonce) {
	var keyhex = CryptoJS.enc.Utf8.parse(nonce);
	var messagehex = CryptoJS.enc.Utf8.parse(messages);
	var encrypted = CryptoJS.AES.encrypt(messagehex, keyhex, {
		iv: keyhex,
		mode: CryptoJS.mode.CBC,
		padding: CryptoJS.pad.Pkcs7
	})
	return encrypted.toString();
}

duanxinLoginBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.loginDuanxin .reading_register .remeber').is('.cur')
	// 判断是否输入手机号
	if (Idipt1.val().replace(/\s+/g, '') === '') {
		$('.loginDuanxin .login_iphone .tishi_error').text('请输入手机号').show()
	} else if (Idipt3.val().replace(/\s+/g, '') === '') {
		$('.loginDuanxin .login_msg .tishi_msg').hide()
		$('.loginDuanxin .login_msg .tishi_error').text('请输入短信验证码').show()
	} else if (!iphmsgnum) {
		$('.loginDuanxin .login_msg .tishi_msg').hide()
		$('.loginDuanxin .login_msg .tishi_error').text('请获取短信验证码').show()
	} else if (!agreementTypes) {
		$('.loginDuanxin .hint_y').css('visibility', 'visible')
	} else {
		
			$('.loginDuanxin .login_iphone .tishi_error').hide()
			$('.loginDuanxin .login_msg .tishi_error').hide()
	}

	var iphoneType = $('.loginDuanxin .login_iphone .tishi_error').is(':hidden')
	var imgType = $('.loginDuanxin .login_cord .tishi_error').is(':hidden')
	var msgType = $('.loginDuanxin .login_msg .tishi_error').is(':hidden')
	if (iphoneType && imgType && msgType && agreementTypes) {
		var msisdn = $.trim(Idipt1.val()); //手机号
		var reg = new RegExp(" ", "g");
		var msisdn = msisdn.replace(reg, "");
		var verfiCode = $.trim(Idipt3.val()); //短信验证码
		var _url = "//reg.cctv.cn/openapi/v2/user/quickLogin"
		$.ajax({
			url: _url,
			type: 'POST',
			dataType: 'json',
			data: {
				"timestamp": timestamp,
				"appid": "dgtGyfXwN9Gcr7ow",
				"mobile": msisdn,
				"sms_code": verfiCode,
				"rem_login": 1
			},
			success: function (data) {
				// imgVerificationCB('codemobilef')
				// console.log(data)
				cb2(data)
			}
		});
	} else {
		return
	}

});

function cb2(data) {
	var ticket_ = data.ticket;
	var code = data.code;
	var msg = data.message;
	if (code !== '0') {
		$(".loginMain .loginDuanxin .login_msg .tishi_msg").hide();
		$(".loginMain .loginDuanxin .login_msg .tishi_error").text("请核对手机号码").show();
		if (code == "-21012") {
			$(".loginMain .loginDuanxin .login_msg .tishi_error").html("短信验证码错误").show();
		} else if (code == "-21011") {
			$(".loginMain .loginDuanxin .login_msg .tishi_error").html("短信验证码已超时").show();
		} else if (code == "-21010") {
			$(".loginMain .loginDuanxin .login_msg .tishi_error").html("请核对手机号码").show();
		} else if (data.code === '-99999' || data.code === '-88888') {
			$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
			$(".systemErrorBox").show()
		} else {
			$(".loginMain .loginDuanxin .login_msg .tishi_error").text(msg).show();
		}
	}
	if (code === '0') {
		$(".loginMain .loginDuanxin .login_msg .tishi_error").hide()
		$('.Maincont').hide()
		var ssoArray = data.data.sso;
		for (var i = 0; i < ssoArray.length; i++) {
			if (i == ssoArray.length - 1) {
				var bc = "msisdned";
			} else {
				var bc = "msisdn" + i;
			}
			$.ajax({
				url: ssoArray[i],
				type: 'post',
				dataType: 'jsonp',
				jsonp: 'callback',
				jsonpCallback: bc,
				cache: true,
				success: function (data) { }
			})
		}
		setCookiedl('CurrentPage','1')
		$("#loginForm").hide();
		iphoneloginClear()
		$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
		sta = true;
		statem = true;
		clearInterval(emtimer);
		clearInterval(load);
	}
}

// 手机登录表单清空
function iphoneloginClear() {
	Idipt1.val('')
	Idp1.show()
	Idipt2.val('')
	Idp2.show()
	Idipt3.val('')
	Idp3.show()
	$('.loginDuanxin .hint_y').css('visibility', 'hidden');
	$('.loginDuanxin .login_msg .daojishi').text('获取验证码')
	$('.loginDuanxin .tishi_error').hide()
	$('.loginDuanxin .tishi_msg').hide()
	clearInterval(emtimer);
	$('.loginDuanxin .reading_register .remeber').removeClass('cur')
}
function iphoneloginClearTab() {
	Idp1.hide()
	if(!checkMobile(Idipt1.val().replace(/\s+/g, ''))) $('.loginDuanxin .login_iphone .tishi_error').show()
	// if(Idipt2.val().replace(/\s+/g, '') !== '') {
	// 	Idp2.hide()
	// 	$('.loginDuanxin .login_cord .tishi_error').show()
	// }
	// if(Idipt3.val().replace(/\s+/g, '') !== '') {
	// 	Idp3.hide()
	// 	$('.loginDuanxin .login_msg .tishi_error').show()
	// }
	$('.loginDuanxin .hint_y').css('visibility', 'hidden');
	$('.loginDuanxin .reading_register .remeber').removeClass('cur')
}


//获取短信验证码
function requestVerficode(checkidmobile) {
	var msisdn = $.trim(Idipt1.val()); //手机号
		var reg = new RegExp(" ", "g");
		var msisdn = msisdn.replace(reg, "");
	
	$.ajax({
		url: "//reg.cctv.cn/openapi/v2/user/verification/sms/code",
		type: 'post',
		dataType: 'json',
		xhrFields: {
			withCredentials: true
		},
		crossDomain: true,
		data: {
			"timestamp": timestamp,
			"appid": "dgtGyfXwN9Gcr7ow",
			"mobile": msisdn,
			"dynamic_captcha_type": 'PUZZLE',
			"captcha_type": "1",
			"captcha_pass_code": checkidmobile,
			"send_type": "4"
		},
		success: function (data) {
			// console.log(data)
			cb5(data)
		}
	});
}

function cb5(data) {
	$(".loginMain .loginDuanxin .login_msg .tishi_error").hide();
	// $(".loginMain .loginDuanxin .login_msg .tishi_msg").hide();
	if (data.code !== "0") {
		if (data.code == "-21014") {
			$(".loginMain .loginDuanxin .login_msg .tishi_msg").hide();
			$(".loginMain .loginDuanxin .login_cord .tishi_error").text("图形验证码错误").show();
		} else {
			$(".loginMain .loginDuanxin .login_msg .tishi_msg").hide();
			if (data.code === "-21010") {
				$(".loginMain .loginDuanxin .login_msg .tishi_error").text("请核对手机号码").show();
			} else if (data.code == "-21017") {
				$(".loginMain .loginDuanxin .login_msg .tishi_error").text("三分钟内频繁发送短信验证码").show();
			} else if (data.code == "-21015" || data.code == "-21016") {
				$(".loginMain .loginDuanxin .login_msg .tishi_error").text("短信验证码发送次数已达上限，请24小时后再试").show();
			} else {
				$(".loginMain .loginDuanxin .login_msg .tishi_error").text(data.errmsg).show();
			}
		}
	} else if (data.code === "0") {

		$(".loginMain .loginDuanxin .login_msg .tishi_error").hide();
		var time = 180;
		$(".loginMain .loginDuanxin .login_msg .tishi_msg").show();
		loginduanxinBtn.html(time + "s后重发");
		loginduanxinBtn.addClass('texthover') // 此类名取消倒计时时文本高亮
		loginduanxinBtn.css('cursor', 'auto')
		emtimer = setInterval(function () {
			time--;
			
			loginduanxinBtn.html(time + "s后重发")
			if (time == 0) {
				clearInterval(emtimer);
				loginduanxinBtn.removeClass('texthover')
				loginduanxinBtn.html("重新获取");
				loginduanxinBtn.css('cursor', 'pointer')
				statem = true;
				
			}
		}, 1000)
		statem = false;
		iphmsgnum = true;
	}
}

/*---------------------- 账号登录 -----------------------*/
pass(Idp, Idipt, Idspan, 'zhanghao1');
var loginshowpsd = $("#showpsd");
var loginpassword = $(".loginZhanghao .login_password #passwordFU");
passwordHiding(".loginMain .loginBox .login_password", loginshowpsd, loginpassword, "请输入密码"); //账号登陆密码 
pass(Idp4, Idipt4, Idspan4);

//Tab 键聚焦
$(".loginZhanghao input").keydown(function (e) {
	if (9 === e.keyCode) {
		if (Idipt.css("display") !== "none") {
			setTimeout(function () {
				if(Idipt.parents(".login_iphone").siblings(".login_password").find(".look").hasClass("cur")){
					Idipt.parents(".login_iphone").siblings(".login_password").find(".input_box #passwordFU").hide();
					Idipt.parents(".login_iphone").siblings(".login_password").find(".input_box #showpsd").show().focus();
				}else{
					Idipt.parents(".login_iphone").siblings(".login_password").find(".input_box #showpsd").hide();
					Idipt.parents(".login_iphone").siblings(".login_password").find(".input_box #passwordFU").show().focus();
				}
				
			})
		}
		if(Idipt.parents(".login_iphone").siblings(".login_password").find(".look").hasClass("cur")){
			if (loginshowpsd.css("display") !== "none") {
				setTimeout(function () {
					loginpassword.parents(".login_password").siblings(".login_cord").find(".con p").hide();
					loginpassword.parents(".login_password").siblings(".login_cord").find(".con #cord02").show().focus();
				})
			}
		} else {
			if (loginpassword.css("display") !== "none") {
				setTimeout(function () {
					loginpassword.parents(".login_password").siblings(".login_cord").find(".con p").hide();
					loginpassword.parents(".login_password").siblings(".login_cord").find(".con #cord02").show().focus();
				})
			}
		}
	}
});


var remember = $('.loginZhanghao .login_checked .remeber')
// var rememberme = $('.loginZhanghao .login_checked .remeber em') // 记住我
remember.on('click', function () {
	if (remember.hasClass("cur")) {
		remember.removeClass("cur");
	} else {
		remember.addClass("cur");
	}
});

// 获取用户存在cookie中的账号和密码
function getCookieUserInfo() {
	var uiuid = getCookiedl('cookname')
	var uipsd = getCookiedl('cookpas')
	
	if (uiuid !== null && uiuid !== 'undefined' && uiuid !== 'object') {
		uipsd = base64.decode(getCookiedl('cookpas'))
		$('.loginBox .loginZhanghao .login_iphone .con .chinaiphone p').hide()
		Idipt.val(uiuid).show()
		loginshowpsd.hide()
		loginpassword.val(uipsd).show()
	} else {
		// idloginClear()
	}
}

var agreementBtn = $('.loginZhanghao .reading_register .remeber em')// 同意协议
agreementBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (agreementTypes) {
		$('.loginZhanghao .reading_register .remeber').removeClass('cur');
	} else {
		$('.loginZhanghao .hint_y').css('visibility', 'hidden')
		$('.loginZhanghao .reading_register .remeber').addClass('cur')
	}
});


// 账号登录按钮
var loginzhanghaoBtn = $('.loginZhanghao .login_btn')
loginzhanghaoBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.loginZhanghao .reading_register .remeber').is('.cur')
	if (Idipt.val().replace(/\s+/g, '') === '') {
		$('.loginZhanghao .login_iphone .tishi_error').text('请输入手机号或邮箱').show()
	} else if (loginpassword.val().replace(/\s+/g, '') === '') {
		$('.loginZhanghao .login_password .tishi_error').text('请输入密码').show()
	}  else if (!agreementTypes) {
		$('.loginZhanghao .hint_y').css('visibility', 'visible')
	} else if (!checkMobile(Idipt.val()) && !checkLinkEmail(Idipt.val())) {
		$('.loginZhanghao .login_iphone .tishi_error').html('手机号格式错误/邮箱格式不正确').show();
	} else  {
		$('.loginZhanghao .login_iphone .tishi_error').hide()
		$('.loginZhanghao .login_password .tishi_error').hide()
	}

	var accountnumberType = $('.loginZhanghao .login_iphone .tishi_error').is(':hidden')
	var pwdType = $('.loginZhanghao .login_password .tishi_error').is(':hidden')

	if (accountnumberType && pwdType  && agreementTypes) { 
		getPicture()

		
		

	} else {
		return false
	}
});

function loginzhanghao(pic_code){
		var username = Idipt.val() //账号
		var password1 = loginpassword.val(); //密码
		encryptdata = 'account=' + username.toLowerCase() + '&appid=dgtgyfxwn9gcr7ow&captcha_pass_code=' + pic_code.toLowerCase() + '&captcha_type=1&dynamic_captcha_type=puzzle&nonce=' + nonce.toLowerCase() + '&password=' + password1.toLowerCase() + '&rem_login=1&ts=' + timestamp;
		var url = '//reg.cctv.cn/openapi/v2/user/login?timestamp=' + timestamp;

		$.ajax({
			type: "post",
			url: url,
			data: {
				"account": encryptras(username, nonce),
				"appid": encryptras("dgtGyfXwN9Gcr7ow", nonce),
				"captcha_pass_code": encryptras(pic_code, nonce),
				"captcha_type": encryptras("1", nonce),
				"dynamic_captcha_type":encryptras("PUZZLE", nonce),
				"nonce": encryptd.encrypt(nonce),
				"password": encryptras(password1, nonce),
				"rem_login": encryptras("1", nonce),
				"ts": encryptras(timestamp, nonce),
				"encryptdata": sha512(encryptdata)
			},
			
			dataType: "json",
			success: function (data) {
				// console.log(data)
				var msg = data.message;
				var errNum = data.code;
				if (errNum !== '0') {
					if (errNum == "-21018") {
						loginshowpsd.addClass('error')
						loginpassword.addClass('error')
						$('.loginZhanghao .login_password').on('blur', '.error', function () {
							$('.loginZhanghao .login_iphone .tishi_error').hide()
							loginshowpsd.removeClass('error')
							loginpassword.removeClass('error')
						});
						$('.loginZhanghao .login_iphone .tishi_error').html("账号或密码错误").show();
					} else if (data.code == "-21013") {
						$('.loginZhanghao .login_cord .tishi_error').html("图形验证码已超过有效时间").show();
					} else if (data.code == "-21014") {
						$(".loginZhanghao .login_cord .tishi_error").html("图形验证码错误").show();
					} else if (data.code == "-21023") {
						$('.loginZhanghao .login_iphone .tishi_error').css('cursor', 'pointer')
						$('.loginZhanghao .login_iphone .tishi_error').addClass('goActivation')
						$('.loginZhanghao').unbind().on('click', '.goActivation', function () {
							VerificationClassFn(username, password1,1)
						});
						$('.loginZhanghao .login_iphone .tishi_error').text('用户未激活，立即激活>>').show()
					} else {
						$(".loginZhanghao .login_cord .tishi_error").html(msg).show();
					}
				} else {
					setCookiedl('CurrentPage','1')
					IDPassword = password1
					$('.Maincont').hide()
					var ssoArray = data.data.sso;
					for (var i = 0; i < ssoArray.length; i++) {
						if (i == ssoArray.length - 1) {
							var bc = "msisdned";
						} else {
							var bc = "msisdn" + i;
						}
						$.ajax({
							url: ssoArray[i],
							type: 'post',
							dataType: 'jsonp',
							jsonp: 'callback',
							jsonpCallback: bc,
							cache: true,
							success: function (data) { }
						})
					}
					// gologinpageFn('iphonerst')
					// $(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试')
					if (!remember.hasClass("cur")) {
						idloginClear()
						setCookiedl("cookname", cookname)
						setCookiedl("cookpas", cookpas)
						var cookname = getCookiedl("cookname")
						var cookpas = getCookiedl("cookpas")
						if (cookname != "" && cookname != null && cookname != undefined) {
							delCookiedl(cookname);
							delCookiedl(cookpas);
						}
					} else {
						idloginClear()
					}

					if (remember.hasClass("cur")) {
						var cookname = username;
						var cookpas = password1;
						cookpas = base64.encode(cookpas)
						setCookiedl("cookname", cookname)
						setCookiedl("cookpas", cookpas)
					}
				}
			}
		});
}
// 账号登陆清空表单
function idloginClear() {
	Idipt.val('')
	Idp.show()
	loginshowpsd.val("请输入密码").css('color', '#7a7a7a').show()
	loginpassword.val("").hide()
	Idipt4.val('')
	Idp4.show()
	$('.loginZhanghao .hint_y').css('visibility', 'hidden');
	$('.loginZhanghao .tishi_error').hide()
	$('.loginZhanghao .login_password .look').removeClass('cur')
	$('.loginZhanghao .reading_register .remeber').removeClass('cur')
}


/*--------------------注册、登录切换 -----------------------*/
var oldid=''
$(".loginMain .Maincont .register_btn").click(function () {
	// $('.tishi_error').hide()
	// if(Idipt1.val().replace(/\s+/g, '') !== '') {
	// 	iphoneloginClearTab()
	// } else {
	// 	iphoneloginClear()
	// }
	// idloginClear()
	// 图形验证码
oldid=thisid
	thisid = 'codemobilei'

	$(".loginMain .Maincont").hide();
	$(".loginMain .registerBox").show();
	$(".registerPhone").addClass("cur")
	$(".registerEmail").removeClass("cur")
	$(".loginMain .login_title span").eq(2).addClass("cur").siblings().removeClass("cur");
})
$(".loginMain .registerBox .register_btn").click(function () {
	// $('.tishi_error').hide()
	// rstiphoneClear()
	// rstemailClear()
	getCookieUserInfo()
	if(Idipt1.val().replace(/\s+/g, '') !== '') {
		iphoneloginClearTab()
	} else {
		iphoneloginClear()
	}
	thisid=oldid
	imgVerification('codemobilef')

	$(".loginMain .loginBox").show();
	$(".loginMain .registerBox").hide();
	$('.loginMain .Maincont').show()
})

/*--------------------手机号邮箱注册方式切换区-----------------------*/
$(".loginMain .registerBox").find(".login_title span").click(function () {
	// $('.tishi_error').hide()
	var loginIndex = $(this).index();
	if (loginIndex === 0) {
		if (!$(this).hasClass('cur')) {

			thisid = 'codemobilei'

		} else {
			return
		}
	} else {
		if (!$(this).hasClass('cur')) {
	
			thisid = 'codemobilet'
	
		} else {
			return
		}
	}
	$(this).addClass("cur").siblings().removeClass("cur")
	$(".loginMain .registerBox").find(".login_con").eq(loginIndex).addClass("cur").siblings(".login_con").removeClass("cur");
})

/*-------------------- 手机注册 -----------------------*/
//手机注册
var Idp5 = $(".loginMain .registerBox .login_iphone .con p");
var Idipt5 = $("#regPhone");
var Idspan5 = $(".loginMain .registerBox .login_iphone .con .clear_txt");

//短信注册图形验证码
var Idp6 = $(".loginMain .registerBox .registerPhone .login_cord .con p");
var Idipt6 = $("#regCord");
var Idspan6 = $(".loginMain .registerBox .registerPhone .login_cord .con .clear_txt");

//注册短信验证码
var Idp7 = $(".loginMain .registerBox .login_msg .con p");
var Idem7 = $(".loginMain .registerBox .login_msg .con em.daojishi");
var Idipt7 = $("#regMsg");
var Idspan7 = $(".loginMain .registerBox .login_msg .con .clear_txt");
$('.registerPhone .login_msg .tishi_msg').hide()
pass(Idp7, Idipt7, Idspan7);
pass(Idp6, Idipt6, Idspan6);
// 密码
var iphoneShowPw = $('#iphoneshowpsd')
var iphoneHidePw = $('#iphonepasswordFU')
var iphonePwText = $('.loginMain .registerPhone .login_password01 .tishi_error')
// 确认密码
var iphoneShowConfirmPw = $('#iphoneshowpsd02')
var iphoneHideConfirmPw = $('#iphonepasswordFU02')
var iphoneConfirmPwText = $('.loginMain .registerPhone .login_password02 .tishi_error')
passwordHiding(".loginMain .registerPhone .login_password01", iphoneShowPw, iphoneHidePw, "密码仅限8-16位,必须包含大小写字母、数字、符号"); //手机注册密码
passwordHiding(".loginMain .registerPhone .login_password02", iphoneShowConfirmPw, iphoneHideConfirmPw, "确认密码"); //手机注册密码02

//Tab 键聚焦
$(".registerPhone input").keydown(function (e) {
	if (9 === e.keyCode) {
		if (Idipt5.css("display") !== "none") {
			setTimeout(function () {
				Idipt5.parents(".login_iphone").siblings(".login_cord").find(".con p").hide();
				Idipt5.parents(".login_iphone").siblings(".login_cord").find(".con #regCord").show().focus();
			})
		}
		if (Idipt6.css("display") !== "none") {
			setTimeout(function () {
				Idipt6.parents(".login_cord").siblings(".login_msg").find(".con p").hide();
				Idipt6.parents(".login_cord").siblings(".login_msg").find(".con #regMsg").show().focus();
			})
		}
		if (Idipt7.css("display") !== "none") {
			setTimeout(function () {
				if(Idipt7.parents(".login_msg").siblings(".login_password01").find(".look").hasClass("cur")){
					Idipt7.parents(".login_msg").siblings(".login_password01").find(".con #iphonepasswordFU").hide();
					Idipt7.parents(".login_msg").siblings(".login_password01").find(".con #iphoneshowpsd").show().focus();
				}else{
					Idipt7.parents(".login_msg").siblings(".login_password01").find(".con #iphoneshowpsd").hide();
					Idipt7.parents(".login_msg").siblings(".login_password01").find(".con #iphonepasswordFU").show().focus();
				}
			})
		}
		if (iphoneHidePw.css("display") !== "none") {
			setTimeout(function () {
				if(iphoneHidePw.parents(".login_password01").siblings(".login_password02").find(".look").hasClass("cur")){
					iphoneHidePw.parents(".login_password01").siblings(".login_password02").find(".con #iphonepasswordFU02").hide();
					iphoneHidePw.parents(".login_password01").siblings(".login_password02").find(".con #iphoneshowpsd02").show().focus();
				}else{
					iphoneHidePw.parents(".login_password01").siblings(".login_password02").find(".con #iphoneshowpsd02").hide();
					iphoneHidePw.parents(".login_password01").siblings(".login_password02").find(".con #iphonepasswordFU02").show().focus();
				}
			})
		}
	}
});

// 手机号 3 4 4 
iphoneFormat(Idipt5, Idspan5, 'regPhone')
pass(Idp5, Idipt5, Idspan5, "phone");
// 同意协议
var zciphoneagreementBtn = $('.registerPhone .reading_register .remeber em')
zciphoneagreementBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.registerPhone .reading_register .remeber').is('.cur')
	if (agreementTypes) {
		$('.registerPhone .reading_register .remeber').removeClass('cur');
	} else {
		$('.registerPhone .hint_y').css('visibility', 'hidden')
		$('.registerPhone .reading_register .remeber').addClass('cur')
	}
});


var rstipmsgSwitch = true
var rstgetmagBtn = $('.registerBox .registerPhone .login_msg .daojishi')
rstgetmagBtn.on('click', function () {
	if (Idipt5.val().replace(/\s+/g, '') === '') {
		$('.registerPhone .login_iphone .tishi_error').text('手机号不能为空').show()
		return false
	}
	if (!checkMobile(Idipt5.val().replace(/\s+/g, ''))) {
		$(".registerPhone .login_iphone .tishi_error").html('手机号格式错误').show()
		return false;
	}
	if (Idem7.text() === '获取验证码' || Idem7.text() === '重新获取') {
		getPicture()
		
	} else {
		Idipt7.parents('.login_msg').find('.tishi_msg').show()
	}
});

// 手机注册事件
var iphonerstBtn = $('.registerPhone .login_btn')
iphonerstBtn.on('click', function () {
	var agreementTypes = $('.registerPhone .reading_register .remeber').is('.cur')
	if (checkMobile(Idipt5.val().replace(/\s+/g, ''))) {
		$('.registerPhone .login_iphone .tishi_error').hide()
	}
	if (Idipt5.val().replace(/\s+/g, '') === '') {
		$('.registerPhone .login_iphone .tishi_error').text('手机号不能为空').show()
	} else if (Idipt7.val().replace(/\s+/g, '') === '') {
		$('.registerPhone .login_msg .tishi_msg').hide()
		$('.registerPhone .login_msg .tishi_error').text('短信验证码不能为空').show()
	} else if (iphoneHidePw.val().replace(/\s+/g, '') === '') {
		$('.registerPhone .login_password01 .tishi_error').text('密码不能为空').show()
	} else if (!checkPassword(iphoneHidePw.val())) {
		$('.registerPhone .login_password01 .tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show()
	} else if (!checkCNPassword(iphoneHidePw.val())) {
		$('.registerPhone .login_password01 .tishi_error').text('密码包含无效字符').show()
	} else if (iphoneHideConfirmPw.val().replace(/\s+/g, '') === '') {
		$('.registerPhone .login_password02 .tishi_error').text('确认密码不能为空').show()
	} else if (!agreementTypes) {
		$('.registerPhone .hint_y').css('visibility', 'visible')
	} else {

	}

	var rstiphoneType = $('.registerPhone .login_iphone .tishi_error').is(':hidden')
	var rstipmsgType = $('.registerPhone .login_msg .tishi_error').is(':hidden')
	var rstippasType = $('.registerPhone .login_password01 .tishi_error').is(':hidden')
	var rstipqrpasType = $('.registerPhone .login_password02 .tishi_error').is(':hidden')

	if (agreementTypes && rstiphoneType  && rstipmsgType && rstippasType && rstipqrpasType) {
		var rstiphoneNum = Idipt5.val().replace(/\s+/g, '')
		var rstipmsgNum = Idipt7.val().replace(/\s+/g, '')
		var rstippasNum = iphoneHidePw.val().replace(/\s+/g, '')
		var rstipqrpasNum = iphoneHideConfirmPw.val().replace(/\s+/g, '')
		encryptdata = 'appid=dgtgyfxwn9gcr7ow&confirm_password=' + rstipqrpasNum.toLowerCase() + '&mobile=' + rstiphoneNum.toLowerCase() + '&nonce=' + nonce.toLowerCase() + '&password=' + rstippasNum.toLowerCase() + '&sms_code=' + rstipmsgNum.toLowerCase() + '&ts=' + timestamp;
		var url = '//reg.cctv.cn/openapi/v2/user/register/mobile?timestamp=' + timestamp;
		$.ajax({
			type: "post",
			url: url,
			data: {
				"appid": encryptras("dgtGyfXwN9Gcr7ow", nonce),
				"confirm_password": encryptras(rstipqrpasNum, nonce),
				"mobile": encryptras(rstiphoneNum, nonce),
				"nonce": encryptd.encrypt(nonce),
				"password": encryptras(rstippasNum, nonce),
				"sms_code": encryptras(rstipmsgNum, nonce),
				"ts": encryptras(timestamp, nonce),
				"encryptdata": sha512(encryptdata)
			},
			dataType: "json",
			success: function (data) {
				// console.log(data)
				var errNum = data.code;
				if (errNum !== '0') {
					if (data.code === "-21010") {
						$('.registerPhone .login_iphone .tishi_error').text('手机号码格式不正确').show()
					} else if (data.code === '-21019') {
						$('.registerPhone .login_iphone .tishi_error').text('手机号已被注册').show()
					} else if (data.code === '-21013') {
						$('.registerPhone .login_cord .tishi_error').text('图形验证码已超过有效时间').show()
					} else if (data.code === '-21014') {
						$('.registerPhone .login_cord .tishi_error').text('图形验证码错误').show()
					} else if (data.code === '-21011') {
						$('.registerPhone .login_msg .tishi_msg').hide()
						$('.registerPhone .login_msg .tishi_error').text('短信验证码已超时').show()
					} else if (data.code === '-21012') {
						$('.registerPhone .login_msg .tishi_msg').hide()
						$('.registerPhone .login_msg .tishi_error').text('短信验证码错误').show()
					} else if (data.code === '-21007') {
						$('.registerPhone .login_password02 .tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show()
					} else if (data.code === '-21008') {
						$('.registerPhone .login_password02 .tishi_error').text('两次密码不相同').show()
					} else if (data.code === '-99999' || data.code === '-88888') {
						$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
						$(".systemErrorBox").show()
						return
					} else {
						$('.registerPhone .login_password02 .tishi_error').text(data.message).show()
					}
				} else {
					setCookiedl('CurrentPage','1')
					$('.registerBox').hide()
					$('.registerPhone .login_msg .tishi_msg').hide()
					var ssoArray = data.data.sso;
					for (var i = 0; i < ssoArray.length; i++) {
						if (i == ssoArray.length - 1) {
							var bc = "msisdned";
						} else {
							var bc = "msisdn" + i;
						}
						$.ajax({
							url: ssoArray[i],
							type: 'post',
							dataType: 'jsonp',
							jsonp: 'callback',
							jsonpCallback: bc,
							cache: true,
							success: function (data) { }
						})
					}
					clearInterval(msgTimer)
					// 清空表单
					rstiphoneClear()
				}
			}
		});
	} else {
		return false
	}
});
// 手机注册表单清除
function rstiphoneClear() {
	Idipt5.val('').hide()
	Idp5.show()
	Idipt6.val('').hide()
	Idp6.show()
	Idipt7.val('').hide()
	Idp7.show()
	clearInterval(msgTimer)
	$('.registerPhone .login_msg .daojishi').text('获取验证码')
	$('.registerPhone .login_password01 .look').removeClass('cur')
	$('.registerPhone .login_password02 .look').removeClass('cur')
	iphoneHidePw.val('').hide()
	iphoneShowPw.val('密码仅限8-16位,必须包含大小写字母、数字、符号').css('color', '#7a7a7a').show()
	iphoneHideConfirmPw.val('').hide()
	iphoneShowConfirmPw.val('确认密码').css('color', '#7a7a7a').show()
	$('.registerPhone .tishi_error').hide()
	$('.registerPhone .tishi_msg').hide()
	$('.registerPhone .reading_register .remeber').removeClass('cur')
}


/*-------------------- 邮箱注册 -----------------------*/
//邮箱注册
var Idp8 = $(".loginMain .registerBox .login_email .con p");
var Idipt8 = $("#emailId");
var Idspan8 = $(".loginMain .registerBox .login_email .con .clear_txt");

//图形验证码
var Idp9 = $(".loginMain .registerBox .registerEmail .login_cord .con p");
var Idipt9 = $("#emailcord");
var Idspan9 = $(".loginMain .registerBox .registerEmail .login_cord .con .clear_txt");
var emailshowpsd = $("#emailshowpsd");
var emailpassword = $("#emailpasswordFU");
var emailshowpsd02 = $("#emailshowpsd02");
var emailpassword02 = $("#emailpasswordFU02");
pass(Idp8, Idipt8, Idspan8, "email");
pass(Idp9, Idipt9, Idspan9);

// 密码确认密码验证
var password = $('.registerEmail .login_password01 #emailpasswordFU')// 密码(隐藏)
var passwordshow = $('.registerEmail .login_password01 #emailshowpsd')
var passwordText = $('.registerEmail .login_password01 .tishi_error')// 密码提示
var confirmpassword = $('.registerEmail .login_password02 #emailpasswordFU02')// 确认密码(隐藏)
var confirmpasswordshow = $('.registerEmail .login_password02 #emailshowpsd02')
var confirmpasswordText = $('.registerEmail .login_password02 .tishi_error')// 确认密码提示
passwordHiding(".loginMain .registerEmail .login_password01", passwordshow, password, "密码仅限8-16位,必须包含大小写字母、数字、符号"); //邮箱注册密码
passwordHiding(".loginMain .registerEmail .login_password02", confirmpasswordshow, confirmpassword, "确认密码"); //邮箱注册密码02

$(".registerEmail input").keydown(function (e) {
	if (9 === e.keyCode) {
		if (Idipt8.css("display") !== "none") {
			setTimeout(function () {
				Idipt8.parents(".login_email").siblings(".login_cord").find(".con p").hide();
				Idipt8.parents(".login_email").siblings(".login_cord").find(".con #emailcord").show().focus();
			})
		}
		if (Idipt9.css("display") !== "none") {
			setTimeout(function () {
				if(Idipt9.parents(".login_cord").siblings(".login_password01").find(".look").hasClass("cur")){
					Idipt9.parents(".login_cord").siblings(".login_password01").find(".con #emailpasswordFU").hide();
					Idipt9.parents(".login_cord").siblings(".login_password01").find(".con #emailshowpsd").show().focus();
				}else{
					Idipt9.parents(".login_cord").siblings(".login_password01").find(".con #emailshowpsd").hide();
					Idipt9.parents(".login_cord").siblings(".login_password01").find(".con #emailpasswordFU").show().focus();
				}
			})
		}
		if (emailpassword.css("display") !== "none") {
			setTimeout(function () {
				if(emailpassword.parents(".login_password01").siblings(".login_password02").find(".look").hasClass("cur")){
					emailpassword.parents(".login_password01").siblings(".login_password02").find(".con #emailpasswordFU02").hide();
					emailpassword.parents(".login_password01").siblings(".login_password02").find(".con #emailshowpsd02").show().focus();
				}else{
					emailpassword.parents(".login_password01").siblings(".login_password02").find(".con #emailshowpsd02").hide();
					emailpassword.parents(".login_password01").siblings(".login_password02").find(".con #emailpasswordFU02").show().focus();
				}
				
			})
		}
	}
});

/*-------------------- 绑定手机号 -----------------------*/
// 手机号
var bindIphonep = $(".bindPhoneBox .login_iphone .con p");
var bindIphoneipt = $("#bindphone");
var bindIphonespan = $(".bindPhoneBox .login_iphone .con .clear_txt");
pass(bindIphonep, bindIphoneipt, bindIphonespan, "phone");
iphoneFormat(bindIphoneipt, bindIphonespan, 'bindphone') // 手机号 3 4 4 

// 图形验证码
var bindImgp = $(".bindPhoneBox .login_cord .con p");
var bindImgipt = $("#bindcord");
var bindImgspan = $(".bindPhoneBox .login_cord .con .clear_txt");
pass(bindImgp, bindImgipt, bindImgspan);

// 短信验证码
var bindmsgp = $(".bindPhoneBox .login_msg .con p");
var bindmsgipt = $("#bindmsg");
var bindmsgspan = $(".bindPhoneBox .login_msg .con .clear_txt");
$('.bindPhoneBox .login_msg .tishi_msg').hide()
pass(bindmsgp, bindmsgipt, bindmsgspan);

$(".bindPhoneBox input").keydown(function (e) {
	if (9 === e.keyCode) {
		if (bindIphoneipt.css("display") !== "none") {
			setTimeout(function () {
				bindIphoneipt.parents(".login_iphone").siblings(".login_cord").find(".con p").hide();
				bindIphoneipt.parents(".login_iphone").siblings(".login_cord").find(".con #bindcord").show().focus();
			})
		}
		if (bindImgipt.css("display") !== "none") {
			setTimeout(function () {
				bindImgipt.parents(".login_cord").siblings(".login_msg").find(".con p").hide();
				bindImgipt.parents(".login_cord").siblings(".login_msg").find(".con #bindmsg").show().focus();
			})
		}
	}
});

// 清空绑定手机表单
function bindIphoneClearForm() {
	bindIphoneipt.val('').hide()
	bindIphonep.show()
	bindImgipt.val('').hide()
	bindImgp.show()
	bindmsgipt.val('').hide()
	bindmsgp.show()
	$('.bindPhoneBox .tishi_error').hide()
	$('.bindPhoneBox .tishi_msg').hide()
	clearInterval(msgTimer)
	$('.bindPhoneBox .conw .daojishi').text('获取验证码')
}
// 同意协议
var zcemailagreementBtn = $('.registerEmail .reading_register .remeber em')
zcemailagreementBtn.click(function (e) {
	e.preventDefault();
	var agreementTypes = $('.registerEmail .reading_register .remeber').is('.cur')
	if (agreementTypes) {
		$('.registerEmail .reading_register .remeber').removeClass('cur');
	} else {
		$('.registerEmail .hint_y').css('visibility', 'hidden')
		$('.registerEmail .reading_register .remeber').addClass('cur')
	}
});

// 邮箱注册
var emailrstBtn = $('.registerEmail .login_btn')
emailrstBtn.on('click', function () {
	var agreementTypes = $('.registerEmail .reading_register .remeber').is('.cur')
	if (Idipt8.val().replace(/\s+/g, '') === '') {
		$('.registerEmail .login_email .tishi_error').text('邮箱不能为空').show()
	}  else if (emailpassword.val().replace(/\s+/g, '') === '') {
		$('.registerEmail .login_password01 .tishi_error').text('密码不能为空').show()
	} else if (!checkPassword(emailpassword.val())) {
		$('.registerEmail .login_password01 .tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show()
	} else if (!checkCNPassword(emailpassword.val())) {
		$('.registerEmail .login_password01 .tishi_error').text('密码包含无效字符').show()
	} else if (emailpassword02.val().replace(/\s+/g, '') === '') {
		$('.registerEmail .login_password02 .tishi_error').text('确认密码不能为空').show()
	} else if (!agreementTypes) {
		$('.registerEmail .hint_y').css('visibility', 'visible')
	} else {

	}

	var rstemailType = $('.registerEmail .login_email .tishi_error').is(':hidden')
	var rstpassType = $('.registerEmail .login_password01 .tishi_error').is(':hidden')
	var rstqrpassType = $('.registerEmail .login_password02 .tishi_error').is(':hidden')

	if (rstemailType  && rstpassType && rstqrpassType && agreementTypes) {
			getPicture()

		
	} else {
		return false
	}
});
function emailrstfun(pic_code){
	
	var username = Idipt8.val().replace(/\s+/g, '') // 邮箱
		var passwordone = emailpassword.val().replace(/\s+/g, '') // 密码
		var passwordtwo = emailpassword02.val().replace(/\s+/g, '') // 确认密码

		encryptdata = 'appid=dgtgyfxwn9gcr7ow&captcha_pass_code=' + pic_code.toLowerCase()+'&captcha_type=1&confirm_password=' + passwordtwo.toLowerCase() + '&dynamic_captcha_type=puzzle&email=' + username.toLowerCase() + '&nonce=' + nonce.toLowerCase() + '&password=' + passwordone.toLowerCase() + '&ts=' + timestamp;
		var url = '//reg.cctv.cn/openapi/v2/user/mailcode/register?timestamp=' + timestamp;;
		$.ajax({
			type: "post",
			url: url,
			data: {
				"appid": encryptras("dgtGyfXwN9Gcr7ow", nonce),
				"captcha_pass_code": encryptras(pic_code, nonce),
				"captcha_type": encryptras("1", nonce),
				'confirm_password': encryptras(passwordtwo, nonce),
				"dynamic_captcha_type":encryptras("PUZZLE", nonce),
				"email": encryptras(username, nonce),
				"nonce": encryptd.encrypt(nonce),
				"password": encryptras(passwordone, nonce),
				"ts": encryptras(timestamp, nonce),
				"encryptdata": sha512(encryptdata)
			},
			dataType: "json",
			success: function (data) {
				// console.log(data)
				$('.registerEmail .login_email .tishi_error').css('cursor', 'auto')
				var msg = data.message;
				var errNum = data.code;
				if (errNum !== '0') {
					if (data.code === "-21004" || data.code === "-21005") {
						$('.registerEmail .login_email .tishi_error').text('邮箱格式错误').show()
					} else if (data.code === '-21006') {
						$('.registerEmail .login_email .tishi_error').text('邮箱含有禁词').show()
					} else if (data.code === '-21023') {
						$('.registerEmail .login_email .tishi_error').css('cursor', 'pointer')
						$('.registerEmail .login_email .tishi_error').addClass('goActivation')
						$('.registerEmail').unbind().on('click', '.goActivation', function () {
							VerificationClassFn(username, passwordtwo,1)
						});
						$('.registerEmail .login_email .tishi_error').text('用户未激活，立即激活>>').show()
					} else if (data.code === '-21009') {
						$('.registerEmail .login_email .tishi_error').text('邮箱已经被注册').show()
					} else if (data.code === '-21013') {
						$('.registerEmail .login_cord .tishi_error').text('图形验证码已超过有效时间').show()
					} else if (data.code === '-21014') {
						$('.registerEmail .login_cord .tishi_error').text('图形验证码错误').show()
					} else if (data.code === '-21007') {
						$('.registerEmail .login_password02 .tishi_error').text('密码仅限8-16位,必须包含大小写字母、数字、符号').show()
					} else if (data.code === '-21008') {
						$('.registerEmail .login_password02 .tishi_error').text('两次密码不相同').show()
					} else if (data.code === '-99999' || data.code === '-88888') {
						$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
						$(".systemErrorBox").show()
					} else {
						$('.registerEmail .login_password02 .tishi_error').text(msg).show()
					}
				} else {
					VerificationClassFn(username, passwordtwo,0)
				}
			}
		});
}
// 邮箱注册表单清除
function rstemailClear() {
	Idipt8.val('').hide()
	Idp8.show()
	Idipt9.val('').hide()
	Idp9.show()
	$('.registerEmail .login_password01 .look').removeClass('cur')
	$('.registerEmail .login_password02 .look').removeClass('cur')
	emailpassword.val('').hide()
	emailshowpsd.val('密码仅限8-16位,必须包含大小写字母、数字、符号').css('color', '#7a7a7a').show()
	emailpassword02.val('').hide()
	emailshowpsd02.val('确认密码').css('color', '#7a7a7a').show()
	bindIphoneipt.val('').hide()
	bindIphonep.show()
	bindImgipt.val('').hide()
	bindImgp.show()
	bindmsgipt.val('').hide()
	bindmsgp.show()
	$('.registerEmail .tishi_error').hide()
	$('.registerEmail .reading_register .remeber').removeClass('cur')
}
var  jihuozh;
var  jihuomima;
/*-------------------- 账号激活 -----------------------*/
function VerificationClassFn(username, passwordtwo,num) { // num 0 / 1
	var num = num
	jihuozh=username;
	jihuomima=passwordtwo;
	$('.Maincont').hide()
	
	$('.codeLoginBtn').hide()
	var gotoemailUrl = gotoEmail(username)
	$('#gotoemailUrl').attr('href', gotoemailUrl)
	var emyztishi = $('.verifyMailBox .conw .tishi_error')// 错误提示
	emyztishi.css('visibility', 'hidden').show()

	// imgVerification('codemobilees')
	// thisid = 'codemobilees'
	// load = setInterval(function () {
	// 	loadNewCodeMobile(thisid);
	// }, 180000)
	// $('.verifyAgain').show();
	// 返回邮箱验证页面

	if(num === 0) {
		$('.verifyMailBox .login_emailcode .chongxinfasong').removeClass('cf');
		$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'auto')
		$('.verifyMailBox .login_emailcode .chongxinfasong').html('已发送,可能会有延后请耐心等待')
		$('.registerBox').hide()
		$('.verifyMailBox').show();
		clearInterval(load)
		emailVerificationFn(username, passwordtwo)
	} else {
		
		againEmailVerificationCode()
		
	}
	
}

// 重新发送邮箱验证码
function againEmailVerificationCode(pic_code) {
	
	if ($('.verifyAgain .button').hasClass('goback')) {
		$('.verifyAgain .button').addClass('againEmailVerificationCode').removeClass('goback')
	}


		thisid = 'codemobilees'
		getPicture();

}

function againEmailVerificationCodeReturn(pic_code){
	var yzemailUrl = '//reg.cctv.cn/openapi/v2/user/send/mail/verification/code'
	$.ajax({
		type: "post",
		url: yzemailUrl,
		data: {
			"timestamp": timestamp,
			"appid": "dgtGyfXwN9Gcr7ow",
			"captcha_type": "1",
			"dynamic_captcha_type":"PUZZLE",
			"email": jihuozh,
			"captcha_pass_code": pic_code,
			"send_type": "1"
		},
		dataType: "json",
		success: function (data) {
			// console.log(data)
			var msg = data.message;
			var errNum = data.code;
			// 失败
			if (errNum !== '0') {
			
				if (data.code === '-21013') {
					$('.verifyAgain .login_cord .tishi_error').text('图形验证码已超过有效时间').show()
				} else if (data.code === '-21014') {
					$('.verifyAgain .login_cord .tishi_error').text('图形验证码错误').show()
				} else if (data.code === '-21055') {
					$('.verifyMailBox .login_emailcode .chongxinfasong').removeClass('cf');
					$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'auto')
					$('.verifyMailBox .login_emailcode .chongxinfasong').html('已发送,可能会有延后请耐心等待')
					$('.verifyMailBox').show();
					$('.verifyAgain').hide();
					$('.registerBox').hide()
					clearInterval(load)
					emailVerificationFn(jihuozh, jihuomima)
				} else if (data.code === '-99999' || data.code === '-88888') {
					$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
					$(".systemErrorBox").show()
					return
				} else if (errNum === '-21052') {
							$('.verifyMailBox .conw .tishi_error').text('您已输入错误5次,请1小时后再试').css('visibility', 'visible')
							$('.verifyMailBox .login_emailcode .chongxinfasong').addClass('cf')
							$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'pointer')
							$('.verifyMailBox').show();
							$('.verifyAgain').hide();
							$('.registerBox').hide()
							emailVerificationFn(jihuozh, jihuomima)
							$('.chongxinfasong').unbind("click").on('click', function () {
								if ($(this).hasClass("cf")) {
									// $('.goback').text('返回上一步')
									// $('.verifyMailBox').hide();
									// $('.verifyAgain').show();
									// $('.verifyAgain .button').addClass('againEmailVerificationCode').removeClass('goback')
									thisid = 'codemobilees'
										
									jihuozh=username
									getPicture()
								}
							});
							$('.verifyMailBox .verifyMail .chongxinfasong').text('重新发送验证邮件')
						}else {
					$('.verifyAgain .login_cord .tishi_error').text(msg).show()
					return
				}
			}
			// 成功
			if (errNum === '0') {
				// $('.goback').text('')
				$('.verifyMailBox .login_emailcode .chongxinfasong').removeClass('cf');
				$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'auto')
				$('.verifyMailBox .login_emailcode .chongxinfasong').html('已发送,可能会有延后请耐心等待')
				$('.verifyMailBox').show();
				$('.verifyAgain').hide();
				$('.registerBox').hide()
				clearInterval(load)
				emailVerificationFn(jihuozh, jihuomima)
			}
		}
	});
}
// 邮箱验证
function emailVerificationFn(username, passwordtwo) {
	// 邮箱验证码
	var Idpemyz = $(".verifyMailBox .login_emailcode .con p");
	var Idiptemyz = $("#verifyemailcord");
	var Idspanemyz = $(".verifyMailBox .login_emailcode .con .clear_txt");
	Idiptemyz.val('').hide()
	Idpemyz.show()
	$('.verifyMailBox .conw .tishi_error').text('').css('visibility', 'visible')
	pass(Idpemyz, Idiptemyz, Idspanemyz);
	Idiptemyz.blur(function (e) {
		e.preventDefault();
		if (Idiptemyz.val().replace(/\s+/g, '') === '') {
			$('.verifyMailBox .conw .tishi_error').html('邮箱验证码不能为空').css('visibility', 'visible')
		} else {
			$('.verifyMailBox .conw .tishi_error').css('visibility', 'hidden')
		}
	});
	// 邮箱验证码确认按钮
	var emailconfirmBtn = $(".verifyMailBox .conw .verifyMail .confirm_btn")
	emailconfirmBtn.click(function (e) {
		e.preventDefault();
		if (Idiptemyz.val().replace(/\s+/g, '') === '') {
			$('.verifyMailBox .conw .tishi_error').html('邮箱验证码不能为空').css('visibility', 'visible')
		}
		var emyztishiType = $('.verifyMailBox .conw .tishi_error').css('visibility')
		if (emyztishiType === 'hidden') {
			var emcode = Idiptemyz.val()
			var url = '//reg.cctv.cn/openapi/v2/user/mail/check/code'
			$.ajax({
				type: "post",
				url: url,
				data: {
					"timestamp": timestamp,
					"appid": "dgtGyfXwN9Gcr7ow",
					"code": emcode,
					"email": username,
					"mail_verification_type": "ACTIVATION"
				},
				dataType: "json",
				success: function (data) {
					// console.log(data)
					var errNum = data.code;
					if (errNum !== '0') {
						if (errNum === '-21052') {
							$('.verifyMailBox .conw .tishi_error').text('您已输入错误5次,请1小时后再试').css('visibility', 'visible')
							$('.verifyMailBox .login_emailcode .chongxinfasong').addClass('cf')
							$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'pointer')
							$('.chongxinfasong').unbind("click").on('click', function () {
								if ($(this).hasClass("cf")) {
									// $('.goback').text('返回上一步')
									// $('.verifyMailBox').hide();
									// $('.verifyAgain').show();
									// $('.verifyAgain .button').addClass('againEmailVerificationCode').removeClass('goback')
									thisid = 'codemobilees'
										
									jihuozh=username
									getPicture()
								}
							});
							$('.verifyMailBox .verifyMail .chongxinfasong').text('重新发送验证邮件')
						} else if (errNum === '-21053') {
							$('.verifyMailBox .conw .tishi_error').text('邮件验证码已超时').css('visibility', 'visible')
							$('.verifyMailBox .login_emailcode .chongxinfasong').addClass('cf')
							$('.verifyMailBox .login_emailcode .chongxinfasong').css('cursor', 'pointer')
							$('.chongxinfasong').unbind("click").on('click', function () {
								if ($(this).hasClass("cf")) {
									// $('.goback').text('返回上一步')
									// $('.verifyMailBox').hide();
									// $('.verifyAgain').show();
									// $('.verifyAgain .button').addClass('againEmailVerificationCode').removeClass('goback')
									thisid = 'codemobilees'
			
									jihuozh=username
									getPicture()
								}
							});
							$('.verifyMailBox .verifyMail .chongxinfasong').text('重新发送验证邮件')
						} else if (errNum === '-21054') {
							$('.verifyMailBox .conw .tishi_error').text('邮件验证码错误').css('visibility', 'visible')
						} else if (errNum === '-21047') {
							$('.verifyMailBox .conw .tishi_error').text('24h同一用户请求邮件验证码超10次').css('visibility', 'visible')
						} else if (data.code === '-99999' || data.code === '-88888') {
							$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
							$(".systemErrorBox").show()
						} else {
							$('.verifyMailBox .conw .tishi_error').text(data.message).css('visibility', 'visible')
						}
					} else {
						$('.verifyMailBox').hide()
						Idiptemyz.val('').hide()
						Idpemyz.show()
						thisid = 'codemobilebd'

						$('.bindPhoneBox').find('.login_msg .tishi_msg').hide()
						$('.bindPhoneBox').show()
						var rstemailmsgSwitch = true
						var rstgetemailmsgBtn = $('.bindPhoneBox .login_msg .daojishi')
						rstgetemailmsgBtn.on('click', function () {
							if (bindIphoneipt.val().replace(/\s+/g, '') === '') {
								$(".bindPhoneBox .login_iphone .tishi_error").html('请输入手机号').show()
								return false;
							}
							if (!checkMobile(bindIphoneipt.val().replace(/\s+/g, ''))) {
								$(".bindPhoneBox .login_iphone .tishi_error").html('手机号格式错误').show()
								return false;
							}
							if (($('.bindPhoneBox .conw .login_msg em.daojishi').text() === '获取验证码' || $('.bindPhoneBox .conw .login_msg em.daojishi').text() === '重新获取')) {
								getPicture()
							} else {
								bindmsgipt.parents('.login_msg').find('.tishi_msg').show()
							}
						});
						hideemaillogin(username, passwordtwo)
						bindIphoneNumFn()
					}
				}
			});
		}
	});
}

// 暗中登陆一哈子
function hideemaillogin(username, passwordtwo) {
	encryptdata = 'account=' + username.toLowerCase() + '&appid=dgtgyfxwn9gcr7ow&captcha_type=3&nonce=' + nonce.toLowerCase() + '&password=' + passwordtwo.toLowerCase() + '&rem_login=1&ts=' + timestamp;
	var url = '//reg.cctv.cn/openapi/v2/user/login?timestamp=' + timestamp;
	$.ajax({
		type: "post",
		url: url,
		data: {
			"account": encryptras(username, nonce),
			"appid": encryptras("dgtGyfXwN9Gcr7ow", nonce),
			"captcha_type": encryptras("3", nonce),
			"nonce": encryptd.encrypt(nonce),
			"password": encryptras(passwordtwo, nonce),
			"rem_login": encryptras("1", nonce),
			"ts": encryptras(timestamp, nonce),
			"encryptdata": sha512(encryptdata)
		},
		dataType: "json",
		success: function (data) {
			// console.log(data)
			var errNum = data.code
			if (errNum !== '0') {
				$('.bindPhoneBox').hide()
				rstemailClear()
				$('.codeLoginBtn').show()
				gologinpageFn('emailrst')
			} else {
				setCookiedl('CurrentPage','1')
				var ssoArray = data.data.sso;
				for (var i = 0; i < ssoArray.length; i++) {
					if (i == ssoArray.length - 1) {
						var bc = "msisdnedcopy";
					} else {
						var bc = "msisdn" + i;
					}
					$.ajax({
						url: ssoArray[i],
						type: 'post',
						dataType: 'jsonp',
						jsonp: 'callback',
						jsonpCallback: bc,
						cache: true,
						success: function (data) { }
					})
				}
				// bindIphoneNumFn()
				// for (var i = 0; i < ssoArray.length; i++) {
				// 	$.ajax({
				// 		url: ssoArray[i],
				// 		type: 'post',
				// 		dataType: 'jsonp',
				// 		jsonp: 'callback',
				// 		jsonpCallback: bc,
				// 		cache: true,
				// 		success: function (data) { }
				// 	})
				// }
			}
		}
	});
}

// 绑定手机
function bindIphoneNumFn() {
	var bindmobile
	var bindmsgcode

	$('.bindPhoneBox .login_btn').click(function (e) {
		e.preventDefault();
		if (bindIphoneipt.val().replace(/\s+/g, '') === '') {
			$(".bindPhoneBox .login_iphone .tishi_error").html('手机号不能为空').show()
		}  else if (bindmsgipt.val().replace(/\s+/g, '') === '') {
			$(".bindPhoneBox .login_msg .tishi_msg").hide()
			$(".bindPhoneBox .login_msg .tishi_error").html('短信验证码不能为空').show()
		} else {

		}

		var bindmobileType = $('.bindPhoneBox .login_iphone .tishi_error').is(':hidden')
		var bindmsgcodeType = $('.bindPhoneBox .login_msg .tishi_error').is(':hidden')
		if (bindmobileType && bindmsgcodeType) {
			bindmobile = bindIphoneipt.val().replace(/\s+/g, '')
			bindmsgcode = bindmsgipt.val().replace(/\s+/g, '')
			var verifycode = getCookiedl('verifycode')
			postMobileBinding(verifycode)
		}

	});


	function postMobileBinding(usertoken) {
		// encryptdata = '&appid=dgtgyfxwn9gcr7ow&mobile=' + bindmobile.toLowerCase() + '&nonce=' + nonce.toLowerCase() + '&sms_code=' + bindmsgcode.toLowerCase()
		var url = '//reg.cctv.cn/openapi/v2/user/verification/mobile/binding'
		$.ajax({
			type: "post",
			url: url,
			data: {
				"timestamp": timestamp,
				"appid": "dgtGyfXwN9Gcr7ow",
				"mobile": bindmobile,
				"sms_code": bindmsgcode
			},
			headers: {
				"verifycode": usertoken,
			},
			dataType: "json",
			success: function (data) {
				// console.log(data)
				var errNum = data.code;
				if (errNum !== '0') {
					if (errNum === '-21021') {
						$(".bindPhoneBox .login_iphone .tishi_error").html('该手机号已有绑定账号,无法绑定').show()
					}else  if (errNum === '-21063') {
					
					}else if (errNum === '-21012') {
						$(".bindPhoneBox .login_msg .tishi_msg").hide()
						$(".bindPhoneBox .login_msg .tishi_error").html('短信验证码错误').show()
					} else if (errNum === '-21011') {
						$(".bindPhoneBox .login_msg .tishi_msg").hide()
						$(".bindPhoneBox .login_msg .tishi_error").html('短信验证码已超时').show()
					} else if (data.code === '-99999' || data.code === '-88888') {
						$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
						$(".systemErrorBox").show()
					} else {
						// $(".bindPhoneBox .login_msg .tishi_msg").hide()
						// $(".bindPhoneBox .login_msg .tishi_error").html(data.message).show()
					}
				} else {
					// var verifycode = getCookiedl("verifycode")
					// hideemaillogout(verifycode)
					$('.loginMain .bindPhoneBox').hide()
					$('.loginMain .loginSuccessBox').find(".conw .txt01").text('绑定成功')
					$('.loginMain .loginSuccessBox').show()
					rstemailClear()
					bindIphoneClearForm()
					var timer = setInterval(function () {
						$('.loginMain .loginSuccessBox').find(".conw .txt01").text('登录成功')
						clearInterval(timer)
					}, 2000)
					var floattimer = setInterval(function () {
						$('.loginFloat').hide()
						$('.loginMain .loginSuccessBox').hide()
						$('.codeLoginBtn').show()
						gologinpageFn('iphonerst')
						clearInterval(floattimer)
					}, 4000)
				}
			}
		});
	}
}

/*-------------------- 二维码登录 -----------------------*/
// 展示二维码浮层
var QRcodeSwitch = true
var QRcodeBtn = $('.codeLoginBtn')
var QRcodeText
var QRcodeTimer

QRcodeBtn.unbind().on('click', function () {
	// clearInterval(emtimer)
	// $('.tishi_error').hide()
	if (QRcodeSwitch) {
		// console.log(thisid)
		$(".loginMain").find(".Maincont").show().siblings().hide()
		QRcodeBtn.addClass('cur').show()
		$(".QRcodeBox .img").html('')
		getQRcode()
		$('.loginMain .loginBox').hide()
		$('.loginMain .codeLoginBox').show()
		QRcodeTimer = setInterval(function () {
			getQRcodeStatus(QRcodeText)
		}, 3000)
		// $('.loginDuanxin .tishi_error').show()
		QRcodeSwitch = false
	} else {
		if ($(".loginMain").find("div[show-id=" + thisid + "]").length > 0) {
			$(".loginMain").find("div[show-id=" + thisid + "]").addClass('cur').siblings().removeClass('cur')
			if (thisid === 'codemobilef' || thisid === 'codemobiles') {
				$(".loginMain").find("div[show-id=" + thisid + "]").parents('.loginBox').show()
				if(Idipt1.val().replace(/\s+/g, '') !== '') iphoneloginClearTab()
				if(Idipt.val().replace(/\s+/g, '') === '') Idp.show()
				// idloginClear()
			}
			if (thisid === 'codemobilei' || thisid === 'codemobilet') {
				$(".loginMain").find("div[show-id=" + thisid + "]").parents('.registerBox').show()
				// rstiphoneClear()
				// rstemailClear()
			}
		}
		getCookieUserInfo()
		QRcodeBtn.removeClass('cur').show()
		$('.loginMain .codeLoginBox').hide()
		// $('.loginMain .loginBox').show()
		clearInterval(QRcodeTimer)
		QRcodeSwitch = true
	}
});

// 渲染二维码
function generateQRCode(rendermethod, picwidth, picheight, url) {
	$(".QRcodeBox .img").qrcode({
		render: rendermethod, // 渲染方式有 table 方式（IE兼容）和 canvas 方式
		width: picwidth, //宽度 
		height: picheight, //高度 
		text: url, //内容 
		typeNumber: -1,//计算模式
		correctLevel: 2,//二维码纠错级别
		background: "#ffffff",//背景颜色
		foreground: "#000000"  //二维码颜色
	});
}

// 获取二维码
function getQRcode() {
	var url = '//reg.cctv.cn/openapi/v2/user/QRCode/login/generationQRCode'
	$.ajax({
		type: "get",
		url: url,
		data: {
			"timestamp": timestamp,
			"appid": "dgtGyfXwN9Gcr7ow",
		},
		dataType: "json",
		success: function (data) {
			// console.log(data)
			QRcodeText = data.data
			var QRcodeTexturl = "PCBOXLOGIN:" + data.data
			generateQRCode('canvas', 184, 184, QRcodeTexturl)
		}
	});
}

// 查询二维码状态
function getQRcodeStatus(QRcode) {
	var url = '//reg.cctv.cn/openapi/v2/user/QRCode/login/getQrcodeStatus'
	$.ajax({
		type: "get",
		url: url,
		data: {
			"timestamp": timestamp,
			"appid": "dgtGyfXwN9Gcr7ow",
			"qrcode": QRcode
		},
		dataType: "json",
		success: function (data) {
			// console.log(data)
			if (data.code !== '0') {
				if (data.code === '-99999' || data.code === '-88888') {
					$(".systemErrorBox .systemtxt").html('系统维护中，请稍后再试');
					$(".systemErrorBox").show()
				} else if (data.code === '-10009') {
					$(".systemErrorBox .systemtxt").html('数据查询失败请稍后重试');
					$(".systemErrorBox").show()
				} else {
				}
			} else {
				if (data.data.status === -2) {
					$('.QRcodeBox .shadow').show()
					clearInterval(QRcodeTimer)
					$('.QRcodeBox .shadow').find('.sx_btn').unbind('click').on('click', function () {
						$(".QRcodeBox .img").html('')
						getQRcode()
						QRcodeTimer = setInterval(function () {
							getQRcodeStatus(QRcodeText)
						}, 3000)
						$('.QRcodeBox .shadow').hide()
					});
				}
				if (data.data.status === 0) {
					setCookiedl('CurrentPage','1')
					$('.codeLoginBox').hide()
					$('.codeLoginBtn').removeClass('cur')
					$('.Maincont').hide()
					var ssoArray = data.data.sso;
					for (var i = 0; i < ssoArray.length; i++) {
						if (i == ssoArray.length - 1) {
							var bc = "msisdned";
						} else {
							var bc = "msisdn" + i;
						}
						$.ajax({
							url: ssoArray[i],
							type: 'post',
							dataType: 'jsonp',
							jsonp: 'callback',
							jsonpCallback: bc,
							cache: true,
							success: function (data) { }
						})
					}
					clearInterval(QRcodeTimer)
					gologinpageFn('iphonerst')
				}
			}
		}
	});
}

// 关闭按钮 点击关闭按钮清空表单跳回登录页面
$('.loginMain .close_btn').on('click', function () {
	statem = true
	$('.tishi_error').hide()
	clearInterval(load)
	imgswitch = true
	QRcodeSwitch = true
	var closeBtnInfoAttr = $(this).attr('data-closeBtnInfo') // login 登录 register 注册
	if (closeBtnInfoAttr === 'login') { // 如果是登录页 判断是 短信登录 还是 账号登录
		var iphoneOremail
		var iphoneOremaillist = $(this).nextAll('.loginBox').find('.login_title span')
		$.each(iphoneOremaillist, function (i, v) {
			if ($(this).hasClass('cur')) {
				iphoneOremail = $(this).index()
			}
		});
		if (iphoneOremail === 0) {// 手机登录表单
			// clearInterval(emtimer)
			iphoneloginClear()
			idloginClear()
			rstiphoneClear()
			rstemailClear()
			$('#loginFloat').hide()
			gologinpageFn('iphonerst')
			
			$('.loginDuanxin .login_msg .daojishi').css('color','#bf0614')
		} else {
			iphoneloginClear()
			idloginClear()
			rstiphoneClear()
			rstemailClear()
			$('#loginFloat').hide()
			gologinpageFn('iphonerst')
			
		}
		if ($('.codeLoginBox').is(':hidden')) {
			clearInterval(QRcodeTimer)
			$('.codeLoginBtn').removeClass('cur');
			$('.codeLoginBox').hide()
			$('.loginBox').show()
			$('#loginFloat').hide()
		}
	}
	if (closeBtnInfoAttr === 'register') {
		var rstiphoneOremail
		var rstiphoneOremaillist = $(this).nextAll('.conw').find('.login_title span')
		$.each(rstiphoneOremaillist, function (i, v) {
			if ($(this).hasClass('cur')) {
				rstiphoneOremail = $(this).index()
			}
		});
		if (rstiphoneOremail === 0) {
			clearInterval(msgTimer)
			iphoneloginClear()
			idloginClear()
			rstiphoneClear()
			rstemailClear()
			$('.codeLoginBtn').show();
			$('.registerBox').hide();
			$('#loginFloat').hide()
			gologinpageFn('iphonerst')
			
		} else {
			iphoneloginClear()
			idloginClear()
			rstiphoneClear()
			rstemailClear()
			$('.codeLoginBtn').show();
			$('.registerBox').hide();
			$('#loginFloat').hide()
			gologinpageFn('iphonerst')
			
		}
		$('.Maincont .loginBox').show()
	}
	if (closeBtnInfoAttr === 'bindiphone') {
		commentLogout()
		bindIphoneClearForm()
		$('.codeLoginBtn').show()
		$('.bindPhoneBox').hide()
		$('.Maincont .loginBox').show()
		$('#loginFloat').hide()
		gologinpageFn('iphonerst')
		
	}
	if (closeBtnInfoAttr === 'emailverifyBox') {
		$(".verifyMailBox #verifyemailcord").val('').hide()
		$(".verifyMailBox .login_emailcode .con p").show()
		$('.verifyMailBox .tishi_error').hide()
		$('.verifyMailBox').hide()
		$('.codeLoginBtn').show()
		$('#loginFloat').hide()
		gologinpageFn('iphonerst')
		
	}
	if (closeBtnInfoAttr === 'emailverifyAgain') {
		$('.verifyAgain #emailimgcord').val('').hide()
		// $('.verifyAgain .goback').text('')
		$('.verifyAgain .login_cord p').show()
		$('.verifyAgain .tishi_error').css('visibility', 'hidden')
		$('.verifyAgain').hide()
		$('.codeLoginBtn').show()
		$('#loginFloat').hide()
		gologinpageFn('iphonerst')
		
	}
	if (closeBtnInfoAttr === 'passwordRisky') {
		$('.loginMain .passwordRisk').hide()
		idloginClear()
		$('.codeLoginBtn').show()
		$('#loginFloat').hide()
		gologinpageFn('iphonerst')
		
		if($('.CurrentPageBox').length > 0) {
			window.location.reload()
		}
	}
});


$(window).bind('beforeunload',function(){
	if (CurrentPageType === null&& location.host!="user.cctv.com") {
		
		RealNameLoginout()
	}
	function RealNameLoginout() {
		if (verifycode === null) {
			return;
		} else {
			$.ajax({
				type: "post",
				url: "//reg.cctv.cn/openapi/v2/user/isAuth",
				dataType: "json",
				data: {
					"timestamp": timestamp,      //当前时间戳
					"appid": "dgtGyfXwN9Gcr7ow"  //管理员分配给业务线应用的唯一标识
				},
				xhrFields: {
					withCredentials: true
				},
				crossDomain: true,            //添加跨域参数是为了将登录标识（token）带过去验证
				success: function (data) {
					// console.log('RealNameLoginout','20230324rrrr')
					// console.log(data)
					if (data.data === '0') {
						if (judgeisMobile()) {
	
						} else {
							commentLogout()
						}
	
					} else {
						return;
					}
				}
			});
		}
	}
})


function commentLogout() {
	var url = '//reg.cctv.cn//openapi/v2/user/logout'
	$.ajax({
		type: "get",
		url: url,
		dataType: "json",
		data: {
			"timestamp": timestamp,        //当前时间戳
			"appid": "dgtGyfXwN9Gcr7ow"    //管理员分配给业务线应用的唯一标识
		},
		xhrFields: {
			withCredentials: true
		},
		crossDomain: true,              //添加跨域参数是为了将登录标识（token）带过去验证
		success: function (msg) {
			// console.log('commentLogout','ccccc')
			var ssoArray = msg.data
			sessionStorage.removeItem('CurrentPage')
			for (var i = 0; i < ssoArray.length; i++) {
				if (i == ssoArray.length - 1) {
					var bc = "msisdnedloginout";
				} else {
					var bc = "msisdn" + i;
				}
				$.ajax({
					url: ssoArray[i],
					type: 'post',
					dataType: 'jsonp',
					jsonp: 'callback',
					jsonpCallback: bc,
					cache: true,
					success: function (data) { }
				})
			}
		}
	})
}


// 
var imgSlideRefreshTimer
var startTime = 0, isMouseDown, endTime = 0, totalTime = 0;
var verifybox, imgPannel, p_img, subBlock, b_img, picture_token, secret_key;
var xiugaiqu03dl = document.getElementsByClassName("xiugaiqu03dl")[0];
verifybox = xiugaiqu03dl.getElementsByClassName("verifybox")[0];
imgPannel = verifybox.getElementsByClassName("verify-img-panel")[0];
p_img = imgPannel.getElementsByTagName("img")[0];
subBlock = verifybox.getElementsByClassName("verify-sub-block")[0];
b_img = subBlock.getElementsByTagName("img")[0];

var barArea, changedRect, moveBlock, originX, originY, startLeft, moveBlockLeft, startTime = 0, endTime = 0, costTime, isMouseDown = false, refreshBtn, moveBlockIcon;
barArea = verifybox.getElementsByClassName("verify-bar-area")[0];
changedRect = verifybox.getElementsByClassName("verify-left-bar")[0];
moveBlock = document.getElementById("box1");
refreshBtn = verifybox.getElementsByClassName("verify-refresh")[0];
moveBlockIcon = moveBlock.getElementsByClassName("iconfont")[0];
duanedRect = verifybox.getElementsByClassName("verify-move-block")[0];

function yanzhengguanbi() {
	clearInterval(imgSlideRefreshTimer)
	$('.xiugaiqu03 .mask').hide()
	document.body.style.height = 'auto';
	document.body.style.overflow = 'visible';
	document.documentElement.style.height = 'auto';
	document.documentElement.style.overflow = 'visible';
	moveBlock.style.left = 0;
	changedRect.style.width = moveBlock.style.width;
	moveBlock.style.backgroundColor = "rgb(255,154,0)"
	changedRect.style.borderColor = "#ddd"
	moveBlockIcon.classList.remove("icon-close-a")
	moveBlockIcon.classList.remove("icon-check")
	moveBlockIcon.classList.add("icon-right")
	$('.verifybox .verifybox-bottom .verify-img-panel .tishii').hide()
	$('.verify-msg').show()
}
// 初始化时获取图片等信息
function getPicture(status) {
	var timestamp = Date.parse(new Date()) / 1000;
	$.ajax({
		url: "https://reg.cctv.cn/openapi/v2/user/captcha/dynamic/puzzle?timestamp=" + timestamp,
		type: "get",
		data: {
			appid: 'dgtGyfXwN9Gcr7ow'
		},
		crossDomain: true,
		success: function (re) {
			
			if (re.code === '0') {
				p_img.setAttribute("src", "data:image/png;base64," + re.data.origin_image_data);
				b_img.setAttribute("src", "data:image/png;base64," + re.data.block_image_data)
				picture_token = re.data.token
				secret_key = re.data.secret_key;
				subBlock.style.width = parseInt((imgPannel.style.width || "").replace("px", "")) * 47 / 310 + 'px';
				if(!status){
					$('.xiugaiqu03 .mask').show();
					document.body.style.height = '100%';
					document.body.style.overflow = 'hidden';
					document.documentElement.style.height = '100%';
					document.documentElement.style.overflow = 'hidden';
				}else{
					moveBlock.style.left = 0;
					changedRect.style.width = moveBlock.style.width;
					moveBlock.style.backgroundColor = "rgb(255,154,0)"
					changedRect.style.borderColor = "#ddd"
					moveBlockIcon.classList.remove("icon-close-a")
					moveBlockIcon.classList.remove("icon-check")
					moveBlockIcon.classList.add("icon-right")
					$('.verifybox .verifybox-bottom .verify-img-panel .tishii').hide()
					$('.verify-msg').show()
				}
				
				clearInterval(load)
				load = setInterval(function () {
					loadNewCodeMobile(thisid);
				}, 180000)
			} else {
				console.log('手机注册图片初始化Error')
				console.log(re)
			}
		}
	})
}


// 加密 encryptras
function encryptraso(messages, nonce) {
	var keyhex = CryptoJS.enc.Utf8.parse(nonce);
	var messagehex = CryptoJS.enc.Utf8.parse(messages);
	var encrypted = CryptoJS.AES.encrypt(messagehex, keyhex, {
		iv: keyhex,
		mode: CryptoJS.mode.ECB,
		padding: CryptoJS.pad.Pkcs7
	})
	return encrypted.toString();
}

function pauseEvent(e) {
	if (e.stopPropagation) e.stopPropagation();
	if (e.preventDefault) e.preventDefault();
	e.cancelBubble = true;
	e.returnValue = false;
	return false;
}

moveBlock.addEventListener('mousedown', function (e) {
	e = e || window.event;
	pauseEvent(e);
	isMouseDown = true;
	moveBlock.style.backgroundColor = "rgb(255,154,0)"
	changedRect.style.borderColor = "#ffcead"
	changedRect.style.backgroundColor = "rgb(255,206,173)"
	//设置moveBlock捕获所有鼠标按下的事件
	// moveBlock.setCapture && moveBlock.setCapture();
	// event = event || window.event;
	//记录鼠标按下时的初始位置
	originX = e.clientX;
	originY = e.clientY;
	// startLeft = event.clientX - barArea.getBoundingClientRect().left
	startTime = new Date().getTime();
})

document.addEventListener('mousemove', function (e) {
	if (!isMouseDown) return false;
	e = e || window.event;
	//移动后的鼠标坐标
	
	$('.verify-msg').css({ 'display': 'none' })
	moveBlock.style.left = e.clientX - originX + "px";

	moveBlockLeft = e.clientX - originX;
	changedRect.style.width = moveBlockLeft + parseFloat(moveBlock.style.width) + 'px';
	if (moveBlockLeft <= 0) {
		moveBlock.style.left = 0;
		changedRect.style.width = moveBlock.style.width;
	}
	if (moveBlockLeft >= 380) {
		moveBlock.style.left = '380px';
		changedRect.style.width = '434px';
	}

})

document.addEventListener('mouseup', function (e) {
	if (!isMouseDown) return false
	isMouseDown = false;
	if (e.x == originX) return false
	_checkVerify();
	// document.onmousemove = null;
	// document.onmouseup = null;
	//取消掉的话，有时松掉鼠标，方块还是会跟着跑动?要把onmouseup时间嵌套在onmousedown时间里面，构成一个完整的事件链，即鼠标点击-移动-松开
	//当鼠标松开时，取消对事件的捕获
	// moveBlock.releaseCapture && moveBlock.releaseCapture();
})

moveBlock.addEventListener('touchstart', function (e) {
	e = e || window.event;
	pauseEvent(e);
	isMouseDown = true;
	moveBlock.style.backgroundColor = "rgb(255,154,0)"
	changedRect.style.borderColor = "#ffcead"
	changedRect.style.backgroundColor = "rgb(255,206,173)"
	//设置moveBlock捕获所有鼠标按下的事件
	// moveBlock.setCapture && moveBlock.setCapture();
	// event = event || window.event;
	//记录鼠标按下时的初始位置
	originX = e.touches[0].clientX;
	originY =  e.touches[0].clientY;
	// startLeft = event.clientX - barArea.getBoundingClientRect().left
	startTime = new Date().getTime();
})

document.addEventListener('touchmove', function (e) {
	if (!isMouseDown) return false;
	e = e || window.event;
	//移动后的鼠标坐标
	
	$('.verify-msg').css({ 'display': 'none' })
	moveBlock.style.left = e.touches[0].clientX - originX + "px";

	moveBlockLeft = e.touches[0].clientX - originX;
	changedRect.style.width = moveBlockLeft + parseFloat(moveBlock.style.width) + 'px';
	if (moveBlockLeft <= 0) {
		moveBlock.style.left = 0;
		changedRect.style.width = moveBlock.style.width;
	}
	if (moveBlockLeft >= 380) {
		moveBlock.style.left = '380px';
		changedRect.style.width = '434px';
	}

})

document.addEventListener('touchend', function (e) {
	if (!isMouseDown) return false
	isMouseDown = false;
	if (e.x == originX) return false
	_checkVerify();
	// document.onmousemove = null;
	// document.onmouseup = null;
	//取消掉的话，有时松掉鼠标，方块还是会跟着跑动?要把onmouseup时间嵌套在onmousedown时间里面，构成一个完整的事件链，即鼠标点击-移动-松开
	//当鼠标松开时，取消对事件的捕获
	// moveBlock.releaseCapture && moveBlock.releaseCapture();
})
refreshBtn.addEventListener('click', function (e) {
	_resetVerify();
})

// 重新获取图片并重置验证码样式
function _resetVerify() {
	
	getPicture("no");
	
}

// 验证滑动是否通过
function _checkVerify() {
	var a = moveBlockLeft;
	var timestamp = Date.parse(new Date()) / 1000;
	// var a = parseInt((moveBlockLeft || "").replace("px", ""));
	a = 310 * a / parseInt((imgPannel.style.width || "").replace("px", ""));
	$.ajax({
		url: "https://reg.cctv.cn/openapi/v2/user/captcha/dynamic/puzzle/check?timestamp=" + timestamp,
		type: "post",
		data: {
			aes_point: encryptraso(JSON.stringify({
				x: a,
				y: 5
			}), secret_key),
			token: picture_token,
			appid: 'dgtGyfXwN9Gcr7ow'
		},
		dataType: "json",
		crossDomain: true,
		success: function (re) {
		
			if (re.code === '0') {
				successCheckVerifyCss();
				setTimeout(function(){
					document.body.style.height = 'auto';
					document.body.style.overflow = 'visible';
					document.documentElement.style.height = 'auto';
					document.documentElement.style.overflow = 'visible';
					$('.xiugaiqu03 .mask').hide()
				},1000)
				if(thisid=="codemobilef"){
					console.log(re)
					requestVerficode(re.data.captcha_checked_code)
				}else if(thisid=="codemobiles"){
					loginzhanghao(re.data.captcha_checked_code)
				}else if(thisid=="codemobilees"){

					againEmailVerificationCodeReturn(re.data.captcha_checked_code)
					
				}else if(thisid=="codemobilet"){
					emailrstfun(re.data.captcha_checked_code)
				}else if(thisid=="codemobilei"){
					gitiphonemessageCode(Idipt5, re.data.captcha_checked_code, Idipt7, '1', rstipmsgSwitch, 'codemobilei');
				}else if(thisid=="codemobilebd"){
					gitiphonemessageCode(bindIphoneipt, re.data.captcha_checked_code, bindmsgipt, '3', true, 'codemobilebd');
				}
				
			} else {
				console.log('滑动验证Error')
				console.log(re)
				// 验证失败 处理
				$('.verifybox .verifybox-bottom .verify-img-panel .tishii').text("验证错误，请重试").show();
				errorCheckVerifyCss()

			}
		}
	})
}
// 成功样式
function successCheckVerifyCss() {
	endTime = Date.now();
	totalTime = endTime - startTime
	totalTime = String(totalTime)
	totalTime = totalTime.substring(0, totalTime.length - 1)
	if (totalTime.length > 2) {
		totalTime = totalTime.substring(0, totalTime.length - 2) + '.' + totalTime.substring(totalTime.length - 2, totalTime.length)
	} else {
		totalTime = '0.' + totalTime
	}
	$('.verifybox .verifybox-bottom .verify-img-panel .tishii').text(totalTime + "s验证成功").show();
	$('.verifybox .verifybox-bottom .verify-img-panel .tishii').css({ 'background-color': 'rgb(5, 146, 68, 0.5)' })
	$('.verifybox .verifybox-bottom .verify-img-panel .tishii').css({ 'display': 'block' })
	moveBlockIcon.classList.remove("icon-right")
	moveBlockIcon.classList.add("icon-check")
	moveBlock.style.backgroundColor = "#33cc66"
	changedRect.style.borderColor = "#33cc66"
	changedRect.style.backgroundColor = "rgb(175,225,179)"
	duanedRect.style.backgroundColor = "#099a4a";
	
	setTimeout(() => {
		moveBlock.style.left = 0;
		changedRect.style.width = moveBlock.style.width;
		moveBlock.style.backgroundColor = "rgb(255,154,0)"
		changedRect.style.borderColor = "#ddd"
		moveBlockIcon.classList.remove("icon-close")
		moveBlockIcon.classList.remove("icon-check")
		moveBlockIcon.classList.add("icon-right")

		$('.verifybox .verifybox-bottom .verify-img-panel .tishii').hide()
		$('.verify-msg').show()
		}, 2000);
}
// 失败样式
function errorCheckVerifyCss() {
	$('.verifybox .verifybox-bottom .verify-img-panel .tishii').css({ 'background-color': 'rgb(153, 2, 2, 0.5)' })
	moveBlockIcon.classList.remove("icon-right")
	moveBlockIcon.classList.add("icon-close-a")
	moveBlock.style.backgroundColor = "rgb(217,83,79)"
	changedRect.style.borderColor = "#fec1c1"
	changedRect.style.backgroundColor = "rgb(254,193,193)"
	duanedRect.style.backgroundColor = "#bf0614"
	setTimeout(_resetVerify, 1e3)
}

</script>

</body>
</html>
