<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>maps.html</title>
</head>
<body>
<script>var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(d){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+b++,d)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var f=d++;return{value:b(f,a[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,b,d,e){if(b){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in d||(d[f]={});d=d[f]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var g=a[f];if(b.call(d,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
function ResumenAvisos(){this.state={};this.create=function(a,b,d,e,f,g){this.service=d;this.id=a;this.lang=f;this.locale=g;this.fechaDesde=e;return this};this.setState=function(a){var b=this,d=!1;["location","zoom","ambito","fecha","dia"].forEach(function(e){var f=a[e];"fecha"==e&&(f=f.substring(0,10));"zoom"==e||d||b.state[e]==f||(d=!0);e in a&&(b.state[e]=f)});d&&this._loadData()};this._loadData=function(){var a=this;this.service.getAvisosHoras(this.state).then(function(b){$(a.id).empty();var d=
a._getSelectorFechas(b[0]);b=a._filterData(b[0],d);$(a.id).append(a._render(b,d));a._bindEvents(b)}).fail(function(a){console.log("Error al obtener "+a)})};this._render=function(a,b){if("no-data"==b.dia)return"<div class='no-data'>{{mensaje}}</div>".replace("{{mensaje}}","No hay datos disponibles");var d=b.dia,e=b.rangoFechas,f=b.hoursTz;b=b.fechaInicial;var g=this,h="<div>",l=!1,m=Object.keys(a.areas);m.sort();m.forEach(function(b){4<=parseInt(a.areas[b][d].nivelMax)||(l=!0,h+='<div class="rs-dia-zona" data-zona-id="{{key}}"><div class="rs-zona"><a target="_new" class="anchor-rss" href="/documentos_d/eltiempo/prediccion/avisos/rss/CAP_AFAC{{zona}}_RSS.xml"><img src="/imagenes/png/iconos/rss.png" title="RSS"></a><a target="_new" class="anchor-rss" href="/documentos_d/eltiempo/prediccion/avisos/rss/CAP_AFAC{{zona}}_ATOM.xml"><img src="/imagenes/png/iconos/atom.png" title="Atom"></a><a style="color:blue" href="/es/eltiempo/prediccion/avisos?l={{key}}&r=1"><div class="rs-nombre-zona">{{key_nombre}}</div></a></div>'.replace(/\{\{key\}\}/g,
b).replace("{{key_nombre}}",b).replace(/\{\{zona\}\}/g,b.substring(0,2)),h+='<div class="rs-resumen">',"fenomenos"in a.areas[b][d]&&a.areas[b][d].fenomenos.forEach(function(a){h+='<div class="rs-el-resumen rs-nivel-{{nivel}} rs-tipo-{{tipo}}" title="{{desc_tipo}}"></div>'.replace("{{nivel}}",a.nivel).replace("{{tipo}}",a.id).replace("{{desc_tipo}}",g.lang["avisos.boletin."+a.id])}),h+="</div>",h+='<div class="rs-horas">',e.forEach(function(a){h+='<div class="rs-hora {{clase_vencida}}" data-rs-fecha="{{fecha}}"></div>'.replace("{{fecha}}",
a.fecha.toISOString().split(".")[0]).replace("{{clase_vencida}}",a.vencida?"rs-vencida":"")}),h+="</div>",h+="</div>")});l||(h+='<div class="rs-msg-noavisos rs-zona"> {{mensaje}} </div><div class="rs-resumen"></div>'.replace("{{mensaje}}",g.lang["avisos.literal.noinfo"]),h+='<div class="rs-horas">',e.forEach(function(a){h+='<div class="rs-hora {{clase_vencida}}" data-rs-fecha="{{fecha}}"></div>'.replace("{{fecha}}",a.fecha.toISOString().split(".")[0]).replace("{{clase_vencida}}",a.vencida?"rs-vencida":
"")}),h+="</div></div>");h+='<div class="rs-dia-zona rs-dia-semana"><div class="rs-zona">{{fecha}}</div>'.replace("{{fecha}}",e[0].fecha.toLocaleDateString(g.locale,{weekday:"long",day:"numeric"}));h+='<div class="rs-resumen"></div>';h+='<div class="rs-horas">';var n=b.getTimezoneOffset();e.forEach(function(a){var b=(n-a.fecha.getTimezoneOffset())/60;h+='<div class="rs-hora rs-titulo-vertical">{{hora}}</div>'.replace("{{hora}}",("0"+(b+eval(a.fecha.getUTCHours()+f))%24).slice(-2))});h+="</div></div>";
return h+="</div>"};this._getSelectorFechas=function(a){var b=this.fechaDesde[this.state.ambito].substring(19),d=new Date,e=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours()+parseInt(b.substring(0,2)),0,0,0)),f=new Date(this.state.fecha+"T00:00:00"+b);d=new Date(a.f_hoy.substring(0,10)+"T00:00:00"+b);for(var g=new Date(a.f_hoy.substring(0,10)+"T00:00:00"+b),h=new Date(a.f_mna+b),l=0;h<=f&&3>l;)g.setDate(g.getDate()+1),h.setDate(h.getDate()+1),l++;a=[];for(f=g>f?f:
g;f<h;)a.push({fecha:new Date(f),vencida:f<e}),f.setHours(f.getHours()+1);switch(l){case 0:e="hoy";break;case 1:e="mna";break;case 2:e="pmna";break;default:e="no-data"}return{dia:e,rangoFechas:a,hoursTz:b.substring(0,3),fechaInicial:d}};this._bindEvents=function(a){var b=this.id;Object.keys(a.areas).forEach(function(d){$(b).find("[data-zona-id={{key}}]".replace("{{key}}",d)).each(function(b,e){a.areas[d].horas.forEach(function(a){var b=a.validez_ini_utc.replace(/[:]/g,"\\$&");b="[data-rs-fecha={{fecha}}]:not(.rs-vencida)".replace("{{fecha}}",
b);a=a.nivelMax;$(e).find(b).addClass("rs-nivel-"+a)})})});if(0<$(b).length){$(".rs-zona-responsive").remove();var d=$("#resumen-avisos .rs-dia-semana").find(".rs-zona").clone();$(b).before(d);$copyDiaSemanaResponsive=d.addClass("rs-zona-responsive");$(b).find(".rs-dia-zona").each(function(){if(!$(this).hasClass("rs-dia-semana")){var a=$(b).find(".rs-dia-semana").find(".rs-horas").clone().addClass("rs-dia-semana-responsive");$(this).after(a)}})}var e=Object.keys(a.areas);0!=e.length&&this.service.getNombreZonas(e).then(function(a){e.forEach(function(d){$(b).find("[data-zona-id={{key}}] div.rs-nombre-zona".replace("{{key}}",
d)).html(a[0][d].name)})})};this._filterData=function(a,b){if("hoy"!=b.dia)return a;b=this.fechaDesde[this.state.ambito];var d=b.substring(19),e=new Date,f=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours()+parseInt(d.substring(0,2)),0,0,0));d=b.substring(19);var g=new Date(a.f_mna+d),h=[];Object.keys(a.areas).forEach(function(b){var e=[];a.areas[b].horas.forEach(function(a){var b=new Date(a.validez_ini+d);(new Date(a.validez_fin+d)<f||b>=g)&&e.push(a)});e.forEach(function(d){d=
a.areas[b].horas.indexOf(d);a.areas[b].horas.splice(d,1)});if(0==a.areas[b].horas.length)h.push(b);else{var l={};a.areas[b].horas.forEach(function(a){a.fenomenos.forEach(function(a){var b=a.tipo,d=a.nivel;if(!(b in l)||l[b].nivel>d)l[b]={nivel:d,fenomeno:a}})});var p=[];Object.keys(l).forEach(function(a){p.push(l[a].fenomeno)});a.areas[b].hoy.fenomenos=p}});h.forEach(function(b){delete a.areas[b]});return a}};function EstacionesComponent(){ListComponent.call(this);this._getData=function(a){return this.service.getListadoEstaciones(a)};this._setState=function(a){var b=this.state.location!=a.location;this.state.location=a.location;this.state.locationName=a.locationName;return b};this._render=function(a){if(0!=a.length){var b="<div class='table-responsive'><table class='table'><thead>"+"<tr><th>{{estacion}}</th><th>{{ind_clima}}</th><th>{{periodo}}</th><th>{{altitud}}</th><th>{{latitud}}</th><th>{{longitud}}</th></tr>".replace("{{estacion}}",
this.lang["valores.literal.estacion"]).replace("{{ind_clima}}",this.lang["valores.literal.ind_climat"]).replace("{{id}}",this.lang["valores.literal.selec_estacion"]).replace("{{periodo}}",this.lang["valores.literal.periodo"]).replace("{{altitud}}",this.lang["valores.literal.altitud"]).replace("{{latitud}}",this.lang["valores.literal.latitud"]).replace("{{longitud}}",this.lang["valores.literal.longitud"])+"</thead>";"<tbody>";var d=this.state,e=this.locale;a.forEach(function(a){var f="/"+e+"/serviciosclimaticos/datosclimatologicos/valoresclimatologicos?l={{id}}&k={{locationName}}".replace("{{id}}",
a.id).replace("{{locationName}}",d.locationName);b+="<tr>"+"<td  class='col-ini'><a href='{{url}}'>{{estacion}}</a></td><td>{{id}}</td><td>{{periodo}}</td><td>{{altitud}}</td><td>{{latitud}}</td><td  class='col-fin'>{{longitud}}</td>".replace("{{url}}",f).replace("{{estacion}}",a.estacion).replace("{{id}}",a.id).replace("{{periodo}}",a.periodo).replace("{{altitud}}",a.altitud).replace("{{latitud}}",a.latitud).replace("{{longitud}}",a.longitud)+"</tr>"});return b+="</tbody></table></div>"}}};function DateLineClimaticos(){this.state={};this.create=function(a,b,d,e,f){this.service=d;this.variables={};this.idParametros=a;this.idPeriodos=b;this.action=e;this.lang=f;this.params=[];this.periodRenderer=DateLineClimaticosPeriodRenderer;return this};this.setState=function(a){var b=this.state.param;for(k in a)this.state[k]=a[k];b!=this.state.param&&(this._setSelectionParam(),this._refreshUIPeriodos(),this._setFirstElement());this._setSelectionPeriod(!1)};this.initialize=function(a,b){var d=this;
for(k in a)this.state[k]=a[k];this.params=b||[];var e=jQuery.Deferred();this.service.getDateLine(a).then(function(a){d._setData(a[0]);d._refreshUI();e.resolve(d.state)});return e.promise()};this._setData=function(a){this._adapt(a);this._setFirstElement()};this._setFirstElement=function(){var a="param"in this.state?this.state.param:Object.keys(this.variables)[0],b=this.variables[a].regiones[this.state.ambito],d=this.state.periodo;-1==Object.keys(b).indexOf(this.state.periodo)&&(d=Object.keys(b)[0]);
b=b[d].fichero;this.state.param=a;this.state.fichero=b;this.state.periodo=d};this._adapt=function(a){var b=this;a.Capas.forEach(function(a){if("Variable"in a){var d=a.Variable[0],f={nombre:a.Variable[1],regiones:{}};a.Elementos.forEach(function(a){var b={},d="Islas Canarias"==a.Region?"CAN":"PB";a.LineaTiempo.forEach(function(a){b[a[0]]={periodo:a[1]}});a.Ficheros.forEach(function(a){b[a.Periodo[0]].fichero=a.Fichero});f.regiones[d]=b});b.variables[d]=f}})};this._refreshUI=function(){this._refreshUIParams();
this._refreshUIPeriodos()};this._refreshUIParams=function(){this._renderParametros();this._setSelectionParam();this._bindEventParams()};this._refreshUIPeriodos=function(){this._renderPeriodos();this._setSelectionPeriod();this._bindEventPeriod()};this._getParamRenderer=function(){return 992<=$(window).width()?DateLineClimaticosParamRenderer:DateLineClimaticosParamMobileRenderer};this._renderParametros=function(){$(this.idParametros).empty();$(this.idParametros).append(this._getParamRenderer().renderParametros(this.variables,
this.state.ambito,this.lang,this.params))};this._renderPeriodos=function(){var a=this.variables[this.state.param].regiones[this.state.ambito];$(this.idPeriodos).empty();$(this.idPeriodos).append(this.periodRenderer.renderPeriodos(a,this.lang))};this._setSelectionParam=function(){this._getParamRenderer().setSelectionParam(this.idParametros,this.state)};this._bindEventParams=function(){this._getParamRenderer().bindParametrosEvents(this.idParametros,this.action)};this._bindEventPeriod=function(){this.periodRenderer.bindPeriodosEvents(this.idPeriodos,
this.action)};this._setSelectionPeriod=function(a){this.periodRenderer.setSelectionPeriod(this.idPeriodos,this.state,a)}}
var DateLineClimaticosParamRenderer={renderParametros:function(a,b,d,e){var f='<ul class="clim-params">';(void 0==e||0==e.length?Object.keys(a):e).forEach(function(e){var g=d["valores.literal.param."+e],l=a[e].regiones[b];l=l[Object.keys(l)[0]].fichero;f+='<li class="clim-param" data-param="{{param}}" data-fichero="{{fichero}}">{{nombre}}</li>'.replace("{{param}}",e).replace("{{fichero}}",l).replace("{{nombre}}",g)});return f+="</ul>"},bindParametrosEvents:function(a,b){$(a).find(".clim-param[data-param]").on("click",
function(){var a=$(this).attr("data-param"),e=$(this).attr("data-fichero");b.fireAction({param:a,fichero:e})})},setSelectionParam:function(a,b){$(a).find(".clim-param[data-param]").each(function(a){$(this).removeClass("tl-selected")});b="[data-param={{codigo}}]".replace("{{codigo}}",b.param);$(a).find(b).addClass("tl-selected")}},DateLineClimaticosParamMobileRenderer={renderParametros:function(a,b,d){var e='<div class="timeline-dias"><select>';Object.keys(a).forEach(function(f){var g=d["valores.literal.param."+
f],h=a[f].regiones[b];h=h[Object.keys(h)[0]].fichero;e+='<option data-fichero="{{fichero}}" value="{{param}}">{{nombre}}</option>'.replace("{{param}}",f).replace("{{param}}",f).replace("{{fichero}}",h).replace("{{nombre}}",g)});return e+="</select>"},bindParametrosEvents:function(a,b){$(a).find("select").selectmenu({width:"auto"}).on("selectmenuchange",function(){$(this).val();var a=$(this).attr("data-fichero");b.fireAction({param:$(this).val(),fichero:a})})},setSelectionParam:function(a,b){a=$(a).find("select");
a.val(b.param);try{a.selectmenu("refresh")}catch(d){}}},DateLineClimaticosPeriodRenderer={renderPeriodos:function(a,b){var d='<div class="tl-main-horas">';d+='<ul class="tl-valores">';Object.keys(a).sort().forEach(function(e){var f=a[e];d+='<li><span class="el-periodo" data-periodo-id="{{periodoId}}" data-periodo-fichero="{{fichero}}">{{nombre}}</span></li>'.replace("{{periodoId}}",e).replace("{{fichero}}",f.fichero).replace("{{nombre}}",b["valores.dateline."+f.periodo])});return d+="</ul></div>"},
bindPeriodosEvents:function(a,b){$(a).find(".el-periodo[data-periodo-id]").on("click",function(){var a=$(this).attr("data-periodo-fichero"),e=$(this).attr("data-periodo-id");b.fireAction({fichero:a,periodo:e})})},setSelectionPeriod:function(a,b,d){$(a).find("[data-periodo-id]").removeClass("tl-selected");$(a).find("[data-periodo-id="+b.periodo+"]").addClass("tl-selected")}};function LeyendaColoresComponent(){ListComponent.call(this);this.create=function(a,b,d,e,f,g){this.service=b;this.id=a;this.lang=d;this.locale=e;this.descriptor=void 0!=f?f:new DescripcionLeyendaCustom(d);this.condition=g||void 0;this.dataSubscribers=[];this.changeOnFichero=!1;return this};this.addDataSubscriber=function(a){this.dataSubscribers.push(a)};this.setChangeOnFichero=function(a){this.changeOnFichero=a};this._setState=function(a){var b=this;if(this.condition&&!this.condition.checkCondition(a))return this.state.param=
a.param,$(this.id).empty(),!1;var d=!1;["param","ambito","fichero","nivel"].forEach(function(e){var f=a[e];"fichero"==e&&!b.changeOnFichero||b.state[e]==f||(d=!0);e in a&&(b.state[e]=f)});return d};this._getData=function(a){return this.service.getValoresLeyenda(a)};this._adapt=function(a){a&&this.dataSubscribers.forEach(function(b){b.setLegendData(a["Lista RGBA"])});return a};this._render=function(a){var b=this,d='<div class="leyenda-colores">'.replace("{{id}}",this.id)+'<div class="leyenda-titulo">{{titulo}}</div>'.replace("{{titulo}}",
this.descriptor.getDescripcion(a.Producto,this.state))+"<ul>";a=a["Lista RGBA"].sort(function(a,b){return a.Valores[0]-b.Valores[0]});var e=!1;a.forEach(function(a){var f=a.RGBA[1],h=a.RGBA[2];f="#"+b._cToHex(a.RGBA[0])+b._cToHex(f)+b._cToHex(h);a=(e=Array.isArray(a.Valores))?a.Valores[0]:a.Valores;d+='<li class="ley-el-color">'+'<div style="background-color:{{color}}">&nbsp;</div>'.replace("{{color}}",f)+'<div class="ley-el-dato{{center}}">{{valor}}</div>'.replace("{{valor}}",a).replace("{{center}}",
e?"":" ley-simple");"</li>"});e&&0<a.length&&(d+='<li class="ley-el-color"><div>&nbsp;</div>'+'<div class="ley-el-dato">{{rango}}</div>'.replace("{{rango}}",a[a.length-1].Valores[1])+"</li>");d+="</ul></div>";return'<div class="leyenda-col-map">'+d+"</div>"};this._cToHex=function(a){a=parseInt(a).toString(16);return 1==a.length?"0"+a:a}}
function DescripcionLeyendaRadar(a){this.lang=a;this.codigos={compo:"radar.literal.peninsula.radar",TOP:"radar.literal.peninsula.ecotop",PPI:"radar.literal.peninsula.radar",RN1:"radar.literal.peninsula.radar1h",RNN:"radar.literal.peninsula.radar6h"};this.medidas={compo:"radar.literal.peninsula.medida.radar",TOP:"radar.literal.peninsula.medida.ecotop",PPI:"radar.literal.peninsula.medida.radar",RN1:"radar.literal.peninsula.medida.radar1h",RNN:"radar.literal.peninsula.medida.radar6h"};this.getDescripcion=
function(a){var b=this.lang[this.codigos[a]]+" "+this.lang[this.medidas[a]];return void 0!=b?b:a}}function DescripcionLeyendaCustom(a,b){this.lang=a||{};this.prefix=b||"";this.getDescripcion=function(a){return this.lang[this.prefix+a]||a}}function DescripcionLeyendaCodigos(a,b){this.lang=a||{};this.desc=b||{};this.getDescripcion=function(a){return this.lang[this.desc[a]]||a}}
function DescripcionLeyendaModelos(a,b,d){this.lang=a||{};this.desc=b||{};this.getDescripcion=function(a,b){b=-1!=["PB","CAN"].indexOf(b.ambito);b="{{modelo}}_{{codigo}}".replace("{{modelo}}",b?"HAR":"CEP").replace("{{codigo}}",a);return this.lang[this.desc[b]]||a}};function ListComponent(){this.data=[];this.state={zoom:6,ambito:"PB"};this.create=function(a,b,d,e){this.service=b;this.id=a;this.lang=d;this.locale=e;return this};this._setState=function(a){for(k in a)this.state[k]=a[k];return!0};this._bindEvents=function(a,b){};this._render=function(){};this._getData=function(a){return $.Deferred().promise()};this._adapt=function(a){return a};this._replaceData=function(a,b){for(key in b)a=a.replace("{{"+key+"}}",b[key]);return a};this.setState=function(a){var b=
this;this._setState(a)&&($(b.id).find(".main").addClass("no-display"),$(b.id).find(".loader").removeClass("no-display"),this._getData(this.state).then(function(a){a=b._adapt(a[0]);$(b.id).empty();b._bindEvents($(b.id).append(b._render(a)),a)}).fail(function(a,e){$(b.id).empty();$(b.id).append("<div class='no-data'>{{mensaje}}</div>".replace("{{mensaje}}",404==e?"No hay datos disponibles":"Error al cargar los datos del componente"))}).always(function(a){}))}}
function TemperaturesComponent(){ListComponent.call(this);this._setState=function(a){var b=this,d=!1;["location","zoom","ambito","fecha"].forEach(function(e){var f=a[e];"fecha"==e&&(f=f.substring(0,10));"zoom"==e||d||b.state[e]==f||(d=!0);e in a&&(b.state[e]=f)});return d};this._getData=function(a){return this.service.getMaxMins(a)};this._adapt=function(a){this._xmlDataAdapter||(this._xmlDataAdapter=0<window.navigator.userAgent.indexOf("MSIE ")||0<window.navigator.userAgent.indexOf("Trident")?new TemperaturasIEXmlDataAdapter(this.lang,
this.locale,this.state):new TemperaturasCustomXmlDataAdapter(this.lang,this.locale,this.state));return this._xmlDataAdapter.getData(a)};this._render=function(a){var b=this,d="<div class='main'><ul class='list'>"+"<li><div class='row title'><div class='name'>{{titulo}}</div><div class='min'>M&#237;n</div><div class='max'>M&#225;x</div></div></li>".replace("{{titulo}}",7>=this.state.zoom?this.lang["pais.prediccion.literal.capital"]:this.lang["localidades.literal.localidad"]).replace("{{min}}",this.lang["pais.prediccion.literal.minima"]).replace("{{max}}",
this.lang["pais.prediccion.literal.maxima"]);a=a.municipios;a.sort(function(a,b){return a.municipio.localeCompare(b.municipio)});a.forEach(function(a){d+=b._replaceData("<li><div class='row element'><div class='name'>{{municipio}}</div><div class='min'>{{tmin}}</div><div class='max'>{{tmax}}</div></div></li>",a)});return d+="</ul></div><div class='loader no-display'></div>"};this._bindEvents=function(a,b){a=this.state;$(".link-download-temp").attr("href","/es/api-eltiempo"+this.service.getMaxMinsDownloadUrl(a))}}
function TemperaturasCustomXmlDataAdapter(a,b,d){this.locale=b;this.lang=a;this.getData=function(a){a=a.evaluate(7>=d.zoom?"//ciudad[@nombre and @capital=1]":"//ciudad[@nombre]",a,null,XPathResult.ANY_TYPE,null);for(var b=a.iterateNext(),e=[];null!=b;){var h=b.getAttribute("nombre"),l=b.getElementsByTagName("tmax")[0].textContent;b=b.getElementsByTagName("tmin")[0].textContent;e.push({municipio:h,tmax:l,tmin:b});b=a.iterateNext()}return{municipios:e}};this._getXmlData=function(a,b){a=b.evaluate(a,
b,null,XPathResult.ANY_TYPE,null).iterateNext();return null!=a&&void 0!=a?a.innerHTML:""}}function TemperaturasIEXmlDataAdapter(a,b,d){this.locale=b;this.lang=a;this.getData=function(a){var b=[];a=a.getElementsByTagName("ciudad");for(i=0;i<a.length;i++){var e=a[i];if(!(7>=d.zoom&&1!=e.getAttribute("capital"))){var h=e.getAttribute("nombre"),l=e.getElementsByTagName("tmax")[0].textContent;e=e.getElementsByTagName("tmin")[0].textContent;b.push({municipio:h,tmin:e,tmax:l})}}return{municipios:b}}}
function PredictionComponent(a){ListComponent.call(this);this.fechaIni=new Date(a);this._getData=function(a){return this.service.getPrediction(a)};this._setState=function(a){var b=this,e=!1,f={};for(key in a)f[key]=a[key];["location","zoom","ambito","fecha"].forEach(function(d){var g=f[d];"fecha"==d&&(g=g.substring(0,10));e||b.state[d]==g||(e=!0);d in a&&(b.state[d]=g)});return e};this._=function(a){return data};this._adapt=function(a){this._xmlDataAdapter||(this._xmlDataAdapter=0<window.navigator.userAgent.indexOf("MSIE ")||
0<window.navigator.userAgent.indexOf("Trident")?new PrediccionIEXmlDataAdapter(this.lang,this.locale):new PrediccionCustomXmlDataAdapter(this.lang,this.locale));return this._xmlDataAdapter.getData(a)};this._render=function(a){void 0==a.zona&&(a.zona=$("#msg-localizacion").html());$("[data-set-localizacion]").html(a.zona);var b="<div><h4>{{tit_pred}}</h4><p>{{prediccion}}</p></div>".replace("{{tit_pred}}",this.lang["pais.prediccion.literal.pred"])+"<div class='loader no-display'></div>";"fenomenos"in
a&&void 0!=a.fenomenos&&(b="<div><h4>{{tit_fen_sig}}</h4><p>{{fenomenos}}</p></div>".replace("{{tit_fen_sig}}",this.lang["pais.prediccion.literal.fensig"])+b);"validezIni"in a&&void 0!=a.validezIni&&(b="<div><strong>{{tit_validez}}:</strong> {{validezIni}}</div>".replace("{{tit_validez}}",this.lang["avisos.literal.validez"])+b);return this._replaceData(b,a)};this._bindEvents=function(a,d){a=this.state;$(".link-download-pred").attr("href","/es/api-eltiempo"+this.service.getPredictionDownloadUrl(a))}}
function PrediccionCustomXmlDataAdapter(a,b){this.locale=b;this.lang=a;this.getData=function(a){var b=void 0,d=a.evaluate("/root/@id",a,null,XPathResult.ANY_TYPE,null);d&&(d=d.iterateNext().value,b=this.lang[d]);b={prediccion:this._getXmlData("/root/prediccion/txt_prediccion",a),zona:b};d=this._getXmlData("/root/validez_ini",a);var g=this._getXmlData("/root/validez_fin",a);(a=this._getXmlData("/root/prediccion/fenom_sign",a))&&(b.fenomenos=a);d&&(a=new Date(g),g={year:"numeric",month:"long",day:"numeric"},
b.validezIni=(new Date(d)).toLocaleDateString(this.locale,g),b.validezFin=a.toLocaleDateString(this.locale,g));return b};this._getXmlData=function(a,b){a=b.evaluate(a,b,null,XPathResult.ANY_TYPE,null).iterateNext();return null!=a&&void 0!=a?a.innerHTML:""}}
function PrediccionIEXmlDataAdapter(a,b){this.locale=b;this.lang=a;this.getData=function(a){var b={zona:this.lang[a.getElementsByTagName("root")[0].getAttribute("id")],prediccion:a.getElementsByTagName("txt_prediccion")[0].textContent},d=a.getElementsByTagName("fenom_sign");d&&d[0]&&(b.fenomenos=d[0].textContent);if(a.getElementsByTagName("validez_ini")){d=new Date(a.getElementsByTagName("validez_ini")[0].textContent);a=new Date(a.getElementsByTagName("validez_fin")[0].textContent);var g={year:"numeric",
month:"long",day:"numeric"};b.validezIni=d.toLocaleDateString(this.locale,g);b.validezFin=a.toLocaleDateString(this.locale,g)}return b}}
function ListadoAvisosComponent(){ListComponent.call(this);this.filter=function(a){$(this.id).find("[data-tipo-av]").each(function(b,d){b=$(this).attr("data-tipo-av");$(this).css("display","ALL"==a||b==a?"":"none")})};this._getData=function(a){return this.service.getListadoAvisos(a)};this._setState=function(a){var b=this,d=!1;"location zoom ambito fecha dia resumen".split(" ").forEach(function(e){var f=a[e];d||b.state[e]==f||(d=!0);e in a&&(b.state[e]=f)});return d};this._render=function(a){if(!("orden_avisos"in
a||0==a.orden_avisos.length))return"<div><ul><li><div class='rs-el-resumen'>No hay avisos</div></li></ul></div>";var b=this,d="",e=/.+\-.+\-\d{2}(.+)\-.+\-(\d+)\D*/,f={1:"avisos.rojo.desc",2:"avisos.naranja.desc",3:"avisos.amarillo.desc"},g=void 0;a.orden_avisos.forEach(function(a){var h=e.exec(a[0]),m=h[1];h=h[2];var n=h.substring(0,4);a=a[1];a.Certainty!=g&&(d+="<div class='table-responsive'>",d+="<table class='table'>",g=a.Certainty,d+="<caption class='contenedor-observado'>{{titulo}}</caption>".replace("{{titulo}}",
b.lang["avisos.boletin."+g+"s"]),d+="<thead><tr>",d+="<th class='col-ini'>{{cabeceraFenomeno}}</th>".replace("{{cabeceraFenomeno}}",b.lang["avisos.boletin.fenomeno"]),d+="<th>{{cabeceraValor}}</th>".replace("{{cabeceraValor}}",b.lang["avisos.boletin.valor"]),d+="<th>{{cabeceraNivelRiesgo}}</th>".replace("{{cabeceraNivelRiesgo}}",b.lang["avisos.boletin.nivelriesgo"]),d+="<th>{{cabeceraProbabilidad}}</th>".replace("{{cabeceraProbabilidad}}",b.lang["avisos.boletin.probabilidad"]),d+="<th>{{cabeceraZonaAviso}}</th>".replace("{{cabeceraZonaAviso}}",
b.lang["localidades.literal.zona_avisos"]),d+="<th>{{cabeceraHoraInicio}}</th>".replace("{{cabeceraHoraInicio}}",b.lang["avisos.boletin.horacomienzo"]),d+="<th>{{cabeceraHoraFin}}</th>".replace("{{cabeceraHoraFin}}",b.lang["avisos.boletin.horafin"]),d+="<th class='col-fin'>{{cabeceraComentario}}</th>".replace("{{cabeceraComentario}}",b.lang["avisos.boletin.comentario"]),d+="</tr></thead>",d+="<tbody>");var p=a.Onset,q=a.Expire;p="{{dia}}/{{mes}}/{{anio}} {{hora}}:{{minutos}}".replace("{{dia}}",p.substring(8,
10)).replace("{{mes}}",p.substring(5,7)).replace("{{anio}}",p.substring(0,4)).replace("{{hora}}",p.substring(11,13)).replace("{{minutos}}",p.substring(14,16));q="{{dia}}/{{mes}}/{{anio}} {{hora}}:{{minutos}}".replace("{{dia}}",q.substring(8,10)).replace("{{mes}}",q.substring(5,7)).replace("{{anio}}",q.substring(0,4)).replace("{{hora}}",q.substring(11,13)).replace("{{minutos}}",q.substring(14,16));d+="<tr data-tipo-av='{{tipo}}'>".replace("{{tipo}}",m.substring(0,2));d+="<td class='col-ini'><img src='/imagenes/gif/iconos_avisos/{{tipo}}{{nivel}}.gif' title='{{desc_tipo}} - {{desc_nivel}}'></div><span class='txt-fenomeno'>{{desc_tipo_2}}</span></td>".replace("{{nivel}}",
a.Nivel).replace("{{desc_tipo}}",b.lang["avisos.boletin."+m.substring(0,2)]).replace("{{tipo}}",m.substring(0,2)).replace("{{desc_nivel}}",b.lang[f[a.Nivel]]).replace("{{desc_tipo_2}}",b.lang["avisos.boletin."+m.substring(0,2)])+"<td>{{valor}}</td>".replace("{{valor}}",void 0!=a.Valor?a.Valor:"")+"<td>{{nivel}}</td>".replace("{{nivel}}",b.lang[f[a.Nivel]])+"<td>{{probabilidad}}</td>".replace("{{probabilidad}}",void 0!=a.Prb?a.Prb:"")+"<td><span class='la-zona-zona' data-zona-id={{zona}}></span>-<span class='la-zona-provincia' data-zona-id={{provincia}}></span></td>".replace("{{zona}}",
h).replace("{{provincia}}",n)+"<td>{{desde}}</td>".replace("{{desde}}",p)+"<td>{{hasta}}</td>".replace("{{hasta}}",q)+"<td class='col-fin'>{{descripcion}}</td>".replace("{{descripcion}}",a.Descrption)});void 0!=g&&(d+="</table>");return d};this._bindEvents=function(a,b){var d=[],e=/.+\-.+\-\d{2}(.+)\-.+\-(\d+)\D*/;b.orden_avisos.forEach(function(a){a=e.exec(a[0])[2];var b=a.substring(0,4);-1==d.indexOf(b)&&d.push(b);-1==d.indexOf(a)&&d.push(a)});0!=d.length&&this.service.getNombreZonas(d).then(function(b){d.forEach(function(d){a.find("[data-zona-id={{key}}]".replace("{{key}}",
d)).html(b[0][d].name)})})}}function VariablesTabs(){}VariablesTabs.prototype.setState=function(a){"param"in a&&(this.state=a,this._renderer.setSelection(this.id,a))};VariablesTabs.prototype._render=function(a,b){return this._renderer.render(a)};VariablesTabs.prototype._createEvents=function(a,b){this._renderer.bindEvents(a,b)};
VariablesTabs.prototype.create=function(a,b,d){b=b.variables;this.action=d;this.id=a;this._renderer=992<=$(window).width()?new VariablesRendererCustom:new VariablesRendererMobile(this);$(a).empty();$(a).append(this._render(b));this._createEvents(a,d);return this};function VariablesRendererCustom(){}VariablesRendererCustom.prototype.render=function(a){var b="<ul class='lista-variables'>";a.forEach(function(a){b+="<li data-param='"+a.id+"'>"+a.name+"</li>"});return b+="</ul>"};
VariablesRendererCustom.prototype.bindEvents=function(a,b){$(a).find("[data-param]").each(function(d){$(this).on("click",function(){var d=$(this).attr("data-param");b.fireAction({param:d});$(a).find("[data-param]").removeClass("tl-selected");$(a).find("[data-param="+d+"]").addClass("tl-selected")})})};VariablesRendererCustom.prototype.setSelection=function(a,b){$(a).find("[data-param]").removeClass("tl-selected");$(a).find("[data-param="+b.param+"]").addClass("tl-selected")};
function VariablesRendererMobile(a){this.component=a}VariablesRendererMobile.prototype.render=function(a){var b="<select class='tl-param-prediccion select-dia'>";a.forEach(function(a){b+="<option value='{{id}}'>{{name}}</option>".replace("{{id}}",a.id).replace("{{name}}",a.name)});return b+="</select>"};VariablesRendererMobile.prototype.bindEvents=function(a,b){$(a).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",function(){b.fireAction({param:$(this).val()})})};
VariablesRendererMobile.prototype.setSelection=function(a,b){a=$(a).find(".select-dia");a.val(b.param);try{a.selectmenu("refresh")}catch(d){}};function MsgLocationComponent(){}MsgLocationComponent.prototype.create=function(a,b){this.id=a;this.lang=b;return this};
MsgLocationComponent.prototype.setState=function(a){$(this.id).empty();var b="Pen&iacute;nsula, Illes Balears, Ceuta y Melilla";"location"in a&&void 0!=a.locationName&&(a=a.locationName,(b=-1!=a.indexOf("C"))&&(a=a.substring(0,a.length-1)),b=this.lang[a]+(b?" - Costa":""));$(this.id).append(b)};function MsgRadarComponent(){}MsgRadarComponent.prototype.create=function(a,b){this.id=a;this.radares={};var d=this;b.forEach(function(a){d.radares[a.codigo]=a.name});return this};
MsgRadarComponent.prototype.setState=function(a){$(this.id).empty();var b="";"radar"in a&&void 0!=a.radar&&(b=this.radares[a.radar]);$(this.id).append(b)};function Mediator(){this.listComponents=[];this.state={};this.addComponent=function(a){this.listComponents.push(a)};this.getState=function(){return this.state};this.setState=function(a,b){var d=this;for(k in a)this.state[k]=a[k];this.listComponents.forEach(function(a){a!=b&&a.setState(d.state)})}};var ShowAvisos={service:null,addAvisosLayer:function(a,b,d,e){this.service=b;this.idTipoAvisos=a;this.options=e;this.locale=d;var f=this;["rojo","naranja","amarillo"].forEach(function(a,b){f.locale["avisos."+(b+1)+".desc"]=f.locale["avisos."+a+".desc"]});this.filter={};this.prevState={};this.changeStateActions.push({fireAction:function(a){f.checkCambio(a)&&f._showAvisosLayers(a)}});return this},_getAvisos:function(a){return"resumen"in a&&a.resumen?this.service.getResumenAvisos(a):this.service.getAvisos(a)},
_showAvisosLayers:function(a){var b=this,d=this.map;d.removeBoundLayers(this.avisosLayers);this._getAvisos(this.getState()).then(function(e){d.removeBoundLayers(b.avisosLayers);e=TopoJsonUtil.toGeojson(e[0]);b.avisosLayers=L.geoJSON(e,AvisosOptions.createOptions(a,b.locale,b.options));b.avisosLayers.setZIndex(100);b.avisosLayers.addTo(d);b._addTiposAvisoControls(e)}).fail(function(a){d.remove();"mapa"==b.placeholderId?$("#"+b.placeholderId).html("<div class='msg-no-data-mapa'>Informaci&oacute;n no disponible. Disculpe las molestias.</div>"):
$("#"+b.placeholderId).html("<div class='msg-no-data-portada'>Informaci&oacute;n no disponible. Disculpe las molestias..</div>")})},_addTiposAvisoControls:function(a){this._renderTipoAvisos(this._getTiposAviso(a));this._bindEventsAvisos()},_getTiposAviso:function(a){var b=["ALL"];if(!("features"in a))return b;a.features.forEach(function(a){if("Fen_avisos"in a.properties)a.properties.Fen_avisos.forEach(function(a){a=a.substring(0,2);-1==b.indexOf(a)&&b.push(a)});else for(k in a.properties)a=k.substring(5,
7),/^Avis_.*$/gi.test(k)&&-1==b.indexOf(a)&&b.push(a)});return b},_renderTipoAvisos:function(a){this._getTipoAvisoRenderer().render(this.idTipoAvisos,a)},_bindEventsAvisos:function(){this._getTipoAvisoRenderer().bindEvents(this)},_getTipoAvisoRenderer:function(){var a=new AvisosMapFilter(this,AvisosOptions.getColoresAvisos()),b=this.locale;return 992<=$(window).width()?CustomTipoAvisosRenderer.createRenderer(a,b):MobileTipoAvisosRenderer.createRenderer(a,b)},checkCambio:function(a){var b=this,d=!1;
["ambito","fecha","resumen"].forEach(function(e){d=d||b.prevState[e]!=a[e];b.prevState[e]=a[e]});return d}},AvisosOptions=function(){return{getColoresAvisos:function(){return{1:{color:"#760900",fillColor:"#a20e02"},2:{color:"#B43104",fillColor:"#f6ba2c"},3:{color:"#B18904",fillColor:"#f4e72a"},4:{color:"#FE2E2E",fillColor:"#4cad5d"}}},createOptions:function(a,b,d){var e=this.getColoresAvisos();return{style:function(a){a=a.properties.Av_mayor;a=a in e?e[a]:{color:"lime",fillColor:"lime"};return{color:a.color,
fillOpacity:.75,fillColor:a.fillColor,weight:.7,opacity:1,zIndex:100}},onEachFeature:function(e,g){if(void 0!=d&&"showPopups"in d&&1==d.showPopups){var f="Fen_avisos"in e.properties?AvisosHoraPopup.createHtmlPopup(e,b):AvisosResumenPopup.createHtmlPopup(e,b),l="auto",m=L.point(0,0);6>=a.zoom&&"COD_Z"in e.properties&&-1!="7127 7115 6333 6639 7520 7501 7548 6925 7431".split(" ").indexOf(e.properties.COD_Z.substring(0,4))&&(l="bottom");6>=a.zoom&&"COD_Z"in e.properties&&-1!=["711502","711504"].indexOf(e.properties.COD_Z.substring(0,
6))&&(l="right",m=L.point(50,50));6>=a.zoom&&"COD_Z"in e.properties&&-1!=["711501"].indexOf(e.properties.COD_Z.substring(0,6))&&(l="right",m=L.point(0,100));g.bindTooltip(f,{direction:l,offset:m})}},filter:function(a){return!0}}}}}(),AvisosHoraPopup=function(){return{createHtmlPopup:function(a,b,d){if("Fen_avisos"in a.properties)return a=this._adapt(a,d),this._createHtml(a,b)},_createHtml:function(a,b){var d='<div class="marker-tooltip marker-tooltip-aviso ">'+'<div class="rs-tp-zona">{{zona}}</div>'.replace("{{zona}}",
a.zona);a.avisos.forEach(function(a){d+='<div class="rs-tp-aviso">';var e=a.nivel,g=a.descripcion,h=a.prob;a=a.tipo;d+='<div class="rs-el-resumen rs-nivel-{{nivel}} rs-tipo-{{tipo}}"></div>'.replace(/\{\{tipo\}\}/g,a.substring(0,2)).replace("{{nivel}}",e);d+='<div class="rs-tp-tipo">{{tipo}}</div>'.replace("{{tipo}}",b["avisos.boletin."+a.substring(0,2)]);d+='<div class="rs-tp-nivel">{{nivel}}</div>'.replace("{{nivel}}",b["avisos."+e+".desc"]);h&&(d+='<div class="rs-tp-certeza">{{des_prob}}: {{prob}}</div>'.replace("{{des_prob}}",
b["avisos.boletin.probabilidad"]).replace("{{prob}}",h));g&&(d+='<div class="rs-tp-descripcion">{{descripcion}}</div>'.replace("{{descripcion}}",g));d+="</div>"});return d+="</div>"},_adapt:function(a,b){var d=a.properties,e={zona:"Nombre_zona"in d?d.Nombre_zona:d.Provincia,avisos:[]};0<d.Fen_avisos.filter(function(a){return"PR"==$.trim(a)}).length&&(d.Fen_avisos=d.Fen_avisos.filter(function(a){return"PR"!=$.trim(a)}),[1,2].forEach(function(a){a="PRP"+a;"Nivel_"+a in d&&d.Fen_avisos.push(a)}));d.Fen_avisos.forEach(function(a){a=
$.trim(a);void 0!=b&&$.trim(b)!=a.substring(0,2)||e.avisos.push({nivel:d["Nivel_"+a],certeza:d["Cer_"+a],descripcion:d["Des_"+a],resumen:d["Resum_"+a],prob:d["Prb_"+a],tipo:a})});return e}}}(),AvisosResumenPopup=function(){return{createHtmlPopup:function(a,b,d){return this._createHtml(this._adapt(a,d),b)},_createHtml:function(a,b){var d='<div class="marker-tooltip marker-tooltip-aviso ">'+'<div class="rs-tp-zona">{{zona}}</div>'.replace("{{zona}}",a.zona);a.avisos.forEach(function(a){d+='<div class="rs-tp-aviso">';
var e=a.nivel_num,g=a.descripcion,h=a.fenomeno,l=a.onset_local;a=a.expires_local;d+='<div class="rs-el-resumen rs-nivel-{{nivel}} rs-tipo-{{tipo}}"></div>'.replace(/\{\{tipo\}\}/g,h.substring(0,2)).replace("{{nivel}}",e);d+='<div class="rs-tp-tipo"> {{tipo}}</div>'.replace("{{tipo}}",b["avisos.boletin."+h.substring(0,2)]);d+='<div class="rs-tp-nivel">{{nivel}}</div>'.replace("{{nivel}}",b["avisos."+e+".desc"]);l&&(l=l.substring(8,10)+"/"+l.substring(5,7)+"/"+l.substring(0,4)+" "+l.substring(11,16),
a=a.substring(8,10)+"/"+a.substring(5,7)+"/"+a.substring(0,4)+" "+a.substring(11,16),d+='<div class="rs-tp-dea"> De {{horaIni}} a {{horaFin}}</div>'.replace("{{horaIni}}",l).replace("{{horaFin}}",a));g&&(d+='<div class="rs-tp-descripcion">{{descripcion}}</div>'.replace("{{descripcion}}",g));d+="</div>"});return d},_adapt:function(a,b){var d=a.properties,e={zona:"Nombre_zona"in d?d.Nombre_zona:d.Provincia,avisos:[]};Object.keys(d).forEach(function(a){/^Avis_.*$/gi.test(a)&&d[a].forEach(function(a){var d=
a.fenomeno;void 0!=b&&$.trim(b)!=d||e.avisos.push(a)})});var f=d.Ordn_avisos;e.avisos=e.avisos.sort(function(a,b){return f.indexOf(a.code)-f.indexOf(b.code)});return e}}}(),CustomTipoAvisosRenderer=function(){return{createRenderer:function(a,b){return{render:function(a,e){$(a).empty();var d='<ul class="timeline-dias">';e.forEach(function(a){d+='<li data-av-tipo="{{tipo}}"><div class="rs-tipo-{{clase}}" style="display:inline-block;width:20px;height:20px"></div><div style="margin-left:20px;vertical-align:top; display:inline-block">{{descripcion}}</div></li>'.replace("{{tipo}}",
a).replace("{{descripcion}}","ALL"!=a?b["avisos.boletin."+a]:b["avisos.literal.todos"]).replace("{{clase}}","ALL"!=a?a.substring(0,2):"ALL")});d+="</ul>";$(a).append(d);$(a).find("[data-av-tipo=ALL]").addClass("tl-selected")},bindEvents:function(b){$(b.idTipoAvisos).find("[data-av-tipo]").on("click",function(d){d=$(this).attr("data-av-tipo");$(b.idTipoAvisos).find("[data-av-tipo]").removeClass("tl-selected");$(this).addClass("tl-selected");a.mostrar(d);b.map.fire("cambioFiltroAvisos",{tipo:d})})}}}}}(),
MobileTipoAvisosRenderer=function(){return{createRenderer:function(a,b){return{render:function(a,e){$(a).empty();var d='<select class="timeline-dias select-dia">';e.forEach(function(a){d+='<option value="{{tipo}}" data-tipo="{{tipo}}">{{descripcion}}</option>'.replace(/\{\{tipo\}\}/g,a).replace("{{descripcion}}","ALL"!=a?b["avisos.boletin."+a]:b["avisos.literal.todos"])});d+="</select>";$(a).append(d)},bindEvents:function(b){$(b.idTipoAvisos).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",
function(){var d=$(b.idTipoAvisos).find("select option:selected").attr("data-tipo");a.mostrar(d);b.map.fire("cambioFiltroAvisos",{tipo:d})})}}}}}();
function AvisosMapFilter(a,b){this.avisos=a;this.colores=b;this.mostrar=function(a){var d=this,f=this.avisos.map,g=this.getFilter();this.avisos.avisosLayers.getLayers().forEach(function(e){var h=g.tieneTipo(e,a);void 0!=h?(h=b[h],e.setStyle({fillColor:h.fillColor,color:h.color}),f.addLayer(e),d.avisos.options.showPopups&&e.bindTooltip(g.getHtmlPopup(e,a))):f.removeLayer(e)})};this.getFilter=function(){var b=a.locale;return this.avisos.state.resumen?new AvisosResumenMapFilter(b):new AvisosHorasMapFilter(b)}}
function AvisosHorasMapFilter(a){this.lang=a;this.tieneTipo=function(a,d){var b=void 0;if("ALL"==d)return a.feature.properties.Av_mayor;"Fen_avisos"in a.feature.properties&&a.feature.properties.Fen_avisos.forEach(function(e){e=$.trim(e);e.substring(0,2)==d&&(e=a.feature.properties["Nivel_"+e],void 0==b||b>e)&&(b=e)});return b};this.getHtmlPopup=function(a,d){return AvisosHoraPopup.createHtmlPopup(a.feature,this.lang,"ALL"!=d?d:void 0)}}
function AvisosResumenMapFilter(a){this.lang=a;this.tieneTipo=function(a,d){var b=void 0;if("ALL"==d)return a.feature.properties.Av_mayor;Object.keys(a.feature.properties).forEach(function(e){!(7>e.length||"Avis_"+d!=e.substring(0,7))&&(e=e.substring(5),e=parseInt(a.feature.properties["Nivel_"+e]),void 0==b||b>e)&&(b=e)});return b};this.getHtmlPopup=function(a,d){return AvisosResumenPopup.createHtmlPopup(a.feature,this.lang,"ALL"!=d?d:void 0)}};var ShowClimaticos={addClimaticosLayer:function(a,b){var d=this;this.climaBoundsDefecto={PB:[],CAN:[]};this.climaService=a;this.climaImage=void 0;this.changeStateActions.push({fireAction:function(a){d._checkCambioClimaticos(a)&&d._showClimaticoLayer(a)}});return this},_checkCambioClimaticos:function(a){return!0},_showClimaticoLayer:function(a){var b=this;this.climaService.getImagenBounds(a).then(function(d){d=L.GeoJSON.coordsToLatLngs(d[0]);0<d.length&&0==b.climaBoundsDefecto[a.ambito].length&&(b.climaBoundsDefecto[a.ambito]=
d);0==d.length&&(d=b.climaBoundsDefecto[a.ambito]);b._setClimaImagen(a,d)}).fail(function(a){console.log("Error al cargar la capa "+a)}).always(function(a){})},_setClimaImagen:function(a,b){a="/es/api-eltiempo/climatologicos/imagen-valores/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);void 0==this.climaImage?(this.climaImage=L.imageOverlay(a,b,{interactive:!0}).addTo(this.map),this.climaImage.setOpacity(.7)):(this.climaImage.setUrl(a),this.climaImage.setBounds(b))}};var ShowEstaciones={service:null,addEstaciones:function(a,b){this.service=a;this._estacionesOptions=EstacionesMarkerOptions.createOptions();this._bindEventsEstaciones();return this},_showEstaciones:function(){var a=this,b=a.map;b.removeBoundLayers(this.estacionesLayers);b=b.getZoom();this.service.getEstaciones({zoom:b}).then(function(b){a._addEstacionesToMap(b[0])}).fail(function(a){}).always(function(a){})},_addEstacionesToMap:function(a){var b=this.map;b.removeBoundLayers(this.estacionesLayers);
this.estacionesLayers=L.geoJSON(a,this._estacionesOptions);b.addPointLayer(this.estacionesLayers)},_clearEstaciones:function(){this.estacionesLayers&&this.map.removeBoundLayers(this.estacionesLayers)},_bindEventsEstaciones:function(){var a=this,b=this.map;b.on("cambioAmbito",function(b){a._showEstaciones()});b.on("moveend",function(b){this.showPointLayers(a.estacionesLayers);$(".marker-estacion").removeClass(function(a,b){return(b.match(/zoom.*/g)||[]).join(" ")});$(".marker-estacion").addClass("zoom-"+
a.state.zoom)})}},EstacionesMarkerOptions=function(a){return{createOptions:function(a){return{pointToLayer:function(a,b){var d=L.divIcon({className:"my-div-icon",html:'<div class="marker-estacion"><img src="/imagenes/svg/ico-location.svg"/></div>',iconSize:null});b=L.marker(b,{icon:d,interactive:!0});a=L.Util.template("<div class='marker-tooltip marker-tooltip-aviso'><div class='rs-tp-zona'><b>{estacion}</b></div><div><div class='rs-tp-tipo'>Ind. Climatol&oacute;gico:</div></div><div>{ind_climatologico}</div><div class='rs-tp-tipo'>Altitud:</div></div><div>{altitud} (m)</div></div>",
a.properties);b.bindTooltip(a).openTooltip();return b}}}}}();L.Map.BoundLayersMap=L.Map.extend({showBoundLayers:function(a){if(void 0!=a){var b=this;a.eachLayer(function(a){b.getBounds().overlaps(a.getBounds())?b.hasLayer(a)||b.addLayer(a):b.hasLayer(a)&&b.removeLayer(a)})}},showPointLayers:function(a){if(void 0!=a){var b=this;a.eachLayer(function(a){b.getBounds().contains(a.getLatLng())?b.hasLayer(a)||b.addLayer(a):b.hasLayer(a)&&b.removeLayer(a)})}},addBoundLayers:function(a){if(void 0!=a){var b=this;a.eachLayer(function(a){b.getBounds().overlaps(a.getBounds())&&
b.addLayer(a)})}},addPointLayer:function(a){if(void 0!=a){var b=this;a.eachLayer(function(a){b.getBounds().contains(a.getLatLng())&&b.addLayer(a)})}},removeBoundLayers:function(a){if(void 0!=a){var b=this;a.eachLayer(function(a){b.removeLayer(a)});a.clearLayers()}},getBoundLayers:function(a){if(void 0!=a){var b=this,d=[];a.eachLayer(function(a){b.hasLayer(a)&&d.push(a)});return d}}});L.boundLayersMap=function(a,b){return new L.Map.BoundLayersMap(a,b)};var ShowLines={service:null,addLimitLines:function(a,b,d){this.style=b||{interactive:!0,opacity:.65,weight:"0.8",color:"darkgreen",fillColor:"darkgreen",fillOpacity:.2};this.service=a;this._limitLineOpts=d||{};this.selectedLayer=void 0;this.roLayers={};this.showZoomLinea=d&&d.zoomLinea||{1:7,2:7,3:7,4:7,5:7,6:7,7:7,8:8,9:8,10:8};this.enableLocation=d&&"enableLocation"in d?d.enableLocation:!0;this.showPaises=d&&"showPaises"in d?d.showPaises:!1;this._bindEventsLimitLines();return this},_showLimitLines:function(a,
b){var d=this,e=d.map;if(void 0!=this.getState()){var f=this.getState().ambito;b=void 0!=b?Math.floor(b):Math.floor(e.getZoom());b=d.showZoomLinea[b];var g=jQuery.Deferred();this.service.getLimitLines({zoom:b,ambito:f,paises:d.showPaises}).then(function(b){d._clearLimitLines();d.limitLinesLayers=L.geoJSON(TopoJsonUtil.toGeojson(b[0]),{filter:function(a){return!0},onEachFeature:function(a,b){b.setStyle(d.style);if(d._limitLineOpts.fitBounds)b.on({click:function(a){e.fitBounds(a.target.getBounds(),
d._getFitBoundsOpts(a.target.feature))}})}});void 0!=a?d._putLocation(a):d._setLocation();d._showMapLayers();g.resolve()}).fail(function(a){}).always(function(a){});return g.promise()}},_clearLimitLines:function(){this.limitLinesLayers&&this.map.removeBoundLayers(this.limitLinesLayers)},_refreshLimitLines:function(a){var b=this,d=this.map;this._clearReadOnlyLayers();this._showLimitLines(a).then(function(a){void 0!=b.previousZoom&&b.enableLocation&&b.map.fire("mapChanged");void 0==b.previousZoom&&
"CAN"==b.state.ambito&&b.enableLocation&&b.map.fire("mapChanged")}).fail(function(a){console.log(a)}).always(function(a){});9<=d.getZoom()&&9!=b.showZoomLinea[d.getZoom()]&&this._showReadOnlyLayers("zonasAvisos")},_bindEventsLimitLines:function(){var a=this,b=this.map;b.on("cambioAmbito",function(b){void 0!=a.previousZoom&&Math.ceil(b.zoom)==this.getZoom()&&a._refreshLimitLines()});b.on("zoomstart",function(d){a.previousZoom=b.getZoom()});b.on("zoomend",function(b){a._refreshLimitLines(void 0==a.previousZoom?
a.state.location:void 0)});b.on("dragend",function(b){a._setLocation()&&a.enableLocation&&a.map.fire("mapChanged");a._showMapLayers()})},_setLocation:function(){if(!this.enableLocation)return!1;if(-1!=[4,5,6].indexOf(Math.floor(this.map.getZoom()))&&"CAN"!=this.state.ambito)return this.selectedLayer=void 0,this.getState().location=void 0,this.getState().locationName=void 0,!1;var a=!1,b=this._getSelectedLayer();void 0!=b&&this.selectedLayer!=b&&(this.selectedLayer=b,this.getState().location=b.feature.properties.location,
this.getState().locationName="id"in b.feature.properties?b.feature.properties.id:b.feature.properties.location,a=!0);return a},_putLocation:function(a){if(this.enableLocation)for(var b=0;b<this.limitLinesLayers.getLayers().length;b++){var d=this.limitLinesLayers.getLayers()[b];if(d.feature.properties.location==a){this.map.panTo(d.getBounds().getCenter());this.selectedLayer=d;break}}},_showMapLayers:function(){this.map.showBoundLayers(this.limitLinesLayers);this.limitLinesLayers&&this.limitLinesLayers.bringToBack();
this._showLayerSelected();for(layerId in this.roLayers)this.map.showBoundLayers(this.roLayers[layerId])},_getSelectedLayer:function(){if(void 0!=this.limitLinesLayers&&0!=this.limitLinesLayers.getLayers().length){var a=this.map.getCenter(),b=void 0,d=this.limitLinesLayers.getLayers().filter(function(a){return void 0!=a.feature.properties.location&&null!=a.feature.properties.location});console.log(this.limitLinesLayers);d.filter(function(b){return b.getBounds().contains(a)}).forEach(function(d){var e=
d.getBounds().getCenter();if(void 0==b||a.distanceTo(e)<a.distanceTo(b.getBounds().getCenter()))b=d});if(void 0==b){var e=1E7;d.forEach(function(d){var f=d.getBounds().getCenter();f=a.distanceTo(f);f<e&&(b=d,e=f)})}return b}},_showLayerSelected:function(){if(void 0!=this.limitLinesLayers){var a=this;this.limitLinesLayers.getLayers().forEach(function(b){b.setStyle(a.style)});void 0!=this.selectedLayer&&this.selectedLayer.setStyle({fillOpacity:a.style.fillOpacitySelected,fillColor:a.style.fillColorSelected,
weight:a.style.weightSelected})}},_getFitBoundsOpts:function(a){var b=null;if(6!=this.map.getZoom())return b;-1!=["ES11","ES21"].indexOf(a.properties.CODNUT2)&&(b={maxZoom:7});return b},_showReadOnlyLayers:function(a){var b=this,d=this.getState().ambito;this.service.getLimitLines({zoom:9,ambito:d,avisos:!0}).then(function(d){b._clearReadOnlyLayers();b.roLayers[a]=L.geoJSON(TopoJsonUtil.toGeojson(d[0]),{onEachFeature:function(a,d){d.setStyle(b.style)}});b.map.showBoundLayers(b.roLayers[a])})},_clearReadOnlyLayers:function(){for(key in this.roLayers)this.map.removeBoundLayers(this.roLayers[key])},
_setStyles:function(a){this.style=a}};var MapComponent=L.Class.extend({initialize:function(a,b,d,e){this.placeholderId=a;this.state=e||{};this.props=d||{};this.tileLayers={};this.changeStateActions=[];this.changeMapActions=[];this.changeAmbito=!1;var f=this;this.map=L.boundLayersMap(a,{attributionControl:!1,zoomControl:1!=f.props.removeZoom,zoomSnap:"zoomSnap"in f.props?f.props.zoomSnap:1,zoomDelta:"zoomDelta"in f.props?f.props.zoomDelta:1,doubleClickZoom:"doubleClickZoom"in f.props?f.props.doubleClickZoom:!0,scrollWheelZoom:"scrollWheelZoom"in
f.props?f.props.scrollWheelZoom:!1});b.forEach(function(a){f.tileLayers[a.getId()]=a});L.control.watermark({position:"bottomright"}).addTo(this.map);1!=f.props.removeZoom&&this.map.zoomControl.setPosition("bottomright");this.map.on("mapChanged",function(a){var b={zoom:f.getZoom()};a&&Object.keys(a).forEach(function(d){b[d]=a[d]});"location"in f.state&&(b.location=f.state.location,b.locationName=f.state.locationName);f.changeMapActions.forEach(function(a){a.fireAction(b)})});this.changeStateActions.push({fireAction:function(){var a=
f.state.ambito,b=f.tileLayers[a],d=f.state.zoom;0==f.props.draggable?(f.map.dragging.disable(),f.map.setMaxBounds(null)):d==b.getInitZoom()?(f.map.dragging.disable(),f.map.setView(f.tileLayers[a].getPuntoCentral(),b.getInitZoom())):f.map.dragging.enable()}})},getZoom:function(){return this.map.getZoom()},setState:function(a){var b=jQuery.isEmptyObject(this.state),d=a.ambito!=this.state.ambito;for(k in a)this.state[k]=a[k];d&&(b=this._setTileLayer(this.props.useStateZoom&&b?a.zoom:void 0),this.map.fire("cambioAmbito",
{location:a.location,zoom:b}));this.changeStateActions.forEach(function(b){b.fireAction(a)})},addChangeMapAction:function(a){this.changeMapActions.push(a)},getState:function(){return this.state},changeTiles:function(a){var b=this;a.forEach(function(a){b.tileLayers[a.getId()]=a});a=this.tileLayers[this.state.ambito].getInitZoom();this._setTileLayer(a)},getTileLayer:function(){return this.tileLayers[this.state.ambito]},_setTileLayer:function(a){for(id in this.tileLayers)this.tileLayers[id].getLayer().removeFrom(this.map);
var b=this.tileLayers[this.state.ambito];b.getLayer().addTo(this.map);a=void 0!=a?a:b.getInitZoom();this.map.setMaxBounds(b.getBounds());this.map.setView(b.getPuntoCentral(),a);return a},removeTiles:function(a){if(a)this.tileLayers[a].getLayer().removeFrom(this.map),this.tileLayers[a].setLayer(this.tileLayers[a].getLayer().options.id,{minZoom:this.tileLayers[a].getLayer().options.minZoom,maxZoom:this.tileLayers[a].getLayer().options.maxZoom}),this.tileLayers[a].getLayer().addTo(this.map);else for(id in this.tileLayers)this.tileLayers[id].getLayer().removeFrom(this.map)},
_setTileLayerZoom:function(a){for(id in this.tileLayers)this.tileLayers[id].getLayer().removeFrom(this.map);var b=this.tileLayers[this.state.ambito];b.getLayer().addTo(this.map);a=void 0!=a?a:b.getInitZoom();this.map.setMaxBounds(b.getBounds());return a},invalidateSize:function(a){this.map.invalidateSize()},changeTilesZoom:function(a,b){var d=this;a.forEach(function(a){d.tileLayers[a.getId()]=a});void 0==b&&(b=6);this._setTileLayerZoom(b)}}),AemetTileLayer=L.Class.extend({initialize:function(a,b,
d){this.id=a;this.puntoCentral=d.puntoCentral;this.bounds=d.bounds;this.initZoom=d.initZoom||d.minZoom;this.layer=L.tileLayer(null!=b?"/imagenes/tiles/{id}/{z}/{x}/{y}.png":"/imagenes/tiles/trans.png",{attribution:'<a href="https://www.aemet.es/">Aemet</a>',maxZoom:d.maxZoom,minZoom:d.minZoom,id:b,tms:!0})},getLayer:function(){return this.layer},getPuntoCentral:function(){return L.latLng(this.puntoCentral)},getInitZoom:function(){return this.initZoom},getId:function(){return this.id},getBounds:function(){return this.bounds},
setLayer:function(a,b){this.layer=L.tileLayer("",{attribution:'<a href="https://www.aemet.es/">Aemet</a>',maxZoom:b.maxZoom,minZoom:b.minZoom,id:a,tms:!0})}});L.Control.Watermark=L.Control.extend({onAdd:function(a){var b=L.DomUtil.create("img");a=$(a.getContainer()).width();b.src=280<a?"/imagenes/gif/aemet_mapa.gif":"/imagenes/gif/aemet.gif";return b},onRemove:function(a){}});L.control.watermark=function(a){return new L.Control.Watermark(a)};
L.getResolution=function(a){var b=$("#"+a).innerHeight(),d=500;300==$("#"+a).innerWidth()&&270==b?d=233:[0,250,500].forEach(function(a){a<=b&&(d=a)});return d};L.penBalTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.penBalOptions_720(),250:L.penBalOptions_480(),233:L.penBalOptions_420(),0:L.penBalOptions_360()};return new AemetTileLayer(a,b,e[d])};
L.canariasTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.canOptions_720(),250:L.canOptions_480(),233:L.canOptions_420(),0:L.canOptions_360()};return new AemetTileLayer(a,b,e[d])};L.penBalPaisesTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.penBalPaisesOptions_720(),250:L.penBalPaisesOptions_480(),233:L.penBalOptions_420(),0:L.penBalOptions_360()};return new AemetTileLayer(a,b,e[d])};
L.atlanticoNorteTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.atlanticoNorte_720(),250:L.atlanticoNorte_720(),233:L.atlanticoNorte_720(),0:L.atlanticoNorte_720()};return new AemetTileLayer(a,b,e[d])};
L.globalTileLayer=function(a,b){b={puntoCentral:[-.9447814006873896,-12.19482421875],bounds:L.latLngBounds([L.latLng(-85.56806584676865,-165.9375),L.latLng(-85.56806584676865,198.28125),L.latLng(84.9901001802348,198.28125),L.latLng(84.9901001802348,-165.9375),L.latLng(-85.56806584676865,-165.9375)]),initZoom:1.1,minZoom:1.1,maxZoom:4};return new AemetTileLayer(a,null,b)};
L.penBalOptions_720=function(){return{puntoCentral:[39.67072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(34.308447837809304,-11.77734375),L.latLng(34.308447837809304,5.44921875),L.latLng(45.440052841530544,5.44921875),L.latLng(45.440052841530544,-11.77734375),L.latLng(34.308447837809304,-11.77734375)]),initZoom:6,minZoom:6,maxZoom:9}};
L.penBalPaisesOptions_720=function(){return{puntoCentral:[39.67072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(31.56085936708384,-13.6669921875),L.latLng(31.56085936708384,6.943359375),L.latLng(46.649436163350245,6.943359375),L.latLng(46.649436163350245,-13.6669921875),L.latLng(31.56085936708384,-13.6669921875)]),initZoom:5.5,minZoom:5.5,maxZoom:9}};
L.atlanticoNorte_720=function(){return{puntoCentral:[46.195042108660154,-15.1171875],bounds:L.latLngBounds([L.latLng(18.024528139781815,26.011223359334075),L.latLng(61.999999999999986,26.011223359334075),L.latLng(61.999999999999986,-61.99999999999999),L.latLng(18.024528139781815,-61.99999999999999)]),initZoom:3.7,minZoom:3.7,maxZoom:6}};
L.penBalOptions_480=function(){return{puntoCentral:[39.85072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(34.488447837809304,-11.77734375),L.latLng(34.488447837809304,5.44921875),L.latLng(45.120052841530544,5.44921875),L.latLng(45.120052841530544,-11.77734375),L.latLng(34.488447837809304,-11.77734375)]),initZoom:5,minZoom:5,maxZoom:9}};
L.penBalPaisesOptions_480=function(){return{puntoCentral:[39.67072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(32.58384932565662,-12.568359375),L.latLng(32.58384932565662,6.943359375),L.latLng(45.9511496866914,6.943359375),L.latLng(45.9511496866914,-11.865234375),L.latLng(32.58384932565662,-12.568359375)]),initZoom:4.5,minZoom:4.5,maxZoom:9}};
L.penBalOptions_420=function(){return{puntoCentral:[39.85072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:4.8,minZoom:4,maxZoom:8}};
L.penBalOptions_360=function(){return{puntoCentral:[39.85072092501597,-2.7521240234375],bounds:L.latLngBounds([L.latLng(34.488447837809304,-11.77734375),L.latLng(34.488447837809304,5.44921875),L.latLng(45.120052841530544,5.44921875),L.latLng(45.120052841530544,-11.77734375),L.latLng(34.488447837809304,-11.77734375)]),initZoom:4.4,minZoom:4,maxZoom:5}};
L.canOptions_720=function(){return{puntoCentral:[28.623103554529894,-15.745654296875],bounds:L.latLngBounds([L.latLng(26.581523191705053,-19.09111328125),L.latLng(26.581523191705053,-11.88720703125),L.latLng(29.649868677972304,-11.88720703125),L.latLng(29.649868677972304,-19.09111328125),L.latLng(26.581523191705053,-19.09111328125)]),initZoom:7,minZoom:7,maxZoom:10}};
L.canOptions_480=function(){return{puntoCentral:[28.623103554529894,-15.745654296875],bounds:L.latLngBounds([L.latLng(26.581523191705053,-19.09111328125),L.latLng(26.581523191705053,-11.88720703125),L.latLng(29.649868677972304,-11.88720703125),L.latLng(29.649868677972304,-19.09111328125),L.latLng(26.581523191705053,-19.09111328125)]),initZoom:6.8,minZoom:6,maxZoom:9}};
L.canOptions_420=function(){return{puntoCentral:[28.623103554529894,-15.745654296875],bounds:L.latLngBounds([L.latLng(26.581523191705053,-19.09111328125),L.latLng(26.581523191705053,-11.88720703125),L.latLng(29.649868677972304,-11.88720703125),L.latLng(29.649868677972304,-19.09111328125),L.latLng(26.581523191705053,-19.09111328125)]),initZoom:6,minZoom:5,maxZoom:6}};
L.canOptions_360=function(){return{puntoCentral:[28.623103554529894,-15.745654296875],bounds:L.latLngBounds([L.latLng(26.581523191705053,-19.09111328125),L.latLng(26.581523191705053,-11.88720703125),L.latLng(29.649868677972304,-11.88720703125),L.latLng(29.649868677972304,-19.09111328125),L.latLng(26.581523191705053,-19.09111328125)]),initZoom:6,minZoom:5,maxZoom:6}};
L.ceutaTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.ceuOptions_720(),250:L.ceuOptions_480(),233:L.ceuOptions_420(),0:L.ceuOptions_360()};return new AemetTileLayer(a,b,e[d])};L.melillaTileLayer=function(a,b,d){d=L.getResolution(d);var e={500:L.melOptions_720(),250:L.melOptions_480(),233:L.melOptions_420(),0:L.melOptions_360()};return new AemetTileLayer(a,b,e[d])};
L.ceuOptions_720=function(){return{puntoCentral:[35.88891100714106,-5.3043365478515625],bounds:L.latLngBounds([L.latLng(34.308447837809304,-11.77734375),L.latLng(34.308447837809304,5.44921875),L.latLng(45.440052841530544,5.44921875),L.latLng(45.440052841530544,-11.77734375),L.latLng(34.308447837809304,-11.77734375)]),initZoom:10,minZoom:8,maxZoom:10}};
L.ceuOptions_480=function(){return{puntoCentral:[35.88891100714106,-5.3043365478515625],bounds:L.latLngBounds([L.latLng(34.488447837809304,-11.77734375),L.latLng(34.488447837809304,5.44921875),L.latLng(45.120052841530544,5.44921875),L.latLng(45.120052841530544,-11.77734375),L.latLng(34.488447837809304,-11.77734375)]),initZoom:8,minZoom:8,maxZoom:10}};
L.ceuOptions_420=function(){return{puntoCentral:[35.88891100714106,-5.3043365478515625],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:8,minZoom:8,maxZoom:10}};
L.ceuOptions_360=function(){return{puntoCentral:[35.88891100714106,-5.3043365478515625],bounds:L.latLngBounds([L.latLng(34.488447837809304,-11.77734375),L.latLng(34.488447837809304,5.44921875),L.latLng(45.120052841530544,5.44921875),L.latLng(45.120052841530544,-11.77734375),L.latLng(34.488447837809304,-11.77734375)]),initZoom:8,minZoom:8,maxZoom:10}};
L.melOptions_720=function(){return{puntoCentral:[35.29172959830692,-2.940387725830078],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:10,minZoom:8,maxZoom:10}};
L.melOptions_480=function(){return{puntoCentral:[35.29172959830692,-2.940387725830078],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:8,minZoom:8,maxZoom:10}};
L.melOptions_420=function(){return{puntoCentral:[35.29172959830692,-2.940387725830078],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:8,minZoom:8,maxZoom:10}};
L.melOptions_360=function(){return{puntoCentral:[35.29172959830692,-2.940387725830078],bounds:L.latLngBounds([L.latLng(34.488447837809304,-4.57734375),L.latLng(34.488447837809304,-.24921875),L.latLng(44.92005284153054,-.24921875),L.latLng(44.92005284153054,-4.57734375),L.latLng(34.488447837809304,-4.57734375)]),initZoom:8,minZoom:8,maxZoom:10}};var ShowModelosNumericos={modeloBounds:{PB:[[35.99578538642032,-9.60205078125],[35.99578538642032,4.37255859375],[43.8028187190472,4.37255859375],[43.8028187190472,-9.60205078125],[26.393734605170323]],CAN:[[26.43122806450644,-18.69873046875],[26.43122806450644,-12.1728515625],[30.240086360983426,-12.1728515625],[30.240086360983426,-18.69873046875],[26.43122806450644,-18.69873046875]]},addModelosNumericosLayer:function(a,b){var d=this;this.modeloImage=void 0;this.modeloService=a;this.modeloLayers=
void 0;this.modeloUnidades=b.unidades||{1:"hPa",156:"m",151:"hPa"};this.modeloState={};this.changeStateActions.push({fireAction:function(a){d._checkCambioModelo(a)&&d._showModelosLayer(a)}});return this},_checkCambioModelo:function(a){var b=!1,d=this;["fichero","param","ambito"].forEach(function(e){d.modeloState[e]!=a[e]&&(d.modeloState[e]=a[e],b=!0,"param"==e&&d._clearLayers())});return b},_showModelosLayer:function(a){var b=this,d=a.param.split("|"),e=a.fichero.split("|");d.forEach(function(d,g){var f=
Object.create(a);f.param=d;f.fichero=e[g];-1!="1 33 131 151 156 165".split(" ").indexOf(d)?b._showGeoJson(f):b._showImageLayer(f)})},_clearLayers:function(){this._clearImageLayer();this._clearModeloLayer()},_clearImageLayer:function(){void 0!=this.modeloImage&&(this.map.removeLayer(this.modeloImage),this.modeloImage=void 0)},_clearModeloLayer:function(){void 0!=this.modeloLayers&&(this.map.removeLayer(this.modeloLayers),this.modeloLayers=void 0)},_showImageLayer:function(a){var b=this;this.modeloService.getImagenBounds(a).then(function(d){d=
L.GeoJSON.coordsToLatLngs(d[0]);b._setModeloImagen(a,d)}).fail(function(a){console.log("Error al cargar la capa "+a)}).always(function(a){})},_showGeoJson:function(a){var b=this.map,d=this;this.modeloService.getModeloNumerico(a).then(function(e){d._clearModeloLayer();d.modeloLayers=L.geoJSON(e[0],ModelosOptionsFactory.getCreatorOptions(a).createOptions(b,d,a));d.modeloLayers.addTo(b)})},_setModeloImagen:function(a,b){a="ATN"==a.ambito?"/es/api-eltiempo/modelo-ceepm/imagen-modelo/{{param}}/{{ambito}}/{{fichero}}".replace("{{param}}",
a.param).replace("{{ambito}}",a.ambito).replace("{{fichero}}",a.fichero):"/es/api-eltiempo/modelo-harmonie/imagen-modelo/{{param}}/{{ambito}}/{{fichero}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito).replace("{{fichero}}",a.fichero);void 0==this.modeloImage?(this.modeloImage=L.imageOverlay(a,b).addTo(this.map),this.modeloImage.setOpacity(.7)):(this.modeloImage.setUrl(a),this.modeloImage.setBounds(b))}},ModelosOptionsFactory=function(){return{getCreatorOptions:function(a){switch(a.param){case "1":case "151":case "156":a=
GeopotencialOptions;break;case "33":a=DireccionVientoOptions;break;default:a=DireccionVientoOptions}return a}}}(),GeopotencialOptions=function(){return{createOptions:function(a,b,d){return{style:function(a){return{color:"#03399c",weight:"1"}},onEachFeature:function(e,f){var g=b.modeloUnidades[d.param]||"",h="<div style='border:1px solid #033399c;font-size:10px;color:#03399c;font-weight:bold'><span>{{valor}} {{unidades}}</span></div>".replace("{{valor}}",(e.properties.pres_Pa+"").substring(0,4)).replace("{{unidades}}",
g);L.Browser.mobile?f.bindTooltip(h):(f.on("mouseover",function(d){this.setStyle({weight:"3"});b.tooltip=L.tooltip({direction:"top",opacity:.85,permanent:!1}).setContent(h).setLatLng(d.latlng).addTo(a)}),f.on("mouseout",function(){a.closeTooltip(b.tooltip);this.setStyle({weight:"1"})}))}}}}}(),DireccionVientoOptions=function(){return{createOptions:function(){return{pointToLayer:function(a,b){a=L.divIcon({className:"marker-dir-viento",html:"<div><img height='10' width='10' src='/imagenes/svg/ico-dirviento.svg' style='transform: rotateZ("+
a.properties.ang_viento+"deg )'/></div>",iconSize:[16,16]});return L.marker(b,{icon:a})}}}}}();var ShowNames={service:null,addNames:function(a,b){this._namesService=a;this._namesOptions=b||{};this._bindEventsNames();return this},_showNames:function(){var a=this,b=a.map;if(void 0!=this.getState()){b.removeBoundLayers(this.namesLayers);var d=b.getZoom();this.getState();5>=d||this._namesService.getMunicipios({zoom:d},this._namesOptions.tipo).then(function(e){b.removeBoundLayers(a.namesLayers);a.namesLayers=L.geoJSON(e[0],GeoJsonOpts.create({param:"CAPITAL",zoom:d},null,a._namesOptions));b.addPointLayer(a.namesLayers)}).fail(function(a){}).always(function(a){})}},
_clearNames:function(){this.namesLayers&&this.map.removeBoundLayers(this.namesLayers)},_bindEventsNames:function(){var a=this,b=this.map;b.on("zoomend",function(b){a._showNames()});b.on("moveend",function(b){this.showPointLayers(a.namesLayers)})}};var ShowRadar={radarBounds:[[33.21999999999998,7.139999999999998],[46.29999999999997,7.139999999999998],[46.29999999999997,-11.079999999999998],[33.21999999999998,-11.079999999999998]],addRadarLayer:function(a,b,d){var e=this;this.radares={};a&&a.forEach(function(a){e.radares[a.codigo]=a});this.service=b;this.datosLeyenda=[];this.radarImage=void 0;this.radarOptions=d;this.cambioAmbitoRadar=void 0;this._radarFinishSetup=!1;this.changeStateActions.push({fireAction:function(a,b){e._checkCambioRadar(a)&&
e._showRadarLayer(a);"move"in a&&1==a.move&&(delete a.move,e._moveToRadar(a))}});this._bindEventsRadar();return this},setLegendData:function(a){this.datosLeyenda=a},_getLeyendColor:function(a){a=a.split(",");var b=[];b[0]=parseInt($.trim(a[0].substring(5)));b[1]=parseInt($.trim(a[1]));b[2]=parseInt($.trim(a[2]));b[3]=parseInt($.trim(a[3].substring(0,a[3].length-1)));a=this.datosLeyenda.filter(function(a){return 10>Math.abs(b[0]-parseInt(a.RGBA[0]))&&10>Math.abs(b[1]-parseInt(a.RGBA[1]))&&10>Math.abs(b[2]-
parseInt(a.RGBA[2]))});var d=void 0;0<a.length&&(d=a[0]);return d},_checkCambioRadar:function(a){return!0},_moveToRadar:function(a,b){a=a.radar;var d=this.map.getCenter(),e=this.getTileLayer().getInitZoom();void 0!=a&&"LPA"!=a&&(d=this.radares[a].coordinates,e=6.5);if(this.cambioAmbitoRadar){this.cambioAmbitoRadar=!1;var f=this;setTimeout(function(){f.map.setView(d,e)},300)}else this.map.setView(d,e)},_clearRadarLayer:function(){void 0!=this.radarImage&&(this.map.removeLayer(this.radarImage),this.radarImage=
void 0)},_showRadarLayer:function(a){var b=this,d="/es/api-eltiempo/radar/imagen-radar/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);this.service.getRadarBounds(a).then(function(a){a=L.GeoJSON.coordsToLatLngs(a[0]);if(void 0==b.radarImage){var e=b.map;b.radarImage=L.imageCanvasOverlay(d,a,{interactive:!0,zIndex:1E4}).addTo(e);if(void 0!=b.radarOptions&&"showPopup"in b.radarOptions&&1==b.radarOptions.showPopup)b.radarImage.on("mousemove",function(a){e.closeTooltip(b.tooltipRadar);
var d=this.getPixelColor(a.latlng),f=b._getLeyendColor(d);if(f){var g="",n=$(".leyenda-titulo");n&&(g=/.*\((.*)\).*/g.exec(n.html())[1]);d='<ul><li class="ley-el-color"><div style="background-color:{{color}}">&nbsp;</div><div class="ley-el-dato">{{rango}} {{medida}}</div></li></ul>'.replace("{{color}}",d).replace("{{rango}}",f.Valores.join(" - ")).replace("{{medida}}",g);b.tooltipRadar=L.tooltip({direction:"top",opacity:.85,permanent:!1}).setContent(d).setLatLng(a.latlng).addTo(e)}})}else b.radarImage.setBounds(a),
b.radarImage.setUrl(d);b.radarImage.setOpacity(1)}).fail(function(a){console.log("Error al cargar la capa "+a)}).always(function(a){})},_bindEventsRadar:function(){var a=this.map,b=this;a.on("dragend",function(a){b._fireChanged()});a.on("cambioAmbito",function(a){1!=b.state.move?b._setUp():(b._clearRadarLayer(),b.cambioAmbitoRadar=!0)});a.on("zoomend",function(a){b._radarFinishSetup&&(setTimeout(function(){b._fireChanged()},100),7<this.getZoom()&&"CAN"==b.state.ambito?b.map.dragging.enable():7==this.getZoom()&&
"CAN"==b.state.ambito&&b.map.dragging.disable())})},_fireChanged:function(){var a=this.map,b=6>=a.getZoom()?void 0:this._getRadarMasProx().codigo,d=!("radar"in this.state)||b!=this.state.radar;this.state.radar=b;d&&a.fire("mapChanged",{radar:b})},_setUp:function(){var a=this.state;this._clearRadarLayer();this._showRadarLayer(a);this._moveToRadar(a);this._radarFinishSetup=!0},_getRadarMasProx:function(){var a=1E7,b=void 0,d=this.radares,e=this.map.getCenter();Object.keys(d).forEach(function(f){f=d[f];
var g=e.distanceTo(f.coordinates);g<a&&(b=f,a=g)});return b},_getRadarSeleccionado:function(a){var b=void 0,d=this.radares;Object.keys(d).forEach(function(e){e=d[e];e.codigo==a.radar&&(b=e)});return b}};var MapUtil=function(){return{getLocation:function(a,b,d){if("CAN"==d)return 65;for(var e=d=void 0,f=0;f<a.getLayers().length;f++){var g=a.getLayers()[f];if(g.getBounds().contains(b)){var h=g.getBounds().getCenter();if(void 0==e||b.distanceTo(h)<b.distanceTo(e.getBounds().getCenter()))e=g}}e&&(d=this.getCodLocation(e.feature.properties.CODNUT2));return d},getCodLocation:function(a){var b=0;if(void 0==a)return b;switch(a.substring(2)){case "61":b=61;break;case "24":b=62;break;case "12":b=63;break;
case "53":b=64;break;case "13":b=66;break;case "41":b=67;break;case "42":b=68;break;case "51":b=69;break;case "11":b=71;break;case "30":b=72;break;case "62":b=73;break;case "22":b=74;break;case "21":b=75;break;case "23":b=76;break;case "52":b=77;break;case "63":b=78;break;case "64":b=79;break;case "43":b=70;break;case "70":b=65;break;case "211":b=7501;break;case "421":b=6802;break;case "521":b=7703;break;case "611":b=6104;break;case "411":b=6705;break;case "431":b=7006;break;case "532":b=6454;break;
case "511":b=6908;break;case "412":b=6709;break;case "432":b=7010;break;case "612":b=6111;break;case "522":b=7712;break;case "422":b=6813;break;case "613":b=6114;break;case "111":b=7115;break;case "423":b=6816;break;case "512":b=6917;break;case "614":b=6118;break;case "424":b=6819;break;case "212":b=7520;break;case "615":b=6121;break;case "241":b=6222;break;case "616":b=6123;break;case "413":b=6724;break;case "513":b=6925;break;case "230":b=7626;break;case "112":b=7127;break;case "300":b=7228;break;
case "617":b=6129;break;case "620":b=7330;break;case "220":b=7431;break;case "113":b=7132;break;case "120":b=6333;break;case "414":b=6734;break;case "114":b=7136;break;case "415":b=6737;break;case "130":b=6639;break;case "416":b=6740;break;case "618":b=6141;break;case "417":b=6742;break;case "514":b=6943;break;case "242":b=6244;break;case "425":b=6845;break;case "523":b=7746;break;case "418":b=6747;break;case "213":b=7548;break;case "419":b=6749;break;case "243":b=6250;break;case "630":b=7851;break;
case "640":b=7952;break;case "709":b=6596;break;case "705":b=6590}return b}}}(),TopoJsonUtil=function(){return{toGeojson:function(a){var b,d;if("Topology"==a.type)for(d in a.objects)a.objects.hasOwnProperty(d)&&(b=topojson.feature(a,a.objects[d]));return b}}}(),GeoJsonOpts=function(){return{create:function(a,b,d){return{filter:function(a){return!0},pointToLayer:function(e,f){return VariablesMarkerFactory.createMarker(e,f,a,b,d)}}}}}();var ShowVariables={addVariablesLayer:function(a,b,d){var e=this;this.locale=b;this._varService=a;this.options=d;this.changeStateActions.push({fireAction:function(a){e._showVariableLayers(a)}});this._bindEventsVariables();return this},_showVariableLayers:function(a){var b=this,d=this.map;this._varService.getVariables(a).then(function(e){d.removeBoundLayers(b.variableGroupLayers);b.variableGroupLayers=L.geoJSON(e[0],GeoJsonOpts.create(a,b.locale,b.options));d.addPointLayer(b.variableGroupLayers)}).fail(function(a){console.log(a)})},
_bindEventsVariables:function(){var a=this.map,b=this;a.on("moveend",function(d){a.showPointLayers(b.variableGroupLayers)});a.on("zoomstart",function(d){a.removeBoundLayers(b.variableGroupLayers)})}};var VariablesMarkerFactory=function(){return{createMarker:function(a,b,d,e,f){var g=DefaultMarkerOptions,h=void 0;switch(d.param){case "eCielo":g=MarkerCieloOptions;h=MarkerPopupCielo;break;case "caNieve":case "coNieve":case "cPrecp":case "probNv":case "probPr":case "probTo":case "rMaxim":g=TextMarkerOptions;h=TextMarkerPopup;break;case "Tempta":case "humRel":case "senTem":g=MaxMinTextMarkerOptions;h=MaxMinTextMarkerPopup;break;case "diVien":g=DirVientoMarkerOptions;h=DirVientoMarkerPopup;break;case "CAPITAL":g=
MunicipiosMarkerOptions}var l=void 0;g=g.getOptions(a,d,f);null!=g&&(l=L.marker(b,g),void 0!=f&&"showPopups"in f&&1==f.showPopups&&void 0!=h&&l.bindTooltip(h.getHtml(a,d,e),{className:"tooltip-map-variables"}).openTooltip());return l}}}(),DefaultMarkerOptions={getOptions:function(a,b){return{icon:L.icon({iconUrl:"https://image.flaticon.com/icons/svg/979/979534.svg",iconSize:L.point(32,32)}),interactive:!1}}},MarkerCieloOptions={getOptions:function(a,b,d){var e=void 0!=d&&d.interactive;d=void 0!=d&&
"iconSize"in d?d.iconSize:32;return{icon:L.icon({iconUrl:"/imagenes/png/estado_cielo/"+a.properties[b.param]+".png",iconSize:L.point(d,d)}),interactive:e}}},TextMarkerOptions={getOptions:function(a,b){if(!$.trim(a.properties[b.param]))return null;a="<div class='marker-text marker-type-{{type}}'><span>{{valor}}</span></div>".replace("{{type}}",b.param).replace("{{valor}}",a.properties[b.param]);return{icon:L.divIcon({className:"marker-text",html:a}),interactive:!0}}},MunicipiosMarkerOptions={getOptions:function(a,
b,d){var e="",f="icono";1==d.showLocationImage&&(e+="<span><img  class='marker-muncipio-punto-localizacion' src='/imagenes/svg/ico-location.svg'/></span>",f="sin-icono");e+="<div class='marker-text marker-municipio-{{clase-despl}}  marker-municipio-size-{{size}}'><span>{{nombre}}</span></div>".replace("{{size}}",a.properties.size).replace("{{clase-despl}}",f).replace("{{nombre}}",a.properties[b.param]);return{icon:L.divIcon({className:"marker-text",html:e,iconSize:null}),interactive:!1}}},MaxMinTextMarkerOptions=
{getOptions:function(a,b){var d="<div class='marker-text'>",e=[-12,-6,0,6,12,18,24,30,38];[b.param+"_min",b.param+"_MAX",b.param].forEach(function(b){if(b in a.properties){for(var f=parseInt(a.properties[b]),h=0,l=0;l<e.length;l++)if(e[l]>f){h=l;break}d+="<span class='marker-type-{{type}} {{type}}_rango_{{rango}}'>{{value}}</span>".replace(/\{\{type\}\}/g,b).replace("{{value}}",f).replace("{{rango}}",h+1)}});d+="</div>";return{icon:L.divIcon({className:"marker-text",html:d}),interactive:!0}}},DirVientoMarkerOptions=
{getOptions:function(a,b){b=a.properties.diVien;a=a.properties.viVien;var d=90>parseInt(a)?4-parseInt(a/30):1;b='<div class="marker-text icono_viento"><div class="imagen_viento_marker viento_escala_{{escala}}"><div class="imagen_direccion_viento imagen_{{direccion}}"></div><div class="texto_km_viento"><div>{{velocidad}}</div></div></div></div>'.replace("{{escala}}",d).replace(/\{\{direccion\}\}/g,b).replace("{{velocidad}}",a);return{icon:L.divIcon({className:"marker-text",html:b}),interactive:!0}}};
function MarkerPopup(a){this.varPrinter=a}MarkerPopup.prototype.getHtml=function(a,b,d){return"<div class='marker-tooltip marker-tooltip-variable'><div class='marker-tooltip-muncipio'>{{municipio}}</div><div class='marker-tooltip-descripcion'>{{descripcion}}</div></div>".replace("{{municipio}}",a.properties.Municipio).replace("{{descripcion}}",this.varPrinter.printHtml(a,b,d))};
var MarkerPopupCielo=new MarkerPopup({printHtml:function(a,b,d){a="imagenes.{{key}}.alt".replace("{{key}}",a.properties[b.param]);return d[a]}}),TextMarkerPopup=new MarkerPopup({printHtml:function(a,b){return a.properties[b.param]+" "+{caNieve:"mm",coNieve:"m",cPrecp:"mm",probNv:"%",probPr:"%",probTo:"%",rMaxim:"km/h"}[b.param]}}),MaxMinTextMarkerPopup=new MarkerPopup({printHtml:function(a,b){var d={Tempta:"&deg;C",humRel:"%",senTem:"&deg;C"},e="",f=b.param+"_min";[f,b.param+"_MAX",b.param].forEach(function(g){g in
a.properties&&(e+="<span>{{value}} {{medida}}</span>{{sep}}".replace("{{value}}",a.properties[g]).replace("{{medida}}",d[b.param]).replace("{{sep}}",g==f?"<span>/</span>":""))});return e}}),DirVientoMarkerPopup=new MarkerPopup({printHtml:function(a,b,d){b=a.properties.viVien;return"{{dir}}. {{vel}} km/h".replace("{{dir}}",d["localidades.literal.viento."+a.properties.diVien]).replace("{{vel}}",b)}});function DateLineModelos(){this.state={};this.create=function(a,b,d,e,f,g,h){this.service=e;this.idParametros=a;this.idNiveles=b;this.idFechas=d;this.action=f;this.datos={};this.lang=g||{};this.locale=h||"es";this.paramRenderer=DateLineModelosParamRenderer;this.periodRenderer=DateLineModelosPeriodRenderer;return this};this.setState=function(a,b){this.state={};for(k in a)this.state[k]=a[k];void 0!=b&&1!=b||this._setSelectionPeriod(this.isRunningAnimate())};this.initialize=function(a,b){var d=this;
this.setState(a,!1);this.datos.params=b;var e=jQuery.Deferred();this.service.getTimeline(a).then(function(b){d._setData(b[0],a);d._refreshUI();e.resolve(d.state)}).fail(function(a){console.log("error al inicializar")});return e.promise()};this._setData=function(a,b){this._adapt(a);this._setFirstElement(b)};this._adapt=function(a){var b=[];a[0].forEach(function(d,e){for(var f=d[1],g=1;g<a.length;g++)f+="|"+a[g][e][1];b.push({fecha:d[0],fichero:f})});b.sort(function(a,b){return new Date(a.fecha)-new Date(b.fecha)});
this.datos.lineaTiempo=b};this._setFirstElement=function(a){var b=void 0;if(void 0!=a.fecha){var d=this.datos.lineaTiempo.filter(function(b){return a.fecha==b.fecha});0<d.length&&(b=d[0])}void 0==b&&(b=this.datos.lineaTiempo[0]);this.state.fichero=b.fichero;this.state.fecha=b.fecha};this._refreshUI=function(){this._refreshUIParams();this._refreshUIPeriodos()};this._refreshUIParams=function(){this._renderParametros();this._setSelectionParam();this._bindEventParams()};this._refreshUIPeriodos=function(){this._renderPeriodos();
this._setSelectionPeriod(!0);this._bindEventPeriod();this._applyStyles()};this._renderParametros=function(){$(this.idParametros).empty();$(this.idParametros).append(this._getParamRenderer().renderParametros(this.datos.params,this.lang))};this._renderPeriodos=function(){var a=this.datos.lineaTiempo;$(this.idFechas).empty();$(this.idFechas).append(this.periodRenderer.renderPeriodos(a,this.locale))};this._setSelectionParam=function(){this._getParamRenderer().setSelectionParam(this.idParametros,this.state,
this.idNiveles,this.lang)};this._setSelectionPeriod=function(a){this.periodRenderer.setSelectionPeriod(this.idFechas,this.state,a)};this._bindEventParams=function(){this._getParamRenderer().bindParametrosEvents(this.idParametros,this.action,this.idNiveles)};this._bindEventPeriod=function(){this.periodRenderer.bindPeriodosEvents(this.idFechas,this.action)};this._getParamRenderer=function(){return 992<=$(window).width()?DateLineModelosParamRenderer:DateLineModelosParamMobileRenderer};this._applyStyles=
function(){var a={1:"100%",2:"49.91%",3:"33.1111%",4:"25%",5:"20%",6:"16.6667%"};$(".tl-lista-horas").each(function(){var b=$(this).find("ul");$(b).each(function(){var b=$(this).find("li"),e=b.length;$(b).css("width",e in a?a[e]:"47px")})})}}
var DateLineModelosParamRenderer={renderParams:{},rendererNiveles:DateLineModelosNivelesRenderer,renderParametros:function(a,b){var d='<div class="timeline-dias"><ul class="lista-variables" id="lista-variables">',e=this;a.forEach(function(a){e.renderParams[a.codigo]=a;"codigoRel"in a||(d+='<li data-tl-codigo="{{codigo}}"><span>{{nombre}}</span></li>'.replace("{{codigo}}",a.codigo).replace("{{nombre}}",b[a.nombre]))});return d+="</ul></div>"},setSelectionParam:function(a,b,d,e){$(a).find("[data-tl-codigo]").each(function(a){$(this).removeClass("tl-selected")});
var f=b.param;"codigoRel"in this.renderParams[f]&&(f=this.renderParams[f].codigoRel);var g="[data-tl-codigo={{codigo}}]".replace("{{codigo}}",f).replace(/\|/gi,"\\$&");$(a).find(g).addClass("tl-selected");$(d).empty();"niveles"in this.renderParams[f]&&(a=this.renderParams[f].niveles,$(d).append(DateLineModelosNivelesRenderer.renderParametros(a,e)),DateLineModelosNivelesRenderer.setSelectionParam(d,b))},bindParametrosEvents:function(a,b,d){$(a).find("[data-tl-codigo]").on("click",function(){var a=
$(this).attr("data-tl-codigo");b.fireAction({param:a})});DateLineModelosNivelesRenderer.bindParametrosEvents(d,b)}},DateLineModelosParamMobileRenderer={renderParams:{},rendererNiveles:DateLineModelosNivelesRenderer,renderParametros:function(a,b){var d='<div class="timeline-dias"><select class="tl-param-prediccion select-dia">',e=this;a.forEach(function(a){e.renderParams[a.codigo]=a;"codigoRel"in a||(d+='<option value="{{codigo}}"><span>{{nombre}}</span></option>'.replace("{{codigo}}",a.codigo).replace("{{nombre}}",
b[a.nombre]))});return d+="</select></div>"},setSelectionParam:function(a,b,d,e){$(d).empty();var f=b.param;"codigoRel"in this.renderParams[f]&&(f=this.renderParams[f].codigoRel);$(a).find("select").val(f);"niveles"in this.renderParams[f]&&(a=this.renderParams[f].niveles,$(d).append(DateLineModelosNivelesRenderer.renderParametros(a,e)),DateLineModelosNivelesRenderer.setSelectionParam(d,b))},bindParametrosEvents:function(a,b,d){$(a).find("select").selectmenu({width:"auto"}).on("selectmenuchange",function(){b.fireAction({param:$(this).val()})});
DateLineModelosNivelesRenderer.bindParametrosEvents(d,b)}},DateLineModelosNivelesRenderer={renderParametros:function(a,b){var d='<div class="timeline-dias paddingtop10px"><ul class="lista-variables" id="lista-niveles">';a.forEach(function(a){d+='<li data-tl-nivel="{{nivel}}" data-tl-codigo="{{param}}"><span>{{nombre}}</span></li>'.replace("{{nombre}}",b[a.nombre]).replace("{{nivel}}",a.nivel).replace("{{param}}",a.codigo)});return d+="</ul></div>"},setSelectionParam:function(a,b){b=void 0!=b.nivel?
b.nivel:"''";$(a).find("[data-tl-nivel]").removeClass("tl-selected");b="[data-tl-nivel={{nivel}}]".replace("{{nivel}}",b).replace(/\|/gi,"\\$&").replace(" ","\\ ");$(a).find(b).addClass("tl-selected")},bindParametrosEvents:function(a,b){$(a).find("[data-tl-nivel]").on("click",function(){var a=$(this).attr("data-tl-nivel"),e=$(this).attr("data-tl-codigo");b.fireAction({nivel:a,param:e})})}},DateLineModelosPeriodRenderer={renderPeriodos:function(a,b){var d='<div class="nav atras">&lt;</div><div class="tl-main-horas">',
e=-1;a.forEach(function(a){var f=new Date(a.fecha),h={weekday:"long",day:"numeric"};e!=f.getDate()&&(h=f.toLocaleDateString(b,h),d+=-1!=e?"</ul></div>":"",d+='<div class="tl-lista-horas"><div class="tl-dia">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",h),e=f.getDate());d+='<li><span data-tl-fecha="{{fecha}}" data-tl-fichero="{{fichero}}">{{mensaje}}</span></li>'.replace("{{fecha}}",a.fecha).replace("{{fichero}}",a.fichero).replace("{{mensaje}}",a.fecha.substring(11,16))});d+=-1!=e?"</ul></div>":
"";d+="</div>";return d+='<div class="nav adelante">&gt;</div>'},setSelectionPeriod:function(a,b,d){$(a).find("[data-tl-fecha]").removeClass("tl-selected");b=b.fecha.replace(/[:+]/g,"\\$&");$(a).find("[data-tl-fecha="+b+"]").addClass("tl-selected");d&&(a=$(a).find("[data-tl-fecha="+b+"]"))&&0<a.length&&$(".tl-main-horas").animate({scrollLeft:$(a[0]).position().left},50)},bindPeriodosEvents:function(a,b){$(a).find("[data-tl-fichero]").on("click",function(){var a=$(this).attr("data-tl-fichero"),e=$(this).attr("data-tl-fecha");
b.fireAction({fichero:a,fecha:e})});$(a).find(".nav.atras").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"-=500"})});$(a).find(".nav.adelante").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"+=500"})})}};
function AnimateModelos(){this.create=function(a,b,d){this.idBoton=a;this.animacion=(new Animacion).create(b);this.speed=d&&d.speed||500;return this};this.startAnimate=function(){this.animacion.start(this.datos.lineaTiempo,this.state.fecha);$(this.idBoton).trigger("animatestart")};this.stopAnimate=function(){this.isRunningAnimate()&&(this.animacion.stop(),$(this.idBoton).trigger("animatestop"))};this.upSpeed=function(){return this.animacion.aumentar()};this.downSpeed=function(){return this.animacion.bajar()};
this.nextSpeed=function(){return this.animacion.siguiente()};this.isRunningAnimate=function(){return this.animacion.isRunning()}};function AnimacionGeoJson(){this.speeds=[{speed:1E3,name:"0.5x"},{speed:500,name:"1x"},{speed:250,name:"2x"},{speed:133,name:"3x"}];this.create=function(a,b){this.action=a;this.functionality=b;this.timer=void 0;this.speed=500;this.lastElement=void 0;this.lista=[];this.id="#pestanas-horas";this.idDias="#pestanas-dias";this.renderer=RendererTimeLine.getRenderer(b);return this};this.start=function(a,b){var d=this;if(1!=this.state){b=this.speed;var e=0;this.lista=a;this.timer="avisos"!=this.functionality?
setInterval(function(b){b=a[e++%a.length];b={fecha:b.F_ini,intervalo:b.interval_utc,dia:b.dia,resumen:!1};d.action.fireAction(b);d._setSelection(b,!0);d.lastElement=b},b):setInterval(function(b){b=a[e++%a.length];b={fecha:b,resumen:!1};d.action.fireAction(b);d._setSelection(b,!0);d.lastElement=b},b)}};this._setSelection=function(a,b){this._setSelectionHora(a,b);this._setSelectionDia(a)};this._setSelectionHora=function(a,b){return this.renderer.setSelectionHora(this.id,a,b)};this._setSelectionDia=
function(a){return this.renderer.setSelectionDia(this.idDias,a)};this.aumentar=function(){var a=this._getSpeedUp()();this._modifySpeed(a);return a};this.siguiente=function(){var a=this._getSpeedNext();this._modifySpeed(a);return a};this.bajar=function(){var a=this._getSpeedDown();this._modifySpeed(a);return a};this.stop=function(){clearInterval(this.timer);this.timer=void 0};this.isRunning=function(){return void 0!=this.timer};this._modifySpeed=function(a){this.speed=a.speed;this.isRunning()&&(this.stop(),
this.start(this.lista,this.lastElement.fecha));return a};this._getCurrentSpeedIndex=function(){var a=this.speed,b=this.speeds.filter(function(b){return b.speed==a});return 0<b.length?this.speeds.indexOf(b[0]):2};this._getSpeedUp=function(){var a=this._getCurrentSpeedIndex(),b=this.speeds[a];0<a&&(b=this.speeds[--a]);return b};this._getSpeedDown=function(){var a=this._getCurrentSpeedIndex(),b=this.speeds[a];a<this.speeds.length-1&&(b=this.speeds[++a]);return b};this._getSpeedNext=function(){var a=
this._getCurrentSpeedIndex();return this.speeds[++a%this.speeds.length]}};function AnimatePrediccion(){this.create=function(a,b,d){this.idBoton=a;this.functionality=d;this.animacion=(new AnimacionGeoJson).create(b,d);this.speed=500;return this};this.startAnimate=function(){"avisos"!=this.functionality?this.animacion.start(this.datos.linea_principal,this.state):this.animacion.start(this.datos.horarios_penbal,this.state);$(this.idBoton).trigger("animatestart")};this.stopAnimate=function(){this.isRunningAnimate()&&(this.animacion.stop(),$(this.idBoton).trigger("animatestop"))};
this.upSpeed=function(){return this.animacion.aumentar()};this.downSpeed=function(){return this.animacion.bajar()};this.nextSpeed=function(){return this.animacion.siguiente()};this.isRunningAnimate=function(){return this.animacion.isRunning()}};function TimeLineAnimate(){this.state={};this.create=function(a,b,d,e,f,g,h,l){this.service=d;this.id=a;this.idDias=b;this.renderer=RendererTimeLine.getRenderer(f);this.infoExtractor=RendererTimeLine.getInfoExtractor(f);this.action=e;this.datos={};this.fechaIni=g;this.locale=h;this.lang=l;this.functionality=f;this.state={resumen:!1};return this};this.setState=function(a){for(k in a)this.state[k]=a[k];var b=this,d=jQuery.Deferred();this.service.getTimeLine(a).then(function(e){b._setData(b.infoExtractor.filterData(e[0],
b.state,b.fechaIni),a);d.resolve(b.state)})};this.initialize=function(a){this.state={ambito:a.ambito,param:a.param,resumen:a.resumen};var b=this,d=jQuery.Deferred();this.service.getTimeLine(a).then(function(e){b.datos=b.infoExtractor.filterData(e[0],b.state,b.fechaIni);e=b.infoExtractor.getFirstElement(b.datos,a);b.state.fecha=e.fecha;b.state.fechaFin=e.fechaFin;b.state.intervalo=e.intervalo;b.state.dia=e.dia;b._setData(b.datos,a);b._refreshUI();d.resolve(b.state)});return d.promise()};this._refreshUI=
function(a){a=this.datos;var b=this.state;$(this.id).empty();var d="resumen"in b&&b.resumen;d&&(d=this.infoExtractor.checkResumen(a,b));d?$(this.id).append(this._renderHorasResumen(a)):$(this.id).append(this._renderHoras(a));$(this.idDias).empty();$(this.idDias).append(this._renderDias(a));this._setSelection(b,!0);this._bindEvents();this._applyStyles()};this._setSelection=function(a,b){this._setSelectionHora(a,b);this._setSelectionDia(a)};this._setData=function(a,b){b="PB"==b.ambito||"CEU"==b.ambito||
"MEL"==b.ambito?"PNB":"CAN";"avisos"!=this.functionality?this._adaptVariable(a[b].linea_principal):this._adaptAviso(a.horarios_penbal)};this._adaptVariable=function(a){this.datos.linea_principal=a};this._adaptAviso=function(a){this.datos.horarios_penbal=a};this._renderHoras=function(a){return this.renderer.renderHoras(a,this.state.ambito,this.locale)};this._renderHorasResumen=function(a){return this.renderer.renderHorasResumen(a,this.state.ambito,this.locale)};this._renderDias=function(a){return this.renderer.renderDias(a,
this.state.ambito,this.locale,this.lang)};this._setSelectionHora=function(a,b){return this.renderer.setSelectionHora(this.id,a,b)};this._setSelectionDia=function(a){return this.renderer.setSelectionDia(this.idDias,a)};this._bindEvents=function(){var a=this;this.renderer.bindEvents(this.id,this.idDias,function(b,d){a.action.fireAction(b);a._setSelection(b,d!=a.id)});$(this.id).find(".nav.atras").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"-=500"})});$(this.id).find(".nav.adelante").on("click",
function(a){$(".tl-main-horas").animate({scrollLeft:"+=500"})})};this._applyStyles=function(){var a={1:"100%",2:"49.91%",3:"33.1111%",4:"25%",5:"20%",6:"16.6667%"};$(".tl-lista-horas").each(function(){var b=$(this).find("ul");$(b).each(function(){var b=$(this).find("li"),e=b.length;$(b).css("width",e in a?a[e]:"47px")})})}};DateLineIncendioParamRenderer={setSelectionParam:function(a,b){$(a).find("[data-tl-codigo]").each(function(a){$(this).removeClass("tl-selected")});b="[data-tl-codigo={{codigo}}]".replace("{{codigo}}",b.param);$(a).find(b).addClass("tl-selected")},renderDias:function(a,b,d){var e='<div class="timeline-dias"><select class="select-dia">',f={},g={weekday:"long",day:"numeric"},h="";h="PB"==b||"CEU"==b||"MEL"==b?"PNB":"CAN";a.forEach(function(a){var b=new Date(a.fecha);"CAN"==h&&b.setHours(b.getHours()-
1);var l=b.toLocaleDateString(d,g);/^(.*,\s.?\d{2}).*$/gi.test(l)&&(l=/^(.*,\s.?\d{2}).*$/gi.exec(l)[1]);f.hasOwnProperty(b.getDate())||(e+='<option data-tl-fecha="{{fechaStr}}" data-tl-periodo="{{periodo}}" data-tl-fichero="{{fichero}}"  value="{{value}}" >{{dia_texto}}</option>'.replace("{{dia_texto}}",l).replace("{{fechaStr}}",a.fecha).replace("{{value}}",a.fecha).replace("{{periodo}}",a.fecha).replace("{{fichero}}",a.fichero),f[b.getDate()]=a.fecha)});return e+="</select></div>"},bindParametrosEvents:function(a,
b){$(a).find("[data-tl-codigo]").on("click",function(){var a=$(this).attr("data-tl-codigo");b.fireAction({param:a})});$(a).find("[data-tl-fecha]").each(function(a,e){$(e).on("click",function(d){d={fecha:$(this).attr("data-tl-fecha"),intervalo:$(this).attr("data-tl-periodo"),dia:$(this).attr("data-tl-dia")};b.fireAction(d,a)})});$(a).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",function(a,e){e=e.item.element;c={fecha:e.attr("data-tl-fecha"),intervalo:e.attr("data-tl-periodo"),
fichero:e.attr("data-tl-fichero")};b.fireAction(c,a)})}};
DateLineIncendiosPeriodRenderer={renderPeriodos:function(a,b,d){var e='<div class="nav atras">&lt;</div><div class="tl-main-horas">',f=-1;a.forEach(function(a){var b=new Date(a.fecha),g={weekday:"long",day:"numeric"};f!=b.getDate()&&(g=b.toLocaleDateString(d,g),e+=-1!=f?"</ul></div>":"",e+='<div class="tl-lista-horas"><div class="tl-dia">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",g),f=b.getDate());b=(Array.isArray(a.rawFecha),"00-24h");e+='<li><span data-tl-fecha="{{fecha}}" data-tl-fichero="{{fichero}}">{{mensaje}}</span></li>'.replace("{{fecha}}",
a.fecha).replace("{{fichero}}",a.fichero).replace("{{mensaje}}",b)});e+=-1!=f?"</ul></div>":"";e+="</div>";return e+='<div class="nav adelante">&gt;</div>'},setSelectionPeriod:function(a,b,d){$(a).find("[data-tl-fecha]").removeClass("tl-selected");b=b.fecha.replace(/[:+]/g,"\\$&");$(a).find("[data-tl-fecha="+b+"]").addClass("tl-selected");d&&(a=$(a).find("[data-tl-fecha="+b+"]"))&&0<a.length&&$(".tl-main-horas").animate({scrollLeft:$(a[0]).position().left-12},50)},setSelectionDia:function(a,b){var d=
$(a).find(".select-dia");if(void 0!=d){var e=new Date(b.fecha);d.find("[data-tl-fecha]").not("[data-tl-resumen]").each(function(a){if((new Date($(this).attr("data-tl-fecha"))).getDate()==e.getDate()){d.val($(this).attr("data-tl-fecha"));try{d.selectmenu("refresh")}catch(g){}}})}},bindPeriodosEvents:function(a,b){$(a).find("[data-tl-fichero]").on("click",function(){var a=$(this).attr("data-tl-fichero"),e=$(this).attr("data-tl-fecha");b.fireAction({fichero:a,fecha:e})});$(a).find(".nav.atras").on("click",
function(a){$(".tl-main-horas").animate({scrollLeft:"-=500"})});$(a).find(".nav.adelante").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"+=500"})})},refreshPeriodData:function(a,b){b.forEach(function(b){var d=b.fecha.replace(/[.*:+?^${}()|[\]\\]/g,"\\$&");$(a).find("[data-tl-fecha={{fecha}}]".replace("{{fecha}}",d)).attr("data-tl-fichero",b.fichero)})}};
function TimelineIncendios(){this.state={};this.create=function(a,b,d,e,f){this.service=d;this.idParametros=a;this.idFechas=b;this.action=e;this.datos={};this.locale="va"==f?"ca-valencia":f||"es";this.paramRenderer=DateLineIncendioParamRenderer;this.periodRenderer=DateLineIncendiosPeriodRenderer;return this};this.setState=function(a){var b=a.param!=this.state.param;for(k in a)this.state[k]=a[k];b&&(this._refreshPeriodData(),this._setFirstElement(a),a.fichero=this.state.fichero);this._setSelectionPeriod(this.isRunningAnimate())};
this.initialize=function(a,b){var d=this;this.state=a;this.datos.params=b;var e=jQuery.Deferred();this.service.getTimeline(a).then(function(b){d._setData(b[0],a);d._refreshUI();e.resolve(d.state)}).fail(function(a){console.log("error al inicializar")});return e.promise()};this._setData=function(a,b){this._adapt(a);this._setFirstElement(b)};this._adapt=function(a){a="CAN"==this.state.ambito?a.incendios.canarias.variables:a.incendios.penbal.variables;if("RIESGO"in a){var b=[];a.RIESGO.forEach(function(a){b.push({rawFecha:a.fecha,
fichero:a.fichero,variable:a.variable,fecha:Array.isArray(a.fecha)?a.fecha[0]:a.fecha})});b.sort(function(a,b){return new Date(a.fecha)-new Date(b.fecha)});this.datos.producto="RIESGO";this.datos.lineaTiempo=b}};this._setFirstElement=function(a){var b=this.datos.lineaTiempo,d=void 0;if(void 0!=a.fecha){var e=b.filter(function(b){return a.fecha==b.fecha});0<e.length&&(d=e[0])}void 0==d&&(d=b[b.length-1]);this.state.fichero=d.fichero;this.state.fecha=d.fecha;this.state.variable=d.variable};this._refreshUI=
function(){this._refreshUIParams();this._refreshUIPeriodos()};this._refreshUIParams=function(){this._renderDias();this._setSelectionParam();this._bindEventParams()};this._refreshUIPeriodos=function(){this._renderPeriodos();this._setSelectionPeriod(!0);this._bindEventPeriod();this._applyStyles()};this._renderDias=function(a){a=this;var b=this.datos.lineaTiempo;$(this.idParametros).empty();$(this.idParametros).append(a.paramRenderer.renderDias(b,this.state.ambito,this.locale))};this._renderPeriodos=
function(){var a=this.datos.lineaTiempo;$(this.idFechas).empty();$(this.idFechas).append(this.periodRenderer.renderPeriodos(a,this.state,this.locale))};this._setSelectionParam=function(){this.paramRenderer.setSelectionParam(this.idParametros,this.state)};this._setSelectionPeriod=function(a){this.periodRenderer.setSelectionPeriod(this.idFechas,this.state,a);this.periodRenderer.setSelectionDia(this.idParametros,this.state,a)};this._bindEventParams=function(){this.paramRenderer.bindParametrosEvents(this.idParametros,
this.action)};this._bindEventPeriod=function(){this.periodRenderer.bindPeriodosEvents(this.idFechas,this.action)};this._refreshPeriodData=function(){this.periodRenderer.refreshPeriodData(this.idFechas,this.datos.lineaTiempo)};this._applyStyles=function(){var a={1:"100%",2:"49.91%",3:"33.1111%",4:"25%",5:"20%",6:"16.6667%"};$(".tl-lista-horas").each(function(){var b=$(this).find("ul");$(b).each(function(){var b=$(this).find("li"),e=b.length;$(b).css("width",e in a?a[e]:"47px")})})}};function IncendiosTabs(){}IncendiosTabs.prototype.setState=function(a){"param"in a&&(this.state=a,this._renderer.setSelection(this.id,a))};IncendiosTabs.prototype._render=function(a,b){return this._renderer.render(a)};IncendiosTabs.prototype._createEvents=function(a,b){this._renderer.bindEvents(a,b)};
IncendiosTabs.prototype.create=function(a,b,d){b=b.variables;this.action=d;this.id=a;this._renderer=992<=$(window).width()?new IncendiosRendererCustom:new IncendiosRendererMobile(this);$(a).empty();$(a).append(this._render(b));this._createEvents(a,d);return this};function IncendiosRendererCustom(){}IncendiosRendererCustom.prototype.render=function(a){var b="<ul class='lista-variables'>";a.forEach(function(a){b+="<li data-param='"+a.codigo+"'>"+a.nombre+"</li>"});return b+="</ul>"};
IncendiosRendererCustom.prototype.bindEvents=function(a,b){$(a).find("[data-param]").each(function(d){$(this).on("click",function(){var d=$(this).attr("data-param");b.fireAction({param:d});$(a).find("[data-param]").removeClass("tl-selected");$(a).find("[data-param="+d+"]").addClass("tl-selected");$("#parametro1")&&$(a).find("[data-param="+d+"]")[0]&&$("#parametro1").text($(a).find("[data-param="+d+"]")[0].innerHTML)})})};
IncendiosRendererCustom.prototype.setSelection=function(a,b){$(a).find("[data-param]").removeClass("tl-selected");$(a).find("[data-param="+b.param+"]").addClass("tl-selected")};function IncendiosRendererMobile(a){this.component=a}IncendiosRendererMobile.prototype.render=function(a){var b="<select class='tl-param-prediccion select-dia'>";a.forEach(function(a){b+="<option value='{{id}}'>{{name}}</option>".replace("{{id}}",a.codigo).replace("{{name}}",a.nombre)});return b+="</select>"};
IncendiosRendererMobile.prototype.bindEvents=function(a,b){$(a).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",function(){b.fireAction({param:$(this).val()})})};IncendiosRendererMobile.prototype.setSelection=function(a,b){a=$(a).find(".select-dia");a.val(b.param);try{a.selectmenu("refresh")}catch(d){}};
function LeyendaIncendiosComponent(){ListComponent.call(this);this.create=function(a,b,d,e,f,g){this.service=b;this.id=a;this.lang=d;this.locale=e;this.descriptor=new DescripcionLeyenda(d);this.condition=g||void 0;this.dataSubscribers=[];this.changeOnFichero=!1;return this};this.addDataSubscriber=function(a){this.dataSubscribers.push(a)};this.setChangeOnFichero=function(a){this.changeOnFichero=a};this._setState=function(a){var b=this;if(this.condition&&!this.condition.checkCondition(a))return this.state.param=
a.param,$(this.id).empty(),!1;var d=!1;["param","ambito","fichero","nivel"].forEach(function(e){var f=a[e];"fichero"==e&&!b.changeOnFichero||b.state[e]==f||(d=!0);e in a&&(b.state[e]=f)});return d};this._getData=function(a){return this.service.getValoresLeyenda(a)};this._adapt=function(a){var b=[],d=this.descriptor.getLeyendas(a.Producto);a["Lista RGBA"].forEach(function(a){var e=d.filter(function(b){return b.codigo===a.Valores[0]});0<e.length&&(a.leyenda=e[0].descripcion,b.push(a))});a&&this.dataSubscribers.forEach(function(a){a.setLegendData(b)});
return a};this._render=function(a){var b=this,d='<div class="leyenda-colores">'.replace("{{id}}",this.id)+'<div class="leyenda-titulo">{{titulo}}</div>'.replace("{{titulo}}",this.descriptor.getDescripcion(a.Producto,this.state))+"<ul>",e=a["Lista RGBA"].sort(function(a,b){return a.Valores[0]-b.Valores[0]}),f=this.descriptor.getLeyendas(a.Producto);e.forEach(function(a){var e=a.RGBA[0].split(","),g=e[1],m=e[2];e="#"+b._cToHex(e[0])+b._cToHex(g)+b._cToHex(m);var n=Array.isArray(a.Valores)?a.Valores[0]:
a.Valores;a=f.filter(function(a){return a.codigo===n});0<a.length&&(d+='<li class="ley-el-color">'+'<div style="background-color:{{color}}">&nbsp;</div>'.replace("{{color}}",e)+'<div class="ley-el-dato ley-simple">{{valor}}</div>'.replace("{{valor}}",a[0].descripcion)+"</li>")});d+="</ul></div>";return'<div class="leyenda-col-map">'+d+"</div>"};this._cToHex=function(a){a=parseInt(a).toString(16);return 1==a.length?"0"+a:a}}
function DescripcionLeyenda(a,b){this.lang=a||{};this.prefix=b||"";this.getDescripcion=function(a){var b=this.lang.filter(function(b){return b.codigo===a.toLocaleLowerCase()});return 0<b.length?b[0].leyenda:a};this.getLeyendas=function(a){var b=this.lang.filter(function(b){return b.codigo===a.toLocaleLowerCase()});return 0<b.length?b[0].detalle_leyenda:{}}};var ShowIncendio={radarBounds:[[33.21999999999998,7.139999999999998],[46.29999999999997,7.139999999999998],[46.29999999999997,-11.079999999999998],[33.21999999999998,-11.079999999999998]],addIncendioLayer:function(a,b){var d=this;this.service=a;this.datosLeyenda=[];this.options=b;this.cambioAmbito=this.incendioImage=void 0;this._finishSetup=!1;this.changeStateActions.push({fireAction:function(a,b){d._checkCambioIncendio(a)&&d._showIncendioLayer(a)}});this._bindEvents();return this},setLegendData:function(a){this.datosLeyenda=
a},_getLeyendColor:function(a){a=a.split(",");var b=parseInt($.trim(a[0].substring(5)));b+=","+parseInt($.trim(a[1]));b+=","+parseInt($.trim(a[2]));b+=","+parseInt($.trim(a[3].substring(0,a[3].length-1)));a=this.datosLeyenda.filter(function(a){return a.RGBA[0]===b});if(0<a.length)return a[0]},_checkCambioIncendio:function(a){return!0},_clearIncendioLayer:function(){void 0!=this.incendioImage&&(this.map.removeLayer(this.incendioImage),this.incendioImage=void 0)},_showIncendioLayer:function(a){var b=
this,d="/es/api-eltiempo/incendios/imagen/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);this.service.getBounds(a).then(function(a){a=L.GeoJSON.coordsToLatLngs(a[0]);if(void 0==b.incendioImage){var e=b.map;b.incendioImage=L.imageCanvasOverlay(d,a,{interactive:!0}).addTo(e);if(void 0!=b.options&&"showPopup"in b.options&&1==b.options.showPopup)b.incendioImage.on("mousemove",function(a){e.closeTooltip(b.tooltipIncendio);var d=this.getPixelColor(a.latlng),f=b._getLeyendColor(d);
f&&($(".leyenda-titulo"),d='<ul><li class="ley-el-color"><div style="background-color:{{color}}">&nbsp;</div><div class="ley-el-dato">{{rango}}</div></li></ul>'.replace("{{color}}",d).replace("{{rango}}",f.leyenda),b.tooltipIncendio=L.tooltip({direction:"top",opacity:.85,permanent:!1}).setContent(d).setLatLng(a.latlng).addTo(e))})}else b.incendioImage.setBounds(a),b.incendioImage.setUrl(d);b.incendioImage.setOpacity(.5)}).fail(function(a){console.log("Error al cargar la capa "+a)}).always(function(a){})},
_bindEvents:function(){var a=this.map,b=this;a.on("dragend",function(a){});a.on("cambioAmbito",function(a){1!=b.state.move?b._setUp():(b._clearIncendioLayer(),b.cambioAmbito=!0)});a.on("zoomend",function(a){})},_setUp:function(){var a=this.state;this._clearIncendioLayer();this._showIncendioLayer(a);this._finishSetup=!0}};function Animacion(){this.speeds=[{speed:1E3,name:"0.5x"},{speed:500,name:"1x"},{speed:250,name:"2x"},{speed:133,name:"3x"}];this.create=function(a,b){this.action=a;this.timer=void 0;this.speed=b&&b.speed||500;this.lastElement=void 0;this.lista=[];return this};this.start=function(a,b){var d=this;if(1!=this.state){var e=this.speed,f=0;this.lista=a;if(void 0!=b){var g=a.filter(function(a){return a.fecha==b});0<g.length&&(f=a.indexOf(g[0]))}this.timer=setInterval(function(b){b=a[f++%a.length];d.action.fireAction({fecha:b.fecha,
fichero:b.fichero});d.lastElement=b},e)}};this.aumentar=function(){var a=this._getSpeedUp()();this._modifySpeed(a);return a};this.siguiente=function(){var a=this._getSpeedNext();this._modifySpeed(a);return a};this.bajar=function(){var a=this._getSpeedDown();this._modifySpeed(a);return a};this.stop=function(){clearInterval(this.timer);this.timer=void 0};this.isRunning=function(){return void 0!=this.timer};this._modifySpeed=function(a){this.speed=a.speed;this.isRunning()&&(this.stop(),this.start(this.lista,
this.lastElement.fecha));return a};this._getCurrentSpeedIndex=function(){var a=this.speed,b=this.speeds.filter(function(b){return b.speed==a});return 0<b.length?this.speeds.indexOf(b[0]):2};this._getSpeedUp=function(){var a=this._getCurrentSpeedIndex(),b=this.speeds[a];0<a&&(b=this.speeds[--a]);return b};this._getSpeedDown=function(){var a=this._getCurrentSpeedIndex(),b=this.speeds[a];a<this.speeds.length-1&&(b=this.speeds[++a]);return b};this._getSpeedNext=function(){var a=this._getCurrentSpeedIndex();
return this.speeds[++a%this.speeds.length]}};function DateLineRadar(){this.state={};this.create=function(a,b,d,e,f){this.service=d;this.idParametros=a;this.idFechas=b;this.action=e;this.datos={};this.locale=f||"es";this.paramRenderer=DateLineRadarParamRenderer;this.periodRenderer=DateLineRadarPeriodRenderer;return this};this.setState=function(a){var b=a.radar!=this.state.radar;for(k in a)this.state[k]=a[k];b&&(this._refreshPeriodData(),this._setFirstElement(a),a.fichero=this.state.fichero);this._setSelectionPeriod(this.isRunningAnimate())};
this.initialize=function(a,b){var d=this;this.state=a;this.datos.params=b;var e=jQuery.Deferred();this.service.getTimeline(a).then(function(b){d._setData(b[0],a);d._refreshUI();e.resolve(d.state)}).fail(function(a){console.log("error al inicializar")});return e.promise()};this._setData=function(a,b){this._adapt(a);this._setFirstElement(b)};this._adapt=function(a){a=a[0];if("Elementos"in a){var b=[];a.Elementos.forEach(function(a){b.push({rawFecha:a.Fecha,fichero:a["Nombre fichero"],radar:a["Nombre radar"],
fecha:Array.isArray(a.Fecha)?a.Fecha[0]:a.Fecha})});b.sort(function(a,b){return new Date(a.fecha)-new Date(b.fecha)});this.datos.producto=a.Producto;this.datos.lineaTiempo=b}};this._setFirstElement=function(a){var b=this.datos.lineaTiempo.filter(function(b){return b.radar==a.radar||"compo"==a.radar&&void 0==b.radar}),d=void 0;if(void 0!=a.fecha){var e=b.filter(function(b){return a.fecha==b.fecha});0<e.length&&(d=e[0])}void 0==d&&(d=b[b.length-1]);this.state.fichero=d.fichero;this.state.fecha=d.fecha;
this.state.radar=d.radar};this._refreshUI=function(){this._refreshUIParams();this._refreshUIPeriodos()};this._refreshUIParams=function(){this._renderParametros();this._setSelectionParam();this._bindEventParams()};this._refreshUIPeriodos=function(){this._renderPeriodos();this._setSelectionPeriod(!0);this._bindEventPeriod();this._applyStyles()};this._renderParametros=function(){$(this.idParametros).empty();$(this.idParametros).append(this.paramRenderer.renderParametros(this.datos.params,this.state.ambito))};
this._renderPeriodos=function(){var a=this,b=this.datos.lineaTiempo.filter(function(b){return b.radar==a.state.radar});$(this.idFechas).empty();$(this.idFechas).append(a.periodRenderer.renderPeriodos(b,this.state,this.locale))};this._setSelectionParam=function(){this.paramRenderer.setSelectionParam(this.idParametros,this.state)};this._setSelectionPeriod=function(a){this.periodRenderer.setSelectionPeriod(this.idFechas,this.state,a)};this._bindEventParams=function(){this.paramRenderer.bindParametrosEvents(this.idParametros,
this.action)};this._bindEventPeriod=function(){this.periodRenderer.bindPeriodosEvents(this.idFechas,this.action)};this._refreshPeriodData=function(){var a=this,b=this.datos.lineaTiempo.filter(function(b){return b.radar==a.state.radar});this.periodRenderer.refreshPeriodData(this.idFechas,b)};this._applyStyles=function(){var a={1:"100%",2:"49.91%",3:"33.1111%",4:"25%",5:"20%",6:"16.6667%"};$(".tl-lista-horas").each(function(){var b=$(this).find("ul");$(b).each(function(){var b=$(this).find("li"),e=
b.length;$(b).css("width",e in a?a[e]:"47px")})})}}
var DateLineRadarParamRenderer={renderParametros:function(a,b){var d='<div class="timeline-dias"><ul class="lista-variables" id="lista-variables">';a.forEach(function(a){d+='<li data-tl-codigo="{{codigo}}"><span>{{nombre}}</span></li>'.replace("{{codigo}}",a.codigo).replace("{{nombre}}",a.nombre)});return d+="</ul></div>"},setSelectionParam:function(a,b){$(a).find("[data-tl-codigo]").each(function(a){$(this).removeClass("tl-selected")});b="[data-tl-codigo={{codigo}}]".replace("{{codigo}}",b.param);
$(a).find(b).addClass("tl-selected")},bindParametrosEvents:function(a,b){$(a).find("[data-tl-codigo]").on("click",function(){var a=$(this).attr("data-tl-codigo");b.fireAction({param:a})})}},DateLineRadarPeriodRenderer={renderPeriodos:function(a,b,d){var e='<div class="nav atras">&lt;</div><div class="tl-main-horas">',f=-1;a.forEach(function(a){var g=new Date(a.fecha),l={weekday:"long",day:"numeric"};f!=g.getDate()&&(l=g.toLocaleDateString(d,l),e+=-1!=f?"</ul></div>":"",e+='<div class="tl-lista-horas"><div class="tl-dia">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",
l),f=g.getDate());g=Array.isArray(a.rawFecha)&&"RNN"==b.param?a.rawFecha[0].substring(11,13)+"-"+a.rawFecha[1].substring(11,13)+"h":a.fecha.substring(11,16);e+='<li><span data-tl-fecha="{{fecha}}" data-tl-fichero="{{fichero}}">{{mensaje}}</span></li>'.replace("{{fecha}}",a.fecha).replace("{{fichero}}",a.fichero).replace("{{mensaje}}",g)});e+=-1!=f?"</ul></div>":"";e+="</div>";return e+='<div class="nav adelante">&gt;</div>'},setSelectionPeriod:function(a,b,d){$(a).find("[data-tl-fecha]").removeClass("tl-selected");
b=b.fecha.replace(/[:+]/g,"\\$&");$(a).find("[data-tl-fecha="+b+"]").addClass("tl-selected");d&&(a=$(a).find("[data-tl-fecha="+b+"]"))&&0<a.length&&$(".tl-main-horas").animate({scrollLeft:$(a[0]).position().left-12},50)},bindPeriodosEvents:function(a,b){$(a).find("[data-tl-fichero]").on("click",function(){var a=$(this).attr("data-tl-fichero"),e=$(this).attr("data-tl-fecha");b.fireAction({fichero:a,fecha:e})});$(a).find(".nav.atras").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"-=500"})});
$(a).find(".nav.adelante").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"+=500"})})},refreshPeriodData:function(a,b){b.forEach(function(b){var d=b.fecha.replace(/[.*:+?^${}()|[\]\\]/g,"\\$&");$(a).find("[data-tl-fecha={{fecha}}]".replace("{{fecha}}",d)).attr("data-tl-fichero",b.fichero)})}};
function AnimateRadar(){this.create=function(a,b,d){this.idBoton=a;this.animacion=(new Animacion).create(b);this.speed=d&&d.speed||500;return this};this.startAnimate=function(){var a=this.state.radar,b=this.datos.lineaTiempo.filter(function(b){return b.radar==a});this.animacion.start(b,this.state.fecha);$(this.idBoton).trigger("animatestart")};this.stopAnimate=function(){this.isRunningAnimate()&&(this.animacion.stop(),$(this.idBoton).trigger("animatestop"))};this.upSpeed=function(){return this.animacion.aumentar()};
this.downSpeed=function(){return this.animacion.bajar()};this.nextSpeed=function(){return this.animacion.siguiente()};this.isRunningAnimate=function(){return this.animacion.isRunning()}};function LeyendaRadar(){}
LeyendaRadar.prototype.create=function(a,b){this.id=a;this.lang=b;this.state={};this.valoresLeyenda={compo:[{clase:"LR01",valor:12},{clase:"LR02",valor:18},{clase:"LR03",valor:24},{clase:"LR04",valor:30},{clase:"LR05",valor:36},{clase:"LR06",valor:42},{clase:"LR07",valor:48},{clase:"LR08",valor:54},{clase:"LR09",valor:60},{clase:"LR10",valor:66},{clase:"LR11",valor:72}],PPI:[{clase:"LR01",valor:12},{clase:"LR02",valor:18},{clase:"LR03",valor:24},{clase:"LR04",valor:30},{clase:"LR05",valor:36},{clase:"LR06",
valor:42},{clase:"LR07",valor:48},{clase:"LR08",valor:54},{clase:"LR09",valor:60},{clase:"LR10",valor:66},{clase:"LR11",valor:72}],RN1:[{clase:"LE01",valor:1},{clase:"LE02",valor:2},{clase:"LE03",valor:3},{clase:"LE04",valor:4},{clase:"LE05",valor:5},{clase:"LE06",valor:6},{clase:"LE07",valor:7},{clase:"LE08",valor:8},{clase:"LE09",valor:9},{clase:"LE10",valor:10},{clase:"LE11",valor:11},{clase:"LE12",valor:12},{clase:"LE13",valor:13}],TOP:[{clase:"LP01",valor:.5},{clase:"LP02",valor:1},{clase:"LP03",
valor:2},{clase:"LP04",valor:4},{clase:"LP05",valor:8},{clase:"LP06",valor:16},{clase:"LP07",valor:32},{clase:"LP08",valor:64},{clase:"LP09",valor:128},{clase:"LP10",valor:256}]};return this};LeyendaRadar.prototype.setState=function(a){"param"in a&&(this.state.param=a.param,this.refreshUI(a))};LeyendaRadar.prototype.refreshUI=function(a){$(this.id).empty();$(this.id).append(this._render(this.valoresLeyenda[a.param]))};
LeyendaRadar.prototype._render=function(a){var b="<ul>";a.forEach(function(a){b+='<li class="{{clase}}"><em>{{valor}}</em></li>'.replace("{{clase}}",a.clase).replace("{{valor}}",a.valor)});return b+="</ul>"};var PrediccionService=function(){};PrediccionService.prototype._httpGet=function(a,b){var d=$.Deferred();$.when($.get("/es/api-eltiempo"+encodeURI(a)),"json").then(function(a){d.resolve(a)}).fail(function(a){d.reject(a.responseText,a.status)});return d.promise()};PrediccionService.prototype.getPredictionDownloadUrl=function(a){var b="/prediccion/{{fecha}}/{{ambito}}/{{zoom}}";for(key in a)b=b.replace("{{"+key+"}}",a[key]);"location"in a&&a.location&&(b+="/"+a.location);return b};
PrediccionService.prototype.getPrediction=function(a){return this._httpGet(getPredictionDownloadUrl(a))};PrediccionService.prototype.getPrediction=function(a){var b="/prediccion/{{fecha}}/{{ambito}}/{{zoom}}";for(key in a)b=b.replace("{{"+key+"}}",a[key]);"location"in a&&a.location&&(b+="/"+a.location);return this._httpGet(b)};
PrediccionService.prototype.getLimitLines=function(a){var b="/lineas_limite/{{zoom}}/{{ambito}}".replace("{{zoom}}",a.zoom).replace("{{ambito}}",a.ambito);"paises"in a&&1==a.paises?b+="/paises":"avisos"in a&&1==a.avisos&&(b+="/avisos");return this._httpGet(b)};
PrediccionService.prototype.getVariables=function(a){4.8==a.zoom&&(a.zoom=5);var b="/variables/{{param}}/{{ambito}}/{{zoom}}/{{fecha}}/{{intervalo}}/{{dia}}";for(key in a)b=b.replace("{{"+key+"}}",a[key]);"location"in a&&void 0!=a.location&&(b+="/"+a.location);return this._httpGet(b)};PrediccionService.prototype.getMaxMinsDownloadUrl=function(a){var b="/temperaturas/{{fecha}}/{{ambito}}";for(key in a)b=b.replace("{{"+key+"}}",a[key]);"location"in a&&a.location&&(b+="/"+a.location);return b};
PrediccionService.prototype.getMaxMins=function(a){return this._httpGet(this.getMaxMinsDownloadUrl(a))};PrediccionService.prototype.getTimeLine=function(a){var b="/timeline-prediccion/{{param}}/{{ambito}}";for(key in a)b=b.replace("{{"+key+"}}",a[key]);return this._httpGet(b)};
PrediccionService.prototype.getLineasLimiteTimeLine=function(){var a=$.Deferred();$.when($.get("/timeline/eCielo/penbal","json"),$.get("/lineas_limite/7","json")).then(function(b,d){a.resolve(b,d)}).fail(function(b){a.reject(b.responseText)});return a.promise()};PrediccionService.prototype.getMunicipios=function(a,b){a="/municipios/{{zoom}}".replace("{{zoom}}",Math.ceil(a.zoom));void 0!=b&&""!=$.trim(b)&&(a+="/"+b);return this._httpGet(a)};var AvisosService=function(){PrediccionService.call(this)};
AvisosService.prototype=Object.create(PrediccionService.prototype);AvisosService.prototype.getTimeLine=function(a){return this._httpGet("/timeline-avisos/{{ambito}}".replace("{{ambito}}",a.ambito))};AvisosService.prototype.getResumenAvisos=function(a){a="/resumen-avisos-geojson/{{ambito}}/{{fecha}}/{{dia}}".replace("{{ambito}}",a.ambito).replace("{{fecha}}",a.fecha).replace("{{dia}}",a.dia);return this._httpGet(a)};
AvisosService.prototype.getAvisosHoras=function(a){var b="/avisos-horas/{{ambito}}/{{zoom}}".replace("{{ambito}}",a.ambito).replace("{{zoom}}",a.zoom);"location"in a&&a.location&&(b+="/"+a.location);return this._httpGet(b)};AvisosService.prototype.getAvisos=function(a){return this._httpGet("/avisos-geojson/{{ambito}}/{{fecha}}".replace("{{ambito}}",a.ambito).replace("{{fecha}}",a.fecha))};
AvisosService.prototype.getListadoAvisos=function(a){return"resumen"in a&&1==a.resumen?this.getResumenListadoAvisos(a):this.getListadoAvisosFechaHora(a)};AvisosService.prototype.getListadoAvisosFechaHora=function(a){var b="/lista-avisos/{{ambito}}/{{fecha}}".replace("{{ambito}}",a.ambito).replace("{{fecha}}",a.fecha);"location"in a&&a.location&&(b+="/"+a.location);return this._httpGet(b)};
AvisosService.prototype.getResumenListadoAvisos=function(a){var b="/resumen-lista-avisos/{{ambito}}/{{fecha}}/{{dia}}".replace("{{ambito}}",a.ambito).replace("{{fecha}}",a.fecha).replace("{{dia}}",a.dia);"location"in a&&a.location&&(b+="/"+a.location);return this._httpGet(b)};AvisosService.prototype.getNombreZonas=function(a){a=17>=a.length?a.join(","):"all";return this._httpGet("/nombres-zona/{{params}}".replace("{{params}}",a))};var RadarService=function(){PrediccionService.call(this)};
RadarService.prototype=Object.create(PrediccionService.prototype);RadarService.prototype.getTimeline=function(a){a="/radar/timeline/{{param}}/{{ambito}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito);return this._httpGet(a)};RadarService.prototype.getRadarBounds=function(a){a="/radar/bounds-radar/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);return this._httpGet(a)};
RadarService.prototype.getValoresLeyenda=function(a){a="/radar/leyenda-radar/{{param}}".replace("{{param}}",a.param);return this._httpGet(a)};var ClimatologicosService=function(){PrediccionService.call(this)};ClimatologicosService.prototype=Object.create(PrediccionService.prototype);ClimatologicosService.prototype.getDateLine=function(){return this._httpGet("/climatologicos/dateline")};
ClimatologicosService.prototype.getValoresLeyenda=function(a){a="/climatologicos/leyenda-valores/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);return this._httpGet(a)};ClimatologicosService.prototype.getImagenBounds=function(a){a="/climatologicos/bounds-imagen/{{fichero}}".replace("{{fichero}}",a.fichero);return this._httpGet(a)};
ClimatologicosService.prototype.getListadoEstaciones=function(a){a="/climatologicos/estaciones/{{location}}".replace("{{location}}",a.location);return this._httpGet(a)};ClimatologicosService.prototype.getEstaciones=function(a){return this._httpGet("/climatologicos/estaciones-geojson")};var ModelosService=function(){PrediccionService.call(this)};ModelosService.prototype=Object.create(PrediccionService.prototype);
ModelosService.prototype.getTimeline=function(a){var b=-1!=["ATN","GBL"].indexOf(a.ambito)?"/modelo-ceepm/timeline/{{param}}/{{ambito}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito):"/modelo-harmonie/timeline/{{param}}/{{ambito}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito);"nivel"in a&&void 0!=a.nivel&&(b+="/"+a.nivel);return this._httpGet(b)};
ModelosService.prototype.getModeloNumerico=function(a){a=-1!=["ATN","GBL"].indexOf(a.ambito)?"/modelo-ceepm/modelo/{{param}}/{{ambito}}/{{fichero}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito).replace("{{fichero}}",a.fichero):"/modelo-harmonie/modelo/{{param}}/{{ambito}}/{{fichero}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito).replace("{{fichero}}",a.fichero);return this._httpGet(a)};
ModelosService.prototype.getImagenBounds=function(a){a="ATN"==a.ambito?"/modelo-ceepm/bounds-imagen/{{param}}".replace("{{param}}",a.param):"/modelo-harmonie/bounds-imagen/{{param}}/{{ambito}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito);return this._httpGet(a)};
ModelosService.prototype.getValoresLeyenda=function(a){for(var b=-1!=["ATN","GBL"].indexOf(a.ambito)?"ceepm":"harmonie",d=a.param.split("|"),e=d[0],f=0;f<d.length;f++){var g=d[f];if(-1!="11 32 61 71 207 130 131_mod 164 165_mod 228".split(" ").indexOf(g)){e=g;break}}b="/modelo-{{modelo}}/leyenda/{{param}}/{{ambito}}".replace("{{modelo}}",b).replace("{{param}}",e).replace("{{ambito}}",a.ambito);"ATN"==a.ambito&&"130"==a.param&&(b+="/"+a.nivel);return this._httpGet(b)};var IncendiosService=function(){PrediccionService.call(this)};
IncendiosService.prototype=Object.create(PrediccionService.prototype);IncendiosService.prototype.getTimeline=function(a){a="/incendios/timeline/{{param}}/{{ambito}}".replace("{{param}}",a.param).replace("{{ambito}}",a.ambito);return this._httpGet(a)};IncendiosService.prototype.getImages=function(a){a="/incendios/imagen/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);return this._httpGet(a)};
IncendiosService.prototype.getBounds=function(a){a="/incendios/bounds/{{param}}/{{fichero}}".replace("{{param}}",a.param).replace("{{fichero}}",a.fichero);return this._httpGet(a)};IncendiosService.prototype.getValoresLeyenda=function(a){a="/incendios/leyenda/{{param}}".replace("{{param}}",a.param);return this._httpGet(a)};function TimeLine(){this.state={};this.create=function(a,b,d,e,f,g,h,l){this.service=d;this.id=a;this.idDias=b;this.renderer=RendererTimeLine.getRenderer(f);this.infoExtractor=RendererTimeLine.getInfoExtractor(f);this.action=e;this.fechaIni=g;this.locale=h;this.lang=l;this.state={resumen:!1};return this};this.setState=function(a){var b=this.state.resumen!=a.resumen;for(k in a)this.state[k]=a[k];b&&this._refreshUI()};this.initialize=function(a){this.state={ambito:a.ambito,param:a.param,resumen:a.resumen};
var b=this,d=jQuery.Deferred();this.service.getTimeLine(a).then(function(e){b.datos=b.infoExtractor.filterData(e[0],b.state,b.fechaIni);e=b.infoExtractor.getFirstElement(b.datos,a);b.state.fecha=e.fecha;b.state.fechaFin=e.fechaFin;b.state.intervalo=e.intervalo;b.state.dia=e.dia;b._refreshUI();d.resolve(b.state)});return d.promise()};this._refreshUI=function(a){a=this.datos;var b=this.state;$(this.id).empty();var d="resumen"in b&&b.resumen;d&&(d=this.infoExtractor.checkResumen(a,b));d?$(this.id).append(this._renderHorasResumen(a)):
$(this.id).append(this._renderHoras(a));$(this.idDias).empty();$(this.idDias).append(this._renderDias(a));this._setSelection(b,!0);this._bindEvents();this._applyStyles()};this._setSelection=function(a,b){this._setSelectionHora(a,b);this._setSelectionDia(a)};this._renderHoras=function(a){return this.renderer.renderHoras(a,this.state.ambito,this.locale)};this._renderHorasResumen=function(a){return this.renderer.renderHorasResumen(a,this.state.ambito,this.locale)};this._renderDias=function(a){return this.renderer.renderDias(a,
this.state.ambito,this.locale,this.lang)};this._setSelectionHora=function(a,b){return this.renderer.setSelectionHora(this.id,a,b)};this._setSelectionDia=function(a){return this.renderer.setSelectionDia(this.idDias,a)};this._bindEvents=function(){var a=this;this.renderer.bindEvents(this.id,this.idDias,function(b,d){a.action.fireAction(b);a._setSelection(b,d!=a.id)});$(this.id).find(".nav.atras").on("click",function(a){$(".tl-main-horas").animate({scrollLeft:"-=500"})});$(this.id).find(".nav.adelante").on("click",
function(a){$(".tl-main-horas").animate({scrollLeft:"+=500"})})};this._applyStyles=function(){var a={1:"100%",2:"49.91%",3:"33.1111%",4:"25%",5:"20%",6:"16.6667%"};$(".tl-lista-horas").each(function(){var b=$(this).find("ul");$(b).each(function(){var b=$(this).find("li"),e=b.length;$(b).css("width",e in a?a[e]:"47px")})})}}
var RendererTimeLine=function(a,b){return{getRenderer:function(a){return"avisos"!=a?variablesTimelineRenderer:avisosTimelineRenderer},getInfoExtractor:function(a){return"avisos"!=a?variablesInfoExtractor:avisosInfoExtractor}}}(),variablesInfoExtractor={filterData:function(a,b,d){var e="PB"==b.ambito?"PNB":"CAN",f=new Date(d[b.ambito]);["linea_principal","resumen"].forEach(function(b){if(0!=a[e][b].length){do{var d=a[e][b][0],g="F_fin"in d?new Date(d.F_fin):new Date(d.F_ini);4==d.interval_utc.length&&
(g.setHours(g.getHours()-eval(d.F_ini.substring(19,22))),g.setMinutes(g.getMinutes()-1));if(g>=f)break;a[e][b].shift()}while(g<f&&0<a[e][b].length)}});return a},getFirstElement:function(a,b){var d="CAN"==b.ambito?"CAN":"PNB",e=void 0!=b.resumen&&1==b.resumen?"resumen":"linea_principal";"resumen"==e&&0==a[d].resumen.length&&(e="linea_principal");var f;void 0==b.fecha?f=a[d][e][0]:a[d][e].forEach(function(a){"01"==a.interval_utc&&a.F_ini==b.fecha?f=a:(fIni=new Date(a.F_ini),fFin=new Date(a.F_fin),fchk=
new Date(b.fecha),fIni<=fchk&&fchk<=fFin&&(f=a))});void 0==f&&(f=a[d][e][0]);return{fecha:f.F_ini,fechaFin:f.F_fin,intervalo:f.interval_utc,dia:f.hasOwnProperty("dia ")?f["dia "]:f.dia}},checkResumen:function(a,b){b="PB"==b.ambito?"PNB":"CAN";return"resumen"in a[b]&&0<a[b].resumen.length}},avisosInfoExtractor={filterData:function(a,b,d){var e=new Date(d[b.ambito]);["horarios_"+("PB"==b.ambito?"penbal":"can")].forEach(function(b){do{var d=new Date(a[b][0].split(" ")[0]);if(d>=e)break;a[b].shift()}while(d<
e&&0<a[b].length)});return a},getFirstElement:function(a,b){var d=(b.resumen?"resumenes":"horarios")+"_"+("PB"==b.ambito?"penbal":"can"),e=b.resumen&&b.dia?b.dia.substring(2,3):0;a=a[d][e];b.resumen&&(a="{{anio}}-{{mes}}-{{dia}}T12:00:00+02:00".replace("{{anio}}",a.substring(0,4)).replace("{{mes}}",a.substring(4,6)).replace("{{dia}}",a.substring(6,8)));return{fecha:a,fechaFin:void 0,intervalo:"01",dia:"dia"in b?b.dia:"D+0"}},checkResumen:function(a,b){return!0}},variablesTimelineRenderer={renderHoras:function(a,
b,d,e){var f='<div class="nav atras">&lt;</div>',g=-1;f+='<div class="tl-main-horas">';var h="CAN"==b?"CAN":"PNB";a[h].linea_principal.forEach(function(a){var b=new Date(a.F_ini);"CAN"==h&&b.setHours(b.getHours()-1);if(!(void 0!=e&&b<e)){var l={weekday:"long",day:"numeric"};g!=b.getDate()&&(l=b.toLocaleDateString(d,l),f+=-1!=g?"</ul></div>":"",f+='<div class="tl-lista-horas"><div class="tl-dia">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",l),g=b.getDate());b=a.interval_utc;b="01"==b?"{{hora}}:{{minutos}}".replace("{{hora}}",
a.F_ini.substring(11,13)).replace("{{minutos}}",a.F_ini.substring(14,16)):"{{ini}}-{{fin}}h".replace("{{ini}}",b.substring(0,2)).replace("{{fin}}",b.substring(2,4));f+='<li><span data-tl-fecha="{{fecha}}" data-tl-periodo="{{periodo}}" data-tl-dia="{{dia}}">{{mensaje}}</span></li>'.replace("{{fecha}}",a.F_ini).replace("{{periodo}}",a.interval_utc).replace("{{dia}}",a.hasOwnProperty("dia ")?a["dia "]:a.dia).replace("{{mensaje}}",b)}});f+=-1!=g?"</div>":"";f+="</div>";return f+='<div class="nav adelante">&gt;</div>'},
renderHorasResumen:function(a,b,d,e){var f='<div class="nav atras">&lt;</div>',g=-1;f+='<div class="tl-main-horas">';a["CAN"==b?"CAN":"PNB"].resumen.forEach(function(a){var b=new Date(a.F_ini);if(!(void 0!=e&&b<e)){var h={weekday:"long",day:"numeric"};g!=b.getDate()&&(h=b.toLocaleDateString(d,h),/^(.*,\s.?\d{2}).*$/gi.test(h)&&(h=/^(.*,\s.?\d{2}).*$/gi.exec(h)[1]),f+=-1!=g?"</ul></div>":"",f+='<div class="tl-lista-horas"><div class="tl-dia tl-resumen">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",
h),g=b.getDate());b=a.interval_utc;b="{{ini}}-{{fin}}h".replace("{{ini}}",b.substring(0,2)).replace("{{fin}}",b.substring(2,4));f+='<li><span data-tl-resumen="true" data-tl-fecha="{{fecha}}" data-tl-periodo="{{periodo}}" data-tl-dia="{{dia}}">{{mensaje}}</span></li>'.replace("{{fecha}}",a.F_ini).replace("{{periodo}}",a.interval_utc).replace("{{dia}}",a.hasOwnProperty("dia ")?a["dia "]:a.dia).replace("{{mensaje}}",b)}});f+=-1!=g?"</div>":"";f+="</div>";return f+='<div class="nav adelante">&gt;</div>'},
renderDias:function(a,b,d){var e='<div class="timeline-dias"><select class="select-dia">',f={},g={weekday:"long",day:"numeric"},h="PB"==b?"PNB":"CAN";a[h].linea_principal.forEach(function(a){var b=new Date(a.F_ini);"CAN"==h&&b.setHours(b.getHours()-1);var l=b.toLocaleDateString(d,g);/^(.*,\s.?\d{2}).*$/gi.test(l)&&(l=/^(.*,\s.?\d{2}).*$/gi.exec(l)[1]);f.hasOwnProperty(b.getDate())||(e+='<option data-tl-fecha="{{fechaStr}}" data-tl-periodo="{{periodo}}" data-tl-dia="{{dia}}"  value="{{value}}" >{{dia_texto}}</option>'.replace("{{dia_texto}}",
l).replace("{{fechaStr}}",a.F_ini).replace("{{value}}",a.F_ini).replace("{{periodo}}",a.interval_utc).replace("{{dia}}",a.dia),f[b.getDate()]=a.F_ini)});"resumen"in a[h]&&0<a[h].resumen.length&&(a=a[h].resumen[0],e+='<option data-tl-resumen="true" data-tl-fecha="{{fecha}}" data-tl-periodo="{{periodo}}" value="resumen" data-tl-dia="{{dia}}">Resumen</option>'.replace("{{fecha}}",a.F_ini).replace("{{periodo}}",a.interval_utc).replace("{{dia}}",a.dia));return e+="</select></div>"},setSelectionHora:function(a,
b,d){$(a).find("[data-tl-fecha]").removeClass("tl-selected");var e=b.fecha.replace(/[.*:+?^${}()|[\]\\]/g,"\\$&"),f=b.intervalo;b=b.dia.replace(/\+/g,"\\+");$(a).find("[data-tl-fecha="+e+"][data-tl-periodo="+f+"][data-tl-dia="+b+"]").addClass("tl-selected");var g=$(".tl-main-horas").width(),h=$(a).find("[data-tl-fecha="+e+"][data-tl-periodo="+f+" ]").position().left;d&&h>g-100&&(a=$(a).find("[data-tl-fecha="+e+"][data-tl-periodo="+f+" ][data-tl-dia="+b+" ]"))&&0<a.length&&$(".tl-main-horas").scrollLeft($(a[0]).position().left)},
setSelectionDia:function(a,b){var d=$(a).find(".select-dia");if(void 0!=d)if("resumen"in b&&b.resumen){a=0<d.find("option[value=resumen]").length;d.val(a?"resumen":d.find("option:first").val());try{d.selectmenu("refresh")}catch(f){}}else{var e=new Date(b.fecha);d.find("[data-tl-fecha]").not("[data-tl-resumen]").each(function(a){if((new Date($(this).attr("data-tl-fecha"))).getDate()==e.getDate()){d.val($(this).attr("data-tl-fecha"));try{d.selectmenu("refresh")}catch(g){}}})}},bindEvents:function(a,
b,d){$(a).find("[data-tl-fecha]").each(function(b,f){$(f).on("click",function(b){b={fecha:$(this).attr("data-tl-fecha"),intervalo:$(this).attr("data-tl-periodo"),dia:$(this).attr("data-tl-dia")};var e=$(this).attr("data-tl-resumen");b.resumen="undefined"!==typeof e&&!1!==e;d(b,a)})});$(b).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",function(a,f){f=f.item.element;a={fecha:f.attr("data-tl-fecha"),intervalo:f.attr("data-tl-periodo"),dia:f.attr("data-tl-dia")};f=f.attr("data-tl-resumen");
a.resumen="undefined"!==typeof f&&!1!==f;d(a,b)})}},avisosTimelineRenderer={_getRendererDias:function(){return 992<=$(window).width()?customAvisosRenderDias:mobileAvisosRenderDias},renderHoras:function(a,b,d,e){var f='<div class="nav atras">&lt;</div>',g=-1,h=-1;f+='<div class="tl-main-horas">';var l="PB"==b?"penbal":"can";a["horarios_"+l].forEach(function(a){var b=new Date(a);"can"==l&&b.setHours(b.getHours()-1);var e={weekday:"long",day:"numeric"};g!=b.getDate()&&(h++,f+=-1!=g?"</ul></div>":"",
f+='<div class="tl-lista-horas"><div class="tl-dia">{{dia_texto}}</div><ul>'.replace("{{dia_texto}}",b.toLocaleDateString(d,e)),g=b.getDate());f+='<li><span data-tl-fecha="{{fecha}}" data-tl-dia="{{dia}}">{{hora}}:{{minutos}}</span></li>'.replace("{{fecha}}",a).replace("{{hora}}",a.substring(11,13)).replace("{{dia}}","D+"+h).replace("{{minutos}}",a.substring(14,16))});f+=-1!=g?"</div>":"";f+="</div>";return f+='<div class="nav adelante">&gt;</div>'},renderHorasResumen:function(a,b,d,e){var f='<div class="nav atras">&lt;</div>';
f+='<div class="tl-main-horas"><ul class="tl-resumen-avisos">';var g=0;a["resumenes_"+("PB"==b?"penbal":"can")].forEach(function(a){a=$.trim(a);a="{{anio}}-{{mes}}-{{dia}}T12:00:00{{tz}}:00".replace("{{anio}}",a.substring(0,4)).replace("{{mes}}",a.substring(4,6)).replace("{{dia}}",a.substring(6,8)).replace("{{tz}}","CET"==a.substring(8)?"+01":"+02");var b=new Date(a);f+='<li><span data-tl-resumen="true" data-tl-fecha="{{fecha}}" data-tl-dia="{{dia}}">{{dia_texto}}</span></li>'.replace("{{fecha}}",
a).replace("{{dia_texto}}",b.toLocaleDateString(d,{weekday:"long",year:"numeric",month:"long",day:"numeric"})).replace("{{dia}}","D+"+g++)});f+="</ul></div>";return f+='<div class="nav adelante">&gt;</div>'},renderDias:function(a,b,d,e){return this._getRendererDias().renderDias(a,b,d,e)},setSelectionHora:function(a,b,d){$(a).find("[data-tl-fecha]").removeClass("tl-selected");b=b.fecha.replace(/[.*:+?^${}()|[\]\\]/g,"\\$&");$(a).find("[data-tl-fecha="+b+"]").addClass("tl-selected");d&&(a=$(a).find("[data-tl-fecha="+
b+"]"))&&0<a.length&&$(".tl-main-horas").animate({scrollLeft:$(a[0]).position().left})},setSelectionDia:function(a,b){this._getRendererDias().setSelectionDia(a,b)},bindEvents:function(a,b,d){[a].forEach(function(a){$(a).find("[data-tl-fecha]").each(function(b,e){$(e).on("click",function(b){b={fecha:$(this).attr("data-tl-fecha"),intervalo:$(this).attr("data-tl-periodo"),dia:$(this).attr("data-tl-dia")};var e=$(this).attr("data-tl-resumen");b.resumen="undefined"!==typeof e&&!1!==e;d(b,a)})})});this._getRendererDias().bindEvents(b,
d)}},customAvisosRenderDias={renderDias:function(a,b,d,e){var f='<div class="timeline-dias"><ul>',g={},h=0,l={weekday:"long",day:"numeric"},m="PB"==b?"penbal":"can";a["horarios_"+m].forEach(function(a){var b=new Date(a);"can"==m&&b.setHours(b.getHours()-1);var n=b.toLocaleDateString(d,l);/^(.*,\s.?\d{2}).*$/gi.test(n)&&(n=/^(.*,\s.?\d{2}).*$/gi.exec(n)[1]);g.hasOwnProperty(b.getDay())||(f+='<li data-tl-fecha="{{fecha}}" data-tl-dia="{{dia}}">{{dia_texto}} <span class="font_bold">{{sufijo_texto}}</span></li>'.replace("{{dia_texto}}",
n).replace("{{sufijo_texto}}",e["avisos.literal.sufijo_dias"]||"horario").replace("{{fecha}}",a).replace("{{dia}}","D+"+h++),g[b.getDay()]=a)});"resumenes_"+m in a&&(a=$.trim(a["resumenes_"+m][0]),a="{{anio}}-{{mes}}-{{dia}}T12:00:00{{tz}}:00".replace("{{anio}}",a.substring(0,4)).replace("{{mes}}",a.substring(4,6)).replace("{{dia}}",a.substring(6,8)).replace("{{tz}}","CET"==a.substring(8)?"+01":"+02"),f+='<li data-tl-resumen="true" data-tl-dia="{{dia}}" data-tl-fecha="{{fecha}}"><span>{{texto}}</span>  <span class="font_bold">{{sufijo_texto}}</li>'.replace("{{texto}}",
e["avisos.literal.resumen"]||"Resumen").replace("{{sufijo_texto}}",e["avisos.literal.sufijo_resumen"]||"horario").replace("{{fecha}}",a).replace("{{dia}}","D+0"));return f+="</ul></div>"},setSelectionDia:function(a,b){if(void 0!=b.resumen&&1==b.resumen)$(a).find("[data-tl-fecha]").each(function(a){$(this).removeClass("tl-selected")}),$(a).find("[data-tl-resumen]").each(function(a){$(this).addClass("tl-selected")});else{var d=new Date(b.fecha);$(a).find("[data-tl-fecha]").not("[data-tl-resumen]").each(function(a){$(this).removeClass("tl-selected");
(new Date($(this).attr("data-tl-fecha"))).getDate()==d.getDate()&&$(this).addClass("tl-selected")})}},bindEvents:function(a,b){$(a).find("[data-tl-fecha]").each(function(d,e){$(e).on("click",function(d){d={fecha:$(this).attr("data-tl-fecha"),intervalo:$(this).attr("data-tl-periodo"),dia:$(this).attr("data-tl-dia")};var e=$(this).attr("data-tl-resumen");d.resumen="undefined"!==typeof e&&!1!==e;b(d,a)})})}},mobileAvisosRenderDias={renderDias:function(a,b,d,e){var f='<div class="timeline-dias"><select class="select-dia">',
g={},h=0,l={weekday:"long",day:"numeric"},m="PB"==b?"penbal":"can";a["horarios_"+m].forEach(function(a){var b=new Date(a);"can"==m&&b.setHours(b.getHours()-1);g.hasOwnProperty(b.getDay())||(f+='<option data-tl-fecha="{{fecha}}" data-tl-dia="{{dia}}" value="{{day}}">{{dia_texto}} {{sufijo_texto}}</option>'.replace("{{dia_texto}}",b.toLocaleDateString(d,l)).replace("{{sufijo_texto}}",e["avisos.literal.sufijo_dias"]||"horario").replace("{{fecha}}",a).replace("{{dia}}","D+"+h++).replace("{{day}}",b.getDay()),
g[b.getDay()]=a)});"resumenes_"+m in a&&(a=$.trim(a["resumenes_"+m][0]),a="{{anio}}-{{mes}}-{{dia}}T12:00:00{{tz}}:00".replace("{{anio}}",a.substring(0,4)).replace("{{mes}}",a.substring(4,6)).replace("{{dia}}",a.substring(6,8)).replace("{{tz}}","CET"==a.substring(8)?"+01":"+02"),f+='<option data-tl-resumen="true" data-tl-dia="{{dia}}" data-tl-fecha="{{fecha}}" value="resumen">{{texto}} {{sufijo_texto}}</option>'.replace("{{texto}}",e["avisos.literal.resumen"]||"Resumen").replace("{{sufijo_texto}}",
e["avisos.literal.sufijo_resumen"]||"diario").replace("{{fecha}}",a).replace("{{dia}}","D+0"));return f+="</select></div>"},setSelectionDia:function(a,b){a=$(a).find(".select-dia");void 0!=b.resumen&&1==b.resumen?a.val("resumen"):a.val((new Date(b.fecha)).getDay());try{a.selectmenu("refresh")}catch(d){}},bindEvents:function(a,b){$(a).find(".select-dia").selectmenu({width:"auto"}).on("selectmenuchange",function(){var d=$("select option:selected"),e={fecha:$(d).attr("data-tl-fecha"),dia:$(d).attr("data-tl-dia")};
d=$(d).attr("data-tl-resumen");e.resumen="undefined"!==typeof d&&!1!==d;b(e,a)})}};</script>
</body>
</html>
