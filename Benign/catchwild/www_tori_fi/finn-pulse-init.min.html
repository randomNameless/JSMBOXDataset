<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>finn-pulse-init.min.html</title>
</head>
<body>

<script>
!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t,n){return t&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(t,n){return function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,c=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t);else for(;!(u=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);u=!0);}catch(e){s=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw i}}return c}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}var u=function(){function e(n,i,a,o){t(this,e),r(this,"pulse",void 0),r(this,"win",void 0),r(this,"isLocalDeployment",void 0),r(this,"isDev",void 0),r(this,"providerId",void 0),this.isLocalDeployment=n,this.isDev=i,this.pulse=a,o&&o.window?this.win=o.window:this.win=window,this.isDev&&(this.win.document.cookie="_pulse2debug=true;SameSite=Lax"),this.providerId=this.getProviderFor(this.getBrand()),this.initializeTracker()}return n(e,[{key:"initializeTracker",value:function(){var t,n=this,r=this.generateInitialTrackerState(),i=this.generateInitialPageTrackerState(r);t=n.getSkdConfig(),n.pulse.init(n.providerId,t,r),n.pulse.init(n.providerId,t,i,e.pageStateTrackerName)}},{key:"getSkdConfig",value:function(){var t={};t.vendors=[e.xandrVendorName,e.googleVendorName],this.isLocalDeployment&&(t.deployStage="dev");try{window._tcf_&&"function"==typeof window._tcf_.getCachedOrDefaultConsentsForPulse&&(t.consents=window._tcf_.getCachedOrDefaultConsentsForPulse(),t.requireAdvertisingOptIn=!0)}catch(e){console.warn("finn-pulse-init: exception during initialisation. Setting SKDConfig without cached consents.",e)}return t}},{key:"getMetaContent",value:function(e){var t=this.getMetaElement(e);return(null==t?void 0:t.content)||null}},{key:"getMetaElement",value:function(e){return this.win.document.querySelector('meta[name="'.concat(e,'"]'))}},{key:"getTopbarDataServiceElement",value:function(){return this.win.document.querySelector("topbar-data-service")}},{key:"getPulseOptionsFromMeta",value:function(){var t=this.getMetaElement(e.finnPulseOptionsMetaTag),n=this.getMetaElement(e.extendedProfileMetaTag),r={};return t&&(r=JSON.parse(decodeURIComponent(t.content))),"true"===(null==n?void 0:n.content)&&(r.hasExtendedProfile=!0),r.vertical&&(r.vertical["@type"]="MarketplaceVertical"),r}},{key:"getPulseTrackerDataFromMeta",value:function(){var t,n,r=this.getMetaElement(e.finnPulseTrackerDataMetaTag),i=this.getMetaElement(e.extendedProfileMetaTag),a={};r&&(null!==(t=(a=JSON.parse(decodeURIComponent(r.content))).object)&&void 0!==t&&t.id&&"ClassifiedAd"===(null===(n=a.object)||void 0===n?void 0:n.type)&&(a.object.contentId=a.object.id));return"true"===(null==i?void 0:i.content)&&a.object&&(a.object.hasExtendedProfile=!0),a.vertical&&(a.vertical["@type"]="MarketplaceVertical"),a}},{key:"generateInitialPageTrackerState",value:function(e){var t=this.getPulseTrackerDataFromMeta();if(t&&Object.keys(t).length>0)return a(a({},e),t);var n=this.getPulseOptionsFromMeta();return n&&Object.keys(n).length>0?a(a(a({},e),s("vertical",n.vertical)),{},{object:a(a(a(a(a(a(a(a(a(a(a({},e.object),"ClassifiedAd"===n.contentType&&{contentId:n.contentId}),s("type",n.contentType)),s("id",n.contentId)),s("category",n.category)),s("tags",n.tags)),s("location",n.contentLocation)),s("filters",n.filters)),s("custom",n.objectCustom)),s("pageType",n.pageType)),s("hasExtendedProfile",n.hasExtendedProfile))}):e}},{key:"generateInitialTrackerState",value:function(){var t={schema:e.trackerEventSchemaVersion,deployTag:"finn-pulse-init-1.6.1",provider:{product:"www.".concat(this.getBrand().toLowerCase()),productType:"ResponsiveWeb"}};this.isDev&&(t.deployStage="dev");var n=this.getApplicationName();n&&(t.provider.component=n),"1"===this.getMetaContent(e.isAuroraMetaTagName)&&(t.provider.platformName="Aurora");var r=this.getFinnDeviceId();r&&""!==r&&(t.device={additionalDeviceIds:[{"@id":"sdrn:".concat(this.providerId,":device:id:").concat(r),component:this.providerId}]});var i=this.getSchibstedAccountId();if(i&&""!==i){t.actor={id:i,realm:p.get(this.getBrand())||"spid.no"};var o=[],c=this.getFinnLoginId();c&&""!==c&&o.push({"@id":"sdrn:".concat(this.providerId,":user:userid:").concat(c),component:this.providerId});var u=this.getFinnOrgId();u&&""!==u&&o.push({"@id":"sdrn:".concat(this.providerId,":user:orgid:").concat(u),component:"".concat(this.providerId)}),o.length>0&&(t.actor.additionalIds=o)}this.updateAbtestCookieFromPodlets();var s=this.getExperiments();s&&s.length>0&&(t.experiments=s);var l=function(e){return function(e){return e.includes("/messages")}(e)?function(e){return e=(e=e.replace(/(\/messages\/new)\/[0-9]+$/,"$1/adId")).replace(/(\/messages\/id)\/.*$/,"$1/ID")}(e):function(e){return e.includes("/innfinn")}(e)?function(e){return e.replace(/(\/innfinn\/adselection\/ad)\/[0-9]+/,"$1/adId")}(e):function(e){return/www\.finn\.no\/[0-9]+$/.test(e)}(e)?function(e){return e.replace(/(www\.finn\.no)\/[0-9]+$/,"$1/adId")}(e):void 0}(this.win.document.URL);l&&(t.object={url:l});var d=this.win.document.title,v=d.replace(/^\([0-9]+\)\s+/i,"");return v&&(t.object=a(a({},t.object),{},{name:v})),t}},{key:"getApplicationName",value:function(){var t=this.getMetaContent(e.appNameMetaTagName);return null!==t?t:this.getAttributeValue(e.dataAppName)}},{key:"getFinnDeviceId",value:function(){return this.getCookie("USERID")}},{key:"getSchibstedAccountId",value:function(){var t,n,r=this.getMetaContent(e.spidIdMetaTagName);if(null!==r)return r;var i=null===(t=this.getTopbarDataServiceElement())||void 0===t?void 0:t.attributes.getNamedItem("spid-id");return i?i.value:null===(n=this.getMetaElement("spidId"))||void 0===n?void 0:n.content}},{key:"getFinnLoginId",value:function(){var t,n,r=this.getMetaContent(e.loginIdMetaTagName);if(null!==r)return r;var i=null===(t=this.getTopbarDataServiceElement())||void 0===t?void 0:t.attributes.getNamedItem("login-id");return i?i.value:null===(n=this.getMetaElement("FINN.userid"))||void 0===n?void 0:n.content}},{key:"getFinnOrgId",value:function(){var e;return null===(e=this.getMetaElement("orgid"))||void 0===e?void 0:e.content}},{key:"updateAbtestCookieFromPodlets",value:function(){var t=this,n=this.win.experiments;if(Array.isArray(n)&&!(n.length<1)){var r=this.getAbtestCookie();r||(r={}),null==n||n.forEach((function(e){var n=o(e.experiment.split("_"),2),i=n[0],a=n[1];r=t.setTreatment(r,i,a,e.timestamp)})),this.win.document.cookie="".concat(e.abtest_cookie_name,"=").concat(encodeURIComponent(JSON.stringify(r)),";domain=").concat(e.abtest_cookie_domain,";max-age=").concat(e.abtest_cookie_maxAgeInSeconds,";path=/")}}},{key:"setTreatment",value:function(e,t,n,r){var i=this.removeExistingTreatment(e,t);return i["".concat(t,"_").concat(n)]=r,i}},{key:"removeExistingTreatment",value:function(e,t){return Object.keys(e).reduce((function(n,i){return i.startsWith("".concat(t,"_"))?n:a(a({},n),{},r({},i,e[i]))}),{})}},{key:"getExperiments",value:function(){var e=this,t=this.getAbtestCookie();if(t){var n=[];return Object.keys(t).forEach((function(t){t&&n.push({platform:e.providerId,id:t,variant:""})})),n}}},{key:"getAbtestCookie",value:function(){var e=this.getCookie("abtest");if(e&&""!==e&&"{"===e.charAt(0)){var t;try{t=JSON.parse(e)}catch(e){return}return t}}},{key:"getCookie",value:function(e){return e&&this.win.document.cookie&&decodeURIComponent(this.win.document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*".concat(encodeURIComponent(e).replace(/[-.+*]/g,"\\$&"),"\\s*\\=\\s*([^;]*).*$)|^.*$")),"$1"))||null}},{key:"getAttributeValue",value:function(e){try{var t,n;if(this.win.document.currentScript&&(n=this.win.document.currentScript.getAttribute(e)),!n){var r=this.win.document.querySelector("[".concat(e,"]"));r&&(n=r.getAttribute(e))}return null!==(t=n)&&void 0!==t?t:null}catch(e){return null}}},{key:"getProviderFor",value:function(t){return this.isDev?d.get(t)||e.defaultProviderId:l.get(t)||e.defaultProviderId}},{key:"getBrand",value:function(){var t=this.getMetaContent(e.brandMetaTagName);return(null==t?void 0:t.toUpperCase())||e.defaultBrand}}])}();function s(e,t){return t&&r({},e,t)}r(u,"defaultProviderId","finn"),r(u,"defaultBrand","FINN"),r(u,"dataAppName","data-application-name"),r(u,"pageStateTrackerName","pageStateTracker"),r(u,"finnPulseOptionsMetaTag","FINN.pulseOptions"),r(u,"finnPulseTrackerDataMetaTag","FINN.pulsePageTrackerData"),r(u,"extendedProfileMetaTag","promotion.extendedProfile"),r(u,"brandMetaTagName","nmp:tracking:brand"),r(u,"loginIdMetaTagName","nmp:tracking:login-id"),r(u,"spidIdMetaTagName","nmp:tracking:spid-id"),r(u,"appNameMetaTagName","nmp:tracking:app-name"),r(u,"isAuroraMetaTagName","nmp:tracking:aurora"),r(u,"abtest_cookie_name","abtest"),r(u,"abtest_cookie_domain","finn.no"),r(u,"abtest_cookie_maxAgeInSeconds",1800),r(u,"trackerEventSchemaVersion","http://schema.schibsted.com/events/tracker-event.json/349.json"),r(u,"xandrVendorName","xandr"),r(u,"googleVendorName","delta");var l=new Map([["FINN","finn"],["TORI","torifi"],["DBA","dba-dk"]]),d=new Map([["FINN","finndev"],["TORI","torifi"],["DBA","dba-dk"]]),p=new Map([["FINN","spid.no"],["TORI","schibsted.fi"],["DBA","schibsted.dk"]]),v=function(){return n((function e(n){t(this,e),r(this,"pulseFunction",void 0),n.pulse.q=n.pulse.q||[],this.pulseFunction=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window.pulse.q.unshift(t)}}),[{key:"init",value:function(e,t,n,r){this.pulseFunction("init",e,t,n,r)}}])}(),f=location.hostname,g=""===f||["local"].some((function(e){return 0===f.indexOf(e)})),m=g||["dev","toripg"].some((function(e){return 0===location.hostname.indexOf(e)}));!function(){var e;(e=window).pulse=e.pulse||function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e.pulse.q=e.pulse.q||[]).push(n)};var t=new v(window);new u(g,m,t)}()}();
//# sourceMappingURL=finn-pulse-init.min.js.map

</script>

</body>
</html>
