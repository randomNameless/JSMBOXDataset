<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cmAdService.html</title>
</head>
<body>

<script>
"use strict";(self.webpackChunkadUnits=self.webpackChunkadUnits||[]).push([[942],{645:(e,i,t)=>{t.r(i),t.d(i,{AdService:()=>I});var a=t(386),s=t(503),d=t(234),r=t(207),o=t(974),n=t(84),p=t(999),l={viewability:{id:30,name:"viewability"},pauseAfterPlay:{id:31,name:"pauseAfterPlay"},conversion:{id:32,name:"adPlay"},clickThru:{id:33,name:"clickThru"},skipVimp1EligibilityLost:{id:43,name:"skipVimp1EligibilityLost"},skipVimp1Vimp0Playing:{id:44,name:"skipVimp1Vimp0Playing"},unitImpression:{id:45,name:"unitImpression"},continueAd:{id:46,name:"continueAd"},viewabilityOneS:{id:54,name:"viewabilityOneS"},adUnmuted:{id:58,name:"adUnmuted"},viewability100:{id:63,name:"viewability100"},adTitleClick:{id:74,name:"adTitleClick"},adCtaButtonClick:{id:75,name:"adCtaButtonClick"},adDescriptionClick:{id:76,name:"adDescriptionClick"},adBrandingClick:{id:77,name:"adBrandingClick"},adIconClick:{id:78,name:"adIconClick"},detach:{id:79,name:"detach"},attach:{id:80,name:"attach"},adSwappedOut:{id:104,name:"adSwappedOut"},adSwappedIn:{id:105,name:"adSwappedIn"},compView100:{id:107,name:"compView100"},pauseAfterPlayScrolledUp:{id:108,name:"pauseAfterPlayScrolledUp"},pauseAfterPlayScrolledDown:{id:109,name:"pauseAfterPlayScrolledDown"},pauseAfterPlaySwitchedTab:{id:110,name:"pauseAfterPlaySwitchedTab"},eligibilityLostScrolledUp:{id:111,name:"eligibilityLostScrolledUp"},eligibilityLostScrolledDown:{id:112,name:"eligibilityLostScrolledDown"},eligibilitySwitchedTab:{id:113,name:"eligibilitySwitchedTab"},oneSecondNoPlaySamePlace:{id:114,name:"oneSecondNoPlaySamePlace"},oneSecondNoPlayScrolledUp:{id:115,name:"oneSecondNoPlayScrolledUp"},oneSecondNoPlayScrolledDown:{id:116,name:"oneSecondNoPlayScrolledDown"},displayingFullNAS:{id:125,name:"displayingFullNAS"},displayingNASTitleOnly:{id:126,name:"displayingNASTitleOnly"},adPausedOtherUnitIsPlaying:{id:127,name:"adPausedOtherUnitIsPlaying"},reportingObserver:{id:129,name:"reportingObserver"},adPlayingNextAdReadyRV1:{id:142,name:"adPlayingNextAdReadyRV1"},adResumeAfterSwapOut:{id:145,name:"adResumeAfterSwapOut"},adPlayingRV1insteadRV0:{id:158,name:"adPlayingRV1insteadRV0"},skipVimp1Vimp1Playing:{id:160,name:"skipVimp1Vimp1Playing"},outOfTab:{id:171,name:"outOfTab"},backToTab:{id:172,name:"backToTab"},stickyDisabled:{id:174,name:"stickyDisabled"},adWaitForPubVideoToStop:{id:175,name:"adWaitForPubVideoToStop"},onImpressionError:{id:178,name:"onImpressionError"},nativeAdCallToActionButtonClick:{id:182,name:"nativeAdCallToActionButtonClick"},pubVideoPreventing:{id:197,name:"pubVideoPreventing"},adRenderedOnFeedIndexLessThanSCMitigationCard:{id:194,name:"adRenderedOnFeedIndexLessThanSCMitigationCard"},adRenderedOnFeedIndexEqualsSCMitigationCard:{id:195,name:"adRenderedOnFeedIndexEqualsSCMitigationCard"},adRenderedOnFeedIndexLargerThanSCMitigationCard:{id:196,name:"adRenderedOnFeedIndexLargerThanSCMitigationCard"},adInSCMitigationFlow:{id:198,name:"adInSCMitigationFlow"},resumeAfterFirstPause:{id:209,name:"resumeAfterFirstPause"},renderOutOfView:{id:210,name:"renderOutOfView"}};class h extends a.O{constructor(e){super(e.model),this.model=e.model,this.adData=e.adData,this.reportFunc=e.reportFunc,this.getAdData=e.getAdDataFunc,this.unitVersion=this.model.get("unitVersion"),this.vpaidData=e.vpaidData,this.log=new s.Z({unitType:this.model.get("unitType"),className:"oppsService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.predictId=e.predictId,this.isViewed=!1,this.hadConversion=!1,this.hadImpression=!1,this.isFirstPlayForAd=!0,this.pageEventHistory=window.cmTag.PEH,this.unifiedPlacementEH=window.cmTag.UPEH,this._fireUnitImpression()}_fireUnitImpression(){this._fireOpp(l.unitImpression.id,l.unitImpression.name),this.reportFunc(l.unitImpression.name,{tab:this.model.get("isInTab"),eligibility:this.model.get("isEligibleToPlay"),gotVimpCountQ:this.model.get("impressionCount"),hadEligibility:this.model.get("hadEligibility"),hadLostEligibility:!!this.model.get("lostEligibilityTime")},!0),this.model.get("hadEligibility")||this.reportFunc("waitingForEligibilty",{tab:this.model.get("isInTab")},!1)}fireSkipVimp1EligibilityLost(e){if(e){var i;this._fireOpp(l.skipVimp1EligibilityLost.id,l.skipVimp1EligibilityLost.name);var t=this.subModel?this.subModel.get("videoViewContainer"):this.model.get("videoViewContainer");if(!t){var a=n(this.subModel?this.subModel.get("parentSelector"):this.model.get("parentSelector"));t=p.isArray(a)?a[0]:a}t=null!==(i=t[0])&&void 0!==i?i:t,this.adData.pap=p.offsetFromBottomOfViewPort(t)+n(t).height()>0?1:0,this.model.get("isInTab")?this.adData.pap?(this._fireOpp(l.eligibilityLostScrolledUp.id,l.eligibilityLostScrolledUp.name),this.reportFunc(l.eligibilityLostScrolledUp.name,{},!0)):(this._fireOpp(l.eligibilityLostScrolledDown.id,l.eligibilityLostScrolledDown.name),this.reportFunc(l.eligibilityLostScrolledDown.name,{},!0)):(this._fireOpp(l.eligibilitySwitchedTab.id,l.eligibilitySwitchedTab.name),this.reportFunc(l.eligibilitySwitchedTab.name,{},!0))}this.reportFunc(l.skipVimp1EligibilityLost.name,{},!1)}fireSkipVimp1AdIsPlaying(e){var i=e===o.CONSTS.RV_TYPES.NON_RV?l.skipVimp1Vimp0Playing:l.skipVimp1Vimp1Playing;this._fireOpp(i.id,i.name),this.reportFunc(i.name,{otherAdRequiredViewbility:this.model.get("activeAdData.requiredViewability"),otherAdPlayerSequenceId:this.model.get("activeAdData.tagData.sequenceId"),otherAdDp:this.model.get("activeAdData.dp")},!1)}onConversion(){this.hadConversion||(this.shouldFirePauseAfterPlay=!0,this.hadConversion=!0,this._fireOpp(l.conversion.id,l.conversion.name),this.reportFunc(l.conversion.name,{},!0))}fireAdUnmuted(){this.adUnmutedOppFired||(this._fireOpp(l.adUnmuted.id,l.adUnmuted.name),this.adUnmutedOppFired=!0)}onFirstPauseAfterPlay(){var e;if(this.shouldFirePauseAfterPlay&&!this.isViewed){this.shouldFirePauseAfterPlay=!1,this.isFirstPauseAfterPlay=!0;var i=this.subModel?this.subModel.get("videoViewContainer"):this.model.get("videoViewContainer");i=null!==(e=i[0])&&void 0!==e?e:i,this.adData.pap=p.offsetFromBottomOfViewPort(i)+n(i).height()>0?1:0,this._fireOpp(l.pauseAfterPlay.id,l.pauseAfterPlay.name),this.reportFunc(l.pauseAfterPlay.name,{tab:this.model.get("isInTab")},!0),this.model.get("isInTab")?this.adData.pap?(this._fireOpp(l.pauseAfterPlayScrolledUp.id,l.pauseAfterPlayScrolledUp.name),this.reportFunc(l.pauseAfterPlayScrolledUp.name,{},!0)):(this._fireOpp(l.pauseAfterPlayScrolledDown.id,l.pauseAfterPlayScrolledDown.name),this.reportFunc(l.pauseAfterPlayScrolledDown.name,{},!0)):(this._fireOpp(l.pauseAfterPlaySwitchedTab.id,l.pauseAfterPlaySwitchedTab.name),this.reportFunc(l.pauseAfterPlayScrolledUp.name,{},!0))}}onResume(){this.isFirstPauseAfterPlay&&(this.isFirstPauseAfterPlay=!1,this._fireOpp(l.resumeAfterFirstPause.id,l.resumeAfterFirstPause.name))}onViewabilityOneS(){this._fireOpp(l.viewabilityOneS.id,l.viewabilityOneS.name)}onViewability(){this.isViewed=!0,this._fireOpp(l.viewability.id,l.viewability.name),this.reportFunc(l.viewability.name,{},!0)}onViewability100(){this._fireOpp(l.viewability100.id,l.viewability100.name)}onCompView100(){this._fireOpp(l.compView100.id,l.compView100.name)}fireContinueAd(){this.isContinueAdFired||(this.isContinueAdFired=!0,this._fireOpp(l.continueAd.id,l.continueAd.name),this.reportFunc(l.continueAd.name,{tab:this.model.get("isInTab")},!0))}onAdClicked(){this._fireOpp(l.clickThru.id),this.reportFunc(l.clickThru.name,{},!0),this.model.set("clickThruState",d.Z.clickThruState.waiting)}onAdDetached(){this.model.get("opps.detach.isFire")&&(this._fireOpp(l.detach.id),this.reportFunc(l.detach.name,{},!0))}onAdAttached(){this.model.get("opps.attach.isFire")&&(this._fireOpp(l.attach.id),this.reportFunc(l.attach.name,{},!0))}fireTitleContaineClick(e){var i=l[e];i&&this._fireOpp(i.id,i.name)}_fireOpp(e,i,t){if(this.adData&&e&&!this.model.get("isFireOppBlocked")){i&&this.log.info("Fire ".concat(i," opps"));var a={uv:this.unitVersion},s=this.getAdData();this._setExtraData(a,s),this._setModifiedPlacement(s);var d={tagItem:this.adData,playerDAST:this.adData.pdast,activeData:s,predictorId:this.predictId,extraData:a};r.Z.oppsula.send(d,e)}}_setExtraData(e,i){e.pv=this.model.get("playerVersion"),i&&(e.su=i.su)}_getAbTest(){return"".concat(this.model.get("abTest")).concat(this.adData.requiredViewabilityDrawn?"!ronrv":"").concat(p.isMidArticleOnReadMorePage(this.model.get("isHip"))?"!rdmr":"")}isBillableEvent(e){return this.model.get("billableEvents").indexOf(e)>-1}setSubModel(e){this.subModel=e}_onSecondsToCloseGlobal(){this.reportFunc("secondsToCloseGlobal",{},!0)}_onCloseButtonClick(){this.reportFunc("closeButtonClick",{},!0)}_setSubUnitData(e,i){var t=this.model.get("isFireSP");for(var a in t){if(e!==parseInt(a)||!t[a])break;var s=this.getAdData();void 0!==s.sp&&(i.sp=s.sp)}var d=this.model.get("subUnitType");i.su||0===i.su||(i.su=d)}_setModifiedPlacement(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.model.get("modifiedPlacement");null!==(e=this.adData)&&void 0!==e&&e.hip&&t&&(i.mp=t)}_setCmTagParams(e){var i=this.model.get("oppsQS")||{};p.assignWithoutUndefinedValues(e,i)}adSwappedOut(){this._fireOpp(l.adSwappedOut.id,l.adSwappedOut.name),this.reportFunc(l.adSwappedOut.name,{},!0)}adSwappedIn(){this._fireOpp(l.adSwappedIn.id,l.adSwappedIn.name),this.reportFunc(l.adSwappedIn.name,{},!0)}adResumeAfterSwapOut(){this._fireOpp(l.adResumeAfterSwapOut.id,l.adResumeAfterSwapOut.name),this.reportFunc(l.adResumeAfterSwapOut.name,{},!1)}onOneSecondNoPlaySamePlace(){this._fireOpp(l.oneSecondNoPlaySamePlace.id,l.oneSecondNoPlaySamePlace.name),this.reportFunc(l.oneSecondNoPlaySamePlace.name,{},!0)}onOneSecondNoPlayScrolledUp(){this._fireOpp(l.oneSecondNoPlayScrolledUp.id,l.oneSecondNoPlayScrolledUp.name),this.reportFunc(l.oneSecondNoPlayScrolledUp.name,{},!0)}onOneSecondNoPlayScrolledDown(){this._fireOpp(l.oneSecondNoPlayScrolledDown.id,l.oneSecondNoPlayScrolledDown.name),this.reportFunc(l.oneSecondNoPlayScrolledDown.name,{},!0)}onDisplayingFullNAS(){this.model.get("opps.displayingFullNAS.isFire")&&(this._fireOpp(l.displayingFullNAS.id,l.displayingFullNAS.name),this.reportFunc(l.displayingFullNAS.name,{},!0))}onDisplayingNASTitleOnly(){this.model.get("opps.displayingNASTitleOnly.isFire")&&(this._fireOpp(l.displayingNASTitleOnly.id,l.displayingNASTitleOnly.name),this.reportFunc(l.displayingNASTitleOnly.name,{},!0))}fireGenericOpp(e){var i=l[e];i&&(this._fireOpp(i.id,i.name),this.reportFunc(i.name,{},!0))}fireBeaconOpp(e){var i=l[e];i&&(this._fireOpp(i.id,i.name,!0),this.reportFunc(i.name,{},!0))}onAdPlayingNextAdReadyRV1(){this._fireOpp(l.adPlayingNextAdReadyRV1.id,l.adPlayingNextAdReadyRV1.name),this.reportFunc(l.adPlayingNextAdReadyRV1.name,{},!0)}onAdPlayingRV1StackWithRV0(){this._fireOpp(l.adPlayingRV1insteadRV0.id,l.adPlayingRV1insteadRV0.name),this.reportFunc(l.adPlayingRV1insteadRV0.name,{},!0)}hadViewabilityAfterConversion(){return this.hadConversion&&this.isViewed}outOfTab(){this._fireOpp(l.outOfTab.id,l.outOfTab.name)}backToTab(){this._fireOpp(l.backToTab.id,l.backToTab.name)}stickyDisabled(){this._fireOpp(l.stickyDisabled.id,l.stickyDisabled.name)}adWaitForPubVideoToStop(){this._fireOpp(l.adWaitForPubVideoToStop.id,l.adWaitForPubVideoToStop.name)}onImpressionError(){this._fireOpp(l.onImpressionError.id,l.onImpressionError.name)}onNativeAdCallToActionButtonClick(){this._fireOpp(l.nativeAdCallToActionButtonClick.id,l.nativeAdCallToActionButtonClick.name)}adRenderedOnFeedIndexLessThanSCMitigationCard(){this._fireOpp(l.adRenderedOnFeedIndexLessThanSCMitigationCard.id,l.adRenderedOnFeedIndexLessThanSCMitigationCard.name)}adRenderedOnFeedIndexEqualsSCMitigationCard(){this._fireOpp(l.adRenderedOnFeedIndexEqualsSCMitigationCard.id,l.adRenderedOnFeedIndexEqualsSCMitigationCard.name)}adRenderedOnFeedIndexLargerThanSCMitigationCard(){this._fireOpp(l.adRenderedOnFeedIndexLargerThanSCMitigationCard.id,l.adRenderedOnFeedIndexLargerThanSCMitigationCard.name)}adInSCMitigationFlow(){this._fireOpp(l.adInSCMitigationFlow.id,l.adInSCMitigationFlow.name)}onOpenOutOfView(){this.model.get("isEligibleToPlay")&&this.model.get("adState")!==d.Z.adState.renderOutOfView||this._fireOpp(l.renderOutOfView.id,l.renderOutOfView.name)}}const g=h;var c,m=t(853),u=t(249),v=t(999);class S extends a.O{constructor(e){super(),this.model=e.model||{},this.log=new s.Z({unitType:this.model.get("unitType"),className:constructor.name,version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.configHierarchy=this._getConfigHierarchy()}_getConfigHierarchy(){return v.sortBy(u.B,(function(e){return e.priority})).reverse()}getConfig(e){var i={};for(var t in this.configHierarchy){var a=this.configHierarchy[t].name,s=e[a],d=u.B[a];s&&d&&(this.log.info("creating config for",a),v.extend(i,this._getDefaultConfig(a)),v.extend(i,this._getUnitConfig(a)))}return i}getConfigForKey(e){var i={},t=u.B[e]&&u.B[e].name;return t&&(this.log.info("creating config for",t),v.extend(i,this._getDefaultConfig(t)),v.extend(i,this._getUnitConfig(t))),i}_getDefaultConfig(e){return u.B[e].defaultConfigFile}_getUnitConfig(e){var i=this.model.get("unitType"),t=u.B[e]&&u.B[e].unitsConfigFiles;return t&&t[i]}}const A=function(e){return c||(c=new S(e)),c};var y=t(999);class b{constructor(e){this.model=e.model,this.subModel=e.subModel?e.subModel:null,this.observerOptions={root:null,rootMargin:"0px",threshold:y.buildObserverThresholdList()},this.model.get("detachToSlider.isStartFromSlider")?this._createSliderObserver():this._createFeedObserver()}_createSliderObserver(){this.intersectionObserver=new IntersectionObserver(function(e){e.map((e=>{this.updateModel("isViewableAMP",e.intersectionRect.height+5>=this.model.get("detachToSlider.height"))}))}.bind(this),this.observerOptions)}_createFeedObserver(){this.intersectionObserver=new IntersectionObserver(function(e){e.map((e=>{this.updateModel("isViewableAMP",e.intersectionRatio>.5)}))}.bind(this),this.observerOptions)}startObserver(e){this.updateModel("isViewableAMP",!1),this.intersectionObserver.observe(e)}stopObserver(e){this.intersectionObserver.unobserve(e),this.intersectionObserver.disconnect()}updateModel(e,i){null!=this.subModel&&this.subModel.set(e,i),this.model.set(e,i)}}var T=t(120),f=t(999),O=t(84),P=t(316);function C(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);i&&(a=a.filter((function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable}))),t.push.apply(t,a)}return t}function w(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{};i%2?C(Object(t),!0).forEach((function(i){V(e,i,t[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}))}return e}function V(e,i,t){var a;return(i="symbol"==typeof(a=function(e,i){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,i||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(e)}(i,"string"))?a:String(a))in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function _(e,i,t,a,s,d,r){try{var o=e[d](r),n=o.value}catch(e){return void t(e)}o.done?i(n):Promise.resolve(n).then(a,s)}class I extends a.O{constructor(e){var{model:i,ppKey:t,adId:a,impressionCb:r,completeCb:o,predictName:n,getAdProperties:p,predictId:l}=e;super(i),this.model=i,this.elasticLogger=this.model.get("elasticLogger"),this.getAdKey=isNaN(parseInt(t))?t:parseInt(t),this.adId=a,this.impressionCb=r,this.completeCb=o,this.predictName=n,this.predictId=l,this.scrollManager=new m.Z,this.getAdProperties=p||{},this.log=new s.Z({unitType:this.model.get("unitType"),className:"adService",version:this.model.get("version"),isDebug:this.model.get("isDebug")}),this.adState=d.Z.readyState,this.getAdState=d.Z.getAdState.notCalled,this.adQState=d.Z.adQState.readyState,this.hadPlay=!1,this.isActive=!1,this.hadImpression=!1,this.sizeObj={},this.adClickCounter=0,this.onAdImpressionTimer=null,this.onAdImpressionTimerMp4=null,this._bindEvents(),this._onPlayerStateReady(),this._getAd(),this.isLostView100=!1,this.allowReportCardOnlyOnce=!0,this.allowReportMitigationOnlyOnce=!0,this.getAdExtraOptions=null}_bindEvents(){this.createStateHandlers([{event:"adManagerState:paused",funcName:"_pauseGetAd",isListenOnce:!0},{event:"adManagerState:stopped",funcName:"_stopGetAd",isListenOnce:!0},{event:"playerState:ready",funcName:"_onPlayerStateReady",isListenOnce:!0},{event:"adViewabilityFired:true",funcName:"adViewabilityFired",isListenOnce:!0},{event:"adConversionFired:true",funcName:"adConversionFired",isListenOnce:!0},{event:"adWaitForPubVideoToStop",funcName:"_onAdWaitForPubVideoToStop",isListenOnce:!0}])}_bindOnTabEvent(){this.createStateHandlers([{event:"isInTab:false",funcName:"_outOfTabEvent",isListenOnce:!0},{event:"isInTab:true",funcName:"_backToTabEvent",isListenOnce:!0}])}_onPlayerStateReady(){!this.player&&r.Z.player&&(this.player=r.Z.player)}_pauseGetAd(){this.cancelGetAd(),this.getAdState=d.Z.getAdState.stopped,this.setToModel("getAdState",d.Z.getAdState.stopped),this.model.get("isReplayAd")||(this.player=void 0)}_stopGetAd(){this.cancelGetAd(),this.getAdState=d.Z.getAdState.finished,this.player=void 0}adViewabilityFired(){if(this._hasVpaidWrapper()&&this.vpaidWrapper.emit){this.vpaidWrapper.emit("unit::viewability");var e=this.vpaidWrapper.getVpaidData(),i=e&&e.eventTrackers&&e.eventTrackers.viewability;f.each(i,this._sendPixel,this)}this.isViewabilityFired=!0}adConversionFired(){this._hasVpaidWrapper()&&this.vpaidWrapper.emit&&(this._setBottomOfVViewPort(),this.vpaidWrapper.emit("unit::conversion"))}_getAd(){var e,i=this;return(e=function*(){if(!i._hasPlayer()||!i.player.getAd)return i.setToModel("getAdCurrId",i.adId),void setTimeout((()=>i.setToModel("getAdState",d.Z.getAdState.failed)),0);i.getAdState===d.Z.getAdState.gettingAd?(i.log.info("[adID=".concat(i.adId,"] getAd was called while trying to get an ad from player")),i.model.trigger("change:getAdState",i.model,d.Z.getAdState.gettingAd)):(i.setToModel("getAdState",d.Z.getAdState.gettingAd),i.getAdState=d.Z.getAdState.gettingAd),i.model.set("lastGetAdKey",i.getAdKey),i._setAdExclusions(i.model.get("exclusionOptions")),i.getAdPPS=i.scrollManager.pps,i.getAdPPSChange=i.scrollManager.ppsChange;var e=Date.now();i.adRequestTime=e;var t={getAdTimeout:i._getTimeOut(),adProperties:i.getAdProperties.adProperties,excAdProperties:i.getAdProperties.excAdProperties,forceWf:i.model.get("exploreMore")>0,predictId:i.predictId,preferPPD:i.model.get("PPD.preferPPD"),ppdAdImpressionTimeout:i.model.get("PPD.ppdTimeout"),extraOptions:w({},i.getAdExtraOptions),requiredViewability:"any"!==i.getAdKey?i.getAdKey:void 0};try{i.getAdResult=i.player.getAd(t),i.getAdResult&&"function"==typeof i.getAdResult.then||i.log.error("getAd did not return a valid promise or returned undefined"),yield i.getAdResult.then(i._getAdResult.bind(i)).catch(i._getAdRejection.bind(i)).finally((()=>{i.getAdKey===o.CONSTS.RV_TYPES.RV&&(i.model.set("isGettingRv1Ad",!1),i.model.set("immediateStartAdInPrediction",!1))}))}catch(e){i.log.error("getAd Failed in auction manager",e),i.setToModel("getAdState",d.Z.getAdState.failed)}},function(){var i=this,t=arguments;return new Promise((function(a,s){var d=e.apply(i,t);function r(e){_(d,a,s,r,o,"next",e)}function o(e){_(d,a,s,r,o,"throw",e)}r(void 0)}))})()}_setAdExclusions(e){if(e){var{excAdType:i,excReason:t}=e,a=i===o.CONSTS.ADX.ITEM_TYPE&&(f.isArray(t)?t.includes(o.CONSTS.EXC_REASONS.PUBVIDEO):t===o.CONSTS.EXC_REASONS.PUBVIDEO),s=i===o.CONSTS.ADX.ITEM_TYPE&&(f.isArray(t)?t.includes(o.CONSTS.EXC_REASONS.DETACH_TO_SLIDER):t===o.CONSTS.EXC_REASONS.DETACH_TO_SLIDER)&&this.model.get("videoViewState")!==d.Z.videoViewState.attached;a&&(this.model.set("beforeGetAd","checkPubVideo"),this.model.get("isPubVideoReady")&&(this._excludeADXAd("pubVideoDetected"),this.getAdExtraOptions={adxPubVideoPreventing:!0})),s&&this._excludeADXAd("notAttachedToSelector")}}_excludeADXAd(e){var i={t:[o.CONSTS.ADX.ITEM_TYPE],advId:[o.CONSTS.ADX.ADVERTISER],advType:[o.CONSTS.ADX.ADVTYPE]};this.getAdProperties.excAdProperties?this.getAdProperties.excAdProperties=Object.assign(this.getAdProperties.excAdProperties,i):this.getAdProperties.excAdProperties=i,this.reportToVpaid("adxAdExcluded",{reason:e,adType:"adx"},!1)}_getAdRejection(e){this.getAdResult=void 0,this.model.set("getAdSuccess",!1),this.getAdState=d.Z.getAdState.failed,this.setToModel("getAdCurrId",this.adId),this.setToModel("getAdState",d.Z.getAdState.failed),this.log.error("getAdResult promise rejected: ".concat(e.message," ")),this.log.info("GetAd failed requiredViewability: ".concat(this.getAdKey),this.adId)}_getAdResult(e){try{var i;if(f.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoGotAd",o.CONSTS.TRC_PERFORMANCE_ACTIONS.START),this.vpaidWrapper=e,this._setAdTypeConfig(),this.rpox=e.tag.rpox,this.vpaidData=this.vpaidWrapper.getVpaidData(),this.adData=f.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon","requiredViewability","rpox","hip","alwsldr","oneSecViewbility"]),this.adData.cpm=this.vpaidWrapper.tag.vpaidWrapperData&&this.vpaidWrapper.tag.vpaidWrapperData.vastPrice?this.vpaidWrapper.tag.vpaidWrapperData.vastPrice:this.vpaidWrapper.tag.price,this.adData.requiredViewability=f.parseBool(this.adData.requiredViewability),this.adData.getAdPPS=this.getAdPPS,this.adData.advType=null!==(i=this.vpaidWrapper.tag.advType)&&void 0!==i?i:"-1",this.adData.getAdPPSChange=this.getAdPPSChange,this.adData.timeToVimp=Date.now()-this.adRequestTime,this.model.get("bottomOfViewPortDebugSelector")&&this.bottomOfViewPortOnGetAd){var t=O(this.model.get("bottomOfViewPortDebugSelector"));this.adData.bovpg=!!this.bottomOfViewPortOnGetAd&&parseInt(this.bottomOfViewPortOnGetAd),this.adData.bovpv=t.length>0&&parseInt(f.offsetFromBottomOfViewPort(t[0]))}this.adData.dast=this.vpaidWrapper.tag.vidDast||this.vpaidWrapper.tag.dast,this.adData.mty=this.vpaidWrapper.tag.vpaidWrapperData&&this.vpaidWrapper.tag.vpaidWrapperData.mediatype?this.vpaidWrapper.tag.vpaidWrapperData.mediatype:void 0,this.setToModel("currentMediatype",this.adData.mty),this.adData.requiredViewabilityDrawn=this.vpaidWrapper.tag.requiredViewabilityDrawn||!1,this.vpaidWrapper.playerDAST&&this.vpaidWrapper.playerDAST.get&&(this.adData.pdast=this.vpaidWrapper.playerDAST.get()),this.adData.hip=!!this.vpaidWrapper.tag.hip,this.vpaidWrapper.vpaidLog.data.unit_history=[],this.reportToVpaid("gotAd",{tab:this.model.get("isInTab"),eligibility:this.model.get("isEligibleToPlay"),gotVimpCountQ:this.model.get("impressionCount"),hadEligibility:this.model.get("hadEligibility"),hadLostEligibility:!!this.model.get("lostEligibilityTime"),predictName:this.predictName,getAdKey:"any"===this.getAdKey?10:this.getAdKey,allowSlider:!!this.adData.alwsldr,oneSecViewbility:!!this.adData.oneSecViewbility},!1),this._logEventUsingElasticLogger("getAd resolve"),this.setToModel("lastGotAdData",this.adData),this.model.get("lastImpressionData.sequenceId")?this.sequenceId=this.model.get("lastImpressionData.sequenceId")+1:this.sequenceId=1;var a=void 0;return this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.data&&(a=this.vpaidWrapper.vpaidLog.data._id),this.lastImpressionData={predictPoint:this.predictPoint,requiredViewability:this.vpaidWrapper.tag.requiredViewability,getAdKey:"any"===this.getAdKey?10:this.getAdKey,sequenceId:this.sequenceId,dp:this.vpaidWrapper.tag.dp,tagData:f.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]),vpaidId:a,lineItemId:this.vpaidWrapper.tag.lineItemId,predictName:this.predictName},this.setToModel("lastImpressionData",this.lastImpressionData),this.setToModel("impressionCount",this.model.get("impressionCount")+1),this.oppsService=new g({model:this.model,adData:this.adData,vpaidData:this.vpaidData,reportFunc:this.reportToVpaid.bind(this),getAdDataFunc:this.getAdData.bind(this),predictId:this.predictId}),this.log.info("GotAd requiredViewability: ".concat(e.tag.requiredViewability?1:0)),this.getAdState=d.Z.getAdState.gotAd,this.setToModel("getAdState",d.Z.getAdState.gotAd),this.getAdResult=void 0,this._setHipAd(this.vpaidData),this._setVastClickUrl(this.vpaidData),this._registerListeners(),this._onAdImpression(e),this.model.set("getAdSuccess",!0),this._bindOnTabEvent(),this._setAdRV(),this.model.get("isOpenInViewPort")||(this.oppsService.onOpenOutOfView(),this.setAdParametersToModel()),null}catch(e){this._clearOnAdImpressionTimer(),this.oppsService&&this.oppsService.onImpressionError(),this.log.error(e)}finally{f.trcPerformanceMeasurement(this.model.get("trcPerformanceMeasurementEnabled"),"videoGotAd",o.CONSTS.TRC_PERFORMANCE_ACTIONS.STOP)}}_registerListeners(){this.vpaidWrapper.on&&(this.vpaidWrapper.on("AdError",this._onAdError.bind(this)),this.vpaidWrapper.on("AdVideoFirstQuartile",this._onAdVideoFirstQuartile.bind(this)),this.vpaidWrapper.on("AdVideoMidpoint",this._onAdVideoMidpoint.bind(this)),this.vpaidWrapper.on("AdVideoThirdQuartile",this._onAdVideoThirdQuartile.bind(this)),this.vpaidWrapper.on("end",this._adVideoEnd.bind(this)),this.vpaidWrapper.on("AdClickThru",this._onAdClickThru.bind(this)),this.vpaidWrapper.on("activeAdCurrentTime",this._onActiveAdCurrentTime.bind(this)),this.vpaidWrapper.on("NewCompletion",this._onNewCompletion.bind(this)))}_onActiveAdCurrentTime(e){this.isCompleted||(this.setToModel("activeAdCurrentTime",e.currentTime),this.setToModel("activeAdMaxTime",e.duration))}_onAdImpression(e){(this.vpaidWrapper.pauseAd(),this.reportToVpaid("pauseAdCalled",{reason:"pauseOnAdImpression",tab:this.model.get("isInTab")},!1),this._bringToBack(),this.log.info("onAdImpression (got ad - pausing ad)",this.adId),this.hadImpression=!0,this.rpox=e.tag.rpox,this.adQState=d.Z.adQState.impression,this.model.get("videoReelCompensation"))&&(this.model.get("unitType")===o.CONSTS.VIDEO_REEL.NAME&&cmTag.set("isVidReelPlaying",!0));var i={lineItemId:this.model.get("lineItemId"),placement:this.model.get("placement"),redId:this.model.get("redId")};this.model.get("isSendCPM")&&(i.cpm=this.adData.cpm),P.trigger("onImpression",i);var t=e.getVpaidData();this.adData.timeToImpression=t.startTimestamp?Date.now()-t.startTimestamp:void 0,this.model.get("adQState")===d.Z.adQState.impression?setTimeout(this.model.trigger.bind(this.model,"change:adQState",this.adQState),0):setTimeout(this.setToModel.bind(this,"adQState",this.adQState),0),this.impressionCb(this),f.sendingEventToTaboolaBridge("impression",this.adId),this.adData.requiredViewability&&(this.setToModel("player.settings.startDelay",0),this._startOneSecondNoPlayTimer()),this._logEventUsingElasticLogger("ad impression")}_onAdError(e){this._clearOnAdImpressionTimer(),this.log.error("Vpaid Wrapper Error, key: "+this.getAdKey,this.adId),f.sendingEventToTaboolaBridge("adError",this.adId)}_onAdVideoFirstQuartile(){this.hadPlay&&(this.adQState=d.Z.adQState.q1,this.setToModel("adQState",d.Z.adQState.q1,this.adId),this.log.info("AdVideoFirstQuartile"),f.sendingEventToTaboolaBridge("firstQuartile",this.adId))}_onAdVideoMidpoint(){this.hadPlay&&(this.adQState=d.Z.adQState.q2,this.setToModel("adQState",d.Z.adQState.q2,this.adId),this.log.info("AdVideoMidpoint"),f.sendingEventToTaboolaBridge("midpoint",this.adId))}_onAdVideoThirdQuartile(){this.hadPlay&&(this.adQState=d.Z.adQState.q3,this.setToModel("adQState",d.Z.adQState.q3,this.adId),this.log.info("AdVideoThirdQuartile"),f.sendingEventToTaboolaBridge("thirdQuartile",this.adId))}_adVideoEnd(e){if(this.player){var i=this.subModel||this.model;if(this.model.get("isReplayAd")||i.stopListening(i,"change:nativeAdClick"),this.isAdxAd){var t=this.model.get("adxSessionDuration")||0;this.model.set("adxSessionDuration",t+e.adElapsedDuration)}if(this._setAdPlayingWithAdChoice(!1),this.log.info("on ad video end",this.adId),this.reportToVpaid("vpaidDone",{tab:this.model.get("isInTab")},!0),this.isCompleted=!0,!this.hadPlay)return this.adState=d.Z.adState.autoKill,void this.completeCb(this,!0);this.setToModel("activeTag",void 0),this.adQState=d.Z.adQState.completed,this.adState=d.Z.adState.completed,this.completeCb(this,!1),this.model.get("isReplayAd")||(this.vpaidWrapper=void 0,this.setToModel("activeAdData",void 0)),this.setOrTrigger("adQState",this.adQState),this.setOrTrigger("adState",this.adQState),this.getAdState=d.Z.getAdState.stopped,f.sendingEventToTaboolaBridge("complete",this.adId),this.onCompView100(),this._stopRV1Observer()}}_onAdClickThru(){this._clearOnAdImpressionTimer(),this.setToModel("clickThruState",d.Z.clickThruState.clicked),this.oppsService.onAdClicked(),1==++this.adClickCounter&&f.sendingEventToTaboolaBridge("adClick",this.adId),this.reportToVpaid("adClickCounter",{number:this.adClickCounter},!1)}_onTitleContainerClick(){if(this._hasVpaidWrapper()){this.oppsService&&!this.nativeAdCTAButtonClicked&&(this.nativeAdCTAButtonClicked=!0,this.oppsService.onNativeAdCallToActionButtonClick()),this.vpaidWrapper.triggerClick&&this.vpaidWrapper.triggerClick();var e=this.getFromModel("nativeAdClick");this.oppsService.fireTitleContaineClick(e),this._onAdClickThru()}}_onLearnMoreClick(){this._hasVpaidWrapper()&&this._onAdClickThru()}_bringToFront(){if(this.vpaidWrapper.localTarget){var e=this.model.get("style.videoBackgroundColor");O(this.vpaidWrapper.localTarget).css({zIndex:1e3,display:"block",backgroundColor:e})}}_bringToBack(){this.vpaidWrapper.localTarget&&O(this.vpaidWrapper.localTarget).css({zIndex:0})}_hasVpaidWrapper(){return this._hasPlayer()&&this.vpaidWrapper}_hasPlayer(){return this.player&&!this.player.playerIsClosed}setActiveTag(){this.log.info("setActiveTag",this.adId);var e=f.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]);this.model.get("activeTag")!==e&&this.setToModel("activeTag",e)}getAdData(){var e;if(this.vpaidWrapper){var i=void 0;this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.data&&(i=this.vpaidWrapper.vpaidLog.data._id);var t={adId:this.adId,itemType:null===(e=this.vpaidWrapper)||void 0===e||null===(e=e.tag)||void 0===e?void 0:e.t,predictPoint:this.predictPoint,requiredViewability:this.vpaidWrapper.tag?f.parseBool(this.vpaidWrapper.tag.requiredViewability):void 0,getAdKey:"any"===this.getAdKey?10:this.getAdKey,sequenceId:this.sequenceId,dp:this.vpaidWrapper.tag?this.vpaidWrapper.tag.dp:void 0,rpox:this.rpox,hip:this.vpaidWrapper.tag?this.vpaidWrapper.tag.hip:void 0,allowSlider:this.vpaidWrapper.tag?this.vpaidWrapper.tag.alwsldr:void 0,oneSecViewbility:this.vpaidWrapper.tag?this.vpaidWrapper.tag.oneSecViewbility:void 0,isCompleted:this.isCompleted,tagData:f.filterObject(this.vpaidWrapper.tag,["sequenceId","rollType","waterfallTagId","created","dast","cpmFloor","pubId","tagId","dp","isRon"]),vpaidId:i,singleAd:this.vpaidWrapper.tag?this.vpaidWrapper.tag.singleAd:void 0,mediatype:this.vpaidWrapper.tag&&this.vpaidWrapper.tag.vpaidWrapperData?this.vpaidWrapper.tag.vpaidWrapperData.mediatype:void 0};return this._setSubUnitData(t),t}}isPWOV(){return!(!this.vpaidWrapper||!this.vpaidWrapper.pwov)&&(this.model.get("isPWOV")&&f.isFactor(100/this.vpaidWrapper.pwov))}_shouldPWOVAfterOneSec(){return this.adData.requiredViewability&&this.adData.oneSecViewbility}_checkRequiredViewabilityForPWOV(){return this._shouldPWOVAfterOneSec()?this.isViewedOneS:this.isViewabilityFired}pause(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.CONSTS.PAUSE_REASONS.UNKNOWN;if((this.model.get("isInTab")&&"continueAd"===this.model.get("onOutOfView")||this.isPWOV())&&this._checkRequiredViewabilityForPWOV()&&!this.model.get("blockedByExternalUnit"))return this.log.info("onOutOfView continueAd",this.adId),this.setToModel("adState",d.Z.adState.continueAd),this.adState=d.Z.adState.continueAd,this.oppsService.fireContinueAd(),void(this.isLostView100=!0);this._hasVpaidWrapper()&&(this.log.info("Pause ad",this.adId),this.vpaidWrapper.pauseAd(),this._setBottomOfVViewPort(),this.oppsService.onFirstPauseAfterPlay(),this._logEventUsingElasticLogger("ad pause",T.b.WARNING,{pauseReason:e}),this.reportToVpaid("pauseAdCalled",{reason:"outOfView",tab:this.model.get("isInTab")},!1)),this.setToModel("adState",d.Z.adState.paused),this.adState=d.Z.adState.paused}skipAd(){this.log.info("Skip ad",this.adId),this.setToModel("isReplayAd",!1),this._hasVpaidWrapper()&&this.vpaidWrapper.skipAd(),this.setToModel("adState",d.Z.adState.skipped),this._clearOnAdImpressionTimer()}play(){this._clearOnAdImpressionTimer(),this.model.set("lastActiveAd",this.adId),this.log.info("playing ad",this.adId);var e=this.getAdData();this._overridePreviousSingleAdConfiguration(e),this.setToModel("activeAdData",e),this._isADXad(e)&&(this.model.set("playedADX",!0),this.isAdxAd=!0),this._hasVpaidWrapper()&&(this._updateAdChoiceVisibility(),this._keepReplayableAdAlive(),this.model.get("isToggleIframeContent")&&this.vpaidWrapper.toggleIframeContentDisplay&&this.vpaidWrapper.toggleIframeContentDisplay("show")),this.hadPlay||(this.hadPlay=!0,this.log.info("Winning ad: "+this.getAdKey,this.adId),this.model.get("isMultiActiveAds")||(this._bringToFront(this.vpaidWrapper),O(this.vpaidWrapper.adTarget).removeClass("_cm-ad")),this.setActiveTag(),this._checkIfStartRV1Observer(),this.adQState=d.Z.adQState.q0,this.setToModel("adQState",d.Z.adQState.q0),this.setToModel("adDuration",this.vpaidData.duration),this.oppsService.onConversion(),this.adConversionFired(),this.setAdParametersToModel()),this._hasVpaidWrapper()?(this.log.info("resumeAd VpaidWrapper is alive ",this.adId),this._bringToFront(this.vpaidWrapper),this.oppsService.onResume(),this.vpaidWrapper.resumeAd(),this.model.set("hadPlayedAd",!0),this.allowReportMitigationOnlyOnce&&this.inSCMitigationFlow&&this._reportInSCMitigationFlow(),this.allowReportCardOnlyOnce&&this.model.get("SCMitigationFlow")&&this.model.get("cardNumForRV0")&&this._reportFeedCardIndexOpp(this.model.get("cardNumForRV0")),this.reportToVpaid("resumeAdCalled",{tab:this.model.get("isInTab")},!1),this._logEventUsingElasticLogger("ad play")):this.log.warning("resumeAd failed VpaidWrapper is NOT alive ",this.adId),setTimeout(this._firePlayEvents.bind(this),0),this.start||(this.start=!0,f.sendingEventToTaboolaBridge("start",this.adId));var i=this.getCurrModel();this.isLostView100||(this.isLostView100=!i.get("isViewable100"),this.isViewabilityListenerSet||this.isLostView100||(i.on("change:isViewable100",this.onViewabile100Change.bind(this)),this.isViewabilityListenerSet=!0))}_overridePreviousSingleAdConfiguration(e){e&&!e.singleAd&&(this.model.set("isReplayAd",!1),this.model.set("isKeepViewOnMidroll",!1))}_isADXad(e){return e.itemType===o.CONSTS.ITEM_TYPE.IMA}_setHipAd(e){e.hip&&this.setToModel("isHipAd",!0)}_setVastClickUrl(e){e.vastClickThruLink&&this.setToModel("vastClickThruLink",e.vastClickThruLink)}_firePlayEvents(){this.adState=d.Z.adState.playing,this.setToModel("adState",d.Z.adState.playing),P.trigger("global:adState:playing")}cancelGetAd(e){this.getAdResult&&(this.log.info("GetAd was cancelled",this.adId),this.getAdResult.cancel(e),this.getAdResult=void 0)}setToModel(e,i){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.model.set(e,i,t),this.subModel&&this.subModel.set(e,i,t)}getFromModel(e){return this.subModel?this.subModel.get(e):this.model.get(e)}setSubModel(e){this.subModel=e,this.oppsService&&this.oppsService.setSubModel(this.subModel)}getCurrModel(){return this.subModel?this.subModel:this.model}forceTrigger(e){this.model.trigger("change:"+e,this.model,this.model.get(e)),this.subModel&&this.subModel.trigger("change:"+e,this.subModel,this.subModel.get(e))}setOrTrigger(e,i){this.model.get(e)===i?this.forceTrigger(e):this.setToModel(e,i)}resize(e){e&&e.width&&e.height?this.sizeObj.width===e.width&&this.sizeObj.height===e.height||(this.sizeObj.width=e.width,this.sizeObj.height=e.height,this.log.info("resizing ad",O.extend({},e,{adId:this.adId,aspectRatio:this.aspectRatioString})),this.vpaidWrapper&&this.vpaidWrapper.resizeAd(e.width,e.height,this.aspectRatioString)):this.log.warning("resize was called with empty sizeObj!",e)}recheckSize(){var e=this.sizeObj;this.sizeObj={},this.resize(e)}mute(){this.vpaidWrapper&&(this.log.info("Mute Player"),this.vpaidWrapper.mute(),f.sendingEventToTaboolaBridge("volumeChange",0))}unmute(){this.vpaidWrapper&&(this.log.info("UnMute Player"),this.vpaidWrapper.unmute(),this.oppsService.fireAdUnmuted(),f.sendingEventToTaboolaBridge("volumeChange",100))}fireSkipVimp1EligibilityLost(e){this._clearOnAdImpressionTimer(),this.oppsService.fireSkipVimp1EligibilityLost(e)}fireSkipVimp1AdIsPlaying(e){this._clearOnAdImpressionTimer(),this.oppsService.fireSkipVimp1AdIsPlaying(e)}onAdPlayingRV1StackWithRV0(){this._clearOnAdImpressionTimer(),this.oppsService.onAdPlayingRV1StackWithRV0()}onViewability(){this.isViewed||(this.isViewed=!0,this.adViewabilityFired(),this.oppsService.onViewability(),this._logEventUsingElasticLogger("ad viewability"))}onViewabilityOneS(){this.isViewedOneS||(this.isViewedOneS=!0,this.oppsService.onViewabilityOneS())}onViewability100(){this.isViewed100||(this.setToModel("viewability100",!0),this.isViewed100=!0,this.oppsService.onViewability100())}onCompView100(){this.isLostView100||this.isCompViewed100||(this.isCompViewed100=!0,this.oppsService.onCompView100())}onDetached(){this.isDetached||(this.isDetached=!0,this.oppsService.onAdDetached())}onAttached(){this.isDetached&&(this.isDetached=!1,this.oppsService.onAdAttached())}onSliderClose(){this.isSliderClosed||(this.isSliderClosed=!0,this._clearOnAdImpressionTimer())}reportToVpaid(e,i,t){this._setSubUnitData(i),this._hasVpaidWrapper()&&this.vpaidWrapper.vpaidLog&&this.vpaidWrapper.vpaidLog.push&&(this.vpaidWrapper.vpaidLog.push("unit_".concat(e),i,!1),this.vpaidWrapper.vpaidLog.data&&this.vpaidWrapper.vpaidLog.data.unit_history&&this.vpaidWrapper.vpaidLog.data.unit_history.push&&this.vpaidWrapper.vpaidLog.data.unit_history.push(e),this.vpaidWrapper.vpaidLog.data&&this.vpaidWrapper.vpaidLog.data.statuses&&this.vpaidWrapper.vpaidLog.data.statuses.push&&this.vpaidWrapper.vpaidLog.data.statuses.push(e),t&&this.vpaidWrapper.vpaidLog.push("unit_state",{status:e},t))}reportRpoxSkip(e){this.reportToVpaid("skipRpox",{otherRpox:e.rpox,otherRequiredViewability:e.requiredViewability,otherAdDp:e.dp,otherSequenceId:e.sequenceId},!1)}reportPpKeySkip(e){this.reportToVpaid("skipPpKey",{otherRpox:e.rpox,otherRequiredViewability:e.requiredViewability,otherAdDp:e.dp,otherSequenceId:e.sequenceId},!1)}_setAdPlayingWithAdChoice(e){this.setToModel("adPlayingWithAdChoice",e)}_updateAdChoiceVisibility(){this.vpaidWrapper.hasAdChoices?this._setAdPlayingWithAdChoice(!0):this._setAdPlayingWithAdChoice(!1)}_reportInSCMitigationFlow(){this.allowReportMitigationOnlyOnce=!1,this.oppsService.adInSCMitigationFlow()}_reportFeedCardIndexOpp(e){this.allowReportCardOnlyOnce=!1;var i=this.subModel&&this.subModel.get("cardNumber")||this.model.get("cardNumber");i<e?this.oppsService.adRenderedOnFeedIndexLessThanSCMitigationCard():i==e?this.oppsService.adRenderedOnFeedIndexEqualsSCMitigationCard():i>e&&this.oppsService.adRenderedOnFeedIndexLargerThanSCMitigationCard()}_setSubUnitData(e){var i=this.model.get("subUnitType");if(this.model&&(i||0===i)&&(this._checkIfPlainSubUnit(i,e)?e.su=o.CONSTS.SUB_UNIT_TYPE.PLAIN:e.su=i),this.subModel){var t=this.model.get("detachToSlider"),a=this.subModel.get("gotFirstEligibility");t&&t.isStartFromSlider&&t.isDetachToSlider?e.sp=a?this.subModel.get("cardNumber"):0:t&&t.isStartFromSlider&&!this.subModel.get("isEligibleToPlay")?e.sp=0:this.model.get("cardNumber")&&(e.sp=this.model.get("cardNumber"))}else this.model.get("MSNCard.row")&&(e.sp=this.model.get("MSNCard.row"))}_isStickyDisabled(e){return e!==o.CONSTS.SUB_UNIT_TYPE.STICKY_BELOW||!this.model.get("enableStickyOnNonAllowSlider")}_checkIfPlainSubUnit(e,i){return e===o.CONSTS.SUB_UNIT_TYPE.STICKY_BELOW||!i.allowSlider&&this.model.get("isSliderCutOff")&&this._isStickyDisabled(e)}_logEventUsingElasticLogger(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T.b.INFO,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.elasticLogger&&e){var a=t;if(a.isEligible=this.model.get("isEligibleToPlay")||!1,a.adId=this.adId,this.vpaidWrapper){var s=this.getAdData(),d=this.vpaidWrapper.getVpaidData();a.requiredViewability=s.requiredViewability,a.predictPoint=s.getAdKey,a.isHipAd=s.hip||!1,a.isSingleAd=s.singleAd,a.allowSlider=1===s.allowSlider,a.lineItemId=d.lineItem||-1,a.campaignId=d.campaignId||-1,a.advertiserId=parseInt(d.advId)||-1,a.mediatype=o.CONSTS.MEDIA_TYPE_ID_TO_NAME[s.mediatype]}this.elasticLogger.log({message:e,severity:i,extraData:a})}}_setAdRV(){this.adData.requiredViewability?this.setToModel("gotRvAd",!0):this.setToModel("gotNonRvAd",!0)}_getTimeOut(){return this.model.get("vForce.secondsToGetAdFail.".concat(this.getAdKey))}_setAdTypeConfig(){if(this.vpaidWrapper&&this.vpaidWrapper.getVpaidData){var e=this.vpaidWrapper.getVpaidData();for(var i in this.adTypeTranslator=new A({model:this.subModel||this.model}),this.adTypeConfig={},e)if(e[i]){var t=this.adTypeTranslator.getConfigForKey(i);if(f.isEmpty(t))continue;if(this.log.info("got adTypeConfig for key "+i,t),t.revertAfter){var a=this._createRevertAdType(t,i);this._setAdTypeConfigAfter(t.revertAfter,a)}t.setAdConfigAfter?this._setAdTypeConfigAfter(t.setAdConfigAfter,t):this.setToModel(t),this.adTypeConfig[i]=t}else"singleAd"===i&&this._revertSingleAdConfig();this.aspectRatioNum=this.getAspectRatioNum(e),this.log.info("Ad size received is - width: "+e.adWidth+"; height: "+e.adHeight),this._setAdTypeConfigAfter("setSubModel",{aspectRatioNum:this.aspectRatioNum}),this.supportVideoCurrentTimeEvents=e.supportVideoCurrentTimeEvents}}_revertSingleAdConfig(){var e={setAdConfigAfter:"setSubModel",isPlacementSingleAd:!1,"continueToPlayInNexCard.isActive":!0};this._setAdTypeConfigAfter(e.setAdConfigAfter,e)}_setAdTypeConfigAfter(e,i){var t=this[e];f.isFunction(t)&&(this[e]=function(){t.apply(this,arguments),this.setToModel(i),this.log.info("setting ad type config after ".concat(t.name," function"),i)})}_createRevertAdType(e,i){var t={};for(var a in e)"setAdConfigAfter"!==a&&"revertAfter"!==a&&(t[a]=this.model.get(a));return t}onAdSetToUnits(){}_keepReplayableAdAlive(){var e=this.vpaidWrapper;e.dontDie&&this.model.get("isReplayAd")&&(e.isReplayable||this.model.get("isForceDontDie"))&&(e.dontDie(),this.model.set("dontRenderRepeatButton",!e.isReplayable))}setAdParametersToModel(){if(this.model.get("components.nativeAd.isActive")){var e=this.vpaidWrapper.getVpaidData(),i=this._getAdNativeSettingsFromVpaidData(e),t=this.subModel||this.model;e.adNativeSettings&&this.model.set("continueToPlayInNexCard.isActive",!1),this.setNativeAdClickListener(),this.setToModel("adNativeSettings",void 0,{silent:!0}),this.setToModel("adNativeSettings",i,{silent:!0}),t.trigger("change:adNativeSettings",t,t.get("adNativeSettings"))}this.vpaidWrapper.clickThruUrl?(this.log.info("updated click through URL",this.vpaidWrapper.clickThruUrl),this.setToModel("adClickThroughUrl",this.vpaidWrapper.clickThruUrl),this._setLearnMoreClickListener()):this.setToModel("adClickThroughUrl",""),this.setToModel("activeAdRV",this.adData.requiredViewability)}_getAdNativeSettingsFromVpaidData(e){var i=this.model.get("nativeAdMapping"),t=e.adNativeSettings||{};return this._isYahooPlacement()&&!t[i.branding]&&e.brand&&(t[i.branding]=e.brand),t}_isYahooPlacement(){return this.model.get("streamDrawerPlacement")}_setTagDataToStorage(){try{this.model.setStorage("activeAdData",this.vpaidWrapper.tag)}catch(e){this.log.error("error setting activeAdData",{error:e,tag:this.vpaidWrapper.tag})}}setNativeAdClickListener(){var e=this.subModel||this.model;e.listenTo(e,"change:nativeAdClick",this._onTitleContainerClick.bind(this))}_setLearnMoreClickListener(){var e=this.subModel||this.model;e.listenTo(e,"change:learnMoreClick",this._onLearnMoreClick.bind(this))}_sendPixel(e){"img"===e.method?(new Image).src=e.pixel:"js"===e.method&&this._sendJSPixel(e.pixel)}_sendJSPixel(e){var i=document.createElement("script");i.src=e,i.type="text/javascript",i.async=!0,document.body.appendChild(i)}getAspectRatioNum(e){if(e&&e.supportVerticalVideo){this.aspectRatioString=e.adWidth.toString()+":"+e.adHeight.toString();var i=e.adWidth/e.adHeight;if(i!==o.CONSTS.RATIOS.SQUARE)return i}else if(this.aspectRatioNum)return this.aspectRatioNum;return this.aspectRatioString="16:9",this.model.get("defaultAspectRatioNum")}onAdSwappedOut(){this.oppsService.adSwappedOut()}onAdSwappedIn(){this.oppsService.adSwappedIn()}onResumeAfterSwapOut(){this.oppsService.adResumeAfterSwapOut()}_getMesureElement(){var e=O(this.subModel?this.subModel.get("parentSelector"):this.model.get("parentSelector"))[0];return this.mesureElement=e,this.mesureElement}_startOneSecondNoPlayTimer(){this.mesureElement=this._getMesureElement(),this.mesureElement&&(this.onImpressionPosition=f.offsetFromBottomOfViewPort(this.mesureElement),this.onAdImpressionTimer=setTimeout(this._reportOneSecondNoPlay.bind(this),1e3))}_reportOneSecondNoPlay(){null!==this.onAdImpressionTimer&&(this.hadPlay?this._clearOnAdImpressionTimer():(this.onOneSecondPosition=f.offsetFromBottomOfViewPort(this.mesureElement),this.onImpressionPosition!==this.onOneSecondPosition?this.onImpressionPosition>this.onOneSecondPosition?this.oppsService.onOneSecondNoPlayScrolledDown():this.onImpressionPosition<this.onOneSecondPosition&&this.oppsService.onOneSecondNoPlayScrolledUp():this.oppsService.onOneSecondNoPlaySamePlace()))}_clearOnAdImpressionTimer(){this.onAdImpressionTimer&&(clearTimeout(this.onAdImpressionTimer),this.onAdImpressionTimer=null)}onViewabile100Change(){var e=this.getCurrModel();this.model.get("adState")===d.Z.adState.paused||e.get("isViewable100")||(this.isLostView100=!0)}_onNewCompletion(){this.onCompView100()}onDisplayingFullNAS(){this.firedDisplayingFullNAS||(this.firedDisplayingFullNAS=!0,this.oppsService.onDisplayingFullNAS())}onDisplayingNASTitleOnly(){this.firedDisplayingNASTitleOnly||(this.firedDisplayingNASTitleOnly=!0,this.oppsService.onDisplayingNASTitleOnly())}fireAdOppOnce(e){this["".concat(e,"Fired")]||(this["".concat(e,"Fired")]=!0,this.oppsService.fireGenericOpp(e))}_stopRV1Observer(){this.AmpViewabilityHelper&&(this.AmpViewabilityHelper.stopObserver(this.targetElement),this.AmpViewabilityHelper=null)}_checkIfStartRV1Observer(){this.model.get("frameType")===o.CONSTS.FRAME_TYPE.amp&&this.model.get("isUseAmpObserver")&&(this.AmpViewabilityHelper=new b({model:this.model,subModel:this.subModel}),this.targetElement=this.vpaidWrapper.adTarget?this.vpaidWrapper.adTarget:this.vpaidWrapper.localTarget,this.targetElement&&(this.log.info("Winning ad vpaidWrapper: ",this.targetElement),this.AmpViewabilityHelper.startObserver(this.targetElement),this.createStateHandlers([{event:"isViewableAMP:false",funcName:"pause"},{event:"isViewableAMP:true",funcName:"play"}])))}_setBottomOfVViewPort(){if(this.model.get("isReportBottomOfVViewPort")){var e=this.vpaidWrapper.adTarget;this.adData.bovpv=!!e&&parseInt(f.offsetFromBottomOfViewPort(e))}}_onAdWaitForPubVideoToStop(){this._clearOnAdImpressionTimer(),this.oppsService?this.oppsService.adWaitForPubVideoToStop():this.createStateHandlers([{event:"adWaitForPubVideoToStop",funcName:" _onAdWaitForPubVideoToStop",isListenOnce:!0}])}_outOfTabEvent(){this._clearOnAdImpressionTimer(),this.oppsService.outOfTab()}_backToTabEvent(){this._clearOnAdImpressionTimer(),this.oppsService.backToTab()}}}}]);
</script>

</body>
</html>
