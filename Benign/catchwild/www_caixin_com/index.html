<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.html</title>
</head>
<body>

<script>
function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function splitNumFloat(t,e,a){for(var n=(t-e)/a,i=[],r=0;r<a;r++)i.push(e+n*r);return i.push(t),i}function splitNum(t,e,a){for(var n=Math.floor((t-e)/a),i=[],r=0;r<a;r++)i.push(e+n*r);return i.push(t),i}function isUpdateTime(){(new Date).getDay();var t=(new Date).getHours();return(t+=(new Date).getMinutes()/60)>9.4&&t<15.5}$("<link>").attr({rel:"stylesheet",type:"text/css",href:"https://file.caixin.com/en/plugins/css/stock.css"}).appendTo("head");var pluginsData=[{name:"上证指数",enName:"SSE Index",klass:"sh",code:"000001",unicode:"106003734"},{name:"沪深300",enName:"CSI 300",klass:"sz",code:"000300",unicode:"106003893"},{name:"中证500",enName:"CSI 500",klass:"gem",code:"000905",unicode:"106002315"},{name:"财新基石",enName:"CSCX Bedrock Economy",klass:"cx",code:"930927",unicode:"106009536"},{name:"财新新动能",enName:"CSCX New Economic Engine",klass:"cxNew",code:"930928",unicode:"106009538"},{name:"创业板指",enName:"SZSE Chinext",klass:"fund",code:"399006",unicode:"106003633"}];function DrawStock(t){this.dom=t;var e=this,a={exponents:{sh:{name:"上证指数",klass:"sh",code:"000001",unicode:"106003734",exponent:{},list:[],init:!0},sz:{name:"沪深300",klass:"sz",code:"000300",unicode:"106003893",exponent:{},list:[],init:!0},gem:{name:"中证500",klass:"gem",code:"000905",unicode:"106002315",exponent:{},list:[],init:!0},cx:{name:"财新基石",klass:"cx",code:"930927",unicode:"106009536",exponent:{},list:[],init:!0},cxNew:{name:"财新新动能",klass:"cxNew",code:"930928",unicode:"106009538",exponent:{},list:[],init:!0},fund:{name:"创业板指",klass:"fund",code:"399006",unicode:"106003633",exponent:{},list:[],init:!0}},active:"sh",timeHandler:void 0,init:function(t){this.dom=t;var e=this.active,a=this.exponents[e].code,n=this.exponents[e].unicode;this.initLoad(a,e);var i="https://www.caixinglobal.com/stock/exponent/details/"+n;d3.select(this.dom+" .linkTo").attr("href",i),this.realtimeChart.init(t)},url:"https://stock.caixin.com/en/common/CXIndexesData",initLoad:function(t,e){var a=this;this.realtimeChart.loading(),clearInterval(this.timeHandler);var n=this.url+"?code="+t+"&size=1&update=0";1==this.exponents[e].init?(this.exponents[e].init=!1,d3.json(n,(function(t){t.status&&(a.exponents[e].list=t.data.list,a.exponents[e].exponent=t.data.hq,a.render(e))}))):this.render(e),this.update()},loadMore:function(){for(var t=this.active,e=this,a=this.exponents[t].code,n=this.exponents[t].list,i=n[0].tradeDate,r=n.length,s=0;s<n.length;s++)if(!n[s].curPrice){r=s;break}var o=this.url+"?code="+a+"&size="+r+"&update="+i;d3.json(o,(function(a){if(a.status){var n=new Date(e.exponents[t].list[0].tradeDate);n=n.getDate();var i=new Date(a.data.hq.tradeDate);n!=(i=i.getDate())&&(e.exponents[t].list=[]),e.exponents[t].exponent=a.data.hq;for(var r=a.data.start,s=a.data.end,o=r,c=0;o<s;o++,c++)e.exponents[t].list[o]=a.data.list[c];e.render(t)}}))},update:function(){var t=this;this.timeHandler=setInterval((function(){isUpdateTime()?t.loadMore():t.timeHandler&&clearInterval(t.timeHandler)}),1e4)},render:function(t){var e=this.exponents[t].list,a=this.exponents[t].exponent;this.realtimeChart.render(e,a),this.realtimeChart.hideLoading()},realtimeChart:{margin:{top:0,left:0,bottom:0,right:0},width:300,height:150,widthChart:240,heightChart:130,el:"",svg:"",init:function(t){var e=this;e.dom=t,e.el=d3.select(e.dom+" .charts"),e.svg=e.el.append("svg").attr("width",e.width).attr("height",e.height),d3.select(e.dom+" .tabs").selectAll("div").data(pluginsData).enter().append("div").attr("class",(function(t,e){return 0==e?"active "+t.klass:t.klass})).text((function(t){return t.enName})).on("click",(function(t){d3.selectAll(e.dom+" .tabs div").each((function(e){t.klass==e.klass?d3.select(this).classed("active",!0):d3.select(this).classed("active",!1)}));var n="https://www.caixinglobal.com/stock/exponent/details/"+t.unicode;d3.select(e.dom+" .linkTo").attr("href",n),a.active=t.klass,a.initLoad(t.code,t.klass)}))},loading:function(){d3.select(this.dom+" .chart-wrap").append("div").attr("class","loading").html((function(){return'<div style="text-align:center;padding-top:20px">Loading...</div>'}))},hideLoading:function(){d3.select(this.dom+" .loading").remove()},showToolTips:function(t){d3.select(this.dom+" .tips").attr("class",(function(){return t.changeRate>0?"tips up":t.changeRate<0?"tips down":"tips keep"})).html((function(){var e="",a=t.curPrice.toFixed(2);t.changeRate>0?e+="<span>"+a+"<b>↑</b></span>":t.changeRate<0?e+="<span>"+a+"<b>↓</b></span>":e+="<span>"+a+"</span>";var n=t.priceUpdown1.toFixed(2),i=t.changeRate.toFixed(2);return 0!=i&&(i+="%"),e+="<span>"+n+"</span>",e+="<span>"+i+"</span>"}))},render:function(t,e){var a=t;a=a.sort((function(t,e){return t.tradeDate>e.tradeDate?1:t.tradeDate<e.tradeDate?-1:0}));for(var n=0;n<a.length;n++)a[n].curPrice=a[n].curPrice?a[n].curPrice:null,a[n].changeRate=a[n].changeRate?a[n].changeRate:0;var i=a[0].preClosePrice,r=[];for(n=0;n<a.length;n++)r.push(a[n].tradeDate);var s=[];for(n=0;n<a.length;n++)a[n].curPrice&&s.push({x:n,y:a[n].curPrice,vol:a[n].tradeVol,rate:a[n].changeRate,pre:a[n].preClosePrice,time:a[n].tradeDate});var o=[];for(n=0;n<a.length;n++){var c=Math.abs(a[n].changeRate)/100;o.push(c)}var d=d3.max(o),l=[-(d+=d/9),d],h=[i*(1-d),i*(1+d)],u=splitNumFloat(l[1],l[0],6),p=[];for(n=0;n<u.length;n++){c=+(1+u[n]).toFixed(4)*i;p.push(c)}var m=splitNum(r.length-1,0,4);d3.time.format("%H:%M");d3.select(this.dom+" .line-chart").remove();var g=this.svg.append("g").attr("class","line-chart").attr("transform","translate(0,0)"),f=d3.scale.linear().domain([0,r.length-1]).range([0,this.widthChart]),x=d3.scale.linear().domain(h).range([this.heightChart,0]),v=(d3.scale.linear().domain(l).range([this.heightChart,0]),d3.svg.axis().scale(f).tickSize(1).tickValues(m).innerTickSize(-this.heightChart).tickPadding(10).tickFormat((function(t,e){return 2==e?"11:30/13:00":0==e?"09:30":4==e?"15:00":""})).orient("bottom")),y=d3.svg.axis().scale(x).tickSize(0).tickValues(p).tickPadding(55).innerTickSize(-this.widthChart).tickFormat((function(t,e){return 0==e||6==e||3==e?t.toFixed(2):""})).orient("right"),k=d3.svg.line().interpolate("monotone").x((function(t){return f(t.x)})).y((function(t){return x(t.y)})),C=d3.svg.area().interpolate("monotone").x((function(t){return f(t.x)})).y0(this.heightChart).y1((function(t){return x(t.y)})),w=g.append("g").attr("class","context-line").attr("transform","translate("+this.margin.left+","+this.margin.top+")");w.append("path").datum(s).attr("class","realtime-line").attr("d",k).attr("fill","none").attr("stroke","#383c80").attr("stroke-width",1),w.append("path").datum(s).attr("class","realtime-area").attr("d",C).attr("fill","#00B7DE").attr("opacity",.1),g.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+(this.heightChart-this.margin.bottom)+")").call(v),d3.selectAll(this.dom+" .x-axis text").style({"text-anchor":function(t,e){return 0==e?"start":4==e?"end":"middle"}}),g.append("g").attr("class","y-axis-cur-price axis").attr("transform","translate("+this.widthChart+","+this.margin.top+")").call(y);var D=d3.selectAll(this.dom+" .y-axis-cur-price text");D.attr("dx",0).attr("dy",(function(t,e){return 0==e?0:e==D.size()-1?"1em":".32em"})).style({"text-anchor":"end"}),d3.selectAll(this.dom+" .y-axis-cur-price text").attr("fill",(function(t,e){return 0==e?"#ed072e":6==e?"#10c118":void 0})),d3.selectAll(this.dom+" .y-axis-cur-price.axis line").attr("stroke",(function(t,e){return 3==e?"#000000":"#CCCCCC"})).style({"stroke-width":"1px","stroke-dasharray":"2px","shape-rendering":"crispEdges"});this.svg.append("rect").attr("class","rectWrap").attr("x",0).attr("y",0).attr("width",this.widthChart).attr("height",this.heightChart).attr("stroke-width",1).attr("stroke","#202470").attr("fill","none");var b=s[s.length-1],S=f(b.x),P=x(b.y);g.append("circle").attr("class","last-point").attr("cx",S).attr("cy",P).attr("r",3).attr("fill","#07a855");this.showToolTips(e)},renderUpdate:function(t){var e=t.hqs;e=e.sort((function(t,e){return t.tradeDate>e.tradeDate?1:t.tradeDate<e.tradeDate?-1:0}));for(var a=0;a<e.length;a++)e[a].curPrice=e[a].curPrice?e[a].curPrice:null,e[a].changeRate=e[a].changeRate?e[a].changeRate:0;var n=e[0].preClosePrice,i=[];for(a=0;a<e.length;a++)i.push(e[a].tradeDate);var r=[];for(a=0;a<e.length;a++)e[a].curPrice&&r.push({x:a,y:e[a].curPrice,vol:e[a].tradeVol,rate:e[a].changeRate,pre:e[a].preClosePrice,time:e[a].tradeDate});var s=[];for(a=0;a<e.length;a++){var o=Math.abs(e[a].changeRate)/100;s.push(o)}var c=d3.max(s),d=[-(c+=c/9),c],l=[n*(1-c),n*(1+c)],h=splitNumFloat(d[1],d[0],6),u=[];for(a=0;a<h.length;a++){o=+(1+h[a]).toFixed(4)*n;u.push(o)}splitNum(i.length-1,0,4),d3.time.format("%H:%M");var p=d3.scale.linear().domain([0,i.length-1]).range([0,this.widthChart]),m=d3.scale.linear().domain(l).range([this.heightChart,0]),g=d3.svg.axis().scale(m).tickSize(0).tickValues(u).tickPadding(55).innerTickSize(-this.widthChart).tickFormat((function(t,e){return 0==e||6==e||3==e?t.toFixed(2):""})).orient("right");d3.select(this.dom+" .y-axis-cur-price.axis").call(g);var f=d3.selectAll(this.dom+" .y-axis-cur-price text");f.attr("dx",0).attr("dy",(function(t,e){return 0==e?0:e==f.size()-1?"1em":".32em"})).style({"text-anchor":"end"}),d3.selectAll(this.dom+" .y-axis-cur-price text").attr("fill",(function(t,e){return 0==e?"#ed072e":6==e?"#10c118":void 0})),d3.selectAll(this.dom+" .y-axis-cur-price.axis line").attr("stroke",(function(t,e){return 3==e?"#000000":"#CCCCCC"})).style({"stroke-width":"1px","stroke-dasharray":"2px","shape-rendering":"crispEdges"});var x=d3.svg.line().interpolate("monotone").x((function(t){return p(t.x)})).y((function(t){return m(t.y)})),v=d3.svg.area().interpolate("monotone").x((function(t){return p(t.x)})).y0(this.heightChart).y1((function(t){return m(t.y)}));d3.select(this.dom+" .realtime-line").datum(r).attr("d",x).attr("fill","none").attr("stroke","#383c80").attr("stroke-width",1),d3.select(this.dom+" .realtime-area").datum(r).attr("d",v).attr("fill","#00B7DE").attr("opacity",.1);var y=r[r.length-1],k=p(y.x),C=m(y.y);d3.select(this.dom+" .last-point").transition().duration(500).attr("cx",k).attr("cy",C),this.showToolTips(t.hq)}}};"object"==("undefined"==typeof d3?"undefined":_typeof(d3))?a.init(e.dom):1==window.getD3Flag?setTimeout((function(){new DrawStock(e.dom)}),1e3):(window.getD3Flag=!0,$.getScript("https://file.caixin.com/en/plugins/js/d3.min.js",(function(){a.init(e.dom)})))}
</script>

</body>
</html>
