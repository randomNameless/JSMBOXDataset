<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index-umd.html</title>
</head>
<body>

<script>
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).SuperAppKit={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=["vk.com","vk.ru"],r=["agreements","promo","vkc_behavior","vkc_auth_action","vkc_brand","vkc_display_mode","service_groups","external_device_id"],o=0,a=1,i=3,s=4,c=6,u=15,l=16,p=82,d=!("undefined"==typeof window||!window.document||!window.document.createElement),h=d&&!!window.addEventListener;function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function m(e,t){return e(t={exports:{}},t.exports),t.exports}var v=f(m((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}))),E=function(){};if(h)try{var g=Object.defineProperty({},"passive",{get:function(){!0}});window.addEventListener("test",E,g),window.removeEventListener("test",E,g)}catch(e){}!function(){if(!d)return!1;var e=!1;try{document.createElement("div").scrollTo({top:0,get behavior(){return e=!0,"smooth"}})}catch(e){}}();var A=m((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}));f(A);var _=m((function(e){e.exports=function(e){if(Array.isArray(e))return A(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));f(_);var S=m((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));f(S);var T=m((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}));f(T);var y=m((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}));f(y),f(m((function(e){e.exports=function(e){return _(e)||S(e)||T(e)||y()},e.exports.default=e.exports,e.exports.__esModule=!0})));var D=f(m((function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0})));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P={parse:function(e){if("string"!=typeof e)return{};if(!(e=e.trim().replace(/^[?#&]/,"")))return{};var t=/\?(.+)$/gi.exec(e);return(t?t[1]:e).split("&").reduce((function(e,t){var n=t.split("=");return n[1]&&(e[n[0]]=decodeURIComponent(n[1])),e}),{})},stringify:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==v(e)||null===e)return"";t=C({encode:!0},t);var n=function(e){return t.encode?encodeURIComponent(e):String(e)};return Object.keys(e).reduce((function(r,o){var a=e[o];return void 0===a?r:null===a?(t.skipNull||r.push([n(o),""].join("=")),r):Array.isArray(a)?(a.map((function(e){r.push("".concat(n(o),"[]=").concat(n(e)))})).join(),r):(r.push([n(o),n(a)].join("=")),r)}),[]).join("&")}};function w(e){return P.stringify(e,{skipNull:!0})}function K(e){return Object.keys(e).filter((function(e){return r.includes(e)}))}function b(e){var t;return Boolean(null===(t=K(e))||void 0===t?void 0:t.length)}function N(e){var t=function(e){return K(e).reduce((function(t,n){return t[n]=e[n],t}),{})}(e);return btoa(JSON.stringify(t))}function R(e,t){var n,r,o=document.createElement("iframe");for(var a in e&&(o.src=e),o.style.cssText=null!==(n=null==t?void 0:t.cssText)&&void 0!==n?n:"",o.width="100%",o.height="100%",o.style.border="none",null==t?void 0:t.properties)t&&t.properties.hasOwnProperty(a)&&(o[a]=null!==(r=t.properties[a])&&void 0!==r?r:"");return o}function k(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(e){return e&&"object"===t(e)};return e.reduce((function(e,t){return Object.keys(t).forEach((function(n){var o=e[n],a=t[n];Array.isArray(o)&&Array.isArray(a)?e[n]=o.concat.apply(o,a):r(o)&&r(a)?e[n]=k(o,a):e[n]=a})),e}),{})}function I(e,t){return void 0===e?t:"number"!=typeof e?e?1:0:e}function M(e,n){return e&&"object"===t(e)?Object.keys(e).reduce((function(t,r){return n.includes(r)?(t[r]=e[r],t):t}),{}):e}f(m((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}))),f(m((function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0})));var x,L,V,U=new(function(){function e(){this.savedStyles=[],this.bodyScrollYValue=0,this.isFreezed=!1}return e.prototype.freezeBodyOverflow=function(){if(!this.isFreezed){this.isFreezed=!0;var e=(n=window.document.documentElement.clientWidth,Math.abs(window.innerWidth-n)),t=parseInt(window.getComputedStyle(window.document.body).paddingRight,10)||0;this.bodyScrollYValue=window.pageYOffset||window.scrollY,this.savedStyles=[],this.savedStyles.push({value:window.document.body.style.paddingRight,property:"padding-right"},{value:window.document.body.style.overflow,property:"overflow"},{value:window.document.body.style.overflowX,property:"overflow-x"},{value:window.document.body.style.overflowY,property:"overflow-y"}),window.document.body.style.setProperty("overflow","hidden"),window.document.body.style.setProperty("padding-right",e+t+"px")}var n},e.prototype.restoreBodyOverflow=function(){this.isFreezed&&(this.savedStyles.forEach((function(e){var t=e.value,n=e.property;t?window.document.body.style.setProperty(n,t):window.document.body.style.removeProperty(n)})),window.scrollTo(0,this.bodyScrollYValue),this.isFreezed=!1)},e}());(x=e.CommonSDKEvents||(e.CommonSDKEvents={})).OPEN="VKSDKOpen",x.CLOSE="VKSDKClose",x.LOGOUT="VKSDKLogout",x.GET_CAPTCHA="VKSDKGetCaptcha",x.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",x.CAPTCHA_FAILED="VKSDKGetCaptchaFail",x.AUTH_NEEDED="VKSDKAuthNeeded",x.UPDATE_PARAMS="VKSDKUpdateParams",x.REQUEST_SUPERAPP_TOKEN="VKSDKRequestSuperAppToken",x.ERROR="VKSDKError",function(e){e.INIT="VKSDKInit"}(L||(L={})),(V=e.SDKErrorCodes||(e.SDKErrorCodes={}))[V.UNKNOWN=1]="UNKNOWN",V[V.MISSING_PARAM=2]="MISSING_PARAM",V[V.CONNECTION_LOST=3]="CONNECTION_LOST",V[V.USER_DENIED=4]="USER_DENIED",V[V.INVALID_PARAMS=5]="INVALID_PARAMS",V[V.CUSTOM=6]="CUSTOM",V[V.LOADING_ERROR=7]="LOADING_ERROR",V[V.CONNECT_WINDOW_CLOSED=7]="CONNECT_WINDOW_CLOSED",V[V.CONNECT_WINDOW_NOT_OPENED=8]="CONNECT_WINDOW_NOT_OPENED",V[V.CONNECT_DOMAIN_NOT_ALLOWED=9]="CONNECT_DOMAIN_NOT_ALLOWED",V[V.CONNECT_UNKNOWN_SDK_MESSAGE=10]="CONNECT_UNKNOWN_SDK_MESSAGE",V[V.CONNECT_CLIENT_SDK_ERROR=11]="CONNECT_CLIENT_SDK_ERROR",V[V.VALIDATE_ERROR=12]="VALIDATE_ERROR",V[V.CAPTCHA_ERROR=14]="CAPTCHA_ERROR",V[V.OLD_MISSING_PARAM=100]="OLD_MISSING_PARAM";var H=function(e,t){return'Wrong "'+e+'" param. '+(t||"")},G=function(){return"Connect window was closed."},W=function(){return"Connect window was not opened."},F=function(e){return'URL domain "'+e+'" is not allowed.'},j=function(e){return"This SDK message is unknown: "+e},B=function(e){return e.error+";"+e.errorCode},z=function(){return"Loading timeout"},Y=function(e){return"The "+e+" parameter must be a number"},q=function(e){return"The "+e+" parameter must be a string"},Z=function(e){return"The "+e+" is required parameter"},Q=function(e){return"The "+e+" parameter must be a number or a string"},J=function(e){return"The "+e+" parameter must be Ð° function"},X=function(e,t){return(X=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function $(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}X(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ee,te,ne,re,oe=function(){return(oe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function ae(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map((function(e){e(n)})),(e["*"]||[]).slice().map((function(e){e(t,n)}))}}}function ie(e){return"number"==typeof e}function se(e){return"string"==typeof e}function ce(e){return void 0!==e&&""!==e&&null!==e}function ue(e){return"function"==typeof e}function le(e,t,n,r){return{type:e,code:t,message:n,params:r}}function pe(t,n){return{type:e.SDKErrorCodes[e.SDKErrorCodes.VALIDATE_ERROR],code:e.SDKErrorCodes.VALIDATE_ERROR,message:t,params:n}}function de(e){return e.message?{code:e.code,reason:e.message,data:e.params}:{code:e.code,data:e.params}}!function(e){e.GET_CAPTCHA="VKSDKGetCaptcha",e.APP_CLOSE="VKWebAppClose",e.APP_READY="VKSDKMiniAppReady",e.RESIZE="VKSDKMiniAppResize",e.APP_INIT_CONFIG="VKSDKMiniAppInitConfig",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.ACTION_DONE="VKWebAppActionDone",e.SET_TITLE="VKWebAppSetTitle",e.AUTH_BY_EXCHANGE_TOKEN="VKWebAppAuthByExchangeToken",e.FORCE_LOGOUT="VKWebAppForceLogout"}(ee||(ee={})),(te=e.MiniAppEvents||(e.MiniAppEvents={})).OPEN="open",te.HIDE="hide",te.CLOSE="close",te.SHOW="show",te.MESSAGE="message",te.CREATE_APP="createapp",function(e){e.SUPERAPP_TOKEN="VKSDKGeneralSuperAppToken",e.AUTH_NEEDED="VKSDKGeneralAuthNeeded",e.OPEN_APP="VKSDKGeneralOpenApp"}(ne||(ne={})),function(e){e.SUPERAPP_TOKEN_CHANGE_V2="superAppTokenV2",e.SUPERAPP_TOKEN_CHANGE="superAppToken"}(re||(re={}));var he,fe=function(){function e(e,t,n){void 0===e&&(e="Parameter validation error"),this.errorText=e,this.params=t,this.valid=n}return e.prototype.isValid=function(){return Boolean(this.valid)},e.prototype.error=function(e){return this.isValid()?null:e?de(pe(this.errorText,this.params)):pe(this.errorText,this.params)},e}(),me=function(){function e(e){this.rules=e}return e.prototype.validate=function(e){for(var t in this.rules)if(this.rules.hasOwnProperty(t))for(var n=0;n<this.rules[t].length;n++){var r=this.rules[t][n];if(!r.rule(e[t]))return new fe(r.errorText,e,!1)}return new fe("",e,!0)},e}(),ve=(new me({params:[{rule:ce,errorText:Z("params")}]}),new me({token:[{rule:se,errorText:q("token")}]})),Ee=new me({event:[{rule:se,errorText:q("event")},{rule:ce,errorText:Z("event")}],handler:[{rule:ce,errorText:Z("handler")}]}),ge=new me({app:[{rule:function(e){return ie(e)||se(e)},errorText:Q("app")},{rule:ce,errorText:Z("app")}]}),Ae=new me({message:[{rule:ce,errorText:Z("message")}]}),_e=new me({handler:[{rule:ce,errorText:Z("handler")},{rule:ue,errorText:J("handler")}]}),Se=new me({handler:[{rule:ce,errorText:Z("handler")},{rule:ue,errorText:J("handler")}]}),Te=new me({handler:[{rule:ce,errorText:Z("handler")},{rule:ue,errorText:J("handler")}]}),ye=new me({appId:[{rule:ie,errorText:Y("appId")}]}),De={appId:0,superAppToken:"",superAppTokenV2:"",loginDomain:"login.vk.com",oauthDomain:"oauth.vk.com",connectDomain:"id.vk.com",_debug:!1,_localhost:!1},Oe={},Ce=function(){function e(){}return e.init=function(e){if(!e.appId)throw new Error("appId required");var t=ye.validate({appId:e.appId});!t.isValid()&&console.error(t.error()),De.appId=e.appId,De.superAppToken=e.superAppToken||"",De.superAppTokenV2=e.superAppTokenV2||"",De.loginDomain=e.loginDomain||"login.vk.com",De.oauthDomain=e.oauthDomain||"oauth.vk.com",De.connectDomain=e.connectDomain||"id.vk.com",De.appSettings=e.appSettings,De._debug=!!e._debug,De._localhost=!!e._localhost},e.get=function(){return De},e.setSuperAppToken=function(t,n){void 0===n&&(n={});var r=ve.validate({token:t});!r.isValid()&&console.error(r.error()),2===n.version?(De.superAppTokenV2=t,e.events.emit(re.SUPERAPP_TOKEN_CHANGE_V2,t)):(De.superAppToken=t,e.events.emit(re.SUPERAPP_TOKEN_CHANGE,t))},e.onRequestSuperAppToken=function(e){var t=_e.validate({handler:e});!t.isValid()&&console.error(t.error()),Oe.requestSuperAppToken=e},e._requestSuperAppToken=function(t,n){var r;void 0===n&&(n={}),Oe.requestSuperAppToken&&(r=Oe.requestSuperAppToken(t,n)),r&&r.then((function(t){return e.setSuperAppToken(t,n)})).catch(console.error)},e.onAuth=function(e){var t=Se.validate({handler:e});!t.isValid()&&console.error(t.error()),Oe.auth=e},e._auth=function(t){var n;void 0===t&&(t={}),Oe.auth&&(n=Oe.auth()),n&&n.then((function(n){e.setSuperAppToken(n,t)})).catch(console.error)},e.onOpenApp=function(e){Oe.openApp=e},e._openApp=function(e){Oe.openApp&&Oe.openApp(e.app)},e.onLogout=function(e){var t=Te.validate({handler:e});!t.isValid()&&console.error(t.error()),Oe.logout=e},e._logout=function(){Oe.logout&&Oe.logout()},e.fetchDomain=function(){return Boolean(he)||(he=new Promise((function(e){fetch("https://vk.ru/domain.txt").then((function(e){return e.text()})).then((function(e){return e.trim()})).then((function(e){De.loginDomain=De.loginDomain.replace("vk.com",e),De.oauthDomain=De.oauthDomain.replace("vk.com",e),De.connectDomain=De.connectDomain.replace("vk.com",e)})).then(e).catch((function(t){e(),console.warn(t)}))}))),he},e.events=ae(),e}(),Pe=new me({iframe:[{rule:ce,errorText:Z("iframe")}],origin:[{rule:se,errorText:q("origin")},{rule:ce,errorText:Z("origin")}]}),we=new me({event:[{rule:ce,errorText:Z("event")}]}),Ke=new me({handler:[{rule:ce,errorText:Z("handler")},{rule:ue,errorText:J("handler")}]}),be=new me({handler:[{rule:ce,errorText:Z("handler")}],params:[{rule:ce,errorText:Z("params")}]}),Ne=function(e){var t=this;this.handler=function(){return{}},this.destroy=function(){delete t.config,window.removeEventListener("message",t.handleMessage)},this.onMessage=function(e){var n=Ke.validate({handler:e});!n.isValid()&&console.error(n.error()),t.handler=e},this.sendMessage=function(e){var n,r=be.validate(e);!r.isValid()&&console.error(r.error()),null===(n=t.config.iframe.contentWindow)||void 0===n||n.postMessage(oe({type:"vk-sak-sdk"},e),t.config.origin)},this.handleMessage=function(e){var n=we.validate({event:e});!n.isValid()&&console.error(n.error()),t.config.origin&&e.origin===t.config.origin&&e.source===t.config.iframe.contentWindow&&e.data&&"vk-sak-sdk"===e.data.type&&t.handler(e.data)};var n=Pe.validate(e);!n.isValid()&&console.error(n.error()),this.config=e,window.addEventListener("message",this.handleMessage)},Re=function(){function e(){var e=this;this.resolve=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.resolveHandler(t)},this.reject=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.rejectHandler(t)}}return e.prototype.start=function(){var e=this;this.active=!0,this.finished=!1,this.promise=new Promise((function(t,n){e.resolveHandler=t,e.rejectHandler=n}))},e.prototype.get=function(){return this.promise},e}(),ke=["extend_token","login_with_user","login_silent_user","__sferum_invite_link","registration_with_phone","registration_with_email","validate_phone","bind_ok_account","no_password_flow","confirm_service_action","login_with_eljour","login_with_multi_user","qr_auth"];function Ie(e){return e&&ke.includes(e.name)?btoa(JSON.stringify(e)):""}function Me(e){return e?btoa(JSON.stringify(e)):""}function xe(e,t){return void 0===t&&(t="auth"),Ce.fetchDomain().then((function(){var n=Ce.get(),r=n.appId,o=n.connectDomain,a=n.appSettings,i=n._debug,s=n._localhost,c=oe({app_id:r,response_type:"silent_token",v:"1.57.0",debug:i?1:null,localhost:s?1:null},e);a&&b(a)&&(c.app_settings=N(a));var u=w(c);return Promise.resolve("https://"+o+"/"+t+"?"+u)}))}var Le,Ve=[o,a,i,s,c,u,l,p];!function(e){e.Default="default",e.NamePhone="name_phone",e.PhoneName="phone_name"}(Le||(Le={}));var Ue,He=[Le.Default,Le.NamePhone,Le.PhoneName];!function(e){e.Primary="primary",e.Flat="flat"}(Ue||(Ue={}));var Ge=[Ue.Primary,Ue.Flat];var We;(We=e.AuthCaptchaEventsSDK||(e.AuthCaptchaEventsSDK={})).CAPTCHA_SUCCESS="VKSDKAuthCaptchaSuccess",We.CAPTCHA_FAIL="VKSDKAuthCaptchaFail";var Fe=function(t,n,r){var o=this;this.events=ae(),this.showReadyPromiseTask=new Re,this.init=function(){Ce.fetchDomain().then((function(){xe(oe(oe({origin:location.protocol+"//"+location.host,uuid:o.uuid},o.captchaData),{scheme:o.scheme}),"auth_captcha").then(o.handleCaptcha)}))},this.createFrame=function(){var e=window.innerHeight,t="\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+e+"px;\n      min-height: "+e+"px;\n      border: none;\n      z-index: 99999;\n     ";return o.iframe=R("",{cssText:t}),o},this.handleError=function(t){var n=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));o.events.emit(e.CommonSDKEvents.ERROR,n)},this.onMessage=function(t){switch(t.handler){case e.CommonSDKEvents.ERROR:o.handleError(t.params);break;case e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS:o.showReadyPromiseTask.resolve(t.params),o.destroy();break;default:o.showReadyPromiseTask.reject(),o.destroy()}},this.handleCaptcha=function(e){o.iframe.src=e,document.body.appendChild(o.iframe),o.bridge=new Ne({iframe:o.iframe,origin:"https://"+Ce.get().connectDomain}),o.bridge.onMessage(o.onMessage)},this.destroy=function(){o.iframe&&document.body.removeChild(o.iframe),o.bridge&&o.bridge.destroy()},this.show=function(){return o.iframe.style.display="block",new Promise((function(e){o.showReadyPromiseTask.start(),o.showReadyPromiseTask.get().then(e)}))},this.uuid=t,this.captchaData=n,this.scheme=r||"bright_light",this.createFrame().init()},je=function(){function t(n){var r=this;this.readyPromiseResolve=null,this.readyPromise=null,this.child=null,this.initialTitle=window.document.title,this.open=function(e,t){return Ce.fetchDomain().then((function(){return r.loading?(r.getMiniAppUrl(e,t).then((function(e){r.iframe.src=e})),r.loading=new Promise((function(e){r.iframe.onload=function(){r.iframe.onload=null,e()}})),r.readyPromise=new Promise((function(e){return r.readyPromiseResolve=e})),r.eventOpenSettings(),r.readyPromise):r.preload(e,t).catch(console.error)}))},this.eventOpenSettings=function(){r.iframe.style.display="block",r.params.stackMode||U.freezeBodyOverflow(),r.loading.then(r.handleResize).catch(console.error),r.events.emit(e.MiniAppEvents.OPEN)},this.hide=function(){r.iframe.style.display="none",r.params.stackMode||U.restoreBodyOverflow(),r.events.emit(e.MiniAppEvents.HIDE)},this.close=function(t){window.document.title!==r.initialTitle&&(window.document.title=r.initialTitle),r.params.stackMode||U.restoreBodyOverflow(),r.iframe&&r.iframe.remove(),r.bridge&&r.bridge.destroy(),delete r.iframe,delete r.bridge,Ce.events.off(re.SUPERAPP_TOKEN_CHANGE,r.onSuperAppToken),window.removeEventListener("resize",r.handleResize),r.events.emit(e.MiniAppEvents.CLOSE,t)},this.show=function(){if(!r.loading)throw new Error('App is not loaded, use "open" or "preload" methods');r.iframe.style.display="block",r.params.stackMode||U.freezeBodyOverflow(),r.events.emit(e.MiniAppEvents.SHOW)},this.preload=function(e,t){return Ce.fetchDomain().then((function(){var n=document.createElement("iframe"),o=window.innerHeight,a=isFinite(r.params.zIndex)?r.params.zIndex:999999;return r.getMiniAppUrl(e,t).then((function(e){n.src=e})),n.setAttribute("allow","geolocation"),n.style.cssText="\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+o+"px;\n      min-height: "+o+"px;\n      border: none;\n      z-index: "+a+";\n    ",r.iframe=n,document.body.appendChild(r.iframe),r.bridge=new Ne({iframe:r.iframe,origin:"https://"+Ce.get().connectDomain}),r.loading=new Promise((function(e){n.onload=function(){n.onload=null,e()}})),r.readyPromise=new Promise((function(e){return r.readyPromiseResolve=e})),r.bridge.onMessage(r.handleMessage),Ce.events.on(re.SUPERAPP_TOKEN_CHANGE,r.onSuperAppToken),window.addEventListener("resize",r.handleResize),r.eventOpenSettings(),r.loading}))},this.sendMessage=function(e){var t=Ae.validate({message:e});!t.isValid()&&console.error(t.error()),r.bridge.sendMessage(e)},this.onSuperAppToken=function(e){r.bridge.sendMessage({handler:ne.SUPERAPP_TOKEN,params:{result:e}})},this.handleError=function(t){var n=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));r.events.emit(e.CommonSDKEvents.ERROR,n)},this.handleMessage=function(t){switch(t.handler){case e.CommonSDKEvents.GET_CAPTCHA:var n=t.params.uuid,o=new Fe(n,{captcha_sid:t.params.captcha_sid,captcha_img:t.params.captcha_img});o.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.CAPTCHA_SUCCESS,params:oe({uuid:n},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.CAPTCHA_FAILED,params:{uuid:n}}),o.destroy()}));break;case ee.APP_CLOSE:r.hide();break;case e.CommonSDKEvents.ERROR:r.handleError(t.params);break;case ee.APP_READY:r.resolveReadyPromise(),r.handleUpdateConfig();break;case ee.OPEN_APP:r.openMiniapp(t.params);break;case ee.OPEN_PAY_FORM:r.openPayForm(t.params);break;case ee.SET_TITLE:r.setTitle(t.params);break;case ee.AUTH_BY_EXCHANGE_TOKEN:r.onAuthByExchangeToken();break;case ee.FORCE_LOGOUT:r.onForceLogout();break;case ne.SUPERAPP_TOKEN:Ce._requestSuperAppToken(t.params);break;case ne.AUTH_NEEDED:Ce._auth();break;default:r.events.emit(e.MiniAppEvents.MESSAGE,t)}},this.handleResize=function(){if(r.iframe){var e=innerWidth,t=innerHeight;r.iframe.style.height=t+"px",r.iframe.style.minHeight=t+"px",r.bridge.sendMessage({handler:ee.RESIZE,params:{viewport_width:e,viewport_height:t}})}},this.handleUpdateConfig=function(){r.bridge.sendMessage({handler:ee.APP_INIT_CONFIG,params:{fullMode:r.params.fullMode,hideMenu:r.params.hideMenu,scheme:r.params.scheme}})},this.update=function(e){e&&(r.params=k(r.params,e||{}),r.sendUpdateParamsMessage())},this.getMiniAppUrl=function(e,t){return Ce.fetchDomain().then((function(){var n=Ce.get(),o=n.connectDomain,a=n.appId,i=n.superAppToken,s=n._debug,c=n._localhost;return"https://"+o+"/mini_app?"+w({app:r.params.app,host_app_id:a,superapp_token:i,app_query:e?JSON.stringify(e):"",app_hash:t||"",debug:s?1:null,localhost:c?1:null})}))},this.resolveReadyPromise=function(){r.readyPromise&&r.readyPromiseResolve&&(r.readyPromiseResolve(),r.readyPromise=null,r.readyPromiseResolve=null)},this.openMiniapp=function(n){r.child=new t({app:n.app_id,stackMode:r.params.stackMode}),r.events.emit(e.MiniAppEvents.CREATE_APP,{app:r.child,location:n.location})},this.openPayForm=function(n){var o=oe({},n.params);o.data&&(o.data=JSON.stringify(o.data));var a=oe(oe({},o),{app_id:n.app_id,action:n.action}),i=new t({app:6217559,stackMode:r.params.stackMode});i.open(a).then((function(){return r.hide()})).catch(console.error),i.events.on(e.MiniAppEvents.MESSAGE,(function(e){r.handleVKPayFormMessage(e),i.close(),r.show()})),i.events.on(e.MiniAppEvents.HIDE,(function(){i.close(),r.close()}))},this.setTitle=function(e){window.document.title=e.title},this.onAuthByExchangeToken=function(){r.close({closedByExchangeToken:!0})},this.onForceLogout=function(){r.close({closedByForceLogout:!0})},this.handleVKPayFormMessage=function(t){t.handler===ee.ACTION_DONE&&r.sendMessage(t),t.handler===e.CommonSDKEvents.ERROR&&r.handleError(t.params)};var o=ge.validate(n);!o.isValid()&&console.error(o.error()),this.params=oe(oe({},n),{app:"number"==typeof n.app?"app"+n.app:n.app,scheme:"string"==typeof n.scheme?n.scheme:"bright_light"}),this.events=ae()}return t.prototype.on=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.prototype.off=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},t.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.bridge.sendMessage({params:this.params,handler:e.CommonSDKEvents.UPDATE_PARAMS})},t}(),Be=function(){function t(){this.stack=[]}return t.prototype.removeMiniApp=function(e){var t=e.app,n=this.stack.lastIndexOf(t);if(n>-1&&n===this.stack.length-1)if(this.stack.splice(n,1),this.stack.length){this.stack[this.stack.length-1].show();var r=this.stack[this.stack.length-2];setTimeout((function(){return null==r?void 0:r.hide()}),0)}else U.restoreBodyOverflow()},t.prototype.makeHandleMiniAppClose=function(e){var t=this,n=e.app;return function(){t.removeMiniApp({app:n})}},t.prototype.makeHandleMiniAppHide=function(e){var t=this,n=e.app;return function(){var e=t.stack.lastIndexOf(n);e>-1&&e===t.stack.length-1&&setTimeout((function(){return n.close()}),0)}},t.prototype.handleMiniAppCreate=function(t){var n=t.app,r=t.query,o=t.hash;this.stack.push(n),n.open(r,o).catch(console.error),n.events.on(e.MiniAppEvents.CREATE_APP,this.handleMiniAppCreate.bind(this)),n.events.on(e.MiniAppEvents.HIDE,this.makeHandleMiniAppHide({app:n})),n.events.on(e.MiniAppEvents.CLOSE,this.makeHandleMiniAppClose({app:n})),U.freezeBodyOverflow();var a=this.stack[this.stack.length-2];return setTimeout((function(){null==a||a.hide()}),0),n},Object.defineProperty(t.prototype,"length",{get:function(){return this.stack.length},enumerable:!1,configurable:!0}),t.prototype.open=function(e){var t=ge.validate(e);!t.isValid()&&console.error(t.error());var n=e.app,r=e.query,o=e.hash,a=new je({app:n,stackMode:!0});return this.handleMiniAppCreate({app:a,query:r,hash:o}),a},t.prototype.close=function(){var e=this.stack;this.stack.splice(0),e.reverse().forEach((function(e){return e.close()})),U.restoreBodyOverflow()},t}();let ze=(e=21)=>{let t="",n=e;for(;n--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t};var Ye;(Ye=e.GeoserviceEvents||(e.GeoserviceEvents={})).STATIC_MAP="VKSDKRequestToGeoservice:staticmap/png/",Ye.SEARCH="VKSDKRequestToGeoservice:search",Ye.OVERALL="VKSDKRequestToGeoservice:overall",Ye.DIRECTIONS="VKSDKRequestToGeoservice:directions",Ye.ISO="VKSDKRequestToGeoservice:iso";var qe,Ze,Qe,Je,Xe,$e,et=function(){function e(e){var t=this;this.apiKey=e.apiKey,this.requestMap={};var n=document.createElement("iframe");this.iframe=n,Ce.fetchDomain().then((function(){var e=Ce.get().appId;t.getGeoserviceProxyUrl({app_id:e}).then((function(e){n.src=e})),n.style.cssText="\n      display: none;\n    ",document.body.appendChild(t.iframe),t.bridge=new Ne({iframe:t.iframe,origin:"https://"+Ce.get().connectDomain}),t.bridge.onMessage((function(e){var n=e.params,r=n.requestID,o=n.response;t.requestMap[r].resolve(o),delete t.requestMap[r]}))}))}return e.prototype.setApiKey=function(e){this.apiKey=e},e.prototype.getGeoserviceProxyUrl=function(e){return Ce.fetchDomain().then((function(){var t=Ce.get(),n=t.connectDomain,r=t._debug,o=t._localhost;return"https://"+n+"/geoservice?"+w(oe(oe({},e||{}),{origin:location.protocol+"//"+location.host,debug:r?1:null,localhost:o?1:null}))}))},e.prototype.prepareAnswer=function(e,t,n){var r=this,o=ze();return this.bridge.sendMessage({handler:"VKSDKRequestToGeoservice:"+e,params:oe(oe({},t),{api_key:this.apiKey,wrapRequestInJSON:n,requestID:o})}),new Promise((function(e,t){r.requestMap[o]={resolve:e,reject:t}}))},e.prototype.getStaticMap=function(e){return this.prepareAnswer("staticmap/png/",e)},e.prototype.encodeCoords=function(e){return this.prepareAnswer("search",e)},e.prototype.decodeCoords=function(e){return this.prepareAnswer("overall",e)},e.prototype.getDirections=function(e){return this.prepareAnswer("directions",e,!0)},e.prototype.getISO=function(e){return this.prepareAnswer("iso",e,!0)},e}();(qe=e.DataPolicyEventsSDK||(e.DataPolicyEventsSDK={})).SHOW_DATA_POLICY="VKSDKOneTapAuthConnectDataPolicy",qe.HIDE_DATA_POLICY="VKSDKOneTapAuthDataPolicyClose",qe.DATA_POLICY_RESULT="VKSDKOneTapAuthDataPolicyResult",qe.SHOW_CAPTCHA="VKSDKOneTapAuthDataPolicyShowCaptcha",function(e){e.SHOW_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsShow",e.HIDE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsHide",e.ACCEPT_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsAccept",e.DECLINE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsDecline",e.POLICY_AGREEMENTS_ERROR="VKSDKOneTapAuthPolicyAgreementsError",e.SHOW_DATA_POLICY="VKSDKOneTapAuthPolicyAgreementsShowDataPolicy",e.GET_CAPTCHA="VKSDKGetCaptcha",e.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",e.CAPTCHA_FAIL="VKSDKGetCaptchaFail"}(Ze||(Ze={})),(Qe=e.OneTapAuthEventsSDK||(e.OneTapAuthEventsSDK={})).PHONE_VALIDATION_NEEDED="VKSDKOneTapAuthPhoneValidationNeeded",Qe.FULL_AUTH_NEEDED="VKSDKOneTapAuthFullAuthNeeded",Qe.AUTH_DATA_LOADED="VKSDKOneTapAuthDataLoaded",Qe.NOT_AUTHORIZED="VKSDKOneTapAuthNotAuthorized",Qe.LOGIN_SUCCESS="VKSDKOneTapAuthLoginSuccess",Qe.RESIZE_FRAME="VKSDKOneTapResizeFrame",Qe.SHOW_CAPTCHA="VKSDKOneTapShowCaptcha",Qe.VALIDATE_CAPTCHA="VKSDKOneTapValidateCaptcha",Qe.UPDATE_PARAMS="VKSDKUpdateParams",(Je=e.FloatingOneTapAuthEventsSDK||(e.FloatingOneTapAuthEventsSDK={})).CLOSE_AUTH="VKSDKOneTapAuthClose",Je.ADAPTIVITY_CHANGE="VKSDKFloatingOneTapAdaptivityChange",Je.ADAPTIVITY_CHANGED="VKSDKFloatingOneTapAdaptivityChanged",Je.UPDATE_PARAMS="VKSDKUpdateParams",(Xe=e.ButtonOneTapAuthEventsSDK||(e.ButtonOneTapAuthEventsSDK={})).SHOW_LOGIN="VKSDKButtonOneTapAuthShowLogin",Xe.SHOW_LOGIN_OPTIONS="VKSDKButtonOneTapAuthShowLoginOptions",Xe.SHOW_AGREEMENTS_DIALOG="VKSDKButtonOneTapAuthShowAgreementsDialog",Xe.START_AUTHORIZE="VKSDKButtonOneTapAuthStartAuthorize",Xe.UPDATE_PARAMS="VKSDKUpdateParams",function(e){e.WRONG_TOKEN="VKSDKBindAccountErrorWrongToken",e.ALREADY_BIND="VKSDKBindAccountErrorAlreadyBind"}($e||($e={}));var tt=new me({url:[{rule:se,errorText:q("url")},{rule:ce,errorText:Z("url")}]}),nt=new me({uuid:[{rule:se,errorText:q("uuid")},{rule:ce,errorText:Z("uuid")}]}),rt=(new me({params:[{rule:ce,errorText:Z("params")}]}),new me({callback:[{rule:ce,errorText:Z("callback")}]})),ot=function(){function t(){}var r;return t.on=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.off=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},r=t,t.flags=null,t.events=ae(),t.handleError=function(t){var n=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));r.events.emit(e.CommonSDKEvents.ERROR,n)},t.silentAuth=function(){return Ce.fetchDomain().then((function(){var t=Ce.get(),n=t.loginDomain,r=t.appId,o=new Re,a=ze(),i="https://"+n+"/?act=connect&app_id="+r+"&response_type=silent_token&uuid="+a+"&v=1.57.0",s=new XMLHttpRequest;return s.open("GET",i,!0),s.responseType="json",s.withCredentials=!0,o.start(),s.onload=function(){var t,n=s.response,r=s.status>=200&&s.status<300;if(n&&(null===(t=n.error)||void 0===t?void 0:t.error_code)===e.SDKErrorCodes.CAPTCHA_ERROR){var c=n.error,u=c.captcha_sid,l=c.captcha_img;new Fe(a,{captcha_sid:u,captcha_img:l}).show().then((function(e){var t=i+"&captcha_key="+e.captcha_key+"&captcha_sid="+e.captcha_sid;s.open("GET",t,!0),s.send()}))}else n&&r?o.resolve({provider:"vk",payload:s.response}):o.reject()},s.onerror=function(){o.reject()},s.send(),o.get()}))},t.oneTapAuth=function(e,n){if(console.warn("Connect.oneTapAuth method is deprecated. Use Connect.floatingOneTapAuth and Connect.buttonOneTapAuth methods."),!["floating","button"].includes(e))return null;switch(e){case"button":return t.buttonOneTapAuth(n);case"floating":return t.floatingOneTapAuth(n);default:return null}},t.floatingOneTapAuth=function(n){var o=rt.validate({callback:n.callback});!o.isValid()&&console.error(o.error());var a=function(){var e,t=window.innerWidth,n=t<=768;return{destroy:function(){return window.removeEventListener("resize",e)},isAdaptive:function(){return n},observe:function(r){e=function(){var e=window.innerWidth;t>768&&e<=768?r(n=!0):t<=768&&e>768&&r(n=!1),t=e},window.addEventListener("resize",e)}}}(),i=function(e,t){var n,r,o,a={},i=e?"314px":"334px",s=e?"\n      display: none;\n      position: fixed;\n      bottom: 0;\n      right: 50%;\n      transform: translate(50%, 0);\n      max-width: 468px;\n      width: 100%;\n      height: "+i+";\n    ":"\n        display: none;\n        position: fixed;\n        top: 0;\n        right: 0;\n        max-width: 400px;\n        width: 100%;\n        height: "+i+";\n      ";return(null===(n=null==t?void 0:t.styles)||void 0===n?void 0:n.zIndex)&&isFinite(null===(r=null==t?void 0:t.styles)||void 0===r?void 0:r.zIndex)&&(s+="z-index: "+(null===(o=null==t?void 0:t.styles)||void 0===o?void 0:o.zIndex)+";"),t&&(a.skip_success=I(t.skipSuccess,0),void 0!==t.scheme&&["bright_light","space_gray"].includes(t.scheme)&&(a.scheme=t.scheme)),{pageUrl:"floating_one_tap_auth",pageUrlParams:oe({adaptive:e?1:0},a),frameStyles:s,scheme:(null==t?void 0:t.scheme)||"bright_light"}}(a.isAdaptive(),n.options);if(!i)throw new Error("options were not set");var s,c,u,l=ze(),p=oe({origin:location.protocol+"//"+location.host,uuid:l},i.pageUrlParams),d=i.pageUrl,h=new Re,f=function(){c&&c.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:l}})},m=function(){s&&(s.remove(),s=null),window.removeEventListener("resize",f),a&&a.destroy(),c&&c.destroy()};u=new Promise((function(e){h.start(),h.get().then((function(t){e(t)}))}));var v=function(o){if(o.params.uuid===l)switch(o.handler){case e.CommonSDKEvents.ERROR:r.handleError(o.params);break;case e.OneTapAuthEventsSDK.NOT_AUTHORIZED:n.callback({type:o.handler,payload:{uuid:l,error:"not_authorized"}}),m(),h.resolve(o.handler);break;case e.OneTapAuthEventsSDK.RESIZE_FRAME:s.style.height=o.params.height+"px";break;case e.FloatingOneTapAuthEventsSDK.CLOSE_AUTH:n.callback({type:o.handler,payload:{uuid:l}}),m();break;case e.FloatingOneTapAuthEventsSDK.ADAPTIVITY_CHANGED:s.style.display="block";break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:s.style.display="block",h.resolve(o.handler);default:t.handleOneTapEvents(o,c,n)}};return s=R("",{cssText:null==i?void 0:i.frameStyles}),document.body.appendChild(s),Ce.fetchDomain().then((function(){return xe(p,d).then((function(t){s.src=t,(c=new Ne({iframe:s,origin:"https://"+Ce.get().connectDomain})).onMessage(v),a.observe((function(t){c.sendMessage({handler:e.FloatingOneTapAuthEventsSDK.ADAPTIVITY_CHANGE,params:{uuid:l,is_adaptive:t}}),t?(s.style.maxWidth="468px",s.style.top="auto",s.style.bottom="0",s.style.right="50%",s.style.transform="translate(50%, 0)"):(s.style.maxWidth="400px",s.style.top="0",s.style.bottom="auto",s.style.right="0",s.style.transform="none"),s.style.display="none"})),window.addEventListener("resize",f)}))})),{getFrame:function(){return s},destroy:m,authReadyPromise:u,update:function(t){i=k(i||{},t),c&&i&&c.sendMessage({handler:e.FloatingOneTapAuthEventsSDK.UPDATE_PARAMS,params:i})}}},t.buttonOneTapAuth=function(n){var r=rt.validate({callback:n.callback});!r.isValid()&&console.error(r.error());var a=function(e){var t,n,r,a,i,s,c={},u=44,l=56;return e&&(c.display=e.displayMode&&He.includes(e.displayMode)?e.displayMode:Le.Default,c.button_skin=e.buttonSkin&&Ge.includes(e.buttonSkin)?e.buttonSkin:Ue.Primary,c.show_agreements=I(e.showAgreements,0),c.show_alternative_login=I(e.showAlternativeLogin,0),void 0!==e.scheme&&["bright_light","space_gray"].includes(e.scheme)&&(c.scheme=e.scheme),void 0!==(null===(t=e.buttonStyles)||void 0===t?void 0:t.height)&&(u=Number(null===(n=e.buttonStyles)||void 0===n?void 0:n.height),l=Number(null===(r=e.buttonStyles)||void 0===r?void 0:r.height)+12,c.style_height=null===(a=e.buttonStyles)||void 0===a?void 0:a.height),void 0!==(null===(i=e.buttonStyles)||void 0===i?void 0:i.borderRadius)&&(c.style_border_radius=null===(s=e.buttonStyles)||void 0===s?void 0:s.borderRadius),void 0!==e.langId&&(c.lang_id=Ve.includes(e.langId)?e.langId:o),u+=c.show_alternative_login?l:0,u+=c.show_agreements?80:0),{pageUrl:"button_one_tap_auth",pageUrlParams:c,frameStyles:"\n        height: "+u+"px;\n      ",scheme:(null==e?void 0:e.scheme)||"bright_light"}}(n.options);if(!a)throw new Error("options were not set");var i,s,c,u=ze(),l=oe({origin:location.protocol+"//"+location.host,uuid:u},a.pageUrlParams),p=a.pageUrl,d=new Re;c=new Promise((function(e){d.start(),d.get().then((function(t){e(t)}))}));var h=function(){s&&s.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:u}})},f=function(r){if(r.params.uuid===u)switch(r.handler){case e.OneTapAuthEventsSDK.RESIZE_FRAME:i.style.height=r.params.height+"px";break;case e.OneTapAuthEventsSDK.NOT_AUTHORIZED:d.resolve(r.handler);break;case e.ButtonOneTapAuthEventsSDK.SHOW_LOGIN:case e.ButtonOneTapAuthEventsSDK.SHOW_LOGIN_OPTIONS:n.callback({type:r.handler,payload:{uuid:u}});break;case e.ButtonOneTapAuthEventsSDK.SHOW_AGREEMENTS_DIALOG:t.userPolicyAgreements(u,null==a?void 0:a.scheme).show().then((function(t){t&&t.accepted&&s.sendMessage({handler:e.ButtonOneTapAuthEventsSDK.START_AUTHORIZE,params:{uuid:u}})})).catch((function(){s.sendMessage({handler:Ze.DECLINE_POLICY_AGREEMENTS,params:{uuid:u}})}));break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:d.resolve(r.handler);default:t.handleOneTapEvents(r,s,n)}};i=R("",{cssText:null==a?void 0:a.frameStyles});var m=n.container;return m&&m.appendChild(i),Ce.fetchDomain().then((function(){return xe(l,p).then((function(e){i.src=e,(s=new Ne({iframe:i,origin:"https://"+Ce.get().connectDomain})).onMessage(f),window.addEventListener("resize",h)}))})),{getFrame:function(){return i},destroy:function(){i&&(i.remove(),i=null),window.removeEventListener("resize",h),s&&s.destroy()},authReadyPromise:c,update:function(t){a=k(a||{},t),s&&a&&s.sendMessage({handler:e.ButtonOneTapAuthEventsSDK.UPDATE_PARAMS,params:a})}}},t.handleOneTapEvents=function(n,o,a){var i,s,c=n.params.uuid;switch(n.handler){case e.CommonSDKEvents.ERROR:r.handleError(n.params);break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:o.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:c}});break;case e.OneTapAuthEventsSDK.LOGIN_SUCCESS:a.callback({type:n.handler,provider:"vk",payload:n.params});break;case e.OneTapAuthEventsSDK.SHOW_CAPTCHA:var u=new Fe(c,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img},null===(i=a.options)||void 0===i?void 0:i.scheme);u.show().then((function(t){o.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS,params:oe({uuid:c},t)})})).catch((function(){o.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_FAIL,params:{uuid:c}}),u.destroy()}));break;case e.DataPolicyEventsSDK.SHOW_DATA_POLICY:t.userDataPolicy(c,null===(s=a.options)||void 0===s?void 0:s.scheme).show().then((function(){a.callback({type:e.DataPolicyEventsSDK.DATA_POLICY_RESULT,payload:{uuid:c,policyAccepted:!0}})})).catch((function(){a.callback({type:e.DataPolicyEventsSDK.DATA_POLICY_RESULT,payload:{uuid:c,policyAccepted:!1}})}));break;case e.OneTapAuthEventsSDK.FULL_AUTH_NEEDED:case e.OneTapAuthEventsSDK.PHONE_VALIDATION_NEEDED:a.callback({type:n.handler,payload:{uuid:c}})}},t.userDataPolicy=function(t,n){var o,a=nt.validate({uuid:t});!a.isValid()&&console.error(a.error());var i,s=window.innerHeight,c=function(){o&&(o.style.display="none")},u=new Re,l=function(){o&&o.remove(),i&&i.destroy()};o=R("",{properties:{height:s+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(o);var p=function(a){switch(a.handler){case e.CommonSDKEvents.ERROR:r.handleError(a.params);break;case e.DataPolicyEventsSDK.HIDE_DATA_POLICY:c(),u.resolve(void 0),l();break;case e.DataPolicyEventsSDK.SHOW_CAPTCHA:var s=new Fe(t,{captcha_sid:a.params.captcha_sid,captcha_img:a.params.captcha_img},n);s.show().then((function(n){i.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS,params:oe({uuid:t},n)}),o.style.display="block"})).catch((function(){i.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_FAIL,params:{uuid:t}}),s.destroy()})),c();break;default:c(),u.reject(),l()}};return Ce.fetchDomain().then((function(){xe({origin:location.protocol+"//"+location.host,uuid:t,scheme:n||"bright_light"},"user_data_policy").then((function(e){o.src=e})),(i=new Ne({iframe:o,origin:"https://"+Ce.get().connectDomain})).onMessage(p)})),{show:function(){return o.style.display="block",new Promise((function(e){u.start(),u.get().then((function(t){e(t)}))}))},hide:c,destroy:l}},t.userPolicyAgreements=function(n,o){var a,i,s,c,u=new Re;s="",c=window.innerHeight,a=R(s,{properties:{height:c+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+c+"px;\n      min-height: "+c+"px;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(a);var l=function(){a&&(a.remove(),a=null),i&&i.destroy()},p=function(){a&&(a.style.display="none")},d=function(s){switch(s.handler){case e.CommonSDKEvents.ERROR:r.handleError(s.params);break;case Ze.ACCEPT_POLICY_AGREEMENTS:p(),u.resolve({accepted:!0}),l();break;case Ze.DECLINE_POLICY_AGREEMENTS:p(),u.resolve({accepted:!1}),l();break;case Ze.GET_CAPTCHA:var c=new Fe(n,{captcha_sid:s.params.captcha_sid,captcha_img:s.params.captcha_img},o);c.show().then((function(e){i.sendMessage({handler:Ze.CAPTCHA_SUCCESS,params:oe({uuid:n},e)}),a.style.display="block"})).catch((function(){i.sendMessage({handler:Ze.CAPTCHA_FAIL,params:{uuid:n}}),c.destroy()})),p();break;case Ze.SHOW_DATA_POLICY:p();var d=function(){a.style.display="block"};t.userDataPolicy(n,o).show().then(d).catch(d);break;case Ze.POLICY_AGREEMENTS_ERROR:case Ze.HIDE_POLICY_AGREEMENTS:default:u.reject(),l()}};return Ce.fetchDomain().then((function(){xe({origin:location.protocol+"//"+location.host,uuid:n,scheme:o||"bright_light"},"user_policy_agreements").then((function(e){a.src=e,(i=new Ne({iframe:a,origin:"https://"+Ce.get().connectDomain})).onMessage(d)}))})),{show:function(){return a.style.display="block",new Promise((function(e){u.start(),u.get().then((function(t){e(t)}))}))},hide:p,destroy:l}},t.userVisibleAuth=function(r){return Ce.fetchDomain().then((function(){var o=ze(),a=Ce.get(),i=oe(oe({origin:location.protocol+"//"+location.host,uuid:o,debug:a._debug?1:null,localhost:a._localhost?1:null},M(r,["screen","source"])),{scheme:null==r?void 0:r.scheme}),s=Ie(null==r?void 0:r.action);s&&(i.action=s);var c=Me(null==r?void 0:r.entry);return c&&(i.initial_stats_info=c),xe(i).then((function(r){t.flags&&(r=r+"#"+w(t.flags));var a=screen.height/2-280,i=screen.width/2-410,s=window.open(r,"_blank","top="+a+",left="+i+",width=820,height=560,location");if(!s){var c=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED],e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED,W()));return Promise.reject(c)}return new Promise((function(t,r){var a=setInterval((function(){if(!s||s.closed){window.removeEventListener("message",i),clearInterval(a);var t=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_CLOSED],e.SDKErrorCodes.CONNECT_WINDOW_CLOSED,G()));r(t)}}),1e3);function i(c){if(c.source===s&&s)if(window.removeEventListener("message",i),clearInterval(a),function(e){for(var t=0;t<n.length;t++){var r=n[t];if(e.slice(e.length-r.length)===r)return!0}return!1}(c.origin))if(c.data.action==="vk_connect_response"+o){var u=c.data.payload;if(s.close(),u.error){p=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_CLIENT_SDK_ERROR],e.SDKErrorCodes.CONNECT_CLIENT_SDK_ERROR,B(u.error)));r(p)}else t({provider:"vk",payload:u})}else if(c.data.action==="oauth_callback"+o)t({provider:c.data.payload.name}),s.close();else if(c.data.action==="skip_callback"+o){var l=c.data.payload.redirectURL;l&&(window.location.href=l),s.close()}else if(c.data.action==="bind_ok_account"+o)t(c.data.payload),s.close();else{s.close();p=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_UNKNOWN_SDK_MESSAGE],e.SDKErrorCodes.CONNECT_UNKNOWN_SDK_MESSAGE,j(JSON.stringify(c.data))));r(p)}else{s.close();var p=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_DOMAIN_NOT_ALLOWED],e.SDKErrorCodes.CONNECT_DOMAIN_NOT_ALLOWED,F(c.origin)));r(p)}}window.addEventListener("message",i)}))}))}))},t.redirectAuth=function(e){var t=tt.validate(e);!t.isValid()&&console.error(t.error());var n=ze(),r=oe(oe({redirect_uri:e.url,uuid:n},M(e,["screen","source"])),{scheme:null==e?void 0:e.scheme}),o=Ie(null==e?void 0:e.action);o&&(r.action=o);var a=Me(null==e?void 0:e.entry);a&&(r.initial_stats_info=a),(null==e?void 0:e.state)&&(r.redirect_state=e.state),xe(r).then((function(e){location.assign(e)}))},t.logout=function(){return Ce.fetchDomain().then((function(){var t=Ce.get(),n=t.connectDomain,r=t.appId,o=t.superAppTokenV2;if(!o)return Promise.reject(H("superappToken","SuperappToken is undefined"));var a=w({origin:location.protocol+"//"+location.host,host_app_id:r,superapp_token:o}),i=fetch("https://"+n+"/logout?"+a,{credentials:"include"});return Ce.events.emit(e.CommonSDKEvents.LOGOUT),Ce.setSuperAppToken(""),Ce.setSuperAppToken("",{version:2}),i}))},t}(),at={OneTapAuthEventsSDK:e.OneTapAuthEventsSDK,FloatingOneTapAuthEventsSDK:e.FloatingOneTapAuthEventsSDK,ButtonOneTapAuthEventsSDK:e.ButtonOneTapAuthEventsSDK,DataPolicyEventsSDK:e.DataPolicyEventsSDK},it=["open_account"];var st,ct=function(){function t(){}return t.open=function(t){var n=ve.validate({token:t.action.token});return!n.isValid()&&console.error(n.error()),Ce.fetchDomain().then((function(){var n,r=ze(),o=Ce.get(),a=oe({origin:location.protocol+"//"+location.host,uuid:r,debug:I(o._debug,0),localhost:I(o._localhost,0)},M(t,["screen","source"])),i=(n=null==t?void 0:t.action)&&it.includes(n.name)?btoa(JSON.stringify(n)):"";return i&&(a.action=i),function(e){return Ce.fetchDomain().then((function(){var t=Ce.get(),n=t.appId,r=t.connectDomain,o=t.appSettings,a=t._debug,i=t._localhost,s=oe({app_id:n,response_type:"silent_token",v:"1.57.0",debug:a?1:null,localhost:i?1:null},e);o&&b(o)&&(s.app_settings=N(o));var c=w(s);return Promise.resolve("https://"+r+"/open_account?"+c)}))}(a).then((function(t){if(!window.open(t,"_blank")){var n=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED],e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED,W()));return Promise.reject(n)}return Promise.resolve()}))}))},t}();!function(e){e.INTERNAL_RESIZE="VKSDKMessengerInternalResize",e.INTERNAL_LOGOUT="VKSDKMessengerInternalLogout"}(st||(st={})),(e.MessengerEvents||(e.MessengerEvents={})).CLOSE_CHAT="VKSDKMessengerCloseChat";var ut,lt=function(){function e(){}return e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}(),pt=new me({params:[{rule:ce,errorText:Z("params")}]}),dt=function(){function t(){var t=this;this.config={},this.params={},this.loadingTask=new Re,this.initTask=new Re,this.cssText="",this.handleError=function(n){var r=de(le(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",n));t.events.emit(e.CommonSDKEvents.ERROR,r)},this.events=ae(),this.handleBridgeMessage=this.handleBridgeMessage.bind(this),this.handleChangeSuperAppToken=this.handleChangeSuperAppToken.bind(this),this.close=this.close.bind(this),this.handleLogout=this.handleLogout.bind(this)}return t.prototype.preload=function(t){var n=this;return Ce.fetchDomain().then((function(){return n.validateParams(t).then((function(){return n.updateParams(t),n.createIframe().then((function(){return n.initTask.start(),n.loadingTask.start(),n.timeoutTimer=setTimeout((function(){if(!n.initTask.finished){var t=de(le(e.SDKErrorCodes[e.SDKErrorCodes.LOADING_ERROR],e.SDKErrorCodes.LOADING_ERROR,z()));n.initTask.reject(t)}}),5e3),n.iframe.onload=function(){n.iframe.onload=null,n.loadingTask.resolve()},n.bridge=new Ne({iframe:n.iframe,origin:"https://"+Ce.get().connectDomain}),n.bridge.onMessage(n.handleBridgeMessage),Ce.events.on(re.SUPERAPP_TOKEN_CHANGE_V2,n.handleChangeSuperAppToken),Ce.events.on(e.CommonSDKEvents.LOGOUT,n.close),n.getIframeContainer().appendChild(n.iframe),n.loadingTask.get()}))}))}))},t.prototype.open=function(e){var t=this;return this.validateParams(e).then((function(){return t.initTask.finished?(t.updateParams(e),Promise.resolve()):t.initTask.active||t.initTask.finished?(t.updateParams(e),t.initTask.get()):t.preload(e).then((function(){return t.initTask.get()}))}))},t.prototype.update=function(e,t){e&&this.updateParams(e),t&&this.updateConfig(t)},t.prototype.close=function(){this.iframe&&this.iframe.remove(),this.bridge&&this.bridge.destroy(),Ce.events.off(re.SUPERAPP_TOKEN_CHANGE_V2,this.handleChangeSuperAppToken),Ce.events.off(e.CommonSDKEvents.LOGOUT,this.close),delete this.iframe,delete this.bridge,this.loadingTask=new Re,this.initTask=new Re,this.events.emit(e.CommonSDKEvents.CLOSE)},t.prototype.sendMessage=function(e){var t=Ae.validate({message:e});!t.isValid()&&console.error(t.error()),this.bridge.sendMessage(e)},t.prototype.on=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.prototype.off=function(e,t){var n=Ee.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},t.prototype.handleInit=function(){this.initTask.finished||(clearTimeout(this.timeoutTimer),this.initTask.resolve()),this.sendUpdateParamsMessage(),this.iframe.style.display="block"},t.prototype.handleRequestAuth=function(){Ce._auth({version:2})},t.prototype.handleRequestSuperAppToken=function(e){Ce._requestSuperAppToken(e,{version:2})},t.prototype.handleChangeSuperAppToken=function(t){this.bridge.sendMessage({handler:e.CommonSDKEvents.REQUEST_SUPERAPP_TOKEN+"Success",params:{result:t}})},t.prototype.handleBridgeMessage=function(t){switch(lt.log(t),t.handler){case L.INIT:this.handleInit();break;case e.CommonSDKEvents.REQUEST_SUPERAPP_TOKEN:this.handleRequestSuperAppToken(t.params);break;case e.CommonSDKEvents.AUTH_NEEDED:this.handleRequestAuth();break;case e.CommonSDKEvents.CLOSE:this.close();break;case e.CommonSDKEvents.ERROR:this.handleError(t.params);break;default:return}},t.prototype.handleLogout=function(){Ce._logout()},t.prototype.handleAfterUpdateParams=function(){this.sendUpdateParamsMessage()},t.prototype.handleAfterUpdateConfig=function(){},t.prototype.handleAfterCreateIframe=function(){},t.prototype.validateParams=function(e){var t=pt.validate({params:e});return!t.isValid()&&console.error(t.error()),Promise.resolve(e)},t.prototype.createIframe=function(){var e=this;return this.getIframeUrl().then((function(t){return e.iframe=R(t,{cssText:e.cssText}),e.handleAfterCreateIframe(),Promise.resolve()}))},t.prototype.getIframeUrl=function(){return new Promise((function(e){return e("")}))},t.prototype.getIframeContainer=function(){return window.document.body},t.prototype.getIframeUrlParams=function(){var e=this;return Ce.fetchDomain().then((function(){var t=Ce.get(),n=t.superAppTokenV2,r=t.appId,o=t._debug,a=t._localhost;return Promise.resolve(w(oe(oe({},e.params),{host_app_id:r,superapp_token:n,origin:location.protocol+"//"+location.host,debug:o?1:null,localhost:a?1:null})))}))},t.prototype.updateConfig=function(e){this.config=k(this.config,e),this.handleAfterUpdateConfig()},t.prototype.updateParams=function(e){this.params=k(this.params,e||{}),this.handleAfterUpdateParams()},t.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.initTask.finished&&this.bridge.sendMessage({params:this.params,handler:e.CommonSDKEvents.UPDATE_PARAMS})},t}(),ht=new me({config:[{rule:ce,errorText:Z("config")}]}),ft={styles:{bottom:"0",right:"0",zIndex:99999}},mt=function(t){function n(e){var n=t.call(this)||this;n.config=ft,n.cssText="\n    border: none;\n    display: none;\n    position: fixed;\n  ",n.updateStyles=function(){if(n.iframe){var e=n.config.styles,t=isFinite(e.zIndex)?e.zIndex:999999;n.iframe.style.zIndex=""+t,n.iframe.style.bottom=e.bottom,n.iframe.style.right=e.right}};var r=ht.validate({config:e});return!r.isValid()&&console.error(r.error()),n.updateConfig(e),n}return $(n,t),n.prototype.handleBridgeMessage=function(n){var r=this;switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.CommonSDKEvents.GET_CAPTCHA:var o=n.params.uuid,a=new Fe(o,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img});a.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Success",params:oe({uuid:o},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Fail",params:{uuid:o}}),a.destroy()}));break;case st.INTERNAL_RESIZE:this.handleInternalIframeResize(n);break;case st.INTERNAL_LOGOUT:this.handleLogout();break;case e.MessengerEvents.CLOSE_CHAT:this.events.emit(e.MessengerEvents.CLOSE_CHAT,n.params);break;default:return}},n.prototype.handleInternalIframeResize=function(e){var t=e.params;this.iframe.width=t.width+"px",this.iframe.height=t.height+"px"},n.prototype.handleAfterUpdateConfig=function(){this.updateStyles()},n.prototype.handleAfterCreateIframe=function(){this.updateStyles()},n.prototype.validateParams=function(e){return e.peer_id>=0?Promise.reject(H("peer_id","Peer id can`t be positive")):Promise.resolve(e)},n.prototype.getIframeUrl=function(){var e=this;return Ce.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Ce.get().connectDomain;return Promise.resolve("https://"+t+"/messenger?"+e)}))}))},n}(dt);(ut=e.AuthQREvents||(e.AuthQREvents={})).SCANNED="VKSDKQRScaned",ut.CLICKED="VKSDKQRClicked";var vt=new me({container:[{rule:ce,errorText:Z("container")}]}),Et=function(t){function n(e){var n=t.call(this)||this;n.getIframeContainer=function(){return n.config.container?n.config.container:window.document.body};var r=vt.validate(e);return!r.isValid()&&console.error(r.error()),(null==e?void 0:e.langId)&&!Ve.includes(null==e?void 0:e.langId)&&console.error(H("lang_id","This lang id is not allowed")),n.updateConfig(e),n}return $(n,t),n.prototype.getIframeUrl=function(){return this.getIframeUrlParams().then((function(e){var t=Ce.get().connectDomain;return Promise.resolve("https://"+t+"/qr_auth?"+e)}))},n.prototype.getIframeUrlParams=function(){var e=this;return Ce.fetchDomain().then((function(){var t,n=Ce.get(),r=n.appId,o=n._debug,a=n._localhost;return Promise.resolve(w({scheme:(null===(t=e.params)||void 0===t?void 0:t.scheme)||"bright_light",app_id:r,origin:location.protocol+"//"+location.host,lang_id:e.config.langId||null,initial_stats_info:Me(e.config.entry)||null,debug:o?1:null,localhost:a?1:null}))}))},n.prototype.handleBridgeMessage=function(n){var r=this;switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.AuthQREvents.CLICKED:this.events.emit(e.AuthQREvents.CLICKED);break;case e.AuthQREvents.SCANNED:this.events.emit(e.AuthQREvents.SCANNED,n.params.token);break;case e.CommonSDKEvents.GET_CAPTCHA:var o=n.params.uuid,a=new Fe(o,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img});a.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Success",params:oe({uuid:o},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Fail",params:{uuid:o}}),a.destroy()}));break;default:return}},n}(dt);e.Account=ct,e.AuthQR=Et,e.BodyOverflowManager=U,e.Config=Ce,e.Connect=ot,e.ConnectEvents=at,e.GeoService=et,e.Messenger=mt,e.MiniApp=je,e.MiniAppService=Be,Object.defineProperty(e,"__esModule",{value:!0})}));

</script>

</body>
</html>
