<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>paypal-in-context-v4.html</title>
</head>
<body>

<script>
var IWD=IWD||{};var $ji=$ji||$j;IWD.InContext={reinitDefaultMethods:function(){if(typeof(Payment)=="undefined"){return;}
Payment.prototype.save=Payment.prototype.save.wrap(function(save){var validator=new Validation(this.form);if(this.validate&&this.validate()&&validator.validate()){last4paypal();if(payment.currentMethod==='paypal_express'||payment.currentMethod==='paypaluk_express'){var request=new Ajax.Request(this.saveUrl,{method:'post',onComplete:function(){},onSuccess:function(){},onFailure:checkout.ajaxFailure.bind(checkout),parameters:Form.serialize(this.form)});}else{save();}}else if(typeof hideLoadingForPaymentMethod==='function'&&payment.currentMethod!=='astropaystreamlinetarjetas'){hideLoadingForPaymentMethod();}});}};if(typeof(window.paypalCheckoutReady)=="undefined"){window.paypalCheckoutReady=function(){if(typeof(IWD.OPC)!="undefined"||typeof(IWD.ES)!="undefined"||typeof(IWD.LIPP)!="undefined"){return;}
if(typeof(PayPalLightboxConfig)=="undefined"){return;}
if(typeof(PayPalLightboxConfig)!="object"){PayPalLightboxConfig=JSON.parse(PayPalLightboxConfig);}
if(PayPalLightboxConfig.isActive==0){return;}
if(typeof(IDS)=="undefined"){IDS=new Array();if($('paypal-save-button')!=undefined){IDS.push('paypal-save-button');}}else{if($('paypal-save-button')!=undefined){IDS.push('paypal-save-button');}}
paypal.checkout.setup(PayPalLightboxConfig.merchantid,{environment:PayPalLightboxConfig.environment,button:IDS,click:function(e){e.preventDefault();if($('paypal-save-button')!=undefined){if(payment.currentMethod!='paypal_express'&&payment.currentMethod!='paypaluk_express'){return;}}
if($ji(e.target).closest('.add-to-cart').length>0){return;}
var link=$ji(e.target).parent().attr('href');if(typeof(link)!="undefined"){if(link.indexOf('paypaluk')>=0||link.indexOf('payflow')>=0){var urlConnect=PayPalLightboxConfig.setExpressCheckoutUk;}else if(link.indexOf('paypal')>=0){var urlConnect=PayPalLightboxConfig.setExpressCheckout}}else{if(payment.currentMethod=='paypal_express'){var urlConnect=PayPalLightboxConfig.setExpressCheckout}
if(payment.currentMethod=='paypaluk_express'){var urlConnect=PayPalLightboxConfig.setExpressCheckoutUk;}}
paypal.checkout.initXO();$ji.support.cors=true;$ji.ajax({url:urlConnect,type:"GET",async:true,crossDomain:false,success:function(token){if(token.indexOf('cart')!=-1||token.indexOf('login')!=-1){paypal.checkout.closeFlow();setLocation(token);}else{var url=paypal.checkout.urlPrefix+token;paypal.checkout.startFlow(url);}},error:function(responseData,textStatus,errorThrown){alert("Error in ajax post"+responseData.statusText);paypal.checkout.closeFlow();}});}});};};document.observe("dom:loaded",function(){if(typeof(IWD.OPC)!="undefined"||typeof(IWD.ES)!="undefined"||typeof(IWD.LIPP)!="undefined"){return;}
if(typeof(PayPalLightboxConfig)!="undefined"){if(typeof(PayPalLightboxConfig)!="object"){PayPalLightboxConfig=JSON.parse(PayPalLightboxConfig);}
if(PayPalLightboxConfig.isActive==0){return;}
IWD.InContext.reinitDefaultMethods();}});function last4paypal(){var form_type=$j('input[name=paypal_login]:checked').val();var last4paypal,selectpaypal;if(form_type=='Billing'){last4paypal=$j('#paypal_ultimos4digitos').val();selectpaypal=$j('input[name=paypal_card]:checked').val();}else if(form_type=='Login'){last4paypal=$j('#paypal_ultimos4digitos_login').val();selectpaypal=$j('input[name=paypal_card_login]:checked').val();}
var last4paypal=jQuery.ajax({url:AP_BASE_URL+'/ajaxapi/ajax/index',type:'POST',data:{ajax:'last4paypal',form_type:form_type,last4paypal:last4paypal,selectpaypal:selectpaypal},dataType:"html"});last4paypal.done(function(msg){if(msg){}})
last4paypal.fail(function(jqXHR,textStatus,errorThrown){});$j('body').addClass('paypal_discount_applied');}
</script>

</body>
</html>
