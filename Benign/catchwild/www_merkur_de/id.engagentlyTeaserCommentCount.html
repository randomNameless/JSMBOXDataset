<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>id.engagentlyTeaserCommentCount.html</title>
</head>
<body>

<script>
define(["modules/id.core"],function(t){"use strict";t.utils.log("loading id.engagentlyTeaserCommentCount.js");var e=function(){this.conf={url:null,checkCmp:!0,forceConsent:!1,cmpVendorId:null};var e="data-id-engagently-id",n="data-id-engagently-id-result",o="idjs-engagently-text--",i="Kommentar",r="Kommentare",s=50;this.getDiscussionIdsFromMarkup=function(){var t,o,i=[],r=document.querySelectorAll("["+e+"]");for(t=0;r.length>t;t+=1)o=r[t].getAttribute(e),o&&(i.push(o),r[t].removeAttribute(e),r[t].setAttribute(n,o));return i.filter(function(t,e){return i.indexOf(t)===e})},this.getCountersFromApi=function(e,n){var o;return e&&e.length?(o=new XMLHttpRequest,o.open("POST",this.conf.url,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?n(JSON.parse(o.responseText)):t.utils.log("[EngagentlyTeaserCommentCount] XMLHttpRequest error:",o.status,o.statusText))},o.send(JSON.stringify({discussion_ids:e})),void 0):{}},this.updateDom=function(t){var e,s,a,d,l,c,u;for(a=0;Object.keys(t).length>a;a+=1)if(e=Object.keys(t)[a],l=t[e],"number"==typeof l&&l>0){for(s=document.querySelectorAll("["+n+'="'+e+'"]'),d=0;s.length>d;d+=1)s[d].innerText=l;for(c=l>1?r:i,u=document.getElementsByClassName(o+e),d=0;u.length>d;d+=1)u[d].innerText=c}},this.updateCounters=function(){var e;try{for(e=this.getDiscussionIdsFromMarkup();e.length;)this.getCountersFromApi(e.slice(0,s),this.updateDom),e=e.slice(s)}catch(n){t.utils.log("[EngagentlyTeaserCommentCount] updateCounters error:",n)}},this.checkConsent=function(t){var e=this;window.__tcfapi("addEventListener",2,function(n,o){!o||"useractioncomplete"!==n.eventStatus&&"tcloaded"!==n.eventStatus||(!e.conf.forceConsent||n.customVendors&&n.customVendors.consents&&n.customVendors.consents[t]===!0)&&(e.initModule(),window.__tcfapi("removeEventListener",2,null,o.listenerId))})},this.checkCmp=function(e){var n,o,i=this;try{window.__tcfapi?this.checkConsent(e):(n=0,o=setInterval(function(){window.__tcfapi?(clearInterval(o),i.checkConsent(e)):100===n&&(clearInterval(o),t.utils.log("[EngagentlyTeaserCommentCount] checkCmp timed out")),n+=1},100))}catch(r){t.utils.log("[EngagentlyTeaserCommentCount] checkCmp error:",r)}},this.initModule=function(){var e=this;t.event.subscribe(t.event.constants.TEASER_LAZYLOADED,function(){e.updateCounters()}),this.updateCounters()},this.init=function(){this.conf.url?this.conf.checkCmp?this.conf.cmpVendorId?this.checkCmp(this.conf.cmpVendorId):t.utils.log("[EngagentlyTeaserCommentCount] init error: missing cmpVendorId"):this.initModule():t.utils.log("[EngagentlyTeaserCommentCount] init error: missing api url")}};return e});
</script>

</body>
</html>
